---
title: Создание приложения резервного копирования
description: Для выполнения ввода-вывода на ленте приложение резервного копирования сначала должно получить маркер ленточного устройства. В следующем примере кода показано, как использовать функцию CreateFile для открытия ленточного устройства.
ms.assetid: a2d367e1-13a9-47a8-8329-6e550c09ad58
keywords:
- Резервное копирование архивных приложений
- Создание резервной копии резервных копий приложений
- Резервное копирование, создание приложений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3086e51bce928b682d3e61518de29118abdc48461a77f79e48a4a4cb4b0f2c3e
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119529484"
---
# <a name="creating-a-backup-application"></a>Создание приложения резервного копирования

Для выполнения ввода-вывода на ленте приложение резервного копирования сначала должно получить маркер ленточного устройства. В следующем примере кода показано, как использовать функцию [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) для открытия ленточного устройства.


```C++
HANDLE hTape;   // handle to tape device
 
hTape = CreateFile(TEXT("\\\\.\\TAPE0"),         // tape dev to open
                   GENERIC_READ | GENERIC_WRITE, // read/write access
                   0,                            // not used
                   0,                            // not used
                   OPEN_EXISTING,                // req for tape devs
                   0,                            // not used
                   NULL);                        // not used
```



Чтобы создать резервную копию дерева каталогов на ленте, приложение должно использовать функции [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) и [**FindNextFile**](/windows/desktop/api/fileapi/nf-fileapi-findnextfilea) для прохода по дереву каталогов. При каждом обнаружении файла приложение должно получить атрибуты файла с помощью функции [**GetFileAttributes**](/windows/desktop/api/fileapi/nf-fileapi-getfileattributesa) .

При наличии жестких связей приложение должно определить количество ссылок и сохранить уникальный идентификатор файла в таблице для будущих сравнений. При первом обнаружении файла приложение должно использовать [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , чтобы открыть файл, и функцию [**баккупреад**](/windows/desktop/api/Winbase/nf-winbase-backupread) , чтобы начать резервное копирование. Затем можно многократно использовать функцию [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) для перемещения всей информации из буфера, используемого **баккупреад** , на ленту. При втором обнаружении файла (проверяется на соответствие таблице идентификаторов файлов при наличии жестких связей) приложение может записать общие сведения о файле на ленту, а затем — поток с идентификатором, который является **\_ ссылкой для резервного копирования**.

При восстановлении файлов с ленты на диск приложение должно использовать функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea), [**баккупврите**](/windows/desktop/api/Winbase/nf-winbase-backupwrite)и [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) . Для каждого файла на ленте приложение должно использовать **CreateFile** , чтобы создать новый файл на диске, и **баккупврите** начать восстановление файла. Затем приложение должно многократно использовать **ReadFile** , пока вся информация для файла считывается с ленты в буфер, заполненный **баккупврите**.

Если один из потоков в буфере [**баккупврите**](/windows/desktop/api/Winbase/nf-winbase-backupwrite) имеет идентификатор потока **\_ связи резервной копии** , приложение должно установить жесткую связь. Если данные, необходимые для установления связи, не существуют, **баккупврите** завершается ошибкой. Приложение может использовать существующий каталог для поиска и восстановления исходных данных или уведомлять пользователя о том, что восстанавливаемые данные файлов находятся в другом расположении.

 

 