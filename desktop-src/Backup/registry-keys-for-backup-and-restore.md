---
title: Разделы и значения реестра для резервного копирования и восстановления
ms.assetid: 83449f78-cca1-449b-8c5f-3c8a91c8b3e7
description: 'Дополнительные сведения: разделы реестра и значения для резервного копирования и восстановления'
keywords:
- Резервное копирование, разделы реестра
- Резервная копия разделов реестра
- Резервная копия Кустомперформанцесеттингс
- Резервная копия Дисаблемониторинг
- Резервная копия Филесноттобаккуп
- Резервная копия Филесноттоснапшот
- Резервная копия Кэйснотторесторе
- Резервная копия Ластинстанце
- Резервная копия Ластрестореид
- Резервная копия Максшадовкопиес
- Резервная копия Миндиффареафилесизе
- Резервная копия Овераллперформанцесеттинг
- Резервная копия SYSVOL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef9796ff96efbc20ac90de6d26a0c1bac7b17633
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104142766"
---
# <a name="registry-keys-and-values-for-backup-and-restore"></a>Разделы и значения реестра для резервного копирования и восстановления

Приложения, запрашивающие или выполняющие операции резервного копирования и восстановления, должны использовать следующие разделы и значения реестра для взаимодействия друг с другом или с такими компонентами, как [Служба теневого копирования томов (VSS)](/windows/desktop/VSS/volume-shadow-copy-service-portal) и Windows Backup.

-   [кустомперформанцесеттингс](#customperformancesettings)
-   [дисаблемониторинг](#disablemonitoring)
-   [филесноттобаккуп](#filesnottobackup)
-   [филесноттоснапшот](#filesnottosnapshot)
-   [IdleTimeout](#idletimeout)
-   [кэйснотторесторе](#keysnottorestore)
-   [ластинстанце](#lastinstance)
-   [ластрестореид](#lastrestoreid)
-   [MaxShadowCopies](#maxshadowcopies)
-   [MinDiffAreaFileSize](#mindiffareafilesize)
-   [Овераллперформанцесеттинг и Кустомперформанцесеттингс](#overallperformancesetting-and-customperformancesettings)
-   [SYSVOL](#sysvol)

## <a name="customperformancesettings"></a>кустомперформанцесеттингс

См. раздел [овераллперформанцесеттинг and кустомперформанцесеттингс](#overallperformancesetting-and-customperformancesettings).

## <a name="disablemonitoring"></a>дисаблемониторинг

На клиентских платформах Windows, начиная с Windows 7, пользователям автоматически предлагается настроить функцию архивации Windows, если это еще не сделано. Эти уведомления отображаются во время запуска компьютера, начиная с 7 дней после установки операционной системы. Они также появляются, когда пользователь подключается к жесткому диску. в этом случае уведомления отображаются немедленно.

Изготовители оборудования и разработчики сторонних приложений резервного копирования могут использовать значение реестра **дисаблемониторинг** для отключения этих автоматических уведомлений.

Это значение не существует по умолчанию, поэтому оно должно быть создано в следующем разделе реестра:

**HKey \_ \_** \\ **Программное обеспечение** локального компьютера \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **виндовсбаккуп**

Значение реестра **дисаблемониторинг** имеет тип данных REG \_ DWORD и интерпретируется следующим образом:

-   Если значение параметра равно 1 и пользователи еще не настроили функцию архивации Windows, автоматическое уведомление отключается. Если автоматическое уведомление уже имеется в центре уведомлений, установка этого параметра реестра приводит к удалению уведомления в 10:00 следующего утра.
-   Если значение не существует, если его данные не заданы или если его данные имеют значение 0, автоматические уведомления не отключаются.

**Windows Vista и Windows XP:** Это значение реестра не поддерживается.

## <a name="filesnottobackup"></a>филесноттобаккуп

Раздел реестра **филесноттобаккуп** указывает имена файлов и каталогов, которые приложения резервного копирования не должны выполнять резервное копирование или восстановление. Каждая запись в этом ключе является \_ строкой с несколькими \_ SZами в следующем формате:

\[ \] Диск \[  \] Путь \\ *Имя файла* \[ ключ\]

-   *Диск* указывает диск и является необязательным. Например, c:. Чтобы указать все диски, используйте обратную косую черту ( \) ; буквы дисков не требуются.
-   *Путь* указывает путь и является необязательным. Он не может содержать подстановочные знаки.
-   *Имя_файла* указывает файл или каталог и является обязательным. Он может содержать подстановочные знаки.
-   /s указывает, что должны быть включены все подкаталоги указанного пути.
-   Переменные среды, такие как% SystemRoot%, можно заменить всей строкой или ее частью.

В следующей таблице показаны некоторые стандартные записи.

| Имя записи                             | Значение по умолчанию                                                                             |
|----------------------------------------|-------------------------------------------------------------------------------------------|
| Internet Explorer                      | Временные файлы                                                                           |
| Файл подкачки памяти                       | \\Pagefile.sys                                                                            |
| MS координатор распределенных транзакций | C: \\ Windows \\ system32 \\ MSDTC \\ MSDTC. Журнал C: \\ Windows \\ system32 \\ MSDtc \\ Trace \\ дтктраце. log |
| Кэш автономные файлы                    | % SystemRoot% \\ Csc \\ \* /s                                                                  |
| Управление питанием                       | \\hiberfil.sys                                                                            |
| Хранилище единственных копий                | \\SIS Common Store \\ \* . \* /s                                                              |
| Временные файлы                        | % TEMP% \\ \* /s                                                                             |



 

> [!Note]  
> Приложения, выполняющие резервное копирование на уровне тома, обычно выполняют копирование всего тома на уровне блоков, поэтому они не могут учитывать раздел реестра **филесноттобаккуп** во время резервного копирования. Вместо этого они ожидают восстановления, чтобы удалить файлы, которые не были архивированы. В большинстве случаев это разумная стратегия. Однако в случае файлов хранилища с одним экземпляром общие файлы хранилища SIS не должны удаляться во время восстановления.

 

Для резервного копирования томов на уровне блоков cистема архивации данных Windows Server и программа Windows Wbadmin соблюдают раздел реестра **филесноттобаккуп** , удаляя соответствующие файлы во время восстановления. Восстановление системы и резервное копирование состояния системы не учитывают раздел реестра **филесноттобаккуп** .

**Windows XP:** При восстановлении системы учитывается раздел реестра **филесноттобаккуп** .

## <a name="filesnottosnapshot"></a>филесноттоснапшот

VSS поддерживает раздел реестра **филесноттоснапшот** . Приложения и службы могут использовать этот ключ для указания файлов, которые будут удалены из вновь создаваемых теневых копий. Дополнительные сведения см. в разделе [исключение файлов из теневых копий](/windows/desktop/VSS/excluding-files-from-shadow-copies).

**Windows Server 2003 и Windows XP:** Этот раздел реестра не поддерживается.

Для резервного копирования томов на уровне блоков cистема архивации данных Windows Server учитывает раздел реестра **филесноттоснапшот** , удаляя соответствующие файлы во время восстановления.

## <a name="idletimeout"></a>IdleTimeout

Параметр реестра **IdleTimeout** указывает время в секундах, в течение которого служба VSS будет ожидать, когда она простаивает. Если это значение времени ожидания достигнуто и нет задач для выполнения, служба VSS завершит работу.

Это значение реестра можно найти в следующем разделе реестра:

**HKey \_ \_** \\  \\  \\  \\  \\ **Параметры** VSS CurrentControlSet Services системы локального компьютера

Если это значение реестра не существует:

-   Фактическое значение времени ожидания, используемое по умолчанию, составляет 180 секунд (3 минуты).
-   Можно создать значение с именем **IdleTimeout** и типом DWORD и присвоить ему нужное значение.

Если значение этого параметра реестра равно 0 секундам:

-   Фактическое значение времени ожидания, которое используется, составляет 180 секунд (3 минуты).

Если задать это значение реестра, сделайте следующее:

-   Служба VSS использует заданное значение времени ожидания.
-   Можно указать любое значение от 1 до FFFFFFFF секунд. Однако рекомендуется выбрать значение от 1 до 180 секунд.

**Windows Server 2003 и Windows XP:** Этот раздел реестра не поддерживается.

## <a name="keysnottorestore"></a>кэйснотторесторе

Раздел реестра **кэйснотторесторе** указывает имена подразделов реестра и значений, которые приложения резервного копирования не должны восстанавливать. Дополнительные сведения см. в разделе [кэйснотторесторе](/previous-versions/windows/it-pro/windows-server-2003/cc737538(v=ws.10)). Не обязательно учитывать раздел реестра **кэйснотторесторе** .

**Windows Server 2003 и Windows XP:** Необходимо учитывать раздел реестра **кэйснотторесторе** .

Для резервного копирования томов на уровне блоков cистема архивации данных Windows Server учитывает раздел реестра **кэйснотторесторе** , удаляя соответствующие файлы во время восстановления.

При резервном копировании состояния системы учитывается раздел реестра **кэйснотторесторе** .

## <a name="lastinstance"></a>ластинстанце

Значение реестра **ластинстанце** указывает, что была выполнена операция восстановления без операционной системы и что тома были перезаписаны, но не отформатированы. Дополнительные сведения см. [в статье Использование автоматического восстановления системы VSS для аварийного восстановления](/windows/desktop/VSS/using-vss-automated-system-recovery-for-disaster-recovery).

**Windows Server 2003 и Windows XP:** Это значение реестра не поддерживается.

## <a name="lastrestoreid"></a>ластрестореид

Когда приложение резервного копирования выполняет восстановление состояния системы, оно должно указать, что это сделало это, установив значение реестра **ластрестореид** . "Восстановление состояния системы" в этом случае относится к любому восстановлению, которое выборочно восстанавливает двоичные файлы и драйверы операционной системы.

Если весь загрузочный и системный тома восстанавливаются на уровне тома, это значение не должно быть задано.

Если значение реестра **ластрестореид** не существует, приложение резервного копирования должно создать его в следующем разделе реестра:

**HKey \_ Локальный \_ компьютер** \\ **система** \\ **CurrentControlSet** \\ **элемент управления** \\ **баккупресторе** \\ **системстатересторе**

Создайте значение с именем **ластрестореид** и введите REG \_ SZ. Значение должно быть уникальным непрозрачным значением, таким как GUID.

При каждом выполнении нового восстановления состояния системы приложение резервного копирования должно изменить данные значения **ластрестореид** .

Другие приложения, которым необходимо отслеживать восстановление состояния системы, должны хранить данные этого значения реестра. Эти данные можно сравнить с текущими данными значения реестра **ластрестореид** , чтобы определить, выполнено ли новое восстановление состояния системы.

Windows **Vista, Windows Server 2003 и Windows XP:** Это значение реестра не поддерживается до Windows Vista с пакетом обновления 1 (SP1) и Windows Server 2008.

## <a name="maxshadowcopies"></a>MaxShadowCopies

Параметр реестра **максшадовкопиес** указывает максимальное число [*доступных для клиента теневых копий*](/windows/desktop/VSS/vssgloss-c) , которые могут храниться на каждом томе компьютера. Теневая копия, доступная для клиента, — это теневая копия, созданная с помощью **\_ \_ клиентского \_ CTX VSS** значение перечисления [**\_ \_ \_ контекста моментальных снимков VSS**](/windows/desktop/api/vss/ne-vss-vss_snapshot_context) . Доступные для клиента теневые копии, которые используются теневыми копиями для общих папок. Дополнительные сведения о теневых копиях см. в документации по [VSS](/windows/desktop/VSS/volume-shadow-copy-service-portal) .

Если значение реестра **максшадовкопиес** не существует, приложение резервного копирования может создать его в следующем разделе реестра:

**HKey \_ \_** \\  \\  \\  \\  \\ **Параметры** VSS CurrentControlSet Services системы локального компьютера

Создайте значение с именем **максшадовкопиес** и типом DWORD. Данные по умолчанию для этого значения — 64. Минимальное значение равно 1. Максимальное значение — 512.

> [!Note]  
> Для других типов теневых копий отсутствует значение реестра, соответствующее **максшадовкопиес**. Максимальное количество теневых копий — 512 на том.

 

**Примечание**  .  Параметр **максшадовкопиес** поддерживается в Windows Server 2003 или более поздней версии.

**Windows Server 2003:** На серверах кластера для данных значения реестра **максшадовкопиес** может потребоваться указать меньшее число. Дополнительные сведения см. в подразделе «при использовании служба теневого копирования томов на компьютерах под управлением Windows Server 2003, на которых выполняется много операций ввода-вывода, тома дисков получают больше времени на подключение к сети» в базе знаний «Справка и поддержка» в [https://support.microsoft.com/kb/945058](https://support.microsoft.com/kb/945058) .

**Windows XP:** Это значение реестра не поддерживается.

## <a name="mindiffareafilesize"></a>MinDiffAreaFileSize

Служба [VSS](/windows/desktop/VSS/volume-shadow-copy-service-portal) выделяет область хранения теневых копий (или область копирования) для хранения данных теневых копий. Минимальный размер области хранения теневых копий — это параметр для каждого компьютера, который можно указать с помощью значения реестра **миндиффареафилесизе** .

Если значение реестра **миндиффареафилесизе** не задано, минимальный размер области хранения теневых копий составляет 32 МБ для томов размером менее 500 мб и 320 МБ для томов размером более 500 МБ.

**Windows server 2008, Windows server 2003 с пакетом обновления 1 (SP1) и Windows Vista:** Если значение реестра **миндиффареафилесизе** не задано, область хранения теневых копий имеет минимальный размер 300 МБ. Если задано значение реестра **миндиффареафилесизе** , его данные должны быть в диапазоне от 300 мб до 3000 МБ (3 ГБ) и должны быть кратны 300 МБ.

**Windows Server 2003:** Если значение реестра **миндиффареафилесизе** не задано, минимальный размер области хранения теневых копий составляет 100 МБ.

**Windows XP:** Это значение реестра не поддерживается.

Если значение реестра **миндиффареафилесизе** не существует, приложение резервного копирования может создать его в следующем разделе реестра:

**HKey \_ \_** \\  \\ **VolSnap CurrentControlSet** \\ **Services** \\  системы локального компьютера

Создайте значение с именем **миндиффареафилесизе** и введите REG \_ DWORD. Данные для этого ключа указываются в мегабайтах. 320 равен 320 МБ, а 3200 равен 3,2 ГБ. Необходимо указать число, кратное 32. Если указать значение, не кратное 32, будет использоваться следующее число, кратное 32.

Теневые копии могут работать неправильно, если значение реестра **миндиффареафилесизе** указывает минимальный размер, превышающий максимальный размер области хранения теневых копий. Чтобы указать максимальный размер области хранения теневых копий, используйте команду [vssadmin](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc754968(v=ws.11)) Add Шадовстораже или vssadmin Resize шадовстораже. Чтобы просмотреть текущий максимальный размер, используйте команду [vssadmin list шадовстораже](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc754968(v=ws.11)) . Если не задать максимальный размер, то объем пространства, который можно использовать, не ограничен.

## <a name="overallperformancesetting-and-customperformancesettings"></a>Овераллперформанцесеттинг и Кустомперформанцесеттингс

Значения реестра **овераллперформанцесеттинг** и **кустомперформанцесеттингс** используются для указания параметров производительности для Cистема архивации данных Windows Server. Эти значения реестра поддерживаются только в операционных системах Windows Server.

**Windows Server 2003:** Эти значения реестра не поддерживаются.

Если эти параметры реестра не существуют, приложение резервного копирования может создать их в следующем разделе реестра:

**HKey \_ Локальное \_ компьютерное** \\ **программное обеспечение** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Windows — Архивация на уровне блока**

Чтобы указать параметры производительность для всех томов, создайте значение с именем **овераллперформанцесеттинг** и введите REG \_ DWORD. Для данных значения необходимо задать одно из следующих значений.

| Значение | Значение                                                                                                                                                                                                                                   |
|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1     | Обычная производительность резервного копирования (с использованием полных резервных копий). Этот параметр соответствует параметру обычная производительность резервного копирования, описанному в статье [Оптимизация резервного копирования и производительности сервера](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759145(v=ws.11)).            |
| 2     | Более высокая производительность резервного копирования (с использованием добавочных резервных копий). Этот параметр соответствует более быстрому параметру производительности резервного копирования, описанному в статье [Оптимизация резервного копирования и производительности сервера](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759145(v=ws.11)).     |
| 3     | Пользовательская производительность резервного копирования (с указанием параметра производительности для каждого тома). Этот параметр соответствует пользовательскому параметру, описанному в разделе [Оптимизация производительности резервного копирования и сервера](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd759145(v=ws.11)). |



 

Если для **овераллперформанцесеттинг** задано значение 3, необходимо также указать параметры производительность для каждого тома отдельно. Для этого создайте значение с именем **кустомперформанцесеттингс** и введите REG \_ Multi \_ SZ. Данные этого значения должны быть заданы следующим образом:

-   Каждая строка в \_ \_ SZ последовательности строк reg содержит параметр для тома.
-   Каждая строка состоит из GUID тома, за которым следует запятая, за которым следует значение DWORD.
-   Каждое из значений DWORD имеет значение 1 (полное резервное копирование) или 2 (добавочное резервное копирование).

Например, предположим, что компьютер имеет два тома, как показано ниже.

-   Два тома — C: \\ и D: \\ .
-   GUID для тома C: \\ — 07c473ca4-2df8-11de-9d80-806e6f6e6963, а GUID для тома D: \\ — 0ac22ea6c-712f-11de-adb0-00215a67606e.
-   Необходимо указать обычную архивацию перфорнанце для тома C: \\ и более быструю производительность резервного копирования для тома D: \\ .

Для этого нужно задать для **овераллперформанцесеттинг** значение 3, а **кустомперформанцесеттингс** — 07c473ca4-2df8-11de-9d80-806e6f6e6963, 1 \\ 00ac22ea6c-712f-11de-adb0-00215a67606e, 2.

Если для **овераллперформанцесеттинг** задано значение 1 или 2, то данные в значении **кустомперформанцесеттингс** игнорируются.

## <a name="sysvol"></a>SYSVOL

Параметр реестра **SYSVOL** — это способ уведомления службы репликации распределенная ФАЙЛОВАЯ система (DFSR) о том, что была инициирована операция восстановления состояния системы. Любое приложение резервного копирования, выполняющее восстановление состояния системы SYSVOL, должно использовать это значение, чтобы указать, является ли операция восстановления полномочной или неполномочной. Это значение считывается службой DFSR. Если это значение не задано, восстановление SYSVOL выполняется по умолчанию неполномочным.

Если значение реестра **SYSVOL** не существует, приложение резервного копирования должно создать его в следующем разделе реестра:

**HKey \_ Восстановление DFSR на локальном \_ компьютере** \\ **System** \\ **CurrentControlSet** \\ **Services** \\  \\ 

Создайте значение с именем **SYSVOL** и введите REG \_ SZ. В качестве данных значения должно быть задано "полномочное" или "неполномочное", основанное на запросе системного администратора.

Windows **Vista, Windows Server 2003 и Windows XP:** Это значение реестра не поддерживается.

 

 
