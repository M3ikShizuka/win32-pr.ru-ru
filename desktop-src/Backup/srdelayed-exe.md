---
title: Srdelayed.exe
description: Приложения, выполняющие операции восстановления состояния системы на ранних этапах запуска операционной системы, могут не использовать функции управления файлами для перемещения, удаления или установки коротких имен определенных системных файлов.
ms.assetid: cedeb48e-bc1d-48d1-9bee-0b8b0132c3e5
keywords:
- Резервная копия Srdelayed.exe
- Резервная копия восстановления состояния системы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5a5f6b281c07f5b0ad8d6cd7e59b4f93ec9208a5
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "104488460"
---
# <a name="srdelayedexe"></a>Srdelayed.exe

Приложения, выполняющие операции восстановления состояния системы на ранних этапах запуска операционной системы, могут не использовать функции управления файлами для перемещения, удаления или установки коротких имен определенных системных файлов. Srdelayed.exe — это исполняемый файл, поставляемый с компонентом cистема архивации данных Windows Server (WSB) в Windows Server 2008, который может включать приложения восстановления состояния системы для перемещения, удаления и установки коротких имен системных файлов.

Средство Срделайед предназначено для приложений восстановления состояния системы. она не заменяет функции управления файлами. Это средство следует использовать только в том случае, если приложению не удается переместить, удалить или задать короткое имя системного файла с помощью функций [**мовефиликс**](/windows/desktop/api/winbase/nf-winbase-movefileexa), [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea)и [**сетфилешортнаме**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea) . При восстановлении состояния системы и перезапуске Srdelayed.exe используется средством восстановления системы, а средство командной строки wbadmin.exe — для перемещения, удаления и задания краткого имени определенных системных файлов. Таким образом, срделайед может быть полезен для разработчиков, которым требуется возможность восстановления этих системных файлов в собственных приложениях восстановления состояния системы.

Срделайед может выполнять следующие операции:

-   Операция перемещения файла, аналогичная функции [**мовефиликс**](/windows/desktop/api/winbase/nf-winbase-movefileexa) с параметром **MOVEFILE \_ delay \_ до \_** флага reboot.
-   Операция удаления файла, аналогичная функции [**DeleteFile**](/windows/desktop/api/fileapi/nf-fileapi-deletefilea)
-   Операция задания короткого имени, аналогичная функции [**сетфилешортнаме**](/windows/desktop/api/winbase/nf-winbase-setfileshortnamea)

Чтобы использовать Срделайед, приложению требуется полный путь к расположению файла Srdelayed.exe и полный путь к текстовому файлу в Юникоде, который вы создали для хранения сведений, необходимых средству для выполнения всех запрошенных операций управления файлами. Приложение несет ответственность за обеспечение того, что этот текстовый файл не содержит избыточных запросов для операции и обрабатывает все необходимые порядок операций управления файлами. Например, поскольку папка должна быть пустой для удаления, приложение должно убедиться, что в текстовом файле указано удаление всех файлов в папке, прежде чем запрашивать удаление папки.

Если запись **сетупексекуте** еще не существует в реестре, приложение должно создать запись типа **reg \_ Multi \_ SZ** с именем **сетупексекуте** в следующем разделе реестра: **hKey \_ локальный \_ компьютер** \\ **System** \\ **CurrentControlSet** \\ **Управление** \\ **диспетчером сеансов**.

Приложение должно использовать следующий формат, чтобы присвоить параметру **сетупексекуте** полный путь к расположению файла Srdelayed.exe и полный путь к расположению текстового файла. Добавьте префикс " \\ \\ ?? \\ " в путь к текстовому файлу следующим образом:

*Полный путь к Srdelayed.exe* \\ \\ ?? \\ *Полный путь к текстовому файлу*  


Например, следующее значение для **сетупексекуте** указывает, что Srdelayed.exe находится в папке System32, а текстовый файл называется делайедоператионс:

В. \\ Windows \\ system32 \\srdelayed.exe \\ \\ ?? \\ C: \\ temp \\ делайедоператионс  


Пробелы в пути и имени должны быть шестнадцатеричной кодировкой. Например, для *программных файлов* закодировать путь как " \\ \\ ?? \\ C:Program%20Files \\a.dll ".

При восстановлении реестра или системы после перезагрузки приложение должно обеспечить запись **сетупексекуте** в правильном кусте реестра. Восстановление реестра выполняется перед запуском Srdelayed.exe. Приложению необходимо записать **сетупексекуте** в восстановленную версию реестра, так как это считанная версия.

## <a name="format-for-the-srdelayed-input-file"></a>Формат входного файла Срделайед

Все сведения Срделайед, необходимые для выполнения операций управления файлами, указываются в виде строки символов Юникода в текстовом файле Юникода. Строка символов Юникода разделяется на записи, которые разделяются на четыре поля. Каждая запись указывает один файл перемещения, удалить файл или задать операцию короткого имени. Четыре поля каждой записи содержат параметры для операции. Srdelayed.exe выполняет каждую операцию в том порядке, в котором их записи происходят в строке. Приложение должно проверить наличие повторяющихся записей в этом файле и удалить дубликаты.

Следующая строка иллюстрирует формат файла, запрашивающего две операции и состоящего из двух записей. Каждое поле параметра заканчивается одним символом L " \\ 0". Запись состоит из четырех последовательных полей. \\К концу всех записей добавляется дополнительный один символ L "0".

`<ParamA1>L'\0'<ParamA2>L'\0'<ParamA3>L'\0'<ParamA4>L'\0'<ParamB1>L'\0'<ParamB2>L'\0'<ParamB3>L'\0'<ParamB4>L'\0'L'\0'`  
`|-----------------------RecordA------------------------|------------------------RecordB------------------------|`  


Значение первого, второго, третьего и четвертого полей параметров зависит от того, описывает ли запись описание операции перемещения, удаления или задания короткого имени.

## <a name="format-for-a-move-file-record"></a>Формат записи для перемещения файла

Поле 1 определяет это как запрос на перемещение файла. Значение в этом поле всегда равно L "MoveFile" и учитывает регистр.

Поле 2 указывает исходное расположение файла. Операция перемещения файла Срделайед не поддерживает перемещение папки. В этом поле должен быть указан файл. Значение этого поля представляет собой полный путь к файлу, добавленному к " \\ \\ ?? \\ ", если путь не включает глобальный уникальный идентификатор (GUID), в \\ \\ \\ качестве префикса используется "?". Удалить " \\ \\ ? \\ " перед добавлением в " \\ \\ ?? \\ ".

Поле 3 задает назначение файла. Операция перемещения файла работает только в пределах тома. Источник и назначение должны находиться на одном томе. Значение этого поля представляет собой полный путь к файлу, добавленному к " \\ \\ ?? \\ ", если путь не включает глобальный уникальный идентификатор (GUID), в \\ \\ \\ качестве префикса используется "?". Удалить " \\ \\ ? \\ " перед добавлением в " \\ \\ ?? \\ ".

Поле 4 получает сведения о состоянии от Срделайед. Для новой записи значение в этом поле должно быть равно L "Нотексекутед".

Следующий пример ссылается на файл по пути к диску. Если путь и имя источника имеют значение C: \\ Stage \\a.dll, эта запись запрашивает, срделайед переместить его на диск c: \\ temp \\a.dll.

MoveFile \\ \\ ?? \\ В. \\ этап \\a.dll \\ \\ ?? \\ C: \\ temp \\a.dll нотексекутед  


В следующем примере показано, как ссылаться на файл по пути GUID тома. Если путь и имя источника имеют значение \\ \\ ? \\a.dll стадия {26a21bda-a627-11d7-9931-806e6f6e6963 \\ } \\ , запрашивается ли эта запись, которую срделайед переместить \\ \\ ? \\ Том {26a21bda-a627-11d7-9931-806e6f6e6963}, \\ временный \\a.dll

 MoveFile \\ \\ ?? \\ Стадия {26a21bda-a627-11d7-9931-806e6f6e6963} \\ \\a.dll \\ \\ ?? \\ Том {26a21bda-a627-11d7-9931-806e6f6e6963}, \\ временный \\a.dll нотексекутед  


## <a name="format-for-a-delete-file-record"></a>Формат записи файла удаления

Поле 1 определяет это как запрос на удаление файла. Значение в этом поле всегда равно L "DeleteFile" и учитывает регистр.

Поле 2 не используется. Значение в этом поле должно быть равно L "не используется".

Поле 3 указывает удаляемый файл. Чтобы удалить папку, она должна быть пустой. Используйте операции удаления файлов, чтобы удалить все файлы из папки перед удалением папки. Значение этого поля представляет собой полный путь к файлу, добавленному к " \\ \\ ?? \\ ", если путь не включает глобальный уникальный идентификатор (GUID), в \\ \\ \\ качестве префикса используется "?". Удалить " \\ \\ ? \\ " перед добавлением в " \\ \\ ?? \\ ".

Поле 4 получает сведения о состоянии от Срделайед. Для новой записи значение в этом поле должно быть равно L "Нотексекутед".

Следующий пример ссылается на файл по пути к диску. Если путь и имя имеют значение C: \\ temp \\b.dll, эта запись запрашивает, срделайед удалить файл.

DeleteFile не используется \\ \\ ? \\ C: \\ temp \\b.dll нотексекутед  


В следующем примере показано, как ссылаться на файл по GUID тома. Если путь и имя имеют значение \\ \\ ? \\ Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\b.dll, эта запись запрашивает, срделайед удалить файл.

DeleteFile не используется \\ \\ ? \\ Том {26a21bda-a627-11d7-9931-806e6f6e6963}, \\ временный \\b.dll\\ нотексекутед  


## <a name="format-for-set-short-name-record"></a>Формат записи Short-Name Set

Поле 1 определяет это как запрос на задание краткого имени файла. Значение в этом поле всегда равно L "Сетфилешортнаме" и учитывает регистр.

Поле 2 указывает короткое имя.

Поле 3. указывает путь и длинное имя для получения короткого имени. Значение этого поля представляет собой путь и длинное имя файла, добавленного к " \\ \\ ?? \\ ", если путь не включает в себя глобальный уникальный идентификатор (GUID), в качестве префикса которого используется символ " \\ \\ ? \\ ". Удалить " \\ \\ ? \\ " перед добавлением в " \\ \\ ?? \\ ".

Поле 4 получает сведения о состоянии от Срделайед. Для новой записи значение в этом поле должно быть равно L "Нотексекутед".

Следующий пример ссылается на файл по пути к диску. Если путь и имя файла имеют значение C: \\ temp \\ShortFileName.dll, эта запись запрашивает, что файл получает короткое имя, шортн ~1.dll.

Сетфилешортнаме Шортн ~1.dll \\ \\ ?? \\ C: \\ temp \\ShortFileName.dll нотексекутед  


В следующем примере показано, как ссылаться на файл по GUID тома. Если путь и имя файла имеют значение \\ \\ ? \\ Volume {26a21bda-a627-11d7-9931-806e6f6e6963} \\ temp \\ShortFileName.dll\\ , эта запись запрашивает, что файл получает короткое имя, шортн ~1.dll.

Сетфилешортнаме Шортн ~1.dll \\ \\ ?? \\ Том {26a21bda-a627-11d7-9931-806e6f6e6963}, \\ временный \\ShortFileName.dll\\ нотексекутед  


## <a name="srdelayed-operations-status"></a>Состояние операций срделайед

Срделайед записывает строку L "SC =*XXXXXXX*" в четвертое поле каждой записи текстового файла, где *XXXXXXX* — это шестнадцатеричное значение, указывающее состояние запрошенной операции. Нулевое значение указывает на то, что операция завершилась удачно.

Срделайед создает раздел реестра с именем **SystemRestore** в разделе **hKey \_ Local \_ Machine** \\ **Software** \\ **Microsoft** \\ **Windows NT** \\ **CurrentVersion** для записи результата всей операции восстановления. Если Срделайед выполняет все запрошенные операции с успешным выполнением, имя Ресторестатусресулт записывается в этом разделе с нулевым значением. Если Срделайед не удается выполнить какие-либо из запрошенных операций, имена Ресторестатусресулт и Ресторестатусдетаилс записываются в этом разделе с ненулевыми значениями. Имя Ресторестатусдетаилс записывается под этим ключом только в том случае, если Срделайед не может выполнить какие-либо запрошенные операции. Если операция для задания краткого имени файла завершается неудачно, Срделайед переходит к следующей операции. Срделайед считает, что операции перемещения файла и удаления файлов являются критическими и не продолжают работу, если операция перемещения или удаления завершается неудачно.

 

 