---
description: Сервер канала указывает режим типа канала, режим чтения и режим ожидания в параметре Двпипемоде функции Креатенамедпипе. Клиенты канала могут задавать эти режимы канала для обработки их каналов с помощью функции CreateFile.
ms.assetid: 07cf9d06-6265-47f4-a9f1-c19c06cc5f9f
title: Типы именованных каналов, чтение и режимы ожидания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b116e5ca9357a65a6d63549b96065843b046d479
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896689"
---
# <a name="named-pipe-type-read-and-wait-modes"></a>Типы именованных каналов, чтение и режимы ожидания

Сервер канала указывает режим типа канала, режим чтения и режим ожидания в параметре *двпипемоде* функции [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) . Клиенты канала могут задавать эти режимы канала для обработки их каналов с помощью функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) .

## <a name="type-mode"></a>Режим типа

Режим типа канала определяет способ, которым данные записываются в именованный канал. Данные могут передаваться через именованный канал в виде потока байтов или в виде потока сообщений. Сервер канала указывает тип канала при вызове [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) для создания экземпляра именованного канала. Режимы типа должны быть одинаковыми для всех экземпляров канала.

Чтобы создать канал типа Byte, укажите \_ байт типа канала \_ или используйте значение по умолчанию. Данные записываются в канал в виде потока байтов, и система не различает байты, записанные в разных операциях записи.

Чтобы создать канал типа сообщений, укажите \_ сообщение типа канала \_ . Система обрабатывает байты, записанные в каждой операции записи, в канал в виде единицы сообщения. Система всегда выполняет операции записи для каналов типа сообщений, как если бы был включен режим сквозной записи.

## <a name="read-mode"></a>Режим чтения

Режим чтения канала определяет способ считывания данных из именованного канала. Сервер канала указывает начальный режим чтения для обработчика канала при вызове [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea). Данные можно считывать в режиме чтения байтов или в режиме чтения сообщений. Обработчик канала типа Byte может быть только в режиме чтения байтов. Обработчик типа сообщений может быть в режиме чтения или считывания сообщения. Для канала типа сообщений режим чтения может отличаться для обработки сервером и клиентом одного и того же экземпляра канала.

Чтобы создать обработчик канала в режиме чтения байтов, укажите канал \_ READMODE \_ Byte или используйте значение по умолчанию. Данные считываются из канала в виде потока байтов. Операция чтения завершается успешно при считывании всех доступных байтов в канале или при считывании указанного числа байтов.

Чтобы создать маркер канала в режиме чтения сообщений, укажите PIPE \_ READMODE \_ сообщение. Данные считываются из канала в виде потока сообщений. Операция чтения успешно завершена только при считывании всего сообщения. Если указанное число считанных байтов меньше размера следующего сообщения, функция считывает как можно больше сообщений, прежде чем возвращать ноль (функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает ошибку \_ больше \_ данных). Оставшуюся часть сообщения можно прочитать с помощью другой операции чтения.

Для клиента канала обработчик канала, возвращаемый функцией [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , изначально всегда находится в режиме чтения байтов. Как клиенты, так и серверы канала могут использовать функцию [**сетнамедпипехандлестате**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) для изменения режима чтения для маркера канала. Обработчик канала должен иметь \_ \_ право доступа к атрибутам записи файла.

## <a name="wait-mode"></a>Режим ожидания

Режим ожидания для маркера канала определяет, как функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)и [**коннектнамедпипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) обрабатывали длительные операции. В режиме ожидания блокировки функции неограниченное время ожидают для процесса на другом конце канала, чтобы завершить операцию. В режиме неблокирующего ожидания функции немедленно возвращают в ситуации, в которых в противном случае требовалось неопределенное время ожидания.

На операцию [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) влияет режим ожидания для обработчика канала, если канал пуст. С помощью маркера ожидания блокировки операция не завершается успешно, пока данные не будут доступны из потока, записывающего на другой конец канала. Используя неблокирующий маркер-Wait, функция немедленно возвращает ноль, а функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) возвращает ошибку \_ No \_ Data.

На операцию [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) влияет режим ожидания для обработчика канала при недостатке места в буфере канала. С помощью маркера ожидания блокировки операция записи не может быть выполнена до тех пор, пока в буфере не будет создано достаточно места потоком, считывающим с другого конца канала. С помощью неблокирующего обработчика ожидания операция записи возвращает ненулевое значение немедленно, без записи байтов (для канала типа сообщения) или после записи как количество байт, которое содержит буфер (для канала типа Byte).

На операцию [**коннектнамедпипе**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) влияет режим ожидания для обработки канала при отсутствии подключения клиента или ожидания соединения с экземпляром канала. При использовании маркера ожидания блокировки операция подключения не выполняется до тех пор, пока клиент канала не подключится к экземпляру канала, вызвав функцию [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) или [**каллнамедпипе**](/windows/desktop/api/Winbase/nf-winbase-callnamedpipea) . При использовании неблокирующего маркера ожидания операция подключения немедленно возвращает ноль, а функция [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) ВОЗВРАЩАЕТ \_ канал ошибки \_ .

По умолчанию все дескрипторы именованных каналов, возвращаемые функцией [**креатенамедпипе**](/windows/desktop/api/Winbase/nf-winbase-createnamedpipea) или [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , создаются с включенным режимом ожидания блокировки. Чтобы создать канал в режиме неблокирующего ожидания, сервер канала определяет канал с параметром \_ Wait при вызове **креатенамедпипе**.

Клиенты канала и серверы канала могут изменить режим ожидания обработчика канала, указав либо канал ожидания канала, \_ либо канал без \_ ожидания при вызове функции [**сетнамедпипехандлестате**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-setnamedpipehandlestate) .

> [!Note]  
> Режим неблокирующего ожидания поддерживается для обеспечения совместимости с Microsoft LAN Manager версии 2,0. Этот режим не следует использовать для получения перекрывающихся входных и выходных данных (ввода-вывода) с именованными каналами. Вместо этого следует использовать перекрывающиеся операции ввода-вывода, так как она позволяет выполнять трудоемкую операцию в фоновом режиме после возврата функции. Дополнительные сведения о перекрывающихся операциях ввода-вывода см. в разделе [синхронные и перекрывающиеся входные и выходные данные](synchronous-and-overlapped-input-and-output.md).

 

 

 
