---
title: Вызов библиотек DLL расширения
description: Вызывает эти функции для каждого действительного пакета проверки подлинности или учета, полученного от сервера доступа к сети (NAS).
ms.assetid: 6d738ad7-cce5-4835-97d6-c57173c79a16
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bc96fab078a982f23f5f5dd86d51dbed46d5541
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987739"
---
# <a name="invoking-the-extension-dlls"></a>Вызов библиотек DLL расширения

> [!Note]  
> Служба проверки подлинности в Интернете (IAS) переименовала сервер политики сети (NPS), начиная с Windows Server 2008. Содержимое этого раздела относится как к IAS, так и к NPS. По всему тексту NPS используется для ссылки на все версии службы, включая версии, изначально называемые IAS.

 

Библиотеки расширения NPS должны экспортировать по крайней мере одну из следующих функций обратного вызова: [*радиусекстенсионпроцесс*](/windows/desktop/api/authif/nc-authif-pradius_extension_process), [*радиусекстенсионпроцессекс*](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex)или [*RadiusExtensionProcess2*](/windows/desktop/api/authif/nc-authif-pradius_extension_process_2). Сервер политики сети вызывает эти функции для каждого действительного пакета проверки подлинности или учета, полученного от сервера доступа к сети (NAS). NPS вызывает эти функции в каждой из библиотек DLL, перечисленных ниже [раздела Параметры реестра](/windows/desktop/Nps/ias-setting-up-the-extension-and-authorization-dlls)NPS. Библиотеки DLL вызываются в том порядке, в котором они перечислены.

Если библиотека DLL расширения NPS экспортирует более одной из перечисленных выше функций, NPS вызывает только один из них: новейшая функция, поддерживаемая операционной системой.

> [!Note]  
> Изначально служба IAS поддерживала только [*радиусекстенсионпроцесс*](/windows/desktop/api/authif/nc-authif-pradius_extension_process). IAS поддерживает также [*радиусекстенсионпроцессекс*](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex). IAS (и более поздние версии NPS) поддерживает также [*RadiusExtensionProcess2*](/windows/desktop/api/authif/nc-authif-pradius_extension_process_2).

 

Библиотеки DLL расширения NPS также могут экспортировать функции [**радиусекстенсионинит**](/windows/desktop/api/authif/nc-authif-pradius_extension_init) и [**радиусекстенсионтерм**](/windows/desktop/api/authif/nc-authif-pradius_extension_term) . Если они есть, NPS вызывает эти функции при запуске и остановке службы соответственно.

## <a name="radiusextensionprocess-callback-function"></a>Функция обратного вызова Радиусекстенсионпроцесс

В библиотеке DLL расширения проверки подлинности [*радиусекстенсионпроцесс*](/windows/desktop/api/authif/nc-authif-pradius_extension_process) получает все атрибуты, полученные NPS в запросе проверки подлинности или учета. Используя эти атрибуты, функция может выполнять дополнительные проверки, проверять разрешения пользователя или передавать записи учета на центральный сервер состояний.

В библиотеке DLL расширения авторизации **радиусекстенсионпроцесс** получает все атрибуты, созданные службой авторизации NPS. Это атрибуты, возвращаемые в пакете Access-Accept.

После вызова **радиусекстенсионпроцесс** действие, ВЫПОЛНЯЕМое NPS, зависит от возвращаемого значения **радиусекстенсионпроцесс** и значения, возвращаемого в параметре *пфактион* . Эти значения перечислены в следующей таблице.



| *пфактион* | Библиотека DLL расширения проверки подлинности                                                                                                                                            | Библиотека DLL расширения авторизации                                                                                                                                 |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Принять     | Обходит все последующие библиотеки DLL расширения проверки подлинности, а также обходит механизм проверки подлинности NPS.                                                                  | Accept не разрешено.                                                                                                                                         |
| Reject     | Обходит все последующие библиотеки DLL расширения проверки подлинности, а также обходит механизм проверки подлинности NPS. Отправлен пакет Access-Reject.                                    | Обход всех дальнейших библиотек DLL расширения авторизации.                                                                                                          |
| Продолжить   | Пакет отправляется следующей библиотеке DLL расширения проверки подлинности или механизму проверки подлинности NPS, если в реестре не указаны дополнительные библиотеки DLL расширения проверки подлинности. | Пакет отправляется в следующую библиотеку DLL расширения авторизации или в журнал учета NPS, если в реестре не указаны другие библиотеки DLL расширения авторизации. |



 

Для всех DLL-библиотек расширения, если **радиусекстенсионпроцесс** возвращает ошибку, пакет отбрасывается. Пакеты, которые отбрасываются из-за ошибки, не обрабатываются журналом учета NPS.

При возникновении ошибки NPS отправляет в журнал событий общую ошибку. Рекомендуется, чтобы библиотека DLL расширения предпредоставил дополнительные функции ведения журнала ошибок.

Дополнительные сведения и схема, представляющая предыдущий процесс, см. в разделе [о расширениях NPS](/windows/desktop/Nps/ias-about-internet-authentication-service).

**Радиусекстенсионпроцесс** должен возвращать ошибку, если не может проверить принятие или отклонение пакета. Такая ситуация может возникать, если сетевая проблема не дает **радиусекстенсионпроцесс** взаимодействовать с базой данных проверки подлинности пользователей.

При обработке пакета учета параметр *пфактион* имеет **значение NULL**, поэтому *пфактион* не может быть установлен. Возврат ошибки из функции **радиусекстенсионпроцесс** при обработке запроса учета приводит к отмене запроса сервером политики сети.

> [!Note]  
> После получения согласия NPS не вызывает **радиусекстенсионпроцесс** в остальных библиотеках DLL в последовательности. Поскольку некоторые функции проверки подлинности также могут реализовывать авторизацию, пропуска таких функций проверки подлинности может привести к пропуску авторизации. Если экземпляр [**радиусекстенсионпроцесс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process) возвращает Accept, важно не делать никаких предположений о том, какие авторизации получены.

 

Если возвращается значение Continue или Accept, то профиль, соответствующий области, отправляется обратно в пакет Access-Accept.

Библиотеки DLL расширения проверки подлинности должны сосуществовать с встроенными поставщиками проверки подлинности NPS и с другими библиотеками DLL расширения. Если расширение применимо только к определенной пользовательской базе данных (например, Windows Active Directory), то перед обработкой запроса необходимо проверить атрибут [**ратпровидер**](/windows/desktop/api/authif/ne-authif-radius_authentication_provider) , переданный в параметре *паттрс* . Атрибут Ратпровидер должен быть одним из списка атрибутов, на который указывает параметр *паттрс* .

Библиотеки DLL расширения не должны отклонять запросы, так как отсутствуют необходимые атрибуты. Например, если для расширения проверки подлинности требуется атрибут User-Password, Ратусерпассворд, а атрибут отсутствует, расширение должно возвращать действие Раконтинуе, чтобы предоставить другим расширениям и поставщикам возможность обработать запрос.

NPS вызывает функцию [**радиусекстенсионпроцесс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process) после принятия решения об использовании определенной базы данных проверки подлинности, но до того, как пользователь прошел проверку подлинности. Таким образом, информация о том, какая база данных проверки подлинности должна использоваться, доступна для функции, чтобы функция могла проверить авторизацию пользователя в соответствующей базе данных проверки подлинности. NPS поддерживает различные базы данных проверки подлинности, включая Active Directory Windows.

## <a name="radiusextensionprocessex-callback-function"></a>Функция обратного вызова Радиусекстенсионпроцессекс

Библиотеки расширения NPS могут экспортировать [**радиусекстенсионпроцессекс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex) , а не или в дополнение к [**радиусекстенсионпроцесс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process). Эта функция позволяет библиотеке DLL добавлять дополнительные атрибуты авторизации в ответ проверки подлинности.

Те же сведения, которые описаны в разделе *функции обратного вызова радиусекстенсионпроцесс* , относятся к функции [**радиусекстенсионпроцессекс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex) .

[**Радиусекстенсионпроцессекс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex) не может изменять или удалять существующие атрибуты. Если возникает ситуация, когда библиотека DLL должна изменять или удалять атрибуты, единственным вариантом является использование пользовательского интерфейса NPS для обеспечения отсутствия атрибутов. По умолчанию атрибуты авторизации отсутствуют. Все существующие должны быть добавлены с помощью пользовательского интерфейса.

Если настроено несколько библиотек DLL авторизации и некоторые из этих библиотек DLL реализуют [**радиусекстенсионпроцессекс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex), функция **радиусекстенсионпроцесс/ex** в заданной библиотеке DLL не получает атрибуты из ранее вызванных библиотек DLL авторизации. Он получает только те атрибуты, которые созданы службой авторизации NPS.

## <a name="radiusextensionprocess2-callback-function"></a>Функция обратного вызова RadiusExtensionProcess2

Библиотеки DLL расширения NPS также могут экспортировать [**RadiusExtensionProcess2**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_2) , а не [**радиусекстенсионпроцесс**](/windows/desktop/api/authif/nc-authif-pradius_extension_process) и **радиусекстенсионпроцессекс**. Эта функция позволяет библиотеке DLL добавлять, изменять и удалять атрибуты в запросе или ответе проверки подлинности.

Те же сведения, которые описаны в разделе *функции обратного вызова радиусекстенсионпроцессекс* , применяются к функции [**RadiusExtensionProcess2**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_ex) со следующими исключениями.

-   В DLL-библиотеке авторизации **RadiusExtensionProcess2** получает атрибуты, созданные службой авторизации NPS, и атрибуты, созданные из ранее вызванных библиотек DLL авторизации.
-   [**RadiusExtensionProcess2**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_2) не имеет параметра *пфактион* . **RadiusExtensionProcess2** задает окончательное расстановку запроса с помощью функции [**сетреспонсетипе**](/previous-versions/ms688462(v=vs.85)) , предоставленной в [**структуре \_ \_ управляющего \_ блока расширения RADIUS**](/windows/desktop/api/authif/ns-authif-radius_extension_control_block) .
-   Сервер политики сети всегда вызывает функцию [**RadiusExtensionProcess2**](/windows/desktop/api/authif/nc-authif-pradius_extension_process_2) в любых оставшихся библиотеках DLL независимо от того, были ли возвращены функции в предыдущих библиотеках DLL.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Настройка библиотек DLL расширения](/windows/desktop/Nps/ias-setting-up-the-extension-and-authorization-dlls)
</dt> <dt>

[Атрибуты идентификации пользователя](/windows/desktop/Nps/ias-user-identification-attributes)
</dt> </dl>

 

 