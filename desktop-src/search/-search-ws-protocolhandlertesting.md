---
description: Неотъемлемой частью тестирования и отладки реализаций обработчика протоколов является понимание того, как запускаются обработчики протоколов.
ms.assetid: 33c99620-7381-4719-9fc6-4c8284481411
title: Обработчики протокола отладки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 321d59c0c7915f9bbf84a80091408ba88a9a75ac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144050"
---
# <a name="debugging-protocol-handlers"></a>Обработчики протокола отладки

Неотъемлемой частью тестирования и отладки реализаций обработчика протоколов является понимание того, как запускаются обработчики протоколов.

Этот раздел организован следующим образом:

-   [Сведения о обработчиках протокола отладки](#about-debugging-protocol-handlers)
-   [Настройка отладки](#setting-up-debugging)
-   [Дополнительные ресурсы](#additional-resources)
-   [См. также](#related-topics)

## <a name="about-debugging-protocol-handlers"></a>Сведения о обработчиках протокола отладки

Процесс Сеарчиндексер (searchindexer.exe) запускает одну копию процесса Сеарчпротоколхост (SearchProtocolHost.exe) в контексте системы и другую копию в контексте пользователя. Затем обработчики протокола загружаются в процесс Сеарчпротоколхост по мере необходимости. Они не выгружаются до тех пор, пока служба поиска не будет остановлена. Один и тот же экземпляр обработчика протокола используется повторно в любое количество раз во время работы службы.

Процессы Сеарчиндексер и Сеарчпротоколхост часто взаимодействуют во время индексирования. Если вы приостанавливаете или останавливаете процесс Сеарчпротоколхост для отладки, Сеарчиндексер запустит новый процесс Сеарчпротоколхост и сделает сеанс отладки недействительным. Кроме того, при присоединении отладчика непосредственно к процессу Сеарчпротоколхост можно приостановить наследование маркеров от searchindexer.exe до searchprotocolhost.exe, и два процесса не смогут взаимодействовать.

Чтобы избежать этих проблем, необходимо уведомить службу поиска, которая отлаживается, и необходимо присоединить отладчик к процессу Сеарчиндексер с инструкциями по отладке дочерних процессов, как описано далее.

## <a name="setting-up-debugging"></a>Настройка отладки

Выполните следующие действия, чтобы настроить отладку для обработчика протокола.

1.  Уведомите службу поиска об отладке, задав для параметра Дебугфилтерс значение 1 в реестре:

    ```
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft
       Windows Search
          Gathering Manager
             DebugFilters = 1
    ```

2.  Подключите отладчик с помощью раздела реестра параметры выполнения файла образа:

    ```
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion
       Image File Execution Options
          SearchIndexer.exe
             Debugger = <path to debugger> <debugger options> 
    ```

    Параметры для примера отладчика описаны в следующей таблице.

    

    **Пример с использованием отладчика NTSD**   *= C: \\ Отладчики \\ntsd.exe-одгкс-c: "sxe ld mydll.dll; g"*<br/>

3.  Перезапустите searchindexer.exe в отладчике с помощью compmgmt. msc, Services. msc или командного окна с командами, аналогичными следующим:
    ```
    net stop wsearch
    <copy new DLLs for debugging>
    net start wsearch
            
    ```

    

Чтобы отличить процесс Сеарчпротоколхост, выполняемый в контексте системы, и запустить его в контексте пользователя, можно проверить строки среды. Например, с помощью ntsd.exe можно использовать команду Extension **! пеб** для отображения форматированного представления информации в блоке среды Process (пеб).

## <a name="additional-resources"></a>Дополнительные ресурсы

-   Сведения о создании обработчиков см. в разделе [Регистрация расширений оболочки](../shell/reg-shell-exts.md).

## <a name="related-topics"></a>См. также

<dl> <dt>**Основные**</dt> <dt><a href="-search-3x-wds-phaddins.md">обработчики протокола разработки</a></dt> <dt><a href="-search-3x-wds-extidx-prot-implementing.md">Основные сведения об обработчиках протоколов</a></dt> <dt><a href="-search-3x-wds-notifyingofchanges.md">уведомление об изменении индекса изменений</a></dt> <dt><a href="-search-3x-wds-ph-ui-extensions.md">Добавление значков и контекстных меню</a></dt> <dt><a href="-search-3x-wds-ph-ui-samplecode.md">пример кода: расширения оболочки для обработчиков протоколов</a></dt> <dt><a href="-search-3x-wds-ph-search-connector.md">Создание соединителя поиска для обработчика протокола</a></dt> <dt><a href="-search-3x-wds-ph-install-registration.md">Установка и регистрация обработчиков протоколов</a></dt> </dl>

 

 
