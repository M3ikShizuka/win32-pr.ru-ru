---
description: Необходимо зарегистрировать обработчик фильтра. Можно также выбрать существующий обработчик фильтра для данного расширения имени файла либо с помощью реестра, либо с помощью интерфейса Илоадфилтер.
ms.assetid: 3478b948-73c7-4533-974a-d9b5186a651b
title: Регистрация обработчиков фильтров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 18f39688bbea3bb0dd73ef28a0ba6e8b0dcf7977
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144125"
---
# <a name="registering-filter-handlers"></a>Регистрация обработчиков фильтров

Необходимо зарегистрировать обработчик фильтра. Можно также выбрать существующий обработчик фильтра для данного расширения имени файла либо с помощью реестра, либо с помощью интерфейса [**илоадфилтер**](/windows/desktop/api/filtereg/nn-filtereg-iloadfilter) .

Этот раздел организован следующим образом:

- [Регистрация обработчиков фильтров для поиска Windows](#registering-filter-handlers)
  - [Устаревший подход к регистрации обработчиков фильтров](#obsolete-approach-for-registering-filters-handlers)
- [Замена существующих обработчиков фильтров](#replacing-existing-filter-handlers)
- [Поиск обработчика фильтра для заданного расширения файла](#finding-a-filter-handler-for-a-given-file-extension)
- [Дополнительные ресурсы](#additional-resources)
- [См. также](#related-topics)

> [!NOTE]  
> Обработчик фильтра является реализацией интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) .

## <a name="registering-filters-handlers-for-windows-search"></a>Регистрация обработчиков фильтров для поиска Windows

Идентификаторы GUID, необходимые для регистрации нового обработчика протокола или поиска существующего обработчика протокола, перечислены в следующей таблице.

| Код GUID                                     | Определено пользователем или приложением | Описание                                                                                               |
|------------------------------------------|-----------------------------|-----------------------------------------------------------------------------------------------------------|
| **89BCB740-6119-101A-BCB7-00DD010655AF** | Приложение                 | GUID интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) — это константа раздела реестра для всех обработчиков фильтров. |
| **{Персистенсандлергуид}**              | Пользователь                        | Это идентификатор GUID для постоянного обработчика.                                                              |
| **{Филтерхандлерклсид}**                 | Пользователь                        | Это идентификатор класса (CLSID) для обработчика фильтра.                                              |
| **{Аппликатионгуид}**                    | Пользователь                        | Это промежуточный (агрегированный) GUID.                                                                |

Обработчики фильтров должны быть зарегистрированы на \_ локальном компьютере hKey, \_ так как SearchFilterHost.exe выполняется под системной учетной записью и поэтому не может получить доступ к разделам реестра для \_ текущего пользователя hKey \_ , вошедшего в систему. Кроме того, Группа "Пользователи" должна иметь доступ для чтения и выполнения к самому обработчику фильтра. dll, так как SearchFilterHost.exe удаляет все права администратора и разрешает только права без прав администратора. Так как расположение проекта Visual Studio по умолчанию находится в каталоге текущего пользователя и не предоставляет разрешения на чтение группе Пользователи, необходимо либо переместить DLL-файл, либо изменить списки ACL, чтобы разрешить SearchFilterHost.exe доступ.

При регистрации нового обработчика фильтров рекомендуется использовать описательное имя, например HTML IFilter.

**Чтобы зарегистрировать новый обработчик фильтра, выполните следующие действия.**

1. Укажите расширение и устойчивый идентификатор GUID обработчика, который будет использовать обработчик фильтра:

```
    HKEY_LOCAL_MACHINE
       Software
          Classes
             .txt
                PersistentHandler
                   (Default) = {PersistentHandlerGUID}
```

```
    HKEY_LOCAL_MACHINE
       Software
          Classes
             .txt
                CLSID
                   {PersistentHandlerGUID}
                      PersistentAddinsRegistered
                         {89BCB740-6119-101A-BCB7-00DD010655AF}l
                            (Default) = {FilterHandlerCLSID}
```

2. Зарегистрируйте обработчик фильтра со следующими ключами и значениями:

```
    HKEY_LOCAL_MACHINE
       Software
          Classes
             .txt
                CLSID
                   {FilterHandlerCLSID}
                      (Default) = {DescriptiveFilterHandlerName}
                      InprocServer32
                         (Default) = DLL Install Path
                         ThreadingModel = Both
```

### <a name="obsolete-approach-for-registering-filters-handlers"></a>Устаревший подход к регистрации обработчиков фильтров

Этот подход не рекомендуется использовать. Фильтры могут быть зарегистрированы для идентификатора CLSID, представляющего класс модели COM, и (или) для расширения имени файла. Вы можете зарегистрировать оба фильтра, если необходимо зарегистрировать обработчик фильтра для класса, и другой обработчик фильтра для расширения имени файла в классе. Обратите внимание, что обработчик фильтра, зарегистрированный для расширения имени файла, имеет приоритет над обработчиком фильтра для идентификатора CLSID.

Эти записи являются стандартными записями реестра OLE, включая запись для класса **CLSID \\ {аппликатионгуид}**. Библиотека DLL sample.dll реализует поведение выполняемого объекта для класса. txt. Обратите внимание на лишнюю запись Персистенсандлер. Эта запись указывает класс, отвечающий за брокер запросов к постоянным объектам класса Sample. Запись в разделе **персистентаддинсрегистеред** определяет реализацию, ответственную за интерфейс с именем **89BCB740-6119-101A-BCB7-00DD010655AF**(IID \_ IFilter). Класс, реализующий интерфейс **IID \_ IFilter** , имеет стандартные записи реестра OLE. Библиотека DLL InprocServer32 загружается с помощью стандартного механизма OLE.

Windows Search просматривает потоковую модель, указанную для обработчика фильтра. Если для потоковой модели задано значение **both**, обработчик фильтра должен быть потокобезопасным; в противном случае, если он не является потокобезопасным, укажите **апартамент**. Обратите внимание, что обработчики фильтров всегда должны быть потокобезопасными.

В следующем примере записи реестра предназначены для обработчика фильтра, зарегистрированного для класса и расширения имени файла. **{Персистенсандлергуид}** и **{филтерхандлерклсид}** используются в качестве переменных, указывающих значения, которые должны быть заданы создателем обработчика фильтра. Значения имеют тип REG \_ SZ.

```
HKEY_LOCAL_MACHINE
   Software
      Classes
         .txt
            (Default) = SampleFile
         SampleFile
            (Default) = Class for Sample Files
            CLSID
               (Default) = {ApplicationGUID}
         CLSID
            {ApplicationGUID}
               (Default) = Sample Files
               InprocServer32
                  (Default) = sample.dll
               PersistentHandler
                  (Default) = {PersistentHandlerGUID}
            {PersistentHandlerGUID}
               (Default) = Sample file persistent handler
               PersistentAddinsRegistered
                  {89BCB740-6119-101A-BCB7-00DD010655AF}l
                     (Default) = {FilterHandlerCLSID}
            {FilterHandlerCLSID}
               (Default) = Sample Files
               InprocServer32
                  (Default) = sampfilt.dll
                  ThreadingModel = Both
```

## <a name="replacing-existing-filter-handlers"></a>Замена существующих обработчиков фильтров

Не рекомендуется заменять встроенные обработчики фильтров для распространенных типов файлов, таких как txt, doc, HTML, URL и т. д., так как это может привести к нежелательным последствиям для других компонентов системы. Индексирование текста сообщений электронной почты зависит от обработчиков фильтров. txt, HTML и. RTF, например.

Если новый обработчик фильтра для типа файла устанавливается в качестве замены для существующей регистрации фильтра, установщик должен сохранить текущую регистрацию и восстановить ее при удалении нового обработчика фильтра. Механизм фильтрации цепочек отсутствует. Таким образом, новый обработчик фильтра отвечает за репликацию всех необходимых функций старого фильтра.

## <a name="finding-a-filter-handler-for-a-given-file-extension"></a>Поиск обработчика фильтра для заданного расширения файла

Интерфейс [**илоадфилтер**](/windows/desktop/api/filtereg/nn-filtereg-iloadfilter) можно использовать для поиска обработчика фильтра для данного расширения имени файла. В следующем примере записи реестра иллюстрируют, как это сделать для HTML-файлов. В этом примере обработчик фильтра для HTML-документов nlhtml.dll. Значения имеют тип REG \_ SZ.

**Чтобы найти обработчик фильтра для данного расширения имени файла, выполните следующие действия.**

1. Проверьте, имеет ли расширение для типа фильтруемых файлов постоянный обработчик, зарегистрированный в записи реестра \\ hKey \_ \_ \\ Software Machine \\ Classes. extension. Если да, предоставьте этому разделу значение {Персистенсандлергуид}.

```
    HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             .htm
                PersistentHandler
                   {PersistentHandlerGUID}
```

2. Если для расширения не зарегистрирован устойчивый обработчик, найдите идентификатор CLSID, связанный с типом документа, в записи реестра \\ hKey \_ Local \_ Machine \\ Software программные \\ классы. Предоставьте этому ключу {Аппликатионгуид}. Затем определите, зарегистрирован ли постоянный обработчик для CLSID: с помощью {Аппликатионгуид} найдите постоянный обработчик для \\ \_ \_ \\ \\ \\ \\ записи CLSID {аппликатионгуид} для классов программного обеспечения на локальном компьютере. Предоставьте этому ключу {Персистенсандлергуид}.

```
    HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             htmlfile
                (Default) = Class for WWW HTML files
                CLSID
                   (Default) = {25336920-03F9-11CF-8FD0-00AA00686F13}
             CLSID
                {25336920-03F9-11CF-8FD0-00AA00686F13}
                   PersistentHandler
                      (Default) = {PersistentHandlerGUID}
```

3. Определите идентификатор GUID постоянного обработчика: с помощью {Персистенсандлергуид} найдите GUID постоянного обработчика для типа документа. Значение в записи реестра HKEY \_ Local \_ Machine \\ Software \\ Classes \\ CLSID \\ {персистенсандлергуид} \\ персистентаддинсрегистеред \\ 89BCB740-6119-101A-BCB7-00DD010655AF дает постоянный идентификатор GUID обработчика для этого типа документа. Предоставьте этому ключу {Филтерхандлерклсид}.

```
    HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             {PersistentHandlerGUID}
                (Default) = HTML File Persistent Handler<dl>
                    REG_SZ     {89BCB740-6119-101A-BCB7-00DD010655AF}
                    REG_SZ     (Default) = {EEC97550-47A9-11CF-B952-00AA0051FE20}
```

4. Определение обработчика фильтра. с помощью {Филтерхандлерклсид}, который был определен на предыдущем шаге, найдите обработчик фильтра в разделе запись \\ hKey \_ локальный \_ компьютер \\ программное обеспечение \\ классы \\ CLSID \\ {филтерхандлерклсид} \\ InprocServer32. В этом примере используется описательное имя обработчика фильтра HTML IFilter.

```
    HKEY_LOCAL_MACHINE
       SOFTWARE
          Classes
             CLSID
                {EEC97550-47A9-11CF-B952-00AA0051FE20}
                   (Default) = HTML IFilter
                    Data type  REG_SZ
                    InprocServer32
                    nlhtml.dll
```

## <a name="additional-resources"></a>Дополнительные ресурсы

- Пример кода [ифилтерсампле](-search-sample-ifiltersample.md) , доступный на [GitHub](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/WindowsSearch/IFilterSample), демонстрирует создание базового класса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) для реализации интерфейса **IFilter** .
- Общие сведения о процессе индексирования см. [в разделе процесс индексирования](-search-indexing-process-overview.md).
- Общие сведения о типах файлов см. в разделе [типы файлов](../shell/fa-file-types.md).
- Сведения о запросе атрибутов сопоставления файлов для типа файлов см. в разделе [перцеиведтипес, системфилеассоЦиатионс и регистрация приложения](/previous-versions/windows/desktop/legacy/cc144150(v=vs.85)).

## <a name="related-topics"></a>См. также

[Разработка обработчиков фильтров](-search-ifilter-conceptual.md)

[О обработчиках фильтров в поиске Windows](-search-ifilter-about.md)

[Рекомендации по созданию обработчиков фильтров в поиске Windows](-search-3x-wds-extidx-filters.md)

[Возвращение свойств из обработчика фильтра](-search-ifilter-property-filtering.md)

[Обработчики фильтров, поставляемые с Windows](-search-ifilter-implementations.md)

[Реализация обработчиков фильтров в поиске Windows](-search-ifilter-constructing-filters.md)

[Тестирование обработчиков фильтров](-search-ifilter-testing-filters.md)
