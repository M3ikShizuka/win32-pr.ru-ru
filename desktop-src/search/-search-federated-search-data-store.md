---
description: В этой статье объясняется, как разрешить доступ к хранилищу данных через веб-службу OpenSearch и как избежать потенциальных препятствий для этого.
ms.assetid: 27d7676c-f4e8-43b4-856b-826e07afcd78
title: Включение хранилища данных в федеративный поиск Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8cef227cb82c64f391ec61b2a7fef0fe35acf131
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105719318"
---
# <a name="enabling-your-data-store-in-windows-federated-search"></a>Включение хранилища данных в федеративный поиск Windows

В этой статье объясняется, как разрешить доступ к хранилищу данных через веб-службу [OpenSearch](https://github.com/dewitt/opensearch) и как избежать потенциальных препятствий для этого.

Этот раздел организован следующим образом:

-   [Условия принятия запроса поиска](#conditions-for-search-request-acceptance)
    -   [Поддерживаемый синтаксис запросов](#supported-query-syntax)
    -   [Поддерживаемые протоколы проверки подлинности](#supported-authentication-protocols)
-   [Отправка запросов и возврат результатов поиска в RSS или Atom](#sending-queries-and-returning-search-results-in-rss-or-atom)
    -   [Пример выходных данных RSS-канала](#example-of-an-rss-feed-output)
-   [Автоматическое сопоставление свойств оболочки Windows](#automatic-mapping-to-windows-shell-properties)
-   [Общие сведения о том, как Windows сопоставляет элементы с типами файлов](#understanding-how-windows-maps-items-to-file-types)
-   [Предотвращение потенциальных препятствий для включения хранилища данных](#avoiding-potential-barriers-to-enabling-a-data-store)
-   [Дополнительные ресурсы](#additional-resources)
-   [См. также](#related-topics)

## <a name="conditions-for-search-request-acceptance"></a>Условия принятия запроса поиска

Веб-служба [OpenSearch](https://github.com/dewitt/opensearch) , созданная на веб-сервере, **должна** удовлетворять следующим двум требованиям.

-   Возможность принимать `GET URL` запрос от клиента.
-   Позволяет внедрять условия поиска в URL-адрес.

    В следующем примере показано, как условие поиска может быть внедрено в URL-адрес.

    ```
    https://example.com/search.aspx?query=terms&param=mysearchword
    ```

    

> [!Note]  
> Федеративный поиск не поддерживает отправку `POST` запросов к веб-службе.

 

Дополнительные сведения о создании URL-адреса см. в разделе "Параметры шаблона URL-адреса" раздела [Создание файла описания OpenSearch в Федеративной службы Windows](-search-federated-search-osdx-file.md).

### <a name="supported-query-syntax"></a>Поддерживаемый синтаксис запросов

В Windows 7 не ожидался Специальный синтаксис запроса. Поставщик OpenSearch принимает любые термины, которые пользователь вводит в поле ввода в проводнике Windows, и кодирует его в URL-адрес. Это делается в соответствии с шаблоном URL-адреса, описанным в разделе "Параметры шаблона URL-адреса", в разделе [Создание файла описания OpenSearch в приложении федеративного поиска Windows](-search-federated-search-osdx-file.md).

Пользователи предполагают, что отдельные термины рассматриваются как неявно and вместе. Например, запрос "Microsoft Windows" должен возвращать только результаты, содержащие "Windows" и "Microsoft".

### <a name="supported-authentication-protocols"></a>Поддерживаемые протоколы проверки подлинности

Федеративный поиск Windows поддерживает проверку подлинности на основе Windows и может предоставлять учетные данные веб-службам с помощью следующих протоколов:

-   NTLM.
-   Kerberos —
-   Basic (только по протоколу HTTPS).
-   Другие поставщики поддержки безопасности (SSP), установленные в Windows, которые обеспечивают дополнительную производительность запросов. Сведения о потенциальном добавлении других SSP см. в документации по пакету SDK для [интерфейса SSP](../secauthn/sspi.md) .

## <a name="sending-queries-and-returning-search-results-in-rss-or-atom"></a>Отправка запросов и возврат результатов поиска в RSS или Atom

Поставщик [OpenSearch](https://github.com/dewitt/opensearch) отвечает за сопоставление значений XML-элементов с системными свойствами оболочки Windows, которые могут использоваться приложениями Windows. Но вы не ограничены сопоставлениями по умолчанию для стандартных элементов RSS или Atom и могут содержать пользовательские XML-элементы в пространстве имен Windows для каждого свойства. Например, можно добавить собственные пользовательские XML-элементы в элемент **Item** для предоставления дополнительных метаданных в Windows. Можно также сопоставлять элементы из других пространств имен XML, например iTunes

### <a name="example-of-an-rss-feed-output"></a>Пример выходных данных RSS-канала

Следующий пример вывода RSS-канала возвращает один элемент.


```
<rss version="2.0" xmlns:media="https://search.yahoo.com/mrss/" xmlns:example="https://example.com/namespace">
   <channel>
      <title>Search Results</title>
      <item>
         <title>An example result</title>
         <link>https://example.com/pictures.aspx?id=01</link>
         <description>This is a test of the emergency search results system. If this were a real emergency result, you'd be reading something more useful.</description>
         <pubDate>Wed, 1 Oct 2008 23:12:00 GMT</pubDate>
         <media:content url="https://example.com/pictures/picture01.jpg" fileSize="212889" type="image/jpeg" height="768" width="1024"/>
         <media:thumbnail url="https://example.com/thumbnails/picture01.jpg" height="120" width="160"/>
         <example:dateTaken>Mon, 22 Sep 2008 23:12:00 GMT</example:dateTaken>
      </item>
   </channel>
</rss>
```



Дополнительные сведения о сопоставлении свойств см. в разделах "Расширенные элементы в федеративного поиска WIndows" и "сопоставления настраиваемых свойств" раздела [Создание файла описания OpenSearch в федеративной системе Windows](-search-federated-search-osdx-file.md).

## <a name="automatic-mapping-to-windows-shell-properties"></a>Автоматическое сопоставление свойств оболочки Windows

В элементах RSS-канала можно выбрать включение других элементов XML, которые автоматически сопоставляются с системными свойствами оболочки Windows. Для этого включите элемент с именем после свойства оболочки Windows и предваряя его пространством имен системы оболочки Windows. В следующем примере показано объявление пространства имен `win=" http://schemas.microsoft.com/windows/2008/propertynamespace"` и включение элемента для сопоставления свойств `win:System.Contact.PrimaryEmailAddress` .


```
<rss version="2.0" xmlns:example="https://example.com/schema/2009" xmlns:win="http://schemas.microsoft.com/windows/2008/propertynamespace">
...
   <item>
      <title>Someone</title>
      <win:System.Contact.PrimaryEmailAddress>someone@example.com
   </win:System.Contact.PrimaryEmailAddress>
   </item>
```



Префикс пространства имен, используемый здесь ( `"win"` ), является предложением; можно использовать любой префикс. Однако необходимо использовать точные имена свойств оболочки Windows, а также указать точный универсальный код ресурса (URI), как показано в следующем примере:


```
http://schemas.microsoft.com/windows/2008/propertynamespace
```



**О свойствах системы оболочки Windows**

Windows определяет полный список [системных свойств](../properties/props.md) и формат типа значения, необходимый для каждого свойства. В документации для свойства оболочки [System. fileExtension](../properties/props-system-fileextension.md) указано, что значение должно содержать начальную точку (". docx", а не "docx").

**Значения даты и времени**

Предпочтительный формат даты и времени — ISO-8601, как показано в следующем примере:


```
2008-01-16T 19:20:30:.45+01:00
```



Разработчики .NET должны использовать класс DateTime с `ToString("R") ` для вывода правильного формата.

Дополнительные сведения о сопоставлении свойств см. в разделе "Расширенные элементы в федеративного поиска Windows" статьи [Создание файла описания OpenSearch в приложении федеративного поиска Windows](-search-federated-search-osdx-file.md).

## <a name="understanding-how-windows-maps-items-to-file-types"></a>Общие сведения о том, как Windows сопоставляет элементы с типами файлов

Поиск в пользовательском интерфейсе проводника Windows позволяет пользователям обрабатывать результаты в виде файлов, когда элемент RSS указывает на файл, хранящийся удаленно. Пользователь может перетаскивать элементы на Рабочий стол, а пользовательский интерфейс проводника Windows отображает правильный значок и предоставляет соответствующее контекстное меню. Если элемент RSS не указывает на удаленный файл, файл рассматривается как ссылка, и пользователи могут выполнять над ним такие действия, как создание ярлыка или открытие его в браузере.

В следующей блок-схеме показано, как Windows определяет тип файла элемента.

![Блок-схема, показывающая пути от элемента к решениям, которые обрабатывают его как элемент типа Web Link или как тип файла](images/determineanitemfiletype.png)

Поставщик [OpenSearch](https://github.com/dewitt/opensearch) выполняет следующие действия по сопоставлению элемента с типом файла:

-   Определить, следует ли обрабатывать элемент как файл или как веб-ссылку.
-   Укажите правильное используемое расширение имени файла.

Например, если у элемента есть URL-адрес ссылки, который использует путь к файловой системе (например `file:///\\server\share\etc\item.ext` ,), поставщик [OpenSearch](https://github.com/dewitt/opensearch) рассматривает ссылку как файл и определяет тип по расширению имени файла, используемому в пути (расширение ext в этом примере).

Если элемент использует стандартный RSS-корпус или **медиарсс Media: Content** , поставщик [OpenSearch](https://github.com/dewitt/opensearch) предполагает, что элемент является файлом, и определяет расширение имени файла следующим образом:

-   Если для элемента было сопоставлено свойство оболочки Windows [System. fileExtension](../properties/props-system-fileextension.md) , поставщик использует это расширение имени файла.
-   Если свойство оболочки Windows [System. fileExtension](../properties/props-system-fileextension.md) не сопоставлено, поставщик использует атрибут **Type** , указанный в элементе enclosure или Content. Этот элемент должен содержать `MIMEType` строку, например `"image/jpeg"` . Если объект `MIMEType` связан с расширением имени файла, зарегистрированным на клиентском компьютере, элемент считается файлом этого типа. Если объект `MIMEType` не связан с расширением имени файла, зарегистрированным на клиентском компьютере, элемент рассматривается как тип веб-ссылки. Поставщик [OpenSearch](https://github.com/dewitt/opensearch) не пытается проанализировать атрибут **URL-адреса** , чтобы определить расширение имени файла.
-   Если объект `MIMEType` связан с расширением имени файла, зарегистрированным на клиентском компьютере, поставщик определяет, является ли расширение имени файла известным типом веб-файла (. htm,. HTML,. ASP,. aspx,. php,. SWF,. stm). Если да, то тип файла рассматривается как тип веб-ссылки. в противном случае он рассматривается как тип файла. Например, если объект `MIMEType "text/html"` связан с расширением htm, этот элемент рассматривается как веб-ссылка, а не как файл. htm.

## <a name="avoiding-potential-barriers-to-enabling-a-data-store"></a>Предотвращение потенциальных препятствий для включения хранилища данных

Некоторые хранилища данных не предоставляют веб-службу, совместимую с [OpenSearch](https://github.com/dewitt/opensearch), но по-прежнему могут быть подключены к федеративным поиску Windows. К таким хранилищам данных относятся:

-   Удаленные индексы с методами проверки подлинности, которые не поддерживаются в Федеративной службе поиска Windows 7.

    Примеры включают проверку подлинности на основе форм и другие пользовательские методы проверки подлинности.

-   Если общедоступное хранилище высокой ценности содержит общедоступные веб-API, любой пользователь может написать другую веб-службу, совместимую с [OpenSearch](https://github.com/dewitt/opensearch), и вызвать эти API в фоновом режиме.

    Примеры включают библиотеку Congress и базы данных медицинских исследований.

-   Частные хранилища данных предприятия или индексы, а также устаревшие хранилища управления содержимым, для которых невозможно реализовать внешний интерфейс.

Однако существуют альтернативные варианты, позволяющие избежать барьеров при включении хранилища данных. Ниже приведены некоторые из этих вариантов.

**Для создания веб-службы среднего звена, когда нельзя изменить веб-службу для существующего источника данных, или веб-служба предоставляет настраиваемый API:**

1.  Напишите веб-службу среднего звена, которая может принимать запрос Windows 7.
2.  Подключитесь к источнику данных и получите результаты запроса.
3.  Переформатируйте результаты в формате RSS или Atom.
4.  Возврат результатов в клиент Windows 7.
5.  Обратите внимание, что для служб корпоративных данных и многих служб данных Интернета может потребоваться передать учетные данные пользователя от имени веб-службы, чтобы выполнить усечение результатов на основе разрешений пользователя.

**Чтобы использовать существующую поисковую подсистему, если не удается включить общедоступное хранилище данных:**

1.  Используйте общедоступную поисковую подсистемку, которая уже поддерживает [OpenSearch](https://github.com/dewitt/opensearch) с RSS. Это можно сделать, предоставив пользователям файл с расширением OSDX-с шаблоном URL-адреса, который будет ограничивать результаты только теми, которые относятся к конкретному домену.
2.  См. Следующий пример описания [OpenSearch](https://github.com/dewitt/opensearch) для поиска только содержимого справки для Windows с помощью запроса к Live.com.

    ```
    <?xml version="1.0" encoding="UTF-8"?>
    <OpenSearchDescription xmlns="https://a9.com/-/spec/opensearch/1.1/">
      <ShortName>Windows Help</ShortName>
      <Description>Search Windows Help using the live.com search engine</Description>
      <Language></Language>
      <Url type="text/html" template="https://windowshelp.microsoft.com/windows/search.aspx?=&amp;qu={searchTerms}"/>
      <Url type="application/rss+xml" template="https://api.search.live.com/rss.aspx?source=web&amp;query={searchTerms} site:windowshelp.microsoft.com&amp;web.count=50"/>
    </OpenSearchDescription>
    ```

    

**Чтобы использовать существующий сервер индексирования, поддерживающий OpenSearch, если не удается включить собственные корпоративные хранилища данных или индексы, выполните следующие действия.**

1.  Выберите существующий сервер индексирования, который поддерживает [OpenSearch](https://github.com/dewitt/opensearch) для индексирования содержимого, например SharePoint Search Server.
2.  Создайте OSDX--файл, который будет ограничивать результаты в индексе SharePoint только теми, которые относятся к серверу, используя синтаксис ключевых слов в шаблоне URL.

**Чтобы создать хранилище данных на стороне клиента, если не работает решение на стороне сервера:**

1.  Напишите Клиентский источник данных [OpenSearch](https://github.com/dewitt/opensearch) , расположенный между поставщиком Windows [OpenSearch](https://github.com/dewitt/opensearch) и внешним источником данных.
2.  Используйте API [интерфейса иопенсеарчсаурце](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iopensearchsource) в Windows SDK, чтобы создать соответствующий файл. сеарчконнектор-MS, через который проводник Windows может вызвать реализацию с параметрами запроса. Затем ваша реализация может вернуть результаты в формате RSS или Atom. Это позволит вашей реализации предоставлять пользовательский пользовательский интерфейс проверки подлинности и подключаться к источнику данных с помощью собственного API-интерфейса.

> [!Note]  
> При открытии файла. OSDX-в каталоге% UserProfile%/сеарчес создается файл. сеарчконнектор-MS (соединитель поиска), который помещает ссылку на него в каталог% UserProfile%/Линкс.

 

## <a name="additional-resources"></a>Дополнительные ресурсы

Дополнительные сведения о реализации Федерации поиска в удаленных хранилищах данных с помощью технологий OpenSearch в Windows 7 и более поздних версиях см. в разделе "дополнительные ресурсы" в [Федеративной функции поиска в Windows](/previous-versions//dd742958(v=vs.85)).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Федеративный поиск в Windows](-search-federated-search-overview.md)
</dt> <dt>

[начало работы с федеративными поиском в Windows](getting-started-with-federated-search-in-windows.md)
</dt> <dt>

[Подключение веб-службы в Федеративной службе поиска Windows](-search-federated-search-web-service.md)
</dt> <dt>

[Создание файла описания OpenSearch в федеративного поиска Windows](-search-federated-search-osdx-file.md)
</dt> <dt>

[Следующие рекомендации по использованию федеративного поиска Windows](-search-fedsearch-best.md)
</dt> <dt>

[Развертывание соединителей поиска в федеративного поиска Windows](-search-federated-search-deploying.md)
</dt> </dl>

 

 
