---
description: диспетчер области обхода содержимого (CSM) позволяет добавлять и удалять корни поиска для хранилищ данных в области сканирования Windows поиска.
ms.assetid: 0f1ff41f-7c4c-4516-bb55-bf09a8f2f3bc
title: Управление корнями поиска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9cbe5fe6184681e6c37cb0b6a7f9a35c677fec53
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122880192"
---
# <a name="managing-search-roots"></a>Управление корнями поиска

диспетчер области обхода содержимого (CSM) позволяет добавлять и удалять корни поиска для хранилищ данных в области сканирования Windows поиска.

В этом разделе рассматриваются следующие вопросы.

-   [Сведения об корнях поиска](#about-search-roots)
-   [Перед началом](#before-you-begin)
-   [Windows 7: новый API диспетчера области сканирования](#windows-7-new-crawl-scope-manager-api)
-   [Добавление корней к области обхода содержимого](#adding-roots-to-the-crawl-scope)
-   [Удаление корней из области сканирования](#removing-roots-from-the-crawl-scope)
-   [Перечисление корней в области обхода содержимого](#enumerating-roots-in-the-crawl-scope)
-   [См. также](#related-topics)

 

## <a name="about-search-roots"></a>Сведения об корнях поиска

Корень поиска определяет основу пространства имен оболочки, в которой определенные области можно включать или исключать, и обычно является контейнером самого высокого уровня в протоколе, который можно перечислить. Он не указывает, какие части этого хранилища должны быть проиндексированы или не должны индексироваться. Он просто сигнализирует, что хранилище содержимого существует и связано с зарегистрированным обработчиком протокола. Синтаксис для идентификации корневого URL-адреса поиска включает протокол, идентификатор безопасности магазина или пользователя, путь и, при необходимости, конкретный элемент (например, файл). В следующих примерах показаны две формы синтаксиса для корня поиска.


```
<protocol>://<store or SID>\<path>\[item]
or
<protocol>://<store or SID>/<path>/[item]
```



&lt; &gt; За сегментом протокола должны следовать две (2) косые черты ("/"), если только это не файл: протокол, для которого требуется три косые черты (file:///). <site or SID>Сегмент представляет хранилище содержимого или идентификатор безопасности пользователя, если корневой каталог поиска предназначен только для пользователя. &lt;Сегмент пути &gt; представляет собой набор контейнеров, таких как каталоги или папки, и может включать символ-шаблон " \* ". &lt;Сегмент элемента &gt; является необязательным и может также включать символ-шаблон " \* ". Если элемент не включен, обязательно завершите сегмент пути косой чертой, иначе индексатор будет считать, что последний вложенный элемент является элементом.

Например, предположим, что вы реализовали обработчик протокола (миф) для обработки файлов типа \* . myext для пользовательского приложения. Все эти файлы будут расположены в папке Ворктеама \\ ProjectFiles на локальном компьютере. Корень поиска для этого может выглядеть следующим образом:

-   myPH:///C: \\ ворктеама \\ ProjectFiles\\

Предположим, вы планируете включить все файлы. myext, но в индексе нет ничего другого из этого контейнера. Корень поиска для этого может выглядеть следующим образом:

-   myPH:///C: \\ ворктеама \\ ProjectFiles \\ \* . myext.

Шаблоны с подстановочными знаками определяют URL-адреса с помощью подстановочного знака " \* " и считаются шаблоном, а не URL-адресом, но терминология часто взаимозаменяемы. Например, file:///C: \\ данные Project a \\ \* \\ \\ будут соответствовать следующим URL-адресам:

-   В. \\ проектная \\ **версии 1** \\ данных\\
-   В. \\ проектная \\ **версия2** \\ данных\\

Но этот шаблон не будет соответствовать этому URL-адресу:

-   В. \\ проект a \\ **версии 1 \\ временные** \\ данные\\

Необходимо создать новые корни поиска для контейнеров, которые еще не находятся в области обхода содержимого индексатора. Если путь C: \\ парентскопе уже включен в область сканирования, нет необходимости добавлять новый корневой элемент поиска для C: \\ парентскопе \\ чилдскопе, если не известно, что дочерняя область ранее не была исключена.

пользовательский интерфейс для установки Windows параметров поиска отображает корни поиска для пользователей, чтобы они могли уточнить правила области для их поиска. В рамках процесса установки пользовательского обработчика протокола, контейнера или приложения можно определить область обхода по умолчанию с правилами включения и исключения. Эти правила представлены для конечных пользователей в качестве расположений. Пользователи могут перемещаться по подкаталогам предопределенного корня поиска и выбирать те из них, которые необходимо включить в поиск, или очистить те, которые нужно исключить.

 

## <a name="before-you-begin"></a>Перед началом

Прежде чем использовать интерфейсы диспетчера области сканирования (CSM), необходимо выполнить следующие предварительные действия.

1.  Создайте объект **кравлсеарчманажер** и получите его интерфейс [**исеарчманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchmanager) .
2.  Вызовите [**исеарчманажер:: catalog**](/windows/desktop/api/Searchapi/nf-searchapi-isearchmanager-getcatalog) для "системиндекс", чтобы получить экземпляр интерфейса [**исеарчкаталогманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcatalogmanager) .
3.  Вызовите метод [**исеарчкаталогманажер:: жеткравлскопеманажер**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcatalogmanager-getcrawlscopemanager) , чтобы получить экземпляр интерфейса [**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) .

После внесения изменений в Диспетчер области обхода содержимого (CSM) необходимо вызвать [**исеарчкравлскопеманажер:: савеалл**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-saveall). Этот метод не принимает параметров и возвращает значение S \_ ОК в случае успеха.

 

## <a name="windows-7-new-crawl-scope-manager-api"></a>Windows 7: новый API диспетчера области сканирования

в **Windows 7 и более поздних версий** [**ISearchCrawlScopeManager2**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager2) расширяет функциональные возможности интерфейса [**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) . Метод [**ISearchCrawlScopeManager2::-Version**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager2-getversion) получает версию диспетчера области СКАНИРОВАНИЯ (CSM), которая информирует клиентов, если изменилось состояние CSM. **ISearchCrawlScopeManager2::-Version** не приводит к вызову между процессами. Если функция выполнена, возвращаемый указатель остается действительным до тех пор, пока клиент не вызовет **UnmapViewOfFile** в указателе и **CloseHandle** на возвращенном обработчике.

 

## <a name="adding-roots-to-the-crawl-scope"></a>Добавление корней к области обхода содержимого

[**Исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) сообщает поисковой системе о контейнерах для обхода и (или) просмотра, а также элементов в этих контейнерах для включения или исключения. Чтобы добавить новый корень поиска, создайте экземпляр объекта [**исеарчрут**](/windows/desktop/api/Searchapi/nn-searchapi-isearchroot) , установите корневые атрибуты, а затем вызовите [**Исеарчкравлскопеманажер:: аддрут**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-addroot) и передайте ему указатель на объект **исеарчрут** . Корневой URL-адрес поиска имеет ту же форму, что и корень поиска, описанный выше.

В следующей таблице описаны соответствующие методы размещения для [**исеарчрут**](/windows/desktop/api/Searchapi/nn-searchapi-isearchroot). другие методы размещения интерфейса в настоящее время не используются Windows поиска. Мы рекомендуем включить идентификаторы безопасности (SID) пользователей во всех корнях для повышения безопасности. Корни на пользователя более безопасны, так как запросы выполняются в пользовательском процессе, что гарантирует, что один пользователь не сможет видеть элементы, индексируемые из папки "Входящие" другого пользователя, например.



| Метод                     | Описание                                                                                                                                                                                         |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| разместить \_ провидеснотификатионс | Задайте значение **true** , если обработчик протокола или другое приложение уведомит поисковую подсистему об изменениях в URL-адресах в корне поиска. Уведомление указывает, что URL-адреса требуют повторного индексирования. |
| разместить \_ рутурл               | Задает корневой URL-адрес для текущего поиска. URL-адрес принимает описанную выше корневую форму поиска.                                                                                                      |



 

 

По умолчанию индексатор не выполняет обход области при добавлении корня поиска. Необходимо также добавить правило включения для корня. Если вы хотите добавить пользовательский корневой элемент для приложения, это приложение должно добавить соответствующие корни для новых пользователей при запуске приложения.

Чтобы добавить соответствующие корни для новых пользователей, выполните следующие действия.

1.  Получите идентификатор безопасности пользователя.
2.  Перечислите все корни, чтобы проверить, существует ли для этого идентификатора безопасности один из них.
3.  При необходимости добавьте новый корень с использованием идентификатора безопасности.

 

## <a name="removing-roots-from-the-crawl-scope"></a>Удаление корней из области сканирования

[**Исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager) можно использовать для удаления корня из области сканирования, если больше не требуется индексировать этот URL-адрес. При удалении корня также удаляются все правила области для этого URL-адреса. Например, предположим, что требуется удалить хранилище содержимого и (или) его обработчик протокола из системы. Можно удалить приложение, удалить все данные, а затем удалить корень поиска из области обхода содержимого, и Диспетчер области обхода контента удалит корень и все правила области, связанные с корнем.

Чтобы удалить существующий корень поиска, вызовите [**исеарчкравлскопеманажер:: ремоверут**](/windows/desktop/api/Searchapi/nf-searchapi-isearchcrawlscopemanager-removeroot) с корнем поиска, который необходимо удалить. Корневой URL-адрес поиска имеет ту же форму, что и корень поиска, описанный выше. Этот метод возвращает \_ значение false, если корневой каталог не найден, и код ошибки, если произошла ошибка при удалении найденного корня.

при удалении корня поиска также удаляется URL-адрес из пользовательского интерфейса для Windows параметров поиска, поэтому пользователи могут не иметь возможности повторно добавить этот контейнер или расположение с помощью пользовательского интерфейса. Кроме того, можно удалить все переопределения набора пользователей для корня поиска и вернуться к исходным правилам корня и области поиска. Дополнительные сведения см. в разделе [Управление правилами области](-search-3x-wds-extidx-csm-scoperules.md).

> [!Note]  
> в Windows Vista, если пользователи удаляются с помощью профилей пользователей на панели управления, CSM удаляет все правила и корни с идентификатором безопасности и удаляет их индексированные элементы из каталога. в Windows XP необходимо вручную удалить корни и правила пользователей.

 

 

## <a name="enumerating-roots-in-the-crawl-scope"></a>Перечисление корней в области обхода содержимого

CSM перечисляет корни поиска с помощью стандартного интерфейса перечислителя в стиле COM, [**иенумсеарчрутс**](/windows/desktop/api/Searchapi/nn-searchapi-ienumsearchroots). Этот интерфейс можно использовать для перечисления корней поиска в ряде целей. Например, может потребоваться отобразить всю область сканирования в пользовательском интерфейсе или определить, находится ли конкретный корень или дочерний элемент корневого элемента в области обхода.

 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Reference**
</dt> <dt>

[**исеарчкравлскопеманажер**](/windows/desktop/api/Searchapi/nn-searchapi-isearchcrawlscopemanager)
</dt> <dt>

[**исеарчрут**](/windows/desktop/api/Searchapi/nn-searchapi-isearchroot)
</dt> <dt>

[**иенумсеарчрутс**](/windows/desktop/api/Searchapi/nn-searchapi-ienumsearchroots)
</dt> <dt>

**Зрения**
</dt> <dt>

[Использование диспетчера области сканирования](-search-3x-wds-extidx-csm.md)
</dt> <dt>

[Управление правилами области](-search-3x-wds-extidx-csm-scoperules.md)
</dt> </dl>

 

 



