---
description: Агрегатная функция выполняет вычисление для набора значений и возвращает значение. Это позволяет создавать сводные статистические данные для многоуровневых групп с небольшими издержками.
ms.assetid: 82a93f57-8273-45bf-81d7-50a673845ae1
title: Агрегатные функции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30d504a9343116bc23e847728716eeaa79fc2d26d993e962dd81ccd43669e22a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119094963"
---
# <a name="aggregate-functions"></a>Агрегатные функции

Агрегатная функция выполняет вычисление для набора значений и возвращает значение. Это позволяет создавать сводные статистические данные для многоуровневых групп с небольшими издержками.

## <a name="about-aggregate-functions"></a>Общие сведения о агрегатных функциях

агрегатные функции в Windows язык SQL поиска (SQL) имеют следующий синтаксис:


```
AGGREGATE <function> [AS <label>] [,<function> [AS <label>]]*
```



Часть функции может содержать любую из следующих функций и синтаксиса:



| Функция                                                              | Описание                                                                                                                                                                                                 |
|-----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AVG ( <column> )                                                   | Возвращает среднее арифметическое значений в группе. Применяется только к числам.                                                                                                                                      |
| БИФРЕКУЕНЦИ ( <column> , <N> )                                | Возвращает наиболее частое значение столбца N из результатов в группе. Также содержит количество раз, когда произошло каждое значение, и идентификаторы документов для результатов, содержащих каждое возвращаемое значение. |
| CHILDCOUNT ()                                                          | Возвращает число элементов в группе (за исключением подгрупп). Если имеется несколько уровней группировки, возвращается число непосредственных дочерних групп.                                                  |
| COUNT ()                                                               | Возвращает количество элементов в группе и всех подгрупп.                                                                                                                                                   |
| DATERANGE ( <column> )                                             | Возвращает нижнюю и верхнюю границы значений столбцов, найденных в группе результатов группы. Допустимо только для свойств FILETIME.                                                                               |
| FIRST ( <column> , <N> )                                      | Возвращает первые N значений столбцов из конечных результатов, найденных в группе.                                                                                                                                       |
| MAX ( <column> )                                                   | Возвращает максимальное значение выражения. Применимо только к числам или датам.                                                                                                                              |
| MIN ( <column> )                                                   | Возвращает минимальное значение выражения. Применимо только к числам или датам.                                                                                                                              |
| РЕПРЕСЕНТАТИВЕОФ ( <column> , <idRepresentative> , <N> ) | Возвращает N значений Идрепресентативе, каждое из которых выбрано из одного из подмножеств результатов, имеющих уникальное значение столбца. Каждое значение также возвращается с идентификатором документа, имеющим значение Идрепресентативе. |
| SUM ( <column> )                                                   | Возвращает сумму значений в группе. Применяется только к числам.                                                                                                                                          |



 

 

> [!Note]  
> Статистические выражения возвращаются в виде отдельных столбцов. Они являются главными простыми типами, за исключением Бифрекуенци, First, DateRange и Репресентативеоф, которые возвращаются как составные типы.

 

Для агрегатов можно использовать любой столбец числового значения или даты, а не только те, которые входят в предложение SELECT. Однако нельзя группировать по статистическим выражениям. Если переданный аргумент столбца не является числовым или типом даты, возвращается синтаксическая ошибка.

Часть метки является необязательной и предоставляет более понятный псевдоним для метки. если метка псевдонима не включена, Windows поиск преобразует функцию и имя столбца в метку. Например, MAX (System.Docумент. WordCount) преобразуется в максимальное \_ системдокументвордкаунт.

## <a name="multi-level-groups-and-counting"></a>Многоуровневые группы и подсчет

Агрегаты определяются над листьями и дублируются. Статистическое выражение принимает в качестве входных данных конечные элементы группы, которая определяет ее (документы), а не подгруппы дочерних элементов. Эта функция называется многоуровневой группировкой.

Помимо агрегатов, определяемых над листьями и повторяющимися, они считаются только один раз. Хотя один и тот же документ может быть представлен несколько раз в одной группе, агрегаты будут рассматривать его только один раз. Эта концепция показана на следующем рисунке.

![Схема, показывающая, что агрегаты определены над листьями и повторяющимися и считаются только один раз](images/aggregates.png)

## <a name="aggregate-examples"></a>Статистические примеры

Ниже приведены примеры агрегатных функций в предложении GROUP ON:


```
GROUP ON System.Sender ['d','m','r'] 
    AGGREGATE COUNT() as 'Total',
              MAX(System.Size) as 'Max Size',
              MIN(System.Size) as 'Min Size'
    OVER (SELECT System.Subject FROM systemindex)
              
GROUP ON System.Sender ['d', 'm', 'r']
      AGGREGATE MAX(System.Search.Rank) as 'MaxRank', 
                MIN(System.Search.Rank) as 'MinRank'
      OVER (GROUP ON system.conversationID
                  OVER (SELECT workid, System.ItemUrl FROM systemindex
                        WHERE CONTAINS (*, 'sometext')
                        ORDER BY System.DateCreated))
               
GROUP ON System.FileName [before('a'),before('z')] 
      AGGREGATE MAX(System.Size) as 'maxsize', MIN(System.Size) as 'MinSize' 
      OVER (SELECT System.FileName FROM systemindex
            ORDER BY System.FileName)      
            
GROUP ON System.author 
      AGGREGATE MAX(System.size) as 'maxsize' 
      ORDER BY min(System.Size) 
      OVER (GROUP ON System.DateCreated 
                  AGGREGATE Count() 
                  ORDER BY MAX(System.size) 
                  OVER (SELECT filename, System.DateCreated, System.Size FROM systemindex
                        WHERE CONTAINS('text')))
```



## <a name="return-value"></a>Возвращаемое значение

Возвращаемое значение является вариантом, найденным в наборе строк как пользовательское свойство либо как заданные псевдонимы, либо как "агрегаты", если не указана метка псевдонима.

 

 



