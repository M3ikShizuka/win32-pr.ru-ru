---
description: узнайте о рекомендациях по созданию обработчиков фильтров в Windows поиске. Поиск использует фильтры для извлечения элементов, включаемых в полнотекстовый индекс.
ms.assetid: 7b86a1b4-c8a9-400d-a9f1-a3b821c0269d
title: рекомендации по использованию обработчиков фильтров в Windowsном поиске
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8320cf0f85bf86f7d61df09437271af67d0e4096fc3a917d037914854c9bad3d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118463703"
---
# <a name="best-practices-for-creating-filter-handlers-in-windows-search"></a>рекомендации по созданию обработчиков фильтров в Windowsном поиске

Microsoft Windows Search использует фильтры для извлечения содержимого элементов, включаемых в полнотекстовый индекс. можно расширить Windows поиска для индексации новых или собственных типов файлов, создав обработчики фильтров для извлечения содержимого и обработчиков свойств для извлечения свойств файлов. Фильтры связаны с типами файлов, как отмечены расширениями имен файлов, типами MIME или идентификаторами классов (CLSID). Хотя один фильтр может работать с несколькими типами файлов, каждый тип работает только с одним фильтром.

Этот раздел состоит из следующих подразделов.

-   [Машинный код](#native-code)
-   [рекомендации по безопасному созданию кода для Windowsного поиска](#secure-code-practices-for-windows-search)
-   [Дополнительные ресурсы](#additional-resources)
-   [Связанные темы](#related-topics)

## <a name="native-code"></a>Машинный код

в Windows 7 и более поздних версиях фильтры, написанные в управляемом коде, явным образом блокируются. Фильтры должны быть написаны в машинном коде из-за потенциальных проблем с управлением версиями среды CLR в процессе выполнения нескольких надстроек.

## <a name="secure-code-practices-for-windows-search"></a>рекомендации по безопасному созданию кода для Windowsного поиска

ниже приведены рекомендации по написанию защищенных приложений для использования с Windowsным поиском.

**Для приложений запросов:**

-   При написании клиентов поиска следует выбрать API, который выполняется в контексте безопасности, который позволяет пользователю иметь минимальные привилегии. Например, страницы ASP могут использовать объект запроса ИКСССО, который выполняется как пользовательский процесс.

**Для IFilter и языковых ресурсов:**

-   Если новый обработчик фильтра для типа файла устанавливается в качестве замены для существующей регистрации фильтра, установщик должен сохранить текущую регистрацию и восстановить ее при удалении нового обработчика фильтра. Механизм фильтрации цепочек отсутствует. Таким образом, новый обработчик фильтра отвечает за репликацию всех необходимых функций старого фильтра.
-   фильтры ifilter, средство разбиения по словам и парадигматические модули для Windowsного поиска выполняются в локальном контексте безопасности. Они должны быть написаны для корректного управления буферами и их правильного стека. Все копии строк должны иметь явные проверки для защиты от переполнения буфера. Следует всегда проверять выделенный размер буфера и проверять размер данных в соответствии с размером буфера. Переполнение буфера — это распространенная методика использования кода, который не обеспечивает ограничения размера буфера.
-   [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter), средство разбиения по словам и компоненты парадигматические модули никогда не должны вызывать функцию [ExitProcess](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) или аналогичный API, который завершает процесс и все его потоки.
-   Не выделяйте и не освобождайте ресурсы в точке входа DllMain. Это может привести к сбоям при нехватке нагрузочных тестов.
-   Код все объекты должны быть потокобезопасными. Windows Поиск вызывает любой экземпляр средств разбиения по словам или парадигматические модули в одном потоке за раз, но может вызывать несколько экземпляров одновременно для нескольких потоков.
-   Избегайте создания временных файлов или записи в реестр.
-   при использовании компилятора Microsoft Visual C++ убедитесь, что приложение компилируется с параметром **/gs** . Параметр **/GS** используется для обнаружения переполнений буфера. Параметр/GS помещает проверки безопасности в скомпилированный код. Дополнительные сведения см. в разделе [DllGetClassObject Function](https://msdn.microsoft.com/library/8dbf701c(vs.71).aspx)  / **GS** (проверка безопасности буфера) раздела Visual C++ параметров компилятора в пакете SDK платформы.

## <a name="additional-resources"></a>Дополнительные ресурсы

-   В примере [ифилтерсампле](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/winui/WindowsSearch/IFilterSample) показано, как создать базовый класс IFilter для реализации интерфейса [**IFilter**](/windows/win32/api/filter/nn-filter-ifilter) .
-   Общие сведения о процессе индексирования см. [в разделе процесс индексирования](-search-indexing-process-overview.md).
-   Общие сведения о типах файлов см. в разделе [типы файлов](../shell/fa-file-types.md).
-   Сведения о запросе атрибутов сопоставления файлов для типа файлов см. в разделе [перцеиведтипес, системфилеассоЦиатионс и регистрация приложения](/previous-versions/windows/desktop/legacy/cc144150(v=vs.85)).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Разработка обработчиков фильтров](-search-ifilter-conceptual.md)
</dt> <dt>

[сведения о обработчиках фильтров в Windowsном поиске](-search-ifilter-about.md)
</dt> <dt>

[Возвращение свойств из обработчика фильтра](-search-ifilter-property-filtering.md)
</dt> <dt>

[Обработчики фильтров, поставляемые с Windows](-search-ifilter-implementations.md)
</dt> <dt>

[реализация обработчиков фильтров в Windowsном поиске](-search-ifilter-constructing-filters.md)
</dt> <dt>

[Регистрация обработчиков фильтров](-search-ifilter-registering-filters.md)
</dt> <dt>

[Тестирование обработчиков фильтров](-search-ifilter-testing-filters.md)
</dt> </dl>

 

 
