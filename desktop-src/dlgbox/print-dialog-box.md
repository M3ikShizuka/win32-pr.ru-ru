---
title: Диалоговое окно «Печать»
description: Диалоговое окно печать позволяет пользователю выбрать параметры для конкретного задания печати.
ms.assetid: 34f69b25-8a89-4322-af4c-a80b85a4a973
keywords:
- Windows Пользовательский интерфейс, ввод данных пользователем
- Windows Пользовательский интерфейс, Библиотека общих диалоговых окон
- ввод пользователя, Библиотека общих диалоговых окон
- запись вводимых пользователем данных, Библиотека общих диалоговых окон
- Библиотека общих диалоговых окон
- Общие диалоговые окна
- Печать - диалоговое окно
- Диалоговое окно «Настройка печати»
- Настройка диалогового окна «Печать»
- стандартные диалоговые окна
- диалоговые окна, печать
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0afd8cfa31a83f664e859cd93acc9d28543b7ab00dcb8f130fdbac329cd1429e
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117720925"
---
# <a name="print-dialog-box"></a>Диалоговое окно «Печать»

Диалоговое окно **Печать** позволяет пользователю выбрать параметры для конкретного задания печати. Например, пользователь может указать используемый принтер, диапазон печатаемых страниц и количество копий.

Функцию [**принтдлжекс**](/previous-versions/windows/desktop/legacy/ms646942(v=vs.85)) можно использовать для отображения страницы [свойств печати](print-property-sheet.md), содержащей страницу « **Общие** », содержащую элементы управления, аналогичные диалоговому окну « **Печать** ». Страница свойств также может содержать дополнительные страницы свойств, относящиеся к конкретному приложению и драйверу, после страницы **Общие** .

Создание и отображение диалогового окна **Печать** осуществляется путем инициализации структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) и передачи структуры в функцию [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) .

На следующем рисунке показано типичное диалоговое окно **печати** .

![диалоговое окно «Печать»](images/printdialogboxxp.png)

Если пользователь нажмет кнопку **ОК** , [**Принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) возвращает **значение true** и использует структуру [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) для возврата сведений о выборе пользователя. Например, члены **хдевмоде** и **хдевнамес** обычно возвращают глобальные дескрипторы памяти для структур и [**DEVNAMES**](/windows/win32/api/commdlg/ns-commdlg-devnames) . Сведения в этих структурах можно использовать для создания контекста устройства или информационного контекста для выбранного принтера.

Если пользователь отменяет диалоговое окно **Печать** или возникает ошибка, [**Принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) возвращает **значение false**. Причину ошибки можно определить с помощью функции [**коммдлжекстендедеррор**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) , чтобы получить расширенное значение ошибки.

Диалоговое окно **Печать** содержит группу **диапазонов печати** переключателей, указывающих, хочет ли пользователь печатать все страницы, диапазон страниц или только выделенный текст. Перед вызовом [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85))можно задать один из флагов **PD \_ ALLPAGES**, **PD \_ Selection** или **PD \_ паженумс** , чтобы указать, какая кнопка изначально выбрана. Когда **принтдлг** возвращает **значение true**, функция устанавливает один из этих флагов для указания выбора пользователя. Если задано значение **PD \_ паженумс** , то элементы **Нфромпаже** и **нтопаже** структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) содержат начальную и конечную страницы, указанные пользователем. Чтобы отключить переключатель **страницы** и связанные **с** ним элементы управления и **для** редактирования, установите флаг **PD \_ нопаженумс** . Чтобы отключить переключатель « **Выбор** », установите флаг « **PD \_** ».

Диалоговое окно содержит элемент управления "поле ввода", в котором пользователь может ввести число печатаемых копий. Если элемент **хдевмоде** структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) имеет значение, отличное от **null**, то элемент **дмкопиес** структуры указывает начальное значение для этого элемента управления "поле ввода". Если **хдевмоде** имеет **значение NULL**, то элемент **нкопиес** структуры **принтдлг** указывает начальное значение. Когда [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) возвращает, **нкопиес** обычно указывает количество копий, указанное пользователем. Однако если установить флаг **PD \_ уседевмодекопиесандколлате** при создании диалогового окна, **нкопиес** всегда имеет значение 1 при возвращении, а элемент **дмкопиес** [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) указывает число печатаемых копий.

Флажок **COLLATE** указывает, хочет ли пользователь выполнить сортировку страниц, если печатается несколько копий. Флаг **\_ сортировки параметров PD** устанавливается, если установлен флажок **COLLATE** . Если приложение не поддерживает несколько копий или смоделированные параметры сортировки, установите флаг **PD \_ уседевмодекопиесандколлате** в элементе **flags** структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) . Если драйвер принтера не поддерживает несколько копий и параметров сортировки, флажок **Параметры сортировки** и **число копий** элемента управления "поле ввода" отключаются.

Флажок **Печать в файл** указывает, хочет ли пользователь отправить выходные данные в файл, а не на принтер. Можно установить флаг **PD \_ PRINTTOFILE** , чтобы был изначально установлен флажок. Чтобы скрыть этот флажок, установите флаг **PD \_ хидепринттофиле** . Чтобы отключить его, установите флаг **PD \_ дисаблепринттофиле** . Если пользователь выбирает параметр **Print to File (печать в файл** ), [**Принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) устанавливает флаг **PD \_ PRINTTOFILE** и возвращает «file:» в смещении, указанном элементом **ваутпутоффсет** структуры [**DEVNAMES**](/windows/win32/api/commdlg/ns-commdlg-devnames) . При вызове функции для запуска операции печати укажите эту строку "FILE:" в элементе **лпсзаутпут** структуры. Указание этой строки приводит к тому, что подсистема печати запрашивает у пользователя имя выходного файла.

По умолчанию в диалоговом окне « **Печать** » изначально отображаются сведения о текущем принтере по умолчанию. Чтобы отобразить сведения для другого установленного принтера, инициализируйте и [**DEVNAMES**](/windows/win32/api/commdlg/ns-commdlg-devnames) структуру и назначьте структуре глобальный маркер памяти для элементов **хдевмоде** и **хдевнамес** . Имя устройства, указанное в элементе **дмдевиценаме** структуры [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) и в члене **вдривероффсет** структуры **DEVNAMES** , должно определять устройство принтера, которое также указано в \[ разделе Devices \] файла Win.ini. Если устройство отсутствует в списке, [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) возвращает ошибку.

Можно направить [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) для создания контекста устройства или информационного контекста для принтера, установив флаг **PD \_ ретурндк** или PD в **элементе \_** **flags** структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) . Функция возвращает маркер контекста устройства или информационного контекста в члене **HDC** . Если вы используете флаг **PD \_ ретурндк** , можно использовать контекст устройства для создания выходных данных для принтера.

Чтобы получить сведения о принтере по умолчанию без отображения диалогового окна « **Печать** », установите флаг **PD \_ ретурндефаулт** . В этом случае [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) возвращается сразу после задания элементов **хдевмоде** и **хдевнамес** для обработки структур, содержащих эти сведения.

По умолчанию [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) отображает окна сообщений при возникновении ошибок. Например, функция отображает сообщение об ошибке, если принтеры не установлены. Чтобы функция не отображала эти предупреждающие сообщения, установите флаг " **PD \ \_ предупреждение** ".

В этом разделе рассматриваются следующие темы.

-   [Настройка диалогового окна «Печать»](#customizing-the-print-dialog-box)
-   [Диалоговое окно «Настройка печати»](#print-setup-dialog-box)

## <a name="customizing-the-print-dialog-box"></a>Настройка диалогового окна «Печать»

Можно указать пользовательский шаблон для диалогового окна **Печать** , например, если требуется включить дополнительные элементы управления, которые являются уникальными для приложения. Функция [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) использует пользовательский шаблон вместо шаблона по умолчанию.

Чтобы предоставить пользовательский шаблон для диалогового окна « **Печать** », выполните следующие действия.

1.  Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле Прнсетуп. DLG. Идентификаторы элементов управления, используемые в шаблоне диалогового окна **печати** по умолчанию, определяются в файле длгс. h.
2.  Используйте структуру [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) , чтобы включить шаблон следующим образом:
    -   Если пользовательский шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **PD \_ енаблепринттемплате** в элементе **flags** . Используйте элементы **HINSTANCE** и **лппринттемплатенаме** структуры для задания имени модуля и ресурса.

        -Или-

    -   Если пользовательский шаблон уже находится в памяти, установите флаг **PD \_ енаблепринттемплатехандле** . Используйте элемент **хпринттемплате** для задания объекта памяти, содержащего шаблон.

Для диалогового окна « **Печать** » можно предоставить процедуру обработчика [**принсукпрок**](/windows/win32/api/commdlg/nc-commdlg-lpprinthookproc) . Процедура-обработчик может обрабатывать сообщения, отправленные в диалоговое окно. Он также может отсылать сообщения в диалоговое окно. При использовании пользовательского шаблона для определения дополнительных элементов управления необходимо предоставить процедуру-обработчик для обработки входных данных для элементов управления.

Чтобы включить процедуру-обработчик для диалогового окна « **Печать** », выполните следующие действия.

1.  Установите флаг **PD \_ енаблепринсук** в элементе **flags** структуры [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) .
2.  Укажите адрес процедуры-обработчика в элементе **лпфнпринсук** .

После обработки сообщения [**WM \_ инитдиалог**](wm-initdialog.md) процедура диалогового окна отправляет сообщение **WM \_ инитдиалог** в процедуру-обработчик. Параметр *lParam* этого сообщения является указателем на структуру [**принтдлг**](/windows/win32/api/commdlg/ns-commdlg-printdlga) , используемую для инициализации диалогового окна.

## <a name="print-setup-dialog-box"></a>Диалоговое окно «Настройка печати»

Можно создать и отобразить диалоговое окно **Настройка печати** , установив флаг **PD \_ принтсетуп** в вызове функции [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) . Однако диалоговое окно **Настройка печати** заменено диалоговым окном **Параметры страницы** и не должно использоваться в новых приложениях.

Следующие флаги применяются только к диалоговому окну « **Настройка печати** ».

-   **PD \_ енаблесетуфук**
-   **PD \_ енаблесетуптемплате**
-   **PD \_ енаблесетуптемплатехандле**

 

 