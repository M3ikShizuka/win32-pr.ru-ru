---
title: Диалоговое окно "Шрифт"
description: Диалоговое окно Шрифт позволяет пользователю выбирать атрибуты для логического шрифта, например семейство шрифтов и связанный стиль шрифта, размер точки, эффекты (подчеркивание, зачеркнутый и цвет текста), а также сценарий (или набор символов).
ms.assetid: e8a996aa-4e34-45d0-a325-9c20b1a6ce07
keywords:
- Пользовательский интерфейс Windows, ввод данных пользователем
- Пользовательский интерфейс Windows, Библиотека общих диалоговых окон
- ввод пользователя, Библиотека общих диалоговых окон
- запись вводимых пользователем данных, Библиотека общих диалоговых окон
- Библиотека общих диалоговых окон
- Общие диалоговые окна
- диалоговое окно шрифтов
- диалоговое окно «Настройка шрифта»
- Флаги, диалоговое окно "Шрифт"
- Флаги инициализации
- стандартные диалоговые окна
- диалоговые окна, шрифт
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9a752ce53ecf496c58efb0c346a8c3d67c4f1b1
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070557"
---
# <a name="font-dialog-box"></a>Диалоговое окно "Шрифт"

Диалоговое окно **Шрифт** позволяет пользователю выбирать атрибуты для логического шрифта, например семейство шрифтов и связанный стиль шрифта, размер точки, эффекты (подчеркивание, зачеркнутый и цвет текста), а также сценарий (или набор символов).

Диалоговое окно **Шрифт** создается и отображается путем инициализации структуры [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) и передачи структуры в функцию [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) .

На следующем снимке экрана показано диалоговое окно типичного **шрифта** .

![снимок экрана, показывающий диалоговое окно "Шрифт"](images/fontdialogboxxp.png)

Если пользователь нажмет кнопку **ОК** , функция [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) возвращает **значение true** и задает сведения о выборе пользователя в структуре [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) .

Если пользователь отменяет диалоговое окно **Шрифт** или возникает ошибка, [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) возвращает **значение false** , а содержимое структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) не определяется. Причину ошибки можно определить с помощью функции [**коммдлжекстендедеррор**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) , чтобы получить расширенное значение ошибки.

В этом разделе рассматриваются следующие темы.

-   [Флаги инициализации диалогового окна шрифта](#font-dialog-box-initialization-flags)
-   [Настройка диалогового окна «Шрифт» в более ранних версиях Windows](#customizing-the-font-dialog-box-on-earlier-versions-of-windows)
-   [Настройка диалогового окна «Шрифт» в Windows 7](#customizing-the-font-dialog-box-on-windows-7)

## <a name="font-dialog-box-initialization-flags"></a>Флаги инициализации диалогового окна шрифта

Перед вызовом [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta)элемент **flags** в структуре [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) должен указать **\_ оба** параметра: **CF \_ скринфонтс**, **CF \_ принтерфонтс** или CF, чтобы указать, следует ли диалоговое окно вывести список экранных шрифтов, шрифтов принтера или и того и другого. Если указать **\_ обе** версии: **CF \_ Принтерфонтс** или CF, элемент **HDC** структуры **CHOOSEFONT** должен задавать маркер для контекста устройства для принтера.

Если установлен флаг **CF \_ Принтерфонтс** или **CF \_** , то в нижней части диалогового окна **Шрифт** отображается метка описание типа шрифта.

Начиная с Windows 7 флаги **CF \_ принтерфонтс**, **CF \_ Скринфонтс**, **CF \_ both** и **CF \_ WYSIWYG** больше не используются функцией [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) для перечисления шрифтов. Они устарели в Windows 7. Однако флаг **CF \_ принтерфонтс** содержит одну функцию: для вывода метки описания типа шрифта в нижней части диалогового окна **Шрифт** .

Можно использовать элемент **flags** для включения или отключения некоторых элементов управления диалогового окна **Шрифт** , а также можно использовать элемент **flags** вместе с другими элементами [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) для управления начальными значениями некоторых элементов управления.

**Чтобы отобразить элементы управления, позволяющие пользователю выбрать параметры зачеркивания, подчеркивание и цвет, выполните следующие действия.**

-   Установка флага **\_ эффектов CF** . Для указания исходного цвета шрифта можно использовать элемент **ргбколорс** структуры [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) .

**Чтобы указать начальные значения для элементов управления "Шрифт", "стиль шрифта", "размер", "зачеркивание" и "подчеркивание", сделайте следующее:**

1.  Чтобы указать начальные значения для элементов управления "Шрифт", "стиль шрифта", "размер", "зачеркивание" и "подчеркивание", сделайте следующее:
2.  Установите флаг **CF \_ иниттологфонтструкт** в элементе **flags** вместе с элементами структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) , на которую указывает **лплогфонт**, чтобы указать начальные значения для атрибутов шрифта.
3.  Можно также использовать флаги **CF \_ нофацесел**, **CF \_ ностилесел** и **CF \_ носизесел** , чтобы диалоговое окно **шрифта** не отображало начальные значения соответствующих элементов управления. Это полезно при работе с выделенным текстом, имеющим более одного шрифта, стиля или кегля. Эти значения также будут заданы в **флагах** , когда [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) возвращает, если пользователь не выберет соответствующее значение.

**Инициализация элемента управления стиля шрифта на указанное имя стиля**

-   Установите флаг **CF \_ усестиле** и используйте элемент **лпсзстиле** , чтобы указать имя стиля.

> [!Note]  
> Чтобы выполнить глобализацию приложения, укажите стиль с помощью членов **лфвеигхт** и **лфиталик** структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) , на которую указывает **лплогфонт**. Имя стиля может изменяться в зависимости от языка пользовательского интерфейса системы.

 

**Отображение кнопки «Применить»**

-   Установите флаг **\_ применения CF** и укажите процедуру-обработчик для обработки [**\_ командных сообщений WM**](/windows/desktop/menurc/wm-command) для кнопки **Применить** . Процедура-обработчик может отправить сообщение [**WM \_ CHOOSEFONT \_ жетлогфонт**](wm-choosefont-getlogfont.md) в диалоговое окно, чтобы получить адрес структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) , которая содержит текущие выборки для шрифта.

**Отображение кнопки «Справка»**

-   Установите флаг **CF \_ SHOWHELP** . Член **хвндовнер** должен определить окно для получения зарегистрированного сообщения [**хелпмсгстринг**](helpmsgstring.md) , когда пользователь нажмет кнопку " **Справка** ".

**Ограничение шрифтов, отображаемых в диалоговом окне**

-   Задайте любое сочетание флагов **CF \_ ттонли**, **CF \_ фикседпитчонли**, **CF \_ Новекторфонтс**, **CF \_ новертфонтс**, **CF \_ скалаблеонли** и **CF \_ WYSIWYG** . Можно также ограничить доступные стили, отображаемые в диалоговом окне для некоторых шрифтов, с помощью **значения \_ CF** .

Начиная с Windows 7, список шрифтов, отображаемых в диалоговом окне, ограничен на основе показанных шрифтов пользователя. Чтобы снять ограничение, установите флаг **CF \_ инактивефонтс** .

**Ограничение имен шрифтов, стилей и размеров точек, которые может указывать пользователь**

1.  Установите флаг **CF \_ форцефонтексист** , чтобы запретить пользователю указывать только допустимые имена гарнитур, стили и размеры точек, перечисленные в диалоговом окне.
2.  Установите флаг **CF \_ лимитсизе** , чтобы запретить пользователю указывать размеры точек в диапазоне, указанном в элементах **нсиземин** и **нсиземакс** .

**Ограничение или отключение поля со списком "скрипты"**

-   Установите флаг **CF \_ носкриптсел** , чтобы отключить поле со списком " **скрипты** ", или установите флаг **CF \_ селектскрипт** , чтобы ограничить выбор в поле со списком **скрипты** указанной кодировкой.

## <a name="customizing-the-font-dialog-box-on-earlier-versions-of-windows"></a>Настройка диалогового окна «Шрифт» в более ранних версиях Windows

Можно указать пользовательский шаблон для диалогового окна **Шрифт** , например, если требуется включить дополнительные элементы управления, которые являются уникальными для приложения. Функция [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) использует пользовательский шаблон вместо шаблона по умолчанию.

**Предоставление пользовательского шаблона для диалогового окна «Шрифт»**

1.  Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле Font. DLG. Идентификаторы элементов управления, используемые в шаблоне диалогового окна Шрифт по умолчанию, определены в файле Длгс. h.
2.  Используйте структуру [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) , чтобы включить шаблон следующим образом:
    -   Если пользовательский шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **CF \_ енаблетемплате** в элементе **flags** . Используйте элементы **HINSTANCE** и **лптемплатенаме** структуры для задания имени модуля и ресурса.
    -   Если пользовательский шаблон уже находится в памяти, установите флаг **CF \_ енаблетемплатехандле** . Используйте элемент **HINSTANCE** для задания объекта памяти, содержащего шаблон.

Вы можете предоставить процедуру обработчика [**кфхукпрок**](/windows/win32/api/commdlg/nc-commdlg-lpcfhookproc) для диалогового окна **Шрифт** . Процедура-обработчик может обрабатывать сообщения, отправленные в диалоговое окно, и отправлять сообщения в диалоговое окно. При использовании пользовательского шаблона для определения дополнительных элементов управления необходимо предоставить процедуру-обработчик для обработки входных данных для элементов управления.

**Включение процедуры-обработчика для диалогового окна «Шрифт»**

1.  Установите флаг **CF \_ енаблехук** в элементе **flags** структуры [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) .
2.  Укажите адрес процедуры-обработчика в элементе **лпфнхук** .

После обработки сообщения [**WM \_ инитдиалог**](wm-initdialog.md) процедура диалогового окна отправляет сообщение **WM \_ инитдиалог** в процедуру-обработчик. Параметр *lParam* этого сообщения является указателем на структуру [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) , которая используется для инициализации диалогового окна.

Процедура-ловушка может отправить сообщения [**WM \_ CHOOSEFONT \_ жетлогфонт**](wm-choosefont-getlogfont.md), [**WM \_ CHOOSEFONT \_ сетлогфонт**](wm-choosefont-setlogfont.md)и [**WM \_ CHOOSEFONT \_ сетфлагс**](wm-choosefont-setflags.md) в диалоговое окно для получения и задания текущих значений и флагов диалогового окна.

## <a name="customizing-the-font-dialog-box-on-windows-7"></a>Настройка диалогового окна «Шрифт» в Windows 7

На следующем снимке экрана показано диалоговое окно типичного **шрифта** в Windows 7.

![снимок экрана, показывающий поле "диалоб шрифта"](images/fontdialogboxwin7.png)

В более ранних версиях Windows файл шаблона Font. DLG содержит один шаблон ChooseFont по умолчанию. Файл шаблона Font. DLG в Windows 7 содержит два шаблона по умолчанию: шаблон по умолчанию из более ранних версий Windows и новый шаблон Windows 7 ChooseFont. Поэтому при настройке диалогового окна **Шрифт** в Windows 7 необходимо учитывать следующие моменты.

1.  Используйте новый шаблон при создании пользовательских шаблонов для приложений, работающих в Windows 7. Этот новый шаблон содержит элемент управления "ссылка", который пользователь может щелкнуть для открытия окна **панели управления "шрифты** ", как показано на следующем снимке экрана.

    ![снимок экрана, показывающий панель управления шрифтами в Windows 7](images/fontcontrolpanelforwin7.png)

2.  Чтобы использовать этот элемент управления ссылки, вызывающее приложение должно использовать COMCTL32.DLL версии 6 или более поздней. В противном случае функция [**ChooseFont**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) возвращает ошибку при попытке создать элемент управления Link в пользовательском шаблоне. Чтобы определить, включен ли этот элемент управления, скомпилируйте вызывающее приложение с COMCTL32.DLL версии 6,0. Дополнительные сведения см. в разделе [Включение визуальных стилей с помощью стандартных элементов управления](/previous-versions//ms649781(v=vs.85)).
3.  Если приложение использует COMCTL32.DLL версии 5,0 или более ранней, при создании пользовательского шаблона необходимо выполнить следующие действия.

    -   Укажите элемент управления в качестве **кнопки**. Элемент управления, используемый для запуска **панели элементов управления "шрифты** ", отображается как кнопка, а не как ссылка.
    -   Замените приведенный ниже текст на Font. DLG:

        `CONTROL         "<A>Show more fonts</A>", IDC_MANAGE_LINK, "SysLink", WS_TABSTOP, 7, 199, 227, 9`

        со следующим текстом:

        `PUSHBUTTON      "S&how more fonts", IDC_MANAGE_LINK, 7, 199, 74, 14 , WS_TABSTOP`

    -   Чтобы приложение использовало пользовательский шаблон, необходимо указать пользовательский шаблон с флагом **CF \_ енаблетемплате** , создать пользовательский шаблон на основе шаблона ChooseFont Windows 7, а затем при необходимости включить процедуру-обработчик.

        Если включить процедуру-обработчик без создания пользовательского шаблона, будет загружен шаблон ChooseFont по умолчанию для более ранних версий Windows.

> [!Note]  
> Необходимо указать **тип элемента управления** или **кнопки** в новом шаблоне в зависимости от версии COMMCTL.DLL, для которой выполняется компиляция приложения. Также обратите внимание, что специальные функции Windows 7, такие как отображение списков шрифтов и расширенных семейств, недоступны, если приложения работают в более ранних версиях операционной системы Windows.

 

 

 