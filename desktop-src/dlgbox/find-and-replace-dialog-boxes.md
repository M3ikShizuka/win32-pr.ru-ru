---
title: Диалоговые окна поиска и замены
description: Отображает немодальное диалоговое окно, позволяющее пользователю указать строку для поиска, а также параметры, используемые при поиске текста в документе.
ms.assetid: c8c035bf-795d-42a7-abc6-168dea43e6e9
keywords:
- Пользовательский интерфейс Windows, ввод данных пользователем
- Пользовательский интерфейс Windows, Библиотека общих диалоговых окон
- ввод пользователя, Библиотека общих диалоговых окон
- запись вводимых пользователем данных, Библиотека общих диалоговых окон
- Библиотека общих диалоговых окон
- Общие диалоговые окна
- диалоговое окно «Поиск»
- Замена - диалоговое окно
- Настройка диалогового окна «Поиск»
- диалоговое окно "Настройка замены"
- стандартные диалоговые окна
- диалоговые окна, Поиск
- диалоговые окна, замена
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5e3cf2c5217d586c0a5ada74fb7dd72aaca5f804
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104569960"
---
# <a name="find-and-replace-dialog-boxes"></a>Диалоговые окна поиска и замены

Отображает немодальное диалоговое окно, позволяющее пользователю указать строку для поиска, а также параметры, используемые при поиске текста в документе. Диалоговое окно **Замена** позволяет пользователю указать строку для поиска и строку замены, а также параметры для управления операцией.

Вы создаете и отображаете диалоговое окно **поиска** , инициализируя структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) и передавая структуру в функцию [**строки FindText**](/windows/desktop/api/Commdlg/nf-commdlg-findtexta) . На следующем рисунке показано типичное диалоговое окно « **найти** ».

![диалоговое окно «найти»](images/finddialogboxxp.png)

Вы создаете и отображаете диалоговое окно **замены** , инициализируя структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) и передавая структуру в функцию [**реплацетекст**](/windows/desktop/api/Commdlg/nf-commdlg-replacetexta) . На следующем рисунке показано типичное диалоговое окно **замены** .

![диалоговое окно "замена"](images/replacedialogboxxp.png)

В отличие от других общих диалоговых окон, диалоговые окна **найти** и **заменить** являются немодальными. Немодальное диалоговое окно позволяет пользователю переключаться между диалоговым окном и окном, которое его создало. Это полезно для того, чтобы позволить пользователю выполнять поиск строки, перейти в окно приложения для работы со строкой и вернуться в диалоговое окно для поиска другой строки без повторения команды, необходимой для открытия диалогового окна.

Если функция [**строки FindText**](/windows/desktop/api/Commdlg/nf-commdlg-findtexta) или [**реплацетекст**](/windows/desktop/api/Commdlg/nf-commdlg-replacetexta) успешно создает диалоговое окно, она возвращает маркер диалогового окна. Этот обработчик можно использовать для перемещения и взаимодействия с диалоговым окном. Если функция не может создать диалоговое окно, она возвращает **значение NULL**. Причину ошибки можно определить, вызвав функцию [**коммдлжекстендедеррор**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) для получения значения расширенной ошибки.

В этом разделе рассматриваются следующие темы.

-   [Зарегистрированное сообщение ФИНДМСГСТРИНГ](#the-findmsgstring-registered-message)
-   [Настройка диалогового окна «найти или заменить»](#customizing-the-find-or-replace-dialog-box)

## <a name="the-findmsgstring-registered-message"></a>Зарегистрированное сообщение ФИНДМСГСТРИНГ

Перед созданием диалогового окна **найти** или **заменить** необходимо вызвать функцию [**регистервиндовмессаже**](/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea) , чтобы получить идентификатор сообщения для зарегистрированного сообщения [**финдмсгстринг**](findmsgstring.md) . Затем можно использовать идентификатор для обнаружения и обработки сообщений, отправленных из диалогового окна. Когда пользователь нажимает кнопку **Найти далее**, **заменять** или **заменять все** в диалоговом окне, процедура диалогового окна отправляет сообщение **финдмсгстринг** в процедуру Window окна Owner. При создании диалогового окна элемент **хвндовнер** структуры [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) определяет окно владельца.

Параметр *lParam* сообщения [**финдмсгстринг**](findmsgstring.md) является указателем на структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) , которая была указана при создании диалогового окна. Перед отправкой сообщения диалоговое окно устанавливает члены этой структуры с последним вводом пользователя, включая строку для поиска, строку замены (если она есть) и параметры для операции поиска и замены.

В сообщении [**финдмсгстринг**](findmsgstring.md) элемент **flags** структуры [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) включает один из следующих флагов для указания события, вызвавшего сообщение.



| Flag               | Значение                                                                                                                                                                                                     |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **FR \_ диалогтерм** | Диалоговое окно закрывается. После того как окно-владелец обработает это сообщение, маркер диалогового окна становится недействительным.                                                                                    |
| **FR \_ FINDNEXT**   | Пользователь нащелкнул кнопку " **Найти далее** " в диалоговом окне " **найти** или **заменить** ". Член **лпстрфиндвхат** указывает строку для поиска.                                                         |
| **FR \_ заменить**    | Пользователь нащелкнул кнопку **заменить** в диалоговом окне **заменить** . Член **лпстрфиндвхат** указывает строку для замены, а член **лпстрреплацевис** указывает замещающую строку.     |
| **FR \_ REPLACEALL** | Пользователь щелкнул кнопку **заменить все** в диалоговом окне **заменить** . Член **лпстрфиндвхат** указывает строку для замены, а член **лпстрреплацевис** указывает замещающую строку. |



 

Для параметра **найти следующее** или **заменить все** сообщение элемент **flags** может включать любое сочетание следующих флагов для указания параметров поиска.



| Flag              | Значение                                                                                                                                                                                                                                                                                          |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **FR \_ вниз**      | Если задано, кнопка " **вниз** " в переключателях направления выбирается, указывая, что пользователь хочет выполнить поиск от текущего расположения до конца документа. Если значение **fr \_ Down** не задано, то выбирается кнопка **вверх** , чтобы пользователь хотел выполнить поиск в начале документа.       |
| **FR \_ матчкасе** | Если задано значение, флажок **учитывать регистр** устанавливается, указывая, что пользователь хочет, чтобы поиск был чувствительным к регистру. Если значение **fr \_ матчкасе** не задано, флажок не установлен, чтобы поиск можно было учитывать без учета регистра.                                                                       |
| **FR \_ вхолеворд** | Если задано значение, то флажок **только слово целиком** будет установлен, указывая, что пользователь хочет искать только целые слова, соответствующие строке поиска. Если значение **fr \_ вхолеворд** не задано, флажок не выбран, поэтому следует искать фрагменты слов, соответствующие строке поиска. |



 

## <a name="customizing-the-find-or-replace-dialog-box"></a>Настройка диалогового окна «найти или заменить»

Для настройки диалогового окна **найти** или **заменить** можно использовать любой из следующих методов.

-   Укажите значения в структуре [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) при создании диалогового окна
-   Предоставление пользовательского шаблона
-   Предоставление процедуры-обработчика

При создании диалогового окна **найти** или **заменить** можно установить флаги в элементе **flags** структуры [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) , чтобы скрыть или отключить любой элемент управления параметров поиска. Например, можно установить \_ флаг fr номатчкасе, чтобы снять флажок **учитывать регистр** , или установить \_ флаг fr хидематчкасе, чтобы скрыть его.

Можно указать пользовательский шаблон для диалогового окна **найти** или **заменить** , например, если требуется включить дополнительные элементы управления, которые являются уникальными для приложения. Функции [**строки FindText**](/windows/desktop/api/Commdlg/nf-commdlg-findtexta) и [**реплацетекст**](/windows/desktop/api/Commdlg/nf-commdlg-replacetexta) используют пользовательский шаблон вместо шаблона по умолчанию.

**Предоставление пользовательского шаблона для диалогового окна «Поиск» или «замена»**

1.  Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле строки FindText. DLG. Идентификаторы элементов управления, используемые в шаблоне диалогового окна **поиска** или **замены** по умолчанию, определяются в файле длгс. h.
2.  Используйте структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) , чтобы включить шаблон следующим образом:
    -   -   Если пользовательский шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите \_ флаг fr енаблетемплате в элементе **flags** . Используйте элементы **HINSTANCE** и **лптемплатенаме** структуры для задания имени модуля и ресурса.

            -Или-

        -   Если пользовательский шаблон уже находится в памяти, установите \_ флаг fr енаблетемплатехандле. Используйте элемент **HINSTANCE** для задания объекта памяти, содержащего шаблон.

Вы можете предоставить процедуру обработчика [**фрхукпрок**](/windows/win32/api/commdlg/nc-commdlg-lpfrhookproc) для диалогового окна **найти** или **заменить** . Процедура-обработчик может обрабатывать сообщения, отправленные в диалоговое окно. При использовании пользовательского шаблона для определения дополнительных элементов управления необходимо предоставить процедуру-обработчик для обработки входных данных для элементов управления.

**Включение процедуры-обработчика для диалогового окна «найти или заменить»**

1.  Установите флаг FR \_ енаблехук в элементе **flags** структуры [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) .
2.  Укажите адрес процедуры-обработчика в элементе **лпфнхук** .

После обработки сообщения [**WM \_ инитдиалог**](wm-initdialog.md) процедура диалогового окна отправляет сообщение **WM \_ инитдиалог** в процедуру-обработчик. Параметр *lParam* этого сообщения является указателем на структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) , используемую для инициализации диалогового окна.

Если процедура-обработчик возвращает **значение false** в ответ на [**сообщение \_ инитдиалог WM**](wm-initdialog.md) , диалоговое окно не будет отображаться, если оно не отображается в процедуре обработчика. Для этого сначала необходимо выполнить все остальные операции рисования, а затем вызвать функции [**ShowWindow**](/windows/desktop/api/winuser/nf-winuser-showwindow) и [**упдатевиндов**](/windows/desktop/api/winuser/nf-winuser-updatewindow) . Примером является следующий код:


```
// We've returned FALSE in response to WM_INITDIALOG. 
// We've performed any other paint operations. 
// Now we display the dialog box. 
ShowWindow(hDlg, SW_SHOWNORMAL); 
UpdateWindow(hDlg); 
```



 

 