---
title: Диалоговое окно «Параметры страницы»
description: Отображает модальное диалоговое окно, позволяющее пользователю выбирать параметры, включающие тип бумаги, источник бумаги, ориентацию страницы и ширину полей страницы.
ms.assetid: debde0a0-07d4-46ed-a936-e517eab1852d
keywords:
- Windows Пользовательский интерфейс, ввод данных пользователем
- Windows Пользовательский интерфейс, Библиотека общих диалоговых окон
- ввод пользователя, Библиотека общих диалоговых окон
- запись вводимых пользователем данных, Библиотека общих диалоговых окон
- Библиотека общих диалоговых окон
- Общие диалоговые окна
- диалоговое окно «Параметры страницы»
- диалоговое окно «Настройка параметров страницы»
- обработчики, диалоговое окно "Параметры страницы"
- стандартные диалоговые окна
- диалоговые окна, параметры страницы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1af64357be8bd39217c6527dc81f7ac426f5e06e183de92b3bb479f4633c75d8
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119741662"
---
# <a name="page-setup-dialog-box"></a>Диалоговое окно «Параметры страницы»

Отображает модальное диалоговое окно, позволяющее пользователю задать следующие атрибуты печатной страницы:

-   Тип бумаги (конверт, Юридическая информация, буква и т. д.)
-   Источник бумаги (ручной канал, веб-канал с перфорацией, податчик листов и т. д.)
-   Ориентация страницы (книжная или альбомная)
-   Ширина полей страницы

Вы создаете и отображаете диалоговое окно **Параметры страницы** путем инициализации структуры [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) и передачи структуры в функцию [**пажесетупдлг**](/previous-versions/windows/desktop/legacy/ms646937(v=vs.85)) . Однако атрибуты, представленные в диалоговом окне, зависят от возможностей принтера. На следующем рисунке показана типичная диалоговая **Страница Параметры страницы** .

![диалоговое окно «Параметры страницы»](images/pagesetupdialogboxxp.png)

Если пользователь нажмет кнопку **ОК** , [**Пажесетупдлг**](/previous-versions/windows/desktop/legacy/ms646937(v=vs.85)) возвращает **значение true** после настройки различных членов в структуре [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) для указания выбора пользователя. Члены **птпаперсизе** и **ртмаргин** содержат значения, указанные пользователем. Члены **хдевмоде** и **хдевнамес** содержат глобальные дескрипторы памяти для структур [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) и [**DEVNAMES**](/windows/win32/api/commdlg/ns-commdlg-devnames) . Эти структуры содержат дополнительные сведения о странице, а также сведения о принтере. Эти сведения можно использовать для подготовки выходных данных к отправке на выбранный принтер.

Если пользователь отменяет диалоговое окно " **Параметры страницы** " или возникает ошибка, [**Пажесетупдлг**](/previous-versions/windows/desktop/legacy/ms646937(v=vs.85)) возвращает **значение false**. Чтобы определить причину ошибки, вызовите функцию [**коммдлжекстендедеррор**](/windows/desktop/api/Commdlg/nf-commdlg-commdlgextendederror) , чтобы получить расширенное значение ошибки.

В этом разделе рассматриваются следующие темы.

-   [Инициализация диалогового окна «Параметры страницы»](#initializing-the-page-setup-dialog-box)
-   [Настройка диалогового окна «Параметры страницы»](#customizing-the-page-setup-dialog-box)
-   [Настройка образца страницы](#customizing-the-sample-page)

## <a name="initializing-the-page-setup-dialog-box"></a>Инициализация диалогового окна «Параметры страницы»

По умолчанию в диалоговом окне « **Параметры страницы** » отображаются сведения о текущем принтере по умолчанию. Чтобы направить диалоговое окно для вывода сведений о конкретном принтере, установите элементы структуры [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) или [**DEVNAMES**](/windows/win32/api/commdlg/ns-commdlg-devnames) и назначьте глобальные дескрипторы памяти этих структур соответствующему элементу в [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga). Если указать имя принтера, которое не установлено в настоящий момент, в диалоговом окне появится сообщение об ошибке. Чтобы диалоговое окно не отображало сообщения об ошибках, используйте значение **\_ непредупреждения PSD** . Чтобы получить сведения о принтере по умолчанию без отображения диалогового окна « **Параметры страницы** », используйте значение **PSD \_ ретурндефаулт** .

Если системой измерения по умолчанию является дюйм, то в качестве единицы измерения по умолчанию в диалоговом окне используются доли дюйма. Если системой измерения по умолчанию является метрика, то в диалоговом окне в качестве единицы измерения по умолчанию используются сотые миллиметры. Чтобы переопределить единицу измерения по умолчанию, установите **флаг \_ PSD Инхундредссофмиллиметерс** или **PSD \_ инсаусандссофинчес** в элементе **flags** структуры [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) .

Начальные значения для полей по умолчанию — 1 дюйм. Если задать флаг **\_ полей PSD** , то в диалоговом окне будут отображены начальные значения полей, указанные в элементе **ртмаргин** . Минимальный размер полей, допустимый принтером, определяется по умолчанию минимальными значениями, которые пользователь может указать для полей. Если задать флаг **PSD \_ минмаргинс** , то в диалоговом окне будут принудительно установлены минимальные поля, указанные в элементе **ртминмаргин** .

Чтобы запретить пользователям выбирать определенные параметры, установите любое сочетание следующих флагов, чтобы отключить соответствующие элементы управления.



| Флаг                        | Значение                                                                  |
|-----------------------------|--------------------------------------------------------------------------|
| **\_ДИСАБЛЕМАРГИНС PSD**     | Отключает элементы управления "поле ввода", в которых пользователь вводит параметры поля. |
| **\_ДИСАБЛЕОРИЕНТАТИОН PSD** | Отключает переключатели **книжной** и **альбомной** ориентации.               |
| **\_ДИСАБЛЕПАПЕР PSD**       | Отключает элементы управления для выбора размера бумаги и источника бумаги.     |
| **\_ДИСАБЛЕПРИНТЕР PSD**     | Отключает кнопку " **принтер** ".                                         |



 

## <a name="customizing-the-page-setup-dialog-box"></a>Настройка диалогового окна «Параметры страницы»

Можно указать пользовательский шаблон для диалогового окна **Параметры страницы** , например, если требуется включить дополнительные элементы управления, которые являются уникальными для приложения. Функция [**пажесетупдлг**](/previous-versions/windows/desktop/legacy/ms646937(v=vs.85)) использует пользовательский шаблон вместо шаблона по умолчанию.

**Предоставление пользовательского шаблона для диалогового окна «Параметры страницы»**

1.  Создайте пользовательский шаблон, изменив шаблон по умолчанию, указанный в файле Прнсетуп. DLG. Идентификаторы элементов управления, используемые в шаблоне диалогового окна **Параметры страницы** по умолчанию, определены в файле длгс. h.
2.  Используйте структуру [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) , чтобы включить шаблон следующим образом:
    -   -   Если пользовательский шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **PSD \_ енаблепажесетуптемплате** в элементе **flags** . Используйте элементы **HINSTANCE** и **лппажесетуптемплатенаме** структуры для задания имени модуля и ресурса.

            -Или-

        -   Если пользовательский шаблон уже находится в памяти, установите флаг **PSD \_ енаблепажесетуптемплатехандле** . Используйте элемент **хпажесетуптемплате** для задания объекта памяти, содержащего шаблон.

Чтобы отфильтровать сообщения, отправляемые в процедуру диалогового окна, можно предоставить процедуру обработчика [**пажесетуфук**](/windows/win32/api/commdlg/nc-commdlg-lppagesetuphook) . При использовании пользовательского шаблона для определения дополнительных элементов управления необходимо предоставить процедуру обработчика **пажесетуфук** для обработки входных данных для элементов управления. Кроме того, можно предоставить процедуру обработчика [**пажепаинсук**](/windows/win32/api/commdlg/nc-commdlg-lppagepainthook) для настройки содержимого образца страницы, отображаемого в диалоговом окне « **Параметры страницы** ». Дополнительные сведения о процедуре обработчика **пажепаинсук** см. [в разделе Настройка образца страницы](#customizing-the-sample-page).

**Включение процедуры-обработчика Пажесетуфук**

1.  Установите флаг **PSD \_ енаблепажесетуфук** в элементе **flags** структуры [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) .
2.  Укажите адрес процедуры-обработчика в элементе **лпфнпажесетуфук** .

После обработки сообщения [**WM \_ инитдиалог**](wm-initdialog.md) процедура диалогового окна отправляет сообщение **WM \_ Инитдиалог** в процедуру обработчика [**пажесетуфук**](/windows/win32/api/commdlg/nc-commdlg-lppagesetuphook) . Параметр *lParam* этого сообщения является указателем на структуру [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) , используемую для инициализации диалогового окна.

## <a name="customizing-the-sample-page"></a>Настройка образца страницы

Диалоговое окно **Параметры страницы** содержит изображение образца страницы, показывающее, как выбранные пользователем параметры влияют на внешний вид напечатанных данных. Изображение состоит из прямоугольника, представляющего выбранную бумагу или тип конверта, с пунктирным прямоугольником, представляющим текущие поля, и частичными (греческими текстовыми) символами для демонстрации того, как выглядит текст на печатной странице.

При вызове функции [**пажесетупдлг**](/previous-versions/windows/desktop/legacy/ms646937(v=vs.85)) можно предоставить процедуру-обработчик [**пажепаинсук**](/windows/win32/api/commdlg/nc-commdlg-lppagepainthook) для настройки внешнего вида образца страницы.

**Включение процедуры-обработчика Пажепаинсук**

1.  Установите флаг **PSD \_ енаблепажепаинсук** в элементе **flags** структуры [**пажесетупдлг**](/windows/win32/api/commdlg/ns-commdlg-pagesetupdlga) .
2.  Укажите адрес процедуры-обработчика в элементе **лпфнпажепаинсук** .

Каждый раз, когда диалоговое окно собирается вывести содержимое образца страницы, процедура-обработчик получает следующие сообщения в том порядке, в котором они перечислены.



| Сообщение                                                  | Значение                                                                                                                                          |
|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| [**WM \_ PSD \_ пажесетупдлг**](wm-psd-pagesetupdlg.md)     | Диалоговое окно собирается нарисовать образец страницы. Процедура-обработчик может использовать это сообщение для подготовки к отрисовке содержимого образца страницы.     |
| [**WM \_ PSD \_ фуллпажерект**](wm-psd-fullpagerect.md)     | Диалоговое окно собирается нарисовать образец страницы. В этом сообщении указывается ограничивающий прямоугольник образца страницы.                               |
| [**WM \_ PSD \_ минмаргинрект**](wm-psd-minmarginrect.md)   | Диалоговое окно собирается нарисовать образец страницы. Это сообщение указывает прямоугольник поля.                                                    |
| [**WM \_ PSD \_ маргинрект**](wm-psd-marginrect.md)         | Диалоговое окно собирается нарисовать прямоугольник поля.                                                                                            |
| [**WM \_ PSD \_ гриктекстрект**](wm-psd-greektextrect.md)   | Диалоговое окно собирается нарисовать Греческий текст внутри прямоугольника поля.                                                                      |
| [**WM \_ PSD \_ енвстампрект**](wm-psd-envstamprect.md)     | Диалоговое окно собирается нарисоваться в прямоугольнике метки конверта на странице образца конверта. Это сообщение отправляется только для конвертов.             |
| [**WM \_ PSD \_ яфуллпажерект**](wm-psd-yafullpagerect.md) | Откроется диалоговое окно, в котором будет отображаться часть возвращаемого адреса на странице образца конверта. Это сообщение отправляется для конвертов и других размеров бумаги. |



 

Если процедура-обработчик возвращает **значение true** для любого из первых трех сообщений последовательности ([**WM \_ PSD \_ пажесетупдлг**](wm-psd-pagesetupdlg.md), [**WM \_ PSD \_ фуллпажерект**](wm-psd-fullpagerect.md)или [**WM \_ PSD \_ минмаргинрект**](wm-psd-minmarginrect.md)), то диалоговое окно отправляет больше сообщений и не рисует его на странице до следующего момента, когда системе потребуется перерисовать образец страницы. Если процедура-обработчик возвращает **значение false** для всех трех сообщений, то диалоговое окно отправляет оставшиеся сообщения последовательности отображения.

Если процедура-обработчик возвращает **значение true** для любого из оставшихся сообщений в последовательности отображения, диалоговое окно не рисует соответствующую часть образца страницы. Если процедура-обработчик возвращает **значение false** для любого из этих сообщений, диалоговое окно выводит эту часть образца страницы.

Чтобы диалоговое окно не могли рисовать содержимое образца страницы, можно установить флаг **PSD \_ дисаблепажепаинтинг** . Этот флаг не влияет на процедуру-обработчик [**пажепаинсук**](/windows/win32/api/commdlg/nc-commdlg-lppagepainthook) , которая получает все сообщения в **формате \_ WM \_ \* PSD** и может отображать образец содержимого страницы.

 

 