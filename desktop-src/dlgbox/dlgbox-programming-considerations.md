---
title: Рекомендации по программированию диалоговых окон
description: В этом обзоре рассматриваются некоторые вопросы программирования, касающиеся диалоговых окон.
ms.assetid: 49024a0f-ea92-4d56-b063-8e5fcdbd884a
keywords:
- Пользовательский интерфейс Windows, окна
- Пользовательский интерфейс Windows, диалоговые окна
- окна, диалоговые окна
- диалоговые окна, сведения
- процедуры диалоговых окон
- диалоговые окна, процедуры
- Сообщение WM_INITDIALOG
- Сообщение WM_COMMAND
- Сообщение WM_PARENTNOTIFY
- сообщения управления цветом
- диалоговые окна, обработка сообщений
- диалоговые окна, интерфейс клавиатуры
- диалоговые окна, назначенные клавиши
- диалоговые окна, пользовательские
- настраиваемые диалоговые окна
- диалоговые окна, параметры
ms.topic: article
ms.date: 08/25/2020
ms.openlocfilehash: 790abe7c76cdb99f86b2a90a133b15faae721e0e
ms.sourcegitcommit: f7cf41ffc79d1ffead9de2fc61677201f94b423a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "105691678"
---
# <a name="dialog-box-programming-considerations"></a>Рекомендации по программированию диалоговых окон

В этом обзоре рассматриваются некоторые вопросы программирования, касающиеся диалоговых окон.

Обзор включает в себя следующие разделы.

-   [Процедуры диалоговых окон](#dialog-box-procedures)
    -   [\_Сообщение ИНИТДИАЛОГ WM](wm-initdialog.md)
    -   [\_Командное сообщение WM](/windows/desktop/menurc/wm-command)
    -   [\_Сообщение ПАРЕНТНОТИФИ WM](/previous-versions/windows/desktop/inputmsg/wm-parentnotify)
    -   [Сообщения управления цветом](#control-color-messages)
    -   [Диалоговое окно обработки сообщений по умолчанию](#dialog-box-default-message-processing)
-   [Интерфейс клавиатуры диалогового окна](#dialog-box-keyboard-interface)
    -   [Стиль WS \_ TABSTOP](/windows/desktop/winmsg/window-styles)
    -   [\_Стиль группы WS](/windows/desktop/winmsg/window-styles)
    -   [Назначенные клавиши](#mnemonics)
-   [Параметры диалогового окна](#dialog-box-settings)
    -   [Переключатели и флажки](#radio-buttons-and-check-boxes)
    -   [Диалоговое окно "изменить элементы управления"](#dialog-box-edit-controls)
    -   [Списки, поля со списком и списки каталогов](#list-boxes-combo-boxes-and-directory-listings)
    -   [Сообщения управления диалогового окна](#dialog-box-control-messages)
-   [Пользовательские диалоговые окна](#custom-dialog-boxes)

## <a name="dialog-box-procedures"></a>Процедуры диалоговых окон

Процедура диалогового окна аналогична процедуре окна, в которой система отправляет сообщения в процедуру, когда она содержит сведения, которые нужно предоставить или выполнить задачи. В отличие от оконной процедуры, процедура диалогового окна никогда не вызывает функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) . Вместо этого он возвращает **значение true** , если обрабатывает сообщение, или **значение false** в противном случае.

Каждая процедура диалогового окна имеет следующий вид:

```cpp
BOOL CALLBACK DlgProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM lParam) 
{ 
    switch (message) 
    { 
 
        // Place message cases here. 
 
        default: 
            return FALSE; 
    } 
}
```

Параметры процедуры служат той же цели, что и в процедуре окна, при этом параметр *хвнддлг* получает маркер окна диалогового окна.

Большинство процедур диалоговых окон обрабатывают сообщение [**WM \_ инитдиалог**](wm-initdialog.md) и [**\_ Командные сообщения WM**](/windows/desktop/menurc/wm-command) , отправленные элементами управления, но обрабатывают немногие другие сообщения. Если процедура диалогового окна не обрабатывает сообщение, она должна вернуть **значение false** , чтобы система обрабатывала внутренние сообщения. Единственным исключением из этого правила является сообщение **WM \_ инитдиалог** . Процедура диалогового окна должна возвращать **значение true** , чтобы система обрабатывала сообщение **WM \_ инитдиалог** . В любом случае процедура не должна вызывать [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca).

- [\_Сообщение ИНИТДИАЛОГ WM](#the-wm_initdialog-message)
- [\_Командное сообщение WM](#the-wm_command-message)
- [\_Сообщение ПАРЕНТНОТИФИ WM](#the-wm_parentnotify-message)
- [Сообщения управления цветом](#control-color-messages)
- [Диалоговое окно обработки сообщений по умолчанию](#dialog-box-default-message-processing)

### <a name="the-wm_initdialog-message"></a>\_Сообщение ИНИТДИАЛОГ WM

Система не отправляет сообщение о [**\_ создании WM**](/windows/desktop/winmsg/wm-create) в процедуру диалогового окна. Вместо этого он отправляет сообщение [**WM \_ инитдиалог**](wm-initdialog.md) при создании диалогового окна и всех его элементов управления, но перед отображением диалогового окна. Процедура должна выполнить инициализацию, необходимую для того, чтобы в диалоговом окне отображались текущие параметры, связанные с задачей. Например, если диалоговое окно содержит элемент управления для отображения текущего диска и каталога, процедура должна определить текущий диск и каталог и задать это значение для элемента управления.

Процедура может инициализировать элементы управления с помощью таких функций, как [**сетдлгитемтекст**](/windows/desktop/api/Winuser/nf-winuser-setdlgitemtexta) и [**чеккдлгбуттон**](https://msdn.microsoft.com/library/Cc410649(v=MSDN.10).aspx). Так как элементы управления являются окнами, процедура также может управлять ими с помощью функций управления окнами, таких как [**енаблевиндов**](/windows/desktop/api/winuser/nf-winuser-enablewindow) и [**SetFocus**](/windows/desktop/api/winuser/nf-winuser-setfocus). Процедура может получить маркер окна для элемента управления с помощью функции [**жетдлгитем**](/windows/desktop/api/Winuser/nf-winuser-getdlgitem) .

При необходимости процедура диалогового окна может изменить содержимое, состояние и расположение любого элемента управления. Например, в диалоговом окне, содержащем список имен файлов и кнопку **Открыть** , процедура может отключить кнопку **Открыть** , пока пользователь не выберет файл из списка. В этом примере шаблон диалогового окна задает стиль [**WS \_ disabled**](/windows/desktop/winmsg/window-styles) для кнопки **Открыть** , и система автоматически отключает кнопку при ее создании. Когда процедура диалогового окна получает сообщение уведомления из списка, показывающего, что пользователь выбрал файл, процедура вызывает функцию [**енаблевиндов**](/windows/desktop/api/winuser/nf-winuser-enablewindow) для включения кнопки **Открыть** .

Чтобы отобразить пользовательский значок в строке заголовка диалогового окна, обработчик [**WM \_ инитдиалог**](wm-initdialog.md) может отправить сообщение [**WM \_ сетикон**](/windows/desktop/winmsg/wm-seticon) в диалоговое окно.

Если приложение создает диалоговое окно с помощью одной из функций [**диалогбокспарам**](/windows/desktop/api/Winuser/nf-winuser-dialogboxparama), [**диалогбоксиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-dialogboxindirectparama), [**Креатедиалогпарам**](/windows/desktop/api/Winuser/nf-winuser-createdialogparama)или [**креатедиалогиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-createdialogindirectparama), параметр *lParam* для сообщения [**WM \_ INITDIALOG**](wm-initdialog.md) содержит дополнительный параметр, передаваемый функции. Приложения обычно используют этот дополнительный параметр для передачи указателя на дополнительные сведения об инициализации в процедуру диалогового окна, но процедура диалогового окна должна определять значение параметра. Если приложение использует другую функцию для создания диалогового окна, система устанавливает для параметра *lParam* **значение NULL**.

Перед возвратом из сообщения [**WM \_ инитдиалог**](wm-initdialog.md) процедура должна определить, должен ли он установить фокус ввода на указанный элемент управления. Если процедура диалогового окна возвращает **значение true**, система автоматически устанавливает фокус ввода на элемент управления, чей обработчик окна находится в параметре *wParam* . Если элемент управления, получивший фокус по умолчанию, не подходит, он может установить фокус на соответствующий элемент управления с помощью функции [**SetFocus**](/windows/desktop/api/winuser/nf-winuser-setfocus) . Если процедура устанавливает фокус ввода, она должна возвращать **значение false** , чтобы система не настраивает фокус по умолчанию. Элементом управления, получающим фокус ввода по умолчанию, всегда является первый элемент управления, указанный в шаблоне, который является видимым, не отключен и имеет стиль [WS \_ TABSTOP](/windows/desktop/winmsg/window-styles) . Если такой элемент управления не существует, система устанавливает фокус ввода по умолчанию на первый элемент управления в шаблоне.

### <a name="the-wm_command-message"></a>\_Командное сообщение WM

Элемент управления может отправить [**\_ командное сообщение WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна, когда пользователь выполняет действие в элементе управления. Эти сообщения, называемые сообщениями уведомления, сообщают о процедуре ввода данных пользователем и позволяют им выполнять соответствующие ответы.

Все стандартные элементы управления, за исключением статических элементов управления, отправляют сообщения уведомлений для выбранных действий пользователя. Например, при нажатии кнопки с помощью кнопки отправки отправляется млрд долл уведомление о [**\_ нажатии**](../controls/bn-clicked.md) на кнопку. Во всех случаях в слове с низким приоритетом параметра *wParam* содержится идентификатор элемента управления, а в верхнем порядке слово *wParam* — код уведомления, а параметр *lParam* содержит управляющий маркер окна.

Процедура диалогового окна должна отслеживать и обрабатывать сообщения уведомления. В частности, процедура должна обрабатывать сообщения с идентификаторами ИДОК или ИДКАНЦЕЛ; Эти сообщения представляют запрос пользователем, который закрывает диалоговое окно. Процедура должна закрыть диалоговое окно с помощью функции [**EndDialog**](/windows/desktop/api/Winuser/nf-winuser-enddialog) для модальных диалоговых окон и функции [**дестройвиндов**](/windows/desktop/api/winuser/nf-winuser-destroywindow) для немодальных диалоговых окон.

Система также отправляет [**\_ Командные сообщения WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна, если в диалоговом окне есть меню, например меню **окно** , и пользователь щелкает пункт меню. В частности, система отправляет **\_ командное сообщение WM** с параметром *wParam* , установленным в **идканцел** каждый раз, когда пользователь нажимает кнопку « **Закрыть** » в меню окна диалогового окна. Сообщение практически идентично сообщению уведомления, отправленному кнопкой **Отмена** , и должно обрабатываться точно таким же образом.

### <a name="the-wm_parentnotify-message"></a>\_Сообщение ПАРЕНТНОТИФИ WM

Элемент управления отправляет сообщение [**WM \_ парентнотифи**](/previous-versions/windows/desktop/inputmsg/wm-parentnotify) всякий раз, когда пользователь нажимает кнопку мыши и указывает на элемент управления. Некоторые приложения преобразуют это сообщение как сигнал для выполнения действия, связанного с элементом управления, например для отображения строки текста, описывающей назначение элемента управления.

Система также отправляет сообщения [**WM \_ парентнотифи**](/previous-versions/windows/desktop/inputmsg/wm-parentnotify) при создании и уничтожении окна, но не для элементов управления, созданных из шаблона диалогового окна. Система предотвращает эти сообщения, указывая стиль **WS \_ ex \_ нопарентнотифи** при создании элементов управления. Приложение не может переопределить это поведение по умолчанию, если оно не создает собственные элементы управления для диалогового окна.

### <a name="control-color-messages"></a>Сообщения Control-Color

Элементы управления и система могут отсылать сообщения управления цветом, когда они хотят, чтобы процедура диалогового окна закрашивания фон элемента управления или другого окна с помощью определенной кисти и цветов. Это может быть полезно, когда приложения переопределяют цвета по умолчанию, используемые в диалоговых окнах и их элементах управления. Ниже приведены сообщения управления цветом, которые заменили сообщение **WM \_ ктлколор** .

-   [**WM \_ ктлколорбтн**](../controls/wm-ctlcolorbtn.md)
-   [**WM \_ ктлколордлг**](wm-ctlcolordlg.md)
-   [**WM \_ ктлколоредит**](../controls/wm-ctlcoloredit.md)
-   [**WM \_ ктлколорлистбокс**](../controls/wm-ctlcolorlistbox.md)
-   [**WM \_ ктлколорскроллбар**](../controls/wm-ctlcolorscrollbar.md)
-   [**WM \_ ктлколорстатик**](../controls/wm-ctlcolorstatic.md)

Элемент управления отправляет сообщение с цветом элемента управления в процедуру диалогового окна непосредственно перед тем, как оно рисует собственный фон. Сообщение позволяет процедуре указать, какую кисть использовать, а также задать цвета фона и переднего плана. Процедура задает кисть, возвращая маркер кисти. Чтобы задать цвета фона и переднего плана, процедура использует функции [**сетбкколор**](/windows/desktop/api/wingdi/nf-wingdi-setbkcolor) и [**сеттекстколор**](/windows/desktop/api/wingdi/nf-wingdi-settextcolor) с контекстом устройства просмотра элемента управления. Сообщение Control-Color передает маркер контексту дисплея устройства в процедуру в параметре *wParam* сообщения.

Система отправляет сообщение [**WM \_ ктлколордлг**](wm-ctlcolordlg.md) в процедуру диалогового окна, если процедура не обрабатывает сообщение [**WM \_ ерасебкгнд**](/windows/desktop/winmsg/wm-erasebkgnd) . В стандартном классе диалогового окна отсутствует кисть фона класса, поэтому это сообщение позволяет процедуре определять собственный фон без необходимости включения кода для выполнения работы.

В любом случае, если процедура диалогового окна не обрабатывает сообщение цвета элемента управления, система использует кисть с цветом окна по умолчанию, чтобы закрасить фон для всех элементов управления и окон, за исключением полос прокрутки. Приложение может получить цвет окна по умолчанию, передав значение **\_ окна цвета** в функцию [**жетсисколор**](/windows/desktop/api/winuser/nf-winuser-getsyscolor) . Во время рисования фона цвет переднего плана для контекста отображаемого устройства задается как цвет текста по умолчанию (**цветовая \_ WINDOWTEXT**). Для полос прокрутки система использует кисть, имеющую цвет полосы прокрутки по умолчанию (**цветовая \_** шкала). В этом случае цвета фона и переднего плана для контекста отображаемого устройства устанавливаются в белый и черный соответственно.

### <a name="dialog-box-default-message-processing"></a>Диалоговое окно обработки сообщений по умолчанию

Процедура окна для предопределенного класса диалогового окна выполняет обработку по умолчанию для всех сообщений, которые не обрабатывает процедура диалогового окна. Когда процедура диалогового окна возвращает **false** для любого сообщения, предопределенная процедура окна проверяет сообщения и выполняет следующие действия по умолчанию:



| Сообщение                                            | Действие по умолчанию                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**\_ЖЕТДЕФИД DM**](dm-getdefid.md)                | Это сообщение можно отправить в диалоговое окно. Диалоговое окно возвращает идентификатор элемента управления кнопки по умолчанию, если диалоговое окно имеет такое значение. в противном случае возвращается ноль.                                                                                                                                                                                                                                                                                                                      |
| [**\_изменение расположения DM**](dm-reposition.md)            | Это сообщение можно отправить в диалоговое окно верхнего уровня. Диалоговое окно перемещается, чтобы оно поместилось в область рабочего стола.                                                                                                                                                                                                                                                                                                                                                                       |
| [**\_СЕТДЕФИД DM**](dm-setdefid.md)                | Это сообщение можно отправить в диалоговое окно. Диалоговое окно задает для кнопки принудительной отправки по умолчанию элемент управления, заданный идентификатором элемента управления в параметре *wParam* .                                                                                                                                                                                                                                                                                                                             |
| [**\_Активация WM**](/windows/desktop/inputdev/wm-activate)           | Восстанавливает фокус ввода на элементе управления, определяемом ранее сохраненным обработчиком, если диалоговое окно активировано. В противном случае процедура сохраняет маркер элемента управления, имеющего фокус ввода.                                                                                                                                                                                                                                                                                               |
| [**WM \_ чартоитем**](../controls/wm-chartoitem.md)         | Возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [**\_Закрыть WM**](/windows/desktop/winmsg/wm-close)                   | Отправляет в диалоговое окно сообщение с уведомлением о [**\_ нажатии млрд долл**](../controls/bn-clicked.md) , указывая **идканцел** в качестве идентификатора элемента управления. Если диалоговое окно содержит идентификатор элемента управления ИДКАНЦЕЛ и элемент управления в данный момент отключен, процедура выдает предупреждение и не заносит сообщение.                                                                                                                                                                                              |
| [**WM \_ компареитем**](../controls/wm-compareitem.md)       | Возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [**WM \_ ерасебкгнд**](/windows/desktop/winmsg/wm-erasebkgnd)         | Заполняет клиентскую область диалогового окна, используя либо кисть, возвращенную из сообщения [**WM \_ ктлколордлг**](wm-ctlcolordlg.md) , либо цвет окна по умолчанию.                                                                                                                                                                                                                                                                                                                                 |
| [**WM, \_ Шрифт**](/windows/desktop/winmsg/wm-getfont)               | Возвращает маркер для определяемого приложением шрифта диалогового окна.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [**WM \_ инитдиалог**](wm-initdialog.md)            | Возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown)     | Отправляет сообщение [**\_ шовдропдовн CB**](../controls/cb-showdropdown.md) в поле со списком, имеющее фокус ввода, направляя элемент управления скрывать его раскрывающийся список. Процедура вызывает [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для завершения действия по умолчанию.                                                                                                                                                                                                                                      |
| [**WM \_ нкдестрой**](/windows/desktop/winmsg/wm-ncdestroy)           | Освобождает глобальную память, выделенную для элементов управления для редактирования в диалоговом окне (применяется к диалоговым окнам, в которых указан стиль [**\_ локаледит DS**](dialog-box-styles.md) ), и освобождает все определенные приложением шрифты (применяется в диалоговых окнах, в которых задан стиль [**DS \_ сетфонт**](dialog-box-styles.md) или [**DS \_ шеллфонт**](dialog-box-styles.md) ). Процедура вызывает функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для завершения действия по умолчанию. |
| [**WM \_ нклбуттондовн**](/windows/desktop/inputdev/wm-nclbuttondown) | Отправляет сообщение [**\_ шовдропдовн CB**](../controls/cb-showdropdown.md) в поле со списком, имеющее фокус ввода, направляя элемент управления скрывать его раскрывающийся список. Процедура вызывает [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для завершения действия по умолчанию.                                                                                                                                                                                                                                      |
| [**WM \_ некстдлгктл**](wm-nextdlgctl.md)            | Устанавливает фокус ввода на следующий или предыдущий элемент управления в диалоговом окне, на элемент управления, определенный маркером в параметре *wParam* , или на первый элемент управления в диалоговом окне, который является видимым, не отключен и имеет стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) . Процедура пропускает это сообщение, если текущее окно с фокусом ввода не является элементом управления.                                                                                                                  |
| [**WM \_ SETFOCUS**](/windows/desktop/inputdev/wm-setfocus)           | Устанавливает фокус ввода на элемент управления, определяемый ранее сохраненным маркером окна управления. Если такого обработчика не существует, процедура задает фокус ввода первому элементу управления в шаблоне диалогового окна, который является видимым, не отключенным и имеет стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) . Если такой элемент управления не существует, процедура устанавливает фокус ввода на первый элемент управления в шаблоне.                                                                                          |
| [**WM \_ SHOWWINDOW**](/windows/desktop/winmsg/wm-showwindow)         | Сохраняет маркер элемента управления, имеющего фокус ввода, если диалоговое окно скрыто, а затем вызывает [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для завершения действия по умолчанию.                                                                                                                                                                                                                                                                                                                     |
| [**WM \_ сискомманд**](/windows/desktop/menurc/wm-syscommand)         | Сохраняет маркер элемента управления, имеющего фокус ввода, если диалоговое окно свернется, а затем вызывает [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для завершения действия по умолчанию.                                                                                                                                                                                                                                                                                                                  |
| [**WM \_ вкэйтоитем**](../controls/wm-vkeytoitem.md)         | Возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Предопределенная процедура окна передает все остальные сообщения в [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для обработки по умолчанию.

## <a name="dialog-box-keyboard-interface"></a>Интерфейс клавиатуры диалогового окна

Система предоставляет специальный интерфейс клавиатуры для диалоговых окон, который выполняет специальную обработку нескольких ключей. Интерфейс создает сообщения, соответствующие определенным кнопкам в диалоговом окне, или изменяет фокус ввода с одного элемента управления на другой. Ниже приведены ключи, используемые в этом интерфейсе, и соответствующие им действия.


| Клавиши            | Действие                                                                                                                                                                    |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ALT +*мнемоника* | Перемещает фокус ввода на первый элемент управления (имеющий стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) ) после статического элемента управления, содержащего заданную назначенную клавишу.        |
| СБОЙ           | Перемещает фокус ввода к следующему элементу управления в группе.                                                                                                                   |
| ВВОД          | Отправляет [**\_ командное сообщение WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна. Параметр *wParam* имеет значение идок или идентификатор элемента управления для кнопки отправки по умолчанию. |
| ESC            | Отправляет [**\_ командное сообщение WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна. Параметр *wParam* имеет значение идканцел.                                              |
| LEFT           | Перемещает фокус ввода к предыдущему элементу управления в группе.                                                                                                               |
| *ассемблер*     | Перемещает фокус ввода на первый элемент управления (имеющий стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) ) после статического элемента управления, содержащего заданную назначенную клавишу.        |
| RIGHT          | Перемещает фокус ввода к следующему элементу управления в группе.                                                                                                                   |
| SHIFT + TAB      | Перемещает фокус ввода на предыдущий элемент управления, имеющий стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) .                                                                |
| TAB            | Перемещает фокус ввода на следующий элемент управления, имеющий стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) .                                                                    |
| UP             | Перемещает фокус ввода к предыдущему элементу управления в группе.                                                                                                               |

Система автоматически предоставляет интерфейс клавиатуры для всех модальных диалоговых окон. Он не предоставляет интерфейс для немодальных диалоговых окон, если только приложение не вызывает функцию [**исдиалогмессаже**](/windows/desktop/api/Winuser/nf-winuser-isdialogmessagea) для фильтрации сообщений в основном цикле обработки сообщений. Это означает, что приложение должно передать сообщение в **исдиалогмессаже** сразу после получения сообщения из очереди сообщений. Функция обрабатывает сообщения, если это диалоговое окно, и возвращает ненулевое значение, указывающее, что сообщение было обработано и не должно передаваться в функцию [**TranslateMessage**](/windows/desktop/api/winuser/nf-winuser-translatemessage) или [**DispatchMessage**](/windows/desktop/api/winuser/nf-winuser-dispatchmessage) .

Так как интерфейс клавиатуры диалогового окна использует клавиши направления для перемещения между элементами управления в диалоговом окне, приложение не может использовать эти ключи для прокрутки содержимого любого модального диалогового окна или любого немодального диалогового окна, для которого вызывается [**исдиалогмессаже**](/windows/desktop/api/Winuser/nf-winuser-isdialogmessagea) . Если в диалоговом окне есть полосы прокрутки, приложение должно предоставить альтернативный интерфейс клавиатуры для полос прокрутки. Обратите внимание, что интерфейс мыши для прокрутки доступен, когда система включает мышь.

### <a name="the-ws_tabstop-style"></a>Стиль WS \_ TABSTOP

Стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) определяет элементы управления, в которые пользователь может перемещаться с помощью клавиши TAB или клавиш SHIFT + TAB.

Когда пользователь нажимает клавишу TAB или SHIFT + TAB, система сначала определяет, обрабатываются ли эти ключи элементом управления, на котором в данный момент находится фокус ввода. Он отправляет элемент управления как сообщение [**WM \_ жетдлгкоде**](wm-getdlgcode.md) , и если элемент управления возвращает длгк \_ ванттаб, система передает ключи элементу управления. В противном случае система использует функцию [**жетнекстдлгтабитем**](/windows/desktop/api/Winuser/nf-winuser-getnextdlgtabitem) для нахождение следующего элемента управления, который является видимым, не отключен и имеет стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) . Поиск начинается с элемента управления, на котором в данный момент находится фокус ввода, и продолжается в том порядке, в котором они были созданы, — то есть в порядке, в котором они определены в шаблоне диалогового окна. Когда система находит элемент управления, имеющий необходимые характеристики, система перемещает фокус ввода на него.

Если поиск следующего элемента управления с стилем [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) встречает окно с стилем WS **\_ ex \_ контролпарент** , система рекурсивно выполняет поиск дочерних элементов окна.

Приложение также может использовать [**жетнекстдлгтабитем**](/windows/desktop/api/Winuser/nf-winuser-getnextdlgtabitem) для нахождение элементов управления, имеющих стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) . Функция получает маркер окна следующего или предыдущего элемента управления со стилем **WS \_ TABSTOP** без перемещения фокуса ввода.

### <a name="the-ws_group-style"></a>\_Стиль группы WS

По умолчанию система перемещает фокус ввода к следующему или предыдущему элементу управления каждый раз, когда пользователь нажимает клавишу направления. Пока текущий элемент управления с фокусом ввода не обрабатывает эти ключи, а следующий или предыдущий элемент управления не является статическим, система по-прежнему перемещает фокус ввода с помощью всех элементов управления в диалоговом окне, так как пользователь по-прежнему нажимает клавиши направления.

Приложение может использовать стиль [**\_ группы WS**](/windows/desktop/winmsg/window-styles) для изменения этого поведения по умолчанию. Стиль отмечает начало группы элементов управления. Если элемент управления в группе имеет фокус ввода, когда пользователь начинает вводить клавиши направления, фокус остается в группе. Как правило, первый элемент управления в группе должен иметь стиль **\_ группы WS** , а все остальные элементы управления в группе не должны иметь этого стиля. Все элементы управления в группе должны быть непрерывными, то есть они должны быть созданы последовательно без промежуточных элементов управления.

Когда пользователь нажимает клавишу направления, система сначала определяет, обрабатывает ли текущий элемент управления фокус ввода клавишами направления. Система отправляет сообщение [**WM \_ жетдлгкоде**](wm-getdlgcode.md) элементу управления, и, если элемент управления возвращает значение **длгк \_ вантарровс** , передает ключ элементу управления. В противном случае система использует функцию [**жетнекстдлгграупитем**](/windows/desktop/api/Winuser/nf-winuser-getnextdlggroupitem) для определения следующего элемента управления в группе.

[**Жетнекстдлгграупитем**](/windows/desktop/api/Winuser/nf-winuser-getnextdlggroupitem) выполняет поиск элементов управления в порядке (или в обратную последовательность), в котором они были созданы. Если пользователь нажимает клавишу со стрелкой вправо или вниз, **жетнекстдлгграупитем** возвращает следующий элемент управления, если у этого элемента управления нет стиля [**\_ группы WS**](/windows/desktop/winmsg/window-styles) . В противном случае функция изменяет порядок поиска и возвращает первый элемент управления, имеющий стиль **\_ группы WS** . Если пользователь нажимает клавишу LEFT или UP, функция возвращает предыдущий элемент управления, если у текущего элемента управления нет стиля **\_ группы WS** . Если текущий элемент управления имеет этот стиль, функция меняет порядок поиска, находит первый элемент управления, имеющий стиль **\_ группы WS** , и возвращает элемент управления, непосредственно предшествующий найденному элементу управления.

Если поиск следующего элемента управления в группе встречает окно с стилем **WS \_ ex \_ контролпарент** , система рекурсивно выполняет поиск дочерних элементов окна.

После того как система получит следующий или предыдущий элемент управления, она отправляет элементу управления сообщение [**WM \_ жетдлгкоде**](wm-getdlgcode.md) для определения типа элемента управления. Затем система перемещает фокус ввода на элемент управления, если он не является статическим элементом управления. Если элемент управления является автоматическим переключателем, система отправляет сообщение [**BM \_ Click**](../controls/bm-click.md) . Приложение также может использовать [**жетнекстдлгграупитем**](/windows/desktop/api/Winuser/nf-winuser-getnextdlggroupitem) для нахождение элементов управления в группе.

Как правило, первый элемент управления в группе объединяет стили [**WS \_**](/windows/desktop/winmsg/window-styles) и [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) , чтобы пользователь мог перемещаться из группы в группу с помощью клавиши TAB. Если группа содержит переключатели, приложение должно применить стиль **WS \_ TABSTOP** только к первому элементу управления в группе. Система автоматически перемещает стиль при перемещении пользователя между элементами управления в группе. Это гарантирует, что фокус ввода всегда будет находиться в последнем выбранном элементе управления, когда пользователь переместится в группу с помощью клавиши TAB.

### <a name="mnemonics"></a>Назначенные клавиши

Назначенная клавиша — это выбранная буква или цифра в метке кнопки или в тексте статического элемента управления. Система перемещает фокус ввода на элемент управления, связанный с назначенным символом, каждый раз, когда пользователь либо нажимает клавишу, соответствующую назначенной клавише, либо нажимает этот ключ и сочетание клавиш ALT. Назначенные клавиши дают возможность быстро перейти к указанному элементу управления с помощью клавиатуры.

Приложение создает назначенную клавишу для элемента управления, вставляя амперсанд (&) непосредственно перед выбранной буквой или цифрой в метке или тексте для элемента управления. В большинстве случаев строка, заканчивающаяся нулевым символом элемента управления в шаблоне диалогового окна, содержит амперсанд. Однако приложение может создать назначенный символ в любое время, заменив существующую метку или текст элемента управления с помощью функции [**сетдлгитемтекст**](/windows/desktop/api/Winuser/nf-winuser-setdlgitemtexta) . Для каждого элемента управления можно указать только один мнемонический символ. Хотя рекомендуется, нажатия клавиш в диалоговом окне не обязательно должны быть уникальными.

Когда пользователь нажимает клавишу с буквой или цифрой, система сначала определяет, обрабатывается ли ключ текущим элементом управления, имеющим фокус ввода. Система отправляет в элемент управления сообщение [**WM \_ жетдлгкоде**](wm-getdlgcode.md) , а если элемент управления возвращает значение **длгк \_ ванталлкэйс** или **DLG \_ вантмессаже** , система передает ключ элементу управления. В противном случае он выполняет поиск элемента управления, мнемоника которого совпадает с указанной буквой или цифрой. Он продолжит поиск, пока не найдет элемент управления или проверит все элементы управления. Во время поиска он пропускает все статические элементы управления с стилем [**\_ префикса SS**](../controls/static-control-styles.md) .

Если поиск элемента управления с совпадающим назначенным клавишей встречает окно с стилем **WS \_ ex \_ контролпарент** , система рекурсивно выполняет поиск дочерних элементов окна.

Если система находит статический элемент управления и элемент управления не отключен, система перемещает фокус ввода на первый элемент управления после того, как статический элемент управления является видимым, не отключен и имеет стиль [**WS \_ TABSTOP**](/windows/desktop/winmsg/window-styles) . Если система находит другой элемент управления с соответствующим назначенным символом, он перемещает фокус ввода на этот элемент управления. Если элемент управления является кнопкой по умолчанию, система отправляет в диалоговое окно процедуру, [**млрд долл \_ Нажатие**](../controls/bn-clicked.md) на сообщение уведомления. Если элемент управления является другим стилем кнопки и в диалоговом окне нет другого элемента управления, имеющего одинаковые назначенные клавиши, система отправляет элементу управления сообщение [**BM \_ Click**](../controls/bm-click.md) .

## <a name="dialog-box-settings"></a>Параметры диалогового окна

Параметры диалогового окна — это текущие настройки и значения для элементов управления в диалоговом окне. Процедура диалогового окна отвечает за инициализацию элементов управления этими параметрами при создании диалогового окна. Он также отвечает за извлечение текущих параметров из элементов управления перед уничтожением диалогового окна. Методы, используемые для инициализации и получения параметров, зависят от типа элемента управления.

Дополнительные сведения см. в следующих разделах:

-   [Переключатели и флажки](#radio-buttons-and-check-boxes)
-   [Диалоговое окно "изменить элементы управления"](#dialog-box-edit-controls)
-   [Списки, поля со списком и списки каталогов](#list-boxes-combo-boxes-and-directory-listings)
-   [Сообщения управления диалогового окна](#dialog-box-control-messages)

### <a name="radio-buttons-and-check-boxes"></a>Переключатели и флажки

В диалоговых окнах используются переключатели и флажки, позволяющие пользователю выбирать из списка параметров. Переключатели позволяют пользователю выбирать взаимоисключающие параметры. флажки позволяют пользователю выбрать сочетание параметров.

Процедура диалогового окна может установить начальное состояние флажка с помощью функции [**чеккдлгбуттон**](https://msdn.microsoft.com/library/Cc410649(v=MSDN.10).aspx) , которая устанавливает или снимает флажок. Для переключателей в группе взаимоисключающих переключателей процедура диалогового окна может использовать функцию [**чеккрадиобуттон**](https://msdn.microsoft.com/library/Cc410654(v=MSDN.10).aspx) для установки соответствующего переключателя и автоматического сброса любого другого переключателя.

Перед завершением диалогового окна процедура диалогового окна может проверить состояние каждого переключателя и установить флажок с помощью функции [**исдлгбуттончеккед**](https://msdn.microsoft.com/library/Cc364806(v=MSDN.10).aspx) , которая возвращает текущее состояние кнопки. Обычно диалоговое окно сохраняет эти сведения для инициализации кнопок при следующем создании диалогового окна.

### <a name="dialog-box-edit-controls"></a>Диалоговое окно "изменить элементы управления"

Многие диалоговые окна имеют элементы управления редактирования, которые позволяют пользователю вводить текст в качестве входных данных. Большинство процедур диалоговых окон инициализируют элемент управления "поле ввода" при первом запуске диалогового окна. Например, процедура диалогового окна может поместить в элемент управления предложенное имя файла, которое пользователь может выбрать, изменить или заменить. Процедура диалогового окна может задать текст в элементе управления "поле ввода" с помощью функции [**сетдлгитемтекст**](/windows/desktop/api/Winuser/nf-winuser-setdlgitemtexta) , которая копирует текст из указанного буфера в элемент управления "поле ввода". Когда элемент управления Edit получает фокус ввода, он автоматически выбирает полный текст для редактирования.

Поскольку элементы управления "поле ввода" не возвращают текст в диалоговое окно, процедура диалогового окна должна получить текст перед завершением. Он может получить текст с помощью функции [**жетдлгитемтекст**](/windows/desktop/api/Winuser/nf-winuser-getdlgitemtexta) , которая копирует текст элемента управления "поле ввода" в буфер. Процедура диалогового окна обычно сохраняет этот текст для последующей инициализации элемента управления "поле ввода" или передает его в родительское окно для обработки.

В некоторых диалоговых окнах используются элементы управления редактированием, позволяющие пользователю вводить числа. Процедура диалогового окна может получить число из элемента управления "поле ввода" с помощью функции [**жетдлгитеминт**](/windows/desktop/api/Winuser/nf-winuser-getdlgitemint) , которая извлекает текст из элемента управления "поле ввода" и преобразует текст в десятичное значение. Пользователь вводит число в десятичных цифрах. Он может быть либо знаком, либо без знака. Процедура диалогового окна может отображать целое число с помощью функции [**сетдлгитеминт**](/windows/desktop/api/Winuser/nf-winuser-setdlgitemint) . **Сетдлгитеминт** Преобразует целое число со знаком или без знака в строку десятичных цифр.

### <a name="list-boxes-combo-boxes-and-directory-listings"></a>Списки, поля со списком и списки каталогов

В некоторых диалоговых окнах отображаются списки имен, из которых пользователь может выбрать одно или несколько имен. Для вывода списка имен файлов, например, в диалоговом окне обычно используется окно со списком и функции [**длгдирлист**](https://msdn.microsoft.com/library/Cc410788(v=MSDN.10).aspx) и [**длгдирселектекс**](https://msdn.microsoft.com/library/Cc410769(v=MSDN.10).aspx) . Функция **длгдирлист** автоматически заполняет список именами файлов в текущем каталоге. Функция **длгдирселект** извлекает выбранное имя файла из списка. Вместе эти две функции предоставляют удобный способ для отображения списка каталогов, чтобы пользователь мог выбрать файл без ввода его имени и расположения.

Диалоговое окно также может использовать поле со списком для вывода списка имен файлов. Функция [**длгдирлисткомбобокс**](https://msdn.microsoft.com/library/Cc410798(v=MSDN.10).aspx) автоматически заполняет список в поле со списком именами файлов в текущем каталоге. Функция [**длгдирселекткомбобоксекс**](https://msdn.microsoft.com/library/Cc410768(v=MSDN.10).aspx) извлекает выбранное имя файла из списка.

### <a name="dialog-box-control-messages"></a>Сообщения управления диалогового окна

Многие элементы управления распознают стандартные сообщения, которые при получении элементами управления приводят к тому, что они выполняют некоторые действия. Например, сообщение [**BM \_ сетчекк**](../controls/bm-setcheck.md) устанавливает флажок в окошке, а сообщение [**EM \_ жетсел**](../controls/em-getsel.md) извлекает часть текста элемента управления, которая в данный момент выбрана. Управляющие сообщения предоставляют процедуре диалогового окна больший и гибкий доступ к элементам управления, чем стандартные функции, поэтому они часто используются, когда диалоговое окно требует сложных взаимодействий с пользователем.

Процедура диалогового окна может отправить сообщение в элемент управления, предоставив идентификатор элемента управления и используя функцию [**сенддлгитеммессаже**](/windows/desktop/api/Winuser/nf-winuser-senddlgitemmessagea) , которая идентична функции [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) , за исключением того, что она использует идентификатор элемента управления вместо обработчика окна для идентификации элемента управления, получающего сообщение. Для указанного сообщения может потребоваться, чтобы процедура диалогового окна отправляла параметры с сообщением, а сообщение может иметь соответствующие возвращаемые значения. Операция и требования каждого управляющего сообщения зависят от назначения сообщения и элемента управления, который его обрабатывает.

Дополнительные сведения об управляющих сообщениях см. в разделе [элементы управления Windows](../controls/window-controls.md).

## <a name="custom-dialog-boxes"></a>Пользовательские диалоговые окна

Приложение может создавать пользовательские диалоговые окна с помощью определяемого приложением класса окна для диалоговых окон вместо использования стандартного класса диалогового окна. Приложения обычно используют этот метод, когда диалоговое окно является основным окном, но оно также полезно для создания модальных и немодальных диалоговых окон для приложений, имеющих стандартные перекрывающиеся окна.

Определяемый приложением класс позволяет приложению определить процедуру окна для диалогового окна и обработать сообщения перед их отправкой в процедуру диалогового окна. Он также позволяет приложению определить значок класса, кисть фона класса и меню класса для этого диалогового окна. Приложение должно зарегистрировать класс окна перед попыткой создания диалогового окна и предоставить шаблон диалогового окна с помощью значения Atom или имени класса окна.

Многие приложения создают новый класс диалогового окна, сначала получая сведения о классе для предопределенного класса диалогового окна и передавая его в функцию [**жетклассинфо**](/windows/desktop/api/winuser/nf-winuser-getclassinfoa) , которая заполняет структуру [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) данными. Приложение изменяет отдельные члены структуры, такие как имя класса, кисть и значок, затем регистрирует новый класс с помощью функции [**registerClass**](/windows/desktop/api/winuser/nf-winuser-registerclassa) . Если приложение заполняет структуру **вндкласс** самостоятельно, оно должно установить для элемента **кбвндекстра** значение **длгвиндовекстра**, которое представляет собой количество дополнительных байтов, необходимых системе для каждого диалогового окна. Если приложение также использует дополнительные байты для каждого диалогового окна, они должны превышать дополнительные байты, необходимые системе.

Процедура окна для пользовательского диалогового окна имеет те же параметры и требования, что и любая другая процедура окна. В отличие от других оконных процедур, процедура окна для этого диалогового окна должна вызывать функцию [**дефдлгпрок**](/windows/desktop/api/Winuser/nf-winuser-defdlgprocw) вместо функции [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для любых сообщений, которые она не обрабатывает. **Дефдлгпрок** выполняет ту же обработку сообщений по умолчанию, что и процедура окна для предопределенного диалогового окна, в том числе вызов процедуры диалогового окна.

Приложение может также создавать пользовательские диалоговые окна, подклассировать процедуру окна предопределенного диалогового окна. Функция [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) позволяет приложению указать процедуру окна для указанного окна. Приложение также может попытаться создать подкласс с помощью функции [**сеткласслонг**](/windows/desktop/api/winuser/nf-winuser-setclasslonga) , но это повлияет на все диалоговые окна в системе, а не только на те, которые принадлежат приложению.

Приложения, которые создают настраиваемые диалоговые окна, иногда предоставляют альтернативный интерфейс клавиатуры для диалоговых окон. Для немодальных диалоговых окон это может означать, что приложение не вызывает функцию [**исдиалогмессаже**](/windows/desktop/api/Winuser/nf-winuser-isdialogmessagea) и обрабатывает все вводы с клавиатуры в пользовательской процедуре окна. В таких случаях приложение может использовать сообщение [**WM \_ некстдлгктл**](wm-nextdlgctl.md) для сворачивания кода, необходимого для перемещения фокуса ввода с одного элемента управления на другой. Это сообщение, передаваемое в [**дефдлгпрок**](/windows/desktop/api/Winuser/nf-winuser-defdlgprocw), перемещает фокус ввода на указанный элемент управления и обновляет внешний вид элементов управления, таких как перемещение границы кнопки по умолчанию или установка автоматических переключателей.
