---
title: диалоговые окна «О программе»
description: В этом разделе рассматривается использование диалоговых окон для создания пользовательских интерфейсов для приложений.
ms.assetid: 51960c28-a178-4ad3-b45e-426fec42a945
keywords:
- диалоговые окна, сведения
- диалоговые окна, когда следует использовать
- модальные диалоговые окна
- безрежимные диалоговые окна
- диалоговые окна, модальные
- диалоговые окна, немодальные
- диалоговые окна, шаблоны
- диалоговые окна, окна владельца
- диалоговые окна, окна сообщений
- процедуры диалоговых окон
- окна сообщений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45dd78713c3b87e54e8a992ea9415577c522fc9e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070384"
---
# <a name="about-dialog-boxes"></a>диалоговые окна «О программе»

Существует множество функций, сообщений и стандартных элементов управления для создания диалоговых окон и управления ими, что упрощает разработку пользовательского интерфейса для приложения. В этом обзоре описываются функции и сообщения диалоговых окон, а также объясняется, как использовать их для создания и использования диалоговых окон.

Этот обзор включает в себя следующие разделы:

-   [Когда следует использовать диалоговое окно](#when-to-use-a-dialog-box)
-   [Окно "владелец" диалогового окна](#dialog-box-owner-window)
-   [Окна сообщений](#message-boxes)
-   [Модальные диалоговые окна](#modal-dialog-boxes)
-   [Немодальные диалоговые окна](#modeless-dialog-boxes)
-   [Шаблоны диалоговых окон](#dialog-box-templates)
    -   [Стили шаблонов диалоговых окон](#dialog-box-template-styles)
    -   [Измерения диалоговых окон](#dialog-box-measurements)
    -   [Элементы управления диалогового окна](#dialog-box-controls)
    -   [Меню окна диалогового окна](#dialog-box-window-menu)
    -   [Шрифты диалогового окна](#dialog-box-fonts)
    -   [Шаблоны в памяти](#templates-in-memory)

Дополнительные сведения об общих диалоговых окнах см. в разделе [Библиотека общих диалоговых](common-dialog-box-library.md)окон.

## <a name="when-to-use-a-dialog-box"></a>Когда следует использовать диалоговое окно

Большинство приложений используют диалоговые окна для запроса дополнительных сведений для пунктов меню, требующих ввода данных пользователем. Использование диалогового окна — это единственный рекомендуемый способ извлечения входных данных для приложения. Например, типичный элемент меню **открытия** требует, чтобы имя файла открывалось, поэтому приложение должно использовать диалоговое окно для запроса имени пользователя. В таких случаях приложение создает диалоговое окно, когда пользователь щелкает элемент меню и удаляет диалоговое окно сразу после того, как пользователь поставляет информацию.

Многие приложения также используют диалоговые окна для вывода сведений или параметров, пока пользователь работает в другом окне. Например, приложения для обработки текстов часто используют диалоговое окно с параметром поиска текста. Пока приложение выполняет поиск текста, диалоговое окно остается на экране. Пользователь может вернуться в диалоговое окно и повторить поиск того же слова. или пользователь может изменить запись в диалоговом окне и выполнить поиск нового слова. Приложения, которые используют диалоговые окна таким образом, обычно создаются, когда пользователь щелкает пункт меню и продолжает отображать его до тех пор, пока выполняется приложение или пользователь явно не закрывает диалоговое окно.

Чтобы обеспечить поддержку различных способов использования диалоговых окон приложениями, существует два типа диалоговых окон: модальные и немодальные. *Модальное диалоговое окно* требует, чтобы пользователь предоставил сведения или отменил диалоговое окно, прежде чем разрешить продолжение работы приложения. Приложения используют модальные диалоговые окна вместе с элементами меню, требующими дополнительных сведений, прежде чем они смогут продолжить работу. *Немодальное диалоговое окно* позволяет пользователю предоставить сведения и вернуться к предыдущей задаче, не закрывая диалоговое окно. Модальные диалоговые окна проще в управлении, чем немодальные диалоговые окна, поскольку они создаются, выполняют их задачи и уничтожаются путем вызова одной функции.

Чтобы создать модальное или немодальное диалоговое окно, приложение должно предоставить шаблон диалогового окна для описания стиля и содержимого диалогового окна. Приложение также должно предоставить процедуру диалогового окна для выполнения задач. *Шаблон диалогового* окна представляет собой двоичное описание диалогового окна и содержащихся в нем элементов управления. Разработчик может создать этот шаблон как ресурс, загружаемый из исполняемого файла приложения, или создать его в памяти во время выполнения приложения. *Процедура диалогового окна* — это функция обратного вызова, определяемая приложением, которую система вызывает, когда в ней есть входные данные для диалогового окна или задач для выполнения этого диалогового окна. Хотя процедура диалогового окна аналогична процедуре окна, она не имеет тех же обязанностей.

Обычно приложение создает диалоговое окно с помощью функции [**диалогбокс**](/windows/desktop/api/Winuser/nf-winuser-dialogboxa) или [**креатедиалог**](/windows/desktop/api/Winuser/nf-winuser-createdialoga) . **Диалогбокс** создает модальное диалоговое окно; **Креатедиалог** создает немодальное диалоговое окно. Эти две функции загружают шаблон диалогового окна из исполняемого файла приложения и создают всплывающее окно, соответствующее спецификациям шаблона. Существуют и другие функции, которые создают диалоговое окно с помощью шаблонов в памяти. они передают дополнительные сведения процедуре диалогового окна при создании диалогового окна.

Обычно диалоговые окна относятся к стандартному, эксклюзивному классу окна. Система использует этот класс окна и соответствующую процедуру окна для модальных и немодальных диалоговых окон. При вызове функции она создает окно для диалогового окна, а также окна для элементов управления в диалоговом окне, а затем отправляет выбранные сообщения в процедуру диалогового окна. Когда диалоговое окно является видимым, предопределенная процедура окна управляет всеми сообщениями, обрабатывая некоторые сообщения и передавая другие в процедуру диалогового окна, чтобы процедура могла выполнять задачи. Приложения не имеют прямого доступа к предопределенному классу окна или процедуре окна, но они могут использовать шаблон диалогового окна и процедуру диалогового окна для изменения стиля и поведения диалогового окна.

## <a name="dialog-box-owner-window"></a>Окно "владелец" диалогового окна

Большинство диалоговых окон имеют окно-владелец (или более просто, владелец). При создании диалогового окна приложение задает владельца, указывая его маркер в окне. Система использует владельца для определения расположения диалогового окна в Z-порядке, чтобы диалоговое окно всегда расположиться над его владельцем. Кроме того, система может отправлять сообщения в процедуру окна владельца, уведомляя его о событиях в диалоговом окне.

Система автоматически скрывает или уничтожает диалоговое окно при каждом скрытии или удалении его владельца. Это означает, что процедура диалогового окна не требует специальной обработки для обнаружения изменений в состоянии окна "владелец".

Так как типичное диалоговое окно используется вместе с пунктом меню, окно-владелец обычно является окном, содержащим меню. Хотя можно создать диалоговое окно, не имеющее владельца, не рекомендуется. Например, когда модальное диалоговое окно не имеет владельца, система не отключает ни одного из других окон приложения и позволяет пользователю продолжать работу в других окнах, не отменяя назначение модального диалогового окна.

Когда немодальное диалоговое окно не имеет владельца, система не скрывает и не уничтожает диалоговое окно, когда другие окна в приложении скрыты или уничтожены. Хотя это не нарушает назначение немодального диалогового окна, оно требует, чтобы приложение выполняло специальную обработку, чтобы убедиться, что диалоговое окно скрыто и удалено в нужное время.

## <a name="message-boxes"></a>Окна сообщений

Окно сообщения — это специальное диалоговое окно, которое приложение может использовать для вывода сообщений и запроса простого ввода. Обычно окно сообщения содержит текстовое сообщение и одну или несколько кнопок. Приложение создает окно сообщения с помощью функции [**MessageBox**](/windows/desktop/api/Winuser/nf-winuser-messagebox) или [**мессажебоксекс**](/windows/desktop/api/Winuser/nf-winuser-messageboxexa) , указывая текст, а также число и типы отображаемых кнопок. Обратите внимание, что в настоящее время нет различий между работой **MessageBox** и **мессажебоксекс** .

Хотя окно сообщения является диалоговым, система получает полный контроль над созданием и управлением окна сообщения. Это означает, что приложение не предоставляет шаблон диалогового окна и процедуру диалогового окна. Система создает собственный шаблон на основе текста и кнопок, указанных для окна сообщения, и предоставляет собственную процедуру диалогового окна.

Окно сообщения является модальным диалоговым окном, и система создает его с помощью тех же внутренних функций, которые [**диалогбокс**](/windows/desktop/api/Winuser/nf-winuser-dialogboxa) использует. Если приложение задает окно владельца при вызове [**MessageBox**](/windows/desktop/api/Winuser/nf-winuser-messagebox) или [**мессажебоксекс**](/windows/desktop/api/Winuser/nf-winuser-messageboxexa), система отключает владельца. Приложение может также направлять систему для отключения всех окон верхнего уровня, принадлежащих текущему потоку, указывая значение **MB \_ таскмодал** во время создания диалогового окна.

Система может передавать сообщения владельцу, таким как [**WM \_ Канцелмоде**](/windows/desktop/winmsg/wm-cancelmode) и [**WM \_ Enable**](/windows/desktop/winmsg/wm-enable), точно так же, как при создании модального диалогового окна. Окно владельца должно выполнять все действия, запрошенные этими сообщениями.

## <a name="modal-dialog-boxes"></a>Модальные диалоговые окна

Модальным диалоговым окном должно быть всплывающее окно с меню окна, строкой заголовка и толстой границей; Это значит, что в шаблоне диалогового окна должны указываться **\_ всплывающие окна WS**, **WS \_ Сисмену**, **WS \_ Caption** и **DS \_ модалфраме** . Несмотря на то, что приложение может **обозначать \_ видимый стиль WS** , система всегда отображает модальное диалоговое окно, независимо от того, указывает ли шаблон диалогового окна стиль **\_ видимый WS** . Приложение не должно создавать модальное диалоговое окно, имеющее стиль **\_ дочернего элемента WS** . Модальное диалоговое окно с этим стилем отключает себя, предотвращая дальнейшие входы в приложение.

Приложение создает модальное диалоговое окно с помощью функции [**диалогбокс**](/windows/desktop/api/Winuser/nf-winuser-dialogboxa) или [**диалогбоксиндирект**](/windows/desktop/api/Winuser/nf-winuser-dialogboxindirecta) . **Диалогбокс** требует имя или идентификатор ресурса, содержащего шаблон диалогового окна; **Диалогбоксиндирект** требует наличия обработчика для объекта памяти, содержащего шаблон диалогового окна. Функции [**диалогбокспарам**](/windows/desktop/api/Winuser/nf-winuser-dialogboxparama) и [**диалогбоксиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-dialogboxindirectparama) также создают модальные диалоговые окна; они идентичны описанным выше функциям, но передают указанный параметр в процедуру диалогового окна при создании диалогового окна.

При создании модального диалогового окна система делает ее активным окном. Диалоговое окно остается активным до тех пор, пока процедура диалогового окна не вызовет функцию [**EndDialog**](/windows/desktop/api/Winuser/nf-winuser-enddialog) или система не активирует окно в другом приложении. Ни пользователь, ни приложение не могут сделать окно владельца активным, пока не будет уничтожено модальное диалоговое окно.

Если окно "владелец" еще не отключено, система автоматически отключает окно и все дочерние окна, принадлежащие ему, при создании модального диалогового окна. Окно владельца остается неактивным до тех пор, пока не будет удалено диалоговое окно. Несмотря на то, что процедура диалогового окна потенциально может включить окно владельца в любое время, при включении владельца не рекомендуется использовать модальное диалоговое окно. При удалении процедуры диалогового окна система снова включает окно «владелец», но только в том случае, если в модальном диалоговом окне был отключен владелец.

По мере того как система создает модальное диалоговое окно, оно отправляет сообщение [**WM \_ канцелмоде**](/windows/desktop/winmsg/wm-cancelmode) в окно (при наличии), в текущий момент записывающее ввод мыши. Приложение, получающее это сообщение, должно освободить захват мыши, чтобы пользователь мог переместить указатель мыши в модальном диалоговом окне. Так как система отключает окно «владелец», все входные данные мыши теряются, если владелец не может отпустить указатель мыши при получении этого сообщения.

Чтобы обрабатывать сообщения для модального диалогового окна, система запускает собственный цикл обработки сообщений, позволяя временно управлять очередью сообщений для всего приложения. Когда система получает сообщение, неявное для этого диалогового окна, оно передает сообщение в соответствующее окно. Если получает сообщение [**\_ Quit WM**](/windows/desktop/winmsg/wm-quit) , оно отправляет сообщение обратно в очередь сообщений приложения, чтобы главный цикл обработки сообщений приложения мог в конечном итоге получить сообщение.

Система отправляет сообщение [**WM \_ ентеридле**](wm-enteridle.md) окну-владельцу, когда очередь сообщений приложения пуста. Приложение может использовать это сообщение для выполнения фоновой задачи, когда диалоговое окно остается на экране. Когда приложение использует сообщение таким образом, приложение должно часто возвращать управление (например, с помощью функции [**PeekMessage**](/windows/desktop/api/winuser/nf-winuser-peekmessagea) ), чтобы модальное диалоговое окно могла получать любые входные данные пользователя. Чтобы предотвратить отправку модальным диалоговым окном сообщений **\_ ентеридле WM** , приложение может указать \_ стиль ноидлемсг DS при создании диалогового окна.

Приложение уничтожает модальное диалоговое окно с помощью функции [**EndDialog**](/windows/desktop/api/Winuser/nf-winuser-enddialog) . В большинстве случаев процедура диалогового окна вызывает метод **EndDialog** , когда пользователь нажимает кнопку « **Закрыть** » в меню окна диалогового окна или нажимает кнопку **ОК** или **Отмена** в диалоговом окне. Это диалоговое окно может возвращать значение с помощью функции [**диалогбокс**](/windows/desktop/api/Winuser/nf-winuser-dialogboxa) (или других функций создания) путем указания значения при вызове функции **EndDialog** . Система возвращает это значение после уничтожения диалогового окна. Большинство приложений используют это возвращаемое значение, чтобы определить, успешно ли завершено выполнение задачи в диалоговом окне или отменено пользователем. Система не возвращает управление из функции, которая создает диалоговое окно, пока процедура диалогового окна не вызовет функцию **EndDialog** .

## <a name="modeless-dialog-boxes"></a>Немодальные диалоговые окна

Немодальное диалоговое окно должно быть всплывающим окном с меню окна, строкой заголовка и тонкой границей. Это значит, что в шаблоне диалогового окна должно быть указано **\_ всплывающее окно WS**, **\_ заголовок WS**, **\_ границы WS** и стили **WS \_ сисмену** . Система не отображает диалоговое окно автоматически, если в шаблоне не указан стиль « **WS \_ Visible** ».

Приложение создает немодальное диалоговое окно с помощью функции [**креатедиалог**](/windows/desktop/api/Winuser/nf-winuser-createdialoga) или [**креатедиалогиндирект**](/windows/desktop/api/Winuser/nf-winuser-createdialogindirecta) . **Креатедиалог** требует имя или идентификатор ресурса, содержащего шаблон диалогового окна; **Креатедиалогиндирект** требует наличия обработчика для объекта памяти, содержащего шаблон диалогового окна. Две другие функции, [**креатедиалогпарам**](/windows/desktop/api/Winuser/nf-winuser-createdialogparama) и [**креатедиалогиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-createdialogindirectparama), также создают немодальные диалоговые окна; При создании диалогового окна они передают указанный параметр в процедуру диалогового окна.

[**Креатедиалог**](/windows/desktop/api/Winuser/nf-winuser-createdialoga) и другие функции создания возвращают описатель окна в диалоговое окно. Приложение и процедура диалогового окна могут использовать этот обработчик для управления диалоговым окном. Например, если в шаблоне диалогового окна не указано значение **WS \_ Visible** , приложение может отобразить это диалоговое окно, передав обработчику окна функцию [**ShowWindow**](/windows/desktop/api/winuser/nf-winuser-showwindow) .

Немодальное диалоговое окно не отключает окно владельца и не отправляет ему сообщения. При создании диалогового окна система делает его активным, но пользователь или приложение может изменить активное окно в любое время. Если диалоговое окно становится неактивным, оно остается над окном "владелец" в Z-порядке, даже если окно "владелец" активно.

Приложение отвечает за извлечение и отправку входных сообщений в диалоговом окне. Большинство приложений используют основной цикл обработки сообщений для этого. Однако, чтобы позволить пользователю перемещаться на элементы управления и выбирать их с помощью клавиатуры, приложение должно вызвать функцию [**исдиалогмессаже**](/windows/desktop/api/Winuser/nf-winuser-isdialogmessagea) . Дополнительные сведения об этой функции см. в разделе [интерфейс клавиатуры диалогового окна](dlgbox-programming-considerations.md).

Немодальное диалоговое окно не может возвращать значение приложению в виде модального диалогового окна, но процедура диалогового окна может отправить сведения в окно владельца с помощью функции [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) .

Приложение должно уничтожить все немодальные диалоговые окна перед завершением работы. Он может уничтожить немодальное диалоговое окно с помощью функции [**дестройвиндов**](/windows/desktop/api/winuser/nf-winuser-destroywindow) . В большинстве случаев процедура диалогового окна вызывает **дестройвиндов** в ответ на ввод пользователя, например нажатие кнопки **Отмена** . Если пользователь никогда не закрывает диалоговое окно таким образом, приложение должно вызвать **дестройвиндов**.

[**Дестройвиндов**](/windows/desktop/api/winuser/nf-winuser-destroywindow) делает недействительным обработчик окна для диалогового окна, поэтому все последующие вызовы функций, использующих этот маркер, возвращают значения ошибки. Во избежание ошибок процедура диалогового окна должна уведомлять владельца о том, что диалоговое окно было удалено. Многие приложения поддерживают глобальную переменную, содержащую маркер диалогового окна. Когда процедура диалогового окна уничтожает диалоговое окно, она также устанавливает глобальную переменную в **значение NULL**, указывая на то, что диалоговое окно больше не является допустимым.

Для уничтожения немодального диалогового окна процедура диалогового окна не должна вызывать функцию [**EndDialog**](/windows/desktop/api/Winuser/nf-winuser-enddialog) .

## <a name="dialog-box-templates"></a>Шаблоны диалоговых окон

Шаблон диалогового окна — это двоичные данные, описывающие диалоговое окно, определяющие его высоту, ширину, стиль и элементы управления, которые он содержит. Чтобы создать диалоговое окно, система либо загружает шаблон диалогового окна из ресурсов в исполняемом файле приложения, либо использует шаблон, переданный в глобальную память приложением. В любом случае приложение должно предоставить шаблон при создании диалогового окна.

Разработчик создает шаблонные ресурсы с помощью компилятора ресурсов или редактора диалоговых окон. Компилятор ресурсов преобразует текстовое описание в двоичный ресурс, а редактор диалоговых окон сохраняет диалоговое окно, созданное в интерактивном режиме, в виде двоичного ресурса.

> [!Note]  
> Описание создания шаблонов ресурсов и их добавления в исполняемый файл приложения выходит за рамки этого обзора. Дополнительные сведения о создании шаблонов ресурсов и их добавлении в исполняемый файл см. в документации, поставляемой со средствами разработки приложений.

 

Чтобы создать диалоговое окно без использования ресурсов шаблона, необходимо создать шаблон в памяти и передать его в функцию [**креатедиалогиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-createdialogindirectparama) или [**диалогбоксиндиректпарам**](/windows/desktop/api/Winuser/nf-winuser-dialogboxindirectparama) либо в макрос [**креатедиалогиндирект**](/windows/desktop/api/Winuser/nf-winuser-createdialogindirecta) или [**диалогбоксиндирект**](/windows/desktop/api/Winuser/nf-winuser-dialogboxindirecta) .

Шаблон диалогового окна в памяти состоит из заголовка, который описывает диалоговое окно, за которым следуют один или несколько дополнительных блоков данных, описывающих каждый из элементов управления в диалоговом окне. Шаблон может использовать либо стандартный формат, либо расширенный формат. В стандартном шаблоне заголовок представляет собой [**длгтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgtemplate) структуру, за которой следуют дополнительные массивы переменной длины. и данные для каждого элемента управления состоят из структуры [**длгитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgitemtemplate) , за которой следуют дополнительные массивы переменной длины. В расширенном шаблоне диалогового окна в заголовке используется формат [**длгтемплатикс**](dlgtemplateex.md) , а в определениях элементов управления используется формат [**длгитемтемплатикс**](dlgitemtemplateex.md) .

Шаблон памяти можно создать, выделив глобальный объект памяти и заполнив его стандартными или расширенными определениями заголовков и элементов управления. Шаблон памяти одинаков в форме и содержимом для ресурса шаблона. Многие приложения, использующие шаблоны памяти, сначала используют функцию [**лоадресаурце**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadresource) для загрузки ресурса шаблона в память, а затем изменяют загруженный ресурс для создания нового шаблона памяти. Дополнительные сведения о создании шаблона диалогового окна в памяти см. в разделе [шаблоны в памяти](#templates-in-memory).

В следующих разделах описываются стили, измерения и другие значения, используемые в шаблоне диалогового окна.

-   [Стили шаблонов диалоговых окон](#dialog-box-template-styles)
-   [Измерения диалоговых окон](#dialog-box-measurements)
-   [Элементы управления диалогового окна](#dialog-box-controls)
-   [Меню окна диалогового окна](#dialog-box-window-menu)
-   [Шрифты диалогового окна](#dialog-box-fonts)
-   [Шаблоны в памяти](#templates-in-memory)

### <a name="dialog-box-template-styles"></a>Стили шаблонов диалоговых окон

Каждый шаблон диалогового окна задает сочетание значений стиля, определяющих внешний вид и возможности диалогового окна. Значения стиля могут быть стилями окна, такими как **\_ "всплывающее окно" и "** WS **\_ сисмену**", а также стилями диалоговых окон, такими как **DS \_ модалфраме**. Количество и тип стилей для шаблона зависит от типа и назначения диалогового окна. Список значений см. в разделе [**стили диалоговых окон**](dialog-box-styles.md).

Система передает все стили окна, указанные в шаблоне, в функцию [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) при создании диалогового окна. Система может передать один или несколько расширенных стилей в зависимости от указанных стилей диалогового окна. Например, если шаблон указывает **DS \_ модалфраме**, система использует **WS \_ ex \_ длгмодалфраме** при создании диалогового окна.

Большинство диалоговых окон — всплывающие окна, в которых есть меню окон и строка заголовка. Таким образом, типичный шаблон задает **Стили \_ всплывающих окон**, **WS \_ сисмену** и **WS \_** . Шаблон также задает стиль границы: **WS \_ border** для немодальных диалоговых окон и **DS \_ модалфраме** для модальных диалоговых окон. Шаблон может указывать тип окна, отличный от всплывающего, (например, **WS \_ OVERLAPPED**), если вместо диалогового окна создается настроенное окно.

Система всегда отображает модальное диалоговое окно независимо от того, был ли указан стиль « **WS \_ Visible** ». Если в шаблоне для немодального диалогового окна указан стиль " **WS \_ Visible** ", система автоматически отображает диалоговое окно при его создании. В противном случае приложение отвечает за отображение диалогового окна с помощью функции [**ShowWindow**](/windows/desktop/api/winuser/nf-winuser-showwindow) .

### <a name="dialog-box-measurements"></a>Измерения диалоговых окон

Каждый шаблон диалогового окна содержит измерения, определяющие расположение, ширину и высоту диалогового окна и содержащихся в нем элементов управления. Эти измерения не зависят от устройства, поэтому приложение может использовать один шаблон для создания одного и того же диалогового окна для всех типов устройств вывода. Это гарантирует, что в диалоговом окне будут одинаковые пропорции и внешний вид на всех экранах, несмотря на различия в разрешениях и пропорции экранов.

Измерения в шаблоне диалогового окна указываются в единицах шаблонов диалогового окна. Чтобы преобразовать измерения из шаблона диалогового окна в единицы экрана (в пикселях), используйте функцию [**мапдиалогрект**](/windows/desktop/api/Winuser/nf-winuser-mapdialogrect) , которая учитывает шрифт, используемый в диалоговом окне, и правильно Преобразует прямоугольник из элементов шаблона диалогового окна в пиксели. Для диалоговых окон, использующих системный шрифт, можно использовать функцию [**жетдиалогбасеунитс**](/windows/desktop/api/Winuser/nf-winuser-getdialogbaseunits) для самостоятельного выполнения вычислений по конвертации, хотя использование **мапдиалогрект** проще.

Шаблон должен указывать начальные координаты левого верхнего угла диалогового окна. Обычно координаты задаются относительно левого верхнего угла клиентской области окна владельца. Если в шаблоне указан \_ стиль АБСАЛИГН DS или в диалоговом окне нет владельца, то это расположение отсчитывается относительно левого верхнего угла экрана. Система устанавливает эту начальную точку при создании диалогового окна, но позволяет приложению настраивать расположение перед отображением диалогового окна. Например, приложение может извлекать размеры окна "владелец", вычислять новую положение, которое выравнивает это диалоговое окно в окне "владелец", а затем задавать положение с помощью функции [**SetWindowPos**](/windows/desktop/api/winuser/nf-winuser-setwindowpos) .

Шаблон должен задавать ширину и высоту диалогового окна, не превышающие ширину и высоту экрана, и гарантирует, что все элементы управления находятся в клиентской области диалогового окна. Несмотря на то, что система допускает использование диалогового окна любого размера, его создание слишком мало или слишком велико, может помешать пользователю предоставить входные данные, что нарушает назначение диалогового окна. Многие приложения используют более одного диалогового окна при наличии большого количества элементов управления. В таких случаях исходное диалоговое окно обычно содержит одну или несколько кнопок, которые пользователь может выбрать для открытия следующего диалогового окна.

### <a name="dialog-box-controls"></a>Элементы управления диалогового окна

Шаблон задает расположение, ширину, высоту, стиль, идентификатор и класс окна для каждого элемента управления в диалоговом окне. Система создает каждый элемент управления, передавая эти данные функции [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) . Элементы управления создаются в том порядке, в котором они указаны в шаблоне. Шаблон должен указывать соответствующее число, тип и порядок элементов управления, чтобы пользователь мог ввести входные данные, необходимые для выполнения задачи, связанной с диалоговым окном.

Для каждого элемента управления шаблон определяет значения стилей, которые определяют внешний вид и операции элемента управления. Каждый элемент управления является дочерним окном и поэтому должен иметь стиль **\_ дочернего элемента WS** . Чтобы обеспечить видимость элемента управления при отображении диалогового окна, каждый элемент управления должен иметь стиль « **WS \_ Visible** ». Другие часто используемые стили окон — это **WS- \_ границы** для элементов управления, которые имеют необязательные границы, **WS \_ отключены** для элементов управления, которые должны быть отключены при первоначальном создании диалогового окна, и **\_ группу** **WS \_ TABSTOP** и WS для элементов управления, доступ к которым можно получить с помощью клавиатуры. Стили **\_ группы** **WS \_ TABSTOP** и WS используются совместно с диалоговым интерфейсом клавиатуры, описанным далее в этом разделе.

Шаблон также может указывать стили элементов управления, характерные для класса окна элемента управления. Например, шаблон, указывающий элемент управления "Кнопка", должен иметь стиль элемента управления " **кнопка \_ ", например** **"Кнопка" или \_ "** BS". Система передает стили элемента управления в процедуру окна управления через сообщение [**\_ создания WM**](/windows/desktop/winmsg/wm-create) , позволяя процедуре адаптировать внешний вид и операции элемента управления.

Система преобразует координаты положения и измерения ширины и высоты из базовых единиц диалогового окна в Пиксели перед их передачей в [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa). Когда система создает элемент управления, она указывает диалоговое окно в качестве родительского окна. Это означает, что система всегда интерпретирует координаты положения элемента управления как клиентские координаты относительно верхнего левого угла клиентской области диалогового окна.

Шаблон задает класс окна для каждого элемента управления. Типичное диалоговое окно содержит элементы управления, принадлежащие предопределенным классам окон элементов управления, например классы кнопок и окон редактирования. В этом случае шаблон задает классы окон, предоставляя соответствующие стандартные значения Atom для классов. Если диалоговое окно содержит элемент управления, принадлежащий классу окна пользовательского элемента управления, шаблон выдает имя зарегистрированного класса окна или значение Atom, которое в настоящее время связано с именем.

Каждый элемент управления в диалоговом окне должен иметь уникальный идентификатор, чтобы отличать его от других элементов управления. Управляет отправкой данных в процедуру диалогового окна с помощью [**\_ командных сообщений WM**](/windows/desktop/menurc/wm-command) , поэтому идентификаторы элементов управления являются обязательными для процедуры определения того, какой элемент управления отправил указанное сообщение. Единственным исключением из этого правила являются идентификаторы элементов управления для статических элементов управления. Статические элементы управления не нуждаются в уникальных идентификаторах, так как они не отправляют сообщения **\_ командной строки WM** .

Чтобы разрешить пользователю закрыть диалоговое окно, шаблон должен указать по крайней мере одну кнопку отправки и присвоить ей идентификатор элемента управления **идканцел**. Чтобы позволить пользователю выбирать между завершением или отменой задачи, связанной с диалоговым окном, шаблон должен указать две кнопки Push-уведомлений с метками " **ОК** **" и "Отмена"** с идентификаторами элементов управления **идок** и **идканцел** соответственно.

В шаблоне также указывается необязательный текст и данные для создания элемента управления. Текст обычно содержит метки для элементов управления "Кнопка" или определяет начальное содержимое статического текстового элемента управления. Данные для создания представляют собой один или несколько байт данных, которые система передает в процедуру окна управления при создании элемента управления. Данные для создания удобны для элементов управления, которым требуются дополнительные сведения о начальном содержимом или стиле, чем указано другими данными. Например, приложение может использовать данные создания для установки начального значения и диапазона для элемента управления полосы прокрутки.

### <a name="dialog-box-window-menu"></a>Меню окна диалогового окна

Система открывает диалоговое окно меню окна, когда шаблон задает стиль **WS \_ сисмену** . Чтобы предотвратить недопустимые входные данные, система автоматически отключает все элементы в меню, за исключением **перемещения** и **закрытия**. Пользователь может нажать кнопку " **переместить** ", чтобы переместить диалоговое окно. Когда пользователь нажимает кнопку " **Закрыть**", система [**отправляет \_ командное сообщение WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна с параметром *wParam* , установленным в **идканцел**. Это идентично сообщению, отправленному кнопкой **Отмена** , когда пользователь щелкнет его. Рекомендуемое действие для этого сообщения — закрыть диалоговое окно и отменить запрошенную задачу.

Хотя другие меню в диалоговых окнах не рекомендуются, шаблон диалогового окна может указать меню, указав идентификатор или имя ресурса меню. В этом случае система загружает ресурс и создает меню для этого диалогового окна. Приложения обычно используют идентификаторы меню или имена в шаблонах при использовании шаблонов для создания пользовательских окон, а не диалоговых окон.

### <a name="dialog-box-fonts"></a>Шрифты диалогового окна

Система использует среднюю ширину символов в диалоговом окне шрифта для вычисления позиции и размеров диалогового окна. По умолчанию система рисует весь текст в диалоговом окне, используя шрифт **системного \_ шрифта** .

Чтобы указать шрифт для диалогового окна, отличного от значения по умолчанию, необходимо создать диалоговое окно с помощью шаблона диалогового окна. В ресурсе шаблона используйте [инструкцию Font](../menurc/font-statement.md). В шаблоне диалогового окна задайте **домен DS \_ Сетфонт** или **DS \_ шеллфонт** и укажите размер точки и имя гарнитуры. Даже если шаблон диалогового окна задает шрифт таким образом, система всегда использует системный шрифт для меню «заголовок диалогового окна» и «диалоговое окно».

Когда диалоговое окно имеет стиль **DS \_ Сетфонт** или **DS \_ Шеллфонт** , система отправляет сообщение [**WM \_ сетфонт**](/windows/desktop/winmsg/wm-setfont) в процедуру диалогового окна и каждый элемент управления при создании элемента управления. Процедура диалогового окна отвечает за сохранение маркера шрифта, передаваемого с сообщением **WM \_ сетфонт** , и выбор маркера в контексте устройства при каждой записи текста в окно. По умолчанию это делается для стандартных элементов управления.

Системный шрифт может различаться в разных версиях Windows. Чтобы приложение использовало системный шрифт независимо от того, на какой системе он работает, используйте **DS \_ шеллфонт** с гарнитурой MS Shell Dlg и используйте [ресурс диаложекс](../menurc/dialogex-resource.md) вместо [ресурса диалогового окна](../menurc/dialog-resource.md). Система сопоставляет эту гарнитуру, чтобы в диалоговом окне использовался шрифт Tahoma. Обратите внимание, что служба **DS \_ шеллфонт** не действует, если гарнитура не является MS Shell Dlg.

### <a name="templates-in-memory"></a>Шаблоны в памяти

Шаблон диалогового окна в памяти состоит из заголовка, который описывает диалоговое окно, за которым следуют один или несколько дополнительных блоков данных, описывающих каждый из элементов управления в диалоговом окне. Шаблон может использовать либо стандартный формат, либо расширенный формат. В стандартном шаблоне заголовок представляет собой [**длгтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgtemplate) структуру, за которой следуют дополнительные массивы переменной длины. Данные для каждого элемента управления состоят из структуры [**длгитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgitemtemplate) , за которой следуют дополнительные массивы переменной длины. В расширенном шаблоне диалогового окна в заголовке используется формат [**длгтемплатикс**](dlgtemplateex.md) , а в определениях элементов управления используется формат [**длгитемтемплатикс**](dlgitemtemplateex.md) .

Для различения стандартного шаблона и расширенного шаблона Проверьте первые 16 бит шаблона диалогового окна. В расширенном шаблоне первое **слово** — 0xFFFF; любое другое значение указывает на стандартный шаблон.

При создании шаблона диалогового окна в памяти необходимо убедиться, что каждое из определений элементов управления [**длгитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgitemtemplate) или [**длгитемтемплатикс**](dlgitemtemplateex.md) соответствует границам **DWORD** . Кроме того, все данные создания, которые следуют за определением элемента управления, должны быть согласованы по границе **DWORD** . Все остальные массивы переменной длины в шаблоне диалогового окна должны быть согласованы по границам **слов** .

### <a name="template-header"></a>Заголовок шаблона

В стандартных и расширенных шаблонах для диалоговых окон заголовок содержит следующие общие сведения:

-   Расположение и размеры диалогового окна
-   Стиль окна и диалогового окна для диалогового окна
-   Число элементов управления в диалоговом окне. Это значение определяет количество определений элементов управления [**длгитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgitemtemplate) или [**длгитемтемплатикс**](dlgitemtemplateex.md) в шаблоне.
-   Необязательный ресурс меню для диалогового окна. Шаблон может указывать, что в диалоговом окне нет меню, или же может указываться порядковое значение или строка в Юникоде, заканчивающаяся нулем, которая определяет ресурс меню в исполняемом файле.
-   Класс окна диалогового окна. Это может быть либо предопределенный класс диалогового окна, либо порядковое значение или строка Юникода, заканчивающаяся нулем, которая идентифицирует зарегистрированный класс окна.
-   Строка в Юникоде, заканчивающаяся нулем и указывающая заголовок окна диалогового окна. Если строка пуста, строка заголовка диалогового окна будет пустой. Если в диалоговом окне отсутствует стиль **\_ заголовка WS** , система устанавливает заголовок в указанную строку, но не отображает ее.
-   Если диалоговое окно имеет стиль **DS \_ сетфонт** , в заголовке указывается размер и гарнитура шрифта, используемый для текста в клиентской области и элементах управления диалогового окна.

В расширенном шаблоне в заголовке [**длгтемплатикс**](dlgtemplateex.md) также указываются следующие дополнительные сведения:

-   Идентификатор контекста справки окна диалогового окна, когда система отправляет сообщение [**\_ справки WM**](../shell/wm-help.md) .
-   Если диалоговое окно имеет стиль **DS \_ Сетфонт** или **DS \_ шеллфонт** , заголовок определяет насыщенность шрифта и указывает, является ли шрифт курсивом.

### <a name="control-definitions"></a>Определения элементов управления

После заголовка шаблона находится одно или несколько определений элементов управления, описывающих элементы управления диалогового окна. В стандартном и расширенном шаблонах заголовок диалогового окна содержит элемент, указывающий количество определений элементов управления в шаблоне. В стандартном шаблоне каждое определение элемента управления состоит из [**длгитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-dlgitemtemplate) структуры, за которой следуют дополнительные массивы переменной длины. В расширенном шаблоне определения элементов управления используют формат [**длгитемтемплатикс**](dlgitemtemplateex.md) .

В стандартном и расширенном шаблонах определение элемента управления включает следующие сведения:

-   Расположение и размеры элемента управления.
-   Окна и стили элементов управления для элемента управления.
-   Идентификатор элемента управления.
-   Класс окна элемента управления. Это может быть либо порядковое значение предопределенного системного класса, либо строка в Юникоде, заканчивающаяся нулем, которая указывает имя зарегистрированного класса окна.
-   Строка в Юникоде, заканчивающаяся нулем, которая указывает исходный текст элемента управления, или порядковое значение, идентифицирующее ресурс, например значок, в исполняемом файле.
-   Необязательный блок переменной длины данных создания. Когда система создает элемент управления, она передает указатель на эти данные в параметре *lParam* сообщения [**WM \_ CREATE**](/windows/desktop/winmsg/wm-create) , которое отправляется в элемент управления.

В расширенном шаблоне определение элемента управления также задает идентификатор контекста справки для элемента управления, когда система отправляет сообщение [**\_ справки WM**](../shell/wm-help.md) .

 

 