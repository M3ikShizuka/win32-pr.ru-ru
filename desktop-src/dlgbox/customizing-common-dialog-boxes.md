---
title: Настройка общих диалоговых окон
description: В этом разделе описывается использование общих диалоговых окон.
ms.assetid: 31ba9deb-32e6-455c-be0e-ff8bcc691c80
keywords:
- Библиотека общих диалоговых окон, Настройка
- Общие диалоговые окна, Настройка
- Настройка общих диалоговых окон
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b7eaa71c4f6fc6aa038ef150eb53935f6b3ec280
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127342887"
---
# <a name="customizing-common-dialog-boxes"></a>Настройка общих диалоговых окон

Общие диалоговые окна можно использовать в стандартной форме или настроить. С точки зрения пользователя главным преимуществом общего диалогового окна является его единообразный внешний вид и функциональность приложения. Поэтому важно настроить общее диалоговое окно только в том случае, если оно совершенно необходимо для приложения. В противном случае последовательный внешний вид и простой интерфейс программирования теряются. Соответствующие настройки не имеют большого количества исходных элементов управления. Изменение размера диалогового окна или добавление новых элементов управления в пространстве, которое уже доступно в диалоговом окне, является соответствующей настройкой. Скрытие исходных элементов управления или иным образом изменение предполагаемой функциональности исходных элементов управления является менее подходящей настройкой.

В этом разделе рассматриваются следующие методы настройки общего диалогового окна.

-   [Пользовательские шаблоны](#custom-templates)
-   [Процедуры-обработчики для общих диалоговых окон](#hook-procedures-for-common-dialog-boxes)
-   [Сообщения общего диалогового окна](#common-dialog-messages)
-   [Поддержка справки](#help-support)
    -   [Контекстно-зависимая справка](#context-sensitive-help)
    -   [Кнопка "Справка"](#the-help-button)

## <a name="custom-templates"></a>Пользовательские шаблоны

Общие диалоговые окна имеют шаблоны по умолчанию, которые определяют число, тип и расположение стандартных элементов управления в диалоговом окне. Вы можете определить пользовательский шаблон, чтобы предоставить пользователям доступ к дополнительным элементам управления, которые являются уникальными для приложения.

Для всех общих диалоговых окон, Кроме диалоговых окон « **Открыть** » и « **Сохранить как** » в стиле обозревателя, необходимо изменить шаблон по умолчанию, чтобы создать пользовательский шаблон, который заменит шаблон по умолчанию. Пользовательский шаблон определяет тип и расположение стандартных элементов управления, а также дополнительные элементы управления.

При создании пользовательского шаблона диалогового окна путем изменения шаблона диалогового окна по умолчанию убедитесь, что идентификаторы для всех добавленных элементов управления уникальны и не конфликтуют с идентификаторами стандартных элементов управления. В следующей таблице перечислены имена файлов шаблонов по умолчанию и включаемых файлов для каждого из типов стандартных диалоговых окон.



| Тип диалогового окна               | Файл шаблона | Включаемый файл |
|-------------------------------|---------------|--------------|
| **Цвет**                     | Color. DLG     | Колордлг. h   |
| **Поиск**                      | Строки FindText. DLG  | Длгс. h       |
| **Font**                      | Font. DLG      | Длгс. h       |
| **Открыть** (множественный выбор) | FileOpen. DLG  | Длгс. h       |
| **Открыть** (одиночный выбор)   | FileOpen. DLG  | Длгс. h       |
| **Параметры страницы**                | Прнсетуп. DLG  | Длгс. h       |
| **Печать**                     | Прнсетуп. DLG  | Длгс. h       |
| **Настройка печати** (устарела)    | Прнсетуп. DLG  | Длгс. h       |
| **Заменить**                   | Строки FindText. DLG  | Длгс. h       |



 

Чтобы включить пользовательский шаблон, необходимо установить флаг в элементе **flags** соответствующей структуры для диалогового окна. Если шаблон является ресурсом в приложении или библиотеке динамической компоновки, установите флаг **енаблетемплате** в элементе **flags** и используйте члены класса **HINSTANCE** и **лптемплатенаме** структуры для обозначения имени модуля и ресурса. Если шаблон уже находится в памяти, установите флаг **енаблетемплатехандле** в элементе **flags** и используйте элемент **HINSTANCE** для обозначения объекта памяти, содержащего шаблон.

В большинстве случаев необходимо также включить процедуру-обработчик для диалогового окна, чтобы поддерживать и обрабатывать входные данные для дополнительных элементов управления в пользовательском шаблоне.

Для диалоговых окон « **Открыть** » и « **Сохранить как** » в стиле обозревателя шаблоны по умолчанию недоступны для изменения. Вместо этого пользовательский шаблон определяет дочернее диалоговое окно, включающее только те элементы, которые добавляются в стандартное диалоговое окно. Пользовательский шаблон также может определять статический элемент управления, указывающий расположение кластера стандартных элементов управления в дочернем диалоговом окне. Дополнительные сведения см. в разделе [пользовательские шаблоны в стиле обозревателя](open-and-save-as-dialog-boxes.md).

## <a name="hook-procedures-for-common-dialog-boxes"></a>Процедуры-обработчики для общих диалоговых окон

Для каждого из общих диалоговых окон можно включить процедуру-обработчик для обработки сообщений из процедуры диалогового окна по умолчанию. Существует два общих типа процедур обработчиков общих диалоговых окон:

-   Стандартная процедура-обработчик, используемая в большинстве распространенных диалоговых окон
-   Процедура-обработчик в стиле обозревателя, поддерживаемая диалоговыми окнами **Открыть** и **Сохранить как**

При предоставлении стандартной процедуры-обработчика для одного из общих диалоговых окон процедура диалогового окна по умолчанию обрабатывает ее сообщения следующим образом.



| Сообщение                                 | Обработка                                                                                                                                                                                                             |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**WM \_ инитдиалог**](wm-initdialog.md) | Процедура диалогового окна по умолчанию обрабатывает сообщение перед его передачей в процедуру-обработчик. Параметр *lParam* сообщения является указателем на структуру инициализации, заданную при создании диалогового окна. |
| Все остальные сообщения                      | Процедура-обработчик сначала получает сообщение. Затем возвращаемое значение процедуры-обработчика определяет, обрабатывает ли сообщение процедура диалогового окна по умолчанию или игнорирует его.                                     |



 

Для диалоговых окон « **Открыть** » и « **Сохранить как** » в стиле обозревателя процедура обработчика не получает сообщения, предназначенные для стандартных элементов управления в диалоговом окне. Вместо этого он получает сообщения уведомления из диалогового окна и сообщения для всех дополнительных элементов управления, определенных в пользовательском шаблоне. Дополнительные сведения см. в разделе [процедуры-обработчики в стиле обозревателя](open-and-save-as-dialog-boxes.md).

Чтобы включить процедуру-обработчик, установите значение **енаблехук** в элементе **flags** соответствующей структуры для этого диалогового окна. Если установлен флаг **енаблехук** , то элемент **лпфнхук** структуры должен указывать адрес процедуры-обработчика.

В следующей таблице показан тип процедуры-ловушки, которую необходимо предоставить для каждого из общих диалоговых окон.



| Тип диалогового окна                          | Процедура обработчика                                      |
|------------------------------------------|-----------------------------------------------------|
| **Цвет**                                | [*кчукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpcchookproc)                      |
| **Найти** или **заменить**                  | [*фрхукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpfrhookproc)                      |
| **Font**                                 | [*кфхукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpcfhookproc)                      |
| **Открыть** или **Сохранить как** (обозреватель-стиль) | [*офнхукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpofnhookproc)                    |
| **Открыть** или **Сохранить как** (старый стиль)      | [*офнхукпроколдстиле*](/previous-versions/windows/desktop/legacy/ms646932(v=vs.85)) |
| **Печать**                                | [*принсукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpprinthookproc)                |
| **Параметры страницы**                           | [*пажесетуфук*](/windows/win32/api/commdlg/nc-commdlg-lppagesetuphook)                |



 

В диалоговом окне « **Параметры страницы** » можно также указать процедуру-обработчик [*пажепаинсук*](/windows/win32/api/commdlg/nc-commdlg-lppagepainthook) . Это специальная процедура-ловушка, которую можно использовать для настройки внешнего вида образца страницы, отображаемого в диалоговом окне « **Параметры страницы** ».

> [!Note]  
> Диалоговое окно « **Настройка печати** » заменено диалоговым окном « **Параметры страницы** ». Приложения должны использовать диалоговое окно " **Параметры страницы** ". Однако для обеспечения совместимости функция [**принтдлг**](/previous-versions/windows/desktop/legacy/ms646940(v=vs.85)) по мере необходимости поддерживает отображение диалогового окна « **Настройка печати** ». Вы можете предоставить процедуру обработчика [*сетуфукпрок*](/windows/win32/api/commdlg/nc-commdlg-lpsetuphookproc) для диалогового окна « **Настройка печати** ».

 

## <a name="common-dialog-messages"></a>Сообщения общего диалогового окна

В общих диалоговых окнах сообщения используются для уведомления процедуры окна или процедуры-обработчика при возникновении определенных событий. Кроме того, есть сообщения, которые можно отправить в общее диалоговое окно для получения сведений или для управления поведением или внешним видом диалогового окна. В этом разделе описаны общие сообщения диалогового окна, регистрируемые функцией [**регистервиндовмессаже**](/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea) , сообщения, используемые в диалоговом окне **Шрифт** и диалоговое окно **Параметры страницы** , а также сообщения, используемые в диалоговых окнах **Открыть** и **Сохранить как** в стиле обозревателя.

Библиотека общих диалоговых окон определяет набор строк сообщений. Можно передать константу, связанную с одной из этих строк сообщения, в [**регистервиндовмессаже**](/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea) , чтобы получить идентификатор сообщения. Затем можно использовать идентификатор для обнаружения и обработки сообщений, отправленных из общего диалогового окна, или для отправки сообщений в общее диалоговое окно. В следующей таблице приведены константы сообщений и описание их использования.



| контантс                               | Использование                                                                                                                                                                                                                                                                                                                                                                                                                    |
|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**колорокстринг**](colorokstring.md) | Диалоговое окно **цвета** отправляет это сообщение в процедуру-обработчик, когда пользователь выбирает цвет и нажимает кнопку **ОК** . Процедура-обработчик может принять цвет или отклонить его и принудительно оставить диалоговое окно открытым.                                                                                                                                                                                             |
| [**филеокстринг**](fileokstring.md)   | Диалоговое окно **Открыть** или **Сохранить как** отправляет это сообщение в процедуру-обработчик, когда пользователь выбирает имя файла и нажимает кнопку **ОК** . Процедура-обработчик может принять имя файла или отклонить его и принудительно оставить диалоговое окно открытым. для диалоговых окон « **открыть** » и « **сохранить как** » в стиле обозревателя это сообщение было заменено сообщением [**CDN \_ филеок**](cdn-fileok.md) уведомления.<br/> |
| [**финдмсгстринг**](findmsgstring.md) | Диалоговое окно **Поиск** или **Замена** отправляет это сообщение в процедуру окна родительского окна, когда пользователь нажимает кнопку **Найти далее**, **заменять** или **заменить все** или закрывает диалоговое окно. Параметр *lParam* сообщения является указателем на структуру [**финдреплаце**](/windows/win32/api/commdlg/ns-commdlg-findreplacea) , содержащую входные данные пользователя.                                                                               |
| [**хелпмсгстринг**](helpmsgstring.md) | Все общие диалоговые окна отправляют это сообщение в процедуру окна своего родительского окна, когда пользователь нажимает кнопку " **Справка** ". для диалоговых окон « **открыть** » и « **сохранить как** » в стиле обозревателя это сообщение было заменено сообщением уведомления [**CDN \_ HELP**](cdn-help.md) .<br/>                                                                                                                    |
| [**лбселчстринг**](lbselchstring.md) | Диалоговое окно **Открыть** или **Сохранить как** отправляет это сообщение в процедуру-обработчик, когда пользователь изменяет выбор в списке **имя файла** . для диалоговых окон « **открыть** » и « **сохранить как** » в стиле обозревателя это сообщение было заменено сообщением [**CDN \_ селчанже**](cdn-selchange.md) уведомления.<br/>                                                                                           |
| [**сетргбстринг**](setrgbstring.md)   | Процедура-обработчик может отправить это сообщение в диалоговое окно **цвета** , чтобы задать текущее выделение цветом.                                                                                                                                                                                                                                                                                                                   |
| [**шаревистринг**](sharevistring.md) | Диалоговое окно **Открыть** или **Сохранить как** отправляет это сообщение в процедуру обработки, если при нажатии пользователем кнопки **ОК** возникает нарушение совместного доступа для выбранного файла. для диалоговых окон « **открыть** » и « **сохранить как** » в стиле обозревателя это сообщение было заменено сообщением [**CDN \_ шаревиолатион**](cdn-shareviolation.md) уведомления.<br/>                                                        |



 

Некоторые общие диалоговые окна отправляют и получают другие сообщения окна. Процедура обработки для диалогового окна **шрифта** может отправить любой из **\_ сообщений WM CHOOSEFONT \_ \* *_ в*** диалоговое окно "_ шрифт". Дополнительные сведения см. в разделе [диалоговое окно "Шрифт"](font-dialog-box.md). Диалоговое окно **Параметры страницы** отправляет сообщения **WM \_ PSD \_ \** _, если вы включили процедуру подключения [_PagePaintHook *](/windows/win32/api/commdlg/nc-commdlg-lppagepainthook) . Дополнительные сведения см. в разделе [диалоговое окно "Параметры страницы"](page-setup-dialog-box.md).

Диалоговые окна обозревателя **Открыть** и **Сохранить как** поддерживают набор предопределенных сообщений. К ним относятся сообщения уведомления, отправленные в виде сообщения [**WM \_ Notify**](../controls/wm-notify.md) в процедуру обработки, и сообщения, которые процедура-ловушка может отправить в диалоговое окно. Полный список этих сообщений см. в разделе [процедуры перехватчика в стиле обозревателя](open-and-save-as-dialog-boxes.md).

## <a name="help-support"></a>Поддержка справки

Общие диалоговые окна предоставляют контекстно-зависимую справку для стандартных элементов управления диалогового окна. Чтобы предоставить дополнительную справку для общего диалогового окна, можно отобразить кнопку **справки** и обработать сообщения, созданные при нажатии пользователем кнопки. Кнопка **Справка** является дополнением к контекстно-зависимой справке по умолчанию. Кнопка **Справка** полезна для описания общего назначения диалогового окна, применяемого в приложении.

-   [Контекстно-зависимая справка](#context-sensitive-help)
-   [Кнопка "Справка"](#the-help-button)

### <a name="context-sensitive-help"></a>Справка по Context-Sensitive

Все общие диалоговые окна предоставляют контекстно-зависимую справку для стандартных элементов управления диалогового окна. Пользователь может отображать справку для отдельных элементов управления любым из следующих способов:

-   Выбор элемента управления и нажатие клавиши F1.
-   Нажатие кнопки « **?** » в строке заголовка и затем щелкнув элемент управления.
-   Щелчок правой кнопкой мыши над элементом управления.

Если диалоговое окно настраивается путем добавления новых элементов управления, необходимо также расширить поддержку справки для этих элементов управления, обрабатывая запросы для справки в процедуре обработки. Процедура-обработчик получает следующие сообщения, когда пользователь запрашивает справку.



| Рекомендуемые действия                                                           | Сообщение                                      |
|-----------------------------------------------------------------------|----------------------------------------------|
| Щелкните правой кнопкой мыши на элементе управления.                          | [**WM \_ CONTEXTMENU**](/windows/desktop/menurc/wm-contextmenu) |
| Нажата клавиша F1.                                                   | [**\_Справка WM**](../shell/wm-help.md)               |
| Щелкнули **?** в строке заголовка, а затем щелкните элемент управления. | [**\_Справка WM**](../shell/wm-help.md)               |



 

Эти сообщения следует обрабатывать для добавленных элементов управления, но позволить диалоговому окну по умолчанию обрабатывать сообщения для стандартных элементов управления. Дополнительные сведения об обработке этих сообщений см. в [справке](/previous-versions/windows/desktop/legacy/bb776786(v=vs.85)).

### <a name="the-help-button"></a>Кнопка "Справка"

Можно отобразить кнопку **справки** в любом из общих диалоговых окон, задав значение **SHOWHELP** в элементе **flags** структуры инициализации для диалогового окна. Если отображается кнопка **Справка** , необходимо обработать запрос пользователя для получения справки. Обработку можно выполнить либо в одной из процедур окна приложения, либо в процедуре обработки диалогового окна. Как правило, запрос на помощь обрабатывается вызовом функции [**WinHelp**](/windows/win32/api/winuser/nf-winuser-winhelpa) .

Для обработки сообщений справки в одной из оконных процедур необходимо получить идентификатор сообщения для строки, определяемой значением [**хелпмсгстринг**](helpmsgstring.md) , и определить окно для получения сообщений. Чтобы получить идентификатор сообщения, укажите **хелпмсгстринг** в качестве параметра в вызове функции [**регистервиндовмессаже**](/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea) . При создании диалогового окна используйте элемент **хвндовнер** структуры инициализации диалогового окна, чтобы указать окно, которое будет принимать сообщения. Процедура диалогового окна отправляет сообщение в процедуру окна каждый раз, когда пользователь нажимает кнопку « **Справка** ».

Для обработки сообщений справки в процедуре обработки необходимо обработать [**\_ командное сообщение WM**](/windows/desktop/menurc/wm-command) . Процедура-обработчик предоставляет справку, если параметр *wParam* этого сообщения указывает, что пользователь щелкнул кнопку " **Справка** ". Идентификатор кнопки **справки** — это константа **пшхелп** , определенная в файле длгс. h.

Процедуры-обработчики для диалоговых окон " **Открыть** " и " **Сохранить как** " в стиле обозревателя не получают [**\_ Командные сообщения WM**](/windows/desktop/menurc/wm-command) для кнопки " **Справка** ". вместо этого при нажатии кнопки « **справка** » диалоговое окно отправляет в процедуру обработчика CDN сообщение с уведомлением о [**\_ помощи**](cdn-help.md) .

 

