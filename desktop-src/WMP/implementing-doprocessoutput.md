---
title: Реализация Допроцессаутпут
description: Реализация Допроцессаутпут
ms.assetid: c6fbcfc0-741b-4aa7-9109-e06810a2e081
keywords:
- подключаемые модули проигрыватель Windows Media, DSP аудиоподсистемы
- подключаемые модули, DSP аудиоподсистемы
- подключаемые модули обработки цифровых сигналов, Допроцессаутпут
- Подключаемые модули DSP, Допроцессаутпут
- подключаемые модули DSP аудиоподсистемы, Допроцессаутпут
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fc2f5aa1a952f16de196bed72ed7ac93dfac95d8333496824e3f0740f506a6fa
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119135587"
---
# <a name="implementing-doprocessoutput"></a>Реализация Допроцессаутпут

Для обработки звуковых данных необходимо выполнить несколько шагов в **допроцессаутпут**. Следующие шаги используют образец кода мастера подключаемых модулей в качестве примеров. Если вы хотите создать подключаемый модуль DSP для аудио, который обрабатывает мультимедийное содержимое того же типа, что и образец кода мастера подключаемого модуля, вам потребуется только изменить фактический код обработки, на который ссылается в шаге 6. Ниже приведены все действия, реализованные в **допроцессаутпут**.

-   Если подключаемый модуль в данный момент не включен, просто скопируйте данные без изменений в выходной буфер. Если подключаемый модуль преобразует данные в другой формат, необходимо также выполнить обработку преобразования здесь.

    ```C++
    // Test whether the plug-in is disabled by the user.
    if (!m_bEnabled)
    {
        // Just copy the data without changing it.
        memcpy(pbOutputData, m_pbInputData, *cbBytesProcessed);

        return S_OK;
    }
    
    ```

    

    -   Получение указателя на структуру формата входных данных. Необходимо получить данные элементов из этой структуры, поэтому скопируйте указатель из *m \_ мтинпут*.**пбформат** в локальную переменную указателя типа, которая соответствует типу структуры формата. В следующем примере сохраняется указатель на структуру формата входных данных **вавеформатекс** :

    ```C++
    WAVEFORMATEX *pWave = (WAVEFORMATEX*) m_mtInput.pbFormat;
    
    ```

    

    -   Вычислите количество обрабатываемых выборок. Пример кода, создаваемый мастером подключаемых модулей, выполняет этот шаг, разделив число байтов для обработки элементом **нблоккалигн** структуры входного формата вавеформатекс, а затем умножив результат на количество каналов, которые хранились в элементе **нчаннелс** . Ниже приведен пример кода из мастера подключаемых модулей.

    ```C++
    DWORD dwSamplesToProcess = (cbBytesProcessed / pWave->nBlockAlign) * pWave->nChannels;
    
    ```

    

    1.  Определите битовую глубину звука. Образец кода мастера подключаемого модуля определяет 8-битный или 16-битный звук путем проверки элемента **вбитсперсампле** структуры **вавеформатекс** . Затем оно использует это значение в операторе switch, чтобы предоставить отдельные подпрограммы обработки для каждой битовой глубины. При работе с другими типами форматов и глубиной бит может потребоваться использовать другой метод.
    2.  Создайте цикл для пошагового просмотра звуковых образцов во входном буфере.
    3.  Получение примера из входного буфера. Это делается путем разыменования указателя входных данных и сохранения результата в переменную типа int. Для 16-разрядного звука необходимо повторно привести указатель БАЙТа к короткому указателю для обработки большей точности звукового образца. После получения значения можно сразу увеличить указатель *пбинпутдата* , чтобы он указывал на следующий образец. Это продемонстрировано в следующих примерах.

    ```C++
    // For 8-bit audio.
    int i = *pbInputData++;  
    
    ```

    

    -или-

    ```C++
    // For 16-bit audio.
    // Recast the pointer.
    short *pwInputData = (short *) pbInputData; 

    // Enter the loop and then get the input sample.
    int i = *pwInputData++;
    
    ```

    

    1.  Выполните обработку. Здесь вы применяете алгоритмы, которые изменяют пример каким-либо образом. Вот что вы сделаете здесь.
    2.  Запишите обработанные данные в выходной буфер. Немедленно Увеличьте указатель до выходного буфера, как показано в следующем примере:

    ```C++
    *pwOutputData++ = i;
    
    ```

    

    1.  Повторите цикл, пока не будут обработаны все образцы.
    2.  Возврат соответствующего **HRESULT**.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Реализация подключаемого модуля DSP аудиоподсистемы**](implementing-an-audio-dsp-plug-in.md)
</dt> </dl>

 

 




