---
title: Реализация удаленного управления проигрывателем Windows Media
description: Реализация удаленного управления проигрывателем Windows Media
ms.assetid: d543b2a0-a2cb-47e2-b50e-4513fc061b46
keywords:
- Проигрыватель Windows Media, внедрение элемента управления ActiveX
- Объектная модель проигрывателя Windows Media, внедрение элемента управления ActiveX
- Объектная модель, внедрение элемента управления ActiveX
- Проигрыватель Windows Media Mobile, внедрение элемента управления ActiveX
- Элемент управления ActiveX проигрывателя Windows Media, внедрение
- Мобильный элемент управления ActiveX проигрывателя Windows Media, внедрение
- Элемент управления ActiveX, внедрение
- Проигрыватель Windows Media, удаленное управление ActiveX
- Объектная модель проигрывателя Windows Media, элемент управления ActiveX для удаленного взаимодействия
- Объектная модель, удаленное взаимодействие элементов управления ActiveX
- Проигрыватель Windows Media Mobile, элемент управления ActiveX для удаленного взаимодействия
- Элемент управления ActiveX проигрывателя Windows Media, удаленное взаимодействие
- Мобильный элемент управления ActiveX проигрывателя Windows Media, удаленное взаимодействие
- Элемент управления ActiveX, удаленное взаимодействие
- удаленное взаимодействие элемента управления ActiveX проигрывателя Windows Media
- внедрение, удаленное взаимодействие элементов управления ActiveX
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 615d3d31535abea098939af65ea67c13acbf8f6c
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "104069695"
---
# <a name="remoting-the-windows-media-player-control"></a>Реализация удаленного управления проигрывателем Windows Media

При внедрении элемента управления проигрывателя Windows Media в программу на языке C++ его можно использовать в качестве удаленного расширения полного режима проигрывателя. Это называется «удаленное взаимодействие» элемента управления проигрывателя Windows Media и позволяет предоставлять все функции проигрывателя в полноэкранном режиме, не реализуя их самостоятельно.

При удаленном элементе управления он использует тот же модуль воспроизведения, что и полный режим проигрывателя, и пользователи могут переключаться между встроенным режимом ("закрепленным" состоянием) и полным режимом ("незакрепленным"), в то время как воспроизведение цифрового мультимедиа продолжается без прерывания.

## <a name="enabling-remote-embedding"></a>Включение удаленного внедрения

Чтобы включить удаленное внедрение элемента управления проигрывателя Windows Media, программа должна реализовать интерфейсы **IServiceProvider** и [ивмпремотемедиасервицес](/previous-versions/windows/desktop/api/wmp/nn-wmp-iwmpremotemediaservices) . **IServiceProvider** — это стандартный интерфейс модели компонентов (com) с одним методом, именуемым **QueryService**. Проигрыватель Windows Media вызывает этот метод для получения указателя на интерфейс **ивмпремотемедиасервицес** .

**Ивмпремотемедиасервицес** имеет несколько методов, но только два из них напрямую связаны с удаленным взаимодействием. В приложении [имя_приложения](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpremotemediaservices-getapplicationname)вы возвращаете имя программы, которое проигрыватель Windows Media добавляет в список **переключаться в другие программы** в меню **вид** . В [жетсервицетипе](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpremotemediaservices-getservicetype)вы указываете режим внедрения элемента управления, возвращая значение "Remote" или "Local". Если удаленное соединение установлено успешно, метод [Get \_ ](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayer4-get_isremote) [IWMPPlayer4](/previous-versions/windows/desktop/api/wmp/nn-wmp-iwmpplayer4) интерфейса возвращает значение true.

## <a name="specifying-an-exclusive-online-store"></a>Указание эксклюзивного Интернет-магазина

В проигрывателе Windows Media 11 приложение, которое внедряет удаленное управление проигрывателем, может указывать эксклюзивное Интернет-хранилище. В этом случае средство выбора службы в проигрывателе Windows Media будет отключено, и пользователю будет доступно только указанное Интернет-хранилище. Подробные сведения о том, как указать эксклюзивное Интернет-хранилище, см. в разделе [эксклюзивные Интернет-магазины](exclusive-online-stores.md).

## <a name="docking-and-undocking"></a>Закрепление и Отстыковка

Интерфейс **IWMPPlayer4** также предоставляет доступ к интерфейсу [ивмпплайераппликатион](/previous-versions/windows/desktop/api/wmp/nn-wmp-iwmpplayerapplication) с помощью метода [Get \_ плайераппликатион](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayer4-get_playerapplication) . Используйте **ивмпплайераппликатион** для переключения между закрепленными и незакрепленными состояниями, а также для определения текущего закрепленного состояния и расположения видео или зрительного дисплея.

Метод [ивмпплайераппликатион:: свитчтоплайераппликатион](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayerapplication-switchtoplayerapplication) отсоединяет элемент управления, открывая полный режим проигрывателя Windows Media и передавая экран видео или визуализацию на панель **воспроизведения** . Метод [ивмпплайераппликатион:: свитчтоконтрол](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayerapplication-switchtocontrol) закрепляет элемент управления, передавая видео или визуализацию в программу и закрывая полный режим проигрывателя, если он открыт. Элемент управления можно также закрепить, выбрав программу из списка **Переход к другой программе** или закрыв полный режим проигрывателя. В обоих случаях воспроизведение любых цифровых мультимедиа продолжается без перерывов.

## <a name="transferring-the-video-or-visualization-display"></a>Передача отображения видео или визуализации

Когда несколько программ с внедренными удаленными элементами управления проигрывателем Windows Media работают одновременно, все элементы управления используют один и тот же модуль воспроизведения. Они также совместно используют один и тот же экземпляр полного режима проигрывателя в незакрепленном состоянии. Однако в закрепленном состоянии только один элемент управления может отображать видео или визуализацию. В незакрепленном состоянии отображается видео или визуализация только в полноэкранном режиме. Метод **свитчтоконтрол** работает как в закрепленных, так и в незакрепленных состояниях и передает видео или визуализацию в любую программу, которая ее вызывает.

Единственное различие между закрепленными и незакрепленными состояниями заключается в наличии полного режима проигрывателя Windows Media и его принадлежности к экрану видео или визуализации. В незакрепленном состоянии все внедренные удаленные элементы управления по-прежнему отображаются, а их пользовательские интерфейсы по-прежнему полностью функционируют. При наличии окна видео или визуализации оно будет пустым. В закрепленном состоянии только один из внедренных удаленных элементов управления владеет отображением, но все пользовательские интерфейсы продолжают функционировать.

## <a name="hiding-or-changing-the-control-in-the-undocked-state"></a>Скрытие или изменение элемента управления в незакрепленном состоянии

Если вы хотите скрыть или изменить пользовательский интерфейс внедренного элемента управления в незакрепленном состоянии или если программа не владеет отображением, необходимо предоставить собственную реализацию. Эти изменения можно выполнять при закреплении и отстыковке элемента управления, а также в ответ на события проигрывателя Windows Media. Поскольку проигрыватель можно закрепить с помощью команды меню **Переход к другой программе** , обычно лучше предоставить эту функцию в ответ на события.

Можно реализовать обработчики событий для событий [свитчедтоплайераппликатион](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpevents-switchedtoplayerapplication) и [свитчедтоконтрол](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpevents-switchedtocontrol) или реализовать один обработчик событий для события [плайердоккедстатечанже](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpevents-playerdockedstatechange) . В последнем случае можно определить закрепленное состояние, вызвав [ивмпплайераппликатион:: Get \_ плайердоккед](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayerapplication-get_playerdocked). В обоих случаях используйте [ивмпплайераппликатион:: Get \_ хасдисплай](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpplayerapplication-get_hasdisplay) , чтобы определить, владеет ли программой дисплей видео или визуализации.

## <a name="re-establishing-a-remote-connection"></a>Повторное установление удаленного подключения

В некоторых обстоятельствах соединение между удаленным встроенным элементом управления и автономным проигрывателем завершится сбоем, что сделает указатели на интерфейсы проигрывателя Windows Media недействительными. Проигрыватель Windows Media автоматически попытается повторно подключиться и запустит событие [плайерреконнект](/previous-versions/windows/desktop/api/wmp/nf-wmp-iwmpevents-playerreconnect) , чтобы сообщить об этой попытке. Хотя повторное подключение выполняется автоматически, необходимо предоставить обработчик событий для этого события, если нужно освободить недопустимые указатели и получить новые, чтобы получить доступ к отдельному проигрывателю через новое соединение.

## <a name="controlling-the-undocked-player"></a>Управление незакрепленным проигрывателем

Все удаленные экземпляры элемента управления проигрывателя Windows Media могут управлять полным режимом проигрывателя независимо от закрепленного состояния. Однако функции, не имеющие соответствия полному режиму проигрывателя, игнорируются до тех пор, пока не будет закреплен элемент управления проигрывателя Windows Media. К ним относятся свойства [ивмпплайер](/previous-versions/windows/desktop/api/wmp/nn-wmp-iwmpplayer) и производных интерфейсов, такие как **Enabled**, **енаблеконтекстмену**, **uiMode** и **виндовлессвидео**.

## <a name="error-dialog-boxes"></a>Диалоговые окна ошибок

Из удаленного экземпляра управления проигрывателя Windows Media *Параметры*. Свойство **енаблиррордиалогс** ведет себя особым образом. Применяются следующие правила.

-   Если проигрыватель Windows Media не закреплен (отображается пользовательский интерфейс проигрывателя Windows Media), свойство **енаблиррордиалогс** игнорируется, а проигрыватель обрабатывает диалоговые окна ошибок.
-   Когда проигрыватель Windows Media закрепляется, значение, заданное каждым удаленным экземпляром элемента управления для **енаблиррордиалогс** , применяется только к отдельному экземпляру элемента управления. То есть, если определенный экземпляр элемента управления задает значение true для **енаблиррордиалогс**, то только этот экземпляр будет отображать диалоговое окно при возникновении ошибки, если все остальные экземпляры элемента управления указали значение false.

## <a name="remoting-in-the-background"></a>Удаленное взаимодействие в фоновом режиме

Не следует хранить удаленный экземпляр проигрывателя, выполняющегося в фоновом режиме, в то время, когда элемент управления не используется. Так как удаленный экземпляр управления игрока использует механизм воспроизведения совместно с проигрывателем в полноэкранном режиме, выполнение фонового экземпляра может привести к непредвиденному поведению. Например, пользователь может закрыть проигрыватель в полноэкранном режиме во время воспроизведения файла. Пользователь будет ожидать, что воспроизведение файла будет полностью прекращено при закрытии проигрывателя, но звук может продолжать воспроизводиться, так как подсистема воспроизведения все еще активна.

## <a name="samples"></a>Примеры

Пакет установки пакета SDK для проигрывателя Windows Media устанавливает примеры, демонстрирующие удаленное взаимодействие. Дополнительные сведения см. в примерах Ремотескин и ВМПМЛ.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Примеры**](samples.md)
</dt> <dt>

[**Использование элемента управления проигрывателя Windows Media в программе на языке C++**](using-the-windows-media-player-control-in-a-c---program.md)
</dt> </dl>

 

 




