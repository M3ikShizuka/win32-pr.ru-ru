---
title: Обновление существующих подключаемых модулей DSP
description: Обновление существующих подключаемых модулей DSP
ms.assetid: 0525030e-eb30-41a0-8191-4a5727736857
keywords:
- подключаемые модули проигрыватель Windows Media, обработка цифровых сигналов (DSP)
- подключаемые модули, обработка цифровых сигналов (DSP)
- подключаемые модули обработки цифровых сигналов, обновление
- Подключаемые модули DSP, обновление
- версии проигрыватель Windows Media, подключаемые модули DSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 725a7a752206f4d321af9deb106df82c40b677dd719182660c5940cac4788244
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120122734"
---
# <a name="updating-existing-dsp-plug-ins"></a>Обновление существующих подключаемых модулей DSP

подключаемые модули DSP, созданные до выпуска пакета SDK для проигрыватель Windows Media 11, могут работать не так, как ожидалось, с проигрыватель Windows Media 11 на Windows Vista. чтобы гарантировать, что клиенты, которые работают проигрыватель Windows Media 11 в Windows Vista, могут использовать ваши подключаемые модули, необходимо внести некоторые изменения в код подключаемого модуля DSP, перекомпилировать проект и распространить обновленный подключаемый модуль клиентам.

проекты, созданные с помощью последней версии мастера подключаемых модулей проигрыватель Windows Media, будут содержать необходимые обновления. дополнительные сведения см. в разделе [обновления мастера подключаемых модулей DSP для проигрыватель Windows Media 11](updates-to-the-dsp-plug-in-wizard-for-windows-media-player-11.md). (рекомендуется запустить мастер, чтобы создать новый пример проекта, а затем использовать такой инструмент, как Windiff.exe, который поставляется с Visual Studio, чтобы проверить различия между образцом кода и рабочим кодом.)

Существуют три основных изменения, которые необходимо внести в существующие подключаемые модули DSP.

-   Изменение способа регистрации подключаемого модуля. Существующий подключаемый модуль, вероятно, регистрирует модель потоков как "подразделение". проигрыватель Windows Media 11, работающий в Windows Vista, требует, чтобы подключаемые модули DSP регистрировали модель потоков как "оба". Это можно исправить, изменив значение модели потоков в файле *имяПроекта*. RGS следующим образом:

    ```C++
    val ThreadingModel = s 'Both'
    
    ```

    

    > [!Note]  
    > При указании модели потоков как "оба" удаляется любая сериализация, предоставляемая COM для вызовов пользовательских интерфейсов. При вызове пользовательских интерфейсов из нескольких потоков необходимо предоставить такую сериализацию самостоятельно.

     

    проигрыватель Windows Media 11 обеспечивает правильную сериализацию вызовов DMO интерфейсов.

    1.  Добавьте вызовы [ивмпмедиаплугинрегистрар:: вмпрегистерплайерплугин](/previous-versions/windows/desktop/api/wmpservices/nf-wmpservices-iwmpmediapluginregistrar-wmpregisterplayerplugin) и [Ивмпмедиаплугинрегистрар:: вмпунрегистерплайерплугин](/previous-versions/windows/desktop/api/wmpservices/nf-wmpservices-iwmpmediapluginregistrar-wmpunregisterplayerplugin) с новым типом подключаемого модуля: WMP \_ PLUGINTYPE \_ DSP \_ OUTOFPROC в DllRegisterServer и DllUnregisterServer в файле *projectnamedll*. cpp. Дополнительные сведения см. на страницах справочника по этим методам.
    2.  Создайте и распространите БИБЛИОТЕКУ прокси-сервера или заглушки, чтобы включить маршалирование COM любого пользовательского интерфейса, реализованного или созданного классом подключаемого модуля. Пользовательский интерфейс — это любой собственный интерфейс, который определяется и реализуется для использования объектом подключаемого модуля. К ним относится пользовательский интерфейс, используемый страницей свойств, если он указан, но также может включать интерфейсы, подключающиеся к подключаемым модулям пользовательского интерфейса, например. Примером настраиваемого интерфейса, созданного с помощью мастера подключаемых модулей, является *ипрожектнаме*. Примеры интерфейсов, которые не являются пользовательскими интерфейсами, включают **имедиаобжект** и **ивмпплугиненабле**.

Если подключаемый модуль DSP обрабатывает аудио, необходимо также добавить поддержку следующих новых форматов звука:

-   \_Формат волны \_ IEEE \_ float
-   \_Формат Wave \_ , расширяемый с подформатом КСДАТАФОРМАТ \_ подтипа \_ IEEE \_ float.

Если подключаемый модуль DSP обрабатывает видео, необходимо добавить поддержку формата видео NV12.

См. образец подключаемого модуля DSP аудио или видео, создаваемый мастером, для примера обработки этих типов форматов.

## <a name="about-the-proxystub-project"></a>Сведения о прокси-сервере или заглушке Project

Возможно, самый простой способ создать проект прокси-сервера или библиотеки DLL-заглушки для подключаемого модуля DSP — запустить мастер подключаемого модуля DSP. В результате будет создан пример проекта прокси-сервера, который можно изменить для работы с существующим кодом. Необходимо внести следующие изменения:

1.  Удалите все существующие определения для пользовательских интерфейсов из кода. например, мастер подключаемых модулей DSP из пакета SDK проигрыватель Windows Media 10 создал определение интерфейса *ипрожектнаме* в файле *имяпроекта*. h с помощью ключевого слова **interface** .
2.  Определите пользовательские интерфейсы в IDL-файле проекта прокси или заглушки.
3.  Создайте проект прокси-сервера или заглушки перед основным проектом. вы можете настроить Visual Studio, чтобы сделать это автоматически, если оба проекта являются частью одного решения.
4.  Компилятор MIDL создаст новый файл заголовка с именем в формате *имя_проекта* \_ х.х. Этот заголовок необходимо включить в основной проект (в *имяПроекта*. h). Он содержит определения для пользовательских интерфейсов.

## <a name="distributing-the-updated-plug-in"></a>Распространение обновленного подключаемого модуля

Вы можете установить обновленный подключаемый модуль на компьютерах пользователей точно так же, как в прошлом. Однако теперь необходимо также распространять и регистрировать библиотеку DLL прокси-сервера и заглушки.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Обзор подключаемого модуля DSP**](dsp-plug-in-developer-overview.md)
</dt> </dl>

 

 




