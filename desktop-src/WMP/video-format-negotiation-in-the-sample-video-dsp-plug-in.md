---
title: Согласование формата видео в примере подключаемого модуля DSP видео
description: Согласование формата видео в примере подключаемого модуля DSP видео
ms.assetid: 3e92ce10-2b9b-4689-a181-f56c33472fea
keywords:
- подключаемые модули проигрыватель Windows Media, DSP видео
- подключаемые модули, DSP видео
- подключаемые модули обработки цифровых сигналов, согласование формата видео
- Подключаемые модули DSP, согласование формата видео
- подключаемые модули DSP видео, форматирование согласования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90154f3fe7824fb9af563cb662fdcb2847339bc6061d79b3e92cab9c6e36e44d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119761824"
---
# <a name="video-format-negotiation-in-the-sample-video-dsp-plug-in"></a>Согласование формата видео в примере подключаемого модуля DSP видео

прежде чем проигрыватель Windows Media вставит подключаемый модуль DSP видео в цепочку сигналов, игрок должен определить, может ли подключаемый модуль обрабатывать воспроизводимое видео. Процесс, с помощью которого подключаемый модуль и проигрыватель обмениваются данными с поддерживаемыми форматами видео, называется согласованием формата.

## <a name="providing-the-supported-input-and-output-types"></a>Предоставление поддерживаемых типов входных и выходных данных

если подключаемый модуль DSP выступает в качестве объекта мультимедиа DirectX (DMO), проигрыватель запрашивает у подключаемого модуля сведения о поддерживаемых форматах, выполняя последовательность вызовов **имедиаобжект:: жетинпуттипе** и **имедиаобжект:: жетаутпуттипе**.

Если подключаемый модуль DSP выступает в качестве Media Foundation преобразования (MFT), проигрыватель запрашивает у подключаемого модуля сведения о поддерживаемых форматах, выполняя последовательность вызовов **имфтрансформ:: жетинпутаваилаблетипе** и **Имфтрансформ:: жетаутпутаваилаблетипе**.

подключаемый модуль образца видео, созданный мастером подключаемых модулей проигрыватель Windows Media, сохраняет список поддерживаемых видеоформатов в виде массива идентификаторов guid. Следующий код находится в файле main. cpp:


```C++
static const GUID*    k_guidValidSubtypes[] = {
    &MEDIASUBTYPE_NV12,
    &MEDIASUBTYPE_YV12,
    &MEDIASUBTYPE_YUY2,
    &MEDIASUBTYPE_UYVY,
    &MEDIASUBTYPE_RGB32,
    &MEDIASUBTYPE_RGB24,
    &MEDIASUBTYPE RGB555,
    &MEDIASUBTYPE RGB565
};

```



Проигрыватель может вызывать **имедиаобжект:: жетинпуттипе** и **Имедиаобжект:: жетаутпуттипе** в любом порядке, поэтому код подключаемого модуля должен предвидеть это. Аналогично, проигрыватель может вызывать **имфтрансформ:: жетинпутаваилаблетипе** и **Имфтрансформ:: жетаутпутаваилаблетипе** в любом порядке. Примеры реализаций **жетаутпуттипе** и **жетаутпутаваилаблетипе** тестируют, был ли уже определен тип входных данных. Если он есть, подключаемый модуль реагирует, что он поддерживает только этот тип. В противном случае подключаемый модуль возвращает тип, соответствующий заданному индексу, как показано в следующем коде:


```C++
// If input type has been defined, then use that as output type.
if (GUID_NULL != m_mtInput.majortype)
{
    hr = ::MoCopyMediaType( pmt, &m_mtInput );
}
else // Otherwise use default for this plug-in.
{
    ::ZeroMemory( pmt, sizeof( DMO_MEDIA_TYPE ) );
    pmt->majortype = MEDIATYPE_Video;
    pmt->subtype = *k_guidValidSubtypes[dwTypeIndex];     
}

```



## <a name="setting-the-input-and-output-types"></a>Настройка типов входных и выходных данных

если подключаемый модуль DSP выступает в качестве DMO, проигрыватель Windows Media задает тип мультимедиа путем вызова **имедиаобжект:: сетинпуттипе** и **имедиаобжект:: сетаутпуттипе**, передавая каждой функции указатель на структуру **\_ \_ типа мультимедиа DMO** , представляющую запрошенный тип мультимедиа.

если подключаемый модуль DSP выступает в качестве MFT, проигрыватель Windows Media задает тип мультимедиа путем вызова **имфтрансформ:: сетинпуттипе** и **имфтрансформ:: сетаутпуттипе**, передавая каждой функции указатель на интерфейс **имфмедиатипе** , представляющий запрошенный тип мультимедиа.

Нет никакой гарантии, что проигрыватель будет вызывать методы согласования формата в каком-то конкретном порядке, поэтому код подключаемого модуля должен работать в любом случае. Например, если игрок вызывает **сетаутпуттипе** перед вызовом **сетинпуттипе**, он является допустимым образом действия для подключаемого модуля, чтобы отклонить предложенный тип выходного носителя. Следующий код из примера реализации **имедиаобжект:: сетаутпуттипе** демонстрирует это:


```C++
if( GUID_NULL != m_mtInput.majortype )
{
    // Validate that the output media type matches our requirements 
    // and matches our input type (if set).
    hr = ValidateMediaType(pmt, &m_mtInput);
}
else
{
    hr = DMO_E_TYPE_NOT_ACCEPTED;
}

```



В примерах реализаций подключаемых модулей **сетинпуттипе** и **сетаутпуттипе** вызывается пользовательская функция с именем **валидатемедиатипе**. Эта подключаемая функция выполняет ряд тестов по предложенному типу мультимедиа, предназначенному для обеспечения правильного формата типа мультимедиа и поддержки его в подключаемом модуле. **Валидатемедиатипе** выполняет следующие тесты:

-   Проверяет, что члены **мажортипе** и **форматтипе** содержат правильные значения.
-   Проверяет, соответствует ли элемент **подтипа** одному из поддерживаемых форматов.
-   Проверяет, содержат ли сведения в структурах **битмапинфохеадер** и **видеоинфохеадер** или **VIDEOINFOHEADER2** допустимые значения.
-   Проверяет совпадение типов входных и выходных носителей, так как подключаемый модуль не преобразует форматы входных данных в выходные данные.

Если предложенный тип мультимедиа передает проверочные тесты, он хранится в переменной-члене: **m \_ мтинпут** для входного типа носителя, **m \_ мтаутпут** для выходного типа мультимедиа.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Реализация подключаемого модуля DSP видео**](implementing-a-video-dsp-plug-in.md)
</dt> </dl>

 

 




