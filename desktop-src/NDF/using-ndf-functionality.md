---
title: Использование функции NDF
description: Корпорация Майкрософт предоставляет доступ к функциональным возможностям NDF через общедоступный API. При возникновении проблемы приложение может использовать этот API для использования этой функции в контексте определенного приложения.
ms.assetid: db06b9a9-a64a-43ff-9b77-95230208cfd6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d85d1386971207330579f5395989e14c4b2315dc578f5bb3509695b99d6e215a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118133231"
---
# <a name="using-ndf-functionality"></a>Использование функции NDF

Корпорация Майкрософт предоставляет доступ к функциональным возможностям NDF через общедоступный API. При возникновении проблемы приложение может использовать этот API для использования этой функции в контексте определенного приложения.

Существует три этапа диагностики NDF: создание инцидента, выполнение диагностики и восстановления и закрытие инцидента. В этом обзоре указывается, какие функции NDF могут быть актуальными для конкретного сценария. Подробные сведения о каждой функции можно найти в разделе [справочника по ndf](ndf-reference.md) .

## <a name="creating-an-incident"></a>Создание инцидента

Для сеанса диагностики NDF требуется конкретный инцидент для диагностики. Существует несколько функций, которые можно использовать для создания инцидента. Выберите функцию, которая наиболее точно соответствует тому, что пытается сделать приложение при возникновении сбоя.

-   [**НдфкреатеконнективитинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateconnectivityincident): общие проблемы с подключением к Интернету, для которых не требуются дополнительные сведения.
-   [**НдфкреатевебинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincident) / [**НдфкреатевебинЦидентекс**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewebincidentex): подключение к URL-адресу http или HTTPS.
-   [**НдфкреатешарингинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatesharingincident): доступ к UNC-пути или общей папке.
-   [**НдфкреатеднсинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatednsincident): разрешение имени узла DNS.
-   [**НдфкреатепнрпинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatepnrpincident): разрешение имени однорангового узла PNRP.
-   [**НдфкреатеграупингинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreategroupingincident): присоединение одноранговой группы.
-   [**НдфкреатевинсоккинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreatewinsockincident): подключение к назначению с помощью сокета (если ни одна из других функций не применяется).
-   [**НдфкреатеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcreateincident): используется, если не подходит никакой другой сценарий и известен конкретный вспомогательный класс ndf (вместе с необходимыми аргументами). В основном используется для целей тестирования разработчиками приложений, которые написали собственный вспомогательный класс.

## <a name="running-diagnosis-and-repairs"></a>Выполнение диагностики и восстановления

Существует два способа запуска функции диагностики и восстановления.

-   использование пользовательского интерфейса Windows (рекомендуется)

    при работе в стандартном Windows пользовательском интерфейсе можно просто вызвать функцию [**ндфексекутедиагносис**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfexecutediagnosis) . Мастер NDF запустит и поможет пользователю определить (и, если возможно, и устранить) проблему. Функция будет возвращена после завершения этого процесса. Пользовательский интерфейс является необязательно модальным для приложения.

-   использование настраиваемого пользовательского интерфейса (только Windows 7 и более поздние версии)

    различные функции доступны для использования в сценариях, где не отображается пользовательский интерфейс или не используется стандартный Windows интерфейс (например, Media Center, встраиваемые приложения и командная строка). Этот параметр позволяет обойти функции взаимодействия с пользователем, предоставляемые мастером NDF, который позволяет ограничить результаты до полностью поддерживаемых основных причин, а также эвристику для предоставления пользователю возможности восстановления в рекомендуемом порядке. При использовании этих функций необходимо предоставить любую такую возможность самостоятельно. Кроме того, необходимо обеспечить освобождение памяти, используемой результатами диагностики.

    Чтобы начать диагностику, вызовите функцию [**ндфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) . Все найденные проблемы будут возвращены приложению в виде коллекции структур [**руткаусеинфо**](/windows/win32/api/ndattrib/ns-ndattrib-rootcauseinfo) , описывающих определенные основные причины и возможные варианты восстановления.

    После выбора восстановления (или запроса на выбор восстановления) следует вызвать [**ндфрепаиринЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) , чтобы попытаться восстановить и определить, была ли проблема устранена.

    В некоторых случаях восстановление может быть выполнено успешно, но проблема не будет устранена. В таких случаях рекомендуется закрыть существующий инцидент, а затем открыть новый. Это гарантирует, что все новые проблемы, снятые с помощью начального восстановления, будут идентифицированы. Например, предположим, что беспроводные сети не были видны. После сброса адаптера Беспроводные сети будут видны, но ни один из них не будет включен в список предпочтительных. Это новая проблема, которая потребует новой диагностики для обнаружения. Если такая вторая попытка диагностики не выявляет дополнительные проблемы, можно попробовать выполнить другое восстановление, чтобы устранить исходную проблему, или пользователь может сообщить о том, что проблему не удалось устранить.

    [**НдфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident) и [**ндфрепаиринЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfrepairincident) — это синхронные API. Если вы хотите отменить действие, инициированное этими функциями, вызовите [**ндфканцелинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcancelincident) из другого потока. Функция возвратится к следующей доступной точке останова в процессе диагностики или восстановления.

    В любой момент вы можете вызвать [**ндфжеттрацефиле**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfgettracefile) , чтобы получить копию журнала ndf для текущего сеанса диагностики и включить ее в журналы приложения. Журнал очищается после получения, и последующие вызовы будут получать только те события, которые произошли после последнего вызова этой функции.

## <a name="closing-an-incident"></a>Закрытие инцидента

После завершения диагностики инцидента вызовите [**ндфклосеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfcloseincident) , чтобы освободить системные ресурсы, связанные с выполнением диагностики для этого инцидента. (Обратите внимание, что это не освобождает объекты, созданные [**ндфдиагносеинЦидент**](/windows/desktop/api/Ndfapi/nf-ndfapi-ndfdiagnoseincident).
