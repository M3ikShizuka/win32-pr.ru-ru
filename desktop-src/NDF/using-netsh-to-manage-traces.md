---
title: Использование команды Netsh для управления трассировками
description: в Windows 7 netsh.exe можно использовать из командной строки для включения и настройки трассировки сети. В этом разделе описаны некоторые команды netsh.exe, которые могут помочь при устранении неполадок, связанных с трассировкой, включая новые функции трассировки Netsh.
ms.assetid: f0f0fc7b-7cfa-43c7-89a3-3b80050875f8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0c1cf869f60b69e227e78e19e8e05d3765ddb67d
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127067652"
---
# <a name="using-netsh-to-manage-traces"></a>Использование команды Netsh для управления трассировками

в Windows 7 netsh.exe можно использовать из командной строки для включения и настройки трассировки сети. В этом разделе описаны некоторые команды netsh.exe, которые могут помочь при устранении неполадок, связанных с трассировкой, включая новые функции **трассировки Netsh** . Обратите внимание, что команды netsh необходимо запускать из командной строки с повышенными привилегиями.

## <a name="collecting-traces"></a>Сбор трассировок

Сценарии — это предопределенные наборы поставщиков трассировки, которые можно включить для устранения неполадок. Чтобы отобразить список доступных сценариев, связанных с сетью, введите **netsh trace Показать сценарии** (для каждого из доступных поставщиков, включая те, которые не связаны с сетевыми подключениями, отображается список **поставщиков Netsh trace Показать поставщики** ).

После определения сценария, который будет иметь отношение к вашим проблемам, можно просмотреть список всех поставщиков, входящих в этот сценарий. Например, чтобы просмотреть всех поставщиков, включенных в сценарии InternetClient, введите **команду netsh trace показать сценарий InternetClient**.

Можно запустить трассировку для всех поставщиков в определенном сценарии или наборе сценариев. Например, чтобы запустить трассировку для всех поставщиков, включенных в сценарии InternetClient, введите **команду netsh trace Start Scenario = InternetClient**. Для сбора поставщиков в нескольких сценариях можно указать все соответствующие сценарии, такие как **netsh trace Start Scenario = филешаринг сценарий = DirectAccess**. Обратите внимание, что в каждый момент времени может быть включен только один сеанс трассировки. нельзя одновременно собирать данные трассировки из разных наборов поставщиков в отдельных файлах.

Можно также запустить трассировку для дополнительных поставщиков, не входящих в этот конкретный сценарий. Например, может потребоваться запустить трассировку для всех поставщиков, включенных в сценарии WLAN, а также поставщика DHCP. для этого введите **netsh trace start сценарий = wlan provider = Microsoft-Windows-Dhcp-Client**.

Можно также просмотреть дополнительные сведения о конкретном поставщике, введя **команду netsh trace Показать поставщик** , а затем имя поставщика.

Чтобы просмотреть все доступные параметры и фильтры, введите **команду netsh trace Start/?**.

Чтобы прерывать трассировку, введите **команду netsh trace останавливаться**.

## <a name="using-the-output-files"></a>Использование выходных файлов

Когда трассировка остановлена, по умолчанию создаются два файла: файл журнала трассировки событий (ETL) и файл .cab.

События трассировки собираются в ETL-файле, который можно просмотреть с помощью таких средств, как сетевой монитор. ETL-файл будет называться NetTrace. ETL по умолчанию. также можно указать другое имя, включив **TraceFile = filename. ETL** при запуске трассировки.

Файл .cab содержит подробные сведения о программном обеспечении и оборудовании в системе, такие как сведения о адаптере, сборка, параметры операционной системы и беспроводная связь. Файл .cab будет называться nettrace.cab по умолчанию, если не указано другое имя, как указано выше.

Этот файл .cab будет содержать два файла, имена которых всегда будут совпадать. Report. ETL — это еще одна копия той же информации, которая содержится в NetTrace. ETL. Файл report.html содержит дополнительные сведения о событиях трассировки и других собираемых данных. Чтобы получить наибольшую доступную информацию, включите команду **Report = Yes** при запуске трассировки.

## <a name="using-filters-to-reduce-the-amount-of-data-in-the-etl-trace-file"></a>Использование фильтров для уменьшения объема данных в файле трассировки ETL

Когда записи происходят в течение длительного периода времени, файл трассировки ETL может стать очень большим. В сценариях, в которых включен несколько поставщиков, что приводит к интенсивному трафику, ограничения буфера ETW могут привести к удалению некоторых трассировок. Помимо этого, уменьшение объема данных в файле трассировки ETL позволяет упростить устранение неполадок, уменьшая объем данных, которые необходимо проверить.

Для уменьшения размера файла трассировки ETL можно использовать команды netsh trace Filters. Эти фильтры трассировки являются уровнями ETW и ключевыми словами, которые можно применять к отдельным поставщикам.

Чтобы просмотреть список фильтров, которые можно применить, введите **команду netsh trace Start/?**

пример фильтра — **netsh trace start InternetClient provider = Microsoft-Windows-TCPIP level = 5 keywords = ut: рецеивепас, ut: сендпас**.

В этом примере уровень равен 5, что означает, что отображается максимальное число событий. В следующей таблице приведены доступные параметры.



| Level      | Параметр              | Описание                                                                           |
|-------|---------------|----------------------------------------------------------------------------|
| 1     | Критически важно      | Будут показаны только критические события.                                        |
| 2     | ошибки        | Будут показаны критические события и ошибки.                                  |
| 3     | Предупреждения      | Будут показаны критические события, ошибки и предупреждения.                       |
| 4     | Informational | Будут показаны критические события, ошибки, предупреждения и информационные события. |
| 5     | Подробный       | Будут показаны все события.                                                  |



 

Ключевые слова **UT: рецеивепас** и **UT: сентпас** отфильтровывают события для отображения только тех событий, которые отслеживаются по пути получения или отправки. Полный список ключевых слов для конкретного поставщика можно найти, введя **команду netsh trace показывать поставщик** , а затем имя поставщика. например, введите **netsh trace показать поставщик microsoft-Windows-tcpip** отобразит сведения о поставщике microsoft-Windows-tcpip, включая список ключевых слов.

Netsh также поддерживает возможность фильтрации пакетов (аналогично сетевой монитор) при включенной записи пакетов (установив **запись = Yes**). Фильтрацию пакетов можно использовать для записи ограниченного числа пакетов в файле трассировки. Например, **команда Netsh trace Start Capture = да IPv4. Address = = x. x. x. x** , где x. x. x. x — это IP-адрес, будет записывать только пакеты с трафиком IPv4 с указанным адресом источника или назначения.

Дополнительные сведения об использовании фильтрации пакетов можно ввести с помощью **команды netsh trace показывать каптурефилтерхелп**.

 

 




