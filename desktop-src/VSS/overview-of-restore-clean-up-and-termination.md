---
description: После восстановления средства записи проверяют состояние операции, чтобы можно было использовать восстановленные данные и обрабатывать ошибки.
ms.assetid: f9def67a-c4ea-4014-929f-51fbd10d770a
title: Общие сведения о сбросе и завершении восстановления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e8ad0b7d40f3c0e5322810f96bb120f28effe4ec3f0d4e278af924962713b2c
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118122036"
---
# <a name="overview-of-restore-clean-up-and-termination"></a>Общие сведения о сбросе и завершении восстановления

После восстановления средства записи проверяют состояние операции, чтобы можно было использовать восстановленные данные и обрабатывать ошибки. Инициатор запроса должен дождаться завершения этого действия. Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).

В следующей таблице показана последовательность действий и событий, необходимых после выполнения операции восстановления.



| Действие запросившего                                                                                                                                                                                                                                                                                                                                                              | Событие                                                           | Действие записи                                                                                                                                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Инициатор запроса указывает на окончание восстановления (см. раздел [**ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).                                                                                                                                                                                                                                           | [*Восстановление после восстановления*](vssgloss-p.md) | Модуль записи выполняет очистку после восстановления и обрабатывает сбои восстановления и файлы, восстановленные в нестандартном расположении (см. раздел [**квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)). |
| Инициатор запроса ждет, пока модули записи не обрабатывали [**событие**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) [**ивссасинк**](/windows/desktop/api/Vss/nn-vss-ivssasync). Он также должен проверить состояние модуля записи (см. раздел [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**Ивссбаккупкомпонентс:: жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)). | Нет                                                            | Нет                                                                                                                                                                                                                                               |
| Инициатор запроса освобождает интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .                                                                                                                                                                                                                                                                                    | Нет                                                            | Нет                                                                                                                                                                                                                                               |



 

## <a name="requester-actions-during-cleanup-and-termination"></a>Действия запросившего во время очистки и завершения

На этом этапе инициатор запроса указывает на завершение действий по восстановлению файла путем создания события [*восстановления*](vssgloss-p.md) путем вызова [**Ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).

Действия запросившего ограничены модулями записи, для которых может потребоваться выполнение некоторой финальной очистки и обработка ошибок восстановления, а также освобождение интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) после того, как все модули записи будут возвращены после обработки события, выполняемого методом [*RESTORE*](vssgloss-p.md) .

## <a name="writer-actions-during-cleanup-and-termination"></a>Действия модуля записи во время очистки и завершения

Событие [*RESTORE*](vssgloss-p.md) обрабатывается виртуальным методом [**квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore). Реализация по умолчанию просто возвращает **значение true** , не принимая никаких действий. Если модуль записи должен повысить управляемость ситуации, выполняемой после восстановления, он может переопределить этот метод.

Помимо обычной очистки (например, удаления временных файлов), которую модуль записи может выполнять в [**квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), он может справиться с успешным или неудачным выполнением операций восстановления.

Как он обрабатывает ошибки восстановления, файлы, восстановленные в альтернативное расположение, и потребность в будущих восстановлениях, совершенно достаточно для пользователя. Типичные действия могут включать сравнение файлов в альтернативных или новых местах с файлами, используемыми в данный момент, объединением данных из нескольких файлов или запуском новых сеансов, подключенных к новым файлам данных. Служба VSS предоставляет следующие механизмы для поддержки этого компонента в зависимости от компонента:

-   Успех или неудача при восстановлении любого компонента можно найти с помощью [**ивсскомпонент:: жетфилересторестатус**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).
-   Использование сопоставлений альтернативного расположения в восстановленных файлах будет отмечено [**ивсскомпонент:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).
-   Определение, является ли восстановление добавочным и потребует дальнейших восстановлений путем вызова [**ивсскомпонент:: жетаддитионалресторес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores). Модули записи, которым требуется полное восстановление данных, не должны перезапускаться, пока этот метод не вернет значение false.
-   Модули записи могут определить, нужен ли инициатору запроса для восстановления файлов в ранее неопределенном расположении с помощью [**ивсскомпонент:: жетневтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) и [**Ивсскомпонент:: жетневтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)

(Дополнительные сведения о восстановлении файлов в расположениях, отличных от по умолчанию, см. в разделе [расположения резервного копирования и восстановления не по умолчанию](non-default-backup-and-restore-locations.md).)

Как и для любого метода [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , сведения, возвращаемые данным экземпляром, применяются к компонентам, [*явным образом включенным*](vssgloss-e.md) для резервного копирования, и к любому из его [*неявного включения*](vssgloss-i.md) для резервного копирования, включая эти подкомпоненты, явно включенные для восстановления инициатором запроса с помощью [**ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (Дополнительные сведения см. в разделе [Работа с выборкой для восстановления и подкомпонентов](working-with-selectability-for-restore-and-subcomponents.md) .

Поскольку потокам записи требуется доступ к документу компонентов резервного копирования, важно, чтобы инициатор запроса не освободил интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , пока поток не завершит обработку.

 

 



