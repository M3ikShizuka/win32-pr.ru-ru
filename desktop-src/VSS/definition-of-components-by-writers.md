---
description: Компоненты определяются и создаются модулями записи в своем документе метаданных модуля записи в ответ на событие Identify в начале операции резервного копирования (см. раздел Обзор инициализации резервного копирования) при заполнении документа метаданных модуля записи.
ms.assetid: 5e1c3f9b-ca83-4e70-963b-0a237c6f4b0d
title: Определение компонентов по модулям записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa5383e9bc87620f23bb2a3ab067c1913a323782
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103913380"
---
# <a name="definition-of-components-by-writers"></a>Определение компонентов по модулям записи

Компоненты определяются и создаются модулями записи в своем документе метаданных модуля записи в ответ на [*событие Identify*](vssgloss-i.md) в начале операции резервного копирования (см. раздел [Обзор инициализации резервного копирования](overview-of-backup-initialization.md)) при заполнении документа метаданных модуля записи.

При создании компонента в документе метаданных модуля записи с помощью [**ивсскреатевритерметадата**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata) и [**Ивсскреатевритерметадата:: AddComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addcomponent)модуль записи должен указывать:

-   Возможность [ *выбора компонента для резервного копирования*](vssgloss-s.md)
-   Тип компонента
-   Имя компонента (которое должно быть уникальным не только в пределах данного [*экземпляра модуля записи*](vssgloss-w.md) , но и во всех экземплярах модуля записи)
-   Связаны ли с компонентом связанные с записью метаданные, относящиеся к записи
-   Требуется ли для модуля записи уведомление после успешной архивации

Модули записи могут дополнительно указывать:

-   [*Логический путь*](vssgloss-l.md) компонента (который должен быть уникальным не только в пределах данного экземпляра модуля записи, но и во всех экземплярах модуля записи)
-   Описание компонента (или заголовок)
-   Значок, используемый с GUI для обозначения компонента

Компонент не обязательно должен содержать какие-либо файлы. Такой вид пустого или фиктивного компонента может быть полезен при Организации компонентов. Такой компонент можно использовать для определения [*набора компонентов*](vssgloss-c.md) и компонента записи (см. раздел [логическое расположение компонентов](logical-pathing-of-components.md)).

## <a name="setting-up-component-organization"></a>Настройка организации компонентов

Настройка [*выбора*](vssgloss-s.md) компонента (его [*Выбор для резервного копирования*](vssgloss-s.md)и возможность [*выбора для восстановления*](/windows)) и его [*логических путей*](vssgloss-l.md) позволяет модулю записи затребовать или сделать необязательным включение определенных компонентов в операции резервного копирования или восстановления, а также сгруппировать компоненты в [*Наборы компонентов*](vssgloss-c.md) с одним выбираемым компонентом, действующим в качестве точки входа для всей группы.

Членство в этих группах определяет, какие компоненты будут использоваться во время операций резервного копирования и восстановления. Использование "выбираемого" значения для получения резервной копии для операции резервного копирования и выбора для восстановления для операции восстановления позволяет разработчикам понять следующее:

-   Если выполняется резервное копирование любых компонентов, управляемых данным модулем записи, инициатор запроса должен [*явным образом включить*](vssgloss-e.md) все невыбираемые [*компоненты*](vssgloss-c.md) без выбора предков в свой [*логический путь*](vssgloss-l.md) к документу компонентов резервного копирования, а также выполнить резервное копирование и восстановление этих компонентов в виде группы.
-   Инициатор запроса имеет возможность явно добавить выбираемые компоненты в документ резервных копий во время операций резервного копирования и восстановления. После добавления компонента необходимо выполнить его резервное копирование или восстановление.
-   Если компонент является выбираемым, компонент и все его [*подкомпоненты*](vssgloss-s.md) (как определено логическими путями) формируют набор компонентов, который может рассматриваться как единый блок, который может участвовать в операциях резервного копирования и восстановления.
-   Инициатор запроса никогда не добавляет невыбираемый компонент с выбираемыми для выбора предками, подкомпонентом в наборе компонентов в документ компонентов резервного копирования во время операций резервного копирования и восстановления. Эти компоненты должны быть [*неявно включены*](/windows) в случае явного добавления их выбираемого предка. в этом случае необходимо выполнить резервное копирование или восстановление (см. раздел [Использование компонентов инициатором запроса](use-of-components-by-the-requestor.md)).
-   Выбираемый компонент с выбираемым предком по-прежнему является [*подкомпонентом*](vssgloss-s.md) (членом набора компонентов) и может быть неявно включен, если его выбираемый предок явно включен в операцию. В этом случае сведения о его данных не добавляются в документ компонентов резервного копирования. Если его выбираемый предок не включен в операцию, компонент можно явно выбрать для включения в операцию. в этом случае сведения о ней включаются в документ компонентов резервного копирования.
-   Вложенный компонент, неявно включенный в резервную копию, может быть явно включен в операцию восстановления независимо от состояния любого выбранного предка, если он можно выбрать для восстановления. Все подкомпоненты, которые можно выбрать для восстановления, включенные во время операции восстановления, должны содержать сведения, добавленные в документ компонентов резервного копирования.
-   Модуль записи, который не содержал компонент, явно добавленный в документ компонентов резервного копирования до создания [*PrepareForBackup*](vssgloss-p.md) и событий предварительного [*восстановления*](vssgloss-p.md) , не будет получать дополнительные события VSS.

Дополнительные сведения см. в разделе [Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md).

## <a name="adding-files-to-a-component"></a>Добавление файлов в компонент

Компонент содержит сведения о файле в виде [*набора файлов*](vssgloss-f.md) , который содержит:

-   Корневой каталог файлов в компоненте.
-   Спецификация файла для файлов в компоненте.
-   Флаг, указывающий, является ли спецификация компонента рекурсивной.

В зависимости от типа компонента, который может быть базой данных или файловой группой, и (в случае компонентов базы данных), следует ли загружать файлы данных или журналов, модуль записи вызывает [**ивсскреатевритерметадата:: аддфилестофилеграуп**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup), [**Ивсскреатевритерметадата:: адддатабасефилес**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles)или [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) для добавления набора файлов.

При использовании этих функций следует указать файлы, которые будут добавлены в набор файлов следующим образом:

-   *всзпас*: это путь к каталогу, содержащему файлы, которые необходимо добавить в набор файлов. Если параметр *брекурсиве* имеет значение **true**, параметр *всзпас* указывает иерархию каталогов для рекурсивного обхода, и все каталоги должны быть созданы заново, включая пустые каталоги.
-   *всзфилеспек*: Эта строка указывает файлы в каждом каталоге, которые будут добавлены в набор файлов.

Например, предположим, что существует следующая структура каталогов:

<dl> C: \\ Directory1 \\File1.txt  
C: \\ Directory1 \\File2.txt  
C: \\ Directory1 \\ Directory2 \\File1.txt  
C: \\ Directory1 \\ Directory2 \\File2.txt  
C: \\ Directory1 \\ Directory3\\  
</dl>

Если в модуле записи указано "C: \\ Directory1" для *всзпас*, "file1. \* " для *всзфилеспек* и **true** для *брекурсиве*, то запросивший должен включать следующие файлы:

<dl> C: \\ Directory1 \\File1.txt  
C: \\ Directory1 \\ Directory2 \\File1.txt  
</dl>

Если вместо этого в модуле записи указывается "C: \\ Directory1" для *всзпас*, " \* " для *Всзфилеспек*, а **true** для *брекурсиве*, запросивший должен включать следующие файлы:

<dl> C: \\ Directory1 \\File1.txt  
C: \\ Directory1 \\File2.txt  
C: \\ Directory1 \\ Directory2 \\File1.txt  
C: \\ Directory1 \\ Directory2 \\File2.txt  
</dl>

Если в модуле записи указано "C: \\ Directory1" для *всзпас*, \* "" для *всзфилеспек* и **false** для *брекурсиве*, то запросивший должен включать следующие файлы:

<dl> C: \\ Directory1 \\File1.txt  
C: \\ Directory1 \\File2.txt  
</dl>

Во всех приведенных выше примерах каждый раз, когда модуль записи указывает **значение true** для *брекурсиве*, следует создать пустой каталог C: \\ Directory1 \\ Directory3 \\ .

Для набора файлов, добавленного в компонент файловой группы, в случаях, когда файлы, находящиеся на диске, не находятся в том виде, в котором модуль записи рассматривает соответствующее расположение или местоположение по умолчанию, модуль записи имеет возможность добавить альтернативный путь. В этих случаях определение пути к набору файлов содержит обычное расположение файлов и место для восстановления файлов, а альтернативный путь содержит текущее расположение файлов для резервного копирования.

Все файлы в наборе файлов должны существовать во время резервного копирования. Запрашивающие стороны должны предположить, что все файлы, перечисленные в наборе файлов, необходимы для резервного копирования и при отсутствии каких бы то ни было файлов не будут создавать резервные копии. Обратите внимание, что если \* для параметра *всзфилеспек* задано значение, оно может сопоставлять ноль или более файлов.

Обратите внимание, что такие атрибуты документа метаданных модуля записи, как сопоставления альтернативного расположения, явно включенные и исключенные файлы, и методы восстановления задаются на уровне записи, а не на уровне компонента. (Дополнительные сведения см. [в разделе Работа с документом метаданных модуля записи](working-with-the-writer-metadata-document.md).)

## <a name="component-definition-for-backup-and-restore-operations"></a>Определение компонента для операций резервного копирования и восстановления

Операции восстановления и резервного копирования обязательно создают [*событие Identify*](vssgloss-i.md), и для резервного копирования и восстановления они будут обрабатываться одним и тем же методом [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .

Во время операций резервного копирования запрашивающие стороны используют сведения, возвращенные методами [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) средства записи, чтобы определить, какие модули записи имеются в системе, а затем определить, какие из них следует архивировать.

Во время операций восстановления информация, возвращаемая событием [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) средства записи, используется только для определения удостоверения и состояния модулей записи, имеющихся в системе в настоящее время. сведения о спецификации файла, созданные во время восстановления, не используются. Вместо этого для получения этих данных используются документы метаданных модуля записи, хранящиеся во время резервного копирования.

После создания в ходе операции резервного копирования сведения о компоненте модуля записи, а также остальные сведения о модуле записи сохраняются для получения поддержки операций восстановления. Обычно для хранения этих сведений отвечает инициатор запроса.

 

 
