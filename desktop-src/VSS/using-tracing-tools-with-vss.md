---
description: Чтобы получить данные трассировки для инфраструктуры VSS, можно использовать средство Всстраце, средство logman или средство tracelog.
ms.assetid: afe2a0ed-1a8e-4f8b-be9e-241d55cd9ef6
title: Использование средств трассировки с VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 073a2ae9ba2ba2771abdc37ff0291764ed5e9efd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104263099"
---
# <a name="using-tracing-tools-with-vss"></a>Использование средств трассировки с VSS

Чтобы получить данные трассировки для инфраструктуры VSS, можно использовать средство Всстраце, средство logman или средство tracelog. Всстраце доступен в пакете средств разработки программного обеспечения Microsoft Windows (SDK) и может использоваться для трассировки приложений VSS в Windows 7 и более поздних версиях операционной системы Windows. Logman — это контроллер трассировки для событий трассировки и счетчиков производительности; его также можно использовать для трассировки приложений VSS в Windows 7 и более поздних версиях операционной системы Windows. Tracelog входит в комплект драйверов Windows (WDK).

Сведения об использовании средств трассировки с помощью [автоматического восстановления системы (ASR)](using-vss-automated-system-recovery-for-disaster-recovery.md)см. в статье [использование средств трассировки с приложениями ASR](using-tracing-tools-with-vss-asr-applications.md).

> [!Note]  
> Для всех Всстраце, Logman и tracelog требуются права администратора.

 

Сведения о каждом средстве см. в следующих разделах:

-   [Использование Всстраце](#using-vsstrace)
    -   [Параметры Command-Line Всстраце](#vsstrace-command-line-options)
-   [Использование программы Logman](#using-logman)
-   [Использование tracelog](#using-tracelog)

## <a name="using-vsstrace"></a>Использование Всстраце

Чтобы запустить средство Всстраце из командной строки, используйте следующий синтаксис:

 *Параметры командной строки* всстраце

Чтобы отобразить краткую справку командной строки для средства Всстраце, используйте следующий синтаксис:

**всстраце — Справка**

Чтобы отобразить подробную справку по командной строке для средства Всстраце, используйте следующий синтаксис:

**всстраце — Справка все**

### <a name="vsstrace-command-line-options"></a>Параметры Command-Line Всстраце

Средство Всстраце использует следующие параметры командной строки:

<dl> <dt>

<span id="-f_Flags"></span><span id="-f_flags"></span><span id="-F_FLAGS"></span>*Флаги* **-f**
</dt> <dd>

Включите модули, флаги которых задаются битовой маской *флагов* . Каждый флаг соответствует модулю VSS. Если *Флаги* равны нулю, модули не включены. Обратите внимание, что большинство модулей включено по умолчанию. Этот параметр можно сочетать с **+** параметром _module_ . Например, **всстраце-f 0 + WRITER + курд** отключает трассировку всех модулей, включенных по умолчанию, и позволяет отслеживать модули записи VSS и службу VSS. Кроме того, **всстраце + f 0xFFFF-курд** включает трассировку всех модулей, кроме службы VSS.

> [!Note]  
> Если параметр **-f** используется вместе с **+** параметром _module_ , то **-f** должен предшествовать **+** параметру _module_ .

 

В следующей таблице перечислены имя модуля и флаг для каждого доступного модуля.

| Модуль | Flag       | По умолчанию включено | Отслеживаемые элементы                                                                                                                                  |
|--------|------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| EXCEPT | 0x00000001 | Да                | Обработка исключений C++.                                                                                                                       |
| курд  | 0x00000002 | Да                | Служба VSS, которая также называется координатором VSS.                                                                                    |
| свпрв  | 0x00000004 | Да                | Служба поставщика теневого копирования системы VSS.                                                                                                  |
| букомп | 0x00000008 | Да                | Инициатор запроса VSS и обработка метаданных резервной копии.                                                                                             |
| WRITER. | 0x00000010 | Да                | Операции модуля записи VSS и реализации размещаемого модуля записи VSS, такие как модуль записи реестра Windows.                                             |
| вссапи | 0x00000020 | Да                | Различные функции API VSS, экспортированные VSSAPI.DLL.                                                                                |
| хвдиаг | 0x00000040 | Да                | Инфраструктура и операции поставщика оборудования VSS.                                                                                          |
| ADMIN  | 0x00000080 | Да                | Служебные программы командной строки VSS, такие как VSSADMIN.EXE и DISKSHADOW.EXE.                                                                           |
| вссуи  | 0x00000100 | Да                | Пользовательский интерфейс конфигурации теневые копии общих папок. Пользовательский интерфейс доступен только в операционных системах Windows Server.         |
| TEST   | 0x00000200 | Да                | Не применяется (Этот модуль трассировки зарезервирован.)                                                                                            |
| ЗАПРОС  | 0x00000400 | Да                | Сведения об операциях ФСКТЛ и IOCTL, инициированных службой VSS путем вызова функции [**DeviceIoControl**](/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol) . |
| ОПЕРАЦИЙ    | 0x00000800 | Да                | Общие служебные функции VSS, такие как распределительы, классы строковых классов, операции с реестром и томами.                                        |
| врксмл  | 0x00001000 | Нет                 | Обработка XML для метаданных модуля записи. Этот модуль имеет очень высокий уровень шума.                                                               |
| вссксмл | 0x00002000 | Нет                 | Базовые классы обработки XML. Этот модуль имеет очень высокий уровень шума.                                                                      |



 

</dd> <dt>

<span id="_Module"></span><span id="_module"></span><span id="_MODULE"></span>**+**_Модуль_
</dt> <dd>

Включите модуль, указанный *модулем*. В каждый момент времени можно включить несколько модулей. Чтобы получить список доступных модулей, введите в командной строке **всстраце – Help modules** .

</dd> <dt>

<span id="-Module"></span><span id="-module"></span><span id="-MODULE"></span>**-**_Модуль_
</dt> <dd>

Отключите модуль, указанный *модулем*. Чтобы получить список доступных модулей, введите в командной строке **всстраце – Help modules** .

</dd> <dt>

<span id="_pid_ProcessId"></span><span id="_pid_processid"></span><span id="_PID_PROCESSID"></span>**+ PID идентификатор** *процесса*
</dt> <dd>

Включите процесс, указанный в параметре *ProcessID*. Чтобы включить все процессы, используйте " \* " для значения *ProcessID*. В каждый момент времени можно указать несколько параметров **PID** . Порядок параметров определяет, какие процессы включены или отключены. Например, чтобы включить только процесс, идентификатор процесса которого — 0xe8c, используйте **всстраце-PID \* + PID 0xe8c**.

</dd> <dt>

<span id="-pid_ProcessId"></span><span id="-pid_processid"></span><span id="-PID_PROCESSID"></span>**-PID** *ProcessID*
</dt> <dd>

Отключите процесс, указанный в параметре *ProcessID*. Чтобы отключить все процессы, используйте " \* " для значения *ProcessID*. В каждый момент времени можно указать несколько параметров **PID** . Порядок параметров определяет, какие процессы включены или отключены. Например, чтобы отключить все процессы, кроме процесса, идентификатор процесса которого — 0xe8c, используйте **всстраце-PID \* + PID 0xe8c**.

</dd> <dt>

<span id="_tid_ThreadId"></span><span id="_tid_threadid"></span><span id="_TID_THREADID"></span>**+ tid** , *ThreadID*
</dt> <dd>

Включите поток, указанный в *ThreadID*. Чтобы включить все потоки, используйте " \* " для значения *ThreadID*. Одновременно может быть задано более одного параметра **tid** . Порядок параметров определяет, какие потоки включены или отключены. Например, чтобы включить только поток, идентификатор процесса которого — 0x31a, используйте **всстраце-TID \* + tid 0x31a**.

</dd> <dt>

<span id="-tid_ThreadId"></span><span id="-tid_threadid"></span><span id="-TID_THREADID"></span>**— tid** *ThreadID*
</dt> <dd>

Отключите поток, указанный в *ThreadID*. Чтобы отключить все потоки, используйте " \* " для значения *ThreadID*. Одновременно может быть задано более одного параметра **tid** . Порядок параметров определяет, какие потоки включены или отключены. Например, чтобы отключить все потоки, за исключением потока, идентификатор процесса которого — 0x31a, используйте **всстраце-TID \* + tid 0x31a**.

</dd> <dt>

<span id="-l_Level"></span><span id="-l_level"></span><span id="-L_LEVEL"></span> *уровень* l
</dt> <dd>

Используйте уровень трассировки, заданный параметром *Level*. Чем выше уровень, тем более подробные выходные данные трассировки. Каждый уровень включает все нижние уровни. Уровень по умолчанию — 170. Доступны следующие уровни.



| Level | Сведения, включаемые в выходные данные трассировки |
|-------|------------------------------------------|
| 000   | Нет                                     |
| 020   | Неустранимые ошибки                             |
| 030   | необработанных исключений.                     |
| 040   | ошибки                                   |
| 050   | Утверждения                               |
| 060   | Предупреждения                                 |
| 080   | Обработка исключений                       |
| 100   | Действие "журнал событий"                       |
| 120   | Общие сведения                      |
| 140   | поток кода.                                |
| 160   | Вход и выход из функции                  |
| 170   | Возвращаемые значения функции                   |
| 180   | Параметры функции (сжатые)              |
| 190   | Параметры функции (verbose)            |
| 200   | Подробный уровень информации 1              |
| 210   | Подробный уровень информации 2              |
| 220   | Подробный уровень информации 3              |
| 230   | Быстрый уровень кода 1                        |
| 240   | Быстрый уровень кода 2                        |
| 250   | Быстрый уровень кода 3                        |
| 255   | Все                                      |



 

</dd> <dt>

<span id="_indent"></span><span id="_INDENT"></span>**+ отступ**
</dt> <dd>

Отступ форматированного вывода трассировки для каждой функции и границы подфункции.

</dd> <dt>

<span id="-indent"></span><span id="-INDENT"></span>**— отступ**
</dt> <dd>

Не изменять отступ форматированного вывода трассировки.

</dd> <dt>

<span id="-etl_EtlFile"></span><span id="-etl_etlfile"></span><span id="-ETL_ETLFILE"></span>**-ETL** *етлфиле*
</dt> <dd>

Преобразование выходного файла logman, указанного параметром *етлфиле* , в текстовый формат для чтения.

</dd> <dt>

<span id="-o_OutputFile"></span><span id="-o_outputfile"></span><span id="-O_OUTPUTFILE"></span>**-o** *выходной_файл*
</dt> <dd>

Сохраните данные трассировки в выходной файл, указанный в файле *выходной_файл*. Для лучшей производительности выходной файл должен находиться на томе, который не является частью теневой копии.

</dd> <dt>

<span id="-help_HelpOption"></span><span id="-help_helpoption"></span><span id="-HELP_HELPOPTION"></span>**-Help** *хелпоптион*
</dt> <dd>

Отобразить справку командной строки, указанную параметром *хелпоптион*. Допустимые значения *хелпоптион* : **modules**, **Levels** и **ALL**. Указание **модулей** вызывает перечисление модулей. Задание **уровней** приводит к отображению доступных уровней. Указание параметра **ALL** приводит к отображению подробной справки. Если параметры не используются, отображается краткая справка.

</dd> </dl>

## <a name="using-logman"></a>Использование программы Logman

В следующей процедуре описывается использование программы Logman с приложением VSS.

**Использование программы Logman с приложением VSS**

1.  Чтобы начать трассировку, используйте следующую команду:

    **Logman Start VSS-o** *x: \\ * * * VSS. ETL-ETS-p {9138500e-3648-4edb-aa4c-859e9f7b7c38} 0xfff 170**

    > [!Note]  
    > Замените "x: \\ " на путь к каталогу, в котором должен храниться файл журнала трассировки.

     

2.  Чтобы прерывать трассировку, используйте следующую команду:

    **Logman останавливает VSS-ETS**

Файл журнала трассировки — *x: \\* VSS. ETL.

Дополнительные сведения о средстве Logman см. в разделе [Logman](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc753820(v=ws.11)).

## <a name="using-tracelog"></a>Использование tracelog

В следующей процедуре описывается использование tracelog.

**Использование tracelog**

1.  Создайте текстовый файл с именем VSS. CTL, который содержит только следующий текст:

    **9138500e-3648-4edb-aa4c-859e9f7b7c38 VSS**

2.  Чтобы начать трассировку, используйте следующую команду:

    **tracelog-Start VSS-f** *x: \\ * * * VSS. ETL-GUID VSS. CTL-флаг 0xFF-Level 0xAA**

    > [!Note]  
    > Замените "x: \\ " на путь к каталогу, в котором должен храниться файл журнала трассировки.

     

3.  Чтобы прерывать трассировку, используйте следующую команду:

    **tracelog — останавливает VSS**

Файл журнала трассировки — *x: \\* VSS. ETL.

Дополнительные сведения о средстве tracelog см. в разделе [tracelog](https://msdn.microsoft.com/library/ms797927.aspx).

 

 
