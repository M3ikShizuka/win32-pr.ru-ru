---
description: Направленный целевой механизм позволяет модулям записи сопоставлять файлы во время восстановления.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Работа с направленными целями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104072760"
---
# <a name="working-with-directed-targets"></a>Работа с направленными целями

[*Направленный целевой*](vssgloss-d.md) механизм позволяет модулям записи сопоставлять файлы во время восстановления. Это позволяет модулям записи выполнять следующие действия:

-   Укажите новые целевые расположения (аналогично Ивссбаккупкомпонентс инициатора запроса [**:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).
-   Освободите место на диске, восстановив только необходимые части файла на диск, особенно при резервном копировании файла с помощью механизма [*частичного создания файлов*](vssgloss-p.md) .
-   Измените формат файла в соответствии с текущими потребностями.

Любой файл, который будет использоваться с направленной целевой операцией, должен иметь [*целевой объект восстановления*](vssgloss-r.md) , \_ направленный службой VSS RT \_ .

После установки того, что инициатор запроса может поддерживать направленную целевую операцию, модуль записи (при обработке события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) использует [**Ивсскомпонент:: Адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, управляющему файлом (или компонентом, определяющим набор компонентов, который содержит файл) для определения способа повторного сопоставления файла при восстановлении.

При использовании [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget)модули записи указывают имя файла и путь, используемые для резервного копирования файла, имя файла и путь к его назначению восстановления (эти значения могут совпадать с исходным именем и расположением файла), а также диапазонами исходных и целевых файлов.

Как и при выполнении частичных операций с файлами, списки диапазонов представляют собой пары смещений в копируемый файл (в байтах) и длину восстанавливаемого раздела (в байтах), смещение и длину, разделенные двоеточием, и каждую пару, разделенную запятой: *Offset1 ***:**_length1_*_,_* * Offset2 ***:**_length2_. Каждое значение представляет собой 64-разрядное целое число в шестнадцатеричном или десятичном формате.

Если модуль записи должен использовать направленный целевой механизм для восстановления файла в новое расположение, он вызывал [**ивсскомпонент:: адддиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) с исходным именем файла и путем и новым именем файла и путем, а также указать диапазоны исходных целевых объектов с нулевым смещением и длиной, равной значению для всего размера файла.

Например, если модуль записи должен иметь файл 200 000 деятелей, C: \\ вритердата \\ index. dat, восстановлен как C: \\ вритердата \\ олдиндекс. dat, строка исходного и целевого диапазона будет иметь значение "**0:204880**".

Чтобы переназначить большой файл с частичным резервным копированием, запрашивающий объект будет использовать исходный диапазон, используемый для резервного копирования файла, и диапазон назначения, который уменьшит размер файла. Данные исходного диапазона можно получить с помощью [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, который управляет файлом (или компонентом, определяющим набор компонентов, который содержит файл).

Если частично заархивированный файл изначально был файлом большого размера, заголовок, байт 64-512, содержит число записей, а также другие часто обновляемые сведения, а последние данные находятся в файле последних 65536 байт — байт, 0x1239E8577A в 0x1239E7577A, средство записи может указать список исходных диапазонов в виде строки "**64:448, 0x1239E8577A: 65536**."

Если модуль записи хочет сопоставить восстановленный файл с только заголовком и последними данными, то список диапазонов может быть строкой "**0:488488:65536**.".

Перед фактическим выполнением операции восстановления инициатор запроса должен проверить, требует ли какие-либо файлов поддержку направленной цели.

Для этого инициатор запроса сначала выполняет перебор модулей записи с хранимыми компонентами в своем документе компонентов резервного копирования с помощью [**ивссбаккупкомпонентс:: жетвритеркомпонентскаунт**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) и [**Ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).

Затем интерфейс [**ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) используется для возврата экземпляров интерфейса [**ивссвритеркомпонентсекст**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , который предоставляет методы [**ивссвритеркомпонентсекст::-Component**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) и [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) , позволяющие инициатору запроса получать экземпляры [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .

Это позволяет инициатору запроса получать направленные целевые кандидаты с помощью [**ивсскомпонент:: жетдиректедтаржеткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) и [**Ивсскомпонент:: Жетдиректедтаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) для экземпляра [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , соответствующего компоненту, который управляет файлом (или компонентом, определяющим набор компонентов, который содержит файл).

 

 
