---
description: У запрашивающих стороны есть основная ответственность за жизненный цикл документа резервных компонентов.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Жизненный цикл документа компонентов резервного копирования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127461362"
---
# <a name="backup-components-document-life-cycle"></a>Жизненный цикл документа компонентов резервного копирования

У запрашивающих стороны есть основная ответственность за жизненный цикл документа резервных компонентов.

Этот элемент управления используется экземпляром объекта интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , возвращенного [**креатевссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).

Перед резервным копированием или восстановлением инициатор запроса должен инициализировать документ компонентов резервного копирования, вызвав [**ивссбаккупкомпонентс:: инитиализефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) или [**Ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore). Инициатор запроса может инициализировать документ как пустой или загрузить ранее сохраненную копию документа.

Для операций резервного копирования документ компонентов резервного копирования обычно инициализируется как пустой. В процессе обработки резервной копии его данные будут заполняться в ходе взаимодействия с системными модулями записи.

Для операций восстановления документ компонентов резервного копирования, как правило, инициализируется из сохраненного документа, созданного во время первоначального резервного копирования. Это позволяет выполнить восстановление (вместе с проверкой сохраненных документов для записи метаданных), чтобы определить, какие данные были изначально архивированы и как они должны быть восстановлены.

Резервное копирование [*переносимых теневых копий*](vssgloss-t.md) является исключением из этого правила. В этом случае теневая копия могла быть перемещена из одной системы (где она была создана вместе с исходным документом компонентов резервного копирования) на другую с помощью повторного назначения логического устройства общего хранилища. Чтобы создать резервную копию в этих обстоятельствах, инициатор запроса загружает сохраненное состояние резервного копирования и переходит с того места, где была отключена начальная система. (Дополнительные сведения см. в разделе [Импорт переносимых теневых скопированных томов](importing-transportable-shadow-copied-volumes.md).)

В процессе обработки резервной копии инициатор запроса решает, какие компоненты на самом деле копируются на основе того, какие компоненты помечены как [*выбираемые для резервного копирования*](vssgloss-s.md), [*логические пути*](vssgloss-l.md)компонента и собственная внутренняя логика.

Некоторые компоненты будут [*явно включаться*](vssgloss-e.md) в операцию резервного копирования. сведения о компоненте будут добавлены в документ компонентов резервного копирования. Другие будут [*неявно включаться*](vssgloss-i.md) в резервную копию; сведения о добавленных компонентах не будут добавлены в документ компонентов резервного копирования.

Все компоненты модуля записи, невыбираемые для компонентов резервного копирования без выбора предка в их логическом пути и выбираемые для компонентов резервного копирования, которые инициатор запроса выбирает, будут добавлены явным образом.

Как невыбираемые, так и невыбираемые для компонентов резервного копирования можно добавлять неявно, если в их логическом пути есть выбираемый предок, который явно включен в резервную копию. Эти компоненты ([*подкомпоненты*](vssgloss-s.md)) являются членами [*наборов компонентов*](vssgloss-s.md) , определенных их выбираемым предком.

При обработке операций восстановления инициатор запроса использует возможность [*выбора для восстановления*](vssgloss-s.md) вместо выбора для резервного копирования вместе со сведениями о логическом пути и собственной внутренней логикой для выбора восстанавливаемых файлов.

Если компонент, который был неявно добавлен в резервную копию, теперь будет явно добавлен к восстановлению, инициатор запроса обновит в документе компоненты резервного копирования сведения о компоненте.

Сведения о хранимых компонентах доступны как для запросов, так и для модулей записи через экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .

Это осуществляется через интерфейсы [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , которые средства записи могут запрашивать и (до конца событий [**моментального снимка**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) и события, [**восстановите**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) в документе резервные копии компонентов.

При вызове обработчика событий [**квссвритер:: онпрепаребаккуп**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**Квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**квссвритер:: Онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**квссвритер:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)или [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) средство записи получает экземпляр интерфейса [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .

Обратите внимание, что после создания события [**Баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) документ резервного копирования становится доступен только для чтения, поэтому [**Квссвритер:: онбаккупкомплете**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) не может использовать интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) для его изменения.

С помощью интерфейса [**ивссвритеркомпонентс**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) модуль записи может извлекать экземпляры интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , который позволит ему получить доступ ко всем компонентам, явным образом добавленным в документ компонентов резервного копирования, и изменить их состояние. Дополнительные сведения см. в разделе Общие сведения об [обработке резервной копии в VSS](overview-of-processing-a-backup-under-vss.md) и [Обзор обработки восстановления в VSS](overview-of-processing-a-restore-under-vss.md).

Документы компонентов резервного копирования удаляются из памяти при освобождении интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) и должны храниться с помощью [**Ивссбаккупкомпонентс:: савеасксмл**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), иначе все данные будут потеряны.

Кроме того, при правильном освобождении документа [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) создается событие [**баккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) и удаляются [*теневые копии автоматического выпуска*](vssgloss-a.md) .

 

 



