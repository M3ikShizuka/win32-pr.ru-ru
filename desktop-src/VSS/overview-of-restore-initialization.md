---
description: При инициализации операции восстановления VSS инициатору запроса необходимо получить документ компонента резервного копирования и каждый соответствующий документ метаданных модуля записи, созданный и сохраненный во время операции резервного копирования.
ms.assetid: 0a087125-c9d4-460a-8153-3e2e26633ac2
title: Общие сведения об инициализации восстановления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6eb62e5282a74e38cd53d36c8ba004f4b8069746
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156115"
---
# <a name="overview-of-restore-initialization"></a>Общие сведения об инициализации восстановления

При инициализации операции восстановления VSS инициатору запроса необходимо получить документ компонента резервного копирования и каждый соответствующий документ метаданных модуля записи, созданный и сохраненный во время операции резервного копирования. Текущее состояние модуля записи будет запрошено при обработке [*события Identify*](vssgloss-i.md) , формируемого инициатором запроса. Дополнительные сведения см. в разделе Общие сведения об [обработке восстановления в VSS](overview-of-processing-a-restore-under-vss.md).

В следующей таблице показана последовательность действий и событий, необходимых для инициализации операции восстановления.



| Действие запросившего                                                                                                                                                                                                                                                                                                       | Событие                                                     | Действие записи                                                                                                                                                                                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Создание интерфейса [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , его инициализация для управления восстановлением и загрузка сохраненных метаданных инициатора запроса (см. раздел [**креатевссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents), [**ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore)). | Нет                                                      | Нет                                                                                                                                                                                                                                                                                                                      |
| Вызовите [**креатевссексаминевритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) , чтобы создать интерфейсы [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) и загрузить их с помощью хранимых метаданных модуля записи.                                                                                                           | Нет                                                      | Нет                                                                                                                                                                                                                                                                                                                      |
| Инициация асинхронного обращения с модулями записи (см. [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata).)                                                                                                                                                                      | [*Указывается*](vssgloss-i.md) | Модуль записи начинает обработку событий при поддержке восстановления. Создает документ метаданных модуля записи (см. раздел [Работа с документом метаданных модуля записи](working-with-the-writer-metadata-document.md), [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify), [**ивсскреатевритерметадата**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscreatewritermetadata)). |
| Инициатор запроса ожидает инициализации модулей записи путем вызова [**ивссасинк**](/windows/desktop/api/Vss/nn-vss-ivssasync).                                                                                                                                                                                                                               | Нет                                                      | Нет                                                                                                                                                                                                                                                                                                                      |



 

## <a name="requester-actions-during-restore-initialization"></a>Действия запрашивающего во время инициализации восстановления

На этапе инициализации восстановления инициатору запроса должен быть предоставлен доступ к документу сохраненных компонентов резервного копирования и всем документам метаданных модуля записи.

В зависимости от реализации это означает, что инициатор запроса потребует, чтобы носитель резервной копии был подключен и доступен для чтения, либо был доступен другой механизм доступа к сохраненным метаданным.

Запрашивающий объект использует сохраненный XML-документ, содержащий компонент резервного копирования, который содержит документ, который выполнил резервное копирование, чтобы инициализировать его компоненты резервного копирования с помощью [**ивссбаккупкомпонентс:: инитиализефорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore) , может получить доступ к данным.

Как и в случае резервного копирования, документ компонентов резервного копирования содержит недостаточные сведения для поддержки восстановления. Таким образом, инициатору запроса требуется доступ к этим документам метаданных модуля записи, хранящимся во время резервного копирования (см. раздел [Использование компонентов инициатором запроса](use-of-components-by-the-requestor.md)).

Инициатор запроса получает метаданные сохраненной записи, вызывая [**креатевссексаминевритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssexaminewritermetadata) для каждого модуля записи, чьи данные были сохранены и которые теперь должны быть восстановлены. Эта функция создает объект [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) для каждого модуля записи и загружает в объект документ метаданных модуля записи модуля записи.

Как и во время резервного копирования, чтобы начать сотрудничество между собой и модулями записи системы, инициатор запроса должен создать событие [*идентификации*](vssgloss-i.md) путем вызова [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata). Не нужно вызывать метод [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) после завершения [**гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata). Модули записи, которые не обрабатывали событие [*определения*](vssgloss-i.md) , не будут включаться в список модулей записи, предоставляющих метаданные, возвращаемые [**Ивссбаккупкомпонентс:: жетвритерметадатакаунт**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadatacount) и [**ивссбаккупкомпонентс:: Жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (см. раздел [Определение состояния модуля записи](determining-writer-status.md)).

Как и в случае с операцией резервного копирования, инициатору запроса потребуется запросить и проанализировать сведения в документе о компонентах резервного копирования и сравнить их с данными в документах метаданных модуля записи, чтобы определить, какие компоненты были скопированы, и выбрать восстанавливаемые данные (см. [Обзор подготовки к](overview-of-preparing-for-restore.md)восстановлению). Кроме того, инициатору запроса потребуется создать подробный список, содержащий сведения о файлах на носителе резервных копий, выбранном для восстановления, а также о том, как и где они будут восстановлены. (См. раздел [Создание набора восстановления](generating-a-restore-set.md).)

Поэтому некоторые приложения резервного копирования могут оказаться полезными для хранения на носителе резервных копий (в собственном оптимизированном формате) файлов и связанных с ними модулей записи, компонента, процедуры восстановления и сведений о расположении. Этот список можно использовать для снижения объема синтаксического анализа и сравнения документов метаданных модуля записи и документов компонентов резервного копирования, необходимых для поддержки восстановления.

## <a name="writer-actions-during-restore-initialization"></a>Действия модуля записи во время инициализации восстановления

Как и во время операции восстановления, в ответ на событие Identify служба VSS вызывает метод виртуального обработчика каждого средства записи [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify).

Обратите внимание, что приложения, отличные от текущего запрашивающего (например, системных приложений), могут создавать события, которые должны обрабатываться модулем записи. Кроме того, разработчик не может определить, какое приложение создало событие Identify, с помощью [**квссвритер:: \ Identify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) .

Учитывая, что при обработке операции восстановления модуль записи может получить несколько событий Identify, модули записи не должны задавать сведения о состоянии в обработчике [**квссвритер:: onidentify**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onidentify) . Вместо этого они должны использовать один и тот же алгоритм для создания документа метаданных модуля записи, как это было сделано во время операций резервного копирования (Дополнительные сведения см. в разделе [действия модуля записи во время инициализации резервной копии](overview-of-backup-initialization.md) ).

 

 



