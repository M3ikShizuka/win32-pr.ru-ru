---
description: Приложение резервного копирования (инициатор запроса) может завершить работу и не создавать событие Баккупкомплете.
ms.assetid: 8e6a1f4f-ba62-46ea-965e-b0c6526ece89
title: Обработка событий Баккупшутдовн
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 939e8e64ca9ee463b0b8331e607f8068c3325d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692918"
---
# <a name="handling-backupshutdown-events"></a>Обработка событий Баккупшутдовн

Приложение резервного копирования (инициатор запроса) может завершить работу и не создавать событие [*баккупкомплете*](vssgloss-b.md) . Приложение резервного копирования может завершиться со сбоем или быть завершено (например, в диспетчере задач) и не может вызывать [**ивссбаккупкомпонентс:: баккупкомплете**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete).

Таким образом, инфраструктура VSS (а не инициатор запроса) создает событие [*баккупшутдовн*](vssgloss-b.md) при освобождении экземпляра [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) , участвующего в резервной копии, независимо от того, освобождается ли он инициатором запроса или системой.

Если резервная копия продолжает работать правильно, модуль записи получит событие Баккупкомплете, за которым следует событие Баккупшутдовн.

Если операция прерывается (инициатор запроса создает [*событие Abort*](vssgloss-a.md) путем вызова [**Ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup)) или внезапно завершается ошибкой, модуль записи может получить только событие баккупшутдовн и не может получить другие события, выполняющие операции очистки. Чтобы определить, соответствует ли событие Баккупшутдовн надлежащей последовательности событий, или представляет непредвиденную ошибку в операциях резервного копирования, разработчику необходимо.

Обработчик событий Баккупшутдовн, [**квссвритер:: онбаккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown), получает \_ идентификатор VSS (GUID) набора теневых копий для завершения операции резервного копирования. Модуль записи может использовать этот параметр, чтобы определить, какая операция резервного копирования завершает работу, если она сохранила идентификатор набора теневых копий во время последовательности резервного копирования (например, из [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), [**квссвритер::**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)onfreezeи или [**квссвритер:: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot)) с помощью [**квссвритер:: жеткуррентснапшотсетид**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid).

Однако модуль записи не должен вызывать [**квссвритер:: жеткуррентснапшотсетид**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getcurrentsnapshotsetid) в [**Квссвритер:: онбаккупшутдовн**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown). Кроме того, **квссвритер:: жеткуррентснапшотсетид** не может вызываться после возврата [**Квссвритер:: онпостснапшот**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) .

Модуль записи может участвовать в нескольких операциях резервного копирования, и если событие Баккупшутдовн вызывается из-за внезапного завершения работы инициатора запроса, то \_ возвращенный идентификатор VSS может быть вызван другой операцией резервного копирования, в которую участвовал модуль записи.

 

 



