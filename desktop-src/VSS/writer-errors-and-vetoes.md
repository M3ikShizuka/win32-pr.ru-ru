---
description: Модуль записи может завершиться ошибкой для многочисленных программных причин.
ms.assetid: 50eced73-3917-4d7e-96cc-2d793b448738
title: Ошибки и запреты модуля записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c24c15ad10766fc6ec395ed058ab3cb72a689d9
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127242020"
---
# <a name="writer-errors-and-vetoes"></a>Ошибки и запреты модуля записи

Модуль записи может завершиться ошибкой для многочисленных программных причин. В этом случае он должен отменять текущую операцию резервного копирования, восстановления или теневого копирования путем вызова метода [**квссвритер:: сетвритерфаилуре**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-setwriterfailure) в одном из методов обработчика (например, [**квссвритер:: onfreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) или [**квссвритер:: Онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)) и возвращая **значение true**. При необходимости можно также задать строку сообщения об ошибке в ответ на условие сбоя в некоторых методах обработчика с помощью методов [**ивсскомпонентекс:: сетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setprepareforbackupfailuremsg), [**Ивсскомпонентекс:: сетпостснапшотфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-setpostsnapshotfailuremsg), [**IVssComponent:: SetPreRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setprerestorefailuremsg)и [**IVssComponent:: SetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setpostrestorefailuremsg) . Инициатор запроса может принять запрет или продолжить резервное копирование, игнорируя запрет.

Инициатор запроса должен проверить состояние модуля записи (с помощью [**ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) и [**Ивссбаккупкомпонентс:: жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)) после каждого создаваемого события.

В некоторых случаях сообщения об ошибках могут быть получены из этих сбоев (с помощью методов [**ивсскомпонентекс:: жетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg), [**Ивсскомпонент:: жетпрересторефаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getprerestorefailuremsg), [**IVssComponentEx:: GetPostSnapshotFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getpostsnapshotfailuremsg)и [**IVssComponent:: GetPostRestoreFailureMsg**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpostrestorefailuremsg) ), либо модуль записи может задать метаданные (с помощью [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata) и [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata) со сведениями о состоянии ошибки). Пример кода, демонстрирующий, как просмотреть такие сообщения об ошибках, см. в разделе [**ивсскомпонентекс:: жетпрепарефорбаккупфаилуремсг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponentex-getprepareforbackupfailuremsg).

В зависимости от состояния ошибки инициатор запроса или его оператор может перезапустить резервное копирование и теневую копию с любыми необходимыми изменениями в состоянии задания резервного копирования или системы.

Например, предположим, что [**жетвритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus) вернул следующее:

-   Служба **VSS \_ E \_ вритереррор \_ инконсистентснапшот** предлагает, что инициатор запроса может добавлять дополнительные тома к теневой копии.
-   Служба **VSS \_ E \_ вритереррор \_ retryingости** указывает, что повторная попытка без перенастройки может быть выполнена. Если модуль записи продолжит возвращать ошибку после нескольких повторных попыток, попробуйте перезапустить службу, в которой размещается модуль записи. Следующие модули записи размещаются в службе VSS: модуль записи реестра, модуль записи базы данных регистрации классов COM+, модуль записи оптимизации теневого копирования и модуль записи автоматического восстановления системы (ASR Writer). Если модуль записи принадлежит приложению, в котором размещается модуль записи в собственном процессе, попробуйте перезапустить приложение.

    **Windows Server 2003 и Windows XP:** следующие модули записи размещаются в службе VSS: модуль записи реестра, модуль записи базы данных регистрации классов COM+, модуль записи журнала событий приложений и модуль записи Microsoft SQL Server 2000 Desktop Engine (MSDE).

-   \_ \_ Состояние модуля записи \_ VSS \_ \_ в недоступном состоянии указывает, что модуль записи может достигнуть максимального количества доступных сеансов резервного копирования и восстановления, и повторная попытка может быть выполнена, когда система будет менее загружена.
-   Служба **VSS \_ E \_ вритереррор \_ Аутофресаурцес** или **VSS \_ e \_ вритереррор \_ timeout** может предложить сократить нагрузку на систему перед повторной попыткой
-   Служба **VSS \_ E \_ вритереррор \_ Нонретрябле** или **VSS \_ e \_ WRITER \_ \_** , скорее всего, покажет ошибку модуля записи настолько серьезно, что не попытается выполнить резервное копирование своих данных с помощью VSS.

В зависимости от того, какой модуль записи и какие компоненты их создают, это не всегда требуется для аварийного завершения работы приложения резервного копирования после запрета или ошибки.

Например, инициатор запроса может решить, что теневая копия предназначена для резервного копирования приложения а, а также от модуля записи для приложения резервного копирования B. В этом случае вполне допустимо продолжать резервное копирование приложения а, не пропуская запрет.

Ниже приведены примеры запрета записи.

-   Модуль записи отменяет процесс создания теневой копии, когда ему не удалось приостановить действия во время создания теневой копии. Это указывает на высокую вероятность того, что теневая копия является недопустимой, так как в состоянии замораживания произошла операция записи.
-   Приложение резервного копирования запросило теневую копию только тома C:, а модуль записи определяет, что теневая копия C: и D: предназначена для резервного копирования данных. В этом случае модуль записи отменяет. Приложение резервного копирования может проверить метаданные и определить, будет ли игнорироваться модуль записи или процесс создания теневой копии будет прерван и позднее перезапуститься.

 

 



