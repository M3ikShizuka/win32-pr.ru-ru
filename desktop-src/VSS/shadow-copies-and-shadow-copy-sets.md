---
description: Теневая копия — это моментальный снимок тома, который дублирует все данные, удерживаемые на этом томе, в один четко определенный момент времени. VSS определяет каждую теневую копию по постоянному идентификатору GUID.
ms.assetid: 8ef2478a-c8bc-4517-9a14-e1d9226ec4cd
title: Теневые копии и наборы теневых копий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 764478c371cf4a622612865ef7a529955780d82847125874253533d331c195f3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118998162"
---
# <a name="shadow-copies-and-shadow-copy-sets"></a>Теневые копии и наборы теневых копий

[*Теневая копия*](vssgloss-s.md) — это моментальный снимок тома, который дублирует все данные, удерживаемые на этом томе, в один четко определенный момент времени. VSS определяет каждую теневую копию по постоянному идентификатору GUID.

[*Набор теневых копий*](vssgloss-s.md) — это набор теневых копий различных томов, которые выполняются одновременно. VSS идентифицирует каждый набор теневых копий с помощью постоянного идентификатора GUID.

Как конкретный поставщик оборудования или программного обеспечения выбирает для реализации теневых копий по своему усмотрению. После создания теневой копии в системе доступны два образа тома, скопированного с помощью теневого копирования: исходный том, к которому можно обращаться по соглашению. и скопированные данные, к которым можно получить доступ через API VSS.

Это позволяет выполнять два набора действий одновременно:

-   Обычные приложения в системе можно быстро продолжить или возобновить с помощью исходного тома, обновив данные на диске.
-   Приложения, использующие API инициатора VSS для доступа к тому теневого копирования, могут выполнять резервное копирование или аналогичные операции.

Теневые копии не должны быть реализованы одинаковым образом для каждого файла, каталога или тома. Различные реализации механизма теневого копирования ([*поставщиков*](vssgloss-p.md)) могут использовать разные подходы к созданию теневой копии. Однако для всех приложений, использующих API VSS, все теневые копии должны отображаться одинаково.

сведения о реализации поставщика Windows по умолчанию см. в разделе [поставщик системы](providers.md).

## <a name="default-shadow-copy-state"></a>Состояние теневой копии по умолчанию

Несмотря на то, что файловая система очищает все буферы ввода-вывода перед созданием теневой копии, это не обеспечит надлежащей обработке незавершенных операций ввода-вывода.

Таким образом, предполагая, что в системе нет приложений с поддержкой VSS, данные в теневой копии говорят о том, что они находятся в [*состоянии сбоя*](vssgloss-c.md). Теневая копия в состоянии с состоянием отказоустойчивости содержит образ диска, аналогичный тому, который существовал после аварийного завершения работы системы. Все открытые файлы по-прежнему будут существовать на томе, но они не гарантируют освобождения незавершенных операций ввода-вывода или повреждения данных.

В то время как отказоустойчивое состояние не полностью связано со всеми проблемами, связанными с определением стабильного резервного набора данных (см. раздел [Общие проблемы резервного копирования томов](common-volume-backup-issues.md)), у него есть несколько преимуществ по сравнению с резервным набором данных, которые должны использоваться для выполнения стандартных операций резервного копирования.

-   Том, содержащийся в теневой копии (даже в состоянии отказоустойчивости), по-прежнему содержит все файлы. Резервный набор данных, созданный без теневой копии, не будет содержать все файлы, открытые во время резервного копирования. Файлы, удерживаемые во время операции резервного копирования, исключаются из резервной копии.
-   Теневая копия тома создается за один момент времени, а не путем обхода активной файловой системы, которая обычно требует гораздо больше времени.

Приложения в системе, не поддерживающие VSS, — текстовые редакторы и т. д., скорее всего, будут оставаться в состоянии сбоя. Однако приложения, поддерживающие VSS (модули записи), могут координировать свои действия, чтобы состояние их файлов в теневой копии было четко определено и согласовано.

## <a name="shadow-copy-freeze-and-thaw"></a>Замораживание и размораживание теневого копирования

Создание каждой операции теневого копирования VSS производится в скобках с помощью событий [*Freeze*](vssgloss-f.md) и [*разморозки*](vssgloss-t.md) , которые модули записи используют для помещения файлов в стабильное состояние до теневого копирования.

Наличие событий заморозки и разморозки в рамках модели VSS означает:

-   Обработка события Freeze означает, что те, кто разрабатывает модули записи, должны иметь четко разделенную точку в цикле резервного копирования, где они гарантируют, что все операции записи на диск останавливаются и что файлы находятся в четко определенном состоянии для резервного копирования.
-   Обработка события разморозки предоставляет механизму записи возможность возобновления записи на диск и очистки всех временных файлов или других временных сведений о состоянии, созданных в связи с теневой копией.
-   Окно по умолчанию между событиями замораживания и разморозки является коротким (обычно 60 секунд); Таким образом, может быть уменьшено фактическое прерывание любой службы, предоставляемой модулем записи.
-   Обработка других событий (например, Препарефорснапшот), предшествующих и следующих за событиями замораживания и разморозки, соответственно, обеспечивает необходимую гибкость, позволяющую авторам выполнять сложные операции для поддержки теневых копий.

 

 



