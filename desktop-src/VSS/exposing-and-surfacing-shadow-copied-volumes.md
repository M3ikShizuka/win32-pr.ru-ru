---
description: Помимо доступа через интерфейс Ивссбаккупкомпонентс с помощью объекта устройства копии, инициатор запроса может сделать теневую копию доступной для других процессов в качестве подключенного устройства только для чтения.
ms.assetid: 0898c2dc-992a-411b-81df-4f5e129f6a80
title: Предоставление и отображая теневых скопированных томов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d684aa9b696facaf1caa3aa3102c6b1d7fc37409
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105693646"
---
# <a name="exposing-and-surfacing-shadow-copied-volumes"></a>Предоставление и отображая теневых скопированных томов

Помимо доступа через интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) с помощью [*объекта устройства*](vssgloss-d.md)копии, инициатор запроса может сделать теневую копию доступной для других процессов в качестве подключенного устройства только для чтения.

Этот процесс называется [*предоставлением теневой копии*](vssgloss-e.md)и выполняется с помощью метода [**Ивссбаккупкомпонентс:: експосеснапшот**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot) .

Теневая копия может быть предоставлена как локальный том, назначенная буква диска или связанная с подключенной папкой, или как общая папка.

Чтобы проиллюстрировать это, рассмотрите возможность создания теневой копии тома в системе Експоседсис, подключенного к F:, \\ корневым каталогом которого являются каталоги дироне и диртво, а также файл филеоне.

## <a name="exposing-a-shadow-copy-locally"></a>Локальное предоставление теневой копии

При подключении в качестве локального тома корень теневой копии всегда отображается в точке подключения (буква диска или подключенная папка), и все теневые копии файлов видимы.

Если теневая копия была локально предоставлена через подключенную папку C: \\ шадовофф, можно найти все файлы на диске, подключенные к диску F: \\ на момент создания теневой копии, доступной в разделе C: \\ шадовофф. При проверке C: \\ шадовофф будут раскрыты два каталога, дироне и диртво и один файл филеоне в C: \\ шадовофф.

Для локального предоставления теневого копирования можно использовать следующие вызовы:

``` syntax
  IVssBackupComponents *pReq;
  VSS_ID snapID;
  PWSTR wszExposed;
  //    .
  //    .
  hr = pReg->ExposeSnapshot(
         snapID,                           // VSS_ID SnapshotId,
         NULL,                             // VSS_PWSZ wszPathFromRoot
         VSS_VOLSNAP_ATTR_EXPOSED_LOCALLY, // LONG lAttributes
         L"C:\ShadowOfF",                  // VSS_PWSZ wszExpose
         LPWSTR &wszExposed,               // VSS_PWSZ* pwszExposed
       );
```

Если теневая копия была успешно открыта локально, *всзекспосед* должна содержать строку расширенных символов "C: \\ шадовофф".

После этого теневая копия может быть недоступна путем вызова [**IVssBackupComponentsEx2:: унекспосеснапшот**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponentsex2-unexposesnapshot).

Локально можно предоставить доступ только к постоянным теневым копиям, то есть теневым копиям, созданным с помощью отката \_ CTX \_ NAS \_ или \_ \_ отката приложения CTX в VSS \_ .

## <a name="exposing-a-shadow-copy-as-a-remote-share"></a>Предоставление теневой копии в качестве удаленной общей папки

Кроме того, можно выбрать создание теневой копии диска, подключенного к \\ , в качестве удаленной общей папки, и предоставить только данные в разделе диртво в качестве общей папки диртвуфф.

В этом случае система может получить доступ к теневой копии файлов в папке F: \\ диртво, сопоставляя \\ \\ експоседсис \\ диртвуфф как сетевой диск.

Вызов для реализации удаленного доступа к теневой копии в качестве общей папки может быть следующим:

``` syntax
  IVssBackupComponents *pReq;
  VSS_ID snapID;
  LPWSTR wszExposed;
  //    .
  //    .
  hr = pReg->ExposeSnapshot(
               snapID,                            // VSS_ID SnapshotId,
               L"\dirTwo",                        // VSS_PWSZ wszPathFromRoot
               VSS_VOLSNAP_ATTR_EXPOSED_REMOTELY, // LONG lAttributes
               L"dirTwoOfF",                      // VSS_PWSZ wszExpose
               LPWSTR &wszExposed,                // VSS_PWSZ* pwszExposed
       );
```

Если теневая копия была успешно предоставлена удаленно, *всзекспосед* должна содержать строку расширенных символов "диртвуфф".

Любая система, в настоящее время сопоставленная с сетевой папкой Диртвуфф, может отключиться от нее, так как она может отключиться от любой обычной общей папки.

## <a name="surfacing-a-shadow-copy"></a>Отображая теневую копию

[*Область теневой копии*](vssgloss-s.md) , в которой находится теневая копия, известна пространству имен диспетчера подключений системы.

Это означает, что такие теневые копии можно найти так же, как и любой другой доступный, но еще не подключенный том — с помощью **финдфирстволуме** и **финднекстволуме**, например.

Очевидно, что теневые копии также отображаются на теневых копиях. Однако обратный порядок не обязательно должен быть истинным.

Если удаленная локально доступная теневая копия была отключена или система решила отсоединить удаленно открытую теневую копию, эта теневая копия больше не будет предоставляться. Тем не менее, если теневая копия сохранена, отображаются тома. Это означает, что они могут быть подключены так же, как и любые другие тома только для чтения.

 

 



