---
description: Существует множество причин, по которым запрашивающая сторона не должна иметь возможности восстановить файлы с резервного носителя в исходное расположение.
ms.assetid: 2a9cfd99-5a2c-4c0c-98ff-11c745298cda
title: Работа с альтернативными расположениями во время восстановления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 907732c7b4b97668f1a317f9e03c3ea35bdec9618ff0e3e3c1a2f1e319eb19fa
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119056152"
---
# <a name="working-with-alternate-locations-during-restore"></a>Работа с альтернативными расположениями во время восстановления

Существует множество причин, по которым запрашивающая сторона не должна иметь возможности восстановить файлы с резервного носителя в исходное расположение. Например, метод восстановления или целевой объект может потребовать такого восстановления, либо текущее расположение восстановления может быть занято и недоступно для записи.

Для таких случаев модуль записи может определить [*альтернативное сопоставление расположения*](vssgloss-a.md), нестандартное назначение восстановления, которое будет использоваться в особых обстоятельствах.

Термин альтернативное сопоставление местоположения, используемый в VSS, не следует путать с термином [*альтернативный путь*](vssgloss-a.md). Сопоставления альтернативного расположения используются только во время операций восстановления и ссылаются на альтернативное назначение для операций восстановления. Альтернативные пути используются только во время операций резервного копирования и относятся к альтернативному источнику, из которого производится резервное копирование.

Чтобы использовать сопоставления альтернативного расположения во время восстановления, инициатор запроса выдаст следующее (как правило, после создания события, выполняемого перед [**восстановлением**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ):

1.  Используя экземпляр интерфейса [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) , полученный путем извлечения сохраненного модуля записи, запросивший объект использует метод [**Ивссексаминевритерметадата:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) для получения сопоставлений альтернативного расположения модуля записи в качестве экземпляров интерфейса [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .

    > [!Note]  
    > Запросивший объект использует [**ивссексаминевритерметадата:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), а не [**Ивсскомпонент:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping). Первый из них Возвращает сопоставления альтернативного расположения, доступные для использования инициатором запроса. Второй используется для указания на то, что сопоставления альтернативного расположения фактически используются инициатором запроса.

     

2.  Вызов метода [**ивссексаминевритерметадата:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) возвращает экземпляр интерфейса [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) . Этот экземпляр содержит сведения о наборе файлов — путь, заданный [**ивссвмфиледеск::**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)Path, спецификацию файла, возвращаемой с помощью [**Ивссвмфиледеск:: жетфилеспек**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), и флаг рекурсии, полученный из [**ивссвмфиледеск:: жетрекурсиве**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive), соответствующий одному из добавленных наборов файлов (с помощью [**ивсскреатевритерметадата:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata:: AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles)или [**IVssCreateWriterMetadata:: AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) в один из компонентов, управляемых модулем записи

    Значение, возвращаемое функцией [**ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) , является сопоставлением альтернативного расположения для этого набора файлов.

3.  Сопоставления альтернативного расположения не содержат сведений о компонентах, поэтому необходимо сравнить сведения о наборе файлов (путь, спецификацию файла и флаг рекурсии), полученные путем вызова [**ивссексаминевритерметадата:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) , который содержится в компонентах модуля записи.

    Эти сведения можно найти, просматривая компоненты модуля записи и вызвав [**ивссексаминевритерметадата::-Component**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) , чтобы получить экземпляр интерфейса [**Ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) и использовать [**ивссвмкомпонент::-File**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) для получения экземпляра [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) , содержащего сведения о наборе файлов компонента.

    Когда сведения о наборе файлов, возвращаемые экземпляром [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) , получены из [**ивссексаминевритерметадата::**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) и [**ивссвмкомпонент:: Profiler**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) , полученных из экземпляра **ивссвмфиледеск** , производного от [**ивссвмфиледеск:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), обнаружен компонент, управляющий файлами с указанным сопоставлением с конкретным альтернативным расположением.

4.  После обнаружения компонента инициатор запроса может определить условия, при которых следует использовать альтернативное сопоставление расположения, выполнив следующие действия.

    -   Проверка метода восстановления компонента, полученного путем вызова [**ивссексаминевритерметадата:: жетресторемесод**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).
    -   Проверка того, переопределяет ли целевой объект восстановления метод Restore, вызывая [**ивсскомпонент:: жетресторетаржет**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).

        Если компонент, найденный в документе метаданных модуля записи, был [*явно включен*](vssgloss-e.md) в резервную копию, экземпляр интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) будет соответствовать этому компоненту. Если компонент был [*неявно включен*](vssgloss-i.md) в резервную копию, экземпляр **ивсскомпонент** будет соответствовать компоненту, определяющему набор компонентов, в котором компонент в документе метаданных модуля записи является подкомпонентом.

5.  С помощью этих сведений инициатор запроса может определить на уровне отдельных компонентов, если требуется восстановить заданный набор файлов данного компонента в назначение, определенное с помощью сопоставления альтернативного расположения.

6.  При использовании сопоставления альтернативного расположения запрашивающий объект учитывает дескриптор файла и рекурсивный флаг, а также использует путь, указанный в сопоставлении альтернативного расположения.

    Инициатор запроса указывает, что во время операции восстановления использовалось сопоставление альтернативного расположения, вызвав метод [**ивссбаккупкомпонентс:: аддалтернативелокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) с данными о расположении по умолчанию для набора файлов, используемое альтернативное расположение для восстановления и имя компонента.

    Если набор файлов был управляем компонентом, который был явно добавлен в резервную копию, будет использоваться это имя компонента. Если набор файлов был управляем компонентом, который был неявно включен в резервную копию, то используется имя компонента, определяющего набор компонентов, в котором компонент, управляющий набором файлов, является подкомпонентом.

Модули записи проверяют, восстанавливаются ли наборы файлов из одного из их компонентов в альтернативное сопоставление расположения путем вызова [**ивсскомпонент:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).

 

 



