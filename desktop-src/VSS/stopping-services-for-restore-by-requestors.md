---
description: Может потребоваться остановить службу до и перезапустить после операции восстановления.
ms.assetid: 111d1281-ad83-49bc-868c-1106a0e25a2a
title: Остановка служб для восстановления с помощью инициаторов запроса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aaa8051fc20c5ba1bd930da8c7da5c40829c07772572c2b1fb795250d34b8c92
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119511624"
---
# <a name="stopping-services-for-restore-by-requesters"></a>Остановка служб для восстановления с помощью инициаторов запроса

Может потребоваться остановить службу до и перезапустить после операции восстановления.

Как правило, остановка и запуск службы для поддержки восстановления выполняется модулем записи при обработке события, выполняемого перед [*восстановлением*](vssgloss-p.md) (с помощью [**Квссвритер:: онпрересторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore)), и события [*восстановления*](vssgloss-p.md) (с [**квссвритер:: онпостресторе**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore)).

Однако могут возникнуть ситуации, когда инициатору запроса необходимо явным образом отключить работающую службу. Модули записи указывают, есть ли в этом случае, задав в качестве аргумента метода Restore в методе \_ \_ \_ \_ ивсскреатевритерметадата:: сетресторемесод начальное значение Start Restore рме остановить или остановить восстановление VSS для \_ перечисления VSS \_ \_ \_ [**\_ ресторемесод \_ enum**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) , а также указать имя службы, которая должна быть остановлена. [](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-setrestoremethod)

Инициатор запроса получает сведения о методе RESTORE и имя службы, которая должна быть остановлена при работе с метаданными модуля записи с помощью метода [**ивссексаминевритерметадата:: жетресторемесод**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod) .

Важно, чтобы средство записи при указании имени останавливаемой службы использовало правильное известное имя этой службы. Неоднозначное или неверное имя может привести к тому, что инициаторы запросов останавливают неправильную службу или не смогут определить, какая служба должна быть остановлена.

После завершения операции восстановления запрашивающие стороны должны перезапустить службу.

Необходимо соблюдать осторожность при проектировании и реализации модулей записи, поддерживающих службы, которые запрашивающие стороны должны останавливаться и перезапускать. В частности, такие модули записи не должны быть частью службы, то есть сам модуль записи не нужно останавливать, а затем перезапускаться в ходе операции восстановления.

Модуль записи, процесс которого остановлен, будет иметь другой экземпляр модуля записи после перезапуска. Новый экземпляр модуля записи не будет принимать события VSS, предназначенные для исходного экземпляра модуля записи. В частности, если процесс экземпляра модуля записи остановлен после обработки события, созданного при предварительном восстановлении, новый экземпляр не будет принимать событие о восстановлении. Кроме того, VSS выдаст ошибку, указывающую на утрату записи участия в операции восстановления, и [**ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) может возвращать ошибку.

 

 



