---
description: При выполнении резервного копирования или восстановления VSS состояние системы Windows определяется как коллекция из нескольких ключевых элементов операционной системы и их файлов. Эти элементы всегда должны рассматриваться как единое целое при операциях резервного копирования и восстановления.
ms.assetid: 48721358-8450-462f-8f99-23e207311041
title: Резервное копирование и восстановление состояния системы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed61c3ccad51ebd8cd632fab292160c795741c9b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103812808"
---
# <a name="backing-up-and-restoring-system-state"></a>Резервное копирование и восстановление состояния системы

> [!Note]  
> Этот раздел относится к Windows Vista, Windows Server 2008 и более поздним версиям. Сведения о Windows Server 2003 см. [в статье резервное копирование и восстановление состояния системы в Windows server 2003 R2 и Windows server 2003 с пакетом обновления 1 (SP1)](backing-up-and-restoring-system-state-under-vss.md)

 

При выполнении резервного копирования или восстановления VSS состояние системы Windows определяется как коллекция из нескольких ключевых элементов операционной системы и их файлов. Эти элементы всегда должны рассматриваться как единое целое при операциях резервного копирования и восстановления.

> [!Note]  
> Корпорация Майкрософт не предоставляет техническую поддержку для разработчиков и ИТ-специалистов по внедрению оперативного восстановления состояния системы в Windows (все выпуски).

 

При резервном копировании и восстановлении состояния системы рекомендуемой стратегией является резервное копирование и восстановление системных и загрузочных томов в дополнение к файлам, перечисленным модулями записи состояния системы. Модули записи состояния системы — это модули записи, для которых в качестве атрибута [**\_ \_ типа использования VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_usage_type) задано значение VSS \_ UT \_ бутаблесистемстате или VSS \_ UT \_ системсервице.

> [!IMPORTANT]
> Если модуль записи VSS определяется [**\_ \_ типом использования VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_usage_type) как модуль записи состояния системы, он должен быть включен в резервную копию состояния системы, даже если он доступен для выбора.

 

В дополнение к перечислимым двоичным файлам операционной системы и драйверов, перечисленным модулями записи состояния системы, существуют некоторые другие файлы, которые необходимо архивировать как часть состояния системы.

Все компоненты, сообщаемые модулем записи состояния системы VSS, являются частью состояния системы, за исключением тех, для которых \_ \_ установлен флаг VSS CF не \_ \_ состояния системы.

Программы резервного копирования должны также установить раздел реестра **ластрестореид** . Дополнительные сведения см. в разделах [разделы реестра и значения для резервного копирования и восстановления](../backup/registry-keys-for-backup-and-restore.md).

> [!Note]  
> В Windows Vista, Windows Server 2008 и более поздних версиях имена и расположения некоторых системных файлов были изменены следующим образом.

 

## <a name="system-state"></a>Состояние системы

Для Windows Server 2012 и более поздних версий в дополнение к файлам, сообщаемым различными модулями записи состояния системы VSS, необходимо явно включать только следующие файлы лицензирования, а следующие файлы DRM необходимо исключить явным образом.

## <a name="windows-media-digital-rights-management-files"></a>Файлы цифровых Rights Management Windows Media

В Windows Server 2008 и более поздних версиях следующие файлы, включая все подкаталоги по следующему пути, исключаются из состояния системы и их не следует архивировать.

-   % Папка ProgramData% \\ \\ Windows \\ DRM\\

Это приводит к замене информации в разделе Windows Media Digital Rights Management [работы с файловой системой и функциями безопасности](working-with-file-system-and-security-features.md).

## <a name="performance-counter-configuration-files"></a>Файлы конфигурации счетчиков производительности

Файлы конфигурации счетчиков производительности находятся в каталоге% SystemRoot% \\ system32 \\ и имеют следующие имена:

<dl> Производительности? 00?. включая  
Perfc0??. включая  
Perfd0??. включая  
Perfh0??. включая  
Perfi0??. включая  
Prfc0???. включая  
Prfd0???. включая  
Prfh0???. включая  
Prfi0???. включая  
</dl>

Эти файлы изменяются только во время установки приложения и должны быть архивированы и восстановлены во время резервного копирования и восстановления состояния системы.

## <a name="iis-configuration-files"></a>Файлы конфигурации IIS

> [!Note]  
> В Windows Vista с пакетом обновления 1 (SP1) и более поздних версий не следует создавать резервные копии этих файлов. Вместо этого используйте модуль записи конфигурации IIS в Box. Дополнительные сведения об этом модуле записи см. [в разделе модули записи VSS в Box](in-box-vss-writers.md).

 

Ниже перечислены соответствующие файлы конфигурации IIS и их расположения.

-   Файл machine.config .NET FX находится в каталоге версий платформы.
-   Корневой web.config файл ASP.NET находится в каталоге версий платформы.
    > [!Note]  
    > Файлы конфигурации для .NET FX и ASP.NET находятся в каталоге версий платформы. Если на компьютере установлено несколько версий платформы, этот каталог будет содержать один файл конфигурации для каждой установленной версии.

     

-   Файл конфигурации центра IIS applicationHost.config находится в каталоге% WINDIR% \\ system32 \\ Inetsrv \\ config. Чтобы сервер понял этот файл конфигурации, существуют файлы схемы, определяющие его грамматику и структуру. Эти файлы находятся в \\ \\ \\ каталоге схемы конфигурации% WINDIR% system32 Inetsrv \\ .

Путь к каталогу версии платформы хранится в следующем разделе реестра:

**HKEY \_ по для локального \_ компьютера \\ \\ Майкрософт \\ . NETFramework \\ InstallRoot**

Кроме того, необходимо создать резервную копию следующих ключей шифрования:<dl> % Папка ProgramData% \\ Microsoft \\ Crypto \\ RSA \\ MachineKeys\\\*  
% SystemRoot% \\ system32 \\ Microsoft \\ Protect\\\*  
</dl>

## <a name="framework-files"></a>Файлы платформы

Необходимо создать резервную копию всех версий платформы .NET Framework. Файлы находятся в одном или обоих следующих каталогах:

<dl> % WINDIR% \\ Microsoft.NET \\ Framework  
% WINDIR% \\ Microsoft.NET \\ Framework64  
</dl>

Кроме того, необходимо создать резервную копию файлов сборки. Эти файлы расположены в следующем каталоге:<dl> Сборка% WINDIR% \\  
</dl>

## <a name="task-scheduler-task-files"></a>Файлы задач планировщик задач

Необходимо создать резервную копию файлов задач планировщика заданий. Файлы находятся в одном или обоих следующих расположениях.

<dl> задачи% WINDIR% \\ system32 \\ и все подкаталоги (рекурсивно)  
задач% WINDIR% \\ (нет подкаталогов)  
</dl>

 

 
