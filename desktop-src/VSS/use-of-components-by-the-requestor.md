---
description: Помимо выполнения резервного копирования или восстановления, а также управления теневыми копиями, инициатор запроса должен управлять сведениями о компонентах модулей записи, с которыми он взаимодействует.
ms.assetid: 641abfbe-fc72-4468-9ef6-69c452adb1b3
title: Использование компонентов инициатором запроса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83efdb9e80ac0331289c3b611978e66a58098de6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541767"
---
# <a name="use-of-components-by-the-requester"></a>Использование компонентов инициатором запроса

Помимо выполнения резервного копирования или восстановления, а также управления теневыми копиями, инициатор запроса должен управлять сведениями о компонентах модулей записи, с которыми он взаимодействует. Выбор компонентов и логический путь используются для включения или исключения данных из резервной копии, а также для принятия решения о том, какие сведения о компонентах включены в документ компонентов резервного копирования.

## <a name="requester-component-selection-during-backup"></a>Выбор компонента инициатора запроса во время резервного копирования

Во время операций резервного копирования инициатор запроса импортирует данные компонента метаданных модуля записи с помощью методов [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) и [**Ивссбаккупкомпонентс:: жетвритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritermetadata) (Дополнительные сведения см. [в разделе Общие сведения об инициализации резервного копирования](overview-of-backup-initialization.md) ).

После изучения сведений модуля записи с помощью интерфейса [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) инициатор запроса решает, какие модули записи будут создавать резервные копии, а в ограниченном экстенте — какие компоненты модуля записи будут создавать резервные копии.

При резервном копировании модуля записи инициатор запроса:

-   Необходимо [*явно включить*](vssgloss-e.md) все невыбираемые компоненты модуля записи для компонентов резервного копирования, не выбрав их для предков с помощью [**Ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) , чтобы добавить компонент в документ компонентов резервного копирования
-   Может явно включать любой из компонентов модуля записи, который можно выбрать для резервного копирования, с помощью [**ивссбаккупкомпонентс:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) для добавления компонента в документ компонентов резервного копирования
-   Если компонент, который можно выбрать для резервного копирования, определяет [*набор компонентов*](vssgloss-c.md), его явное включение [*неявно включает*](vssgloss-i.md) все члены набора компонентов — возможность выбора для резервного копирования. Эти компоненты не добавляются в документ компонентов резервного копирования.

При добавлении компонента для резервного копирования, который можно выбрать, или невыбираемого для компонентов резервного копирования без выбора для резервного копирования предков в документ компонентов резервного копирования, запросивший объект определяет следующее:

-   Экземпляр модуля записи, управляющий компонентом
-   Идентификатор класса модуля записи
-   [*Логический путь*](vssgloss-l.md) компонента (который может иметь **значение NULL**)
-   Имя компонента

Если компонент не соответствует спецификации, будет возвращена ошибка.

Если такой компонент существует, VSS создает интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) для компонента в документе архивных компонентов. Эта информация будет доступна и может быть изменена модулем записи и инициатором запроса. Для выбираемого компонента, определяющего [*набор компонентов*](vssgloss-c.md), он описывает не только свойства компонента, но и все содержащиеся в нем компоненты.

Сведения о неявно добавляемых компонентах недоступны в документе архивные компоненты. Кроме того, в документе компоненты резервного копирования нет доступных сведений о файле. Чтобы получить эти сведения, инициатору запроса потребуется изучить документы метаданных модуля записи (которые уже были считаны) в контексте выбранных сохраненных компонентов в документе компонента резервного копирования.

## <a name="requester-component-selection-during-restore"></a>Выбор компонента инициатора запроса во время восстановления

Во время операций восстановления инициатор запроса не должен импортировать сведения о компонентах из модулей записи, которые в настоящее время активны в системе через [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), так как состояние выполняющихся процессов не обязательно отражает состояние процессов при резервном копировании.

Он по-прежнему должен создавать [*событие Identify*](vssgloss-i.md) через [**Ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), чтобы создать *событие определения* и определить, какие модули записи в настоящее время находятся в системе, и их состояние.

Инициатор запроса получает сохраненный документ компонентов резервного копирования во время его инициализации, а также документы метаданных хранимой программы записи (Дополнительные сведения см. в разделе [Обзор инициализации восстановления](overview-of-restore-initialization.md) ).

Включение компонентов во время резервного копирования во многом аналогично тому, что требуется для восстановления, за исключением того, что необходимо рассмотреть возможность [*выбора для восстановления*](vssgloss-s.md) вместе с [*логическим путем*](vssgloss-l.md)— [*невыбираемым для резервного копирования*](vssgloss-s.md).

Однако существуют некоторые отличия.

-   Если компонент уже был [*явно включен*](vssgloss-e.md) в документ компонентов резервного копирования во время резервного копирования, если он включен для восстановления (явно или неявно), [**Ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) используется для явного добавления его в документ компонентов резервного копирования для восстановления.
-   Если компонент был [*неявно включен*](vssgloss-i.md) в резервную копию и недоступен для восстановления без выбора для предков восстановления, который в случае резервного копирования будет требовать явного включения — компонент не включается явным образом (то есть не добавляется в документ компонентов резервного копирования с помощью [**Ивссбаккупкомпонентс:: сетселектедфорресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore)). Такой компонент следует считать неявно выбранным для восстановления.
-   Из этих компонентов, неявно выбранных для резервного копирования (независимо от того, был ли этот компонент выбран для резервного копирования или нет), в документ компонентов резервного копирования можно добавить только те компоненты, которые могут быть выбраны для восстановления, с помощью [**ивссбаккупкомпонентс:: аддресторесубкомпонент**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).
-   Возможность выбора для компонентов восстановления может определять [*набор компонентов*](vssgloss-c.md) для восстановления, так же как и для компонентов резервного копирования. Этот компонент, выбираемый для восстановления, затем определяет этот набор компонентов для операции восстановления.

Модуль записи без компонентов, явно выбранных для восстановления до создания события предварительного [*восстановления*](vssgloss-p.md) , не получит никаких событий VSS.

Запрашивающие стороны и модули записи могут получать доступ к хранящимся сведениям о компонентах с помощью интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) . С помощью интерфейса **ивсскомпонент** модули записи могут изменять некоторые параметры его компонентов, явно включаемые в документ компонентов резервного копирования для поддержки восстановления (например, [*цель восстановления*](vssgloss-r.md)). Если он определяет набор компонентов, изменения, внесенные средством записи явно включаемого компонента, распространяются на его [*подкомпоненты*](vssgloss-s.md). Кроме того, интерфейс предоставляет механизм передачи сведений об успешном и неуспешном завершении восстановления между модулем записи и инициатором запроса.

Как и во время резервного копирования, в документе "компоненты резервного копирования" недостаточно сведений для реализации восстановления. Опять же, документы метаданных модуля записи должны предоставлять сведения о фактических путях восстанавливаемых файлов, а также определить, какие невыбираемые компоненты входят в набор компонентов выбора компонентов и поэтому их необходимо восстановить.

Сведения о типах выбора и их использовании см. в разделе [Работа с использованием выбора и логических путей](working-with-selectability-and-logical-paths.md) .

## <a name="use-of-writer-component-document-information-by-the-requester"></a>Использование сведений о документе компонента модуля записи инициатором запроса

Каждый компонент однозначно идентифицируется [*идентификатором класса модуля записи*](vssgloss-w.md) его родительского модуля записи, его именем и [*логическим путем*](vssgloss-l.md).

Инициатор запроса может использовать интерфейс [**ивссвритеркомпонентсекст**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , возвращенный методом [**Ивссбаккупкомпонентс:: жетвритеркомпонентс**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) , для получения сведений о каждом сохраненном компоненте.

Имя компонента и логический путь (помимо других элементов) можно найти с помощью интерфейса [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , возвращаемого [**ивссвритеркомпонентсекст::-Component**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent).

> [!Note]  
> На этапе восстановления запрашивающий объект должен вызвать [**ивссвритеркомпонентсекст::**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) или [**Ивссвритеркомпонентсекст:: жеткомпоненткаунт**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) только после вызова [**ивссбаккупкомпонентс::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) , чтобы разрешить модулю записи обновлять документ компонентов резервного копирования. Одним из примеров такого обновления является изменение целевого объекта восстановления.

 

Сведения о каждом сохраненном выбранном компоненте записи родительского модуля можно найти с помощью [**ивссвритеркомпонентсекст:: жетвритеринфо**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getwriterinfo).

С помощью этих сведений можно запросить документы метаданных модуля записи и определить соответствующий документ. Затем, используя [*логический путь*](vssgloss-l.md), инициатор запроса может определить зависимые невыбираемые компоненты для каждого выбираемого компонента, то есть определить всех членов [*набора компонентов*](vssgloss-c.md)выбираемого компонента.

С помощью интерфейса [**ивссексаминевритерметадата**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) инициатор запроса теперь имеет полные сведения о компонентах, включая спецификацию пути (от интерфейса [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) ) — для выбираемых и невыбираемых компонентов, для которых требуется резервное копирование или восстановление.

Это одна из причин того, что необходимо, чтобы инициатор запроса сохранял как состояние собственных компонентов резервного копирования, так и документы метаданных модуля записи, с которыми происходит резервное копирование.

Более подробные сведения см. [в разделе Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md) .

 

 
