---
description: Инициатор запроса — это любое приложение, использующее API VSS (в частности, интерфейс Ивссбаккупкомпонентс) для запроса служб служба теневого копирования томов для создания теневых копий и наборов теневого копирования одного или нескольких томов, а также управления ими.
ms.assetid: e49920d0-5b66-4aa1-b3ca-641629df5f8a
title: Инициаторы запроса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59f0e7fa7b1718b0da278dabb164fbffee43c939cd688c150e202bfafc4731a9
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119866384"
---
# <a name="requesters"></a>Инициаторы запроса

[*Инициатор запроса*](vssgloss-r.md) — это любое приложение, ИСПОЛЬЗУЮЩЕЕ API VSS (в частности, интерфейс [**ивссбаккупкомпонентс**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) ) для запроса служб Служба теневого копирования томов для создания теневых копий и наборов теневого копирования одного или нескольких томов, а также управления ими.

Наиболее типичный пример запроса (и единственный адрес, описанный в этой документации) — это приложение для резервного копирования и восстановления с поддержкой VSS, которое использует теневое копирование данных в качестве стабильного источника для своих операций резервного копирования.

Помимо запуска теневого копирования, приложения инициатора запроса и резервного копирования и восстановления взаимодействуют с производителями данных (модулями записи) для сбора информации в системе и для подготовки к записи данных для резервного копирования.

## <a name="requester-state"></a>Состояние инициатора запроса

Инициатор запроса сохраняет свои сведения о состоянии в объекте метаданных на основе XML, который называется документом компонентов резервного копирования. Метаданные запросившего необходимы, но недостаточно, чтобы разрешить инициатору запроса резервное копирование и восстановление файловой системы. Это обусловлено следующими причинами.

-   Во время операции резервного копирования только подмножество компонентов, задействованных в резервной копии, не [*выбираемое для*](vssgloss-s.md) компонентов резервного копирования без выбора для предков резервной копии и выбираемых для компонентов резервного копирования, которые были [*явно включены*](vssgloss-e.md) в резервную копию, были добавлены в документ компонентов резервного копирования инициатора запроса.
-   Данные даже для компонентов, добавленных в документ архивных компонентов, являются неполными — спецификации файлов и путей не включаются.
-   Во время операций восстановления компонент, [*неявно включаемый*](vssgloss-i.md) в резервную копию, может быть [*выбран для восстановления*](vssgloss-s.md) и поэтому может быть явно добавлен в восстановление. Для этого потребуется обновить документ компонентов резервного копирования инициатора запроса информацией из сохраненных копий документа метаданных модуля записи модуля записи.

Чтобы обеспечить полную спецификацию операции резервного копирования или восстановления, API VSS позволяет инициатору запроса выполнять запросы к выполняемым метаданным модулей записи (во время резервного копирования) или анализировать метаданные сохраненного модуля записи (во время восстановления). Кроме того, модуль записи может изменять сведения о компонентах в документе резервных копий в ходе операции резервного копирования или восстановления.

Используя сведения о том, какие компоненты были выбраны для резервного копирования и восстановления, и правила, касающиеся выбора компонентов (Дополнительные сведения см. в разделе [Настройка организации компонентов](definition-of-components-by-writers.md) и [Работа с возможностью выбора и логическими путями](working-with-selectability-and-logical-paths.md)), инициатор запроса может определить, какие файлы модуля записи необходимо архивировать или восстанавливать, а также где он может найти эти файлы.

В рамках резервной копии необходимо сохранить метаданные запрашивающего и модуля записи, чтобы их можно было использовать в восстановлении. И наоборот, для операций восстановления требуется получение старых компонентов резервного копирования и документов метаданных модуля записи для получения полных инструкций по восстановлению файлов.

## <a name="requester-interprocess-communication"></a>Взаимодействие между процессами запросившего

Инициатор запроса поддерживает управление операциями резервного копирования и восстановления VSS путем создания событий COM с помощью различных вызовов API инициатора запроса. Эти вызовы могут выполнять следующие действия:

-   Запросы поставщиков, например [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) , приводят к созданию теневой копии выбранного тома поставщиком.
-   Активация модулей записи для возврата информации, например [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) , позволяет инициатору запроса получить документ метаданных модуля записи каждого модуля записи.
-   Необходимо, чтобы модули записи подготавливались к различным этапам операций теневого копирования и резервного копирования или обрабатывали их, например [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) сигналы, которые можно настроить для закрепления ввода-вывода.

Инициатор запроса получает сведения от модулей записи через динамические или хранимые документы метаданных модуля записи, а также использует интерфейс [**ивсскомпонент**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , который модуль записи может обновить.

## <a name="life-cycle-of-a-requester-during-backup"></a>Жизненный цикл инициатора запроса во время резервного копирования

Ниже приведена сводка жизненного цикла инициатора запроса для резервного копирования.

1.  Создание и инициализация интерфейсов API VSS.
2.  Свяжитесь с модулями записи и извлеките их информацию.
3.  Выберите данные для резервного копирования.
4.  Запросите теневую копию поставщика.
5.  Создайте резервную копию данных.
6.  Освободите интерфейс и теневую копию.

## <a name="life-cycle-of-a-requester-during-restore"></a>Жизненный цикл инициатора запроса во время восстановления

В жизненном цикле восстановления не требуется теневая копия, но по-прежнему требуется взаимодействие модуля записи:

1.  Создание экземпляров интерфейсов API VSS.
2.  Инициализируйте инициатор запроса для операции восстановления, загрузив сохраненный документ компонентов резервного копирования.
3.  Извлеките метаданные сохраненного модуля записи и документы компонентов резервного копирования.
4.  Обратитесь к модулям записи для инициализации взаимодействия.
5.  Проверьте наличие обновлений модуля записи в документе архивных компонентов.
6.  Восстановление данных.

 

 



