---
description: Для обработки одного из наборов файлов компонента может потребоваться рекурсивный обход дерева каталогов, что может потребовать от инициатора запроса обрабатывать подключенные папки и точки повторного анализа (например, ссылки), которые указывают на данные, которые не находятся на текущем томе.
ms.assetid: d0e08598-a8a2-489b-9cb2-e989bed1ce53
title: Работа с подключенными папками и точками повторного анализа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1162d1d7da5869f588ae61d9235ec3d5827265c5eb9deaa23c38b8b9e85db68
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119905064"
---
# <a name="working-with-mounted-folders-and-reparse-points"></a>Работа с подключенными папками и точками повторного анализа

Для обработки одного из наборов файлов компонента может потребоваться рекурсивный обход дерева каталогов, что может потребовать от инициатора запроса обрабатывать подключенные папки и точки повторного анализа (например, ссылки), которые указывают на данные, которые не находятся на текущем томе.

Ожидающие запросы должны следовать за подключенными папками и точками повторного анализа при просмотре дерева каталогов, а VSS имеет четко определенные рекомендации по их обработке для операций резервного копирования и восстановления.

Чтобы продемонстрировать эти рекомендации, рассмотрим следующий пример.

-   Том \\ \\ ? \\ Том {GUID \_ 1} имеет букву C: \\ .
-   Набор файлов имеет путь C: \\ вритердата.
-   Файл Specification \* . dat используется набором файлов.
-   Для рекурсии набора файлов задано **значение true**.
-   Каталог C: \\ вритердата расположен на томе \\ \\ ? \\ Том {GUID \_ 1}.
-   Каталог C: \\ вритердата \\ Archive является подключенной папкой.
-   Том \\ \\ ? \\ Том {GUID \_ 2} связан с подключенной папкой C: \\ вритердата \\ Archive.

## <a name="handling-mounted-folders-and-reparse-points-during-backup"></a>Обработка подключенных папок и точек повторного анализа во время резервного копирования

Основные правила обработки подключенных папок и точек повторного анализа в VSS при выполнении рекурсивного резервного копирования можно суммировать следующим образом.

-   Пути следуют в подключенных папках и точках повторного анализа.
-   Если подключенная папка или точка повторной обработки указывает на том, этот том должен быть теневым копированием.
-   Если том содержит подключенные папки или точки повторного анализа, они будут отображаться в теневой копии тома.
-   Данные, наявляющиеся в подключенной папке или точке повторной обработки, фиксируются в теневой копии тома, на который указывает подключенная папка или точка повторной обработки.

Чтобы продемонстрировать использование приведенного выше примера, так как задан рекурсивный флаг, инициатор запроса должен проверить все данные в папке C: \\ вритердата \\ Archive и ниже.

Инициатор запроса должен добавить как том с буквой диска C: \\ ( \\ \\ ? \\ Том {GUID \_ 1}) и том, связанный с подключенной папкой C: \\ вритердата \\ Archive ( \\ \\ ? \\ Том {GUID \_ 2}) в набор теневых копий с помощью [**ивссбаккупкомпонентс:: аддтоснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).

\\ \\ В теневой копии тома отображается архивная папка C: вритердата \\ \\ ? \\ Том {GUID \_ 1} с объектом устройства с именем deviceObject1.

Однако VSS не будет копировать данные в эту подключенную папку (данные включены \\ \\ ? \\ Том {GUID \_ 2}) к теневой копии, на которую ссылается deviceObject1. Вместо этого эти данные фиксируются в теневой копии \\ \\ ? \\ Том {GUID \_ 2} с объектом устройства с именем deviceObject2.

Таким образом, инициатор запроса, который создает резервную копию теневых копий файлов в C: \\ вритердата, будет использовать путь deviceObject1 \\ вритердата для поиска файлов, соответствующих C: \\ вритердата \\ \* . dat.

Чтобы выполнить резервное копирование теневых копий файлов в файле C: \\ вритердата \\ Archive, инициатор запроса будет использовать путь deviceObject2 (поскольку корневой каталог \\ \\ ? \\ Том {GUID \_ 2} связан с подключенной папкой c: \\ Архив модуля записи, \\ чтобы найти файлы, соответствующие C: \\ вритердата \\ Archive \\ \* . dat.

Обратите внимание, что точка повторного анализа обрабатывается так же, как и подключенная папка. Точка повторного анализа отображается в теневой копии первого тома. Данные в точке повторного анализа отображаются в теневой копии второго тома.

Во время резервного копирования запрашивающие стороны должны хранить сведения о подключенных папках и связанных с ними томах, а также о точках повторного анализа и их целевых объектах, чтобы обеспечить правильную архивацию и восстановление всех данных.

## <a name="handling-mount-and-reparse-points-during-restore"></a>Обработка точек подключения и повторного анализа во время восстановления

При восстановлении файлов инициатор запроса должен следовать рекомендациям, отличным от тех, которые использовались во время резервного копирования (без учета таких проблем, как [*сопоставление альтернативного расположения*](vssgloss-a.md) и [*новое целевое расположение*](vssgloss-n.md)):

-   Как и раньше, если требуется рекурсия, то пути должны находиться в подключенных папках и точках повторного анализа.
-   Подключенные папки будут восстановлены.
-   Местами восстановления подключенных папок и точек повторного анализа являются их исходные пути.

Если имена томов сохраняются между резервным копированием и восстановлением, то есть не создаются повторно тома — восстановленные подключенные папки и точки повторного анализа должны указывать на правильные тома.

Поэтому в приведенном выше примере, если папка C: \\ вритердата \\ Archive была восстановлена до ( \\ \\ ? \\ Том {GUID \_ 1}) и ранее связанный с ним том был восстановлен в ( \\ \\ ? \\ Том {GUID \_ 2}), восстановленные файлы и структура файлов будут правильными и единообразными.

Возможно, данные восстанавливаются в систему, в которой имена томов изменились. Это может быть вызвано аварийным завершением работы диска, в котором может потребоваться ручное восстановление системы и повторное создание томов. В такой ситуации подключенные папки и точки повторного анализа станут недействительными после восстановления. Чтобы повторно создать файлы и структуру файлов на восстановленном томе, потребуется удалить восстановленные подключенные папки и точки повторного анализа и создать их заново на диске. Приложение резервного копирования должно решить, подходит ли это.

Обратите внимание, что назначение восстановления для подключенной папки уже занято. Например, C: \\ вритердата \\ Archive может уже содержать некоторые файлы. Для принятия решения о том, как следует решить эту ситуацию, требуется приложение резервного копирования.

 

 



