---
description: Резервный набор данных — это список всех файлов для резервного копирования, их расположения и архивации.
ms.assetid: 34a66a9c-c1bc-437d-b034-59dc0c88228c
title: Создание резервного набора данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 827d9ecb90ac376aa9818b61e8dab65550ff8c50
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692924"
---
# <a name="generating-a-backup-set"></a>Создание резервного набора данных

Резервный набор данных — это список всех файлов для резервного копирования, их расположения и архивации.

Запрашивающий объект должен использовать файлы, содержащиеся на тенев скопированных томах, после того, как [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) успешно возвращает полный список файлов для резервного копирования.

Кроме того, инициатор запроса должен решить, что некоторые файлы имеют [*альтернативные пути*](vssgloss-a.md) и что некоторые файлы были исключены.

Алгоритм выбора файлов для резервного копирования должен передаваться на [*экземпляре модуля*](vssgloss-w.md) записи по экземпляру средства чтения, по отдельности по компонентам (как это будет происходить во время восстановления; см. статью [Создание набора восстановления](generating-a-restore-set.md)) и выполнить следующие действия.

1.  Определение томов, содержащих файлы модуля записи и соответствующие объекты устройств
2.  Использование сведений о [*наборе файлов*](vssgloss-f.md) (содержащихся в объектах [**ивссвмфиледеск**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) , возвращаемых [**ивссексаминевритерметадата:: жетексклудефиле**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getexcludefile)) для создания списка явно исключенных файлов при необходимости с помощью **финдфилефирст**, **финдфилефирстекс** и **FindNextFile**.
3.  Перебор всех компонентов модуля записи с помощью [**ивссексаминевритерметадата::-Component**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent). Если выбран выбираемый компонент, используйте [*логический путь*](vssgloss-l.md) , чтобы получить эти невыбираемые компоненты, связанные с ним, в наборе компонентов. (См. раздел [Работа с выборкой и логическими путями](working-with-selectability-and-logical-paths.md).)
4.  Получение [*наборов файлов*](vssgloss-f.md) , содержащихся в каждом выбранном компоненте, с помощью интерфейса [**ивссвмкомпонент**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) , соответствующего каждому компоненту, который он содержит.
5.  Создание списка файлов из спецификаций (при необходимости с помощью **финдфилефирст**, **финдфилефирстекс** и **FindNextFile**).
6.  Проверка каждого файла в списке, созданном на основе сведений о компоненте, по списку исключенных файлов, созданных выше. Это следует сделать с помощью пути по умолчанию для файла (возвращаемого функцией [**ивссвмфиледеск:: путь**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath)), а не из альтернативного пути, возвращенного [**Ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation)). Если файл соответствует исключенному списку, резервное копирование не выполняется.
7.  Выбор фактического расположения для резервного копирования (с использованием альтернативного пути, если он был задан)
8.  На этом этапе доступен полный список файлов и их расположений, а также может начаться резервное копирование.

После создания начального резервного набора данных для всех модулей записи, имеющихся в системе, инициатор запроса проверяет следующий раздел реестра:

**HKEY \_ локальный \_ компьютер \\ система \\ CurrentControlSet \\ элемент управления \\ баккупресторе \\ филесноттобаккуп**

Инициатор запроса использует подразделы в этом разделе следующим образом:

-   Если модуль записи присутствует в системе и существует подраздел, имя которого совпадает с именем модуля записи, этот подраздел необходимо игнорировать.
-   Если модуль записи присутствовал в системе, но в настоящее время отсутствует в резервном наборе данных и имеется соответствующий подраздел, все файлы, указанные в подразделе, исключаются и должны быть удалены из резервного набора.
-   Приложение резервного копирования добавляет файлы в данные подраздела путем создания \_ значения Multi SZ, содержащего список спецификаций файлов для файлов, которые не должны быть резервными. Каждая строка в \_ значении Multi SZ должна содержать одну спецификацию файла.
-   Спецификации файла могут содержать? и \* подстановочные знаки. Спецификацию можно сделать рекурсивной, добавив/s в конец. Например, при указании "% TEMP% \\ \* /s" все файлы в каталоге% TEMP% и все его подкаталоги не будут создаваться.

 

 



