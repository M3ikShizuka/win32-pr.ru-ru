---
description: Модуль записи теста — это служебная программа, которую можно использовать для тестирования приложений инициатора запроса VSS.
ms.assetid: 02434cb9-390c-4cf0-9941-b833ace55685
title: Средство записи тестов VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b93f0b81bd5e27db9fdfb70ca52e6f43bbb1e853af87bc12e1d76f01d7966ef3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118344237"
---
# <a name="vss-test-writer-tool"></a>Средство записи тестов VSS

Модуль записи теста — это служебная программа, которую можно использовать для тестирования приложений инициатора запроса VSS. Этот модуль записи можно настроить для выполнения практически всех действий, которые может выполнять модуль записи VSS. Кроме того, модуль записи тестов выполняет расширенные проверки, чтобы убедиться, что инициатор запроса правильно обработал эти действия записи.

Каждый экземпляр модуля записи инициализируется с помощью XML-файла конфигурации, в котором точно описаны компоненты, на которые будет сообщать модуль записи, а также принципы работы модуля записи. Модуль записи можно настроить для создания отчетов о различных типах сценариев, включая более сложные сценарии с использованием добавочных и разностных интерфейсов. Модуль записи выполняет проверки в различных точках во время процесса, чтобы убедиться, что инициатор запроса правильно работает надлежащим образом. После завершения восстановления модуль записи проверяет, что все необходимые файлы были восстановлены без повреждений. Кроме того, модуль записи можно настроить для выполнения других операций, таких как сбой конкретных событий.

> [!Note]  
> это средство входит в состав пакета средств разработки программного обеспечения (SDK) для Microsoft Windows для Windows Vista и более поздних версий. вы можете скачать Windows SDK из [https://msdn.microsoft.com/windowsvista](https://msdn.microsoft.com/windows/default.aspx) .

 

в Windows SDK установки средство всссамплепровидер можно найти в `%Program Files(x86)%\Windows Kits\8.1\bin\x64` (для 64-разрядных Windows) и `%Program Files(x86)%\Windows Kits\8.1\bin\x86` .

## <a name="running-the-test-writer-tool"></a>Запуск средства записи теста

Чтобы запустить модуль записи теста, введите в командной строке следующее:

 *Файл конфигурацииvswriter.exe-File*

где *config-file* — это путь к файлу конфигурации, в котором указывается поведение этого модуля записи.

Чтобы прерывать модуль записи теста, нажмите клавиши CTRL + C.

Несколько экземпляров модуля записи теста можно запустить одновременно. Однако каждый экземпляр модуля записи будет сообщать один и тот же идентификатор класса записи (хотя другой идентификатор экземпляра модуля записи), поэтому логические пути и имена компонентов должны быть уникальными во всех одновременно работающих экземплярах модуля записи.

Чтобы убедиться в том, что модуль записи может проверить правильность спецификаций файла исключения, все файлы, резервные копии которых были созданы, необходимо удалить из исходного тома, прежде чем пытаться восстановить их. Рекомендуется хранить шаблон каждого сценария записи, чтобы сценарий можно было легко воссоздать.

## <a name="using-a-configuration-file"></a>Использование файла конфигурации

Следующий пример файла конфигурации, всвритер \_config.xml, можно найти в `%ProgramFiles%\Microsoft SDKs\Windows\v7.0\bin\vsstools` на платформах x86 и `%ProgramFiles%\Microsoft SDKs\Windows\v7.0\bin\x64\vsstools` на платформах x64.

``` syntax
<TestWriter usage="USER_DATA">

    <RestoreMethod method="RESTORE_IF_CAN_BE_REPLACED"
                   writerRestore="always"
                   rebootRequired="no" />

    <ExcludeFile path="c:\writerData\notTheseFiles" 
                 filespec="excludeThisFile.txt" 
                 recursive="no"/>

    <Component componentType="filegroup"
               componentName="TestFiles">
        <ComponentFile path="c:\writerData\myFilesHere" 
                       filespec="*"
                       recursive="no" />
    </Component>

</TestWriter>
```

Корневой элемент в этом файле конфигурации называется Тествритер. Все остальные элементы упорядочиваются по элементу Тествритер.

Один из атрибутов, связанных с Тествритер, — это атрибут Usage. Этот атрибут указывает тип использования, сообщаемый через [**ивссексаминевритерметадата::-Identity**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getidentity). Одним из возможных значений этого атрибута являются \_ данные пользователя.

Первый дочерний элемент корневого элемента всегда должен быть элементом Ресторемесод. Этот элемент задает следующее:

-   Метод Restore (в данном случае Restore \_ , \_ Если \_ можно \_ заменить)
-   Требует ли модуль записи события восстановления (в данном случае всегда)
-   Требуется ли перезагрузка после восстановления модуля записи (в данном случае нет)

Этот элемент может дополнительно указывать сопоставление альтернативного расположения. (В этом случае альтернативное расположение не указано.)

Второй дочерний элемент является элементом Ексклудефиле. Этот элемент заставляет модуль записи исключить файл или набор файлов из резервной копии.

Третий дочерний элемент является элементом компонента. Этот элемент заставляет модуль записи добавить компонент в свои метаданные. Элемент component содержит атрибуты, описывающие компонент и дочерние элементы для описания содержимого компонента, например следующие:

-   Параметра ComponentType, указывающее, является ли это файловой группой или базой данных
-   Логикалпас для логического пути к компоненту
-   componentName для имени компонента
-   Выберите параметр, чтобы указать состояние для резервного копирования.

Элемент Component также имеет дочерний элемент с именем Компонентфиле, который добавляет спецификацию файла в этот компонент. (Элемент компонента может иметь произвольное число элементов Компонентфиле, которые можно указать для каждого компонента.) Этот элемент Компонентфиле имеет следующие атрибуты:

-   path = "c: \\ вритердата \\ мифилешере"
-   filespec = " \* "
-   recursive = "нет"

Хотя модуль записи тестов проверяет поведение инициатора запроса, он не проверяет, что файл конфигурации всегда поддерживает документированную семантику для модуля записи. Существует много операций, которые не должны делать хорошо работающий модуль записи (например, отчет о том же файле в нескольких компонентах), а также автор XML-файла конфигурации для поддержки этой семантики.

## <a name="configuring-writer-attributes"></a>Настройка атрибутов модуля записи

Корневой элемент Тествритер содержит атрибуты, определяющие различные режимы работы модуля записи. Ниже перечислены некоторые из вариантов поведения, которые можно изменить.



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>attribute</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span id="verbosity"></span><span id="VERBOSITY"></span>уровень детализации<br/></td>
<td>Модуль записи выводит состояние на консоль при получении событий и их обработке. Уровень детализации определяется атрибутом детализации. Вы можете выбрать один из трех уровней детализации:<br/> <dl> <dt><span id="low"></span><span id="LOW"></span>низшую</dt> <dd> Будут распечатаны только сбои в модуле записи или неправильное поведение инициатора запроса.<br/> </dd> <dt><span id="medium"></span><span id="MEDIUM"></span>высокое</dt> <dd> В дополнение к дополнительным сведениям о состоянии, например при получении событий, печатается все на низком уровне детализации. Это уровень, заданный по умолчанию.<br/> </dd> <dt><span id="high"></span><span id="HIGH"></span>высоком</dt> <dd> Отображается подробная информация о состоянии операции модуля записи.<br/> </dd> </dl></td>
</tr>
<tr class="even">
<td><span id="deleteFiles"></span><span id="deletefiles"></span><span id="DELETEFILES"></span>делетефилес<br/></td>
<td>Чтобы выполнить дополнительные проверки, присвойте этому атрибуту значение &quot; Да, &quot; чтобы модуль записи удалил все файлы сразу после создания теневой копии тома. Затем инициатор запроса должен скопировать файлы из теневой копии, так как они больше не существуют на исходном томе. <br/>
<blockquote>
[!Note]<br />
В случае выдам Writer файлы удаляются из исходного расположения после выдам, но до создания теневой копии. После создания теневой копии файлы удаляются из каталога выдам.
</blockquote>
<br/></td>
</tr>
<tr class="odd">
<td><span id="deletePartialFiles"></span><span id="deletepartialfiles"></span><span id="DELETEPARTIALFILES"></span>делетепартиалфилес<br/></td>
<td>Чтобы удалить частичные файлы, установите для этого атрибута значение &quot; Да &quot; .<br/></td>
</tr>
<tr class="even">
<td><span id="deleteDifferencedFiles"></span><span id="deletedifferencedfiles"></span><span id="DELETEDIFFERENCEDFILES"></span>делетедифференцедфилес<br/></td>
<td>Чтобы удалить файлы с разной разницей, установите для этого атрибута значение &quot; Да &quot; .<br/></td>
</tr>
<tr class="odd">
<td><span id="checkIncludes"></span><span id="checkincludes"></span><span id="CHECKINCLUDES"></span>чеккинклудес<br/></td>
<td>Задайте для этого атрибута значение &quot; Да, &quot; чтобы модуль записи проводил проверку на то, что все резервные копии файлов были восстановлены в соответствующее расположение и что файл не был поврежден. Частичные файлы и файлы различий также обрабатываются правильно.<br/></td>
</tr>
<tr class="even">
<td><span id="checkExcludes"></span><span id="checkexcludes"></span><span id="CHECKEXCLUDES"></span>чеккексклудес<br/></td>
<td>Задайте для этого атрибута значение &quot; Да, &quot; чтобы модуль записи не восстановил файлы, соответствующие спецификации файла в списке исключений. Чтобы эта функция правильно функционировала, перед восстановлением необходимо очистить каталоги восстановления.<br/></td>
</tr>
</tbody>
</table>



 

## <a name="specifying-alternate-location-mappings"></a>Указание сопоставлений альтернативного расположения

Сопоставление альтернативного расположения задает расположение для восстановления в, если метод Restore является VSS \_ WRE \_ RESTORE \_ в \_ другое \_ расположение или если не удается выполнить нормальное восстановление компонента. Модуль записи может сообщить о сопоставлении альтернативного расположения инициатору запроса с помощью метода [**ивссексаминевритерметадата:: жеталтернателокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) . Можно добавить сопоставления альтернативного расположения в файл конфигурации модуля записи теста, добавив подэлементы Алтернателокатионмаппинг в элемент Ресторемесод.

Следующий элемент Ресторемесод содержит вложенный элемент Алтернателокатионмаппинг.

``` syntax
<RestoreMethod method="RESTORE_IF_CAN_REPLACE"
              writerRestore="always"
              rebootRequired="no">
    <AlternateLocationMapping path="c:\files"
                              filespec="*.txt"
                              recursive="no"
                              alternatePath="c:\altfiles"/>
</RestoreMethod>
```

Этот пример указывает, что инициатор запроса должен сначала попытаться восстановить все файлы, соответствующие файлам c: \\ Files, \\ \*.txt в каталог c: \\ Files. Если один из этих файлов не может быть заменен, инициатор запроса должен восстановить все файлы в каталоге c: \\ алтфилес. Инициатор запроса должен сохранить сопоставление этого альтернативного расположения с помощью метода [**ивссбаккупкомпонентс:: аддалтернативелокатионмаппинг**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) . Если модуль записи тестов настроен для проверки того, были ли файлы восстановлены, он также проверяет, вызвал ли инициатор запроса **аддалтернативелокатионмаппинг**.

## <a name="specifying-files-to-be-excluded"></a>Указание исключаемых файлов

Каждый модуль записи может указывать список спецификаций файлов, указывающих файлы, которые должны быть исключены из резервной копии для инициатора запроса. Эти спецификации файлов можно добавить в файл конфигурации модуля записи теста, добавив подэлементы Ексклудефиле в корневой элемент Тествритер.

Ниже приведен пример вложенного элемента Ексклудефиле, который исключает все файлы в каталоге C: \\ Files, соответствующие c: \\ temp \* . \*

``` syntax
    <ExcludeFile path="c:\files" 
                 filespec="temp*.*" 
                 recursive="no"/>
```

## <a name="backing-up-spit-writers"></a>Резервное копирование модулей записи выдам

Многие авторы работают как «выдам Writers». Модуль записи выдам создает промежуточные файлы или файлы выдам, основываясь на исходном наборе файлов, и помещает файлы выдам в альтернативное расположение во время резервного копирования. Модуль записи использует метод [**ивссвмфиледеск:: жеталтернателокатион**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) , чтобы уведомить инициатор запроса о том, что эти файлы должны быть восстановлены из альтернативного расположения. Однако эти файлы по-прежнему должны быть восстановлены до активного расположения исходных файлов. Модуль записи теста можно настроить так, чтобы он работал как модуль записи выдам для конкретной спецификации файла.

Следующий элемент Компонентфиле содержит атрибут Алтернатепас:

``` syntax
    <ComponentFile path="c:\files"
                   filespec="*.txt"
                   recursive="no"
                   alternatePath="c:\files\spit" />
```

В этом примере модуль записи тестов настраивается на копирование всех файлов, соответствующих c: \\ Files, \\ \*.txt в каталог c: \\ Files \\ выдам непосредственно перед созданием теневой копии тома. Инициатор запроса должен создать резервную копию файлов из каталога c: \\ Files \\ выдам. Если модуль записи тестов настроен на удаление файлов, он удаляет исходные файлы перед созданием теневой копии, поэтому они не отображаются в каталоге c: \\ Files на томе теневой копии. В этом случае файлы в c: \\ Files \\ выдам удаляются после создания теневой копии, поэтому их необходимо архивировать из каталога c: \\ Files \\ выдам на томе теневого копирования.

## <a name="reporting-component-dependencies"></a>Зависимости компонентов отчетности

Модули записи могут указывать зависимость между локальным компонентом и компонентом, который существует в другом модуле записи. Эти зависимости передаются инициатору запроса с помощью [**ивссвмкомпонент:: dependency**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdependency). Модуль записи теста может быть настроен для передачи этих зависимостей путем добавления одного или нескольких вложенных элементов зависимостей в элемент Component.

Следующий элемент component содержит вложенный элемент dependency:

``` syntax
    <Component componentType="filegroup"
               logicalPath=""
               componentName="WriterComponent"
               selectable="yes">
         <Dependency writerId="<GUID of target writer>"
                     logicalPath="ComponentPath"
                     componentName="Writer2Component" />
    </Component>
```

Зависимость указывается как атрибуты элемента зависимости. Вритерид — это идентификатор класса модуля записи, содержащего целевой объект зависимости, Логикалпас — это логический путь к компоненту в этом модуле записи, а componentName — имя компонента. В этом случае, если инициатор запроса создает резервную копию "Вритеркомпонент" в текущем модуле записи, он должен также создать резервную копию компонента "Компонентпас \\ Writer2Component" в целевом модуле записи.

> [!Note]  
> Модуль записи тестов не проверяет соответствие зависимостей.

 

## <a name="failing-events"></a>События с ошибками

Модуль записи теста можно настроить для отказа от обычных событий, получаемых средством записи. Ниже приведены эти события.



| Событие                                                                                                                                    | Описание                                                                                                                                                                                                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="Identify"></span><span id="identify"></span><span id="IDENTIFY"></span>Указывается<br/>                                     | Получен как ответ на вызов [**ивссбаккупкомпонентс:: гасервритерметадата**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) . Ошибка здесь приведет к тому, что средство записи не будет сообщено.<br/>                                                                 |
| <span id="PrepareForBackup"></span><span id="prepareforbackup"></span><span id="PREPAREFORBACKUP"></span>PrepareForBackup<br/>     | Получен как ответ на запрашивающий вызов [**ивссбаккупкомпонентс::P репарефорбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).<br/>                                                                                                                 |
| <span id="PrepareForSnapsot"></span><span id="prepareforsnapsot"></span><span id="PREPAREFORSNAPSOT"></span>препарефорснапсот<br/> | Получается, когда инициатор запроса вызывает [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), но до создания теневой копии.<br/>                                                                                              |
| <span id="Freeze"></span><span id="freeze"></span><span id="FREEZE"></span>Фиксировать<br/>                                             | Получено сразу после [*препарефорснапшот*](vssgloss-p.md), но по-прежнему до создания теневой копии.<br/>                                                                                                      |
| <span id="Thaw"></span><span id="thaw"></span><span id="THAW"></span>Постепенно<br/>                                                     | Получено после завершения создания теневой копии.<br/>                                                                                                                                                                                                     |
| <span id="PostSnapshot"></span><span id="postsnapshot"></span><span id="POSTSNAPSHOT"></span>Моментальный снимок<br/>                     | Получено после разморозки, но до завершения [**ивссбаккупкомпонентс::D оснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .<br/>                                                                                                                   |
| <span id="Abort"></span><span id="abort"></span><span id="ABORT"></span>Рвал<br/>                                                 | Получается, если истекает слишком много времени между [*закреплением*](vssgloss-f.md) и [*размораживанием*](vssgloss-t.md) или если инициатор запроса вызывает [**ивссбаккупкомпонентс:: абортбаккуп**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-abortbackup).<br/> |
| <span id="BackupComplete"></span><span id="backupcomplete"></span><span id="BACKUPCOMPLETE"></span>баккупкомплете<br/>             | Получено при завершении запроса. Здесь ошибки никогда не будут передаваться.<br/>                                                                                                                                                                                 |
| <span id="PreRestore"></span><span id="prerestore"></span><span id="PRERESTORE"></span>Предвосстановление<br/>                             | Получается, когда инициатор запроса вызывает [**ивссбаккупкомпонентс::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).<br/>                                                                                                                                           |
| <span id="PostRestore"></span><span id="postrestore"></span><span id="POSTRESTORE"></span>Восстановление после восстановления<br/>                         | Получается, когда инициатор запроса вызывает [**ивссбаккупкомпонентс::P остресторе**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).<br/>                                                                                                                                         |



 

Эти сбои настраиваются путем добавления одного или нескольких вложенных элементов Фаилевент в корневой элемент Тествритер. Существует два класса сбоев, которые можно задать: повторяемые и неповторяемые. Повторяемые ошибки — это ошибки, которые могут исчезнуть при повторном выполнении всего процесса резервного копирования, в то время как ошибки, не допускающие повторения, вряд ли исчезнут. Тип сбоя для события выбирается на основе атрибута повторяемости.

Ниже приведен пример простой неповторяемой ошибки:

``` syntax
    <FailEvent writerEvent="Freeze"
               retryable="no" />
```

Этот пример приведет к сбою модуля записи во время события [*Freeze*](vssgloss-f.md) . [**Ивссбаккупкомпонентс:: гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) сообщит о сбое модуля записи в VSS \_ E \_ вритереррор \_ нонретрябле.

Ниже приведен пример базовой ошибки повторяемости.

``` syntax
    <FailEvent writerEvent="Freeze"
               retryable="yes"
               numFailures="2"/>
```

В этом примере средство записи будет завершаться сбоем первыми двумя раз, когда он получает событие [*Freeze*](vssgloss-f.md) . Через первые два раза модуль записи всегда будет выполнен. Ошибка модуля записи, полученная через [**гасервритерстатус**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus) , будет возможной случайным кодом ошибки.

## <a name="declaring-supported-backup-types"></a>Объявление поддерживаемых типов резервного копирования

Модули записи обмениваются данными о том, какие типы резервного копирования поддерживаются посредством вызова [**ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema)инициатора запроса. Корневой элемент Тествритер содержит атрибуты для каждого типа резервной копии для указания поддержки. Эти атрибуты: Суппортскопи, Суппортсдифферентиал, Суппортсинкрементал и Суппортслог. Чтобы указать поддержку для конкретного типа резервного копирования, установите для соответствующего атрибута значение "Да".

Если инициатор запроса задает для типа резервного копирования тип резервного копирования, который не поддерживается модулем записи, то модуль записи запустит этот факт во время [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), но в противном случае будет работать правильно.

## <a name="indicating-the-file-backup-type"></a>Указание типа резервной копии файла

Метод [**ивссвмфиледеск:: жетбаккуптипемаск**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getbackuptypemask) возвращает битовую маску для инициатора запроса, указывающего, как следует выполнять резервное копирование файла. Это указывает, является ли файл обязательным или необязательным во время конкретных типов резервного копирования, а также необходимость создания теневой копии во время конкретных типов резервного копирования. Типы резервных копий в этой битовой маске более подробно описаны в [роли "инициатор запроса документа" при резервном копировании сложных хранилищ](requestor-role-in-backing-up-complex-stores.md).

В модуле записи теста элементы этой битовой маски задаются путем установки атрибутов в каждом элементе Компонентфиле. Атрибуты Фуллбаккупрекуиред, Диффбаккупрекуиред, Инкбаккупрекуиред и Логбаккупрекуиред указывают, когда требуется создать резервную копию файла. Атрибуты Фуллснапшотрекуиред, Диффснапшотрекуиред, Инкснапшотрекуиред и Логснапшотрекуиред указывают, когда необходимо создать резервную копию файла из теневой копии тома (и никогда не от исходного тома). По умолчанию для всех этих значений задано значение "Да", указывающее, что файл должен всегда быть резервным и должен быть создан из теневой копии тома.

## <a name="adding-partial-files"></a>Добавление частичных файлов

Во время обработки [**доснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)средство записи имеет шанс добавить к каждому компоненту частичные файлы. Эти частичные файлы выводятся с помощью [**ивсскомпонент:: жетпартиалфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile). Модуль записи теста можно настроить для добавления частичных файлов, указав подэлементы Партиалфиле в элементе Component.

Ниже приведен пример элемента Component с двумя подэлементами Партиалфиле:

``` syntax
    <Component componentType="filegroup"
               logicalPath=""
               componentName="WriterComponent"
               selectable="yes">
        <ComponentFile path="c:\files"
                       filespec="*.txt"
                       recursive="no"/>
        <PartialFile path="c:\files"
                     filespec="partial.txt"
                     ranges="0:5,100:20" />
        <PartialFile path="c:\files2"
                     filespec="partial.txt"
                     ranges="0:5,100:20" />
    </Component>
```

Таким образом можно указать только частичные файлы, которые частично соответствуют существующему Компонентфиле (как в первом частичном файле в примере) или новые частичные файлы на том же томе, что и существующий Компонентфиле (как во втором частичном файле). Для этого компонента инициатор запроса должен полностью создать резервную копию всех файлов, соответствующих c: \\ files \\ \*.txt за исключением partial.txt. Затем инициатор запроса должен выполнить резервное копирование указанных диапазонов (где диапазон — это смещение, за которым следует длина) для файлов c: \\ files \\partial.txt и c: \\ files2 \\partial.txt.

Если модуль записи настроен для проверки восстановления файлов, при восстановлении будут проверяться только резервные диапазоны частичного файла. Изменения, внесенные в другие части файла, будут незамеченными. Если задан атрибут Делетепартиалфилес корневого элемента Тествритер, частичные файлы удаляются из исходного тома сразу после создания теневой копии.

## <a name="adding-differenced-files"></a>Добавление различных файлов

Во время обработки [**доснапшотсет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)модуль записи может добавлять в каждый компонент файлы с различиями. Эти файлы выводятся с помощью [**ивсскомпонент:: жетдифференцедфиле**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdifferencedfile). Модуль записи теста можно настроить для добавления различных файлов, указав подэлементы Дифференцедфиле в элементе Component.

Ниже приведен пример элемента Component с двумя подэлементами Дифференцедфиле:

``` syntax
    <Component componentType="filegroup"
               logicalPath=""
               componentName="WriterComponent"
               selectable="yes">
        <ComponentFile path="c:\files"
                       filespec="*.txt"
                       recursive="no"/>
        <DifferencedFile path="c:\files"
                         filespec="*.txt"
                         year="2007"
                         month="1"
                         day="22"
                         hour="12"
                         minute="44"
                         second="17" />
        <DifferencedFile path="c:\files2"
                         filespec="*.txt"
                         year="2007"
                         month="1"
                         day="22"
                         hour="12"
                         minute="44"
                         second="17" />
    </Component>
```

В отличие от частичных файлов, файлы различий не должны частично соответствовать спецификации Компонентфиле. Спецификация файла в элементе Дифференцедфиле должна либо точно соответствовать Компонентфиле (как в примере выше), либо не должна соответствовать этому файлу, но находиться на томе, на который ссылается Компонентфиле (как во втором файле различий). Значения даты и времени должны относиться к локальному часовому поясу, но они будут преобразованы в формат GMT перед передачей инициатору запроса. В этом примере выполняется резервное копирование только файлов, соответствующих c: \\ files \\ \*.txt или c: \\ files2 \\ \*.txt, которые были изменены с момента 1/22/2003:12:44:17.

Если модуль записи тестов настроен для проверки восстановления файлов, то восстановление будет проверяться только для измененных файлов. Если задан атрибут Делетедифференцедфилес корневого элемента Тествритер, то файлы с отличиями удаляются из исходного тома сразу после создания теневой копии.

## <a name="new-targets"></a>Новые цели

Определенные модули записи позволяют инициатору запроса сообщить о том, что было выбрано новое расположение для восстановления определенных файлов. Модуль записи указывает, что этот режим поддерживается как часть битовой маски, возвращаемой [**ивссексаминевритерметадата:: жетбаккупсчема**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getbackupschema). По умолчанию модуль записи теста всегда поддерживает новые целевые объекты. Эту поддержку можно отключить, присвоив атрибуту Суппортсневтаржет в корневом элементе Тествритер значение "No".

Если модуль записи поддерживает новые целевые объекты, инициатор запроса может уведомить средство записи о новых целевых объектах, вызвав [**ивссбаккупкомпонентс:: аддневтаржет**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget). Затем модуль записи проверяет новое целевое расположение для проверки восстановления, а не исходного расположения.

## <a name="more-information"></a>Дополнительные сведения

Модуль записи теста поддерживает больше параметров конфигурации, которые не описаны здесь. полная схема для всех возможностей настройки модуля записи теста указана в swriter.xml в `%ProgramFiles%\Microsoft SDKs\Windows\v7.0\bin\x64\vsstools` (для 64-разрядной Windows) и `%ProgramFiles%\Microsoft SDKs\Windows\v7.0\bin\vsstools` (для 32-разрядной Windows). Этот файл содержит схему XML, которая полностью описывает все элементы и атрибуты, составляющие файл конфигурации. Каждый элемент и каждый атрибут в этом файле снабжен комментариями с описанием, которое документирует использование этого элемента или атрибута.

 

 




