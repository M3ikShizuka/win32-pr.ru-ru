---
description: Объектная модель VDS
ms.assetid: e5fcc19a-e170-4918-85eb-c1457776795a
title: Объектная модель VDS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ae998955c5d0b7834cf4d88b901537f3644a2ab
ms.sourcegitcommit: 37f276b5d887a3aad04b1ba86e390dea9d87e591
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "104273166"
---
# <a name="vds-object-model"></a>Объектная модель VDS

\[Начиная с Windows 8 и Windows Server 2012, интерфейс COM [службы виртуальных дисков](virtual-disk-service-portal.md) заменяется [API управления хранилищами Windows](/previous-versions/windows/desktop/stormgmt/windows-storage-management-api-portal).\]

Служба VDS обеспечивает косвенный доступ к устройствам хранения на основе узлов, таким как диски и устройства чтения компакт-дисков, а также к массивам дисков, управляемым аппаратными RAID-контроллерами. Хотя некоторые сущности хранилища моделируют физические устройства, другие виртуальные конструкции модели: тома, секции и т. д. Объекты, описанные в этом разделе, представляют как физические, так и виртуальные сущности службы VDS.

Приложения вызывают методы, предоставляемые этими объектами, и служба VDS вызывает соответствующий поставщик для выполнения запрошенных операций с хранилищем. Приложение никогда не вызывает программу поставщика напрямую.

### <a name="classification-of-objects"></a>Классификация объектов

Как показано на следующем рисунке, программы поставщика программного обеспечения реализуют объекты, которые моделируют сущности на основе узла. программы поставщиков оборудования реализуют объекты, которые моделируют внутренние и внешние аппаратные RAID-устройства; остальные общие объекты не зависят от поставщика или реализуются службой VDS. Диск, который не является объектом VDS, является термином для универсального носителя хранилища, который состоит из экстентов диска или диска.

![Схема, на которой показана классификация объектов, определенных как "общие объекты", "объекты поставщика программного обеспечения" и "объекты поставщика оборудования".](images/vdsobjectmodel.png)

Дополнительные сведения о поведении каждого объекта см. в следующих разделах:

-   Загрузчике служб и объекты службы см. в разделе [объекты запуска и службы](startup-and-service-objects.md).
-   Перечисления и асинхронных объектов см. в разделе [вспомогательные объекты](helper-objects.md).
-   Объект поставщика см. в разделе [объект поставщика](provider-object.md).
-   Объекты "Pack", "диск", "том" и "Плекс" см. в разделе [объекты поставщика программного обеспечения](software-provider-objects.md).
-   Подсистема, контроллер, диск, LUN и объекты плекса LUN см. в разделе [объекты поставщика оборудования](hardware-provider-objects.md).

### <a name="object-creation"></a>Создание объектов

Выполнение операций конфигурации и запросов, связанных с созданием объектов, может занять значительное время; Таким образом, служба VDS вызывает все методы асинхронно. Поставщик обнаружения возвращает все события завершения, ошибки или изменения состояния. Поставщики программного обеспечения также заносить в журнал все ошибки и значительные изменения состояния.

### <a name="object-deletion"></a>Удаление объекта

Несколько методов VDS удаляют или преобразуют объекты VDS. Вызывающий объект может хранить ссылку, используя указатель интерфейса, удаленному объекту после возврата метода. Когда вызывающий объект освобождает интерфейс, служба VDS удаляет объект.

В отношении удаления объектов вызывающие объекты должны отменять вызов любого объекта, кроме метода [**IUnknown:: Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) для этих интерфейсов. Поставщик должен быть достаточно надежным для работы с вызывающими объектами аномального. Если вызывающий объект вызывает метод для удаленного объекта, поставщик должен вернуть **объект VDS E в \_ \_ \_ удаленном** виде.

### <a name="service-initialization"></a>Инициализация службы

Служба VDS предоставляет идентификатор класса (CLSID) для загрузчика службы и объектов службы, но только CLSID загрузчика службы является общедоступным. Инициализация службы происходит, когда поставщики, вызывающее приложение и служба выполняют следующие задачи:

-   Каждый новый поставщик вызывает метод [**ивдсадмин:: RegisterProvider**](/windows/desktop/api/VdsHwPrv/nf-vdshwprv-ivdsadmin-registerprovider) во время установки для регистрации в службе VDS. Вызов создает раздел реестра в СИСТЕМном кусте, определяемый идентификатором GUID объекта поставщика. В этом разделе содержится идентификатор CLSID объекта поставщика, имя, версия и идентификатор GUID версии поставщика.
    > [!Note]  
    > Идентификаторы GUID объектов поставщика являются постоянными; идентификаторы GUID объектов программного и аппаратного обеспечения не являются.

     

-   Приложение вызывает функцию [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) , передавая CLSID загрузчика службы в качестве аргумента. Используя указатель на объект загрузчика службы, приложение может запустить службу VDS локально или удаленно, передав имя нужного компьютера в качестве параметра в метод [**ивдссервицелоадер:: лоадсервице**](/windows/desktop/api/Vds/nf-vds-ivdsserviceloader-loadservice) .
-   При присоединении к службе первого приложения служба VDS сначала вызывает [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для каждого идентификатора CLSID, найденного в разделе реестра, а затем вызывает метод [**ивдспровидерпривате:: OnLoad**](/windows/desktop/api/VdsHwPrv/nf-vdshwprv-ivdsproviderprivate-onload) для каждого поставщика, чтобы инициализировать программы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[О службе VDS](about-vds.md)
</dt> <dt>

[**Ивдсадмин:: RegisterProvider**](/windows/desktop/api/VdsHwPrv/nf-vdshwprv-ivdsadmin-registerprovider)
</dt> <dt>

[**Ивдссервицелоадер:: Лоадсервице**](/windows/desktop/api/Vds/nf-vds-ivdsserviceloader-loadservice)
</dt> <dt>

[**Ивдспровидерпривате:: OnLoad**](/windows/desktop/api/VdsHwPrv/nf-vdshwprv-ivdsproviderprivate-onload)
</dt> </dl>

 

 
