---
description: Функции Wait позволяют потоку блокировать свое выполнение.
ms.assetid: 9c66c71d-fdfd-42ae-895c-2fc842b5bc7a
title: Функции Wait
ms.topic: article
ms.date: 06/25/2020
ms.openlocfilehash: f5a21b0d95a316b926fcaad037004edc8c418246
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664064"
---
# <a name="wait-functions"></a>Функции Wait

*Функции Wait* позволяют потоку блокировать свое выполнение. Функции ожидания не возвращают, пока не будут выполнены указанные условия. Тип функции Wait определяет набор используемых критериев. При вызове функции Wait она проверяет, выполнены ли условия ожидания. Если критерии не выполнены, вызывающий поток переходит в состояние ожидания до тех пор, пока не будут выполнены условия условий ожидания или не истечет указанный интервал времени ожидания.

-   [Функции ожидания с одним объектом](#single-object-wait-functions)
-   [Функции ожидания с несколькими объектами](#multiple-object-wait-functions)
-   [Функции ожидания с оповещением](#alertable-wait-functions)
-   [Зарегистрированные функции ожидания](#registered-wait-functions)
-   [Ожидание адреса](#waiting-on-an-address)
-   [Функции ожидания и интервалы времени ожидания](#wait-functions-and-time-out-intervals)
-   [Функции ожидания и объекты синхронизации](#wait-functions-and-synchronization-objects)
-   [Функции Wait и создание окон](#wait-functions-and-creating-windows)

## <a name="single-object-wait-functions"></a>Функции ожидания с одним объектом

Для функций [**сигналобжектандваит**](/windows/win32/api/synchapi/nf-synchapi-signalobjectandwait), [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject)и [**WaitForSingleObjectEx**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobjectex) требуется обработчик одного объекта синхронизации. Эти функции возвращают, когда происходит одно из следующих событий:

-   Указанный объект находится в сигнальном состоянии.
-   Интервал времени ожидания истекает. Интервал времени ожидания может быть установлен в **бесконечное** значение, чтобы указать, что время ожидания не будет истекает.

Функция [**сигналобжектандваит**](/windows/win32/api/synchapi/nf-synchapi-signalobjectandwait) позволяет вызывающему потоку атомарно установить состояние объекта в значение "сигнал" и подождать, пока состояние другого объекта не будет равно "сигнальному".

## <a name="multiple-object-wait-functions"></a>Функции ожидания с несколькими объектами

Функции [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects), [**ваитформултиплеобжектсекс**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjectsex), [**мсгваитформултиплеобжектс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjects)и [**мсгваитформултиплеобжектсекс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjectsex) позволяют вызывающему потоку указать массив, содержащий один или несколько дескрипторов объекта синхронизации. Эти функции возвращают, когда происходит одно из следующих событий:

-   Состоянию любого из указанных объектов присваивается значение «сигнальные» или состояниям всех объектов присвоено значение «сигнальный». Вы управляете тем, будет ли использоваться одно или все из этих состояний в вызове функции.
-   Интервал времени ожидания истекает. Интервал времени ожидания может быть установлен в **бесконечное** значение, чтобы указать, что время ожидания не будет истекает.

Функция [**мсгваитформултиплеобжектс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjects) и [**мсгваитформултиплеобжектсекс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjectsex) позволяет указать объекты входных событий в массиве обработчиков объектов. Это делается при указании типа входных данных для ожидания в очереди ввода потока. Например, поток может использовать **мсгваитформултиплеобжектс** для блокирования его выполнения до тех пор, пока состояние указанного объекта не станет сигнальным, а в очереди входных данных потока будет доступно вход с помощью мыши. Для получения входных данных [](/windows/win32/api/winuser/nf-winuser-getmessage) поток может использовать функцию [**пикмессажеа**](/windows/win32/api/winuser/nf-winuser-peekmessagea) или [**пикмессажев**](/windows/win32/api/winuser/nf-winuser-peekmessagew) .

При ожидании того, что состояния всех объектов должны быть сигнальными, эти функции с несколькими объектами не изменяют состояния указанных объектов до тех пор, пока не будут заданы состояния всех объектов. Например, состояние объекта мьютекса может быть сигнальным, но вызывающий поток не получает владение, пока состояния других объектов, указанных в массиве, также не будут сигнальными. В то же время другой поток может стать владельцем объекта Mutex, тем самым устанавливая его состояние на несигнальное.

При ожидании того, что состояние одного объекта должно быть сигнальным, эти функции с несколькими объектами проверяют дескрипторы в массиве в порядке, начиная с индекса 0, до тех пор, пока не будет получен сигнал об одном из объектов. Если несколько объектов получают сигнал, функция возвращает индекс первого дескриптора в массиве, объект которого получил сигнал.

## <a name="alertable-wait-functions"></a>Функции ожидания с оповещением

Функции [**мсгваитформултиплеобжектсекс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjectsex), [**сигналобжектандваит**](/windows/win32/api/synchapi/nf-synchapi-signalobjectandwait), [**ваитформултиплеобжектсекс**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjectsex)и [**WaitForSingleObjectEx**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobjectex) отличаются от других функций ожидания в том, что они могут дополнительно выполнить *операцию ожидания* с возможностью предупреждения. В операции ожидания с оповещением функция может возвращать данные о выполнении указанных условий, но также может возвращать значение, если система помещает в очередь подпрограмму завершения ввода-вывода или APC для выполнения в ожидающем потоке. Дополнительные сведения о выполняемых с предупреждениями операциях ожидания и подсистемах завершения ввода-вывода см. в разделе [Синхронизация и перекрывающиеся входные и выходные данные](synchronization-and-overlapped-input-and-output.md). Дополнительные сведения о APC см. в разделе [асинхронные вызовы процедур](asynchronous-procedure-calls.md).

## <a name="registered-wait-functions"></a>Зарегистрированные функции ожидания

Функция [**RegisterWaitForSingleObject**](/windows/desktop/api/WinBase/nf-winbase-registerwaitforsingleobject) отличается от других функций ожидания тем, что операция ожидания выполняется потоком из [пула потоков](../procthread/thread-pooling.md). При выполнении указанных условий функция обратного вызова выполняется рабочим потоком из пула потоков.

По умолчанию зарегистрированная операция ожидания является операцией с несколькими ожиданиями. Система сбрасывает таймер при каждом сигнале события (или истечении интервала времени ожидания) до тех пор, пока не будет вызвана функция [**UnregisterWaitEx**](unregisterwaitex.md) для отмены операции. Чтобы указать, что операция ожидания должна выполняться только один раз, присвойте  параметру dwFlags [**RegisterWaitForSingleObject**](/windows/desktop/api/WinBase/nf-winbase-registerwaitforsingleobject) значение **WT \_ ексекутеонлйонце**.

Если поток вызывает функции, использующие APC, установите для параметра *dwFlags* в [**RegisterWaitForSingleObject**](/windows/desktop/api/WinBase/nf-winbase-registerwaitforsingleobject) значение **WT \_ ексекутеинперсистентсреад**.

## <a name="waiting-on-an-address"></a>Ожидание адреса

Поток может использовать функцию [**ваитонаддресс**](/windows/desktop/api/SynchAPI/nf-synchapi-waitonaddress) , чтобы ждать, пока значение целевого адреса изменится с нежелательного на любое другое значение. Это позволяет потокам ожидать изменения значения без необходимости прокрутки или обработки проблем синхронизации, которые могут возникать, когда поток фиксирует нежелательное значение, но значение изменяется до того, как поток может подождать.

[**Ваитонаддресс**](/windows/desktop/api/SynchAPI/nf-synchapi-waitonaddress) возвращает, когда код, изменяющий целевое значение, сигнализирует об изменении, вызывая [**вакебяддресссингле**](/windows/desktop/api/SynchAPI/nf-synchapi-wakebyaddresssingle) для пробуждения одного ожидающего потока или [**вакебяддрессалл**](/windows/desktop/api/SynchAPI/nf-synchapi-wakebyaddressall) для пробуждения всех ожидающих потоков. Если интервал времени ожидания указан с параметром **ваитонаддресс** и ни один поток не вызывает функцию пробуждения, функция возвращает значение по истечении интервала времени ожидания. Если интервал времени ожидания не указан, поток ждет бесконечно.

## <a name="wait-functions-and-time-out-intervals"></a>Функции ожидания и интервалы времени ожидания

Точность указанного интервала времени ожидания зависит от разрешения системных часов. Системные часы "тактов" по постоянной ставке. Если интервал времени ожидания меньше, чем разрешение системных часов, время ожидания может истекает менее указанного промежутка времени. Если интервал времени ожидания больше одного деления, но меньше двух, ожидание может находиться в любом месте между одним и двумя тактами и так далее.

Чтобы увеличить точность интервала времени ожидания для функций ожидания, вызовите функцию **тимежетдевкапс** , чтобы определить поддерживаемое минимальное разрешение таймера и функцию **тимебегинпериод** , чтобы установить минимальное разрешение таймера. Будьте внимательны при вызове **тимебегинпериод**, так как частые вызовы могут существенно повлиять на системные часы, энергопотребление системы и планировщик. Если вы вызовите **тимебегинпериод**, вызовите его один раз в начале приложения и не забудьте вызвать функцию **тиминдпериод** в самом конце приложения.

## <a name="wait-functions-and-synchronization-objects"></a>Функции ожидания и объекты синхронизации

Функции ожидания могут изменять состояния некоторых типов [объектов синхронизации](synchronization-objects.md). Изменение происходит только для объектов или объектов, сигнальное состояние которых привело к возврату функции. Функции ожидания могут изменять состояния объектов синхронизации следующим образом.

-   Число объектов семафора уменьшается на единицу, а для состояния семафора устанавливается значение несигнальное, если его число равно нулю.
-   Состояния мьютекса, события автосброса и объектов уведомлений устанавливаются в несигнальное состояние.
-   Для состояния таймера синхронизации задано несигнальное состояние.
-   Функции Wait не затрагивают состояния событий ручного сброса, таймера, процесса, потока и входных объектов консоли вручную.

## <a name="wait-functions-and-creating-windows"></a>Функции Wait и создание окон

Необходимо соблюдать осторожность при использовании функций ожидания и кода, который напрямую или косвенно создает Windows. Если поток создает какие-либо окна, он должен обрабатывать сообщения. Широковещательные сообщения отправляются во все окна системы. Если у вас есть поток, использующий функцию Wait без интервала ожидания, система взаимоблокируется. Два примера кода, который косвенно создает окна — DDE и функция **CoInitialize** . Поэтому при наличии потока, создающего окна, используйте [**мсгваитформултиплеобжектс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjects) или [**мсгваитформултиплеобжектсекс**](/windows/desktop/api/Winuser/nf-winuser-msgwaitformultipleobjectsex), а не другие функции Wait.

 

 
