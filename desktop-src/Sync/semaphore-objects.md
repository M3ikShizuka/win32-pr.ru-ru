---
description: Объект семафора — это объект синхронизации, который поддерживает число от нуля до указанного максимального значения.
ms.assetid: d9da1d98-a306-4e2d-a149-1eef6a724751
title: Объекты семафора
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c814be0ab2fafe7fbabfdeca5b640cfb550172a09e465dddc71629dfa5b0068
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118886263"
---
# <a name="semaphore-objects"></a>Объекты семафора

*Объект семафора* — это объект синхронизации, который поддерживает число от нуля до указанного максимального значения. Счетчик уменьшается каждый раз, когда поток завершает ожидание объекта семафора и увеличивается каждый раз, когда поток освобождает семафор. Когда счетчик достигнет нуля, больше ни один поток не сможет успешно ожидать, пока состояние объекта семафора не станет сигнальным. Состояние семафора становится сигнальным, когда это число становится больше нуля, и несигнальным, когда равно нулю.

Объект семафора полезен при управлении общим ресурсом, который может поддерживать ограниченное число пользователей. Он выступает в качестве шлюза, ограничивающего количество потоков, совместно использующих ресурс, до указанного максимального числа. Например, приложение может устанавливать ограничение на количество создаваемых окон. Он использует семафор с максимальным числом, равным ограничению окна, уменьшая число при создании окна и увеличивая его при каждом закрытии окна. Приложение задает объект семафора в вызове одной из [функций ожидания](wait-functions.md) перед созданием каждого окна. Если значение счетчика равно нулю — это означает, что достигнуто предельное число окон, функция wait блокирует выполнение кода создания окна.

Поток использует функцию [**createsemaphore-**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) или [**креатесемафорикс**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) для создания объекта семафора. В процессе создания потока указывается начальное число и максимальное значение счетчика для объекта. Начальное число не должно быть меньше нуля или больше максимального значения. В создаваемом потоке также можно указать имя для объекта семафора. Потоки в других процессах могут открыть обработчик для существующего объекта семафора, указав его имя в вызове функции [**опенсемафоре**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) . Дополнительные сведения об именах для мьютексов, событий, семафоров и объектов таймера см. в разделе [межпроцессная синхронизация](interprocess-synchronization.md).

Если в семафоре ожидается несколько потоков, выбирается ожидающий поток. Не думайте порядок "первым поступил — первым обслужен" (FIFO). Внешние события, такие как режим ядра APC, могут изменять порядок ожидания.

Каждый раз, когда одна из [функций Wait](wait-functions.md) возвращает сигнал, так как состояние семафора было равно сигнальному, счетчик семафора уменьшается на единицу. Функция [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) увеличивает значение счетчика семафора на указанный объем. Число не может быть меньше нуля или больше максимального значения.

Первоначальное число семафора обычно равно максимальному значению. Затем счетчик уменьшается с этого уровня, когда потребляется защищенный ресурс. Кроме того, можно создать семафор с начальным счетчиком, равным нулю, чтобы заблокировать доступ к защищенному ресурсу во время инициализации приложения. После инициализации можно использовать [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) , чтобы увеличить число до максимального значения.

Поток, владеющий объектом Mutex, может многократно ожидать для того же объекта мьютекса, чтобы он стал сигнальным, не блокируя его выполнение. Однако поток, который ожидает повторное выполнение для одного и того же объекта семафора, уменьшает количество семафора каждый раз, когда завершается операция ожидания. поток блокируется, когда число становится равным нулю. Аналогично, только поток, владеющий мьютексом, может успешно вызвать функцию [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) , хотя любой поток может использовать [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) для увеличения числа объектов семафора.

Поток может уменьшить число семафоров несколько раз, повторно указав один и тот же объект семафора в вызовах любой из [функций ожидания](wait-functions.md). Однако вызов одной из функций ожидания с несколькими объектами с массивом, содержащим несколько дескрипторов одного и того же семафора, не приводит к множественному уменьшению.

Завершив использование объекта семафора, вызовите функцию [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) , чтобы закрыть этот обработчик. Объект семафора уничтожается при закрытии его последнего маркера. Закрытие маркера не влияет на число семафоров; Поэтому обязательно вызовите [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) перед закрытием обработчика или до завершения процесса. В противном случае ожидающие операции ожидания истечет либо время ожидания, либо продолжить неограниченно в зависимости от того, было ли указано значение времени ожидания.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование объектов семафора](using-semaphore-objects.md)
</dt> </dl>

 

 
