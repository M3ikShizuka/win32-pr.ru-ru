---
description: Упрощенные блокировки потоков чтения/записи (SRW) позволяют потокам одного процесса получать доступ к общим ресурсам. они оптимизированы для ускорения и занимают очень мало памяти.
ms.assetid: 2d439b21-291f-4ff0-910a-c1c27e800019
title: Упрощенные блокировки потоков чтения/записи (SRW)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3bc478d5f9bbfec1268f65b3e4a7f562b9bdca3d2df21f4570a52782eec9f028
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119959984"
---
# <a name="slim-readerwriter-srw-locks"></a>Упрощенные блокировки потоков чтения/записи (SRW)

Упрощенные блокировки потоков чтения/записи (SRW) позволяют потокам одного процесса получать доступ к общим ресурсам. они оптимизированы для ускорения и занимают очень мало памяти. Упрощенные блокировки чтения и записи не могут совместно использоваться разными процессами.

Потоки чтения считывают данные из общего ресурса, а потоки записи записывают данные в общий ресурс. Когда несколько потоков считываются и записываются с помощью общего ресурса, монопольные блокировки, такие как критический раздел или мьютекс, могут стать узким местом, если потоки чтения работают непрерывно, но операции записи являются редкими.

Блокировки SRW предоставляют два режима, в которых потоки могут получить доступ к общему ресурсу:

-   **Общий режим**, который предоставляет общий доступ только для чтения к нескольким потокам чтения, что позволяет им одновременно считывать данные из общего ресурса. Если операции чтения превышают операции записи, этот параллелизм повышает производительность и пропускную способность по сравнению с критическими секциями.
    > [!NOTE]
    > Блокировки SRW в общем режиме не должны быть получены рекурсивно, так как это может привести к взаимоблокировкам при объединении с монопольным получением.

-   **Монопольный режим**, который предоставляет доступ на чтение и запись в один поток записи за раз. Когда блокировка была получена в монопольном режиме, другой поток не сможет получить доступ к общему ресурсу до тех пор, пока модуль записи не освободит блокировку.
    > [!NOTE]
    > Блокировки с монопольным режимом SRW не могут быть получены рекурсивно. Если поток пытается получить блокировку, которую он уже содержит, то эта попытка завершится ошибкой (для [**тряккуиресрвлоккексклусиве**](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockexclusive)) или взаимоблокировкой (для [**AcquireSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockexclusive)).

Одну блокировку SRW можно получить в любом из режимов. потоки чтения могут получить его в общем режиме, тогда как потоки модуля записи могут получить его в монопольном режиме. Не гарантируется порядок, в котором для потоков, запрашивающих владение, будет предоставлен владение. Блокировки SRW не являются ни честными, ни FIFO.

Блокировка SRW — это размер указателя. Преимущество в том, что обновление состояния блокировки происходит быстро. Недостаток заключается в том, что можно хранить очень мало информации о состоянии, поэтому блокировки SRW не обнаруживают неправильное рекурсивное использование в общем режиме. Кроме того, поток, владеющий блокировкой SRW в общем режиме, не может обновить его владение монопольным режимом.

Вызывающий объект должен выделить структуру SRWLOCK и инициализировать ее путем вызова [**инитиализесрвлокк**](/windows/win32/api/synchapi/nf-synchapi-initializesrwlock) (для динамической инициализации структуры) или назначения константы **SRWLock \_ init** переменной структуры (для статической инициализации структуры).

[Средство проверки приложений](/windows-hardware/drivers/devtest/application-verifier) можно использовать для поиска рекурсивного (повторного) использования блокировок SRW.

Ниже приведены функции блокировки SRW.

| Функция блокировки SRW                                                | Описание                                                                                                                                       |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| [**AcquireSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockexclusive)       | Получает блокировку SRW в монопольном режиме.                                                                                                           |
| [**аккуиресрвлоккшаред**](/windows/win32/api/synchapi/nf-synchapi-acquiresrwlockshared)             | Получает блокировку SRW в общем режиме.                                                                                                              |
| [**инитиализесрвлокк**](/windows/win32/api/synchapi/nf-synchapi-initializesrwlock)                   | Инициализация блокировки SRW.                                                                                                                           |
| [**ReleaseSRWLockExclusive**](/windows/win32/api/synchapi/nf-synchapi-releasesrwlockexclusive)       | Освобождает блокировку SRW, которая была открыта в монопольном режиме.                                                                                           |
| [**ReleaseSRWLockShared**](/windows/win32/api/synchapi/nf-synchapi-releasesrwlockshared)             | Освобождает блокировку SRW, которая была открыта в режиме общего доступа.                                                                                              |
| [**SleepConditionVariableSRW**](/windows/win32/api/synchapi/nf-synchapi-sleepconditionvariablesrw)   | Закрывает указанную переменную условия и освобождает указанную блокировку как атомарную операцию.                                                |
| [**тряккуиресрвлоккексклусиве**](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockexclusive) | Пытается получить упрощенную блокировку чтения/записи (SRW) в монопольном режиме. Если вызов выполнен успешно, вызывающий поток принимает владение блокировкой. |
| [**тряккуиресрвлоккшаред**](/windows/win32/api/synchapi/nf-synchapi-tryacquiresrwlockshared)       | Пытается получить блокировку упрощенного чтения/записи (SRW) в общем режиме. Если вызов выполнен успешно, вызывающий поток принимает владение блокировкой.    |

 
