---
description: Объект критической секции обеспечивает синхронизацию, аналогичную той, которая предоставляется объектом Mutex, за исключением того, что критическая секция может использоваться только потоками одного процесса.
ms.assetid: 2ec11a42-3d12-4d60-9dd7-dc38926d56e1
title: Объекты критических секций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbcada1f2ddbc6d370445f36a3dbd51c5c9f54bf
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105663886"
---
# <a name="critical-section-objects"></a>Объекты критических секций

*Объект критической секции* обеспечивает синхронизацию, аналогичную той, которая предоставляется объектом Mutex, за исключением того, что критическая секция может использоваться только потоками одного процесса. Объекты критических секций нельзя совместно использовать в процессах.

Объекты событий, мьютексов и семафоров также можно использовать в однопроцессном приложении, но критически важные объекты раздела обеспечивают несколько более быстрый и эффективный механизм взаимной синхронизации (инструкции по тестированию и определению конкретного процессора). Как и объект Mutex, объект критической секции может принадлежать только одному потоку за раз, что позволяет защитить общий ресурс от одновременного доступа. В отличие от объекта Mutex, невозможно определить, был ли прерван критический раздел.

Начиная с Windows Server 2003 с пакетом обновления 1 (SP1), потоки, ожидающие критической секции, не получают критический раздел на основе первых поступающих. Это изменение значительно повышает производительность для большинства кодов. Однако некоторые приложения зависят от порядка "первым поступил — первым обслужен" (FIFO) и могут работать плохо или не вообще на всех текущих версиях Windows (например, приложения, использующие критические разделы в качестве ограничения). Чтобы обеспечить правильную работу кода, может потребоваться добавить дополнительный уровень синхронизации. Например, предположим, что у вас есть поток-производитель и поток-потребитель, который использует объект критического раздела для синхронизации своей работы. Создайте два объекта событий — по одному для каждого потока, чтобы сообщить о готовности для продолжения работы другого потока. Поток-потребитель ждет, пока производитель сообщит о своем событии перед входом в критическую секцию, и поток-производитель ожидает, пока поток-потребитель не сообщит о своем событии перед входом в критическую секцию. После того как каждый поток покидает критическую секцию, он сигнализирует своему событию освободить другой поток.

**Windows Server 2003 и Windows XP:** Потоки, ожидающие критического раздела, добавляются в очередь ожидания. они пробуждении и обычно запрашивают критическую секцию в том порядке, в котором они были добавлены в очередь. Однако если потоки добавляются в эту очередь с достаточной скоростью, производительность может быть снижена из-за времени, затрачиваемого на пробуждение каждого ожидающего потока.

Процесс отвечает за выделение памяти, используемой критическим разделом. Как правило, это делается путем простого объявления переменной с типом **критической \_ Секции**. Прежде чем потоки процесса смогут использовать его, инициализируйте критическую секцию с помощью функции [**инитиализекритикалсектион**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsection) или [**инитиализекритикалсектионандспинкаунт**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) .

Поток использует функцию [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) или [**трентеркритикалсектион**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) для запроса владения критическим разделом. Она использует функцию [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) для освобождения владения критическим разделом. Если объект критического раздела в настоящее время принадлежит другому потоку, **EnterCriticalSection** ожидает неопределенного времени владения. В отличие от этого, если объект Mutex используется для взаимного исключения, [функции Wait](wait-functions.md) принимают заданный интервал времени ожидания. Функция **трентеркритикалсектион** пытается войти в критическую секцию, не блокируя вызывающий поток.

Когда поток владеет критическим разделом, он может выполнять дополнительные вызовы [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection) или [**трентеркритикалсектион**](/windows/win32/api/synchapi/nf-synchapi-tryentercriticalsection) , не блокируя его выполнение. Это предотвращает взаимную взаимоблокировку потока при ожидании того, что он уже принадлежит критическому разделу. Чтобы освободить владение, поток должен вызвать [**LeaveCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-leavecriticalsection) один раз для каждого момента, когда он вошел в критическую секцию. Не гарантируется порядок, в котором ожидающие потоки будут получать владение критическим разделом.

Поток использует функцию [**инитиализекритикалсектионандспинкаунт**](/windows/win32/api/synchapi/nf-synchapi-initializecriticalsectionandspincount) или [**сеткритикалсектионспинкаунт**](/windows/win32/api/synchapi/nf-synchapi-setcriticalsectionspincount) для задания счетчика прокрутки для объекта критической секции. Цикличность означает, что когда поток пытается получить критический раздел, который заблокирован, поток входит в цикл, проверяет, снята ли блокировка, и если блокировка не была снята, поток переходит в спящий режим. В однопроцессорных системах счетчик пропусков игнорируется, а для счетчика критического раздела — значение 0 (ноль). В многопроцессорных системах, если критический раздел недоступен, вызывающий поток вращает *двспинкаунт* раз перед выполнением операции ожидания семафора, связанного с критическим разделом. Если критическая секция будет свободна во время операции Spin, вызывающий поток не будет выполнять операцию ожидания.

Любой поток процесса может использовать функцию [**делетекритикалсектион**](/windows/win32/api/synchapi/nf-synchapi-deletecriticalsection) для освобождения системных ресурсов, выделенных при инициализации объекта критической секции. После вызова этой функции объект критической секции не может быть использован для синхронизации.

При владении объектом критической секции единственными затронутыми потоками являются потоки, ожидающие владение вызовом [**EnterCriticalSection**](/windows/win32/api/synchapi/nf-synchapi-entercriticalsection). Потоки, которые не ожидают ожидания, могут продолжать выполняться.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Мьютексные объекты](mutex-objects.md)
</dt> <dt>

[Использование объектов критических секций](using-critical-section-objects.md)
</dt> </dl>

 

 
