---
description: Приложения должны синхронизировать доступ к переменным, которые являются общими для нескольких потоков.
ms.assetid: 729c0e68-ef52-4d6c-b771-a89043a937e6
title: Доступ к блокируемым переменным
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9b298dffe45d1a0de655e225c8a240dd72be15a0fff7e4d6eac25ebb0a1130ad
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120126324"
---
# <a name="interlocked-variable-access"></a>Доступ к блокируемым переменным

Приложения должны синхронизировать доступ к переменным, которые являются общими для нескольких потоков. Приложения также должны гарантировать, что операции с этими переменными выполняются атомарно (полностью или вообще).

Простые операции чтения и записи с надлежащим образом согласованными 32-разрядными переменными являются атомарными операциями. Иными словами, не придется обновлять только одну часть переменной. все биты обновляются атомарным образом. Однако синхронизация доступа не гарантируется. Если два потока считывают и записываются из одной и той же переменной, невозможно определить, будет ли один поток выполнять операцию чтения, прежде чем другой выполняет операцию записи.

Простые операции чтения и записи для правильно согласованных 64-разрядных переменных являются атомарными для 64-разрядных Windows. Операции чтения и записи в 64-разрядные значения не обязательно должны быть атомарными в 32-бит Windows. Операции чтения и записи в переменные других размеров не обязательно должны быть атомарными на какой бы то ни было платформе.

## <a name="the-interlocked-api"></a>Блокируемый API

Блокируемые функции предоставляют простой механизм для синхронизации доступа к переменной, совместно используемой несколькими потоками. Они также выполняют операции с переменными атомарным способом. Потоки различных процессов могут использовать эти функции, если переменная находится в общей памяти.

Функции [**интерлоккединкремент**](/windows/win32/api/winnt/nf-winnt-interlockedincrement) и [**интерлоккеддекремент**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement) объединяют шаги, связанные с увеличением или уменьшением переменной, в атомарную операцию. Эта функция полезна в многозадачной операционной системе, в которой система может прерывать выполнение одного потока, чтобы предоставить срез времени процессора другому потоку. Без такой синхронизации два потока могут считать одно и то же значение, увеличивать его на 1 и сохранять новое значение для общего увеличения 1 вместо 2. Блокируемые функции доступа к переменным, защищающие от подобных ошибок.

Функции [**интерлоккедексчанже**](/windows/win32/api/winnt/nf-winnt-interlockedexchange) и [**интерлоккедексчанжепоинтер**](/windows/win32/api/winnt/nf-winnt-interlockedexchangepointer) атомарно обмениваются значениями указанных переменных. Функция [**интерлоккедексчанжеадд**](/windows/win32/api/winnt/nf-winnt-interlockedexchangeadd) объединяет две операции: одновременное добавление двух переменных и сохранение результата в одной из переменных.

Функции [**интерлоккедкомпариксчанже**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchange), [**InterlockedCompare64Exchange128**](/previous-versions/windows/desktop/legacy/ms683553(v=vs.85))и [**интерлоккедкомпариксчанжепоинтер**](/windows/win32/api/winnt/nf-winnt-interlockedcompareexchangepointer) объединяют две операции: сравнение двух значений и сохранение третьего значения в одной из переменных в зависимости от результата сравнения.

Функции [**интерлоккеданд**](/windows/win32/api/winnt/nf-winnt-interlockedand), [**взаимоблокировки**](/windows/win32/api/winnt/nf-winnt-interlockedor)и [**интерлоккедксор**](/windows/win32/api/winnt/nf-winnt-interlockedxor) выполняют атомарное выполнение операций and, OR и XOR соответственно.

Существуют функции, специально предназначенные для блокировки доступа к переменным в 64-битных значениях и адресах памяти и оптимизированные для использования в 64-разрядной Windows. Каждая из этих функций содержит "64" в имени; Например, [**InterlockedDecrement64**](/windows/win32/api/winnt/nf-winnt-interlockeddecrement64) и [**InterlockedCompareExchangeAcquire64**](/previous-versions/windows/desktop/legacy/ms683566(v=vs.85)).

большая часть блокируемых функций обеспечивает полную барьеры памяти на всех Windowsных платформах. Существуют также функции, сочетающие базовые операции доступа с блокируемыми переменными с семантикой упорядочивания и освобождения памяти, поддерживаемой определенными процессорами. Каждая из этих функций содержит слово "получение" или "выпуск" в именах; Например, [**интерлоккеддекрементаккуире**](/previous-versions/windows/desktop/legacy/ms683583(v=vs.85)) и [**интерлоккеддекрементрелеасе**](/previous-versions/windows/desktop/legacy/ms683586(v=vs.85)). Семантика получения памяти указывает, что операция с памятью, выполняемая текущим потоком, будет видна перед попыткой выполнения любых других операций с памятью. Семантика высвобождения памяти указывает, что операция с памятью, выполняемая текущим потоком, будет видна после завершения всех других операций с памятью. Эти семантики позволяют принудительно выполнять операции с памятью в определенном порядке. Используйте семантику получения при вводе защищенной области и семантики выпуска при ее сохранении.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Встроенные инструкции компилятора](/cpp/intrinsics/compiler-intrinsics?view=vs-2019)
</dt> <dt>

[Проблемы синхронизации и многопроцессорности](synchronization-and-multiprocessor-issues.md)
</dt> </dl>

 

 
