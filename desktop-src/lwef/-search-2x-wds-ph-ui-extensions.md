---
title: Добавление значков и контекстных меню с расширениями оболочки
description: вы можете улучшить работу пользователей с помощью Microsoft Windows Desktop Search (WDS) и обработчика протокола, реализовав расширения оболочки.
ms.assetid: 899f3fd1-1ae9-45fe-ae6d-26d4f07bf6e4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9198fc56b8ca09e61909b1828d7d00b964bb12c0e13308583eb36a4e2211f3c3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118976874"
---
# <a name="adding-icons-and-context-menus-with-shell-extensions"></a>Добавление значков и контекстных меню с расширениями оболочки

> [!NOTE]
> Windows настольный поиск 2. x — это устаревшая технология, которая изначально была доступна в качестве надстройки для Windows XP и Windows Server 2003. в более поздних выпусках используйте вместо этого [Windows поиск](../search/-search-3x-wds-overview.md) .

вы можете улучшить работу пользователей с помощью Microsoft Windows Desktop Search (WDS) и обработчика протокола, реализовав расширения оболочки. Без дополнительного расширения созданный обработчик протокола не будет включать следующие пользовательские интерфейсы:

-   WDS не будет отображать определенные значки для результатов.
-   Когда пользователь дважды щелкнул элемент, Пользовательский интерфейс не будет отвечать на событие.
-   Когда пользователь правой кнопкой мыши щелкнул элемент, контекстное меню не будет поддерживать никаких операций с элементом.

В **ишеллфолдер** требуются минимальные реализации **IPersist** и **иперсистфолдер** , а для **IContextMenu** и **иекстрактикон** требуется минимальная реализация **ишеллфолдер** . это два интерфейса, обеспечивающие более простой пользовательский интерфейс.

 

## <a name="ipersist"></a>IPersist

Интерфейс **IPersist** определяет единственный метод- **ClassID**, который предназначен для предоставления идентификатора CLSID объекта, который может храниться в системе постоянно.



| Метод       | Описание                                 |
|--------------|---------------------------------------------|
| -ClassID () | Возвращает идентификатор ClassID обработчика протокола. |



 

> [!Note]
>
> Один и тот же CLSID должен быть реализован для **IPersist**, **иперсистфолдер** и **ишеллфолдер**.

 

 

## <a name="ipersistfolder"></a>иперсистфолдер

Интерфейс **иперсистфолдер** используется для инициализации объектов папки оболочки. Реализация этого интерфейса, производного от **IPersist**, заключается в том, как папка сообщается, где она находится в пространстве имен оболочки.



| Метод       | Описание                                                                                            |
|--------------|--------------------------------------------------------------------------------------------------------|
| Initialize () | Указывает объекту папки оболочки инициализировать себя на основе переданных и возвратов \_ ОК |



 

> [!Note]
>
> Один и тот же CLSID должен быть реализован для **IPersist**, **иперсистфолдер** и **ишеллфолдер**.

 

Этот интерфейс не используется напрямую. Он используется реализацией файловой системы интерфейса Ишеллфолдер:: Биндтубжект при инициализации объекта папки оболочки.

 

## <a name="ishellfolder"></a>ишеллфолдер

интерфейс **ишеллфолдер** используется для управления папками, а частичная реализация необходима, чтобы интерфейсы значков и контекста, реализованные для обработчика протокола, были правильно настроены в пользовательском интерфейсе "результаты поиска Windows рабочего стола". Большинство необходимых функциональных возможностей предоставляется с помощью метода **жетуиобжектоф** . Этот метод позволяет надстройке запрашивать интерфейсы **иекстрактикон** и **IContextMenu** .

Интерфейс **ишеллфолдер** использует PIDL вместо URL-адресов. В отличие от требований полного расширения пространства имен надстройки могут использовать простую структуру IDL, содержащую только URL-адрес.

Должны быть реализованы следующие методы **ишеллфолдер** . Обратите внимание, что для пяти этих методов требуется минимальная реализация.



| Метод             | Описание                                                                                                                                                                                                 |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Биндтубжект ()     | Возвращает E \_ нотимпл                                                                                                                                                                                          |
| Биндтостораже ()    | Возвращает E \_ нотимпл                                                                                                                                                                                          |
| Креатевиевобжект () | Возвращает E \_ нотимпл                                                                                                                                                                                          |
| Сетнамеоф ()        | Возвращает E \_ нотимпл                                                                                                                                                                                          |
| Парседисплайнаме () | Преобразует URL-адрес в структуру ПИДЛ                                                                                                                                                                        |
| Компареидс ()       | Сравнивает два значения ПИДЛ                                                                                                                                                                                    |
| Жетдисплайнамеоф () | Возвращает URL-адрес для ПИДЛ                                                                                                                                                                                  |
| Жетуиобжектоф ()    | Этот метод аналогичен методу OLE COM QueryInterface. Если запрошен значок, вызывающий объект запрашивает IID \_ иекстрактикон; если контекстное меню запрашивается, вызывающий объект запрашивает идентификатор IID \_ IContextMenu. |



 

> [!Note]
>
> Один и тот же CLSID должен быть реализован для **IPersist**, **иперсистфолдер** и **ишеллфолдер**.

 

**Ишеллфолдер** не используется для перечисления папок. Это означает, что отображаемое имя папки будет физическим URL-адресом. Это может измениться в будущем.

 

## <a name="icontextmenu"></a>IContextMenu

Когда WDS отображает результаты для пользователя, пользователь может щелкнуть правой кнопкой мыши элемент и просмотреть контекстное меню, определенное интерфейсом **IContextMenu** .

Действие по умолчанию в контекстном меню — это то же действие, которое предпринимается при двойном щелчке элемента. При отсутствии соответствующих интерфейсов **ишеллфолдер** или **IContextMenu** для элемента поведение по умолчанию для события двойного щелчка заключается в передаче URL-адреса в качестве аргумента функции ShellExecute.

 

## <a name="iextracticon"></a>иекстрактикон

**Иекстрактикон** получает значок для ПОЛЬЗОВАТЕЛЬСКОГО интерфейса WDS на основе URL-адреса в Пидл, предоставленного обработчиком протокола.

 

## <a name="code-sample"></a>Образец кода

В [примере кода пользовательского интерфейса обработчика пользовательских протоколов](-search-2x-wds-ph-ui-samplecode.md) демонстрируется реализация **ишеллфолдер** и вспомогательных интерфейсов, а также поддержка манипуляций с PIDL.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Reference**
</dt> <dt>

[Пример кода пользовательского интерфейса обработчика настраиваемых протоколов](-search-2x-wds-ph-ui-samplecode.md)
</dt> <dt>

[Установка и регистрация обработчиков протоколов](-search-2x-wds-ph-install-registration.md)
</dt> </dl>

 

 




