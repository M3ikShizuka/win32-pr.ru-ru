---
title: Создание обработчиков столбцов
description: в представлении "сведения" в Windows обозревателе Windows обычно отображается несколько стандартных столбцов.
ms.assetid: 805e0e13-d09e-40f8-955b-c585f388e07e
keywords:
- обработчики столбцов
- регистрация, обработчики столбцов
- GetColumnInfo
- жетитемдата
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90876aecdb2626326513723f0cd2c5a6e8f66bfd938b3f56cf10bd3624dd8687
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119349473"
---
# <a name="creating-column-handlers"></a>Создание обработчиков столбцов

\[эта функция поддерживается только в Windows XP и более ранних версиях. \]

в представлении "сведения" в Windows обозревателе Windows обычно отображается несколько стандартных столбцов. В каждом столбце содержится информация, например размер файла или тип, для каждого файла в текущей папке. Путем реализации и регистрации обработчика столбца можно сделать пользовательские столбцы доступными для вывода.

Общие процедуры для реализации и регистрации обработчика расширений оболочки обсуждаются в разделе [Создание обработчиков расширений оболочки](/windows/desktop/shell/handlers). В этом документе рассматриваются аспекты реализации, характерные для обработчиков столбцов.

Обсуждаются следующие темы.

-   [Принципы работы обработчиков столбцов](#how-column-handlers-work)
-   [Регистрация обработчиков столбцов](#registering-column-handlers)
-   [Реализация обработчиков столбцов](#implementing-column-handlers)
    -   [Метод Initialize](#the-initialize-method)
    -   [Метод GetColumnInfo](#the-getcolumninfo-method)
    -   [Метод Жетитемдата](#the-getitemdata-method)

## <a name="how-column-handlers-work"></a>Принципы работы обработчиков столбцов

на следующем рисунке показан Windows Explorer в представлении details.

![снимок экрана проводника Windows в представлении сведений](images/columnproviderhandler1.jpg)

в Windows 2000 эта папка также может поддерживать ряд столбцов, которые по умолчанию не отображаются. Пользователь может отобразить дополнительные столбцы, щелкнув один из заголовков столбцов правой кнопкой мыши и выбрав команду **More...** в меню. Откроется диалоговое окно со списком доступных столбцов для папки и позволяет пользователю выбрать отображаемые столбцы. На следующем рисунке показано это диалоговое окно для предыдущего примера.

![снимок экрана окна проводника Windows с отображаемым диалоговым окном "Выбор сведений"](images/columnproviderhandler2.jpg)

Создавая обработчик столбца, можно создавать пользовательские столбцы и добавлять их в этот список. Например, коллекция файлов, содержащих музыку, может использовать обработчик столбца для отображения столбцов, содержащих сведения об исполнителе и элементе, содержащемся в каждом файле.

обработчик столбца — это глобальный объект, который вызывается каждый раз, когда Windows Explorer отображает подробное представление. Однако обработчики столбцов обычно используются для вывода пользовательских столбцов только для членов определенного [типа файлов](/windows/desktop/shell/fa-file-types). перед отображением подробного представления Windows Explorer запрашивает все обработчики зарегистрированных столбцов для их характеристик столбцов. если пользователь выбрал один из столбцов обработчика, Windows Explorer запрашивает обработчик для связанных данных. Когда обработчик столбца получает запрос на данные, он предоставляет его, если файл является членом поддерживаемого типа. В противном случае запрос игнорируется путем возвращения значения \_ false.

## <a name="registering-column-handlers"></a>Регистрация обработчиков столбцов

Обработчики столбцов регистрируются в следующем подразделе.

```
HKEY_CLASSES_ROOT
   Folder
      shellex
         ColumnHandlers
```

Создайте подраздел **колумнхандлерс** с именем в виде строки GUID идентификатора класса обработчика (CLSID). Общие сведения о регистрации обработчиков расширений оболочки см. в статье [Создание обработчиков расширений](/windows/desktop/shell/handlers)оболочки. В следующем примере показано, как зарегистрировать обработчик столбца.

```
HKEY_CLASSES_ROOT
   Folder
      shellex
         ColumnHandlers
            {My Column Handler CLSID GUID}
```

## <a name="implementing-column-handlers"></a>Реализация обработчиков столбцов

Как и все обработчики расширений оболочки, обработчики столбцов — это объекты модели COM, реализованные в виде библиотек DLL. В дополнение к [IUnknown](/windows/win32/api/unknwn/nn-unknwn-iunknown), они экспортируют интерфейс [**иколумнпровидер**](/windows/desktop/api/shlobj/nn-shlobj-icolumnprovider) .

Windows Обозреватель вызывает три метода, экспортированные с помощью [**иколумнпровидер**](/windows/desktop/api/shlobj/nn-shlobj-icolumnprovider) , чтобы запросить сведения, необходимые для вывода столбца. процедура, используемая обозревателем Windows:

1.  Вызовите [**иколумнпровидер:: Initialize**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-initialize) , чтобы указать папку, которая будет отображаться.
2.  Вызовите метод [**иколумнпровидер:: GetColumnInfo**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-getcolumninfo) , чтобы получить идентификатор и характеристики столбца.
3.  Если столбец выбран пользователем, вызовите [**иколумнпровидер:: жетитемдата**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-getitemdata) для каждого файла в папке, чтобы получить данные, которые принадлежат записи столбца файла.

### <a name="the-initialize-method"></a>Метод Initialize

Windows Обозреватель вызывает метод [**иколумнпровидер:: Initialize**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-initialize) для инициализации обработчика столбца. Метод имеет три параметра, но в настоящее время используется только *всзфолдер* . Задана папка, представление сведений о которой будет отображаться. Сохраните имя папки для последующего использования и инициализируйте объект обработчика по мере необходимости.

### <a name="the-getcolumninfo-method"></a>Метод GetColumnInfo

Windows Далее обозреватель вызывает [**иколумнпровидер:: GetColumnInfo**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-getcolumninfo) , чтобы запросить идентификатор и характеристики столбца. Он передает индекс для столбца в параметре *двиндекс* . Этот индекс является произвольным значением, используемым для перечисления столбцов. Windows Обозреватель также передает указатель на структуру [**школумнинфо**](/windows/desktop/api/shlobj/ns-shlobj-shcolumninfo) . Эта структура используется для возвращения идентификатора и характеристик столбца. **Иколумнпровидер:: GetColumnInfo** должен назначать соответствующие значения членам структуры и возвращать.

Столбцы идентифицируются по ИДЕНТИФИКАТОРу набора свойств OLE (FMTID) и связанному ИДЕНТИФИКАТОРу свойства (PID). Первый элемент структуры [**школумнинфо**](/windows/desktop/api/shlobj/ns-shlobj-shcolumninfo) , **сЦид**, является указателем на структуру [**школумнид**](/windows/desktop/shell/objects) , которая используется для задания столбца. Его член **fmtid** содержит fmtid столбца, а его элемент **PID** содержит идентификатор процесса столбца. Например, стандартная пара FMTID/PID, которая обычно используется для задания столбцов, — это идентификатор автора набора свойств сводных данных.

Если это возможно, обработчик должен использовать существующие Фмтидс и идентификаторы PID, чтобы указать столбец, который он поддерживает. Если используется пользовательская структура [**школумнид**](/windows/desktop/shell/objects) , в столбце будут отображаться данные только для тех файлов, которые поддерживаются обработчиком. Если в папке содержатся другие файлы, их записи будут пустыми. Если папка содержит файлы более чем из одного типа, использование стандартных значений FMTID/PID может привести к объединению данных из разных типов в один столбец.

Присвойте элементу **VT** тип [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) для данных, которые должны отображаться в столбце. Чаще всего используется тип VT \_ LPSTR, так как в большинстве столбцов данные отображаются в виде символьных строк. Остальные элементы структуры [**школумнинфо**](/windows/desktop/api/shlobj/ns-shlobj-shcolumninfo) используются для определения характеристик столбца. Присвойте значения соответствующим образом.

### <a name="the-getitemdata-method"></a>Метод Жетитемдата

если выбран столбец обработчика столбца, Windows Explorer вызывает [**иколумнпровидер:: жетитемдата**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-getitemdata) для каждого файла в отображаемой папке. Параметр *псЦид* является указателем на структуру [**школумнид**](/windows/desktop/shell/objects) , которая идентифицирует столбец. Параметр *пскд* указывает на структуру [**школумндата**](/windows/desktop/api/shlobj/ns-shlobj-shcolumndata) , определяющую конкретный файл.

Параметр *пвардата* возвращает данные, которые должны отображаться в столбце обработчика для файла, заданного параметром *пскд*. Если этот файл поддерживается обработчиком столбцов, присвойте ему значение *пвардата* и возвратите S \_ ОК. Если этот файл не поддерживается обработчиком столбцов, возвратите \_ значение false, не присваивая значения *пвардата*.

Во многих папках будет содержаться несколько файлов, которые не поддерживаются каким-либо конкретным обработчиком столбцов. Чтобы повысить эффективность, [**иколумнпровидер:: жетитемдата**](/windows/desktop/api/shlobj/nf-shlobj-icolumnprovider-getitemdata) должен сначала проверить элемент **пвсзекст** структуры, на который указывает *пскд*. Этот член содержит расширение имени файла. Если расширение указывает, что файл не является членом типа файла, поддерживаемого обработчиком, следует избегать ненужной обработки, немедленно возвращая \_ false.

 

 