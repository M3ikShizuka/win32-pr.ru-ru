---
title: Добавление функциональных возможностей агента Microsoft Agent в приложение
description: Добавление функциональных возможностей агента Microsoft Agent в приложение
ms.assetid: 2b4816dd-11bf-4c17-873e-4bdbb7fa1ccf
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a2972b0251a4114e5d280d8f739d416ebc5dc1c
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337076"
---
# <a name="adding-microsoft-agent-functionality-to-your-application"></a>Добавление функциональных возможностей агента Microsoft Agent в приложение

\[Microsoft Agent является устаревшим в Windows 7 и может быть недоступен в последующих версиях Windows.\]

Для доступа к интерфейсам сервера Microsoft Agent агент должен быть уже установлен в целевой системе. Установка, отличная от использования автономного исполняемого файла агента, например попытки копирования и регистрации файлов компонентов агента, не поддерживается. Это гарантирует последовательную и полную установку. Обратите внимание, что самостоятельно устанавливаемый файл Microsoft Agent не будет установлен в Microsoft Windows 2000 и более поздних операционных системах, так как эти версии операционной системы уже содержат собственную версию агента.

Чтобы успешно установить агент в целевой системе с предыдущей операционной системой Microsoft Windows, необходимо также убедиться в том, что в целевой системе установлена последняя версия среды выполнения Microsoft Visual C++ (Msvcrt.dll), средство регистрации Майкрософт (Regsvr32.dll) и библиотеки DLL Microsoft COM. Самый простой способ убедиться, что необходимые компоненты находятся в целевой системе, — это требовать установки Microsoft Internet Explorer 3,02 или более поздней версии. Кроме того, можно установить два первых компонента, которые доступны в составе Microsoft Visual C++. Необходимые DLL-библиотеки COM можно установить в рамках обновления Microsoft DCOM, доступного на веб-сайте Майкрософт. Дополнительные сведения и сведения о лицензировании для этих компонентов можно найти на веб-сайте Майкрософт.

Компоненты языка агента можно установить таким же образом. Аналогичным образом можно использовать этот метод, чтобы установить формат ACS символов Майкрософт, доступных для распространения, с веб-сайта Microsoft Agent. Файлы символов автоматически устанавливаются в подкаталог Microsoft Agent \\ chars.

Поскольку компоненты Microsoft Agent разработаны как компоненты операционной системы, агент может не быть удален. Аналогично, когда агент уже установлен в составе операционной системы Windows, сам установочный CAB-файл агента может не устанавливаться.

После установки для вызова интерфейсов агента создайте экземпляр сервера и запросите указатель на конкретный интерфейс, который сервер поддерживает, используя стандартное соглашение COM. В частности, Библиотека COM предоставляет функцию API, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance), которая создает экземпляр объекта и возвращает указатель на запрашиваемый интерфейс объекта. Запросите указатель на интерфейс [**иажент**](iagent.md) или [**иажентекс**](iagentex.md) в вызове **CoCreateInstance** или в последующем вызове [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)).

Следующий код иллюстрирует это в C/C++.


```
hRes = CoCreateInstance(CLSID_AgentServer,
                     NULL,
                     CLSCTX_SERVER,
                     IID_IAgentEx,
                     (LPVOID *)&amp;pAgentEx);
```



Если сервер Microsoft Agent работает, эта функция подключается к серверу; в противном случае запускается сервер.

Обратите внимание, что интерфейсы сервера Microsoft Agent часто включают в себя расширенные интерфейсы, включающие суффикс "ex". Эти интерфейсы являются производными от и, следовательно, включают все функции, их аналоги, не относящиеся к ex. Если вы хотите использовать любой из расширенных функций, используйте интерфейсы ex.

Функции, которые принимают указатели на BSTR, выделяют память с помощью [**сисаллокстринг**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysallocstring). Он отвечает за освобождение этой памяти с помощью [**сисфристринг**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-sysfreestring).

 

 