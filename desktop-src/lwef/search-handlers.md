---
title: Создание обработчиков поиска
description: Оболочка поддерживает несколько служебных программ поиска, позволяющих пользователям находить объекты пространства имен, такие как файлы или принтеры. Вы можете создать пользовательскую подсистему поиска и сделать ее доступной для пользователей, реализовав и зарегистрировав обработчик поиска.
ms.assetid: ffd023bb-16ab-43ce-b00b-5e32656c8013
keywords:
- Поиск обработчиков
- регистрация, обработчики поиска
- Статические обработчики поиска
- Регистр, статические обработчики поиска
- динамические обработчики поиска
- регистрация, динамические обработчики поиска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e6476109302a176822137747353b2762b0caea8a
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337340"
---
# <a name="creating-search-handlers"></a>Создание обработчиков поиска

\[Эта функция поддерживается только в Windows XP и более ранних версиях. Используйте вместо этого Поиск Windows.\]

Оболочка поддерживает несколько служебных программ поиска, позволяющих пользователям находить объекты пространства имен, такие как файлы или принтеры. Вы можете создать пользовательскую подсистему поиска и сделать ее доступной для пользователей, реализовав и зарегистрировав *обработчик поиска*.

Общие процедуры для реализации и регистрации обработчика расширений оболочки обсуждаются в разделе [Создание обработчиков расширений оболочки](/windows/desktop/shell/handlers). В этом документе рассматриваются аспекты реализации, характерные для обработчиков поиска.

-   [Принципы работы обработчиков поиска](#how-search-handlers-work)
-   [Регистрация обработчиков поиска](#registering-search-handlers)
    -   [Регистрация статического обработчика поиска](#registering-a-static-search-handler)
    -   [Регистрация динамического обработчика поиска](#registering-a-dynamic-search-handler)
-   [Реализация обработчиков поиска](#implementing-search-handlers)

## <a name="how-search-handlers-work"></a>Принципы работы обработчиков поиска

Пользователи могут выбрать поисковую подсистему двумя способами. Первый способ — из меню "Пуск". В системах, предшествующих Windows 2000, при выборе команды **найти** в меню **Пуск** отображается подменю доступных поисковых систем. В Windows 2000 и более поздних версиях команда Find **меню «** **найти** » переименована в область поиска. На следующем рисунке показана кнопка **поиска** в системе Windows XP.

![подменю "Поиск" в меню "Пуск"](images/searchhandler1.jpg)

Пользователи также могут запускать поиск в проводнике Windows. В системах, предшествующих Windows 2000, они **находят** в меню **Сервис** команду найти, чтобы отобразить практически то же меню, которое было связано с меню **Пуск** . Однако проводник Windows для Windows 2000 обрабатывает поисковые системы по-другому. Вместо того чтобы обрабатывать поисковые системы в виде подменю меню **Сервис** , теперь на панели инструментов появилась кнопка **поиска** . Нажатие этой кнопки открывает панель **поиска** панели обозревателя. На следующем рисунке показан **Поиск по панели поиска файлов и папок** .

![панель "Поиск" панели проводника Windows](images/searchhandler2.jpg)

Существует ряд различий в том, как Windows 2000 и более ранние системы управляют обработчиками поиска, которые влияют на реализацию и регистрацию.



| Пред-Windows 2000                                                                                                                                                                                                       | Windows 2000 и более поздние версии                                                                                                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Обработчики поиска реализуются как тип [обработчика контекстного меню](/windows/desktop/shell/context-menu-handlers).                                                                                                                     | Обработчики поиска могут быть реализованы в виде обработчиков контекстного меню или в виде динамических HTML-документов (DHTML).                                                                                                                                                                                                               |
| Обработчики поиска могут быть либо статическими, либо динамическими. Статические обработчики загружаются только в том случае, если они выбраны пользователем. Динамические обработчики загружаются оболочкой при запуске и не завершаются до тех пор, пока оболочка не завершит работу. | Обработчики, реализованные как обработчики контекстного меню, могут быть либо статическими, либо динамическими. Обработчики, реализованные как документы DHTML, должны быть статическими.                                                                                                                                                                           |
| Обработчики поиска отображаются в подменю " **найти** " меню " **Пуск** " и подменю " **найти** " меню " **Сервис** " проводника Windows.                                                                                  | Обработчики поиска отображаются только в подменю **Поиск** меню **Пуск** . Чтобы сделать настраиваемую панель поиска доступной в строке меню проводника Windows, необходимо реализовать ее как [объект диапазона](/previous-versions/windows/desktop/legacy/cc144099(v=vs.85)). Затем она отображается в подменю **панели обозревателя** в меню  **вид** проводника Windows. |



 

## <a name="registering-search-handlers"></a>Регистрация обработчиков поиска

Обработчики поиска регистрируются в подразделе **финдекстенсионс** типов файлов.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FindExtensions
```

С этого момента процедура регистрации зависит от того, должен ли обработчик быть статическим или динамическим. Общие сведения о регистрации обработчиков расширений оболочки см. в статье [Создание обработчиков расширений](/windows/desktop/shell/handlers)оболочки.

### <a name="registering-a-static-search-handler"></a>Регистрация статического обработчика поиска

Статические обработчики поиска загружаются только при запуске пользователем. Этот подход лучше подходит для небольших библиотек DLL, которые можно быстро загрузить. Если для реализации обработчика используется DHTML, он должен быть статическим. Чтобы зарегистрировать статический обработчик расширений, создайте подраздел с именем для обработчика в **статическом** подразделе подраздела **финдекстенсионс** . Имя не используется системой, но оно не должно совпадать с другими именами обработчиков поиска в подразделе **финдекстенсионс** .

### <a name="shortcut-menu-based-search-handlers"></a>Обработчики поиска на основе контекстного меню

Если обработчик реализуется как [обработчик контекстного меню](/windows/desktop/shell/context-menu-handlers), установите значение по умолчанию для подраздела имени обработчика в GUID идентификатора класса (CLSID) объекта. В подразделе имени обработчика создайте подраздел с именем **0**   (ноль) и задайте в качестве значения по умолчанию строку, которая будет отображаться в подменю **Поиск** или **найти** . Сочетания клавиш можно включить обычным способом, добавив перед ним символ амперсанда (&). Можно отобразить необязательный маленький значок справа от текста меню, создав подраздел **дефаултикон** в подразделе **0** . Присвойте значение по умолчанию строке, содержащей путь к файлу, содержащему значок, за которым следует запятая, а затем — Отсчитываемый от нуля индекс.

В следующем примере регистрируется обработчик поиска **мисеарченгине** . Текст меню — "Моя поисковая система", а в качестве сочетания клавиш задано значение M. Значок находится в C: \\ MyDir \\MySearch.dll с индексом 2.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FindExtensions
                     Static
                        MySearchEngine
                           (Default) = {MySearchEngine CLSID GUID}
                           0
                              (Default) = &My Search Engine
                              DefaultIcon
                                 (Default) = c:\MyDir\MySearch.dll,2
```

### <a name="dhtml-based-search-handlers"></a>Обработчики поиска на основе DHTML

В Windows 2000 можно также реализовать обработчик поиска в виде документа DHTML. Его имя указано в подменю **Поиск** в меню **Пуск** . Когда пользователь выбирает его, он запускает проводник Windows с открытой в нем панелью обозревателя. Можно также указать документ DHTML, который будет отображаться справа от панели обозревателя. Невозможно запустить другой обработчик из панели поиска по умолчанию. Поисковые системы можно запустить непосредственно из проводника Windows, но только в том случае, если они реализованы как [объекты полос](/previous-versions/windows/desktop/legacy/cc144099(v=vs.85)).

Чтобы зарегистрировать обработчик поиска на основе DHTML, задайте для подраздела имени обработчика форму строки CLSID \_ шеллсеарчекст (в настоящее время {169A0691-8DF9-11D1-A1C4-00C04FD75D13}) и создайте следующие подразделы.

1.  Создайте подраздел **0**(нуль) в подразделе "имя обработчика" и задайте в качестве значения по умолчанию текст меню.
2.  Чтобы значок отображался рядом с текстом меню, создайте подраздел **дефаултикон** в разделе **0** и задайте в качестве значения по умолчанию путь и индекс значка.
3.  Создайте подраздел **сеарчгуид** в разделе **0**. Назначьте идентификатор GUID для документа DHTML и задайте в качестве значения по умолчанию **сеарчгуид** строку. Этот идентификатор GUID не требуется регистрировать в **\_ \_ корневом \\ идентификаторе CLSID классов hKey**.
4.  Создайте подраздел **URL-адреса** в разделе **сеарчгуид**. Задайте в качестве значения по умолчанию путь к HTML-документу, который будет отображаться на панели обозревателя.
5.  Создайте подраздел **урлнавнев** в разделе **сеарчгуид**. Задайте в качестве значения по умолчанию путь к HTML-документу, который будет отображаться справа от панели обозревателя.

В следующем примере выполняется регистрация обработчика поиска **мисеарченгине** , реализованного в виде документа DHTML. Текст меню — "Моя поисковая система", а в качестве сочетания клавиш задано значение M. Значок находится в C: \\ MyDir \\MySearch.dll с индексом 2. HTML-документ панели обозревателя имеет значение C: \\ MyDir \\MySearch.htm, а документ, который будет отображаться справа от панели обозревателя, — c: \\ MyDir \\MySearchPage.htm.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FindExtensions
                     Static
                        MySearchEngine
                           (Default) = {169A0691-8DF9-11d1-A1C4-00C04FD75D13}
                           0
                              (Default) = &My Search Engine
                              DefaultIcon
                                 (Default) = c:\MyDir\MySearch.dll,2
                                 SearchGUID
                                    (Default) = {My Search GUID}
                                    Url
                                       (Default) = C:\MyDir\MySearch.htm
                                    UrlNavNew
                                       (Default) = C:\MyDir\MySearchPage.htm
```

### <a name="registering-a-dynamic-search-handler"></a>Регистрация динамического обработчика поиска

Если обработчик реализуется как [обработчик контекстного меню](/windows/desktop/shell/context-menu-handlers), его также можно зарегистрировать как динамический обработчик. В этом случае он будет загружен с оболочкой и завершится только после выхода из оболочки. Динамические обработчики поиска отвечают гораздо быстрее, чем статические обработчики, когда они запускаются пользователем. Такой подход лучше всего подходит, если загрузка DLL-библиотеки обработчика может занять много времени или часто вызывается.

Динамические обработчики поиска регистрируются в подразделе **финдекстенсионс** .

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FindExtensions
```

Создайте подраздел **финдекстенсионс** с именем для обработчика и задайте для его значения по умолчанию идентификатор CLSID обработчика. Значки меню не поддерживаются для обработчиков динамического поиска. В следующем примере Мисеарченгине регистрируется в качестве динамического обработчика поиска.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FindExtensions
                     MySearchEngine
                        (Default) = {MySearchEngine CLSID GUID}
                        0
                           (Default) = &My Search Engine
```

В отличие от статических обработчиков поиска, текст меню не указывается в реестре. Когда обработчик загружен, оболочка вызывает метод обработчика [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) , чтобы добавить элементы в подменю **Поиск** или **Поиск** .

## <a name="implementing-search-handlers"></a>Реализация обработчиков поиска

Обработчики поиска могут быть реализованы как обработчики контекстного меню для всех версий Windows. Для Windows 2000 они также могут быть реализованы в виде документов DHTML.

Общее описание способов реализации обработчиков контекстного меню см. в разделе [Создание обработчиков контекстного](/windows/desktop/shell/context-menu-handlers)меню. Обработчики поиска отличаются от стандартных обработчиков контекстного меню только несколькими способами.

Для обработчиков статического меню подменю **Поиск** или **Поиск** создается на основе сведений в реестре. Обработчику не нужно добавлять элемент меню в качестве обычного обработчика контекстного меню. Оболочка управляет обработчиками статических меню следующим образом.

-   Когда пользователь запускает пункт меню обработчика, оболочка загружает DLL-библиотеку обработчика и вызывает [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) , чтобы уведомить обработчик о необходимости запуска поисковой системы. Методы [**ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) и [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) не вызываются.
-   При вызове [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) элемент **лпверб** структуры [**кминвокекоммандинфо**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-cminvokecommandinfo) , который передается, идентифицирует команду. Младшее слово **лпверб** устанавливается равным числовому эквиваленту имени подраздела команды. Так как этот подраздел обычно называется **0**, **лпверб** обычно имеет нулевое значение. Затем обработчик должен запустить поисковую подсистему.

Динамические обработчики поиска реализуются во многом так же, как и обычные обработчики контекстного меню. Основное исключение заключается в том, что при вызове [**ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) для аргументов *пидлфолдер* и *лпдобж* устанавливается **значение NULL**.

Обработчики поиска на основе DHTML реализуются как обычные документы DHTML. Они могут включать в себя любую технологию HTML, DHTML или сценарии, поддерживаемую Windows Internet Explorer.

 

 