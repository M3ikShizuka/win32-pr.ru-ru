---
title: Исрресграфекс и Иаттрибутес
description: Исрресграфекс и Иаттрибутес
ms.assetid: 6eb37da1-5252-4c41-891c-c19cca6fb7d1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 659d7d4723bfc5145fb8abcc77043031a0e48e8b
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069832"
---
# <a name="isrresgraphex-and-iattributes"></a>Исрресграфекс и Иаттрибутес

\[Microsoft Agent является устаревшим в Windows 7 и может быть недоступен в последующих версиях Windows.\]

Объекты результатов, возвращаемые ядром, должны поддерживать интерфейс Исрресграфекс и интерфейс Иаттрибутес. Достаточно поддерживать интерфейс Исрресграфекс, чтобы позволить редактору звуковых данных предоставлять информацию о разбиении на слова, но не предоставляет необходимую поддержку информации о phoneme.

Для работы редактора звука требуется, чтобы модули поддерживали специальный атрибут DWord, **сраттр \_ фонесег**. Редактор запрашивает у обработчиков интерфейс Иаттрибутес и пытается установить **сраттр \_ фонесег** в значение 1. Если этот вызов завершится удачно, в звуковом редакторе предполагается, что результаты ядра будут поддерживать сбор сведений о phoneme сегментации из объекта Results.

`#define    SRATTR_PHONESEG    MAKELONG (1, SRVEN_MICROSOFT)`

Когда объект результатов передается в редактор звука, он запрашивает этот объект для своей реализации Исрресграфекс. Исрресграфекс содержит функцию-член Датажет с сигнатурой типа

`HRESULT  DataGet  (DWord, dwID, GUID gAttrib, SDATA *psData)`

Где **ДВИД** — это идентификатор объекта Graph, **ГАТТРИБ** — это GUID, соответствующий искомому атрибуту, а **psData** — это указатель на объект sdata, содержащий возвращаемые данные. Модуль отвечает за выделение данных, хранящихся в **psData** , с помощью [**CoTaskMemAlloc**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemalloc). Вызывающее приложение (в данном случае это редактор звука) отвечает за его освобождение через [**CoTaskMemFree**](/windows/desktop/api/combaseapi/nf-combaseapi-cotaskmemfree) по завершении.

Датажет требуется для распознавания трех стандартных идентификаторов GUID, которые перечислены в документации по SAPI. Ядро, возвращающее код успешного выполнения для вызова **типа DWORD (сраттр \_ фонесег, 1)** , также требуется для распознавания определенного идентификатора GUID, **сргарк \_ Фонемесегментатион** при вызове с **ДВИД** , соответствующим границе в графе.

`DEFINE_GUID(SRGARC_PHONMESEGMENTATION, 0xd05405b0, 0x1db1, 0x11d2, 0x94, 0x2, 0x0, 0xc0, 0x4f, 0x8e, 0xf4, 0x8f);`

Когда вызов возвращает, **psData** должен указывать на массив структуры типа **фонесег**, ВЫзываемой с параметром DWORD, определяемый:

``` syntax
typedef struct tagSRPHONESEG {
   DWORD   dwSize;       // Size of the SRPHONESEG structure + phone data
   QWORD   qwStartTime;  // SAPI timestamp of the start of the seqment
   …QWORD   qwEndTime;    // SAPI timestamp of the end of the seqment
   int      nScore;      // The segment's score
   WCHAR   aPhones[0];   // Array of phone(s) making up the segment
} SRPHONESEG,  *PSRPHONESEG;
```

где **квстарттиме** и **квендтиме** указывают на начало и конец каждого phoneme, охватывающего слово, и **Афонес** представляет собой массив символов Юникода, соответствующий IPA представлению телефона, которое было создано в этом сегменте. (В некоторых языках есть фонемы, которые написаны несколько IPA phoneme. Например, на английском языке «длинный I» в слове «Live» на самом деле является дифсонг, который состоит из двух более простых фонемы сцепленных друг с другом.) Массив **афонес** должен быть нулевым нулем и дополняются в конце, чтобы каждая структура **срфонесег** в массиве стала четным кратной четырем байтам.

Например, предположим, что слово, произнесенное на дугу 4, было «сделано». Затем вызов Датажет (4, **сргарк \_ фонемесегментатион**, &SD) может вернуть массив из трех сегментов phoneme,/м/, выполняемых от **квстарттиме**= 328434 байт до **квендтиме**= 330354 байт,/1E/с **квстарттиме**= 330354 байт до **квендтиме**= 344114 байт и/d/с **qwStartTime**= 344114 байт до **qwEndTime**= 347314 байт. Они будут представлены в виде упакованного массива из трех **срфонесег** структур размером 28, 32 и 28 байтов соответственно. Обратите внимание, что в конце средней **срфонесег** структуры имеется некоторое внутреннее поле, чтобы следующий элемент массива начинался с 4-байтной границы.

Пакет SDK для SAPI 4,0 включает средство (Срфунк) для тестирования соответствия спецификации SAPI 4,0. В этот инструмент входит проверка соответствия с этим набором интерфейсов. Исходный код этого средства является хорошим местом для начала работы, чтобы понять, как эти интерфейсы взаимодействуют с звуковым редактором и будут отлаживать интерфейсы во время разработки.

 

 