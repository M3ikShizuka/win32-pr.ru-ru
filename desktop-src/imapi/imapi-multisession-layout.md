---
title: Многосеансовый макет IMAPI
description: IMAPI предоставляет разработчикам приложений возможность создавать образы файловой системы ISO 9660 и UDF и записывать их на компакт-диск, DVD-диск и Blu-Ray \ 8482; оптические носители.
ms.assetid: 691fdc3a-e762-4d6d-9980-e2d9227100a5
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2581672fac78d23a0d2f4e2bc36ee4227adbca1d
ms.sourcegitcommit: af9983bab40fe0b042f177ce7ca79f2eb0f9d0e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "104557476"
---
# <a name="imapi-multisession-layout"></a>Многосеансовый макет IMAPI

IMAPI предоставляет разработчикам приложений возможность создавать образы файловой системы ISO 9660 и UDF и записывать их на компакт-диски, диски DVD и Blu-Ray™ оптические носители. В Windows 7 IMAPI обеспечивает дополнительную поддержку для записи в многосеансовую запись на DVD и Blu-Ray™ перезаписываемый носитель.

В следующей документации описана структура диска, используемая IMAPI для реализации многосеансовой связи. Эти сведения следует использовать для обеспечения взаимодействия между IMAPI и другим программным обеспечением записи, а также для разработчиков этого программного обеспечения, позволяющего создавать многосеансовые образы дисков с поддержкой IMAPI.

> [!Note]  
> Пример, посвященный созданию многосеансового диска, см. в разделе [Создание диска с многосеансовой](creating-a-multisession-disc.md)информацией.

 

## <a name="multisession-on-sequential-media"></a>Многосеансы на последовательных носителях

Реализация многосеансового подключения IMAPI на последовательных носителях поддерживается для использования с носителями CD-R, CD-RW, DVD-R, DVD + R и Blu-Ray™. IMAPI использует режим записи сеанса "на один раз" для CD-RW, и в этом случае формат считается последовательным типом носителя.

В сценарии, включающем многосеансы на последовательных носителях с помощью UDF, IMAPI записывает структуры привязки (указатель на дескриптор тома привязки UDF-АВДП), структуры томов (последовательность дескрипторов UDF) и структуры метаданных файловой системы (дескриптор набора файлов UDF-ФСД) в начале каждого нового сеанса, как описано на следующей схеме:

![Схема, на которой показана структура метаданных файловой системы с точкой подключения "import/F S", обозначенной красной стрелкой на точке привязки физического сеанса 2.](images/multises1.png)

> [!Note]  
> На этом рисунке показана структура диска IMAPI при использовании UDF 2,50 с избыточными метаданными.

 

Данные, хранящиеся на последовательных записанных носителях, состоят из нескольких физических сеансов. Каждый сеанс содержит полную файловую систему, представляющую данные пользователя, в виде набора файлов, упорядоченных в каталогах. Метаданные файловой системы состоят из нескольких иерархических структур данных. В верхней части иерархии находятся структуры привязки (АВДП), расположенные в заранее определенных логических адресах блоков (Лбас). Структуры привязки указывают расположения структур следующего уровня, которые не имеют предопределенных адресов. Следующий уровень иерархии после структур привязки содержит структуры томов (VDS), описывающие свойства тома и ссылающиеся на структуры метаданных файловой системы (ФСД), которые, в свою очередь, описывают отдельные файлы и каталоги.

## <a name="multisession-on-rewritable-media"></a>Многосеансы на перезаписываемом носителе

Метод последовательного медиа, описанный в предыдущем разделе, несовместим с перезаписываемым (не последовательным) носителем. Эти форматы мультимедиа включают диски DVD-RW, DVD + RW, DVD-RAM, Blu-Ray™ перезаписываемый и другой произвольный носитель, например, Iomega. Перезаписываемый носитель не поддерживает концепцию физических сеансов, соответствующих логическим сеансам, которые являются отдельными приращениями, зафиксированными главным приложением. Предоставляется только один физический сеанс, который является областью, которая начинается с начала диска и представляет всю адресную область, которая может содержать несколько логических сеансов.

> [!Note]  
> Хотя диск DVD-RW является исключением в том, что он поддерживает концепцию физического сеанса в последовательном режиме, эта возможность в настоящее время не поддерживается IMAPI.

 

Чтобы устранить отсутствие сопоставления "один к одному" между физическими и логическими сеансами в перезаписываемых форматах, IMAPI выборочно обновляет структуры привязки (АВДП) в *первом* логическом сеансе, чтобы они указывали на новые структуры ТОМОВ (VDS) и структуры метаданных файловой системы (ФСД) в начале *последнего* логического сеанса, как описано на следующей схеме:

![Схема, на которой показана структура метаданных файловой системы с "точкой подключения" import/F S ", обозначенной красной стрелкой на" Anchor "логического сеанса 1.](images/multises2.png)

> [!Note]  
> На этом рисунке показана структура диска IMAPI при использовании UDF 2,50 с избыточными метаданными.

 

При добавлении нового логического сеанса к перезаписываемому диску IMAPI сначала определяет конец последнего логического сеанса путем анализа метаданных тома (VDS). Затем IMAPI добавляет новый логический сеанс с новыми привязками (АВДП), Volume (VDS) и структурами метаданных файловой системы (ФСД) физически непрерывно с записанным ранее логическим сеансом. На последнем шаге необходимо обновить структуры привязки (АВДП) в начале первого логического сеанса, чтобы они указывали на структуры томов (VDS) в *новом* логическом сеансе. Рабочий результат такой же, как и для последовательного носителя.

## <a name="additional-recommendations"></a>Дополнительные рекомендации

-   **Макет раздела**

    Для работы с IMAPI совместимости рекомендуется, чтобы разработчики программного обеспечения для записи сторонних разработчиков использовали структуры дисков, описанные в этой документации. Разработчикам следует избегать макетов с разделами файловой системы, которые занимают весь диск, так как это требует записи приложений для выявления свободного места в существующих секциях, когда данные необходимо добавить на диск. Часто это достигается благодаря использованию на диске собственных маркеров, указывающих на то, сколько пространства фактически занято данными пользователя. Такие структуры дисков несовместимы с IMAPI, так как специальные маркеры не распознаются за пределами приложения, для которого они были созданы.

-   **Тип секции UDF**

    IMAPI использует тип секции UDF **только для чтения** в своей реализации многосеансовой передачи на записываемом носителе. Разработчики сторонних программ для записи должны использовать тип раздела UDF, предназначенный **только для чтения** , для достижения совместимости с главной записью Windows через IMAPI. Если используется другой тип раздела UDF, например, **перезаписываемый** , IMAPI не сможет обеспечить поддержку основных функций.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание многосеансового диска](creating-a-multisession-disc.md)
</dt> <dt>

[**имултисессионрандомврите**](/windows/desktop/api/imapi2/nn-imapi2-imultisessionrandomwrite)
</dt> </dl>

 

 




