---
title: Предотвращение выхода из системы или приостановки во время записи
description: Если в приложении не выполняются правильные меры предосторожности, пользователь может выйти из системы во время операции записи. Это приводит к прерыванию процесса записи, что может привести к потере данных и, возможно, к неработоспособности диска.
ms.assetid: 5223c9f6-30f6-43ce-b46c-267da0a53d4b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5922fbe6dbc27303cee82e7ed745cbaaf2744781
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104487600"
---
# <a name="preventing-logoff-or-suspend-during-a-burn"></a>Предотвращение выхода из системы или приостановки во время записи

Если в приложении не выполняются правильные меры предосторожности, пользователь может выйти из системы во время операции записи. Это приводит к прерыванию процесса записи, что может привести к потере данных и, возможно, к неработоспособности диска.

Чтобы избежать этой проблемы, приложение должно обработать сообщение [**WM \_ куерендсессион**](/windows/desktop/Shutdown/wm-queryendsession) , которое доставляется до выхода из системы. Если приложение получает это сообщение во время выполнения операции записи, возвращается **значение false** , чтобы отменить процедуру выхода из системы. Если приложение позволяет пользователю решить, следует ли продолжать выход из системы, должно быть указано предупреждение о том, что пользователь потеряет данные.

Переходы питания в процессе записи могут также создавать потенциальные проблемы при успешном выполнении действия записи. Предотвращение этих осложнений во время процесса записи требует от приложения учитывать время перехода на питание. Это достигается путем включения приложения для обработки сообщения [**WM \_ поверброадкаст**](/windows/desktop/Power/wm-powerbroadcast) . Приложения, разработанные для Windows XP или Windows Server 2003, могут вернуть **широковещательный \_ запрос \_ Deny** в ответ на [**ПБТ \_ апмкуерисуспенд**](/windows/desktop/Power/pbt-apmquerysuspend), предотвращая приостановку в процессе записи.

Из-за изменений в модели управления питанием для Windows Vista и Windows Server 2008 событие [**ПБТ \_ апмкуерисуспенд**](/windows/desktop/Power/pbt-apmquerysuspend) больше не доставляется в приложения. Вместо этого событие [**ПБТ \_ апмсуспенд**](/windows/desktop/Power/pbt-apmsuspend) доставляется, предоставляя приложению две секунды для подготовки к переходу.

В результате этих изменений мы советуем, чтобы приложения вызывали функцию [**SetThreadExecutionState**](/windows/desktop/api/winbase/nf-winbase-setthreadexecutionstate) , чтобы предотвратить время простоя системы, что обычно приводит к приостановке перехода. Важно помнить, что вызов этой функции с соответствующим набором флагов будет препятствовать простою системы, а не выполняющейся приостановке.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование IMAPI](using-imapi.md)
</dt> <dt>

[**SetThreadExecutionState**](/windows/desktop/api/winbase/nf-winbase-setthreadexecutionstate)
</dt> </dl>

 

 