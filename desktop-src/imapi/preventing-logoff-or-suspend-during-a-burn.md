---
title: Предотвращение выхода из системы или приостановки во время записи
description: Если в приложении не выполняются правильные меры предосторожности, пользователь может выйти из системы во время операции записи. Это приводит к прерыванию процесса записи, что может привести к потере данных и, возможно, к неработоспособности диска.
ms.assetid: 5223c9f6-30f6-43ce-b46c-267da0a53d4b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8f3dd6980db72854ff65d657cc58730335febcb1dbc8c4a467eedead88f5eab
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118977134"
---
# <a name="preventing-logoff-or-suspend-during-a-burn"></a>Предотвращение выхода из системы или приостановки во время записи

Если в приложении не выполняются правильные меры предосторожности, пользователь может выйти из системы во время операции записи. Это приводит к прерыванию процесса записи, что может привести к потере данных и, возможно, к неработоспособности диска.

Чтобы избежать этой проблемы, приложение должно обработать сообщение [**WM \_ куерендсессион**](/windows/desktop/Shutdown/wm-queryendsession) , которое доставляется до выхода из системы. Если приложение получает это сообщение во время выполнения операции записи, возвращается **значение false** , чтобы отменить процедуру выхода из системы. Если приложение позволяет пользователю решить, следует ли продолжать выход из системы, должно быть указано предупреждение о том, что пользователь потеряет данные.

Переходы питания в процессе записи могут также создавать потенциальные проблемы при успешном выполнении действия записи. Предотвращение этих осложнений во время процесса записи требует от приложения учитывать время перехода на питание. Это достигается путем включения приложения для обработки сообщения [**WM \_ поверброадкаст**](/windows/desktop/Power/wm-powerbroadcast) . приложения, разработанные для Windows XP или Windows Server 2003, могут возвращать **широковещательный \_ запрос \_ DENY** в ответ на [**пбт \_ апмкуерисуспенд**](/windows/desktop/Power/pbt-apmquerysuspend), предотвращая приостановку в процессе записи.

из-за изменений в модели управления питанием для Windows Vista и Windows Server 2008 событие [**пбт \_ апмкуерисуспенд**](/windows/desktop/Power/pbt-apmquerysuspend) больше не доставляется в приложения. Вместо этого событие [**ПБТ \_ апмсуспенд**](/windows/desktop/Power/pbt-apmsuspend) доставляется, предоставляя приложению две секунды для подготовки к переходу.

В результате этих изменений мы советуем, чтобы приложения вызывали функцию [**SetThreadExecutionState**](/windows/desktop/api/winbase/nf-winbase-setthreadexecutionstate) , чтобы предотвратить время простоя системы, что обычно приводит к приостановке перехода. Важно помнить, что вызов этой функции с соответствующим набором флагов будет препятствовать простою системы, а не выполняющейся приостановке.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование IMAPI](using-imapi.md)
</dt> <dt>

[**SetThreadExecutionState**](/windows/desktop/api/winbase/nf-winbase-setthreadexecutionstate)
</dt> </dl>

 

 