---
title: Параметры Bluetooth и сокета
description: Bluetooth для Windows поддерживает следующие параметры сокета.
ms.assetid: e2e305c2-e749-4566-8e24-c07a7a29c612
keywords:
- Параметры Bluetooth и сокета Bluetooth
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84040a98c3dae1fec292e4f0a7086f11d1ee546c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987599"
---
# <a name="bluetooth-and-socket-options"></a>Параметры Bluetooth и сокета

Bluetooth для Windows поддерживает следующие параметры сокета. Параметры сокета задаются и запрашиваются с помощью функций [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) и [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) соответственно. С функцией **сетсоккопт** можно использовать все перечисленные ниже параметры, но для использования с функцией **жетсоккопт** доступен только параметр **so \_ БС \_ MTU** .

Для работы с параметрами сокета Bluetooth требуются следующие параметры:

-   Параметр *s* должен быть сокетом Bluetooth.
-   Параметр *Level* должен быть **Sol \_ RFCOMM**.

## <a name="so_bth_authenticate"></a>Итак \_ , \_ Проверка подлинности БС

Для отключенных сокетов, **\_ БС \_** проверка подлинности указывает, что для успешного выполнения операции [**подключения**](/windows/desktop/api/winsock2/nf-winsock2-connect) или [**приема**](/windows/desktop/api/winsock2/nf-winsock2-accept) требуется проверка подлинности. Установка этого параметра сокета активно инициирует проверку подлинности во время установки соединения, если два устройства Bluetooth ранее не прошли проверку подлинности. Пользовательский интерфейс для обмена ключами при необходимости предоставляется операционной системой за пределами контекста приложения.

Для исходящих подключений, требующих проверки подлинности, операция [**подключения**](/windows/desktop/api/winsock2/nf-winsock2-connect) завершается сбоем с **всаеакцес** , если проверка подлинности не прошла успешно. В ответ приложение может предложить пользователю выполнить проверку подлинности двух устройств Bluetooth перед подключением.

Для входящих соединений соединение отклоняется, если не удается установить проверку подлинности и возвращает ошибку **всаехостдовн** . Дополнительные сведения о проверке подлинности устройств Bluetooth см. в разделе [**блуетусаусентикатедевице**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).

Для БС параметра сокета **\_ \_ проверки подлинности** *ОПТВАЛ* является указателем на ulong баусентикате и должно иметь **значение true**. *оптлен* эквивалентен "sizeof (ulong)".

**Windows XP с пакетом обновления 2 (SP2): \_ БС \_** Authentication запускает проверку подлинности для подключенных сокетов и принудительно выполняет проверку подлинности при подключении для неподключенных сокетов. Для входящих подключений соединение отклоняется, если не удается выполнить проверку подлинности.

## <a name="so_bth_encrypt"></a>Итак, \_ БС \_ Encrypt

В случае неподключенных сокетов для установления соединения параметр сокета **\_ БС \_ Encrypting** обеспечивает принудительное шифрование. Шифрование доступно только для проверенных соединений. Для входящих подключений подключение, для которого не удается установить шифрование, автоматически отклоняется, и в качестве ошибки возвращается **всаехостдовн** . Для исходящих подключений функция [**Connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) завершается с **всаеакцес** , если не удается установить шифрование. В ответ приложение может предложить пользователю выполнить проверку подлинности двух устройств Bluetooth перед подключением. Дополнительные сведения о проверке подлинности устройств Bluetooth см. в разделе [**блуетусаусентикатедевице**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).

Для \_ БС \_ -шифрования параметра Socket *оптвал* является указателем на ulong **Бенкрипт** и должно иметь **значение true**. *оптлен* эквивалентно sizeof (ulong).

**Windows XP с пакетом обновления 2 (SP2):** Для сокета, который подключен и прошел проверку подлинности, **\_ БС \_ Encrypt** начинает шифрование.

## <a name="so_bth_mtu"></a>Итак, \_ БС \_ MTU

Таким образом, параметр Socket **\_ БС \_ MTU** является дополнительным параметром, который используется в основном для проверки. **Таким образом, параметр \_ БС \_ MTU** получает или задает значение по умолчанию MTU RFCOMM (максимальная единица передачи) для согласования соединения со значением, отличным от значения по умолчанию для протокола RFCOMM.

Поскольку RFCOMM MTU зависит от базового L2CAP MTU, а также от минимальных и максимальных значений протоколов и приложений, значение по умолчанию для **\_ БС \_ MTU** — это только отправная точка для согласования с удаленным одноранговым узлом, а окончательно согласованный MTU, скорее всего, будет отличаться от значения по умолчанию. Установка значения **\_ \_ MTU БС** может негативно сказаться на пропускной способности, и поэтому любые изменения должны выполняться с учетом базового протокола Bluetooth.

Таким образом, параметр сокета **\_ БС \_ MTU** может быть выполнен на подключенных сокетах, но не действует, если согласование уже завершено. Его установка на сокете прослушивания (сервер) не действует.

Количество данных, которое приложение может отправить или получить в одном вызове сокета, не зависит от значения MTU; MTU влияет только на то, как базовый поставщик услуг Windows Sockets обрабатывает пакеты для транспорта. Предложенные значения MTU и MTU в конечном итоге должны быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.

Для БС параметра сокета **\_ \_ MTU** *ОПТВАЛ* — это указатель на ulong MTU; *оптлен* эквивалентен "sizeof (ulong)".

## <a name="so_bth_mtu_max"></a>Итак, \_ БС \_ MTU \_ Max

Таким образом, параметр Socket **\_ БС \_ MTU \_ Max** является дополнительным параметром, который используется в основном для проверки. Таким образом, параметр Socket **\_ БС \_ MTU \_ Max** устанавливает максимальное значение MTU RFCOMM (максимальная единица передачи) для согласования соединения. Подключения с RFCOMM MTU, равным или превышающим это значение, завершаются [](/windows/desktop/api/winsock2/nf-winsock2-connect)сбоем во время / процесса [**принятия**](/windows/desktop/api/winsock2/nf-winsock2-accept) подключения. Если этот параметр сокета разрешен для подключенного сокета, он не действует, если согласование завершено. Установка этого параметра сокета на сокете прослушивания распространяет значение для всех входящих подключений. Максимальное значение MTU должно быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.

Для параметра **\_ БС \_ MTU \_ Max** Socket *оптвал* является указателем на Max \_ MTU. *оптлен* эквивалентен "sizeof (ulong)".

## <a name="so_bth_mtu_min"></a>так что \_ БС \_ MTU \_ мин

Параметр **\_ БС \_ \_ мин min** Socket является дополнительным параметром, который используется в основном для проверки. Параметр **\_ БС \_ MTU \_ min** Socket устанавливает минимальное значение MTU RFCOMM (максимальная единица передачи) для согласования соединения. При [**подключении**](/windows/desktop/api/winsock2/nf-winsock2-connect)с параметром MTU RFCOMM меньше этого значения происходит сбой в процессе / [**принятия**](/windows/desktop/api/winsock2/nf-winsock2-accept) подключения. Если этот параметр сокета разрешен для подключенного сокета, он не действует, если согласование завершено. Установка этого параметра сокета на сокете прослушивания распространяет значение для всех входящих подключений.

Только сокет прослушивания может изменить MTU вниз, поэтому, если значение, предложенное сокетом соединения, меньше, чем значение, заданное для параметра **\_ БС \_ MTU \_ min** на сокете прослушивания, подключение отклоняется. Минимальное значение MTU должно быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.

Для \_ \_ параметра БС \_ мин min Socket, *оптвал* является указателем на ulong min \_ MTU; *оптлен* эквивалентен "sizeof (ulong)".

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сокеты Windows](/windows/desktop/WinSock/windows-sockets-start-page-2)
</dt> <dt>

[**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt)
</dt> <dt>

[**блуетусаусентикатедевице**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice)
</dt> <dt>

[**соединиться**](/windows/desktop/api/winsock2/nf-winsock2-connect)
</dt> <dt>

[**гласит**](/windows/desktop/api/winsock2/nf-winsock2-accept)
</dt> </dl>

 

 