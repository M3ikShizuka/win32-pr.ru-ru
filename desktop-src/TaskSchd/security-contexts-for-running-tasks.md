---
title: Контексты безопасности для задач
description: Задачи регистрируются и запускаются в определенном контексте безопасности.
ms.assetid: be86eb9f-f6ec-4dce-afe8-e3314a74062a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 329f354518daeb11a5f330ae3fdc2c332b66d5c3
ms.sourcegitcommit: 3e70ae762629e244028b437420ed50b5850db4e3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "104412589"
---
# <a name="security-contexts-for-tasks"></a>Контексты безопасности для задач

Задачи регистрируются и запускаются в определенном контексте безопасности. Пользователи могут создавать приложения, которые успешно регистрируют, обновляют, удаляют или запускают задачи, но при регистрации задачи пользователь должен предоставить правильные учетные данные, а приложение должно быть запущено в процессе с правильными привилегиями.

## <a name="specifying-credentials"></a>Указание учетных данных

Можно указать контекст безопасности для задачи, указав учетные данные в методах [**ITaskFolder:: регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask) или [**ITaskFolder:: регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition) ([**таскфолдер. регистертаск**](taskfolder-registertask.md) или [**таскфолдер. Регистертаскдефинитион**](taskfolder-registertaskdefinition.md) для сценариев) или назначив участника [**свойству Principal класса ITaskDefinition**](/windows/desktop/api/taskschd/nf-taskschd-itaskdefinition-get_principal) ([**TaskDefinition. Principal**](taskdefinition-principal.md) для сценариев). Если для определения задачи создается участник, а затем определение задачи регистрируется с помощью метода **регистертаскдефинитион** с другими учетными данными, указанными в параметрах метода, то учетные данные, указанные в методе **регистертаскдефинитион** , будут перезаписывать учетные данные участника. Если участник создается для определения задачи с помощью XML, а затем XML-код для задачи зарегистрирован с помощью метода **регистертаск** с другими учетными данными, указанными в параметрах метода, то учетные данные, указанные в методе **регистертаск** , будут перезаписывать учетные данные участника.

Учетная запись пользователя или группа задаются при регистрации задачи или при указании принципа задачи. Контекст безопасности учетной записи пользователя или группы используется для контекста безопасности задачи. В этих методах и свойствах также определяется тип входа в систему. Тип входа определяется одной из констант в перечислении [**\_ \_ типа входа в задачу**](/windows/desktop/api/taskschd/ne-taskschd-task_logon_type) .

Задачи, зарегистрированные с помощью параметра \_ пароль для входа в систему \_ или задачи для входа в систему, \_ \_ запускаются только в том случае, если для указанного пользователя включено право на пакетное задание. Администраторы и операторы резервного копирования пользователи имеют доступ к этой привилегии по умолчанию.

При вызове метода [**GetFolder интерфейса ITaskService:: Connect**](/windows/desktop/api/taskschd/nf-taskschd-itaskservice-connect) ([**TaskService. Connect**](taskservice-connect.md) для создания скриптов) все последующие вызовы методов к службе планировщик задач будут использовать учетные данные, переданные в метод **Connect** . Это важно учитывать при регистрации задач с интерактивным типом входа. При регистрации задачи с помощью \_ интерактивного маркера входа в систему с типом входа \_ и в \_ задаче не указаны учетные данные, указанные в свойстве [**Principal**](/windows/desktop/api/taskschd/nf-taskschd-itaskdefinition-get_principal) определения задачи, заданном в параметрах [**регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition)или указанном в XML, переданном в [**регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask), задача будет зарегистрирована с учетными данными пользователя, который вызвал метод **Connect** .

## <a name="user-account-control-uac-security-for-tasks"></a>Безопасность управления учетными записями пользователей (UAC) для задач

[Контроль учетных записей](https://www.microsoft.com/technet/windowsvista/security/uac.mspx) (UAC) позволяет пользователям выполнять такие общие функции, как запуск программ, сохранение и изменение данных без предоставления прав администратора. По умолчанию задача выполняется с низким уровнем привилегий при включенном контроле учетных записей. Задачи могут указать, что они будут запускаться с повышенными привилегиями или низкими привилегиями, установив уровень привилегий из перечисления [**\_ \_ типов задач RUNLEVEL**](/windows/win32/api/taskschd/ne-taskschd-task_runlevel_type) для [**Свойства RunLevel IPrincipal**](/windows/desktop/api/taskschd/nf-taskschd-iprincipal-get_runlevel) ([**Principal. RUNLEVEL**](principal-runlevel.md) для сценариев). Значение свойства **runlevel** определяет уровень привилегий, на котором будут выполняться действия задачи. Если действия задачи должны иметь повышенные привилегии для выполнения, необходимо задать для свойства **runlevel** значение **Task \_ runlevel \_ высшего**. Если задача зарегистрирована с помощью группы администраторов для контекста безопасности задачи, необходимо также задать для свойства **runlevel** значение **Task \_ runlevel \_ высшего** , если требуется выполнить задачу. Если задача зарегистрирована с помощью встроенной \\ учетной записи администратора или учетных записей локальной системы или локальной службы, свойство **runlevel** будет пропущено. Значение свойства также будет пропущено, если контроль учетных записей (UAC) отключен. Значение свойства **runlevel** не влияет на разрешения, необходимые для выполнения или удаления задачи.

> [!Note]  
> После обновления операционной системы с Windows XP до Windows Vista задачи, зарегистрированные с помощью встроенной \\ учетной записи администратора в Windows XP, будут иметь свойство [**runlevel**](/windows/desktop/api/taskschd/nf-taskschd-iprincipal-get_runlevel) со значением **Task \_ runlevel \_ Lua**. Это может привести к сбою некоторых задач. Это свойство можно обновить вручную, чтобы убедиться, что все задачи будут выполняться.

 

В процессе с низким уровнем привилегий вы не можете зарегистрировать задачу с помощью свойства [**runlevel**](/windows/desktop/api/taskschd/nf-taskschd-iprincipal-get_runlevel) , равного **runlevel задаче \_ \_**, но можно зарегистрировать задачу с помощью свойства **runlevel** , равного **задаче \_ runlevel \_ Lua**. Действия задач будут выполняться с низкими привилегиями. Вы не можете зарегистрировать задачу как встроенную или администраторскую, локальную систему или группу.

С помощью процесса повышенной привилегии можно зарегистрировать задачу с помощью свойства [**runlevel**](/windows/desktop/api/taskschd/nf-taskschd-iprincipal-get_runlevel) , равное **задаче \_ runlevel \_ высшего** уровня или **задаче \_ runlevel \_ Lua**. Задача будет выполняться с уровнем привилегий, который выбирается свойством **runlevel** , если не используется учетная запись администратора. в этом случае задача запускается с повышенными привилегиями.

В процессе с повышенными правами можно зарегистрировать задачу планировщик задач 1,0. Служба планировщик задач установит уровень выполнения задачи \_ RUNLEVEL \_ наивысший, и задача будет запущена с повышенными привилегиями.

В процессе с низким уровнем привилегий можно также зарегистрировать задачу планировщик задач 1,0. Служба планировщик задач установит для задачи уровень выполнения \_ RUNLEVEL \_ Lua, и задача будет запущена с низкими привилегиями. Если эта задача обновляется из процесса с повышенными правами, то уровень выполнения задачи останется \_ RUNLEVEL \_ Lua.

## <a name="security-for-registering-tasks"></a>Безопасность для регистрации задач

При регистрации задачи из учетной записи, которая является членом группы "Администраторы", необходимо указать пароль только при регистрации задачи в следующих ситуациях:

-   Если задача регистрируется для запуска в контексте безопасности вашей учетной записи или учетной записи другого пользователя, и используется \_ флаг пароля для входа \_ в систему в методе [**регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask) или [**регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition) .
-   Если задача регистрируется для запуска в контексте безопасности учетной записи другого пользователя и используется \_ флаг подключения для входа \_ в систему в методе [**регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask) или [**регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition) .

Вы не можете использовать группу пользователей в качестве контекста безопасности задачи при регистрации задачи с помощью \_ флага входа в систему \_ или \_ \_ флага пароля при входе в систему в методе [**регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask) или [**регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition) .

При регистрации задачи из учетной записи пользователя, которая не является членом группы "Администраторы", не нужно указывать пароль при регистрации задачи, если вы регистрируете задачу для запуска в контексте безопасности вашей учетной записи и используете тип подключения S4U или Interactive. В противном случае при регистрации задачи необходимо указать пароль. Кроме того, невозможно зарегистрировать задачу с помощью учетной записи Local Service или группы для контекста безопасности задачи.

## <a name="security-for-reading-updating-deleting-and-running-tasks"></a>Безопасность для чтения, обновления, удаления и выполнения задач

По умолчанию пользователь, создающий задачу, может читать, обновлять, удалять и выполнять задачу. Пользователь должен иметь разрешение на запись файлов для файла задачи, чтобы обновить задачу, разрешение на чтение файла задачи для чтения задачи, разрешение DELETE для файла задачи, чтобы удалить задачу, а также разрешение на выполнение файла задачи для выполнения задачи с помощью методов [**ирегистередтаск:: Run**](/windows/desktop/api/taskschd/nf-taskschd-iregisteredtask-run) или [**рунекс**](/windows/desktop/api/taskschd/nf-taskschd-iregisteredtask-runex) ([**регистередтаск. Run**](registeredtask-run.md) и [**рунекс**](registeredtask-runex.md) для сценариев). Члены группы «Администраторы» или «СИСТЕМная учетная запись» могут читать, обновлять, удалять и выполнять любые задачи. Члены группы "Пользователи", учетная запись LocalService и учетная запись NetworkService могут только читать, обновлять, удалять и выполнять созданные им задачи. Это поведение по умолчанию изменяется при изменении списка DACL файла задачи. в этом случае список DACL определяет, какие пользователи имеют разрешение на запись, чтение, выполнение и удаление файлов. Чтобы задать разрешения для файла задачи, используйте метод Ирегистередтаск. Сетсекуритидескриптор (Регистередтаск. Сетсекуритидескриптор для создания скриптов) или задайте дескриптор безопасности при регистрации задачи с помощью методов [**регистертаск**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertask) или [**RegisterTaskDefinition**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition) .

Пользователь должен иметь разрешение Вритедак в дополнение к разрешениям на чтение и запись для обновления задачи, если обновление задачи требует изменения списка DACL для задачи.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сведения о регистрации задачи](task-registration-information.md)
</dt> <dt>

[Сведения о планировщик задач](about-the-task-scheduler.md)
</dt> <dt>

[Усиление безопасности задач](task-security-hardening.md)
</dt> <dt>

[**Таскфолдер. Регистертаскдефинитион**](taskfolder-registertaskdefinition.md)
</dt> <dt>

[**ITaskFolder:: Регистертаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskfolder-registertaskdefinition)
</dt> <dt>

[**Свойство Principal объекта Итаскдефинитион**](/windows/desktop/api/taskschd/nf-taskschd-itaskdefinition-get_principal)
</dt> <dt>

[**\_тип входа \_ задачи**](/windows/desktop/api/taskschd/ne-taskschd-task_logon_type)
</dt> </dl>

 

 




