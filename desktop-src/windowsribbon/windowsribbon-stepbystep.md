---
title: Создание приложения для ленты
description: Платформа Windows Ribbon состоит из двух отдельных, но зависимых платформ разработки языка разметки, основанного на XAML (XAML) для объявления элементов управления и их визуального макета, а также набора интерфейсов на основе модели компонентов C++ (COM) для определения функциональных возможностей команд и обработчиков приложений. Эта часть работы в архитектуре ленты Ribbon требует, чтобы разработчик, желающий воспользоваться преимуществами возможностей пользовательского интерфейса, предоставляемый платформой, должен разработать и описать пользовательский интерфейс в разметке, а затем использовать интерфейсы COM платформы Ribbon для подключения платформы к ведущему приложению.
ms.assetid: 1bd3dbb5-822b-4551-8330-8b202a4cecdf
keywords:
- Лента Windows, создание приложений
- Лента, создание приложений
- Лента Windows, план
- Лента, план
- Лента Windows, разметка
- Лента, разметка
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0a10f683c7fbb07b9992e418a4c09dc9aecba280
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413385"
---
# <a name="creating-a-ribbon-application"></a>Создание приложения для ленты

Платформа Windows Ribbon состоит из двух отдельных, но зависимых платформ разработки: языка разметки на основе XAML (XAML) для объявления элементов управления и их визуального макета, а также набора интерфейсов на основе модели компонентов C++ для определения функциональных возможностей команд и обработчиков приложений. Эта часть работы в архитектуре ленты Ribbon требует, чтобы разработчик, желающий воспользоваться преимуществами возможностей пользовательского интерфейса, предоставляемый платформой, должен разработать и описать пользовательский интерфейс в разметке, а затем использовать интерфейсы COM платформы Ribbon для подключения платформы к ведущему приложению.

-   [Путеводитель по лентам](#ribbon-roadmap)
-   [Написание разметки](#write-the-markup)
    -   [Компиляция разметки](#compile-the-markup)
-   [Создание приложения](#build-the-application)
    -   [Инициализация ленты](#initialize-the-ribbon)
    -   [Связывание разметки с приложением](#link-the-markup-to-the-application)
    -   [Компиляция приложения](#link-the-markup-to-the-application)
-   [Обновления и выполнения во время выполнения](#run-time-updates-and-executions)
-   [Поддержка OLE](#ole-support)
-   [См. также](#related-topics)

## <a name="ribbon-roadmap"></a>Путеводитель по лентам

Визуальные аспекты приложения на ленте, такие как отображаемые элементы управления и место их размещения, объявляются в разметке (см. раздел [объявление команд и элементов управления с разметкой ленты](windowsribbon-schema.md)). Логика команды приложения, например, что происходит при нажатии кнопки, реализуется в коде.

Процесс реализации ленты и его включения в приложение Windows требует выполнения четырех основных задач: написание разметки, компиляция разметки, написание кода и компиляция и связывание всего приложения.

На следующей схеме показан рабочий процесс для типичной реализации ленты.

![Диаграмма, показывающая рабочий процесс для типичной реализации ленты.](images/overviews/ribbonroadmap.png)

В следующих разделах этот процесс описан более подробно.

## <a name="write-the-markup"></a>Написание разметки

После разработки Ribbon в первую очередь разработчик приложения должен описать пользовательский интерфейс с разметкой ленты.

> [!IMPORTANT]
> Файл схемы разметки платформы Ribbon, УИКК. xsd, устанавливается вместе с пакетом средств разработки программного обеспечения Microsoft Windows (SDK) для Windows 7 и платформа .NET Framework 4,0. При использовании стандартного пути установки файл находится в папке bin% ProgramFiles% \\ Microsoft SDK \\ \\ \[ номер версии Windows, где на \] \\ него могут ссылаться многие редакторы XML для указания и автоматического завершения.

 

Элементы управления ленты, команды Ribbon (независимые от элемента управления элементы, которые предоставляют базовую функциональность для элементов управления ленты), а все макеты элементов управления и визуальные связи объявляются в разметке. Структура разметки ленты подчеркивает различие между элементами управления и командами ленты через две иерархии первичных узлов: [команды и дерево ресурсов](windowsribbon-reference-elements-command.md) , а также дерево [представлений](windowsribbon-reference-elements-view.md) .

Все контейнеры и действия, предоставляемые лентой, объявляются в дереве [команды и ресурсы](windowsribbon-reference-elements-command.md) . Каждый элемент команды связан с набором ресурсов в соответствии с требованиями дизайна пользовательского интерфейса.

После создания команд для приложения следует объявить элементы управления в дереве [представлений](windowsribbon-reference-elements-view.md) и привязать каждый элемент управления к команде, чтобы предоставить возможность команды. Платформа Ribbon определяет фактическое позиционирование элементов управления на основе иерархии элементов управления, объявленной здесь.

В следующем примере кода показано, как объявить элемент управления "Кнопка", "выход из приложения" и связать его с командой exit.


```
<Application xmlns="http://schemas.microsoft.com/windows/2009/Ribbon">
  <Application.Commands>
    <Command Name="cmdExit" LabelTitle="Exit application" />
  </Application.Commands>

  <Application.Views>
    <Ribbon>
      <Ribbon.Tabs>
        <Tab>
          <Group>
            <Button CommandName="cmdExit" />
          </Group>
        </Tab>
      </Ribbon.Tabs>
    </Ribbon>
  </Application.Views>
</Application>
        
```



> [!TIP]
> Хотя для файла разметки ленты можно использовать любое расширение файла, расширение XML является рекомендуемым расширением, используемым во всей документации.

 

### <a name="compile-the-markup"></a>Компиляция разметки

После создания файла разметки ленты его необходимо скомпилировать в двоичный формат с помощью компилятора разметки ленты, компилятора команд пользовательского интерфейса (УИКК), который входит в состав пакета средств разработки программного обеспечения (SDK) для Windows. Ссылка на этот двоичный файл передается методу [**иуифрамеворк:: лоадуи**](/windows/desktop/api/uiribbon/nf-uiribbon-iuiframework-loadui) во время инициализации платформы Ribbon ведущим приложением.

УИКК можно выполнить непосредственно из окна командной строки или добавить в качестве настраиваемого этапа сборки в Visual Studio.

На следующем рисунке показан компилятор разметки УИКК в окне оболочки CMD пакета SDK для Windows 7.

![снимок экрана, отображающий uicc.exe в окне командной строки.](images/overviews/screenshot-intentcl-commandline.png)

На следующем рисунке показано, как УИКК добавлен в Visual Studio в качестве настраиваемого этапа сборки.

![снимок экрана, отображающий uicc.exe, добавленный в виде настраиваемого этапа сборки в Visual Studio.](images/overviews/screenshot-vs-intentcl-custombuildstep.png)

УИКК создает три файла: двоичная версия разметки (. БМЛ), заголовок определения идентификатора (h-файл) для предоставления элементов разметки ведущему приложению ленты, а также [скрипт определения ресурса](../menurc/about-resource-files.md) (RC-файл) для связывания изображения ленты и строковых ресурсов с ведущим приложением во время компиляции.

Дополнительные сведения о компиляции разметки платформы ленты см. в разделе [Компиляция разметки ленты](windowsribbon-intentcl.md).

## <a name="build-the-application"></a>Построение приложения

После того как предварительный пользовательский интерфейс для приложения ленты разрабатывается и реализован в разметке, необходимо написать код приложения, который инициализирует платформу, использует разметку и привязывает команды, объявленные в разметке к соответствующим обработчикам команд в приложении.

> [!IMPORTANT]
>
> Так как платформа Ribbon основана на модели COM, рекомендуется использовать \_ \_ оператор ууидоф () для ссылки на идентификаторы GUID для интерфейсов платформы Ribbon (идентификаторов IID). В тех случаях, когда невозможно использовать \_ \_ оператор ууидоф (), например, если используется компилятор, отличный от Майкрософт, или ведущее приложение на языке C, идентификаторов IID должно быть определено приложением, так как они не содержатся в UUID. lib.
>
> Если идентификаторов IID определены приложением, необходимо использовать идентификаторы GUID, указанные в Уириббон. idl.
>
> Уириббон. idl поставляется в составе [пакета средств разработки программного обеспечения (SDK) для Windows](https://msdn.microsoft.com/windows/bb980924.aspx) и находится по стандартному пути установки% ProgramFiles% \\ пакеты SDK Microsoft \\ Windows \\ v 7.0 \\ включают.

 

### <a name="initialize-the-ribbon"></a>Инициализация ленты

На следующей схеме показаны шаги, необходимые для реализации простого приложения на ленте.

![Схема, на которой показаны шаги, необходимые для реализации простой реализации ленты.](images/overviews/initializationsteps.png)

Следующие шаги подробно описывают, как реализовать простое приложение на ленте.

1.  CoCreateInstance

    Приложение вызывает стандартную функцию CoCreateInstance COM с ИДЕНТИФИКАТОРом класса платформы Ribbon для получения указателя на платформу.

    ```
    IUIFramework* pFramework = NULL;
    HRESULT hr = ::CoCreateInstance(
                CLSID_UIRibbonFramework, 
                NULL,
                CLSCTX_INPROC_SERVER, 
                IID_PPV_ARGS(&pFramework));
    if (FAILED(hr))
    {
      return hr;
    }
    ```

    

2.  Initialize (HWND, Иуиаппликатион \* )

    Приложение вызывает [**иуифрамеворк:: Initialize**](/windows/desktop/api/uiribbon/nf-uiribbon-iuiframework-initialize), передавая два параметра: указатель на окно верхнего уровня, которое будет содержать ленту, и указатель на реализацию [**иуиаппликатион**](/windows/desktop/api/uiribbon/nn-uiribbon-iuiapplication) , которая позволяет платформе выполнять обратные вызовы к приложению.

    > \[! Существенно\]  
    > Платформа ленты инициализируется как однопотоковое подразделение (STA).

     

    ```
    hr = pFramework->Initialize(hWndHost, pApplication);
    if (FAILED(hr))
    {
      return hr;
    }
    ```

    

3.  Лоадуи (экземпляр, resourceName)

    Приложение вызывает [**иуифрамеворк:: лоадуи**](/windows/desktop/api/uiribbon/nf-uiribbon-iuiframework-loadui) для привязки ресурса разметки. Первый параметр этой функции является маркером для экземпляра приложения ленты. Вторым параметром является имя ресурса двоичной разметки, который был скомпилирован ранее. Передавая двоичную разметку в платформу Ribbon, приложение сигнализирует, что должна быть структура ленты и как должны упорядочиваться элементы управления. Она также предоставляет платформу с манифестом команд для предоставления (например, вставки, вырезания, поиска), которые используются платформой при выполнении обратных вызовов, связанных с командой, во время выполнения.

    ```
    hr = pFramework->LoadUI(GetModuleHandle(NULL), L"APPLICATION_RIBBON");
    if (FAILED(hr))
    {
      return hr;
    }
    ```

    

4.  Обратные вызовы [**иуиаппликатион:: онкреатеуикомманд**](/windows/desktop/api/uiribbon/nf-uiribbon-iuiapplication-oncreateuicommand)

    После выполнения шагов 1 – 3 платформа Ribbon знает, какие команды нужно предоставить на ленте. Тем не менее для полной функциональности платформы необходимо выполнить два действия: способ указать приложению, когда выполняются команды, и способ получения ресурсов команды или свойств во время выполнения. Например, если поле со списком отображается в пользовательском интерфейсе, платформа должна запросить элементы, с которыми будет заполнено поле со списком.

    Эти две части функциональности обрабатываются через интерфейс [**иуикоммандхандлер**](/windows/desktop/api/uiribbon/nn-uiribbon-iuicommandhandler) . В частности, для каждой команды, объявленной в двоичной разметке (см. шаг 3 выше), платформа вызывает [**иуиаппликатион:: онкреатеуикомманд**](/windows/desktop/api/uiribbon/nf-uiribbon-iuiapplication-oncreateuicommand) , чтобы запросить у приложения объект **иуикоммандхандлер** для этой команды.

    > [!Note]  
    > Интерфейс [**иуикоммандхандлер**](/windows/desktop/api/uiribbon/nn-uiribbon-iuicommandhandler) позволяет привязать обработчик команд к одной или нескольким командам.

     

Как минимум, приложению требуется реализовать заглушки методов [**иуиаппликатион**](/windows/desktop/api/uiribbon/nn-uiribbon-iuiapplication) , возвращающие E \_ нотимпл, как показано в следующем примере.


```
STDMETHOD(OnViewChanged)(UINT32 viewId,
                         UI_VIEWTYPE typeID,
                         IUnknown *view,
                         UI_VIEWVERB verb,
                         INT32 uReasonCode)
{ 
  return E_NOTIMPL; 
}

STDMETHOD(OnCreateUICommand)(UINT32 commandId,
                             UI_COMMANDTYPE typeID,
                             IUICommandHandler **commandHandler)
{ 
  return E_NOTIMPL; 
}

STDMETHOD(OnDestroyUICommand)(UINT32 commandId,
                              UI_COMMANDTYPE typeID,
                              IUICommandHandler *commandHandler) 
{ 
  return E_NOTIMPL; 
}
```



### <a name="link-the-markup-to-the-application"></a>Связывание разметки с приложением

На этом этапе файлы ресурсов разметки должны быть связаны с ведущим приложением, включив ссылку на файл определения ресурса разметки (который содержит ссылку на файл заголовка разметки) в файле ресурсов приложения. Например, для приложения с именем Риббонапп и файлом ресурсов с именем Риббонуи. RC требуется следующая строка в файле Риббонапп. rc.


```C++
#include "ribbonUI.rc"
```



В зависимости от используемого компилятора и компоновщика скрипт определения ресурса может также требовать компиляции перед компиляцией приложения Ribbon. Для этой задачи можно использовать программу командной строки [компилятора ресурсов (RC)](../menurc/using-rc-the-rc-command-line-.md) , которая поставляется с Microsoft Visual Studio и Windows SDK.

### <a name="compile-the-application"></a>Компиляция приложения

После компиляции приложения на ленте его можно запустить и проверить пользовательский интерфейс. Если в пользовательском интерфейсе требуется настройка и нет изменений в связанных обработчиках команд в основном коде приложения, измените исходный файл разметки, перескомпилируйте разметку с UICC.exe и свяжите новые файлы ресурсов разметки. При перезапуске приложения отображается измененный пользовательский интерфейс.

Все это возможно, не затрагивая основной код приложения — значительное улучшение по сравнению со стандартными разработками и распространением приложений.

## <a name="run-time-updates-and-executions"></a>Обновления и выполнения во время выполнения

Структура взаимодействия платформы Ribbon во время выполнения основана на принудительном и опрашивающем, или двустороннем вызывающем объекте Model.

Эта модель позволяет платформе уведомлять приложение при выполнении команды и позволяет платформе и приложению запрашивать, обновлять и делать недействительными значения свойств и ресурсов ленты. Эта функция предоставляется через ряд интерфейсов и методов.

Платформа извлекает обновленные сведения о свойствах из приложения ленты с помощью метода обратного вызова [**иуикоммандхандлер:: упдатепроперти**](/windows/desktop/api/uiribbon/nf-uiribbon-iuicommandhandler-updateproperty) . Идентификатор команды и ключ свойства, определяющие обновляемое свойство команды, передаются в метод, который затем возвращает или передает значение для этого ключа свойства в платформу.

Платформа вызывает [**иуикоммандхандлер:: Execute**](/windows/desktop/api/uiribbon/nf-uiribbon-iuicommandhandler-execute) при выполнении команды, определяя идентификатор команды и тип выполнения ([**UI \_ ексекутионверб**](/windows/desktop/api/uiribbon/ne-uiribbon-ui_executionverb)). Здесь приложение указывает логику выполнения для команды.

На следующей схеме показана связь времени выполнения для выполнения команд между платформой и приложением.

![Схема, на которой показан пример взаимодействия между платформой Ribbon и ведущим приложением.](images/overviews/updatesandexecutions.png)

> [!Note]  
> Реализация функций [**иуикоммандхандлер:: упдатепроперти**](/windows/desktop/api/uiribbon/nf-uiribbon-iuicommandhandler-updateproperty) и [**Иуикоммандхандлер:: Execute**](/windows/desktop/api/uiribbon/nf-uiribbon-iuicommandhandler-execute) не требуется для первоначального вывода ленты в приложении. Однако эти методы необходимы, чтобы обеспечить правильное функционирование приложения при выполнении команд пользователем.

 

## <a name="ole-support"></a>Поддержка OLE

Приложение ленты можно настроить как OLE-сервер для поддержки внутренней OLE-активации.

Объекты, созданные в приложении OLE-сервера, сохраняют связь с серверным приложением при вставке (вставленном или помещенном) в клиентское приложение OLE (или контейнер). При неразмещенной OLE-активации дважды щелкните объект в клиентском приложении, чтобы открыть выделенный экземпляр серверного приложения и загрузить объект для редактирования. При закрытии серверного приложения все изменения, внесенные в объект, отражаются в клиентском приложении.

> [!Note]  
> Платформа Ribbon не поддерживает активацию OLE на месте. Объекты, созданные в OLE-сервере на основе ленты, нельзя редактировать в клиентском приложении OLE. Требуется внешний выделенный экземпляр серверного приложения.


## <a name="related-topics"></a>См. также

<dl> <dt>

[Объявление команд и элементов управления с разметкой ленты](./windowsribbon-schema.md)
</dt> <dt>

[Рекомендации по работе пользователя с лентой](https://msdn.microsoft.com/library/cc872782.aspx)
</dt> <dt>

[Процесс разработки ленты](https://msdn.microsoft.com/library/cc872781.aspx)
</dt> </dl>

 

 




