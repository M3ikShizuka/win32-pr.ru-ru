---
title: Контроль учетных записей пользователей (основы проектирования)
description: Хорошо спроектированный интерфейс управления учетными записями пользователей помогает предотвратить нежелательные изменения в масштабе всей системы, что предсказуемо и требует минимальных усилий.
ms.assetid: c4b83537-c600-4b24-bda6-df7a82719ab1
ms.topic: article
ms.date: 10/20/2020
ms.openlocfilehash: b346e5cb581ac83ad2ebffabe73c5fbed636d814
ms.sourcegitcommit: 3bdf30edb314e0fcd17dc4ddbc70e4ec7d3596e6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "104569489"
---
# <a name="user-account-control"></a>контроль учетных записей

> [!NOTE]
> Это руководство по проектированию было создано для Windows 7 и не Обновлено для более новых версий Windows. Многие рекомендации по-прежнему применяются в принципе, но презентация и примеры не соответствуют нашим [текущим руководствам по проектированию](/windows/uwp/design/).

Хорошо спроектированный интерфейс управления учетными записями пользователей помогает предотвратить нежелательные изменения в масштабе всей системы, что предсказуемо и требует минимальных усилий.

При включенной функции контроля учетных записей (UAC) Интерактивные администраторы обычно работают с минимальными правами пользователя, но они могут самостоятельно повышать уровень для выполнения административных задач, предоставляя явное согласие с пользовательским интерфейсом согласия. К таким административным задачам относятся установка программного обеспечения и драйверов, изменение параметров на уровне системы, просмотр и изменение других учетных записей пользователей, а также запуск средств администрирования.

В состоянии с наименьшим уровнем привилегий администраторы называются защищенными администраторами. В состоянии с повышенными правами они называются администраторами с повышенными правами. В отличие от этого, стандартные пользователи не могут повышать свою поправку, но они могут попросить администратора повысить их уровень с помощью пользовательского интерфейса учетных данных. Встроенная учетная запись администратора не требует повышения прав.

![снимок экрана с сообщением безопасности "разрешить программу" ](images/winenv-uac-image1.png)

Пользовательский интерфейс согласия, используемый для повышения прав администратора у защищенных администраторов.

![снимок экрана с запросом пароля ](images/winenv-uac-image2.png)

Пользовательский интерфейс учетных данных, используемый для повышения уровня обычных пользователей.

UAC предоставляет следующие преимущества.

-   Это сокращает количество программ, работающих с повышенными привилегиями, помогая предотвратить случайное изменение системных настроек пользователями, а также предотвратить появление вредоносных программ на уровне системы. При отказе повышения прав вредоносные программы могут влиять только на данные текущего пользователя. Без повышения прав вредоносные программы не могут вносить изменения на уровне системы или влиять на работу других пользователей.
-   В [управляемых средах](glossary.md)хорошо спроектированные возможности контроля учетных записей позволяют пользователям работать в качестве обычных пользователей, удаляя ненужные ограничения.
-   Он дает обычным пользователям возможность попросить администраторов предоставить им разрешение на выполнение административных задач в текущем сеансе.
-   Для домашних сред это обеспечивает более эффективный родительский контроль над изменениями на уровне системы, включая устанавливаемое программное обеспечение.

**Разработчики:** Сведения о реализации см. в статье [перепроектирование ПОЛЬЗОВАТЕЛЬСКОГО интерфейса для обеспечения совместимости с UAC](/previous-versions/bb756990(v=msdn.10)).

В Windows Vista защищенные администраторы могут получать уведомления обо всех изменениях системы или нет. Параметр UAC по умолчанию уведомляет обо всех изменениях, независимо от их происхождения. Когда вы получите соответствующее сообщение, ваш рабочий стол будет недоступен, и вы должны либо утвердить или отклонить запрос в диалоговом окне UAC, прежде чем выполнять другие действия на компьютере. Модуль затемнения рабочего стола называется [защищенным рабочим столом](glossary.md) , так как другие программы не могут работать, пока они недоступны.

В Windows 7 появились два промежуточных параметра контроля учетных записей для защищенных администраторов в дополнение к двум из Windows Vista. Первый — уведомлять пользователей только при внесении изменений программой, поэтому администраторы автоматически получают повышенные права при внесении изменений. Это параметр UAC по умолчанию в Windows 7, а также использует безопасный рабочий стол.

Второй промежуточный параметр в Windows 7 совпадает с первым, за исключением того, что он не использует безопасный рабочий стол.

![снимок экрана с четырьмя параметрами контроля учетных записей в Windows 7 ](images/winenv-uac-image3.png)

В Windows 7 введены два промежуточных параметра контроля учетных записей.

**Примечание.** Рекомендации по написанию [кода для поддержки управления учетными записями пользователей](/previous-versions/aa905330(v=msdn.10)) представлены в отдельной статье.

## <a name="design-concepts"></a>Принципы проектирования

**Цели**

Хорошо спроектированное управление учетными записями пользователей имеет следующие цели:

-   **Исключите ненужные права на повышение прав.** Пользователям следует повышать права только для выполнения задач, требующих прав администратора. Все остальные задачи должны быть спроектированы таким образом, чтобы избавиться от необходимости повышения прав. Зачастую для устаревшего программного обеспечения требуются права администратора, которые не требуют записи в разделы реестра HKLM или HKCR, а также файлы программы или системные папки Windows.
-   **Быть прогнозируемым.** Обычным пользователям необходимо знать, какие задачи требуют администратора для выполнения или не могут быть выполнены вообще в управляемых средах. Администраторам необходимо знать, какие задачи требуют повышения прав. Если им не удается точно предсказать потребность в повышении точности, они, скорее всего, выдают согласие на задачи администрирования, когда они не должны.
-   **Требовать минимальных усилий.** Задачи, требующие прав администратора, должны быть спроектированы таким образом, чтобы требовать одного повышения прав. Задачи, для которых требуется несколько прав, быстро становятся утомительными.
-   **Возврат к минимальным привилегиям.** После завершения задачи, требующей прав администратора, программа должна вернуться к минимальному состоянию прав доступа.

**Последовательность задач повышения прав**

Если задача требует повышения прав, она включает следующие шаги:

1.  **Точка входа.** Задачи, требующие немедленного повышения прав после включения UAC, имеют точки входа, помеченные защитой UAC. В этом случае пользователи должны видеть пользовательский интерфейс повышения прав сразу после нажатия этих команд, и они должны быть очень осторожными, если они видят пользовательский интерфейс повышения прав из задач, у которых нет щита.

    ![снимок экрана значков экранирования UAC и их меток ](images/winenv-uac-image4.png)

    В этом примере элементам панели управления родительский элемент управления и учетные записи пользователей требуется повышение прав.

    Если UAC частично включен или полностью отключен, экранирование UAC по-прежнему отображается, чтобы указать, что задача включает изменения на уровне системы и, следовательно, требует повышения прав, даже если пользователь может не видеть пользовательский интерфейс повышения прав. Постоянное отображение щита контроля учетных записей для задач, требующих повышения прав, обеспечивает простой и прогнозируемый пользовательский интерфейс.

2.  **Полномочий.** Для защищенных администраторов задача запрашивает согласие с помощью пользовательского интерфейса согласия. Для обычных пользователей задача запрашивает учетные данные администратора с помощью пользовательского интерфейса учетных данных.

    ![снимок экрана двух типов повышения прав ](images/winenv-uac-image5.png)

    В этих примерах показан пользовательский интерфейс учетных данных и пользовательский интерфейс согласия.

3.  **Отдельный процесс с повышенными правами.** На внутреннем уровне создается новый процесс с повышенными правами для выполнения задачи.
4.  **Возврат к минимальным привилегиям.** При необходимости вернитесь к минимальным привилегиям для выполнения действий, которые не требуют повышения прав.

Обратите внимание, что задачи не запоминают состояния с повышенными правами. Например, если пользователь перемещается назад и вперед по точке входа в мастере, пользователь должен каждый раз повышать уровень.

## <a name="usage-patterns"></a>Варианты использования

Управление учетными записями пользователей имеет несколько шаблонов использования (в порядке предпочтения):

1.  **Работать для обычных пользователей.** Разработайте эту функцию для всех пользователей, ограничив ее область до текущего пользователя. Ограничивая параметры для текущего пользователя (в отличие от уровня системы), вы полностью Устраните необходимость в пользовательском интерфейсе повышения прав и решите пользователям выполнить задачу.

    **Неправильно**:

    ![снимок экрана сообщения: у вас нет прав доступа ](images/winenv-uac-image6.png)

    В этом примере пользователям Windows XP были предоставлены права администратора для просмотра или изменения текущего часового пояса.

    **Правильно:**

    ![снимок экрана — диалоговое окно "Дата и время" ](images/winenv-uac-image7.png)

    В этом примере функция часового пояса была переработана в Windows 7 и Windows Vista для всех пользователей.

2.  **Иметь отдельные элементы пользовательского интерфейса для обычных пользователей и администраторов.** Четкое разделение стандартных задач пользователя от административных задач. Предоставьте всем пользователям доступ к полезной информации только для чтения. Четко выявление административных задач с помощью щита UAC.

    ![Рисунок щита контроля учетных записей с повышенными требованиями ](images/winenv-uac-image8.png)

    В этом примере элемент панели управления "система" показывает свое состояние всем пользователям, но изменение параметров на уровне системы требует повышения прав.

3.  **Разрешить обычным пользователям попытаться выполнить задачу и повысить уровень их отказа.** Если обычные пользователи могут просматривать сведения и могут вносить некоторые изменения без повышения прав, предоставьте им доступ к пользовательскому интерфейсу и дождитесь их повышения только в случае сбоя задачи. Этот подход подходит, когда обычные пользователи имеют ограниченный доступ, например свойства собственных файлов в проводнике Windows. Он также подходит для параметров на гибридных страницах панели управления.

    ![снимок экрана: сообщение об отказе в доступе ](images/winenv-uac-image9.png)

    В этом примере пользователь пытался изменить свойства файла программы, но не имел достаточных привилегий. Пользователь может повысить уровень прав и повторить попытку.

4.  **Работать только для администраторов.** Используйте этот подход только для административных функций и программ! Если функция предназначена только для администраторов (и не имеет путей перехода или полезных сведений только для чтения для обычных пользователей), то перед отображением пользовательского интерфейса можно запросить учетные данные администратора в точке входа. Используйте этот подход для продолжительных мастеров и [потоков страниц](glossary.md) , если всем путям требуются права администратора.

    Если вся программа предназначена только для администраторов, пометьте ее как запрос учетных данных администратора для запуска. Windows отображает такие значки программ с наложением щита UAC.

    ![снимок экрана с эмблемой Windows и наложением щита UAC ](images/winenv-uac-image10.png)

    В этом примере программе требуются права администратора для запуска.

## <a name="guidelines"></a>Рекомендации

### <a name="uac-shield-icon"></a>Значок щита UAC

-   **Отображение элементов управления с помощью щита UAC, чтобы указать, что задача требует немедленного повышения прав при полном включении UAC,** даже если UAC в настоящее время не включен полностью. Если для всех путей мастера и [потока страниц](glossary.md) требуется повышение прав, отобразите экранирование UAC в точке входа задачи. Правильное использование экранирования UAC помогает пользователям предсказать, когда требуется повышение прав.
-   **Если программа поддерживает несколько версий Windows, отобразите экранирование UAC, если хотя бы одна версия требует повышения прав.** Так как Windows XP не требует повышения прав, рекомендуется удалить экранирования UAC для Windows XP, если это возможно, и без ущерба для производительности.
-   **Не выводите панель UAC для задач, не требующих повышения прав в большинстве контекстов.** Так как этот подход иногда является ошибочным, предпочтительным подходом является использование правильно экранированной контекстной команды.

    ![снимок экрана файлов фотографий в проводнике Windows ](images/winenv-uac-image11.png)

    Так как команда "создать папку" требует повышения прав только при использовании в системных папках, она отображается без щита контроля учетных записей.

-   Экранирование UAC может отображаться на следующих элементах управления:

    **Командные кнопки:**

    ![снимок экрана с кнопкой "команда" со значком щита UAC ](images/winenv-uac-image12.png)

    Командная кнопка, которая требует немедленного повышения прав.

    **Ссылки на команды:**

    ![снимок экрана с ссылкой на команду со значком щита UAC ](images/winenv-uac-image13.png)

    Ссылка на команду, которая требует немедленного повышения прав.

    **Источники**

    ![снимок экрана со ссылкой "изменить учетную запись" с защитой UAC ](images/winenv-uac-image14.png)

    Ссылка, которая требует немедленного повышения прав.

    **Ярлык**

    ![снимок экрана меню с защитой UAC ](images/winenv-uac-image15.png)

    Раскрывающееся меню, для которого требуется немедленное повышение прав.

-   Так как задачи не запоминают привилегированные состояния, **не следует изменять экранирование UAC для отражения состояния.**
-   **Отображение щита UAC, даже если контроль учетных записей отключен или пользователь использует встроенную учетную запись администратора.** Единообразное отображение щита UAC упрощает программирование и предоставляет пользователям сведения о характере задачи.

### <a name="elevation"></a>Elevation

-   **По возможности разрабатывать задачи, выполняемые обычными пользователями без повышения прав.** Предоставьте всем пользователям доступ к полезной информации только для чтения.
-   **Повышение уровня для отдельных задач, а не на уровне отдельных параметров.** Не смешивать стандартные параметры пользователя с административными параметрами на одной странице или в диалоговом окне. Например, если обычные пользователи могут изменять некоторые параметры, но не все, разделите их как отдельную поверхность пользовательского интерфейса.

    **Неправильно**:

    ![снимок экрана — диалоговое окно "Параметры даты и времени" ](images/winenv-uac-image16.png)

    В этом примере стандартные параметры пользователя неправильно смешиваются с административными параметрами.

    **Правильно:**

    ![снимок экрана того же диалогового окна без экранирования UAC ](images/winenv-uac-image17.png)

    В этом примере параметры для изменения даты и времени находятся в отдельном диалоговом окне, доступном только для администраторов. Параметры часового пояса доступны для обычных пользователей и не смешиваются с административными параметрами.

-   **Не учитывайте необходимость повышения уровня при определении необходимости отображения или отключения элемента управления.** Это вызвано следующими соображениями.
    -   В неуправляемых средах Предположим, что стандартные пользователи могут повысить уровень прав, запрашивая администратора. Отключение элементов управления, требующих повышения прав, помешает пользователям повышать права администратора.
    -   В управляемых средах предполагается, что обычные пользователи не могут повышать уровень прав. Удаление элементов управления, требующих повышения прав, помешает пользователям знать, когда следует перестать смотреть.
-   **Чтобы устранить ненужные повышения прав, сделайте следующее:**
    -   **Если для задачи может потребоваться повышение прав, повышение прав как можно позднее.** Если задаче требуется [Подтверждение](mess-confirm.md), ОТОБРАЗИТСЯ пользовательский интерфейс повышения прав только после подтверждения пользователя. Если задача всегда требует повышения прав, повышение прав в точке входа.
    -   **После повышения привилегий Следите за тем, чтобы повышенные полномочия стали ненужными.** Для выполнения одной задачи пользователям не нужно повышать уровень прав.
    -   **Если пользователям необходимо повысить уровень, чтобы внести изменения, но не вносить никаких изменений, оставьте кнопки положительной фиксации включенными, но обработайте фиксацию как отмену.** Это устраняет необходимость в повышении прав для закрытия окна.
    -   **Неправильно**:
    -   ![снимок экрана окна с активной кнопкой только на одну кнопку ](images/winenv-uac-image18.png)
    -   В этом примере кнопка Сохранить изменения отключена, чтобы избежать ненужных прав, но становится доступной при изменении пользователем выделения. Однако кнопка «отключенная фиксация» делает его недоступным для пользователей.
-   **Не отображать сообщение об ошибке при сбое задач, так как пользователи отказались от повышения прав.** Предположим, что пользователи намеренно решили не продолжать работу, поэтому они не будут рассматриваться как ошибки.

    **Неправильно**:

    ![снимок экрана сообщения: не удается запустить восстановление Fabrikam ](images/winenv-uac-image19.png)

    В этом примере, если пользователь решил не повышать уровень прав, то при восстановлении Fabrikam сообщение об ошибке выдается неправильно.

-   **Не выводите предупреждения, объясняющие, что пользователям может потребоваться повысить привилегии для выполнения задач.** Позвольте пользователям обнаруживать этот факт самостоятельно.
-   **Отобразите панель UAC и пользовательский интерфейс повышения прав на основе следующей таблицы.**

    |                       |                                                                                                                                                                  |                                                                                                                                                                                                                       |                                                                                                      |
    |-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
    | **Объект**      | **Условия**                                                                                                                                                | **Где разместить экранирование UAC**                                                                                                                                                                               | **Когда следует повышать уровень**                                                                            |
    | Программа<br/>    | Вся программа предназначена только для администраторов.<br/>                                                                                                            | ![снимок экрана с эмблемой Windows и наложением щита UAC ](images/winenv-uac-image10.png)<br/> Наложение UAC щита на значке программы.<br/>                                                                       | Отображение пользовательского интерфейса повышения прав при запуске.<br/>                                                           |
    | Get-Help<br/>    | Вся команда предназначена только для администраторов.<br/>                                                                                                            | ![снимок экрана с ссылкой "изменение учетной записи" и щита UAC ](images/winenv-uac-image14.png)<br/> Экранирование UAC на кнопке или ссылке.<br/>                                                                      | Отображать пользовательский интерфейс повышения прав при нажатии кнопки или ссылки, но после каких-либо подтверждений.<br/> |
    | Get-Help<br/>    | Команда отображает полезные сведения только для чтения, соответствующие всем пользователям, но изменения требуют прав администратора.<br/>                               | ![снимок экрана с ссылкой "изменить параметры" и защитой UAC ](images/winenv-uac-image8.png)<br/> Экранирование UAC на кнопке или ссылке для внесения изменений.<br/>                                                      | Отображать пользовательский интерфейс повышения прав при нажатии кнопки Command, но после каких-либо подтверждений.<br/>         |
    | Get-Help<br/>    | Обычные пользователи могут просматривать информацию и, возможно, вносить некоторые изменения без повышения прав. разрешить обычным пользователям предпринимать попытки и повысить уровень их сбоев.<br/> | ![снимок экрана с сообщением об ошибке с значком UAC при нажатии кнопки "повторить" ](images/winenv-uac-image9.png)<br/> Не показывать экранирование UAC для команды, но отображать ее для повышения прав в случае сбоя команды.<br/> | Отображать пользовательский интерфейс повышения прав, когда пользователь повторяет команду.<br/>                                       |
    | Шаг задачи<br/>  | Для всех последующих шагов требуется повышение прав.<br/>                                                                                                               | ![снимок экрана с кнопкой "Следующая команда" с защитой UAC ](images/winenv-uac-image20.png)<br/> Экранирование UAC на кнопке Next (или аналогичной).<br/>                                                                | Отображать пользовательский интерфейс повышения прав при нажатии кнопки "Далее" или "другая фиксация".<br/>                         |
    | Шаг задачи<br/>  | Для некоторых ветвей требуется повышение прав.<br/>                                                                                                                      | ![снимок экрана со ссылкой на команду с защитой UAC ](images/winenv-uac-image21.png)<br/> Экранирование UAC для ссылок на команды, требующих повышения прав.<br/>                                                              | Отображать пользовательский интерфейс повышения прав при щелчке ссылок на команды с помощью щита UAC.<br/>                      |

    

     

### <a name="elevation-ui"></a>Пользовательский интерфейс повышения прав

-   **Если пользователь предоставляет недействительную учетную запись (имя или пароль) или не имеет прав администратора, просто откройте пользовательский интерфейс учетных данных.** Не отображать сообщение об ошибке.
-   **Если пользователь отменяет пользовательский интерфейс учетных данных, верните пользователя обратно в исходный пользовательский интерфейс.** Не отображать сообщение об ошибке.
-   Если контроль учетных записей отключен и Стандартный пользователь пытается выполнить задачу, требующую повышения прав, укажите сообщение об ошибке "Эта задача требует прав администратора. Для выполнения этой задачи необходимо войти в систему с помощью учетной записи администратора.

![снимок экрана с сообщением о том, что задача требует привилегий ](images/winenv-uac-image22.png)

В этом примере контроль учетных записей отключен, поэтому в сообщении об ошибке объясняется, что пользователь должен использовать учетную запись администратора.

### <a name="wizards"></a>Мастера

-   **Не повышать их несколько раз.** После повышения прав мастера он должен оставаться повышенным.
-   Если задача выполняется в мастере, поставьте экранирование UAC на кнопку "Далее" на странице фиксации (в которой должна быть указана более [конкретная метка](win-wizards.md)). При фиксации пользователя:
    -   Если Следующая страница является страницей хода выполнения, перейдите на эту страницу и модально Отобразите пользовательский интерфейс повышения прав. После успешного повышения прав выполните задачу.
    -   Если Следующая страница является страницей завершения, перейдите на эту страницу (но временно замените ее содержимое на "ожидание разрешения...") и модально Отобразите пользовательский интерфейс повышения прав. После успешного повышения прав выполните задачу, а затем отобразите содержимое страницы завершения.
    -   Если пользователь отменяет пользовательский интерфейс повышения прав, вернитесь на страницу фиксации. Это позволит пользователю повторить попытку.
-   Если задача выполняется после завершения работы мастера, добавьте экранирование контроля учетных записей на кнопке завершения на странице фиксации (для которой должна быть указана более [конкретная метка](win-wizards.md)). При фиксации пользователя:
    -   Остаться на странице фиксации и модально отобразить пользовательский интерфейс повышения прав. После успешного повышения прав закройте мастер.
    -   Если пользователь отменяет пользовательский интерфейс повышения прав, вернитесь на страницу фиксации. Это позволит пользователю повторить попытку.
-   Для продолжительных мастеров, предназначенных только для администраторов, перед отображением пользовательского интерфейса вы можете запросить учетные данные администратора в точке входа.

## <a name="text"></a>Текст

-   **Не используйте многоточие только потому, что для команды требуется повышение прав.** Потребность в повышении прав указывается с помощью щита UAC.

## <a name="documentation"></a>Документация

При ссылке на контроль учетных записей пользователей:

-   Обратитесь к компоненту как контроль учетных записей (при первом упоминании) или UAC (при последующем упоминании), не используйте учетную запись пользователя с минимальными правами или LUA.
-   В качестве обычных пользователей обратитесь к пользователям, не являющимся администраторами.
-   Обратитесь к встроенным администраторам компьютеров в качестве встроенных администраторов.

В пользовательской документации:

-   Обратитесь к акту о предоставлении согласия на выполнение административной задачи как предоставление разрешения.

В программировании и другой технической документации:

-   Сведения о предоставлении согласия на выполнение административной задачи в качестве повышения прав см. в этой статье.
-   В контексте контроля учетных записей следует обращаться к администраторам как к защищенным администраторам при отсутствии повышенных прав, а также при повышении прав администратора.
-   Обратитесь к диалоговому окну, используемому для ввода пароля в качестве пользовательского интерфейса учетных данных. Обратитесь к диалоговому окну, используемому для предоставления согласия в качестве пользовательского интерфейса согласия. Как правило, в качестве пользовательского интерфейса повышения прав см.

