---
title: Форматы буфера обмена
description: Окно может поместить в буфер обмена несколько объектов, каждый из которых представляет одни и те же данные в другом формате буфера обмена. Пользователям не нужно знать форматы буфера обмена, используемые для объекта в буфере обмена.
ms.assetid: fe42baec-6b00-4816-b379-7f335da8a197
keywords:
- буфер обмена, форматы
- буфер обмена, Windows
- буфер обмена, стандартные форматы
- буфер обмена, зарегистрированные форматы
- буфер обмена, синтезированные форматы
- стандартные форматы буфера обмена
- зарегистрированные форматы буфера обмена
- форматы синтезированного буфера обмена
- форматы облачного буфера обмена
- форматы журнала буфера обмена
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 193ee4cc10c17846d974e50b17a464207026280b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105710343"
---
# <a name="clipboard-formats"></a>Форматы буфера обмена

Окно может поместить в буфер обмена несколько объектов, каждый из которых представляет одни и те же данные в другом формате буфера обмена. Пользователям не нужно знать форматы буфера обмена, используемые для объекта в буфере обмена.

В следующих разделах описываются форматы буфера обмена.

-   [Стандартные форматы буфера обмена](#standard-clipboard-formats)
-   [Зарегистрированные форматы буфера обмена](#registered-clipboard-formats)
-   [Форматы частных буферов обмена](#private-clipboard-formats)
-   [Несколько форматов буфера обмена](#multiple-clipboard-formats)
-   [Форматы синтезированного буфера обмена](#synthesized-clipboard-formats)
-   [Форматы журнала облачного буфера обмена и буфера обмена](#cloud-clipboard-and-clipboard-history-formats)

## <a name="standard-clipboard-formats"></a>Стандартные форматы буфера обмена

Форматы буфера обмена, определенные системой, называются *стандартными форматами буфера обмена*. Эти форматы буфера обмена описаны в [**стандартных форматах буфера обмена**](standard-clipboard-formats.md).

## <a name="registered-clipboard-formats"></a>Зарегистрированные форматы буфера обмена

Многие приложения работают с данными, которые не могут быть преобразованы в стандартный формат буфера обмена без потери информации. Эти приложения могут создавать собственные форматы буфера обмена. Формат буфера обмена, определенный приложением, называется [зарегистрированным форматом буфера обмена](#registered-clipboard-formats). Например, если приложение обработки текста скопировало форматированный текст в буфер обмена, используя стандартный текстовый формат, сведения о форматировании будут потеряны. Решением будет зарегистрировать новый формат буфера обмена, например RTF.

Чтобы зарегистрировать новый формат буфера обмена, используйте функцию [**регистерклипбоардформат**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) . Эта функция принимает имя формата и возвращает целочисленное значение без знака, представляющее зарегистрированный формат буфера обмена. Чтобы получить имя зарегистрированного формата буфера обмена, передайте в функцию [**жетклипбоардформатнаме**](/windows/desktop/api/Winuser/nf-winuser-getclipboardformatnamea) целочисленное значение без знака.

Если несколько приложений регистрируют формат буфера обмена с точно тем же именем, формат буфера обмена регистрируется только один раз. Оба вызова функции [**регистерклипбоардформат**](/windows/desktop/api/Winuser/nf-winuser-registerclipboardformata) возвращают одно и то же значение. Таким образом, два разных приложения могут обмениваться данными с помощью зарегистрированного формата буфера обмена.

## <a name="private-clipboard-formats"></a>Форматы частных буферов обмена

Приложение может определить частный формат буфера обмена, определив значение в диапазоне от **CF \_ Приватефирст** до **CF \_ привателаст**. Приложение может использовать частный формат буфера обмена для определяемого приложением формата данных, который не требуется регистрировать в системе.

Дескрипторы данных, связанные с частными форматами буфера обмена, не освобождаются автоматически системой. Если в Windows используются форматы частных буферов обмена, можно использовать сообщение [**WM \_ дестройклипбоард**](wm-destroyclipboard.md) , чтобы освободить все связанные ресурсы, которые больше не нужны.

Дополнительные сведения о сообщении [**WM \_ дестройклипбоард**](wm-destroyclipboard.md) см. в разделе " [владение буфером обмена](clipboard-operations.md)".

Приложение может поместить дескрипторы данных в буфер обмена, определив частный формат в диапазоне от **CF \_ Гдиобжфирст** до **CF \_ гдиобжласт**. При использовании значений в этом диапазоне обработчик данных не является обработчиком для объекта Windows интерфейс графических устройств (GDI), но является маркером, выделенным функцией [**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc) с \_ флагом перемещаемого объекта ГМЕМ. При очистке буфера обмена система автоматически удаляет объект с помощью функции [**GlobalFree**](/windows/desktop/api/winbase/nf-winbase-globalfree) .

## <a name="multiple-clipboard-formats"></a>Несколько форматов буфера обмена

Окно может поместить в буфер обмена несколько объектов Clipboard, каждый из которых представляет одни и те же данные в другом формате буфера обмена. При размещении сведений в буфере обмена окно должно предоставлять данные в максимальном количестве форматов. Чтобы узнать, сколько форматов в данный момент используется в буфере обмена, вызовите функцию [**каунтклипбоардформатс**](/windows/desktop/api/Winuser/nf-winuser-countclipboardformats) .

Форматы буфера обмена, содержащие наибольшую информацию, должны размещаться в буфере обмена, за которым следуют менее описательные форматы. Окно, вставленное из буфера обмена, обычно получает объект буфера обмена в первом распознаваемым формате. Так как форматы буфера обмена перечисляются в том порядке, в котором они помещены в буфер обмена, первый распознаваемый формат также является наиболее описательным.

Например, предположим, что пользователь копирует стильный текст из документа, обрабатывающего текстовые документы. Окно, содержащее документ, может сначала поместить данные в буфер обмена в зарегистрированном формате, например RTF. Впоследствии окно поместит данные в буфер обмена в менее описательном формате, например текст (**\_ текст CF**).

Когда содержимое буфера обмена вставляется в другое окно, оно получает данные в наиболее описательном формате, который он распознает. Если окно распознает RTF, соответствующие данные вставляются в документ. В противном случае текстовые данные вставляются в документ, и сведения о форматировании теряются.

## <a name="synthesized-clipboard-formats"></a>Форматы синтезированного буфера обмена

Система неявно преобразует данные между определенными форматами буфера обмена: Если окно запрашивает данные в формате, который не находится в буфере обмена, система преобразует доступный формат в запрошенный формат. Система может преобразовать данные, как показано в следующей таблице.



| Формат буфера обмена     | Формат преобразования    |
|----------------------|----------------------|
| **\_точечный рисунок CF**       | **CF \_ DIB**          |
| **\_точечный рисунок CF**       | **\_DIBV5 CF**        |
| **CF \_ DIB**          | **\_точечный рисунок CF**       |
| **CF \_ DIB**          | **\_Палитра CF**      |
| **CF \_ DIB**          | **\_DIBV5 CF**        |
| **\_DIBV5 CF**        | **\_точечный рисунок CF**       |
| **\_DIBV5 CF**        | **CF \_ DIB**          |
| **\_DIBV5 CF**        | **\_Палитра CF**      |
| **\_ЕНХМЕТАФИЛЕ CF**  | **\_МЕТАФИЛЕПИКТ CF** |
| **\_МЕТАФИЛЕПИКТ CF** | **\_ЕНХМЕТАФИЛЕ CF**  |
| **\_ОЕМТЕКСТ CF**      | **\_текст CF**         |
| **\_ОЕМТЕКСТ CF**      | **\_УНИКОДЕТЕКСТ CF**  |
| **\_текст CF**         | **\_ОЕМТЕКСТ CF**      |
| **\_текст CF**         | **\_УНИКОДЕТЕКСТ CF**  |
| **\_УНИКОДЕТЕКСТ CF**  | **\_ОЕМТЕКСТ CF**      |
| **\_УНИКОДЕТЕКСТ CF**  | **\_текст CF**         |



 

Если система обеспечивает автоматическое преобразование типов для конкретного формата буфера обмена, нет никаких преимуществ для размещения форматов преобразования в буфере обмена.

Если система обеспечивает автоматическое преобразование типов для конкретного формата буфера обмена и вызывает [**енумклипбоардформатс**](/windows/desktop/api/Winuser/nf-winuser-enumclipboardformats) для перечисления форматов данных в буфере обмена, система сначала перечисляет формат буфера обмена, а затем форматы, в которых он может быть преобразован.

При копировании точечных рисунков лучше размещать в буфере обмена формат **CF \_ DIB** или **CF \_ DIBV5** . Это связано с тем, что цвета в точечном рисунке, зависимом от устройства (**\_ точечный рисунок CF**), зависят от системной палитры, которая может измениться до вставления растрового изображения. Если формат **CF \_ DIB** или **CF \_ DIBV5** находится в буфере обмена, а окно запрашивает **Формат \_ точечных рисунков CF** , система визуализирует аппаратно-независимый точечный рисунок (DIB), используя текущую палитру в это время.

При помещении формата **\_ точечных рисунков CF** в буфер обмена (а не в **CF \_ DIB**) система отображает формат буфера обмена **CF \_ DIB** или **CF \_ DIBV5** , как только закрывается буфер обмена. Это гарантирует, что для создания рисунка DIB используется правильная палитра. Если поместить формат **CF \_ DIBV5** с данными о цветовой области растрового изображения в буфер обмена, система преобразует битовые карты из цветового пространства растрового изображения в цветовую область sRGB при запросе **CF \_ DIB** или **CF \_ DIBV5** . Если запрос **CF \_ DIBV5** запрашивается, когда в буфере обмена нет сведений о цветовом пространстве, система возвращает сведения о цветовом пространстве sRGB в структуре [**BITMAPV5HEADER**](/windows/desktop/api/wingdi/ns-wingdi-bitmapv5header) . Преобразования между другими форматами буфера обмена происходят по требованию.

Если в буфере обмена содержатся данные в формате **\_ палитры CF** , приложение должно использовать функции [**селектпалетте**](/windows/desktop/api/wingdi/nf-wingdi-selectpalette) и [**реализепалетте**](/windows/desktop/api/wingdi/nf-wingdi-realizepalette) для реализации любых других данных в буфере обмена на этой логической палитре.

Существует два формата буферов обмена для метафайлов: **CF \_ Енхметафиле** и **CF \_ метафилепикт**. Укажите **\_ енхметафиле CF** для расширенных метафайлов **и \_ Метафилепикт CF** для метафайлов Windows.

## <a name="cloud-clipboard-and-clipboard-history-formats"></a>Форматы журнала облачного буфера обмена и буфера обмена

Некоторые версии Windows включают в себя [облачный буфер обмена](/windows/whats-new/whats-new-windows-10-version-1809#cloud-clipboard), который хранит историю последних элементов данных в буфере обмена и может синхронизировать их между устройствами пользователя.
Если вы не хотите, чтобы данные, размещаемые приложением в буфере обмена, включались в журнал буфера обмена или синхронизированы с другими устройствами, приложение может управлять этим поведением, помещая данные в определенные [зарегистрированные форматы буфера обмена](#registered-clipboard-formats) , имена которых известны системе Windows:

- **Ексклудеклипбоардконтентфроммониторпроцессинг** : Поместите данные в буфер обмена в этом формате, чтобы предотвратить включение всех форматов буфера обмена в журнал буфера обмена или их синхронизацию с другими устройствами пользователя.
- **Канинклудеинклипбоардхистори** : Разместите сериализованное значение **[DWORD](../WinProg/windows-data-types.md)** , равное нулю, в буфере обмена в этом формате, чтобы предотвратить включение всех форматов буфера обмена в журнал буфера обмена или поместить значение одного из них вместо явного запроса, что элемент буфера обмена должен быть включен в журнал буфера обмена. Это не влияет на синхронизацию с другими устройствами пользователя.
- **Кануплоадтоклаудклипбоард** : Разместите сериализованное значение **[DWORD](../WinProg/windows-data-types.md)** , равное нулю, в буфере обмена в этом формате, чтобы предотвратить синхронизацию всех форматов буфера обмена с другими устройствами пользователя или поместить значение одного из них вместо явного запроса на синхронизацию элемента буфера обмена с другими устройствами. Это не влияет на журнал буфера обмена локального устройства.

Как и в случае с другими зарегистрированными форматами буфера обмена, необходимо использовать функцию [**регистерклипбоардформат**](
/windows/win32/api/winuser/nf-winuser-registerclipboardformata) для получения целого числа без знака, определяющего каждый из приведенных выше трех форматов.