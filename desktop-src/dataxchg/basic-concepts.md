---
title: Основные понятия
description: В этом разделе обсуждаются основные понятия, касающиеся динамического обмена данными.
ms.assetid: 37826d83-4dcd-484f-b1aa-87bf309c5c09
keywords:
- Пользовательский интерфейс Windows, платформа динамических данных Exchange (DDE)
- Пользовательский интерфейс Windows, Библиотека управления платформа динамических данных Exchange (ДДЕМЛ)
- Платформа динамических данных Exchange (DDE), взаимодействие с сервером клиента
- DDE (платформа динамических данных Exchange), взаимодействие с сервером клиента
- Обмен данными, платформа динамических данных Exchange (DDE)
- Обмен данными, Библиотека управления платформа динамических данных Exchange (ДДЕМЛ)
- Платформа динамических данных Exchange (DDE), клиентские приложения
- DDE (платформа динамических данных Exchange), клиентские приложения
- Платформа динамических данных Exchange (DDE), серверные приложения
- DDE (платформа динамических данных Exchange), серверные приложения
- Платформа динамических данных Exchange (DDE), функции обратного вызова
- DDE (платформа динамических данных Exchange), функции обратного вызова
- Платформа динамических данных Exchange (DDE), транзакции
- DDE (платформа динамических данных Exchange), транзакции
- Платформа динамических данных Exchange (DDE), имена служб
- DDE (платформа динамических данных Exchange), имена служб
- Платформа динамических данных Exchange (DDE), имена элементов
- DDE (платформа динамических данных Exchange), имена элементов
- Платформа динамических данных Exchange (DDE), имена разделов
- DDE (платформа динамических данных Exchange), имена разделов
- Платформа динамических данных Exchange (DDE), системный раздел
- DDE (платформа динамических данных Exchange), системный раздел
- Библиотека управления платформа динамических данных Exchange (ДДЕМЛ), инициализация
- ДДЕМЛ (Библиотека управления Exchange платформа динамических данных), инициализация
- Библиотека управления платформа динамических данных Exchange (ДДЕМЛ), функции обратного вызова
- ДДЕМЛ (Библиотека управления Exchange платформа динамических данных), функции обратного вызова
- Библиотека управления платформа динамических данных Exchange (ДДЕМЛ), управление строками
- ДДЕМЛ (Библиотека управления Exchange платформа динамических данных), управление строками
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0c564bffbcbb06ddc3a0e0fa4e0a9ed398d3ca55
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103792090"
---
# <a name="basic-concepts-dde"></a>Основные понятия (DDE)

Эти понятия являются ключевыми для понимания платформа динамических данных Exchange (DDE) и платформа динамических данных библиотеки управления Exchange (ДДЕМЛ).

-   [Взаимодействие между клиентом и сервером](#client-and-server-interaction)
-   [Транзакции и функция обратного вызова DDE](#transactions-and-the-dde-callback-function)
-   [Имена служб, имена разделов и имена элементов](#service-names-topic-names-and-item-names)
-   [Системный раздел](#system-topic)
-   [Инициализация](#initialization)
-   [Функция обратного вызова](#callback-function)
-   [Управление строками](#string-management)
-   [ДДЕМЛ и потоки](#ddeml-and-threads)

## <a name="client-and-server-interaction"></a>Взаимодействие между клиентом и сервером

DDE всегда происходит между клиентским приложением и серверным приложением. *Клиентское приложение DDE* инициирует обмен, создавая диалог с сервером для отправки транзакций на сервер. Транзакция — это запрос данных или служб. *Серверное приложение DDE* отвечает на транзакции, предоставляя клиенту данные или службы. Например, графическое приложение может содержать линейчатую диаграмму, представляющую квартальную прибыль корпорации, но данные линейчатой диаграммы могут содержаться в приложении для работы с электронными таблицами. Чтобы получить последние данные о прибылях, графическое приложение (клиент) может создать диалог с приложением электронной таблицы (сервер). Графическое приложение может отправить транзакцию в приложение электронной таблицы, запросив последние данные о прибылях.

Сервер может одновременно иметь много клиентов, а клиент может запрашивать данные с нескольких серверов. Приложение также может быть клиентом и сервером. Как клиент, так и сервер могут завершить диалог в любое время.

## <a name="transactions-and-the-dde-callback-function"></a>Транзакции и функция обратного вызова DDE

ДДЕМЛ уведомляет приложение о действии DDE, которое влияет на приложение, отправляя транзакции в функцию обратного вызова DDE приложения. *Транзакция DDE* похожа на сообщение — это именованная константа, сопровождающая другие параметры, которые содержат дополнительные сведения о транзакции.

ДДЕМЛ передает транзакцию в определенную приложением функцию обратного вызова DDE, которая выполняет действие, соответствующее типу транзакции. Например, когда клиентское приложение пытается установить диалог с серверным приложением, клиент вызывает функцию [**ддеконнект**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) . Эта функция заставляет ДДЕМЛ отправить транзакцию [**кстип \_ Connect**](xtyp-connect.md) в функцию обратного вызова DDE сервера. Функция обратного вызова может разрешить диалог, возвращая **true** в ддемл, или запретить диалог, возвращая **значение false**. Подробное описание транзакций см. в разделе [Управление транзакциями](transaction-management.md).

## <a name="service-names-topic-names-and-item-names"></a>Имена служб, имена разделов и имена элементов

Сервер DDE использует имя службы иерархии с тремя уровнями (именуемое "имя приложения" в предыдущей документации DDE), имя раздела и имя элемента для уникальной идентификации единицы данных, которые сервер может обменивать во время диалога.

*Имя службы* — это строка, на которую реагирует серверное приложение, когда клиент пытается установить диалог с сервером. Клиент должен указать это имя службы, чтобы установить диалог с сервером. Хотя сервер может отвечать на многие имена служб, большинство серверов реагируют только на одно имя.

*Имя раздела* — это строка, идентифицирующая логический контекст данных. Для серверов, работающих с файловыми документами, имена разделов обычно являются именами файлов. для других серверов они являются другими строками, зависящими от приложения. Клиент должен указать имя раздела вместе с именем службы сервера при попытке установить диалог с сервером.

*Имя элемента* — это строка, определяющая единицу данных, которые сервер может передать клиенту во время транзакции. Например, имя элемента может обозначать целое число, строку, несколько абзацев текста или точечный рисунок.

Имена службы, раздела и элемента позволяют клиенту устанавливать диалог с сервером и принимать данные с сервера.

## <a name="system-topic"></a>Системный раздел

Раздел System содержит контекст для получения сведений об общем интересе любому клиенту DDE. Рекомендуется все время, чтобы серверные приложения поддерживали системный раздел. Системный раздел определен в ДДЕМЛ. Файл заголовка H в виде \_ раздела сзддесис.

Чтобы определить, какие серверы существуют, и какие типы информации они могут предоставить, клиентское приложение может запросить диалог по системному разделу после запуска, установив для имени устройства **значение NULL**. Такие диалоговые окна с подстановочными знаками являются дорогостоящими в плане производительности системы, поэтому их следует свести к минимуму. Дополнительные сведения об инициализации сеансов DDE см. в разделе [Управление диалоговыми](conversation-management.md)окнами.

Сервер должен поддерживать следующие имена элементов в системном разделе и имена других элементов, полезных для клиента.



| Элемент                     | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| СЗДДЕ \_ элемент \_ итемлист    | Список элементов, поддерживаемых в несистемном разделе. (Этот список может меняться в зависимости от момента и от раздела до раздела).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| \_форматы элементов \_ сзддесис  | Разделенный символами табуляцией список строк, представляющих все форматы буфера обмена, потенциально поддерживаемые приложением службы. Строки, представляющие стандартные форматы буфера обмена, эквивалентны \_ значениям CF с \_ удаленным префиксом "CF". Например, \_ Формат текста CF представлен строкой Text. Эти строки должны быть в верхнем регистре, чтобы их можно было определить как Предопределенные форматы. Список форматов должен отображаться в порядке с наиболее широкими возможностями в содержимом с минимальными возможностями содержимого. Дополнительные сведения о форматах буфера обмена и данных для подготовки к просмотру см. в разделе [буфер обмена](clipboard.md).<br/> |
| \_Справка по элементу сзддесис \_     | Понятные пользователю сведения об общем интересе. Этот элемент должен содержать как минимум сведения об использовании функций DDE серверного приложения. Эти сведения могут включать, но не ограничиваются, как указывать элементы в разделах, как выполнять строки, которые может выполнять сервер, какие транзакции разрешаются, а также как найти справку по другим системным разделам.                                                                                                                                                                                                                           |
| СЗДДЕСИС \_ элемент \_ ртнмсг   | Поддержка подробных сведений о недавно использованном сообщении [**WM \_ DDE \_ ACK**](wm-dde-ack.md) . Этот элемент полезен в тех случаях, когда требуется более 8 бит возвращаемых данных для конкретного приложения.                                                                                                                                                                                                                                                                                                                                                                                                                        |
| \_состояние элемента \_ сзддесис   | Указывает текущее состояние сервера. Как правило, этот элемент поддерживает только \_ Формат текста CF и содержит строку Ready или Busy.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| СЗДДЕСИС \_ элемент \_ сиситемс | Список элементов, поддерживаемых этим сервером в разделе System.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| \_статьи об элементах сзддесис \_   | Список разделов, поддерживаемых сервером в текущее время. (Этот список может меняться в зависимости от времени.)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |



 

Эти имена элементов являются значениями, определенными в ДДЕМЛ. Файл заголовка H. Чтобы получить дескрипторы строк для этих строк, приложение должно использовать функции управления строками ДДЕМЛ так же, как и для любой другой строки в приложении ДДЕМЛ. Дополнительные сведения об управлении строками см. в разделе [Управление строками](#string-management).

## <a name="initialization"></a>Инициализация

Перед вызовом любой другой функции ДДЕМЛ приложение должно вызвать функцию [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) . **Ддеинитиализе** получает идентификатор экземпляра для приложения, регистрирует функцию обратного вызова DDE приложения в DDE и задает флаги фильтра транзакций для функции обратного вызова.

Каждый экземпляр приложения или библиотеки DLL должен передавать свой идентификатор экземпляра в качестве параметра *идинст* любой другой функции ддемл, которая ее требует. Несколько экземпляров ДДЕМЛ предназначены для поддержки библиотек DLL, которые должны использовать ДДЕМЛ в то же время, когда приложение использует его. Приложение не должно использовать более одного экземпляра ДДЕМЛ.

*Фильтры транзакций* оптимизируют производительность системы за счет предотвращения передачи нежелательных транзакций в функцию обратного вызова DDE приложения ддемл. Приложение задает фильтры транзакций в параметре уфкмд [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea)  . Приложение должно задавать флаг фильтра транзакций для каждого типа транзакции, который не обрабатывается в функции обратного вызова. Приложение может изменить свои фильтры транзакций при последующем вызове **ддеинитиализе**. Дополнительные сведения о транзакциях см. в разделе [Управление транзакциями](transaction-management.md).

В следующем примере показано, как инициализировать приложение для использования ДДЕМЛ.


```
DWORD idInst = 0; 
HINSTANCE hinst; 
 
DdeInitialize(&idInst,         // receives instance identifier 
    (PFNCALLBACK) DdeCallback, // pointer to callback function 
    CBF_FAIL_EXECUTES |        // filter XTYPE_EXECUTE 
    CBF_SKIP_ALLNOTIFICATIONS, // filter notifications 
    0); 
```



Приложение должно вызвать функцию [**ддеунинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeuninitialize) , когда больше не будет использовать ддемл. Эта функция завершает все беседы, открытые в настоящее время для приложения, и освобождает ресурсы ДДЕМЛ, выделенные для приложения.

## <a name="callback-function"></a>Функция Callback

Приложение, использующее ДДЕМЛ, должно предоставлять функцию обратного вызова, которая обрабатывает события DDE, влияющие на приложение. ДДЕМЛ уведомляет приложение о таких событиях, отправляя транзакции в функцию обратного вызова DDE приложения. Транзакции, получаемые функцией обратного вызова, зависят от того, какой фильтр обратного вызова имеет приложение, указанное в [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) , и является ли приложение клиентом, сервером или обоими. Дополнительные сведения см. в разделе [**ддекаллбакк**](/windows/win32/api/ddeml/nc-ddeml-pfncallback).

В следующем примере показана общая структура функции обратного вызова для типичного клиентского приложения.


```
HDDEDATA CALLBACK DdeCallback(uType, uFmt, hconv, hsz1, 
    hsz2, hdata, dwData1, dwData2) 
UINT uType;       // transaction type 
UINT uFmt;        // clipboard data format 
HCONV hconv;      // handle to conversation 
HSZ hsz1;         // handle to string 
HSZ hsz2;         // handle to string 
HDDEDATA hdata;   // handle to global memory object 
DWORD dwData1;    // transaction-specific data 
DWORD dwData2;    // transaction-specific data 
{ 
    switch (uType) 
    { 
        case XTYP_REGISTER: 
        case XTYP_UNREGISTER: 
            . 
            . 
            . 
            return (HDDEDATA) NULL; 
 
        case XTYP_ADVDATA: 
            . 
            . 
            . 
            return (HDDEDATA) DDE_FACK; 
 
        case XTYP_XACT_COMPLETE: 
            
            // 
            
            return (HDDEDATA) NULL; 
 
        case XTYP_DISCONNECT: 
            
            // 
            
            return (HDDEDATA) NULL; 
 
        default: 
            return (HDDEDATA) NULL; 
    } 
} 
```



Параметр *утипе* указывает тип транзакции, отправляемый функции обратного вызова объектом ддемл. Значения остальных параметров зависят от типа транзакции. Типы транзакций и события, которые их создают, описаны в следующих разделах. Подробные сведения о каждом типе транзакции см. в разделе [Управление транзакциями](transaction-management.md).

## <a name="string-management"></a>Управление строками

Для выполнения задачи DDE многим функциям ДДЕМЛ требуется доступ к строкам. Например, клиент должен указать имя службы и имя раздела при вызове функции [**ддеконнект**](/windows/desktop/api/Ddeml/nf-ddeml-ddeconnect) для запроса диалога с сервером. Приложение указывает строку, передавая строковый маркер (ХСЗ), а не указатель в функции ДДЕМЛ. *Строковый обработчик* — это значение **типа DWORD** , присваиваемое системой, которое определяет строку.

Приложение может получить строковый обработчик для конкретной строки, вызвав функцию [**ддекреатестрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatestringhandlea) . Эта функция регистрирует строку в системе и возвращает в приложение обработчик строк. Приложение может передать этот обработчик функциям ДДЕМЛ, которые должны обращаться к строке. Следующий пример получает дескрипторы строк для строки системного раздела и строки имени службы.


```
HSZ hszServName; 
HSZ hszSysTopic; 
hszServName = DdeCreateStringHandle( 
    idInst,         // instance identifier 
    "MyServer",     // string to register 
    CP_WINANSI);    // Windows ANSI code page 
 
hszSysTopic = DdeCreateStringHandle( 
    idInst,         // instance identifier 
    SZDDESYS_TOPIC, // System topic 
    CP_WINANSI);    // Windows ANSI code page 
    
```



Параметр *идинст* в предыдущем примере указывает идентификатор экземпляра, полученный функцией [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) .

Функция обратного вызова DDE приложения получает один или несколько дескрипторов строк во время большинства транзакций DDE. Например, сервер получает два дескриптора строки во время транзакции [**\_ запроса кстип**](xtyp-request.md) : одна определяет строку, указывающую имя раздела, а другая определяет строку, указывающую имя элемента. Приложение может получить длину строки, которая соответствует строковому маркеру, и скопировать ее в определенный приложением буфер, вызвав функцию [**ддекуеристринг**](/windows/desktop/api/Ddeml/nf-ddeml-ddequerystringa) , как показано в следующем примере.


```
DWORD idInst; 
DWORD cb; 
HSZ hszServ; 
PSTR pszServName; 
cb = DdeQueryString(idInst, hszServ, (LPSTR) NULL, 0, 
    CP_WINANSI) + 1; 
pszServName = (PSTR) LocalAlloc(LPTR, (UINT) cb); 
DdeQueryString(idInst, hszServ, pszServName, cb, CP_WINANSI); 
```



Зависящий от экземпляра обработчик строк не может быть сопоставлен с строковым маркером и строкой. Например, несмотря на то, что [**ддекуеристринг**](/windows/desktop/api/Ddeml/nf-ddeml-ddequerystringa) создает строку из дескриптора строки, а затем [**ддекреатестрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatestringhandlea) создает строковый дескриптор из этой строки, два дескриптора не совпадают, как показано в следующем примере.


```
DWORD idInst; 
DWORD cb; 
HSZ hszInst, hszNew; 
PSZ pszInst; 
DdeQueryString(idInst, hszInst, pszInst, cb, CP_WINANSI); 
hszNew = DdeCreateStringHandle(idInst, pszInst, CP_WINANSI); 
// hszNew != hszInst ! 
```



Чтобы сравнить значения двух дескрипторов строк, используйте функцию [**ддекмпстрингхандлес**](/windows/desktop/api/Ddeml/nf-ddeml-ddecmpstringhandles) .

При возврате функции обратного вызова функция обратного вызова DDE передается в недопустимый строковый маркер. Приложение может сохранить строковый маркер для использования после возврата функции обратного вызова с помощью функции [**ддекипстрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddekeepstringhandle) .

Когда приложение вызывает [**ддекреатестрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatestringhandlea), система вводит указанную строку в таблицу строк и создает обработчик, который он использует для доступа к строке. Система также поддерживает подсчет использования для каждой строки в таблице строк.

Когда приложение вызывает [**ддекреатестрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddecreatestringhandlea) и указывает строку, которая уже существует в таблице, система увеличивает счетчик использования, а не добавляет еще одно вхождение строки. (Приложение также может увеличить счетчик использования с помощью [**ддекипстрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddekeepstringhandle).) Когда приложение вызывает функцию [**ддефристрингхандле**](/windows/desktop/api/Ddeml/nf-ddeml-ddefreestringhandle) , система уменьшает счетчик использования.

Строка удаляется из таблицы, если ее значение счетчика использования равно нулю. Так как несколько приложений могут получить этот обработчик для конкретной строки, приложение не должно освобождать строковый обработчик больше, чем он был создан или удерживает этот обработчик. В противном случае приложение может вызвать удаление строки из таблицы, запрещая другим приложениям доступ к строке.

Функции управления строками ДДЕМЛ основаны на диспетчере Atom и имеют те же ограничения по размеру, что и атомы.

## <a name="ddeml-and-threads"></a>ДДЕМЛ и потоки

Функция [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) регистрирует приложение в ддемл, создавая экземпляр ддемл. Экземпляр ДДЕМЛ основан на потоке и связан с потоком, который вызвал **ддеинитиализе**.

Все вызовы функций ДДЕМЛ для объектов, принадлежащих экземпляру ДДЕМЛ, должны быть сделаны из того же потока, который вызвал [**ддеинитиализе**](/windows/desktop/api/Ddeml/nf-ddeml-ddeinitializea) для создания экземпляра. При вызове функции ДДЕМЛ из другого потока функция завершится ошибкой. Невозможно получить доступ к беседе ДДЕМЛ из потока, отличного от того, который выделил диалог.

 

