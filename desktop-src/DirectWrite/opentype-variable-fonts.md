---
title: Шрифты переменных OpenType
description: в этом разделе описаны шрифты переменных OpenType, их поддержка в DirectWrite и Direct2D, а также способы их использования в приложении. .
ms.assetid: 788558a7-efe7-b075-942f-ac75a5b86b84
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c671bebce73cf3bdec42d1f7f570add914db7eb33b8a6bfd1b196d569b9975d5
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118649400"
---
# <a name="opentype-variable-fonts"></a>Шрифты переменных OpenType

в этом разделе описаны шрифты переменных OpenType, их поддержка в DirectWrite и Direct2D, а также способы их использования в приложении. 

-   [Что такое переменные шрифты OpenType?](#what-are-opentype-variable-fonts)
-   [Поддержка шрифтов переменных OpenType в DirectWrite](#opentype-variable-font-support-in-directwrite)
-   [Использование переменных шрифтов OpenType](#using-opentype-variable-fonts)

## <a name="what-are-opentype-variable-fonts"></a>Что такое переменные шрифты OpenType?

Версия 1,8 [спецификации формата шрифтов OpenType](https://www.microsoft.com/typography/otspec/) предоставила новое расширение в формате, известном как [варианты шрифтов OpenType](/typography/opentype/spec/otvaroverview). Шрифты, использующие эти расширения, называются переменными шрифтами OpenType. Переменная шрифта OpenType — это один шрифт, который может вести себя как несколько шрифтов с помощью непрерывной интерполяции между различными макетами, определенными в одном шрифте.

Шрифт переменной OpenType может определять непрерывную вариацию своего дизайна по одной или нескольким независимым осям, таким как вес или ширина: 

 

![Показывает шрифт переменной OpenType с использованием буквы "G" и показывает различные вариации вдоль горизонтальной и вертикальной оси толщины.](images/opentype-width-weight.png)

Разработчик шрифта определяет набор осей вариаций для использования в определенном шрифте. Эти оси могут включать набор хорошо известных (или "зарегистрированных") осей вариации, например веса и ширины, но они также могут включать произвольные настраиваемые оси вариации, определенные разработчиком шрифта.  

Если выбрать набор осей вариантов для шрифта, разработчик шрифта определяет абстрактное, n-мерный размер варианта проектирования для шрифта. Текстовые обработчики могут задавать потенциально любую точку или "экземпляр" внутри этого непрерывного пространства для размещения и отрисовки текста. 

Разработчик шрифта также может выбирать и назначать имена определенным экземплярам в пространстве конструктивных вариантов. они называются именованными экземплярами. Например, шрифт с вариацией веса может поддерживать непрерывную вариацию между очень светлой и очень большой обводкой, тогда как разработчик шрифта выбрал определенные весовые коэффициенты и присвоить им имена, такие как «Light», «Regular» и «полужирный». 

Формат шрифта переменной OpenType использует таблицы данных, находящиеся в традиционных шрифтах OpenType, а также некоторые дополнительные таблицы, описывающие изменение значений различных элементов данных для разных экземпляров. Формат определяет один экземпляр варианта как "экземпляр по умолчанию", который использует традиционные таблицы для получения значений по умолчанию. Все остальные экземпляры зависят от данных по умолчанию и других разностных данных. Например, таблица "глиф" может иметь описание номинальной фигуры глифа, которая является фигурой, используемой для экземпляра по умолчанию, а таблица "гвар" будет описывать, как контрольные точки Безье для глифа корректируются для других экземпляров. Аналогичным образом, другие значения шрифта могут иметь номинальное значение плюс разностные данные, описывающие изменение этих значений для разных экземпляров. Например, x-Height и другие метрики на уровне шрифта или метки, зависящие от глифов, и корректировки кернинга. 

Так как переменные шрифты могут поддерживать произвольный набор осей вариаций, им требуется расширяемая модель семейств шрифтов, которая более точно отражает, как разработчики шрифтов создают семейства шрифтов: семейство шрифтов определяется именем семейства и определенными характеристиками структуры, которые являются постоянными, с произвольным числом (определяется разработчиком шрифта) способами, в которых структура может различаться. Можно создать одно семейство шрифтов с вариантами веса, но можно создать другое семейство шрифтов с вариантами для x-высоты, Serif-size, "функинесс" или любым разработчиком шрифта. В этой модели выбор начертания шрифта лучше описать с помощью общего, или «предпочитаемого» или «типографского» имени семейства, а также набора пар «ключ-значение», каждый из которых представляет разновидность и конкретное значение, с видами вариаций в общем виде расширяемым набором. Это общее понятие семейства шрифтов может применяться к традиционным, непеременным шрифтам, а также к переменным шрифтам. Например, в рамках этой общей модели для типографской гарнитуры семейство «Селавик VF» может иметь вариации для веса, оптического размера и засечек с такими экземплярами, как «Semilight Banner Sans». 

однако некоторые существующие реализации программного обеспечения, в том числе существующие DirectWrite api, могут быть спроектированы с учетом более ограниченной модели семейств шрифтов. Например, некоторые приложения могут предположить, что семейство шрифтов может иметь, по крайней мере, обычный, полужирный, курсив и полужирный курсив. существующие интерфейсы [**идвритефонтколлектион**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) и [**идвритефонтфамили**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfamily) предполагают использование модели семейства веса/растяжения или стиля ("Windows SharePoint Services"), что позволяет указать варианты в семействе с помощью [**двритеного \_ \_ веса шрифта**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_weight), [**дврите \_ \_ растяжение шрифтов**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_stretch) или перечислений [**\_ шрифтов \_ дврите**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_style) в качестве параметров. выполнив предыдущий пример, оси оптического и засечек не будут рассматриваться как внутренние оси в модели Windows SharePoint Services. 

Для полной поддержки переменных шрифтов потребуются API, позволяющие указать член семейства с потенциально несколькими параметрами, как определено шрифтом. Однако существующие схемы API могут обеспечить частичную поддержку переменных шрифтов путем проецирования именованных экземпляров, определенных в переменном шрифте, в более ограниченные модели семейства шрифтов. в предыдущем примере «селавик vf Semilight banner sans» может быть проецирован в модель Windows SharePoint Services как семейство «селавик vf Banner sans» с «Semilight» в качестве варианта веса. 

В качестве другого примера рассмотрим типографскую гарнитуру, например Ситка, с вариантами веса и оптического размера. Именованные варианты в семействе включают обычный текст Ситка и Ситканый баннер (а также многие другие). Название семьи "Ситка", а названия этих вариантов в модели гарнитуры — "обычный текст" и "баннер полужирный". модели семейства из четырех элементов и Windows SharePoint Services не поддерживают варианты оптического размера в семействе, поэтому различия в оптическом размере должны рассматриваться как различия на уровне семейства. в следующей таблице показано, как в модели семейства Windows SharePoint Services будут рассматриваться выбранные шрифты из типографии ситка: 



Модель семейства типографских

модель семейства Windows SharePoint Services

Семейство

Распознавание лиц

Семейство

Распознавание лиц

ситка

Обычный текст

Ситка текст

Обычный

ситка

Плакат, полужирный

Баннер Ситка

Полужирный

ситка

Курсив заголовка

Заголовок Ситка

Курсив



 

проекции имен из типографии в модели семейства Windows SharePoint Services можно применять к непеременным шрифтам и к именованным экземплярам переменных шрифтов. Однако это не может быть сделано для других неименованных экземпляров из области непрерывного проектирования, относящейся к переменному шрифту. По этой причине поддержка полной функциональности переменных шрифтов потребует использования интерфейсов API, предназначенных для ссылок на лица в типографском семействе, с точки зрения неограниченного набора осей вариаций и значений осей. 

## <a name="opentype-variable-font-support-in-directwrite"></a>Поддержка шрифтов переменных OpenType в DirectWrite

начиная с выпуска Windows 10 Creators Update формат переменных OpenType по-прежнему очень новый, а поставщики шрифтов, платформ и приложений все еще находятся в процессе реализации нового формата. Это обновление обеспечивает начальную реализацию для этого формата в DirectWrite. 

DirectWrite внутренние компоненты были обновлены для поддержки переменных шрифтов OpenType. Используя текущие API, это обеспечивает поддержку любых именованных экземпляров переменного шрифта. Эта поддержка может использоваться для завершения рабочих процессов — от перечисления именованных экземпляров, выбора именованного экземпляра, использования в макете и формировании для подготовки к просмотру и печати. Для преимуществ приложений, которые также используют текстовое взаимодействие GDI для определенных операций, аналогичная поддержка также была добавлена в существующие API GDI. 

в Windows 10 Creators Update DirectWrite не поддерживает произвольные экземпляры, использующие возможность постоянной вариации переменных шрифтов.

во многих операциях поведение в DirectWrite именованных экземпляров переменного шрифта не может отличаться от поведения непеременных шрифтов. а так как поддержка предоставляется с помощью существующих DirectWrite api, именованные экземпляры переменных шрифтов могут даже работать во многих существующих приложениях DirectWrite без каких-либо изменений. Однако исключения могут применяться в определенных ситуациях.  

-   Если приложение обрабатывает данные шрифтов непосредственно для определенных операций. Например, если приложение считывает данные структуры глифа непосредственно из файла шрифта для создания определенных визуальных эффектов.
-   Если приложение использует библиотеку сторонних разработчиков для определенных операций. например, если приложение использует DirectWrite для макета, для получения окончательных индексов и позиций глифов, но затем использует библиотеку стороннего производителя для подготовки к просмотру.
-   Если приложение внедряет данные шрифтов в документ или другой способ передает данные шрифтов в нисходящий процесс.

Если операции выполняются с использованием реализаций, которые не поддерживают переменные шрифты, то эти операции могут не давать ожидаемых результатов. Например, позиции глифов могут рассчитываться для одного именованного экземпляра переменной Font, но при этом глифы могут быть отображены с учетом другого именованного экземпляра. В зависимости от реализации приложения результаты могут работать в некоторых контекстах, но не в других контекстах, где могут использоваться другие библиотеки. Например, текст может отображаться правильно на экране, но не при печати. если сквозные рабочие процессы реализуются только с помощью DirectWrite, может потребоваться правильное поведение именованных экземпляров переменного шрифта. 

поскольку существующие api DirectWrite поддерживают выделение лиц с помощью модели веса, растяжения и стиля, именованные экземпляры шрифтов, которые используют другие оси вариации, будут выделены из общей, типографской модели семейства в модель Windows SharePoint Services, как описано выше. Это зависит от переменного шрифта, включающего таблицу "атрибуты стиля" ("STAT") с подтаблицами "ось-значение", которые Дврите использует для различения маркеров имени, определяющих весовые значения, атрибуты растяжения или стиля из маркеров, относящихся к другим осям вариации.  

если переменный шрифт не включает таблицу STAT, которая требуется для переменных шрифтов спецификацией OpenType, то DirectWrite будет обрабатывать шрифт как непеременный шрифт, содержащий только экземпляр по умолчанию.  

Если шрифт содержит таблицу STAT, но не содержит соответствующие вложенные таблицы значений осей, это может привести к непредвиденным результатам, например наличие нескольких лиц с одинаковыми именами лиц. В настоящее время такие шрифты не поддерживаются. 

Спецификация OpenType позволяет представить данные структуры глифов в одном из двух форматов: с помощью таблицы "глиф", в которой используется формат "структура TrueType" и "Подсказка", или с помощью таблицы "CFF", которая использует представление в формате компактного шрифта ("CFF"). В переменном шрифте с обозначением TrueType таблица "глиф" по-своему используется и дополняется таблицей "гвар", которая предоставляет данные варианта для контуров. Это означает, что экземпляр по умолчанию переменного шрифта с контурами TrueType использует только традиционные таблицы OpenType, которые будут поддерживаться в старом программном обеспечении без поддержки переменных шрифта. Однако в переменной шрифт с CFF контурами таблица "CFF" заменяется таблицей "CFF2", которая инкапсулирует данные структуры по умолчанию и связанные данные варианта в одной таблице. Данные CFF обрабатываются с помощью отдельного средства растеризации, используемого для данных TrueType, а для таблицы "CFF2" требуется обновленный CFF средство прорисовки, поддерживающее поддержку "CFF2". Таблица "CFF2" не может быть обработана более старыми средствами растеризации CFF. Для переменного шрифта с данными структуры CFF это означает, что даже экземпляр по умолчанию не будет работать в старом программном обеспечении. 

в Windows 10 Creators Update DirectWrite не поддерживает переменные шрифты с данными структуры CFF с помощью таблицы "CFF2". 

## <a name="using-opentype-variable-fonts"></a>Использование переменных шрифтов OpenType

Можно легко использовать переменные шрифты OpenType, учитывая текущие ограничения, указанные выше: 

-   В настоящее время поддерживаются только именованные экземпляры переменной шрифта.
-   В настоящее время поддерживаются только переменные шрифты, в которых используются данные структуры глифов TrueType (не CFF контуры). 
-   для шрифтов, использующих оси, отличные от веса, растяжения или стиля, именованные экземпляры будут проецироваться в модель семейства Windows SharePoint Services, что может привести к тому, что некоторые именованные экземпляры появятся как отдельные семейства (как в прошлом для непеременных шрифтов). Для этого переменные шрифты должны иметь таблицу STAT, которая включает соответствующие подтаблицы значений осей.
-   именованные экземпляры переменных шрифтов поддерживаются в DirectWrite api, но если некоторые операции выполняются в старых реализациях, которые не поддерживают переменные шрифты, они могут привести к неправильным результатам. 
-   некоторые api DirectWrite используют [**дврите \_ шрифта \_**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_weight), [**дврите \_ \_ растяжение**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_stretch) шрифта и дврите перечисления начертания [**шрифта для указания \_ \_**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_style) веса, растяжения и атрибутов стиля при выборе лиц. Если переменная шрифта использует соответствующие оси вариации, но имеет много именованных экземпляров, требующих более детальной детализации, то не все именованные экземпляры будут выбираться в этих API.

переменные opentype, соответствующие этим требованиям, можно установить из оболочки Windows, как и другие шрифты OpenType, а также можно использовать в пользовательских наборах шрифтов, созданных приложением.  

При установке в системе все именованные экземпляры переменной шрифта будут включаться в набор шрифтов, возвращаемый путем вызова метода IDWriteFontFamily3::[**жетсистемфонтсет**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) . обратите внимание, что набор шрифтов является плоским списком без иерархии группирования семейства, но каждый элемент в наборе имеет свойство family-name, основанное на модели семейства Windows SharePoint Services. Набор шрифтов можно отфильтровать для конкретного именованного экземпляра с переменным шрифтом с помощью методов [**идвритефонтсет:: жетматчингфонтс**](idwritefontset-getmatchingfonts-overload.md) . однако при использовании перегрузки **жетматчингфонтс** , которая принимает familyName, заданный familyName должен использовать имя, соответствующее модели семейства шрифтов Windows SharePoint Services. полный список имен, совместимых с Windows SharePoint Services, которые входят в набор шрифтов, можно получить с помощью методов [**идвритефонтсет:: GetPropertyValues**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontset-getpropertyvalues(dwrite_font_property_id_idwritestringlist)) , использующих \_ \_ \_ имя семейства идентификаторов свойств font дврите \_ \_ .  

Аналогичным образом все именованные экземпляры переменного шрифта будут представлены в коллекции шрифтов, возвращаемой методом Идвритефактори::[**жетсистемфонтколлектион**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) . поскольку элементы коллекции шрифтов являются семействами шрифтов на основе модели Windows SharePoint Services, именованные экземпляры переменного шрифта могут быть представлены в коллекции как члены двух или более семейств шрифтов. если используется метод [**идвритефонтколлектион:: финдфамилинаме**](/windows/win32/api/dwrite/nf-dwrite-idwritefontcollection-findfamilyname) , параметр familyName должен быть именем семейства, совместимого с Windows SharePoint Services. чтобы найти все имена семейств, совместимых с Windows SharePoint Services, из коллекции шрифтов, приложение может циклически проходить по каждому семейству и вызывать [**идвритефонтфамили:: жетфамилинамес**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfamily-getfamilynames), хотя может быть проще получить соответствующий набор шрифтов и использовать метод [**GetPropertyValues**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontset-getpropertyvalues(dwrite_font_property_id_idwritestringlist)) , как описано выше. 

При работе с пользовательскими шрифтами для создания набора шрифтов можно использовать различные подходы, описанные в разделе [пользовательские наборы шрифтов](custom-font-sets-win10.md) . Чтобы добавить переменную шрифт в пользовательский набор шрифтов, рекомендуется использовать метод [**IDWriteFontSetBuilder1:: аддфонтфиле**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) , так как он поддерживает переменные шрифты и добавляет все именованные экземпляры переменного шрифта в один вызов. На данный момент невозможно добавить отдельные именованные экземпляры шрифта настраиваемой переменной к набору шрифтов с помощью методов [**идвритефонтсетбуилдер:: аддфонтфацереференце**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) , так как не существует способа создать ссылку на шрифт, указав, какой из именованных экземпляров из файла шрифта переменной является необходимым. Это означает, что в настоящее время невозможно добавить именованные экземпляры пользовательского шрифта в пользовательский набор шрифтов с назначенными пользовательскими свойствами. это, в свою очередь, означает, что в настоящее время невозможно легко использовать настраиваемые переменные шрифты в сочетании с интерфейсами api DirectWrite для удаленных шрифтов. Если именованные экземпляры переменного шрифта включены в набор системных шрифтов, то ссылки на шрифт для каждого именованного экземпляра уже существуют, и их можно добавить в пользовательские наборы шрифтов, в том числе с помощью значений настраиваемых свойств. Дополнительные сведения см. в разделе Пользовательские наборы шрифтов. 

при работе с переменными шрифтами перечисления [**DirectWrite \_ дврите \_ шрифта**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_weight) и [**\_ \_ растяжения шрифта дврите**](/windows/win32/api/dwrite/ne-dwrite-dwrite_font_stretch) тесно связаны с осями вариантов веса и ширины, определенными в спецификации OpenType, но не одинаковы. Во первых, числовой масштаб для любой оси вариантов всегда поддерживает дробные значения, тогда как fontWeight и fontStretch используют целые числа. Шкала весовой оси OpenType использует значения от 1 до 1000, что также поддерживается fontWeight. Таким образом, изменение значения по оси веса вариации на fontWeight является относительно незначительным: fontWeight, сообщаемый для именованного экземпляра, может быть округлен от точного значения, используемого для определения именованного экземпляра внутри шрифта. различие между DirectWrite fontStretch и шкалой по оси ширины OpenType больше: DirectWrite использует значения от 1 до 9, после значений [усвидскласс](/typography/opentype/spec/os2#uswidthclass) таблицы OpenType OS/2, а масштаб по оси ширины opentype использует положительные значения, представляющие процент нормальной ширины. Документация [усвидскласс](/typography/opentype/spec/os2#uswidthclass) в спецификации OpenType обеспечивает сопоставление между значениями от 1 до 9 и процентными значениями. Значение fontStretch, сообщаемое для именованного экземпляра, может содержать округление при преобразовании из значений осей ширины. 

при создании [**идвритетекстформат**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat)необходимо указать коллекцию шрифтов и свойства шрифта, совместимые с Windows SharePoint Services (имя семейства, вес, растяжение и стиль). Это также применимо при задании свойств форматирования шрифта для текстового диапазона [**идвритетекстлайаут**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) . Свойства можно получить из объекта [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) или из объектов [**идвритефонт**](/windows/win32/api/dwrite/nn-dwrite-idwritefont) и [**идвритефонтфамили**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfamily) , представляющих определенный именованный экземпляр. как показано выше, значения, возвращаемые методами round и stretch, могут быть скругленными приближениями для фактических значений осей, используемых для определения именованного экземпляра, но DirectWrite будет сопоставлять сочетание свойств с нужным именованным экземпляром. 

аналогичным образом, если приложение использует [**идвритефонтфаллбаккбуилдер**](idwritefontfallbackbuilder.md) для создания настраиваемых данных резервных шрифтов, семейства указываются для сопоставлений диапазонов символов с помощью имен семейств, совместимых с Windows SharePoint Services. резервные шрифты в DirectWrite основаны на семействах с DirectWrite выбора варианта в резервном семействе, которое является ближайшим соответствием варианту начального семейства. для вариантов, которые включают измерения, отличные от веса, растяжения и стиля, DirectWrite в настоящее время не смогут выбирать такие варианты в резервном семействе, если только пользовательские резервные данные не создавались специально для обеспечения резервных сопоставлений для семейств с определенными неWindows SharePoint Servicesными атрибутами, такими как варианты оптического размера "заголовок".

 

 