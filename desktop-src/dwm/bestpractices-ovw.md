---
title: Вопросы производительности и рекомендации
description: В этом разделе представлен набор рекомендаций по использованию интерфейсов API диспетчер окон рабочего стола (DWM).
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Диспетчер окон рабочего стола (DWM), рекомендации
- DWM (диспетчер окон рабочего стола), рекомендации
- Диспетчер окон рабочего стола (DWM), рекомендации по приложениям
- DWM (диспетчер окон рабочего стола), рекомендации по приложениям
- Диспетчер окон рабочего стола (DWM), способы рисования
- DWM (диспетчер окон рабочего стола), рекомендации по рисованию
- Диспетчер окон рабочего стола (DWM), размытие за эффектом
- DWM (диспетчер окон рабочего стола), размытие за эффект
- рекомендации по приложениям
- способы рисования
- Размытие за эффект
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7affbbf5ebca91a4e5172e75f88da4b9fe8e33f6e1e3de1e7a735add816a313f
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118280277"
---
# <a name="performance-considerations-and-best-practices"></a>Вопросы производительности и рекомендации

В этом разделе представлен набор рекомендаций по использованию интерфейсов API диспетчер окон рабочего стола (DWM).

Этот раздел состоит из следующих подразделов.

-   [Рекомендации по приложениям для DWM](#application-practices-for-dwm)
-   [Методики рисования для DWM](#drawing-practices-for-dwm)
-   [Область клиента DWM Blur-Behind](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a>Рекомендации по приложениям для DWM

Если приложение обрабатывает масштабирование точек на дюйм, можно объявить приложение как поддерживающее dpi и запретить автоматическое масштабирование, установив флаг с учетом dpi в манифесте программы или вызвав функцию [**сетпроцессдпиаваре**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) во время инициализации программы.

Если композиция DWM включена, скрытые приложения больше не получают сообщения [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) и не запрашивает повторное отображение. Содержимое каждого окна уже доступно для создания изображения экрана.

[**\_ \_ Прозрачные**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) окна верхнего уровня WS ex следует объединять с **\_ \_ Многоуровневый стилем WS ex** в целях проверки попадания. **Служба WS \_ ПРИМЕРная \_ прозрачность** в классическом смысле, без перенаправления, полезна для дочерних окон в иерархии окон, принадлежащих одному и тому же потоку, но не предназначенной для окон верхнего уровня.

Используйте области или слои для создания окон или смешивания. обратите внимание, что в Windows Vista и более поздних версиях Windows пользовательское рисование только в части окна верхнего уровня не будет предоставлять необходимое устаревшее содержимое в нерисуемых регионах.

Для определения определенных фактических значений можно использовать API-интерфейсы, такие как [**жетдкоржекс**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) . При наличии контекста устройства (DC) для перенаправляемого окна Источник, возвращенный **жетдкоржекс** , не будет соответствовать источнику окна на экране. Вместо этого источником будет источник поверхности заднего буфера для окна: (0, 0).

Если все остальное не удается, отключите отрисовку окна, вызвав функцию [**двмсетвиндоваттрибуте**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .

## <a name="drawing-practices-for-dwm"></a>Методики рисования для DWM

Избегайте рисования непосредственно на основной поверхности отображения. В этом случае диспетчер DWM будет вынужден отключить композицию, пока приложение не освободит поверхность основного устройства.

Оцените, должен ли приложение предоставлять собственную двойную буферизацию. DWM фактически дважды замещает содержимое и представляет окно в одном кадре.

Избегайте чтения или записи в отображаемый контроллер домена. Хотя это и поддерживается DWM, мы не рекомендуем использовать его из-за снижения производительности.

Избегайте прорисовки в области, не являющейся клиентской. Несмотря на то, что эта область может быть доступна для приложения, и отрисовка поддерживается в Microsoft Win32 API, это может привести к потере окон прозрачным обрамлением.

старайтесь не смешивать Windows интерфейс графических устройств (GDI) и Microsoft DirectX, если они не перекрываются. Если требуется смешивание, разместите содержимое GDI на поверхности программного обеспечения DirectX и объедините их перед созданием на экране или нарисуйте их в отдельных окнах.

используйте функцию [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) или [**стретчблт**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) вместо Windows GDI+ для представления документа для отрисовки. GDI+ отображает по одной строке сканирования за раз при отрисовке программного обеспечения. Это может вызвать мерцание в приложениях.

## <a name="dwm-blur-behind-client-region"></a>Область клиента DWM Blur-Behind

Визуализация эффект размытия — это ресурсоемкие операции как для ЦП, так и для графического процессора. Разработчики приложений, законодателей, оценить последствия использования размытия в области клиента, чтобы он не потребляет чрезмерные ресурсы. Следует соблюдать определенные меры предосторожности в следующих случаях.

-   Если предполагается, что размер размытия в клиентской области будет значительным, даже если в самой размытой области не произойдет никаких обновлений. Размытие должно быть подготовлено к просмотру в случае, если обновления происходят в непрозрачной области окна, что влечет за собой затраты на ЦП и GPU. Кроме того, операции с окнами в окне (перемещение, изменение размера и переходов) приводят к дополнительным затратам.
-   Если вы планируете значительные обновления в области размытого клиента, Это потребует перерисовки размытия при каждом обновлении и потребляет чрезмерные ресурсы.
-   Если размытие должно охватывать значительную область, а также ожидаются обновления в этой области, настоятельно рекомендуется не премыть клиентской области.

 

 