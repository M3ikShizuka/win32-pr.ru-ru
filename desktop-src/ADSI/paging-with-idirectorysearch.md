---
title: Подкачка с помощью IDirectorySearch
description: Подкачка указывает количество строк, возвращаемых сервером клиенту.
ms.assetid: cf4aa56a-c6f7-47c8-956d-512a5cffbf22
ms.tgt_platform: multiple
keywords:
- Подкачка с помощью IDirectorySearch ADSI
- ADSI, поиск, IDirectorySearch, другие параметры поиска, разбиение на страницы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48494c01831e6b69931fc6b6f779ed9b042b7fecaaf17fa62286c094a926ba73
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117838944"
---
# <a name="paging-with-idirectorysearch"></a>Подкачка с помощью IDirectorySearch

Подкачка указывает количество строк, возвращаемых сервером клиенту. Страница может быть определена числом строк или ограничением по времени. COM-объект ADSI извлекает каждую страницу результатов на основе значений, перечисленных в следующей таблице. Вызывающий объект вызывает [**IDirectorySearch:: GetNextRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getnextrow) , когда он достиг конца страницы, а COM-объект ADSI извлекает следующую страницу.



| Значение                                   | Описание                                                                                                                                                                                                                                          |
|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ADS \_ сеарчпреф \_ PAGESIZE**           | Указывает максимальное число строк, возвращаемых на странице.                                                                                                                                                                                            |
| **ADS \_ сеарчпреф \_ предел времени в выгружаемом страничном \_ периоде \_** | Указывает максимальное время в секундах, которое сервер должен тратить на сбор страниц результатов, прежде чем возвратить страницу клиенту. Если достигнут предел, сервер останавливает Поиск и возвращает строки, уже извлеченные для страницы. |



 

Если ни одно из этих параметров поиска не задано, по умолчанию используется значение без подкачки. Поиск Active Directory, выполненных без разбиения по страницам, ограничивается возвратом максимального числа первых 1000 записей, поэтому необходимо использовать страничный поиск, если существует вероятность того, что результирующий набор будет содержать более 1000 элементов.

Операция поиска может привести к возвращению большого количества объектов. Если сервер возвращает результат в одном наборе, он может снизить производительность клиента и сервера, а также повлиять на сетевую нагрузку. Чтобы предотвратить это, можно использовать страничные поисковые запросы. При поиске с постраничным поиском клиент может принимать результаты в меньшем объеме пакетов. Размер пакета называется размером страницы поиска.

Страничные поисковые запросы предлагают преимущества как клиенту, так и серверу. Клиент может более быстро реагировать на представление результатов для пользователей. Это особенно важно для графических средств пользовательского интерфейса, которые могут начать процесс вывода окна, пока другой поток одновременно получает данные.

На стороне сервера страничные поисковые запросы делают операцию масштабируемой. Например, если 100 Клиенты выдают запросы на поиск одновременно и, в среднем, каждый клиент получает 200 объектов. Если размер страницы не указан, в худшем случае сервер должен иметь достаточный объем памяти для хранения объектов 20 000. И наоборот, если каждый клиент указывает размер страницы, например десять объектов, потребность в памяти на сервере сокращается до 20.

Кроме того, с помощью страничного поиска клиент может отказаться от выполняемой операции. В отличие от этого, в нестраничном поиске клиент получает результирующий набор в одном пакете. Это может снизить производительность сети.

ADSI обрабатывает размер страницы для клиента. Клиенту не нужно подсчитывать количество выполняемых объектов. ADSI инкапсулирует взаимодействие сервера для клиента. С точки зрения клиента, поиск возвращает полный результирующий набор.

Рекомендуется использовать разбиение на страницы.

Чтобы указать максимальный размер страницы, задайте для параметра **поиска ADS \_ сеарчпреф \_ PAGESIZE** значение **адстипе \_ Integer** , равное максимальному количеству строк на страницу в массиве [**\_ \_ сведений об ADS сеарчпреф**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) , переданном в метод [**IDirectorySearch:: сетсеарчпреференце**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) .

В следующем примере кода показано, как задать максимальный размер страницы.


```C++
ADS_SEARCHPREF_INFO SearchPref;
SearchPref.dwSearchPref = ADS_SEARCHPREF_PAGESIZE;
SearchPref.vValue.dwType = ADSTYPE_INTEGER;
SearchPref.vValue.Integer = 1000;
```



Чтобы указать время страницы, задайте для параметра **поиска ADS \_ сеарчпреф \_ страничного \_ \_ ограничения по времени** с **\_ целочисленным значением адстипе** значение, равное максимальному числу секунд, которое сервер должен потратить на получение страницы в массиве [**\_ \_ сведений об ADS сеарчпреф**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) , переданном в метод [**IDirectorySearch:: сетсеарчпреференце**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) .

В следующем примере кода показано, как задать время страницы.


```C++
ADS_SEARCHPREF_INFO SearchPref;
SearchPref.dwSearchPref = ADS_SEARCHPREF_PAGED_TIME_LIMIT;
SearchPref.vValue.dwType = ADSTYPE_INTEGER;
SearchPref.vValue.Integer = 60;
```



 

 




