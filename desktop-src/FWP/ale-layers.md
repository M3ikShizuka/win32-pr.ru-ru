---
title: Уровни ALE
description: Принудительное применение уровня приложения (ALE) состоит из нескольких уровней фильтрации и многих соответствующих слоев отклонения.
ms.assetid: 3ac71787-2350-4a60-b0bf-b00b52d30b83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0a96e3b2ae5092bf8cca014eb3603eea5efe8f71
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104336924"
---
# <a name="ale-layers"></a>Уровни ALE

Принудительное применение уровня приложения (ALE) состоит из нескольких уровней фильтрации и многих соответствующих слоев отклонения. Все уровни механизма фильтрации Windows Filtering Platform (WFP), включая ALE, описаны в разделе [**Фильтрация идентификаторов слоев**](management-filtering-layer-identifiers-.md). Этот раздел содержит более подробное описание слоев фильтрации, которые являются частью ALE.

## <a name="resource_assignment"></a>\_Назначение ресурсов

Фильтр на уровне [**\_ \_ \_ назначения ресурсов ALE \_ \_ V {4 \| 6 для слоя фвпм**](management-filtering-layer-identifiers-.md) соответствует операциям сетевой привязки, явному или неявному.

Если фильтр на этом уровне совпадает с разрешающим созданием необработанного сокета, [**флаг условия FWP будет иметь значение \_ \_ \_ \_ необработанный флаг \_ конечной точки**](filtering-condition-flags-.md) .

Если фильтр на этом уровне соответствует запросу на получение неизбирательного режима, в поле [**\_ \_ \_ неизбирательного \_ режима FWP условия**](filtering-condition-identifiers-.md) будет установлено значение SIO \_ рквалл. Описание \_ РКВАЛЛ SIO см. в разделе [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl).

> [!Note]  
> Это единственный слой, в котором можно фильтровать неизбирательный режим.

 

Если во время **привязки ()** порт не указан, то есть для параметра Port задано значение 0 (ноль), то стек TCP/IP выберет порт из диапазона динамических портов (19152 – 65535). Выбранный порт будет классифицироваться в этом слое вместе с [**\_ флагом условия FWP \_ — флагом \_ \_ \_ привязки с подстановочным знаком**](filtering-condition-flags-.md) .

Если локальный адрес не указан в вызове [**BIND ()**](/windows/desktop/api/winsock/nf-winsock-bind) , в поле Локальный адрес устанавливается значение [**FWP \_ Empty**](/windows/desktop/api/Fwptypes/ne-fwptypes-fwp_data_type).

## <a name="auth_listen"></a>прослушивание проверки подлинности \_

Фильтр на уровне [**фвпм \_ \_ \_ проверки подлинности ALE уровня \_ \_ {4 \| 6}**](management-filtering-layer-identifiers-.md) соответствует фильтру для вызовов [**Listen ()**](/windows/desktop/api/winsock2/nf-winsock2-listen) TCP.

## <a name="auth_recv_accept"></a>АВТОРИЗАЦИя \_ recv \_ Accept

Фильтр на уровне [**фвпм \_ \_ \_ проверки подлинности \_ recv \_ Accept \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) сопоставлен с вызовами протокола TCP [**Accept ()**](/windows/desktop/api/winsock2/nf-winsock2-accept) , для первых UDP-пакетов (одноадресной рассылки) из уникального удаленного адреса или кортежа порта, а также для первых входящих сообщений ICMP, не являющихся ошибками (одноадресная рассылка) с уникальным типом ICMP, кодом и идентификатором.

> [!Note]  
> Протоколы, не являющиеся TCP или ICMP, обрабатываются как UDP.

 

TCP-пакеты, полученные необработанными сокетами, обрабатываются аналогично UDP-трафику. То есть фильтруется только первая отправка по протоколу TCP [**()**](/windows/desktop/api/winsock2/nf-winsock2-send) и первый протокол TCP [**recv ()**](/windows/desktop/api/winsock/nf-winsock-recv) через необработанные сокеты.

## <a name="auth_connect"></a>Проверка подлинности \_ подключения

Фильтр на уровне [**\_ \_ \_ подключения к проверке подлинности фвпм уровня \_ \_ {4 \| 6}**](management-filtering-layer-identifiers-.md) сопоставляется с вызовами TCP [**Connect ()**](/windows/desktop/api/winsock2/nf-winsock2-connect) для первых UDP-пакетов, отправленных на уникальный удаленный адрес и кортеж портов, а также для первых исходящих ICMP-сообщений с уникальным типом ICMP, кодом и идентификатором.

> [!Note]  
> Протоколы, не являющиеся TCP или ICMP, обрабатываются как UDP.

 

TCP-пакеты, отправляемые необработанными сокетами, обрабатываются аналогично UDP-трафику. То есть фильтруется только первая отправка по протоколу TCP [**()**](/windows/desktop/api/winsock2/nf-winsock2-send) и первый протокол TCP [**recv ()**](/windows/desktop/api/winsock/nf-winsock-recv) через необработанные сокеты.

## <a name="flow_established"></a>\_установленный поток

После успешного завершения 3-стороннего подтверждения TCP-порта для [**\_ потока ALE уровня фвпм, \_ установленного на уровне \_ \_ \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) , сопоставляется с фильтром. Для трафика, отличного от TCP, фильтр сопоставляется немедленно после того, как будут сопоставлены уровни **проверки подлинности \_ \_ Accept** или Authentication **\_ Connect** .

Фильтр на этом уровне не должен возвращать блок или разрешить.

Этот уровень используется драйверами выноски для отслеживания состояния подключения, подробно описанных в документации к [пакету драйверов Windows](/windows-hardware/drivers/network/windows-filtering-platform-callout-drivers2) .

## <a name="resource_release"></a>\_Выпуск ресурсов

После освобождения ресурсов, выделенных с помощью **\_ назначения ресурсов** , фильтр на уровне [**\_ \_ \_ ресурсов \_ Release \_ V {4 \| 6 для уровня фвпм**](management-filtering-layer-identifiers-.md) будет сопоставлен.

## <a name="endpoint_closure"></a>\_замыкание КОНЕЧНОЙ точки

Фильтр на уровне [**\_ \_ \_ замыкания конечной точки ALE уровня фвпм \_ \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) сопоставляется при закрытии ПОДКЛЮЧЕНной конечной точки TCP-потока или UDP-сокетов.

## <a name="connect_redirect"></a>Перенаправление подключений \_

Фильтр на уровне [**фвпм " \_ \_ \_ Connect \_ redirect \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) " позволяет изменять удаленные адреса и порты. Исходящее подключение будет перенаправляться на время этого соединения.

## <a name="bind_redirect"></a>Перенаправление привязки \_

Фильтр на уровне [**фвпм \_ BIND версии \_ \_ \_ \_ V {4 \| 6}**](management-filtering-layer-identifiers-.md) позволяет изменять локальный адрес и порты базового сокета. Локальный сокет будет перенаправлен на время существования сокета

## <a name="ale-discard-layers"></a>Слои отклонения ALE

Для каждого из уровней ALE, описанных выше, модуль фильтрации содержит соответствующий слой отклонения. Уровни отклонения ALE используются в целях ведения журнала. Пакеты и указания, которые были отклонены на одном из уровней фильтрации ALE, обозначаются соответствующим уровнем отклонения ALE.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Принудительное применение уровня приложения (ALE)](application-layer-enforcement--ale-.md)
</dt> <dt>

[Фильтрация с отслеживанием состояния ALE](ale-stateful-filtering.md)
</dt> <dt>

[Многоадресный или широковещательный трафик ALE](ale-multicast-broadcast-traffic.md)
</dt> <dt>

[Повторная авторизация ALE](ale-re-authorization.md)
</dt> <dt>

[Настройка потока ALE](ale-flow-customization.md)
</dt> <dt>

[Потоки TCP-пакетов](tcp-packet-flows.md)
</dt> <dt>

[Потоки UDP-пакетов](udp-packet-flows.md)
</dt> <dt>

[Функции Winsock](/windows/desktop/WinSock/winsock-functions)
</dt> <dt>

[**Флаги условия фильтрации**](filtering-condition-flags-.md)
</dt> <dt>

[**Условия фильтрации, доступные на каждом слое фильтрации**](filtering-conditions-available-at-each-filtering-layer.md)
</dt> </dl>

 

 