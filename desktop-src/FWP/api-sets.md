---
title: API WFP
description: API платформы фильтрации Windows (WFP) делится на следующие компоненты.
ms.assetid: ff3f0d74-7e0b-4a3e-b66d-eaa61b89038a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9eadbb3fb6383999b2bb8ef14c99ecb8beab3f88
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122470151"
---
# <a name="wfp-api"></a>API WFP

API платформы фильтрации Windows (WFP) делится на следующие компоненты.




| Компонент | Описание | Файлы заголовков | 
|-----------|-------------|--------------|
| <a href="/windows-hardware/drivers/ddi/_netvista/">API выноски</a> (фвпс) $ {Remove} $<br /> | <a href="/windows-hardware/drivers/ddi/_netvista/">Типы данных</a> , используемые в выносках. <strong>Примечание</strong> .  эти типы данных описаны в пакете sdk для Microsoft Windows Driver Kit (DDK).<br /> | <dl> фвпстипес. h<br />фвпстипес. idl<br /></dl> | 
| <a href="/windows-hardware/drivers/ddi/_netvista/">Функции</a> и <a href="/windows-hardware/drivers/ddi/_netvista/">перечислимые типы</a> , используемые для реализации вызовов. <strong>Примечание</strong>  .  Эти функции и перечислимые типы описаны в DDK.<br /> | <dl> фвпсу. h<br />фвпск. h<br /></dl> | 
| API IKE/AuthIP (IKEEXT) $ {Remove} $<br /> | <a href="fwp-enums.md">Перечислимые типы</a> и <a href="fwp-structs.md">структуры</a> , используемые для управления политиками IKE и политики основного режима AuthIP (mm) и сопоставлениями безопасности. | <dl> икетипес. h<br />икетипес. idl<br /></dl> | 
| <a href="fwp-ike-functions.md">Функции</a> , используемые для управления политикой и сопоставлениями безопасности IKE и AuthIP mm. | <dl> фвпму. h<br />фвпмк. h<br /></dl> | 
| API IPsec $ {Remove} $<br /> | <a href="fwp-enums.md">Перечислимые типы</a> и <a href="fwp-structs.md">структуры</a> , используемые для управления политиками IPSec и сопоставлениями безопасности. | <dl> ипсектипес. h<br />ипсектипес. idl<br /></dl> | 
| <a href="fwp-ipsec-functions.md">Функции</a> , используемые для управления политиками IPSec и сопоставлениями безопасности. | <dl> фвпму. h<br />фвпмк. h<br /></dl> | 
| API управления (ФВПМ) $ {Remove} $<br /> | <a href="fwp-enums.md">Перечислимые типы</a> и <a href="fwp-structs.md">структуры</a> , используемые для управления обработчиком фильтров. | <dl> фвпмтипес. h<br />фвпмтипес. idl<br /></dl> | 
| <a href="fwp-mgmt-functions.md">Функции</a> , используемые для управления обработчиком фильтров. Эти функции используются для выполнения следующих задач:<br /><ul><li>Установка и Фильтрация запросов, поставщиков и выносок.</li><li>Получение статистики IPsec.</li><li>настройте платформу фильтрации Windows.</li></ul> | <dl> фвпму. h<br />фвпмк. h<br /></dl> | 
| Общий API (FWP) | фундаментальные <a href="fwp-enums.md">перечислимые типы</a> и <a href="fwp-structs.md">структуры</a> , общие для платформы фильтрации Windows. | <dl> фвптипес. h<br />фвптипес. idl<br /></dl> | 




 

Имена типов данных — это все символы в верхнем регистре и знаки подчеркивания. Имя всегда начинается с префикса, определяющего свою группу компонентов, например [**фвпм \_ PROVIDER0**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_provider0).

Имена функций являются символами в смешанном регистре и регистром. Имя всегда начинается с префикса, определяющего свою группу компонентов, например [**FwpmProviderContextAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmprovidercontextadd0).

Большинство имен данных и функций заканчиваются номером версии. Файл заголовка фвпви. h сопоставляет независимые от версии данные и имена функций с версией, которая подходит для использования с данной операционной системой. Дополнительные сведения см. в разделе [имена Version-Independent WFP и нацеливание на конкретные версии Windows](wfp-version-independent-names-and-targeting-specific-versions-of-windows.md).

Каждый компонент не является изолированным. Например, политики IKE в основном режиме (MM) определяются в компоненте IKEEXT, но хранятся в контексте поставщика и связаны с фильтром, который находится в компоненте API ФВПМ.

## <a name="user-mode-and-kernel-mode-public-header-files"></a>Файлы общедоступных заголовков User-Mode и Kernel-Mode

Большинство функций WFP можно вызывать из пользовательского режима или режима ядра. Однако функции пользовательского режима возвращают значение **DWORD** , представляющее код ошибки Win32, тогда как функции режима ядра возвращают значение **NTSTATUS** , представляющее код состояния NT. В результате имена функций и семантика идентичны в пользовательском режиме и режиме ядра, но сигнатуры функций не являются. Для этого требуются отдельные заголовки, относящиеся к пользовательскому режиму и режиму ядра, для прототипов функций. Имена файлов заголовков пользовательского режима заканчиваются на "u", а имена файлов заголовков в режиме ядра заканчиваются на "k".

В следующей таблице перечислены файлы заголовков Win32, которые определяют функции WFP.

| Файлы заголовков | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| фвпмк. h      | Прототипы функций в режиме ядра для компонентов ФВПМ, IPsec и IKEEXT. Доступно только в DDK.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| фвпму. h      | Прототипы функций пользовательского режима для компонентов ФВПМ, IPsec и IKEEXT. доступно только в пакете Microsoft Windows Software Development Kit (SDK).                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| фвпск. h      | Прототипы функций и перечислимые типы для компонента ФВПС в режиме ядра. Доступно только в DDK.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| фвпсу. h      | Прототипы функций пользовательского режима и перечислимые типы для компонента ФВПС. доступно только в Windows SDK. **Примечание** .  Перечисляемые типы ФВПС в пользовательском режиме идентичны перечисленным типам ФВПС в режиме ядра. В итоге эти типы описаны только в DDK.<br/> **Примечание**  .  Прототипы функций ФВПС в пользовательском режиме идентичны прототипам функций ФВПС в режиме ядра, за исключением кода возврата. Функции ФВПС пользовательского режима возвращают **DWORD**, тогда как функции фвпс в режиме ядра возвращают **NTSTATUS**. В итоге эти функции описаны только в DDK.<br/> |



 

Все функции пользовательского режима экспортируются из fwpuclnt.dll. Все функции режима ядра экспортируются из fwpkclnt.sys.

### <a name="management-fwpm-and-callout-fwps-data-types"></a>Типы данных управления (ФВПМ) и выноски (ФВПС)

Большинство типов данных ФВПМ, которые используются для задач управления, таких как Добавление фильтров или выносок из приложения или драйвера, имеют аналоги ФВПС. Типы данных ФВПС используются во время фактической фильтрации сетевого трафика в контексте подпрограммы выноски для классификации.

Например, чтобы добавить фильтр к определенному слою механизма фильтрации, программист должен использовать тип ФВПМ, например: `filter.layerKey = FWPM_LAYER_INBOUND_IPPACKET` . Чтобы проверить, из какого слоя вызывается выноска, программист должен использовать соответствующий тип ФВПС: ` if (inFixedValues->layerId == FWPS_LAYER_INBOUND_IPPACKET)` .

Некоторые ФВПС аналоги с типами данных ФВПМ расширяют исходные типы данных ФВПМ. Например, чтобы добавить условие фильтра на многих уровнях механизма фильтрации, программист определяет `filterCondition.fieldKey = FWPM_CONDITION_IP_PROTOCOL` независимо от слоя механизма фильтрации. Чтобы найти значение условия фильтра, программист указывает тип ФВПС, относящийся к слою, например: `inFixedValues->incomingValue[FWPS_FIELD_ALE_FLOW_ESTABLISHED_V4_IP_PROTOCOL]` .

Типы данных ФВПС обычно меньше, чем их аналоги ФВПМ. Например, [**идентификаторы слоя фильтрации фвпм**](management-filtering-layer-identifiers-.md) — **GUID** s (16-bytes), в то время как [идентификаторы слоя фильтрации фвпс](/windows-hardware/drivers/network/management-filtering-layer-identifiers) — **UINT16** (16 бит). Меньший размер для типов данных ФВПС повышает производительность системы, так как сравнения целых чисел перевешивают сравнения **GUID** для трафика в режиме реального времени. Кроме того, память ядра используется эффективно, так как все типы ФВПС используются в ядре для управления фильтрами, в то время как типы ФВПМ хранятся в пользовательском режиме для управления различными слоями.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Объектная модель API WFP](object-model.md)
</dt> <dt>

[Управление объектами API WFP](object-management.md)
</dt> </dl>

