---
title: Конфигурация IPsec
description: Платформа фильтрации Windows (WFP) — это базовая платформа для брандмауэра Windows в повышенной безопасности.
ms.assetid: d54b5caa-daea-4231-9909-7a8d388df661
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78af8e3d0a23713c0505082555fe260bc562dfa4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "103987452"
---
# <a name="ipsec-configuration"></a>Конфигурация IPsec

Платформа фильтрации Windows (WFP) — это базовая платформа для брандмауэра Windows в повышенной безопасности. WFP используется для настройки правил фильтрации сети, в том числе правил, регулирующих защиту сетевого трафика с помощью IPsec. Разработчики приложений могут настроить IPsec напрямую с помощью API WFP, чтобы использовать более детализированную модель фильтрации сетевого трафика, чем модель, доступную через оснастку консоли управления (MMC) для брандмауэра Windows в режиме повышенной безопасности.

## <a name="what-is-ipsec"></a>Что такое IPsec

Internet Protocol Security (IPsec) — это набор протоколов безопасности, используемых для обеспечения конфиденциальности IP-пакетов по Интернету. Протокол IPsec обязателен для всех реализаций IPv6 и необязателен для IPv4.

В защищенном IP-трафике есть два дополнительных заголовка IPsec, которые указывают типы криптографической защиты, применяемые к пакету IP, и включают сведения для декодирования защищенного пакета.

Заголовок ESP используется для обеспечения конфиденциальности и защиты от вредоносных изменений путем выполнения проверки подлинности и дополнительного шифрования. Его можно использовать для трафика, который проходит через маршрутизаторы преобразования сетевых адресов (NAT).

Заголовок Authentication (AH) используется только для защиты от вредоносных изменений путем выполнения проверки подлинности. Его нельзя использовать для трафика, который проходит через маршрутизаторы NAT.

Дополнительные сведения о протоколе IPsec см. в разделе также:

<dl>

[Технический справочник по IPsec](/previous-versions/windows/it-pro/windows-server-2003/cc740240(v=ws.10))  
</dl>

## <a name="what-is-ike"></a>Что такое IKE

Протокол IKE (IKE) — это протокол обмена ключами, который является частью набора протоколов IPsec. IKE используется при настройке безопасного подключения и выполнении безопасного обмена секретными ключами и другими параметрами, связанными с защитой, без вмешательства пользователя.

Дополнительные сведения о IKE см. также в следующих статьях:

<dl>

[протокол IKE](/previous-versions/windows/it-pro/windows-server-2003/cc784994(v=ws.10))  
</dl>

## <a name="what-is-authip"></a>Что такое AuthIP

Протокол AuthIP — это новый протокол обмена ключами, который расширяет IKE следующим образом.

<dl> Хотя IKE поддерживает только учетные данные проверки подлинности компьютера, AuthIP также поддерживает:

-   Учетные данные пользователя: NTLM, Kerberos, сертификаты.
-   Сертификаты работоспособности защиты доступа к сети (NAP).
-   Анонимные учетные данные, используемые для дополнительной проверки подлинности.
-   Сочетание учетных данных; Например, сочетание учетных данных компьютера и пользователя Kerberos.

  
AuthIP использует механизм повторной проверки подлинности, который проверяет все настроенные методы проверки подлинности до сбоя подключения.  
AuthIP можно использовать с защищенными сокетами для реализации защищенного трафика IPsec на основе приложений. Консоль предоставляет следующие возможности:

-   Проверка подлинности и шифрование для каждого сокета. Дополнительные сведения см. в разделе [**всасетсоккетсекурити**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-wsasetsocketsecurity) .
-   Олицетворение клиента. (IPsec олицетворяет контекст безопасности, в котором создан сокет.)
-   Проверка имени входящей и исходящей одноранговых узлов. Дополнительные сведения см. в разделе [**всасетсоккетпиртаржетнаме**](/windows/desktop/api/ws2tcpip/nf-ws2tcpip-wsasetsocketpeertargetname) .

  
</dl>

Дополнительные сведения об AuthIP см. также в следующих статьях:

<dl>

[AuthIP в Windows Vista](https://www.microsoft.com/technet/community/columns/cableguy/cg0806.mspx)  
</dl>

## <a name="what-is-an-ipsec-policy"></a>Что такое политика IPsec

Политика IPsec — это набор правил, определяющих, какой тип IP-трафика должен быть защищен с помощью IPsec, и как защитить этот трафик. Только одна политика IPsec активна на одном компьютере.

Чтобы узнать больше о реализации политик IPsec, откройте оснастку MMC "Локальная политика безопасности" (secpol. msc), нажмите клавишу F1, чтобы открыть справку, а затем выберите Создание и использование политик IPsec в содержании.

Дополнительные сведения о политиках IPsec см. также в следующих статьях:

<dl>

[Обзор основных понятий политики IPsec](/previous-versions/windows/it-pro/windows-server-2003/cc776080(v=ws.10))  
[Описание политики IPsec](/previous-versions/windows/it-pro/windows-server-2003/cc781593(v=ws.10))  
</dl>

## <a name="how-to-use-wfp-to-configure-ipsec-policies"></a>Использование WFP для настройки политик IPsec

Реализация IPsec в корпорации Майкрософт использует платформу фильтрации Windows для настройки политик IPsec. Политики IPsec реализуются путем добавления фильтров на различных уровнях WFP следующим образом.

-   На слоях ФВПМ в версии \_ \_ \_ {4 \| 6} слоев добавляются фильтры, задающих политики согласования, используемые модулями ключей (IKE/AuthIP) во время обмена данными в основном режиме (mm). Методы проверки подлинности и криптографические алгоритмы указаны на этих уровнях.
-   На слоях ФВПМ \_ Layer \_ IPSec \_ V {4 \| 6} добавьте фильтры, задающих политики согласования, используемые модулями ключей во время обмена быстрым режимом (QM) и расширенного режима (EM). Заголовки IPsec (AH/ESP) и алгоритмы шифрования указаны на этих уровнях.

    Политика согласования указывается в качестве контекста поставщика политики, связанного с фильтром. Модуль ключа перечисляет контексты поставщика политики на основе характеристик трафика и получает политику, используемую для согласования безопасности.

    > [!Note]  
    > API WFP можно использовать для непосредственного указания сопоставлений безопасности (SAs) и, следовательно, для игнорирования политики согласования модуля создания ключей.

     

-   На слоях \_ фвпм \_ входящего \_ транспорта \_ v {4 \| 6} и фвпм \_ уровня " \_ исходящий \_ транспорт \_ v {4 \| 6}" добавьте фильтры, которые вызывают выноски, и определите, какой поток трафика следует защищать.
-   На уровне ФВПМ \_ \_ \_ проверки подлинности \_ recv \_ Accept \_ V {4 \| 6} слои добавляют фильтры, реализующие фильтрацию удостоверений и политику для каждого приложения.

На следующей схеме показано взаимодействие различных компонентов платформы WFP по отношению к операциям IPsec.![конфигурация IPSec с использованием платформы фильтрации Windows](images/ipsec-configuration.jpg)

После настройки IPsec она интегрируется с WFP и расширяет возможности фильтрации WFP, предоставляя сведения для использования в качестве условий фильтрации на уровнях авторизации уровня приложения (ALE). Например, IPsec предоставляет удаленный пользователь и удостоверение удаленного компьютера, что WFP предоставляет уровни авторизации ALE Connect и Accept. Эти сведения можно использовать для детальной авторизации удаленных удостоверений с помощью реализации брандмауэра на основе WFP.

Ниже приведен пример политики изоляции, которую можно реализовать с помощью IPsec:

-   ФВПМ \_ слоя \_ " \_ {4 \| 6} уровни" — Проверка подлинности Kerberos.
-   \_Уровни фвпм \_ IPSec \_ V {4 \| 6} слои — AH/SHA-1.
-   \_Уровень фвпм \_ входящего \_ транспорта \_ v {4 \| 6} и фвпм \_ уровня \_ исходящего \_ транспорта \_ v {4 \| 6} — Обнаружение согласований для всего сетевого трафика.
-   ФВПМ \_ уровня \_ \_ проверки подлинности \_ recv \_ Accept \_ V {4 \| 6} уровней: IPSec требуется для всего сетевого трафика.

## <a name="related-topics"></a>См. также

<dl> <dt>

**Уровни WFP**
</dt> <dt>

[**Фильтрация идентификаторов слоя**](management-filtering-layer-identifiers-.md)
</dt> <dt>

[Уровни ALE](ale-layers.md)
</dt> <dt>

**Сценарии политики IPsec, реализованные с помощью API WFP:**
</dt> <dt>

[транспортный режим](regular-transport-mode.md)
</dt> <dt>

[Транспортный режим обнаружения согласований](negotiation-discovery-transport-mode.md)
</dt> <dt>

[Транспортный режим обнаружения согласований в режиме границ](negotiation-discovery-transport-mode-in-boundary-mode.md)
</dt> <dt>

[Туннельный режим](tunnel-mode.md)
</dt> <dt>

[Гарантированное шифрование](guaranteed-encryption.md)
</dt> <dt>

[Удаленная авторизация идентификации](remote-identity-authorization.md)
</dt> <dt>

[SAs вручную IPsec](manual-ipsec-sas.md)
</dt> <dt>

[Исключения IKE/AuthIP](ike-exemptions.md)
</dt> <dt>

**Решения IPsec:**
</dt> <dt>

[Изоляция серверов и доменов](/previous-versions/windows/it-pro/windows-server-2003/cc776080(v=ws.10))
</dt> </dl>

 

 