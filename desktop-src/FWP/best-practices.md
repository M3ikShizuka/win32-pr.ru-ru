---
title: рекомендации (платформа фильтрации Windows)
description: следующий список содержит рекомендации по разработке приложений с помощью API платформы фильтрации Windows (WFP).
ms.assetid: 017ff210-8666-466e-8424-c95e750fd5ac
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e0ddb6038a9fe43070f1c16e545dbd7ac8929f3363fc88556aac391428175ea
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119069464"
---
# <a name="best-practices-windows-filtering-platform"></a>рекомендации (платформа фильтрации Windows)

следующий список содержит рекомендации по разработке приложений с помощью API платформы фильтрации Windows (WFP).

-   Используйте динамические сеансы.

    Многие приложения добавляют объекты политики фильтрации при запуске, а затем удаляют эти объекты по мере их завершения. Используя динамический сеанс, вы гарантируете, что эти объекты будут удалены даже в случае сбоя приложения. Более того, простое закрытие обработчика подсистемы на этапе «останавливается» является более эффективным, чем выполнение отдельных вызовов для удаления каждого объекта.

-   Либо обрабатывайте время ожидания транзакций, либо задайте для сеанса **ткснваиттимеаутинмсек** значение Infinite, чтобы предотвратить время ожидания.

    Даже если не используются явные транзакции, большинство вызовов все еще выполняются в неявной транзакции и, таким образом, могут истечет время ожидания.

-   Используйте явные транзакции для объединения связанных операций добавления или удаления в одну транзакцию.

    Это более эффективно и позволяет легко очищать частичные результаты по путям ошибок.

-   Используйте строки, совместимые с MUI.

    Все локализуемые строки хранятся в общей структуре данных: [**фвпм \_ отобразить \_ data0**](/windows/desktop/api/Fwptypes/ns-fwptypes-fwpm_display_data0). Строки в этой структуре могут быть непрямыми строками типа, поддерживаемого [**шлоадиндиректстринг**](/windows/win32/api/shlwapi/nf-shlwapi-shloadindirectstring). Перед возвратом структуры **фвпм \_ \_ data0** в любой из функций непрямые строки разрешаются в указанный строковый ресурс с помощью языкового стандарта вызывающего объекта.

-   Свяжите все объекты с поставщиком.

    Если в системе установлено несколько поставщиков, это упрощает средство диагностики для определения того, кто их добавил.

-   Добавьте фильтры в свой подслой.

    После попадания в подслоям завершающего фильтра не вычисляются дополнительные фильтры в этом подслое. Таким образом, при добавлении фильтров в тот же подуровень, что и другой поставщик, можно предотвратить вызов фильтров друг друга, что приведет к непредвиденным результатам.

-   Используйте принудительное применение уровня приложения (ALE), а не фильтрацию по пакетам.

    Фильтрация на уровне пакетов выполняется очень долго.

-   Фильтрация ошибок ICMP и событий RST перед их созданием.

    Это более эффективный способ фильтрации этих событий после их создания.

-   Выполнять проверку пакетов на уровне потокового или датаграмма, а не на транспортном уровне.

    Это относится к разработке выносок. дополнительные сведения см. в разделе [рекомендации по программированию драйвера выноски](/windows-hardware/drivers/network/callout-driver-programming-considerations) в Windows driver Kit (WDK).

-   При использовании сложных фильтров учитывайте влияние на производительность.

    начиная с Windows 7 и Windows Server 2008 R2, можно создавать фильтры с несколькими условиями, в которых используется один и тот же ключ поля. Это позволяет создавать сложные политики с меньшим количеством фильтров. Однако такие сложные фильтры могут привести к снижению производительности для классификации механизма фильтрации WFP. Необходимо выполнить оценку, чтобы определить, оказывает ли использование таких фильтров негативное влияние на общую производительность вашего решения.

 

 
