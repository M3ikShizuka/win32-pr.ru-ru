---
title: Транспортный режим обнаружения согласований в режиме границ
description: Режим транспорта обнаружения согласования в сценарии политики IPsec в режиме граничного режима запрашивает защиту режима транспорта IPsec для всего соответствующего трафика.
ms.assetid: 36ae74b3-30f5-49bd-8855-6f3c0fb04d70
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6b9f4168eee38165125c2455bc80dae29c1c6794
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104487704"
---
# <a name="negotiation-discovery-transport-mode-in-boundary-mode"></a>Транспортный режим обнаружения согласований в режиме границ

Режим транспорта обнаружения согласования в сценарии политики IPsec в режиме граничного режима запрашивает защиту режима транспорта IPsec для всего соответствующего трафика. В случае сбоя согласования IKE/AuthIP для входящих и исходящих соединений разрешается переход на незашифрованный текст.

Эта политика IPsec обычно используется на компьютерах, доступ к которым осуществляется на компьютерах с поддержкой IPsec и без IPsec.

Примером возможного режима транспорта обнаружения согласования является защита всего трафика одноадресных данных, за исключением ICMP, использование транспортного режима IPsec и Включение обнаружения согласований в режиме границ.

Чтобы реализовать этот пример программно, используйте следующую конфигурацию платформы WFP.

<dl>

**В ФВПМ \_ Layer \_ IKEEXT \_ V {4 \| 6} Настройка политики согласования mm**  

1.  Добавьте один или оба следующих контекста поставщика политики MM.  
    -   Для IKE — контекст поставщика политики типа ФВПМ \_ IPSec \_ IKE \_ mm \_ .
    -   Для AuthIP — контекст поставщика политики типа ФВПМ \_ IPSec \_ AuthIP \_ mm \_ .

    > [!Note]  
    > Будет согласовываться общий модуль ключа, и будет применена соответствующая политика MM. AuthIP — предпочтительный модуль создания ключей, если поддерживаются IKE и AuthIP.

     

2.  Для каждого контекста, добавленного на шаге 1, добавьте фильтр со следующими свойствами.
    | Свойство Filter        | Значение                                            |
    |------------------------|--------------------------------------------------|
    | Условия фильтрации   | Пустой. Весь трафик будет соответствовать фильтру.        |
    | **провидерконтексткэй** | Идентификатор GUID контекста поставщика MM, добавленного на шаге 1. |

        

**На уровне \_ фвпм \_ IPSec \_ V {4 \| 6} Настройка политики СОГЛАСОВАНия QM и EM**  

1.  Добавьте один или оба следующих контекста поставщика политики транспортного режима QM и установите флаг [**политики IPSec « \_ \_ \_ ND \_ периметра**](/windows/desktop/api/Ipsectypes/ns-ipsectypes-ipsec_transport_policy0) ».  
    -   Для IKE — контекст поставщика политики типа **фвпм \_ IPSec \_ IKE \_ QM \_ Transport \_**.
    -   Для AuthIP — контекст поставщика политики типа **фвпм \_ IPSec \_ AuthIP \_ QM \_ Transport \_**. Этот контекст может дополнительно содержать политику согласования расширенного режима AuthIP (EM).

    > [!Note]  
    > Будет выполнено согласование общего модуля ключа, и будет применена соответствующая политика QM. AuthIP — предпочтительный модуль создания ключей, если поддерживаются IKE и AuthIP.

     

2.  Для каждого контекста, добавленного на шаге 1, добавьте фильтр со следующими свойствами.
    | Свойство Filter        | Значение                                            |
    |------------------------|--------------------------------------------------|
    | Условия фильтрации   | Пустой. Весь трафик будет соответствовать фильтру.        |
    | **провидерконтексткэй** | Идентификатор GUID контекста поставщика QM, добавленного на шаге 1. |

        

**На уровне \_ фвпм \_ входящий \_ транспорт \_ V {4 \| 6} Настройка входящих правил фильтрации для каждого пакета**  

1.  Добавьте фильтр со следующими свойствами. 
    | Свойство Filter                                                   | Значение                                                                                              |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
    | **Фвпм \_ Условие \_ фильтрации \_ \_ \_ типа ЛОКАЛЬНОГО IP-адреса условия** | [нлатуникаст](/windows/win32/api/nldef/ne-nldef-nl_address_type)                                      |
    | **Action. Type**                                                   | **\_ \_ Завершение вызова действия \_ FWP**                                                              |
    | **Action. Каллауткэй**                                             | **ФВПМ \_ выноска \_ \_ входящего \_ транспорта IPSec \_ V {4 \| 6}**                                              |
    | **равконтекст**                                                    | [**\_Безопасность контекста фвпм \_ IPSec для \_ входящего \_ \_ подключения PERSIST \_**](filter-context-identifiers.md) |

        
2.  Исключите ICMP-трафик из IPsec, добавив фильтр со следующими свойствами.
    | Свойство Filter                                                   | Значение                                                                      |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------|
    | **Фвпм \_ Условие \_ фильтрации \_ \_ \_ типа ЛОКАЛЬНОГО IP-адреса условия** | нлатуникаст                                                                |
    | **Фвпм \_ Условие фильтрации \_ IP- \_ протокола условия**             | **Иппрото \_ ICMP {V6}** эти константы определены в Winsock2. h.<br/> |
    | **Action. Type**                                                   | \_разрешение действия \_ FWP                                                        |
    | **weight**                                                        | [**\_ \_ исключения IKE для диапазона веса \_ фвпм \_**](filter-weight-identifiers.md)  |

        

**На уровне \_ \_ исходящего \_ транспорта уровня фвпм \_ V {4 \| 6} Настройка правил фильтрации исходящих пакетов для каждого пакета**  

1.  Добавьте фильтр со следующими свойствами.
    | Свойство Filter                                                   | Значение                                                                                     |
    |-------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
    | **Фвпм \_ Условие \_ фильтрации \_ \_ \_ типа ЛОКАЛЬНОГО IP-адреса условия** | нлатуникаст                                                                               |
    | **Action. Type**                                                   | **\_ \_ Завершение вызова действия \_ FWP**                                                     |
    | **Action. Каллауткэй**                                             | **\_Исходящий транспорт IPSec для фвпм выноски \_ \_ \_ \_ V {4 \| 6}**                                    |
    | **равконтекст**                                                    | [**ФВПМ \_ контекст \_ IPSec для \_ исходящей \_ согласованности \_ обнаружения**](filter-context-identifiers.md) |

        
2.  Исключите ICMP-трафик из IPsec, добавив фильтр со следующими свойствами.
    | Свойство Filter                                                   | Значение                                                                      |
    |-------------------------------------------------------------------|----------------------------------------------------------------------------|
    | **Фвпм \_ Условие \_ фильтрации \_ \_ \_ типа ЛОКАЛЬНОГО IP-адреса условия** | нлатуникаст                                                                |
    | **Фвпм \_ Условие фильтрации \_ IP- \_ протокола условия**             | **Иппрото \_ ICMP {V6}** эти константы определены в Winsock2. h.<br/> |
    | **Action. Type**                                                   | **\_разрешение действия \_ FWP**                                                    |
    | **weight**                                                        | **\_ \_ исключения IKE для диапазона веса \_ фвпм \_**                                   |

        

</dl>

> [!Note]  
> В противоположность транспортному режиму обнаружения согласования для транспортного режима обнаружения согласования в политике режима границы нет необходимости добавлять фильтр на **уровне \_ фвпм \_ \_ проверки подлинности " \_ recv \_ Accept \_ V {4 \| 6}** ", так как эта политика разрешает входящие незащищенные соединения с открытым текстом.

 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Пример кода: использование транспортного режима](using-transport-mode.md)
</dt> <dt>

[Уровни ALE](ale-layers.md)
</dt> <dt>

[**Встроенные идентификаторы выноски**](built-in-callout-identifiers.md)
</dt> <dt>

[Условия фильтрации](filtering-conditions.md)
</dt> <dt>

[**Фильтрация идентификаторов слоя**](management-filtering-layer-identifiers-.md)
</dt> <dt>

[**ФВПМ \_ ACTION0**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_action0)
</dt> <dt>

[**\_ \_ тип контекста поставщика \_ фвпм**](/windows/desktop/api/Fwpmtypes/ne-fwpmtypes-fwpm_provider_context_type)
</dt> </dl>

 

