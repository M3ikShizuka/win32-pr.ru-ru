---
title: Фильтрация с отслеживанием состояния ALE
description: фильтры, установленные на уровнях применения уровня приложения (ALE) платформы фильтрации Windows (WFP), выполняют фильтрацию сети с отслеживанием состояния.
ms.assetid: d5a3fcad-d55e-4a07-af21-cb40e5e9a9ee
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ebbcb0517bb1e48c337f0ffd9589a1f39a3e4239aa0b3971dc81a71b402891f5
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119388914"
---
# <a name="ale-stateful-filtering"></a>Фильтрация с отслеживанием состояния ALE

фильтры, установленные на уровнях применения уровня приложения (ALE) платформы фильтрации Windows (WFP), выполняют фильтрацию сети с отслеживанием состояния. В качестве базиса для фильтрации с отслеживанием состояния ALE используется *поток ALE* .

Поток ALE — это способ классификации сетевого трафика путем его группирования на основе IP-адреса источника, IP-адреса назначения, исходного порта, порта назначения и протокола. Поток ALE может быть универсальным, то есть один или несколько дескрипторов могут сопоставлять все (или подстановочные знаки \* ). Например, универсальный поток ALE UDP будет описываться как исходный IP-адрес = \* , конечный IP-адрес = \* , исходный порт = \* , порт назначения = \* и протокол UDP.

После авторизации подключения (входящие подключения разрешаются на уровне [**\_ \_ проверки подлинности на уровне фвпм уровня \_ \_ \_ \_ {4 \| 6}**](management-filtering-layer-identifiers-.md) и исходящих подключений на уровне **\_ \_ \_ проверки подлинности ALE версии \_ \_ {4 \| 6} уровня фвпм** ) создается поток Ale, что позволяет автоматически разрешать изменение политики, все пакеты, входящие и исходящие, которые принадлежат одному потоку Ale. Так как изменение политики может потребовать блокирования ранее разрешенных подключений, потоки ALE [должны быть переработаны при изменении политики](ale-re-authorization.md) .

Фильтрация с отслеживанием состояния ALE значительно сокращает количество необходимых классификаций, классификация только первого пакета, принадлежащего потоку ALE. При сравнении Фильтрация без отслеживания состояния требует классификации каждого пакета, который проходит по сети.

Поток ALE имеет связанное направление, которое является направлением первого пакета потока. Это позволяет более гибким политикам, разрешая входящим подключениям, имеющим различные политики от исходящих инициированных подключений.

## <a name="tcp-ale-flow"></a>Flow ALE TCP

Поток ALE для трафика TCP определяется пятью кортежами TCP/IP (исходный IP-адрес, IP-адрес назначения, исходный порт, порт назначения и протокол).

Поток ALE TCP имеет такое же время существования, как и подключенный TCP-сокет. Подключенный TCP-сокет может быть либо сокетом, созданным с помощью [**Connect ()**](/windows/desktop/api/winsock2/nf-winsock2-connect) , либо сокетом, созданным в результате вызова [**Accept ()**](/windows/desktop/api/winsock2/nf-winsock2-accept) .

ALE поддерживает связь "один к одному" между потоком TCP ALE и управляющим блоком TCP (TCB).

## <a name="udp-ale-flow"></a>Flow ALE UDP

> [!Note]  
> Протоколы, не являющиеся TCP или ICMP, обрабатываются как UDP.

 

Поток ALE для UDP-трафика определяется пятью кортежами TCP/IP (исходный IP-адрес, IP-адрес назначения, исходный порт, порт назначения и протокол).

Поток ALE UDP создается на основе сокета UDP и представляет удаленный одноранговый узел, с которым взаимодействует приложение. Удаленный узел определяется кортежем (IP-адрес назначения и порт назначения).

Между сокетом UDP и удаленными одноранговыми узлами, к которым он обращается, существует связь «один ко многим».

При закрытии локального UDP-сокета все связанные с ним потоки ALE будут удалены.

При отсутствии замыканий сокетов одноадресные потоки ALE UDP имеют [настраиваемое](ale-flow-customization.md) время ожидания простоя, которое по умолчанию составляет 60 секунд. Если в этом окне не отправляются или не принимаются пакеты, поток ALE будет удален. Это время ожидания по умолчанию постепенно сокращается, когда количество потоков ALE уровня системы достигает определенного порогового значения.

## <a name="icmp-ale-flow"></a>Flow ALE ICMP

Поток ALE для ICMP-трафика определяется шестью кортежами (исходным IP-адресом, IP-адресом назначения, типом ICMP, кодом ICMP, протоколом и ИДЕНТИФИКАТОРом ICMP). Идентификатор ICMP является частью потока ALE только для трафика эхо/Reply ICMP.

В случае отсутствия замыканий сокета потоки одноадресных ALE ICMP имеют [настраиваемое](ale-flow-customization.md) время ожидания простоя, которое по умолчанию составляет 60 секунд. Если в этом окне не отправляются или не принимаются пакеты, поток ALE будет удален. Это время ожидания по умолчанию постепенно сокращается, когда количество потоков ALE уровня системы достигает определенного порогового значения.

На уровни ALE выводятся только сообщения ICMP без ошибок. Сообщения об ошибках ICMP можно проверить на \_ уровнях ошибок ICMP.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Принудительное применение уровня приложения (ALE)](application-layer-enforcement--ale-.md)
</dt> <dt>

[Уровни ALE](ale-layers.md)
</dt> <dt>

[Многоадресный или широковещательный трафик ALE](ale-multicast-broadcast-traffic.md)
</dt> <dt>

[Повторная авторизация ALE](ale-re-authorization.md)
</dt> <dt>

[настройка Flow ALE](ale-flow-customization.md)
</dt> <dt>

[Потоки TCP-пакетов](tcp-packet-flows.md)
</dt> <dt>

[Потоки UDP-пакетов](udp-packet-flows.md)
</dt> <dt>

[Функции Winsock](/windows/desktop/WinSock/winsock-functions)
</dt> </dl>

 

 