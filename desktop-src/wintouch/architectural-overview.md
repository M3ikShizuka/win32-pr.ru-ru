---
title: Основные сведения об архитектуре
description: В этом обзоре архитектуры представлен контекст для API сенсорного ввода Windows для технологий планшета и сенсорного ввода и объясняется, как он подходит для более крупной архитектуры Windows 7.
ms.assetid: b284e96f-0998-408c-ae84-92a3acdc3014
keywords:
- Windows Touch, обзор архитектуры
- Касание Windows, манипуляции
- Касание Windows, сообщения
- Касание Windows, инерция
- Касание Windows, жесты
- жесты, сведения
- манипуляции, о
- инерция, сведения
- процессор манипуляции, обзор архитектуры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b807113211d77f0aad0ed01fc24570d033063474
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987526"
---
# <a name="architectural-overview"></a>Основные сведения об архитектуре

В этом обзоре архитектуры представлен контекст для API сенсорного ввода Windows для технологий планшета и сенсорного ввода и объясняется, как он подходит для более крупной архитектуры Windows 7.

## <a name="messages-for-windows-touch-input-and-gestures"></a>Сообщения для сенсорного ввода и жестов Windows

Функции обмена сообщениями для Windows Touch включены путем прослушивания и интерпретации сообщений во время выполнения. На следующем рисунке показано, как сообщения формируются из оборудования и отправляются в приложения Windows 7.

![Иллюстрация, показывающая, как Windows 7 отправляет сообщения от оборудования Мультисенсорная в приложение](images/wm-multitouch-messaging.png)

В крайнем левом столбце иллюстрации сенсорно-чувствительное оборудование получает входные данные от пользователя. Затем драйвер взаимодействует между оборудованием и операционной системой. Затем ОС создает сообщение [**\_ жеста**](wm-gesture.md) [**WM \_ Touch**](wm-touchdown.md) или WM, которое затем отправляется в HWND приложения. Затем приложение обновляет пользовательский интерфейс, учитывая сведения, инкапсулированные в сообщении.

По умолчанию приложения получают жесты. Если приложение не регистрирует входные сообщения касания Windows с помощью функции [**регистертаучвиндов**](/windows/desktop/api/winuser/nf-winuser-registertouchwindow) , уведомления для жестов ([**сообщения \_ жестов WM**](wm-gesture.md) ) создаются Windows и отправляются в это окно приложения. Если окно приложения регистрируется для получения сенсорных сообщений, уведомления для сенсорного ввода Windows (сообщения [**\_ сенсорного экрана WM**](wm-touchdown.md) ) отправляются в это окно приложения. Сообщения касания и жестов Windows являются жадными в том смысле, что после совершения касания или начала работы над окном приложения все сообщения отправляются в это приложение до тех пор, пока жест не завершится или не будет выполнено основное касание.

Для поддержки прежних версий Windows интерпретирует [**сообщения \_ жестов WM**](wm-gesture.md) , если они были собраны, а затем отправляют или разписывают соответствующие сообщения, сопоставленные с этим жестом. Чтобы избежать нарушения поддержки устаревшей версии, убедитесь, что вы пересылаете \_ сообщения ЖЕСТОВ WM с помощью [дефвиндовпрок](/windows/win32/api/winuser/nf-winuser-defwindowproca). Дополнительные сведения о поддержке устаревших версий можно найти в разделе [Общие сведения о сенсорных жестах Windows](windows-touch-gestures-overview.md).

## <a name="manipulations-and-inertia"></a>Манипуляции и инерция

Программисты Windows Touch должны уметь интерпретировать жесты из нескольких источников способом, который имеет смысл для жеста. Корпорация Майкрософт предоставляет API манипуляции для выполнения этих вычислений. Манипуляции — это фактические жесты со связанными с ними значениями, описывающими весь жест. После подключения входных данных к обработчику манипуляции можно получить сведения, относящиеся к действиям, которые пользователь делает с объектом. На следующем рисунке показан один из способов использования манипуляций.

![Иллюстрация, показывающая сообщения Windows Touch, переданные обработчику манипуляции объекта, который обрабатывает события с помощью \- интерфейса иманипулатионевентс](images/manipulation-arch.png)

В верхнем левом углу экрана пользователь затронул экран, который создает сенсорные сообщения. Эти сообщения содержат координаты x и y-координаты, используемые для определения объекта, наданного фокус. Объект в фокусе содержит обработчик манипуляции. Затем в сообщении [**WM \_ Touch**](wm-touchdown.md) с флагом **таучевентф \_ up** выбирается объект в фокусе пользователя, выполняется ссылка на обработчик манипуляций, а сообщение отправляется обработчику манипуляции. Последующие сообщения **WM \_ Touch** , связанные с этим контактом, отправляются в обработчик манипуляции до тех пор, пока не будет получено сообщение **WM \_ Touch** с флагом **таучевентф \_ up** , а выбранный объект не является разыменованным. В нижней правой части иллюстрации показан приемник событий манипуляции, реализующий интерфейс [**\_ иманипулатионевентс**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) , для обработки событий манипуляции, которые вызываются во время создания сенсорных сообщений. Приемник событий может выполнять обновления интерфейса на основе событий манипуляции во время их возникновения.

В приложениях Windows Touch можно реализовать простую физику, чтобы объекты плавно приступили к прекращению, а не внезапно останавливаться, когда они больше не затрагиваются. Корпорация Майкрософт предоставляет API инерции для выполнения вычислений для этой простой физикы, что позволяет приложению работать так же, как и другие приложения. Это также экономит усилия, необходимые для создания надежных физических функций. На следующем рисунке показано, как можно использовать инерцию.

![Иллюстрация, демонстрирующая передачу сообщений Windows Touch в интерфейс IInertiaProcessor объекта, который вызывает события с помощью \- интерфейса иманипулатионевентс](images/inertia-arch.png)

Обратите внимание на сходства между инерцией и манипуляцией. Единственное различие между ними заключается в том, что в случае инерции интерпретируемые сообщения передаются в Процессор инерции, а не в обработчик манипуляции, и обработчик инерции создает события. В верхнем левом углу экрана в сообщении [**WM \_ Touch**](wm-touchdown.md) с флагом **таучевентф \_ up** сообщения Touch используются для обозначения объекта в фокусе, который содержит процессор инерции и обработчик манипуляции. Последующие сообщения **WM \_ Touch** отправляются в обработчик манипуляций, а обработчик манипуляции ВЫПОЛНЯЕТ обновления пользовательского интерфейса приложения. После завершения манипуляции значения скорости из манипуляции используются для настройки процессора инерции. Как показано в среднем столбце, метод [**Process**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-process) или [**процесстиме**](/windows/desktop/api/manipulations/nf-manipulations-iinertiaprocessor-processtime) вызывается в интерфейсе [**IInertiaProcessor**](/windows/desktop/api/manipulations/nn-manipulations-iinertiaprocessor) с помощью таймера или другого цикла в отдельном потоке, пока вызовы не указывают, что процессор завершает обработку. Хотя эти вызовы выполняются, создаются события манипуляции, которые обрабатываются приемником событий манипуляции на основе интерфейса [**\_ иманипулатионевентс**](/windows/win32/api/manipulations/nn-manipulations-_imanipulationevents) . В нижней правой части иллюстрации этот приемник событий выполняет обновления пользовательского интерфейса приложения на основе событий манипуляции, когда они происходят через обработчики событий в приемнике событий.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Руководство по программированию](programming-guide.md)
</dt> </dl>

 

 