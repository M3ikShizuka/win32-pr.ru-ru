---
title: Редакторы на базе сторонних методов ввода
description: Редакторы на базе сторонних методов ввода
ms.assetid: 7FFD7210-2335-4499-A36A-ACFAECEB01F9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cca9768de96b9dcdeac7f4b0da210f7aa788801b
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "104570591"
---
# <a name="third-party-input-method-editors"></a>Редакторы на базе сторонних методов ввода

## <a name="platforms"></a>Платформы

**Клиенты** — Windows 8  
**Серверы** — Windows Server 2012  


## <a name="description"></a>Описание

Редакторы методов ввода (IME) — это программные компоненты, позволяющие пользователю вводить текст на языке, который содержит больше символов, чем может быть представлено на клавиатуре. (Это распространенный, но не ограниченный Восточно-азиатский язык.) Вместо каждого отдельного символа, появляющегося в одном ключе, пользователи могут вводить сочетания клавиш, которые затем обрабатываются редактором IME. Редактор IME создает символ, соответствующий набору клавиш, иногда предоставляя пользователю список возможных символов для выбора, а затем вставляет этот символ в окно управления редактированием пользовательского приложения.

В прошлом Windows позволяла сторонним программам IME работать в системе Windows, и эта возможность будет продолжаться для Windows 8. Пользователи могут установить сторонний редактор IME и использовать его. Кроме того, мы работаем над системой и процессами для предотвращения вредоносных редакторов IME, повышения безопасности и улучшения взаимодействия с пользователем.

В Windows 8 вы увидите:

-   Поддержка IME сторонних производителей для аппаратных и сенсорных клавиатур
-   Сторонние поставщики IME должны следовать рекомендациям корпорации Майкрософт по разработке редакторов IME для Windows 8.
-   Сторонние редакторы IME должны иметь цифровую подпись
-   Сторонние редакторы IME должны поддерживать платформу текстовых служб (TSF), и для правильной работы в Windows 8 должны быть настроены правильные флаги IME
-   Сторонние редакторы IME могут работать в настольных приложениях, но будут заблокированы в приложениях для Магазина Windows
-   Сторонние редакторы IME могут использовать раскладку сенсорной клавиатуры, предоставляемую Windows, для связывания IME, чтобы пользователи могли использовать редактор IME с сенсорными клавиатурами. Однако некоторые функции редакторов IME для сенсорных клавиатур не будут доступны сторонним редакторам IME.
-   Защитник Windows удалит вредоносные редакторы IME из системы Windows

## <a name="manifestation"></a>Проявление

**Изменения языка ввода и переключения метода ввода**

Вместо отображения всех значков режима IME вместе со значком фирменной символики IME отображается только один значок режима IME вместе со значком фирменной символики IME. На двух рисунках ниже показано всплывающее меню ввода Windows 8 и всплывающее меню IME с японским IME в качестве текущего метода ввода. Если щелкнуть значок фирменной символики IME, можно переключить методы ввода.

![переключить методы ввода](images/inputindicator2.png)

Если щелкнуть значок режима IME, можно переключиться в другой режим IME.

![Переключение режимов IME](images/inputindicator1.png)

Если редактор IME использует языковую панель для отображения значков своего режима в Windows 7, необходимо изменить редактор IME, чтобы отображать значок фирменной символики и значок режима в индикаторе ввода в Windows 8.

> [!Note]  
> Примечание. сведения о том, как редактор IME может отображать значок фирменной символики и значок режима в Систрай на панели задач настольных систем, будут задокументированы и опубликованы в соответствии с рекомендациями редактора IME для Windows 8.

 

**Новая среда Windows**

Среда в Windows 8 изменяет альбом для IME. Основные понятия приложений Магазина Windows, контейнеров локальных контекстных приложений и ограничений API в редакторах IME отсутствовали в Windows 7. Некоторые существующие редакторы IME для Windows 7 перестают отвечать на запросы при запуске в приложении для Магазина Windows и поэтому не позволяют выполнять прежние IME в приложениях для Магазина Windows. Кроме того, убедитесь, что новые версии IME проверены, чтобы убедиться, что они совместимы с новой средой пользовательского интерфейса, прежде чем они будут запускаться в приложениях для Магазина Windows.

## <a name="mitigation"></a>Меры по снижению риска

В системе можно использовать совместимый с настольной системой редактор IME. Это может быть лучшим вариантом, если вы в основном используете классические приложения, и вы хотите продолжить использовать предпочтительный Старый редактор IME для входных данных. Рекомендуется использовать редактор IME для Windows 8 и не использовать устаревшие или несертифицированные редакторы IME. Уведомления предоставляются как с помощью CPL языка, так и с помощью входного параметра, чтобы предупредить вас о влиянии использования IME, совместимого с рабочим столом.

Если совместимый с настольной системой IME не работает в вашей системе, вы увидите любое из приведенных ниже вариантов поведения.

-   В пользовательском интерфейсе языковой панели отображаются метки IME, совместимые с рабочим столом, и отображается сообщение о том, что несовместимые редакторы IME работают только в классических приложениях.
-   Всплывающее окно ввода закрывает редакторы IME, совместимые с рабочим столом, когда пользователь находится в приложениях для Магазина Windows. Это означает, что редактор IME не работает в этом приложении. (На настольных компьютерах редакторы IME, совместимые с настольными системами, не затенены). Если вы перейдете в приложение для Магазина Windows, используя несовместимый редактор IME, и не знаете, что IME отключен, используйте индикатор ввода, чтобы изменить редактор IME, совместимый с приложениями Магазина Windows.

Прежние или настольные совместимые редакторы IME ограничены следующими условиями:

-   Обновление Windows 7 до Windows 8 с помощью сторонних редакторов IME в системе
-   Поставщик не выпустил версию, совместимую с Windows 8, и пользователь пытается использовать существующую версию Windows 7.

## <a name="solution"></a>Решение

**Общие сведения**

Используйте существующую инфраструктуру текстовых служб (TSF), чтобы реализовать логику IME и стандартные элементы управления для приложений Магазина Windows для пользовательских интерфейсов. Создайте собственные окна для размещения пользовательского интерфейса.

Добавляются новые API поиска для улучшения прогнозирования поиска и обеспечения возможности поиска в пользовательском интерфейсе.

Кроме того, добавляются API, уведомляющие сторонние редакторы IME при вызове сенсорной клавиатуры для защиты пользовательского интерфейса от сенсорной клавиатуры. Для сторонних редакторов IME автоматически загружается макет классической сенсорной клавиатуры по умолчанию. Для интеграции с классической накладкой сенсорной клавиатуры не требуется дополнительная работа. Тем не менее, сторонние редакторы IME смогут запрашивать альтернативный макет касания.

Ознакомьтесь с рекомендациями по IME для Windows 8, чтобы вы могли повысить основные принципы работы пользователей приложений Магазина Windows в IME. Редакторы IME, которые соответствуют рекомендациям, должны установить флаг, указывающий, что редактор IME совместим с Microsoft Design. Windows 8 блокирует запуск всех настольных совместимых редакторов IME в приложениях для Магазина Windows.

Цифровые подписи, помимо отзыва в Защитнике Windows, предотвращают установку вредоносных редакторов IME в системе Windows 8. После проверки личности цифровая подпись редактора IME для стороннего разработчика имеет цифровую подписывание. Только редакторы IME с этой цифровой подписью можно установить в систему, не выполняя пользовательское предупреждающее сообщение. Пользователи могут сообщать о вредоносных редакторах IME. После того как редактор IME был определен как вредоносный, защитник Windows удаляет его из системы Windows.

**инфраструктуры текстовых служб (TSF)**

Чтобы иметь возможность работать в Windows 8, редактор IME должен быть совместим с TSF. Windows 8 блокирует выполнение редакторов IME, не поддерживающих TSF, в приложениях для Магазина Windows. При запуске приложения TSF загружает редактор IME. dll для IME, выбранного пользователем в процессе приложения.

> [!Note]  
> Чтобы предоставить отдельные функциональные возможности или пользовательские интерфейсы для приложений Магазина Windows и классических приложений, Библиотека. dll, загруженная TSF, может проверить, в какой тип приложения он загружается. Редактор IME вызывает метод [итфсреадмгрекс:: жетактивефлагс](/windows/win32/api/msctf/nf-msctf-itfthreadmgrex-getactiveflags) и проверяет \_ флаг TF ТМФ \_ иммерсивемоде и может активировать другую логику приложения в зависимости от результата.

 

Когда редактор IME загружается в приложение Магазина Windows, он подчиняется тем же ограничениям контейнеров приложений, что и само приложение. Такое поведение гарантирует, что редакторы IME не смогут нарушать контракты безопасности приложений Магазина Windows, несмотря на наличие доступа к пакету SDK для настольных систем (поскольку они не распространяются или не сертифицированы магазином Windows). Некоторые функции, выполняемые редактором IME в настоящее время, затрагиваются внутри контейнера приложения. К этим функциям относятся:

-   Файлы словарей
-   Обновление через Интернет
-   Обучение на лету
-   Обмен информацией между процессами

Дополнительные сведения см. в руководстве по редактору IME для Windows 8.

Прежние версии IME не работают в приложениях для Магазина Windows, чтобы избежать возможных проблем с пользовательским интерфейсом, включая System остановке. Редакторы IME, совместимые с приложениями Магазина Windows, должны самостоятельно объявляться путем установки флага, указывающего на совместимость. Этот флаг предоставляется TSF в \_ структуре TF инпутпроцессорпрофиле. Сведения о том, как использовать этот флаг для объявления редактора IME стороннего производителя в качестве совместимого с приложениями Магазина Windows, будет документирован и опубликован в соответствии с рекомендациями редактора IME для Windows 8.

Редакторы IME, совместимые с приложениями Магазина Windows, могут работать в настольных приложениях или приложениях Магазина Windows. Несовместимые методы IME могут выполняться только в рабочих процессах.

**Пользовательский интерфейс**

Хотя сторонние редакторы IME имеют доступ к интерфейсам API окон рабочего стола, они должны следовать тем же ограничениям API окна, что и приложение, в котором они выполняются. Например, редактор IME не может рисовать поверх приложения для Магазина Windows, пока активно в классическом приложении. Ограничения API предназначены для предотвращения следующих сценариев:

-   Классические приложения, принимающие фокус из приложений Магазина Windows
-   Приложения для настольных приложений, нарисованные в магазине Windows
-   Классические приложения, мешающие приложениям Магазина Windows

**Поддержка сенсорной клавиатуры**

Хотя поддержка сенсорной клавиатуры (ТКБ) по-прежнему доступна сторонним поставщикам IME, полностью настраиваемая и Интегрированная сенсорная клавиатура не предоставляется в Windows 8. Однако редакторы IME сторонних разработчиков могут сопоставлять свои редакторы IME с раскладкой клавиатуры, оптимизированной для сенсорного ввода. Панель программного ввода Windows (SIP) по умолчанию предоставляет классическую раскладку клавиатуры для редакторов IME сторонних разработчиков. Так как классическая клавиатура создает ключевые события аналогично тому, как работает аппаратная клавиатура, в настоящее время нет специальных требований к реализации IME для работы с сенсорной клавиатурой. Обработка ввода для аппаратных ключевых событий также будет обрабатывать ключевые события из классических сенсорных раскладок.

> [!Note]  
> Примечание. редакторам IME может потребоваться начать обработку событий ввода в Юникоде, если поддержка ТКБ расширена и включает оптимизированные раскладки клавиатуры.

 

Сторонний редактор IME может использовать оптимизированную раскладку клавиатуры для своего редактора IME. Дополнительные сведения см. в статье Руководство по IME для сторонних разработчиков.

Убедитесь, что пользовательский интерфейс панели кандидатов (и другие элементы пользовательского интерфейса) не нарисован под сенсорной клавиатурой. В большинстве случаев приложение должно изменить размер окна, чтобы учитывать сенсорную клавиатуру. Однако если приложение не делает этого, редакторы IME по-прежнему могут использовать API Инпутпанефрамеворк для изучения расположения сенсорной клавиатуры. Сторонние редакторы IME могут использовать этот API для получения экранного пространства, занятого сенсорной клавиатурой, до отображения потенциальных (или других) интерфейсов пользователя и перекомпоновки пользовательского интерфейса, чтобы избежать прорисовки под сенсорной клавиатурой.

**Поиск**

В Windows 8 приложения из Магазина Windows могут легко предоставлять пользователям функции поиска, реализуя [контракт поиска](/previous-versions/windows/apps/hh464906(v=win.10)) и интеграцию с панелью поиска. Панель поиска — это центральное расположение, в котором пользователи могут выполнять поиск по всем приложениям. Windows помогает приложениям, использующим панель поиска, получать пользователей там, где они хотят, как можно быстрее. В частности, для пользователей IME он предоставляет уникальный интерфейс поиска, позволяющий совместимым редакторам IME интегрироваться с Windows 8 для повышения эффективности и удобства использования.

Редактор IME совместим с интегрированными возможностями поиска, если он соответствует следующим критериям:

-   Совместим с средой приложений для Магазина Windows
-   Реализует API режима Уилесс для TFS
-   Реализует API-интерфейсы интеграции поиска TFS:
-   -   итфсеарчкандидатепровидер
    -   итфсеарчхардварекэйбоардбехавиорс

При активации на панели поиска совместимый редактор IME помещается в режим Уилесс и не может отобразить пользовательский интерфейс. Вместо этого он отправляет кандидатам преобразования в Windows, которые затем будут отображаться в элементе управления списка кандидатов.

Редактор IME также отправляет кандидаты Windows, которые должны использоваться для выполнения текущего поиска: эти кандидаты могут быть такими же, как кандидаты на преобразование, или могут быть адаптированы для поиска. Хорошие кандидаты поиска отвечают следующим критериям:

-   Без перекрытия префикса
-   Нет кандидата на прогнозирование (только завершение)

Редакторы IME, которые не соответствуют критериям и не совместимы с поиском, отображаются так же, как и в других элементах управления приложениями Магазина Windows, и не могут использовать преимущества интеграции пользовательского интерфейса и кандидатов поиска. (Приложения получают запросы только после завершения составления пользователем.)

Когда приложение, поддерживающее контракт поиска, получает запрос, событие запроса будет включать в себя массив "Куеритексталтернативес", содержащий все известные варианты, от наиболее актуального (вероятнее всего) до наименьшего значения (маловероятно). Всякий раз, когда предоставлены альтернативные варианты, приложение должно обрабатывать каждую альтернативу как запрос и возвращать все результаты, соответствующие любым альтернативным вариантам (как если бы пользователь выдавал несколько запросов одновременно), по сути, выполнив запрос "или" к службе, предоставляющей результаты. Для повышения производительности приложения часто ограничивают соответствие 10 наиболее релевантным альтернативам.

**Цифровая подпись IME**

Все сторонние редакторы IME должны иметь цифровую подпись, чтобы их можно было установить в систему Windows 8 в качестве редактора IME. С помощью SmartScreen пользователи могут видеть предупреждающее сообщение при скачивании неподписанного IME из Интернета. Чтобы получить сертификат и подписать файлы, выполните следующие действия.

-   **Использование подписи Authenticode для цифровой подписи программ**
    -   Получите допустимый сертификат для подписи кода Authenticode от одного из многих центров сертификации, поддерживаемых Windows.
    -   Использование средств разработки (например, [signtool.exe](../seccrypto/signtool.md)) для подписывания приложений перед распространением
    -   Дополнительные сведения и пошаговое описание процесса подписывания кода см. в разделе записи блога [о подписывании кода Authenticode](/archive/blogs/ieinternals/everything-you-need-to-know-about-authenticode-code-signing) .
-   **Обеспечение того, что загрузки не обнаруживаются как вредоносные**
    -   Загруженные программы, которые были обнаружены и подтверждены как вредоносная программа, влияют на репутацию загрузки и репутацию цифрового сертификата, используемого для подписи этого файла.
-   **Применить к сертификации Windows**
    -   Посетите страницу сертификации приложений Windows на сайте MSDN

Дополнительные сведения см. в следующих статьях о цифровых подписях и подписывания кода.

-   [Общие сведения о Authenticode](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537359(v=vs.85))
-   [Обеспечение целостности и подлинности](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85))
-   [Рекомендации по подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85))
-   [Что такое цифровые сертификаты?](/previous-versions/office/developer/office2000/aa190113(v=office.10))

Если редактор IME **не** подписан, пользователь получает это предупреждающее сообщение при попытке загрузить IME:

![сообщение IME не подписано предупреждением](images/downloadwarning02-fhu-ivu.png)

Если редактор IME подписан, пользователи видят это сообщение:

![IME — сообщение с подписью](images/downloadwarning01-fhu-vcu.png)

На основе этих уведомлений пользователи могут выбрать, следует ли удалить файл или пропустить предупреждение и запустить загруженную программу.

**Отзыв IME**

Редакторы IME, которые являются вредоносными или не соответствуют рекомендациям IME для Windows 8, могут быть удалены из системы с помощью защитника Windows. Дополнительные сведения о вредоносных редакторах IME см. в статье, посвященной [сторонним редакторам IME в Windows 8](/previous-versions/windows/apps/hh967426(v=win.10)).

## <a name="resources"></a>Ресурсы

-   [Метод Итфсреадмгрекс:: Get Active flags](/windows/win32/api/msctf/nf-msctf-itfthreadmgrex-getactiveflags)
-   [SignTool](../seccrypto/signtool.md)
-   [Все, что необходимо знать о подписывании кода Authenticode](https://blogs.msdn.com/b/ieinternals/archive/2011/03/22/authenticode-code-signing-for-developers-for-file-downloads-building-smartscreen-application-reputation.aspx)
-   [Контракты и расширения приложений Windows](/previous-versions/windows/apps/hh464906(v=win.10))
-   [Требования к сертификации для классических приложений Windows 8](../win_cert/certification-requirements-for-windows-desktop-apps.md)
-   [Требования к сертификации для приложений Windows](https://msdn.microsoft.com/library/windows/apps/51A7C609-94AB-49ab-B8E0-F26FF776DDB4.aspx)
-   [Использование комплекта сертификации приложений для Windows](../win_cert/using-the-windows-app-certification-kit.md)
-   [Общие сведения о Authenticode](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537359(v=vs.85))
-   [Обеспечение целостности и подлинности](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85)#Ensuring_Integrity_a)
-   [Рекомендации по подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85))
-   [Что такое цифровые сертификаты?](/previous-versions/office/developer/office2000/aa190113(v=office.10))

 

 