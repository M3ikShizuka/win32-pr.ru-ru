---
title: Редакторы на базе сторонних методов ввода
description: Редакторы на базе сторонних методов ввода
ms.assetid: 7FFD7210-2335-4499-A36A-ACFAECEB01F9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 64e12b2c2788ed95509b785dd7fc2c5ba3ec0a31ac46a736bc7dfdc92c7289f1
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119815125"
---
# <a name="third-party-input-method-editors"></a>Редакторы на базе сторонних методов ввода

## <a name="platforms"></a>Платформы

**клиенты** — Windows 8  
**серверы** — Windows Server 2012  


## <a name="description"></a>Описание

Редакторы методов ввода (IME) — это программные компоненты, позволяющие пользователю вводить текст на языке, который содержит больше символов, чем может быть представлено на клавиатуре. (Это распространенный, но не ограниченный Восточно-азиатский язык.) Вместо каждого отдельного символа, появляющегося в одном ключе, пользователи могут вводить сочетания клавиш, которые затем обрабатываются редактором IME. Редактор IME создает символ, соответствующий набору клавиш, иногда предоставляя пользователю список возможных символов для выбора, а затем вставляет этот символ в окно управления редактированием пользовательского приложения.

в прошлом Windows позволяли использовать сторонние редакторы ime в системе Windows, и эта возможность будет продолжаться для Windows 8. Пользователи могут установить сторонний редактор IME и использовать его. Кроме того, мы работаем над системой и процессами для предотвращения вредоносных редакторов IME, повышения безопасности и улучшения взаимодействия с пользователем.

в Windows 8 вы увидите:

-   Поддержка IME сторонних производителей для аппаратных и сенсорных клавиатур
-   Сторонние поставщики IME должны следовать рекомендациям корпорации Майкрософт по разработке редакторов IME для Windows 8
-   Сторонние редакторы IME должны иметь цифровую подпись
-   Сторонние редакторы IME должны поддерживать платформу текстовых служб (TSF), а правильные флаги IME должны быть настроены для правильной работы в Windows 8
-   старые сторонние редакторы ime смогут работать в настольных приложениях, но будут заблокированы в приложениях Windows Store.
-   сторонние редакторы ime могут использовать раскладку сенсорной клавиатуры, предоставляемую Windows, чтобы связать их ime, чтобы пользователи могли использовать редактор ime с сенсорными клавиатурами. Однако некоторые функции редакторов IME для сенсорных клавиатур не будут доступны сторонним редакторам IME.
-   Защитник Windows удалит вредоносные редакторы ime из системы Windows

## <a name="manifestation"></a>Проявление

**Изменения языка ввода и переключения метода ввода**

Вместо отображения всех значков режима IME вместе со значком фирменной символики IME отображается только один значок режима IME вместе со значком фирменной символики IME. на двух рисунках ниже показан всплывающий элемент ввода Windows 8 и всплывающее меню ime с японским ime в качестве текущего метода ввода. Если щелкнуть значок фирменной символики IME, можно переключить методы ввода.

![переключить методы ввода](images/inputindicator2.png)

Если щелкнуть значок режима IME, можно переключиться в другой режим IME.

![Переключение режимов IME](images/inputindicator1.png)

если редактор ime использует языковую панель для отображения значков в режиме Windows 7, необходимо изменить редактор IME, чтобы отображать значок фирменной символики и значок режима в индикаторе ввода в Windows 8.

> [!Note]  
> примечание. сведения о том, как редактор IME может отображать значок фирменной символики и значок режима в систрай на панели задач настольных систем, будут задокументированы и опубликованы в соответствии с рекомендациями по Windows 8 IME.

 

**новая среда Windows**

среда в Windows 8 изменяет альбом для редакторов ime. основные понятия о приложениях Windows Store, контейнерах локальных контекстных приложений и ограничениях API для ime отсутствовали в Windows 7. некоторые существующие редакторы ime Windows 7 перестают отвечать на запросы при запуске в приложении для хранения Windows и поэтому не позволяют выполнять прежние ime в приложениях Windows store. кроме того, убедитесь, что новые версии ime проверены, чтобы убедиться, что они совместимы с новой средой пользовательского интерфейса, прежде чем они будут запускаться в приложениях Windows Store.

## <a name="mitigation"></a>Меры по снижению риска

В системе можно использовать совместимый с настольной системой редактор IME. Это может быть лучшим вариантом, если вы в основном используете классические приложения, и вы хотите продолжить использовать предпочтительный Старый редактор IME для входных данных. рекомендуется использовать Windows 8 ime и не использовать устаревшие или несертифицированные редакторы ime. Уведомления предоставляются как с помощью CPL языка, так и с помощью входного параметра, чтобы предупредить вас о влиянии использования IME, совместимого с рабочим столом.

Если совместимый с настольной системой IME не работает в вашей системе, вы увидите любое из приведенных ниже вариантов поведения.

-   В пользовательском интерфейсе языковой панели отображаются метки IME, совместимые с рабочим столом, и отображается сообщение о том, что несовместимые редакторы IME работают только в классических приложениях.
-   всплывающее окно ввода закрывает редакторы ime, совместимые с рабочим столом, когда пользователь находится в Windows приложений магазина. Это означает, что редактор IME не работает в этом приложении. (На настольных компьютерах редакторы IME, совместимые с настольными системами, не затенены). если вы переключились на Windows приложения магазина с несовместимым ime и не знаете, что ime отключен, используйте индикатор ввода, чтобы изменить редактор ime, совместимый с приложениями магазина Windows.

Прежние или настольные совместимые редакторы IME ограничены следующими условиями:

-   обновление с Windows 7 до Windows 8 с помощью редакторов ime сторонних разработчиков в системе
-   поставщик не выпустил версию, совместимую с Windows 8, и пользователь пытается использовать имеющуюся версию Windows 7.

## <a name="solution"></a>Решение

**Общие**

используйте существующую инфраструктуру текстовых служб (TSF), чтобы реализовать логику IME и стандартные элементы управления для приложений хранилища Windows для пользовательских интерфейсов. Создайте собственные окна для размещения пользовательского интерфейса.

Добавляются новые API поиска для улучшения прогнозирования поиска и обеспечения возможности поиска в пользовательском интерфейсе.

Кроме того, добавляются API, уведомляющие сторонние редакторы IME при вызове сенсорной клавиатуры для защиты пользовательского интерфейса от сенсорной клавиатуры. Для сторонних редакторов IME автоматически загружается макет классической сенсорной клавиатуры по умолчанию. Для интеграции с классической накладкой сенсорной клавиатуры не требуется дополнительная работа. Тем не менее, сторонние редакторы IME смогут запрашивать альтернативный макет касания.

ознакомьтесь с рекомендациями по Windows 8 IME, чтобы вы могли продвинуть основные Windows принципов взаимодействия пользователей с приложениями в редакторе ime. Редакторы IME, которые соответствуют рекомендациям, должны установить флаг, указывающий, что редактор IME совместим с Microsoft Design. Windows 8 блокирует запуск всех совместимых с настольными системами ime в приложениях Windows Store.

цифровая подпись, помимо отзыва по Защитник Windows, предотвращает установку вредоносных редакторов ime в систему Windows 8. При проверке удостоверения .dll стороннего редактора IME имеет цифровую подпись. Только редакторы IME с этой цифровой подписью можно установить в систему, не выполняя пользовательское предупреждающее сообщение. Пользователи могут сообщать о вредоносных редакторах IME. после того как редактор IME был определен как вредоносный, Защитник Windows удаляет его из системы Windows.

**инфраструктуры текстовых служб (TSF)**

Для выполнения в Windows 8 редактор IME должен быть совместим с TSF. Windows 8 блокирует выполнение редакторов ime, не поддерживающих TSF, в приложениях для магазина Windows. При запуске приложения TSF загружает .dll IME для IME, выбранного пользователем в процессе приложения.

> [!Note]  
> чтобы предоставить отдельные функциональные возможности или пользовательские интерфейсы для приложений магазина Windows и классических приложений, .dll, загруженные TSF, могут проверить тип приложения, в который он загружается. Редактор IME вызывает метод [итфсреадмгрекс:: жетактивефлагс](/windows/win32/api/msctf/nf-msctf-itfthreadmgrex-getactiveflags) и проверяет \_ флаг TF ТМФ \_ иммерсивемоде и может активировать другую логику приложения в зависимости от результата.

 

когда редактор IME загружается в приложение магазина Windows, он подчиняется тем же ограничениям контейнеров приложений, что и само приложение. такое поведение гарантирует, что редакторы ime не смогут нарушать Windows хранения контрактов безопасности приложений, несмотря на наличие доступа к пакету SDK для настольных систем (поскольку они не распространяются или не сертифицированы хранилищем Windows). Некоторые функции, выполняемые редактором IME в настоящее время, затрагиваются внутри контейнера приложения. К этим функциям относятся:

-   Файлы словарей
-   Обновление через Интернет
-   Обучение на лету
-   Обмен информацией между процессами

дополнительные сведения см. в руководстве по Windows 8 IME.

устаревшие редакторы ime не работают в приложениях Windows Store, чтобы избежать возможных проблем с пользовательским интерфейсом, включая system остановке. редакторы ime, совместимые с приложениями для магазина Windows, должны самостоятельно объявляться путем установки флага, указывающего на совместимость. Этот флаг предоставляется TSF в \_ структуре TF инпутпроцессорпрофиле. сведения об использовании этого флага для объявления стороннего редактора IME, так как совместимые с приложением Windows Store, будут документированы и опубликованы в документации по Windows 8 IME.

редакторы ime, совместимые с приложениями Windows store, разрешено запускать в классических приложениях или приложениях для магазина Windows. Несовместимые методы IME могут выполняться только в рабочих процессах.

**Пользовательский интерфейс**

Хотя сторонние редакторы IME имеют доступ к интерфейсам API окон рабочего стола, они должны следовать тем же ограничениям API окна, что и приложение, в котором они выполняются. например, редактор IME не может рисовать поверх приложения Windows Store, пока активно в классическом приложении. Ограничения API предназначены для предотвращения следующих сценариев:

-   классические приложения, принимающие фокус от приложений Windows Store
-   создание классических приложений в приложении Windows Store
-   классические приложения, мешающие приложениям магазина Windows

**Поддержка сенсорной клавиатуры**

Хотя поддержка сенсорной клавиатуры (ТКБ) по-прежнему доступна сторонним поставщикам IME, полностью настраиваемая и Интегрированная сенсорная клавиатура не предоставляется в Windows 8. Однако редакторы IME сторонних разработчиков могут сопоставлять свои редакторы IME с раскладкой клавиатуры, оптимизированной для сенсорного ввода. Windows мягкая панель ввода (SIP) по умолчанию предоставляет классическую раскладку клавиатуры для редакторов ime сторонних разработчиков. Так как классическая клавиатура создает ключевые события аналогично тому, как работает аппаратная клавиатура, в настоящее время нет специальных требований к реализации IME для работы с сенсорной клавиатурой. Обработка ввода для аппаратных ключевых событий также будет обрабатывать ключевые события из классических сенсорных раскладок.

> [!Note]  
> Примечание. редакторам IME может потребоваться начать обработку событий ввода в Юникоде, если поддержка ТКБ расширена и включает оптимизированные раскладки клавиатуры.

 

Сторонний редактор IME может использовать оптимизированную раскладку клавиатуры для своего редактора IME. Дополнительные сведения см. в статье Руководство по IME для сторонних разработчиков.

Убедитесь, что пользовательский интерфейс панели кандидатов (и другие элементы пользовательского интерфейса) не нарисован под сенсорной клавиатурой. В большинстве случаев приложение должно изменить размер окна, чтобы учитывать сенсорную клавиатуру. Однако если приложение не делает этого, редакторы IME по-прежнему могут использовать API Инпутпанефрамеворк для изучения расположения сенсорной клавиатуры. Сторонние редакторы IME могут использовать этот API для получения экранного пространства, занятого сенсорной клавиатурой, до отображения потенциальных (или других) интерфейсов пользователя и перекомпоновки пользовательского интерфейса, чтобы избежать прорисовки под сенсорной клавиатурой.

**Поиск**

в Windows 8 приложения для магазина Windows могут легко предоставить пользователям функции поиска, реализовав [контракт поиска](/previous-versions/windows/apps/hh464906(v=win.10)) и интеграцию с панелью поиска. Панель поиска — это центральное расположение, в котором пользователи могут выполнять поиск по всем приложениям. Windows помогает приложениям, использующим панель поиска, получать пользователей там, где они хотят, как можно быстрее. в частности, для пользователей IME он предоставляет уникальный интерфейс поиска, позволяющий совместимым редакторам ime интегрироваться с Windows 8 для повышения эффективности и удобства использования.

Редактор IME совместим с интегрированными возможностями поиска, если он соответствует следующим критериям:

-   совместим с средой приложений для магазина Windows
-   Реализует API режима Уилесс для TFS
-   Реализует API-интерфейсы интеграции поиска TFS:
-   -   итфсеарчкандидатепровидер
    -   итфсеарчхардварекэйбоардбехавиорс

При активации на панели поиска совместимый редактор IME помещается в режим Уилесс и не может отобразить пользовательский интерфейс. вместо этого он отправляет кандидаты на преобразование в Windows, которые затем будут отображаться в элементе управления списка кандидатов.

редактор IME также отправляет Windows кандидатов, которые должны использоваться для выполнения текущего поиска: эти кандидаты могут быть такими же, как кандидаты на преобразование, или могут быть адаптированы для поиска. Хорошие кандидаты поиска отвечают следующим критериям:

-   Без перекрытия префикса
-   Нет кандидата на прогнозирование (только завершение)

редакторы ime, не соответствующие критериям и несовместимые с поиском, отображаются так же, как и в других Windows элементы управления приложениями магазина и не могут использовать преимущества интеграции пользовательского интерфейса и кандидатов поиска. (Приложения получают запросы только после завершения составления пользователем.)

Когда приложение, поддерживающее контракт поиска, получает запрос, событие запроса будет включать в себя массив "Куеритексталтернативес", содержащий все известные варианты, от наиболее актуального (вероятнее всего) до наименьшего значения (маловероятно). Всякий раз, когда предоставлены альтернативные варианты, приложение должно обрабатывать каждую альтернативу как запрос и возвращать все результаты, соответствующие любым альтернативным вариантам (как если бы пользователь выдавал несколько запросов одновременно), по сути, выполнив запрос "или" к службе, предоставляющей результаты. Для повышения производительности приложения часто ограничивают соответствие 10 наиболее релевантным альтернативам.

**Цифровая подпись IME**

все сторонние редакторы ime должны иметь цифровую подпись, чтобы их можно было установить в систему Windows 8 в качестве редактора IME. С помощью SmartScreen пользователи могут видеть предупреждающее сообщение при скачивании неподписанного IME из Интернета. Чтобы получить сертификат и подписать файлы, выполните следующие действия.

-   **Использование подписи Authenticode для цифровой подписи программ**
    -   Получите допустимый сертификат для подписи кода Authenticode от одного из многих центров сертификации, поддерживаемых Windows
    -   Использование средств разработки (например, [signtool.exe](../seccrypto/signtool.md)) для подписывания приложений перед распространением
    -   Дополнительные сведения и пошаговое описание процесса подписывания кода см. в разделе записи блога [о подписывании кода Authenticode](/archive/blogs/ieinternals/everything-you-need-to-know-about-authenticode-code-signing) .
-   **Обеспечение того, что загрузки не обнаруживаются как вредоносные**
    -   Загруженные программы, которые были обнаружены и подтверждены как вредоносная программа, влияют на репутацию загрузки и репутацию цифрового сертификата, используемого для подписи этого файла.
-   **применить к Windows сертификации**
    -   посетите страницу сертификации Windows приложений на сайте MSDN

Дополнительные сведения см. в следующих статьях о цифровых подписях и подписывания кода.

-   [Общие сведения о Authenticode](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537359(v=vs.85))
-   [Обеспечение целостности и подлинности](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85))
-   [Рекомендации по подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85))
-   [Что такое цифровые сертификаты?](/previous-versions/office/developer/office2000/aa190113(v=office.10))

Если редактор IME **не** подписан, пользователь получает это предупреждающее сообщение при попытке загрузить IME:

![сообщение IME не подписано предупреждением](images/downloadwarning02-fhu-ivu.png)

Если редактор IME подписан, пользователи видят это сообщение:

![IME — сообщение с подписью](images/downloadwarning01-fhu-vcu.png)

На основе этих уведомлений пользователи могут выбрать, следует ли удалить файл или пропустить предупреждение и запустить загруженную программу.

**Отзыв IME**

редакторы ime, которые являются вредоносными или не соответствуют правилам Windows 8 IME, могут быть удалены из системы с помощью Защитник Windows. Дополнительные сведения о вредоносных редакторах IME см. в статье, посвященной [сторонним редакторам IME в Windows 8](/previous-versions/windows/apps/hh967426(v=win.10)).

## <a name="resources"></a>Ресурсы

-   [Метод Итфсреадмгрекс:: Get Active flags](/windows/win32/api/msctf/nf-msctf-itfthreadmgrex-getactiveflags)
-   [SignTool](../seccrypto/signtool.md)
-   [Все, что необходимо знать о подписывании кода Authenticode](https://blogs.msdn.com/b/ieinternals/archive/2011/03/22/authenticode-code-signing-for-developers-for-file-downloads-building-smartscreen-application-reputation.aspx)
-   [контракты и расширения Windows приложений](/previous-versions/windows/apps/hh464906(v=win.10))
-   [требования к сертификации для классических приложений Windows 8](../win_cert/certification-requirements-for-windows-desktop-apps.md)
-   [требования к сертификации для приложений Windows](https://msdn.microsoft.com/library/windows/apps/51A7C609-94AB-49ab-B8E0-F26FF776DDB4.aspx)
-   [Использование комплекта сертификации приложений для Windows](../win_cert/using-the-windows-app-certification-kit.md)
-   [Общие сведения о Authenticode](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537359(v=vs.85))
-   [Обеспечение целостности и подлинности](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85)#Ensuring_Integrity_a)
-   [Рекомендации по подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85))
-   [Что такое цифровые сертификаты?](/previous-versions/office/developer/office2000/aa190113(v=office.10))

 

 