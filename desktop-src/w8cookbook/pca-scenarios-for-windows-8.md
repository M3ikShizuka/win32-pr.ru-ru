---
title: Сценарии помощника по совместимости программ для Windows 8
description: Сценарии помощника по совместимости программ для Windows 8
ms.assetid: C61BF746-63EE-4F4E-81D3-52947FD4954D
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1ebada2ca5115d24f260808a1c9ae899963184a8
ms.sourcegitcommit: ee06501cc29132927ade9813e0888aaa4decc487
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2021
ms.locfileid: "104553902"
---
# <a name="program-compatibility-assistant-scenarios-for-windows-8"></a>Сценарии помощника по совместимости программ для Windows 8

## <a name="platforms"></a>Платформы

**Клиенты** — Windows XP Windows Vista, Windows \| \| 7 \|  

## <a name="description"></a>Описание

Помощник по совместимости программ (PCA) — это функция Windows 8, которая позволяет конечным пользователям запускать классические приложения, предназначенные для более ранних версий Windows. Windows 8 обладает отличной встроенной совместимостью приложений, благодаря которой приложения, разработанные для Windows 7 или более ранних версий Windows, могут работать отлично в Windows 8 автоматически. Однако существует небольшое количество приложений, которые могут иметь неприятное выполнение без вмешательства пользователя.

Когда пользователь запускает приложение, PCA отслеживает это приложение и определяет симптомы некоторых известных проблем совместимости в Windows 8. При обнаружении каких-либо проблем она предоставляет пользователю возможность применить рекомендуемое исправление, которое поможет лучше запустить приложение в Windows 8.

## <a name="scenarios"></a>Сценарии

PCA отслеживает приложения для набора известных проблем совместимости в Windows 8. PCA отслеживает проблемы, определяет исправления и предоставляет пользователю диалоговое окно с инструкциями по применению рекомендуемого исправления. Пользователь может принять решение о применении рекомендуемых исправлений или не предпринимать никаких действий и отменить рекомендации. Если пользователь отменяет действие, PCA больше не будет отслеживанию этого приложения.

PCA обычно использует один из трех режимов совместимости Windows: Windows XP SP3, Windows Vista SP2 или Windows 7 в зависимости от того, когда была создана программа (или ее программа установки). PCA использует атрибуты " \_ Дата ссылки" и "версия подсистемы" программы, а также разделы TRUSTINFO и COMPATIBILITY манифеста исполняемого файла, чтобы определить, какой режим является релевантным и применяет Windows XP SP3 (включая права администратора), Windows Vista с пакетом обновления 2 (SP2) или Windows 7 соответственно. Глоссарий в конце документа содержит список всех режимов совместимости, которые применяют PCA, и его описание.

Для всех сценариев, перечисленных ниже, PCA отслеживает приложения еще раз после применения исправления. Если приложение по-разному завершается с ошибкой даже после применения исправления совместимости, PCA восстанавливает исправление. PCA будет постоянно прекращать отслеживание конкретного приложения, которое завершилось сбоем.

Хотя PCA отслеживает множество потенциальных проблем, не все проблемы могут вызвать сбои приложений. PCA рекомендует исправлять исправления только в тех случаях, когда существует высокая вероятность сбоя приложения из-за совместимости с Windows. В следующих разделах разворачиваются все сценарии PCA, разработанные в Windows 8. В каждом разделе описан сценарий проблемы и рекомендации, предоставляемые PCA, позволяющие приложению правильно работать в Windows 8.

Дополнительные сведения об изменениях совместимости в Windows 8 см. в других разделах, посвященных *Cookbook совместимости с Windows 8*.

В сценариях, которые PCA отслеживает и рекомендует устранять исправления:

-   Не удается установить или удалить приложение
-   Не удается запустить приложение с сообщением проверки версии Windows
-   Не удается запустить приложение из-за прав администратора
-   Сбои приложений из-за конкретных проблем с памятью
-   Сбой приложения из-за несоответствия системных файлов
-   Сбой приложения из-за необработанных ошибок в 64-разрядной версии Windows
-   Сбой приложения при попытке удаления защищенных файлов, отличных от Windows
-   Сбой приложения при попытке изменить файлы Windows
-   Сбой приложения из-за использования 8-или 16-разрядных цветовых режимов
-   Сбой приложения из-за графики и отображение проблем
-   Приложению не удалось объявить сведения о DPI
-   Сбой приложения из-за отсутствия компонентов Windows
-   Сбой приложения из-за неподписанных драйверов в 64-разрядной версии Windows 8
-   Приложения отслеживания, установленные с помощью параметров совместимости
-   Приложению не удается запустить установщики или средства обновления
-   Установщики приложений, которые должны запускаться с правами администратора
-   Устаревшие приложения панели управления, которые должны запускаться с правами администратора

Каждый из этих сценариев раскрывается следующим образом:

**Не удается установить или удалить приложение**

Один из наиболее распространенных типов сбоев приложения происходит во время установки приложения. Более старые программы установки обычно завершаются сбоем двумя способами:

-   Программа установки не имеет информации о функциях контроля учетных записей (UAC) в Windows 8, поэтому она может не работать с полными привилегиями, необходимыми для внесения изменений в защищенные области Windows 8.
-   Программа установки проверяет версию Windows и блокирует ее выполнение, если версия выше, чем она ожидает.

Эти условия сбоя являются двумя наиболее распространенными типами сбоев совместимости в программе установки. PCA с помощью различных компонентов Windows, таких как UAC, обнаруживает программы установки при запуске и отслеживает их до конца установки. Если программе установки не удается добавить файлы или добавить допустимую запись в компоненте "Установка и удаление программ" панели управления Windows, PCA считает, что установка завершилась неудачно.

В этом случае PCA рекомендует режим совместимости, подходящий для приложения. Режим совместимости позволяет программе установки запускаться в режиме Windows, предназначенном для, а также обеспечивает запуск приложения с правами администратора. PCA применяет режим совместимости RUNASADMIN вместе с соответствующим режимом совместимости Windows XP, Windows Vista или Windows 7. Пользователь, в конце неудачной установки, увидит диалоговое окно с рекомендацией PCA:

![приложению не удается установить или удалить диалоговое окно](images/pcafigure1.png)

Затем пользователь может выбрать:

-   Запустите программу, используя параметры совместимости (рекомендуемый параметр), после чего PCA применит рекомендуемый параметр (режим совместимости), перезапустите программу установки и отследите, пока установка завершится успешно.
-   Укажите, что программа установлена правильно, в этом случае PCA не будет добавлять никаких параметров и будет перестанет отслеживать установку.
-   Нажмите кнопку Закрыть. в этом случае PCA не будет добавлять никаких параметров и будет перестанет отслеживать эту настройку.

Тот же механизм используется для удаления приложения, когда пользователь пытается удалить приложение из раздела "Установка и удаление программ" в Windows или из ярлыка программы удаления приложения.

**Не удается запустить приложение с сообщением проверки версии Windows**

Одна из наиболее распространенных ошибок совместимости в среде выполнения приложения связана с продолжением проверки версии Windows. Многие приложения при запуске Проверьте версию Windows. Если они не распознают версию, они блокируют себя даже в том случае, если приложение могло работать без проблем.

Как правило, такие проверки связаны с двумя условиями, которые отслеживаются PCA:

Приложение отображает окно сообщения, которое предупреждает пользователя. Ниже приведен пример.

![не удается запустить приложение с диалоговым окном сообщения проверки версии Windows](images/pcafigure2.png)

-   Приложение завершается немедленно или аварийно завершается

Если PCA определяет оба этих условия для приложения, он предоставит рекомендации пользователю. PCA позволит пользователю повторно запустить приложение с параметрами совместимости. PCA будет применять соответствующий режим совместимости Windows XP, Windows Vista или Windows 7 на основе приложения. Как и в любом из сценариев, пользователь может сообщить PCA о том, что приложение работало правильно, или отказаться от рекомендуемых параметров, нажав кнопку Закрыть. Ниже приведен пример диалогового окна.

![не удается запустить приложение в диалоговом окне параметров сообщения о проверке версии Windows](images/pcafigure3.png)

**Не удается запустить или запустить приложение из-за прав администратора**

Некоторым приложениям требуются права администратора для запуска и выполнения их функциональности. Однако в Windows 8, как и в Windows 7 и Windows Vista, приложения работают на более низких уровнях привилегий по умолчанию из-за контроля учетных записей. Более новые приложения, разработанные для Windows Vista и более поздних версий, обычно объявляют уровень привилегий, необходимый для запуска с помощью раздела TRUSTINFO манифеста EXE. Однако старые приложения обычно завершаются сбоем двумя способами:

-   Приложение отображает пользователю сообщение о том, что ему требуются права администратора, как показано ниже.

![не удается запустить или запустить приложение из-за диалогового окна привилегий администратора](images/pcafigure4a.png)

-   Приложение либо завершается немедленно, либо завершается сбоем

Если PCA определяет оба этих условия для приложения, он предоставит рекомендации пользователю. PCA позволит пользователю повторно запустить приложение с правами администратора (PCA применяет режим совместимости РУНАШИГХЕСТ). При повторном запуске приложения пользователь получит запрос контроля учетных записей. Как и в любом из сценариев, пользователь может повторно запуститься с рекомендуемым параметром или отказаться от рекомендуемых параметров, нажав кнопку Закрыть. Ниже приведен пример диалогового окна.

![не удается запустить или запустить приложение из-за диалогового окна параметров административных привилегий](images/pcafigure5.png)

**Сбои приложений из-за конкретных проблем с памятью**

Некоторые приложения завершаются сбоем из-за хорошо известной проблемы с памятью. Приложение обращается к библиотеке DLL из памяти, а затем вызывает функцию для выполнения кода в той же библиотеке DLL. Это приводит к немедленному сбою приложения. Хотя эта проблема не связана с изменением совместимости с Windows 8, это относительно распространенная проблема, возникающая в самых разных приложениях. PCA отслеживает эту ошибку, чтобы дать пользователям возможность более надежно запускать свои приложения.

Для этих приложений PCA автоматически применяет режим совместимости ПИНДЛЛ в автоматическом режиме. Режим совместимости, вызываемый PCA, не позволяет приложению освободить библиотеку DLL из памяти. Таким образом, вызов функции в библиотеке DLL приложения будет работать, предотвращая сбой приложения и позволяя ему продолжать нормально работать.

**Сбой приложения из-за несоответствия системных файлов**

Некоторые приложения, разработанные для Windows XP и более ранних версий, содержат копии системных библиотек Windows и их установщики. При установке таких приложений у приложения есть и старая копия библиотеки DLL, в ее собственной папке, а также последняя версия библиотеки DLL, которая находится в системных папках Windows.

В Windows Vista и более поздних версиях это условие может привести к сбою приложения при попытке загрузить локальную библиотеку DLL, так как эта библиотека DLL не будет работать с остальными текущими системными библиотеками Windows. Так как приложение обычно не знает о новых версиях этой библиотеки DLL, оно не работает должным образом.

Когда PCA обнаруживает, что библиотека DLL не удалось загрузить правильно, она применяет параметр совместимости, позволяющий Windows загрузить последнюю версию библиотеки DLL из системной папки Windows, чтобы приложение работало правильно.

В конце первого неудачного запуска приложения пользователи увидят диалоговое окно PCA, которое уведомляет о примененном параметре, как показано ниже.

![сбой приложения из-за несоответствия системных файлов](images/pcafigure6.png)

**Сбой приложения из-за необработанных ошибок в 64-разрядной версии Windows**

В 64-разрядной версии Windows 8 было включено новое исключение для механизма обратного вызова цикла сообщений. Хотя это исключение впервые появилось в Windows 7, оно не было обязательным для решения этой ошибки. В Windows 8 приложения, использующие циклы сообщений, должны справиться с этим новым исключением. В противном случае произойдет сбой. Приложения, предназначенные для более старых версий Windows, могут не знать об этом исключении, и поэтому могут неправильно обрабатывать эту ошибку (Exception).

PCA обнаруживает приложения, которые не удалось выполнить из-за этой необработанной ошибки, и автоматически применяет режим совместимости ДИСАБЛЕУСЕРКАЛЛБАККЕКСЦЕПТИОН для приложения. После применения параметра в конце выполнения пользователь получает уведомления, как показано ниже. Приложение получит режим при следующем запуске и сможет избежать этой ошибки.

![сбой приложения из-за необработанных ошибок в 64-разрядном диалоговом окне Windows](images/pcafigure7.png)

**Сбой приложения при попытке удаления защищенных файлов, отличных от Windows**

Некоторые приложения, разработанные для Windows XP и более ранних версий предполагают, что они обычно работают с полными правами администратора. В качестве обычного поведения приложения они могут попытаться удалить защищенные файлы, не относящиеся к Windows (в программах или папках Windows). При сбое операции удаления многие такие приложения могут завершиться со сбоем.

PCA обнаруживает такие приложения, которые не могут удалить защищенные файлы и дает пользователю рекомендации. PCA позволит пользователю повторно запустить приложение с параметрами совместимости. Как и в любом из сценариев, пользователь может сообщить PCA о том, что приложение работало правильно, или отказаться от рекомендуемых параметров, нажав кнопку Закрыть. В этом случае PCA применяет режим совместимости ВИРТУАЛИЗЕДЕЛЕТЕ. Ниже приведен пример диалогового окна.

![сбой приложения при попытке удалить диалоговое окно защищенных файлов, не связанных с Windows](images/pcafigure8.png)

**Сбой приложения при попытке изменить файлы или ключи реестра Windows**

Некоторые приложения, разработанные для Windows XP и более ранних версий предполагают, что они обычно работают с полными правами администратора. В качестве обычного поведения приложения они могут попытаться изменить, удалить или записать защищенные файлы Windows (в программных файлах или папках Windows) или в разделы реестра, принадлежащие Windows. При сбое любой операции записи, удаления или изменения файла или раздела реестра многие такие приложения могут аварийно завершить работу или привести к сбою.

PCA обнаруживает такие приложения, которые не могут записывать данные в защищенные файлы Windows или разделы реестра, и предоставляет рекомендации пользователю при завершении работы приложения. PCA позволит пользователю повторно запустить приложение с параметрами совместимости. Как и в любом из сценариев, пользователь может сообщить PCA о том, что приложение работало правильно, или отказаться от рекомендуемых параметров, нажав кнопку Закрыть. В этом случае PCA применяет режим совместимости ВРПМИТИГАТИОН. Ниже приведен пример диалогового окна.

![сбой приложения при попытке изменить диалоговое окно "файлы Windows" или "разделы реестра"](images/pcafigure9.png)

**Сбой приложения из-за использования 8-или 16-разрядных цветовых режимов**

В рамках перекрывающегося Windows 8 для приложений Магазина Windows одним из ключевых изменений является то, что диспетчер окон рабочего стола (DWM) теперь поддерживает только 32-разрядные цвета в Windows 8. Теперь моделируются низкоуровневые цветовые режимы.

Многие старые приложения и игры, разработанные для Windows XP, или перед использованием 8-разрядных или 16-разрядных цветовых режимов. Без снижения риска эти приложения могут не работать в Windows 8. Однако, когда эти приложения перечисляют или пытаются использовать любой из 8-разрядных или 16-разрядных цветовых режимов для экрана, PCA немедленно определяет эту ошибку и справку по DWM, гарантируя, что приложение будет правильно работать с имитацией цветового режима.

Обратите внимание, что это происходит, как только приложение запрашивает режимы низкого цвета и прозрачно для пользователя. Пользователю не нужно перезапускать приложение, чтобы избежать этого, так как это исправление всегда требуется для правильной работы приложения.

**Сбой приложения из-за графики и отображение проблем**

Так как диспетчер окон рабочего стола (DWM) всегда включена в Windows 8, некоторые старые приложения-версии Windows XP могут завершиться ошибкой, если приложение использует графические API в смешанном режиме, как и интерфейсы GDI и DirectX для рисования на экране (в основном в более старых играх), и пытается использовать полноэкранный режим:

-   DWM не позволит рисовать непосредственно на настольном компьютере, игра или приложение либо выйдут из строя, либо Нарисуйте черный экран на рабочем столе, и ни одна из графических объектов не будет видима
-   В таких случаях, когда приложение завершает работу, Windows обнаруживает, что приложение или игра имеет проблему в полноэкранном режиме, и применяет режим совместимости ДКСМАКСИМИЗЕДВИНДОВЕДМОДЕ, позволяющий приложению или игре работать в режиме развернутого окна, а не в полноэкранном режиме.
-   После применения параметра в конце выполнения пользователь получает уведомления PCA, как показано ниже. приложение получит режим совместимости при следующем запуске и сможет работать правильно.

![приложение завершается сбоем из-за диалогового окна "графика и отображение проблем"](images/pcafigure10.png)

**Приложению не удалось объявить сведения о DPI**

Еще одна типичная проблема с отображением многих старых приложений возникает, когда Windows и приложение выполняются в режиме высокого DPI, но приложение не объявляет о высоком уровне DPI через манифест EXE. Между распространенными проблемами, которые могут возникать из-за такого несоответствия параметров, являются обрезанные элементы пользовательского интерфейса или текст и неверный размер шрифта. Дополнительные сведения о проблемах см. [здесь](/previous-versions//dd464660(v=vs.85)).

В таких случаях Windows обнаруживает, что приложение поддерживает высокое разрешение DPI, и применяет режим совместимости ХИГХДПИАВАРЕ к приложению в конце первого запуска. PCA будет уведомлять пользователя об этом, как показано ниже:

![приложению не удалось объявить диалоговое окно определения осведомленности о dpi](images/pcafigure11.png)

**Сбой приложения из-за отсутствия компонентов Windows**

Некоторые приложения зависят от компонентов Windows, которые были удалены с момента выпуска Windows Vista. Когда эти приложения пытаются загрузить недостающие библиотеки DLL или COM-компоненты, они не смогут работать.

PCA обнаруживает приложения при попытке загрузить недостающие компоненты Windows, а также предоставляет рекомендации по загрузке этих компонентов и их установке после завершения работы приложения. Пользователь может щелкнуть "получить справку в Интернете", чтобы найти альтернативу или скачать компонент и установить его. При необходимости пользователь может ничего не делать, нажав кнопку Закрыть.

![сбой приложения из-за отсутствия диалогового окна компонентов Windows](images/pcafigure12.png)

**Сбой приложения из-за неподписанных драйверов в 64-разрядной версии Windows 8**

64-разрядная версия Windows требует наличия драйверов с цифровыми подписями (SYS-файлы), начиная с Windows Vista. Однако старые приложения, разработанные до выпуска драйверов Windows Vista, не подписанные цифровой подписью. Если такой неподписанный драйвер установлен, Windows не будет загружать их. В редких случаях Windows может не запускаться, если такие драйверы помечены как драйверы времени загрузки.

Некоторые старые приложения устанавливают драйверы, которые не вошли в 64-разрядную версию Windows. Любое устройство или приложение, пытающееся использовать этот драйвер, может завершиться ошибкой или привести к сбою системы. Чтобы предотвратить такой сценарий, PCA обнаруживает приложения при установке неподписанных драйверов и отключает драйвер, помеченный как драйвер времени загрузки.

Он также указывает пользователю получить драйвер цифровой подписи, чтобы приложение работало правильно. Сообщение отображается в результате установки драйвера, а также в результате установки приложения в. Если другое приложение устанавливает тот же драйвер, это приложение также будет получать то же сообщение.

![сбой приложения из-за неподписанных драйверов в 64-разрядном диалоговом окне Windows 8](images/pcafigure13.png)

**Приложения отслеживания, установленные с помощью параметров совместимости**

При сбое установщика PCA помогает установщику с различными режимами совместимости в зависимости от типа сбоя. После завершения работы установщика с параметрами совместимости PCA будет отслеживанию ярлыков, добавленных установщиком. Это делается для того, чтобы определить, могут ли приложения, которые были установлены, иметь параметры совместимости, примененные к установщику.

Когда пользователь запускает такое приложение, PCA запрашивает у пользователя вопрос о том, что приложение работало правильно. Если пользователь ответил, "Да", PCA прекращает отслеживать приложение. Если пользователь отвечает "нет", он применяет тот же режим совместимости, который был применен к установщику приложения, и повторно запускает приложение с примененным режимом совместимости.

**Приложению не удается запустить установщики или средства обновления**

Приложения иногда запускают дочерние программы, которые должны запускаться от имени администраторов. Обычно это происходит, когда приложение пытается запустить программное обеспечение обновления для проверки и установки новых обновлений приложения. Если приложения непосредственно запускают такие дочерние программы, дочерняя программа может не запуститься, так как само приложение не имеет прав администратора или потому, что дочерняя программа не была правильно отмечена для повышения прав с помощью манифеста UAC.

PCA отслеживает эти ошибки и при закрытии основного приложения автоматически применяет режим совместимости ELEVATECREATEPROCESS, который поможет обеспечить правильную работу дочерних программ. Когда приложение запускает дочернее приложение при последующих запусках, пользователь увидит диалоговое окно контроля учетных записей для дочерней программы.

Ниже приведен пример диалогового окна PCA.

![приложению не удается запустить диалоговое окно установщиков или средств обновления](images/pcafigure14.png)

**Установщики приложений, которые должны запускаться с правами администратора**

Для установки классических приложений Windows требуются права администратора, так как они записывают файлы, папки и записи реестра в защищенные системные области. Windows (UAC) имеет логику обнаружения для определения времени запуска установщика и немедленно предлагает пользователю предоставить административные привилегии в диалоговом окне UAC. Однако в некоторых случаях эта логика не сможет определить, что приложение действительно является установщиком, и не может получить права администратора. Обычно это пользовательские установщики, которые не используют хорошо известные технологии установки, такие как установщик Windows или установка щита.

В таких случаях PCA обнаруживает, что установщику не удалось записать файлы. В конце в случае сбоя установки PCA предоставит рекомендации по применению параметров совместимости. Если пользователь выбирает команду "запустить программу", PCA будет применять режим совместимости RUNASADMIN и повторно запустить установщик. Если пользователь решит закрыть, параметр не будет применен. Ниже приведен пример диалогового окна PCA.

![Снимок экрана, на котором показан пример диалогового окна для установщика приложений, которое должно выполняться с правами администратора.](images/pcafigure15.png)

Приложения панели управления прежних версий, необходимые для работы с приложениями панели управления правами администратора, обычно изменяют системные параметры и нуждаются в возможности запуска администратора AD. Однако они, написанные до Windows Vista, не имеют манифеста EXE или не имеют раздела TRUSTINFO, в котором объявляется требуемый уровень привилегий. При запуске таких приложений PCA обнаруживает их и в конце первого запуска предоставляет рекомендацию для запуска с административными параметрами. Если пользователь выбирает команду "запустить программу", PCA применяет режим совместимости RUNASADMIN и повторно запускает установщик. Если пользователь решит закрыть, параметры не будут применены. Ниже приведен пример диалогового окна PCA.

![установщики приложений, которые должны запускаться с помощью диалогового окна с правами администратора](images/pcafigure16.png)

**Проверка рекомендуемых параметров с помощью отзывов пользователей**

В конце каждого сценария (после запуска приложения с рекомендуемыми параметрами совместимости) PCA предложит пользователю простой вопрос:

![Проверка рекомендуемых параметров с помощью диалогового окна отзывов пользователей](images/pcafigure17.png)

Пользователь может оставить отзыв, если приложение работало или завершилось сбоем с параметром совместимости. Эти данные будут отправлены анонимно в корпорацию Майкрософт. Это гарантирует, что эти исправления могут быть встроены в Windows 8 с помощью процесса обновления Windows, чтобы будущие пользователи Windows 8 больше не сталкиваются со сбоем приложения, и PCA больше не будет относиться к сбоям в работе приложения.

**Отслеживание проблем, не имеющих рекомендаций**

Приложения могут завершаться сбоем различными способами по соображениям совместимости. PCA отслеживает множество других проблем совместимости, чем указано в приведенных выше сценариях. В таких случаях, как правило, манифест проблемы зависит от приложения. Это означает, что некоторые приложения правильно обрабатывали такие проблемы, а другие — нет. Таким образом, в то время как PCA по-прежнему отслеживает приложение, оно не предоставляет прямых рекомендаций по устранению проблемы.

Проблемы, которые отслеживаются PCA без рекомендуемых параметров или диалогового окна, включают приложения, которые:

-   Очень короткий период выполнения — приложения выполняются не более трех секунд
-   Создание глобальных объектов памяти без прав администратора
-   Ошибка (исключение Win32) при запуске
-   Проверьте наличие прав администратора (но может произойти сбой)
-   Использование кодеков Indeo (не рекомендуется в Windows Vista)
-   Попробуйте записать или удалить ключи из защищенных расположений реестра, таких как HKLM
-   Аварийное завершение при запуске

**Применение исправлений с помощью вкладки "совместимость" и средства устранения неполадок совместимости**

Как упоминалось выше, приложения могут завершаться сбоем по различным причинам совместимости. Не все из них имеют четкие рекомендации по PCA, так как параметры зависят от приложения. Тем не менее пользователи могут перейти на вкладку Диагностика совместимости или совместимость, чтобы применить некоторые общие исправления для правильной работы приложения, которое не работает в Windows 8. В таких случаях PCA по-прежнему будет отслеживанию проблем совместимости приложения до и после применения исправления. После того как приложение будет запущено с применением исправления, PCA запросит пользователя, если исправление работало. Когда пользователь ответит на вопрос, данные отправляются анонимно через телеметрию в корпорацию Майкрософт. Эти данные собираются из множества пользователей и анализируются, а соответствующие исправления затем широко распространяются всем пользователям Windows 8 через Windows Update.

**Использование средства устранения проблем совместимости**

Средство устранения неполадок совместимости — это механизм Windows, который позволяет диагностировать проблемы с приложениями и применять рекомендованные исправления для правильной работы. Это необходимо только в том случае, если PCA не предоставляет никаких рекомендаций для приложения.

Средство устранения неполадок позволяет пользователям пройти по набору вопросов и ответить на них, и на основе ответов будет применен набор исправлений, позволяющий пользователям тестировать свои приложения и проверять исправления. После проверки исправления будут постоянно применены к приложениям, чтобы они были лучше работают в Windows 8.

Ниже приведена ссылка на пользовательский интерфейс средства устранения неполадок.

![Использование диалогового окна "Устранение неполадок совместимости"](images/pcafigure18.png)

Средство устранения неполадок совместимости можно запустить двумя способами.

**На начальном экране:**

1.  Тип: средство устранения неполадок совместимости
2.  В разделе Параметры щелкните плитку запуск программ, выполненных для предыдущей версии Windows.

  
**На плитке приложения:**

1.  На начальном экране щелкните правой кнопкой мыши плитку приложения.
2.  Щелкните "открыть расположение файла" (только для классических приложений)
3.  На ленте проводника перейдите на вкладку "приложение".
4.  Выберите "Устранение неполадок совместимости"

  


**Использование вкладки "совместимость"**

Обратите внимание, что это рекомендуется только для пользователей, которые экспертов используют разные параметры совместимости. Этот метод не предоставляет никаких рекомендаций по типу исправления, применяемого к приложениям. Здесь предполагается, что пользователь должен узнать, какие исправления можно применить, чтобы заставить приложение работать. Если вы не знаете об исправлениях, воспользуйтесь средством устранения проблем с совместимостью, чтобы найти исправление для приложения.

Чтобы открыть вкладку "совместимость", выполните следующие действия.

 **На начальном экране:**

1.  Щелкните плитку приложения правой кнопкой мыши
2.  Открыть расположение файла (только для классических приложений)

  
**На ленте обозревателя:**

1.  Выберите Свойства.
2.  Перейдите на вкладку "совместимость"
3.  Выберите исправления совместимости
4.  Повторно запустите приложение.
    > [!Note]  
    > Вы можете вернуться к тому же месту, чтобы изменить или удалить исправления. Вы также можете применить исправления ко всем пользователям на компьютере с помощью кнопки, представленной на вкладке.

     

  


![Использование вкладки "совместимость"](images/pcafigure19.png)

**Приложения с известными проблемами совместимости**

Помимо описанных выше сценариев обнаружения проблем среды выполнения, PCA также информирует пользователей при запуске приложения, если приложение имеет известные проблемы совместимости. Список хранится в базе данных совместимости системных приложений. Существует два типа этих сообщений:

-   **Сообщения с жестким блоком**— если известно, что приложение несовместимо, и если разрешить запуск приложения, это приведет к серьезному влиянию системы (например, аварийному завершению работы Windows или невозможности загрузки после установки), появится сообщение о блокировке, как показано ниже.

![приложения с известными проблемами совместимости — диалоговое окно с жестко заблокированными сообщениями](images/pcafigure20.png)

-   **Сообщения об мягком блокировании**— если приложение имеет известную проблемы совместимости и может работать неправильно, отображается следующее сообщение:

![приложения с известными проблемами совместимости — диалоговое окно "Мягкая блокировка сообщений"](images/pcafigure21.png)

В обоих случаях параметр "получить справку в Интернете" отправляет отчет об ошибках Windows, чтобы получить от Майкрософт ответ в сети и отобразить его пользователю. Обычно ответы указывают пользователю на один из трех типов ресурсов:

-   Обновление от поставщика приложения
-   Веб-сайт поставщика приложения для получения дополнительных сведений
-   Дополнительные сведения см. в статье базы знаний Майкрософт

**Телеметрию для PCA**

После того как PCA решает все проблемы с приложениями на компьютере с Windows 8 и получает все отзывы пользователей, он собирает анонимные данные о приложении, установщике, обнаруженных проблемах и параметрах совместимости, примененных к приложению, и отправляет его обратно в корпорацию Майкрософт. Эти данные собираются от любого пользователя, который хочет предоставить такие анонимные данные (с помощью программа улучшения качества программного обеспечения CEIP). После сбора данных будут проанализированы сбои и исправления приложений, а исправления будут распространяться во всю экосистему Windows через механизм Центр обновления Windows, чтобы любой пользователь приложения в будущем автоматически выигрывает из исправления.

**Административные элементы управления и управление параметрами PCA**

ИТ администраторы могут управлять поведением PCA двумя способами:

-   **Отключить PCA** — этот параметр позволяет ИТ-администраторам отключить диалоговые окна, которые PCA отображает пользователям. PCA по-прежнему будет отслеживать и обнаруживать проблемы и передавать данные телеметрии обратно
-   **Отключить телеметрии приложений** — этот параметр отключает сбор и отправку данных телеметрии с помощью PCA
    > [!Note]  
    > Если Программа CEIP отключена, этот параметр не оказывает влияния.

     

**Разработка приложений для работы с PCA**

Разработчикам необходимо убедиться, что их приложения будут хорошо работать во всех сценариях совместимости, описанных выше. Разработчики должны протестировать и проверить свои приложения для каждого из описанных выше сценариев и убедиться в отсутствии проблем совместимости. Если выявлены проблемы совместимости, разработчики должны внести исправления в свои приложения, необходимые для устранения проблемы совместимости. Ниже перечислены некоторые из стандартных исправлений, которые должны быть внесены разработчиками.

-   Устранение проверок версий операционной системы Windows во время установки и выполнения
-   Устранение непроверенных прав (проверка доступа администратора); Используйте манифест EXE для объявления нужного уровня привилегий.
-   Убедитесь, что двоичные файлы Windows не поставляются в установщик приложения
-   Удаление записи в защищенные области (реестр, папки) или запись в защищенные файлы
-   Цифровая подпись всех двоичных файлов (EXE, DLL, SYS-файлы)
-   Для установщиков убедитесь, что добавлена соответствующая запись "Установка и удаление программ". как минимум, эта запись метаданных приложения должна включать имя приложения, издателя, строку версии и поддерживаемый язык. Это указывает PCA на то, что установщик успешно завершил работу, а также предоставит пользователям удобный способ удаления приложения.

Проверка того, что раздел TRUSTINFO и COMPATIBILITY манифеста приложения (исполняемого файла) обновлен, как указано в Windows 8 Compatibility Cookbook, позволит PCA знал о том, что приложение разрабатывалось для Windows 8, а также гарантирует, что приложение всегда будет выполняться изначально без применения режимов совместимости.

Чтобы убедиться, что PCA считает приложение предназначенным для Windows 8, выполните следующие действия.

-   Все исполняемые файлы (установщик или среда выполнения) должны быть манифестом для разделов TRUSTINFO и COMPATIBILITY для Windows 8.
-   Установщик должен добавить запись "Установка и удаление программ"

**Словарь терминов**

Ниже перечислены режимы совместимости, используемые PCA, с кратким описанием того, что включает режим.



| Режим                         | Описание                                                                                                                                                      |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Windows7RTM                  | Этот режим эмулирует общее поведение Windows 7, включая номер версии операционной системы 6,1                                                                   |
| WindowsVistaSP2              | Этот режим эмулирует общее поведение Windows 7, включая номер версии операционной системы 6,1                                                                   |
| WindowsXPSp3                 | Этот режим эмулирует общее поведение Windows XP SP3, включая номер версии операционной системы 5,1. Это также включает режим РУНАШИГХЕСТ                    |
| рунашигхест                 | В этом режиме пользователю предлагается запустить приложение с наивысшей доступной привилегией. Пользователи с правами администратора увидят запрос на повышение прав UAC для приложения. |
| RUNASADMIN                   | Этот режим всегда предлагает пользователю запустить приложение с правами администратора. приложения с этим режимом всегда будут получать запрос на повышение прав UAC                    |
| ELEVATECREATEPROCESS         | В этом режиме дочерние процессы главного приложения запускаются с правами администратора. дочерние процессы получат диалоговое окно повышения прав UAC                          |
| пиндлл                       | Этот режим заставляет библиотеку DLL находиться в памяти для приложения, даже если приложение выгружает библиотеку DLL.                                                                                |
| дисаблеусеркаллбаккексцептион | Этот режим перехватывает исключения обратного вызова пользователя и позволяет приложению продолжить работу без необходимости обработайте исключение.                                          |
| виртуализеделете             | Этот режим перехватывает операции удаления защищенных файлов и предотвращает сбой приложений из-за необработанных исключений из операции удаления.                   |
| врпмитигатион                | Этот режим возвращает значение Success, если приложение пытается записать, изменить или удалить защищенные файлы Windows или записи реестра (без фактического завершения операции).  |
| дксмаксимизедвиндоведмоде      | Этот режим определяет приложения, которые переходят в полноэкранный режим и перенаправляют их в режим развернутого окна                                                          |
| хигхдпиаваре                 | Этот режим позволяет остальным системам Windows знать, что приложение поддерживает высокое разрешение DPI, и обеспечивает правильную отрисовку элементов пользовательского интерфейса, текста, шрифта и т. д.                              |



 

 

 