---
title: Multipath I/O теперь поддерживает расширенные блоки запросов хранилища
description: Multipath I/O теперь поддерживает расширенные блоки запросов хранилища
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127247654"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a>Multipath I/O теперь поддерживает расширенные блоки запросов хранилища

## <a name="platforms"></a>Платформы

**серверы** — Windows Server 2012 

## <a name="description"></a>Описание

в Windows Server 2012 новая структура, \_ блок запроса хранилища \_ (extended срб) заменяет \_ блок запроса SCSI \_ (legacy срб) в основном стеке хранилища. Расширенная Србс реплицирует функциональность устаревших Србс, но также расширяема и масштабируется.

Multipath I/O (MPIO) поддерживает расширенные Србс и позволяет модулям конкретных устройств (DSM) указать также расширенную поддержку СРБ. Однако, чтобы стек хранилища многопутевого устройства мог использовать расширенную Србс, **все компоненты в стеке должны поддерживать расширенные србс, включая DSM**. Обратите внимание, что модуль DSM Microsoft in-Box (MSDSM) поддерживает расширенные Србс.

\_Структура транзитного \_ перебора по протоколу SCSI \_ не входит в состав расширенных проходов MPIO через структуру, так как в зависимости от отладчика командной строки (CDB) может быть переменного размера. Вместо этого расширенное передаваемое значение MPIO имеет поле, которое описывает смещение от начала расширенного прохода по структуре с помощью функции перебора \_ по \_ каналу SCSI через \_ структуру. Вызывающий объект должен убедиться, что они выделили буфер соответствующего размера и правильно установили смещение SCSI-передачи. При условии, что вызывающий объект соответствует правилам для расширенных передаваемых дисков SCSI, не должно быть дополнительной работы, чтобы они использовали расширенный проход MPIO.

> [!Note]  
> Если модуль DSM не поддерживает расширенную Србс, MPIO не сможет пройти запросы, для которых в качестве \_ \_ флага ioctl требуется \_ \_ установлен флаг DSM.

 

## <a name="manifestation"></a>Проявление

Если какая либо часть стека хранилища устройства, включая DSM, не поддерживает расширенные Србс, стек хранилища вернется к использованию устаревших Србс.

## <a name="solution"></a>Решение

Для поддержки блоков запросов хранилища модуль DSM должен иметь только два требования к MPIO \_ \_ :

-   Модуль DSM должен сообщить о своем типе как DsmType6
-   Модуль DSM должен предоставить \_ \_ \_ поддерживаемую функцию типа адреса DSM

Если модуль DSM не сообщает о DsmType6 или если он сообщает DsmType6, но не предоставляет \_ \_ \_ функцию поддерживаемого типа адреса DSM, MPIO считает, что DSM не поддерживает расширенную србс.

\_ \_ \_ Поддерживаемая функция типа адреса DSM принимает два параметра, один из которых является типом адреса. Этот тип адреса должен быть одним из \_ значений типа адреса хранилища, \_ \_ \* определенных в СРБ. h. Модуль DSM должен возвращать значение TRUE, если он поддерживает заданный тип адреса, и значение FALSE в противном случае. Определение "Support" в конечном итоге обеспечивается DSM. MPIO использует эту функцию, чтобы гарантировать, что модуль DSM не будет вести себя, если он передается расширенному СРБ с \_ структурой адресов стор данного типа. Таким образом, MPIO обычно вызывает эту функцию при перечислении многопутевого устройства, но функцию можно вызвать в любое время.

Если модуль DSM никогда не касается адреса стор расширенного СРБ \_ , он может вернуть значение true для любого допустимого \_ \_ значения типа адреса хранилища \_ \* . Ознакомьтесь с примером DSM в WDK.

**Другие важные примечания**

-   DSM, поддерживающие расширенную Србс, должны иметь возможность обрабатывать \_ \_ структуры блоков запросов SCSI и \_ блоки запросов хранилища \_ . Так как DSM сообщает, что он поддерживает расширенную Србс, не означает, что он будет монопольно принимать расширенные Србс. Кроме расширенных Србс, он по-прежнему может получать любое количество устаревших Србс, и поэтому должен иметь возможность обрабатывать оба.
-   Мы предоставили в WDK файл заголовка с именем србхелпер. h, который содержит встроенные функции, помогающие драйверам, которые должны поддерживать как расширенные, так и устаревшие Србс. Наш пример DSM использует этот заголовок, чтобы вы могли использовать его в качестве примера использования этих функций.
-   Модуль DSM, не поддерживающий расширенную Србс, никогда не должен будет поддерживать расширенную Србс.
-   Возможно, что MPIO будет переносить стек хранилища на устаревшие Србс в случае, если модуль DSM не поддерживает заданный \_ тип адреса хранения \_ \_ \* (но в противном случае поддерживает расширенный србс).
-   "BTL8" — это единственный \_ тип адресов хранения, \_ \_ \* определенный в настоящее время для Windows Server 2012.

 

 




