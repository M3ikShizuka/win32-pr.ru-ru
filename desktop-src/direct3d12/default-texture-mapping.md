---
title: Оптимизация с использованием доступных для ЦП текстур и стандартных Свиззле
description: Графические процессоры с архитектурой "Универсальная память" (для архитектуры) предлагают некоторые эффективные преимущества по сравнению с отдельными GPU, особенно при оптимизации для мобильных устройств.
ms.assetid: 26C41948-9625-4786-BBDF-552D1F8A2437
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2624a300811b4d4a1eef70873a31af89b0546224fd9b4f3ba06ecb1fbd2fac42
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119894674"
---
# <a name="uma-optimizations-cpu-accessible-textures-and-standard-swizzle"></a>Оптимизация UMA: доступные ЦП текстуры и стандартное преобразование ссылок при перемещении данных с внешнего устройства

Графические процессоры с архитектурой "Универсальная память" (для архитектуры) предлагают некоторые эффективные преимущества по сравнению с отдельными GPU, особенно при оптимизации для мобильных устройств. Предоставление ресурсов доступа к ЦП при наличии GPU может уменьшить объем копируемых данных между ЦП и GPU. Несмотря на то, что приложения не рекомендуют предоставлять доступ к ЦП всем ресурсам на всех схемах, существуют возможности повышения эффективности, обеспечивая доступ к нужным ресурсам ЦП. В отличие от дискретных графических процессоров, в ЦП технически может быть указатель на все ресурсы, к которым может получить доступ GPU.

-   [Общие сведения о текстурах, доступных для ЦП](#overview-of-cpu-accessible-textures)
-   [Обзор стандартных Свиззле](#overview-of-standard-swizzle)
-   [Программные интерфейсы](#apis)
-   [Связанные темы](#related-topics)

## <a name="overview-of-cpu-accessible-textures"></a>Общие сведения о текстурах, доступных для ЦП

Текстуры, доступные для ЦП, в графическом конвейере — это функция архитектуры, позволяющая ЦП считывать и записывать доступ к текстурам. На более распространенных дискретных графических процессорах ЦП не имеет доступа к текстурам в графическом конвейере.

Общие рекомендации по работе с текстурами заключаются в раздельных графических процессорах, которые обычно входят в процессы [отправки данных текстуры через буферы](upload-and-readback-of-texture-data.md), как показано ниже.

-   Отсутствие доступа к ЦП для большинства текстур.
-   Задание макета текстуры D3D12 \_ \_ неизвестный макет текстуры \_ .
-   Передача текстур в GPU с помощью [**копитекстуререгион**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion).

Однако в некоторых случаях ЦП и GPU могут часто взаимодействовать с одними и теми же данными, что позволяет экономить текстуру, а также ускорить определенную архитектуру на определенных адаптерах или архитектурах. Приложения должны обнаружить эти случаи и оптимизировать ненужные копии. В этом случае для достижения оптимальной производительности необходимо учитывать следующее.

-   Приступить только к повышению производительности текстур сопоставления, когда [**D3D12 \_ функция \_ \_ архитектура данных**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_feature_data_architecture):: верхнюю часть имеет значение true. Затем Обратите внимание на *качекохерентума* , если решите, какие свойства кэша ЦП следует выбрать в куче.

-   Использование доступа к ЦП для текстур является более сложным, чем для буферов. Наиболее эффективные макеты текстур для графических процессоров редко являются основной строкой \_ . Фактически, некоторые GPU могут поддерживать только \_ основные текстуры строк при копировании данных текстуры.

-   Самые графические процессоры должны иметь универсальное преимущество от простой оптимизации для уменьшения времени загрузки на уровне. Определив верхнюю область, приложение может оптимизировать первоначальные [**копитекстуререгион**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-copytextureregion) для заполнения текстур, которые не будут изменены графическим процессором. Вместо создания текстуры в куче с \_ типом КУЧИ D3D12 \_ \_ по умолчанию и маршалингом данных текстуры с помощью приложение может использовать [**вритетосубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-writetosubresource) , чтобы избежать понимания фактической структуры текстуры.

-   В D3D12 текстуры, созданные с помощью \_ макета текстуры D3D12, \_ \_ неизвестны и доступ к ЦП не является самым эффективным для частой отрисовки и выборки GPU. При тестировании производительности эти текстуры должны сравниваться с \_ \_ макетом текстуры D3D12 \_ , неизвестным при доступе к ЦП, а также по \_ \_ \_ стандарту D3D12 \_ , Стандартный свиззле с доступом к ЦП и D3D12 \_ \_ строке макета текстуры, \_ \_ основной для поддержки перекрестных адаптеров.

-   Использование \_ макета текстуры \_ D3D12 \_ Unknown с доступом к ЦП позволяет методам [**вритетосубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-writetosubresource), [**реадфромсубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-readfromsubresource), [**Map**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-map) (исключает доступ к приложению в указатель) и отменять [**сопоставление**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-unmap); но может пожертвовать производительность доступа к GPU.

-   Использование \_ \_ стандартного свиззле макета текстуры D3D12 \_ \_ с доступом к ЦП позволяет [**вритетосубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-writetosubresource), [**реадфромсубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-readfromsubresource), [**Map**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-map) (который возвращает допустимый указатель на приложение) и [**отменить сопоставление**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-unmap). Это также может пожертвовать повышение эффективности доступа GPU, чем D3D12ный \_ \_ Макет текстуры \_ , неизвестен с помощью ЦП.

## <a name="overview-of-standard-swizzle"></a>Обзор стандартных Свиззле

D3D12 (и D3D 11.3) предоставляют стандартный макет многомерных данных. Это делается для того, чтобы несколько единиц обработки работали с одними и теми же данными без копирования данных или группирующие данных между несколькими макетами. Стандартизированный макет позволяет повысить эффективность благодаря сетевым эффектам и позволяет использовать алгоритмы для сокращенного использования определенного шаблона.

Подробное описание макетов текстур см. в разделе [**D3D12 \_ текстурный \_ Макет**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_texture_layout).

Обратите внимание, что этот стандарт свиззле является аппаратной функцией и может не поддерживаться всеми GPU.

Общие сведения о группирующие см. в разделе [Кривая Z-порядка](https://en.wikipedia.org/wiki/Z-order_curve).

## <a name="apis"></a>API-интерфейсы

В отличие от D3D 11.3, D3D12 поддерживает сопоставление текстур по умолчанию, поэтому нет необходимости запрашивать [**\_ \_ \_ \_ Параметры D3D12 данных о функциях D3D12**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_feature_data_d3d12_options). Однако D3D12 не всегда поддерживает стандартный свиззле. эту функцию необходимо запросить с помощью вызова [**чеккфеатуресуппорт**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-checkfeaturesupport) и проверки поля *StandardSwizzle64KBSupported* в D3D12 **\_ Data Features \_ \_ D3D12 \_ Options**.

Следующие API сопоставлены текстурные карты:

Перечисления

-   [**D3D12 \_ \_Макет текстуры**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_texture_layout) . управляет шаблоном свиззле текстур по умолчанию и включает поддержку карт для текстур, доступных в ЦП.

Структуры

-   [**D3D12 \_ RESOURCE \_ DESC**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_resource_desc) : описывает ресурс, такой как текстура, который является широко используемой структурой.
-   [**D3D12 \_ \_DESC**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_heap_desc) — описание кучи.

Методы

-   [**ID3D12Device:: креатекоммиттедресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) : создает один ресурс и резервную кучу правильного размера и выравнивания.
-   [**ID3D12Device:: CreateHeap**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createheap) : создает кучу для буфера или текстуры.
-   [**ID3D12Device:: креатеплацедресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createplacedresource) : создает ресурс, который размещается в определенной куче, обычно это более быстрый способ создания ресурса, чем [**CreateHeap**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createheap).
-   [**ID3D12Device:: креатересерведресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createreservedresource) : создает ресурс, который зарезервирован, но еще не зафиксирован или не помещен в кучу.
-   [**ID3D12CommandQueue:: упдатетилемаппингс**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-updatetilemappings) : обновляет сопоставления расположений плиток в мозаичных ресурсах с расположениями в памяти в куче ресурсов.
-   [**ID3D12Resource:: Map**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-map) : получает указатель на указанные данные в ресурсе и запрещает доступ GPU к подресурсу.
-   [**ID3D12Resource:: DESC**](id3d12resource-getdesc.md) : получает свойства ресурса.
-   [**ID3D12Heap:: DESC**](id3d12heap-getdesc.md) получает свойства кучи.
-   [**Реадфромсубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-readfromsubresource) : копирует данные из текстуры, сопоставленной с помощью [**Map**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-map).
-   [**Вритетосубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-writetosubresource) : копирует данные в текстуру, сопоставленную с помощью [**Map**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-map).

Ресурсы и родительские кучи имеют требования к выравниванию:

-   D3D12 \_ по умолчанию \_ \_ Размещение ресурсов MSAA \_ \_ (4 МБ) для многопримерных текстур.
-   D3D12 \_ \_ Выравнивание размещения ресурсов по умолчанию \_ \_ (64 КБ) для отдельных образцов текстур и буферов.
-   Копирование линейного подсчета должно быть выровнено по D3D12у \_ \_ \_ выравнивания размещения данных текстуры \_ (512 байт), при этом высота строки выравнивается по ширине D3D12 \_ \_ данных текстуры \_ \_ (256 байт).
-   Представления буфера констант должны быть выровнены относительно \_ \_ выравнивания размещения данных в буфере констант D3D12 \_ \_ \_ (256 байт).

Текстуры меньше 64 КБ должны обрабатываться через [**креатекоммиттедресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createcommittedresource).

Благодаря динамическим текстурам (текстурам, изменяющих каждый кадр) ЦП записывается линейно в кучу передачи, а затем выполняется операция копирования GPU.

Как правило, для создания динамических ресурсов создайте большой буфер в куче передачи (см. [подраспределение в буферах](large-buffers.md)). Чтобы создать промежуточные ресурсы, создайте большой буфер в куче реадбакк. Чтобы создать статические ресурсы по умолчанию, создайте смежные ресурсы в куче по умолчанию. Чтобы создать ресурсы с псевдонимами по умолчанию, создайте перекрывающиеся ресурсы в куче по умолчанию.

[**Вритетосубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-writetosubresource) и [**реадфромсубресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12resource-readfromsubresource) переупорядочивают данные текстуры между макетом "строка — основной" и неопределенным макетом ресурса. Операция является синхронной, поэтому приложение должно учитывать необходимость планирования ЦП. Приложение всегда может разбивать копирование на небольшие регионы или запланировать эту операцию в другой задаче. Ресурсы MSAA и ресурсы элементов глубины с непрозрачными макетами ресурсов не поддерживаются этими операциями копирования ЦП и могут привести к сбою. Форматы, у которых нет элемента Power-of-2, также не поддерживаются, и это также приведет к сбою. Возможны коды возврата нехватки памяти.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Базовые константы**](constants.md)
</dt> <dt>

[**ID3D12Heap**](/windows/desktop/api/d3d12/nn-d3d12-id3d12heap)
</dt> <dt>

[Привязка ресурсов](resource-binding.md)
</dt> </dl>

 

 




