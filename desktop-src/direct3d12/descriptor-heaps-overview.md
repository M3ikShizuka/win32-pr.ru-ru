---
title: Общие сведения о кучах дескрипторов
description: Кучи дескрипторов содержат множество типов объектов, которые не являются частью объекта состояния конвейера (PSO), например представления ресурсов шейдера (СРВС), неупорядоченные представления доступа (Уавс), представления постоянного буфера (КБВС) и пробы.
ms.assetid: 14561E77-44E0-4A58-8456-F40D59ECA175
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8bf720ebb71d016457fa4383a8d33aa62e2eee4
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127343866"
---
# <a name="descriptor-heaps-overview"></a>Общие сведения о кучах дескрипторов

Кучи дескрипторов содержат множество типов объектов, которые не являются частью объекта состояния конвейера (PSO), например представления ресурсов шейдера (СРВС), неупорядоченные представления доступа (Уавс), представления постоянного буфера (КБВС) и пробы.

-   [Назначение куч дескрипторов](#the-purpose-of-descriptor-heaps)
-   [Синхронизация](#synchronization)
-   [Привязка](#binding)
-   [Переключение куч](#switching-heaps)
-   [Пакеты](#bundles)
-   [Управление](#management)
-   [Связанные темы](#related-topics)

## <a name="the-purpose-of-descriptor-heaps"></a>Назначение куч дескрипторов

Основной целью кучи дескриптора является охватывающая часть памяти, необходимая для хранения спецификаций дескрипторов типов объектов, на которые ссылается шейдер, для как можно большего размера окна отрисовки (в идеале это весь кадр отрисовки или более). Если приложение переключается на те текстуры, которые конвейер видит быстро, из API, то в куче дескрипторов должно быть место для определения таблиц дескрипторов в режиме реального времени для каждого необходимого набора состояний. Приложение может повторно использовать определения, если ресурсы снова используются в другом объекте, например, или просто назначать пространство кучи последовательно при переключении различных типов объектов.

Кучи дескрипторов также позволяют отдельным программным компонентам управлять хранилищем дескрипторов отдельно друг от друга.

Все кучи видимы для ЦП. Приложение также может запрашивать свойства доступа к ЦП, которые должна иметь куча дескриптора (если таковая имеется) — запись в сочетании, запись обратно и т. д. Приложения могут создавать столько куч дескриптора, сколько нужно, с тем, какие свойства требуются. Приложения всегда имеют возможность создавать кучи дескрипторов, предназначенные исключительно для промежуточных целей, которые не ограничены размером, и копировать в кучи дескрипторов, которые используются для отрисовки по мере необходимости.

Существуют некоторые ограничения, которые могут попасть в одну кучу дескрипторов. Записи CBV, UAV и SRV могут находиться в одной куче дескрипторов. Однако записи образцов не могут совместно использовать кучу с записями CBV, UAV или SRV. Как правило, существует два набора куч дескрипторов: один для общих ресурсов, а второй для образцов.

Использование куч дескриптора в Direct3D 12 отражает большинство аппаратных средств GPU, что заключается в том, чтобы либо использовать дескрипторы в режиме реального времени только в кучах дескрипторов, либо просто уменьшить число битов адресации, если используются эти кучи. Direct3D 12 требует использования куч дескриптора, поэтому нет возможности размещать дескрипторы в любом месте памяти.

Кучи дескрипторов могут быть изменены только ПРОЦЕССОРом, поэтому графический процессор не может изменить кучу дескрипторов.

## <a name="synchronization"></a>Синхронизация

Содержимое кучи дескрипторов можно изменить до, во время и после записи списков команд, ссылающихся на нее. Однако дескрипторы нельзя изменить, пока список команд, отправленный для выполнения, может ссылаться на это расположение, так как это может вызвать состояние гонки.

## <a name="binding"></a>Привязка

Хотя бы одна объединенная куча CBV/SRV/UAV и одна куча выборки могут быть привязаны в любой момент времени. Эти кучи являются общими для конвейеров графики и вычислений (описанных в их псос).

## <a name="switching-heaps"></a>Переключение куч

Приложение может переключать кучи в одном списке команд или в разных, используя API [**сетдескрипторхеапс**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) и [**Reset**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-reset) . На некоторых устройствах это может быть дорогостоящей операцией, требующей остановки GPU для сброса всей работы, которая зависит от кучи дескрипторов, привязанных в данный момент. В результате, если необходимо изменить кучу дескрипторов, приложения должны попытаться сделать это, когда Рабочая нагрузка GPU становится относительно светлой, что может привести к ограничению изменений в начале списка команд.

## <a name="bundles"></a>Пакеты

В пакетах может быть только один вызов метода [**сетдескрипторхеапс**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) , а набор куч дескриптора должен точно совпадать со списком команд, вызывающим пакет. Если пакет не изменяет таблицы дескрипторов, не нужно задавать кучу дескрипторов.

Список вызовов API, которые нельзя использовать с пакетами, см. в разделе [Создание и запись списков команд и пакетов](recording-command-lists-and-bundles.md).

## <a name="management"></a>Управление

Для отображения всех объектов в сцене требуется много дескрипторов, и существуют некоторые стратегии управления, которые могут быть выполнены.

Основная стратегия заключается в том, чтобы заполнить свежую область кучи дескрипторов всеми требованиями для следующего вызова Draw. Таким образом, непосредственно перед выполнением вызова Draw в списке команд указатель таблицы дескриптора будет установлен в начало новой заполненной таблицы. Перемещается, что нет необходимости записывать, где какой-либо конкретный дескриптор находится в куче.

Недостаток этой стратегии заключается в том, что в куче дескрипторов может быть много повторов, особенно при отрисовке очень похожей сцены, и пространство кучи дескрипторов будет быстро использоваться. Отдельные кучи дескрипторов для тех, которые визуализируются на GPU и записываются ЦП, возможно, придется избежать конфликта. Можно также использовать систему подраспределения.

Кроме того, базовая система может быть дополнительно оптимизирована путем аккуратного использования перекрывающихся таблиц дескрипторов из одного вызова Draw к следующему, чтобы были добавлены только новые дескрипторы.

Более эффективная стратегия, чем базовая, может быть предварительно заполнена кучами дескрипторов с помощью дескрипторов, необходимых для объектов (или материалов), которые являются частью сцены. Идея в том, что необходимо только задать таблицу дескрипторов во время рисования, так как куча дескрипторов заполняется заранее.

Разновидность предварительной стратегии заключается в интерпретации кучи дескрипторов как одного огромного массива, содержащего все необходимые дескрипторы в фиксированных известных расположениях. Затем вызов Draw должен получить набор констант, которые являются индексами в массиве, где должны использоваться дескрипторы.

Дальнейшая оптимизация заключается в том, чтобы гарантировать, что корневые константы и корневые дескрипторы содержат наиболее часто меняющиеся, а не размещайте константы в куче дескрипторов. Для большинства аппаратных средств это эффективный способ обработки констант.

На практике графический механизм может использовать другую стратегию в различных ситуациях, а также объединять элементы каждой стратегии в соответствии с определенными требованиями к отрисовке.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Кучи дескрипторов](descriptor-heaps.md)
</dt> </dl>

 

 




