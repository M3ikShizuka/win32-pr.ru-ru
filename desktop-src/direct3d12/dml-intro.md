---
title: Введение в DirectML
description: Direct Машинное обучение (Директмл) — это интерфейс API низкого уровня для машинного обучения (ML).
ms.custom: Windows 10 May 2019 Update
ms.localizationpriority: high
ms.topic: article
ms.date: 04/19/2019
ms.openlocfilehash: 2dd37bc4c27364e26e4bbd4ae2cf5d43031c3314
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "74104261"
---
# <a name="introduction-to-directml"></a>Введение в DirectML

## <a name="summary"></a>Итоги

Direct Машинное обучение (Директмл) — это интерфейс API низкого уровня для машинного обучения (ML). Примитивы машинного обучения с аппаратным ускорением (называемые операторами) являются стандартными блоками Директмл. Из этих стандартных блоков можно разрабатывать такие приемы машинного обучения, как масштабирование, сглаживание и перенос по стилям, а именно несколько. Например, деноисинг и Super-разрешение позволяют достичь впечатляющих райтрацедных эффектов с меньшим количеством лучей на пиксель.

Вы можете интегрировать рабочие нагрузки формирования логических выводов машинного обучения в свою игру, подсистему, ПО промежуточного слоя, серверную часть или другое приложение. Директмл имеет привычный (собственный C++, Nano-COM) интерфейс программирования и рабочий процесс в стиле DirectX 12, который поддерживается всеми DirectX 12-совместимыми аппаратными средствами. Примеры приложений Директмл, в том числе пример минимального приложения Директмл, см. в разделе [примеры приложений директмл](dml-min-app.md).

Директмл введен в Windows 10, версии 1903 и в соответствующей версии Windows SDK.

## <a name="is-directml-appropriate-for-my-project"></a>Подходит ли Директмл для моего проекта?

Директмл — это компонент под управлением [Windows машинное обучение](/windows/ai) . API WinML высшего уровня в основном ориентирован на модели, с рабочим процессом Load-BIND-Evaluate. Но в таких доменах, как игры и модули, обычно требуется более низкий уровень абстракции и более высокая степень управления разработчиком, чтобы воспользоваться всеми преимуществами кристалла. Если вы выберете миллисекунды и засжимаете время кадров, то Директмл будет соответствовать потребностям машинного обучения.

Для надежных сценариев в режиме реального времени, с низкой задержкой и/или с ограниченными ресурсами используйте Директмл (а не WinML). Вы можете интегрировать Директмл непосредственно в существующий модуль или конвейер подготовки к просмотру. Или, на более высоком уровне для пользовательских платформ машинного обучения и по промежуточного слоя, Директмл может предоставить высокопроизводительную серверную часть для Windows.

WinML сам реализуется с помощью Директмл в качестве одной из своих интерфейсов.

## <a name="what-work-does-directml-do-and-what-work-must-i-do-as-the-developer"></a>Действия, выполняемые Директмл. и какую *работу необходимо выполнить* в качестве разработчика?

Директмл эффективно выполняет отдельные уровни модели вывода на GPU (или в ядрах с ускорением искусственного интеллекта, если они есть). Каждый слой является оператором, и Директмл предоставляет библиотеку простых операторов машинного обучения с аппаратным ускорением. Эти операторы имеют специфичные для оборудования и архитектурные оптимизации, разработанные для них (Дополнительные сведения см. в разделе [почему директмл работает правильно?](#why-does-directml-perform-so-well)). В то же время разработчик увидит один независимый от поставщика интерфейс для выполнения этих операторов.

Библиотека операторов в Директмл предоставляет все обычные операции, которые могут быть использованы в рабочей нагрузке машинного обучения.

- Операторы активации, такие как **линейные**, **Релу**, **сигмоидальной**, **tanh** и др.
- Поэлементные операторы, такие как **Add**, **exp**, **log**, **Max**, **min**, **подсистема** и т. д.
- Операторы свертки, такие как 2D и 3D **свертки**, и многое другое.
- Операторы сокращения, такие как **аргмин**, **СРЗНАЧ**, **L2**, **Sum** и др.
- Операторы группирования, такие как **Average**, **LP** и **Max**.
- Операторы нейронной сети (NN), такие как **жемм**, **ГРУ**, **LSTM** и **РНН**.
- И многие другие.

Для максимальной производительности и, чтобы не платить за то, что вы не используете, Директмл помещает элемент управления в себя как разработчик, посвященный выполнению рабочей нагрузки машинного обучения на оборудовании. Определить, какие операторы следует выполнять, и когда, является обязанностью разработчика. В число задач, оставшихся на усмотрение пользователя, входят: фотографировать модель. упрощение и оптимизация слоев; Загрузка весов; выделение ресурсов, привязка, управление памятью (точно так же, как с Direct3D 12); и выполнения графа.

Вы храните высокоуровневые сведения о графах (вы можете жестко закодировать модель напрямую или написать собственный загрузчик модели). Можно спроектировать модель с более масштабным масштабированием, например, используя несколько слоев каждый из операторов **Sample**, **свертки**, **нормализации** и **активации** . Благодаря такому сопоставлению, тщательному планированию и управлению барьерами вы можете извлекать от оборудования большую часть параллелизма и производительности. Если вы разрабатываете игру, тщательное управление ресурсами и контроль над планированием позволяют разгрузить рабочие нагрузки машинного обучения и традиционную работу по отрисовке, чтобы повысить насыщенность GPU.

## <a name="whats-the-high-level-directml-workflow"></a>Что такое высокоуровневый рабочий процесс Директмл?

Ниже приведен обобщенный рецепт того, как мы планируем использовать Директмл. В двух основных этапах инициализации и выполнения вы записываете данные о работе в списки команд, а затем выполняете их в очереди.

### <a name="initialization"></a>Инициализация

1. Создайте ресурсы Direct3D 12 &mdash; : устройство Direct3D 12, очередь команд, список команд и ресурсы, такие как кучи дескрипторов.
2. Так как вы выполняете обучение машинного обучения, а также рабочую нагрузку для подготовки к просмотру, создавайте ресурсы Директмл &mdash; на устройстве директмл и экземплярах операторов. Если у вас есть модель машинного обучения, в которой необходимо выполнить определенный тип свертки с определенным размером фильтра тензорные с определенным типом данных, то все они являются параметрами в операторе **свертки** директмл.
3. Записи Директмл работают в списках команд Direct3D 12. Таким образом, после инициализации вы записываете в список команд привязку и инициализацию (например) оператора свертки. Затем закройте и выполните список команд в своей очереди обычным образом.

### <a name="execution"></a>Выполнение

1. Отправьте свои дополнительные десятки в ресурсы. Тензорные в Директмл представляется с помощью обычного ресурса Direct3D 12. Например, если вы хотите передать данные о весе в GPU, то это выполняется так же, как и с любым другим ресурсом Direct3D 12 (используйте кучу отправки или очередь копирования).
2. Далее необходимо привязать эти ресурсы Direct3D 12 к входным и выходным десяткам. Запись в список команд привязка и выполнение операторов.
3. Закройте и выполните список команд.

Как и в случае с Direct3D 12, вы отвечаете за время существования ресурсов и синхронизацию. Например, не освобождайте объекты Директмл по крайней мере до завершения выполнения на GPU.

## <a name="why-does-directml-perform-so-well"></a>Почему Директмл работает так хорошо?

Есть веская причина, по которой не следует просто писать собственный оператор свертки (например,) как HLSL в [шейдере вычислений](/windows/desktop/direct3d12/pipelines-and-shaders-with-directx-12#direct3d-12-compute-pipeline). Преимущество использования Директмл заключается в том, что помимо экономии усилий от того, что &mdash; вы хомебревинг свое собственное решение, &mdash; у него есть возможность добиться более высокой производительности, чем можно достичь с помощью высокопроизводительного шейдера вычислений общего назначения для таких элементов, как **свертка**, или **LSTM**.

Директмл достигает этой части из-за функции метакоммандс Direct3D 12. Метакоммандс предоставляет черный ящик функциональных возможностей до Директмл, что позволяет поставщикам оборудования предоставлять Директмл доступ к оптимизации, зависящей от оборудования и архитектуры поставщика. Несколько операторов &mdash; , например, для свертки, за которыми следует активация, &mdash; можно объединить в один метакомманд.  Из-за этих факторов Директмл имеет возможность превысить производительность даже очень хорошо написанный, написанный вручную шейдер вычислений, предназначенный для работы на широком оборудовании.

Метакоммандс являются частью API Direct3D 12, хотя они слабо связаны с ним. Метакомманд определяется фиксированным [**идентификатором GUID**](/windows/win32/api/guiddef/ns-guiddef-guid), хотя почти все остальное о нем (от его поведения и семантики до сигнатуры и имени) не является строго частью API Direct3D 12. Вместо этого между автором и драйвером, который его реализует, указывается метакомманд. В этом случае автором является Директмл. Метакоммандс являются примитивами Direct3D 12 (как рисование и отправка), поэтому они могут быть записаны в список команд и запланированы для выполнения вместе.

Директмл ускоряет рабочие нагрузки машинного обучения, используя целый набор метакоммандс машинного обучения. Следовательно, вам не нужно писать зависящие от поставщика пути кода, чтобы добиться аппаратного ускорения при возникновении. Если вы заработаете в микросхеме с использованием искусственного интеллекта, Директмл использует это оборудование для значительного ускорения операций, таких как свертка. Вы можете взять тот же код, который вы написали, без изменения, запустить его на микросхеме, которая не поддерживает AI (возможно, интегрированный графический процессор на ноутбуке), и по-прежнему получит отличное аппаратное ускорение GPU. Если GPU недоступен, Директмл возвращается к ЦП.
