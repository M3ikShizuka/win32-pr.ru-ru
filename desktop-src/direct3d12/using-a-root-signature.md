---
title: Использование корневой подписи
description: Корневая подпись является определением произвольно упорядоченной коллекции таблиц дескрипторов (включая их макет), корневых констант и корневых дескрипторов.
ms.assetid: 0131CDE4-02DB-440A-92B8-B0933C6414B0
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3babe26dc06d4f85ce3d6fb771e18c78b54a3701
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "74104004"
---
# <a name="using-a-root-signature"></a>Использование корневой подписи

Корневая подпись является определением произвольно упорядоченной коллекции таблиц дескрипторов (включая их макет), корневых констант и корневых дескрипторов. Каждая запись имеет стоимость в сторону максимального ограничения, поэтому приложение может выплатить баланс между количеством записей каждого типа, которые будет содержать корневая подпись.

-   [Семантика списка команд](#command-list-semantic)
-   [Семантика пакета](#bundle-semantics)
-   [Связанные темы](#related-topics)

Корневая подпись — это объект, который можно создать с помощью ручного указания в API. Все шейдеры в PSO должны быть совместимы с корневым макетом, заданным в PSO, или, в противном случае отдельные шейдеры должны включать внедренные корневые макеты, которые соответствуют друг другу. в противном случае создание PSO завершится ошибкой. Одним из свойств корневой сигнатуры является то, что шейдеры не должны иметь сведений о них при создании, хотя при необходимости также могут быть созданы корневые подписи непосредственно в шейдере. Для существующих ресурсов шейдера не требуется, чтобы изменения были совместимы с корневыми сигнатурами. Модель шейдера 5,1 введена для предоставления некоторой гибкости (динамическое индексирование дескрипторов из шейдеров) и может быть постепенно реализована начиная с существующих ресурсов шейдера по мере необходимости.

## <a name="command-list-semantic"></a>Семантика списка команд

В начале списка команд корневая подпись не определена. Графические шейдеры имеют отдельную корневую подпись от COMPUTE Shader, каждый из которых задан отдельно в списке команд. Корневой набор сигнатур, заданный для списка команд или пакета, должен также совпадать с текущим набором PSO в Draw или Dispatch. в противном случае поведение не определено. Несоответствие временных корневых подписей перед настройкой или отправкой, например при установке несовместимого PSO перед переключением на совместимую корневую подпись (при условии, что они совместимы с вызовом времени или диспетчеризации). При настройке PSO корневая подпись не изменяется. Приложение должно вызывать выделенный API для установки корневой подписи.

После установки корневой подписи в списке команд макет определяет набор привязок, которые предполагается предоставить приложению, и какие псос можно использовать (скомпилированные с тем же макетом) для следующих вызовов рисования/диспетчеризации. Например, корневая подпись может быть определена приложением для того, чтобы иметь следующие записи. Каждая запись называется "слотом".

-   \[0 \] — встроенный дескриптор CBV (root)
-   \[1 \] Таблица дескрипторов, содержащая 2 СРВС, 1 КБВС и 1 UAV
-   \[2 \] Таблица дескрипторов, содержащая 1 образец
-   \[3 \] 4x32-разрядная коллекция корневых констант
-   \[4 \] Таблица дескрипторов, содержащая неуказанное число СРВС

В этом случае, прежде чем выдавать прорисовку или отправку, приложение должно установить соответствующую привязку для каждого из слотов \[ 0.. 4 \] , которое приложение определило с его текущей корневой подписью. Например, в слот \[ 1 \] Таблица дескрипторов должна быть привязана, то есть непрерывной областью в куче дескрипторов, которая содержит (или будет содержать при выполнении) 2 СРВС, 1 КБВС и 1 UAV. Аналогичным образом необходимо задать таблицы дескрипторов в слотах \[ 2 \] и \[ 4 \] .

Приложение может изменить часть привязок корневой подписи за раз (остальное остается без изменений). Например, если единственное, что необходимо изменить между операциями рисования, — одна из констант в слоте \[ 2 \] , то есть приложению нужно выполнить повторную привязку. Как обсуждалось ранее, версия драйвера или оборудования привязывает состояние привязки корневой подписи, так как оно изменяется автоматически. Если корневая сигнатура изменена в списке команд, все предыдущие привязки корневой сигнатуры устаревают и все вновь ожидаемые привязки должны быть установлены до рисования или диспетчеризации; в противном случае поведение не определено. Если корневая подпись настроена на то же значение, которая уже задана, существующие привязки корневой подписи не устаревают.

## <a name="bundle-semantics"></a>Семантика пакета

Пакеты наследуют привязки корневой подписи списка команд (привязки к различным слотам в приведенном выше примере списка команд). Если пакету необходимо изменить некоторые из наследуемых корневых привязок сигнатур, сначала необходимо задать для корневой подписи то же значение, что и для вызывающего списка команд (унаследованные привязки не устаревают). Если пакет задает для корневой подписи значение, отличное от списка вызывающих команд, то оно имеет тот же результат, что и изменение корневой подписи в списке команд, описанном выше: все предыдущие привязки корневой сигнатуры устарели, и перед началом рисования или диспетчеризации должны быть установлены новые привязки. в противном случае поведение не определено. Если пакету не требуется изменять привязки корневой подписи, не нужно задавать корневую подпись.

В следующем коде показан пример потока вызовов в пакете.

``` syntax
// Command List
...
pCmdList->SetGraphicsRootSignature(pRootSig); // new parameter space
MyEngine_SetTextures(); // bundle inherits descriptor table setting
MyEngine_SetAnimationFactor(fTime); // bundle inherits root constant
pCmdList->ExecuteBundle(...);
...
// Bundle
pBundle->SetGraphicsRootSignature(pRootSig); // same as caller, in order to inherits bindings
pBundle->SetPipelineState(pPS); 
pBundle->SetGraphicsRoot32BitConstant(drawConstantsSlot,0,drawIDOffset);
pBundle->Draw(...); // using inherited textures / animation factor
pBundle->SetGraphicsRoot32BitConstant(drawConstantsSlot,1,drawIDOffset);
pBundle->Draw(...);
...
```

После выхода из пакета любые изменения в корневом макете и (или) привязки изменяются из пакета в список вызывающих команд после завершения выполнения пакета.

Дополнительные сведения о наследовании см. в разделе **наследование состояния графического конвейера** статьи [Управление состоянием графического конвейера в Direct3D 12](managing-graphics-pipeline-state-in-direct3d-12.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Корневые подписи](root-signatures.md)
</dt> </dl>

 

 




