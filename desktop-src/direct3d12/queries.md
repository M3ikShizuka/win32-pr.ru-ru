---
title: Запросы
description: В Direct3D 12 запросы группируются в массивы запросов, которые называются кучами запросов. Куча запроса имеет тип, который определяет допустимые типы запросов, которые могут использоваться с этой кучей.
ms.assetid: d7403b5d-7e1b-4dd2-ae45-52e1153233c6
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 71279c09b59b417535f3155683747ac4c153d7d0fd9f668f79cab9b63ca79805
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119241954"
---
# <a name="queries"></a>Запросы

В Direct3D 12 запросы группируются в массивы запросов, которые называются кучами запросов. Куча запроса имеет тип, который определяет допустимые типы запросов, которые могут использоваться с этой кучей.

-   [Отличия запросов от Direct3D 11 к Direct3D 12](#differences-in-queries-from-direct3d-11-to-direct3d-12)
-   [Кучи запросов](#query-heaps)
-   [Создание куч запросов](#creating-query-heaps)
-   [Извлечение данных из запроса](#extracting-data-from-a-query)
-   [Связанные темы](#related-topics)

## <a name="differences-in-queries-from-direct3d-11-to-direct3d-12"></a>Отличия запросов от Direct3D 11 к Direct3D 12

Следующие типы запросов больше не используются в Direct3D 12, их функции внедряются в другие процессы:

-   **Запросы событий** — события теперь обрабатываются ограждениями.
-   Несвязанные **запросы timestamp** . часы GPU можно установить в стабильное состояние в Direct3D 12 (см. раздел " [время](timing.md) "). Сравнение часов GPU не имеет смысла, если GPU все время бездействует между отметками времени (называемым несвязанным запросом). Благодаря стабильной питанию два запроса с отметкой времени, выданных из разных списков команд, надежно сравнимы. Две отметки времени в одном списке команд всегда являются надежными.
-   **Потоковая статистика вывода запросов** . в Direct3D 12 отсутствует запрос на единичный потоковый выход (т. е.) запросов переполнения для всех выходных потоков. Приложения должны выдавать несколько однопотоковых запросов, а затем сопоставлять результаты.
-   **Потоки выходных статистических данных потока и предиката перекрытия** — запросы (которые выполняют запись в память) и [затенения](predication.md) (которые считывают данные из памяти) больше не связаны, поэтому эти типы запросов не нужны.

К Direct3D 12 добавлен новый тип запроса binary перекрытия. Это позволяет затенения стратегиям, которые повлияли только на то, был ли объект полностью перекрыто или нет (вместо того, сколько пикселей было перекрыто) для обозначения устройства, что может обеспечить более эффективную работу запросов.

## <a name="query-heaps"></a>Кучи запросов

Запросы могут быть одного типа из нескольких типов ([**\_ \_ \_ тип кучи запросов D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_query_heap_type)) и группируются в кучи запросов перед их отправкой в GPU.

Новый тип запроса D3D12 \_ тип запроса \_ \_ Binary \_ перекрытия доступен и действует как D3D12 \_ Query \_ Type перекрытия, \_ за исключением того, что он возвращает двоичный результат 0/1:0 означает, что ни один из образцов не прошел тестирование на глубину и набор элементов, 1 указывает, что по крайней мере в одном из образцов передано тестирование глубины и шаблона. Это позволяет перекрытия запросам не мешать оптимизации производительности GPU, связанной с тестированием глубины или трафарета.

## <a name="creating-query-heaps"></a>Создание куч запросов

API-интерфейсы, относящиеся к созданию кучи запросов, представляют [**собой \_ \_ \_ тип кучи запроса enum D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_query_heap_type), структуру [**D3D12 \_ запроса \_ \_ DESC**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_query_heap_desc)и метод [**креатекуерихеап**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createqueryheap).

Основная среда выполнения проверяет, что тип кучи запросов является допустимым членом перечисления [**\_ \_ типа кучи D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_heap_type) и что значение счетчика больше 0.

Каждый отдельный элемент запроса в куче запросов может запускаться и останавливаться отдельно.

API-интерфейсы для использования куч запросов представляют собой [**\_ \_ тип запроса enum D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_query_type), а также методы [**бегинкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-beginquery) и [**ендкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-endquery).

D3D12 \_ \_ \_ -Метка типа запроса — это единственный запрос, поддерживающий только [**ендкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-endquery) . Для всех остальных типов запросов требуются [**бегинкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-beginquery) и **ендкуери**.

Слой отладки будет проверять следующее:

-   Не допускается начинать запрос метки времени &mdash; , его можно завершить только
-   Недопустимо начинать запрос дважды, не завершая его (для данного элемента). Для запросов, которые должны начинаться и заканчиваться, нельзя завершать запрос до соответствующего begin (для заданного элемента).
-   Тип запроса, передаваемый в [**бегинкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-beginquery) , должен соответствовать типу запроса, переданному в [**ендкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-endquery).

Основная среда выполнения будет проверять следующее:

-   [**Бегинкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-beginquery) не может быть вызван для запроса метки времени.
-   Для типов запросов, которые поддерживают как [**бегинкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-beginquery) , так и [**ендкуери**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-endquery) (все, кроме метки времени), запрос для данного элемента не должен охватывать границы списка команд.
-   *Елементиндекс* должен находиться в пределах диапазона.
-   Тип запроса является допустимым членом перечисления [**\_ \_ типа запроса D3D12**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_query_type) .
-   Тип запроса должен быть совместим с кучей запроса. В следующей таблице показан тип кучи запроса, необходимый для каждого типа запроса:

    

    | Тип запроса                                  | Тип кучи запроса                                |
    |---------------------------------------------|------------------------------------------------|
    | D3D12 \_ , \_ тип запроса \_ перекрытия               | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ перекрытия            |
    | D3D12 \_ \_ тип запроса \_ Binary \_ перекрытия       | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ перекрытия            |
    | \_ \_ Метка времени типа запроса D3D12 \_               | \_ \_ \_ Метка времени типа кучи запроса D3D12 \_            |
    | \_ \_ \_ Статистика конвейера типа запроса D3D12 \_    | \_ \_ \_ \_ Статистика конвейера типа кучи запросов D3D12 \_ |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM0 | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ для \_ статистики       |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM1 | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ для \_ статистики       |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM2 | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ для \_ статистики       |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM3 | \_ \_ Тип КУЧИ запроса \_ D3D12 \_ для \_ статистики       |

    

     

-   Тип запроса поддерживается типом списка команд. В следующей таблице показано, какие запросы поддерживаются для типов списков команд.

    

    | Тип запроса                                  | Поддерживаемые типы списков команд         |
    |---------------------------------------------|--------------------------------------|
    | D3D12 \_ , \_ тип запроса \_ перекрытия               | Прямой доступ                               |
    | D3D12 \_ \_ тип запроса \_ Binary \_ перекрытия       | Прямой доступ                               |
    | \_ \_ Метка времени типа запроса D3D12 \_               | Прямые, вычисленные и при необходимости копирование |
    | \_ \_ \_ Статистика конвейера типа запроса D3D12 \_    | Прямой доступ                               |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM0 | Прямой доступ                               |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM1 | Прямой доступ                               |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM2 | Прямой доступ                               |
    | \_Тип запроса \_ D3D12 \_ , поэтому \_ Statistics \_ STREAM3 | Прямой доступ                               |

    

     

## <a name="extracting-data-from-a-query"></a>Извлечение данных из запроса

Способ извлечения данных из запроса заключается в использовании метода [**ресолвекуеридата**](/windows/win32p/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resolvequerydata) . **Ресолвекуеридата** работает со всеми типами памяти (будь это системная память или локальная память устройства), но требует, чтобы целевой ресурс был в [**D3D12_RESOURCE_STATE_COPY_DEST**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_states). 

## <a name="related-topics"></a>Связанные темы

* [Счетчики и запросы](counters-and-queries.md)
* [Пошаговые инструкции по запросам затенения](predication-queries.md)
