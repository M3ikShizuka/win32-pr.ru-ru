---
title: Общие кучи
description: Общий доступ удобен для многопроцессных и многоадаптерных архитектур.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2019
ms.locfileid: "74104929"
---
# <a name="shared-heaps"></a>Общие кучи

Общий доступ удобен для многопроцессных и многоадаптерных архитектур.

-   [Общие сведения о совместном использовании](#sharing-overview)
-   [Совместное использование куч в процессах](#sharing-heaps-across-processes)
-   [Совместное использование куч в адаптерах](#sharing-heaps-across-adapters)
-   [Связанные темы](#related-topics)

## <a name="sharing-overview"></a>Общие сведения о совместном использовании

Общие кучи позволяют выполнять два действия: совместное использование данных в одной или нескольких процессах и исключает Недетерминированный вариант неопределенного макета текстуры для ресурсов, помещенных в кучу. Совместное использование куч несколькими адаптерами также устраняет необходимость в передаче ЦП данных.

Можно совместно использовать обе кучи и зафиксированные ресурсы. Общий доступ к зафиксированному ресурсу фактически предоставляет неявную кучу вместе с описанием зафиксированного ресурса, так что совместимое описание ресурса может быть сопоставлено с кучей с другого устройства.

Все методы являются свободными потоками и наследуют существующую семантику D3D11 в проектировании совместного использования маркеров NT.

-   [**ID3D12Device:: Креатешаредхандле**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [**ID3D12Device:: Опеншаредхандле**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [**ID3D12Device:: Опеншаредхандлебинаме**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a>Совместное использование куч в процессах

Общие кучи указываются с помощью \_ \_ флага кучи D3D12 \_ Shared Member в перечислении [**\_ \_ флагов кучи D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .

Общие кучи не поддерживаются в кучах, доступных для ЦП: \_ \_ Отправка типа кучи D3D12 \_ , \_ тип D3D12 \_ \_ реадбакк и \_ тип кучи D3D12 \_ \_ Custom без \_ Свойства страницы D3D12 ЦП \_ \_ \_ \_ недоступны.

Отсутствие детерминированного выбора неопределенного макета текстуры может значительно отрушить работу сценариев отложенной отрисовки на некоторых графических процессорах, поэтому он не является поведением по умолчанию для размещенных и зафиксированных ресурсов. Отложенная отрисовка не связана с некоторыми архитектурами GPU, так как детерминированные макеты текстур уменьшают эффективную пропускную способность памяти при одновременной отрисовке на несколько текстур целевых изображений одного и того же формата и размера. Архитектуры GPU развиваются от использования недетерминированных макетов текстур для поддержки стандартизованных шаблонов свиззле и оптимальных стандартизированных макетов для отложенной отрисовки.

Общие кучи также поставляются с другими небольшими затратами:

-   Данные общей кучи не могут быть повторно запущены в виде гибких куч из-за проблем раскрытия информации, поэтому физическая память чаще всего зеро'ед.
-   При создании и уничтожении общих куч возникает незначительная дополнительная нагрузка на ЦП и повышение использования системной памяти.

## <a name="sharing-heaps-across-adapters"></a>Совместное использование куч в адаптерах

Общие кучи для адаптеров указываются с помощью \_ \_ \_ элемента Shared Cross Adapter флага кучи D3D12 \_ \_ в перечислении [**\_ \_ флагов кучи D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .

Общие кучи перекрестных адаптеров позволяют нескольким адаптерам совместно использовать данные без использования ЦП, который маршалирует данные между ними. В то время как различные возможности адаптера определяют, как эффективные адаптеры могут передавать данные между ними, просто включение копий GPU увеличивает эффективность пропускной способности. Некоторые макеты текстур разрешены в кучах кросс адаптеров для поддержки обмена данными текстуры, даже если такие макеты текстур не поддерживаются иным образом. К таким текстурам могут применяться определенные ограничения, например, только поддерживающие копирование.

Совместное использование между адаптерами работает с кучами, созданными путем вызова [**ID3D12Device:: CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap). Затем приложения могут создавать ресурсы через [**креатеплацедресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource). Кроме того, она разрешена ресурсами и кучами, созданными [**креатекоммиттедресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , но только для \_ ресурсов D3D12 ресурсов \_ TEXTURE2D измерения ресурса \_ (см. [**D3D12 \_ ресурс \_ Dimension**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)). Совместное использование между адаптерами не работает с [**креатересерведресаурце**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).

Для совместного использования между адаптерами по-прежнему применяются все стандартные правила совместного использования ресурсов в разных очередях. Приложения должны выдать соответствующие барьеры, чтобы обеспечить правильную синхронизацию и согласованность между двумя адаптерами. Приложения должны использовать межадаптерные ограждения для координации планирования списков команд, отправленных на несколько адаптеров. Механизм совместного использования ресурсов между адаптерами в версиях D3D API отсутствует. Общие ресурсы для разных адаптеров поддерживаются только в системной памяти. Общие кучи и ресурсы перекрестных адаптеров поддерживаются в куче D3D12 \_ \_ типа кучи \_ по умолчанию и в \_ \_ \_ пользовательских кучах D3D12 типа кучи (с пулом памяти на уровне 0 и со свойствами страницы ЦП для записи и объединения). Драйверы должны быть уверены, что операции чтения и записи GPU для общих куч между адаптерами согласованы с другими графическими процессорами в системе. Например, драйверу может потребоваться исключить данные кучи из кэша GPU, которые обычно не нужно сбрасывать, если ЦП не может напрямую получить доступ к данным кучи.

Приложения должны ограничивать использование куч между адаптерами только теми сценариями, для которых требуются предоставляемые ими функции. Кучи между адаптерами находятся в \_ пуле памяти D3D12 уровня \_ \_ 0, что не всегда предлагает [**жеткустомхеаппропертиес**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) . Этот пул памяти неэффективен для отдельных архитектур адаптеров и NUMA. И самые эффективные макеты текстур не всегда доступны.

Также действуют следующие ограничения.

-   Флаги кучи, связанные с уровнями кучи, должны \_ иметь \_ флаг D3D12 heap \_ , позволяющий использовать \_ все \_ буферы \_ и \_ текстуры.
-   \_ \_ \_ Также должен быть задан флаг общей кучи D3D12.
-   Необходимо задать \_ значение \_ \_ по умолчанию для типа кучи D3D12 или задать \_ тип D3D12 \_ для типа кучи \_ Custom с D3D12 \_ памяти \_ \_ 0, а \_ \_ свойство страницы ЦП D3D12 \_ \_ \_ — недоступно.
-   Только ресурсы с \_ \_ флагом ресурса D3D12 \_ Разрешить \_ перекрестный \_ адаптер можно разместить в кучах между адаптерами.

Дополнительные сведения об использовании нескольких адаптеров см. в разделе о [системах с несколькими адаптерами](multi-engine.md) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Подраспределение в кучах](suballocation-within-heaps.md)
</dt> </dl>

 

 




