---
title: Счетчики UAV
description: Счетчики неупорядоченного представления доступа (UAV) можно использовать для связывания 32-разрядного атомарного счетчика с неупорядоченным представлением доступа (UAV).
ms.assetid: 0B77E238-E8CF-466B-9188-3DE96AF97F42
ms.localizationpriority: high
ms.topic: article
ms.date: 02/10/2020
ms.openlocfilehash: 94bc1492e3b984d96c76788430d2e63c0672ca76
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127242872"
---
# <a name="uav-counters"></a>Счетчики UAV
Счетчики неупорядоченного представления доступа (UAV) можно использовать для связывания 32-разрядного атомарного счетчика с неупорядоченным представлением доступа (UAV).

## <a name="differences-in-uav-counters-from-direct3d-11-to-direct3d-12"></a>Различия в счетчиках UAV с Direct3D 11 до Direct3D 12
Приложения Direct3D 12 и Direct3D 11 используют одни и те же функции шейдера высокого уровня шейдеров (HLSL) для доступа к счетчикам UAV.

-   **инкременткаунтер**
-   **декременткаунтер**
-   **Append**
-   **Использование**

### <a name="direct3d-12"></a>Direct3D 12
В Direct3D 12 32-битные значения выделяются приложением, поэтому 32-разрядные значения могут быть считаны и записаны либо ЦП, либо GPU, как и любой другой ресурс Direct3D 12.

### <a name="direct3d-11"></a>Direct3D 11
За пределами шейдеров с помощью Direct3D 11 необходимо вызывать методы API для доступа к счетчикам (например, [ссылку ID3D11DeviceContext:: копиструктурекаунт](/windows/win32/api/d3d11/nf-d3d11-id3d11devicecontext-copystructurecount)).

## <a name="using-uav-counters"></a>Использование счетчиков UAV
Приложение отвечает за выделение 32-разрядов хранилища для счетчиков UAV. Это хранилище можно выделить в другом ресурсе, который содержит данные, доступные через UAV.

См. [**креатеунордередакцессвиев**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createunorderedaccessview), [**D3D12 \_ buffer \_ UAV \_ flags**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_buffer_uav_flags) и [**D3D12 \_ buffer \_ UAV**](/windows/desktop/api/d3d12/ns-d3d12-d3d12_buffer_uav).

Если в вызове [**креатеунордередакцессвиев**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createunorderedaccessview)указан *пкаунтерресаурце* , то существует счетчик, связанный с UAV. В данном случае:

-   *Структуребитестриде* должно быть больше нуля
-   Формат должен быть \_ \_ неизвестным в формате DXGI
-   Не следует задавать флаг RAW
-   Оба ресурса должны быть буферами
-   *Каунтероффсетинбитес* должен быть кратен 4 байтам
-   *Каунтероффсетинбитес* должен находиться в диапазоне ресурса счетчика
-   *пдеск* не может иметь значение null
-   *предисходный код* не может иметь значение null

И обратите внимание на следующие случаи использования:

-   Если *пкаунтерресаурце* не указан, то *каунтероффсетинбитес* должен быть равен 0.
-   Если флаг RAW установлен, то формат должен быть в формате DXGI \_ \_ R32 без \_ типов, а ресурс UAV должен быть буфером.
-   Если *пкаунтерресаурце* не задан, то *каунтероффсетинбитес* должен быть равен 0.
-   Если флаг RAW не установлен и *структуребитестриде* = 0, то формат должен быть допустимым форматом UAV.

Direct3D 12 устраняет различие между Append и Counter Уавс (хотя различие по-прежнему существует в байтах HLSL).

Основная среда выполнения будет проверять эти ограничения в [**креатеунордередакцессвиев**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createunorderedaccessview).

Во время рисования или диспетчеризации ресурс счетчика должен находиться в состоянии [**ресурса D3D12 \_ \_ \_ неупорядоченный \_ доступ**](/windows/desktop/api/d3d12/ne-d3d12-d3d12_resource_states). Кроме того, в рамках одного вызова рисования/отправки приложение не может получить доступ к одному и тому же 32-разрядному расположению памяти через два отдельных счетчика UAV. Если обнаружен один из этих элементов, отладочный слой выдаст ошибки.

Методы "Сетунордередакцессвиевкаунтервалуе" и "Копиструктурекаунт" отсутствуют, так как приложения могут просто копировать данные в значение счетчика напрямую и обратно.

Поддерживается динамическое индексирование Уавс с счетчиками.

Если шейдер пытается получить доступ к счетчику UAV, у которого нет связанного счетчика, то отладочный слой выдаст предупреждение, и произойдет ошибка страницы GPU, из-за чего будет удалено устройство приложения.

Счетчики UAV поддерживаются во всех типах куч (по умолчанию, upload, реадбакк).

## <a name="related-topics"></a>Связанные темы

* [Счетчики и запросы](counters-and-queries.md)