---
title: Стратегии управления памятью
description: Диспетчер памяти для Direct3D 12 может очень усложнить работу со всеми различными уровнями поддержки, для сетевых карт, а также с существенным спектром различий в архитектуре между адаптерами GPU. Рекомендуемой стратегией для управления памятью Direct3D 12, описанной в этом разделе, является \ 0034; классификация, бюджет и поток \ 0034;.
ms.assetid: BC9894F7-D496-46F2-A5C3-C7CA31FD4BA8
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dad04055a5acdeeeaead3a56f0bd04e64aa90fe0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104548981"
---
# <a name="memory-management-strategies"></a>Стратегии управления памятью

Диспетчер памяти для Direct3D 12 может очень усложнить работу со всеми различными уровнями поддержки, для сетевых карт, а также с существенным спектром различий в архитектуре между адаптерами GPU.

Рекомендуемой стратегией для управления памятью Direct3D 12, описанной в этом разделе, является классификация, бюджет и поток.

-   [Типы ресурсов](#resource-types)
-   [Бюджет памяти](#memory-budget)
-   [Стратегия классификации](#classification-strategy)
-   [Связанные темы](#related-topics)

## <a name="resource-types"></a>Типы ресурсов

Основная концепция «выделенного ресурса» (создание как виртуальных, так и физических адресных пространств, инициализированных в управляемой физической памяти) была выполнена с момента Direct3D 9, хотя виртуальная адресация (ва) и физическая адресация могут быть теаседы в Direct3D 12, что позволяет приложению аккуратно управлять физической памятью.

Помимо зафиксированных ресурсов, конструкция кучи Direct3D 12 включает два других типа ресурсов: "помещено" и "зарезервировано". В Direct3D 11 «зарезервированный» ресурс назывался «мозаичным ресурсом».

Зарезервированные ресурсы отличаются от размещенных ресурсов в том, что зарезервированные ресурсы имеют собственное уникальное виртуальное адресное пространство GPU. Это позволяет получить большой объем пространства на сервере, а затем включает сопоставление страниц ва с определенными частями кучи, и приложение перестраивает размещение в режиме реального времени. Неупорядоченное пространство является непрерывным, и его можно разреженно сопоставить с.

Зарезервированный ресурс можно создать для ссылок на регионы в куче с помощью вызовов API, таких как [**упдатетилемаппингс**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-updatetilemappings) , и их можно сделать резидентными в приложении, обновив таблицы страниц в режиме реального времени. Если диапазон номеров ва сопоставлен со значением NULL или нерезидентной кучей, эта часть ресурса считается нерезидентной. Когда диапазон ва сопоставляется с резидентной кучей, эта часть ресурса считается резидентной. Кучи выводятся после создания.

Размещенные ресурсы — это гораздо более простой проект, который просто является указателем на определенную область кучи (например, 1 МБ для текстуры в куче размером 5 МБ). Барьеры с псевдонимами позволяют использовать пересекающиеся размещенные ресурсы (см. [**креатеплацедресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createplacedresource) и [**ресаурцебарриер**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-resourcebarrier)).

Зарезервированные ресурсы доступны не на всех устройствах с Direct3D 12, а размещенные ресурсы являются разумным резервом, хотя размещенные ресурсы должны быть непрерывными и не могут быть частично резидентными.

## <a name="memory-budget"></a>Бюджет памяти

В Direct3D 12 при выделении кучи вы создаете аспект физической памяти выделенного ресурса. Более явный выбор сегмента памяти доступен в Direct3D 12 (выбор между видео и системной памятью). Адаптеры с памятью имеют только один сегмент памяти, системную память.

Графические процессоры не поддерживают сбои страниц, поэтому разработчики должны понимать, что они не зафиксированы, особенно в системах, скажем, всего 1 ГБ системной памяти. Если приложение выполняет принудительную фиксацию, операционная система использует планирование процессов с недетализированным распределением по требованию к физической памяти. Планировщик будет заморозить процессы переднего плана и, по сути, страницу в фоновом процессе, который требуется выполнить. Доступная физическая память может значительно варьироваться в зависимости от того, что делает пользователь в фоновом режиме (например, запуск браузера или просмотр видео).

API для бюджета памяти — [**куеривидеомеморинфо**](/windows/desktop/api/dxgi1_4/nf-dxgi1_4-idxgiadapter3-queryvideomemoryinfo). Для дискретных адаптеров "локальным" является видеопамять, а "Нелокальная" — системная память. Для адаптеров с областью памяти, не являющимся локальным, всегда равен нулю. Один вопрос проектирования заключается в том, будет ли модуль управлять бюджетом или только локальным бюджетом. Управлять только локальным бюджетом проще, но имеет несколько предостережений. Например, предположим, что существует максимальный локальный бюджет, равный 1 ГБ, а все кучи поступают от этого 1 ГБ в системе с областью памяти, и нет переполнения системной память (очевидно, что нет).

Так как управляемая память Direct3D11 для приложений, неиспользуемые ресурсы, по сути, будут выдаваться из страницы.

Выберите наиболее подходящие размеры ресурсов. Определите, подходит ли размер ресурса для ситуации, когда приложение фактически выполняется в. Некоторые пользователи могут запускать приложение в окне или с разрешением экрана 800x600.

## <a name="classification-strategy"></a>Стратегия классификации

Чтобы эффективно управлять ресурсами в сценариях, связанных с памятью, рассмотрите возможность классификации ресурсов в следующих целях:



| Классификация      | Примеры                                                                                         | Объекты и функции API                                                                                           | Примечания по управлению                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|---------------------|--------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Критически важно            | Пользовательский интерфейс игры                                                                                          | Распределитель команд, очереди команд, кучи запросов, ресурсы и кучи ресурсов.                                      | Эти элементы должны находиться в нестраничном или постоянно выделенном объеме памяти.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Масштабированный/необязательный    | Модели и текстуры для конкретных уровней, цепочки подкачки, небесные поля, модели символов первого исполнителя | Ресурсы и кучи. Зафиксированные ресурсы, но также размещенные и зарезервированные ресурсы могут работать так же.          | Интеграция местонахождение памяти бюджетирование в алгоритмы подготовки к просмотру. Выберите соответствующий уровень доступности и повторно оцените его менее одного кадра. Методы включают использование ресурсов переменного размера и масштабирование цепочки буферов.<br/>                                                                                                                                                                                                                                                                                                                                                 |
| Повторно используемые ресурсы   | Теневые буферы, ресурсы отложенной отрисовки, пост-обработка ресурсов, кэши данных освещения    | Ресурсы и кучи. Перекрывающиеся ресурсы, размещенные в кучах и барьерах.                                  | Повторно используйте большие ресурсы или области кучи в кадре, чтобы выделять все требования для всего фрейма. Используйте метод повторного использования памяти внутри фрейма. В Direct3D 11 приложения могут повторно использовать ресурсы с одинаковым типом и, возможно, иметь достаточно большой размер. Кучи Direct3D 12 позволяют перекрывать ресурсы для более простого и многократного использования.<br/>                                                                                                                                                                                                                              |
| Ресурсы потоковой передачи | Ландшафта, замкнутый и геометрический текстуры                                                        | Ресурсы и кучи. Создание свободных потоков ЦП и списков с очередями и списками команд в фоновом режиме. | Частичная местонахождение, обычно основанная на видимости (с использованием представления-фрустум или оценки на основе расстояния) и повторное вычисление местонахождение требует каждого кадра.<br/> Метод использования частичного управления местонахождение для отдельных плиток и повторного использования между кадрами доступен, когда адаптер GPU поддерживает зарезервированные ресурсы в кучах.<br/> Используя метод повторного использования памяти в кадрах, можно выполнить частичное местонахождение подресурса, но он является менее оптимальным. Размещенные ресурсы с кучами должны обеспечить более быстрый перезапуск, но зафиксированные ресурсы можно использовать в качестве резервного.<br/> |



 

Чем больше приложений гравитате потоковые ресурсы для большей части работы, тем больше они будут использовать размещенные и зарезервированные ресурсы, что позволит максимально увеличить объем памяти между этими четырьмя классификациями. Чем больше поток приложений, тем больше бюджет и тем более приоритетна пропускная способность.

Обычно с модулями обработки графики Direct3D 12 необходимо учитывать более разнообразный и динамический бюджет, а также делать это более строго, чем раньше. Лучшие приложения будут размещать все четыре категории в бюджете, указанном в процессе, и масштабировать игру из фонового мобильного приложения в полноэкранные дискретные бюджеты. Но многие приложения, скорее всего, будут испытывать трудности, начиная с слишком большого числа критических типов ресурсов. Ресурсы с поддержкой Direct3D 11 должны быть анонимно созданы и занимать критическое состояние без влияния на производительность. Однако для Direct3D 12 разработчики должны тщательно искать ресурсы, созданные случайным образом, на основе их механизма и по промежуточного слоя, а затем повторно назначать их одной из других категорий.

Другими проблемными областями являются компоненты по промежуточного слоя, пользовательские элементы управления и потоковая передача внутри фрейма. Компоненты по промежуточного слоя могут быть недоступными для бюджета и не должны работать тесно вместе. Компоненты по промежуточного слоя, вероятно, могут предоставлять функции как методы отрисовки; и приложение может полагаться на предоставление параметров по промежуточного слоя и подсистемы. Разработчики могут использовать Direct3D 11 для разбиения на страницы и достижения правильного темпа кадров. В некоторых случаях приложения Direct3D 11 могут быть помещены в содержимое каждого кадра и постранично. и это привело к приемлемым частоте кадров для пользователя. Большинство ядер просто потокируют данные ресурсов как фоновые действия, где они не имеют корректного перехода к потоковой передаче с высоким приоритетом внутри фрейма. Попросите обработчиков реализовать, который будет разрушить часть ресурсов ЦП, которые они хотят найти, переместив на Direct3D 12. Разработчики подсистемы могут рассмотреть возможность шутки их кадров в этапы, чтобы предоставить больше возможностей для повторного использования ресурсов. и, вероятно, работают с поставщиками по промежуточного слоя для поддержки размещенных ресурсов и куч для повторного использования памяти внутри фрейма.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**креатекоммиттедресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createcommittedresource)
</dt> <dt>

[**креатересерведресаурце**](/windows/desktop/api/d3d12/nf-d3d12-id3d12device-createreservedresource)
</dt> <dt>

[Руководство по программированию для Direct3D 12](directx-12-programming-guide.md)
</dt> <dt>

[Управление памятью](memory-management.md)
</dt> <dt>

[Привязка ресурсов](resource-binding.md)
</dt> </dl>

 

