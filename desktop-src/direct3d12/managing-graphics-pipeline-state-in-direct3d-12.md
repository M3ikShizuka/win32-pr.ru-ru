---
title: Управление состоянием графического конвейера в Direct3D 12
description: В этом разделе описывается, как задается состояние графического конвейера в Direct3D 12.
ms.assetid: AAF97BD2-D532-469D-9242-CC94C06727C3
keywords:
- состояние конвейера
- объект состояния конвейера
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7564b5863d3efebdf8a335e2c46945aeebea93e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104549049"
---
# <a name="managing-graphics-pipeline-state-in-direct3d-12"></a>Управление состоянием графического конвейера в Direct3D 12

В этом разделе описывается, как задается состояние графического конвейера в Direct3D 12.

## <a name="pipeline-state-overview"></a>Общие сведения о состоянии конвейера

Когда геометрия отправляется в графический процессор (GPU) для прорисовки, существует широкий спектр параметров оборудования, определяющих интерпретацию и визуализацию входных данных. В совокупности эти параметры называются состоянием графического конвейера и включают общие параметры, такие как состояние средства прорисовки, состояние смешения и состояние трафарета глубины, а также тип топологии примитива отправленной геометрии и шейдеры, которые будут использоваться для отрисовки. В Microsoft Direct3D 12 большинство состояний графического конвейера задаются с помощью объектов состояния конвейера (PSO). Приложение может создавать неограниченное количество этих объектов, представленное интерфейсом [**ID3D12PipelineState**](/windows/win32/api/d3d12/nn-d3d12-id3d12pipelinestate) , как правило, во время инициализации. Затем, во время отрисовки списки команд могут быстро переключать несколько параметров состояния конвейера, вызывая [**ID3D12GraphicsCommandList:: сетпипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate) в списке прямых команд или наборе для установки активного PSO.

В Direct3D 11 состояние графического конвейера было объединено в крупные объекты состояния с небольшими гранями, такие как [**ID3D11BlendState**](/windows/win32/api/d3d11/nn-d3d11-id3d11blendstate) , которые можно создать и задать во время отрисовки в мгновенном контексте с помощью таких методов, как [**ссылку ID3D11DeviceContext:: омсетблендстате**](/windows/win32/api/d3d10/nf-d3d10-id3d10device-omsetblendstate). Идея этого заключается в том, что GPU может повысить эффективность, установив связанные параметры, такие как параметры состояния смешения, все сразу. Однако в современных графических устройствах существуют зависимости между различными единицами оборудования. Например, состояние смешения оборудования может иметь зависимости от растрового состояния, а также от состояния смешения. Псос в Direct3D 12 был разработан таким образом, чтобы позволить GPU предварительно обрабатывать все зависимые параметры в каждом из состояний конвейера, как правило, во время инициализации, чтобы переключаться между состояниями во время визуализации как можно быстрее.

Обратите внимание, что хотя большая часть параметров состояния конвейера задается с помощью псос, существуют некоторые параметры состояния, которые задаются отдельно с помощью интерфейсов API, предоставляемых [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist). Эти параметры и связанные API подробно обсуждаются ниже. Кроме того, существуют различия в способе наследования состояния графического конвейера и их сохранение из списков прямых команд и пакетов. В этом разделе содержатся сведения по обоим этим темам.

## <a name="graphics-pipeline-states-set-with-pipeline-state-objects"></a>Состояния графического конвейера, заданные с помощью объектов состояния конвейера

Самый простой способ просмотреть все состояния конвейера, которые можно задать с помощью объекта состояния конвейера, — Просмотреть справочный раздел о [**\_ состоянии D3D12 графического \_ конвейера \_ \_**](/windows/win32/api/d3d12/ns-d3d12-d3d12_graphics_pipeline_state_desc) , который передается в [**ID3D12Device:: креатеграфикспипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-creategraphicspipelinestate) при инициализации объекта. Краткий обзор состояний, которые можно задать, включает:

-   Байтовый код для всех шейдеров, включая, вершинные, пиксельные, доменные, поверхности и геометрические шейдеры.
-   Входной формат вершины.
-   Тип топологии примитива. Обратите внимание, что тип топологии примитива input-Assembler (точка, линия, треугольник, исправление) задан в PSO с помощью перечисления [**\_ \_ \_ типа D3D12-примитива**](/windows/win32/api/d3d12/ne-d3d12-d3d12_primitive_topology_type) . Примитивное соседство и упорядочивание (список строк, полоса строк, полоса строк с смежными данными и т. д.) задаются в списке команд с помощью метода [**ID3D12GraphicsCommandList:: иасетпримитиветопологи**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-iasetprimitivetopology) .
-   Состояние смешения, состояние средства отображения программной прорисовки, состояние трафарета глубины.
-   Набор элементов глубины и форматы целевого объекта прорисовки, а также количество целевых объектов рендеринга.
-   Параметры с несколькими образцами.
-   Потоковый выходной буфер.
-   Корневая подпись. Дополнительные сведения см. в разделе [корневые подписи](root-signatures.md).

## <a name="graphics-pipeline-states-set-outside-of-the-pipeline-state-object"></a>Состояния графического конвейера, установленные за пределами объекта состояния конвейера

Большинство состояний конвейера графики задаются с помощью псос. Однако существует набор параметров состояния конвейера, которые задаются путем вызова методов интерфейса [**ID3D12GraphicsCommandList**](/windows/win32/api/d3d12/nn-d3d12-id3d12graphicscommandlist) из списка команд. В следующей таблице показаны состояния, которые устанавливаются таким образом и соответствующие методы.

|Состояние|Метод|
|-|-|
|Привязки ресурсов|[**иасетиндексбуффер**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-iasetindexbuffer)<br/>[**иасетвертексбуфферс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-iasetvertexbuffers)<br/>[**сосеттаржетс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-sosettargets)<br/>[**омсетрендертаржетс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-omsetrendertargets)<br/>[**сетдескрипторхеапс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps)<br/>Все методы **сетграфиксрут...**<br/>Все методы **сеткомпутерут...**<br/>
|Окна просмотра|<a href="/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-rssetviewports">**рссетвиевпортс**</a>|
|Прямоугольные прямоугольники|<a href="/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-rssetscissorrects">**рссетсЦиссорректс**</a>|
|Коэффициент смешения|<a href="/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-omsetblendfactor">**омсетблендфактор**</a>|
|Значение ссылки на трафарет глубины|<a href="/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-omsetstencilref">**омсетстенЦилреф**</a>|
|Порядок примитивной топологии и тип соседства для входного ассемблера|<a href="/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-iasetprimitivetopology">**иасетпримитиветопологи**</a>|

## <a name="graphics-pipeline-state-inheritance"></a>Наследование состояния графического конвейера

Так как списки прямых команд обычно предназначены для одного использования одновременно, а пакеты предназначены для многократного использования одновременно, существуют различные правила наследования состояния графического конвейера, заданные предыдущими списками команд или пакетами.

Для состояний графического конвейера, заданных с помощью псос, ни одно из этих состояний не наследуется ни в одном из списков прямых команд, ни пакетов. Начальное состояние графического конвейера для списков прямых команд и пакетов устанавливается во время создания с параметром [**ID3D12PipelineState**](/windows/win32/api/d3d12/nn-d3d12-id3d12pipelinestate) в [**ID3D12Device:: креатекоммандлист**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommandlist). Если в вызове не указано PSO, используется начальное состояние по умолчанию. Вы можете изменить текущий PSO в списке команд, вызвав [**ID3D12GraphicsCommandList:: сетпипелинестате**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setpipelinestate).

Прямые списки команд также не наследуют состояние, заданное с помощью методов списка команд, таких как [**рссетвиевпортс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-rssetviewports). Дополнительные сведения о начальных значениях по умолчанию для состояний, отличных от PSO, см. в разделе [**ID3D12GraphicsCommandList:: клеарстате**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-clearstate).

Пакеты наследуют все состояние графического конвейера, которое не задано параметром псос, за исключением типа "примитивная топология". Для топологии примитива всегда задано значение [**D3D12- \_ примитивный \_ \_ тип топологии \_ undefine**](/windows/win32/api/d3d12/ne-d3d12-d3d12_primitive_topology_type) , когда пакет начинает выполняться. Любое состояние, заданное в пакете (самого PSO, не-PSOного состояния и привязки ресурсов), влияет на состояние родительского списка прямых команд. Например, если в наборе вызывается [**рссетвиевпортс**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-rssetviewports) , то указанные окна просмотра будут по-прежнему задаваться в родительском списке прямых команд для вызовов, которые появятся после вызова [**ексекутебундле**](/windows/win32/api/d3d12/nf-d3d12-id3d12graphicscommandlist-executebundle) , в котором заданы окна просмотра.

Привязки ресурсов, заданные в списке команд или пакете, сохраняются. Так что привязки ресурсов, измененные в списке прямых команд, будут по-прежнему задаваться в рамках последующего выполнения дочернего пакета. И привязки ресурсов, измененные из пакета, будут по-прежнему установлены для последующих вызовов в родительском списке прямых команд.

Дополнительные сведения о привязках см. в разделе **семантика пакета** в статье [Использование корневой сигнатуры](using-a-root-signature.md).

## <a name="related-topics"></a>Связанные темы

* [Отправка рабочих заданий в Direct3D 12](command-queues-and-command-lists.md)