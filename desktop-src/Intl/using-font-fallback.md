---
description: Использование отката шрифта
ms.assetid: 952f33b6-ca52-40a2-b914-52c1c62ae0e0
title: Использование отката шрифта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db9a4e9b329e2c3257ae9fad02f1fb4774a63dc1d4b4e804c0dca8e690cbf4d0
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119787874"
---
# <a name="using-font-fallback"></a>Использование отката шрифта

> [!Note]  
> В этом разделе все замечания о [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) применяются одинаково к [**скриптшапеопентипе**](/windows/desktop/api/Usp10/nf-usp10-scriptshapeopentype).

 

Приложение должно использовать откат шрифтов во время вывода текста, если некоторые символы в строке не поддерживаются в шрифте или если приложение использует [сложный скрипт](uniscribe-glossary.md) , не поддерживаемый шрифтом. Требование отката шрифта определяется во время процесса макета для текста, когда приложение вызывает функцию [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) . Сведения о отображении текста см. [в разделе Отображение текста с помощью Uniscribe](displaying-text-with-uniscribe.md).

## <a name="determine-the-need-for-font-fallback-for-unsupported-characters"></a>Определение необходимости резервирования шрифтов для неподдерживаемых символов

Если некоторые символы в строке не поддерживаются в запрошенном шрифте, вызов приложения [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) будет выполнен. Однако приложение должно проверить выходной буфер глифов на наличие отсутствующих глифов. Индекс глифа отсутствующего глифа может быть определен для определенного шрифта путем вызова [**скриптжетфонтпропертиес**](/windows/desktop/api/Usp10/nf-usp10-scriptgetfontproperties). Если конкретный глиф недоступен, приложение должно либо вернуться к другому шрифту для глифа, либо визуализировать графический символ, указывающий на отсутствие доступных глифов.

## <a name="determine-the-need-for-font-fallback-for-unsupported-complex-scripts"></a>Определение необходимости резервирования шрифтов для неподдерживаемых сложных наборов символов

Шрифт, предпочитаемый приложением для вывода, может не поддерживать сложные сценарии, необходимые для текста. В этом случае вызов приложения в [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) завершается сбоем с кодом ошибки E, \_ \_ отсутствующим \_ в \_ шрифте.

## <a name="assign-a-fallback-font"></a>Назначение резервного шрифта

После определения того, что требуется откат шрифта, приложение должно назначить резервный шрифт. Приложение может использовать следующие методы:

-   Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) для каждого шрифта в списке шрифтов, пока один вызов не будет иметь допустимый возврат.
-   Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) с каждым шрифтом в списке, пока не сможете определить, что шрифт не будет выполнен. Если код ошибки всегда имеет \_ \_ \_ \_ нешрифтовый сценарий, то шрифты не поддерживаются сложным сценарием. Либо отрисовывает графический символ, указывающий, что нет доступных глифов, либо переопределите скрипт как неопределенный (без обработки скрипта) и начните снова. Чтобы задать для скрипта значение undefine, установите для элемента **ескрипт** структуры [**\_ анализа скрипта**](/windows/win32/api/usp10/ns-usp10-script_analysis) значение \_ undefine script.
-   Вызывайте [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape) с каждым шрифтом в списке, пока не сможете определить, что шрифт не будет выполнен. Если код ошибки указывает, что некоторые символы сопоставлены с отсутствующими глифами, разбейте строку на меньшие диапазоны. Для поддиапазонов можно назначить различные шрифты, чтобы можно было отобразить больше символов.

## <a name="generate-glyph-information"></a>Создание сведений о глифе

После того, как приложение назначило шрифт, который проходит через вызовы [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape), он может вызвать [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace) , чтобы создать ширину и объемное смещение глифа из выходных данных **скриптшапе**. Шрифт должен быть выполнен в этих вызовах. Сбой шрифта при вызове **скриптплаце** после успешного выполнения в вызове **скриптшапе** указывает на поврежденный шрифт.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование Uniscribe](using-uniscribe.md)
</dt> </dl>

 

 



