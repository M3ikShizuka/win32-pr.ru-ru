---
description: служба хранилища жестко запрограммированных строк в реестре является частью модели локализации до Windows Vista.
ms.assetid: 70185942-7d32-4151-a4e1-f71cf45e87af
title: Использование перенаправления строк реестра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30f0804d0586f8340e5a84e9da9c82ca39ffc30b55f72f4695d5216cbb26aab6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118389420"
---
# <a name="using-registry-string-redirection"></a>Использование перенаправления строк реестра

служба хранилища жестко запрограммированных строк в реестре является частью модели локализации до Windows Vista. Он не поддерживается многоязыковым интерфейсом. В текущей модели пользовательский интерфейс для операционной системы выполняется в файлах ресурсов, зависящих от языка, поверх базы, не зависящей от языка. Компоненты операционной системы используют реестр независящим от языка способом.

MUI использует только перенаправленные строки реестра, определенные ресурсами Win32 PE в файле ресурсов базового языка. Перенаправление определяется отдельно, например в INF-файле. Этот тип хранилища позволяет загрузчику ресурсов автоматически выбирать нужные языковые ресурсы при загрузке модуля ресурсов.

> [!Note]  
> Этот раздел относится только к ресурсам Win32 PE. При использовании ресурсов, отличных от Win32, при необходимости необходимо указать настраиваемое Перенаправление строки реестра.

 

## <a name="create-a-language-neutral-resource"></a>Создание Language-Neutral ресурса

приложение MUI, работающее в Windows Vista и более поздних версиях, использует строковый ресурс, не зависящий от языка, чтобы предоставить доступ к строкам, относящимся к конкретному языку, хранящимся в таблице строк Код приложения, считывающий эти значения из реестра, описан в разделе Загрузка Language-Neutral значения реестра статьи [Поиск перенаправленных строк](locating-redirected-strings.md).

Данные для значения реестра, не зависящего от языка, имеют формат " `@<PE-path>,-<stringID>[;<comment>]` ", где:

-   *PE-Path* указывает путь к исполняемому файлу. Для поддержки развертывания можно указать путь, используя переменную среды, например% ProgramFiles%. Альтернативой для создания ссылки на строку является выход из сведений о пути к файлу. В этом случае приложение должно иметь некоторые средства, например другое значение реестра, для обмена данными с собственным каталогом установки.
-   *stringID* указывает числовой идентификатор ресурса соответствующего строкового ресурса, который реализуется так же, как любой другой локализуемый строковый ресурс.
-   *Комментарий* указывает дополнительные сведения для отладки или удобства чтения значения реестра. Функции API реестра игнорируют комментарий при загрузке строки.

> [!Note]  
> Данные для значения реестра не имеют явной ссылки на файл ресурсов, зависящий от языка. Правильный файл определяется во время выполнения в соответствии с текущими предпочтениями языка пользовательского интерфейса.

 

Значение реестра указывается без пробела между "," и "-". Правильное значение реестра:

`shell32.dll,-22912`

Неверное значение реестра:

`shell32.dll, -22912`

примером из Windows Vista является значение реестра со следующими данными:

`@%SystemRoot%\system32\input.dll,-5020`

## <a name="create-resources-for-shortcut-strings"></a>Создание ресурсов для строк ярлыков

Когда приложение MUI отображает имя в пользовательском интерфейсе оболочки, для значка приложения отображается строка подсказки. Для каждого поддерживаемого языка необходимо создать строковые ресурсы для отображаемого имени приложения и соответствующей строки подсказки. Когда ресурсы будут готовы, приложение сможет использовать строки, как описано в разделе Использование API оболочки для загрузки строк ярлыков из раздела реестра [Поиск перенаправленных строк](locating-redirected-strings.md).

### <a name="prepare-resources-for-a-shortcut-created-with-windows-installer"></a>подготовка ресурсов для ярлыка, созданного с помощью установщик Windows

если для создания ярлыка используется установщик Windows (MSI), строковые ресурсы включают в себя отображаемое имя и описание ярлыка. В [таблице ярлыков MSI](../msi/shortcut-table.md)ссылка на библиотеку ресурсов содержится в соответствующих столбцах, а идентификаторы ресурсов для отображаемого имени и описания ярлыка используются в соответствующих столбцах идентификаторов ресурсов.

Чтобы ярлык приложения правильно работал с технологией ресурсов MUI, учитывайте следующие моменты при подготовке строк ярлыка:

-   Для регистрации библиотеки DLL используйте либо переменные среды, либо относительный путь. Можно указать параметр @% systemroot% \\ system32 \\shell32.dll, если строка реестра имеет тип REG \_ expand \_ SZ. Строковый идентификатор ресурса для "текстового документа" в Shell32.dll — 12345.
-   Не используйте пробелы вокруг символов "," и "-". Правильный пример: "shell32.dll,-22912".
-   Не используйте короткое имя файла. Этот тип имени не работает с загрузчиком ресурсов.

### <a name="prepare-resources-for-a-shortcut-using-inf-format"></a>Подготовка ресурсов для ярлыка с помощью формата INF

Если для создания строк ярлыков используется формат файла INF, файл ресурсов должен иметь следующие параметры реестра. В этих инструкциях предполагается использование синтаксиса Профилеитемс API установки.

1.  Измените значение подсказки, чтобы оно указывало на ссылку перенаправления строк, используя путь и идентификатор ресурса.
2.  Добавьте новое значение Дисплайресаурце в разделы установки Профилеитемс.

Ниже приведен пример добавления приложения Calculator в меню **Пуск** .


```C++
[CalcInstallItems]
"Name" = %Calc_DESC%
"CmdLine" = 11, calc.exe
"SubDir" = %Access_GROUP%
"WorkingDir" = 11

"InfoTip" = "@%systemroot%\system32\shell32.dll,-22531"

"DisplayResource" = "%systemroot%\system32\shell32.dll",22019
```



Используйте синтаксис, показанный ниже, при использовании INF-файла для добавления элементов, например, папки группы доступа, в меню " **Пуск** ". Этот синтаксис предполагает использование \[ \] поддержки Стартменуитемс из программы установки аналогично синтаксису, используемому в сиссетуп. INF.


```C++
[StartMenuItems]
<description> = <binary>,<commandline>,<iconfile>,<iconnum>,<infotip>,<resDLL,resID>
```



Задайте в *подсказке* значения ссылку на строку " `@<path>,-resID` ".

Отображаемое имя определяется значениями *ресдлл* и *resID* . Значение *resID* указывает идентификатор ресурса для строкового ресурса, связанного с файлом, не зависящим от языка. Значение *ресдлл* указывает путь к файлу, не зависящему от языка.

## <a name="create-resources-for-friendly-document-type-names"></a>Создание ресурсов для понятных имен типов документов

Необходимо реализовать понятные имена и строки подсказки для приложения в качестве строковых ресурсов. Чтобы разрешить дружественные имена типов документов для реагирования на язык пользовательского интерфейса, приложение должно зарегистрировать имена с помощью значения Фриендлитипенаме в ключе идентификатора программы для типа файла. Значение по умолчанию для ключа идентификатора программы должно быть сохранены для обеспечения обратной совместимости. Сведения о доступе к именам из приложения см. в разделе "запрос понятных имен типов документов" раздела реестра [Поиск перенаправленных строк](locating-redirected-strings.md).

Конкретная работа состоит из следующих этапов.

1.  Реализуйте понятное имя и строки подсказки в качестве строковых ресурсов для конкретных языков.
2.  Добавьте значение Фриендлитипенаме в раздел реестра типа документа. Данные для значения следуют шаблону " `@<path>,-<resID>` ", где *path* указывает исполняемый файл, а *resID* — идентификатор ресурса локализуемого строкового ресурса, связанного с этим исполняемым файлом.
3.  Укажите значение реестра подсказки в формате " `@<path>,-<resID>` ".

В следующем примере показаны параметры реестра для файла .txt:


```C++
HKCR\.txt
@="txtfile"
"Content Type"="text/plain"

HKCR\txtfile
@="Text Document"

"FriendlyTypeName" = "@%systemroot%\system32\shell32.dll,-12345"

"InfoTip" = "@%systemroot%\system32\shell32.dll,-12346"
```



## <a name="provide-resources-for-shell-verb-action-strings"></a>Предоставление ресурсов для строк действий команд оболочки

строки действий для определенных команд, например "открыть" и "изменить", отображаются во всплывающем меню, которое отображается, когда пользователь щелкает правой кнопкой мыши файл в Windows Explorer. Приложению не нужно указывать строки для общих команд оболочки, так как оболочка имеет собственные параметры по умолчанию, поддерживающие MUI для этих команд. Однако необходимо предоставить локализуемые строковые ресурсы для строк, представляющих нестандартные команды.

в операционных системах, предшествующих Windows XP, строки для команд оболочки в реестре подготавливаются к просмотру с помощью следующего синтаксиса, где *команда* указывает фактическое имя команды:


```C++
HKCR\<progid>\shell\<verb>
@ = <friendly-name>
```



Ниже приведен пример.


```C++
HKCR\Sample.app\shell\Disc
@ = "Disconnect"
```



в Windows XP и более поздних версиях можно использовать уровень косвенного обращения для того, чтобы строка действия зависела от языка пользовательского интерфейса. Эти операционные системы поддерживают значение Муиверб для определения строки, совместимой с MUI. Ниже приведен пример записи реестра для нестандартной команды:


```C++
HKCR\Sample.app\shell\Disc
@ = "Disconnect"
"MUIVerb" = "@%systemroot%\system32\sample.exe,-9875"
```



Приложение MUI также должно иметь возможность зарегистрировать старое значение по умолчанию как локализуемое строку, как показано ниже:


```C++
HKCR\Sample.app\shell\Disc
@ = "@%systemroot%\system32\sample.exe,-9875"
```



> [!Note]  
> регистрация старого значения по умолчанию не рекомендуется, так как для нее требуется другая программа установки Windows XP и более поздней версии из программы установки, которая использовалась в предыдущих версиях операционных систем.

 

## <a name="create-resources-for-verb-protocol-and-auxusertype-strings"></a>Создание ресурсов для строк глагола, протокола и Ауксусертипе

Необходимо создать локализуемые строковые ресурсы для глаголов, протоколов и строк Ауксусертипе. Используйте следующие параметры реестра:


```C++
HKCR\CLSID\{<Your_CLSID>}\Verb\<number> @="<Your Verb>, <menu_flag>, <verb_flag>"
"LocalizedString"="@<resDLLpath\resDLL.DLL>,-resStrID"
...

HKCR\CLSID\{<Your_CLSID>}\AuxUserType\<number>
@="<Your Short Name>"
"LocalizedString"="@<resDLLpath\resDLL.DLL>,-resStrID1"
...

HKCR\<Your_Name>\protocol\StdFileEditing\verb\<number>
@="<Your Verb>"
"LocalizedString"="@<resDLLpath\resDLL.DLL>,-resStrID"
...
```



Значение, указанное для Локализедстринг, содержит или заменяет значение для *команды*, а не два значения флага.

Ниже приведена сводка по обеспечению правильных настроек реестра.

-   Если у CLSID есть \\ ключ CLSID \\ (CLSID \\ ) с ключом HKCR, определите значение по умолчанию CLSID, используя HKCR \\ CLSID \\ {CLSID} \\ локализедстринг.
-   Если у CLSID есть один или несколько подразделов \\ в \\ команде HKCR CLSID {CLSID} \\ , определите каждую отдельную строку команды с помощью \\ команды HKCR CLSID \\ {CLSID} \\ \\ \\ локализедстринг.
-   Если у CLSID есть один или несколько подразделов в \\ команде HKCR {ProgID} \\ Protocol \\ стдфилидитинг \\ , определите каждую отдельную строку команды с помощью \\ команды HKCR {ProgID} \\ \\ стдфилидитинг протокола \\ \\ xxx \\ локализедстринг.
-   Если в CLSID имеется один или несколько перечисленных подразделов Ауксусертипе в разделе HKCR \\ CLSID \\ {CLSID} \\ ауксусертипе, определите каждую запись АУКСУСЕРТИПЕ с помощью HKCR \\ CLSID \\ {CLSID} \\ ауксусертипе \\ xxx \\ локализедстринг.

## <a name="create-a-resource-for-the-uninstall-program"></a>Создание ресурса для программы удаления

чтобы зарегистрировать программу удаления для приложения, можно создать значения реестра в подразделе уникальный идентификатор для приложения в разделе реестра HKEY \_ локальный \_ компьютер \\ программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ uninstall. значения для установки включают: DisplayName, дисплайверсион, Publisher, ProductID, реговнер, регкомпани, урлинфоабаут, хелптелефоне, HelpLink, InstallLocation, инсталлсаурце, инсталлдате, Contact, comments, DisplayIcon, Readme, UrlUpdateInfo.

> [!Note]  
> Чтобы включить технологию MUI для каждого значения, можно добавить " \_ локализованный" к имени значения.

 

Компоненты операционной системы необходимы для предоставления значения для DisplayName, \_ локализованного в соответствии с MUI. Необходимо поместить отображаемое имя в библиотеку DLL, например Res.dll, в виде строкового ресурса, предполагая, что идентификатор 1245. Затем приложение может зарегистрировать отображаемое имя как DisplayName, \_ локализованное со значением "@ \\res.DLL,-1245". Все остальные параметры реестра должны быть сохранены, включая исходное значение DisplayName.

## <a name="create-resources-for-sound-events"></a>Создание ресурсов для событий звука

Windows связывает определенные события с звуковыми файлами, например с уведомлением о новом сообщении электронной почты или событием предупреждения о критическом аккумуляторе. Имена событий должны отображаться в пользовательском интерфейсе и должны поддерживать глобализацию. Поэтому следует реализовать локализуемый строковый ресурс для описания каждого описания события. Добавьте новое значение реестра для каждого имени события в дополнение к жестко запрограммированному значению по умолчанию.

Чтобы включить звуковое событие, выполните следующие действия.

1.  Реализуйте описание как локализуемый строковый ресурс.
2.  Добавьте новое значение реестра для отображаемого имени в дополнение к жестко запрограммированному значению по умолчанию. Ниже показан соответствующий макет реестра.


```C++
HKCR\AppEvents\EventLabels
<event_name>
    (Default) REG_SZ "<description>"
    DispFileName REG_EXPAND_SZ "@<path>,-<resID>"
```



Если оболочке не удается найти или получить значение Диспфиленаме, используется описание по умолчанию.

## <a name="create-resources-for-keyboard-layout-strings"></a>Создание ресурсов для строк раскладки клавиатуры

Если приложение реализует раскладку клавиатуры, для отображения имени макета экрана, например, в списках раскладок клавиатуры требуется локализуемый строковый ресурс. У каждой раскладки клавиатуры есть раздел реестра в разделе HKEY \_ Local \_ Machine \\ System \\ CurrentControlSet \\ Control \\ LAYOUTS.

Значениями для этого ключа являются текст макета, удобное для чтения имя для обратной совместимости и отображаемое имя макета. Данные, передаваемые для отображаемого имени макета, должны быть строковой ссылкой в форме " `@<path>,-resID` ", ссылающейся на локализуемый строковый ресурс, связанный с раскладкой клавиатуры.

Ниже приведен пример параметра реестра для раскладки клавиатуры "Испанский (Испания)":

`Layout Display Name=@%SystemRoot%\system32\input.dll,-5020`

## <a name="represent-ole-insert-object-common-dialog-strings"></a>Представление строк общих диалоговых окон вставки объекта OLE

Отображаемое имя вставляемого объекта OLE можно реализовать как локализуемый строковый ресурс, связанный с кодом, реализующим этот объект. [Диалоговое окно OLE: Вставка объекта](/cpp/mfc/reference/coleinsertdialog-class) получает отображаемое имя из раздела реестра HKCR \\ CLSID \\ { *<GUID>* }, где *GUID* определяет идентификатор класса вставляемого объекта OLE. Windows Vista и более поздние версии реализуют этот тип объектов в локализуемых способах, используя отображаемое имя, совместимое с MUI, которое позволяет настраивать язык пользовательского интерфейса. в отличие от этого, предварительные Windows операционные системы Vista реализуют отображаемое имя для этого типа объекта, используя значение по умолчанию соответствующего раздела реестра. Обычно это имя является либо именем английского (США), либо именем в системном языке пользовательского интерфейса по умолчанию.

> [!Note]  
> Не все объекты, соответствующие подразделам раздела реестра, можно вставлять.

 

Значение по умолчанию \\ \\ ключа CLSID { *<GUID>* } раздела HKCR должно содержать удобное для чтения имя для обратной совместимости. Однако он также должен определять значение Локализедстринг в формате " `@<path>,-ResID` ", где путь определяет исполняемый файл, реализующий объект. Значение ResID указывает идентификатор ресурса локализуемой строки для отображаемого имени.

Например, скрипт регистрации для вставляемого объекта клипа мультимедиа содержит следующие строки:


```C++
HKCR,"CLSID\%CLSID_Media_Clip%",,,"%default description%"
HKCR,"CLSID\%CLSID_Media_Clip%","LocalizedString",,"@%systemroot%\system32\mplay32.exe,-9217"
```



Первая строка обеспечивает обратную совместимость, помещая в реестре простую текстовую строку в качестве отображаемого имени по умолчанию. Вторая строка предоставляет доступ к отображаемому имени, совместимому с MUI. Указывает идентификатор строки, хранящийся в Mplay32.exe. Строку с идентификатором 9217 в Mplay32.exe можно связать со строковыми значениями ресурсов для любого числа языков. Название английского языка (США) — "клип мультимедиа".

## <a name="create-string-resources-for-microsoft-management-console-snap-ins"></a>Создание строковых ресурсов для консоли управления (Майкрософт) Snap-Ins

Необходимо создать локализуемый строковый ресурс для каждой оснастки консоли управления (MMC), используемой приложением MUI. Поскольку оснастка является частью консоли, она имеет пользовательский интерфейс и должна быть глобализована для работы на более чем одном языке.

В большинстве случаев оснастки MMC вызывают те же проблемы глобализации и локализации, что и само приложение MUI. Оснастка MMC должна отражать свое имя в реестре для отображения. Запись реестра должна включать косвенную ссылку на локализуемый строковый ресурс и литеральную строку для обеспечения обратной совместимости.

Каждая оснастка консоли управления (MMC) содержит раздел реестра в разделе HKEY \_ Local \_ Machine \\ Software \\ Microsoft \\ MMC \\ оснастки. В качестве значения для этого ключа можно указать Наместринг, указав удобное для чтения имя для обратной совместимости и Наместрингиндирект, указав косвенную ссылку на локализуемый строковый ресурс. Для Наместрингиндирект необходимо предоставить ссылку на строку в форме " `@<path>,-resID` ", представляющую локализуемый строковый ресурс.

Например, можно настроить следующий параметр для Mymmc.dll, где 12345 — идентификатор соответствующего строкового ресурса, содержащего локализуемое имя оснастки:


```C++
NameStringIndirect=@%systemroot%@c:\windir\system32\mymmc.dll,-12345
```



Некоторые оснастки регистрируют другие строковые значения реестра, которые MMC не считывает из реестра. Дополнительные сведения об использовании этих значений см. в разделе Регистрация [перенаправленных строк](locating-redirected-strings.md)консоли управления Microsoft Snap-In строк, не считанных из реестра.

## <a name="create-string-resources-for-a-windows-service"></a>создание строковых ресурсов для службы Windows

несмотря на то, что служба Windows обычно имеет небольшую или не имеющую пользовательский интерфейс, она должна отображать имя, совместимое с mui, и обычно содержит описание, соответствующее языку, совместимому с mui. раздел реестра, описывающий службу Windows, поддерживает только значение DisplayName для имени службы и значение описания службы.

Параметры для службы Windows выполняется из приложения, как описано в статье установка отображаемого имени и описания для службы Windows из реестра в разделе [поиск перенаправленных строк](locating-redirected-strings.md). Если в приложении не заданы значения реестра для пользовательского интерфейса службы, значения в реестре остаются установленными на английском языке, даже если пользовательский интерфейс находится на другом языке.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Подготовка ресурсов](preparing-resources.md)
</dt> <dt>

[Поиск перенаправленных строк](locating-redirected-strings.md)
</dt> </dl>

 

 
