---
description: Приложения могут использовать Юникод для представления строк в нескольких формах.
ms.assetid: 027c9ef5-4012-4d1c-b78c-a4d3f1ccbf35
title: Использование нормализации Юникода для представления строк
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ad452db3bc20518320afcf77e5f6483e010cd144
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103913691"
---
# <a name="using-unicode-normalization-to-represent-strings"></a>Использование нормализации Юникода для представления строк

Приложения могут использовать Юникод для представления строк в нескольких формах. По мере того, как принятие Юникода увеличилось, особенно через Интернет, потребность в возникли сомнения устраняет ненужные различия в строках Юникода. Несколько представлений для сочетания символов усложняют программное обеспечение, например, когда веб-сервер отвечает на запрос страницы или компоновщик ищет определенный идентификатор в библиотеке.

> [!Caution]  
> Различные строки в Юникоде могут показаться визуально идентичными, что вызывает проблемы безопасности. Дополнительные сведения см. в разделе [вопросы безопасности: международные функции](security-considerations--international-features.md).

 

В ответ на это требование Консорциум Unicode определил процесс, называемый «нормализацией», который создает одно двоичное представление для любого из эквивалентных двоичных представлений символа. После нормализации две строки эквивалентны только в том случае, если они имеют идентичные двоичные представления. Нормализация устраняет некоторые различия, но сохраняет регистр.

Чтобы использовать нормализацию Юникода, приложение может вызывать функции [**нормализестринг**](/windows/desktop/api/Winnls/nf-winnls-normalizestring) и [**иснормализедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnormalizedstring) для изменения порядка строк АКККОРДИНГ в Unicode 4,0 TR \# 15. Нормализация может помочь повысить безопасность за счет сокращения числа альтернативных строковых представлений, имеющих одинаковые лингвистические значения. Однако помните, что нормализация не может полностью исключить альтернативные представления.

Подробное описание стандартов Юникода для нормализации см. в [стандартном приложении Юникода \# 15: формы нормализации Юникода](https://www.unicode.org/reports/tr15) (уакс \# 15).

> [!Caution]  
> Поскольку нормализация может изменить форму строки, механизмы безопасности или алгоритмы проверки символов, как правило, должны быть реализованы после нормализации. Дополнительные сведения см. в разделе [вопросы безопасности: международные функции](security-considerations--international-features.md).

 

## <a name="provide-multiple-representations-of-the-same-string"></a>Предоставление нескольких представлений одной и той же строки

Во многих случаях в Юникоде разрешено несколько представлений, то есть одной и той же строки, лингвистических. Пример:

-   Заглавная буква A с диересис (умляут) может быть представлена одной кодовой точкой Юникода "Ä" (U + 00C4) или сочетанием прописной буквы A и сочетанием Диересис ("A" + "ё", то есть U + 0041 U + 0308). Аналогичные рекомендации применяются ко многим другим символам с диакритическими знаками.
-   Заглавная буква A может быть представлена обычным способом (прописная буква A, U + 0041) или по ширине прописной буквы A (U + FF21). Аналогичные рекомендации применяются для других простых латинских букв (как в верхнем, так и в нижнем регистре) и для символов катакана, используемых для написания японского языка.
-   Строка «Fi» может быть представлена либо символами «f», «i» (U + 0066 U + 0069), либо лигатурой «Fi» (U + FB01). Аналогичные соображения относятся ко многим другим сочетаниям символов, для которых Юникод определяет лигатуры.

## <a name="use-the-four-defined-normalization-forms"></a>Использовать четыре определенные формы нормализации

Приложения могут выполнять нормализацию Юникода с помощью нескольких алгоритмов, называемых «формами нормализации», которые подчиняются различным правилам. Консорциум Unicode определил четыре формы нормализации: NFC (форма C), NFD (форма D), НФКК (форма KC) и НФКД (форма KD). Каждая форма устраняет некоторые различия, но сохраняет регистр. Win32 и платформа .NET Framework поддерживают все четыре формы нормализации.

[**\_ Форма нормы**](/windows/desktop/api/Winnls/ne-winnls-norm_form) типа перечисления NLS поддерживает четыре стандартные формы нормализации Юникода. Формы C и D предоставляют канонические формы для строк. Неканонические формы KC и KD обеспечивают дальнейшую совместимость и могут раскрывать определенные семантические эквивалентные, не очевидные в формах C и D. Однако они делают это за счет определенной потери информации, и обычно не следует использовать в качестве канонического способа хранения строк.

Из двух канонических форм форма C представляет собой «составную» форму, а форма «D» — это «разложенная» форма. Например, форма C использует одну кодовую точку Юникода «Ä» (U + 00C4), а форма D использует («A» + «ё»), то есть U + 0041 U + 0308). Эти данные отображаются одинаково, так как "ё" (U + 0308) — это несамостоятельный символ. Форма D может использовать любое количество кодовых точек для представления одной кодовой точки, используемой формой C.

Если две строки идентичны в форме C или форме D, они идентичны в другой форме. Более того, при правильном отображении они отображают неразличимы друг от друга и от исходной ненормализованной строки.

После нормализации строки не могут быть постоянно возвращены в исходное представление. Например, если строка с сочетанием составных и разделенных символьных представлений преобразуется в нормализованную форму, невозможно отменить нормализацию для исходной смешанной строки. Таким образом, если приложению требуется исходное представление строки, оно должно хранить это представление явным образом. Однако преобразование между двумя каноническими формами осуществляется с помощью обратимого преобразования. Строка в формате C может быть преобразована в форму D, а затем обратно в форму C, а результат идентичен исходной строке в формате C.

Формы KC и KD похожи на формы C и D соответственно, но эти формы совместимости имеют дополнительные сопоставления совместимых символов с базовой формой каждого символа. Такие сопоставления могут привести к потере незначительных символов. Они объединяют определенные символы, которые являются визуально отличающимися. Например, они объединяют символы полной и половинной ширины с одним и тем же семантическим значением или разными формами того же арабского письма или лигатурой "Fi" (U + FB01) и парой символов "Fi" (U + 0066 U + 0069). Они также объединяют некоторые символы, которые иногда могут иметь другое семантическое значение, например цифру, записанную в виде надстрочного знака, в виде подстрочного или заключенного в круг. Из-за этой потери информации Forms KC и KD обычно не следует использовать в качестве канонических форм строк, но они полезны для определенных приложений.

Форма KC является составной формой, а форма KD — разделенной формой. Приложение может возвращаться между Forms KC и KD, но не существует согласованного способа перехода от формы KC или KD к исходной строке, даже если исходная строка находится в формате C или D.

Windows, приложения Майкрософт и платформа .NET Framework обычно создают символы в форме C, используя обычные методы ввода. Для большинства целей в Windows форма «C» является предпочтительной формой. Например, символы в форме C создаются вводом с клавиатуры Windows. Однако символы, импортированные из Интернета и других платформ, могут ввести другие формы нормализации в поток данных.

Следующие примеры взяты из УАКС \# 15 и иллюстрируют различия между четырьмя формами нормализации.



<table>
<thead>
<tr class="header">
<th>До преобразования</th>
<th>Форма D</th>
<th>Форма C</th>
<th>Примечания</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&quot;äффин&quot;</td>
<td>&quot;A\u0308ffin&quot;</td>
<td>&quot;äффин&quot;</td>
<td rowspan="2">Ffi_ligature (U + FB03) не разлагаются, так как имеет сопоставление совместимости, а не каноническое сопоставление. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>&quot;Ä \ uFB03n&quot;</td>
<td>&quot;A\u0308\uFB03n&quot;</td>
<td>&quot;Ä \ uFB03n&quot;</td>

</tr>
<tr class="odd">
<td>&quot;Генри IV&quot;</td>
<td>&quot;Генри IV&quot;</td>
<td>&quot;Генри IV&quot;</td>
<td rowspan="2">РИМСКИЕ цифры IV (U + 2163) не разлагаются. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>&quot;Генри \u2163&quot;</td>
<td>&quot;Генри \u2163&quot;</td>
<td>&quot;Генри \u2163&quot;</td>

</tr>
<tr class="odd">
<td>ga</td>
<td>Ка + 10</td>
<td>ga</td>
<td rowspan="5">Разные эквиваленты совместимости одного японского символа не являются одной и той же строкой в форме C. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>Ка + 10</td>
<td>Ка + 10</td>
<td>ga</td>

</tr>
<tr class="odd">
<td>hw_ka + hw_ten</td>
<td>hw_ka + hw_ten</td>
<td>hw_ka + hw_ten</td>

</tr>
<tr class="even">
<td>ка + hw_ten</td>
<td>ка + hw_ten</td>
<td>ка + hw_ten</td>

</tr>
<tr class="odd">
<td>hw_ka + 10</td>
<td>hw_ka + 10</td>
<td>hw_ka + 10</td>

</tr>
<tr class="even">
<td>какс</td>
<td>б <sub>i</sub> + + KS <sub>f</sub></td>
<td>какс</td>
<td>Слоги хангыль поддерживаются в нормализации.<br/></td>
</tr>
</tbody>
</table>



 



<table>
<thead>
<tr class="header">
<th>До преобразования</th>
<th>Форма KD</th>
<th>Форма KC</th>
<th>Примечания</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&quot;äффин&quot;</td>
<td>&quot;A\u0308ffin&quot;</td>
<td>&quot;äффин&quot;</td>
<td rowspan="2">Ffi_ligature (U + FB03) разлагаются в форме KC, но не в форме C. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>&quot;Ä \ uFB03n&quot;</td>
<td>&quot;A\u0308ffin&quot;</td>
<td>&quot;äффин&quot;</td>

</tr>
<tr class="odd">
<td>&quot;Генри IV&quot;</td>
<td>&quot;Генри IV&quot;</td>
<td>&quot;Генри IV&quot;</td>
<td rowspan="2">Результирующие строки здесь идентичны в форме KC. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>&quot;Генри \u2163&quot;</td>
<td>&quot;Генри IV&quot;</td>
<td>&quot;Генри IV&quot;</td>

</tr>
<tr class="odd">
<td>ga</td>
<td>Ка + 10</td>
<td>ga</td>
<td rowspan="5">Разные эквиваленты совместимости одного японского символа в одной строке в формате KC. $ {Remove} $<br />
</td>
</tr>
<tr class="even">
<td>Ка + 10</td>
<td>Ка + 10</td>
<td>ga</td>

</tr>
<tr class="odd">
<td>hw_ka + hw_ten</td>
<td>Ка + 10</td>
<td>ga</td>

</tr>
<tr class="even">
<td>ка + hw_ten</td>
<td>Ка + 10</td>
<td>ga</td>

</tr>
<tr class="odd">
<td>hw_ka + 10</td>
<td>Ка + 10</td>
<td>ga</td>

</tr>
<tr class="even">
<td>какс</td>
<td>б <sub>i</sub> + + KS <sub>f</sub></td>
<td>какс</td>
<td>Слоги хангыль поддерживаются в нормализации. В более ранних версиях Юникода такие символы, как KS <sub>f</sub> , имеют сопоставление совместимости с k <sub>f</sub> + s <sub>f</sub>. Эти сопоставления были удалены в Юникоде 2.1.9, чтобы обеспечить поддержку слогов хангыль.<br/></td>
</tr>
</tbody>
</table>



 

> [!Note]  
> Две приведенные выше таблицы имеют авторские права на © 1998-2006 Unicode, Inc. Все права защищены.

 

## <a name="use-composed-forms-for-single-glyphs"></a>Использование составных форм для одиночных глифов

Многие последовательности символов, соответствующие одному глифу, не состоят из составных форм. Даже при нормализации формы C один визуальный глиф или логический текстовый элемент может состоять из нескольких кодовых позиций Юникода. Например, несколько символов, используемых в записи литовский, имеют двойные диакритические знаки, так как они содержат только разразделенные формы. Например, строчные буквы U с Макрон и тильда ("ū̃", U + 016b U + 0303, где первая кодовая точка — строчная буква U с Макрон, а вторая — сочетание острых знаков).

## <a name="example"></a>Пример

Соответствующий пример можно найти в [примере NLS: нормализация Юникода](nls--unicode-normalization-sample.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Поддержка национальных языков](using-national-language-support.md)
</dt> <dt>

[Вопросы безопасности: международные функции](security-considerations--international-features.md)
</dt> <dt>

[**иснормализедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnormalizedstring)
</dt> <dt>

[**нормализестринг**](/windows/desktop/api/Winnls/nf-winnls-normalizestring)
</dt> </dl>

 

 




