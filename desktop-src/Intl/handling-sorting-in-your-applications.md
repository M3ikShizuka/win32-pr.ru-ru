---
description: Некоторые приложения, такие как Microsoft Active Directory, Microsoft Exchange и Microsoft Access, поддерживают сортировку базы данных языкового стандарта и языковых строк, индексируемых по имени (строка UTF-16), и связанные с ними весовые коэффициенты сортировки.
ms.assetid: c8fc32bd-02bd-4a40-a836-d9ad9f69c209
title: Обработка сортировки в приложениях
ms.topic: article
ms.date: 03/04/2020
ms.openlocfilehash: c0bba3d78a5219781226ecf58292ed461c902090
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103913699"
---
# <a name="handling-sorting-in-your-applications"></a>Обработка сортировки в приложениях

Некоторые приложения, такие как Microsoft Active Directory, Microsoft Exchange и Microsoft Access, поддерживают сортировку базы данных языкового стандарта и языковых строк, индексируемых по имени (строка UTF-16), и связанные с ними весовые коэффициенты сортировки.

[Сортировка](sorting.md) обычно интуитивно понятна для пользователей в собственных языковых стандартах. Тем не менее он может быть интуитивно понятным для разработчиков приложений. В этом разделе обсуждаются вопросы, касающиеся обработки сортировки в приложениях. Сортировка может быть либо лингвистическими, либо порядковыми (не лингвистическими).

## <a name="sorting-functions"></a>Функции сортировки

В приложениях можно использовать различные функции сортировки:

-   Функции сравнения строк NLS. Примеры: [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) и [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal), [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa), [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex), [**финднлсстринг**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring), [**финднлсстринжекс**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex)и [**финдстрингординал**](/windows/desktop/api/Libloaderapi/nf-libloaderapi-findstringordinal). См. раздел [вопросы безопасности: международные функции](security-considerations--international-features.md) для обсуждения проблем безопасности, связанных с функциями сравнения строк.
-   Функции-оболочки, которые внутренне вызывают функции сравнения строк. Наиболее распространенными функциями являются [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa) и [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia), которые вызывают [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw).

Обычно функции сортировки оценивают строки по символам. Однако многие языки содержат элементы с несколькими символами, например две пары символов "CH" в традиционном испанском. [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) и [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) используют предоставляемый приложением идентификатор или имя локали для идентификации элементов с несколькими символами. В отличие от этого, [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa)и [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia) используют языковой стандарт пользователя.

Еще один пример — вьетнамский, который содержит много элементов с двумя символами, таких как допустимые символы в верхнем регистре, регистр заголовка и строчные формы «водо», которые имеют соответственно. Любая из этих форм рассматривается как один элемент сортировки и, если регистр игнорируется, сравнивается как равный. Однако поскольку ««» не является допустимым в качестве одного элемента, [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa)и [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia) обрабатывают ««»» как два отдельных элемента.

Функции [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa), [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia), [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa), [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex), [**финднлсстринг**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)и [**финднлсстринжекс**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) по умолчанию используют методику сортировки слов. Для такого типа сортировки все знаки пунктуации и другие символы, не являющиеся буквенно-цифровыми, за исключением дефиса и апострофа, перед любым буквенно-цифровым символом. Дефис и апостроф обрабатываются иначе, чем другие небуквенно-цифровые символы, чтобы гарантировать, что слова, такие как «Coop» и «Co-операция», останутся в отсортированном списке.

Вместо сортировки по словам приложение может запросить метод сортировки строк из функций сортировки, указав \_ флаг Sort стрингсорт. Строка сортировки обрабатывает дефис и апостроф так же, как любой другой символ, не являющийся буквенно-цифровым. Их положения в последовательности сортировки предшествуют буквенно-цифровым символам.

В следующей таблице сравниваются результаты слова Sort с результатами сортировки строк. 

| Сортировка по словам | Сортировка строк |
|-----------|-------------|
| биллет    | счет      |
| ведомостей     | биллет      |
| счет    | ведомостей       |
| он не может    | нельзя       |
| не можете      | он не может      |
| нельзя     | не можете        |
| параллель       | Совместная операция       |
| Coop      | параллель         |
| Совместная операция     | Coop        |



 

## <a name="sort-strings-linguistically"></a>Сортировка строк по лингвистическому сортировке

Функции [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) и [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) проверяют лингвистическое равенство. Приложения должны использовать эти функции с правильным языковым стандартом для сортировки строк лингвистически.

> [!Note]  
> Чтобы обеспечить совместимость с Юникодом, приложение должно предпочитать [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) или версию программы [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)в Юникоде. Еще одна причина для предустановления [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) заключается в том, что корпорация Майкрософт выполняет миграцию в сторону использования имен языковых стандартов вместо идентификаторов языкового стандарта для новых языков, чтобы обеспечить взаимодействие. Любое приложение, работающее только в Windows Vista и более поздних версиях, должно использовать [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex).

 

Другой способ проверки лингвистического равенства заключается в использовании [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa) или [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia), которые всегда используют сортировку по словам. Функция [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia) вызывает [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) с \_ флагом нормы IGNORECASE, а [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa) вызывает его без этого флага. Общие сведения об использовании функций-оболочек см. в разделе [**строки**](../menurc/strings.md).

Функции получают лингвистически соответствующие результаты для всех языков. Ожидания пользователей для разных языковых стандартов могут значительно различаться при сортировке, как показано в следующих примерах.

-   Многие языковые стандарты выравнивают лигатуру AE (æ) с буквами AE. Однако Исландский (Исландия) считает его отдельной буквой и помещает ее после Z в последовательности сортировки.
-   Кольцо (a) обычно сортируется с разностью диакритических знаков из. Однако шведский (Швеция) помещает кольцо после Z в последовательности сортировки.

Функции попытаются проверить, что кодовые точки, определенные в стандарте Юникода, являются каноническими, равными строкам эквивалентных кодовых позиций. Например, кодовая точка, представляющая строчную букву "u" с диересис (u), канонно равна строчной букве "u" в сочетании с диересис (ё). Однако обратите внимание, что каноническая эквивалентность не всегда возможна.

Почти все данные, введенные с помощью клавиатуры Windows и редакторов методов ввода (IME), соответствуют форме нормализации C, определенной в стандарте Юникода, а преобразование входящих данных из других платформ с помощью функций нормализации Юникода в NLS предоставляет наиболее согласованные результаты, особенно для языков, использующих скрипты тибетский или хангыль для современных хангыль. Дополнительные сведения о поддержке нормализации Юникода в Windows Vista и более поздних версиях см. в разделе [Использование нормализации Юникода для представления строк](using-unicode-normalization-to-represent-strings.md).

Если при сравнении строк следует предпочтение языка пользователя, например при сортировке элементов для упорядоченного элемента управления ListView, приложение может выполнить одно из следующих действий:

-   Вызовите [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa) или [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia) , используя языковой стандарт пользователя.
-   Вызовите [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) или [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) , чтобы определить языковой стандарт для сравнения, передать дополнительные флаги для внедрения символов NULL или передать явные длины для соответствия частям строки.

Если результаты сравнения должны быть единообразными независимо от языкового стандарта, например при сравнении извлеченных данных с предопределенным списком или с внутренним значением, приложение должно использовать [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) или [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex) с параметром *locale* , для которого задано значение инвариантный языковой стандарт \_ . Для [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)один из следующих вызовов будет соответствовать, даже если Мистр имеет значение "инлап". В этом случае вызов [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia) с учетом локали завершится ошибкой, если текущий языковой стандарт — Вьетнам.

В Windows XP.


```C++
int iReturn = CompareString(LOCALE_INVARIANT, NORM_IGNORECASE, mystr, -1, _T("InLap"), -1);
```



В более ранних операционных системах:


```C++
DWORD lcid = MAKELCID(MAKELANGID(LANG_ENGLISH, SUBLANG_ENGLISH_US), SORT_DEFAULT);
int iReturn = CompareString(lcid, NORM_IGNORECASE, mystr, -1, _T("InLap"), -1);
```



## <a name="sort-strings-ordinally"></a>Сортировка строк по порядковому номеру

При сортировке по порядковому номеру (не лингвистическая) в приложениях всегда следует использовать функцию [**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) .

> [!Note]  
> Эта функция доступна только для Windows Vista и более поздних версий.

 

[**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) сравнивает две строки [Юникода](unicode.md) для проверки на двоичное равенство, в отличие от лингвистического равенства. Примерами таких нелингвистических строк являются имена файлов NTFS, переменные среды и имена мьютексов, именованных каналов или маилслотс. За исключением варианта учета регистра, эта функция игнорирует все недвоичные эквиваленты. В отличие от других функций сортировки, она проверяет все кодовые точки на равенство, включая те, которые не имеют веса в лингвистических схемах сортировки.

Все приведенные ниже инструкции применяются к [**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) в двоичных сравнениях, но не к [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**лстркмп**](/windows/win32/api/winbase/nf-winbase-lstrcmpa)или [**лстркмпи**](/windows/win32/api/winbase/nf-winbase-lstrcmpia).

-   Канонические эквивалентные последовательности в Юникоде, такие как Латинская СТРОЧная БУКВа A с КОЛЬЦОм выше (U + 00e5) и Латинская СТРОЧная БУКВа A + ОБЪЕДИНЕНный Звонок выше (U + 0061 U + 030A), не равны, несмотря на то, что они выглядят как одинаковые ("a").
-   Канонические строки в Юникоде, например Латинская БУКВа SMALL ПРОПИСная Y (U + 028f) и Латинская ПРОПИСная БУКВа Y (U + 0059), которые выглядят очень похожими ("ʏ" и "Y") и отличаются только некоторыми особыми весовыми коэффициентами регистра в лингвистических таблицах, считаются полностью непохожими символами. Даже если приложение устанавливает для *Бигнорекасе* **значение true**, эти строки сравниваются как разные.
-   Кодовые точки, которые определены, но не имеют веса лингвистической сортировки, такие как соединение НУЛЕВой ширины (U + 200d), обрабатываются как имеющие весовые точки кода.
-   Кодовые точки, определенные в более поздних версиях Юникода, но не имеющие веса в текущих лингвистических таблицах, обрабатываются как имеющие весовые коэффициенты кодовых точек.
-   Кодовые точки, неопределенные в Юникоде, обрабатываются как имеющие вес кодовых точек.
-   Когда приложение устанавливает для *Бигнорекасе* **значение true**, функция сопоставляет регистр с использованием таблицы верхнего регистра операционной системы вместо сведений в лингвистических таблицах сортировки. Поэтому сопоставление не зависит от языкового стандарта.

Дополнительные сведения о канонических эквивалентных последовательностях в Юникоде и канонических аналогичных строках в Юникоде см. в разделе [Использование нормализации Юникода для представления строк](using-unicode-normalization-to-represent-strings.md).

## <a name="sort-code-points"></a>Сортировка кодовых точек

Некоторые кодовые точки Юникода не имеют веса, например НУЛЕВой ширины, отличной от, U + 200c. Функции сортировки намеренно оценивают невзвешенные кодовые точки как эквивалентные, так как они не имеют веса при сортировке. В Windows Vista и более поздних версиях приложение может сортировать эти кодовые точки путем вызова функций сравнения строк NLS, особенно [**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal), для оценки всех кодовых позиций в литерале, двоичного смысла, например, при проверке пароля. В операционных системах, предшествующих Windows Vista, приложение должно использовать функцию среды выполнения C **strcmp** или **wcscmp**.

Функции сортировки игнорируют диакритические знаки, такие как бреве;, а не пробелы, U + 0306, если в приложении задан флаг пропуска Hlink \_ . Аналогичным образом эти функции игнорируют символы, например знак равенства, U + 003D, если \_ задан флаг символов Hlink. В Windows Vista и более поздних версиях приложение вызывает [**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal) для оценки диакритических знаков и кодовых позиций символов в литерале, двоичный смысл. В операционных системах, предшествующих Windows Vista, приложение должно использовать **strcmp** или **wcscmp**.

Некоторые кодовые точки, такие как 0xFFFF и 0x058b, в настоящее время не назначаются в Юникоде. Эти кодовые точки не получают веса при сортировке и никогда не должны передаваться в функции сортировки. Приложение должно использовать [**иснлсдефинедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnlsdefinedstring) для обнаружения кодовых точек не в Юникоде в потоке данных.

> [!Note]  
> Результаты [**иснлсдефинедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnlsdefinedstring) могут различаться в зависимости от версии в Юникоде, если в более поздней версии символ добавляется в Юникод, а затем добавляется в таблицы сортировки Windows. Дополнительные сведения см. в статье [Использование управления версиями для сортировки](#use-sort-versioning).

 

## <a name="sort-digits-as-numbers"></a>Сортировка цифр как чисел

В Windows 7 и более поздних версиях приложение может вызывать [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa)или [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex) с помощью \_ флага Sort дигитсаснумберс. Этот флаг поддерживает сортировку, которая обрабатывает цифры как цифры, например сортировку "2" перед "10".

Обратите внимание, что использование этого флага не подходит для шестнадцатеричных цифр, как показано ниже. <dl> 01AF  
1BCD  
002A  
12FA  
AB1C  
AB02  
AB12  
</dl>

В этом случае "числа" сортируются по порядку, но пользователь воспринимает неправильный отсортированный шестнадцатеричный список.

## <a name="map-strings"></a>Строки отображения

Приложение использует функцию [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa) или [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex) для отображения строк, если \_ не указан лкмап SORTKEY. Сопоставленная строка завершается нулем, если исходная строка завершается нулем.

При преобразовании между прописными и строчными буквами функция не гарантирует, что один символ будет сопоставляться с одним символом. Например, \_ Флаги лкмап нижнего регистра и лкмап в \_ верхнем регистре могут сопоставлять немецкий диез S (",") с самим собой. Кроме того, флаг ЛКМАП в \_ верхнем регистре может сопоставлять ««?» с «SS», а флаг лкмап в \_ нижнем регистре может СОПОСТАВЛЯТЬ «SS» с ««?». Поведение зависит от версии NLS.

При преобразовании между прописными и строчными буквами функция не чувствительна к контексту. Например, хотя флаг ЛКМАП в \_ верхнем регистре правильно сопоставляет греческую строчную Сигма ("σ") и греческую строчную букву Сигма ("ς") до греческого прописного Сигма ("σ"), флаг лкмап в \_ нижнем регистре всегда сопоставляет "σ" с "σ", никогда — "ς".

По умолчанию функция сопоставляет строчную букву i с прописной буквой I, даже если параметр *locale* указывает Турецкий или азербайджанский. Чтобы переопределить это поведение для турецкого или азербайджанский, приложение должно указать ЛКМАП \_ лингвистический \_ регистр. Если этот флаг указан с соответствующим языковым стандартом, "ı" (строчная буква I) является формой "I" в нижнем регистре "I" (прописная буква I), а "i" (с точками в нижнем регистре) является формой "i" в верхнем регистре.

Если \_ задан флаг лкмап хирагана для сопоставления символов катакана с хирагана-символами, а ширина лкмап \_ не задана, [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa) или [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex) сопоставляет символы полной ширины с хирагана. В этом случае все символы катакана половинной ширины помещаются в строку назначения, без сопоставления с хирагана. Приложение должно указать ЛКМАПную \_ ширину, чтобы сопоставлять символы катакана половинной ширины с хирагана. Причина этого ограничения состоит в том, что все символы хирагана имеют полноширинные символы.

Если приложению необходимо удалить символы из исходной строки, оно может вызвать функцию сопоставления с \_ \_ установленными флагами нормы ИГНОРЕСИМБОЛС и нормы игноренонспаце, а все остальные флаги сняты. Если приложение делает это с исходной строкой, которая не завершается нулем, функция может вернуть пустую строку и не будет возвращать ошибку.

## <a name="create-sort-keys"></a>Создание ключей сортировки

Когда приложение указывает ЛКМАП \_ SORTKEY, [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa) или [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex) создает ключ сортировки, двоичный массив байтовых значений. Ключ сортировки не является истинной строкой, и ее значения представляют поведение сортировки исходной строки, но не являются осмысленными отображаемыми значениями.

> [!Note]  
> Функция игнорирует арабскую кашиды во время создания ключа сортировки. Если приложение вызывает функцию для создания ключа сортировки для строки, содержащей арабскую кашиды, функция не создает значение ключа сортировки.

 

Ключ сортировки может содержать нечетное число байтов. Флаг ЛКМАП \_ битерев только меняет число байтов на противоположное. Последний байт (с нечетным положением) в ключе сортировки не является обратным. Если завершающий байт 0x00 является байтовым байтом с нечетным положением, он остается последним байтом в ключе сортировки. Если конечный байт 0x00 является равномерно позиционированным байтом, он обменивается позициями с предшествующим байтом.

При формировании ключа сортировки функция рассматривает дефис и апостроф иначе, чем другие символы пунктуации, поэтому такие слова, как «Coop» и «Co-op», останутся в списке. Все символы пунктуации, отличные от дефиса и апострофа, сортируются до буквенно-цифровых символов. Приложение может изменить это поведение, установив \_ флаг Sort стрингсорт, как описано в разделе [функции сортировки](#sorting-functions).

При использовании в [memcmp](/cpp/c-runtime-library/reference/memcmp-wmemcmp)ключ сортировки дает тот же порядок, что и при использовании исходной строки в [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw) или [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex). Функция [memcmp](/cpp/c-runtime-library/reference/memcmp-wmemcmp) должна использоваться вместо [strcmp](/cpp/c-runtime-library/reference/strcmp-wcscmp-mbscmp), так как ключ сортировки может иметь внедренные значения NULL.

## <a name="use-sort-versioning"></a>Использовать сортировку версий

Таблица [сортировки](sorting.md) имеет два числа, которые определяют ее версию: определенную версию и версию NLS. Оба числа являются значениями типа DWORD, состоящими из основного значения и незначительного значения. Первый байт значения зарезервирован, два следующих байта представляют основной номер версии, а последний байт представляет дополнительный номер версии. В шестнадцатеричных терминах используется шаблон 0xRRMMMMmm, где R равно reserved, M равно Major, а m равно Minor. Например, основная версия 3 с дополнительной версией 4 представлена как 0x304.

Определенная версия определяет поработать кодовых точек и одинакова для всех языков. Основной номер версии указывает на изменения существующих кодовых позиций. Дополнительный номер версии указывает, что были добавлены кодовые точки, но ранее не были изменены никакие из существующих кодовых точек.

Версия NLS зависит от [идентификатора локали](locale-identifiers.md) или [имени локали](locale-names.md)и отслеживает изменения веса кодовых точек для затронутого языкового стандарта. Основная версия увеличивается при изменении весовых коэффициентов для кодовых точек, которые уже были отсортированы. Дополнительный номер версии увеличивается при назначении новых кодовых точек весовым коэффициентам, но все остальные ранее весовые коэффициенты кодовых точек остаются без изменений.

> [!Note]  
> Для основной версии одна или несколько кодовых точек изменяются, поэтому приложению необходимо повторно индексировать все данные, чтобы они были допустимыми. Для дополнительной версии ничего не перемещается, но добавляются кодовые точки. Для этого типа версии приложению необходимо только повторно индексировать строки с ранее несортированными значениями.

 

> [!IMPORTANT]
> Основная версия была изменена в Windows 8. Данные, созданные в более ранних версиях Windows, необходимо повторно индексировать.

 

Как определенные, так и версии NLS применяются к отбираемым кодовым точкам, полученным с помощью функции [**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa) или [**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex) \_ , с флагом лкмап SORTKEY, а также с использованием функций [**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw), [**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex), [**финднлсстринг**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)и [**финднлсстринжекс**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex) . Если одна или несколько кодовых точек в строке не поддерживают сортировку, функция [**иснлсдефинедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnlsdefinedstring) возвращает **значение false** , если эта строка передается в качестве параметра.

Приложение может вызывать либо [**жетнлсверсион**](/windows/desktop/api/Winnls/nf-winnls-getnlsversion) , либо [**жетнлсверсионекс**](/windows/desktop/api/Winnls/nf-winnls-getnlsversionex) , чтобы получить определенную версию и версию NLS для таблицы сортировки.

## <a name="index-the-database"></a>Индексирование базы данных

По соображениям производительности при индексировании базы данных приложение должно следовать этой процедуре.

**Правильная индексация базы данных**

1.  Для каждой функции сохраните версию NLS, ключи сортировки этой версии и сведения о сортировке для каждой индексированной строки.
2.  При увеличении дополнительного номера версии повторно индексировать ранее несортированные строки. Строки, затрагиваемые этим обновлением, должны быть ограничены теми, для которых [**иснлсдефинедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnlsdefinedstring) ранее возвращал **значение false**.
3.  Когда основной номер версии увеличивается, повторно индексирует все строки, так как обновленные весовые коэффициенты могут изменить поведение любой строки. Основные выпуски версий очень редки.

Проблемы с индексацией базы данных могут возникнуть по следующим причинам.

-   Более поздняя операционная система может определить кодовые точки, не определенные для более ранней операционной системы, тем самым изменяя сортировку.
-   Кодовые точки могут иметь разные веса сортировки в разных операционных системах из-за исправлений в языковой поддержке.

Чтобы сократить необходимость повторного индексирования базы данных в этих обстоятельствах, приложение может использовать [**иснлсдефинедстринг**](/windows/desktop/api/Winnls/nf-winnls-isnlsdefinedstring) , чтобы отличать определенные от неопределенных строк, чтобы приложение могла отклонять строки с неопределенными кодовыми точками. Использование [**жетнлсверсион**](/windows/desktop/api/Winnls/nf-winnls-getnlsversion) или [**жетнлсверсионекс**](/windows/desktop/api/Winnls/nf-winnls-getnlsversionex) позволяет приложению определить, влияет ли изменение NLS на языковой стандарт, используемый для конкретной таблицы индексов. Если изменение не влияет на языковой стандарт, приложению не нужно повторно индексировать таблицу.

## <a name="examples"></a>Примеры

В следующей таблице показаны эффекты некоторых флагов, используемых в функциях сортировки. В каждом случае выбор флагов определяет, считаются ли два разных символа равными для целей сортировки.



| Символ 1                                                        | Символ 2                                             | Значение по умолчанию | НОРМа \_ игноревидс | НОРМа \_ игнорекана | НОРМа \_ игноревидс \| нормигнорекана |
|--------------------------------------------------------------------|---------------------------------------------------------|---------|-------------------|------------------|------------------------------------|
| "あ"<br/> U + 3042 БУКВА ХИРАГАНА<br/>                | "ガ"<br/> U + 30A2 БУКВА КАТАКАНА A<br/>     | Равны | Равны           | Равно            | Равно                              |
| "オ"<br/> FF75 БУКВА КАТАКАНА U + A<br/>       | "オ"<br/> U + 30AA, КАТАКАНА, БУКВА O<br/>     | Равны | Равно             | Равны          | Равно                              |
| &<br/> FF22 ПРОПИСНАЯ ЛАТИНСКАЯ БУКВА B + U<br/> | "B"<br/> U + 0042 ЛАТИНСКАЯ ПРОПИСНАЯ БУКВА B<br/> | Равны | Равно             | Равны          | Равно                              |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Поддержка национальных языков](using-national-language-support.md)
</dt> <dt>

[Сортировка](sorting.md)
</dt> <dt>

[Извлечение и установка сведений о языковых стандартах](retrieving-and-setting-locale-information.md)
</dt> <dt>

[Использование нормализации Юникода для представления строк](using-unicode-normalization-to-represent-strings.md)
</dt> <dt>

[Вопросы безопасности: международные функции](security-considerations--international-features.md)
</dt> <dt>

[**CompareString**](/windows/win32/api/stringapiset/nf-stringapiset-comparestringw)
</dt> <dt>

[**компарестринжекс**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringex)
</dt> <dt>

[**CompareStringOrdinal**](/windows/desktop/api/Stringapiset/nf-stringapiset-comparestringordinal)
</dt> <dt>

[**финднлсстринг**](/windows/desktop/api/Winnls/nf-winnls-findnlsstring)
</dt> <dt>

[**финднлсстринжекс**](/windows/desktop/api/Winnls/nf-winnls-findnlsstringex)
</dt> <dt>

[**LCMapString завершилось ошибкой**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringa)
</dt> <dt>

[**лкмапстринжекс**](/windows/desktop/api/Winnls/nf-winnls-lcmapstringex)
</dt> </dl>

 

 
