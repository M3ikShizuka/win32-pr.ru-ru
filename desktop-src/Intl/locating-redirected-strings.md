---
description: В этом разделе обсуждаются программные инструкции по поиску перенаправленных строк реестра. Дополнительные сведения см. в разделе Использование перенаправления строк реестра.
ms.assetid: 03d1512f-35a6-4b3a-9a0e-97e17bd9b126
title: Поиск перенаправленных строк
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f11600ad57c04de54d914c2c876b67967dfa1467
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127274192"
---
# <a name="locating-redirected-strings"></a>Поиск перенаправленных строк

В этом разделе обсуждаются программные инструкции по поиску перенаправленных строк реестра. Дополнительные сведения см. [в разделе Использование перенаправления строк реестра](using-registry-string-redirection.md).

## <a name="load-a-language-neutral-registry-value"></a>Загрузка значения реестра Language-Neutral

в Windows Vista и более поздних версиях приложение MUI использует значение реестра, не зависящее от языка, чтобы разрешить доступ к строкам, зависящим от языка, хранящимся в таблице строковых ресурсов. Дополнительные сведения см. в разделе Создание Language-Neutral ресурса в [с помощью перенаправления строки реестра](using-registry-string-redirection.md).

Код приложения, считывающий не зависящее от языка значение из реестра, должен загрузить строки на правильном языке пользовательского интерфейса, вызвав [**реглоадмуистрингв**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa). При использовании этой функции приложению не нужно явно работать с загрузкой ресурсов.

Если вы обновляете существующее приложение в соответствии с языком реестра, не зависящим от языка, вы обычно сохраняете существующие строковые значения, локализованные для английского языка или другого языка в реестре в качестве резервных и для обеспечения обратной совместимости. Хранение литеральной строки в реестре позволяет приложению возвращаться к литеральной строке, если вызов [**реглоадмуистрингв**](/windows/win32/api/winreg/nf-winreg-regloadmuistringa) завершается ошибкой. Необходимо решить, как реализовать такой откат, так как MUI не поддерживает такую реализацию.

## <a name="use-shell-api-to-set-shortcut-strings-from-the-registry"></a>Использование API оболочки для задания строк ярлыка из реестра

Приложение может использовать API оболочки для создания строк для ярлыков, связывающих файлы или папки в меню " **Пуск** " или на рабочем столе. Дополнительные сведения см. в разделе Создание ресурсов для контекстных строк в [с помощью перенаправления строк реестра](using-registry-string-redirection.md).

Приложение может использовать [**шсетлокализеднаме**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) для загрузки отображаемого имени, совместимого с MUI, для ярлыка. Чтобы задать связанное всплывающее подсказку, следует использовать [**ишелллинк:: SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription) . Вызовы регистрируют строки в реестре. Рассмотрим следующие примеры, для которых "HKCR" представляет \_ раздел реестра hKey classes \_ root:


```C++
HKCR,"CLSID\%CLSID_AntiSpyware%",,,"Windows AntiSpyware"

HKCR,"CLSID\%CLSID_AntiSpyware%","LocalizedString",,"@%ProgramFiles%\Windows AntiSpyware\MSASCui.exe,-104"

HKCR,"CLSID\%CLSID_AntiSpyware%","InfoTip",,"@%ProgramFiles%\Windows AntiSpyware\MSASCui.exe,-208"
```



В первой строке представлена нелокализованная строка литерала для обеспечения обратной совместимости и возврата. Во второй строке показан способ регистрации отображаемого имени с помощью MUI. эта строка указывает идентификатор строки 104, хранящийся в Msascui.exe (для Windows XP) или в соответствующем файле для конкретного языка (для Windows Vista). Этот идентификатор строки соответствует параметру "Мое сетевое окружение". Третья строка в примере обрабатывает регистрацию подсказки. % CLSID \_ AntiSpyware% указывает переменную среды, представляющую идентификатор GUID, соответствующий идентификатору класса этого компонента.

в приведенном выше примере приложение вызывает [**шсетлокализеднаме**](/windows/win32/api/shellapi/nf-shellapi-shsetlocalizedname) , чтобы указать путь к исполняемому файлу для первых двух параметров, и укажите *идсрес* как "@% ProgramFiles% \\ Windows антишпионское \\MSASCui.exe, 104". вызов [**ишелллинк:: SetDescription**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishelllinka-setdescription)указывает путь для подсказки как "@% ProgramFiles% \\ Windows антишпионская \\MSASCui.exe, 208".

## <a name="query-friendly-document-type-names-in-the-registry"></a>Запрос понятных имен типов документов в реестре

Создание ресурсов для удобных имен типов документов рассматривается в разделе Создание ресурсов для удобных имен типов документов в [с помощью перенаправления строк реестра](using-registry-string-redirection.md). Чтобы запросить понятное имя документа, приложение должно использовать [**икуеряссоЦиатионс:: init**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-init), за которым следует вызов [**ИкуеряссоЦиатионс:: GetString**](/windows/win32/api/shlwapi/nf-shlwapi-iqueryassociations-getstring). При вызове **икуеряссоЦиатионс:: init** указывается тип документа, например ".txt". При вызове **икуеряссоЦиатионс:: GetString** необходимо указать ассокстр \_ фриендлидокнаме в качестве идентификатора строки.

## <a name="register-microsoft-management-console-snap-in-strings-not-read-from-the-registry"></a>Регистрация строк оснастки консоли управления (Майкрософт), не считанных из реестра

Приложение может использовать оснастку консоли управления Майкрософт (MMC) для размещения своих задач управления. Большинство строк обрабатываются как ресурсы с помощью параметров реестра, описанных в разделе Создание строковых ресурсов для консоли управления (Майкрософт) Snap-Ins в [разделе Использование перенаправления строк реестра](using-registry-string-redirection.md). Однако некоторые оснастки регистрируют значения строк реестра, которые консоль управления (MMC) не может прочитать из реестра. В этом случае оснастка должна получить значения с помощью интерфейса [**иснапинабаут**](/windows/win32/api/mmc/nn-mmc-isnapinabout) , совместимого с MUI.

## <a name="set-the-display-name-and-description-for-a-windows-service-from-the-registry"></a>установка отображаемого имени и описания для службы Windows из реестра

если приложение MUI использует службу Windows, оно должно отображать отображаемое имя и описание службы. связанные ресурсы обсуждаются в разделе "создание строковых ресурсов для Windowsной службы" раздела [использование перенаправления строк реестра](using-registry-string-redirection.md).

Чтобы задать отображаемое имя службы, приложение MUI вызывает [**CreateService**](/windows/win32/api/winsvc/nf-winsvc-createservicea) или [**чанжесервицеконфиг**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfiga). Имя является строкой в формате " `@<PE-path>,-<stringID>[;<comment>]` ". Например, если служба реализуется с помощью файла .dll с путем% ProgramFiles% \\ % MyPath% \\MyDll.dll, а строковый идентификатор отображаемого имени для конкретного языка — 347, параметр указывается как " `@%ProgramFiles%\\%MyPath%\\MyDll.dll,-347` ". Двойная обратная косая черта ( \\ \\ ) необходима, поскольку C/C++ использует обратную косую черту в качестве escape-символа в строках.

Чтобы задать описание службы для конкретного языка, приложение MUI должно сделать элемент **лпдескриптион** в структуре [**\_ описания службы**](/windows/win32/api/winsvc/ns-winsvc-service_descriptiona) указать строку формы " `@<PE-path>,-<stringID>[;<comment>]` ", ссылающуюся на соответствующий идентификатор строки. Затем приложение вызывает [**ChangeServiceConfig2**](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfig2a) с параметром *двинфолевел* , указанным как \_ Описание конфигурации службы \_ , и параметр *LpInfo* , указанный в качестве структуры **\_ описания службы** .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Поиск ресурсов Win32 PE](locating-win32-pe-resources.md)
</dt> <dt>

[Использование перенаправления строк реестра](using-registry-string-redirection.md)
</dt> </dl>

 

 
