---
description: Языки со сложными скриптами разбиваются на кластеры с помощью Скриптшапе. Изменение порядка символов всегда происходит в границах кластера. Сами по себе кластеры гарантированно передаются в направлении порядка чтения.
ms.assetid: 50b4b643-af96-4a6f-80f9-27a71ce16b0e
title: Управление размещением курсора и проверкой попадания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 02e1c6d3b9dbd54f3df2b458a3f7473d1021dceafd6772730b8482b06c4e1c4e
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119788404"
---
# <a name="managing-caret-placement-and-hit-testing"></a>Управление размещением курсора и проверкой попадания

Языки со сложными скриптами разбиваются на [кластеры](uniscribe-glossary.md) с помощью [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape). Изменение порядка символов всегда происходит в границах кластера. Сами по себе кластеры гарантированно передаются в направлении порядка чтения.

Сведения о кластере в логическом массиве кластера используются для равномерного совместного использования ширины кластера глифов между логическими символами, которые они представляют. Например, глиф алиф лам делится на четыре области:

-   Ведущая половина лам.
-   Конечная половина лам.
-   Начальная половина Алиф.
-   Конечная половина Алиф.

Соглашения о размещении курсоров в кластерах зависят от скрипта. Для арабского скрипта, если задано расположение курсора между базовым символом и его комбинированной меткой, курсор отображается на середине по базовому символу. Для тайского скрипта курсор не может быть помещен в кластер. Таким же, когда пользователь перемещает курсор, приложение должно продвинуть все глифы, составляющие кластер.

Функции [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) и [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) преобразуются между позициями курсора (в смещениях кодовых точек) и позициями x (в пикселях). Функция **скрипткстокп** имеет знания о соглашениях о положении курсора для каждого скрипта:

-   Для Индийского и тайского положения курсоров привязываются к границам кластера.
-   Для арабского положения курсоров интерполируются с кластерами.
-   Для иврита, в версиях до Usp10.dll версии 1,420, позиции курсора интерполируются с кластерами. Начиная с Usp10.dll версии 1,420, позиции курсора привязываются к границам кластера.

И [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) , и [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) работают только в пределах выполнения. Функция требует, чтобы определенные параметры были получены из предыдущих вызовов Uniscribe, как показано в следующей таблице.



| Параметр                                        | Источник                                                 |
|--------------------------------------------------|--------------------------------------------------------|
| *СРП*                                            | Возвращается методом [**скриптитемизе**](/windows/desktop/api/Usp10/nf-usp10-scriptitemize). |
| *кглифспвлогклуст*<br/> *псва*<br/> | Возвращается методом [**скриптшапе**](/windows/desktop/api/Usp10/nf-usp10-scriptshape).     |
| *пиадванце*                                      | Возвращается методом [**скриптплаце**](/windows/desktop/api/Usp10/nf-usp10-scriptplace).     |



 

Приложение должно установить запуск, в котором заданное смещение курсора или позиция по оси x, перед передачей информации в [**скрипткптокс**](/windows/desktop/api/Usp10/nf-usp10-scriptcptox) или [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp). Если приложение не сохраняет сведения о ширине, оно может выполнить проверку попадания и положение курсора после отображения каждого запуска. В качестве альтернативы приложение может кэшировать достаточно информации для проверки попадания и размещения курсора в текущей строке без необходимости повторной обработки абзаца.

[**Скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) Возвращает конечное значение ребра, чтобы приложение знало сторону символа или кластера, в котором пользователь щелкнул. Значение равно 0 или ширине символа или кластера в кодовых позициях. Возвращаемая позиции символа является позицией символа, на который щелкнул пользователь. Дополнительные сведения см. [в разделе отображение курсора в двунаправленных строках](displaying-the-caret-in-bidirectional-strings.md).

Для таких языков, как тайский, для которых пользователь не должен располагать курсором в кластере, [**скрипткстокп**](/windows/desktop/api/Usp10/nf-usp10-scriptxtocp) устанавливает для конечного флага значение 0 или ширину кластера. Для таких языков, как арабский, для которых пользователь должен иметь возможность редактирования в кластере, **скрипткстокп** устанавливает для конечного флага значение 0 или значение 1.

Чтобы помочь приложению установить допустимые расположения курсора при обработке клавиш со стрелками, Uniscribe предоставляет сведения о допустимых позициях курсора в элементе **фчарстоп** в логических атрибутах, возвращенных [**скриптбреак**](/windows/desktop/api/Usp10/nf-usp10-scriptbreak). **Значение true** возвращается для большинства символов и **false** для символов между кластерами в таких скриптах, как тайский. Приложение должно проверить значение **фнидскаретинфо** в структуре [**\_ свойств скрипта**](/windows/desktop/api/Usp10/ns-usp10-script_properties) для элемента, чтобы узнать, нужно ли вызывать **скриптбреак** для проверки допустимости позиций курсора. Если значение **фнидскаретинфо** равно **false**, то все кодовые точки являются допустимыми позициями курсора.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование Uniscribe](using-uniscribe.md)
</dt> </dl>

 

 




