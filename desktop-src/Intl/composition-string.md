---
description: Строка композиции — это текущий текст в окне композиции.
ms.assetid: ab226567-f68d-4fa4-9ead-e9bfabde927e
title: Строка композиции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05a547b4383c95b99025b779de2950c8325af56a3397603db10199474dfe20ce
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119430994"
---
# <a name="composition-string"></a>Строка композиции

Строка композиции — это текущий текст в окне композиции. Это текст, который редактор IME преобразует в конечные символы. Каждая строка композиции состоит из одного или нескольких "предложений". Предложение — это наименьшее сочетание символов, которое редактор IME может преобразовать в окончательный символ. Чтобы получить и задать строку композиции, приложение вызывает функции [**иммжеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) и [**иммсеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) соответственно.

При вводе пользователем текста в окне композиции редактор IME отслеживает состояние строки композиции. Это состояние включает сведения об атрибутах, сведения о предложении, вводе данных и положении курсора. Приложение может получить состояние композиции с помощью функции [**иммжеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immgetcompositionstringa) .

Сведения об атрибутах подготавливаются к просмотру в массиве 8-разрядных значений, указывающих состояние символов в строке композиции. Все символы одного предложения должны иметь один и тот же атрибут. Массив включает по одному значению для каждого байта в строке, в том числе по одному байту для интереса и ко второму байтам любых двухбайтовых символов в строке. Для каждого значения в массиве биты 0 – 3 могут иметь одно сочетание следующих значений.



| Значение                      | Значение                                                                                                   |
|----------------------------|-----------------------------------------------------------------------------------------------------------|
| \_Вход attr                | Символ, вводимых пользователем. Редактор IME еще не преобразует этот символ.                           |
| \_Ошибка ввода атрибута attr \_         | Символ ошибки, который редактор IME не может преобразовать. Например, редактор IME не может объединить несколько согласных. |
| \_целевой объект attr \_ преобразован    | Символ, выбранный пользователем, а затем преобразованный редактором IME.                                             |
| Превышено \_ Преобразование attr            | Символ, который уже преобразован редактором IME.                                                             |
| \_целевой \_ нотконвертед attr | Преобразуемый символ. Пользователь выбрал этот символ, но редактор IME еще не его преобразовал.     |
| ATTR \_ фикседконвертед       | Символы, которые редактор IME больше не будет преобразовывать.                                                           |



 

Все остальные значения зарезервированы. В японском языке любой непреобразованный символ, имеющий \_ входной атрибут attr, — это символ хирагана, катакана или алфавитно-цифровой знак. В корейском языке этот атрибут представляет символ хангыль, который еще не преобразован редактором IME. В традиционном китайском и упрощенном китайском языке каждый редактор IME может ограничить свой символ в каком бы то ни было диапазоне.

Сведения о предложении, включенные в состояние строки композиции, — это массив из 32-разрядных значений, указывающий позиции предложений в строке композиции. Массив включает по одному значению для каждого предложения и конечное значение, указывающее длину полной строки. Каждое значение в массиве указывает смещение в байтах от начала строки до предложения. Первое значение всегда равно 0, поскольку первое предложение всегда начинается с начала строки. Например, если строка имеет два предложения, сведения о предложении имеют три значения: первое значение равно 0, второе значение — смещение второго предложения, а третье значение — Длина строки. Для Юникода позиция предложения учитывается в символах Юникода, а длина строки — это размер в символах Юникода.

Сведения о вводе в состояние строки композиции — это строка символов, завершающаяся нулем, представляющая символы, вводимые пользователем на клавиатуре.

Позицией курсора, включенной в состояние строки композиции, является значение, указывающее позицию курсора относительно символов в строке композиции. Значение — это смещение в байтах от начала строки. Если это значение равно 0, курсор находится непосредственно перед первым символом в строке. Если значение равно длине строки, курсор находится сразу после последнего символа. Если значение равно 1, курсор отсутствует. Для Юникода обе позиции и длина измеряются в символах Юникода.

Приложение может задать строку композиции или элементы состояния композиции с помощью функции [**иммсеткомпоситионстринг**](/windows/desktop/api/Imm/nf-imm-immsetcompositionstringa) . Чтобы обеспечить обновление внешнего вида окна композиции на основе этих изменений, функция позволяет приложению отправить в окно сообщение уведомления. Приложения, которые устанавливают сочетание элементов состояния композиции, обычно отключают уведомления для всех вызовов этой функции, кроме последнего, чтобы для окна композиции создавалось только одно сообщение уведомления.

Наконец, элемент управления "поле ввода" поддерживает два сообщения для изменения обработки строк композиции с помощью IME. Дополнительные сведения см. в разделе [**EM \_ Жетиместатус**](../controls/em-getimestatus.md) и [**EM \_ сетиместатус**](../controls/em-setimestatus.md). Дополнительные сведения об элементе управления "поле ввода" см. в разделе [Edit Control](../controls/edit-controls.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[О диспетчере методов ввода](about-input-method-manager.md)
</dt> </dl>

 

 
