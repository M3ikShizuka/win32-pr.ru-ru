---
description: Поставщик времени реализуется в виде библиотеки DLL. Каждая библиотека DLL может поддерживать несколько поставщиков времени. Каждый поставщик отвечает за собственную конфигурацию и синхронизацию.
ms.assetid: 04f523d7-7e99-4bf5-941f-ae67f4b9df0a
title: Создание поставщика времени
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 93ac5a12e19651d88c3328ac72280c486a54c4d0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664714"
---
# <a name="creating-a-time-provider"></a>Создание поставщика времени

Поставщик времени реализуется в виде библиотеки DLL. Каждая библиотека DLL может поддерживать несколько поставщиков времени. Каждый поставщик отвечает за собственную конфигурацию и синхронизацию.

Поставщики времени должны реализовывать следующие функции обратного вызова:

-   [**тимепровклосе**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovclose)
-   [**тимепровкомманд**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovcommand)
-   [**тимепровопен**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovopen)

После загрузки библиотеки DLL поставщика Диспетчер поставщиков времени вызывает [**тимепровопен**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovopen), передавая имя поставщика и указатели на следующие функции:

-   [**алертсамплесаваилфунк**](/windows/desktop/api/Timeprov/nc-timeprov-alertsamplesavailfunc)
-   [**жеттимесисинфофунк**](/windows/desktop/api/Timeprov/nc-timeprov-gettimesysinfofunc)
-   [**логтимепровевентфунк**](/windows/desktop/api/Timeprov/nc-timeprov-logtimeproveventfunc)

Эти функции предназначены для использования поставщиком времени. Поставщик времени использует [**тимепровопен**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovopen) для возврата маркера поставщика, используемого диспетчером поставщиков времени при отправке команд поставщику времени. Значение Handle определяется поставщиком времени и используется в основном для различения разных поставщиков, реализованных в одной и той же библиотеке DLL. Поставщик времени может регистрировать важные события с помощью [**логтимепровевентфунк**](/windows/desktop/api/Timeprov/nc-timeprov-logtimeproveventfunc).

Диспетчер поставщиков времени использует [**тимепровкомманд**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovcommand) для отправки команд поставщику времени. Когда поставщику времени необходимо уведомить Диспетчер поставщиков времени о наличии доступных образцов времени, он вызывает [**алертсамплесаваилфунк**](/windows/desktop/api/Timeprov/nc-timeprov-alertsamplesavailfunc). Затем Диспетчер поставщиков времени вызывает **тимепровкомманд** с помощью команды TPC \_ ресамплинг для получения образцов времени. Для запроса образца диспетчером поставщиков времени может потребоваться до 16 секунд. Поэтому приложение не должно ждать запроса.

Чтобы обеспечить точность, поставщик времени должен получить все сведения, связанные со временем, с помощью [**жеттимесисинфофунк**](/windows/desktop/api/Timeprov/nc-timeprov-gettimesysinfofunc).

Когда время завершения работы поставщика времени завершается, Диспетчер поставщиков времени вызывает [**тимепровклосе**](/windows/desktop/api/Timeprov/nf-timeprov-timeprovclose).

 

 



