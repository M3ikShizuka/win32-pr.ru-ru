---
description: Время файла — это 64-разрядное значение, представляющее число 100-наносекундных интервалов, прошедших с 12:00 утра. 1 января 1601 скоординированного всемирного времени (UTC). Система записывает время файла, когда приложения создают файлы, обращаются к ним и записывают их.
ms.assetid: 52d80b82-9ab0-4631-9e70-85df21da4946
title: Время файла
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1492597b4e71775974ed8b19f6109c5900a8a28720b769c1c10dcf2f70166b7d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117764496"
---
# <a name="file-times"></a>Время файла

*Время файла* — это 64-разрядное значение, представляющее число 100-наносекундных интервалов, прошедших с 12:00 утра. 1 января 1601 скоординированного всемирного времени (UTC). Система записывает время файла, когда приложения создают файлы, обращаются к ним и записывают их.

В файловой системе NTFS значения времени хранятся в формате UTC, поэтому изменения в часовом поясе и летнем времени не затрагиваются. Файловая система FAT хранит значения времени на основе местного времени компьютера. Например, файл, сохраненный в 3:12:00 PST в Вашингтоне, отображается как 6:12:00 EST в Нью-Йорке на томе NTFS, но он отображается как 3:12:00 EST в Нью-Йорке на томе FAT.

Метки времени обновляются в различные моменты времени и по различным причинам. Единственной гарантией метки времени файла является то, что время файла правильно отражается при закрытии маркера, который вносит изменения.

Не все файловые системы могут записывать время создания и последнего доступа, а не все файловые системы записывают их одинаковым образом. Например, разрешение на создание времени в файловой системе FAT составляет 10 миллисекунд, а время записи имеет разрешение в 2 секунды, а время доступа — 1 день, поэтому на самом деле это Дата доступа. Файловая система NTFS задерживает обновление времени последнего доступа к файлу до 1 часа после последнего доступа.

Чтобы получить время файла для указанного файла, используйте функцию [**функции getFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) . **Функции getFileTime** копирует создание, Последний доступ и время последней записи в отдельные структуры [**fileTime**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) . Кроме того, можно получить время файла с помощью функций [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) и [**FindNextFile**](/windows/desktop/api/fileapi/nf-fileapi-findnextfilea) . Эти функции копируют время файла в структуры **fileTime** в структуре [**данных Win32 \_ Find \_**](/windows/desktop/api/minwinbase/ns-minwinbase-win32_find_dataa) . При записи в файл последнее время записи не обновляется полностью до тех пор, пока не будут закрыты все дескрипторы, используемые для записи.

Чтобы задать время файла для файла, используйте функцию [**сетфилетиме**](/windows/desktop/api/FileAPI/nf-fileapi-setfiletime) . Эта функция позволяет изменять время создания, последнего доступа и времени последней записи без изменения содержимого файла. Можно сравнить время различных файлов с помощью функции [**компарефилетиме**](/windows/desktop/api/FileAPI/nf-fileapi-comparefiletime) . Функция сравнивает два файловых времени и возвращает значение, указывающее, какое время позже или возвращает 0 (нуль), если значения времени равны.

Если планируется изменить время файла для указанных файлов, можно преобразовать дату и время суток в файловый момент с помощью функции [**SystemTimeToFileTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime) . Можно также получить системное время в структуре [**fileTime**](/windows/win32/api/minwinbase/ns-minwinbase-filetime) , вызвав функцию [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) .

Чтобы упростить отображение времени в файле для пользователя, используйте функцию [**филетиметосистемтиме**](/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime) . **Филетиметосистемтиме** преобразует время файла и копирует месяц, день, год и время суток из времени файла в структуру [**SYSTEMTIME**](/windows/win32/api/minwinbase/ns-minwinbase-systemtime) .

## <a name="file-times-and-daylight-saving-time"></a>Время файла и летнее время

Необходимо соблюдать осторожность при использовании файлового времени, если пользователь установил автоматическую регулировку перехода на летнее время.

Чтобы преобразовать время файла в местное время, используйте функцию [**филетиметолокалфилетиме**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime) . Однако **филетиметолокалфилетиме** использует текущие настройки часового пояса и летнего времени. Таким образом, если это летнее время, оно принимает на себя переход на летнее время, даже если время преобразования файла — стандартное время.

Файловая система FAT записывает время на диск по местному времени. [**Функции getFileTime**](/windows/desktop/api/FileAPI/nf-fileapi-getfiletime) извлекает кэшированные значения времени в формате UTC из файловой системы FAT. Когда он переходит на летнее время, время, полученное **функции getFileTime** , будет отключено в течение часа, так как кэш не обновляется. При перезагрузке компьютера в кэшированное время, которое **функции getFileTime** извлекает, верно. [**FindFirstFile**](/windows/desktop/api/fileapi/nf-fileapi-findfirstfilea) извлекает местное время из файловой системы FAT и преобразует его в формат UTC с использованием текущих параметров часового пояса и летнего времени. Таким образом, если это летнее время, **FindFirstFile** принимает на себя летнее время, даже если время преобразования файла — стандартное время.

Файловая система NTFS записывает время на диск в формате UTC. Чтобы учитывать переход на летнее время при преобразовании файлового времени в местное время, используйте следующую последовательность функций вместо использования [**филетиметолокалфилетиме**](/windows/desktop/api/FileAPI/nf-fileapi-filetimetolocalfiletime):

-   [**филетиметосистемтиме**](/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime)
-   [**системтиметотзспеЦификлокалтиме**](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetotzspecificlocaltime)
-   [**SystemTimeToFileTime**](/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime)

## <a name="file-times-and-cdfs"></a>Время файла и CDFS

Метки даты и времени для файлов, расположенных на носителе или исходящих из носителя с использованием файловой системы компакт-диска (CDFS), корректируются для местного часового пояса. ISO 9660 указывает на то, что CDFS правильно отображает сведения о дате для местного часового пояса. Это делается так, что даты для файлов в CDFS отображаются так же, как и в формате универсального диска (UDF). UDF — это новый стандарт для дистрибутивного носителя. Если код зависит от сведений о неизмененной дате для файла, который находится на носителе или исходит из него с помощью CDFS, возможно, он работает неправильно.

 

 
