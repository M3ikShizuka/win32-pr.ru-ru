---
title: Сбор дампов User-Mode
description: начиная с Windows Server 2008 и Windows Vista с пакетом обновления 1 (SP1), отчеты об ошибках Windows (WER) можно настроить таким образом, чтобы все дампы пользовательского режима собираются и сохранялись локально после сбоя приложения пользовательского режима.
ms.assetid: 8dad892b-04df-4aeb-b6c4-82f7676d382a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e6291d3ad8dfeb641582a93f6789ca7844594ad
ms.sourcegitcommit: 892997f4126d44df413286074e08a9c6065313ec
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/16/2021
ms.locfileid: "114300189"
---
# <a name="collecting-user-mode-dumps"></a>Сбор дампов User-Mode

начиная с Windows Server 2008 и Windows Vista с пакетом обновления 1 (SP1), отчеты об ошибках Windows (WER) можно настроить таким образом, чтобы все дампы пользовательского режима собираются и сохранялись локально после сбоя приложения пользовательского режима. Приложения, которые выполняют пользовательские отчеты о сбоях, включая приложения .NET, не поддерживаются этой функцией.

Эта функция отключена по умолчанию. Для включения функции требуются права администратора. чтобы включить и настроить компонент, используйте следующие значения реестра в разделе **\_ \_ программное обеспечение для локального компьютера HKEY \\ \\ Microsoft \\ Windows \\ отчеты об ошибках Windows \\ локалдумпс** key.

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Применение</th>
<th>Описание</th>
<th>Тип</th>
<th>Значение по умолчанию</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>думпфолдер</strong></td>
<td>Путь, по которому должны храниться файлы дампа. Если путь по умолчанию не используется, убедитесь, что в папке содержатся списки управления доступом, позволяющие процессу аварийного завершения записывать данные в папку. Для сбоев службы дамп записывается в папки профиля конкретной службы в зависимости от используемой учетной записи службы. Например, папка Profile для системных служб —%WINDIR%\System32\Config\SystemProfile. Для сетевых и локальных служб папка является%Виндир%\сервицепрофилес..<br/></td>
<td>REG_EXPAND_SZ</td>
<td>%локалаппдата%\крашдумпс</td>
</tr>
<tr class="even">
<td><strong>думпкаунт</strong></td>
<td>Максимальное число файлов дампа в папке. Если превышено максимальное значение, самый старый файл дампа в папке будет заменен новым файлом дампа.</td>
<td>REG_DWORD</td>
<td>10</td>
</tr>
<tr class="odd">
<td><strong>думптипе</strong></td>
<td>Укажите один из следующих типов дампа:
<ul>
<li>0: Пользовательский дамп</li>
<li>1: мини-дамп</li>
<li>2: полный дамп</li>
</ul></td>
<td>REG_DWORD</td>
<td>1</td>
</tr>
<tr class="even">
<td><strong>кустомдумпфлагс</strong></td>
<td>Используемые параметры пользовательского дампа. Это значение используется, только если <strong>думптипе</strong> имеет значение 0.<br/> Параметры являются побитовой комбинацией значений перечисления <a href="/windows/desktop/api/minidumpapiset/ne-minidumpapiset-minidump_type"><strong>MINIDUMP_TYPE</strong></a> .<br/></td>
<td>REG_DWORD</td>
 <td><code>0x00000121</code> (<code>MiniDumpWithDataSegs | MiniDumpWithUnloadedModules | MiniDumpWithProcessThreadData == 0x00000001 | 0x00000020 | 0x00000100)</code></td>
</tr>
</tbody>
</table>

>[!NOTE]
> Аварийный дамп не собирается при установке [автоматической отладки для сбоев **приложений**](../debug/configuring-automatic-debugging.md#configuring-automatic-debugging-for-application-crashes). 

Эти значения реестра представляют глобальные параметры. Кроме того, можно указать параметры для каждого приложения, которые переопределяют глобальные параметры. чтобы создать параметр для каждого приложения, создайте новый ключ для приложения в разделе **hkey \_ local \_ machine \\ software \\ microsoft \\ Windows \\ отчеты об ошибках Windows \\ локалдумпс** (например, **hkey \_ local \_ machine \\ software \\ microsoft \\ Windows \\ отчеты об ошибках Windows \\ локалдумпс \\MyApplication.exe**). Добавьте параметры дампа в раздел **MyApplication.exe** . Если приложение аварийно завершает работу, WER сначала считывает глобальные параметры, а затем переопределяет все параметры с параметрами конкретного приложения.

После сбоя приложения и до его завершения система проверит параметры реестра, чтобы определить, следует ли собирать локальный дамп. После завершения сбора дампа приложение будет разрешено завершаться нормально. Если приложение поддерживает восстановление, то перед вызовом функции обратного вызова восстановления производится сбор локального дампа.

Эти дампы настраиваются и управляются независимо от остальной инфраструктуры WER. Можно использовать локальную коллекцию дампов, даже если средство WER отключено или пользователь отменяет отчеты об WER. Локальный дамп может отличаться от дампа, отправленного в корпорацию Майкрософт.

 

