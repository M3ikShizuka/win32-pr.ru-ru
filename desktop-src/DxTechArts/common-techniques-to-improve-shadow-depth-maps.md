---
title: Распространенные методики по улучшению карт глубины теней
description: В этой технической статье представлен обзор некоторых распространенных алгоритмов карты глубины тени и общих артефактов, а также объясняется несколько приемов — от базовых до промежуточных, которые можно использовать для повышения качества стандартных теневых карт.
ms.assetid: bf994838-a261-0379-9301-eb9b250d216c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aafff1b537830ae0ee681ed32932cca2b6274a4d9da3e0471ef498e0bef2d483
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120102538"
---
# <a name="common-techniques-to-improve-shadow-depth-maps"></a>Распространенные методики по улучшению карт глубины теней

Теневые карты, впервые представленные в 1978, являются распространенной методикой для добавления темных участков в игры. Спустя три десятка лет, несмотря на развитие оборудования и программного обеспечения, теневые артефакты — Шиммеринг края, псевдонимы перспектив и другие проблемы с точностью — сохраняются.

В этой технической статье представлен обзор некоторых распространенных алгоритмов карты глубины тени и общих артефактов, а также объясняется несколько приемов — от базовых до промежуточных, которые можно использовать для повышения качества стандартных теневых карт. Добавление базовых теневых карт к названию обычно является простым, но понимание нюансов теневых артефактов может быть непростой задачей. Эта Техническая статья написана для разработчиков промежуточных графических объектов, которые реализуют тени, но не полностью понимают, почему появляются конкретные артефакты и не уверены, как их обойти.

Выбор правильных методик для устранения конкретных артефактов является нетривиальной задачей. При устранении недостатков теневой схемы можно вычислить разницу в качества (рис. 1). Правильное внедрение этих методов радикально улучшает стандартные тени. Методы, описанные в этой статье, реализованы в примере CascadedShadowMaps11 в пакете SDK DirectX.

**Рис. 1. Тени с серьезными артефактами (слева) и тенями после реализации методик, описанных в этой статье (справа)**

![тени с серьезными артефактами (слева) и тенями после реализации методик, описанных в этой статье (справа)](images/shadows-before-and-after.jpg)

## <a name="shadow-depth-maps-review"></a>глубина тени Карты проверка

Алгоритм карты глубины тени — это алгоритм с двумя проходами. Первый проход создает карту глубины в пространстве. На втором этапе эта схема используется для сравнения глубины каждого пикселя в области освещения с соответствующей глубиной на карте глубины освещения.

**Рис. 2. Ключевые части теневой сцены**

![Ключевые части теневой сцены](images/key-parts-of-shadow-scene.jpg)

### <a name="pass-1"></a>1 проход

Сцена показана на рис. 2. На первом этапе (рис. 3) геометрия отображается в буфере глубины с точки зрения освещения. В частности, шейдер вершин преобразует геометрию в пространство с небольшими представлениями.

Конечным результатом первого прохода является буфер глубины, содержащий сведения о глубине сцены с точки зрения освещения. Теперь это можно использовать на этапе 2, чтобы определить, какие пиксели перекрыто от светлого.

**Рис. 3. Первый проход базовой теневой карты**

![первый проход базовой теневой карты](images/first-pass-of-basic-hadow-mapping.png)

### <a name="pass-2"></a>2 прохода

На втором этапе (рис. 4) шейдер вершин преобразует каждую вершину дважды. Каждая вершина преобразуется в пространство просмотра камеры и передается шейдеру пикселей в качестве расположения. Каждая вершина также преобразуется в матрицу «вид-проекция-текстура» источника и передается шейдеру пикселей в виде координаты текстуры. Матрица View-проекция-текстура — это та же матрица, которая используется для отрисовки сцены в проходе 1 с одним дополнительным преобразованием. Это преобразование, которое масштабирует и преобразует точки из пространства просмотра (от – 1 до 1 в X и Y) в пространство текстуры (от 0 до 1 в X и 1 до 0 в Y).

Построитель текстуры получает в виде интерполяции и интерполяции координаты текстуры. Все, что необходимо для выполнения теста глубины, теперь находится в этой координате текстуры. Теперь можно выполнить тест глубины, выполнив индексирование буфера глубины с первого прохода с координатами текстуры X и Y и сравнив полученное значение глубины с координатой Z-текстуры.

**Рис. 4. Второй этап базового сопоставления**

![второй этап базового сопоставления](images/second-pass-of-basic-shadow-mapping.png)

## <a name="shadow-map-artifacts"></a>Теневая схема Artifacts

Алгоритм теневой схемы глубины тени является наиболее широко используемым алгоритмом теневого отображения в реальном времени, но по-прежнему создает несколько артефактов, которые требуют устранения. Ниже перечислены типы артефактов, которые могут быть выполнены.

### <a name="perspective-aliasing"></a>Присвоение псевдонимов перспективам

Псевдоним перспективы, общий артефакт, показан на рис. 5. Это происходит, когда сопоставление пикселей в области просмотра для пикселей текстуры в теневой карте не является отношением «один к одному». Это связано с тем, что пикселы близко к ближайшему плоскости расположены ближе друг к другу и нуждаются в более высоком разрешении теневой карте.

На рис. 6 показана теневая схема и представление фрустум. Рядом с глазом Пиксели расположены ближе друг к другу, и многие Пиксели сопоставляются с одним и тем же теневым пикселей текстуры. Пиксели, находящиеся на дальней плоскости, распределяются, тем самым уменьшая псевдонимы перспективы.

**Рис. 5. Сглаживание с высоким уровнем перспективы (слева) и с низкими перспективами (справа)**

![сглаживание с высоким уровнем перспективы (слева) и с низкими перспективами (справа)](images/high-perspective-aliasing-vs-low-perspective-aliasing.jpg)

Для изображения слева псевдоним перспективы имеет больший приоритет; слишком много пробельных пикселей сопоставляются с одним и тем же пикселей текстуры теневой схемы. На изображении справа в качестве псевдонима перспективы мало, так как имеется 1:1 сопоставление между пикселями глаза и пикселей текстуры теневой карты.

**Рис. 6. Просмотр фрустум с теневой картой**

![Просмотр фрустум с теневой картой](images/view-frustum-with-shadow-map.jpg)

Светлое пикселы в дальней плоскости представляют собой псевдонимы с низкой перспективой, а темные пиксели в ближней плоскости — псевдонимы с высокой перспективой.

Разрешение теневой гиперкарты также может быть слишком высоким. Хотя более заметное разрешение менее заметно, это может привести к тому, что небольшие объекты, например телефонные провода, не приводят к теням. Кроме того, слишком высокое разрешение может вызвать серьезные проблемы с производительностью из-за схем доступа к текстурам.

Теневые карты перспективы (ПСМС) и точки с пониженным расстоянием (Лспсмс) пытаются попытаться подать псевдонимы перспективам путем наклона матрицы-проекций освещения, чтобы разместить больше пикселей текстуры рядом с тем, где они нужны. К сожалению, ни один из этих методов не способен решать псевдонимы перспективы. Параметризация преобразования, необходимого для отображения пикселей пропикселей текстуры в теневой карте, не может быть привязана с помощью линейной наклона. Требуется логарифмическая параметризация. ПСМС слишком много близко к глазу, в результате чего отдаленные тени имеют низкую степень качества или даже исчезают. Лспсмс лучше нахождение средней земли между увеличением разрешения рядом с глазом и появление достаточной информации для объектов. Оба метода деформируют ортогональные тени в некоторых конфигурациях сцены. Эта дегенерация может быть отделена путем визуализации отдельной теневой схемы для каждой грани представления фрустум, хотя это дорого. С помощью теневых карт с логарифмической шкалой (Логпсмс) также отображается отдельная карта для каждого лица представления фрустум. Этот метод использует нелинейную растрирование, чтобы увеличить пикселей текстуры. Оборудование класса D3D10 и D3D11 не поддерживает нелинейную растрирование. Дополнительные сведения об этих методах и алгоритмах см. в разделе "ссылки".

Каскадные теневые карты (Ксмс) — это самая популярная методика для работы с псевдонимами перспективы. Хотя Ксмс можно сочетать с ПСМС и Лспсмс, он не нужен. использование ксмс для устранения ошибок псевдонимов перспективы приводится в сопровождающей статье с [каскадным затенением Карты](/windows/desktop/DxTechArts/cascaded-shadow-maps).

### <a name="projective-aliasing"></a>Проецирование псевдонимов

Проецированные псевдонимы сложнее показывать, чем псевдонимы перспективы. Затененные тени, выделенные на рис. 7, демонстрируют ошибки при проецировании псевдонимов. Постановка псевдонимов происходит, когда сопоставление между пикселей текстуры в пространстве камеры и пикселей текстуры в светлом пространстве не является отношением "один к одному". Это обусловлено ориентацией геометрии по отношению к светлой камере. При проецировании в геометрическую плоскость геометрии начинает параллельно с лампочками.

**Рис. 7. Высокий-проектный псевдоним по сравнению с низким-проецированным псевдонимом**

![высокий-проектный псевдоним по сравнению с низким-проецированным псевдонимом](images/high-projective-aliasing-vs-low%20projective-aliasing.jpg)

Методы, используемые для смягчения ошибок при назначении псевдонимов, также снижают опасность при использовании попроектного псевдонима. Поэлементное Присвоение псевдонимов происходит, когда нормальная поверхность поверхности является ортогональной; Эти поверхности должны получать меньше света на основе уравнений рассеянного освещения.

### <a name="shadow-acne-and-erroneous-self-shadowing"></a>Теневые акне и ошибочные Self-Shadowing

Теневая акне (рис. 8) — термин, сопоставляемый с неправильной тенью, происходит, когда теневая схема куантизес глубину для всего шаг текселя. Когда шейдер сравнивает фактическую глубину с этим значением, он, скорее всего, будет самозатенен, так как он должен быть скрыт.

Еще одна причина для теневого акне заключается в том, что шаг текселя в светлом пространстве настолько близко к глубине соответствующего шаг текселя в карте глубины, что ошибки точности приводят к ошибочному выполнению теста глубины. Одна из причин этой точности заключается в том, что схема глубины вычисляется аппаратным обеспечением для растрирования с фиксированной функцией, а глубина, сравниваемой с помощью, вычисляется шейдером. При проецировании псевдонимов также может возникнуть теневая акне.

**Рис. 8. Теневой акне артефакт**

![теневой акне артефакт](images/shadow-acne-artifact.jpg)

Как показано на рисунке слева, некоторые Пиксели не прошли тестирование глубины и создали спекклед артефакты и шаблоны моирé. Чтобы уменьшить ошибочное затенение, границы ближней плоскости и дальней плоскости для представления освещения фрустум должны быть как можно точными. Смещение глубины на основе шкалы наклона и другие типы сдвига — это другие решения, используемые для смягчения акне теневой копии.

### <a name="peter-panning"></a>Питер панорамирование

Термин *Питер панорамирование* извлекает свое имя из символа книги ребенка, тень которого стала отсоединена и кто может посвятить его. Этот артефакт делает так, чтобы объекты с отсутствующими темными тенями отсоединились от и перемещаются над поверхностью (рис. 9).

**Рис. 9. Артефакт панорамирования Питер**

![артефакт панорамирования Питер](images/peter-panning-artifact.jpg)

На изображении слева тень отсоединяется от объекта, создавая плавающий эффект.

Одним из способов удаления Surface акне является добавление некоторого значения в пиксельную точку в пространстве. Это называется добавлением смещения глубины. Питер выдает результаты панорамирования, если используется слишком большое смещение глубины. В этом случае смещение глубины приводит к ошибочному выполнению теста глубины. Как и в случае с теневым акне, Питер Панорамировани — усугубляться, когда в буфере глубины недостаточно точности. Вычисление тесных близких плоскостей и дальней плоскости также помогает избежать панорамирования Питер.

## <a name="techniques-to-improve-shadow-maps"></a>методы улучшения теневого Карты

Добавление теней к заголовку — это процесс. Первым шагом является работа с базовыми теневыми картами. Второй способ — обеспечить оптимальную работу всех базовых вычислений: Фруста по ширине, близко к дальнему, почти или далеко масштабируется жестко, используется наклонный сдвиг и т. д. После того как основные тени включены, разработчик имеет более точное представление о том, какие алгоритмы необходимы для получения достаточной точности. Ниже приведены основные советы, которые могут потребоваться для получения базовых теневых карт.

### <a name="slope-scale-depth-bias"></a>Slope-Scale смещение глубины

Как уже упоминалось, Самозатенение может привести к теневому акне. Добавление слишком большого смещения может привести к сдвигу Питер. Кроме того, многоугольники с интенсивным наклоненной (относительно светлой) значительно отличаются от составных псевдонимов, чем многоугольники с поверхностными наклоненнойами (относительно освещения). По этой причине для каждого значения карт глубины может потребоваться другое смещение в зависимости от наклона многоугольника относительно освещения.

Аппаратное обеспечение Direct3D 10 позволяет заменять многоугольник на основе его наклона относительно направления представления. Это влияет на применение большого смещения к многоугольнику, который просматривает ребро, в направлении освещения, но не применяет сдвиг к многоугольнику, направленному на свет напрямую. На рис. 10 показано, как два соседних пикселя могут переобъявляться между собой при тестировании по той же несмещенной наклонной линии.

**Рис. 10. Наклонное масштабирование — смещение по сравнению со смещением несмещенной глубины**

![Наклонное масштабирование — смещение по сравнению со смещением несмещенной глубины](images/slope-scaled-depth-bias-compared-to-unbiased-depth.png)

### <a name="calculating-a-tight-projection"></a>Вычисление плотной проекции

Тесная подгонка проекции освещения на представление фрустум увеличивает покрытие теневой схемы. На рис. 11 показано, что использование произвольной проекции или размещение проекции в границах сцены приводит к увеличению псевдонима перспективы.

**Рис. 11. Произвольные теневые фрустум и тень фрустум по размеру сцены**

![произвольные теневые фрустум и тень фрустум по размеру сцены](images/arbitrary-shadow-frustum-and-shadow-frustum-fit-to-scene.jpg)

Представление находится с точки зрения освещения. Трапеция представляет фрустум в представлении камеры. Сетка, нарисованная на изображении, представляет собой теневую карту. На изображении справа показано, что та же теневая схема разрешения создает более шаг текселя покрытие, если оно более тесно соответствует сцене.

На рис. 12 показаны фрустумс, которые правильно подходят. Чтобы вычислить проекцию, восемь точек, составляющих представление фрустум, преобразуются в область освещения. Далее будут найдены минимальное и максимальное значения X и Y. Эти значения составляют границы ортогональной проекции.

**Рис. 12. Теневая проекция по размеру представления фрустум**

![Теневая проекция по размеру представления фрустум](images/shadow-projection-fit-to-view-frustum.jpg)

Можно также обрезать фрустум в сцене ААББ, чтобы получить более тесную привязку. Это не рекомендуется во всех случаях, так как это может изменить размер проекции лампочки с Frame на кадр. Многие методы, например, описанные в разделе, в котором перемещается освещение Texel-Sized увеличиваются, дают лучшие результаты, когда размер проекции освещения остается постоянным в каждом кадре.

### <a name="calculating-the-near-plane-and-far-plane"></a>Вычисление ближней плоскости и дальней плоскости

Near плоскость и FAR — это конечные части, необходимые для вычисления матрицы проекции. Чем ближе объединяется плоскости, тем точнее значения в буфере глубины.

Буфер глубины может быть 16-битным, 24-битным или 32-битным, со значениями от 0 до 1. Как правило, буферы глубины являются фиксированными, а значения вблизи ближней плоскости группируются ближе друг к другу, чем значения, близкие к дальней плоскости. Степень точности, доступная для буфера глубины, определяется отношением ближней плоскости к дальней плоскости. Использование максимально близкой к дальней плоскости может позволить использовать 16-разрядный буфер глубины. 16-разрядный буфер глубины может уменьшить использование памяти при увеличении скорости обработки.

### <a name="aabb-based-near-plane-and-far-plane"></a>AABB-Based вблизи плоскости и дальней плоскости

Простой и упрощенный способ вычисления ближней плоскости и дальней плоскости заключается в преобразовании ограничивающего тома сцены в область освещения. Наименьшее значение координаты Z — это ближайшая плоскость, а самая крупная координата Z — это далеко плоскость. Для многих конфигураций сцены и освещения этот подход достаточно. Однако наихудший случай может привести к значительной утрате точности в буфере глубины. На рис. 13 показан такой сценарий. Здесь диапазон ближней плоскости до дальней плоскости составляет четыре раза больше, чем требуется.

Представление фрустум на рис. 13 было выбрано небольшим. Небольшое представление фрустум отображается в очень большой сцене, состоящей из идей, которые выходят за пределы представления камеры. Использование сцены ААББ для ближайших и дальнеих плоскостей не является оптимальным. алгоритм CSM, описанный в технической статье по [каскадным теневым Картыам](/windows/desktop/DxTechArts/cascaded-shadow-maps) , должен вычислять около и дальнее плоскости для очень мелких фрустумс.

**Рис. 13. Близкие и далекое плоскости на основе сцены ААББ**

![близкие и далекое плоскости на основе сцены ААББ](images/near-far-%20planes-based-on-scene-aabb.jpg)

### <a name="frustum-based-near-plane-and-far-plane"></a>Frustum-Based вблизи плоскости и дальней плоскости

Другой способ вычисления ближайших и дальнего плоскостей заключается в преобразовании фрустум в пустое пространство и использовании минимальных и максимальных значений в Z в качестве ближайших и дальнеих плоскостей соответственно. На рис. 14 показаны две проблемы, связанные с этим подходом. Во-первых, вычисление слишком консервативно, как показано, когда фрустум выходит за пределы сцены. Во-вторых, ближнее плоскость может быть слишком тесной, что приводит к обрезанию теней.

**Рис. 14. Почти и Far плоскости основаны исключительно на представлении фрустум**

![почти и Far плоскости основаны исключительно на представлении фрустум](images/near-far-planes-based-solely-on-view-frustum.jpg)

### <a name="light-frustum-intersected-with-scene-to-calculate-near-and-far-planes"></a>Светло Фрустум, пересекающийся с сценами для вычисления ближайших и Далекных плоскостей

Правильный способ вычисления ближайших и дальнеих плоскостей показан на рис. 15. Четыре из плоскостей ортогонального освещения фрустум были рассчитаны с использованием минимального и максимального значений координат X и Y представления фрустум в области освещения. Последние две плоскости ортогонального представления фрустумются вблизи и дальней плоскости. Чтобы найти эти плоскости, границы сцены обрезаются по четырем известным голубым фрустум плоскости. Наименьшее и самое большое значение Z от вновь обрезанной границы представляет собой близкую плоскость и большую плоскость соответственно.

Код, выполняющий эту операцию, находится в примере CascadedShadowMaps11. Восемь точек, из которых состоит ААББ мира, преобразуются в световую область. Преобразование точек в область освещения упрощает тест обрезки. Четыре известные плоскости светлого фрустум теперь можно представить в виде строк. Ограничивающий том сцены в области освещения можно представить как шесть куадрилатералс. Эти 6 куадрилатералс могут быть включены в 12 треугольников для усечения на основе треугольника. Треугольники обрезаются относительно известных плоскостей представления фрустум (это горизонтальные и вертикальные линии в X и Y в пространстве). При обнаружении точки пересечения в X и Y трехмерный треугольник обрезается в этой точке. Минимальное и максимальное значения Z всех обрезанных треугольников — это близкая плоскость и дальнее расстояние. В примере CascadedShadowMaps11 показано, как выполнить эту обрезку в функции **компутенеарандфар** .

Существует еще две методики, которые можно использовать для вычисления тесно возможных ближайших плоскостей. Эти методы не показаны в примере Каскадедшадовмапс.

-   Равномерное приближение и далекое плоскости можно вычислить путем пересечения иерархии сцены или отдельных объектов сцены с светлой фрустум. Это было бы более сложным. Хотя это и не показано в примере CascadedShadowMaps11, это может быть допустимым методом для некоторых плиток.
-   На дальней плоскости можно рассчитать, выполнив минимум:

    -   Самая большая глубина представления, фрустум в виде светлого пространства.
    -   Самая большая глубина пересечения представления фрустум и сцены ААББ.

Этот подход может быть проблематичным при использовании с каскадными теневыми картами, где можно индексировать за пределами представления фрустум. В этом случае на теневой карте может отсутствовать геометрия.

**Рис. 15. Близко и далекое плоскости основаны на пересечении четырех вычисляемых плоскостей светлой фрустум и ограничивающей геометрии сцены.**

![близко и далекое плоскости основаны на пересечении четырех вычисляемых плоскостей светлой фрустум и ограничивающей геометрии сцены.](images/near-far-plane-based-on-intersection-of-four.jpg)

### <a name="moving-the-light-in-texel-sized-increments"></a>Перемещение освещения с шагом Texel-Sized

Распространенным артефактом в теневом сопоставлении является эффект Шиммеринг ребра. При перемещении камеры пикселы на краях темнее и темнее. Это не видно в изображениях, но оно очень заметно и неудобно в режиме реального времени. На рис. 16 выделяется эта проблема, а на рис. 17 показано, как должны выглядеть тени.

Ошибка Шиммеринг ребра возникает из-за того, что матрица низкой проекции пересчитывается каждый раз при перемещении камеры. Это создает небольшие различия в созданных теневых картах. На матрицу, созданную для привязки сцены, могут влиять все следующие факторы.

-   Размер представления фрустум
-   Ориентация представления фрустум
-   Расположение источника освещения
-   Расположение камеры

При каждом изменении матрицы границы тени могут измениться.

**Рис. 16. Шиммеринг тени**

![Шиммеринг тени](images/shimmering-shadow-edges.jpg)

Пиксели, расположенные вдоль границы тени, появляются и выходят из тени, так как камера перемещается слева направо.

**Рис. 17. Тени, не Шиммеринг края**

![тени, не Шиммеринг края](images/shadows-without-shimmering-edges.jpg)

Границы тени остаются постоянными, так как камера перемещается слева направо.

Для направленного освещения решение этой проблемы заключается в округлении минимального и максимального значений в X и Y (которые составляют границы ортогональной проекции) к увеличению размера пикселя. Это можно сделать с помощью операции деления, операции этажа и умножения.


```C++
        vLightCameraOrthographicMin /= vWorldUnitsPerTexel;
        vLightCameraOrthographicMin = XMVectorFloor( vLightCameraOrthographicMin );
        vLightCameraOrthographicMin *= vWorldUnitsPerTexel;
        vLightCameraOrthographicMax /= vWorldUnitsPerTexel;
        vLightCameraOrthographicMax = XMVectorFloor( vLightCameraOrthographicMax );
        vLightCameraOrthographicMax *= vWorldUnitsPerTexel;
```



Значение Вворлдунитспертексел вычисляется путем взятия границы представления фрустум и деления на размер буфера.


```C++
        FLOAT fWorldUnitsPerTexel = fCascadeBound /
        (float)m_CopyOfCascadeConfig.m_iBufferSize;
        vWorldUnitsPerTexel = XMVectorSet( fWorldUnitsPerTexel, fWorldUnitsPerTexel,                            0.0f, 0.0f );
```



Ограничение максимального размера представления фрустум приводит к отслабому размеру ортогональной проекции.

Важно отметить, что при использовании этого метода текстура размером в 1 пиксель больше по ширине и высоте. Это позволяет сохранять координаты теневой копии за пределами теневой схемы.

### <a name="back-face-and-front-face"></a>Задняя поверхность и передняя сторона

Теневые карты должны быть подготовлены к просмотру со стандартным отбором фоновых лиц, процессом, который пропускает растрирование объектов, которые средство просмотра не может видеть, и ускоряет рендеринг сцены. Другой распространенный вариант — отображение теневых карт с включенным отбором внешних лицевых сторон, что означает, что объекты, расположенные в средстве просмотра, исключаются. Аргумент для этого заключается в том, что он помогает при самотеневой работе, так как геометрией объектов, составляющих обратную передачу, немного смещены. У этой идеи есть две проблемы.

-   Любой объект с неправильной геометрией или фигурой заднего плана вызывает артефакты на теневой карте. Тем не менее, наличие неправильной геометрии или геометрического объекта приведет к возникновению других проблем, поэтому может быть уверенным, что поверхность внешнего лица и фоновая геометрия выполняются правильно. Создание задних граней на основе спрайта, например фолиаже, может оказаться нецелесообразным.
-   Питер прокрутка и тени на основе таких объектов, как стенки, скорее всего, будут возникать из-за того, что невелика степень четности глубины тени.

### <a name="shadow-mapfriendly-geometry"></a>Теневая схема — удобная геометрия

Создание геометрии, хорошо работающей в теневых картах, обеспечивает большую гибкость при борьбе с артефактами, такими как Питер панорамирование и Shadow акне.

При самоскрытии на жестких краях возникают проблемы. Несоответствие глубины по отношению к кончику ребра очень мало. Даже небольшое смещение может привести к потере теней объектов (рис. 18).

**Рис. 18. Резкие края приводят к корню артефактов от низкого уровня без четности с использованием смещений.**

![резкие края приводят к корню артефактов от низкого уровня без четности с использованием смещений.](images/sharp-edges-cause%20artifacts.jpg)

Узкие объекты, такие как стены, должны иметь обратную передачу, даже если они никогда не видны. Это увеличит несоответствие глубины.

Также важно убедиться в правильности направления геометрии. то есть за пределами объекта должен быть обратен, а внутри объекта — внешним. Это важно для подготовки к просмотру с включенным отбором обратных лиц, а также для борьбы с эффектами смещения глубины.

## <a name="summary"></a>Сводка

Методы, описанные в этой статье, можно использовать для повышения качества стандартных теневых карт. Следующим шагом является рассмотрение методов, которые могут хорошо работать со стандартными теневыми картами. Ксмс рекомендуется использовать в качестве старших методик для борьбы с псевдонимами перспективы. В процентах более тесная фильтрация или теневые карты отклонений можно использовать для смягчения границ тени. дополнительные сведения см. в технической статье с [каскадным затенением Карты](/windows/desktop/DxTechArts/cascaded-shadow-maps) .

доннелли, W. и лауритзен, [Shadow-Карты](https://portal.acm.org/citation.cfm?doid=1111411.1111440). Symposium на интерактивной трехмерной графике, материалы 2006 Symposium в интерактивной трехмерной графике и играх. 2006, PP. 161 – 165.

Енжел, Вофлганг F. раздел 4. каскадная теневая Карты. ShaderX5, *Дополнительные методы отрисовки*, Волфганг F. Енжел, ED. Чарльз River Media, Бостон, Массачусетс. 2006. PP. 197 – 206.

Стамминжер, (Marc и Дреттакис, Георгия. [теневая Карты перспективы](https://portal.acm.org/citation.cfm?id=566616). Международная конференция по компьютерной графике и интерактивным технологиям, *материалы на 29 ежегодных конференциях по компьютерной графике и интерактивным технологиям*. 2002, PP 557 — 562.

виммер, M., счерзер, D. и пургасофер, W. [область с точки зрения теневого Карты](https://www.cg.tuwien.ac.at/research/vr/lispsm/shadows_egsr2004_revised.pdf). Еурографикс Symposium при подготовке к просмотру. 2004. Пересмотрено 10 июня 2005 г. [Течнисче Университäт Виен](https://www.cg.tuwien.ac.at/research/vr/lispsm/).

 

 
