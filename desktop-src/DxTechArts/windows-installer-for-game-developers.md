---
title: Windows Установщик для разработчиков игр
description: в этой статье приводятся общие сведения о установщик Windows, специально предназначенных для разработчиков игр. подробную документацию по функциям и интерфейсам api, упомянутым в этой статье, можно найти в разделе пакет SDK для Windows Platform.
ms.assetid: 07401792-b34b-71c9-18f8-a11c916c7d81
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bc587725ce2a2a675c9db835fabb503bc44ffa62c07ee1ce80578aef9432cf9a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119290394"
---
# <a name="windows-installer-for-game-developers"></a>Windows Установщик для разработчиков игр

показывает, как установщик Windows можно использовать для установки игр на компьютерах конечных пользователей. Windows Установщик предлагает полную поддержку настраиваемого пользовательского интерфейса, а также установку исправлений.

Microsoft установщик Windows — это предпочтительный API для установки программного обеспечения на компьютерах на базе Windows. хотя многие функции установщик Windows предназначены для поддержки развертывания бизнес-приложений в корпоративной среде, установщик Windows также вполне подходит для установки игр на компьютерах конечных пользователей. основные преимущества использования установщик Windows для установки игр:

-   Надежная Отмена установки
-   Возможность установки содержимого по запросу
-   Поддержка полностью настраиваемого пользовательского интерфейса
-   Эффективная установка исправлений

в этой статье приводятся общие сведения о установщик Windows, специально предназначенных для разработчиков игр. подробную документацию по функциям и интерфейсам api, упомянутым в этой статье, можно найти в разделе пакет SDK для Windows Platform.

-   [Обзор](#overview)
-   [основные понятия установщик Windows](#key-windows-installer-concepts)
    -   [Components](#components)
    -   [Функции](#features)
-   [Состояния установки](#install-states)
-   [Установка по запросу](#install-on-demand)
-   [Настраиваемый пользовательский](#custom-user-interface)
-   [установка исправлений;](#patching)
-   [Другие ресурсы](#other-resources)

## <a name="overview"></a>Обзор

все настройки на основе установщик Windows используют файл базы данных установки, называемый MSI-файлом, для описания способа установки приложения. Файл MSI содержит сведения о том, какие файлы, разделы реестра, ярлыки, сопоставления файлов и другие элементы приложений должны быть установлены. Фактически устанавливаемые файлы могут быть сжаты в самом MSI-файле, упакованы и сжаты в отдельные "CAB-файлы" или храниться в другом месте на установочном носителе как отдельные несжатые файлы. Файл MSI также может ссылаться на внешние реализованные действия, чтобы разрешить действия, для которых файл MSI не разрешается изначально.

При необходимости MSI-файл может содержать пользовательский интерфейс, позволяющий пользователю выполнить процесс установки. Этот пользовательский интерфейс подходит для большинства приложений. однако он имеет вид обычного Windows приложения, и многие разработчики игр предпочитают, чтобы приложение настройки поддерживало внешний вид самой игры, чтобы обеспечить более единообразное взаимодействие с конечным пользователем. для поддержки этого полностью настраиваемого пользовательского интерфейса приложение установки может отключить встроенный пользовательский интерфейс установщик Windows и работать с ним целиком. установщик Windows API предоставляет механизм обратного вызова, позволяющий пользовательскому интерфейсу установки получать уведомления о ходе установки, а также важные события, такие как запросы на изменение диска.

Windows Установщик не является комплексным решением для создания настроек. Это только API, который может использоваться программой установки для выполнения фактической установки файлов, разделов реестра, ярлыков рабочего стола и других элементов приложения. последние версии всех основных средств коммерческой настройки (например, InstallShield, разумно и Microsoft Visual Studio) поддерживают установщик Windows. эти средства предоставляют удобные пользовательские интерфейсы для создания программы установки для игры, но они полагаются на установщик Windows API, чтобы выполнить большую часть фактической установки. Эти средства также можно использовать только для создания базы данных MSI, содержащей пакет установки, который затем можно установить из пользовательского интерфейса установки. в качестве альтернативы сторонним средствам установщик Windows API предоставляет все функции, необходимые для программного создания базы данных MSI и управления ей, а пакет SDK для Windows Platform включает в себя средство редактирования базы данных msi, которое называется Orca.

## <a name="key-windows-installer-concepts"></a>основные понятия установщик Windows

ниже приведены установщик Windows компоненты и компоненты.

### <a name="components"></a>Компоненты

Приложение состоит из одного или нескольких компонентов, идентифицируемых по ИДЕНТИФИКАТОРу компонента GUID. Компонент — это атомарная единица; она либо полностью установлена, либо не установлена вообще. Компонент может состоять из одного файла, нескольких файлов, разделов реестра, ярлыков рабочего стола или их сочетания. Ресурсы (файлы и т. д.) внутри компонента должны быть уникальными для этого компонента. два компонента не могут содержать один и тот же ресурс. Компонент не устанавливается явным образом. Он устанавливается только как часть компонента (см. ниже).

### <a name="features"></a>Функции

Компонент — это группа компонентов, определяемая ИДЕНТИФИКАТОРом функции GUID. В отличие от компонентов, несколько компонентов могут содержать один и тот же компонент. Компонент, совместно используемый несколькими компонентами, будет установлен, если какие-либо из этих компонентов установлены и удалены только после удаления всех компонентов, ссылающихся на этот компонент. Установка компонента может быть выполнена автоматически в рамках установки продукта или вручную с помощью API [**мсиконфигурефеатуре**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) .

хотя некоторые игры имеют несколько "компонентов", которые могут устанавливаться независимо, установщик Windows концепция компонента все еще полезна. поскольку установщик Windows функция — это лишь набор компонентов, которые можно установить вместе, игры могут использовать функции для объединения всего содержимого, необходимого для конкретного этапа игры. Например, игра, ориентированная на уровень, может определять одну функцию на уровень, состоящую из всего содержимого, необходимого для этого уровня. Это позволит игре устанавливать содержимое на один уровень за раз в самой игре, а не устанавливать все содержимое всех уровней во время первоначальной установки.

## <a name="install-states"></a>Состояния установки

С каждым компонентом или компонентом связано состояние установки, которое определяет, доступен ли компонент или компонент, и если да, то где установлены файлы для компонента или функции. Возможные состояния установки для компонента:

<dl> <dt>

<span id="Absent"></span><span id="absent"></span><span id="ABSENT"></span>Отсутствии
</dt> <dd>

Эта функция не установлена, поэтому она недоступна.

</dd> <dt>

<span id="Local"></span><span id="local"></span><span id="LOCAL"></span>Языковые
</dt> <dd>

Эта функция доступна и устанавливается для запуска с локального жесткого диска.

</dd> <dt>

<span id="Source"></span><span id="source"></span><span id="SOURCE"></span>Источника
</dt> <dd>

Эта функция доступна и устанавливается для запуска с оригинального исходного носителя (обычно это компакт-диск или диск DVD).

</dd> <dt>

<span id="Advertised"></span><span id="advertised"></span><span id="ADVERTISED"></span>Объявленных
</dt> <dd>

Компонент не установлен, но его можно установить по запросу с помощью API [**мсиконфигурефеатуре**](/windows/desktop/api/msi/nf-msi-msiconfigurefeaturea) . Когда компонент фактически установлен, он может быть установлен либо в локальное, либо в исходном состоянии.

</dd> </dl>

Компонент может иметь любое из указанных выше состояний, за исключением "объявлено". Если компонент является частью объявленной функции, компонент будет отображаться как "отсутствует", пока не будет установлен компонент.

## <a name="install-on-demand"></a>Установка по запросу

Windows Установщик позволяет приложению помечать функции как объявленные, то есть эта функция еще не установлена, но доступна для установки во время выполнения, если это необходимо. Установка компонентов в среде выполнения называется "Установка по запросу". Игры могут использовать установку по запросу, чтобы радикально сократить время, необходимое для первоначальной настройки игры, отложив установку содержимого игры, пока оно не понадобится во время выполнения. Задержка, необходимая для установки содержимого во время выполнения, часто может быть частично или полностью скрыта путем выполнения установки по требованию в фоновом потоке, в то время как пользователь в противном случае занят игрой.

## <a name="custom-user-interface"></a>Настраиваемый пользовательский

хотя установщик Windows предоставляет пользовательский интерфейс по умолчанию, который помогает пользователю устанавливать приложение, этот интерфейс выглядит так же, как и для стандартного Windows приложения. Многие разработчики игр предпочитают, что их пользовательский интерфейс установки выглядит так же, как и сама игра, чтобы предоставить пользователю впечатление от амбианце игры. для этого установщик Windows позволяет полностью отключить встроенный пользовательский интерфейс, позволяя разработчику предоставлять полностью настраиваемый пользовательский интерфейс.

программа выборочной установки сначала отключает встроенный пользовательский интерфейс установщик Windows с помощью API [**мсисетинтерналуи**](/windows/desktop/api/msi/nf-msi-msisetinternalui) , чтобы установить уровень пользовательского интерфейса инсталлуилевел \_ NONE. Затем он вызывает API [**мсисетекстерналуи**](/windows/desktop/api/msi/nf-msi-msisetexternaluia) , чтобы указать функцию обратного вызова, которая будет вызываться в процессе установки для уведомления программы установки о ключевых событиях во время установки.

Фактически процесс установки запускается путем вызова API [**мсиинсталлпродукт**](/windows/desktop/api/msi/nf-msi-msiinstallproducta) . Этот API принимает строку параметра, которая позволяет вызывающей стороне указать значения для именованных свойств. Эти свойства можно использовать в самой базе данных установки для настройки способа установки приложения. Эти свойства можно использовать для указания следующих параметров:

-   Каталог, в который должно быть установлено приложение
-   Какие компоненты должны быть установлены локально и должны быть установлены для запуска с компакт-диска или DVD-диска (например, чтобы обеспечить выбор между минимальной установкой и полной установкой);
-   Должно ли приложение устанавливаться для всех пользователей компьютера или только для текущего пользователя

Во время установки программа установки использует сообщения уведомления, отправленные в функцию обратного вызова, чтобы определить, когда следует обновить пользовательский интерфейс индикатора хода выполнения, когда пользователю будет предложено вставить следующий компакт-диск или когда уведомить пользователя об ошибке в процессе установки.

## <a name="patching"></a>установка исправлений;

Windows Установщик позволяет устанавливать исправления установленных приложений, применяя файл исправления. Файл исправления содержит новые файлы, которые будут добавлены с помощью исправления, файлы, которые были изменены с помощью исправления, и список изменений, которые необходимо внести в базу данных установки. Для экономии места вместо хранения полного содержимого файла, измененного с помощью исправления, файл исправления фактически содержит только различия между исходной версией файла и новой версией файла.

Чтобы создать исправление, необходимо установить образ установки для каждой версии приложения, с которой нужно обновить обновление, а также образ установки для новой обновленной версии приложения. Образ установки состоит из базы данных MSI и всех фактических файлов данных для приложения. Лучшим способом создания образа установки для новой версии приложения является копирование образа установки из предыдущей версии приложения, а затем внесение любых изменений, необходимых для обновления этой копии в исправленной версии.

После получения всех необходимых образов установки можно создать исправления с помощью Msimsp.exe, который представляет собой средство создания исправлений, доступное в составе пакета Platform SDK. Средство запросит расположение каждого из образов установки, а затем определит, как эффективно представить различия между последовательными версиями. Выходные данные средства — это окончательный файл исправления (определяется расширением MSP). Чтобы установить исправление программным способом, вызовите API [**мсиапплипатч**](/windows/desktop/api/msi/nf-msi-msiapplypatcha) . Пользователь также может установить обновление вручную, дважды щелкнув MSP-файл в проводнике.

## <a name="other-resources"></a>Другие ресурсы

-   подробные сведения об API установщик Windows см. в разделе [установщик Windows](/windows/desktop/Msi/windows-installer-portal).
-   Сведения о рекомендациях по установке игр см. в статье [Установка и обслуживание игр](/windows/desktop/DxTechArts/installation-and-maintenance-of-games).

 

 