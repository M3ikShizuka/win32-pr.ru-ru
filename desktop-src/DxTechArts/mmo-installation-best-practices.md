---
title: Рекомендации по установке для массовых многопользовательских интернет-игр
description: в этой статье описывается создание цепочки отношений доверия для установки клиента в интернет-играх с широкими усилиями (ммог) и пользовательских систем обновления игр, которые хорошо работают с Windows и моделью безопасности Windows Vista и Windows 7.
ms.assetid: b719cff7-97e8-5e0a-9c91-3bd8178da7c8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6b574bdf2ae98b28fabed97340d6aa38b1a864c24519bb6532d0aa4069882efe
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117815443"
---
# <a name="installation-best-practices-for-massively-multiplayer-online-games"></a>Рекомендации по установке для массовых многопользовательских интернет-игр

в этой статье описывается создание цепочки отношений доверия для установки клиента в интернет-играх с широкими усилиями (ммог) и пользовательских систем обновления игр, которые хорошо работают с Windows и моделью безопасности Windows Vista и Windows 7. Этот подход предназначен для включения исправлений в названиях ММОГ при поддержке стандартных учетных записей пользователей, имеющих ограниченный доступ к жесткому диску и системному реестру.

-   [Почему у клиентов ММОГ разные требования к традиционным розничным приобретенным играм](#why-mmog-clients-have-different-requirements-to-traditional-retail-purchased-games)
-   [Общие сведения о цепочке подхода к доверию](#overview-of-a-chain-of-trust-approach)
-   [Все проверяется на сервере, почему следует беспокоиться о взломе клиента?](#everything-is-validated-on-the-server-why-should-i-worry-if-my-client-gets-hacked)
-   [Создание приложения Trust-Worthy Loader](#construction-of-the-trust-worthy-loader-application)
    -   [Фоновое чтение](#background-reading)
    -   [Установка доверенного загрузчика и диспетчера](#installation-of-the-trusted-loader-and-patcher)
    -   [Установка игровых исполняемых файлов, библиотек DLL и данных](#installation-of-the-game-executables-dlls-and-data)
    -   [Код изменения списка управления доступом](#access-control-list-modification-code)
    -   [Установки для опытных пользователей](#installations-for-advanced-users)
    -   [Проверка доверия загрузчика](#the-loaders-verification-of-trust)
    -   [Проверка данных](#data-validation)

## <a name="why-mmog-clients-have-different-requirements-to-traditional-retail-purchased-games"></a>Почему у клиентов ММОГ разные требования к традиционным розничным приобретенным играм

Постоянно подключенная и развивающаяся природа MMOG делает это фундаментальным требованием для регулярного обновления кода и содержимого клиента, чтобы устранить уязвимости системы безопасности и расширить возможности игрового процесса. С возможностью почти ежедневного обновления сценарий ММОГ требует тщательного управления, чтобы обеспечить удобство работы пользователя. Это отличается от традиционной модели розничной покупки, где небольшое количество исправлений можно указать ближе к розничной дате поставки продукта. установщик Windows ограниченная технология исправления пользователей, обеспечиваемая операционной системой, предназначена для работы с небольшим количеством исправлений приложений, а не большим числом и высокой частотой, необходимой для mmog. Поэтому часто требуется разработать пользовательские системы исправлений для удовлетворения потребностей MMOG, включая специальные требования, характерные для конкретных ММОГ, которые разрабатываются.

так как многие компьютеры подключены к интернету, Windows Vista и Windows 7 имеют более жесткие ограничения безопасности и защиты для пользователей, что ограничивает доступ приложений к различным областям жесткого диска. в отличие от Windows XP, эти ограничения включены в режиме по умолчанию для учетных записей пользователей. Эти ограничения следует учитывать при проектировании макета игры, исполняемого файла и данных, а также связанной с ней системы исправлений. Дополнительные сведения о мерах безопасности, предоставляемых операционной системой, см. в разделе [Управление учетными записями пользователей для разработчиков игр](/windows/desktop/DxTechArts/user-account-control-for-game-developers).

## <a name="overview-of-a-chain-of-trust-approach"></a>Общие сведения о цепочке подхода к доверию

Подход к пользовательскому обновлению, представленный в этом техническом документе, основан на использовании надежного приложения загрузчика в папке защищенных файлов, сохраняя при этом исполняемые файлы и данные игр в общей области, доступной для всех пользователей. Цепочка доверия начинается с загрузчика, который выполняет проверки достоверности двоичных файлов и данных игр перед запуском.

![Цепочка доверия начинается с надежного загрузчика](images/mmo-installation-best-practices-01.gif)

Надежному загрузчику необходимо иметь достаточное количество логики, чтобы убедиться, что исполняемый файл и другие двоичные файлы игры не были изменены перед запуском игры. Загрузчик также может проверять данные игры по мере необходимости, однако размер данных игры обычно слишком велик, чтобы их можно было проверять каждый раз за один проход. Альтернативный подход заключается в использовании шаблона выборки, который гарантирует, что проверка всего набора данных выполняется в течение продолжительного периода времени. Приложение Loader может содержать подсистему установки игр, которая предоставляет метод достойной доверия для интеграции обновлений с установленной игрой.

## <a name="everything-is-validated-on-the-server-why-should-i-worry-if-my-client-gets-hacked"></a>Все проверяется на сервере, почему следует беспокоиться о взломе клиента?

Невозможно доверять, что клиент не был скомпрометирован; Таким образом, серверы ММОГ обычно проверяют все данные, полученные от клиента. Хотя эта обработка может определять скомпрометированные или обмана Игровые клиенты в среде игры, сервер не может легко найти все проблемы, с которыми может предоставляться игровой клиент. Важно усилить защиту от хакеров, желающих использовать клиент в качестве платформы для атак на вашу службу, других пользователей или даже в качестве вектора для самостоятельной атаки на клиентские компьютеры. Применение методов подписывания кода и проверки данных помогает обнаружить скомпрометированные клиенты перед их выполнением. Поскольку механизму исправления требуется предоставлять двоичные файлы исполняемых файлов и библиотек DLL, которые не защищены стандартными разрешениями только для чтения в программах, проверка этих файлов перед их запуском важна для обеспечения общей безопасности системы.

Эта модель не пытается справиться с сценарием пользователя вредоносного администратора, в котором сам загрузчик может стать скомпрометированным, но он посвящен защите обычных пользователей от случайного выполнения незаконного кода. Традиционные методики проверки сервера и клиента являются единственным возможным устранением вредоносных системных администраторов.

## <a name="construction-of-the-trust-worthy-loader-application"></a>Создание приложения Trust-Worthy Loader

### <a name="background-reading"></a>Фоновое чтение

Читатели должны ознакомиться со следующей документацией, в которой приводятся подробные сведения о технологии, обеспечивающей наилучшее отношение доверия на основе программного обеспечения.

<dl> <dt>

<span id="Code_Signing"></span><span id="code_signing"></span><span id="CODE_SIGNING"></span>Подписывание кода
</dt> <dd>

[Подписывание Authenticode для разработчиков игр](/windows/desktop/DxTechArts/authenticode-signing-for-game-developers)

</dd> <dt>

<span id="SignTool"></span><span id="signtool"></span><span id="SIGNTOOL"></span>Средство
</dt> <dd>

Средство [SignTool](/windows/desktop/SecCrypto/signtool) на MSDN

</dd> </dl>

В следующем разделе описаны интерфейсы API, которые следует использовать для создания приложения загрузчика, поддерживающего структуру диска для установки и проверки доверия.

### <a name="installation-of-the-trusted-loader-and-patcher"></a>Установка доверенного загрузчика и диспетчера

Доверенный загрузчик и базовая версия служебной программы исправления должны быть установлены в папке защищенных файлов на жестком диске так же, как в традиционных установках. для установки и исправления приложения загрузчика требуются права администратора, поэтому важно обеспечить минимальную частоту обновления для загрузчика, чтобы гарантировать, что конечным пользователям не нужно часто повышать уровень прав, хотя установщик Windows ограниченный набор исправлений пользователей можно использовать, чтобы избежать повышения прав для исправлений загрузчика.

см. статью установка игровых программ в Windows XP, Windows Vista и Windows 7.

### <a name="installation-of-the-game-executables-dlls-and-data"></a>Установка игровых исполняемых файлов, библиотек DLL и данных

Чтобы упростить обновление стандартных пользователей игры без прав администратора, необходимо установить исполняемые файлы, библиотеки DLL и данные в область жесткого диска, доступную для записи всем пользователям. Операционная система предоставляет область "все данные приложений пользователей", которую можно использовать в качестве расположения по умолчанию для установки. [**Шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) следует использовать вместе с \_ общим \_ ключом AppData, чтобы определить путь к файлу для этой области. Важно, чтобы в пути, к которому этот ключ возвращается, не предполагалось никаких допущений, так как он может быть настраиваемым пользователем.

Установка должна изменить разрешения папки или управлять ею, чтобы обеспечить доступ для всех пользователей и общих операций записи, необходимых для обновления заголовка. С учетом правильных разрешений функция средства обновления игр может легко исправить игру, не требуя наличия специальной привилегии для всех пользователей, включая время запуска обычных пользователей.

### <a name="access-control-list-modification-code"></a>Код изменения списка управления доступом

для Windows XP необходимо выполнить код для изменения списка управления доступом (ACL) вручную. ниже приведен пример функции, которая показывает, как это сделать.

``` syntax
HRESULT ChangeACLtoAllowUserRW( WCHAR* strDir )
{
    EXPLICIT_ACCESS explicitaccess;
    PACL NewAcl = NULL;
    DWORD dwError;

    BuildExplicitAccessWithName( &explicitaccess, L"BUILTIN\\Users",
                                 GENERIC_ALL, GRANT_ACCESS,
                                 SUB_CONTAINERS_AND_OBJECTS_INHERIT );
                                 
    dwError = SetEntriesInAcl( 1, &explicitaccess, NULL, &NewAcl );
    if( dwError == ERROR_SUCCESS) 
    {
        dwError = SetNamedSecurityInfo( strDir, SE_FILE_OBJECT,
                                        DACL_SECURITY_INFORMATION,
                                        NULL, NULL, NewAcl, NULL );
        if( dwError == ERROR_SUCCESS)
        {
            if( NewAcl != NULL ) AccFree( NewAcl );
            return S_OK;
        }
    }

    if( NewAcl != NULL ) AccFree( NewAcl );
    return E_FAIL;
}
```

этот пример кода также будет работать для Windows Vista и Windows 7. Однако они также предоставляют программу командной строки Icacls для редактирования ACL файлов, которые можно использовать вместо этого.

При выполнении этого средства отображается подробная справка, но одним из примеров использования этого средства является:

``` syntax
icacls "C:\Users\All Users\Game" /grant Rex:(D,WDAC)
```

Это позволит пользователю Rex удалить и записать разрешения DAC в игровую папку, хранящуюся в области все пользователи жесткого диска.

### <a name="installations-for-advanced-users"></a>Установки для опытных пользователей

В случае расширенных сценариев установки пользователю может потребоваться указать путь установки игр вручную. Выбор каталога должен быть ограничен одним за пределами программных файлов, чтобы эта папка находилась в полностью разделяемой области жесткого диска. Выбранный пользователем путь следует использовать только для исполняемых файлов и exe, так как загрузчик игры и исполняемый файл исправления всегда должны быть установлены в папку "защищенные файлы программ" для повышения безопасности.

### <a name="the-loaders-verification-of-trust"></a>Проверка доверия загрузчика

Windows предоставляет функцию [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) для проверки допустимости подписанного кода и основана на службах шифрования в операционной системе. Функция полностью документирована в функции MSDN: **WinVerifyTrust** .

В следующем примере программы на сайте MSDN подробно описывается использование функции для определения того, подписан ли исполняемый файл программы действительным сертификатом: [Пример программы C: Проверка подписи PE-файла](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file).

В целях проверки того, что подписанный исполняемый файл игры надежен для выполнения в загрузчике, будет достаточно универсальное действие проверки:

<dl> <dt>

<span id="Value"></span><span id="value"></span><span id="VALUE"></span>Значений
</dt> <dd>

ВИНТРУСТ \_ действие \_ Generic \_ Проверка \_ версии 2

</dd> <dt>

<span id="Meaning"></span><span id="meaning"></span><span id="MEANING"></span>А
</dt> <dd>

Проверьте файл или объект с помощью поставщика политики Authenticode.

</dd> </dl>

Функция принимает аргумент структуры ввода, который содержит сведения, необходимые поставщику доверия для обработки указанного действия. Как правило, как и в предыдущем примере, структура включает сведения, определяющие объект, который должен оценивать поставщик доверия.

Формат структуры зависит от идентификатора действия. Следующий раздел на сайте MSDN подробно демонстрирует структуру структуры [**\_ данных**](/windows/desktop/api/wintrust/ns-wintrust-wintrust_data) поставщика винтруст: винтруст.

Если поставщик доверия проверяет, что субъект является доверенным для указанного действия, возвращаемое значение равно нулю. Никакое другое значение, кроме нуля, не следует рассматривать как успешный возврат.

### <a name="data-validation"></a>Проверка данных

механизм сопроектирования поддерживает только подписывание нескольких конкретных типов файлов, включая исполняемые файлы, библиотеки dll, пакеты установщик Windows (.msi файлы) и cab-файлы (.cab). API [**WinVerifyTrust**](/windows/desktop/api/wintrust/nf-wintrust-winverifytrust) не следует использовать для проверки того, что большие файлы данных (например, файлы .cab) не были изменены, так как при проверке очень больших файлов возникают проблемы с производительностью и стабильностью. Исполняемые файлы программы, как правило, достаточно малы для проверки полного доверия с помощью поставщика Винтруст, но файлы данных для игр часто представляют собой область многих гигабайтов в размере. Метод, выполняемый загрузчиком для проверки данных игры, должен быть одним из них, где небольшой образец набора данных тестируется во время выполнения игры. При таком подходе затраты на проверку проверяются в течение жизненного цикла игры и могут обеспечивать удобство работы пользователей без длительного времени ожидания. Чтобы добиться этого, может потребоваться тщательная организация данных. Некоторые MMOG используют подход к базе данных, чтобы помочь в управлении, обслуживании и проверке правильности игровых ресурсов в течение времени.

С точки зрения безопасности клиентский код должен быть разработан таким образом, чтобы не доверять файлам данных, даже если используется какая-либо базовая проверка данных с надежным загрузчиком. Следует применять проверки заголовков, хэши и другую традиционную проверку целостности. работа с усилением защиты кода ввода-вывода клиента должна также выполняться с помощью таких методов, как тестирование методом нечеткого тестирования, а также использования средств автоматического анализа статического кода, таких как параметр **/analyze** в Visual Studio 2005 и Visual Studio 2008 (доступно в Visual Studio Team System и бесплатном компиляторе, который поставляется с Windows SDK).

Дополнительные сведения о безопасности программного обеспечения см. [в разделе Лучшие методики обеспечения безопасности при разработке игр](/windows/desktop/DxTechArts/best-security-practices-in-game-development).

 

 