---
title: Советы и рекомендации по разработке игр
description: В этой статье рассматриваются рекомендации по использованию в разработке игр.
ms.assetid: 20956529-42ed-722b-cfa3-e3230d89fdd7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ba4f02d5e1a2e3da2e50feedd89f085a0c063be
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103890821"
---
# <a name="best-security-practices-in-game-development"></a>Советы и рекомендации по разработке игр

В этой статье рассматриваются рекомендации по использованию в разработке игр.

-   [Введение](#introduction)
-   [Примеры небезопасного кода](#examples-of-insecure-code)
-   [Способы повышения безопасности](#ways-to-improve-security)
-   [Сводка](#summary)

## <a name="introduction"></a>Введение

Увеличение числа людей, играющих онлайн-игры и игры с пользовательским содержимым. Это, в сочетании с повышением безопасности операционной системы Microsoft Windows, означает, что игры являются растущим и более заманчивым целевым объектом, который злоумышленники могут использовать. Разработчики игр должны прилагать особое внимание на то, чтобы игры, которые они выпускают, не создают новые бреши в системе безопасности для атак злоумышленников. Разработчики игр несут ответственность за защиту компьютеров клиентов от вредоносных данных в сети, изменений пользователей или несанкционированного доступа. Если уязвимостью воспользоваться злоумышленником, это может привести к потере клиентов и/или денег. В этой статье описаны некоторые распространенные методы и средства для повышения безопасности кода без чрезмерного роста времени разработки.

Три наиболее распространенные ошибки, вносимые командой разработчиков при выпуске продукта:

-   Требуются права администратора. Для игр не требуются права администратора. Дополнительные сведения см. в разделе [Управление учетными записями пользователей для разработчиков игр](./user-account-control-for-game-developers.md).
-   Не использовать автоматическую защиту. Обычно разработчики не используют **/GS**, **/SAFESEH** или **/НКС**. Использование этих флагов компиляции и компоновки позволяет обнаруживать или устранять многие основные бреши в системе безопасности без значительного увеличения рабочей нагрузки. Эти флаги обсуждаются далее в этой статье.
-   Использование запрещенных интерфейсов API. Существует множество API-интерфейсов (**strcpy**, **strncpy** и т. д.), которые подвержены ошибкам программиста и легко создают бреши в системе безопасности. Разработчики должны заменить эти API своими версиями. Visual Studio 2005 поставляется с инструментом для анализа двоичных файлов, которые могут автоматически проверять объектные файлы на наличие ссылок на ненадежные интерфейсы API. Дополнительные сведения о том, что делать с данными, созданными с помощью этого средства, см. в статье [стоек атаки в коде с помощью надежных библиотек C и C++ для Visual Studio 2005](/archive/msdn-magazine/2005/may/repel-attacks-with-visual-studio-2005-safe-c-and-c-libraries) с помощью Martyn Ловелл. Кроме того, можно получить файл заголовка запрещено [. h](https://www.microsoft.com/downloads/details.aspx?FamilyID=6aed14bd-4766-4d9d-9ee2-fa86aad1e3c9) , который может помочь в удалении заблокированных функций из кода.

Каждая из перечисленных ошибок является не только распространенной, но легко исправимой без существенных изменений в рабочей нагрузке разработки, стандартам кодирования или функциональности.

## <a name="examples-of-insecure-code"></a>Примеры небезопасного кода

Ниже приведен простой пример, позволяющий злоумышленнику выполнить атаку переполнения буфера:


```
void GetPlayerName(char *pDatafromNet)
{
    char playername[256]; 
    strncpy(playername, pDatafromNet, strlen(pDatafromNet));

    // ...
}
```



На поверхности код выглядит нормально — он вызывает Сейф функции, как и в конце концов. Данные из сети копируются в буфер, который составляет 256 байт. Функция **strncpy** основывается на поиске терминатора NULL в исходной строке или ограничивается указанным количеством буферов. Проблема заключается в том, что размер буфера неправильный. Если данные из сети не прошли проверку или размер буфера неправильный (как в этом примере), злоумышленник может просто предоставить большой буфер для перезаписи данных стека, после того как буфер завершится с любыми данными в сетевом пакете. Это позволит злоумышленнику выполнить произвольный код, перезаписав указатель инструкций и изменив обратный адрес. Основное занятие этого примера — никогда не доверять входным данным, пока не будет выполнена проверка.

Даже если данные не поступают из сети изначально, это потенциально может быть риском. Разработка современных игр требует много людей, разрабатывая, разрабатывая и тестируя одну и ту же базу кода. Нет способа выяснить, как функция будет вызываться в будущем. Всегда спрашивать, откуда поступили данные и что может контролировать злоумышленник? Хотя сетевые атаки являются наиболее распространенными, они не являются единственными методами создания брешей в системе безопасности. Может ли злоумышленник создать Mod или изменить сохраненный файл способом, открывающим брешь в системе безопасности? Как насчет предоставляемых пользователем образов и звуковых файлов? Вредоносные версии этих файлов можно публиковать в Интернете и создавать опасные риски безопасности для клиентов.

В качестве побочной заметки используйте стрсафе. h или Сейф CRT вместо **strncpy** , чтобы исправить пример. Безопасный CRT — это полное обновление системы безопасности среды выполнения C, которое входит в состав Visual Studio 2005. Дополнительные сведения о безопасной CRT можно найти в статье [улучшения безопасности в CRT](https://msdn.microsoft.com/library/8ef0s5kh(VS.80).aspx) с помощью Майкла Ховарда.

## <a name="ways-to-improve-security"></a>Способы повышения безопасности

Существует несколько способов повышения безопасности в цикле разработки. Ниже приведены некоторые из лучших способов.

<dl> <dt>

<span id="Reading_about_security"></span><span id="reading_about_security"></span><span id="READING_ABOUT_SECURITY"></span>Чтение сведений о безопасности
</dt> <dd>

Книга, *написание безопасного кода, второй выпуск* Майкла Ховарда и Дэвид Леблана, предоставляет подробное и четкое объяснение стратегий и методов предотвращения атак и устранения уязвимостей. Начиная с методов проектирования безопасности в выпуске с учетом методов защиты сетевых приложений, книга охватывает все аспекты, необходимые разработчикам игр для защиты, их продуктов и клиентов от злоумышленников. Книгу можно использовать для прививать языка и региональных параметров безопасности в среде разработки Studio. Не следует просто думать о безопасности кода как о проблеме разработчика или в проблеме тестера. Безопасность как любая команда — от руководителя программы до конструктора до тестеров — следует подумать о том, когда они работают над проектом. Чем больше глаз является частью процесса проверки, тем больше вероятность перехватывать бреши в системе безопасности до выпуска.

При *написании безопасного кода второй выпуск* можно найти на конференции [Microsoft Learning](https://www.microsoftpressstore.com/store/writing-secure-code-9780735617223) , а более общие сведения о безопасности можно найти в [Фендингх будущих атак, уменьшая контактную зону](/previous-versions/ms972812(v=msdn.10)) Майкла Ховарда.

Майкл Говард, Дэвид Леблана и Джон Виега написали другую книгу по теме, охватывающую все распространенные операционные системы и языки программирования, а также *19 тупиковые Синс безопасности программного обеспечения*.

Презентации по безопасности, касающиеся игр, можно найти на странице загрузки [презентаций для разработчиков Microsoft XNA](/previous-versions/dn629515(v=msdn.10)) .

</dd> <dt>

<span id="Threat_Modeling_Analysis"></span><span id="threat_modeling_analysis"></span><span id="THREAT_MODELING_ANALYSIS"></span>Анализ моделирования угроз
</dt> <dd>

Анализ моделирования угроз — это хороший способ оценки безопасности системы, а не на определенном языке или с помощью средства, но в широком, сквозном методе, который можно выполнить на нескольких собраниях. При правильной реализации модель потоков может определить все сильные и слабые стороны системы, не добавляя в проект значительную рабочую нагрузку или время собрания. Метод моделирования угроз также подчеркивает концепцию оценки безопасности системы до и во время процесса разработки, чтобы обеспечить комплексную оценку, в то же время сосредоточиться на самых рискованных функциях. Его можно рассматривать как профилировщик для обеспечения безопасности. Если не использовать конкретный язык или полагаться на конкретное средство, моделирование угроз можно использовать в любой среде разработки, работающей над любым проектом в любом жанре. Моделирование угроз — это отличный метод, позволяющий отнести идею о безопасности всех сотрудников, а не о проблемах других пользователей.

При моделировании угроз Обратите особое внимание на следующее:

-   Источники данных UDP
-   Источники данных, для которых не требуется проверка подлинности
-   Источники данных, которые часто и обычно проверяются в ходе сбора информации с широкими масштабами
-   Любая возможность клиента напрямую передавать данные другим клиентам.

Это области, которые имеют хороший потенциал для слабых мест безопасности.

Дополнительные сведения о моделировании угроз см. в статье [моделирование](https://technet.microsoft.com/security/) угроз в центре разработки безопасности MSDN и в книге [моделирование угроз](https://www.amazon.com/Threat-Modeling-Microsoft-Professional-Swiderski/dp/0735619913) по Федору Свидерски и Window Снайдер.

</dd> <dt>

<span id="Data_Execution_Prevention___NX_"></span><span id="data_execution_prevention___nx_"></span><span id="DATA_EXECUTION_PREVENTION___NX_"></span>Предотвращение выполнения данных (/НКС)
</dt> <dd>

Последним средством, снижающим опасность нескольких эксплойтов, является предотвращение выполнения данных (DEP). Если включить параметр **/НКС** в команду Build, Visual Studio пометит страницы памяти с флагами, которые обозначают, имеет ли код право на выполнение или нет. Любая программа, попытка выполнения которой на странице памяти, не помеченной с помощью разрешения EXECUTE, приведет к принудительному завершению работы программы. Защита применяется на уровне процессора и повлияет на разработчиков, использующих самостоятельно изменяемый код или компиляторы собственного JIT-языка. Сейчас только процессоры AMD Athlon64 и Opteron и процессоры Intel Itanium и новейшей версии 4 поддерживают предотвращение выполнения, но все 32-разрядные и 64-разрядные процессоры будут поддерживать предотвращение выполнения в будущем. (Схема защиты от копирования, используемая разработчиком, может зависеть от предотвращения выполнения, но корпорация Майкрософт работает с поставщиками защиты от копирования, чтобы уменьшить влияние.) Мы рекомендуем использовать DEP.

Дополнительные сведения о DEP см. в разделе [предотвращение выполнения данных](../memory/data-execution-prevention.md).

</dd> <dt>

<span id="Buffer_Security_Check___GS__and_Image_has_Safe_Exception_Handlers___SAFESEH_"></span><span id="buffer_security_check___gs__and_image_has_safe_exception_handlers___safeseh_"></span><span id="BUFFER_SECURITY_CHECK___GS__AND_IMAGE_HAS_SAFE_EXCEPTION_HANDLERS___SAFESEH_"></span>Проверка безопасности буфера (/GS) и Image имеет безопасный обработчик исключений (/SAFESEH)
</dt> <dd>

*Проверка безопасности буфера*, заданная с помощью флага компилятора **/GS**, и *Image имеет безопасные обработчики исключений*, заданные флагом компоновщика **/SAFESEH** (впервые реализованный в Visual Studio .NET 2003), может значительно упростить задачу разработчика по защите кода.

Использование флага **/GS** приводит к тому, что компилятор создает проверку на наличие некоторых форм переполнения буфера на основе стека, которые могут быть использованы для перезаписи возвращаемого адреса функции. Использование **/GS** не обнаруживает все возможные переполнения буфера и не должно считаться перехватывать все, но хорошей защитной технологией.

Использование флага **/SAFESEH** дает указание компоновщику создать только исполняемый файл или библиотеку DLL, если он также может формировать таблицу безнадежных обработчиков исключений исполняемого файла или библиотеки DLL. Безопасность структурированной обработки исключений (SafeSEH) устраняет обработку исключений как цель атак переполнения буфера, гарантируя, что до отправки исключения обработчик исключений регистрируется в таблице функций, расположенной в файле изображения. Эти преимущества защиты включены в Windows XP с пакетом обновления 2 (SP2), Windows Server 2003, Windows Vista и Windows 7. Кроме того, для правильной работы параметр **/SAFESEH** должен использоваться в методе ALL-или Nothing. Все библиотеки, содержащие код, привязанный к исполняемому файлу или библиотеке DLL, должны быть скомпилированы с параметром **/SAFESEH** , иначе таблица не будет создана.

Дополнительные сведения о [проверке безопасности буфера](https://msdn.microsoft.com/library/8dbf701c(vs.71).aspx) (**/GS**) и [образе, которые имеют безопасный обработчик исключений](https://msdn.microsoft.com/library/9a89h429(vs.71).aspx) (**/SAFESEH**), можно найти в MSDN.

См. также сведения о [флаге **/SDL**](/cpp/build/reference/sdl-enable-additional-security-checks?view=vs-2019) 2012 Microsoft Visual Studio и усовершенствованиях Visual Studio 2012 [для флага **/GS**](https://www.microsoft.com/security/blog/2012/01/26/enhancements-to-gs-in-visual-studio-11/).

</dd> <dt>

<span id="PREfast"></span><span id="prefast"></span><span id="PREFAST"></span>PREfast
</dt> <dd>

Экспресс-выпуск — это бесплатное средство, предлагаемое корпорацией Майкрософт, которое анализирует пути выполнения в скомпилированном C или C++ для поиска ошибок времени выполнения. Предбыстрый запуск осуществляется путем работы с всеми путями выполнения во всех функциях и оценки каждого пути для проблем. Это средство, первоначально используемое для разработки драйверов и другого кода ядра, помогает разработчикам игр сэкономить время, устраняя некоторые ошибки, которые трудно найти или игнорировать компилятором. Быстрое использование — это отличный способ сократить рабочую нагрузку и сосредоточиться на усилиях группы разработки и тестирования. В Visual Studio Team Suite и Visual Studio Team Edition for Software Developers в качестве средств анализа кода, включенного параметром компилятора **/Analyze**. (Этот параметр также доступен в бесплатной версии компилятора, поставляемой с пакетом средств разработки программного обеспечения Windows.)

> [!Note]  
> Visual Studio 2012 поддерживает **/Analyze** во всех выпусках. Дополнительные сведения о доступности анализа кода во всех выпусках Visual Studio см. в разделе [новые возможности анализа кода](/archive/blogs/codeanalysis/?m=20123).

 

Используя заметку заголовка (особенно для аргументов указателя буфера), можно использовать дополнительные проблемы, например перезапись ошибок памяти, общий источник сбоев и потенциальных уязвимостей безопасности. Это делается с помощью стандартного языка аннотирования (SAL), который представляет собой форму пометки для прототипов функций C/C++, которые предоставляют дополнительные сведения о предполагаемой семантике аргумента указателя и корреляции с параметрами длины, объявленными размерами буфера и т. д. Все заголовки для операционных систем Windows записываются в заметки, и Добавление знака SAL в заголовках общедоступных API в собственных библиотеках позволяет выполнять более подробные и агрессивные проверки в коде клиента для таких API. Введение в SAL и ссылки на дополнительные сведения см. в записи блога Майкла Ховарда «[Краткое введение по стандартному языку аннотирования (SAL)](/archive/blogs/michael_howard/a-brief-introduction-to-the-standard-annotation-language-sal)».

</dd> <dt>

<span id="Windows_Application_Verifier"></span><span id="windows_application_verifier"></span><span id="WINDOWS_APPLICATION_VERIFIER"></span>средство проверки приложений Windows
</dt> <dd>

Средство проверки приложений Windows или AppVerifier могут помочь инженерам-испытателям, предоставляя несколько функций в одном средстве. AppVerifier — это средство, разработанное для того, чтобы сделать распространенные ошибки программирования более тестируемыми. AppVerifier может проверять параметры, передаваемые в вызовы API, вставлять ошибочные входные данные для проверки возможности обработки ошибок и записывать изменения в реестр и файловую систему. AppVerifier также может обнаруживать переполнения буфера в куче, проверять, правильно ли определен список управления доступом (ACL) и обеспечивать безопасность использования API-интерфейсов сокетов. Хотя это и не является исчерпывающим, AppVerifier может быть одним из средств на панели элементов тестировщика, чтобы помочь среде разработки выпускать качественный продукт.

Дополнительные сведения о средство проверки приложений см. в статье [средство проверки приложений](/previous-versions/visualstudio/visual-studio-2008/ms220948(v=vs.90)) и [использование средство проверки приложений в жизненном цикле разработки программного обеспечения](/previous-versions/aa480483(v=msdn.10)) на сайте MSDN.

</dd> <dt>

<span id="Fuzz_Testing"></span><span id="fuzz_testing"></span><span id="FUZZ_TESTING"></span>Тестирование методом Монте
</dt> <dd>

*Тестирование методом Монте-Карло* — это частично автоматизированный метод тестирования, который может улучшить текущие методологии тестирования. Центральная идея тестирования методом Монте-Карло заключается в полной оценке всех входных данных за счет ввода произвольной информации для просмотра перерывов; Сюда входят все сетевые данные, МОДС и сохраненные игры и т. д. Тестирование методом Монте-Карло довольно просто. Просто измените правильно сформированные файлы или сетевые данные путем вставки случайных байтов, зеркального отображения смежных байтов или отрицания числовых значений. 0xFF, 0xFFFF, 0xFFFFFFFF, 0x00, символ 0x0000, 0x00000000 и 0x80000000 — это значения, которые хорошо подходят для обеспечения безопасности при тестировании методом монтеного тестирования. Вы можете наблюдать за полученными сочетаниями взаимодействия с помощью AppVerifier. Хотя нечеткость не является исчерпывающей, ее легко реализовать и автоматизировать, и она может перехватить более сомнительны и непредсказуемые ошибки.

Дополнительные сведения о тестировании методом Монте: [Gamefest 2007](/previous-versions/dn629515(v=msdn.10)) см. *в статье Практическое руководство по обеспечению безопасности игр*.

</dd> <dt>

<span id="Authenticode_Signing"></span><span id="authenticode_signing"></span><span id="AUTHENTICODE_SIGNING"></span>Подписывание Authenticode
</dt> <dd>

Authenticode — это метод, гарантирующий, что исполняемые файлы, DLL-файлы и пакеты установщика Windows (MSI-файлы), получаемые пользователем, не изменяются с того, что был выпущен разработчик. Используя сочетание принципов шифрования, доверенных сущностей и отраслевых стандартов, Authenticode проверяет целостность исполняемого содержимого. Корпорация Майкрософт предоставляет криптографический API-интерфейс CryptoAPI, который можно использовать для автоматического обнаружения искажений подписанного кода. Если после выпуска возникает утечка безопасности, сертификат может быть отозван, и весь код, подписанный этим сертификатом, перестанет проходить проверку подлинности. Отзыв сертификата приведет к отмене проверки всех наименований, подписанных этим сертификатом. Windows разработана для работы с подписыванием Authenticode и предупреждает пользователя о неподписанном коде в конкретных ситуациях, которые могут представлять компьютер пользователя для атаки.

Authenticode не следует рассматривать как метод устранения проблем безопасности, но метод обнаружения незаконного изменения после выпуска исполняемого файла. Исполняемый файл или библиотека DLL, содержащая уязвимость системы безопасности, может быть подписана и проверена с помощью Authenticode, но она по-прежнему будет выдавать проблемы безопасности для новой системы. Только после того, как продукт или обновление будут проверены на безопасность, следует подписать код, чтобы убедиться, что у пользователей есть выпуск, который не был изменен.

Даже если разработчик полагает, что их выпуски не изменяются, другие технологии и службы полагаются на Authenticode. Подписывание кода легко интегрируется и автоматизируется. нет причин, по которым разработчики не должны иметь подписанные выпуски.

Дополнительные сведения о подписывании Authenticode см. в статье [Подписывание Authenticode для разработчиков игр](./authenticode-signing-for-game-developers.md).

</dd> <dt>

<span id="Minimize_Privileges"></span><span id="minimize_privileges"></span><span id="MINIMIZE_PRIVILEGES"></span>Уменьшение привилегий
</dt> <dd>

В общих процессах следует запускать с минимальным набором привилегий, необходимых для работы. В Windows Vista и Windows 7 это достигается с помощью [контроля учетных записей](./user-account-control-for-game-developers.md), что позволяет запускать игру от имени обычного пользователя, а не администратора. Для Windows XP обычно игры всегда работают от имени администратора. Даже в Windows Vista и Windows 7 иногда требуется повысить права до полного уровня администратора для некоторых конкретных операций.

В случаях, когда процесс выполняется с полными правами администратора, фактически требуется лишь несколько прав, помимо тех, которые относятся к стандартному пользователю. Административный доступ включает множество прав, которые не требуются для правильного кода, но могут использоваться злоумышленниками с некоторыми слабыми местами в процессе. К примерам таких прав относятся \_ SE \_ -Take Ownership, SE \_ Debug, SE \_ Create \_ Token, SE \_ ассигнпримаритокен, SE \_ TCB, SE \_ Security, SE \_ Load \_ Driver, SE, СЕ \_ BACKUP, \_ SE \_ RESTORE, SE \_ Shutdown и SE \_ Audit (см. раздел [константы права](../secauthz/privilege-constants.md)).

Хотя процесс не может получить больше прав после запуска, он может легко получить права. При запуске процесс может сразу же использовать API-интерфейсы Win32 для удаления ненужных прав.

</dd> <dt>

<span id="Utilize_Windows_Security_Features"></span><span id="utilize_windows_security_features"></span><span id="UTILIZE_WINDOWS_SECURITY_FEATURES"></span>Использование функций безопасности Windows
</dt> <dd>

Windows Vista и Windows 7 включают ряд новых функций, улучшающих безопасность кода. [Управление учетными записями пользователей](./user-account-control-for-game-developers.md) , несомненно, является наиболее важным для понимания и принятия, но существуют и другие функции. В дополнение к технологиям Windows XP с пакетом обновления 2 (SP2), таким как брандмауэр Windows, предотвращение выполнения данных, проверка безопасности буфера и безопасный обработчик исключений, которые также доступны в Windows Vista и Windows 7, существует три новых функции безопасности, которые следует учитывать:

-   Функция случайного выбора макета адресного пространства. Это можно включить, связавсь с параметром **/DynamicBase** в visual Studio 2005 с пакетом обновления 1 (SP1) или visual Studio 2008. Это заставляет систему заменять позиции многих ключевых системных библиотек DLL в пространстве процесса, что усложняет написание злоумышленниками вредоносных программ, которые широко распространяются через Интернет. Этот флаг компоновщика не учитывается в Windows XP и более ранних версиях Windows.
-   Повреждение кучи может привести к целому классу эксплойтов безопасности, поэтому система памяти Windows Vista и Windows 7 теперь поддерживает режим, который прерывает процесс при обнаружении повреждения кучи. Вызов [**HeapSetInformation**](/windows/win32/api/heapapi/nf-heapapi-heapsetinformation) с помощью **хеапенаблетермиантеонкорруптион** даст согласие на это поведение. Этот вызов завершается сбоем в Windows XP и более ранних версиях Windows.
-   При написании служб их можно настроить с помощью новой функции, чтобы указать, какие привилегии действительно необходимы, а также ограничить доступ к ресурсам по определенному идентификатору безопасности. Это делается через [ChangeSeviceConfig2](/windows/win32/api/winsvc/nf-winsvc-changeserviceconfig2a), используя конфигурацию службы \_ \_ необходимые \_ привилегии \_ сведения и \_ \_ идентификатор безопасности службы настройки службы \_ \_ .

</dd> </dl>

## <a name="summary"></a>Сводка

Разработка игры для текущего и будущего рынка — дорогостоящая и трудоемкая. Выпуск игры с проблемами безопасности в конечном итоге повлечет за собой большую стоимость и время для правильного исправления. Таким образом, все разработчики игр могут интегрировать средства и методы для устранения угроз безопасности до выпуска.

Сведения, приведенные в этой статье, являются введением в то, что может сделать разработчик, чтобы помочь им и клиентам. Дополнительные сведения об общих рекомендациях по обеспечению безопасности и сведениях о безопасности можно найти в [центре разработчиков безопасности Майкрософт](https://technet.microsoft.com/security/).

 

 