---
title: Установка исправлений для игр в Windows XP, Windows Vista и Windows 7
description: В этой статье рассматриваются некоторые методы установки исправлений, которые будут хорошо работать в Windows Vista и Windows 7, а также в Windows XP.
ms.assetid: 27be805a-bffd-a9f8-2207-2a9a4822ba48
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 95ae0b1455cae61b8372f81e6928977743084c9e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105681654"
---
# <a name="patching-game-software-in-windows-xp-windows-vista-and-windows-7"></a>Установка исправлений для игр в Windows XP, Windows Vista и Windows 7

В Windows Vista и Windows 7 имеется ряд функций, позволяющих повысить безопасность операционной системы. Добавленная безопасность означает, что применение исправлений к программному обеспечению не так просто, как было в прошлом. В этой статье рассматриваются некоторые методы установки исправлений, которые будут хорошо работать в Windows Vista и Windows 7, а также в Windows XP.

Существуют две основные категории игр, для которых требуются исправления:

-   Игры, для которых требуются только случайные исправления, например большинство автономных игр.
-   Игры, требующие частого исправления, например большинство Интернет-игр.

В этой статье также приводится краткое введение в контроль учетных записей (UAC), которое служит фоновым описанием прав, которые разработчики могут рассчитывать в Windows Vista и Windows 7.

-   [Контроль учетных записей пользователей](#user-account-control)
-   [Игры, для которых требуются только случайные исправления](#games-that-require-only-occasional-patches)
    -   [Метод 1. Использование установщик Windows для редких исправлений](#method-1-use-windows-installer-for-occasional-patches)
    -   [Метод 2. требование наличия прав администратора для применения исправлений](#method-2-require-administrator-rights-to-apply-patches)
-   [Игры, требующие частых исправлений](#games-that-require-frequent-patches)
    -   [Способ 3. Установка для каждого пользователя](#method-3-install-per-user)
    -   [Метод 4. Установка в общую папку Per-Computer](#method-4-install-to-a-common-per-computer-location)
    -   [Другие возможности](#other-possibilities)
-   [Сводка](#summary)

## <a name="user-account-control"></a>контроль учетных записей

Windows Vista и Windows 7 имеют два основных типа учетных записей пользователей: стандартные пользователи и Администраторы. Учетная запись обычного пользователя имеет несколько ограничений доступа. Например, он не может записывать данные в файловую систему в папке% SystemDrive% \\ Program Files или в реестр на \_ локальном компьютере hKey \_ . Это влияет на применение исправлений к игре, если она установлена в расположении, доступном только для чтения. В отличие от Windows XP, учетная запись обычного пользователя гораздо более распространена в Windows Vista и Windows 7. Учетные записи обычных пользователей также требуются для важных функций операционной системы, таких как родительский контроль. Родительский контроль требует, чтобы дочерняя учетная запись была обычным пользователем, и повышенная учетная запись для администратора даже одной игры не позволяет родительским элементам управления работать со всеми другими играми. Поэтому важно, чтобы игры были разработаны для обычных пользователей.

В Windows Vista и Windows 7 имеется более новая модель для прав пользователей, которая помогает предотвратить запуск программ, пытающихся выполнять операции, которые пользователь не намеревается или не авторизует. Для этого контроль учетных записей пользователей (ранее назывался учетной записью пользователя с минимальными правами или LUA) позволяет пользователям работать на компьютере с минимальными правами, в то время как при необходимости можно легко запускать приложения, требующие прав более высокого уровня. Это означает, что учетные записи обычных пользователей и учетные записи администраторов запускают приложения с правами обычного пользователя, но только учетные записи администратора могут предоставлять приложениям повышенные права. Операционная система запрашивает у пользователей учетные записи администратора для явного согласия перед запуском приложения с повышенными правами, и если программа, требующая прав администратора, запускается на стандартной учетной записи пользователя, система запрашивает утверждение администратором.

## <a name="games-that-require-only-occasional-patches"></a>Игры, для которых требуются только случайные исправления

Некоторым играм требуется лишь несколько исправлений на протяжении всего жизненного цикла. Для этой частоты исправлений можно использовать два метода: распространять исправления в виде пакетов установщик Windows, которые обычно не нуждаются в правах администратора или используют другой тип распространения, который непосредственно изменяет файлы игры.

> [!Note]  
> Независимо от того, требуется ли для игры частое исправление, для установки или удаления приложений обычно требуются права администратора.

 

### <a name="method-1-use-windows-installer-for-occasional-patches"></a>Метод 1. Использование установщик Windows для редких исправлений

В этом методе установщик Windows используется для установки пакета (MSI-файл) и исправления установщик Windows (MSP-файл) для установки исправлений. Пакет должен иметь таблицу Мсипатчцертификате, а исправление должно иметь цифровую подпись сертификата в таблице. Дополнительные сведения о цифровой подписи можно найти в [подписывания Authenticode для разработчиков игр](/windows/desktop/DxTechArts/authenticode-signing-for-game-developers).

Дополнительные сведения и требования для использования этого метода исправления можно найти в документации по установщик Windows:

-   [Установка исправлений и обновления](/windows/desktop/Msi/patching-and-upgrades)
-   [Исправление контроля учетных записей пользователей (UAC)](/windows/desktop/Msi/user-account-control--uac--patching)

Недостаток этого метода заключается в том, что если игра не была установлена со съемного носителя в Windows XP, для установки исправлений требуются права администратора. Однако это не является слишком ограничивающим, поскольку большинство пользователей в Windows XP и ограничение на программное обеспечение, установленное со съемного носителя, отсутствует в Windows Vista.

Основным преимуществом этого метода является то, что исправления могут применяться учетной записью обычного пользователя, не требуя запроса и проверки подлинности для повышенных прав. Это обеспечивает лучшую работу пользователей, так как для игры пользователю с учетной записью обычного пользователя не нужно спрашивать пользователя с учетной записью администратора для установки исправления или предоставления учетной записи обычного пользователя с постоянными правами администратора.

Возможно, этот метод может работать в играх, требующих частых исправлений, но издержки на использование пакетов установщик Windows, в плане интеграции сборки и поддержки большого количества файлов, могут сделать этот метод менее желательным, чем другие.

### <a name="method-2-require-administrator-rights-to-apply-patches"></a>Метод 2. требование наличия прав администратора для применения исправлений

В этом методе для запуска исполняемого файла, который применяет исправление, требуются права администратора. С правами администратора исполняемый файл установки исправлений может напрямую изменять файлы игры, расположенные в файлах программы% SystemDrive% \\ .

Преимущество этого метода заключается в его простоте. Однако этот метод не подходит, если игра требует частого исправления, так как если пользователю с обычной учетной записью пользователя требуется играть в игру, требующую частых исправлений, например в интерактивной игре с несколькими игроками, у этого пользователя есть два варианта:

-   Получите администратора для входа в систему и исправления игры, что может оказаться неудобным для обеих сторон.
-   Повысьте права администратора у своей учетной записи.

> [!Note]  
> Последнее решение не только ослабляет безопасность системы в целом, но и предотвращает работу важных функций, таких как родительский контроль.

 

При реализации этого метода исполняемый файл, который применяет исправление, должен отличаться от исполняемого файла игры. Манифест исполняемого файла установки исправлений должен указывать requireAdministrator для requestedExecutionLevel, чтобы обозначить его как приложение, для которого требуются права администратора. Дополнительные сведения о том, как это сделать, можно найти в статье рекомендации [для разработчиков и рекомендации для приложений в среде с минимальными привилегиями](/previous-versions/dotnet/articles/aa480150(v=msdn.10))в "схема манифеста приложения".

При использовании этого метода даже с параметрами в манифесте исполняемый файл по-прежнему может запускаться без прав администратора в двух случаях:

-   Если операционной системой является Windows XP, а учетная запись пользователя является ограниченным пользователем.
-   Если операционной системой является Windows Vista или Windows 7, учетная запись пользователя является стандартным пользователем, а UAC отключен.

Оба из них являются редкими сценариями потребителя. Тем не менее, необходимо, чтобы манифест имел права администратора и вызывал [**исусеранадмин**](/windows/desktop/api/shlobj_core/nf-shlobj_core-isuseranadmin). Если эта функция возвращает значение FALSE, отображается сообщение об ошибке "требуются права администратора".

В целом, метод 1 предпочтительнее для игр, в которых требуется всего несколько исправлений в течение всего времени существования.

## <a name="games-that-require-frequent-patches"></a>Игры, требующие частых исправлений

Многие Интернет-игры постоянно улучшаются и обычно нуждаются в регулярных исправлениях. Для этих игр можно применить исправления для каждого пользователя или компьютера, как описано в следующих разделах. К другим возможным решениям относится изменение списка ACL, защищающего \\ программные файлы% systemdrive% или создание настраиваемой службы.

### <a name="method-3-install-per-user"></a>Метод 3. Установка Per-User

Один из рекомендуемых и простых подходов — установить всю игру в подпапку "на пользователя" локальной папки данных приложения, которую можно найти, вызвав [**шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) с CSid \_ Local \_ APPDATA. Пример пути — C: \\ Documents and Settings \\ имя пользователя \\ Local Settings \\ ексамплегаме данных приложения \\ . Такое расположение позволяет приложению, работающему с правами обычного пользователя, напрямую изменять файлы игр.

Однако существует недостаток этого подхода, если компьютер имеет несколько пользователей: на каждом из них установлена копия игры, а исправления должны быть загружены и применены каждым пользователем. Это теряет не только время и место на диске, но и увеличивает использование полосы пропускания сети для сервера, который предоставляет исправления. Кроме того, поскольку любое приложение с правами обычного пользователя может изменять игру, исполняемые файлы игр менее защищены; чтобы решить, является ли это приемлемой, разработчику игр.

### <a name="method-4-install-to-a-common-per-computer-location"></a>Метод 4. Установка в общую папку Per-Computer

Другой способ — установить неисполняемые данные игры в подкаталог пути, указанном в [**шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) CSid. \_ \_ пример пути — C: \\ Documents and Settings \\ All Users \\ Application Data \\ ексамплегаме. Это общее расположение для всех пользователей, которое может быть изменено приложениями, запускаемыми с правами обычного пользователя. Этот метод позволяет избежать необходимости повторного применения крупных исправлений, когда игра воспроизводится из нескольких учетных записей. Исполняемые файлы для игры должны храниться в файлах% SystemDrive%, \\ чтобы свести к сведению риск для других учетных записей в системе. Исполняемые файлы должны проверять целостность нового содержимого в общем каталоге, так как это расположение может быть изменено программой или пользователем с правами обычного пользователя. Рассмотрите возможность использования [**мапфилеандчекксум**](/windows/desktop/api/imagehlp/nf-imagehlp-mapfileandchecksuma) для вычисления контрольной суммы файлов.

Этот метод имеет преимущество работы как в Windows XP, так и в Windows Vista, и ему не требуются права администратора.

### <a name="other-possibilities"></a>Другие возможности

За пределами уже обсуждаемых методов можно изменить список ACL для \\ папки "Program Files" программы% systemdrive% \\ \\ при установке игры, чтобы средство исправления может записывать файлы в игры непосредственно, даже при запуске с правами обычного пользователя. Хотя это и не является сложной задачей, она обходит защиту системы безопасности, которую система предложит файлам игры, и предоставляет вредоносным программам возможность изменять содержимое каталога. Это не рекомендуется, поэтому настоятельно рекомендуется использовать вместо него альтернативный вариант.

Последняя возможность — написать пользовательскую службу. Как правило, написание пользовательской службы для исправлений игр не является хорошей идеей, так как это усложняется и подвержено ошибкам. Рекомендуется выполнить исправление, используя другие методы, описанные в этой статье. Однако при объединении с решениями борьбы-Памятка по или борьбы с пиратством может потребоваться пользовательская служба. Такая служба должна поддерживать большое количество игр и разработана таким образом, чтобы загружать только файлы исправлений и записывать их только в каталог установки для целевой игры. Важно, чтобы служба была невелика, иметь минимальную контактную зону, уязвимую для атак, и использовать как можно меньше системных ресурсов, если игра не запущена.

## <a name="summary"></a>Сводка

В конечном итоге вам нужно решить, какой метод реализовать. Необходимо взвесить факторы, которые важны для вас. Безопасность, периодичность установки исправлений, простота использования клиентом, Рабочая нагрузка, необходимая для реализации, сложности решения и соответствия функций платформы, — это факторы, которые каждый разработчик должен учитывать перед принятием решения о конкретном методе.

Дополнительные сведения о защите учетных записей можно найти в статье [требования к разработке приложений Windows Vista для контроля учетных записей пользователей (UAC)](/previous-versions/aa905330(v=msdn.10)).

 

 