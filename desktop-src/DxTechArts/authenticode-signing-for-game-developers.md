---
title: Подписывание Authenticode для разработчиков игр
description: В этой статье описывается, как приступить к проверке подлинности в игре и интеграции проверки подлинности в процесс ежедневной сборки.
ms.assetid: 0b3138ea-e4ea-57fb-756b-62fdc20cf813
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 256b1cec0693787e76cfa479940524fca28d508e
ms.sourcegitcommit: 5a78723ad484955ac91a23cf282cf9c176c1eab6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/22/2021
ms.locfileid: "114436459"
---
# <a name="authenticode-signing-for-game-developers"></a>Подписывание Authenticode для разработчиков игр

Проверка подлинности данных все еще важна для разработчиков игр. Windows в Vista и Windows 7 имеется ряд функций, таких как родительский контроль, требующих правильной подписи игр, чтобы убедиться в том, что данные не были изменены. Microsoft Authenticode позволяет конечным пользователям и операционной системе проверять, поступает ли программный код от законного владельца и что он не был изменен или случайно поврежден. В этой статье описывается, как приступить к проверке подлинности в игре и интеграции проверки подлинности в процесс ежедневной сборки.

-   [Фон](#background)
-   [Начало работы](#getting-started)
-   [Использование доверенного центра сертификации](#using-a-trusted-certificate-authority)
-   [Пример с использованием тестового сертификата](#example-using-a-test-certificate)
-   [Интеграция кода для входа в систему ежедневной сборки](#integrating-code-signing-into-the-daily-build-system)
-   [Запрет доступа](#revocation)
-   [Драйверы подписывания кода](#code-signing-drivers)
-   [Сводка](#summary)
-   [Дополнительные сведения](#more-information)

> [!Note]  
> по состоянию на 1 января 2016 г. Windows 7 и более поздних версий больше не доверяют сертификат подписи кода SHA-1 с датой истечения 1 января 2016 или более поздней. дополнительные сведения см. в разделе [Windows принудительное применение подписи кода Authenticode и метки времени](https://social.technet.microsoft.com/wiki/contents/articles/32288.windows-enforcement-of-sha1-certificates.aspx) .

 

## <a name="background"></a>Фон

Цифровые сертификаты используются для определения удостоверения автора. Цифровые сертификаты выдаются доверенным сторонним сторонним лицом, известным как центр сертификации (ЦС), например VeriSign или Thawte. ЦС отвечает за проверку того, что владелец не заказывает в ложном определении. После применения к центру сертификации для сертификата коммерческие разработчики могут рассчитывать на ответ на приложение менее чем за две недели.

После того как ЦС решит, что вы отвечаете условиям политики, он создает сертификат подписи кода, который соответствует X. 509, стандартному формату сертификата, созданному в международной телекоммуникационному объединению с расширениями версии 3. Этот сертификат идентифицирует вас и содержит открытый ключ. Он хранится в центре сертификации для справки, а копия предоставляется в электронном виде. В то же время вы также создадите закрытый ключ, который необходимо защитить и который не должен предоставляться никому, даже в центре сертификации.

После создания открытого и закрытого ключей можно приступать к распространению подписанного программного обеспечения. корпорация майкрософт предоставляет средства для этого в Windows SDK. Средства используют односторонний хэш, создают дайджест фиксированной длины и создают зашифрованную подпись с закрытым ключом. Затем они объединяют зашифрованную подпись с сертификатом и учетными данными в структуру, известную как блок подписи, и внедряют ее в файловый формат исполняемого файла. Любой тип исполняемого двоичного файла может быть подписан, включая библиотеки DLL, исполняемые файлы и CAB-файлы.

Подпись может быть проверена несколькими способами. Программы могут вызывать функцию Цертверифицертификатечаинполици, а средство SignTool (signtool.exe) можно использовать для проверки подписи из командной строки. Windows Обозреватель также имеет вкладку Цифровые подписи в свойствах файла, где отображаются все сертификаты подписанного двоичного файла. (Вкладка цифровые подписи отображается только в свойствах файлов для подписанных файлов.) Кроме того, приложение может самостоятельно проверить с помощью [**цертверифицертификатечаинполици**](/windows/desktop/api/wincrypt/nf-wincrypt-certverifycertificatechainpolicy).

подписывание Authenticode используется не только для проверки подлинности данных конечными пользователями, но и для исправления ограниченных учетных записей пользователей, а также родительскими элементами управления в Windows Vista и Windows 7. кроме того, для будущих технологий в операционных системах Windows также может потребоваться подпись кода, поэтому настоятельно рекомендуется, чтобы все профессиональные и пугала разработчики получили сертификат подписи кода от центра сертификации. Дополнительные сведения о том, как это сделать, можно найти далее в этой статье в разделе [использование доверенного центра сертификации](#using-a-trusted-certificate-authority).

Код игры, диспетчеры и установщики могут дополнительно использовать подписывание Authenticode путем проверки подлинности файлов в коде. Это можно использовать для защиты от Памятка по и общей безопасности сети. Пример кода для проверки подписи файла можно найти здесь: [Пример программы на языке C: Проверка сигнатуры PE-файла](/windows/desktop/SecCrypto/example-c-program--verifying-the-signature-of-a-pe-file)и пример кода для проверки принадлежности сертификата подписи к подписанному файлу можно найти здесь: [как получить сведения из исполняемых файлов, подписанных Authenticode](https://support.microsoft.com/kb/323809).

## <a name="getting-started"></a>Приступая к работе

чтобы приступить к работе, корпорация майкрософт предоставляет средства с Visual Studio 2005 и Visual Studio 2008, а также в [Windows SDK](https://msdn.microsoft.com/windowsserver/bb980924.aspx), чтобы помочь выполнить и проверить процесс подписывания кода. после установки Visual Studio или Windows SDK средства, описанные в этой технической статье, находятся в подкаталоге установки, который может включать в себя один или несколько из следующих компонентов:

-   % SystemDrive% \\ Program files \\ Microsoft Visual Studio 8 \\ SDK \\ v 2.0 \\ Bin
-   % SystemDrive% \\ Program files \\ Microsoft Visual Studio 8 \\ VC \\ платформсдк \\ Bin
-   % SystemDrive% \\ Program files \\ Microsoft Visual Studio 9,0 \\ смартдевицес \\ SDK \\ сдктулс\\
-   % SystemDrive% \\ Program files \\ Microsoft sdks \\ Windows \\ v 6.0 a \\ bin\\

Следующие средства наиболее полезны для подписания кода:

<dl> <dt>

<span id="Certificate_Creation_Tool__MakeCert.exe_"></span><span id="certificate_creation_tool__makecert.exe_"></span><span id="CERTIFICATE_CREATION_TOOL__MAKECERT.EXE_"></span>Средство создания сертификатов (MakeCert.exe)
</dt> <dd>

Создает тестовый сертификат X. 509 в виде CER-файла, который содержит открытый ключ и закрытый ключ в виде PVK-файла. Этот сертификат предназначен только для внутренних целей тестирования и не может использоваться в публичном виде.

</dd> <dt>

<span id="pvk2pfx.exe"></span><span id="PVK2PFX.EXE"></span>pvk2pfx.exe
</dt> <dd>

создает файл личных данных Exchange (pfx) из пары файлов. cer и. pvk. PFX-файл содержит как открытый, так и закрытый ключ.

</dd> <dt>

<span id="SignTool__SignTool.exe_"></span><span id="signtool__signtool.exe_"></span><span id="SIGNTOOL__SIGNTOOL.EXE_"></span>Средство SignTool (SignTool.exe)
</dt> <dd>

Подписывает файл с помощью PFX-файла. средство SignTool поддерживает подписывание файлов DLL, исполняемых файлов, файлов установщик Windows (.msi) и cab-файлов (.cab).

</dd> </dl>

> [!Note]  
> При чтении другой документации могут оказаться ссылки на SignCode (SignCode.exe), но это средство является устаревшим и больше не поддерживается — используйте SignTool.

 

## <a name="using-a-trusted-certificate-authority"></a>Использование доверенного центра сертификации

Чтобы получить доверенный сертификат, необходимо применить к центру сертификации (CA), например VeriSign или Thawte. корпорация майкрософт не рекомендует использовать какой-либо центр сертификации, но если вы хотите интегрировать его со службой отчеты об ошибках Windows (WER), рекомендуется использовать verisign для выдаче сертификата, так как для доступа к базе данных WER требуется учетная запись винкуал, для которой требуется идентификатор VeriSign. Полный список доверенных сторонних центров сертификации см. в [статье участники программы корневых сертификатов Майкрософт](/previous-versions/ms995347(v=msdn.10)). дополнительные сведения о регистрации с помощью WER см. в разделе "[введение в отчеты об ошибках Windows](https://msdn.microsoft.com/)" в [зоне ISV](https://msdn.microsoft.com/).

После получения сертификата из ЦС можно подписать программу с помощью средства SignTool и отпустить программу в общедоступной версии. Однако необходимо соблюдать осторожность при защите закрытого ключа, который содержится в файлах PFX и PVK. Не забудьте хранить эти файлы в безопасном месте.

## <a name="example-using-a-test-certificate"></a>Пример с использованием тестового сертификата

Следующие шаги демонстрируют создание сертификата подписи кода для целей тестирования, а также подписывание примера программы Direct3D (с именем BasicHLSL.exe) с помощью этого тестового сертификата. Эта процедура создает CER-и PVK-файлы (открытые и закрытые ключи соответственно), которые не могут использоваться для общедоступной сертификации.

В этом примере отметка времени также добавляется в сигнатуру. Метка времени предотвращает недействительность подписи после истечения срока действия сертификата. Код, который подписан, но отсутствует метка времени, не будет проверяться после истечения срока действия сертификата. Таким образом, весь открытый код должен иметь отметку времени.

**Создание сертификата и подписание программы**

1.  Создайте тестовый сертификат и закрытый ключ с помощью средства создания сертификатов (MakeCert.exe).

    Следующий пример командной строки задает MyPrivateKey в качестве имени файла для файла закрытого ключа (. PVK), Мипубликкэй в качестве имени файла сертификата (CER) и Мисофтварекомпани в качестве имени сертификата. Он также создает самозаверяющий сертификат, чтобы он не имел ненадежного корневого центра сертификации.

    ```
    MakeCert /n CN=MySoftwareCompany /r /h 0 /eku "1.3.6.1.5.5.7.3.3,1.3.6.1.4.1.311.10.3.13" /e 12-31-2020 /sv MyPrivateKey.pvk MyPublicKey.cer
    ```

    

2.  создайте файл личных данных Exchange (pfx) из файла закрытого ключа (. pvk) и файла сертификата (cer) с помощью pvk2pfx.exe.

    PFX-файл объединяет открытые и закрытые ключи в один файл. Следующий пример командной строки использует PVK-и CER-файлы из предыдущего шага, чтобы создать PFX-файл с именем Мипфкс и паролем \_ :

    ```
    pvk2pfx.exe -pvk MyPrivateKey.pvk -spc MyPublicKey.cer -pfx MyPFX.pfx -po your_password
    ```

    

3.  подпишите свою программу, используя личную информацию Exchange файл (. pfx) с помощью средства SignTool.

    В командной строке можно указать несколько параметров. В следующем примере командной строки используется PFX-файл из предыдущего шага, в качестве пароля задается \_ пароль, указывается басичлсл в качестве файла для подписи и извлекается метка времени из указанного сервера:

    ```
    signtool.exe sign /fd SHA256 /f MyPFX.pfx /p your_password /v /t URL_to_time_stamp_service BasicHLSL.exe
    ```

    

    > [!Note]  
    > URL-адрес службы отметок времени предоставляется центром сертификации и является необязательным для тестирования. Для рабочего подписывания важно включить допустимый центр отметок времени, иначе подпись не сможет проверить срок действия сертификата.

     

4.  Убедитесь, что программа подписана с помощью средства SignTool.

    Следующий пример командной строки указывает, что средство SignTool должно попытаться проверить подпись на BasicHLSL.exe с помощью всех доступных методов, в то же время предоставляя подробные выходные данные:

    ```
    signtool.exe verify /a /v BasicHLSL.exe
    ```

    

    В этом примере средство SignTool должно указывать, что сертификат присоединен, а также о том, что он не является доверенным, так как он не выдается центром сертификации.

5.  Доверять тестовому сертификату.

    Для тестовых сертификатов необходимо доверять сертификату. Этот шаг следует пропустить для сертификатов, предоставляемых центром сертификации, так как они будут доверенными по умолчанию.

    На компьютерах, на которых требуется доверять тестовому сертификату, выполните следующую команду:

    ```
    certmgr.msc
    ```

    

    Затем щелкните правой кнопкой мыши Доверенные корневые центры сертификации и выберите все задачи \| Импорт. Затем перейдите к созданному PFX-файлу и следуйте инструкциям мастера, поместив сертификат в список доверенных корневых центров сертификации.

    По завершении работы мастера можно начать тестирование с помощью доверенного сертификата на этом компьютере.

## <a name="integrating-code-signing-into-the-daily-build-system"></a>Интеграция кода для входа в систему ежедневной сборки

Чтобы интегрировать подписывание кода в проект, можно создать пакетный файл или скрипт для запуска программ командной строки. После сборки проекта запустите средство SignTool с соответствующими параметрами (как показано на шаге 3 нашего примера).

Будьте особенно осторожны в процессе сборки, чтобы гарантировать, что доступ к файлам PFX и PVK ограничен минимальным числом компьютеров и пользователей. Рекомендуется только подписать код с помощью тестового сертификата до тех пор, пока они не будут готовы к отправке. Опять же, закрытый ключ (. PVK) должен храниться в защищенном расположении, например в надежной или защищенной комнате, и в идеале — на устройстве шифрования, например на смарт-карте.

другой уровень защиты обеспечивается с помощью Microsoft Authenticode для подписи самого пакета установщик Windows (MSI). Это помогает защитить пакет MSI от несанкционированного изменения и случайного повреждения. Дополнительные сведения о том, как подписывать пакеты с помощью Authenticode, см. в документации по своему средству создания MSI.

## <a name="revocation"></a>Запрет доступа

В случае, если безопасность закрытого ключа скомпрометирована или какое-либо событие, связанное с безопасностью, отрисовывает Code-Signing сертификат недействителен, разработчик должен отозвать сертификат. Это не приведет к ослаблению целостности разработчика и эффективности кода подписи. Центр сертификации также может выдать отзыв с заданным временем; код, подписанный с помощью метки времени до момента повторного вызова, по-прежнему будет считаться действительным, но код со следующей отметкой времени будет недействительным. Отзыв сертификата влияет на код в любых приложениях, подписанных отозванным сертификатом.

## <a name="code-signing-drivers"></a>Драйверы Code-Signing

Драйверы могут и должны быть подписаны с поддержкой Authenticode. драйверы режима ядра предъявляют дополнительные требования: 64-разрядные выпуски Windows Vista и Windows 7 не позволяют устанавливать все неподписанные драйверы режима ядра, а во всех версиях Windows будет отображаться предупреждение, когда пользователь попытается установить неподписанный драйвер. кроме того, администраторы могут задать групповая политика, чтобы предотвратить установку неподписанных драйверов на Microsoft Windows Server 2003, Windows XP Professional x64 Edition и 32-разрядных выпусках Windows Vista и Windows 7.

многие типы драйверов могут быть подписаны с помощью надежной подписи майкрософт — в рамках программы Windows сертификации [Windows лаборатории](https://www.microsoft.com/whdc/whql/) WHQL или [программы неклассифицированных подписей](https://www.microsoft.com/whdc/winlogo/drvsign/dqs.mspx) (прежнее название — подпись надежности драйвера), которая позволяет системе полностью доверять этим драйверам и устанавливать их даже без административных учетных данных.

как минимум, драйверы должны быть подписаны с помощью Authenticode, так как драйверы, которые не подписаны или не имеют собственной подписи (то есть подписанный тестовый сертификат), не смогут установить на многих платформах на базе Windows. дополнительные сведения о подписывании драйверов и коде и связанных компонентах см. в статье [требования подписывания драйверов для Windows](https://www.microsoft.com/whdc/winlogo/drvsign/drvsign.mspx) в [центре разработчиков Windows оборудования](https://www.microsoft.com/whdc/).

## <a name="summary"></a>Сводка

Использование Microsoft Authenticode — это простой процесс. После получения CER-файла и создания закрытого ключа достаточно просто использовать средства, предоставляемые корпорацией Майкрософт. затем вы можете включить важные функции в Windows Vista и Windows 7, например родительский контроль, и уведомить клиентов о том, что продукт поступает непосредственно от его законного владельца.

## <a name="more-information"></a>Дополнительные сведения

Дополнительные сведения о средствах и процессах, связанных с кодом подписи, см. по следующим ссылкам:

-   [Средства шифрования](/windows/desktop/SecCrypto/cryptography-tools)
-   [Справочник по средствам API шифрования](/windows/desktop/SecCrypto/cryptoapi-tools-reference)
-   [Общие сведения о Authenticode и Турториалс](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537360(v=vs.85))
-   [Цифровые сертификаты](/windows/desktop/SecCrypto/digital-certificates)
-   [Развертывание Authenticode](https://www.microsoft.com/technet/security/topics/cryptographyetc/authenticodets.mspx)
-   [Как создать временные сертификаты для использования во время разработки](/dotnet/framework/wcf/feature-details/how-to-create-temporary-certificates-for-use-during-development)

 

 
