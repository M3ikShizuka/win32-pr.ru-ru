---
title: Оптимизация производительности DVD для игр Windows
description: В этой статье описывается оптимизация производительности DVD для игр Windows.
ms.assetid: 01e8dc7d-4ba7-40dd-d845-a20000201ae1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb15063d0441423ccb3a9f67db84caa134f801c6
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105661747"
---
# <a name="optimizing-dvd-performance-for-windows-games"></a>Оптимизация производительности DVD для игр Windows

Высокий процент компьютеров под управлением Windows имеет DVD-дисковод и многие игры поставляются на DVD-диск. Поэтому рекомендуется убедиться, что игры используют DVD-дисковод для полного использования. Зная, как данные считываются с DVD-диска и как расположение данных влияет на время его чтения, можно уменьшить время загрузки и повысить общую производительность во время игры. В этой статье описывается оптимизация производительности DVD для игр Windows.

-   [Базовый макет DVD-диска](#basic-layout-of-a-dvd)
-   [Чтение с DVD-диска](#reading-from-a-dvd)
-   [Чтение ошибок](#reading-errors)
-   [Пропускная способность данных](#data-throughput)
-   [Примеры неиспользуемой пропускной способности](#examples-of-wasted-throughput)
-   [Синхронное считывание и асинхронное чтение](#reading-synchronously-vs-asynchronously)
-   [Оптимальное чтение](#reading-optimally)
-   [Совместимость с DVD](#dvd-compatibility)
-   [Сводка](#summary)

## <a name="basic-layout-of-a-dvd"></a>Базовый макет DVD-диска

На этом рисунке показан базовый макет DVD-диска.

![макет DVD](images/dvdsector.png)

Данные на DVD-диске хранятся в виде непрерывной спирали, например на компакт-диске. Однако файлы разбиваются на блоки и секторы. Файлы распределяются по блокам кода исправления ошибок (ECC), и каждый блок делится на секторы размером 16 2 КБ (то есть 32 КБ данных в каждом блоке). Файлы вычисляются по границам секторов, а любое неиспользуемое пространство в секторе остается пустым. Если файл содержит всего 10 байт, то оставшаяся часть пространства в этом секторе 2 КБ теряется. по возможности упакуйте файлы в интервал размером 2 КБ, чтобы получить лучшую плотность данных. Имейте в виду, что эти спецификации предназначены только для DVD-дисков, а CD и HD-DVD имеют разные характеристики.

## <a name="reading-from-a-dvd"></a>Чтение с DVD-диска

Ниже приведена последовательность, которая выполняется при получении запроса на чтение с DVD-диска:

1.  Изменить слои (при необходимости)
2.  Seek
3.  Перефокусирование устройства оптического приема-отправки (ОПУ) для чтения данных
4.  Проверка фактической должности
5.  Настройка и повторение до тех пор, пока не будут найдены правильные данные

Операции чтения диска квантования по-разному, в зависимости от того, являются ли они чтением логического накопителя или чтением физического диска. Операция чтения логического накопителя может считать только целое число секторов DVD, а физический диск может считать только целочисленное количество блоков ECC. Как правило, физический диск получает запрос на чтение; будет предпринята попытка заполнения своего кэша. Размер кэша DVD-дисковода зависит от характеристик отдельных дисков.

Когда DVD-дисковод получает запрос на чтение, превышающий размер кэша, запрос разбивается на запросы размера кэша. Диск ищет блок ECC, который содержит первый сектор запроса, и считывает весь блок ECC. Встроенное по диска декодирует блок ECC, а затем считывает следующий блок ECC. Процесс повторяется до заполнения кэша диска или выполнения всех запросов. Затем ядро считывает декодированные данные из кэша диска. Затем он очищает кэш и запускает следующую операцию чтения, если все запросы на чтение остаются.

> [!Note]  
> В каждом некэшированном чтении кэш диска очищается.

 

## <a name="reading-errors"></a>Чтение ошибок

Диски DVD и DVD не идеально подходят, и во время чтения могут возникать ошибки. Как и компакт-диски, части DVD могут стать нечитаемыми с пыли или царапин. Если какая-либо часть блока нечитаема, весь блок считается нечитаемым. Если возникает ошибка чтения, диск пытается повторно прочитать блок ECC. Если блок по-прежнему недоступен для чтения, диск прерывает операцию чтения и возвращает в ядро значение, указывающее, что блок был нечитаемым. Затем ядро решает, какой шаг следует предпринять. Ядро может либо повторно выполнить запрос, либо полностью прервать чтение, либо прокрутить диск вниз и повторно отправить запрос.

## <a name="data-throughput"></a>Пропускная способность данных

Пропускная способность данных DVD-дисковода зависит от нескольких факторов: расположения запрошенных данных, способа очистки или удаления диска, количества потоков, считываемых с диска, размера буферов, связанных с этими потоками, и спецификаций отдельного диска. Пропускная способность также зависит от того, имеет ли диск постоянную угловую скорость (Кав) или постоянную линейную скорость (CLV). Если диск вращается с помощью Кав, диск вращается с той же скоростью, независимо от того, где находится устройство оптической отправки (ОПУ). Это означает, что скорость перемещения данных ОПУ быстрее, так как ОПУ ближе к внешнему периметру диска. При использовании CLV диск вращается медленнее, так как ОПУ перемещается наружу, поэтому скорость передачи данных перемещается после ОПУ с постоянной скоростью. В большинстве компьютеров DVD-дисководы используют CLV.

Пока диск ищет и изменяет слои, данные невозможно прочитать с диска. Рекомендуется максимально сокращать эти операции, особенно при чтении данных для начального экрана загрузки.

## <a name="examples-of-wasted-throughput"></a>Примеры неиспользуемой пропускной способности

Чтобы понять, как может быть потрачено пропускная способность данных, рассмотрим гипотетический диск и DVD-диск. Предположим, что необходимо прочитать файл в середине диска. Пропускная способность этой области диска составляет примерно 8,25 МБ/с. Если искомый фрагмент является половиной или третьей частью полного, среднее время поиска составляет 150 мс. В этом примере 1,2 МБ (150 MS × 8,25 МБ/с) могли быть считаны в момент, когда он занял ОПУ, откуда он может быть прочитан. Добавление изменения слоя приводит к потере пропускной способности до 1,8 МБ (225 МС × 8,25 МБ/с).

Еще один пример, демонстрирующий пропускную способность, — загрузка 20 плохо расположенных файлов с диска Кав без изменения слоя. Если время поиска для каждого файла плюс задержка до считывания данных, составляет примерно 200 мс, то 4 секунды (20 файлов × 200 мс) потратили только на поиск данных. Если файлы расположены на внешнем диаметре и считываются 11 ×, то средняя пропускная способность 15,2 МБ/с (11 скорость/12 скорость x 16 МБ/с). Неиспользуемая пропускная способность в этом примере составляет примерно 60,8 МБ (15,2 МБ/с × 4 с).

## <a name="reading-synchronously-vs-asynchronously"></a>Синхронное считывание и асинхронное чтение

Асинхронное чтение более эффективно, чем синхронное чтение. При синхронном чтении один или несколько блоков ECC данных считываются в системную память перед их копированием в память приложения. В отличие от этого асинхронное чтение копирует декодированные блоки ECC непосредственно в память приложения, что позволяет избежать использования кэша L2 и снизить нагрузку на ЦП. Для асинхронного чтения используйте \_ флаг флага file \_ OVERLAPPED при использовании функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) для открытия файлов. Для выполнения асинхронного ввода-вывода функции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) также требуется допустимая перекрывающая структура.

Дополнительные сведения о асинхронном вводе-выводе можно найти в [синхронном и асинхронном операциях ввода-вывода](/windows/desktop/FileIO/synchronous-and-asynchronous-i-o).

## <a name="reading-optimally"></a>Оптимальное чтение

Лучший принцип чтения с DVD-диска — избежать поиска и чтения небольших объемов данных. Если объем считанных данных меньше емкости блока ECC (менее 32 КБ), оставшаяся часть блока теряется. Так как размер кэша отличается от диска к диску, разработчики должны принять решение о минимальном объеме данных для запросов на чтение и не сделать их меньше. Минимальный размер должен быть целым числом, кратным блоку ECC, чтобы не тратить время на чтение и декодирование данных, которые не будут использоваться. Также важно избегать поиска во всех затратах, так как любое время, потраченное на поиск, затратило время на чтение данных.

## <a name="dvd-compatibility"></a>Совместимость с DVD

Существует ряд важных проблем совместимости, которые следует учитывать при выпуске на DVD-диске. Во-первых, диски DVD в компьютерах под управлением Windows могут различаться в зависимости от производительности, поэтому, если диск DVD имеет определенное требование к пропускной способности, важно убедиться, что оборудование пользователя соответствует этим требованиям. Кроме того, многослойные DVD-диски могут вызвать проблемы совместимости некоторых дисков DVD. Чтобы избежать этих проблем, рекомендуется предоставить одноуровневый DVD-диск или тщательно протестировать DVD-диск с несколькими уровнями на большинстве дисков перед выпуском.

## <a name="summary"></a>Сводка

Для повышения производительности DVD-диска можно применить некоторые общие правила. Следующие методы позволяют максимально увеличить пропускную способность и сократить объем незанятых данных:

-   Старайтесь не считывать данные размером менее 32 КБ.
-   Разметьте данные для сокращения или исключения поисков
-   Размещать данные на границах блоков ECC
-   Максимально увеличить емкость, объединяя небольшие файлы в блоки размером в 2 КБ, и уменьшить пространство заполнения в секторах DVD
-   Асинхронное чтение для снижения нагрузки на ЦП и чрезмерного использования памяти
-   Избегайте выпуска многослойных DVD-дисков

 

 