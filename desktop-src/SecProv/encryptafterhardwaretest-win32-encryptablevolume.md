---
description: Начинает шифрование полностью расшифрованного тома операционной системы после проверки оборудования.
ms.assetid: 216c96bb-7737-4421-8b16-1ce295342266
title: Метод Енкриптафтерхардваретест класса Win32_EncryptableVolume
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- Win32_EncryptableVolume.EncryptAfterHardwareTest
api_type:
- COM
api_location:
- Root\CIMV2\Security\MicrosoftVolumeEncryption
ms.openlocfilehash: f5365bd9aca023d42d9f2ab1d9de5d242497b8b21842004b2bb508f362752bd5
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119004502"
---
# <a name="encryptafterhardwaretest-method-of-the-win32_encryptablevolume-class"></a>Метод Енкриптафтерхардваретест \_ класса Win32 енкриптаблеволуме

Метод **енкриптафтерхардваретест** класса [**Win32 \_ енкриптаблеволуме**](win32-encryptablevolume.md) начинает шифрование полностью расшифрованного тома операционной системы после проверки оборудования. Для выполнения этой проверки оборудования требуется перезагрузка. Используйте этот метод вместо метода [**Encrypt**](encrypt-win32-encryptablevolume.md) , чтобы убедиться, что BitLocker будет работать должным образом.

> [!Note]  
> Если жесткий диск является аппаратно зашифрованным, этот метод не шифрует данные. Вместо этого он устанавливает состояние полосы снято с «бессрочно разблокирована». Если полоса заблокирована, разблокирована или доступна только для чтения, диск считается зашифрованным.

 

## <a name="syntax"></a>Синтаксис


```mof
uint32 EncryptAfterHardwareTest(
  [in, optional] uint32 EncryptionMethod,
  [in, optional] uint32 EncryptionFlags
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*Енкриптионмесод* \[ в необязательное\]
</dt> <dd>

Тип: **UInt32**

Задает алгоритм шифрования и размер ключа, используемые для шифрования тома. Оставьте этот параметр пустым, чтобы использовать нулевое значение по умолчанию. Если том частично или полностью зашифрован, значение этого параметра должно быть равно 0 или совпадать с существующим методом шифрования тома. Если соответствующий параметр групповая политика включен с допустимым значением, значение этого параметра должно быть равно 0 или соответствовать параметру групповая политика.

Если соответствующий параметр групповая политика является недопустимым, используется по умолчанию AES 128 с диффузором.



| Значение                                                                                                                                                                                                                                       | Значение                                                                                                                                                                                           |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="Unspecified"></span><span id="unspecified"></span><span id="UNSPECIFIED"></span><dl> Не <dt>**указано**</dt> <dt>0</dt> </dl> | Используйте текущий параметр групповая политика, если он доступен и является допустимым, или метод шифрования по умолчанию в противном случае.<br/>                                                                              |
| <dl> <dt>1</dt> </dl>                                                                                                                                                                | AES 128 С ДИФФУЗОРОМ<br/> Зашифруйте том с помощью алгоритма AES (AES), улучшенного с помощью слоя диффузора и размера ключа AES размером 128 бит.<br/> |
| <dl> <dt>2</dt> </dl>                                                                                                                                                                | AES 256 С ДИФФУЗОРОМ<br/> Зашифруйте том с помощью алгоритма AES (AES), улучшенного с помощью слоя диффузора и размера ключа AES размером 256 бит.<br/> |
| <span id="AES_128"></span><span id="aes_128"></span><dl> <dt>**AES \_ 128**</dt> <dt>3</dt> </dl>                                          | Зашифруйте том с помощью алгоритма AES (AES) и с помощью ключа AES размером 128 бит.<br/>                                                                 |
| <span id="AES_256"></span><span id="aes_256"></span><dl> <dt>**AES \_ 256**</dt> <dt>4</dt> </dl>                                          | Зашифруйте том с помощью алгоритма AES (AES) и с помощью ключа AES размером 256 бит.<br/>                                                                 |



 

</dd> <dt>

*Енкриптионфлагс* \[ в необязательное\]
</dt> <dd>

Тип: **UInt32**

Флаги, описывающие поведение шифрования.

**Windows 7, Windows server 2008 R2, Windows Vista Enterprise и Windows Server 2008:** Этот параметр недоступен.

Сочетание 32 бит, в котором в настоящее время определены следующие биты.



| Значение                                                                                  | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>0x00000001</dt> </dl>  | При запуске нового процесса шифрования Шифрование томов выполняется в режиме шифрования только для данных. Если шифрование приостановлено или остановлено, вызов метода [**Encrypt**](encrypt-win32-encryptablevolume.md) эффективно возобновляет преобразование, а значение этого бита игнорируется. Этот бит действует только в том случае, если методы **Encrypt** или **енкриптафтерхардваретест** запускают шифрование из полностью расшифрованного состояния, выполняется расшифровка или приостановленное состояние расшифровки. Если этот бит равен нулю, то есть он не задан, при запуске нового процесса шифрования будет выполнено преобразование в полном режиме.<br/> |
| <dl> <dt>0x00000002</dt> </dl>  | Выполните очистку свободного места тома по требованию. Вызов метода [**Encrypt**](encrypt-win32-encryptablevolume.md) с этим набором битов разрешен только в том случае, если в настоящее время не выполняется преобразование или очистка тома и он находится в зашифрованном состоянии.<br/>                                                                                                                                                                                                                                                                                                                                                                                    |
| <dl> <dt>0x00010000 </dt> </dl> | Выполнение запрошенной операции в синхронном режиме. Вызов блокируется до тех пор, пока запрошенная операция не будет завершена или была прервана. Этот флаг поддерживается только при использовании метода [**Encrypt**](encrypt-win32-encryptablevolume.md) . Этот флаг можно указать при вызове **шифрования** для возобновления остановки или прекращения шифрования или очистки, а также при выполнении шифрования или очистки. Это позволяет вызывающему объекту возобновить синхронное ожидание до завершения или прерывания процесса.<br/>                                                                                                                          |



 

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Тип: **UInt32**

При сбое этот метод возвращает один из следующих кодов или другой код ошибки.

Этот метод немедленно возвращает значение. Если том уже полностью зашифрован и другие ошибки не возвращаются, этот метод возвращает ноль.



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Возвращаемый код и значение</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><dl> <dt><strong>S_OK</strong></dt> <dt>0 (0x0)</dt> </dl></td>
<td>Метод успешно выполнен.<br/></td>
</tr>
<tr class="even">
<td><dl> <dt><strong>E_INVALIDARG</strong></dt> <dt>2147942487 (0x80070057)</dt> </dl></td>
<td>Параметр <em>енкриптионмесод</em> предоставляется, но не находится в известном диапазоне или не соответствует текущему параметру групповая политика.<br/></td>
</tr>
<tr class="odd">
<td><dl> <dt><strong>FVE_E_CANNOT_ENCRYPT_NO_KEY</strong></dt> <dt>2150694958 (0x8031002E)</dt> </dl></td>
<td>Для тома не существует ключа шифрования.<br/> Отключите предохранители ключа с помощью метода <a href="disablekeyprotectors-win32-encryptablevolume.md"><strong>дисаблекэйпротекторс</strong></a> или используйте один из следующих методов, чтобы указать предохранители ключа для тома:
<ul>
<li><a href="protectkeywithexternalkey-win32-encryptablevolume.md"><strong>протекткэйвисекстерналкэй</strong></a></li>
<li><a href="protectkeywithnumericalpassword-win32-encryptablevolume.md"><strong>протекткэйвиснумерикалпассворд</strong></a></li>
<li><a href="protectkeywithtpm-win32-encryptablevolume.md"><strong>протекткэйвистпм</strong></a></li>
<li><a href="protectkeywithtpmandpin-win32-encryptablevolume.md"><strong>протекткэйвистпмандпин</strong></a></li>
<li><a href="protectkeywithtpmandpinandstartupkey-win32-encryptablevolume.md"><strong>протекткэйвистпмандпинандстартупкэй</strong></a></li>
<li><a href="protectkeywithtpmandstartupkey-win32-encryptablevolume.md"><strong>протекткэйвистпмандстартупкэй</strong></a></li>
</ul>
<br/></td>
</tr>
<tr class="even">
<td><dl> <dt><strong>FVE_E_CLUSTERING_NOT_SUPPORTED</strong></dt> <dt>2150694942 (0x8031001E)</dt> </dl></td>
<td>Невозможно зашифровать том, так как этот компьютер настроен как часть кластера серверов.<br/></td>
</tr>
<tr class="odd">
<td><dl> <dt><strong>FVE_E_NO_PROTECTORS_TO_TEST</strong></dt> <dt>2150694971 (0x8031003B)</dt> </dl></td>
<td>Не удается найти предохранители ключа &quot; доверенного платформенного модуля &quot; , &quot; TPM и ПИН-кода &quot; , &quot; TPM, ПИН-код и ключ запуска &quot; , &quot; TPM и ключ запуска, а &quot; также &quot; внешний ключ &quot; . Проверка оборудования включает только предыдущие предохранители ключа.<br/> Если вы по-прежнему хотите выполнить тест оборудования, необходимо использовать один из следующих методов для указания предохранителей ключа для тома:
<ul>
<li><a href="protectkeywithexternalkey-win32-encryptablevolume.md"><strong>протекткэйвисекстерналкэй</strong></a></li>
<li><a href="protectkeywithnumericalpassword-win32-encryptablevolume.md"><strong>протекткэйвиснумерикалпассворд</strong></a></li>
<li><a href="protectkeywithtpm-win32-encryptablevolume.md"><strong>протекткэйвистпм</strong></a></li>
<li><a href="protectkeywithtpmandpin-win32-encryptablevolume.md"><strong>протекткэйвистпмандпин</strong></a></li>
<li><a href="protectkeywithtpmandpinandstartupkey-win32-encryptablevolume.md"><strong>протекткэйвистпмандпинандстартупкэй</strong></a></li>
<li><a href="protectkeywithtpmandstartupkey-win32-encryptablevolume.md"><strong>протекткэйвистпмандстартупкэй</strong></a></li>
</ul>
<br/></td>
</tr>
<tr class="even">
<td><dl> <dt><strong>FVE_E_NOT_DECRYPTED</strong></dt> <dt>2150694969 (0x80310039)</dt> </dl></td>
<td>Том частично или полностью зашифрован.<br/> Проверка оборудования применяется перед шифрованием. Если вы по-прежнему хотите выполнить тест, сначала используйте метод <a href="decrypt-win32-encryptablevolume.md"><strong>дешифровки</strong></a> , а затем используйте один из следующих методов для добавления предохранителей ключа:
<ul>
<li><a href="protectkeywithexternalkey-win32-encryptablevolume.md"><strong>протекткэйвисекстерналкэй</strong></a></li>
<li><a href="protectkeywithnumericalpassword-win32-encryptablevolume.md"><strong>протекткэйвиснумерикалпассворд</strong></a></li>
<li><a href="protectkeywithtpm-win32-encryptablevolume.md"><strong>протекткэйвистпм</strong></a></li>
<li><a href="protectkeywithtpmandpin-win32-encryptablevolume.md"><strong>протекткэйвистпмандпин</strong></a></li>
<li><a href="protectkeywithtpmandstartupkey-win32-encryptablevolume.md"><strong>протекткэйвистпмандстартупкэй</strong></a></li>
</ul>
<br/></td>
</tr>
<tr class="odd">
<td><dl> <dt><strong>FVE_E_NOT_OS_VOLUME</strong></dt> <dt>2150694952 (0x80310028)</dt> </dl></td>
<td>Том является томом данных.<br/> Проверка оборудования применяется только к томам, которые могут запускать операционную систему. Запустите этот метод на том же томе операционной системы, в котором запущен.<br/></td>
</tr>
<tr class="even">
<td><dl> <dt><strong>FVE_E_POLICY_PASSWORD_REQUIRED</strong></dt> <dt>2150694956 (0x8031002C)</dt> </dl></td>
<td>Предохранители ключа для типа " &quot; числовой пароль" не &quot; указаны. Групповая политика требуется резервное копирование сведений о восстановлении в службы домен Active Directory. Чтобы добавить хотя бы один предохранитель ключа этого типа, используйте метод <a href="protectkeywithnumericalpassword-win32-encryptablevolume.md"><strong>протекткэйвиснумерикалпассворд</strong></a> .<br/></td>
</tr>
</tbody>
</table>



 

## <a name="remarks"></a>Remarks

при использовании этого метода без второго параметра (в соответствии с определением Windows 7 и Windows Vista Enterprise) метод всегда запускает преобразование в полном режиме, чтобы обеспечить обратно совместимое поведение. таким образом, безопасность существующих приложений и скриптов не будет нарушена с добавлением второго необязательного параметра в Windows 8 и Windows Server 2012.

В отличие от метода [**Encrypt**](encrypt-win32-encryptablevolume.md) , этот метод выполняет следующие действия:

-   Проверяет, сможет ли доверенный платформенный модуль разблокировки тома, если существует предохранитель ключа, связанный с TPM.
-   Проверяет, может ли компьютер считывать флэш-накопитель USB, содержащий внешний файл ключа, во время запуска, если том будет разблокирован внешним ключом (включая ключ запуска).
-   Для запуска проверки оборудования требуется перезагрузка компьютера.
-   Начинает шифрование, только если проверка оборудования выполнена.
-   Не может использоваться на томе данных, на частично или полностью зашифрованном томе или для возобновления шифрования.

Перед выполнением этого метода используйте следующие методы, чтобы создать связанные предохранители ключа:

-   [**протекткэйвисекстерналкэй**](protectkeywithexternalkey-win32-encryptablevolume.md)
-   [**протекткэйвистпм**](protectkeywithtpm-win32-encryptablevolume.md)
-   [**протекткэйвистпмандпин**](protectkeywithtpmandpin-win32-encryptablevolume.md)
-   [**протекткэйвистпмандпинандстартупкэй**](protectkeywithtpmandpinandstartupkey-win32-encryptablevolume.md)
-   [**протекткэйвистпмандстартупкэй**](protectkeywithtpmandstartupkey-win32-encryptablevolume.md)

После выполнения этого метода выполните следующие дополнительные действия:

1.  Вставьте в компьютер флэш-накопитель USB, содержащий внешний файл ключа. Этот шаг применяется только в том случае, если том имеет предохранитель ключа типа "внешний ключ" или "TPM и ключ запуска".
2.  Перезагрузите компьютер.

При перезагрузке компьютера проверка оборудования выполняется автоматически.

Шифрование начинается, если проверка оборудования выполнена. В противном случае попытайтесь устранить сбои оборудования. Запустите [**жесардваретестстатус**](gethardwareteststatus-win32-encryptablevolume.md) после перезагрузки компьютера, чтобы получить результаты теста.

файлы MOF-файл (MOF) содержат определения для классов инструментарий управления Windows (WMI) (WMI). MOF-файлы не устанавливаются в составе Windows SDK. Они устанавливаются на сервере при добавлении связанной роли с помощью диспетчер сервера. Дополнительные сведения о файлах MOF см. в разделе [MOF-файл (MOF)](../wmisdk/managed-object-format--mof-.md).

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|---------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows vista Enterprise, \[ только для настольных приложений Windows vista Ultimate\]<br/>                       |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                                    |
| Пространство имен<br/>                | Корневой \\ CIMV2 \\ безопасности \\ микрософтволуминкриптион<br/>                                             |
| MOF<br/>                      | <dl> <dt>Win32 \_ енкриптаблеволуме. mof</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**\_Енкриптаблеволуме Win32**](win32-encryptablevolume.md)
</dt> </dl>

 

 
