---
description: Дополнительные сведения о функции Жетбегинтрансактион
title: Функция JetBeginTransaction
TOCTitle: JetBeginTransaction Function
ms:assetid: c5b2f9d7-157d-431d-a292-009c43773a9f
ms:mtpsurl: https://msdn.microsoft.com/library/Gg294083(v=EXCHG.10)
ms:contentKeyID: 32765698
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetBeginTransaction
topic_type:
- kbArticle
- apiref
api_type:
- COM
- DLLExport
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: dd5986d2e9e8e3c65fa472f37e8d92c4afbb4803
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342665"
---
# <a name="jetbegintransaction-function"></a>Функция JetBeginTransaction


_**Применимо к:** Windows | Windows Server_

## <a name="jetbegintransaction-function"></a>Функция JetBeginTransaction

Функция **жетбегинтрансактион** заставляет сеанс войти в транзакцию и создать новую точку сохранения. Эту функцию можно вызвать несколько раз в одном сеансе, чтобы создать дополнительные точки сохранения. Эти точки сохранения можно использовать для выборочного сохранения или отмены изменений состояния базы данных.

```cpp
    JET_ERR JET_API JetBeginTransaction(
      __in          JET_SESID sesid
    );
```

### <a name="parameters"></a>Параметры

*сесид*

Сеанс, используемый для этого вызова.

### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных.</p>
<p>Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="even">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="even">
<td><p>JET_errSessionSharingViolation</p></td>
<td><p>Один и тот же сеанс нельзя использовать одновременно для нескольких потоков. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
<tr class="even">
<td><p>JET_errTransTooDeep</p></td>
<td><p>Не удается запустить новую транзакцию, так как сеанс уже находится в максимально допустимой глубины точки сохранения в ядре СУБД.</p></td>
</tr>
</tbody>
</table>


При успешном выполнении указанный сеанс будет находиться внутри транзакции. Если сеанс был ранее внутри транзакции, будет создана новая точка сохранения.

В случае сбоя состояние транзакции сеанса останется неизменным. Изменение состояния базы данных не выполняется.

#### <a name="remarks"></a>Комментарии

Ядро СУБД предоставляет модель изоляции моментального снимка для своих транзакций. Это означает, что при первом входе в транзакционное состояние сеанс будет видеть всю базу данных в момент начала транзакции. Сеансу не требуется считывать данные блокировки, так как он всегда может обращаться к соответствующей версии этих данных. Это означает, что сеанс, который обновляет данные, никогда не будет блокировать считывание этих данных другим сеансом.

Еще одним следствием использования изоляции моментального снимка является модель блокировки, используемая для обновлений. Ядро СУБД будет выставлять блокировку записи для определенного фрагмента данных в первый сеанс, запрашивающий его. Эта блокировка записи освобождается, когда транзакция зафиксирована или прервана полностью, так что сеанс больше не находится в транзакции. Пока сеанс удерживает блокировку записи, любой другой сеанс, запрашивающий ту же блокировку записи, не будет блокироваться до тех пор, пока не станет доступной блокировка записи. Вместо этого второй сеанс немедленно завершится сбоем с JET_errWriteConflict. Чтобы устранить этот конфликт, второй сеанс должен полностью прервать (или зафиксировать) его транзакцию, дождаться некоторого небольшого периода времени, в течение которого первый сеанс зафиксирует или прекратит свою транзакцию, а затем снова запустите все снова.

В поддержку изоляции моментального снимка ядро СУБД сохраняет все версии всех измененных данных в памяти с момента первого запуска самой старой активной транзакции в любом сеансе. Это имеет важные последствия для вашего приложения. Любое поведение, которое приводит к созданию большого количества версий в памяти, может привести к исчерпанию максимального размера хранилища версий. Дополнительные сведения см. [JET_paramMaxVerPages](./resource-parameters.md) в разделе " [системные параметры](./extensible-storage-engine-system-parameters.md) ". Такое поведение включает, но не ограничивается очень большими обновлениями в одной транзакции и очень долго выполняющимися транзакциями. В результате очень важно правильно настроить размер хранилища версий для ожидаемой транзакционной нагрузки приложения. Также важно соблюдать осторожность при ограничении количества обновлений, выполняемых в одной транзакции. Более того, очень важно сделать так, чтобы транзакции намерены в условиях высокой нагрузки, как можно более короткие.

Настоятельно рекомендуется, чтобы приложение всегда набыло в контексте транзакции при вызове API-интерфейсов ESE, которые извлекают или обновляют данные. Если это не так, ядро СУБД автоматически заключает каждый вызов API-интерфейса ESE этого типа в транзакцию от имени приложения. В некоторых случаях затраты на эти очень короткие транзакции могут быстро сложиться.

Поведение обработчика по умолчанию заключается в ограничении использования сеанса тем же потоком с момента выполнения первого вызова **жетбегинтрансактион** до тех пор, пока не будет произведен соответствующий вызов [жеткоммиттрансактион](./jetcommittransaction-function.md) или [жетроллбакк](./jetrollback-function.md) . Это поведение можно изменить, чтобы удалить это ограничение, задав пользовательский контекст сеанса с помощью [жетсетсессионконтекст](./jetsetsessioncontext-function.md) и [жетресетсессионконтекст](./jetresetsessioncontext-function.md).

Ядро СУБД также поддерживает изменения схемы транзакций. Например, можно начать новую транзакцию, создать таблицу, добавить несколько столбцов, создать индекс или две, а затем прервать транзакцию. Только что добавленные элементы схемы будут удалены из базы данных. Также можно сочетать изменения схемы и обычные обновления базы данных в одной транзакции.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_GRBIT](./jet-grbit.md)  
[JET_SESID](./jet-sesid.md)  
[жеткоммиттрансактион](./jetcommittransaction-function.md)  
[жетжетсистемпараметер](./jetgetsystemparameter-function.md)  
[жетресетсессионконтекст](./jetresetsessioncontext-function.md)  
[жетроллбакк](./jetrollback-function.md)  
[жетсетсессионконтекст](./jetsetsessioncontext-function.md)  
[жетстопсервице](./jetstopservice-function.md)  
[Системные параметры](./extensible-storage-engine-system-parameters.md)
