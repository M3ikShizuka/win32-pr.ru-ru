---
description: Дополнительные сведения о функции Жетреадфиле
title: Функция Жетреадфиле
TOCTitle: JetReadFile Function
ms:assetid: 59dc9e04-7e02-4835-9aed-95cfcf74d780
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269257(v=EXCHG.10)
ms:contentKeyID: 32765559
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetReadFile
topic_type:
- apiref
- kbArticle
api_type:
- DLLExport
- COM
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 57e11f3b5478f18bc7883974c2f598bf24dcb8fe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265530"
---
# <a name="jetreadfile-function"></a>Функция Жетреадфиле


_**Применимо к:** Windows | Windows Server_

## <a name="jetreadfile-function"></a>Функция Жетреадфиле

Функция **жетреадфиле** извлекает содержимое файла, открытого с помощью [жетопенфиле](./jetopenfile-function.md).

```cpp
    JET_ERR JET_API JetReadFile(
      __in          JET_HANDLE hfFile,
      __out         void* pv,
      __in          unsigned long cb,
      __out_opt     unsigned long* pcbActual
    );
```

### <a name="parameters"></a>Параметры

*хффиле*

Описатель файла для чтения.

*PV*

Выходной буфер, который будет принимать данные файла.

*CB*

Максимальный размер выходного буфера в байтах.

*пкбактуал*

Получает фактический объем извлекаемых файловых данных.

### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errBackupAbortByServer</p></td>
<td><p>Не удалось выполнить операцию, так как текущая Внешняя резервная копия была прервана вызовом <a href="gg269240(v=exchg.10).md">жетстопсервице</a>. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Один из указанных параметров содержит непредвиденное значение или содержит значение, которое не имеет смысла при объединении со значением другого параметра. Это может произойти для <strong>жетреадфиле</strong> в следующих случаях:</p>
<ul>
<li><p>Указан недопустимый обработчик экземпляра. Windows XP и более поздние версии.</p></li>
<li><p>Размер выходного буфера не кратен размеру страницы базы данных (<a href="gg269337(v=exchg.10).md">JET_paramDatabasePageSize</a>). Windows XP и более поздние версии.</p></li>
<li><p>Размер выходного буфера меньше трех страниц базы данных (<a href="gg269337(v=exchg.10).md">JET_paramDatabasePageSize</a>), и это первый вызов <strong>жетреадфиле</strong> для указанного маркера. Windows XP и более поздние версии.</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p>JET_errNoBackup</p></td>
<td><p>Не удалось выполнить операцию, так как не выполняется внешняя архивация.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="even">
<td><p>JET_errReadVerifyFailure</p></td>
<td><p>Не удалось выполнить операцию, так как при чтении страницы базы данных из файла базы данных или файла исправления базы данные обнаружено неустранимое повреждение данных.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errLogReadVerifyFailure</p></td>
<td><p>Не удалось выполнить операцию, поскольку при чтении файла журнала транзакций обнаружено неустранимое повреждение данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="even">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRunningInMultiInstanceMode</p></td>
<td><p>Операция завершилась с ошибкой, так как была предпринята попытка использовать модуль в устаревшем режиме (режим совместимости Windows 2000), где только один экземпляр поддерживается, если в действительности несколько экземпляров уже существуют.</p></td>
</tr>
<tr class="even">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
</tbody>
</table>


При успешном выполнении следующий фрагмент данных из файла будет считан в выходной буфер. Также будет возвращено фактическое число полученных байтов. Смещение файла, на котором будет выполняться следующее считывание, будет расширено этим объемом.

В случае сбоя состояние выходного буфера не определено. Сбой приведет к отмене всего процесса резервного копирования для экземпляра. В Windows XP и более поздних версиях резервная копия не будет отменена, если при чтении файла базы данных произошла ошибка. Однако резервная копия этого файла базы данных по-прежнему будет отменена, и соответствующий маркер будет автоматически закрыт.

#### <a name="remarks"></a>Комментарии

Любой вызов **жетреадфиле** с помощью маркера, который уже вернул все данные в базовом файле (например, предыдущий вызов вернул меньше байт, чем размер выходного буфера), всегда будет успешно выполнен, но возвращать нулевые байты данных.

Для повышения производительности резервного копирования следует использовать большой выходной буфер. Для поиска правильного компромисса между потреблением ресурсов и пропускной способностью в данной ситуации может потребоваться некоторое экспериментирование. В любом случае выходной буфер должен иметь размер не меньше 64 КБ.

Несколько одновременных вызовов **жетреадфиле** , использующих один и тот же файловый обработчик, не поддерживаются. Это означает, что невозможно поставить в очередь несколько буферов для чтения одновременно для одного и того же файла, чтобы добиться высокой последовательной пропускной способности. Вместо этого следует использовать один большой буфер.

Если экземпляр настроен таким образом, что включена очистка страниц базы данных (см. раздел JET_paramZeroDatabaseDuringBackup в параметрах системы), удаленные данные будут удалены из базы данных как побочный результат вызова **жетреадфиле** по отношению к файлу базы данных.

Очень важно понимать, как взаимодействуют резервные копии и повреждения данных. Если ядро СУБД обнаружит повреждение данных во время резервного копирования, то произойдет сбой резервного копирования затронутой базы данных или всего экземпляра. Это осознанное решение по проектированию, предназначенное для защиты от потери данных. Если ядро СУБД допускало успешное резервное копирование при наличии повреждений данных, возможно, что в результате может быть отклонено старое, неповрежденное резервное копирование. Это было бы неудачно, так как было бы возможным исправить повреждение данных на динамическом экземпляре, восстановив эту резервную копию и воспроизводящую все файлы журнала транзакций для этой базы данных. В этом сценарии с нулевой потерей данных предполагается, что циклическое ведение журнала не включено (см. [JET_paramCircularLog](./transaction-log-parameters.md) в разделе [системные параметры](./extensible-storage-engine-system-parameters.md)).

Также важно понимать, что в случае повреждения данных потоковая резервная копия будет наиболее вероятным местом, что она сначала будет обнаружена. Это происходит потому, что потоковая Архивация — единственный процесс, который обычно сканирует каждую отдельную страницу файла базы данных. Также вполне вероятно, что потоковая Архивация будет первым процессом для обнаружения ранних нарушений аппаратного сбоя, как при нерегулярном повреждении данных. Это связано с объемом данных, получаемых резервной копией, а также скоростью их получения.

Повреждение данных обнаруживается ядром СУБД с помощью блочных контрольных сумм. Эти контрольные суммы задаются непосредственно перед записью страницы базы данных и проверяются на прочитанной странице базы данных. Эта схема позволяет ядру СУБД определить, что данные повреждены в некоторый момент, но не позволяют ядру СУБД определить источник этого повреждения. Исторически, основная причина такого повреждения была обнаружена из источников, отличных от самого ядра СУБД.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_HANDLE](./jet-handle.md)  
[JET_INSTANCE](./jet-instance.md)  
[жетопенфиле](./jetopenfile-function.md)  
[жетстопсервице](./jetstopservice-function.md)  
[Системные параметры](./extensible-storage-engine-system-parameters.md)
