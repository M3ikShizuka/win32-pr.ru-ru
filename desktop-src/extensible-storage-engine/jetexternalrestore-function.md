---
description: Дополнительные сведения о функции Жетекстерналресторе
title: Функция Жетекстерналресторе
TOCTitle: JetExternalRestore Function
ms:assetid: c930689a-3ea6-4c5a-9318-76f519f23343
ms:mtpsurl: https://msdn.microsoft.com/library/Gg294088(v=EXCHG.10)
ms:contentKeyID: 32765703
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetExternalRestoreA
- JetExternalRestore
- JetExternalRestoreW
topic_type:
- apiref
- kbArticle
api_type:
- COM
- DLLExport
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 087949817ac0bcbe2effe2ff136a6ce80084daa2
ms.sourcegitcommit: 168d11879cb9fd89d26f826482725c0a626be00f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "105704037"
---
# <a name="jetexternalrestore-function"></a>Функция Жетекстерналресторе


_**Применимо к:** Windows | Windows Server_

## <a name="jetexternalrestore-function"></a>Функция Жетекстерналресторе

Функция **жетекстерналресторе** восстанавливает внешнюю резервную копию, созданную с помощью внешних API-интерфейсов резервного копирования, и указывает диапазон номеров файлов журнала для воспроизведения в процессе восстановления. Это называется жесткое восстановление, которое аналогично, но отличается от программного восстановления, выполняемого функцией [жетинит](./jetinit-function.md) .

```cpp
JET_ERR JET_API JetExternalRestore(
  __in          JET_PSTR szCheckpointFilePath,
  __in          JET_PSTR szLogPath,
  __in_opt      JET_RSTMAP* rgrstmap,
  __in          long crstfilemap,
  __in          JET_PSTR szBackupLogPath,
  __in          long genLow,
  __in          long genHigh,
  __in          JET_PFNSTATUS pfn
);
```

### <a name="parameters"></a>Параметры

*сзчеккпоинтфилепас*

Путь к файлу контрольных точек, используемому во время восстановления, если *сзтаржетинстанцечеккпоинтпас* не указан или уже имеет активный или запущенный экземпляр.

*сзлогпас*

Путь или каталог журналов для последнего этапа (отмены) восстановления и, возможно, для журналов наката. Этот путь может быть таким же, как и *сзбаккуплогпас*.

*ргрстмап*

Это массив структур [JET_RSTMAP](./jet-rstmap-structure.md) . Это схема старых и новых путей к базам данных или имен файлов. Это используется, так как базы данных могут быть восстановлены в расположении, отличном от расположения, из которого они были созданы. В случае, когда несколько баз данных присоединены к одному набору журналов, на карте восстановления можно указать подмножество баз данных для восстановления.

*крстфилемап*

Число записей в параметре массива *ргрстмап* .

*сзбаккуплогпас*

Путь к каталогу, в который восстанавливаются файлы журнала. Это журналы, которые были считаны во время внешней последовательности резервного копирования. Этот путь может быть таким же, как и Сзлогпас.

*женлов*

Минимальный номер файла журнала, который будет воспроизводиться из *сзбаккуплогпас*. Необходимо сохранить полную достоверность беззнакового типа Long, но в текущей версии подсистемы это число является шестнадцатеричным числом в диапазоне от 0x00000 до 0xFFFFF. Это может измениться в будущих версиях.

*женхигх*

Максимальный номер файла журнала, который будет воспроизводиться из *сзбаккуплогпас*. Необходимо сохранить полную достоверность беззнакового типа Long, но в текущей версии подсистемы это число является шестнадцатеричным числом в диапазоне от 0x00000 до 0xFFFFF. Это может измениться в будущих версиях.

*PFN*

Обратный вызов состояния, сообщающий о ходе восстановления.

### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errOutOfMemory</p></td>
<td><p>Не удалось выполнить операцию из-за нехватки памяти, выделенной для ее завершения.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Один из указанных параметров содержит непредвиденное значение или содержит значение, которое не имеет смысла при объединении со значением другого параметра. Это может произойти для <strong>жетекстерналресторе</strong>и т. д., если <em>сзтаржетчеккпоинтпас</em> и <em>сзтаржетинстанцелогпас</em> либо не указаны одновременно, либо не указаны одновременно. То есть они должны сопоставляться и быть одновременно указаны, либо не указаны одновременно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errDatabaseCorrupted</p></td>
<td><p>Это указывает, что база данных повреждена или нераспознанный файл.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errFileNotFound</p></td>
<td><p>Не удалось выполнить операцию, так как не удалось открыть запрошенный файл, так как он не найден по указанному пути.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInvalidPath</p></td>
<td><p>Не удалось выполнить операцию, так как не удалось найти указанный путь.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRestoreOfNonBackupDatabase</p></td>
<td><p>Эта ошибка возвращается, если файл базы данных, указанный во время восстановления, не является базой данных, для которой была создана резервная копия с внешней резервной копией.</p></td>
</tr>
<tr class="even">
<td><p>JET_errStartingRestoreLogTooHigh</p></td>
<td><p>Эта ошибка возвращается, если один из файлов журнала в <em>сзбаккуплогпас</em>имеет следующее создание журнала, заданное <em>женлов</em> или <em>плогинфо. улженлов</em>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errEndingRestoreLogTooLow</p></td>
<td><p>Эта ошибка возвращается, если одна из файлов журнала в <em>сзбаккуплогпас</em>имеет более позднюю версию журнала, указанную в <em>женхигх</em> или <em>плогинфо. улженхигх</em>.</p></td>
</tr>
<tr class="even">
<td><p>JET_errBadRestoreTargetInstance</p></td>
<td><p>Указанный <em>сзтаржетинстанцелогпас</em> не принадлежит инициализированному экземпляру. Эта ошибка будет возвращена только в Windows XP и более поздних версиях.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRunningInOneInstanceMode</p></td>
<td><p>Ядру СУБД не удается выполнить внешнее восстановление или принудительное восстановление в режиме одиночного экземпляра. Эта ошибка будет возвращена только в Windows XP и более поздних версиях.</p></td>
</tr>
</tbody>
</table>


При успешном выполнении все базы данных из *ргрстмап* полностью восстанавливаются, а в состоянии чистого или устойчивого состояния. На этом этапе базу данных можно повторно подключить к существующему экземпляру.

В случае сбоя подсистема не смогла восстановить базу данных. База данных находится в недопустимом состоянии, и для повторного восстановления необходимо восстановить всю базу данных. Как правило, источником такой ситуации является повреждение диска или журнала, а также другой вид непостоянного управления журналом или ненепрерывный набор журналов.

#### <a name="remarks"></a>Комментарии

Чтобы понять, как работает «жесткое» восстановление, необходимо понимать, что существует три этапа восстановления, а второй этап может содержать две части. На этапе I журналы необходимы для обеспечения согласованности резервной копии базы данных (или можно использовать начальный набор добавочных журналов). В фазе II для обеспечения соответствия базы данных используются все дополнительные журналы наката. Кроме того, существует также воспроизведение дополнительных журналов наката. Этап III является стадией отката процесса восстановления.

Этап I. Воспроизведение набора журналов, которые необходимо восстановить для базы данных, в целостное состояние (или начальный набор файлов журнала). По сути, это воспроизведение набора файлов журнала, которые не являются необязательными для восстанавливаемых баз данных. Если журналы из этого диапазона журналов отсутствуют, восстановление завершится ошибкой. Эти журналы должны размещаться в каталоге, указанном в параметре *сзбаккуплогпас* .

Этап II. при необходимости могут существовать некоторые наборы файлов журналов, которые направляют файлы журналов, полученные из добавочных или разностных резервных копий, а также из файлов журнала активного экземпляра. В случае файлов журналов из добавочных или разностных резервных копий файлы журнала можно поместить в каталоги, указанные в параметрах *сзбаккуплогпас* или *сзтаржетинстанцелогпас* , где первым является рекомендуемый каталог. Журналы, используемые для этапа наката (этап II), должны поступать из одной серии журналов, воспроизводимых на этапе I, и должны постоянно увеличивать номера журналов без промежутков с этапа, который я записывает. Чтобы обеспечить полную актуальность базы данных с файлами журнала, используемыми в настоящий момент активным экземпляром, необходимо указать параметры *сзтаржетинстанцелогпас* и *сзтаржетинстанцечеккпоинтпас* . Это можно сделать даже в том случае, если к этому набору журналов присоединены другие базы данных.

Этап III. на последнем этапе восстановления выполняется откат всех незафиксированных транзакций, для чего требуется создание новых файлов журнала и обновление файла контрольных точек. Этот этап иногда называют "отменой". Путь к файлу контрольной точки, используемый на этом этапе, — это путь, аналогичный расположению журнала Phase III, то есть если *сзлогпас* используется для этапа III, будет использоваться *Сзчеккпоинтфилепас* , если *сзтаржетинстанцелогпас* используется для фазы III Recovery *сзтаржетинстанцечеккпоинтпас* .

Чтобы понять, как работают пути, используйте следующую диаграмму потока:

![ESE_Documentation_ese1](images/Gg294088.ESE_Documentation_ese1(EXCHG.10).gif "ESE_Documentation_ese1")

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
<tr class="even">
<td><p><strong>Юникод</strong></p></td>
<td><p>Реализуется как <strong>жетекстерналресторев</strong> (Юникод) и <strong>жетекстерналрестореа</strong> (ANSI).</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_PFNSTATUS](./jet-pfnstatus-callback-function.md)  
[JET_RSTMAP](./jet-rstmap-structure.md)  
[JET_LOGINFO](./jet-loginfo-structure.md)  
[жетбегинекстерналбаккуп](./jetbeginexternalbackup-function.md)  
[жетинит](./jetinit-function.md)
