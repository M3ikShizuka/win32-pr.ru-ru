---
description: Дополнительные сведения о функции Жетресторе
title: Функция JetRestore
TOCTitle: JetRestore Function
ms:assetid: cdfb8823-6260-46f2-adfc-77e2512a68fd
ms:mtpsurl: https://msdn.microsoft.com/library/Gg294093(v=EXCHG.10)
ms:contentKeyID: 32765708
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetRestore
- JetRestoreW
- JetRestoreA
topic_type:
- apiref
- kbArticle
api_type:
- DLLExport
- COM
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 5ed164bb6775150f9745cb0e6d9b158a5f03f146
ms.sourcegitcommit: 168d11879cb9fd89d26f826482725c0a626be00f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2021
ms.locfileid: "104000549"
---
# <a name="jetrestore-function"></a>Функция JetRestore


_**Применимо к:** Windows | Windows Server_

## <a name="jetrestore-function"></a>Функция JetRestore

Функция **жетресторе** восстанавливает и восстанавливает потоковую передачу резервной копии экземпляра, включая все подключенные базы данных. Эта функция предназначена в первую очередь для обеспечения обратной совместимости с Windows 2000 и более ранними ядрами СУБД, в которых разрешен только один экземпляр базы данных. В этом случае активный экземпляр — это восстанавливаемый экземпляр. При использовании **жетресторе** расположение восстановленных баз данных указывать нельзя.

```cpp
JET_ERR JET_API JetRestore(
  __in          JET_PCSTR sz,
  __in          JET_PFNSTATUS pfn
);
```

### <a name="parameters"></a>Параметры

*SZ*

Папка, в которой находится резервная копия. Резервная копия должна быть создана с помощью функции [жетбаккуп](./jetbackup-function.md) .

*PFN*

Необязательный указатель на функцию, которая будет вызываться как уведомление о ходе выполнения операции восстановления.

### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errAlreadyInitialized</p></td>
<td><p>Не удалось выполнить операцию, так как модуль уже инициализирован для этого экземпляра.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidLogSequence</p></td>
<td><p>Набор файлов журнала из резервного набора данных и из текущего пути к журналу не совпадают.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Один из указанных параметров содержит непредвиденное значение или содержит значение, которое не имеет смысла при объединении со значением другого параметра.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidPath</p></td>
<td><p>Не удалось выполнить операцию, так как некоторые из указанных путей являются недопустимыми (путь резервной копии, путь назначения, журнал или системный путь для экземпляра).</p></td>
</tr>
<tr class="even">
<td><p>JET_errPageSizeMismatch</p></td>
<td><p>Операция завершилась сбоем, так как модуль настроен на использование размера страницы базы данных (с использованием <a href="gg294044(v=exchg.10).md">жетсетсистемпараметер</a> для <a href="gg269337(v=exchg.10).md">JET_paramDatabasePageSize</a>), который не соответствует размеру страницы базы данных, используемому для создания файлов журнала транзакций, или баз данных, связанных с файлами журнала транзакций.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRunningInMultiInstanceMode</p></td>
<td><p>Операция завершилась с ошибкой, так как параметры явно заданный режим одиночного экземпляра (режим совместимости Windows 2000) и модуль уже находятся в режиме с несколькими экземплярами.</p></td>
</tr>
</tbody>
</table>


В случае успеха файлы базы данных из набора резервных копий будут восстановлены в своем расположении, а восстановление будет выполняться таким, что базы данных будут находиться в состоянии чистой согласованности транзакций. Восстановление приведет к воспроизведению файлов журналов из резервного набора данных и файлов журналов из пути к журналу, если такие файлы существуют. Это восстановление приведет к изменению файла контрольных точек, файлов журнала транзакций и любых баз данных, на которые ссылаются эти файлы журнала транзакций.

При сбое экземпляр остается в неинициализированном состоянии. Состояние файлов журнала транзакций и всех баз данных, на которые ссылаются эти файлы журнала транзакций, скорее всего, будет изменено при попытке инициализации восстановления и восстановления баз данных.

#### <a name="remarks"></a>Комментарии

Процесс восстановления воссоздаст базы данных, присоединенные к экземпляру во время резервного копирования, и сохранит изменения в файлах базы данных. Результатом будут базы данных с одинаковыми транзакциями. По возможности он также сохраняет в базе данных изменения, выполненные с момента создания резервной копии до тех пор, пока в журналах транзакций не найдется Последнее изменение. Это могло быть возможно, если журналы транзакций, созданные с момента создания резервной копии, все еще находятся в каталоге журнала транзакций. Обратите внимание, что если для экземпляра было включено циклическое ведение журнала, то созданные журналы транзакций повторно используются, так что восстановление сможет сохранить изменения, которые были выполнены в момент резервного копирования. В любом случае этот процесс может занять довольно много времени, если количество файлов журнала транзакций, воспроизводимых с базами данных, велико.

Функции **жетресторе** должны вызываться для экземпляра до вызова [жетинит](./jetinit-function.md) для этого экземпляра.

Так как во время восстановления будет использоваться значительное количество страниц базы данных и журналов транзакций, то для этих функций может возвращаться вся последовательность ошибок. Такие ошибки могут воздержаться во временных сбоях выделения ресурсов, таких как Jet_errOutOfMemory к ошибкам, представляющим физические повреждения, такие как JET_errReadVerifyFailure, JET_errLogFileCorrupt или JET_errBadPageLink. Эти ошибки почти всегда вызываются аппаратными проблемами, поэтому их нельзя избежать. Необычное Управление файлами будет самим манифестом JET_errMissingLogFile или JET_errAttachedDatabaseMismatch или JET_errDatabaseSharingViolation или JET_errInvalidLogSequence. Эти ошибки предотвращаются приложением. Приложение должно быть аккуратным, чтобы защитить репозиторий этих файлов от манипуляции извне, такими как пользователь или другие приложения. Если приложение должно полностью уничтожить экземпляр, необходимо удалить все файлы, связанные с этим экземпляром. К ним относятся файл контрольных точек, файлы журнала транзакций и все файлы базы данных, присоединенные к экземпляру.

На различных этапах восстановления будут созданы записи журнала событий, включая ход воспроизведения журнала транзакций и окончательный результат восстановления.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
<tr class="even">
<td><p><strong>Юникод</strong></p></td>
<td><p>Реализуется как <strong>жетресторев</strong> (Юникод) и <strong>жетрестореа</strong> (ANSI).</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_GRBIT](./jet-grbit.md)  
[JET_INSTANCE](./jet-instance.md)  
[жетбаккуп](./jetbackup-function.md)  
[жетбаккупинстанце](./jetbackupinstance-function.md)  
[жеткреатеинстанце](./jetcreateinstance-function.md)  
[жетсетсистемпараметер](./jetsetsystemparameter-function.md)
