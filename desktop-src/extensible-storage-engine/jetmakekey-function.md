---
description: Дополнительные сведения о функции Жетмакекэй
title: Функция JetMakeKey
TOCTitle: JetMakeKey Function
ms:assetid: 8c1cff2f-2f24-4990-a9d8-fb4f822e50b1
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269329(v=EXCHG.10)
ms:contentKeyID: 32765619
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetMakeKey
topic_type:
- apiref
- kbArticle
api_type:
- COM
- DLLExport
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: e3d121ed83f096baad249aab8677bb9f5e72e301
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104272115"
---
# <a name="jetmakekey-function"></a>Функция JetMakeKey


_**Применимо к:** Windows | Windows Server_

## <a name="jetmakekey-function"></a>Функция JetMakeKey

Функция **жетмакекэй** конструирует ключи поиска, которые затем могут использоваться для поиска набора записей в индексе с помощью некоторых простых условий поиска по значениям ключевых столбцов. Ключ поиска является также одним из внутренних свойств курсора и используется операциями [жетсик](./jetseek-function.md) и [жетсетиндексранже](./jetsetindexrange-function.md) для поиска записей индекса, соответствующих этим критериям поиска в текущем индексе курсора. Полный ключ поиска создается в серии вызовов **жетмакекэй** , где каждый вызов используется для загрузки значения столбца для следующего ключевого столбца текущего индекса курсора. Также можно загрузить ранее созданный ключ поиска, полученный из курсора с помощью [жетретриевекэй](./jetretrievekey-function.md).

```cpp
    JET_ERR JET_API JetMakeKey(
      __in          JET_SESID sesid,
      __in          JET_TABLEID tableid,
      __in_opt      const void* pvData,
      __in          unsigned long cbData,
      __in          JET_GRBIT grbit
    );
```

### <a name="parameters"></a>Параметры

*сесид*

Сеанс, используемый для этого вызова.

*TableID*

Курсор, используемый для этого вызова.

*пвдата*

Входной буфер, содержащий данные столбца для текущего ключевого столбца текущего индекса курсора, для которого создается ключ поиска.

Тип данных столбца во входном буфере должен точно совпадать с типом данных и другими свойствами определения столбца текущего ключевого столбца. Для данных столбца не выполняется приведение типов.

Если в параметре *грбит* указано значение JET_bitNormalizedKey, входной буфер должен содержать ранее созданный ключ поиска. Такие ключи получаются с помощью вызова [жетретриевекэй](./jetretrievekey-function.md).

*cbData*

Размер в байтах данных столбца, указанных во входном буфере.

Если в параметре *грбит* указано значение JET_bitNormalizedKey, то это размер ключа поиска, предоставленного во входном буфере.

Если размер данных столбца равен нулю, содержимое входного буфера игнорируется. Если в параметре *грбит* указано значение JET_bitKeyDataZeroLength и текущий ключевой столбец текущего индекса курсора является столбцом переменной длины, то данные входного столбца считаются нулевой длиной. В противном случае данные входного столбца предположительно будут иметь значение NULL.

*грбит*

Группа битов, задающая ноль или более следующих параметров.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Значение</p></th>
<th><p>Значение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_bitFullColumnEndLimit</p></td>
<td><p>Ключ поиска должен быть создан таким образом, чтобы все ключевые столбцы, поступающие после текущего ключевого столбца, считались подстановочными знаками. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для этого ключевого столбца и всех предыдущих ключевых столбцов.</p></li>
<li><p>Все значения столбцов, необходимые для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к концу индекса. Конец индекса — это элемент индекса, найденный при переходе к последней записи в этом индексе. Конец индекса не совпадает с верхним концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Этот параметр доступен только в Windows XP и более поздних версиях.</p></td>
</tr>
<tr class="even">
<td><p>жетбитфуллколумнстартлимит</p></td>
<td><p>Ключ поиска должен быть создан таким, чтобы все ключевые столбцы, поступающие после текущего ключевого столбца, считались подстановочными знаками. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для этого ключевого столбца и всех предыдущих ключевых столбцов.</p></li>
<li><p>Все значения столбцов, необходимые для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к началу индекса. Начало индекса — это элемент индекса, найденный при переходе к первой записи в этом индексе. Начало индекса не совпадает с младшим концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Этот параметр доступен только в Windows XP и более поздних версиях.</p></td>
</tr>
<tr class="odd">
<td><p>JET_bitKeyDataZeroLength</p></td>
<td><p>Если размер входного буфера равен нулю, а текущий ключевой столбец является столбцом переменной длины, этот параметр указывает, что входной буфер содержит значение нулевой длины. В противном случае размер входного буфера, равный нулю, будет означать значение NULL.</p></td>
</tr>
<tr class="even">
<td><p>JET_bitNewKey</p></td>
<td><p>Должен быть создан новый ключ поиска. Любой ранее существующий ключ поиска отклоняется.</p></td>
</tr>
<tr class="odd">
<td><p>JET_bitNormalizedKey</p></td>
<td><p>Если указан этот параметр, все остальные параметры игнорируются, любой ранее существующий ключ поиска отбрасывается, а содержимое входного буфера загружается в качестве нового ключа поиска.</p></td>
</tr>
<tr class="even">
<td><p>JET_bitPartialColumnEndLimit</p></td>
<td><p>Ключ поиска должен быть создан таким, что текущий ключевой столбец считается подстановочным знаком, а все ключевые столбцы, поступающие после текущего ключевого столбца, должны рассматриваться как подстановочные знаки. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для этого ключевого столбца и всех предыдущих ключевых столбцов.</p></li>
<li><p>Все значения столбцов, необходимые для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к концу индекса. Конец индекса — это элемент индекса, найденный при переходе к последней записи в этом индексе. Конец индекса не совпадает с верхним концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Этот параметр нельзя использовать, если текущий ключевой столбец не является текстовым столбцом или переменным двоичным столбцом. Операция завершится ошибкой с JET_errInvalidgrbit при попытке.</p>
<p>Этот параметр доступен только в Windows XP и более поздних версиях.</p></td>
</tr>
<tr class="odd">
<td><p>JET_bitPartialColumnStartLimit</p></td>
<td><p>Этот параметр указывает, что ключ поиска должен быть создан таким, что текущий ключевой столбец считается подстановочным знаком, а все ключевые столбцы, поступающие после текущего ключевого столбца, должны считаться подстановочными знаками. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для этого ключевого столбца и всех предыдущих ключевых столбцов.</p></li>
<li><p>Все значения столбцов, необходимые для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к началу индекса. Начало индекса — это элемент индекса, найденный при переходе к первой записи в этом индексе. Начало индекса не совпадает с младшим концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Этот параметр нельзя использовать, если текущий ключевой столбец не является текстовым столбцом или переменным двоичным столбцом. Операция завершится ошибкой с JET_errInvalidgrbit при попытке.</p>
<p>Этот параметр доступен только в Windows XP и более поздних версиях.</p></td>
</tr>
<tr class="even">
<td><p>JET_bitStrLimit</p></td>
<td><p>Этот параметр указывает, что ключ поиска должен быть создан таким, чтобы все ключевые столбцы, поступающие после текущего ключевого столбца, считались подстановочными знаками. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для этого ключевого столбца и всех предыдущих ключевых столбцов.</p></li>
<li><p>Все значения столбцов, необходимые для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к концу индекса. Конец индекса — это элемент индекса, найденный при переходе к последней записи в этом индексе. Конец индекса не совпадает с верхним концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Если этот параметр указан в сочетании с JET_bitSubStrLimit а текущий ключевой столбец является текстовым столбцом, этот параметр будет проигнорирован. Это поведение предназначено для того, чтобы разрешить выводимый тип текущего ключевого столбца при построении ключа поиска.</p>
<p>Если вы хотите создать аналогичный поисковый ключ для начала индекса, для последнего ключевого столбца, который не является подстановочным знаком, необходимо выполнить аналогичный вызов <strong>жетмакекэй</strong> , но без указания подстановочных знаков. Затем ключ поиска находится в соответствующем состоянии, чтобы использовать его для такого поиска. Это аналогично использованию JET_bitFullColumnStartLimit, за исключением того, что поисковый ключ не завершается четко, как после использования параметра подстановочного знака.</p>
<p>Этот параметр является устаревшим для Windows XP и более поздних версий, чтобы устранить эту неудобную семантику. По возможности вместо них следует использовать JET_bitFullColumnStartLimit и JET_bitFullColumnEndLimit.</p></td>
</tr>
<tr class="odd">
<td><p>JET_bitSubStrLimit</p></td>
<td><p>Этот параметр указывает, что ключ поиска должен быть создан таким, что текущий ключевой столбец считается подстановочным знаком, а все ключевые столбцы, поступающие после текущего ключевого столбца, должны считаться подстановочными знаками. Это означает, что созданный ключ поиска можно использовать для сопоставления записей индекса, имеющих следующее:</p>
<ul>
<li><p>Точные значения столбцов, предоставленные для всех предыдущих ключевых столбцов.</p></li>
<li><p>Указанные данные столбца в качестве префикса значения столбца для текущего ключевого столбца.</p></li>
<li><p>Все значения столбцов для последующих ключевых столбцов.</p></li>
</ul>
<p>Этот параметр следует использовать при создании ключей поиска с подстановочными знаками, которые будут использоваться для поиска записей индекса, ближайших к концу индекса. Конец индекса — это элемент индекса, найденный при переходе к последней записи в этом индексе. Конец индекса не совпадает с верхним концом индекса, который может изменяться в зависимости от порядка сортировки ключевых столбцов в индексе.</p>
<p>Если этот параметр указан в сочетании с JET_bitStrLimit, а текущий ключевой столбец является текстовым столбцом, то этот параметр имеет приоритет. Этот параметр игнорируется, если текущий ключевой столбец не является текстовым столбцом. Это поведение предназначено для того, чтобы разрешить выводимый тип текущего ключевого столбца при построении ключа поиска.</p>
<p>Если вы хотите создать аналогичный поисковый ключ для начала индекса, для ключевого столбца необходимо выполнить аналогичный вызов <strong>жетмакекэй</strong> , который должен быть подстановочным знаком, но с параметром подстановочных знаков не указано. Затем ключ поиска находится в соответствующем состоянии, чтобы использовать его для такого поиска. Это аналогично использованию JET_bitPartialColumnStartLimit, за исключением того, что поисковый ключ не завершается четко, как после использования параметра подстановочного знака.</p>
<p>Этот параметр является устаревшим для Windows XP и более поздних версий, чтобы устранить эту неудобную семантику. Вместо этого по возможности следует использовать JET_bitPartialColumnStartLimit и JET_bitPartialColumnEndLimit.</p></td>
</tr>
</tbody>
</table>


### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errIndexTuplesKeyTooSmall</p></td>
<td><p>Указанные данные столбца слишком малы для создания допустимого ключа для текущего индекса, так как этот индекс является индексом кортежа, а минимальный размер кортежа больше, чем предоставленные данные столбца. Дополнительные сведения о индексах кортежей см. в разделе <a href="gg294099(v=exchg.10).md">жеткреатеиндекс</a> . Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidBufferSize</p></td>
<td><p>Предоставленные данные столбца не соответствуют размеру, требуемому для определения столбца. Это может произойти, если тип данных столбца является внутренним определенным размером. Это также может произойти, если тип данных столбца не является каким-либо определенным размером, но определение столбца объявляет его фиксированной длиной. Единственным исключением является то, что эта ошибка не возникает, если для столбца с фиксированной длиной текста указано слишком мало данных, так как любые отсутствующие данные будут автоматически дополнены пробелами. Вторым исключением является то, что эта ошибка не возникает, если для двоичного столбца фиксированной длины задано слишком мало данных, так как любые отсутствующие данные будут автоматически заполнены нулями.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInvalidgrbit</p></td>
<td><p>Один из запрошенных параметров недопустим, используется недопустимым образом или не реализован. Это может произойти для <strong>жетмакекэй</strong> в следующих случаях:</p>
<ul>
<li><p>Указаны JET_bitPartialColumnStartLimit или JET_bitPartialColumnEndLimit, а соответствующий ключевой столбец не является текстовым столбцом и не является двоичным столбцом переменной длины. Этот вариант происходит только в Windows XP и более поздних версиях.</p></li>
<li><p>Предпринята попытка использовать несколько следующих параметров вместе: JET_bitPartialColumnStartLimit, JET_bitPartialColumnEndLimit, JET_bitFullColumnStartLimit и JET_bitFullColumnEndLimit. Этот вариант происходит только в Windows XP и более поздних версиях.</p></li>
<li><p>Предпринята попытка использовать JET_bitStrLimit или JET_bitSubStrLimit при использовании одного из следующих параметров: JET_bitPartialColumnStartLimit, JET_bitPartialColumnEndLimit, JET_bitFullColumnStartLimit и JET_bitFullColumnEndLimit. Этот вариант происходит только в Windows XP и более поздних версиях.</p></li>
</ul></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Один из указанных параметров содержит непредвиденное значение или содержит значение, которое не имеет смысла при объединении со значением другого параметра.</p>
<p>Это может произойти для <strong>жетмакекэй</strong> , когда было указано JET_bitNormalizedKey и значение, указанное во входном буфере, слишком велико, чтобы быть допустимым ключом поиска.</p></td>
</tr>
<tr class="even">
<td><p>JET_errKeyIsMade</p></td>
<td><p>Данные столбца, предоставленные в <strong>жетмакекэй</strong> , были отклонены, так как данные столбца уже были предоставлены для всех ключевых столбцов в текущем индексе. Это может произойти тремя способами. Первый способ — если данные столбца предоставляются для каждого ключевого столбца в текущем индексе. Второй способ — если данные столбца были предоставлены по крайней мере для одного ключевого столбца и для последнего вызова был выбран параметр с подстановочным знаком. Третий способ — если ранее созданный ключ поиска был предоставлен с помощью JET_bitNormalizedKey, охватывающего все ключевые столбцы.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errKeyNotMade</p></td>
<td><p>Для курсора отсутствует текущий ключ поиска. Это произойдет для <strong>жетмакекэй</strong> , если не указан параметр JET_bitNewKey и для этого курсора не был создан ключ поиска, используя перед ним вызов <strong>жетмакекэй</strong>. Ключ поиска будет удален при предыдущем вызове любого API навигации в курсоре, отличном от <a href="gg294117(v=exchg.10).md">жетмове</a>.</p></td>
</tr>
<tr class="even">
<td><p>JET_errNoCurrentIndex</p></td>
<td><p>Для курсора отсутствует текущий индекс. Это произойдет для <strong>жетмакекэй</strong> , если курсор находится на кластеризованном индексе таблицы, первичный индекс не был определен и JET_bitNormalizedKey не был указан. Невозможно создать ключ поиска, если курсор находится на индексе, который не имеет ключевых столбцов, если не предоставлен ранее созданный ключ поиска.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="even">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errSessionSharingViolation</p></td>
<td><p>Один и тот же сеанс нельзя использовать одновременно для нескольких потоков. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="even">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
</tbody>
</table>


При успешном выполнении, если не указаны JET_bitNormalizedKey и JET_bitNewKey, ключ поиска будет построен в соответствии с критериями поиска для одного и того же ключевого столбца в текущем индексе. Если параметр JET_bitNormalizedKey не был указан и JET_bitNewKey был указан, то любой ранее существующий ключ поиска был отклонен, а новый ключ будет создан в соответствии с критериями поиска для первого ключевого столбца в текущем индексе. Если указан JET_bitNormalizedKey, то любой ранее существующий ключ поиска был отклонен, а новый был загружен из входного буфера. В любом случае изменение состояния базы данных не выполняется.

В случае сбоя, если был указан JET_bitNormalizedKey или JET_bitNewKey, состояние ключа поиска не определено. Если не указаны ни JET_bitNormalizedKey, ни JET_bitNewKey, то не произойдет никаких изменений в состоянии поискового ключа. В любом случае изменение состояния базы данных не выполняется.

#### <a name="remarks"></a>Комментарии

Ключи следует рассматривать как непрозрачные фрагменты данных. Для использования внутренней структуры этих данных не нужно предпринимать никаких попыток. Тем не менее, известны следующие сведения обо всех ключах ESENT:

  - Ключи можно сравнить друг с другом с помощью [memcmp](/previous-versions/visualstudio/visual-studio-6.0/aa246467(v=vs.60)) , чтобы установить их относительное упорядочение в исходном индексе по таблице записей исходного индекса.

  - Нет смысла сравнивать ключи индексов из разных индексов друг с другом.

  - Длина ключа всегда меньше или равна JET_cbKeyMost (255) байт до Windows Vista. В Windows Vista и более поздних выпусках ключи могут быть больше. Максимальный размер ключа равен текущему значению JET_paramKeyMost.

При использовании подстановочных знаков в ключах поиска может быть больше одного байта. В этом случае ключ поиска будет JET_cbLimitKeyMost (256) байт для выпусков до Windows Vista, а JET_paramKeyMost + 1 байт для Windows Vista и более поздних выпусков.

Существует очень важное влияние на этот максимальный размер ключа. Всякий раз, когда имеется запись индекса, имеющая достаточно большой размер для создания ключа для этого индекса, который в противном случае был бы больше этого максимального размера, этот ключ автоматически усекается по этому максимальному размеру. Это приводит к двум последствиям:

  - Для записей в уникальном индексе это приведет к тому, что записи, которые в противном случае были бы уникальными, будут объявлены как повторяющиеся.

  - Для записей во всех индексах усечение ключа приведет к тому, что элементы индекса, которые в противном случае не будут соответствовать критериям поиска данного ключа поиска, будут объявлены как совпадения.

Приложения должны предвидеть это усечение и либо избегать, либо компенсировать его влияние. В Windows Vista добавлен новый флаг индекса, JET_bitIndexDisallowTruncation, чтобы упростить для приложений предотвращение усечения ключей. Дополнительные сведения об этом параметре индексирования см. в разделе Структура [JET_INDEXCREATE](./jet-indexcreate-structure.md) .

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_GRBIT](./jet-grbit.md)  
[JET_SESID](./jet-sesid.md)  
[JET_TABLEID](./jet-tableid.md)  
[жеткреатеиндекс](./jetcreateindex-function.md)  
[жетретриевекэй](./jetretrievekey-function.md)  
[жетсик](./jetseek-function.md)  
[жетсетиндексранже](./jetsetindexrange-function.md)
