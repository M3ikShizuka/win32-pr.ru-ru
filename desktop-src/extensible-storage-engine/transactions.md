---
description: 'Дополнительные сведения: транзакции (события Windows)'
title: Транзакции (события Windows)
TOCTitle: Transactions
ms:assetid: 1ceb362c-1efe-439b-b10a-016c8a54f27b
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269197(v=EXCHG.10)
ms:contentKeyID: 32765500
ms.date: 04/11/2016
ms.topic: article
ms.openlocfilehash: 90b5b566f5ff961ce7b0ae3725f580e1f39c041d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104346955"
---
# <a name="transactions-windows-events"></a>Транзакции (события Windows)


_**Применимо к:** Windows | Windows Server_

## <a name="transactions"></a>Transactions

Транзакции ESE — это логические единицы обработки, которые управляют тем, как приложение видит и манипулирует строками в базе данных. Приложение может использовать точки сохранения транзакций, чтобы определить, следует ли сохранить или отменить определенный набор изменений в базе данных. Все транзакции в ESE являются атомарными, последовательными, изолированными и устойчивыми (ACID), как описано ниже.

  - **Атомарная:** Все обновления в транзакции появятся в базе данных или отбрасываются.

<!-- end list -->

  - **Соответствует:** База данных всегда будет начинаться в допустимом состоянии и всегда будет находиться в другом допустимом состоянии. Для приложений ESE ядро СУБД будет управлять некоторыми простыми ограничениями, например уникальностью уникального индекса, но само приложение будет определять почти все остальные аспекты того, что означает, что база данных будет находиться в допустимом состоянии.

<!-- end list -->

  - **Изоляция:** Транзакции изолированы от обновлений в других сеансах. Транзакция не будет видеть частичный набор изменений, сделанных другой транзакцией.

<!-- end list -->

  - **Устойчивое:** После того как ядро СУБД подтверждает, что транзакция зафиксирована, ее изменения сохраняются в базе данных. Устойчивость транзакции может быть необязательно отменено по соображениям производительности.

Транзакции выполняются в пределах границ вызовов [жетбегинтрансактион](./jetbegintransaction-function.md) и [жеткоммиттрансактион](./jetcommittransaction-function.md) или [жетроллбакк](./jetrollback-function.md). Когда приложение входит в транзакцию, база данных будет зафиксирована в экземпляре во время начала транзакции. Это называется изоляцией моментального снимка. Если транзакция завершается вызовом [жетроллбакк](./jetrollback-function.md), ни одна из операций, выполняемых в транзакции, не фиксируется в базе данных. Если процесс или компьютер завершается сбоем до вызова [жеткоммиттрансактион](./jetcommittransaction-function.md) , то это то же самое, что и вызов [жетроллбакк](./jetrollback-function.md).

В этой процедуре показано, как запустить и зафиксировать транзакцию, которая считывает и обновляет данные в базе данных.

### <a name="to-start-and-commit-a-transaction"></a>Запуск и фиксация транзакции

1.  Вызовите [жетбегинтрансактион](./jetbegintransaction-function.md) или [JetBeginTransaction2](./jetbegintransaction2-function.md) с идентификатором сеанса, чтобы начать транзакцию.

2.  Переместите курсор к нужной записи, вызвав [жетмове](./jetmove-function.md) с JET_MoveFirst, указанным в параметре *CRowset* . Дополнительные сведения о том, как переместить курсор, см. в статье [индексирование в разделе таблицы](./indexing-in-the-table.md) .

3.  Вызовите [жетжеттаблеколумнинфо](./jetgettablecolumninfo-function.md) для текущей записи с JET_ColInfo, указанным в параметре *инфолевел* , чтобы получить идентификатор столбца для столбца. Идентификатор столбца возвращается в структуре [JET_COLUMNDEF](./jet-columndef-structure.md) .

4.  Вызовите [жетсетколумн](./jetsetcolumn-function.md) с идентификатором сеанса, идентификатором таблицы и идентификатором столбца обновляемого столбца. Данные столбца содержатся в параметре *пвдата* .

5.  Вызовите [жеткоммиттрансактион](./jetcommittransaction-function.md) , чтобы зафиксировать транзакцию в базе данных.

Способ, с помощью которого ядро базы данных ESE реализует изоляцию моментальных снимков, имеет некоторые важные отличия от традиционных моделей реляционной базы данных и блокировки. Когда транзакция считывает строку, она всегда может получить доступ к строке без ошибок или ожидать, пока другие сеансы не выпускают блокировку. Когда транзакция пытается обновить строку, она будет выполнена, если это первый сеанс для обновления этой строки, то есть первый модуль записи WINS. Если сеанс не является первым средством записи, он немедленно завершится ошибкой с конфликтом записи. Затем сеансу необходимо прервать транзакцию, подождать (обычно через произвольную задержку), чтобы другая транзакция зафиксировала свои изменения, а затем повторить транзакцию. Ядро СУБД не будет автоматически ожидать, пока другая транзакция не завершит свое обновление. Как правило, транзакция проверяется, чтобы обновить строку внутри вызова [жетупдате](./jetupdate-function.md) . Если не удается заблокировать строку для обновления, [жетупдате](./jetupdate-function.md) завершится с JET_errWriteConflict.

Сеансы ограничены одним потоком с момента запуска транзакции до конца транзакции. Рекомендуется, чтобы все операции Update и извлечения выполнялись в транзакции. ESE также поддерживает изменения схемы, такие как создание таблиц и добавление столбцов в транзакцию. Обновления и изменения схемы могут выполняться в одной транзакции. После завершения транзакции с [жеткоммиттрансактион](./jetcommittransaction-function.md)обновление заносится в файл журнала транзакций. Эти файлы можно использовать для поддержания логически стабильного состояния в случае непредвиденного завершения процесса или завершения работы системы.

Транзакции могут быть вложены до 7 уровней с соответствующими вызовами [жетбегинтрансактион](./jetbegintransaction-function.md) , [жеткоммиттрансактион](./jetcommittransaction-function.md) или [жетроллбакк](./jetrollback-function.md) , вложенными друг в друга. Это позволяет приложению откатить часть транзакции без необходимости отката всей транзакции. Вложенный вызов [жеткоммиттрансактион](./jetcommittransaction-function.md) означает, что этот уровень обработки завершен; Однако транзакция не фиксируется в базе данных, пока не будет вызвана операция внешнего вызова для фиксации транзакции с [жеткоммиттрансактион](./jetcommittransaction-function.md).

Столбцы депонированного обновления могут обновляться одновременно несколькими сеансами без сбоя при Jet_errWriteConflict. Функцию [жетескровупдате](./jetescrowupdate-function.md) можно вызывать только для депонированных столбцов, столбцов, созданных с помощью Jet_bitColumnEscrowUpdate.
