---
description: Дополнительные сведения о функции Жетпрепареупдате
title: Функция Жетпрепареупдате
TOCTitle: JetPrepareUpdate Function
ms:assetid: 90cbaa83-47f2-4a65-b561-3bdecb7fd95a
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269339(v=EXCHG.10)
ms:contentKeyID: 32765628
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetPrepareUpdate
topic_type:
- kbArticle
- apiref
api_type:
- DLLExport
- COM
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 16362463194d945d7b451f784bc0942bda2d03e1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105647711"
---
# <a name="jetprepareupdate-function"></a>Функция Жетпрепареупдате


_**Применимо к:** Windows | Windows Server_

## <a name="jetprepareupdate-function"></a>Функция Жетпрепареупдате

Функция **жетпрепареупдате** является первой операцией при выполнении обновления для вставки новой записи или замены существующей записи новыми значениями. Обновления выполняются путем вызова **жетпрепареупдате**, вызова [жетсетколумн](./jetsetcolumn-function.md) или [жетсетколумнс](./jetsetcolumns-function.md) ноль или более раз и, наконец, путем вызова [жетупдате](./jetupdate-function.md) для завершения операции. **Жетпрепареупдате** и [жетупдате](./jetupdate-function.md) устанавливают границы для операции обновления и важны только для последнего состояния обновления записи, указанной в индексах. Это более эффективно, но также требуется в случаях, когда данные должны соответствовать допустимому состоянию с использованием более чем в операции с набором столбцов.

Существует несколько различных вариантов вставки или замены записей, и они более подробно описаны ниже.

```cpp
    JET_ERR JET_API JetPrepareUpdate(
      __in          JET_SESID sesid,
      __in          JET_TABLEID tableid,
      __in          unsigned long prep
    );
```

### <a name="parameters"></a>Параметры

*сесид*

Сеанс, используемый для этого вызова.

*TableID*

Курсор, используемый для этого вызова.

*подготовить*

Параметры, которые можно использовать для подготовки к обновлению, в том числе следующие.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Значение</p></th>
<th><p>Значение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_prepCancel</p></td>
<td><p>Этот флаг приводит к тому, что <strong>жетпрепареупдате</strong> отменяет обновление для данного курсора.</p></td>
</tr>
<tr class="even">
<td><p>JET_prepInsert</p></td>
<td><p>Этот флаг заставляет курсор подготовиться к вставке новой записи. Все данные инициализируются в состояние по умолчанию для записи. Если в таблице есть столбец с автоматическим приращением, то эта запись назначается новому значению независимо от того, завершилось ли обновление в конечном итоге успешно, завершается сбоем или отменяется.</p></td>
</tr>
<tr class="odd">
<td><p>JET_prepInsertCopy</p></td>
<td><p>Этот флаг заставляет курсор подготовиться к вставке копии существующей записи. При использовании этого параметра должна существовать текущая запись. Начальное состояние новой записи копируется из текущей записи. Длинные значения, хранящиеся за пределами записи, практически копируются.</p></td>
</tr>
<tr class="even">
<td><p>JET_prepInsertCopyDeleteOriginal</p></td>
<td><p>Этот флаг заставляет курсор подготовиться к вставке той же записи, а также к удалению или исходной записи. Он используется в случаях, когда первичный ключ изменился.</p></td>
</tr>
<tr class="odd">
<td><p>JET_prepReplace</p></td>
<td><p>Этот флаг заставляет курсор подготовиться к замене текущей записи. Если таблица имеет столбец Version, то для столбца Version устанавливается следующее значение в последовательности. Если это обновление не завершено, то значение версии в записи не изменится. Для записи была снята блокировка обновления, чтобы другие сеансы не обновляли эту запись до завершения этого сеанса.</p></td>
</tr>
<tr class="even">
<td><p>JET_prepReplaceNoLock</p></td>
<td><p>Этот флаг аналогичен JET_prepReplace, но блокировка не предпринимается, чтобы другие сеансы не обновляли эту запись. Вместо этого этот сеанс может получить JET_errWriteConflict при вызове <a href="gg269288(v=exchg.10).md">жетупдате</a> для завершения обновления.</p></td>
</tr>
</tbody>
</table>


### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errAlreadyPrepared</p></td>
<td><p><strong>Жетпрепареупдате</strong> был вызван с допустимым флагом для подготовки, но не JET_prepCancel, а курсор уже находится в состоянии готовности.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInvalidParameter</p></td>
<td><p>Данный флаг подготовки не является допустимым флагом.</p></td>
</tr>
<tr class="even">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errNotInTransaction</p></td>
<td><p><strong>Жетпрепареупдате</strong> был вызван для замены записи, которая содержит столбцы SLV. Столбцы SLV. Обратите внимание, что столбцы SLV являются функцией, не предназначенной для общего использования. Эта функция используется для поддержки инфраструктуры Microsoft Exchange и не предназначена для использования в приложении.</p></td>
</tr>
<tr class="even">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRollbackError</p></td>
<td><p><strong>Жетпрепареупдате</strong> был вызван с JET_prepCancel, но не смог откатить все изменения, внесенные в столбцы типа JET_coltypLongText и/или столбцов типа JET_coltypLongBinary.</p></td>
</tr>
<tr class="even">
<td><p>JET_errSessionSharingViolation</p></td>
<td><p>Этот флаг нельзя использовать одновременно с одним сеансом из нескольких потоков. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
<tr class="even">
<td><p>JET_errUpdateNotPrepared</p></td>
<td><p><strong>Жетпрепареупдате</strong> был вызван с JET_prepCancel, но курсор не был в подготовленном состоянии.</p></td>
</tr>
</tbody>
</table>


При успешном завершении курсор меняется на подготовленное состояние для требуемого обновления или в случае JET_prepCancel курсор возвращается к неподготовленному состоянию, а все изменения отбрасываются.

В случае сбоя состояние курсора остается неизменным. Если сбой был JET_errRollbackError то состояние курсора меняется на неподготовленное, но не все изменения были отменены.

#### <a name="remarks"></a>Комментарии

Вставка копии записи является важной оптимизацией, когда записи совместно используют данные типа JET_coltypLongText и (или) JET_coltypLongBinary. Эти данные хранятся вне записи, когда она велика, и существует вероятность того, что несколько записей могут совместно использовать одно и то же физическое представление данных. В этом случае данные могут быть обновлены из любой записи, но это приведет к тому, что данные будут находиться в таком виде, что каждая запись будет иметь собственную копию. Невозможно изменить данные в одной записи с помощью изменения из другой записи. Кроме того, невозможно заблокировать обновление одной записи с помощью обновления другой записи. Это центральная функция ESE и известна как блокировка на уровне записи.

Операции [жетупдате](./jetupdate-function.md) , которые не удается оставить курсор в состоянии "подготовлено к обновлению". Это позволяет исправить некоторые ошибки, например неправильное значение столбца, не требуя повторного создания состояния обновления. Это означает, что во всех случаях, когда курсор отменяет обновление, он должен явным образом вызвать **жетпрепареупдате** с JET_prepCancel.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_SESID](./jet-sesid.md)  
[JET_TABLEID](./jet-tableid.md)  
[жетретриевеколумн](./jetretrievecolumn-function.md)  
[жетсетколумн](./jetsetcolumn-function.md)  
[жетупдате](./jetupdate-function.md)
