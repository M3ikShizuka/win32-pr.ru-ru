---
description: Дополнительные сведения о функции Жетретриевекэй
title: Функция JetRetrieveKey
TOCTitle: JetRetrieveKey Function
ms:assetid: a96d0a7c-f1db-48bc-807d-4e6357aec726
ms:mtpsurl: https://msdn.microsoft.com/library/Gg294051(v=EXCHG.10)
ms:contentKeyID: 32765650
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetRetrieveKey
topic_type:
- apiref
- kbArticle
api_type:
- DLLExport
- COM
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: 8e560d28447b7e5d3798949f47dcadf259e49d60
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104081471"
---
# <a name="jetretrievekey-function"></a>Функция JetRetrieveKey


_**Применимо к:** Windows | Windows Server_

## <a name="jetretrievekey-function"></a>Функция JetRetrieveKey

Функция **жетретриевекэй** извлекает ключ для записи индекса в текущем положении курсора. Такие ключи создаются с помощью вызовов [жетмакекэй](./jetmakekey-function.md). Полученный ключ можно использовать для эффективного возврата курсора к той же записи индекса с помощью вызова [жетсик](./jetseek-function.md).

```cpp
    JET_ERR JET_API JetRetrieveKey(
      __in          JET_SESID sesid,
      __in          JET_TABLEID tableid,
      __out_opt     void* pvData,
      __in          unsigned long cbMax,
      __out_opt     unsigned long* pcbActual,
      __in          JET_GRBIT grbit
    );
```

### <a name="parameters"></a>Параметры

*сесид*

Сеанс, используемый для этого вызова.

*TableID*

Курсор, используемый для этого вызова.

*пвдата*

Выходной буфер, который получит ключ.

*кбмакс*

Максимальный размер выходного буфера в байтах.

*пкбактуал*

Получает фактический размер ключа в байтах.

Если этот параметр имеет значение NULL, фактический размер ключа не будет возвращен.

Если выходной буфер слишком мал, то фактический размер ключа все равно будет возвращен. Это означает, что это число будет больше, чем размер выходного буфера.

*грбит*

Группа битов, содержащая параметры, которые должны использоваться для этого вызова, включая ноль или более следующих значений.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Значение</p></th>
<th><p>Значение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_bitRetrieveCopy</p></td>
<td><p>Если этот параметр указан, обработчик вернет ключ поиска курсора. Ключ поиска создается с использованием одного или нескольких предыдущих вызовов <a href="gg269329(v=exchg.10).md">жетмакекэй</a> для поиска в этом ключе с помощью <a href="gg294103(v=exchg.10).md">жетсик</a> или задания диапазона индекса с помощью <a href="gg294112(v=exchg.10).md">жетсетиндексранже</a>.</p></td>
</tr>
</tbody>
</table>


### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="even">
<td><p>JET_errKeyNotMade</p></td>
<td><p>Для курсора отсутствует текущий ключ поиска. Это произойдет для <strong>жетретриевекэй</strong> , если указан параметр JET_bitRetrieveCopy и для этого курсора не был создан ключ поиска, используя перед ним вызов <a href="gg269329(v=exchg.10).md">жетмакекэй</a>. Ключ поиска будет удален при предыдущем вызове любого API навигации в курсоре, отличном от <a href="gg294117(v=exchg.10).md">жетмове</a>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errNoCurrentRecord</p></td>
<td><p>Курсор не располагается на записи. Это может произойти по различным причинам. Например, это произойдет, если курсор находится в данный момент после последней записи в текущем индексе.</p></td>
</tr>
<tr class="even">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="even">
<td><p>JET_errSessionSharingViolation</p></td>
<td><p>Один и тот же сеанс нельзя использовать одновременно для нескольких потоков. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
<tr class="even">
<td><p>JET_wrnBufferTruncated</p></td>
<td><p>Операция успешно завершена, но выходной буфер слишком мал для получения всего ключа. Выходной буфер заполнен объемом ключа, который будет соответствовать. При запросе также возвращается фактический размер ключа.</p>
<p><strong>Примечание</strong>   .   Эта ошибка не будет возвращена, если указано JET_bitRetrieveCopy. Дополнительные сведения см. в разделе "Примечания".</p></td>
</tr>
</tbody>
</table>


При успешном выполнении ключ для записи индекса в текущей позиции курсора будет возвращен в выходной буфер. Если возвращается значение JET_wrnBufferTruncated, выходной буфер будет содержать столько ключей, сколько будет помещаться в предоставленное пространство, а фактический размер ключа будет неточным. Изменение состояния базы данных не выполняется.

В случае сбоя состояние выходного буфера и фактический размер ключа будут неопределенными. Изменение состояния базы данных не выполняется.

#### <a name="remarks"></a>Комментарии

Обычно ключи обрабатываются как непрозрачные фрагменты данных. Для использования внутренней структуры этих данных не нужно предпринимать никаких попыток. Однако следующие свойства могут быть известны всем ключам ESENT:

  - Ключи можно сравнить друг с другом с помощью функции [memcmp](https://msdn.microsoft.com/library/aa246467\(vs.60\).aspx) , чтобы установить их относительное упорядочение в исходном индексе по таблице записей исходного индекса.

  - Нет смысла сравнивать ключи индексов из разных индексов друг с другом.

  - Длина ключа всегда меньше или равна JET_cbKeyMost (255) байт до Windows Vista. В Windows Vista и более поздних выпусках ключи могут быть больше. Максимальный размер ключа равен текущему значению JET_paramKeyMost.

Помимо указанных выше свойств ключей ESENT в целом, важно отметить, что ключ поиска отличается от ключа для записи индекса. В частности, ключ поиска может быть длиннее, чем обычный ключ. Эта лишние длина возникает, когда при построении ключа поиска используется подстановочный знак. Дополнительные сведения см. в разделе [жетмакекэй](./jetmakekey-function.md) .

В этом API есть важная ошибка, которая присутствует во всех выпусках. Если поисковый ключ запрашивается с помощью JET_bitRetrieveCopy и выходной буфер слишком мал для получения всего ключа, то JET_wrnBufferTruncated не будет возвращен. Вместо этого будет возвращено JET_errSuccess. Важно убедиться, что фактический размер ключа, возвращаемый с помощью *пкбактуал* , меньше или равен размеру выходного буфера. Если фактический размер превышает размер выходного буфера, вызывающий объект **жетретриевекэй** должен реагировать так, как будто вместо этого возвращались JET_wrnBufferTruncated.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_ERR](./jet-err.md)  
[JET_GRBIT](./jet-grbit.md)  
[JET_SESID](./jet-sesid.md)  
[JET_TABLEID](./jet-tableid.md)  
[жетмакекэй](./jetmakekey-function.md)  
[жетсик](./jetseek-function.md)  
[жетсетиндексранже](./jetsetindexrange-function.md)
