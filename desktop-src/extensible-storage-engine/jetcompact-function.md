---
description: Дополнительные сведения о функции Жеткомпакт
title: Функция Жеткомпакт
TOCTitle: JetCompact Function
ms:assetid: 6944bd61-893d-4269-869b-56590e22580a
ms:mtpsurl: https://msdn.microsoft.com/library/Gg269284(v=EXCHG.10)
ms:contentKeyID: 32765576
ms.date: 04/11/2016
ms.topic: reference
api_name:
- JetCompactW
- JetCompactA
- JetCompact
topic_type:
- apiref
- kbArticle
api_type:
- COM
- DLLExport
api_location:
- ESENT.DLL
ROBOTS: INDEX,FOLLOW
ms.openlocfilehash: ebac7fe4f09a6c4456b5370af03ea24f2334cff6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105712074"
---
# <a name="jetcompact-function"></a>Функция Жеткомпакт


_**Применимо к:** Windows | Windows Server_

## <a name="jetcompact-function"></a>Функция Жеткомпакт

Функция **жеткомпакт** создает копию существующей базы данных. Копия сжимается в состояние, оптимальное для использования. Данные в скопированных данных будут упаковываться в соответствии с мерами, выбранными для индексов при создании индекса. Таким образом, сжатые данные могут храниться как можно более плотно. Кроме того, сжатые данные могут резервировать пространство для последующего роста записи или вставки индекса.

```cpp
    JET_ERR JET_API JetCompact(
      __in          JET_SESID sesid,
      __in          JET_PCSTR szDatabaseSrc,
      __in          JET_PCSTR szDatabaseDest,
      __in          JET_PFNSTATUS pfnStatus,
      __in_opt      JET_CONVERT* pconvert,
      __in          JET_GRBIT grbit
    );
```

### <a name="parameters"></a>Параметры

*сесид*

Сеанс, используемый для этого вызова.

*сздатабасесрк*

База данных источника, которая будет сжата.

*сздатабаседест*

Имя, используемое для сжатой базы данных.

*пфнстатус*

Функция обратного вызова, которую можно периодически вызывать с помощью операции Database Compact для отчета о ходе выполнения.

*пконверт*

Указатель, используемый для обозначения альтернативной библиотеки DLL ESE, которая может использоваться для чтения базы данных-источника, а также для предоставления необязательных параметров для операции **жеткомпакт** , которая преобразует базу данных из более ранней версии в формат более поздней. Эта функция прекращена в Windows Server 2003.

*грбит*

Группа битов, задающая ноль или более следующих параметров.

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Значение</p></th>
<th><p>Значение</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_bitCompactRepair</p></td>
<td><p>Используется, если база данных-источник повреждена. Она обеспечивает целый набор новых поведений, предназначенных для восстановления максимально возможного объема данных из базы данных-источника. <strong>Жеткомпакт</strong> с этим набором параметров может возвращать JET_errSuccess но не копировать все данные, созданные в базе данных источника. Данные, которые находятся в поврежденных частях базы данных источника, будут пропущены.</p></td>
</tr>
<tr class="even">
<td><p>JET_bitCompactStats</p></td>
<td><p>Вызывает <strong>жеткомпакт</strong> для дампа статистики в базе данных-источнике в файл с именем DFRGINFO.TXT. Статистика включает в себя имя каждой таблицы в базе данных источника, число строк в каждой таблице, общий размер в байтах всех строк в каждой таблице, общий размер в байтах всех столбцов типа <a href="gg269213(v=exchg.10).md">JET_coltypLongText</a> или <a href="gg269213(v=exchg.10).md">JET_coltypLongBinary</a> , которые достаточно велики для хранения отдельно от записи, число конечных страниц кластеризованного индекса и количество конечных страниц с длинными значениями. Кроме того, сводные статистические данные, включая размер базы данных-источника, целевую базу данных, время, необходимое для сжатия базы данных, также сохраняются в дампе временной базы данных.</p></td>
</tr>
</tbody>
</table>


### <a name="return-value"></a>Возвращаемое значение

Эта функция возвращает [JET_ERR](./jet-err.md) DataType с одним из следующих кодов возврата. Дополнительные сведения о возможных ошибках ESE см. в разделе [ошибки подсистемы хранилища](./extensible-storage-engine-errors.md) и [Параметры обработки ошибок](./error-handling-parameters.md).

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Код возврата</p></th>
<th><p>Описание</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>JET_errSuccess</p></td>
<td><p>Операция выполнена успешно.</p></td>
</tr>
<tr class="even">
<td><p>JET_errClientRequestToStopJetService</p></td>
<td><p>Невозможно выполнить операцию, так как все действия в экземпляре, связанном с сеансом, были прекращены в результате вызова <a href="gg269240(v=exchg.10).md">жетстопсервице</a>.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errFeatureNotAvailable</p></td>
<td><p>Указан непустой указатель <em>пконверт</em> , но используемая версия ESE не поддерживает функцию CONVERT. Эта функция была удалена в версии ESE для Windows Server 2003.</p></td>
</tr>
<tr class="even">
<td><p>JET_errInstanceUnavailable</p></td>
<td><p>Невозможно выполнить операцию, поскольку экземпляр, связанный с сеансом, обнаружил неустранимую ошибку, которая требует, чтобы доступ ко всем данным был отозван для защиты целостности этих данных. Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errInTransaction</p></td>
<td><p>Вызывающий сеанс находится в пределах транзакции. <strong>Жеткомпакт</strong> должен вызываться сеансом за пределами какой-либо транзакции.</p></td>
</tr>
<tr class="even">
<td><p>JET_errNotInitialized</p></td>
<td><p>Невозможно выполнить операцию, так как экземпляр, связанный с сеансом, еще не инициализирован.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errRestoreInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как в экземпляре, связанном с сеансом, выполняется операция восстановления.</p></td>
</tr>
<tr class="even">
<td><p>JET_errSessionSharingViolation</p></td>
<td><p>Один и тот же сеанс нельзя использовать одновременно для нескольких потоков.</p>
<p>Эта ошибка будет возвращена только Windows XP и более поздних версий.</p></td>
</tr>
<tr class="odd">
<td><p>JET_errTermInProgress</p></td>
<td><p>Невозможно выполнить операцию, так как выполняется завершение работы экземпляра, связанного с сеансом.</p></td>
</tr>
</tbody>
</table>


При успешном выполнении база данных-источник копируется в целевую базу данных. Целевая база данных находится в оптимальном состоянии, например все индексы таблиц находятся в смежном пространстве логического диска. Каждая страница индекса дополняется объемом, настроенным при первоначальном создании индексов в базе данных-источнике. Все параметры данных и метаданных копируются с полной точностью, если не указан параметр восстановления. Если указан параметр восстановления, некоторые данные из базы данных источника могут быть не скопированы.

В случае сбоя Целевая база данных может существовать, но не является полной копией базы данных-источника.

#### <a name="remarks"></a>Комментарии

Сжатие базы данных также используется для обновления базы данных в формате более ранней версии до более современной версии. Необязательный параметр — *пконверт*, который содержит структуру, которая может содержать описание для библиотеки DLL более ранней версии, используемой для чтения формата базы данных-источника. Эта функция прекращена в Windows Server 2003. После Windows Server 2003 новые версии ESE всегда могут читать старые версии формата базы данных, поэтому эта функция не требуется.

Требуемая плотность данных после операции сжатия указывается при создании таблиц и индексов. Плотность должна составлять от 20% до 100%. Если база данных в основном считывается и не обновляется, то для уменьшения числа операций ввода-вывода во время обработки запроса приложения будут устанавливать плотность равным 100%. Однако если данные часто обновляются с операциями, увеличивающими размер данных, хранящихся вместе с записью, или часто вставляются новые данные, то приложение выбирает меньшую плотность, чтобы обновления чаще нашли необходимые ресурсы. Операция сжатия базы данных приводит к тому, что база данных лучше располагаться в соответствии с заполнением, выбранной приложением.

Сжатие базы данных — это автономная операция. Она не может быть выполнена, пока используется база данных. В результате он обычно выполняется как часть процесса сборки приложения, который доставляет набор данных как часть самого себя.

Автономное сжатие базы данных касается каждого бита данных в базе данных и может использоваться как средство проверки согласованности базы данных. Если база данных сомнительна, ее можно сжать. Если в сжатии не обнаружена ошибка, то будет известно, что база данных находится в допустимом состоянии для ESE.

#### <a name="requirements"></a>Требования

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Клиент</strong></p></td>
<td><p>Требуется Windows Vista, Windows XP или Windows 2000 Professional.</p></td>
</tr>
<tr class="even">
<td><p><strong>Server</strong></p></td>
<td><p>Требуется Windows Server 2008, Windows Server 2003 или Windows 2000 Server.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Header</strong></p></td>
<td><p>Объявлено в ESENT. h.</p></td>
</tr>
<tr class="even">
<td><p><strong>Библиотека</strong></p></td>
<td><p>Используйте ESENT. lib.</p></td>
</tr>
<tr class="odd">
<td><p><strong>КОМПОНОВКИ</strong></p></td>
<td><p>Требуется ESENT.dll.</p></td>
</tr>
<tr class="even">
<td><p><strong>Юникод</strong></p></td>
<td><p>Реализуется как <strong>жеткомпактв</strong> (Юникод) и <strong>жеткомпакта</strong> (ANSI).</p></td>
</tr>
</tbody>
</table>


#### <a name="see-also"></a>См. также:

[JET_COLTYP](./jet-coltyp.md)  
[JET_ERR](./jet-err.md)  
[JET_SESID](./jet-sesid.md)  
[жетдефрагмент](./jetdefragment-function.md)  
[жетстопсервице](./jetstopservice-function.md)
