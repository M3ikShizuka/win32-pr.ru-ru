---
description: Ниже приведены рекомендации по работе с потоками для планшетных ПК, связанные с использованием модели COM и автоматизации.
ms.assetid: cf8feba5-a391-4396-a5d8-1ef58df304a7
title: Рекомендации по потокам COM и автоматизации
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: afe0cf67d427ce89074a605f664e94f35d3d3eaf
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701351"
---
# <a name="com-and-automation-threading-considerations"></a>Рекомендации по потокам COM и автоматизации

Ниже приведены рекомендации по работе с потоками для планшетных ПК, связанные с использованием модели COM и автоматизации.

-   [Потокобезопасность](#thread-safety)
-   [Приложения STA и MTA](#sta-and-mta-applications)
-   [InkCollector и InkOverlay](#inkcollector-and-inkoverlay)
-   [Приемники событий](#event-sinks)
-   [Исключения в обработчиках событий](#exceptions-within-event-handlers)
-   [См. также](#related-topics)

## <a name="thread-safety"></a>Потокобезопасность

Объекты планшетных ПК, за исключением элементов управления [InkPicture](inkpicture-control.md) и [InkEdit](inkedit-control.md) , являются потокобезопасными и помечаются как оба. Как и то, и другое, они могут работать в одном потоковом апартаменте (STA) или в многопоточном апартаменте (MTA).

В Windows Forms используется модель STA, поскольку Windows Forms основана на собственных окнах Win32, которые по сути являются потоковыми потоками.

## <a name="sta-and-mta-applications"></a>Приложения STA и MTA

Если приложение выполняется в MTA или использует бесплатный потоковый маршалеру (FTM), необходимо написать потокобезопасный код. Тем не менее, это позволяет повысить производительность обработки определенных событий.

## <a name="inkcollector-and-inkoverlay"></a>InkCollector и InkOverlay

Приложение не должно освобождать его окончательную ссылку на объект [**InkCollector**](inkcollector-class.md) или [**InkOverlay**](inkoverlay-class.md) , тем самым уничтожая объект непосредственно из потока рукописного ввода. Вместо этого приложение должно освободить объект **InkCollector** или **InkOverlay** из потока приложения.

**Внимание!** Приложение, помеченное как MTA или использующее FTM, которое позволяет выполнять прямые вызовы из потока рукописного ввода в подразделение приложения, может освобождать последнюю ссылку на объект [**InkCollector**](inkcollector-class.md) или [**InkOverlay**](inkoverlay-class.md) непосредственно из потока рукописного ввода; Однако это приводит к неустранимому сбою приложения.

## <a name="event-sinks"></a>Приемники событий

Если приложение не использует FTM, а объект и его приемник событий создаются в разных апартаментах, то событие выполняется в потоке, обслуживающем приемник событий.

## <a name="exceptions-within-event-handlers"></a>Исключения в обработчиках событий

Исключения, вызванные из обработчиков событий планшетных ПК, используются и не видны остальным или вашим приложениям. Аналогичным образом значения HRESULT не распространяются на обработчики событий планшетных ПК. Если приложение, использующее уровень COM, создает исключение, фоновый поток завершается, и исключение будет потеряно. Никакие дополнительные обработчики событий не будут вызываться.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Пример приемников событий C++](c---event-sinks-sample.md)
</dt> <dt>

[Общие рекомендации по потокам](general-threading-considerations.md)
</dt> <dt>

[Рекомендации по потокам управляемых библиотек](managed-library-threading-considerations.md)
</dt> </dl>

 

 



