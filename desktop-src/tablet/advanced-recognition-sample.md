---
description: В примере расширенного распознавания демонстрируются расширенные возможности программного интерфейса программирования автоматизации приложений Microsoft Tablet PC (API), используемого для распознавания рукописного текста.
ms.assetid: 4c9b9f31-c317-43fd-8404-35295b41d093
title: Пример расширенного распознавания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de7c56a76e66870fdd881ff1d51c4b54acb929765fb21d45857d67c252b01628
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117675632"
---
# <a name="advanced-recognition-sample"></a>Пример расширенного распознавания

В примере расширенного распознавания демонстрируются расширенные возможности программного интерфейса программирования автоматизации приложений Microsoft Tablet PC (API), используемого для распознавания рукописного текста.

Он включает следующие компоненты.

-   Перечисление установленного распознавателя
-   Создание контекста распознавателя с конкретным языком
-   Использование объекта распознавателя
-   Настройка фактоид распознавания и списков слов
-   Использование руководств для повышения качества распознавания
-   Динамическое распознавание фона
-   Распознавание жестов

Используются следующие интерфейсы: [**иинкрекогнизер**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognizer), **иинкрекоконтекст**, [**иинкрекогнитионресулт**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult), **иинкрекогнитионгуиде**, **иинквордлист**, [**IInkGesture**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkgesture), **IInkCollector**, **IInkDisp**, **IInkRenderer**, **IInkDrawingAttributes**, **IInkStrokes** и **IInkStroke**.

## <a name="ink-and-project-headers"></a>заголовки рукописного ввода и Project

Сначала включите заголовки для интерфейсов автоматизации планшетных ПК. Они устанавливаются вместе с пакетом SDK для платформы Tablet PC Platform. Файл Тпцеррор. h содержит определения кодов ошибок API для планшетных ПК.


```C++
#include <msinkaut.h>
#include <msinkaut_i.c>
#include <TpcError.h>
```



Файл Евентсинкс. h определяет интерфейсы **иинкевентсимпл** и **иинкрекогнитионевентсимпл** и настраивает события [**рекогнитионвисалтернатес**](inkrecognizercontext-recognitionwithalternates.md), [**Stroke**](inkcollector-stroke.md)и [**жестов**](inkcollector-gesture.md) .


```C++
#include "EventSinks.h"
```



Файл Чилдвндс. h содержит определения классов **Цинкинпутвнд** и **крекуутпутвнд**, которые являются производными от квиндовимпл ATL и используются для создания дочерних окон примера.


```C++
#include "ChildWnds.h"
```



Файл Адвреко. h объявляет класс **кадврекоапп** , который является классом окна приложения для этого примера.


```C++
#include "AdvReco.h"
```



## <a name="initializing-the-application-window"></a>Инициализация окна приложения

`Run`Метод окна настраивает объект **кадврекоапп** , загружает меню и значок для окна, создает объект [**инкрекогнизерконтекст**](inkrecognizercontext-class.md) для распознавателя по умолчанию и запускает цикл обработки сообщений окна.

Метод **OnCreate** окна обрабатывает событие **\_ создания WM** и создает дочерние окна. Объект [**InkCollector**](inkcollector-class.md) подключается к источнику событий сборщика рукописных данных и включает ввод рукописных данных в окне ввода. Затем он создает объект [**инкрекогнизергуиде**](inkrecognizerguide-class.md) и использует свойство модуля [**подготовки**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_renderer) сборщика рукописных данных для преобразования прямоугольников с руководством по распознаванию в пространство рукописного ввода. Наконец, метод **OnCreate** создает объект [**инквордлист**](inkwordlist-class.md) .

## <a name="handling-ink-collector-events"></a>Обработка событий сборщика рукописных данных

Метод **onstroke** окна обрабатывает событие [**Stroke**](inkcollector-stroke.md) сборщика рукописных данных. Новый объект [**иинкстрокедисп**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkstrokedisp) добавляется в [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) свойства [**Ink**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) сборщика рукописных данных.

Метод **ongesture** окна обрабатывает событие [**жеста**](inkcollector-gesture.md) сборщика рукописных данных. Метод **ongesture** определяет жест, сначала используя жест с наивысшим уровнем достоверности, и проверяет, поддерживает ли окно этот конкретный жест. Если жест поддерживается, ограничивающий прямоугольник для жеста становится недействительным, так как жест удаляется из коллекции штрихов. Если жест не поддерживается, событие **жеста** отменяется, что приводит к тому, что сборщик рукописных данных создает событие [**Stroke**](inkcollector-stroke.md) . Наконец, окно результатов обновляется.

## <a name="handling-recognizer-context-events"></a>Обработка событий контекста распознавателя

Метод **онрекогнитионвисалтернатес** окна обрабатывает событие [**рекогнитионвисалтернатес**](inkrecognizercontext-recognitionwithalternates.md) контекста распознавателя. Метод **онрекогнитионвисалтернатес** отображает результаты распознавания в окне результаты.

## <a name="handling-menu-commands"></a>Обработка команд меню

Метод **Onrecognizeя** окна обрабатывает команды в меню распознавателя. Если выбрана команда **по умолчанию** , метод [**жетдефаултрекогнизер**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizers-getdefaultrecognizer) объекта [инкрекогнизерс](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)) используется для получения распознавателя по умолчанию. в противном случае извлекается выбранный распознаватель. Затем создается и используется контекст распознавателя, а затем обновляются строки меню и состояния.

Метод **онфактоидвордлист** окна обрабатывает команду **use список слов** в меню **фактоид** . Для свойства [**Stroke**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекста распознавателя установлено **значение NULL** , чтобы сбросить контекст распознавателя. Если параметр **использовать** пустые значения отключен, свойство [**список слов**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) в контексте распознавателя имеет значение **null**; в противном случае в качестве значения свойства **список слов** для контекста распознавателя задается значение [**инквордлист**](inkwordlist-class.md) , созданное в методе **OnCreate** . Наконец, [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных повторно присоединяется к контексту распознавателя, вызывается метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя и обновляется меню.

Метод **онфактоид** окна обрабатывает команды фактоид в меню **фактоид** . Сначала он устанавливает для свойства [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекст распознавателя **значение NULL**, устанавливает свойство [**фактоид**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) контекста распознавателя в выбранное фактоид и перенаписывает [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных в контекст распознавателя. Если объект [фактоид](factoid-constants.md) поддерживается контекстом распознавателя, вызывается метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя. в противном случае отображается сообщение об ошибке. Наконец, меню и строка состояния обновляются.

Метод **onguide** окна обрабатывает команды в меню **Guide** . Если контекст распознавателя поддерживает параметры программы Guide, метод **onguide** устанавливает для свойства [**Stroke**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) контекста распознавателя **значение NULL**, устанавливает для свойства "программа" в контексте распознавателя выбранное значение [**параметра Guide,**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) переназначает [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) из сборщика рукописного текста в контекст распознавателя и вызывает метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) в контексте распознавателя. В противном случае отображается сообщение об ошибке. Наконец, окно ввода, меню и строка состояния обновляются.

Метод **onmode** окна обрабатывает команды в меню **режим** . Он отключает сборщик рукописных данных, обновляет свойство [**режиме CollectionMode**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_collectionmode) сборщика рукописных данных, обновляет меню и отображает или скрывает списки жестов. Наконец, включен сборщик рукописных данных.

Метод **onrecognize** окна обрабатывает команду **Recognize** в меню рукописного ввода. Он вызывает метод [**ендинкинпут**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-endinkinput) контекста распознавателя, чтобы предотвратить добавление рукописного ввода в контекст распознавателя. Иногда это необходимо, так как не все распознаватели поддерживают частичное распознавание. Затем вызывается метод [**распознавания**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-recognize) контекста распознавателя и результаты передаются в метод **онрекогнитионвисалтернатес** окна. Наконец, [инкстрокес](/previous-versions/windows/desktop/legacy/ms703293(v=vs.85)) сборщика рукописных данных переназначится в контекст распознавателя.

Метод **OnClear** окна обрабатывает команду **clear** в меню **рукописного ввода** . Он удаляет штрихи из свойства [**рукописного ввода**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkcollector-get_ink) сборщика рукописных данных, освобождает старую коллекцию штрихов и создает новый для свойства **Ink** сборщика рукописных данных и прикрепляет новую коллекцию штрихов к контексту распознавателя.

Метод **onexit** окна обрабатывает команду **Exit** в меню **рукописного ввода** и вызывает \_ событие закрытия WM.

## <a name="helper-methods"></a>Вспомогательные методы

Метод **лоадмену** окна вызывается из метода **Run** окна и добавляет в меню список поддерживаемых распознавателей и список поддерживаемых фактоидс. Сначала он получает [инкрекогнизерс](/previous-versions/windows/desktop/legacy/ms702438(v=vs.85)). Затем он перебирает доступные распознаватели и выбирает только те из них, которые имеют список языков в свойстве **Languages** , которое добавляется в меню **распознавателя** . Наконец, он заполняет меню **фактоид** списком фактоидс, определенным как глобальная константа.

Метод **усерекогнизер** окна вызывается из метода **onrecognizeя** окна, когда пользователь выбирает новый распознаватель. Он создает контекст распознавателя, отсоединяет старый контекст от приемника событий распознавателя, очищает и освобождает старый контекст и прикрепляет новый контекст к приемнику событий распознавателя.

Затем метод **усерекогнизер** проверяет свойство [**возможностей**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_capabilities) распознавателя, которое возвращает значение [**инкрекогнизеркапабилитиес**](/windows/desktop/api/msinkaut/ne-msinkaut-inkrecognizercapabilities) . Если распознаватель поддерживает ввод с линией, команда **строки** в меню " **Направляющая** " будет включена. Если распознаватель поддерживает Упакованные входные данные, команда " **окна** " становится доступной. Если распознаватель не поддерживает свободные входные данные, команда **None** отключена. Если текущий выбор руководств не поддерживается, то обновляются и свойство [**Guide**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_guide) контекста распознавателя, и меню.

Затем метод **усерекогнизер** пытается задать свойства " [**список слов**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_wordlist) " и [**фактоид**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-get_factoid) для контекста распознавателя. Если какой-либо из параметров не поддерживается распознавателем, то используется значение по умолчанию и обновляется меню.

Наконец, метод **усерекогнизер** присоединяет свойство [**Strokes**](/windows/desktop/api/msinkaut15/nf-msinkaut15-iinkdivisionresult-get_strokes) объекта [**инкдисп**](inkdisp-class.md) сборщика рукописных данных к контексту распознавателя, изменяет шрифт окна вывода на единицу, поддерживаемую языком распознавателя, сбрасывает окно вывода и обновляет результаты распознавания, вызывая метод [**баккграундрекогнизевисалтернатес**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizercontext-backgroundrecognizewithalternates) контекста распознавателя.

Метод **жетжестуренаме** окна вызывается из метода **ongesture** окна. Он выполняет поиск жеста и возвращает индекс в имя жеста, которое хранится в таблице строк в файле Адвреко. rc.

 

 
