---
description: В Windows Vista панель ввода Tablet PC интегрирует новые возможности автозаполнения, позволяющие обновлять список автозаполнения приложения в режиме реального времени по мере того, как рукописный ввод пользователя распознается на панели ввода.
ms.assetid: 0f01f546-f76b-4c61-a204-2a06079a374a
title: Использование автозаполнения панели ввода
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c9e7f108631eb2723b71bf8ed919c17a0eabff5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144767"
---
# <a name="using-input-panel-autocomplete"></a>Использование автозаполнения панели ввода

В Windows Vista панель ввода Tablet PC интегрирует новые возможности автозаполнения, позволяющие обновлять список автозаполнения приложения в режиме реального времени по мере того, как рукописный ввод пользователя распознается на панели ввода. Кроме того, список автозаполнения приложения располагается в удобном месте для пользователей панели ввода. Без автозаполнения панели ввода, использование функций автозаполнения с панелью ввода является сложным процессом, требующим от пользователей вставки одного символа за раз и перемещения панели ввода для доступа к предложениям автозаполнения. Благодаря интеграции Автозаполнение — это мощное средство для пользователей планшетных ПК, которое ускоряет и повышает удобство ввода текста с помощью панели ввода.

![панель ввода с помощью списка автозаполнения в IE](images/9e769482-543a-4e29-b274-8f19ae10250d.jpg)

Существует три способа, с помощью которых приложение может использовать преимущества интеграции автозаполнения на панели ввода. Приложения, которые содержат функции автозаполнения, созданные с помощью автозаполнения оболочки (через интерфейс [**иаутокомплете**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete) ) или платформа .NET Framework Автозаполнение (через перечисление [AutoCompleteMode](/dotnet/api/system.windows.forms.autocompletemode?view=netcore-3.1) ), получают интеграцию с автозаполнением на панели ввода, не требуя изменения кода. Приложения, содержащие пользовательские текстовые поля автозаполнения, могут использовать API автозаполнения панели ввода для получения тех же функций.

Во всех случаях эти изменения можно внести в список автозаполнения приложения без дублирования или изменения пользовательского интерфейса или логики прогноза, используемой приложением для создания списка автозаполнения. Список автозаполнения по своим владельцам будет отображаться в приложении, а содержимое списка автозаполнения будет таким же, как если бы текст был введен непосредственно в поле редактирования.

Интеграция автозаполнения на панели ввода поддерживается в операционной системе Windows Vista или более поздних версиях. Интеграция автозаполнения на панели ввода встроена в оболочку PowerShell, начиная с Windows Vista и Windows Forms разработки, начиная с версии платформа .NET Framework 3,0. Хотя [**иаутокомплете**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete) и [AutoCompleteMode](/dotnet/api/system.windows.forms.autocompletemode?view=netcore-3.1) работают в более ранних версиях Windows, интеграция автозаполнения на панели ввода не поддерживается в Microsoft Windows XP Tablet PC Edition или более ранних операционных системах. Если автозаполнение панели ввода выполняется в более ранних версиях Tablet PC, приложения возвращаются к поведению до интеграции.

## <a name="reasons-to-integrate-application-autocomplete-lists-with-input-panel"></a>Причины для интеграции списков автозаполнения приложений с панелью ввода

Интеграция списка автозаполнения приложения обеспечивает максимальную простоту и скорость ввода для пользователей, которые вводит текст в текстовое поле, включающее функцию автозаполнения. Кроме того, приложение, включающее в себя интеграцию с автозаполнением панели ввода, сразу же выглядит так, как если бы оно было разработано с планшетным ПК, что делает приложение более привлекательным для пользователей планшетных ПК.

### <a name="how-input-panel-and-autocomplete-list-interact-without-integration"></a>Взаимодействие панели ввода и списка автозаполнения без интеграции

Использование панели ввода для ввода текста в текстовое поле, включающее список автозаполнения, но не интегрированную с панелью ввода:

1.  Пользователь помещает фокус в текстовое поле и открывает панель ввода.
2.  Пользователь записывает один или два символа.
3.  Пользователь касается **вставки**. Панель ввода вводит текст в текстовое поле приложения. Отображается список автозаполнения приложения, который, скорее всего, частично или полностью скрыт панелью ввода.
4.  Пользователь перетаскивает панель ввода для обнаружения списка автозаполнения приложения.
5.  Если в список автозаполнения включена правильная запись, пользователь может выбрать эту запись. в противном случае пользователь должен повторить шаги 2 и 3.

Это, очевидно, громоздкий процесс. Ожидание работы пользователя в списке автозаполнения имеет вид штриха и возможность выполнения задач.

### <a name="how-input-panel-and-autocomplete-list-interaction-improves-with-integration"></a>Улучшение взаимодействия с панелью ввода и списком автозаполнения с интеграцией

Использование панели ввода для ввода текста в текстовое поле, включающее список автозаполнения, интегрированный с панелью ввода:

1.  Пользователь помещает фокус в текстовое поле и открывает панель ввода.
2.  Пользователь записывает один или два символа. Список автозаполнения приложения отображается непосредственно над панелью ввода или непосредственно под ней при записи текста пользователем.
3.  Пользователь выбирает запись из списка автозаполнения; запись вставляется непосредственно в текстовое поле приложения, или пользователь повторяет шаг 2, пока не появится правильная запись.

Из-за интеграции список автозаполнения отображается и обновляется во время записи пользователем на панели ввода. Кроме того, список располагается таким образом, чтобы он был удобен для доступа пользователю при записи, а не скрытой панелью ввода. Наконец, когда пользователь выбирает элемент из списка автозаполнения, элемент вставляется непосредственно в поле ввода текста приложения, тем самым позволяя пользователю обходить шаг вставки текста с панели ввода.

![панель ввода с перечнем автозаполнения Outlook Express](images/ba59a513-e538-4092-89a6-6d691424dc3d.jpg)

## <a name="standard-autocomplete-components-that-include-input-panel-autocomplete-integration"></a>Стандартные компоненты автозаполнения, включающие интеграцию с автозаполнением панели ввода

Как [**иаутокомплете**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete) , так и [AutoCompleteMode](/dotnet/api/system.windows.forms.autocompletemode?view=netcore-3.1) включают встроенную интеграцию автозаполнения панели ввода. Приложения, использующие любой из этих стандартных компонентов автозаполнения, могут воспользоваться преимуществами функции автозаполнения на панели ввода без дополнительной работы. Кроме того, хотя Автозаполнение панели ввода поддерживается только в Windows Vista или в новых версиях операционной системы Windows, приложения, созданные с помощью **иаутокомплете** до выпуска Windows Vista, автоматически выполняют интеграцию с автозаполнением панели ввода при запуске в Windows Vista. В следующих разделах содержатся дополнительные сведения о конкретных элементах **иаутокомплете** и AutoCompleteMode, включающих интеграцию автозаполнения на панели ввода.

### <a name="shell-autocomplete-with-input-panel-autocomplete-integration"></a>Интеграция автозаполнения оболочки с автозаполнением панели ввода

Приложения, использующие [**иаутокомплете**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete) , применяют интеграцию автозаполнения на панели ввода бесплатно. Хотя интерфейсы API автозаполнения для оболочки включены в Windows 2000, интеграция автозаполнения на панели ввода поддерживается только в Windows Vista и более новых версиях. Однако приложения, созданные до выпуска Windows Vista, которые используют **иаутокомплете** , автоматически получают интеграцию автозаполнения панели ввода при запуске в Windows Vista.

Чтобы воспользоваться преимуществами автозаполнения планшета таким образом, необходимо использовать объект автозаполнения (**\_ Автозаполнение CLSID**). Если вы хотите предоставить функцию автозаполнения для URL-адресов или имен файлов, используйте функцию [**шаутокомплете**](/windows/win32/api/shlwapi/nf-shlwapi-shautocomplete) для создания объекта автозаполнения.

В дополнение к [**иаутокомплете**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete)можно напрямую реализовать [**IAutoComplete2**](/windows/win32/api/shldisp/nn-shldisp-iautocomplete2) или [**иаутокомплетедропдовн**](/windows/win32/api/shobjidl/nn-shobjidl-iautocompletedropdown)s и по-прежнему автоматически получать автоматическую интеграцию панели ввода.

### <a name="input-panel-autocomplete-integration-with-net-framework-applications"></a>Интеграция автозаполнения панели ввода с приложениями платформа .NET Framework

Начиная с платформа .NET Framework 3,0, Windows Forms текстовые поля включают Автозаполнение. Windows Forms Автозаполнение текстового поля построено на основе автозаполнения оболочки, что означает, что интеграция автозаполнения на панели ввода также встроена. Платформа .NET Framework 3,0 поддерживается в выпусках Windows, выпущенных до Windows Vista. Однако поскольку интеграция автозаполнения на панели ввода поддерживается только в Windows Vista или более поздних версиях, интеграция автозаполнения на панели ввода работает только в приложении платформа .NET Framework 3,0, если оно установлено в Windows Vista или более поздних версиях.

Приложения, желающие воспользоваться преимуществами интеграции автозаполнения на панели ввода в платформа .NET Framework 3,0, должны использовать [текстовое поле](/dotnet/api/system.windows.forms.textbox?view=netcore-3.1) Windows Forms с включенным свойством [AutoCompleteMode](/dotnet/api/system.windows.forms.textbox.autocompletemode?view=netcore-3.1) . Чтобы воспользоваться преимуществами интеграции автозаполнения на панели ввода, вам не нужно выполнять дополнительную работу, помимо Windows Forms автозаполнения.

## <a name="using-input-panel-autocomplete-apis-directly"></a>Непосредственное использование интерфейсов API автозаполнения панели ввода

Разработчики настраиваемых полей автозаполнения должны работать с интерфейсами API автозаполнения панели ввода напрямую, чтобы получить Улучшенный интерфейс ввода текста, который обеспечивает интеграция автозаполнения на панели ввода в приложениях. Интерфейсы API автозаполнения панели ввода входят в состав операционной системы Windows Vista и в составе пакета SDK для платформы планшетов версии 1,9 или более поздней. Интерфейсы автозаполнения на панели ввода являются интерфейсами на основе COM.

В следующем разделе подробно описывается работа этих интерфейсов в приложении C++. Однако эти COM-интерфейсы могут быть реализованы на большинстве языков, включая C \# , с помощью COM-взаимодействия.

Для реализации интеграции автозаполнения панели ввода в пользовательском текстовом поле автозаполнения необходимы два интерфейса: [**интерфейс итипаутокомплетепровидер**](itipautocompleteprovider.md) и [**интерфейс итипаутокомплетеклиент**](itipautocompleteclient.md). Определения этих интерфейсов находятся в Типаутокомплете. h и Типаутокомплете \_ i.c.

Сначала приложение должно определить и создать экземпляр класса поставщика автозаполнения, который реализует [**итипаутокомплетепровидер**](itipautocompleteprovider.md) для каждого текстового поля ввода, включающего список автозаполнения. Этот класс управляет стороны приложения в интеграции автозаполнения. Все запросы автозаполнения из панели ввода выполняются из клиента автозаполнения в приложение с помощью поставщика автозаполнения приложения. Поставщик автозаполнения приложения должен иметь доступ к HWND для списка автозаполнения приложения и ХВИНД для связанного поля ввода текста. Кроме того, должны быть реализованы следующие методы **итипаутокомплетепровидер** :

-   [**Метод итипаутокомплетепровидер:: упдатепендингтекст**](itipautocompleteprovider-updatependingtext.md). Этот метод используется клиентом автозаполнения для уведомления приложения о том, что текст написан пользователем на панели ввода. После получения этого уведомления поставщик отвечает за создание списка автозаполнения, как если бы текст был введен в поле ввода текста приложения. Строка, передаваемая поставщику автозаполнения с помощью **метода итипаутокомплетепровидер:: упдатепендингтекст** , включает только текст, находящиеся на панели ввода. Таким образом, если в поле ввода текста есть дополнительный текст, ответственность за его правильное добавление к тексту, отправленному клиентом, несет поставщик. Строка, передаваемая **методом итипаутокомплетепровидер:: упдатепендингтекст** , должна рассматриваться как замена для текущего выбора в поле. Если текущее выделение отсутствует, оно должно располагаться в позиции текущей точки вставки. После создания списка автозаполнения поставщик должен вызвать [**метод итипаутокомплетепровидер:: Показать**](itipautocompleteprovider-show.md) , передавая **значение true** для отображения списка автозаполнения. Приложение не должно кэшировать вызовы **упдатепендингтекст** , а вместо этого обрабатывать каждый дополнительный вызов **упдатепендингтекст** как отмену предыдущего вызова, чтобы избежать МИГАНИЯ устаревшего пользовательского интерфейса списка автозаполнения. Эти рекомендации иллюстрируются в следующем примере кода.

    ```C++
    HRESULT SampleProvider::UpdatePendingText(BSTR bstrPendingText)
    {
       //Discard previously cached pending text from Input Panel
       m_bstrPending.Empty();
        //Store the new pending text from Input Panel as m_bstrPending
    m_bstrPending = bstrPendingText;

        //Get the text from the field in two chunks. The characters to
    //the left of the selection and the characters to the right.
    CComBSTR bstrLeftContext = //Text to the left of the selection
            CComBSTR bstrRightContext = //Text to the right of the selection

    //Discard previously cached complete text
        m_bstrCompleteText.Empty();
        //Append to the field text from the left of the selection
        //the text from Input Panel and then append to that
        //the field text to the right of the selection
        m_bstrCompleteText.Append(bstrLeftContext);
        m_bstrCompleteText.Append(m_bstrPending);
        m_bstrCompleteText.Append(bstrRigtContext);

        //Update the app's AC list based on m_bstrCompleteText
        //...

        //Show the updated AC list by calling the provider's Show method
       Show(true);
       return S_OK;
    }
    ```

    

-   [**Метод итипаутокомплетепровидер:: "**](itipautocompleteprovider-show.md). Этот метод вызывается из [**упдатепендингтекст**](itipautocompleteprovider-updatependingtext.md), но он может вызываться клиентом автозаполнения в любое время. При получении этого вызова поставщик автозаполнения должен скрыть или показать поставщик автозаполнения, как указано в параметре. Перед отображением списка автозаполнения поставщик автозаполнения должен обратиться к клиенту автозаполнения о месте расположения списка автозаполнения. Дополнительные сведения о расположении списка автозаполнения см. Далее в этой статье.

Затем приложение должно использовать функцию [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) (ATL), чтобы создать экземпляр [**интерфейса итипаутокомплетеклиент**](itipautocompleteclient.md) с идентификатором класса **CLSID \_ типаутокомплетеклиент** в качестве внутрипроцессного сервера, а затем зарегистрировать поставщик в клиенте. Метод автозаполнения Client [**итипаутокомплетеклиент:: адвисепровидер**](itipautocompleteclient-adviseprovider.md) регистрирует поставщик в клиенте, чтобы позволить клиенту вызывать объект поставщика автозаполнения приложения. Если tiptsf.dll отсутствует в системе, функция **CoCreateInstance** завершается ошибкой и возвращает **регдб \_ E \_ класснотрег**. На этом этапе приложение может удалить объект [**итипаутокомплетепровидер**](itipautocompleteprovider.md) и продолжать работу, как если бы панель ввода не существовала, так как она не находится в такой системе.

Приложение может выбрать создание одного экземпляра [**итипаутокомплетеклиент**](itipautocompleteclient.md) или одного экземпляра на текстовом поле. Для первого параметра требуется, чтобы поставщик был отменен и зарегистрирован при каждом изменении фокуса. Дополнительные сведения об отмене регистрации поставщика автозаполнения см. Далее в этом разделе.

Существует несколько шагов, связанных с размещением списка автозаполнения, который необходимо координировать между поставщиком автозаполнения (приложение) и клиентом автозаполнения (панель ввода). Перед отображением списка автозаполнения в результате вызова метода " [**Показать**](itipautocompleteprovider-show.md) " поставщика автозаполнения или из-за ввода текста пользователем с помощью клавиатуры поставщик должен обратиться к клиенту, чтобы узнать, где разместить список автозаполнения. Поставщик должен выполнить следующие действия:

-   Используйте [**метод итипаутокомплетеклиент:: рекуестшовуи**](itipautocompleteclient-requestshowui.md) клиента автозаполнения, чтобы определить, готова ли панель ввода к отображению списка автозаполнения. **Рекуестшовуи** принимает параметр *HWND* , который является HWND для окна списка автозаполнения, и метод возвращает **значение true** или **false** , чтобы указать, является ли он состоянием, в котором можно отобразить список автозаполнения. Если клиент возвращает **значение false**, поставщик не должен пытаться отобразить список автозаполнения.
-   Вызовите [**рекуестшовуи**](itipautocompleteclient-requestshowui.md) , чтобы задать окно списка автозаполнения для всплывающих окон перед вызовом [**метода Итипаутокомплетеклиент::P реферредректс**](itipautocompleteclient-preferredrects.md). Несоблюдение этого действия приведет к ошибке **E \_ INVALIDARG** при вызове **преферредректс**.
-   Если [**рекуестшовуи**](itipautocompleteclient-requestshowui.md) возвращает **значение true**, поставщик должен вычислить прямоугольник координат экрана по умолчанию в списке автозаполнения на основе расположения поля ввода текста, а затем вызвать [**метод итипаутокомплетеклиент::P реферредректс**](itipautocompleteclient-preferredrects.md)клиента автозаполнения. Это позволяет клиенту автозаполнения настраивать прямоугольник, чтобы избежать перекрытия списка автозаполнения с помощью панели ввода. Метод **преферредректс** принимает четыре параметра:

    -   RECT *ркаклист*: прямоугольник координат экрана по умолчанию в списке автозаполнения.
    -   RECT *ркфиелд*: прямоугольник координат экрана соответствующего поля ввода текста.
    -   RECT *\* пркмодифиедаклист*: скорректированный экранный прямоугольник координат для автозаполнения
    -   BOOL *\* пфшовабове*. Этот параметр указывает поставщику, размещает ли прямоугольник *пркмодифиедаклист* список автозаполнения выше или ниже панели ввода. Приложение может использовать эти сведения для правильной отрисовки элементов пользовательского интерфейса, таких как маркеры изменения размера и полосы прокрутки. Поставщик должен сначала передать в направлении, в котором список автозаполнения будет располагать относительно поля ввода текста с помощью *ркаклист*. Клиент не изменяет *пфшовабове* , если он задает *пркмодифиедаклист* , равный *ркаклист*.

    Для позиционирования и отображения окна списка автозаполнения используйте возвращаемые значения аргументов *пркмодифиедаклист* и *пфшовабове* out. Если панель ввода не используется, [**рекуестшовуи**](itipautocompleteclient-requestshowui.md) всегда возвращает **значение true** , а *пркмодифиедаклист* всегда совпадает с *ркаклист*. *пфшовабове* также не изменяется, результат заключается в том, что вызовы не влияют на поведение приложения. Эти рекомендации иллюстрируются в следующем примере кода.


```C++
HRESULT SampleProvider::Show(BOOL fShow)
{
    //Ask the AC client if it is OK to show the Autocomplete list.
    BOOL fAllowShowing = FALSE;
    m_spACClient->RequestShowUI(m_hWndList, &fAllowShowing);

    if (fShow && fAllowingShowing)
        {
            // Create the parameters required to call PreferredRects
            RECT rcField = //Rectangle for app's text field
            RECT rcACList = //Default rectangle for app's AC list
            RECT rcModifiedACList = {0, 0, 0, 0};
            BOOL fShowAbove = TRUE;

//Ask the AC client to modify the position of the AC list
m_spACClient->PreferredRects(&rcACList, &rcField,
&rcModifiedACList, &fShowAbove);

            //Show the Autocomplete UI at the modified preferred rectangle
            //from rcModifiedACList and the directional info provide by
//fShowAbove
            //...
        }
    else
        {
        //Hide the Autocomplete list and clean up
        //...
        }
    return S_OK;
}
```



Когда пользователь выбирает элемент в списке автозаполнения, поставщику необходимо вызвать [**метод итипаутокомплетеклиент:: усерселектион**](itipautocompleteclient-userselection.md) клиента в дополнение к вставке текста выбранного элемента в поле ввода текста. Панель ввода использует это уведомление для удаления оставшегося текста, который еще не был вставлен на панели ввода.

Наконец, когда поставщик больше не нужен, поставщик должен быть связан с клиентом автозаполнения путем вызова [**метода итипаутокомплетеклиент:: унадвисепровидер**](itipautocompleteclient-unadviseprovider.md) клиента автозаполнения, чтобы отменить регистрацию поставщика. Поставщику может потребоваться отменить регистрацию по одной из двух причин: поскольку поле ввода текста, с которым связан поставщик, было удалено, или потому, что приложение выбирает создание только одного клиента автозаполнения, а не по одному полю ввода текста. В этом экземпляре поставщик должен быть отменен из регистрации при каждом переключении фокуса с текстового поля.

## <a name="conclusion"></a>Заключение

Интеграция автозаполнения на панели ввода — это мощное средство для улучшения взаимодействия с пользователем в приложениях Windows, содержащих списки автозаполнения на планшетных ПК. Без интеграции пользователи панели ввода должны пройти трудоемкий процесс вставки текста по одному символу за раз и изменить расположение панели ввода, чтобы использовать автозаполнение. При интеграции списки автозаполнения отображаются в удобном месте как рукописный ввод пользователей на панели ввода, увеличивая скорость и простоту ввода текста. В приложениях, которые включают функции автозаполнения, основанные на автозаполнении оболочки или платформа .NET Framework 3,0 Автозаполнение, интеграция автозаполнения панели ввода является бесплатной и привлекательной функцией. Кроме того, предоставляется простой набор интерфейсов на основе COM, обеспечивающий единую интегрированную среду для приложений, использующих пользовательские элементы управления автозаполнения.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Справочник по панели ввода текста](text-input-panel-reference.md)
</dt> </dl>

 

 
