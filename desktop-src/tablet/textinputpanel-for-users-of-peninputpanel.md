---
description: выпуск Windows Vista включает новый программируемый объект для панели ввода Tablet PC, который предоставляет новый диапазон возможностей для работы приложения и взаимодействия с панелью ввода.
ms.assetid: 539f41d3-5fb8-4e20-99ba-0d5af1f0cc54
title: Текстинпутпанел для пользователей Пенинпутпанел
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fd75fddb929dfd9e0e783aefc0d3f57743d23d5c35f23c845a9745660512f52
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119222173"
---
# <a name="textinputpanel-for-users-of-peninputpanel"></a>Текстинпутпанел для пользователей Пенинпутпанел

выпуск Windows Vista включает новый программируемый объект для панели ввода Tablet PC, который предоставляет новый диапазон возможностей для работы приложения и взаимодействия с панелью ввода. При первом запуске разработчики приложений могут располагать значком In-Place панели ввода, чтобы выровнять его с помощью текстового поля или поместить в углу пользовательской области, чтобы предоставить доступ к альтернативному режиму ввода. Когда значок панели ввода разворачивается на панели ввода In-Place, разработчики имеют тот же контроль над положением. Это позволяет убедиться, что In-Place панель ввода никогда не пересекается с ключевыми элементами пользовательского интерфейса в макете приложения или даже для перекомпоновки пользовательского интерфейса приложения, чтобы освободить место для In-Place панели ввода, а затем поместить его в зарезервированное пространство. Новая модель программирования включает поддержку более чем просто, но разработчики также могут настраивать область ввода, режим исправления и многие другие свойства панели ввода, чтобы адаптировать ввод текста в приложении. Наконец, в первый раз, когда приложение может получить рукописный ввод пользователя, в дополнение к распознанному тексту, связанному с вставками текста из панели ввода. Это позволяет использовать новые сценарии приложений, включая рукописный ввод в журналах отслеживания изменений, и позволяет пользователям изменять или просматривать рукописные данные в приложении. Эти новые возможности программирования являются прямым результатом отзывов о статье о разработке панели ввода и представляют первый шаг к более тесной интеграции приложений и панели ввода.

Чтобы обеспечить эту расширенную модель программирования панели ввода, существующий механизм программного взаимодействия с панелью ввода, объект [**пенинпутпанел**](peninputpanel-class.md) является устаревшим и заменен новым объектом [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) . Кроме предоставления новых возможностей программирования, объект **текстинпутпанел** также обеспечивает близко к всем программным возможностям объекта **пенинпутпанел** . объект **текстинпутпанел** входит в состав Windows Vista и пакета разработчика Windows Vista. объект **текстинпутпанел** совместим только с панелью ввода Windows Vista и не может использоваться с панелью ввода Windows XP с пакетом обновления 2 (sp2) или более старой. приложение, которое ранее было написано для использования объекта **пенинпутпанел** , будет продолжать работать с панелью ввода Windows Vista, однако при написании новых разработчиков приложений для планшетов настоятельно рекомендуется использовать новый объект **текстинпутпанел** вместо устаревшего объекта **пенинпутпанел** .

Каждый из параметров программирования объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) может применяться к отдельности для каждого текстового поля. Это достигается путем подключения экземпляра объекта **текстинпутпанел** с помощью свойства [**аттачедедитвиндов**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_attachededitwindow) . Для свойства необходимо задать маркер окна для текстового поля.

> [!Note]  
> : Некоторые свойства и методы, описанные ниже, применяются, когда панель ввода находится в режиме взаимодействия "на месте", а не когда панель ввода находится в режиме с плавающей или закрепленной взаимодействием. Режим взаимодействия «на месте» — это поведение панели ввода, где при помещении фокуса в редактируемое поле появляется значок панели ввода рядом с полем, и нажатие значка на панели ввода приводит к раскрытию панели ввода. Методы и свойства, которые применяются только в том случае, если панель ввода находится в режиме взаимодействия "на месте", где все они содержат "Place" в имени метода или свойства.

 

## <a name="control-of-input-panel-icon-and-input-panel-visibility"></a>Управление значком панели ввода и видимостью панели ввода

первый аспект панели ввода, с которой разработчики приложений имеют больший контроль в Windows Vista — это его видимость. С помощью объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) можно управлять видимостью In-Place панели ввода тремя способами. С помощью сочетания свойств и методов приложение может определить, отображается ли In-Place панель ввода, когда на панели ввода In-Place отображается и отображается ли она первым в качестве значка панели ввода или сразу же отображается в развернутом виде. Комбинируя эти методы для управления видимостью с помощью методов управления размещением, обсуждаемых в следующем разделе, разработчики приложений могут создавать пользовательские точки запуска и пользовательские рабочие потоки с помощью панели ввода In-Place в приложении.

> [!Note]  
> Свойства и методы, описанные в этом разделе, применяются только в том случае, если панель ввода находится в режиме взаимодействия In-Place.

 

Во-первых, можно предотвратить отображение панели ввода In-Place и значка панели ввода, установив для свойства [**инплацевисиблеонфокус**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_inplacevisibleonfocus) **значение false**. Если установить его в **true** , будет возвращено значение по умолчанию, если это возможно, если оно не было отключено пользователем или групповая политика. Этот параметр полезен для приложений, которые содержат пользовательские решения для ввода текста в качестве альтернативы панели ввода.

Во-вторых, установив свойство [**дефаултинплацестате**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinplacestate) , разработчик может указать, какое состояние на месте, как указано в перечислении [**инплацестате**](/windows/win32/api/peninputpanel/ne-peninputpanel-inplacestate) , отображается In-Place панели ввода в том случае, когда фокус помещается в текстовое поле. Система по умолчанию используется для того, чтобы In-Place панель ввода отображалась в состоянии наведения указателя, если панель ввода уже не видна в развернутом состоянии, в этом случае панель ввода остается расширенной. Если задать для свойства **дефаултинплацестате** значение инплацестате, то панель ввода In-Place всегда будет отображаться развернутой, а не с помощью значка панели ввода, а затем будет требовать от пользователя коснуться значка панели ввода перед расширением панели ввода. **\_** Два других варианта — **инплацестате \_ Auto**, то есть поведение системы по умолчанию и **инплацестате \_ ховертаржет** , которое всегда приводит к отображению значка панели ввода. Возможность указать, что In-Place панель ввода всегда развернута, — это новая функция с объектом [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) и невозможность использования объекта [**пенинпутпанел**](peninputpanel-class.md) . На следующем рисунке показан значок панели ввода In-Place и развернутые состояния панели.

![значок панели ввода на месте и развернутые состояния](images/8ce866b6-9a45-499f-a3d1-95a1d34d6402.jpg)

Помимо возможности управления состоянием на месте, разработчик может определить состояние на месте в данный момент, получая свойство [**куррентинплацестате**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentinplacestate) ... **Куррентинплацестате** равен [**Дефаултинплацестате**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinplacestate) , если панель ввода не видна, за исключением случаев,  когда дефаултинплацестате **инплацестате \_ Auto** , в этом случае **куррентинплацестате** становится **InPlaceState \_ HoverTarget**. События [**инплацевисибилитичангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacevisibilitychanging)  /  [**инплацевисибилитичанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacevisibilitychanged) можно использовать для отслеживания состояния видимости In-Place панели ввода.

Наконец, разработчик может заставить панель ввода In-Place скрыть или Показать с помощью метода [**сетинплацевисибилити**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplacevisibility) . Если разработчик ранее установил свойство [**дефаултинплацестате**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinplacestate) , панель ввода отображается в указанном состоянии при принудительном отображении. Приложение может скрывать или отображать панель ввода In-Place только в том случае, если фокус находится в окне, к которому присоединен объект [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , а также когда пользователь не открывает панель ввода в другом режиме взаимодействия, например закрепленном или плавающем. Возможность принудительной установки скрытой или отображаемой панели ввода In-Place также является новой с помощью объекта **текстинпутпанел** и невозможности использования объекта [**пенинпутпанел**](peninputpanel-class.md) .

Эти параметры позволяют разработчикам приложений точно контролировать, когда появляется панель ввода In-Place и в каком состоянии. Настроив состояние "на месте" по умолчанию и управляя видимостью на месте независимо от изменения фокуса, разработчик приложения может создать пользовательский рабочий процесс, когда панель ввода реагирует на параметры приложения или данные пользователя в приложении.

## <a name="absolute-positioning-of-input-panel-icon-and-input-panel"></a>Абсолютное позиционирование значка панели ввода и панели ввода

Возможно, наиболее привлекательным новым компонентом в объекте [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) является абсолютное позиционирование панели ввода In-Place. Благодаря этой новой возможности разработчик приложения может убедиться, что панель ввода In-Place не пересекается с одним или несколькими ключевыми визуальными элементами в макете приложения. С помощью объекта [**пенинпутпанел**](peninputpanel-class.md) можно разместить панель ввода In-Place относительно текстового поля, основанного на смещении, однако панель ввода будет по-прежнему настроена для сохранения на экране. В первый раз в Vista приложение может разместить In-Place панель ввода на абсолютной позиции с помощью экранных координат. Кроме того, ответственность за хранение панели ввода на экране остается недоступной для разработчика приложения, поэтому при этом удаляется вероятность того, что панель ввода будет автоматически и кажется случайной.

> [!Note]  
> Свойства и методы, описанные в этом разделе, применяются только в том случае, если панель ввода находится в режиме взаимодействия In-Place.

 

Два основных метода, необходимые для абсолютного позиционирования In-Place панели ввода, — это [**сетинплацепоситион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplaceposition) и [**сетинплацеховертаржетпоситион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplacehovertargetposition). Первая используется для указания расположения панели ввода In-Place, а вторая используется для указания расположения значка панели ввода для In-Place панели ввода. Если приложение выбирает установку только расположения значка панели ввода, а не расположения In-Place панели ввода, то In-Place панель ввода отображается в расположении по умолчанию, определенном системой. Аналогично, если приложение перемещает панель ввода In-Place, но не значок панели ввода, значок панели ввода отображается в расположении по умолчанию. Расположение указывается в экранных координатах. Фактическая точка располагается в левом верхнем углу значка панели ввода или панели ввода без развернутого раскладки исправлений. Когда разворачивание исправлений разворачивается, размещаемая точка не изменяется. (См. рис. 2 ниже) Нет никаких признаков того, где In-Place панель ввода и значок In-Place панели ввода могут быть местами, а приложения, вызывающие эти методы, должны держать их на экране. Оба метода являются синхронными, то есть размещение происходит перед возвратом метода. Если панель ввода уже открыта в режиме плавающего или закрепленного взаимодействия, попытка позиционирования In-Place панели ввода или значка In-Place панели ввода завершается ошибкой. Кроме того, методы завершаются ошибкой, если окно, присоединенное к объекту [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , в настоящее время не имеет фокуса.

Вызов [**сетинплацепоситион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplaceposition) или [**сетинплацеховертаржетпоситион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplacehovertargetposition) не приводит к автоматической появлению In-Place панели ввода или значка панели ввода, он просто задает расположение для следующего отображения. Вызов [**сетинплацевисибилити**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-setinplacevisibility) можно использовать для немедленного отображения.

![размеры панели ввода на месте](images/0c67a77a-5d2f-489f-9357-b8a168d024d3.jpg)

При размещении In-Place панели ввода, чтобы определить, будет ли она отображаться на экране, может быть немного сложнее. Чтобы упростить этот процесс, существует несколько свойств объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , которые можно использовать для упрощения этого процесса. Вместе эти свойства и события можно использовать для определения точного размера In-Place панели ввода во всех ее состояниях:

-   [**Инплацебаундингректангле**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_inplaceboundingrectangle)— это свойство предоставляет ограничивающий прямоугольник для In-Place панели ввода, когда отображается самая большая область ввода для текущего языка ввода. Если панель рукописного ввода или панель символов определяется самой крупной входной областью, то будет добавлена Высота кнопки Вставить. Он не включает высоту для этого исправления. При автоматическом увеличении панели ввода In-Place [](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacesizechanging)  /  инициируется пара событий [**инплацесизечанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacesizechanged) , а значение этого свойства обновляется для включения дополнительной области ввода или записи.
-   [**Попупкорректионхеигхт**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_popupcorrectionheight)— это свойство определяет высоту раскладки исправлений после вставки, когда она располагается над панелью ввода. Чтобы получить полную высоту панели ввода In-Place с извлеченным объединением исправлений после вставки, добавьте высоту [**инплацебаундингректангле**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_inplaceboundingrectangle) в **попупкорректионхеигхт**.

В качестве более простой альтернативы заданию абсолютного расположения панели ввода In-Place и значка панели ввода, приложение может просто указать, будет ли панель ввода In-Place по умолчанию отображаться выше или ниже поля ввода текста. Таким образом, можно избежать перекрытия элементов в макете приложения с более слабо управляемым способом. Для этого приложение устанавливает для [**преферрединплацедиректион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_preferredinplacedirection) значение **Инплацедиректион \_ Bottom** или **инплацедиректион \_ Top**. Свойство является предпочтением, поскольку панель ввода In-Place переопределяет настройки, заданные приложением при необходимости для сохранения панели ввода на экране. По умолчанию система принимает на себя размещение In-Place панели ввода под текстовым полем, если это возможно, и в противном случае, чтобы разместить его выше. При задании для **преферрединплацедиректион** значения **инплацедиректион \_ Автоматическое** восстановление системы по умолчанию.

Вместе свойства, методы и события объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) дают разработчикам необходимый контроль над In-Place панели ввода, чтобы иметь возможность разумно располагать In-Place панель ввода и значок панели ввода в макете приложения, чтобы они не нарушают поток макета, а в некоторых случаях могут быть интегрированы. Этот новый уровень управления — это большой выигрыш в разработке приложений для планшетов.

## <a name="access-to-the-three-input-panel-areas-writing-pad-character-pad-and-keyboard"></a>Доступ к трем областям ввода: панель ввода, панель символов и клавиатура

Панель ввода имеет три области ввода: панель ввода, панель символов и клавиатуру. С помощью объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) приложение может указать область ввода по умолчанию, отображаемую пользователю при открытии панели ввода. Основная причина, по которой приложение сделает это, — это связать область ввода с типом ввода конкретного поля. Например, панель рукописного ввода, вероятно, лучше всего подходит для заполнения поля комментариев, но клавиатура может оказаться более удобной для ввода серийного номера продукта, который содержит как цифры, так и буквы. Чтобы указать область ввода по умолчанию, приложения устанавливают для свойства [**дефаултинпутареа**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinputarea) одну из трех областей ввода, как определено в перечислении [**панелинпутареа**](/windows/win32/api/peninputpanel/ne-peninputpanel-panelinputarea) . На следующем рисунке показаны три области ввода.

![запись, символ и панель ввода с клавиатуры](images/3f1e3d03-88b9-478c-b12d-00d341bc8d5c.jpg)

Системная область ввода по умолчанию — это панель для письма на английском, французском, немецком, испанском, итальянском, португальском, нидерландском и других языках ввода латиницы. Для языков ввода Восточной Азии, включая японский, китайский и корейский, область ввода по умолчанию является панелью символов. Однако при изменении пользователем области ввода он переопределяет область ввода по умолчанию для текущего языка ввода и сохраняется как новое значение по умолчанию для этого языка ввода. Клавиатура является областью ввода по умолчанию для полей пароля, независимо от языка ввода, если защита паролей не отключена пользователем или групповой политикой. Во всех случаях настройка области панели ввода по умолчанию программным способом переопределяет систему по умолчанию, если только текущее поле не является полем пароля или распознаватель рукописного ввода для текущего языка ввода не поддерживает программно выбранную область ввода. При установке для свойства [**дефаултинпутареа**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinputarea) значения **инплацедиректион \_ Автоматическое** восстановление параметров системы по умолчанию.

Независимо от того, была ли настроена область панели ввода по умолчанию программно, пользователь может изменить текущую область панели ввода после открытия панели ввода. После того как пользователь изменит текущую область ввода, выбор пользователя сохраняется до тех пор, пока панель ввода не закроется, или пользователь снова изменит выделение. После закрытия и повторного открытия панели ввода программно задается переопределение области ввода по умолчанию.

Так как текущая область панели ввода может отличаться от области панели ввода по умолчанию, приложение может запросить свойство [**куррентинпутареа**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentinputarea) , чтобы определить, какая область ввода видима в данный момент. Если панель ввода в настоящее время не видна, текущая область ввода равна области ввода по умолчанию. Свойство **куррентинпутареа** никогда не равно значению **панелинпутареа \_ Auto**. Если [**дефаултинпутареа**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_defaultinputarea) равен **панелинпутареа \_ Auto**, то **куррентинпутареа** равен последней отображаемой области ввода или по умолчанию системы для текущего языка ввода, если панель ввода никогда не отображалась.

Основное различие между поддержкой области ввода, обнаруженным в объекте [**пенинпутпанел**](peninputpanel-class.md) и объектом [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , заключается в том, что приложение теперь имеет возможность установить область ввода по умолчанию на панель символов, а также панель рукописного ввода и клавиатуру.

С помощью приведенных выше свойств приложение может управлять областью ввода входных данных панели ввода, отображаемой в разных полях, и оптимизировать интерфейс ввода текста пользователем. Кроме того, приложение может поддерживать осведомленность о текущей области ввода и принимать условные решения в соответствии с тем, какая область ввода лучше всего подходит для текущей задачи пользователя.

## <a name="detailed-information-about-input-panels-interaction-mode"></a>Подробные сведения о режиме взаимодействия панели ввода

Чтобы обеспечить возможность обнаружения текущей входной области панели ввода, можно также обнаружить текущий режим взаимодействия: "на месте", "закреплено" или "плавающее". Может быть важно, чтобы приложение знало о текущем режиме взаимодействия, чтобы понять, как пользователь взаимодействует с приложением, или потому, что некоторые методы и свойства объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) применимы только к режиму взаимодействия In-Place. Например, в приложении компонент переносит существующие элементы пользовательского интерфейса, а затем позиционирует панель ввода In-Place на пустую область в своих пользовательских интерфейсах. прежде чем вносить изменения, убедитесь, что текущий режим взаимодействия находится на месте.

![закрепленные, плавающие и сквозные режимы панели ввода](images/98c8e96b-99b2-477a-9843-33b1fae7e75b.jpg)

Свойство [**куррентинтерактионмоде**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentinteractionmode) объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) сохраняет текущий режим взаимодействия в соответствии с выбранным пользователем. Возможные режимы определяются перечислением [**интерактионмоде**](/windows/win32/api/peninputpanel/ne-peninputpanel-interactionmode) следующим образом:

**Интерактионмоде \_ Place**— на панели ввода In-Place взаимодействия отображается рядом с полем ввода текста, которое в данный момент находится в фокусе. По умолчанию значок панели ввода In-Place появляется, когда точка вставки помещается в поле ввода текста. Касание на значке панели ввода вызывает расширение панели ввода. Панель ввода In-Place видна только в том случае, если точка вставки находится в редактируемом поле.

Интерактионмоде \_ float — режим с плавающей взаимодействием аналогичен режиму взаимодействия «на месте», за исключением того, что он не привязан к точке вставки. Панель плавающего ввода открывается путем касания на вкладке Панель ввода, которая по умолчанию отображается в левой части экрана. И панель плавающего ввода, и вкладка «Панель ввода» можно перетаскивать и перемещать с помощью пользователя. В режиме плавающего режима позиционирование и управление панелью ввода полностью оставлены пользователю.

Интерактионмоде \_ доккедтоп — в верхней части экрана отображается панель ввода Docked-Top взаимодействие, и изменяется размер активного рабочего стола, поэтому панель ввода не пересекается с другими окнами или элементами пользовательского интерфейса. В закрепленном режиме панель ввода нельзя перетаскивать или перемещать вокруг.

Интерактионмоде \_ доккедботтом — режим взаимодействия Docked-Bottom совпадает с режимом Docked-Top, за исключением того, что в нижней части экрана отображается панель ввода.

Если панель ввода не отображается, текущий режим взаимодействия выполняется на месте.

Публикация текущей модели взаимодействия — еще один способ, которым объект [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) предоставляет дополнительные сведения о состоянии панели ввода, чем было доступно в любой предыдущей версии.

## <a name="detailed-information-about-input-panels-correction-mode"></a>Подробные сведения о режиме исправления панели ввода

Последним аспектом панели ввода, который объект [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) предоставляет подробную информацию о и контроле, является режим исправления. Знание режима исправления помогает приложениям определить текущий размер панели ввода. Управление способом исправления после вставки в приложении — один из способов настройки процесса исправления в приложении.

Существует два основных режима, в которых может отображаться объединение исправлений: перед вставкой и после вставки. Объединение исправлений перед вставкой используется для исправления текста, прежде чем вставить его в приложение. Он активируется, коснувшись ожидающего текста, который отображается под базовым планом на панели рукописного ввода в качестве красок пользователя. Объединение исправлений после вставки используется для исправления текста после его вставки в приложение. Он активируется путем помещения курсора вставки в или выбора ранее вставленного текста. Помимо двух основных режимов существует несколько вариантов того, как может выглядеть объединение исправлений после вставки. Сначала он может располагаться выше или под панелью ввода, а второй — свернутым или развернутым. В свернутом состоянии объединение исправлений после вставки показывает только список вариантов. В развернутом состоянии оно содержит как альтернативы, так и область для перезаписи слова.

![«Объединение исправлений», «пред» и «POST inserted Input Panel»](images/6cc627de-fc15-4721-9f6a-7e1517d9e650.jpg)

Свойство [**курренткорректионмоде**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentcorrectionmode) позволяет приложению определить текущую конфигурацию в процессе исправления. Возможные значения этого свойства, определенные перечислениями [**корректионмоде**](/windows/win32/api/peninputpanel/ne-peninputpanel-correctionmode) : **нотвисибле**, **INSERT**, **постинсертионколлапсед** и **постинсертионекспандед**. Если панель ввода или объединение исправлений не видны, **курренткорректионмоде** имеет значение **нотвисибле**.

По умолчанию в системе отображается объединение исправлений после вставки, развернутое при выборе подходящего текста и показывающих, что точка вставки помещается в исправленный текст. Приложение может указать, где разворачивание исправлений после вставки должно быть всегда развернуто, установив для свойства [**експандпостинсертионкорректион**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_expandpostinsertioncorrection) **значение true**. По умолчанию система имеет **значение false**. Если свойство **експандпостинсертионкорректион** используется совместно с интерфейсом [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion) , разработчик приложения может с легкостью добавить поддержку исправления в приложения, которые не могут получить его автоматически.

Отслеживание и управление состоянием исправления панели ввода является одной из многих новых возможностей объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , которые делают возможным более тесную панель ввода и интеграцию приложений.

## <a name="event-notification-before-and-after-the-event-occurs"></a>Уведомление о событии до и после наступления события

Другим аспектом программирования панели ввода, который значительно улучшен в объекте [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) , является модель событий. Теперь вместо того, чтобы вызывать события, которые сообщают об изменении состояния панели ввода после изменения, существуют отдельные события, отправленные до и после изменения. События, указывающие на начало события, содержат приведенные глаголы, например "изменение" или "Вставка", тогда как события задают заключение о событии, содержат прошедшее время выполнения команд, например "Changed" или "inserted".

Эта модель событий позволяет приложению реагировать на изменение до или после того, как оно произошло. Работа панели ввода заблокирована после изменения или возобновления после изменения, пока не будут завершены обработчики событий для всех событий. Эти события являются синхронными, и таким образом приложение может отложить изменение до тех пор, пока оно не будет завершено. Однако время, когда обработчик событий выполняет панель ввода, становится недоступным для пользователя и может перестает быть зависла, поэтому очень важно, чтобы обработчик событий был хорошо работать. Однако приложение не может предотвратить или отменять событие. Все параметры событий доступны только для чтения. Ниже приведено описание шести пар событий объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) :

-   [**Инплацестатечангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacestatechanging)  /  [**Инплацестатечанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacestatechanged)— уведомление о том, что состояние «на месте» равно или было просто переключено с наведения на «развернуто» или наоборот. Параметры — это новое и старое состояние на месте. Совпадений с изменением значения свойства [**куррентинплацестате**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentinplacestate) .
-   [**Инплацесизечангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacesizechanging)  /  [**Инплацесизечанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacesizechanged)— указывается, когда размер панели ввода In-Place собирается измениться или измениться из-за изменения размера пользователя, автоматического увеличения размера или области ввода. Параметры — это новый и старый ограничивающий прямоугольник. Совпадений с изменением значения свойства [**инплацебаундингректангле**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_inplaceboundingrectangle) .
-   [**Инпутареачангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inputareachanging)  /  [**Инпутареачанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inputareachanged)— сообщает, когда область ввода панели ввода собирается изменить или измениться с на другую из трех возможных областей ввода: Writing Pad, панель символов или клавиатура. Параметры — это новая и старая область ввода. Совпадает с изменением значения свойства [**куррентинпутареа**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentinputarea)
-   [**Корректионмодечангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-correctionmodechanging)  /  [**Корректионмодечанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-correctionmodechanged)— уведомление о том, что режим исправления скоро изменится или изменился. Возможны следующие режимы исправления: невидимые, предварительные вставки, после вставки и развернутые после вставки. Параметры — это новый и старый режим исправления. Совпадает с изменением значения свойства [**курренткорректионмоде**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpanel-get_currentcorrectionmode) .
-   [**Инплацевисибилитичангинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacevisibilitychanging)  /  [**Инплацевисибилитичанжед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-inplacevisibilitychanged)— указывает, когда видимость панели ввода In-Place будет изменена или изменилась. Параметры — это новая и старая видимость. Новая видимость **false** означает, что In-Place панель ввода не открыта, но не препятствует отображению панели ввода в режиме взаимодействия с плавающей или закрепленной.
-   [**Текстинсертинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-textinserting)  /  [**Текстинсертед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-textinserted)— указывает, когда текст будет вставлен или вставлен из панели ввода. Параметр — это массив объектов [**инкдисп**](inkdisp-class.md) , каждый из которых содержит строку рукописных данных и текста, составляющих вставку. Дополнительные сведения об этом событии см. в следующем разделе.

Эти события предоставляют приложениям важнейшую информацию об изменениях на панели ввода и позволяют им реагировать соответствующим образом. Опять же, изменение в модели событий панели ввода представляет собой шаг к более эффективному взаимодействию между приложениями и панелью ввода.

## <a name="support-for-collecting-the-ink-and-text-entered-in-input-panel"></a>Поддержка для сбора рукописного ввода и текста, введенного на панели ввода

Последнее, безусловно, некоторая, по крайней мере, одна очень мощная новая функция объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) — возможность получения объекта рукописного ввода для текста, введенного с помощью панели ввода, за пределами панели ввода во время вставки текста в приложение. Эта функция часто была запрошена в целях отслеживания изменений и сохранения записей. Это также позволяет приложениям использовать рукописный ввод в пользовательском интерфейсе как статический элемент или с пользовательской поверхностью рукописного ввода.

Чтобы получить объект [**инкдисп**](inkdisp-class.md) для текста, введенного через панель ввода, приложение должно зарегистрироваться для получения событий [**текстинсертинг**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-textinserting) или [**текстинсертед**](/windows/desktop/api/peninputpanel/nf-peninputpanel-itextinputpaneleventsink-textinserted) , созданных объектом [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) . Событие **текстинсертинг** срабатывает непосредственно перед вставкой текста из панели ввода в приложение, и текст не вставляется до тех пор, пока все обработчики событий не будут завершены. Событие **текстинсертед** срабатывает сразу после вставки теста. Единственным параметром для события **текстинсертинг** и **текстинсертед** является массив объектов **инкдисп** , который включает один объект **инкдисп** для каждой строки текста, вставленной из панели ввода. Примечание. панель ввода неактивна, пока обработчики событий выполняются и могут казаться недоступными для пользователя, поэтому важно сделать эти обработчики событий очень весомыми и обеспечить их быстрое выполнение. Кроме того, приложение не должно создавать обработчик для этого события, если только он не имеет определенного использования для информации, так как это связано с затратами на производительность. Панель ввода маршалирует данные рукописного ввода только в том случае, если приложение запрашивает данные, в противном случае панель ввода может пропустить эту дорогостоящую операцию. Параметры событий **текстинсертинг** и **текстинсертед** доступны только для чтения. Это означает, что в приложениях невозможно изменить вставленный текст перед вставкой в приложение.

Возможности, которые могут сделать приложения с этой новой функциональностью, являются широкими и не могут быть более простыми в использовании. разрешение распознавания текста и рукописного ввода, введенного с помощью панели ввода, для сбора приложений — это просто другой способ улучшения функциональности разработчика панели ввода в Windows Vista.

## <a name="conclusion"></a>Заключение

в целом, история программирования для панели ввода Tablet PC значительно улучшилась с введением объекта [**текстинпутпанел**](/windows/desktop/api/peninputpanel/nn-peninputpanel-itextinputpanel) в Windows Vista. С помощью объекта **текстинпутпанел** разработчики приложений имеют больший контроль и дополнительные сведения о панели ввода состояния в предыдущем выпуске. В результате разработчики приложений, создающие новые приложения для планшетных ПК или обновляя существующие приложения, настоятельно рекомендуют использовать объект **текстинпутпанел** вместо устаревшего объекта [**пенинпутпанел**](peninputpanel-class.md) . Кроме того, поддержка новых функций, таких как абсолютное позиционирование панели ввода и значка панели ввода, а также способность приложения принимать текст распознавателя и рукописный ввод, введенные с помощью панели ввода, обеспечивают новые функциональные возможности приложения и сценарии. Включение этих функций и несколько других пользователей в прямой ответ на Отзывы разработчиков и помечают первые шаги для полной интеграции панели ввода с приложениями для планшетных ПК. В конечном итоге, расширение функциональности приложений для планшетных ПК — это большой выигрыш как для разработчиков приложений, так и для платформы Tablet PC.

 

 



