---
description: Панель ввода Microsoft Tablet PC — это мощный инструмент для ввода рукописного текста с помощью пера и исправления текста без использования клавиатуры.
ms.assetid: c45ac1b5-7713-4bcb-a130-4692cff99aa2
title: Включение исправления текста для пользовательских сборов рукописных данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: accb0bf2129a4e93e543e3ec5cc73d3e65383dc57b581114f30e812b1ac88b8a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119940840"
---
# <a name="enabling-text-correction-for-custom-ink-collectors"></a>Включение исправления текста для пользовательских сборов рукописных данных

Панель ввода Microsoft Tablet PC — это мощный инструмент для ввода рукописного текста с помощью пера и исправления текста без использования клавиатуры. При использовании панели ввода пользователь вводит текст путем ввода текста на поверхности рукописного ввода, что заставляет панель ввода распознавать рукописный ввод пользователя как текст. После того как текст будет распознан, пользователь нажмет «вставить» на панели ввода, чтобы вставить текст в приложение или документ. Перед вставкой текста пользователь имеет доступ к набору средств исправления на панели ввода. В их число входит выбор альтернативного результата распознавания, возможность перезаписи одного символа или даже для вычеркивания всего слова и перезаписи. Эти средства исправления позволяют пользователю исправить как ошибки распознавания, так и человеческие ошибки.

после того, как текст, введенный с помощью панели ввода, находится в документе, пользователи получают доступ к тем же функциям исправления, которые доступны до вставки Windows приложений, основанных на [платформах текстовых служб](/windows/desktop/TSF/text-services-framework)и приложениях с поддержкой текстовых служб. начиная с Microsoft Windows XP с пакетом обновления 2 (sp2) Tablet PC Edition все приложения с богатыми возможностями редактирования являются текстовыми службами. по умолчанию, и начиная с Windows Vista, HTML-приложения — это текстовые службы, включенные по умолчанию. Исправление в документе доступно только в приложениях, основанных на службах текста и поддерживающих текстовые службы. Это обусловлено тем, что панель ввода зависит от возможности службы текста для хранения связанных текстовых свойств, включая рукописные объекты и варианты распознавания, чтобы обеспечить возможность внесения изменений в документ.

![панель ввода Tablet PC с исправлением текста](images/a0dced5e-16de-410b-965f-5d97d297cee5.jpg)

Однако существует множество сценариев, в том числе исправление распознавания речи или исправления введенного текста в дороге, которые не начинаются с текстового ввода с помощью панели ввода, но для пользователей планшетных ПК может оказаться очень полезным исправление в документе. Простым примером является использование приложений, предоставляющих пользовательские поверхности рукописного ввода для ввода текста с помощью пера. Пользовательские поверхности рукописного ввода — это отличный способ предоставить приложениям уникально специализированную функциональность, относящуюся к задачам ввода текста для каждого приложения. Кроме того, пользовательские поверхности для рукописного ввода предоставляют полностью интегрированный пользовательский интерфейс Tablet PC, что делает его более четким, чем первое устройство ввода в приложениях, содержащих их. Однако приложения, предоставляющие пользовательские поверхности для рукописного ввода, могут не допускать и не предоставлять такой же уровень поддержки исправлений, который доступен при исправлении в документе на панели ввода.

![Пользовательский сборщик рукописных данных](images/b6797b12-dda6-44c4-87f4-570fe0c23f3a.jpg)

Приложения, основанные на текстовых службах, в которых функция исправления в документе полезна для исправления текста, не введенного с помощью панели ввода, может использовать [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion) API панели ввода (класс [Microsoft. TextInput. хандвриттентекстинсертион](/previous-versions/ms573516(v=vs.100)) в управляемом коде) для включения исправления в документе для текста, введенного другими средствами. Таким образом, приложения могут в значительной мере добавить мощную поддержку исправления для собственных поверхностей рукописного ввода или других сценариев ввода текста, а также округлить историю ввода текста Tablet PC. API панели ввода ихандвриттентекстинсертион входит в состав операционной системы Windows Vista и в составе пакета SDK для платформы планшетов версии 1,9 или более поздней. Включены версии API на основе .NET и COM. включение исправления в документе для текста, не введенного с помощью панели ввода, поддерживается в Windows Vista и более новых версий. Исправление в документе доступно только для латинских языков и не может отображать любой символ за пределами Латинской кодировки.

## <a name="how-to-use-the-handwrittentextinsertion-api-in-an-application"></a>Как использовать API Хандвриттентекстинсертион в приложении

Необходимые изменения в приложении, позволяющие интегрировать панель ввода в документ исправление для текста, не введенного с помощью панели ввода, и использовать API [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion) очень просто. Все пользовательские коды ввода текста в приложении остаются без изменений, за исключением последнего шага. В момент, когда текст, указанный с помощью пользовательской области рукописного ввода, распознавания речи или других средств, отображается в текстовом поле Text Services Enabled (текстовые поля с поддержкой текста), приложение отправляет текст в интерфейс **ихандвриттентекстинсертион** , а не отправляет его непосредственно в текстовое поле. Затем компонент программируемой панели ввода обрабатывает вставку текста в текстовое поле и в резервное хранилище текстовых служб. При добавлении текста в резервное хранилище текстовых служб компонент "программирование" панели ввода обрабатывает свойства текста, необходимые для панели ввода для исправления в документе, которое должно быть включено для этого текста.

В следующем разделе подробно описывается этот процесс для приложения C++, использующего COM-версию API [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion) . существуют примечания в любом месте, где вы используете версию платформа .NET Framework API в языке C, \# отличаются для использования версии COM в C++. Управляемый API **хандвриттентекстинсертион** включает один COM-интерфейс **ихандвриттентекстинсертион**. Определение этого интерфейса находится в Пенинпутпанел. h и Пенинпутпанел \_ i.c.

Во первых, приложение должно использовать функцию [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) для создания экземпляра [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion) с идентификатором класса **CLSID \_ хандвриттентекстинсертион**. Обратите внимание, что создание объекта **CLSID \_ хандвриттентекстинсертион** будет выполнено только после создания окна и получения фокуса, так как пока не будет активировано резервное хранилище текстовых служб. Кроме того, если tiptsf.dll отсутствует в системе, функция **CoCreateInstance** завершается с ошибкой и возвращает **регдб \_ E \_ класснотрег**, что указывает на то, что в системе не поддерживается исправление в документе для панели ввода. На этом этапе приложение должно быть продолжено без попытки включить исправление для панели ввода в документе. Экземпляр **хандвриттентекстинсертион** должен быть доступен из кода приложения, который обрабатывает вставку текста в текстовое поле.

> [!Note]  
> при работе с платформа .NET Frameworkной версией API приложение должно добавить инструкцию using, чтобы разрешить доступ к пространству имен [Microsoft. Ink. TextInput](/previous-versions/dotnet/netframework-3.5/ms581554(v=vs.90)) , а затем создать объект напрямую.

 

Во-вторых, код приложения, отвечающий за вставку текста в текстовое поле, должен быть изменен таким образом, чтобы он больше не вставил текст в текстовое поле, но вместо этого вызывается один или второй из двух методов вставки [**ихандвриттентекстинсертион**](/windows/desktop/api/peninputpanel/nn-peninputpanel-ihandwrittentextinsertion). Должны ли приложения вызывать [**инсертрекогнитионресултсаррай**](/windows/desktop/api/peninputpanel/nf-peninputpanel-ihandwrittentextinsertion-insertrecognitionresultsarray) или [**инсертрекогнитионресултс**](/windows/desktop/api/peninputpanel/nf-peninputpanel-ihandwrittentextinsertion-insertinkrecognitionresult) , зависит от того, имеет ли приложение варианты распознавания для текста, хранящегося как массив или как объект [**иинкрекогнитионресулт**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult) .

> [!Note]  
> При работе в управляемом коде соответствующий объект поощрения, используемый Инсертрекогнитионресултсаррай, — это [рекогнитионресулт](/previous-versions/ms552537(v=vs.100)). Оба метода используют следующие три параметра:

 

-   *альтернативные варианты* — Это многомерная коллекция строк, сохраненная либо в виде массива массивов, либо в виде объекта [**иинкрекогнитионресулт**](/windows/desktop/api/msinkaut/nn-msinkaut-iinkrecognitionresult) (или [рекогнитионресулт](/previous-versions/ms552537(v=vs.100))). Если альтернативные варианты хранятся в виде массива массивов, то они должны передаваться как указатель безопасного массива. Каждая запись в массиве верхнего уровня представляет собой список вариантов для одного слова в вставке. Запись в позиции нуль в подмассивах альтернативы — это текст, вставляемый в текстовое поле. Дополнительные варианты (индексы 1 – n в каждом подмассиве) хранятся в резервном хранилище текстовых служб и предлагаются пользователю в качестве параметров в процессе исправления в документе. Если альтернативы не включены, пользователь увидит вместо списка вариантов вариант "без предложения". Если вставка содержит несколько слов с пробелами, то каждое пространство должно быть указано в качестве записи в массиве верхнего уровня.
-   *языковая* [Код](/previous-versions/ms221397(v=vs.71)) языка ввода, соответствующий тексту, содержащемуся в параметре " *альтернативные* ". В случае, когда содержимое *альтернативы* было создано распознавателем рукописного ввода или распознавания речи, это также свойство [**Languages**](/windows/desktop/api/msinkaut/nf-msinkaut-iinkrecognizer-get_languages) , связанное с используемым распознавателем.
-   *флаттицеконтаинсаутоспаЦингинформатион* Флаг, указывающий, был ли текст, содержащийся в параметре *alternate* , создан распознавателем с включенным автоматическим промежутком. Если включен автоматический отступ, то флаг должен иметь значение **true**. Если автоматическое разделение отключено, то флагу должно быть присвоено значение **false**. В случае, когда содержимое *альтернативных* элементов было создано распознавателем, который не поддерживает автоматическое создание интервалов или не был создан распознавателем, то флаг должен иметь значение **false**.

Модель программируемости панели ввода может вставить текст в документ или приложение из позиции системного курсора.

При успешном вставке оба метода возвращают значение **S \_ ОК** . Они возвращают **E без \_ интерфейса** , если приложение не основано на текстовых службах и не включено, а **E \_ INVALIDARG** , если *варианты* неверно форматированы или недоступны. Они также могут возвращать **E \_ OUTOFMEMORY** , если в системе не хватает памяти **, или после неустранимого сбоя, \_ например** при отключении платформы текстовых служб.

### <a name="conclusion"></a>Заключение

Включение исправления в документе на панели ввода для текста, не введенного с помощью панели ввода, является недорогым и простым способом для приложения, основанного на текстовых службах или поддерживающего пользовательскую функцию рукописного ввода или входа с мощными функциями исправления на основе пера. в Windows Vista все приложения с богатыми возможностями редактирования и Trident являются включенными текстовыми службами. В то время как встроенные поверхности рукописного ввода являются отличным вариантом для добавления пользовательского интерфейса Tablet PC в приложение, они поддерживают только половину текстового ввода, если они не включают возможности исправления. Функция исправления в документе позволяет пользователям с другой половиной, добавив возможность поменять местами выбранный вариант распознавания или переписать часть или весь выбор.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Программирование панели ввода текста](programming-the-text-input-panel.md)
</dt> </dl>

 

 
