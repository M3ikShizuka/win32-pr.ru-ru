---
description: Отслеживание COM+
ms.assetid: ad3bdeb5-f303-411a-abfb-ccde3f9a86b9
title: Отслеживание COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 069d910f0c559776125342b861e71566fb20f45231f960b1c1dcb18262171926
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120029494"
---
# <a name="com-tracking"></a>Отслеживание COM+

Служба отслеживания COM+ позволяет создавать собственные программы администрирования и диагностики, которые отслеживают состояние и производительность выполняющихся приложений COM+. Отслеживание COM+ предоставляет статистические сведения об использовании приложений COM+, а также сведения о состоянии, например о том, приостановлен ли экземпляр серверного приложения COM+ или он был перезапущен. Средства могут использовать данные отслеживания в диагностической диагностике или в целях показа. Например, средство администрирования "службы компонентов" использует отслеживание COM+ для просмотра состояния экземпляров приложений COM+ в приложениях COM+ и запуска процессов.

Отслеживание COM+ вычисляет и периодически обновляет набор часто используемых метрик, делая эту информацию доступной для программ, которым она необходима. Он похож на инструментирование COM+ в том, что обе службы автоматически собираются данные из экземпляров приложений COM+ и делают эти данные доступными для потребителей. Однако существует ряд важных различий между этими службами, как в предоставленной функциональности, так и в типичном использовании. Эти различия обобщены в следующей таблице.



| Инструментарий COM+                                                                                                                                                                                                   | Отслеживание COM+                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Детализированные данные. Служба инструментария COM+ уведомляет зарегистрированных подписчиков отдельных дискретных событий (например, вызванный метод, уничтоженный объект), происходящий в экземпляре приложения COM+.<br/> | Статистические данные. Отслеживание COM+ вычисляет и периодически обновляет часто используемые метрики для состояния и производительности экземпляров приложений COM+.<br/> |
| Подписчики на события обычно рассчитывают метрики самостоятельно, используя специальные алгоритмы и политики.<br/>                                                                                                           | Метрики рассчитываются автоматически службой отслеживания COM+. Все потребители получают одни и те же данные, без поддержки пользовательских метрик.<br/>                |
| После регистрации подписки потребитель не получает никаких сведений об экземпляре приложения COM+, пока не произойдет событие.<br/>                                                                    | Данные отслеживания для всех экземпляров приложений COM+ могут быть получены в любое время.<br/>                                                                         |
| Поддерживает только механизм подписки на основе событий COM+ для потребителей.<br/>                                                                                                                                     | Поддерживает как механизм подписки COM+ на основе событий, так и опрос в интерфейсе локального сервера COM.<br/>                                                  |
| Примеры                                                                                                                                                                                                               |                                                                                                                                                                   |
| Уведомления при вызове или возврате метода.<br/>                                                                                                                                                           | Среднее время ответа вызова, количество вызовов методов, успешно выполненных или завершившихся сбоем за последний период времени, число объектов, находящихся в данный момент в вызове метода.<br/>     |
| Уведомления при добавлении объекта в пул объектов или получении из него.<br/>                                                                                                                                  | Количество объектов в пуле, общее число объектов.<br/>                                                                                                |
| Уведомления при запуске, приостановке или перезапуске серверного приложения COM+.<br/>                                                                                                                               | Состояние процесса серверного приложения COM+ (например, является ли он приостановленным или перезапущенным).<br/>                                                         |
| Уведомления о событиях запуска, подготовки, прерывания и фиксации транзакций.<br/>                                                                                                                                      | Эквивалент отсутствует.<br/>                                                                                                                                         |
| Уведомления об успешных и неудачных попытках проверки подлинности на уровне вызовов методов.<br/>                                                                                                                           | Эквивалент отсутствует.<br/>                                                                                                                                         |



 

Хотя отслеживание COM+ более ограничено с точки зрения области данных и гибкости при вычислении метрик, предоставляемые им метрики должны быть достаточными для широкого спектра административных и диагностических программ. Использование отслеживания COM+, по возможности, может упростить разработку этих программ. Кроме того, использование отслеживания COM+ в рабочих системах может существенно снизить производительность, что делает ее более подходящей для средств мониторинга в реальном времени.

## <a name="how-com-tracking-collects-data"></a>Как отслеживание COM+ собирает данные

При запуске процесса серверного приложения COM+ COM+ регистрирует процесс на *сервере Tracker*, компоненте системного приложения. Компоненты в приложениях и службах библиотеки COM+, не поддерживающих контексты Components (SWC), также поддерживают отслеживание. Когда в процессе создается компонент библиотеки или контекст SWC, COM+ регистрирует процесс на сервере мониторинга, если он еще не был зарегистрирован.

COM+ обновляет статистику для отслеживающего процесса при возникновении определенных событий в процессе, например при создании объекта или завершении вызова метода. Обновленные данные периодически передаются на сервер Tracker, после чего они становятся доступными для потребителей. Сервер отслеживания также отвечает за вычисление некоторых метрик, используемых функциями перезапуска приложений COM+ и мониторинга зависания. Эти данные также доступны для потребителей.

Данные отслеживания упорядочены в соответствии с процессом, создавшим данные. Данные на уровне отдельных приложений или компонентов COM+ в процессе также доступны для потребителей, которым требуются эти сведения.

## <a name="events-versus-polling"></a>События и опрос

Отслеживание COM+ поддерживает два механизма для получения данных отслеживания от сервера отслеживания, механизма подписки COM+ на основе событий и интерфейса локального сервера COM.

Программы, требующие периодического уведомления с обновленными данными отслеживания, могут зарегистрировать подписку для интерфейса событий [**икомтраккингинфоевентс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfoevents) . Примерно каждые три секунды сервер отслеживания вызывает метод [**икомтраккингинфоевентс:: онневтраккингинфо**](/windows/desktop/api/ComSvcs/nf-comsvcs-icomtrackinginfoevents-onnewtrackinginfo) каждого подписчика, отправляя последние данные отслеживания в виде объекта коллекции. Этот объект реализует интерфейс [**икомтраккингинфоколлектион**](/windows/desktop/api/ComSvcs/nn-comsvcs-icomtrackinginfocollection) , и подписчики могут перемещаться по этой коллекции для поиска интересующих вас данных.

По различным причинам может быть целесообразно, чтобы программа обратилась к серверу отслеживания для получения данных. Например, средство мониторинга может потребовать обновления гораздо реже, чем программа, отображающая состояние в пользовательском интерфейсе. Кроме того, программа может использовать только небольшую часть данных отслеживания, доступных для системы (например, средство может отслеживать только производительность экземпляров одного приложения COM+). Модель подписки отправляет каждому подписчику данные отслеживания для всех приложений COM+ в каждом уведомлении, и ответственность за поиск нужных данных отвечает подписчику. Наконец, события COM+ — это оптимальный механизм уведомления о событиях. Надежные службы доставки сообщений не предоставляются, и подписчику не удается обнаружить, что серверу-Tracker не удалось отправить ему уведомление.

Программа, которой требуется больший контроль над получением данных отслеживания, может использовать интерфейс [**ижетапптраккердата**](/windows/desktop/api/ComSvcs/nn-comsvcs-igetapptrackerdata) сервера отслеживания.

 

 




