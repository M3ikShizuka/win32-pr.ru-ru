---
description: Объекты, которые могут быть объединены в пул, должны отвечать определенным требованиям, чтобы обеспечить использование одного экземпляра объекта несколькими клиентами.
ms.assetid: 2cd4211e-be12-4197-8b43-5cb9f2321016
title: Требования к объектам в пуле
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78d6834210f180ad8b514b51b6926b5cd30714fd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990541"
---
# <a name="requirements-for-poolable-objects"></a>Требования к объектам в пуле

Объекты, которые могут быть объединены в пул, должны отвечать определенным требованиям, чтобы обеспечить использование одного экземпляра объекта несколькими клиентами.

## <a name="stateless"></a>Без отслеживания состояния

Для обеспечения безопасности, согласованности и изоляции объекты, которые могут быть помещены в пул, не должны содержать клиентское состояние от клиента к клиенту. Вы можете управлять любым состоянием каждого клиента с помощью [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), выполняя инициализацию, зависящую от контекста, с помощью [**IObjectControl:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) и очищаются все состояния клиентов с [**IObjectControl::D еактивате**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate). Дополнительные сведения см. в разделе [Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md).

## <a name="no-thread-affinity"></a>Без сходства потоков

Объекты, являющиеся пулами, не могут быть привязаны к определенному потоку; в противном случае производительность может быть катастрофой. По этой причине объекты, которые могут быть помещены в пул, нельзя помечать для выполнения в модели апартамента. они должны выполняться в многопоточном апартаменте или в нейтральном апартаменте. Кроме того, объекты, поддерживающие использование пула, не должны использовать локальное хранилище потока, а также не должны выполнять статистическое вычисление в свободном потоке. Дополнительные сведения о потоках в COM+ см. в разделе [модели потоков com+](com--threading-models.md).

> [!Note]  
> Среда разработки Microsoft Visual Basic 6,0 и более ранних версий может создавать только компоненты модели подразделения. Однако в Visual Basic .NET компоненты могут быть помещены в пул.

 

## <a name="aggregatable"></a>Aggregatable

Объекты, которые могут быть объединены в пул, должны поддерживать агрегирование, то есть они должны поддерживать создание путем вызова [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) с аргументом *пункаутер* , отличным от NULL. Когда COM+ активирует объект poold, он создает статистическое выражение для управления временем существования объекта poold и для вызова методов в [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol). Дополнительные сведения о создании статистически обрабатываемых объектов см. в разделе [агрегирование](/windows/desktop/com/aggregation).

## <a name="transactional-components"></a>Транзакционные компоненты

Объекты в пуле, участвующие в транзакциях, должны прикреплять управляемые ресурсы вручную. Если объект содержит управляемый ресурс, например подключение к базе данных, в пуле, то при активации объекта в заданном контексте диспетчер ресурсов не будет автоматически прикрепляться к транзакции. Таким образом, сам объект должен управлять логикой обнаружения транзакции, отключив автоматическое прикрепление Resource Manager и вручную прикреплять все удерживаемые ресурсы. Кроме того, объект в составе пула транзакций должен отражать текущее состояние его ресурсов в значениях параметров [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled). Дополнительные сведения см. в разделе [объединение транзакционных объектов в пул](pooling-transactional-objects.md).

## <a name="implement-iobjectcontrol-to-manage-the-object-lifetime"></a>Реализация IObjectControl для управления временем жизни объекта

Объекты в пуле должны реализовывать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol), хотя это не является строго необходимым. Однако транзакционные компоненты, которые входят в состав пула, должны реализовывать **IObjectControl**. Эти компоненты должны отслеживать состояние ресурсов, которые они хранят, и указывать, когда их нельзя использовать повторно; Когда [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) возвращает значение false, он повреждение транзакцию. Дополнительные сведения см. в разделе [Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md).

## <a name="language-restrictions"></a>Ограничения языка

Компоненты, разработанные с помощью Microsoft Visual Basic 6,0 и более ранних версий, не могут быть помещены в пул, поскольку эти компоненты будут потоковой моделью потоков. Однако в Visual Basic .NET компоненты могут быть помещены в пул.

## <a name="legacy-components"></a>Устаревшие компоненты

Если они не являются транзакционными и соответствуют соответствующим предыдущим требованиям, компоненты могут быть помещены в пул, даже если они не были специально написаны с учетом возможности объединения в пул. Нет необходимости реализовывать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol); компонент, который не делает этого, просто не будет участвовать в управлении временем существования. Если [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) не реализован, объект будет по-прежнему использоваться повторно, пока пул не достиг максимального размера.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Строки конструктора объектов COM+](com--object-constructor-strings.md)
</dt> <dt>

[Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md)
</dt> <dt>

[Как работает пул объектов](how-object-pooling-works.md)
</dt> <dt>

[Повышение производительности с помощью пула объектов](improving-performance-with-object-pooling.md)
</dt> <dt>

[Группирование транзакционных объектов в пул](pooling-transactional-objects.md)
</dt> </dl>

 

 
