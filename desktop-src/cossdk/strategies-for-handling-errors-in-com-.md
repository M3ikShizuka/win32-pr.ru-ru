---
description: В этом разделе приведены несколько стратегий обработки ошибок, которые следует учитывать при разработке компонентов для COM+.
ms.assetid: 1ae5875b-8085-44f2-9071-c2a5d7543ac1
title: Стратегии обработки ошибок в COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4f89736f8a81e51150e9d2480c98c6e5859d9b280fc5f7cd96662f3b1b9f3e8a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119895704"
---
# <a name="strategies-for-handling-errors-in-com"></a>Стратегии обработки ошибок в COM+

В этом разделе приведены несколько стратегий обработки ошибок, которые следует учитывать при разработке компонентов для COM+.

-   **Возвращает значение HRESULT для всех методов во всех интерфейсах компонента.**  COM+ использует значения **HRESULT** для создания отчетов об ошибках, возникающих при вызове функций или вызовах методов интерфейса. **Значение HRESULT** указывает, завершился ли метод успешно или неудачно, и определяет связанное с ошибкой средство, например RPC, Win32 или ИТФ, для ошибок, связанных с интерфейсом. Кроме того, системные API-интерфейсы предоставляют Поиск из **HRESULT** в строку, описывающую условие ошибки. Использование методов, возвращающих значения **HRESULT** , является фундаментальным для хорошо написанных компонентов и является необходимым для процесса отладки. Microsoft Visual Basic автоматически определяет каждый метод с помощью **HRESULT** в качестве возвращаемого значения. в Microsoft Visual C++ необходимо явно вернуть **значение HRESULT**. Дополнительные сведения о HRESULT см. в разделе [структура кодов ошибок COM](/windows/desktop/com/structure-of-com-error-codes).
-   **Инициируйте объект коллекции ErrorInfo любым способом, предоставляемым вашим средством разработки.** Объекты коллекции [**errorInfo**](errorinfo.md) часто называются исключениями com, так как они позволяют объекту передавать (или создавать) подробные сведения об ошибках вызывающему объекту, даже через границы апартамента. Значение этого объекта общей ошибки заключается в том, что он дополняет значение HRESULT, расширяя тип сведений об ошибке, который можно вернуть вызывающему объекту. Каждый объект коллекции **errorInfo** Возвращает контекстное описание, источник ошибки и идентификатор интерфейса метода, который поступил к ошибке. Также можно включить указатели в запись в файле справки. Автоматизация предоставляет три интерфейса для управления объектом Error. Компонент должен реализовать интерфейс автоматизации **ISupportErrorInfo** , чтобы объявить его поддержку для коллекции **errorInfo** . При возникновении ошибки компонент использует интерфейс автоматизации **икреатирроринфо** для инициализации объекта ошибки. После того как вызывающий объект проверит значение HRESULT и обнаружит, что вызов метода завершился неудачно, он запрашивает объект, чтобы узнать, поддерживает ли он коллекцию **errorInfo** . Если это так, вызывающий объект использует интерфейс автоматизации **IErrorInfo** для получения сведений об ошибке. Visual Basic программисты имеют простой доступ к объекту коллекции **ErrorInfo** , который предоставляется через объект Err. Вы можете вызывать ошибки с помощью функции Err raise и перехватывать ошибки с помощью оператора **On Error** . уровень времени выполнения Visual Basic отвечает за сопоставление. Если вы используете Visual C++ поддержку COM-компилятора, можно использовать \_ \_ класс COM raise \_ Error для сообщения об ошибке и \_ \_ классе ошибок COM для получения сведений об ошибке. COM+ не распространяет традиционные исключения C++ как расширенные сведения о **IErrorInfo** . Дополнительные сведения об объекте коллекции **errorInfo** см. в разделе "обработка ошибок" в инструкции по автоматизации.
    > [!Note]  
    > COM требует, чтобы все объекты коллекции [**errorInfo**](errorinfo.md) маршалируются по значению, подразумевая, что компоненты, реализующие интерфейс автоматизации **IErrorInfo** , также должны реализовать и поддерживать интерфейс [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) . Реализация интерфейса **IMarshal** должна поддерживать маршалирование по значению для компонента.

     

-   **Используйте транзакции для управления сбоями общих ресурсов.** Автоматические транзакции могут значительно сократить объем кода обработки ошибок, который необходимо написать при использовании диспетчеров ресурсов, управляемых состоянием. Однако транзакции не устраняют необходимость в полной обработке ошибок. Вам по-прежнему необходимо вернуть коды ошибок из методов интерфейса и проверить эти коды ошибок в вызывающем объекте, чтобы избежать ненужной работы для поэтому транзакция завершается транзакции. Дополнительные сведения об объединении обработки ошибок с обработкой транзакций см. [в разделе ускорение транзакций путем уведомления корневого объекта](speeding-transactions-by-notifying-the-root-object.md).
-   **Явно вызывать ошибки.** Избегайте предоставления сведений об ошибках, если объект явно не вызывает ошибку. Перехватите все ошибки, сформированные средством, и обработайте их в коде компонента. По крайней мере, включите стандартный обработчик для согласованного сообщения о непредвиденных ошибках.
-   **\_Для сообщения об ошибках, связанных с интерфейсом, используйте диапазон ошибок ИТФ.** Ошибки, связанные с интерфейсом, должны находиться в \_ диапазоне итфи ошибок между 0x0200 и 0xFFFF. вы можете определить пользовательский код ошибки в Visual Basic как смещение от вбобжектеррор. Используйте макрос MAKE \_ HRESULT в C++, чтобы ввести код ошибки, зависящий от интерфейса, как показано в следующем примере:

    ``` syntax
    const HRESULT ERROR_NUMBER = MAKE_HRESULT (SEVERITY_ERROR, FACILITY_ITF, 10);
    ```

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Изоляция сбоев и политика FailFast](fault-isolation-and-failfast-policy.md)
</dt> <dt>

[Поиск источника ошибки](finding-the-source-of-an-error.md)
</dt> <dt>

[Изменение возвращаемых значений COM+](how-com--modifies-return-values.md)
</dt> <dt>

[Анализ кодов ошибок](interpreting-error-codes.md)
</dt> <dt>

[Устранение неполадок](troubleshooting.md)
</dt> </dl>

 

 
