---
description: Использование нетранзакционных компонентов в транзакции
ms.assetid: b83b4bab-1851-48dc-b35a-6467a6dff741
title: Использование нетранзакционных компонентов в транзакции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a75cd8ebc756971a56413e371cf23de2144e5816
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807894"
---
# <a name="using-non-transactional-components-in-a-transaction"></a>Использование нетранзакционных компонентов в транзакции

Часто бывает полезно поместить нетранзакционные компоненты в транзакцию, чтобы воспользоваться преимуществами [свойств ACID](acid-properties.md) транзакций. Например, при наличии нетранзакционных устаревших компонентов, используемых для обновления паролей в сети, эти компоненты можно поместить в транзакцию, чтобы обеспечить согласованность обновлений паролей по сети.

*Объект контекста транзакции* — это универсальный объект, позволяющий нетранзакционным клиентам объединять работу нескольких COM-объектов в одну транзакцию без необходимости разработки нового компонента специально для этой цели. В отличие от автоматической транзакции, объект контекста транзакции требует, чтобы его клиент явно зафиксировал или прервал транзакцию.

По умолчанию атрибут Transaction объекта контекста транзакции имеет значение Required. COM+ прерывает транзакцию, если клиент освобождает объект контекста транзакции без явного выполнения вызова Commit или Abort.

В следующем примере Visual Basic показано, как нетранзакционный клиент может составить работу, выполняемую более чем одним объектом, в одну транзакцию:


```VB
Dim objTxCtx As TransactionContext
Dim objCat As MyDLL.Ccat  ' Ccat is a user-defined component.
Dim objDog As MyDLL.Cdog  ' Cdog is a user-defined component.

' Get TransactionContext object.
Set objTxCtx = _
  CreateObject ("TxCtx.TransactionContext")

' Create instances of Cat and Dog.
Set objCat = _ 
  objTxCtx.CreateInstance ("MyDLL.Ccat")
Set objDog = _ 
  objTxCtx.CreateInstance ("MyDLL.Cdog")

' Both objects do work.
objDog.Bark
objCat.Hiss

' Commit the transaction.
objTxCtx.Commit

```



## <a name="limitations-of-the-transaction-context-object"></a>Ограничения объекта контекста транзакции

Ниже приведены некоторые важные ограничения объекта контекста транзакции.

-   При использовании объекта контекста транзакции логика приложения, объединяющая работу нескольких объектов в одну транзакцию, связана с определенной нетранзакционной реализацией клиента, и некоторые преимущества использования COM-компонентов теряются. Эти потерянные преимущества включают следующие.
    -   Возможность повторного использования логики приложения в рамках еще больших транзакций
    -   Ликвидация декларативной безопасности
    -   Гибкость запуска логики удаленно от клиента
-   Объект контекста транзакции выполняется в процессе с нетранзакционным клиентом, что означает, что COM+ должен быть доступен на нетранзакционном клиентском компьютере. Это может не быть проблемой, например, когда объект контекста транзакции используется на странице Active Server страниц (ASP), которая работает на том же сервере, что и COM+.
-   При создании объекта контекста транзакции контекст для нетранзакционного клиента не получается. Транзакционные операции можно выполнять только косвенно через COM-объекты, созданные с помощью объекта контекста транзакции. В частности, нетранзакционный клиент не может использовать распределителя ресурсов COM+ (например, ODBC) и включать работу в транзакцию. Например, разработчики могут ознакомиться со следующим синтаксисом для транзакционной работы в системах реляционных баз данных:

    ``` syntax
    BEGIN TRANSACTION
      DoWork
    COMMIT TRANSACTION
    ```

    Использование объекта контекста транзакции аналогичным образом не дает желаемого результата:

    ``` syntax
    Set objTxCtx = CreateObject ("TxCtx.TransactionContext")
      DoWork
      objTxCtx.Commit
    Set objTxCtx = Nothing
    ```

    Вызов DoWork в этом примере не прикреплен к транзакции. Вместо этого необходимо создать COM-компонент, который вызывает DoWork, создать экземпляр объекта этого компонента с помощью объекта контекста транзакции, а затем вызвать этот объект из нетранзакционного клиента, чтобы работа была частью транзакции, управляемой клиентом.

 

 



