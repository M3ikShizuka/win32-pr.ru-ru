---
description: Ошибки Server-Side
ms.assetid: ce8ddb52-237c-4d46-a088-9f592afadcd2
title: Ошибки Server-Side
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1522f1e4ca07a1a2bfc17273b331a7beb3efc67a8c3f9a90e925161949f694ca
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119793434"
---
# <a name="server-side-errors"></a>Ошибки Server-Side

Прослушиватель и проигрыватель работают вместе, чтобы работать с подозрительными сообщениями. Если происходит сбой транзакции, которая воспроизводится, [очередь сообщений](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) перемещает входное сообщение обратно во входную очередь. Проигрыватель прерывает транзакцию при получении ошибки HRESULT от серверного компонента или при перехвате исключения. Если проблема сохраняется, прослушиватель может непрерывно пройти по следующему шаблону:

-   Вывод сообщения из очереди
-   Создает экземпляр объекта
-   Пострадает откат
-   Помещает сообщение в начало очереди

Служба очередей компонентов обрабатывает этот сбой, используя ряд очередей повторных попыток для конкретного приложения. Созданные при установке компонента, существует семь очередей для каждого приложения, как показано ниже.

1.  Обычная входная очередь. Имя этой очереди — это имя приложения COM+. Это общая очередь очереди сообщений.

2.  Первая очередь повторных попыток. Сообщения перемещаются здесь, если транзакция постоянно завершается неудачно при обработке сообщений из обычной очереди ввода. Сообщения в этой очереди обрабатываются через одну минуту. Сообщение может быть повторено три раза в этой очереди, прежде чем перемещаться на задний план второй очереди повтора. Эта очередь называется *applicationName* \_ 0. Эта очередь является частной очередью очереди сообщений.

3.  Вторая очередь повторов. Сообщения перемещаются здесь, если при обработке сообщений из первой очереди повтора происходит сбой транзакции. Сообщения в этой очереди обрабатываются через две минуты. Сообщение может быть повторено три раза в этой очереди, прежде чем перемещаться на заднюю часть третьей очереди повторной попытки. Эта очередь называется *applicationName* \_ 1. Эта очередь является частной очередью очереди сообщений.

4.  Третья очередь повторов. Сообщения перемещаются здесь, если транзакция повторяется повторно при обработке сообщений из второй очереди повтора. Сообщения в этой очереди обрабатываются через четыре минуты. Сообщение может быть повторено три раза в этой очереди, прежде чем переместиться обратно в четвертую очередь повторных попыток. Эта очередь называется *applicationName* \_ 2. Эта очередь является частной очередью очереди сообщений.

5.  Четвертая очередь повторных попыток. Сообщения перемещаются здесь, если транзакция повторяется повторно при обработке сообщений из третьей очереди повторной попытки. Сообщения в этой очереди обрабатываются через восемь минут. Сообщение может быть повторено три раза в этой очереди, прежде чем переместить его в пятую очередь повторных попыток. Эта очередь называется *applicationName* \_ 3. Эта очередь является частной очередью очереди сообщений.

6.  Пятая очередь повторных попыток. Сообщения перемещаются здесь, если транзакция повторяется неудачно при обработке сообщений из четвертой очереди повтора. Сообщения в этой очереди обрабатываются через 16 минут. Сообщение может быть повторено три раза в этой очереди, прежде чем будет перемещено в конечную очередь RESTful. Эта очередь называется *applicationName* \_ 4. Это частная очередь очереди сообщений.

7.  Конечная очередь RESTful для конкретного приложения. Сообщения перемещаются здесь, если транзакция постоянно прерывается при попытке выполнения в пятой очереди повторных попыток. Эта очередь называется *applicationName* \_ деадкуеуе. Это частная очередь очереди сообщений. Конечная очередь RESTful не обслуживается прослушивателем очереди. Сообщения остаются здесь до тех пор, пока они не будут перемещены вручную (возможно, с помощью служебной программы перемещения сообщений в очереди) или очищаются обозревателем очереди сообщений.

Неработоспособные сообщения, так как ясно, что при каждой попытке повтора произойдет сбой, можно переместиться непосредственно в конечную очередь для конкретного приложения, не проведя все уровни повтора.

Проигрыватель выдает событие COM+ для уведомления заинтересованных сторон о том, что сообщения не могут быть воспроизведены. События COM+ выдаются в следующих ситуациях:

-   При прерывании транзакции
-   При перемещении сообщения из одной очереди в другую
-   При размещении сообщения в конечной очереди RESTful

Сообщения могут быть изменены перед переходом из одной очереди в другую. Механизм безопасности очередей компонентов COM+ позволяет перемещать сообщения в очереди повтора, а затем повторно вставлять их в начальную входную очередь приложения. Дополнительные сведения о безопасности компонентов, помещенных в очередь, см. в разделе [Безопасность очередей компонентов](queued-components-security.md).

Очереди повтора создаются вместе с основной очередью приложения, если приложение помечено как помещенное в очередь средством администрирования служб компонентов или с помощью функций административного пакета SDK для COM+. Служба очередей компонентов обеспечивает гибкость механизма повторных попыток, позволяя удалять очереди повторов. Например, если все очереди повторных попыток удалены, то сообщение, которое постоянно прерывается, будет перемещено непосредственно из очереди приложения в конечную очередь, относящуюся к конкретному приложению. Удалив одну или несколько очередей попыток, можно уменьшить число и длину повторных попыток. Если очереди удаляются из последовательности повторных попыток, то время оставшихся очередей соответствует положению в последовательности очередей повтора. Например, если удалить очередь повтора *applicationName* \_ 1, *applicationName* \_ 2 и *applicationName* \_ 3, сообщения в *applicationName* \_ 4 будут обрабатываться так, как если бы очередь была второй очередью повтора.

Механизм повторных попыток предназначен для завершения сообщения, если это возможно. В некоторых случаях сообщение может оказаться невозможным. Например, клиент может попытаться отозвать деньги из учетной записи, имеющей недостаточный фонд. В таких случаях ошибку можно решить несколькими способами, включая следующие:

-   Создание диагностики и выдача предупреждения
-   Создание компенсирующих транзакций
-   Пропустить проблему и закрыть сообщение

Как и в случае постоянных сбоев на стороне клиента, служба очередей компонентов позволяет связать класс исключения с компонентом. Класс исключения связан с компонентом с помощью вкладки **Дополнительно** на странице Свойства компонента средства администрирования служб компонентов или с помощью АДМИНИСТРАТИВНЫХ функций COM+. Класс Exception позволяет разработчику управлять после повторной попытки сообщения и до того, как оно будет перемещено в конечную очередь, относящуюся к конкретному приложению. Дополнительные сведения о классе Exception см. в разделе [постоянные Client-Side сбои](persistent-client-side-failures.md).

Ниже приведена последовательность событий для обработки исключений на стороне сервера.

1.  Сообщение перемещается через доступные очереди повтора для конкретного приложения.
2.  Последняя повторная попытка в очереди повторного выполнения завершается ошибкой.
3.  Время выполнения службы очередей компонентов извлекает целевой компонент из сообщения и проверяет наличие класса исключения.
4.  Время выполнения создает экземпляр класса Exception.
5.  Запросы времени выполнения [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) в классе Exception.
6.  Во время выполнения вызывается [**иплайбаккконтрол:: финалсерверретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalserverretry) в классе Exception.
7.  Во время выполнения воспроизводятся все вызовы свойств и методов из сообщения в класс Exception.
8.  Если шаги с 4 по 6 не выполнены, время выполнения перемещает сообщение в очередь окончательного RESTful для конкретного приложения.

Если необходимо выполнить описанный выше процесс или переместить опасное сообщение из конечной очереди RESTful, используйте программу перемещения сообщений. Дополнительные сведения о программе перемещения сообщений см. в разделе [Обработка ошибок](handling-errors-in-queued-components.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Ошибки на стороне клиента](client-side-errors.md)
</dt> <dt>

[Постоянные сбои Client-Side](persistent-client-side-failures.md)
</dt> </dl>

 

 



