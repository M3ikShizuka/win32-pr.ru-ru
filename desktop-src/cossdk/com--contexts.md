---
description: Для настроенных компонентов, работающих в приложениях COM+, контексты являются основой, на которой предоставляются службы COM+.
ms.assetid: 62a0bef2-c3c2-4a60-a5d1-6c038958e13e
title: Контексты COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f0ae1228f89797f9124e817db07f11a23dbec12
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423449"
---
# <a name="com-contexts"></a>Контексты COM+

Для настроенных компонентов, работающих в приложениях COM+, *контексты* являются основой, на которой предоставляются службы COM+. В COM+ контекст определяется как набор свойств времени выполнения, связанных с одним или несколькими COM-объектами, которые используются для предоставления служб для этих объектов.

В COM+ каждый COM-объект связан точно с одним контекстом при его запуске (то есть между его активацией и деактивацией), и каждый контекст находится в пределах ровно одного подразделения COM. Несколько объектов могут выполняться в одном и том же контексте, и несколько контекстов могут находиться в одном апартаменте. Инициализировано при активации объекта, свойства контекста, такие как свойства контекста безопасности, представляют потребности объекта во время выполнения.

> [!Note]  
> Для ненастроенных компонентов, которые не используют службы COM+, контекст, по большей части, игнорируется.

 

COM+ использует свойства контекста в качестве основания для предоставления служб времени выполнения. Эти свойства сохраняют состояние, определяющее, как среда выполнения выполняет службы для объектов в контексте. В некоторых случаях можно напрямую взаимодействовать со свойствами контекста объекта, чтобы указать некоторое состояние, относящееся к службе, предоставляемой для объекта. Например, это можно сделать, когда объект, участвующий в автоматической проводке, продвигается в результате транзакции.

Подробное описание COM-модели этих концепций см. в статье [процессы, потоки и подразделения](/windows/desktop/com/processes--threads--and-apartments).

## <a name="programmatic-interaction-with-context-properties"></a>Программное взаимодействие со свойствами контекста

Каждый контекст имеет связанный объект [**ObjectContext**](/windows/desktop/api/ComSvcs/nn-comsvcs-objectcontext) , который отслеживает его свойства. Доступ к **контексту ObjectContext** можно получить, вызвав функцию метода [**ObjectContext**](/windows/desktop/api/ComSvcs/nf-comsvcs-getobjectcontext) . После доступа к классу **ObjectContext** можно вызывать методы в интерфейсе [**иобжектконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext) , предоставляемом для управления свойствами контекста.

Например, вызов [**иобжектконтекст:: сеткомплете**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setcomplete) влияет на установку бита согласованности транзакций в значение "consistent", а бит выполнения [JIT-активации](com--just-in-time-activation.md) — на "Done" в контексте, связанном с объектом. "Последовательные" сигналы для COM+, которые проголосуют за фиксацию транзакции, и "Готово" означает, что объект готов к деактивации при возврате из метода.

Помимо [**иобжектконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontext), другие специализированные интерфейсы, предоставляющие доступ к свойствам контекста, — это [**иобжектконтекстинфо**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextinfo), [**иконтекстстате**](/windows/desktop/api/ComSvcs/nn-comsvcs-icontextstate)и [**иобжектконтекстактивити**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontextactivity). В определенный экстент [**исекуритикаллконтекст**](/windows/desktop/api/ComSvcs/nn-comsvcs-isecuritycallcontext) также обращается к свойствам контекста. Для получения **исекуритикаллконтекст** можно использовать [**Ижетсекуритикаллконтекст:: жетсекуритикаллконтекст**](/windows/desktop/api/ComSvcs/nf-comsvcs-igetsecuritycallcontext-getsecuritycallcontext) .

## <a name="understanding-activation-and-interception"></a>Общие сведения об активации и перехвате

Как правило, необходимо думать о контексте только в том экстенте, который представляет ряд свойств, некоторые из которых можно задать или получить, которые используются для предоставления служб COM+ для компонентов. Однако в некоторых обстоятельствах может потребоваться рассмотреть два следующих взаимосвязанных аспекта контекстов:

-   [Активация контекста](context-activation.md)или инициализация объекта в соответствующем контексте.
-   [Перехват](interception-of-cross-context-calls.md)или то, что делает com+ в вызовах через границу контекста.

## <a name="relation-to-mts-context-wrappers"></a>Связь с обертками контекста MTS

Контексты эффективно заменяют оболочки контекста MTS. Предоставляемая им цель — предоставление автоматических служб путем перехвата запросов на создание — теперь является интегрированной функцией COM+. В результате вам больше не нужно использовать функцию [**сафереф**](/windows/desktop/api/ComSvcs/nf-comsvcs-saferef) . В MTS **сафереф** использовался для получения ссылки на объект, который мог быть передан за пределами оболочки контекста. В COM+ это не требуется; обычные ссылки на объекты (**эти** указатели) работают.

 

 
