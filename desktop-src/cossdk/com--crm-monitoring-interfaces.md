---
description: Инфраструктура CRM предоставляет набор интерфейсов, которые можно использовать для мониторинга Крмс в определенном серверном приложении.
ms.assetid: b8f40c91-001b-4003-b377-57a918988100
title: Интерфейсы мониторинга COM+ CRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c893040c46810c980c647cbacdc808200e8d5f5e
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127457815"
---
# <a name="com-crm-monitoring-interfaces"></a>Интерфейсы мониторинга COM+ CRM

Инфраструктура CRM предоставляет набор интерфейсов, которые можно использовать для мониторинга Крмс в определенном серверном приложении. Для доступа к интерфейсам мониторинга компонент, работающий в серверном приложении, должен сначала создать специализированный клерк CRM под названием «клерк восстановления CRM».

При обычном использовании Крмс ожидается кратковременное использование транзакций, и, следовательно, работники CRM и компенсаторы CRM существуют в течение короткого периода времени, обычно всего несколько секунд. Таким образом, интерфейсы мониторинга предназначены для создания моментального снимка состояния выполнения Крмс в определенный момент времени. Если в какой бы то ни было из Крмс возникли проблемы, интерфейсы мониторинга можно использовать для того, чтобы обменяться в системе с неисправностью CRM, проверять записи журнала и прерывать ее транзакцию, если это необходимо.

Ниже приведены три интерфейса мониторинга CRM и описания их работы.



| Интерфейс                                                         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**икрммонитор**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitor)<br/>                     | С помощью [**икрммонитор::-клерков**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-getclerks)можно получить моментальный снимок из текущего набора активных клерков CRM в серверном приложении. В этом случае можно найти конкретный интересующий вас объект коллекции CRM, включая текущее состояние транзакции и записи журнала, записанные в CRM.<br/> Когда средство мониторинга определило, какой клерк является интересным, он вызывает [**икрммонитор:: холдклерк**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmmonitor-holdclerk) , чтобы получить интерфейс [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) на этом конкретном Клерке. На этом этапе средство мониторинга хранит ссылку на этот Клерк, и, если транзакция завершается, клерк удерживается в памяти и не освобождается до тех пор, пока не будет сделано средство мониторинга.<br/>                                                                                                                                                                                                    |
| [**икрммониторклеркс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorclerks)<br/>         | С помощью этого интерфейса можно просмотреть объект коллекции клерков, чтобы получить сведения о состоянии коллекции клерков в момент получения. Эти сведения включают число клерков, идентификатор ProgID компенсатора CRM, используемый клерком, описание, предоставленное во время регистрации компенсатора CRM (с помощью [**икрмлогконтрол:: регистеркомпенсатор**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-registercompensator)), идентификатор транзакции и идентификатор действия. Отдельные клерки также уникально идентифицируются с помощью идентификатора CLSID экземпляра клерка, который не является CLSID COM в обычном смысле термина, но является уникальным идентификатором GUID, идентифицирующим этот конкретный Клерк на время его существования.<br/>                                                                                                                                                                                                                                                                                                |
| [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords)<br/> | Этот интерфейс может использоваться для запроса текущего состояния транзакции, для определения количества записей журнала, записанных этим клерком CRM, и для получения фактических данных записи журнала. Записи журнала предоставляются из интерфейса [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) в том же формате, в котором они были первоначально записаны (с помощью [**икрмлогконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol)). Кроме того, **икрммониторлогрекордс** можно дополнительно реализовать для преобразования записей журнала в просматриваемый формат, чтобы их можно было представить с помощью универсального средства мониторинга.<br/> Так как [**икрммониторлогрекордс**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmmonitorlogrecords) реализована непосредственно в Клерке CRM, вы можете выпустить [**QueryInterface**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) для [**икрмлогконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-icrmlogcontrol) (также реализованного в Клерке CRM). Затем можно использовать, чтобы напрямую прервать транзакцию ([**икрмлогконтрол:: форцетрансактионтоаборт**](/windows/desktop/api/ComSvcs/nf-comsvcs-icrmlogcontrol-forcetransactiontoabort)).<br/> |



 

## <a name="related-topics"></a>Связанные разделы

<dl> <dt>

[Основные понятия о компенсации диспетчер ресурсов COM+](com--compensating-resource-manager-concepts.md)
</dt> </dl>

 

