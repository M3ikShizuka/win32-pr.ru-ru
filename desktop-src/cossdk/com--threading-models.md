---
description: Модели потоков COM+ спроектированы вокруг коллекции объектов, называемой апартаментом. Подразделение — это коллекция контекстов, содержащихся в процессе.
ms.assetid: c73fb4c5-20ae-4873-afd2-4f40eb47bade
title: Модели потоков COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd0949a27291be43b5981f24f4985fac6911937b2c9fa85785b4d662bd1bf546
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119793683"
---
# <a name="com-threading-models"></a>Модели потоков COM+

Модели потоков COM+ спроектированы вокруг коллекции объектов, называемой апартаментом. Подразделение — это коллекция контекстов, содержащихся в процессе, как показано на следующем рисунке.

![Схема, показывающая коллекцию контекстов в действии в пределах подразделения внутри процесса.](images/6b86fe3b-262a-483a-a418-67d60f9a5d68.png)

Вызовы в апартаменте являются прямыми, а вызовы между апартаментами (вне процесса) являются непрямыми и нуждаются в коде прокси-сервера и заглушки. Подразделения позволяют объектам с разными свойствами синхронизации и повторного входа и иметь две категории: однопотоковые и многопоточные. Объекты в однопотоковом апартаменте (STA) выполняются в определенном потоке, в котором они были созданы. STA допускают выполнение только одного метода за раз. они предназначены для пользовательских интерфейсов и используют очередь сообщений Microsoft Windows для обработки входящих вызовов.

Объекты в многопоточном апартаменте (MTA) выполняются в любом потоке и позволяют одновременно выполнять любое количество методов. MTA поддерживает неявное перевход.

Классы COM+ помечены свойством **ThreadingModel** , которое позволяет COM+ создавать объект в надлежащем апартаменте. Чтобы определить, в каком апартаменте создается объект, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) использует свойство **ThreadingModel** .

Потоки должны вызывать [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) , прежде чем они смогут использовать COM+. При этом они создаются в правильном апартаменте и контексте. Главный контейнер потока определяется как первый STA, вызываемый методом **CoInitializeEx**. Обычно это связано с основным потоком процесса. **CoInitializeEx** указывает тип подразделения, требуемого для потока, установив следующие флаги:

-   **СОинициализация \_ Многопоточное — находит** поток в одном многопоточном апартаменте.
-   **СОинициализация \_ АПАРТМЕНТСРЕАДЕД**— помещает поток в Новый STA.

В следующих подразделах этого раздела приводятся дополнительные сведения об использовании потоков моделей и апартаментов в COM+.

-   [Атрибут модели потоков](threading-model-attribute.md)
-   [Нейтральные подразделения](neutral-apartments.md)

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Процессы, потоки и подразделения](/windows/desktop/com/processes--threads--and-apartments)
</dt> <dt>

[**ThreadingModel**](components.md)
</dt> </dl>

 

 
