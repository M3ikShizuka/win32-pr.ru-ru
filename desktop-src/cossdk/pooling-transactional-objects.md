---
description: Для транзакционных компонентов, которые должны быть помещены в пул, предъявляются особые требования.
ms.assetid: 32e2f830-c30a-4dbc-8e69-dd2038851998
title: Группирование транзакционных объектов в пул
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 006ba32ad2ac550be4fa4418dde322ded26c64c7
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701230"
---
# <a name="pooling-transactional-objects"></a>Группирование транзакционных объектов в пул

Для транзакционных компонентов, которые должны быть помещены в пул, предъявляются особые требования.

## <a name="manually-enlisting-resources"></a>Прикрепление ресурсов вручную

Объекты в пуле, участвующие в транзакциях, должны прикреплять управляемые ресурсы вручную. Если объект хранит управляемые ресурсы между клиентами, диспетчер ресурсов не будет автоматически прикрепляться к транзакции при активации объекта в заданном контексте.

Сам объект должен выполнить логику обнаружения транзакции, отключить автоматическое прикрепление диспетчера ресурсов и вручную прикрепить все ресурсы, которые он содержит. Эти действия относятся к используемому диспетчеру ресурсов. Если вам нужно прикрепить вручную, обратитесь к документации по диспетчеру ресурсов.

Как описано ниже, объекты могут быть объединены в пул с сопоставлением транзакций, пока транзакция активна и может быть активирована с помощью сходства транзакций, если вызывается клиентом, связанным с этой транзакцией. Перед прикреплением ресурсов необходимо сначала проверить соответствие транзакций. Если объект взят из пула, относящегося к этой транзакции, он уже выполнил работу в этой транзакции и закрепляет ее ресурсы.

## <a name="turning-off-automatic-enlistment"></a>Отключение автоматического прикрепления

Автоматическое прикрепление должно быть отключено после получения ресурса, обычно в конструкторе объекта. То есть вы отключаете автоматическое прикрепление, а затем подключаетесь.

Отключение автоматического прикрепления иногда может быть незаметной процедурой, особенно в случае многоуровневых поставщиков доступа к данным. Автоматическое прикрепление иногда связывается с пулом соединений, как и с ODBC, и иногда не так, как с OLE DB. Может потребоваться обеспечить отключение автоматического прикрепления на нескольких уровнях поставщиков.

## <a name="implementing-iobjectcontrol"></a>Реализация IObjectControl

Объекты в пуле, участвующие в транзакциях, должны отслеживать текущее состояние ресурсов, которые они хранятся. Если объект обнаруживает, что он находится в непригодном для использования состоянии, например, если соединение является недопустимым, оно должно возвращать значение false для [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled). Это приведет к удалению экземпляра объекта и неудачу текущей транзакции.

## <a name="transaction-specific-pools"></a>Пулы Transaction-Specific

Пул объектов обычно является однородным, а любой объект в пуле, который в настоящее время не используется, имеет хорошее значение для возврата к любому клиенту. Единственное исключение из этого правила — в случае с объектами транзакций, для которых оптимизирована Группировка объектов. Когда клиент, запрашивающий объект, имеет связанную транзакцию, COM+ проверит пул на наличие доступного объекта, уже связанного с этой транзакцией. Если найден объект с сходством транзакций, он возвращается клиенту. в противном случае возвращается объект из общего пула.

Таким образом, будут поддерживаться специальные подгруппы, содержащие объекты с сходством для конкретной транзакции. Когда транзакция фиксируется или прерывается, эти объекты возвращаются в общий пул без сходства транзакций, готового к использованию любым клиентом.

По этой причине, когда компонент вручную прикрепляет свои управляемые ресурсы в транзакции, он должен сначала проверить, не были ли они прикреплены. В этом случае нет необходимости прикрепляться к.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Строки конструктора объектов COM+](com--object-constructor-strings.md)
</dt> <dt>

[Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md)
</dt> <dt>

[Как работает пул объектов](how-object-pooling-works.md)
</dt> <dt>

[Повышение производительности с помощью пула объектов](improving-performance-with-object-pooling.md)
</dt> <dt>

[Требования к объектам в пуле](requirements-for-poolable-objects.md)
</dt> </dl>

 

 



