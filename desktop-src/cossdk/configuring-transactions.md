---
description: Атрибут Transaction является декларативным свойством, которое автоматически управляет транзакциями для разработчика компонентов. Устанавливая этот атрибут, вы устраняете необходимость использовать явные элементы управления транзакциями в компоненте.
ms.assetid: ea0e4d7e-2598-4a42-993c-58815f2fa138
title: Настройка транзакций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9d613eb49a5f053b869e3efc90e04b9455644ea52acbaf651f33b00909e6e35
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119128895"
---
# <a name="configuring-transactions"></a>Настройка транзакций

*Атрибут Transaction* является декларативным свойством, которое автоматически управляет транзакциями для разработчика компонентов. Устанавливая этот атрибут, вы устраняете необходимость использовать явные элементы управления транзакциями в компоненте.

COM+ использует атрибут транзакции компонента для определения типа защиты транзакций, необходимой для каждого активируемого им объекта. В зависимости от требований объект может совместно использовать свою транзакцию вызывающего объекта, требовать новую транзакцию или действовать без защиты транзакций.

COM+ предоставляет следующие значения атрибутов транзакций:

<dl> <dt>

<span id="Disabled"></span><span id="disabled"></span><span id="DISABLED"></span>Доступ
</dt> <dd>

Как правило, значение этого атрибута следует задавать только в том случае, если вы уверены, что компонент никогда не получает доступ к диспетчеру ресурсов. При отключении атрибута Transaction COM+ игнорирует требования к транзакции компонента при определении размещения объекта в контексте. В результате объект может совместно использовать контекст вызывающего объекта (и транзакцию). При переносе COM-компонента в COM+ необходимо отключить атрибут Transaction, чтобы сохранить то же поведение транзакций, что и ненастроенный COM-компонент.

> [!Note]  
> *Ненастроенный компонент* — это COM-компонент, который не был установлен в приложении COM+.

 

</dd> <dt>

<span id="Not_Supported"></span><span id="not_supported"></span><span id="NOT_SUPPORTED"></span>Не поддерживается
</dt> <dd>

При задании этого значения атрибута COM+ гарантирует, что любой объект, созданный из компонента, никогда не участвует в транзакции, независимо от состояния транзакций вызывающего объекта. Объявив это значение, вы гарантируете, что объект не проголосовать за его транзакцию вызывающего объекта, и не сможет начать транзакцию. Не поддерживается значением по умолчанию для всех компонентов.

</dd> <dt>

<span id="Supported"></span><span id="supported"></span><span id="SUPPORTED"></span>Поддерживается
</dt> <dd>

При задании этого значения атрибута COM+ гарантирует, что любой объект, созданный из компонента, будет участвовать в транзакции, если она существует. Это значение объявляется, если требуется, чтобы объект был совместно использоваться в его транзакции вызывающего объекта, не требуя собственной транзакции.

</dd> <dt>

<span id="Required"></span><span id="required"></span><span id="REQUIRED"></span>Обязательно
</dt> <dd>

При задании этого значения атрибута COM+ гарантирует, что любой объект, созданный из компонента, будет транзакционным. Когда COM+ активирует объект с требуемым параметром, он проверяет состояние транзакций вызывающего объекта. Если вызывающий объект имеет транзакцию, новый объект включается в текущую транзакцию. В противном случае COM+ начинает транзакцию, делая новый объект корнем транзакции. Это предпочтительный параметр для компонента, который выполняет действия с ресурсами, так как он помогает обеспечить защиту транзакций для этих действий.

</dd> <dt>

<span id="Requires_New"></span><span id="requires_new"></span><span id="REQUIRES_NEW"></span>Требуется новое
</dt> <dd>

При задании этого значения атрибута COM+ гарантирует, что все объекты, созданные из компонента, должны участвовать в новой транзакции в качестве корня транзакции, независимо от состояния транзакций вызывающего. COM+ автоматически инициирует новую транзакцию, которая отличается от транзакции вызывающего объекта.

> [!Note]  
> COM+ не поддерживает вложенные транзакции. Когда один объект транзакции вызывает другой компонент, помеченный как требуется New, COM+ создает независимую границу транзакций для вновь активированного объекта. Вторая транзакция не может влиять на первую транзакцию, если первая транзакция явно не затронет результаты второй транзакции и не изменяет свой голос на основе этих результатов.

 

</dd> </dl>

## <a name="transaction-attribute-dependencies"></a>Зависимости атрибутов транзакций

В следующей таблице показаны характеристики каждого значения атрибута транзакции COM+, включая воздействие значения на характеристики транзакции. COM+ принудительно реализует [JIT-активацию](com--just-in-time-activation.md) и [синхронизацию](com--synchronization.md) для всех компонентов транзакций.



| Значение атрибута          | Создать транзакцию   | Транзакция клиента                 | Корень транзакции                        | JIT-активация      | Синхронизация     |
|--------------------------|-------------------|--------------------------------------|-----------------------------------------|---------------------|---------------------|
| Выключено<br/>      | Никогда<br/>  | Возможно<br/>                     | Никогда<br/>                        | Необязательный<br/> | Необязательный<br/> |
| Не поддерживается<br/> | Никогда<br/>  | Никогда<br/>                     | Никогда<br/>                        | Необязательный<br/> | Необязательный<br/> |
| Поддерживается<br/>     | Никогда<br/>  | Если клиент имеет транзакцию<br/> | Никогда<br/>                        | Обязательно<br/> | Обязательно<br/> |
| Обязательно<br/>      | Возможно<br/>  | Если клиент имеет транзакцию<br/> | Если у клиента нет транзакции<br/> | Обязательно<br/> | Обязательно<br/> |
| RequiresNew<br/>  | Всегда<br/> | Никогда<br/>                     | Всегда<br/>                       | Обязательно<br/> | Обязательно<br/> |



 

## <a name="transaction-boundaries"></a>Границы транзакций

Транзакция имеет начало, конец и происходит ровно один раз. Во время выполнения транзакция может вызываться для ресурса, например базы данных или очереди, для выполнения одной или нескольких задач. Каждый ресурс попадает в пределах *границы транзакции*. Все ресурсы внутри границы транзакции, которые могут охватывать несколько процессов и компьютеров, совместно используют одну транзакцию. Очень важно управлять согласованностью в пределах этих процессов и компьютеров.

COM+ обеспечивает согласованность за счет автоматического управления границами транзакций на основе значения атрибута транзакции, заданного для каждого компонента. Транзакция COM+ автоматически передается объектам, которые принимают участие в транзакции и обходят объекты, которые были выполнены за пределами транзакции. COM+ не поддерживает вложенные транзакции. Вместо этого транзакции COM+ являются отдельными и кратковременными.

Первый объект в границе транзакции является специальным для транзакции и называется *корневым объектом* транзакции. В транзакции может быть только один корневой объект. Все остальные объекты в иерархии транзакций в корневом объекте называются *внутренними объектами*.

## <a name="mapping-transactions"></a>Сопоставление транзакций

Один из способов убедиться, что объект включен в правильную границу транзакции, — это соотнесение транзакций до начала написания компонентов. При сопоставлении транзакций можно определить наилучшее значение для каждого записываемого компонента. Чем больше определено, чем будут использоваться компоненты, тем проще будет выбрать правильное значение атрибута транзакции.

Во время выполнения COM+ просматривает атрибут Transaction, чтобы определить, должен ли объект быть корнем новой транзакции, создан в существующей транзакции или создан как нетранзакционный объект.

На следующем рисунке показано возможное сопоставление транзакции. На рисунке клиент создает объект 1, для которого требуется транзакция. Поскольку транзакция не существует, COM+ создает транзакцию 1 и помещает объект 1 в него в качестве корневого объекта. Объект 1 создает объект 2, который поддерживает транзакции и, следовательно, помещается в транзакцию 1. Объект 2 создает объект 3, который не поддерживает транзакции и, следовательно, помещается вне всех транзакций. Объект 2 также создает объект 4, который требует транзакции и поэтому помещается в транзакцию 1. Объект 3 создает объект 5, который поддерживает транзакции. Однако, поскольку объект 5 создается объектом, который не существует в транзакции, он также помещается за пределы всех транзакций. Объект 4 создает объект 6, для которого требуется новая транзакция, поэтому COM+ создает транзакцию 2 и помещает объект 6 в него в качестве корневого объекта. Объект 6 создает объект 7, который поддерживает транзакции и поэтому помещается в транзакцию 2.

![Схема, на которой показано взаимодействие клиента с транзакцией 1 и транзакцией 2.](images/fc7e2d03-94c2-40d9-a79b-1e05ca31dd80.png)

На предыдущем рисунке показаны две потенциальные проблемные области. Во-первых, большая часть работы разделяется между двумя отдельными транзакциями. Если транзакция 1 завершается сбоем после того, как объект 4 создает объект 6, транзакция 2 не повлияет на результат транзакции 1. Если этот результат не предполагался, можно попытаться сложить операции обеих транзакций в одну транзакцию, что можно сделать, изменив атрибут транзакции объекта 6 на Required.

На рисунке сопоставления также показано, что объект 3 и объект 5 являются нетранзакционными и выполняются полностью вне области транзакций 1 и 2. Если объект 5 обновляет постоянные данные, может потребоваться повторное рассмотрение нетранзакционного состояния. Объект 5 можно поместить в транзакцию, изменив его атрибут Transaction на Required.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Установка атрибута Transaction](setting-the-transaction-attribute.md)
</dt> </dl>

 

 




