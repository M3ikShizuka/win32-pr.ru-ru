---
description: Особенности работы с потоками
ms.assetid: 4d27f0b3-3e30-4e88-b2b2-d57218da4ffa
title: Особенности работы с потоками
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8acde9a06802a867cb6a93e7c52be8066ad483c3
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104072538"
---
# <a name="threading-considerations"></a>Особенности работы с потоками

Средство записи очередей компонентов COM+ может выполняться в многопоточном апартаменте процесса (MTA) или в однопотоковом подразделении (STA). Когда средство записи запускается в STA, для каждого подразделения, содержащего объекты, должна быть очередь [очереди сообщений](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) для обработки вызовов из других процессов и подразделений в рамках одного процесса. Это означает, что Рабочая функция потока должна иметь цикл обработки сообщений. При создании экземпляра компонента в очереди возвращаемый указатель интерфейса всегда является указателем интерфейса прокси, а не прямым указателем интерфейса. Указатель на самом деле является ссылкой на экземпляр средства записи. Если ссылка на интерфейс записи передается другому потоку, исходный поток по-прежнему должен выполнять цикл обработки сообщений Windows, чтобы принимающий поток мог распаковать интерфейс. Если это не так, принимающий поток зависает в вызове [**каунмаршалинтерфаце**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface).

Если для синхронизации потоков используются примитивы, рассмотрите возможность использования [**мсгваитформултиплеобжектс**](/windows/desktop/api/winuser/nf-winuser-msgwaitformultipleobjects) вместо других функций синхронизации. Это проверяет наличие сообщений в очереди, а также состояния объекта синхронизации.

 

 
