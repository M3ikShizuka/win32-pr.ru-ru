---
description: Постоянные сбои Client-Side
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Постоянные сбои Client-Side
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423374"
---
# <a name="persistent-client-side-failures"></a>Постоянные сбои Client-Side

В некоторых случаях [очередь сообщений](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) может переместить сообщение в очередь назначения. Например, если элементы управления доступом к очереди не допускают перемещение сообщения с клиента на сервер, то сообщение, вызвавшее ошибку, перемещается в очередь недоставленных сообщений на стороне клиента. В этом случае служба очередей компонентов COM+ позволяет связать класс исключения с компонентом. Чтобы связать класс исключений с компонентом, используйте вкладку **Дополнительно** на странице Свойства компонента средства администрирования служб компонентов. Кроме того, класс исключений можно связать программно с помощью атрибута компонента каталога Ексцептионкласс административных функций COM+.

Класс исключения определяется как ProgID или CLSID компонента, реализующего [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol). Служба очередей компонентов имеет монитор очереди недоставленных сообщений, который сканирует очередь недоставленных сообщений о транзакции. Если в очереди имеется сообщение, монитор очереди недоставленных сообщений создает экземпляр обработчика исключений, связанного с целевым компонентом, и вызывает [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), указывая на то, что произошла неустранимая ошибка на стороне клиента.

Помимо [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), обработчик исключений должен реализовать тот же набор интерфейсов, что и серверный компонент, для которого он обрабатывает исключения. Когда вызывается [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) , компонент очереди компонентов во время выполнения воспроизводит сообщение, вызвавшее ошибку, в обработчик исключений. Это позволяет обработчику исключений реализовать альтернативное поведение для сообщений, которые не могут быть перемещены на сервер, например путем создания компенсирующих транзакций.

Если обработчик исключений завершает все вызовы метода, то сообщение удаляется из очереди недоставленных сообщений об активных сообщениях и закрывается. Однако если обработчик исключений прерывает сообщение, возвращая состояние сбоя одного из вызовов метода, сообщение возвращается в очередь недоставленных сообщений. Следующая последовательность событий показывает, как обрабатываются исключения на стороне клиента.

1.  Службе очереди сообщений не удается доставить сообщение на сервер и помещает его в очередь недоставленных сообщений транзакций.
2.  Прослушиватель очереди недоставленных сообщений (ДЛКЛ) находит сообщение в очереди недоставленных сообщений о транзакции.
3.  ДЛКЛ извлекает CLSID целевого компонента из сообщения и проверяет наличие класса исключения.
4.  ДЛКЛ создает экземпляр класса Exception.
5.  ДЛКЛ запрашивает [**иплайбаккконтрол**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) для класса Exception.
6.  ДЛКЛ вызывает метод [**иплайбаккконтрол:: финалклиентретри**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) в классе Exception.
7.  ДЛКЛ воспроизводит все вызовы свойств и методов из сообщения в класс Exception.
8.  ДЛКЛ удаляет сообщение, если обработчик исключений успешно завершает транзакцию. Обработчик исключений может выдавать [**иобжектконтекст:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), и сообщение останется в очереди недоставленных сообщений.

Если какое-либо из предыдущих шагов завершится неудачей, сообщение будет оставлено в очереди недоставленных сообщений активной транзакции.

При запуске ДЛКЛ считывает каждое сообщение в очередь недоставленных транзактных сообщений и создает экземпляр класса исключений для каждого сообщения компонента, помещенного в очередь. После прохождения через очередь он ожидает поступления новых сообщений. Затем он обрабатывает каждое новое сообщение очереди недоставленных сообщений по мере поступления.

Если вам нужно поработать с описанным здесь процессом или переместить опасное сообщение из конечной очереди RESTful, используйте программу перемещения сообщений. Дополнительные сведения о программе перемещения сообщений см. в разделе [Обработка ошибок](handling-errors-in-queued-components.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Ошибки на стороне клиента](client-side-errors.md)
</dt> <dt>

[Ошибки на стороне сервера](server-side-errors.md)
</dt> </dl>

 

 



