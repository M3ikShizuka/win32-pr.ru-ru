---
description: При настройке компонента для объединения в пул COM+ будет поддерживать его экземпляры в пуле, что будет готово к активации любому клиенту, запрашивающему компонент. Все запросы на создание объектов будут обрабатываться диспетчером пула.
ms.assetid: 34978b50-cd20-42fd-ad46-410190478ef8
title: Как работает пул объектов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: df937dd8e3d7a2fb111c7825df101cd2b53f6f39a94326efb1eafe878d74daa6
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119954044"
---
# <a name="how-object-pooling-works"></a>Как работает пул объектов

При настройке компонента для объединения в пул COM+ будет поддерживать его экземпляры в пуле, что будет готово к активации любому клиенту, запрашивающему компонент. Все запросы на создание объектов будут обрабатываться диспетчером пула.

Пулы настраиваются и обслуживаются отдельно для каждого компонента. Пул состоит из однородных объектов, использующих один и тот же идентификатор CLSID. Единственным исключением являются объекты транзакций, для которых поддерживаются подгруппы, содержащие объекты, имеющие сходство транзакций, пока транзакция находится в состоянии ожидания.

При запуске приложения пул будет заполнен до минимального уровня, указанного администратором, при условии, что создание объекта завершится успешно. По мере того как клиентские запросы для компонента поступают в систему, они выполняются на основе первого поступления из пула. Если объекты в пуле недоступны, а пул еще не находится на указанном максимальном уровне, то для клиента создается и активируется новый объект.

Когда пул достигает максимального уровня, клиентские запросы помещаются в очередь и получат первый доступный объект из пула. Количество объектов, включая активированные и отключенные, никогда не превысит максимальное значение пула. Время ожидания запросов на создание объектов истечет через административно указанный период, чтобы можно было контролировать, как долго клиенты будут ожидать создания объектов. По истечении времени ожидания клиент получит сообщение об ошибке E \_ timeout из [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).

Когда это возможно, COM+ будет пытаться повторно использовать объект после его освобождения клиентом, пока пул не достигнет максимального уровня. Объект отвечает за наблюдение за его состоянием, чтобы определить, можно ли его использовать повторно и вернуть соответствующее значение для [**IObjectControl:: канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled).

При создании объекта в составе пула он объединяется в объект большего размера, который будет управлять временем существования объекта. Внешний объект вызывает методы [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol) в нужное время в жизненном цикле объекта, как показано ниже.

-   Метод [**Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) вызывается всякий раз, когда объект возвращается клиенту, активируется в определенном контексте.
-   Метод [**Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate) вызывается всякий раз, когда объект освобождается клиентом, или, в случае JIT-активируемого объекта, при деактивации.
-   Метод [**канбепулед**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-canbepooled) вызывается всякий раз, когда объект возвращается в общий пул. Если объект обнаруживает, что некоторые повторно используемые ресурсы находятся в неправильном состоянии, он должен вернуть **значение false** для этого метода, и диспетчер пула удалит объект.

Объект не обязательно должен реализовывать [**IObjectControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iobjectcontrol). В противном случае экземпляры всегда будут использоваться повторно, пока не будет достигнут максимальный уровень пула.

Дополнительные сведения о настройке компонентов для объединения в пул см. в разделе [Настройка компонента для объединения в пул](configuring-a-component-to-be-pooled.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Строки конструктора объектов COM+](com--object-constructor-strings.md)
</dt> <dt>

[Управление временем существования и состоянием объекта](controlling-object-lifetime-and-state.md)
</dt> <dt>

[Повышение производительности с помощью пула объектов](improving-performance-with-object-pooling.md)
</dt> <dt>

[Группирование транзакционных объектов в пул](pooling-transactional-objects.md)
</dt> <dt>

[Требования к объектам в пуле](requirements-for-poolable-objects.md)
</dt> </dl>

 

 
