---
title: Общие сведения о раскадровке
description: в этом обзоре основное внимание уделяется использованию переходов и раскадровок в Windows анимации.
ms.assetid: d37718ac-0256-4a24-a26c-d29173593be0
keywords:
- Windows анимация Windows анимации, общие сведения о раскадровке
- раскадровки Windows анимации, описание
- Windows анимации переходов, описание
- переходы Windows анимация, пользовательский
- интерполяция Windows анимации, описание
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca78e4638ad7c3930be25b9ff826e5fa533d2af62cc4907b7a17d4c5b636f239
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119514186"
---
# <a name="storyboard-overview"></a>Общие сведения о раскадровке

в этом обзоре основное внимание уделяется использованию переходов и раскадровок в Windows анимации. общие сведения о компонентах анимации Windows см. в разделе [общие сведения о Windows анимации](scenic-animation-api-overview.md).

Этот раздел состоит из следующих подразделов.

-   [Transitions](#custom-transitions)
    -   [Библиотека переходов](#transition-library)
    -   [Пользовательские переходы](#custom-transitions)
-   [элементы раскадровки;](#storyboards)
    -   [Создание простой раскадровки](#building-a-simple-storyboard)
    -   [Использование Context-Sensitive длительности](#using-a-context-sensitive-duration)
    -   [Создание более сложной раскадровки](#building-a-more-complex-storyboard)
    -   [Использование опорных кадров](#using-keyframes)
    -   [Хранение переменных](#holding-variables)
    -   [Планирование раскадровки](#scheduling-a-storyboard)
-   [Связанные темы](#related-topics)

## <a name="transitions"></a>Transitions

Переход определяет, как изменяется одна переменная анимации за определенный интервал времени. Windows Анимация включает библиотеку распространенных переходов, которые разработчики могут применять к одной или нескольким переменным анимации. Различные виды переходов имеют разные наборы параметров, которые могут включать значение переменной после завершения перехода, длительность перехода или количества, уникальные для базовой математической функции, например ускорение или диапазон колебаний.

Все переходы совместно используют два неявных параметра: начальное значение и начальную скорость (наклон) математической функции. Они могут быть заданы явным образом приложением, но обычно задаются диспетчером анимации как значение и скорость переменной анимации при начале перехода.

-   [Библиотека переходов](#transition-library)
-   [Пользовательские переходы](#custom-transitions)

### <a name="transition-library"></a>Библиотека переходов

В настоящее время в библиотеке переходов предоставляются следующие переходы. Если приложению требуется воздействие, которое не может быть указано с помощью библиотеки переходов, разработчики могут создавать другие виды переходов, реализуя пользовательский интерполяцию для приложения или используя библиотеку переходов от третьей стороны.



| Имя перехода                        | Описание                                                                                                                                                                                          |
|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ускорение — замедление<br/>       | Переменная анимации ускоряется, а затем замедляется в течение заданного времени.<br/>                                                                                                               |
| constant<br/>                    | Переменная анимации остается в исходном значении во время перехода.<br/>                                                                                                            |
| кубические<br/>                       | Переменная анимации меняется с исходного значения на указанное конечное значение с указанной конечной скоростью в течение заданного времени.<br/>                                                 |
| отдельного<br/>                    | Переменная анимации остается в исходном значении для указанного времени задержки, затем переключается на указанное конечное значение и остается в этом значении в течение заданного времени удержания.<br/> |
| котором<br/>               | Переменная анимации сразу же меняется от текущего значения к указанному конечному значению.<br/>                                                                                               |
| linear<br/>                      | Переменная анимации переходит линейно от начального значения к указанному конечному значению за заданную длительность.<br/>                                                                      |
| линейная с скорости<br/>           | Переменная анимации переходит линейно от начального значения к указанному конечному значению с указанной скоростью.<br/>                                                                     |
| параболическим от ускорения<br/> | Переменная анимации переходит от исходного значения к указанному конечному значению с указанной конечной скоростью, изменяя его скорость с указанным ускорением.<br/>               |
| обратный порядок<br/>                    | Переменная изменяет направление в течение заданного времени. Конечное значение будет таким же, как исходное значение, а последняя скорость будет отрицательной на начальную скорость.<br/>          |
| синусоидальной из диапазона<br/>       | Переменная осЦиллатес в заданном диапазоне значений с указанным периодом колебаний для заданной длительности.<br/>                                                                     |
| синусоидальной с скорости<br/>    | Переменная осЦиллатес с указанным периодом колебаний для заданной длительности. Амплитуда колебаний определяется начальной скоростью переменной.<br/>                      |
| гладкая Отмена<br/>                 | Переменная анимации переходит на гладкую точку в указанном окончательном значении в пределах максимальной длительности времени.<br/>                                                                              |



 

В следующей таблице приводятся иллюстрации для каждого из этих переходов.



|    Рисунки                                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ![Иллюстрация мгновенного перехода](images/instantaneoustransition.png)  ![Иллюстрация постоянного перехода](images/constanttransition.png)  ![Иллюстрация линейного перехода](images/lineartransition.png)  ![Иллюстрация линеатного перехода с скорости](images/lineartransitionfromspeed.png)  ![Иллюстрация дискретного перехода](images/discretetransition.png) |
| ![Иллюстрация параболическимного перехода из ускорения](images/parabolictransitionfromacceleration.png)  ![Иллюстрация третьего перехода](images/cubictransition.png)  ![Иллюстрация плавного перехода на новую точку](images/smoothstoptransition.png)                                                                                                                                       |
| ![Иллюстрация обратного перехода](images/reversaltransition.png)  ![Иллюстрация синусоидальнойного перехода с скорости](images/sinusolidaltransitionfromvelocity.png)  ![Иллюстрация синусоидальнойного перехода из диапазона](images/sinusolidaltransitionfromrange.png)                                                                                                                  |
| ![Иллюстрация акцеллерате и замедляет переходы](images/acceleratedeceleratetransition.png)                                                                                                                                                                                                                                                                                               |



 

### <a name="custom-transitions"></a>Пользовательские переходы

*Интерполяция* определяет математическую функцию, определяющую изменение переменной анимации с течением времени по мере продвижения ее начального значения к конечному значению. Каждый переход в библиотеке переходов имеет связанный объект интерполяции, предоставляемый системой, и реализует функцию интерполяции. Если приложению требуется результат, который не может быть указан с помощью библиотеки переходов, он может реализовать один или несколько пользовательских переходов, реализуя объект интерполяции для каждого нового перехода. Объекты интерполяции не могут использоваться приложениями напрямую и должны быть заключены в соответствующий переход. *Фабрика переходов* используется для создания переходов из объекта интерполяции. Дополнительные сведения см. в разделе [**иуианиматионинтерполатор**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationinterpolator) и [**иуианиматионтранситионфактори**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationtransitionfactory) .

Обратите внимание, что большинство приложений будут иметь все необходимые вам переходы с помощью библиотеки переходов, поэтому не нужно реализовывать интерполяцию.

## <a name="storyboards"></a>элементы раскадровки;

Раскадровка — это коллекция переходов, применяемых к одной или нескольким переменным анимации с течением времени. Переходы в раскадровке гарантированно остаются синхронизированными относительно друг друга, а раскадровка планируется или отменяется как единое целое. После создания нужных переходов приложение создает раскадровку с помощью диспетчера анимации, добавляет переходы в раскадровку, настраивает раскадровку соответствующим образом и планирует ее воспроизведение как можно быстрее. Диспетчер анимации определяет фактическое время начала раскадровки, так как может возникнуть состязание с другими раскадровками, которые в настоящее время анимированы одних и тех же переменных.

Общая длительность раскадровки зависит от длительности переходов в раскадровке. Длительность перехода не требует исправления; его можно определить по значению и скорости анимированных переменных при начале перехода. Таким образом, длительность раскадровки также может зависеть от состояния переменных, которые она анимирует.

В следующих примерах предполагается, что были созданы диспетчер анимации, Библиотека переходов и таймер. Дополнительные сведения см. [в разделе Создание основных объектов анимации](adding-animation-to-an-application.md). В примерах также предполагается, что приложение создало три переменные анимации (X, Y и Z) с помощью метода [**иуианиматионманажер:: креатеаниматионвариабле**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationmanager-createanimationvariable) и пять переходов (T1, T2, T3, T4 и T5) с помощью одного из методов интерфейса [**иуианиматионтранситионлибрари**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationtransitionlibrary) .

-   [Создание простой раскадровки](#building-a-simple-storyboard)
-   [Использование Context-Sensitive длительности](#using-a-context-sensitive-duration)
-   [Создание более сложной раскадровки](#building-a-more-complex-storyboard)
-   [Использование опорных кадров](#using-keyframes)
-   [Хранение переменных](#holding-variables)
-   [Планирование раскадровки](#scheduling-a-storyboard)

### <a name="building-a-simple-storyboard"></a>Создание простой раскадровки

Чтобы создать простую раскадровку, используйте метод [**иуианиматионманажер:: креатесторибоард**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationmanager-createstoryboard) для создания новой раскадровки, метод [**Иуианиматионтранситионлибрари:: креателинеартранситион**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationtransitionlibrary-createlineartransition) , чтобы создать линейный переход, T1 и метод [**IUIAnimationStoryboard:: AddTransition**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addtransition) для применения перехода T1 к переменной X и добавления результирующего перехода в раскадровку.

Этот процесс дает простую раскадровку, как показано на следующем рисунке. Раскадровка содержит один переход (T1), так что значение переменной X изменяется линейно за фиксированный период времени.

![Иллюстрация, демонстрирующая простую раскадровку с фиксированной длительностью](images/simplestoryboardfixedduration.png)

Обратите внимание, что для такого простого сценария альтернативным вариантом является использование метода [**иуианиматионманажер:: счедулетранситион**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationmanager-scheduletransition) .

### <a name="using-a-context-sensitive-duration"></a>Использование Context-Sensitive длительности

Хотя некоторые переходы имеют фиксированную длительность, длительность других зависит от первоначального значения или скорости анимированной переменной при начале перехода. Например, метод [**иуианиматионтранситионлибрари:: креателинеартранситионфромспид**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationtransitionlibrary-createlineartransitionfromspeed) создает переход с длительностью, пропорциональной разнице между начальным значением переменной анимации и указанным итоговым значением. На этом рисунке и на оставшихся иллюстрациях, таких переходов с произвольными продолжительностью, отображается вопросительный знак (?), а их фактическая длительность определяется при воспроизведении раскадровки.

![Иллюстрация, демонстрирующая простую раскадровку с неизвестной длительностью](images/simplestoryboardunknownduration.png)

### <a name="building-a-more-complex-storyboard"></a>Создание более сложной раскадровки

После создания раскадровки и добавления одного перехода (T1) можно добавить второй переход для переменной X, вызвав метод [**иуианиматионсторибоард:: аддтранситион**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addtransition) еще раз, но с T2 вместо T1.

Предполагая, что переход T2 имеет длительность, зависящую от контекста, раскадровка теперь содержит два обратных перехода от произвольной длительности, влияющие на переменную X.

![Иллюстрация, показывающая раскадровку, содержащую два перехода на одну и ту же переменную](images/appendingwithaddtransition.png)

Повторный вызов [**аддтранситион**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addtransition) с переменной Y и Transition T3 добавляет третий переход в начало раскадровки. В зависимости от значений X и Y при воспроизведении раскадровки T3 могут заканчиваться после T1 или даже после T2.

![Иллюстрация, показывающая раскадровку, содержащую переходы по нескольким переменным](images/multivariablestoryboard.png)

### <a name="using-keyframes"></a>Использование опорных кадров

Чтобы добавить переход со смещением от начала раскадровки, необходимо сначала добавить опорный кадр. Ключевые кадры представляют мгновенные сообщения, и сами по себе не влияют на поведение раскадровки. У каждой раскадровки есть неявный ключевой кадр, представляющий начало раскадровки, [**\_ \_ \_ \_ начало раскадровки анимации пользовательского интерфейса**](/previous-versions/windows/desktop/legacy/dd756780(v=vs.85)); вы можете добавлять новые опорные кадры по смещению от начала, вызывая метод [**иуианиматионсторибоард:: аддкэйфрамеатоффсет**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addkeyframeatoffset) с **\_ \_ \_ \_ началом раскадровки для анимации пользовательского интерфейса**.

Смещение, при котором добавляется опорный кадр, всегда отсчитывается относительно другого опорного кадра. На следующей диаграмме показан результат добавления keyframe1 и переходов T4, который применяется к переменной Z, соответствует keyframe1 и создается с фиксированной длительностью. Конечно, поскольку длительность других переходов еще не известна, T4 может не быть последним переходом к завершению.

![Иллюстрация, показывающая добавление перехода по опорному кадру](images/addtransitionatkeyframe.png)

Опорные кадры также можно разместить на концах переходов с помощью метода [**иуианиматионсторибоард:: аддкэйфрамеафтертранситион**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addkeyframeaftertransition) . На следующей диаграмме показан результат добавления keyframe2 после T1 и keyframe3 после T2.

![Иллюстрация, демонстрирующая Добавление опорных кадров после различных переходов](images/addkeyframeaftertransition.png)

Так как длительность T1 и T2 неизвестны до воспроизведения раскадровки, смещения keyframe2 и keyframe3 также не определяются до тех пор, пока не будут воспроизводиться. Следовательно, keyframe2 и даже keyframe3 могут происходить раньше keyframe1.

Начало и конец перехода можно согласовать с опорными кадрами с помощью метода [**иуианиматионсторибоард:: аддтранситионбетвинкэйфрамес**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-addtransitionbetweenkeyframes) . На следующей диаграмме показан результат добавления пятого перехода (T5) для переменной Y между keyframe2 и keyframe3. Это изменяет длительность T5, делая его более длинным или коротким в зависимости от относительного смещения keyframe2 и keyframe3.

![Иллюстрация, демонстрирующая аддитон перехода между опорными кадрами](images/addtransitionbetweenkeyframes.png)

### <a name="holding-variables"></a>Хранение переменных

Если T4 завершается после T2 и T5, то раскадровка прекращает анимировать переменные X и Y, делая их доступными для анимации других раскадровок. Однако приложение может вызвать метод [**иуианиматионсторибоард:: холдвариабле**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-holdvariable) , чтобы запрашивать, что раскадровка удерживает некоторые или все переменные, которые она анимирует, в своих конечных значениях до завершения раскадровки. На следующей диаграмме показан результат удержания X и Z при последнем завершении T4. Обратите внимание, что раскадровка содержит X в своем окончательном значении до завершения раскадровки. Удержание не влияет на Z, поскольку раскадровка заканчивается после завершения T4.

![Иллюстрация, показывающая хранение переменных в конечных значениях до завершения раскадровки](images/holdvariable.png)

Несмотря на то, что эта раскадровка не удерживает Y, ее значение не меняется после завершения T5, если только другая раскадровка не выполняет анимацию. Поскольку Y не удерживается, любая другая раскадровка, независимо от приоритета, может анимировать Y после завершения T5. В отличие от этого, поскольку удерживается X, раскадровка с более низким приоритетом не может анимировать X до завершения этой раскадровки.

Во всех этих иллюстрациях предполагается произвольный набор текущих значений для переменных, когда начинается воспроизведение раскадровки. При обнаружении других значений длительность контекстно-зависимых переходов, скорее всего, будет отличаться, как показано на следующем рисунке.

![Иллюстрация, демонстрирующая результат изменения начальных условий, использованных для предыдущей иллюстрации](images/holdvariablez.png)

В этом сценарии T5 начинается до того, как T3 завершен, а T3, следовательно, усекается. Поскольку T4 завершается раньше T2 и T5, значение Z удерживается до конца раскадровки. Как правило, значения и скоростей переменных при запуске раскадровки могут повлиять на порядок кадров и общую длину и форму раскадровки.

### <a name="scheduling-a-storyboard"></a>Планирование раскадровки

При планировании раскадровки ее время начала определяется по структуре и контурам раскадровок, которые в данный момент находятся в расписании. В частности, первое и последнее время, когда раскадровка анимируется каждую отдельную переменную, определяют, когда две раскадровки конфликтуют, а внутренние сведения о переходах в пределах не важны.

На следующем рисунке показана структура раскадровки с пятью переходами, которая выполняет анимацию трех переменных.

![Иллюстрация с раскадровкой с пятью переходами анимация трех переменных](images/storyboardwithoutline.png)

основой платформы анимации Windows является поддержка выполнения одной анимации до начала другой, когда это необходимо. Хотя это устраняет многие логические проблемы, оно также вводит произвольную задержку в пользовательском интерфейсе. Для решения этой задачи приложения могут указать *самую длинную допустимую задержку* для запуска раскадровки с помощью метода [**Иуианиматионсторибоард:: сетлонжестакцептабледелай**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-setlongestacceptabledelay) , а диспетчер анимации использует эти сведения для планирования раскадровки до истечения указанного периода задержки. При планировании раскадровки диспетчер анимации определяет, должны ли быть отменены, обрезаны, завершены или сжаты другие раскадровки.

Приложение может зарегистрировать обработчик, который будет вызываться при изменении состояния раскадровки. Это позволяет приложению ответить, когда раскадровка начинается, выполняется до завершения, удаляется полностью из расписания или из-за прерывания с помощью раскадровки с более высоким приоритетом. Для обнаружения раскадровки, передаваемых обработчикам событий раскадровки (или сравнению приоритетов), приложение может использовать метод [**иуианиматионсторибоард:: сеттаг**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationstoryboard-settag) для применения тегов к раскадровкам аналогично тем, которые можно использовать для обозначения переменных. Как и в случае повторного использования раскадровки, разработчики должны соблюдать осторожность при использовании тегов для определения раскадровок и убедиться, что неоднозначность возникает, когда пользовательские действия приводят к постановке в очередь нескольких раскадровок.

В следующих примерах показаны два варианта планирования раскадровки, построенной в предыдущих разделах этого раздела.

В этом сценарии шесть раскадровок, от A до F, уже запланировали анимацию переменных W, X, Y и Z, но началось воспроизведение только A и B. Новая раскадровка с меткой G имеет самую длинную допустимую задержку, указанную на следующем рисунке.

![Иллюстрация, демонстрирующая Добавление новой раскадровки к существующему расписанию](images/existingschedule1withlines.png)

В приложении зарегистрированы сравнения приоритетов, включающие следующую логику:

-   G может отменять только C и E и только для предотвращения сбоя.
-   G может обрезать только A, C, E и F и только для предотвращения сбоя.
-   Любая раскадровка может сжимать любую другую раскадровку (сжатие всегда выполняется только во избежание сбоя).

> [!Note]  
> Квалификатор "только для предотвращения сбоя" означает, что зарегистрированные сравнения приоритетов возвращают значение " \_ ОК" только в том случае, если параметр *приоритеффект* имеет значение " **\_ \_ \_ \_ сбой эффекта анимации пользовательского интерфейса**". Дополнительные сведения см. в описании метода [**иуианиматионприоритикомпарисон:: хасприорити**](/windows/desktop/api/UIAnimation/nf-uianimation-iuianimationprioritycomparison-haspriority) .

 

Чтобы начать G до истечения максимальной допустимой задержки, диспетчер анимации должен выполнить следующие действия.

-   Обрезать F
-   Отмена E

Когда E отменяется, D и F открываются и возвращаются к исходным контурам:

![Иллюстрация, демонстрирующая исходные контуры](images/existingschedule1bwithlines.png)

Диспетчеру анимации не нужно отменять или обрезать C до расписания до истечения максимальной допустимой задержки, поэтому встреча C и G определяет время начала операции G.

![Иллюстрация, показывающая, что f обрезан, чтобы разрешить c и g отвечать](images/schedule1withgwithlines.png)

После успешного планирования операции G можно определить продолжительность ее переходов, и в остальной части ее структуры будет известно, что она известна. Однако структура может измениться, если другая раскадровка будет удалена из расписания.

Во втором примере рассмотрим сценарий, подобный приведенному выше, но с более короткой допустимой задержкой, заданной для G.

![Иллюстрация, показанная в предыдущем сценарии, но с более короткой допустимой задержкой для g](images/existingschedule2withlines.png)

В этом случае выполняются следующие действия.

-   Обрезать F
-   Отмена E
-   Отмена в

Кроме того, диспетчер анимации должен сжимать D по показанному объему, чтобы разрешить запуск G по истечении максимальной допустимой задержки, а не позже.

![Иллюстрация, показывающая, где d должен быть сжат, чтобы разрешить запуск g с максимальной допустимой задержкой](images/trimmedandcancelledwithlines.png)

Для сохранения относительных сроков, A, B и F также сжимаются.

![Иллюстрация, в которой показаны сжатые, b, d и f](images/schedule2withgwithlines.png)

Однако раскадровки несвязанных переменных (не показано) не будут сжиматься.

Опять же, структура G теперь известна и отличается от результата в первом сценарии, так как переменные имеют разные значения при начале G.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**иуианиматионманажер**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationmanager)
</dt> <dt>

[**иуианиматионприоритикомпарисон**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationprioritycomparison)
</dt> <dt>

[**иуианиматионсторибоард**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationstoryboard)
</dt> <dt>

[**иуианиматионтранситионлибрари**](/windows/desktop/api/UIAnimation/nn-uianimation-iuianimationtransitionlibrary)
</dt> </dl>

 

