---
description: Представляет запись атрибута.
ms.assetid: f9d9458c-b179-441c-9f62-ff0ac2f75329
title: Структура ATTRIBUTE_RECORD_HEADER
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- ATTRIBUTE_RECORD_HEADER
api_type:
- NA
api_location: ''
ms.openlocfilehash: ae710ca04f11cb70c1bad9b5e6fec25f8fb5e94f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103895366"
---
# <a name="attribute_record_header-structure"></a>\_ \_ Структура заголовка записи атрибута

\[Эта структура допустима только для томов NTFS версии 3; Он может быть изменен в будущих версиях.\]

Представляет запись атрибута.

## <a name="syntax"></a>Синтаксис


```C++
typedef struct _ATTRIBUTE_RECORD_HEADER {
  ATTRIBUTE_TYPE_CODE TypeCode;
  ULONG               RecordLength;
  UCHAR               FormCode;
  UCHAR               NameLength;
  USHORT              NameOffset;
  USHORT              Flags;
  USHORT              Instance;
  union {
    struct {
      ULONG  ValueLength;
      USHORT ValueOffset;
      UCHAR  Reserved[2];
    } Resident;
    struct {
      VCN      LowestVcn;
      VCN      HighestVcn;
      USHORT   MappingPairsOffset;
      UCHAR    Reserved[6];
      LONGLONG AllocatedLength;
      LONGLONG FileSize;
      LONGLONG ValidDataLength;
      LONGLONG TotalAllocated;
    } Nonresident;
  } Form;
} ATTRIBUTE_RECORD_HEADER, *PATTRIBUTE_RECORD_HEADER;
```



## <a name="members"></a>Члены

<dl> <dt>

**Код типа**
</dt> <dd>

Код типа атрибута.



| Значение                                                                                                                                                                                                                                           | Значение                                                                                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="_STANDARD_INFORMATION"></span><span id="_standard_information"></span><dl> <dt>**$Standard \_ СВЕДЕНИЯ**</dt> <dt>0x10</dt> </dl> | Атрибуты файлов (например, только для чтения и архивация), метки времени (например, создание файла и Последнее изменение) и число жестких связей.<br/> |
| <span id="_ATTRIBUTE_LIST"></span><span id="_attribute_list"></span><dl> <dt>**$Attribute \_ Список**</dt> <dt>0x20</dt> </dl>                   | Список атрибутов, образующих файл, и ссылка на файл записи MFT, в которой расположен каждый атрибут.<br/>     |
| <span id="_FILE_NAME"></span><span id="_file_name"></span><dl> <dt>**$File \_ ИМЯ**</dt> <dt>0x30</dt> </dl>                                  | Имя файла в символах Юникода.<br/>                                                                                     |
| <span id="_OBJECT_ID"></span><span id="_object_id"></span><dl> <dt>**$Object \_ Идентификатор**</dt> <dt>0x40</dt> </dl>                                  | 64-байтовый идентификатор объекта, назначенный службой отслеживания ссылок.<br/>                                                              |
| <span id="_VOLUME_NAME"></span><span id="_volume_name"></span><dl> <dt>**$Volume \_ ИМЯ**</dt> <dt>0x60</dt> </dl>                            | Метка тома. Содержится в файле $Volume.<br/>                                                                                   |
| <span id="_VOLUME_INFORMATION"></span><span id="_volume_information"></span><dl> <dt>**$Volume \_ СВЕДЕНИЯ**</dt> <dt>0x70</dt> </dl>       | Сведения о томе. Содержится в файле $Volume.<br/>                                                                             |
| <span id="_DATA"></span><span id="_data"></span><dl> <dt>**$Data**</dt> <dt>0x80</dt> </dl>                                                  | Содержимое файла.<br/>                                                                                                        |
| <span id="_INDEX_ROOT"></span><span id="_index_root"></span><dl> <dt>**$Index \_ КОРНЕВой**</dt> <dt>0x90</dt> </dl>                               | Используется для реализации выделения имен файлов для больших каталогов.<br/>                                                                     |
| <span id="_INDEX_ALLOCATION"></span><span id="_index_allocation"></span><dl> <dt>**$Index \_**</dt> <dt>0x82</dt> выделения </dl>             | Используется для реализации выделения имен файлов для больших каталогов.<br/>                                                                     |
| <span id="_BITMAP"></span><span id="_bitmap"></span><dl> <dt>**$Bitmap**</dt> <dt>0xB0</dt> </dl>                                            | Индекс точечного рисунка для большого каталога.<br/>                                                                                            |
| <span id="_REPARSE_POINT"></span><span id="_reparse_point"></span><dl> <dt>**$REPARSE \_ ТОЧКА**</dt> <dt>0xC0</dt> </dl>                      | Данные точки повторного анализа.<br/>                                                                                                          |



 

</dd> <dt>

**RecordLength**
</dt> <dd>

Размер записи атрибута в байтах. Это значение отражает требуемый размер для варианта записи и всегда округляется до ближайшей границы куадворд.

</dd> <dt>

**формкоде**
</dt> <dd>

Код формы атрибута.



| Значение                                                                                                                                                                                                                            | Значение                                                                                                   |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| <span id="RESIDENT_FORM"></span><span id="resident_form"></span><dl> <dt>**Резидентная \_ ФОРМА**</dt> <dt>0x00</dt> </dl>          | Значение содержится в записи файла и сразу после заголовка записи атрибута.<br/> |
| <span id="NONRESIDENT_FORM"></span><span id="nonresident_form"></span><dl> <dt>**НЕрезидентная \_ ФОРМА**</dt> <dt>0x01</dt> </dl> | Значение содержится в других секторах на диске.<br/>                                           |



 

</dd> <dt>

**NameLength**
</dt> <dd>

Размер необязательного имени атрибута, в символах или 0, если имя атрибута отсутствует. Максимальная длина имени атрибута — 255 символов.

</dd> <dt>

**намеоффсет**
</dt> <dd>

Смещение имени атрибута от начала записи атрибута в байтах. Если элемент **намеленгс** имеет значение 0, этот член не определен.

</dd> <dt>

**Флаги**
</dt> <dd>

Флаги атрибута.

<dl> <dt>

<span id="ATTRIBUTE_FLAG_COMPRESSION_MASK"></span><span id="attribute_flag_compression_mask"></span>**Атрибут \_ ФЛАГ \_ \_ маски сжатия** (0x00FF)
</dt> <dt>

<span id="ATTRIBUTE_FLAG_SPARSE"></span><span id="attribute_flag_sparse"></span>**Атрибут \_ ФЛАГ \_ разреженного** (0x8000)
</dt> <dt>

<span id="ATTRIBUTE_FLAG_ENCRYPTED"></span><span id="attribute_flag_encrypted"></span>**Атрибут \_ ФЛАГ \_ зашифрован** (0x4000)
</dt> </dl> </dd> <dt>

**Экземпляр**
</dt> <dd>

Уникальный экземпляр для этого атрибута в записи файла.

</dd> <dt>

**Form**
</dt> <dd>

Если элемент **формкоде** является резидентной \_ формой, объединение является **резидентной** структурой. Если **формкоде** является нерезидентной \_ формой, объединение является **нерезидентной** структурой.

<dl> <dt>

**Принтера**
</dt> <dd> <dl> <dt>

**валуеленгс**
</dt> <dd>

Размер значения атрибута в байтах.

</dd> <dt>

**валуеоффсет**
</dt> <dd>

Смещение значения от начала записи атрибута в байтах.

</dd> <dt>

**Reserved**
</dt> <dd>

Зарезервировано.

</dd> </dl> </dd> <dt>

**Нерезидентная**
</dt> <dd> <dl> <dt>

**ловествкн**
</dt> <dd>

Самый низкий номер виртуального кластера (VCN), охватываемый этой записью атрибута.

</dd> <dt>

**хигхествкн**
</dt> <dd>

Самое высокое значение VCN, охваченное этой записью атрибута.

</dd> <dt>

**маппингпаирсоффсет**
</dt> <dd>

Смещение массива пар сопоставлений от начала записи атрибута в байтах. Дополнительные сведения см. в подразделе "Примечания".

</dd> <dt>

**Reserved**
</dt> <dd>

Зарезервировано.

</dd> <dt>

**аллокатедленгс**
</dt> <dd>

Выделенный размер файла в байтах. Это значение кратно размеру кластера. Этот элемент является недопустимым, если элемент **ловествкн** не равен нулю.

</dd> <dt>

**Размер файла**
</dt> <dd>

Размер файла (максимальный байт, который можно прочитать плюс 1) в байтах. Этот элемент является недопустимым, если **ловествкн** не равен нулю.

</dd> <dt>

**валиддаталенгс**
</dt> <dd>

Допустимая длина данных (наибольший инициализированный байт плюс 1) в байтах. Это значение округляется до ближайшей границы кластера. Этот элемент является недопустимым, если **ловествкн** не равен нулю.

</dd> <dt>

**тоталаллокатед**
</dt> <dd>

Общее значение, выделенное для файла (сумма выделенных кластеров).

</dd> </dl> </dd> </dl> </dd> </dl>

## <a name="remarks"></a>Комментарии

Обратите внимание, что для этой структуры нет связанного файла заголовка.

Это определение структуры допустимо только для основной версии 3 и дополнительной версии 0 или 1, как сообщается [**фсктл \_ Получение \_ \_ \_ данных тома NTFS**](/windows/win32/api/winioctl/ni-winioctl-fsctl_get_ntfs_volume_data).

Записи атрибутов всегда выводятся по границе куадворд.

Если атрибут не является резидентным, заголовок записи атрибута содержит список сведений о извлечении, которые предоставляют сопоставление между VCN и Number логического кластера (LCN) для атрибута. Если сведения о извлечении не помещаются в основном сегменте файла, они могут храниться в сегменте записи внешнего файла сами по себе. Если он по-прежнему не помещается в сегмент записи внешнего файла, в списке атрибутов можно включить несколько записей для атрибута, требующих дополнительных сведений для получения.

Массив пар сопоставления хранится в сжатой форме и предполагает, что информация распакована и кэшируется системой. Он состоит из серии пар Некствкн/Куррентлкн. Например, если файл имеет один запуск из 8 кластеров, начиная с LCN 128, а файл начинается с Ловествкн 0, то массив пар сопоставлений содержит только одну запись, которая имеет Некствкн = 8 и Куррентлкн = 128. Массив представляет собой байтовый поток, который сохраняет изменения в рабочих переменных при последовательной обработке. Поток байтов интерпретируется как поток Triple с нулевым нулем, как показано ниже:

Счетчик Byte = *v* + (*l* \* 16)

где *v* — число измененных младших байтов VCN, а *l* — число измененных байт LCN с низким порядковым номером.

Алгоритм распаковки выглядит следующим образом:

1.  Инициализируйте Некствкн `Attribute->LowestVcn` и куррентлкн до 0.
2.  Инициализирует указатель потока байтов на `(PCHAR)Attribute + Attribute->AttributeForm->Nonresident->MappingPairsOffset` .
3.  Задайте для Куррентвкн значение Некствкн.
4.  Считывает следующий байт из потока. Если значение равно 0, то Break; иначе Извлеките *v* и *l* , как описано выше.
5.  Интерпретирует следующие *v* байты как количество со знаком, а сначала байт нижнего порядка. Распакуйте подписывание подписывания на 64 бит и добавьте его в Некствкн.
6.  Интерпретировать следующие *l* байты как количество со знаком, начиная с младшего байта. Распакуйте подписывание подписывания на 64 бит и добавьте его в Куррентлкн. Если это Куррентлкн 0, то Вкнс из Куррентвкн в Некствкн – 1 не распределены.
7.  Обновите кэшированные сведения о сопоставлении из Куррентвкн, Некствкн и Куррентлкн.
8.  Перейдите к шагу 3.

## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Основная таблица файлов](master-file-table.md)
</dt> </dl>

 

 
