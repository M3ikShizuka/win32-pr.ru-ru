---
description: Связь часто включает потенциально большие объемы данных или данные неизвестной длины.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Использование Секбуффердеск и Pvbuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103911855"
---
# <a name="using-secbufferdesc-and-secbuffer"></a>Использование Секбуффердеск и Pvbuffer

Связь часто включает потенциально большие объемы данных или данные неизвестной длины. Отправка и получение данных выполняются аналогично или одинаково в обоих случаях. Для обработки неизвестной длины и потенциально больших объемов данных связь SSPI выполняется с помощью двух структур: [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) и [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).

Структура [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) — это контейнер для массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) . Структура **секбуффердеск** имеет следующие члены:

-   Номер версии
-   Число элементов [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)
-   Адрес массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)

Структура [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) содержит следующие три члена:

-   Число байтов в буфере
-   Тип сведений, содержащихся в элементе данных
-   Сами байты

Полное сообщение SSPI часто состоит из массива структур [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .

Следующие типы данных буфера определяются следующим образом.



| Тип буфера                | Значение                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| PVBUFFER \_ пусто           | Не определено, заменено функцией [*пакета безопасности*](../secgloss/s-gly.md) |
| \_данные pvbuffer            | Данные пакета                                                                                                                            |
| \_токен pvbuffer           | Маркер безопасности                                                                                                                         |
| \_Параметры pvbuffer pkg \_     | Параметры, зависящие от пакета                                                                                                            |
| \_отсутствует pvbuffer         | Отсутствующий индикатор данных                                                                                                                 |
| PVBUFFER, \_ дополнительный           | Дополнительные данные                                                                                                                             |
| \_поток pvbuffer          | Данные потока безопасности                                                                                                                   |
| \_трейлер потока \_ pvbuffer | Трейлер потока безопасности                                                                                                                |
| \_заголовок потока \_ pvbuffer  | Заголовок потока безопасности                                                                                                                 |



 

Приведенные выше буферы можно комбинировать с помощью битовой операции **or** с любым из следующих типов буфера.



| Тип буфера         | Значение                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| PVBUFFER \_ аттрмаск | Маскировать атрибуты безопасности, разделив флаги атрибутов от типа буфера. |
| PVBUFFER \_ ReadOnly | Буфер доступен только для чтения                                                              |



 

Перед каждым вызовом API SSPI, для которого требуется параметр [**секбуффердеск**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , объявляется и инициализируется один или несколько элементов массива [**pvbuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) . Например, могут существовать два буфера безопасности: один, содержащий входные данные сообщения, а другой — непрозрачный токен безопасности, возвращенный пакетом безопасности. Порядок буферов безопасности в дескрипторе буфера безопасности не важен, но каждый буфер должен быть помечен соответствующим типом. Тег, предназначенный только для чтения, можно использовать со всеми входными буферами, которые не должны изменяться [*пакетом безопасности*](../secgloss/s-gly.md).

Важен размер выходного буфера, который должен содержать маркер безопасности. Приложение может найти максимальный размер маркера для пакета безопасности во время начальной настройки. Вызов [**енумератесекуритипаккажес**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) возвращает массив указателей на сведения о пакете безопасности. Структура сведений о пакете безопасности содержит максимальный размер маркера для каждого пакета. В этом примере сведения находятся в элементе **кбмакстокен** структуры [**секпкгинфо**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) . Те же сведения можно получить позже с помощью [**куерисекуритипаккажеинфо**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).

Приложение инициализирует указатели буфера и размеры в описании буфера, чтобы указать, где можно найти данные сообщений и другие сведения.

Дополнительные сведения см. в разделе [пример кода pvbuffer и секбуффердеск](secbuffer-and-secbufferdesc-example-code.md).

 

 
