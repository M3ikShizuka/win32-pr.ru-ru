---
description: Контексты потоков обрабатывали защищенные потоковые протоколы, такие как SSL или PCT.
ms.assetid: 05a6b036-1f7f-473f-9813-a1e1534e0f0d
title: Контексты потока
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53103dc1269c05e5a2c162133d21e167d8035c2c
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127146582"
---
# <a name="stream-contexts"></a>Контексты потока

Контексты потоков обрабатывали защищенные потоковые протоколы, такие как SSL или PCT. В интересах совместного использования одного и того же интерфейса и аналогичного управления учетными данными SSPI обеспечивает поддержку контекстов потоков. [*Протокол безопасности*](../secgloss/s-gly.md) включает как потоковую схему проверки подлинности, так и форматы записей.

Для обеспечения протоколов, ориентированных на поток, [*пакеты безопасности*](../secgloss/s-gly.md) , поддерживающие контексты потоков, имеют следующие характеристики процесса:

-   Пакет устанавливает \_ флаг потока флага SECPKG, \_ чтобы указать, что он поддерживает семантику потока.
-   Транспортные приложения запрашивают семантику потока, устанавливая в \_ \_ \_ \_ вызовах функций [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) и [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) флаги "поток требований" ISC "и" ASC req Stream ".
-   Приложение вызывает функцию [**QueryContextAttributes (General)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) с структурой [**секпкгконтекст \_ стреамсизес**](/windows/desktop/api/Sspi/ns-sspi-secpkgcontext_streamsizes) , чтобы запросить [*контекст безопасности*](../secgloss/s-gly.md) о количестве предоставляемых буферов и размерах, резервируемых для заголовков или трейлеров.
-   Приложение предоставляет дескрипторы буфера для резервирования во время фактической обработки данных. Указывая семантику потока, вызывающий объект указывает готовность выполнить лишнюю обработку, чтобы [*пакет безопасности*](../secgloss/s-gly.md) мог обработать блокировку сообщений. По сути, для функций [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature) и [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) вызывающий объект передает список буферов. Когда сообщение получено из канала, ориентированного на поток (например, TCP-порт), вызывающий объект передает список буферов следующим образом.

    | Буфер | Длина         | Тип буфера      |
    |--------|----------------|------------------|
    | 1      | Длина сообщения | \_данные pvbuffer  |
    | 2      | 0              | PVBUFFER \_ пусто |
    | 3      | 0              | PVBUFFER \_ пусто |
    | 4      | 0              | PVBUFFER \_ пусто |
    | 5      | 0              | PVBUFFER \_ пусто |

    

     

    Затем пакет безопасности работает с большим [*двоичным объектом*](../secgloss/b-gly.md). Если функция возвращается успешно, буферный список выглядит следующим образом.

    

    | Буфер | Длина         | Тип буфера                |
    |--------|----------------|----------------------------|
    | 1      | Длина заголовка  | \_заголовок потока \_ pvbuffer  |
    | 2      | Длина данных    | \_данные pvbuffer            |
    | 3      | Длина трейлера | \_трейлер потока \_ pvbuffer |
    | 4      | 0              | PVBUFFER \_ пусто           |
    | 5      | 0              | PVBUFFER \_ пусто           |

    

     

    Пакет мог бы также вернуть буфер \# 4 с длиной x и типом буфера pvbuffer \_ , что означает, что данные в этом буфере являются частью следующей записи и еще не были обработаны. И наоборот, если функция Message возвращает \_ \_ код ошибки незавершенного сообщения sec E \_ , возвращенный буфер будет выглядеть следующим образом.

    

    | Буфер | Длина | Тип буфера        |
    |--------|--------|--------------------|
    | 1      | x      | \_отсутствует pvbuffer |

    

     

    Это означает, что для обработки записи потребовались дополнительные данные. В отличие от большинства ошибок, возвращаемых функцией Message, этот тип буфера не указывает на то, что контекст был скомпрометирован. Вместо этого он указывает, что требуются дополнительные данные. [*пакеты безопасности*](../secgloss/s-gly.md) не должны обновлять свое [*состояние*](../secgloss/s-gly.md) в этом состоянии.

    Аналогично, на стороне отправителя взаимодействия вызывающий объект может вызвать функцию [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature) . Возможно, для пакета безопасности потребуется перераспределить буфер или выполнить операции копирования. Вызывающий объект может быть более эффективным, предоставляя список буферов следующим образом.

    

    | Буфер | Длина         | Тип                       |
    |--------|----------------|----------------------------|
    | 1      | Длина заголовка  | \_заголовок потока \_ pvbuffer  |
    | 2      | Длина данных    | \_данные pvbuffer            |
    | 3      | Длина трейлера | \_трейлер потока \_ pvbuffer |

    

     

    Это позволяет вызывающему объекту более эффективно использовать буферы. Вызвав функцию [**QueryContextAttributes**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) , чтобы определить объем пространства, которое необходимо зарезервировать перед вызовом [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature), операция более эффективна для приложения и пакета безопасности.

 

 
