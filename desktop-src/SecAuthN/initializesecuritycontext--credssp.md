---
description: Инициирует на стороне клиента исходящий контекст безопасности из маркера учетных данных.
ms.assetid: f3d8c07b-db28-4f26-ba29-8733fc95bdb5
title: Функция InitializeSecurityContext (CredSSP) (Sspi.h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: aa359fc0cedf96f43d93cfb7d962035453328759
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127567534"
---
# <a name="initializesecuritycontext-credssp-function"></a>Функция InitializeSecurityContext (CredSSP)

Функция **InitializeSecurityContext (CredSSP)** инициирует на стороне клиента исходящий контекст безопасности из маркера учетных данных. Функция создает контекст безопасности между клиентским приложением и удаленным одноранговым узлом. **InitializeSecurityContext (CredSSP)** возвращает маркер, который клиент должен передать удаленному одноранговому узлу; узел, в свою очередь, отправляет этот маркер в локальную реализацию безопасности через вызов [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md) . Создаваемый токен должен считаться непрозрачным для всех вызывающих объектов.

Как правило, функция **InitializeSecurityContext (CredSSP)** вызывается в цикле до тех пор, пока не будет установлен достаточный контекст безопасности.

## <a name="syntax"></a>Синтаксис


```C++
SECURITY_STATUS SEC_ENTRY InitializeSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    SEC_CHAR       *pszTargetName,
  _In_        unsigned long  fContextReq,
  _Reserved_  unsigned long  Reserved1,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PSecBufferDesc pInput,
  _In_        unsigned long  Reserved2,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Out_opt_   PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*фкредентиал* \[ в необязательное\]
</dt> <dd>

Описатель учетных данных, возвращаемых [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md). Этот маркер используется для создания контекста безопасности. Для функции **InitializeSecurityContext (CredSSP)** требуются как минимум исходящие учетные данные.

</dd> <dt>

*фконтекст* \[ в необязательное\]
</dt> <dd>

Указатель на структуру [кткссандле](sspi-handles.md) . При первом вызове метода **InitializeSecurityContext (CredSSP)** этот указатель имеет **значение NULL**. При втором вызове этот параметр является указателем на маркер для частично сформированного контекста, возвращаемого в параметре *фневконтекст* при первом вызове.

При первом вызове метода **InitializeSecurityContext (CredSSP)** укажите **значение NULL**. В будущих вызовах укажите токен, полученный в параметре *фневконтекст* , после первого вызова этой функции.

</dd> <dt>

*птаржетнаме* \[ в необязательное\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая уникальным образом идентифицирует целевой сервер. SChannel использует это значение для проверки сертификата сервера. Schannel также использует это значение для нахождение сеанса в кэше сеанса при повторном подключении. Кэшированный сеанс используется только в том случае, если выполняются все перечисленные ниже условия.

-   Имя целевого объекта совпадает.
-   Срок действия записи кэша не истек.
-   Процесс приложения, вызывающий функцию, совпадает.
-   Сеанс входа в систему аналогичен.
-   Один и тот же маркер учетных данных.

</dd> <dt>

*фконтекстрек* \[ окне\]
</dt> <dd>

Битовые флаги, указывающие запросы для контекста. Не все пакеты могут поддерживать все требования. Для флагов, используемых для этого параметра, используется префикс ISC \_ req \_ , например, ISC \_ req \_ Delegate.

Этот параметр может иметь один или несколько следующих флагов атрибутов.



| Значение                                                                                                                                                                                                                                                                            | Значение                                                                                                                                                                                                                                                            |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ISC_REQ_ALLOCATE_MEMORY"></span><span id="isc_req_allocate_memory"></span><dl> <dt>**ISC \_ ТРЕБОВАНИЯ \_ выделения \_ памяти**</dt> <dt>0x100</dt> </dl>                         | Пакет безопасности выделяет буферы вывода для вызывающего объекта. Завершив использование выходных буферов, освободите их, вызвав функцию [**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .<br/>                                                        |
| <span id="ISC_REQ_CONNECTION"></span><span id="isc_req_connection"></span><dl> <dt>**ISC \_ ЗАЯВКа на \_ Подключение**</dt> <dt>0x800</dt> </dl>                                         | Контекст безопасности не будет работать с сообщениями форматирования.<br/>                                                                                                                                                                                               |
| <span id="ISC_REQ_EXTENDED_ERROR"></span><span id="isc_req_extended_error"></span><dl> <dt>**ISC \_ \_Расширенная \_ Ошибка**</dt> <dt>0x4000</dt> </dl>                           | При возникновении ошибок удаленная сторона будет уведомлена.<br/>                                                                                                                                                                                                   |
| <span id="ISC_REQ_MANUAL_CRED_VALIDATION"></span><span id="isc_req_manual_cred_validation"></span><dl> <dt>**ISC \_ Запрос \_ на \_ \_ проверку вручную для проверки**</dt> <dt>0x80000</dt> </dl> | Поставщик поддержки безопасности учетных данных (CredSSP) не должен автоматически проверять подлинность сервера. Этот флаг всегда задается при использовании CredSSP.<br/>                                                                                                              |
| <span id="ISC_REQ_SEQUENCE_DETECT"></span><span id="isc_req_sequence_detect"></span><dl> <dt>**ISC \_ \_Последовательность требований \_ обнаружения**</dt> <dt>0x8</dt> </dl>                           | Обнаружение сообщений, полученных за пределами последовательности.<br/>                                                                                                                                                                                                               |
| <span id="ISC_REQ_STREAM"></span><span id="isc_req_stream"></span><dl> <dt>**ISC \_ \_Поток требований**</dt> <dt>0x8000</dt> </dl>                                                    | Поддерживать соединение с потоковой ориентацией.<br/>                                                                                                                                                                                                                   |
| <span id="ISC_REQ_USE_SUPPLIED_CREDS"></span><span id="isc_req_use_supplied_creds"></span><dl> <dt>**ISC \_ \_ \_ \_**</dt> Заданные учетные данные использования req <dt>0x80</dt> </dl>                | CredSSP не должен пытаться автоматически предоставлять учетные данные для клиента.<br/>                                                                                                                                                                            |
| <span id="ISC_REQ_DELEGATE"></span><span id="isc_req_delegate"></span><dl> <dt>**ISC \_ Запрос \_ делегата**</dt> <dt>0x1</dt> </dl>                                                 | Указывает, что учетные данные пользователя должны быть делегированы серверу.<br/> Если этот флаг не указан, на сервер делегируется пустой набор учетных данных.<br/> **Windows Server 2008 и Windows Vista:** Этот флаг является обязательным.<br/> |
| <span id="ISC_REQ_MUTUAL_AUTH"></span><span id="isc_req_mutual_auth"></span><dl> <dt>**ISC \_ \_Обоюдная \_ Проверка подлинности req**</dt> <dt></dt> </dl>                                       | Указывает, что проверка подлинности сервера не требуется. Политики делегирования по-прежнему применяются, если этот флаг не указан.<br/> **Windows Server 2008 и Windows Vista:** Этот флаг игнорируется.<br/>                                                 |



 

Запрошенные атрибуты могут не поддерживаться клиентом. Дополнительные сведения см. в описании параметра *пфконтекстаттр* .

Дополнительные описания различных атрибутов см. в разделе [требования к контексту](context-requirements.md).

</dd> <dt>

*Reserved1* \[ окне\]
</dt> <dd>

Зарезервировано. Этот параметр должен иметь значение 0.

</dd> <dt>

*Таржетдатареп* \[ окне\]
</dt> <dd>

Представление данных, например порядок байтов, на целевом объекте. Этот параметр может быть либо **\_ собственными \_ Дреп** , либо **безопасностью \_ сети \_ дреп**.

</dd> <dt>

*пинпут* \[ в, out, необязательно\]
</dt> <dd>

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) , содержащую указатели на буферы, передаваемые в качестве входных данных для пакета. Если сервер не инициировал контекст клиента, значение этого параметра должно быть **равно NULL** при первом вызове функции. При последующих вызовах функции или при инициации контекста клиента сервером значение этого параметра является указателем на буфер, выделенный с достаточным объемом памяти для хранения токена, возвращенного удаленным компьютером.

При вызове этой функции после начального вызова должно быть два буфера. Первый имеет тип **\_ Token pvbuffer** и содержит маркер, полученный от сервера. Второй буфер имеет тип **pvbuffer \_ Empty**; задайте нулевые значения для обоих элементов **пвбуффер** и **кббуффер** .

</dd> <dt>

*Reserved2* \[ окне\]
</dt> <dd>

Зарезервировано. Этот параметр должен иметь значение 0.

</dd> <dt>

*фневконтекст* \[ в, out, необязательно\]
</dt> <dd>

Указатель на структуру [кткссандле](sspi-handles.md) . При первом вызове метода **InitializeSecurityContext (CredSSP)** этот указатель получает новый обработчик контекста. Во втором вызове *фневконтекст* может совпадать с маркером, указанным в параметре *фконтекст* .

При вызовах после первого вызова передайте возвращенный здесь маркер в качестве параметра *фконтекст* и укажите **значение NULL** для *фневконтекст*.

</dd> <dt>

*паутпут* \[ out, необязательно\]
</dt> <dd>

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) . Эта структура в свою очередь содержит указатели на структуру [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) , которая получает выходные данные. Если во входных данных был **введен \_ буфер в секунду** , он будет находиться в выходных данных. Система выделит буфер маркера безопасности, если это запрошено (с помощью **ISC \_ требования \_ выделить \_ память**), и заполнит адрес в дескрипторе буфера для маркера безопасности.

Если указан флаг **ISC \_ требования \_ выделить \_ память** , CredSSP выделит память для буфера и поместит соответствующую информацию в [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc).

</dd> <dt>

*пфконтекстаттр* \[ заполняет\]
</dt> <dd>

Указатель на набор битовых флагов, указывающих [*атрибуты*](../secgloss/a-gly.md#_security_attribute_gly) установленного контекста. Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md).

Флаги, используемые для этого параметра, имеют префикс ISC \_ RET, например, в качестве **\_ \_ делегата ISC RET**. Список допустимых значений см. в описании параметра *фконтекстрек* .

Не проверяйте атрибуты, связанные с безопасностью, до тех пор, пока завершающий вызов функции не вернется успешно. Флаги атрибутов, не связанные с безопасностью, такие как флаг **ASC \_ , \_ Выделенная \_ память** , можно проверить перед окончательным возвратом.

> [!Note]  
> Определенные атрибуты контекста могут изменяться во время согласования с удаленным одноранговым узлом.

 

</dd> <dt>

*птсекспири* \[ out, необязательно\]
</dt> <dd>

Указатель на структуру [**метки времени**](timestamp.md) , которая получает время окончания срока действия контекста. Рекомендуется, чтобы пакет безопасности всегда возвращал это значение в местное время. Этот параметр является необязательным, и для кратковременных клиентов необходимо передавать **значение NULL** .

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция завершается успешно, она возвращает один из следующих кодов успеха.



| Код возврата                                                                                                    | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>**с \_ \_ неполным \_ сообщением электронной почты**</dt> </dl>     | Данные для всего сообщения не были прочитаны по каналу связи.<br/> При возвращении этого значения буфер *пинпут* содержит структуру [**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) с элементом **буффертипе** **pvbuffer \_ Missing**. Член **кббуффер** параметра **pvbuffer** указывает число дополнительных байтов, которое функция должна считывать с клиента перед тем, как эта функция будет выполнена. Хотя это число не всегда точнее, его использование может повысить производительность, избегая нескольких вызовов этой функции.<br/> |
| <dl> <dt>**СЕК., \_ д. \_**</dt> </dl>                      | Контекст безопасности успешно инициализирован. Другой вызов [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) не требуется. Если функция возвращает выходной токен, т. е. Если **\_ токен Pvbuffer** в *паутпут* имеет ненулевую длину, токен должен быть отправлен на сервер.<br/>                                                                                                   |
| <dl> <dt>**с \_ \_ завершено \_ и \_ продолжить**</dt> </dl> | Клиент должен вызвать [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) , а затем передать выходные данные на сервер. Затем клиент ждет возврата токена и передает его в другой вызов в [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).<br/>                                                                                                                                                                                                                                            |
| <dl> <dt>**с \_ \_ \_**</dt> </dl>        | Клиент должен завершить создание сообщения, а затем вызвать функцию [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) .<br/>                                                                                                                                                                                                                                                                                                                                                                                                   |
| <dl> <dt>**СЕКУНД по мере \_ \_ \_ необходимости**</dt> </dl>        | Клиент должен отправить выходной токен на сервер и дождаться возвращаемого токена. Клиент передает возвращенный токен в другой вызов [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md). Выходной токен может быть пустым.<br/>                                                                                                                                                                                                                                                              |
| <dl> <dt>**с \_ \_ неполными \_ учетными данными**</dt> </dl> | Сервер запросил проверку подлинности клиента, но либо указанные учетные данные не включают сертификат, либо сертификат не был выдан центром сертификации, которому доверяет сервер. Дополнительные сведения см. в подразделе "Примечания".<br/>                                                                                                                                                                              |



 

Если функция завершается ошибкой, функция возвращает один из следующих кодов ошибок.



| Код возврата                                                                                                          | Описание                                                                                                                                                                                                                                                                           |
|----------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>**СЕК \_ . \_ недостаточный \_ объем памяти**</dt> </dl>          | Недостаточно доступной памяти для завершения запрошенного действия.<br/>                                                                                                                                                                                                     |
| <dl> <dt>**\_ \_ Внутренняя ошибка E \_ sec**</dt> </dl>               | Произошла ошибка, которая не сопоставлена с кодом ошибки SSPI.<br/>                                                                                                                                                                                                                  |
| <dl> <dt>**c \_ E \_ Недопустимый \_ маркер**</dt> </dl>               | В функцию передан недопустимый маркер.<br/>                                                                                                                                                                                                                            |
| <dl> <dt>**в секунду \_ E \_ Недопустимый \_ токен**</dt> </dl>                | Неверный формат входного токена. Возможные причины: маркер поврежден при передаче, маркер неверного размера и маркер, переданный в неправильный пакет безопасности. Это Последнее условие может произойти, если клиент и сервер не согласуются с соответствующим пакетом безопасности.<br/> |
| <dl> <dt>**с \_ е. \_ Вход \_ запрещен**</dt> </dl>                 | Ошибка входа в систему.<br/>                                                                                                                                                                                                                                                          |
| <dl> <dt>**в. \_ е. \_ нет \_ центра проверки подлинности \_**</dt> </dl> | Не удалось связаться с центром сертификации для проверки подлинности. Доменное имя проверяющей стороны может быть неверным, домен может быть недоступен или произошла ошибка отношения доверия.<br/>                                                                    |
| <dl> <dt>**с \_ \_ без \_ учетных данных**</dt> </dl>               | В пакете безопасности нет доступных учетных данных.<br/>                                                                                                                                    |
| <dl> <dt>**с \_ \_ \_ неизвестным целевым объектом E**</dt> </dl>               | Целевой объект не распознан.<br/>                                                                                                                                                                                                                                             |
| <dl> <dt>**с \_ е \_ неподдерживаемая \_ функция E**</dt> </dl>         | Недопустимое значение параметра *фконтекстрек* . Либо не указан обязательный флаг, либо указан флаг, не поддерживаемый CredSSP.<br/>                                                                                                                 |
| <dl> <dt>**с \_ \_ неверным \_ участником**</dt> </dl>              | Участник, получивший запрос проверки подлинности, отличается от участника, переданного в параметр *псзтаржетнаме* . Эта ошибка указывает на ошибку взаимной проверки подлинности.<br/>                                                                                      |
| <dl> <dt>**\_ \_ Политика делегирования E SEC \_**</dt> </dl>            | Политика не поддерживает делегирование учетных данных на целевой сервер.<br/>                                                                                                                                                                                                |
| <dl> <dt>**с. \_ E, \_ только политика \_ NLTM \_**</dt> </dl>            | Делегирование учетных данных на целевой сервер не разрешено, если не достигнута взаимная проверка подлинности.<br/>                                                                                                                                                                  |
| <dl> <dt>**с \_ \_ \_ ошибками взаимной проверки подлинности E \_**</dt> </dl>          | Произошел сбой проверки подлинности сервера, если \_ \_ \_ в параметре *фконтекстрек* указан флаг взаимной проверки подлинности ISC.<br/>                                                                                                                                                             |



 

## <a name="remarks"></a>Комментарии

Вызывающий объект отвечает за определение того, достаточно ли атрибутов последнего контекста. Если, например, была запрошена конфиденциальность, но ее не удалось установить, некоторые приложения могут немедленно завершить подключение.

Если атрибуты контекста безопасности недостаточно, клиент должен освободить частично созданный контекст, вызвав функцию [**делетесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .

Клиент вызывает функцию **InitializeSecurityContext (CredSSP)** для инициализации исходящего контекста.

Для контекста безопасности с двумя ножками вызывающая последовательность выглядит следующим образом:

1.  Клиент вызывает функцию с параметром *фконтекст* , имеющим значение **null** , и заполняет дескриптор буфера входным сообщением.
2.  Пакет безопасности проверяет параметры и конструирует непрозрачный токен, помещая его в элемент TOKEN в буферном массиве. Если параметр *фконтекстрек* включает флаг **\_ требования \_ выделения \_ памяти ISC** , пакет безопасности ВЫДЕЛЯЕТ память и возвращает указатель в элементе Token.
3.  Клиент отправляет токен, возвращенный в буфере *паутпут* , на целевой сервер. Затем сервер передает маркер в качестве входного аргумента при вызове функции [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md) .
4.  [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md) может возвращать маркер. Сервер отправляет этот маркер клиенту через второй вызов **InitializeSecurityContext (CredSSP)** , если первый вызов возвращен в секунду, по **мере \_ \_ \_ необходимости**.

Если сервер успешно ответил, пакет безопасности возвращается в секунду, **а \_ затем \_** устанавливается безопасный сеанс.

Если функция возвращает один из ответов об ошибках, ответ сервера не принимается, а сеанс не устанавливается.

Если функция возвращает значение в **секундах, \_ что \_ \_** требуется по мере необходимости, в **секундах \_ \_ \_**, после **\_ \_ завершения \_ и \_ продолжения** действия 2 и 3 повторяются.

Безопасность — инициализация контекста может потребовать более одного вызова этой функции в зависимости от базового механизма проверки подлинности, а также вариантов, указанных в параметре *фконтекстрек* .

Параметры *фконтекстрек* и *пфконтекстаттрибутес* представляют собой битовую маску, представляющую различные атрибуты контекста. Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md). Хотя параметр *пфконтекстаттрибутес* допустим при любом успешном возвращении, следует проанализировать флаги, относящиеся к аспектам безопасности контекста, только после окончательного успешного возврата. Промежуточные возвраты могут задавать, например, флаг « **\_ \_ Выделенная \_ память ISC** ».

Если установлен установленный флаг **\_ \_ использования \_ \_** учетных данных ISC, пакет безопасности должен искать тип буфера **pvbuffer \_ pkg \_ params** в буфере ввода *пинпут* . Хотя это решение не является универсальным, оно обеспечивает надежную пару пакетов безопасности и приложений, когда это необходимо.

Если указана **Заявка на ISC, \_ \_ выделение \_ памяти** , вызывающий объект должен освободить память, вызвав функцию [**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .

Например, входной маркер может быть запросом диспетчера LAN. В этом случае выходным токеном является зашифрованный NTLM ответ на запрос.

Действие, принимаемое клиентом, зависит от кода возврата от этой функции. Если код возврата — в **секунду \_ , \_** то второй вызов **InitializeSecurityContext (CredSSP)** не будет выполняться, а ответ от сервера не появится. Если код возврата в **секунду по \_ - \_ прежнему \_ необходим**, клиент ждет маркер в ответе от сервера и передает его во второй вызов **InitializeSecurityContext (CredSSP)**. Код возврата (в секундах) показывает, что клиент должен завершить создание сообщения и вызвать функцию [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) . **\_ \_ \_** Код **\_ \_ завершения \_ и \_ продолжения в секундах** включает оба этих действия.

Если **InitializeSecurityContext (CredSSP)** возвращает значение Success для первого (или единственного) вызова, вызывающий объект должен в конечном итоге вызвать функцию [**делетесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) для возвращенного маркера, даже если вызов завершается неудачей на более позднем этапе обмена аутентификацией.

Клиент может снова вызвать **InitializeSecurityContext (CredSSP)** после успешного завершения. Это указывает пакету безопасности, что требуется выполнить перепроверку подлинности.

Вызывающие объекты в режиме ядра имеют следующие отличия: имя целевого объекта — это строка в [*Юникоде*](../secgloss/u-gly.md#_security_unicode_gly) , которую необходимо выделить в виртуальной памяти с помощью [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); Он не должен выделяться из пула. Буферы, переданные и передаваемые в *пинпут* и *паутпут* , должны находиться в виртуальной памяти, а не в пуле.

Если функция возвращает **данные с \_ \_ неполными \_ учетными данными**, убедитесь, что учетные данные r, переданные в функцию [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) , указали действительный и доверенный сертификат. сертификат должен быть сертификатом проверки подлинности клиента, выданным центром сертификации, которому доверяет сервер. Чтобы получить список доверенных центров сертификации, заслуживающих доверия от сервера, вызовите функцию [**QueryContextAttributes (CredSSP)**](querycontextattributes--credssp.md) с атрибутом **SECPKG \_ attr \_ Issuer \_ List \_ ex** .

После получения сертификата проверки подлинности от центра сертификации, которому доверяет сервер, клиентское приложение создает новые учетные данные. Это достигается путем вызова функции [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) и повторного вызова **InitializeSecurityContext (CredSSP)** с указанием новых учетных данных в параметре *фкредентиал* .

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения Vista\]<br/>                                                         |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                                   |
| Заголовок<br/>                   | <dl> <dt>SSPI. h (включая Security. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Secur32. lib</dt> </dl>                 |
| DLL<br/>                      | <dl> <dt>Secur32.dll</dt> </dl>                 |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Функции SSPI](authentication-functions.md#sspi-functions)
</dt> <dt>

[**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md)
</dt> <dt>

[**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md)
</dt> <dt>

[**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)
</dt> <dt>

[**делетесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer)
</dt> <dt>

[**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)
</dt> <dt>

[**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
</dt> </dl>

 

 
