---
description: Функция Логонусерексексв пытается зарегистрировать пользователя на локальном компьютере.
ms.assetid: d90db4c6-a711-4519-8b91-5069cee07738
title: Функция Логонусерексексв (Винбасеп. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- LogonUserExExW
api_type:
- DllExport
api_location:
- Advapi32.dll
ms.openlocfilehash: 8e6b7c5b377ffa7b517ccd19d1dfbffa08d26191af3822f9d9b17cc02c33d055
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118922339"
---
# <a name="logonuserexexw-function"></a>Функция Логонусерексексв

Функция **логонусерексексв** пытается зарегистрировать пользователя на локальном компьютере. Локальный компьютер — это компьютер, с которого был вызван **логонусерексексв** . **Логонусерексексв** нельзя использовать для входа на удаленный компьютер. Укажите пользователя, используя имя пользователя и домен, и проверяйте [*подлинность*](../secgloss/a-gly.md) пользователя с помощью пароля в виде открытого текста. Если функция выполнена, она получает маркер маркера, который представляет пользователя, выполнившего вход в систему. Затем этот маркер маркера можно использовать для олицетворения указанного пользователя или, в большинстве случаев, для создания [*процесса*](../secgloss/p-gly.md) , который выполняется в контексте указанного пользователя.

Эта функция аналогична функции [**логонусерекс**](/windows/desktop/api/Winbase/nf-winbase-logonuserexa) , за исключением того, что она принимает дополнительный параметр *птокенграупс*, который представляет собой набор из одного или нескольких [*идентификаторов безопасности*](../secgloss/s-gly.md) (SID), которые добавляются в маркер, возвращаемый вызывающему объекту при успешном входе.

Эта функция не объявлена в общедоступном заголовке и не имеет связанной библиотеки импорта. Для динамической привязки к Advapi32.dll необходимо использовать функции [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) и [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) .

## <a name="syntax"></a>Синтаксис


```C++
BOOL WINAPI LogonUserExExW(
  _In_      LPTSTR        lpszUsername,
  _In_opt_  LPTSTR        lpszDomain,
  _In_opt_  LPTSTR        lpszPassword,
  _In_      DWORD         dwLogonType,
  _In_      DWORD         dwLogonProvider,
  _In_opt_  PTOKEN_GROUPS pTokenGroups,
  _Out_opt_ PHANDLE       phToken,
  _Out_opt_ PSID          *ppLogonSid,
  _Out_opt_ PVOID         *ppProfileBuffer,
  _Out_opt_ LPDWORD       pdwProfileLength,
  _Out_opt_ PQUOTA_LIMITS pQuotaLimits
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*лпсзусернаме* \[ окне\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает имя пользователя. Это имя учетной записи пользователя для входа в систему. Если используется формат [*имени участника-пользователя*](../secgloss/u-gly.md) (UPN), параметр *Лпсздомаин* должен иметь **значение NULL**.

</dd> <dt>

*лпсздомаин* \[ в необязательное\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает имя домена или сервера, база данных учетных записей которого содержит учетную запись *лпсзусернаме* . Если этот параметр имеет **значение NULL**, имя пользователя должно быть указано в формате UPN. Если этот параметр имеет значение ".", функция проверяет учетную запись, используя только локальную базу данных учетных записей.

</dd> <dt>

*лпсзпассворд* \[ в необязательное\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает пароль в виде открытого текста для учетной записи пользователя, указанной параметром *лпсзусернаме*. Завершив использование пароля, очистите его из памяти, вызвав функцию [**секурезеромемори**](/previous-versions/windows/desktop/legacy/aa366877(v=vs.85)) . Дополнительные сведения о защите паролей см. в разделе [обработка паролей](../secbp/handling-passwords.md).

</dd> <dt>

*dwLogonType* \[ окне\]
</dt> <dd>

Тип выполняемой операции входа. Этот параметр может принимать одно из указанных ниже значений.



| Значение                                                                                                                                                                                                                                                                        | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="LOGON32_LOGON_INTERACTIVE"></span><span id="logon32_logon_interactive"></span><dl> <dt>**LOGON32 \_ \_Интерактивный вход**</dt> <dt>2</dt> </dl>                    | Этот тип входа предназначен для пользователей, которые будут интерактивно работать с компьютером, например пользователь, вошедший в систему с помощью сервера [*терминалов*](../secgloss/t-gly.md) , удаленной оболочки или аналогичного процесса. Этот тип входа имеет дополнительные затраты на кэширование данных для входа в систему для отключенных операций. Поэтому он не подходит для некоторых клиентских и серверных приложений, таких как почтовый сервер.<br/>                                  |
| <span id="LOGON32_LOGON_NETWORK"></span><span id="logon32_logon_network"></span><dl> <dt>**LOGON32 \_ Вход в \_ сеть**</dt> <dt>3</dt> </dl>                                | Этот тип входа предназначен для высокопроизводительных серверов для проверки подлинности паролей в формате обычного текста. Функция **логонусерексексв** не кэширует учетные данные для этого типа входа.<br/>                                                                                                                                                                                                                                                                                                 |
| <span id="LOGON32_LOGON_BATCH"></span><span id="logon32_logon_batch"></span><dl> <dt>**LOGON32 \_ Вход в \_ пакет**</dt> <dt>4</dt> </dl>                                      | Этот тип входа предназначен для пакетных серверов, где процессы могут выполняться от имени пользователя без их прямого вмешательства. Этот тип также используется для более высоких серверов производительности, которые обрабатывают несколько попыток проверки подлинности с открытым текстом в каждый момент времени, таких как почта или веб-серверы. Функция **логонусерексексв** не кэширует учетные данные для этого типа входа.<br/>                                                                                                           |
| <span id="LOGON32_LOGON_SERVICE"></span><span id="logon32_logon_service"></span><dl> <dt>**LOGON32 \_ \_Служба входа**</dt> <dt>5</dt> </dl>                                | Указывает на тип входа в службу. Предоставленная учетная запись должна иметь права на доступ к службе.<br/>                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="LOGON32_LOGON_UNLOCK"></span><span id="logon32_logon_unlock"></span><dl> <dt>**LOGON32 \_ \_Разблокировка входа**</dt> <dt>7</dt> </dl>                                   | Этот тип входа предназначен для библиотек DLL [*GINA*](../secgloss/g-gly.md) , которые входят в систему пользователей, которые будут интерактивно использовать компьютер. Этот тип входа может создать уникальную запись аудита, которая показывает, когда Рабочая станция была разблокирована.<br/>                                                                                                                                                                                                                   |
| <span id="LOGON32_LOGON_NETWORK_CLEARTEXT"></span><span id="logon32_logon_network_cleartext"></span><dl> <dt>**LOGON32 \_ Вход в \_ сеть с \_ открытым текстом**</dt> <dt>8</dt> </dl> | Этот тип входа сохраняет имя и пароль в [*пакете проверки подлинности*](../secgloss/a-gly.md), что позволяет серверу устанавливать соединения с другими сетевыми серверами при олицетворении клиента. Сервер может принимать учетные данные открытого текста от клиента, вызывать **логонусерексексв**, проверять, может ли пользователь получить доступ к системе по сети и по-прежнему взаимодействовать с другими серверами. <br/> |
| <span id="LOGON32_LOGON_NEW_CREDENTIALS"></span><span id="logon32_logon_new_credentials"></span><dl> <dt>**LOGON32 \_ ВХОД с \_ новыми \_ учетными данными**</dt> <dt>9</dt> </dl>       | Этот тип входа позволяет вызывающему объекту клонировать его текущий токен и указывать новые учетные данные для исходящих соединений. Новый сеанс входа имеет тот же локальный идентификатор, но использует другие учетные данные для других сетевых подключений.<br/> Этот тип входа поддерживается только поставщиком **LOGON32 \_ provider \_ WINNT50** .<br/>                                                                                                                                       |



 

</dd> <dt>

*двлогонпровидер* \[ окне\]
</dt> <dd>

Поставщик входа в систему. Этот параметр может принимать одно из указанных ниже значений.



| Значение                                                                                                                                                                                           | Значение                                                                                                                                                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="LOGON32_PROVIDER_DEFAULT"></span><span id="logon32_provider_default"></span><dl> <dt>**\_Поставщик LOGON32 \_ по умолчанию**</dt> </dl> | Использовать стандартный поставщик входа в систему. По умолчанию используется [*поставщик безопасности*](../secgloss/s-gly.md) NTLM.<br/> |
| <span id="LOGON32_PROVIDER_WINNT50"></span><span id="logon32_provider_winnt50"></span><dl> <dt>**\_WINNT50 поставщика \_ LOGON32**</dt> </dl> | Используйте поставщик согласованного входа в систему. <br/>                                                                                                                                                         |
| <span id="LOGON32_PROVIDER_WINNT40"></span><span id="logon32_provider_winnt40"></span><dl> <dt>**\_WINNT40 поставщика \_ LOGON32**</dt> </dl> | Используйте поставщик входа NTLM.<br/>                                                                                                                                                               |



 

</dd> <dt>

*птокенграупс* \[ в необязательное\]
</dt> <dd>

Указатель на структуру [**\_ групп токенов**](/windows/win32/api/winnt/ns-winnt-token_groups) , указывающий список идентификаторов SID группы, которые добавляются к маркеру, получаемому этой функцией при успешном входе. Все идентификаторы SID, добавленные в маркер, также влияют на расширение группы. Например, если добавленные идентификаторы SID являются членами локальных групп, эти группы также добавляются к полученному маркеру доступа.

если этот параметр не равен **NULL**, то вызывающая функция этой функции должна иметь разрешение **SE права \_ \_ доступа к TCB** , предоставленное и включенное.

</dd> <dt>

*фтокен* \[ out, необязательно\]
</dt> <dd>

Указатель на переменную обработчика, которая получает маркер, представляющий указанного пользователя.

Возвращаемый маркер можно использовать в вызовах функции [**имперсонателогжедонусер**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .

В большинстве случаев возвращаемый обработчик является [*основным маркером*](../secgloss/p-gly.md) , который можно использовать в вызовах функции [**параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) . Однако при указании \_ \_ флага сети LOGON32 logon **логонусерексексв** возвращает [*маркер олицетворения*](../secgloss/i-gly.md) , который нельзя использовать в **параметр CreateProcessAsUser** , если не был вызван [**дупликатетокенекс**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) для преобразования токена олицетворения в основной маркер.

Если этот обработчик больше не нужен, закройте его, вызвав функцию [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) .

</dd> <dt>

*пплогонсид* \[ out, необязательно\]
</dt> <dd>

Указатель на указатель на идентификатор безопасности, который получает идентификатор безопасности пользователя, вошедшего в систему.

Завершив использование идентификатора безопасности, освободите его, вызвав функцию [**функции LocalFree**](/windows/win32/api/winbase/nf-winbase-localfree) .

</dd> <dt>

*пппрофилебуффер* \[ out, необязательно\]
</dt> <dd>

Указатель на указатель, получающий адрес буфера, который содержит профиль пользователя, вошедшего в систему.

</dd> <dt>

*пдвпрофилеленгс* \[ out, необязательно\]
</dt> <dd>

Указатель на **DWORD** , который получает длину буфера профиля.

</dd> <dt>

*пкуоталимитс* \[ out, необязательно\]
</dt> <dd>

Указатель на структуру [**\_ ограничений квоты**](/windows/desktop/api/Winnt/ns-winnt-quota_limits) , которая получает сведения о квотах для вошедшего в систему пользователя.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция завершается с ошибкой, функция возвращает ненулевое значение.

Если функция завершается ошибкой, она возвращает ноль. Дополнительные сведения об ошибке можно получить, вызвав [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror).

## <a name="remarks"></a>Комментарии

Тип входа в **\_ \_ сеть LOGON32 logon** — самый быстрый, но он имеет следующие ограничения.

-   Функция возвращает [*маркер олицетворения*](../secgloss/i-gly.md), а не первичный токен. Этот токен нельзя использовать непосредственно в функции [**параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) . Однако можно вызвать функцию [**дупликатетокенекс**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) для преобразования токена в основной токен, а затем использовать его в **параметр CreateProcessAsUser**.
-   Если вы преобразуете маркер в основной маркер и используете его в [**параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) для запуска процесса, новый процесс не сможет получить доступ к другим сетевым ресурсам, таким как удаленные серверы или принтеры, через перенаправитель. Исключением является то, что если сетевой ресурс не управляет доступом, новый процесс сможет получить к нему доступ.

Учетная запись, указанная параметром *лпсзусернаме* , должна иметь необходимые права учетной записи. например, чтобы войти в систему пользователя с флагом **\_ \_ интерактивного входа в LOGON32** , пользователь (или группа, к которой принадлежит пользователь) должен иметь право **SE \_ интерактивное \_ \_ имя входа в систему** . Список прав учетной записи, влияющих на различные операции входа в систему, см. в разделе [права доступа к объектам учетной записи](../secmgmt/account-object-access-rights.md).

Пользователь считается вошедшим в систему, если существует хотя бы один токен. Если вызвать [**параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) и закрыть маркер, пользователь по-прежнему будет входить в систему, пока процесс (и все его дочерние процессы) не будут завершены.

Если указан необязательный параметр *птокенграупс* , LSA не будет автоматически добавлять локальный SID или SID для входа.

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения Vista\]<br/>                                                                        |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                                                  |
| Версия<br/>                  | логонусерексексв также доступен в Windows Server 2003 или Windows кспвис выпуске общего распространения.<br/> |
| Header<br/>                   | <dl> <dt>Винбасеп. h</dt> </dl>                                 |
| DLL<br/>                      | <dl> <dt>Advapi32.dll</dt> </dl>                               |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Управление доступом клиента/сервера](../secauthz/client-server-access-control.md)
</dt> <dt>

[Функции управления доступом клиента/сервера](../secauthz/authorization-functions.md)
</dt> <dt>

[**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle)
</dt> <dt>

[**Параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera)
</dt> <dt>

[**дупликатетокенекс**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex)
</dt> <dt>

[**имперсонателогжедонусер**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser)
</dt> <dt>

[**логонусерекс**](/windows/desktop/api/Winbase/nf-winbase-logonuserexa)
</dt> <dt>

[**ограничения КВОТы \_**](/windows/desktop/api/Winnt/ns-winnt-quota_limits)
</dt> </dl>

 

 
