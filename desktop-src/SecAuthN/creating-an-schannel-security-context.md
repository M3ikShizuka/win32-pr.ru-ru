---
description: Объясняет, как установить контекст безопасности, защищающий взаимодействие между клиентом и сервером.
ms.assetid: eb1eadb2-14b2-4265-994a-dcea4208e650
title: Создание контекста безопасности безопасного канала Schannel
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 23e364e6319fbaddb50bffaf59541af9e8f43bfb
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127146693"
---
# <a name="creating-an-schannel-security-context"></a>Создание контекста безопасности безопасного канала Schannel

Чтобы установить [*контекст безопасности*](/windows/desktop/SecGloss/s-gly) , который будет защищать обмен данными между клиентом и сервером, необходимо принять участие в следующем процессе обмена информацией:

## <a name="client"></a>Клиент

1.  Клиент вызывает функцию [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) .
2.  Schannel начинает создавать контекст безопасности в соответствии с правилами выбранного протокола безопасности. Код возврата функции указывает, должен ли клиент повторно вызывать функцию. [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) может возвращать маркер, представляющий контекст.
3.  Если маркер был возвращен, клиент отправляет его на сервер.
4.  Когда [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) возвращает значение \_ \_ в секунду, то клиент выполняется. Если функция возвращает секунды \_ \_ \_ , то клиент должен подождать, пока сервер отправит ему маркер. Если у клиента есть маркер с сервера, он должен снова вызвать [*функцию*](/windows/desktop/SecGloss/c-gly) **InitializeSecurityContext (General)** . (Вернитесь к шагу 2.)

## <a name="server"></a>Сервер

1.  Сервер ожидает отправки клиентом сообщения, содержащего маркер безопасности. Сервер передает маркер, полученный от клиента, в функцию [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) .
2.  Schannel строится на частичном контексте безопасности, представленном токеном. Schannel возвращает маркер серверу и код возврата, указывающий, должен ли сервер повторно вызывать функцию.
3.  Если маркер был возвращен, сервер отправляет его клиенту.
4.  Когда [**AcceptSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) возвращает значение \_ \_ в секунду, то сервер выполняется. Если функция возвращает секунды \_ , то \_ \_ сервер должен подождать, пока клиент отправит ему маркер. Если сервер имеет маркер от клиента, он должен снова вызвать функцию **AcceptSecurityContext (General)** . (Вернитесь к шагу 2.)

Если любая из функций возвращает значение, отличное от \_ \_ "в секунду", в секундах по мере \_ \_ \_ необходимости, или с \_ \_ неполным \_ сообщением (см. следующий абзац), произошла ошибка. Клиент и сервер должны вызвать функцию [**делетесекуритиконтекст**](/windows/desktop/api/Sspi/nf-sspi-deletesecuritycontext) для удаления частично установленного контекста безопасности.

Особый случай, который может изменить обработку на стороне клиента и сервера, заключается в том, что на клиент или сервер с другой стороны отправляется слишком мало или слишком много информации. В случае слишком небольшого объема информации обе функции возвращают \_ сообщение с \_ неполным указанием «е» \_ . Сведения об распознавании и обработке недостаточных или избыточных сведений см. [в разделе дополнительные буферы, возвращаемые SChannel](extra-buffers-returned-by-schannel.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Выполнение проверки подлинности с помощью канала Schannel](performing-authentication-using-schannel.md)
</dt> <dt>

[Сопоставление сертификатов](mapping-certificates.md)
</dt> <dt>

[Проверка учетных данных SChannel вручную](manually-validating-schannel-credentials.md)
</dt> </dl>

 

 
