---
description: Объясняется, как проверить учетные данные SChannel вручную.
ms.assetid: 0229486a-5812-4a7e-98ad-446292997ee3
title: Проверка учетных данных SChannel вручную
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d71ddff50ab674825d8effd1a08477116ee0c654d031e7f353a30c95e4f1249f
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117787006"
---
# <a name="manually-validating-schannel-credentials"></a>Проверка учетных данных SChannel вручную

По умолчанию SChannel проверяет [*сертификат сервера*](../secgloss/s-gly.md) , вызывая функцию [**WinVerifyTrust**](/windows/win32/api/wintrust/nf-wintrust-winverifytrust) . Однако если вы отключили эту функцию с помощью \_ \_ \_ \_ флага проверки ручного удостоверения ISC, необходимо проверить сертификат, предоставленный сервером, который пытается установить его удостоверение.

Чтобы вручную проверить сертификат сервера, необходимо сначала получить его. Используйте функцию [**QueryContextAttributes (General)**](/windows/win32/api/sspi/nf-sspi-querycontextattributesa) и укажите \_ \_ \_ значение атрибута контекста удаленного сертификата SECPKG attr \_ . Этот атрибут возвращает структуру [**\_ контекста сертификата**](/windows/win32/api/wincrypt/ns-wincrypt-cert_context) , содержащую сертификат, предоставленный сервером. Этот сертификат называется конечным сертификатом, так как он является последним сертификатом в цепочке сертификатов и находится дальше от [*корневого сертификата*](../secgloss/r-gly.md).

С помощью конечного сертификата необходимо проверить следующее:

-   Цепочка сертификатов завершена, а корень — сертификат из доверенного [*центра сертификации*](../secgloss/c-gly.md) (ЦС).
-   Текущее время не превышает даты начала и окончания для каждого из сертификатов в цепочке сертификатов.
-   Ни один из сертификатов в цепочке сертификатов не был отозван.
-   Глубина конечного сертификата не превышает максимально допустимую глубину, указанную в расширении сертификата. Эта проверка необходима, только если указана глубина.
-   Использование сертификата является правильным, например, [*сертификат клиента*](../secgloss/c-gly.md) не следует использовать для проверки подлинности сервера.
-   Для проверки подлинности сервера удостоверение сервера, содержащееся в конечном сертификате сервера, соответствует серверу, к которому пытается связаться клиент. Как правило, клиент будет сопоставлять некоторые элементы в поле имени субъекта сертификата с IP-адресом или DNS-именем сервера.

 

 
