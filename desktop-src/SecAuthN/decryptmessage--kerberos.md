---
description: Расшифровывает сообщение с помощью протокола Kerberos.
ms.assetid: 9e699f7c-f738-4702-bdef-fb2c276c38fc
title: Функция Декриптмессаже (Kerberos)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: b32968ea83ca0403a5d8dd1579c4e03f30776c19
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104154771"
---
# <a name="decryptmessage-kerberos-function"></a>Функция Декриптмессаже (Kerberos)

Функция **декриптмессаже (Kerberos)** расшифровывает сообщение. Некоторые пакеты не шифруют и не расшифровываются сообщения, а выполняют и проверяют [*хэш*](../secgloss/h-gly.md)целостности.

> [!Note]  
> [**Енкриптмессаже (Kerberos)**](encryptmessage--kerberos.md) и **декриптмессаже (Kerberos)** могут вызываться одновременно из двух разных потоков в одном контексте SSPI, если [*один поток*](../secgloss/s-gly.md) шифруется, а другой расшифровывается. При шифровании нескольких потоков или при расшифровке более одного потока каждый поток должен получить уникальный контекст.

## <a name="syntax"></a>Синтаксис

```C++
SECURITY_STATUS SEC_Entry DecryptMessage(
  _In_    PCtxtHandle    phContext,
  _Inout_ PSecBufferDesc pMessage,
  _In_    ULONG          MessageSeqNo,
  _Out_   PULONG         pfQOP
);
```

## <a name="parameters"></a>Параметры

*фконтекст* \[ окне\]

Маркер [*контекста безопасности*](../secgloss/s-gly.md) , который будет использоваться для расшифровки сообщения.

*пмессаже* \[ в, out\]

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) . На входе структура ссылается на одну или несколько структур [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) , которые могут иметь тип данных pvbuffer \_ . Буфер содержит зашифрованное сообщение. Зашифрованное сообщение расшифровывается на месте, переписывая исходное содержимое его буфера.

*Мессажесекно* \[ окне\]

Порядковый номер, ожидаемый транспортным приложением (при наличии). Если транспортное приложение не поддерживает порядковые номера, этот параметр должен иметь значение 0.

*пфкоп* \[ заполняет\]

Указатель на переменную типа **ulong** , которая получает зависящие от пакета флаги, указывающие качество защиты.

Этот параметр может иметь следующий флаг.

| Значение                  | Значение                                                             |
|------------------------|---------------------------------------------------------------------|
| SECQOP_WRAP_NO_ENCRYPT | сообщение не было зашифровано, но был создан заголовок или трейлер. |

> [!NOTE]
> KERB_WRAP_NO_ENCRYPT имеет то же значение и то же самое.

## <a name="return-value"></a>Возвращаемое значение

Если функция проверяет, что сообщение было получено в правильной последовательности, функция возвращает значение в секунду \_ E \_ ОК.

Если функция не расшифрует сообщение, она возвращает один из следующих кодов ошибок.

| Код возврата                     | Описание                                                                                                                                                                      |
|---------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **с \_ \_ неполным \_ сообщением электронной почты** | Данные во входном буфере неполны. Приложению необходимо прочитать дополнительные данные с сервера и вызвать [**декриптмессаже (Kerberos)**](decryptmessage--kerberos.md) еще раз. |
| **с \_ не \_ \_ по \_ порядку**   | Сообщение не было получено в правильной последовательности.                                                                                                                            |

## <a name="remarks"></a>Комментарии

Иногда приложение считывает данные от удаленной стороны, попытается расшифровать их с помощью **декриптмессаже (Kerberos)** и обнаружит, что **декриптмессаже (Kerberos)** закончились, но выходные буферы пусты. Это нормальное поведение, и приложения должны уметь работать с ним.

Сведения о взаимодействии с GSSAPI см. [в статье взаимодействие между SSPI/Kerberos и GSSAPI](sspi-kerberos-interoperability-with-gssapi.md).

**Windows XP:** Эта функция также называлась **унсеалмессаже**. Теперь приложения должны использовать только **декриптмессаже (Kerberos)** .

## <a name="requirements"></a>Требования

| Требование | Значение |
|-------------------------------------|--------------------------------|
| Минимальная версия клиента | Только для \[ классических приложений Windows XP\]          |
| Минимальная версия сервера | \[Только для настольных приложений Windows Server 2003\] |
| Header                   | SSPI. h (включая Security. h)               |
| Библиотека                  | Secur32. lib                               |
| DLL                      | Secur32.dll                               |

## <a name="see-also"></a>См. также раздел

- [Функции SSPI](authentication-functions.md#sspi-functions)
- [**Енкриптмессаже (Kerberos)**](encryptmessage--kerberos.md)
- [**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)
- [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
