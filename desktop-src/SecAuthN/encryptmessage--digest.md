---
description: Шифрует сообщение для обеспечения конфиденциальности с помощью дайджеста.
ms.assetid: 0045e931-929b-40c4-a524-5664d2fc5170
title: Функция Енкриптмессаже (Digest) (SSPI. h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 13bcaa5b91f165321d03e229416741b90a978dc6
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127569438"
---
# <a name="encryptmessage-digest-function"></a>Функция Енкриптмессаже (Digest)

Функция **енкриптмессаже (Digest)** шифрует сообщение для обеспечения [*конфиденциальности*](../secgloss/p-gly.md). **Енкриптмессаже (дайджест)** позволяет приложению выбирать между [*алгоритмами шифрования*](../secgloss/c-gly.md) , поддерживаемыми выбранным механизмом. Функция **енкриптмессаже (Digest)** использует [*контекст безопасности*](../secgloss/s-gly.md) , на который ссылается маркер контекста. Некоторые пакеты не имеют зашифрованных и не расшифрованных сообщений, а предоставляют [*хэш*](../secgloss/h-gly.md) целостности, который можно проверить.

Эта функция доступна только в качестве механизма SASL.

> [!Note]  
> **Енкриптмессаже (дайджест)** и [**декриптмессаже (Digest)**](decryptmessage--digest.md) могут быть вызваны одновременно из двух разных потоков в одном контексте [*интерфейса поставщика услуг обеспечения безопасности*](../secgloss/s-gly.md) (SSPI), если один поток шифруется, а другой расшифровывается. При шифровании нескольких потоков или при расшифровке более одного потока каждый поток должен получить уникальный контекст.

 

## <a name="syntax"></a>Синтаксис


```C++
SECURITY_STATUS SEC_ENTRY EncryptMessage(
  PCtxtHandle    phContext,
  unsigned long  fQOP,
  PSecBufferDesc pMessage,
  unsigned long  MessageSeqNo
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*фконтекст* \[ окне\]
</dt> <dd>

Маркер [*контекста безопасности*](../secgloss/s-gly.md) , который будет использоваться для шифрования сообщения.

</dd> <dt>

*фкоп* \[ окне\]
</dt> <dd>

Зависящие от пакета флаги, указывающие качество защиты. [*Пакет безопасности*](../secgloss/s-gly.md) может использовать этот параметр, чтобы включить выбор [*алгоритмов шифрования*](../secgloss/c-gly.md).

При использовании дайджест-поставщика общих служб этот параметр должен иметь значение 0.

</dd> <dt>

*пмессаже* \[ в, out\]
</dt> <dd>

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) . На входе структура ссылается на одну или несколько структур [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) , которые могут иметь тип данных pvbuffer \_ . Этот буфер содержит сообщение для шифрования. Сообщение шифруется на месте, перезаписывая исходное содержимое структуры.

Функция не обрабатывает буферы с \_ атрибутом pvbuffer ReadOnly.

Длина структуры [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) , которая содержит сообщение, должна быть не больше **кбмаксимуммессаже**, полученной из функции [**QueryContextAttributes (дайджест)**](querycontextattributes--digest.md) (SECPKG \_ attr \_ Streams \_ sizes).

При использовании дайджест-поставщика общих служб \_ \_ \_ для хранения сведений о [*сигнатурах*](../secgloss/d-gly.md#_security_digital_signature_gly) должен быть второй буфер с типом заполнения pvbuffer или с данными буфера (в секунду). Чтобы получить размер выходного буфера, вызовите функцию [**QueryContextAttributes (Digest)**](querycontextattributes--digest.md) и укажите \_ размеры SECPKG attr \_ . Функция вернет структуру [**\_ размеров секпкгконтекст**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) . Размер выходного буфера равен сумме значений в элементах **кбмакссигнатуре** и **кбблокксизе** .

Приложения, не использующие SSL, должны предоставить [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) типа pvbuffer \_ Padding.

</dd> <dt>

*Мессажесекно* \[ окне\]
</dt> <dd>

Порядковый номер, назначенный сообщению транспортным приложением. Если транспортное приложение не поддерживает порядковые номера, этот параметр должен быть равен нулю.

При использовании дайджест-поставщика общих служб этот параметр должен иметь значение 0. Хэш-код дайджеста управляет нумерацией последовательности внутренним образом.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция завершается успешно, функция возвращает значение секунды \_ E \_ ОК.

Если функция завершается ошибкой, возвращается один из следующих кодов ошибок.



| Код возврата                                                                                                    | Описание                                                                                                                                                                                                                                   |
|----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>**\_ \_ \_ слишком \_ маленький буфер E с**</dt> </dl>      | Выходной буфер слишком мал. Дополнительные сведения см. в подразделе "Примечания".<br/>                                                                                                                                                                 |
| <dl> <dt>**с \_ \_ \_ истекшим сроком действия в контексте E**</dt> </dl>        | Приложение ссылается на контекст, который уже был закрыт. Правильно написанное приложение не должно получить эту ошибку.<br/>                                                                                               |
| <dl> <dt>**с \_ е \_ . \_ неправильная система шифрования E \_**</dt> </dl> | [*Шифр*](../secgloss/c-gly.md) , выбранный для [*контекста безопасности*](../secgloss/s-gly.md) , не поддерживается.<br/>                                                                                                         |
| <dl> <dt>**СЕК \_ . \_ недостаточный \_ объем памяти**</dt> </dl>    | Недостаточно доступной памяти для завершения запрошенного действия.<br/>                                                                                                                                                             |
| <dl> <dt>**c \_ E \_ Недопустимый \_ маркер**</dt> </dl>         | В параметре *фконтекст* указан недопустимый маркер контекста.<br/>                                                                                                                                                     |
| <dl> <dt>**в секунду \_ E \_ Недопустимый \_ токен**</dt> </dl>          | Не \_ найден буфер типа данных pvbuffer.<br/>                                                                                                                                                                                          |
| <dl> <dt>**с \_ е \_ КОП \_ не \_ поддерживается**</dt> </dl>     | [*Контекст безопасности*](../secgloss/s-gly.md)не поддерживает ни конфиденциальность, ни [*целостность*](../secgloss/i-gly.md) .<br/> |



 

## <a name="remarks"></a>Комментарии

Функция **енкриптмессаже (Digest)** шифрует сообщение на основе сообщения и [*ключа сеанса*](../secgloss/s-gly.md) из [*контекста безопасности*](../secgloss/s-gly.md).

Если приложение транспорта создало [*контекст безопасности*](../secgloss/s-gly.md) для поддержки обнаружения последовательности и вызывающий объект предоставляет порядковый номер, функция включает эти сведения в зашифрованное сообщение. Включение этой информации обеспечивает защиту от воспроизведения, вставки и подавления сообщений. [*Пакет безопасности*](../secgloss/s-gly.md) включает порядковый номер, переданный из транспортного приложения.

При использовании дайджест-поставщика общих служб получите размер выходного буфера, вызвав функцию [**QueryContextAttributes (Digest)**](querycontextattributes--digest.md) и УКАЗАВ \_ размеры SECPKG attr \_ . Функция вернет структуру [**\_ размеров секпкгконтекст**](/windows/win32/api/sspi/ns-sspi-secpkgcontext_sizes) . Размер выходного буфера равен сумме значений в элементах **кбмакссигнатуре** и **кбблокксизе** .

> [!Note]  
> Эти буферы должны быть представлены в указанном порядке.

 



| Тип буфера                           | Описание                                                                                                                    |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| \_заголовок потока \_ pvbuffer<br/>  | Для внутреннего использования. Инициализация не требуется.<br/>                                                                        |
| \_данные pvbuffer<br/>            | Содержит зашифрованное сообщение в [*виде открытого текста*](../secgloss/s-gly.md) .<br/> |
| \_трейлер потока \_ pvbuffer<br/> | Для внутреннего использования. Инициализация не требуется.<br/>                                                                        |
| PVBUFFER \_ пусто<br/>           | Для внутреннего использования. Инициализация не требуется. Размер может быть равен нулю.<br/>                                                      |



 

Для оптимальной производительности структуры *пмессаже* должны выделяться из непрерывной памяти.

**Windows XP:** Эта функция также называлась **сеалмессаже**. Теперь приложения должны использовать только **енкриптмессаже (дайджест)** .

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения XP\]<br/>                                                            |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2003\]<br/>                                                   |
| Заголовок<br/>                   | <dl> <dt>SSPI. h (включая Security. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Secur32. lib</dt> </dl>                 |
| DLL<br/>                      | <dl> <dt>Secur32.dll</dt> </dl>                 |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Функции SSPI](authentication-functions.md#sspi-functions)
</dt> <dt>

[**AcceptSecurityContext (дайджест)**](acceptsecuritycontext--digest.md)
</dt> <dt>

[**Декриптмессаже (дайджест)**](decryptmessage--digest.md)
</dt> <dt>

[**InitializeSecurityContext (дайджест)**](initializesecuritycontext--digest.md)
</dt> <dt>

[**QueryContextAttributes (дайджест)**](querycontextattributes--digest.md)
</dt> <dt>

[**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)
</dt> <dt>

[**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
</dt> </dl>

 

 
