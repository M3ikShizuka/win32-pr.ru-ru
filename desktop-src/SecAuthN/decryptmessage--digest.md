---
description: Расшифровывает сообщение с помощью дайджеста.
ms.assetid: 46d45f59-33fa-434a-b329-20b6257c9a19
title: Функция Декриптмессаже (Digest)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: f87828263766643a10cf5400e38cabe9d3096403
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122480870"
---
# <a name="decryptmessage-digest-function"></a>Функция Декриптмессаже (Digest)

Функция **декриптмессаже (Digest)** расшифровывает сообщение. Некоторые пакеты не шифруют и не расшифровываются сообщения, а выполняют и проверяют [*хэш*](../secgloss/h-gly.md)целостности.

[*Поставщик поддержки*](../secgloss/s-gly.md) дайджеста безопасности (SSP) обеспечивает конфиденциальность шифрования и расшифровки сообщений, которыми обмениваются клиент и сервер, только как механизм SASL.

> [!Note]  
> [**Енкриптмессаже (дайджест)**](encryptmessage--digest.md) и **декриптмессаже (Digest)** могут быть вызваны одновременно из двух разных потоков в одном контексте [*интерфейса поставщика услуг обеспечения безопасности*](../secgloss/s-gly.md) (SSPI), если один поток шифруется, а другой расшифровывается. При шифровании нескольких потоков или при расшифровке более одного потока каждый поток должен получить уникальный контекст.

## <a name="syntax"></a>Синтаксис

```C++
SECURITY_STATUS SEC_ENTRY DecryptMessage(
  PCtxtHandle    phContext,
  PSecBufferDesc pMessage,
  unsigned long  MessageSeqNo,
  unsigned long  *pfQOP
);
```

## <a name="parameters"></a>Параметры

*фконтекст* \[ окне\]

Маркер [*контекста безопасности*](../secgloss/s-gly.md) , который будет использоваться для расшифровки сообщения.

*пмессаже* \[ в, out\]

Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) . На входе структура ссылается на одну или несколько структур [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) . По крайней мере один из них должен иметь тип \_ данных pvbuffer. Этот буфер содержит зашифрованное сообщение. Зашифрованное сообщение расшифровывается на месте, переписывая исходное содержимое его буфера.

При использовании дайджест-поставщика общих служб на входе структура ссылается на одну или несколько структур [**pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) . Один из них должен иметь тип PVBUFFER \_ Data или pvbuffer \_ Stream и должен содержать зашифрованное сообщение.

*Мессажесекно* \[ окне\]

Порядковый номер, ожидаемый транспортным приложением (при наличии). Если транспортное приложение не поддерживает порядковые номера, этот параметр должен иметь значение 0.

При использовании дайджест-поставщика общих служб этот параметр должен иметь значение 0. Хэш-код дайджеста управляет нумерацией последовательности внутренним образом.

*пфкоп* \[ заполняет\]

Указатель на переменную типа **ulong** , которая получает зависящие от пакета флаги, указывающие качество защиты.

Этот параметр может иметь один из следующих флагов.


| Значение | Значение | 
|-------|---------|
| <span id="SECQOP_WRAP_NO_ENCRYPT"></span><span id="secqop_wrap_no_encrypt"></span><dl><dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt></dl> | Сообщение не было зашифровано, но был создан заголовок или трейлер.<br /><blockquote>[!Note]<br />KERB_WRAP_NO_ENCRYPT имеет то же значение и то же самое.</blockquote><br /> | 
| <span id="SIGN_ONLY_"></span><span id="sign_only_"></span><dl><dt><strong>SIGN_ONLY</strong></dt></dl> | При использовании дайджест-поставщика общих служб используйте этот флаг, если [*контекст безопасности*](../secgloss/s-gly.md) настроен на проверку только [*подписи*](../secgloss/s-gly.md) . Дополнительные сведения см. в разделе [качество защиты](quality-of-protection.md).<br /> | 


## <a name="return-value"></a>Возвращаемое значение

Если функция проверяет, что сообщение было получено в правильной последовательности, функция возвращает значение в секунду \_ E \_ ОК.

Если функция не расшифрует сообщение, она возвращает один из следующих кодов ошибок.

| Код возврата                         | Описание                                                                                                                                                                  |
|-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **\_ \_ \_ слишком \_ маленький буфер E с**      | Буфер сообщений слишком мал. Используется с дайджест-SSP.                                                                                                                   |
| **с \_ е \_ . \_ неправильная система шифрования E \_** | [*Шифр*](../secgloss/c-gly.md) , выбранный для [*контекста безопасности*](../secgloss/s-gly.md) , не поддерживается. Используется с дайджест-SSP.                                                                                       |
| **с \_ \_ неполным \_ сообщением электронной почты**     | Данные во входном буфере неполны. Приложению необходимо прочитать больше данных с сервера и вызвать [**декриптмессаже (дайджест)**](decryptmessage--digest.md) еще раз. |
| **c \_ E \_ Недопустимый \_ маркер**         | В параметре *фконтекст* указан недопустимый маркер контекста. Используется с дайджест-SSP.                                                                     |
| **с \_ \_ измененным сообщением E \_**        | Сообщение было изменено. Используется с дайджест-SSP.                                                                                                                      |
| **с \_ не \_ \_ по \_ порядку**       | Сообщение не было получено в правильной последовательности.                                                                                                                        |
| **с \_ е \_ КОП \_ не \_ поддерживается**     | [*Контекст безопасности*](../secgloss/s-gly.md)не поддерживает ни конфиденциальность, ни [*целостность*](../secgloss/i-gly.md) . Используется с дайджест-SSP.                           |

## <a name="remarks"></a>Комментарии

Иногда приложение считывает данные от удаленной стороны, пытается расшифровать их с помощью **декриптмессаже (Digest)** и обнаружит, что **декриптмессаже (дайджест)** прошел проверку, но выходные буферы пусты. Это нормальное поведение, и приложения должны уметь работать с ним.

**Windows XP:** Эта функция также называлась **унсеалмессаже**. Теперь приложения должны использовать только **декриптмессаже (дайджест)** .

## <a name="requirements"></a>Требования

| Требование | Значение |
|--------------------------|-------------------------------------------|
| Минимальная версия клиента | Windows \[Только классические приложения XP\]          |
| Минимальная версия сервера | Windows Только для \[ настольных приложений сервера 2003\] |
| Заголовок                   | SSPI. h (включая Security. h)               |
| Библиотека                  | Secur32. lib                               |
| DLL                      | Secur32.dll                               |

## <a name="see-also"></a>См. также

- [Функции SSPI](authentication-functions.md#sspi-functions)
- [**Енкриптмессаже (дайджест)**](encryptmessage--digest.md)
- [**Pvbuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer)
- [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
