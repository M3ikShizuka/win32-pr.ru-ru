---
title: Функции управления профилями
description: Функции управления профилями
ms.assetid: 185863b7-0b74-4c65-97c3-3c60b86d37fd
keywords:
- Windows Система цветовой системы (WCS), функции
- WCS (Windows цветовая система), функции
- Управление цветом изображений, функции
- Управление цветом, функции
- цвета, функции
- Справочник по WCS, функции
- Справочник по WCS, функциям
- Windows Система цветовой системы (WCS), профили
- WCS (Windows цветовая система), профили
- Управление цветом изображений, профили
- Управление цветом, профили
- цвета, профили
- Справочник по WCS, профили
- Справочник по WCS, профилям
- Управление профилями
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d9f047c2dee199800fad976dd7b959fbbb54d585fd252fb8b5390c3223415db4
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119587774"
---
# <a name="profile-management-functions"></a>Функции управления профилями

## <a name="profile-management-functions"></a>Функции управления профилями

В управлении профилями полезны следующие функции API.



| Функция                                                                               | Описание                                                                                                                                          |
|----------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**ассоЦиатеколорпрофилевисдевицев**](/windows/win32/api/icm/nf-icm-associatecolorprofilewithdevicew)             | Связывает указанный цветовой профиль с указанным устройством.                                                              |
| [**Креатепрофилефромлогколорспацев**] ((/windows/win32/api/icm/nf-icm-createprofilefromlogcolorspacew) | Преобразует логическое [пространство цветов](c.md) в [профиль устройства](d.md). |
| [**дисассоЦиатеколорпрофилефромдевицев**](/windows/win32/api/icm/nf-icm-disassociatecolorprofilefromdevicew) | Отменяет связь указанного цветового профиля с указанным устройством на указанном компьютере. |
| [**енумколорпрофилесв**](/windows/win32/api/icm/nf-icm-enumcolorprofilesw) | Перечисляет все профили, удовлетворяющие заданным критериям перечисления. |
| [**жетколордиректорив**](/windows/win32/api/icm/nf-icm-getcolordirectoryw) | возвращает путь к Windowsному каталогу цветов на указанном компьютере. |
| [**жетдевицегаммарамп**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicegammaramp)                                       | Возвращает гамма-цвет из экранных плат с прямыми цветами.                                                                                                |
| [**жетстандардколорспацепрофилев**](/windows/win32/api/icm/nf-icm-getstandardcolorspaceprofilew) | Извлекает цветовой профиль, зарегистрированный для указанного стандартного [цветового пространства](c.md). |
| [**инсталлколорпрофилев**](/windows/win32/api/icm/nf-icm-installcolorprofilew) | Устанавливает заданный профиль для использования на указанном компьютере. Профиль также копируется в каталог цветов. |
| [**регистеркммв**](/windows/win32/api/icm/nf-icm-registercmmw) | Связывает указанное идентификационное значение с заданной библиотекой динамической компоновки модуля управления цветом (библиотека DLL CMM). если этот идентификатор отображается в цветом профиле, Windows можете выбрать соответствующий CMM, чтобы создать преобразование. |
| [**сетдевицегаммарамп**](/windows/desktop/api/Wingdi/nf-wingdi-setdevicegammaramp)                                       | Задает гамма-шкалу на экранах с прямыми цветными платами.                                                                                                  |
| [**сетстандардколорспацепрофилев**](/windows/win32/api/icm/nf-icm-setstandardcolorspaceprofilew) | Регистрирует указанный профиль для заданного стандартного [цветового пространства](c.md). Этот профиль можно запросить с помощью [жетстандардколорспацепрофилев](/windows/win32/api/icm/nf-icm-getstandardcolorspaceprofilew). |
| [**унинсталлколорпрофилев**](/windows/win32/api/icm/nf-icm-uninstallcolorprofilew) | Удаляет указанный цветовой профиль с указанного компьютера. Связанные файлы при необходимости удаляются из системы. |
| [**унрегистеркммв**](/windows/win32/api/icm/nf-icm-unregistercmmw) | Отменяет связь указанного значения идентификатора из заданной библиотеки динамической компоновки модуля управления цветом (библиотека DLL CMM). |
| [**вксассоЦиатеколорпрофилевисдевице**](/windows/win32/api/icm/nf-icm-wcsassociatecolorprofilewithdevice)       | Связывает указанный цветовой профиль WCS с указанным устройством.                                                                                    |
| [**вкскреатеиккпрофиле**](/windows/win32/api/icm/nf-icm-wcscreateiccprofile)                                     | Преобразует профиль WCS в профиль ICC.                                                                                                          |
| [**вксдисассоЦиатеколорпрофилефромдевице**](/windows/win32/api/icm/nf-icm-wcsdisassociatecolorprofilefromdevice) | Отменяет связь указанного цветового профиля WCS с указанным устройством на указанном компьютере.                                                         |
| [**вксенумколорпрофилес**](/windows/win32/api/icm/nf-icm-wcsenumcolorprofiles)                                   | Перечисляет все цветовые профили, удовлетворяющие критериям перечисления в указанной области управления профилями.                                       |
| [**вксенумколорпрофилессизе**](/windows/win32/api/icm/nf-icm-wcsenumcolorprofilessize)                           | Возвращает размер (в байтах) буфера, необходимого функции [**вксенумколорпрофилес**](/windows/win32/api/icm/nf-icm-wcsenumcolorprofiles) для перечисления цветовых профилей. |
| [**вксжетдефаултколорпрофиле**](/windows/win32/api/icm/nf-icm-wcsgetdefaultcolorprofile)                         | Извлекает профиль цвета по умолчанию для устройства или аппаратно-независимое значение по умолчанию, если устройство не указано.                                  |
| [**вксжетдефаултколорпрофилесизе**](/windows/win32/api/icm/nf-icm-wcsgetdefaultcolorprofilesize) | Возвращает размер (в байтах) имени профиля цвета по умолчанию для устройства, включая знак завершения **null** .                                       |
| [**вксжетдефаултрендерингинтент**](/windows/win32/api/icm/nf-icm-wcsgetdefaultrenderingintent) | Извлекает цель отрисовки по умолчанию в указанной области управления профилями.                                                                    |
| [**вксжетусеперусерпрофилес**](/windows/win32/api/icm/nf-icm-wcsgetdefaultrenderingintent) | Определяет, будет ли пользователь использовать список ассоциаций профилей для каждого пользователя для указанного устройства.                                          |
| [**вксопенколорпрофилев**](/windows/win32/api/icm/nf-icm-wcsopencolorprofilew) | Создает маркер для указанного цветового профиля.                                                                                                       |
| [**вкссетдефаултколорпрофиле**](/windows/win32/api/icm/nf-icm-wcssetdefaultcolorprofile) | Задает имя профиля цвета по умолчанию для указанного типа профиля в указанной области управления профилями.                                         |
| [**вкссетдефаултрендерингинтент**](/windows/win32/api/icm/nf-icm-wcssetdefaultrenderingintent) | Задает цель отрисовки по умолчанию в указанной области управления профилями.                                                                         |
| [**вкссетусеперусерпрофилес**](/windows/win32/api/icm/nf-icm-wcssetuseperuserprofiles)                           | Позволяет пользователю указать, следует ли использовать список ассоциаций профилей для каждого пользователя для указанного устройства.                                              |



 

## <a name="profile-consumption-functions"></a>Функции использования профиля

Интерфейсы API потребления профиля — это API-интерфейсы в ICM2, которые принимают профили XML ICC или WCS, дескрипторы профилей или отрисовки в качестве параметров, а также набор новых интерфейсов API для поддержки профиля WCS для кода управления цветом приложения.

 

## <a name="profiles-and-profile-management-functions"></a>Профили и функции управления профилями

Рабочий процесс управления профилями основан на существующих API-интерфейсах ICM2, которые дополняются для предоставления дополнительных функциональных возможностей для пересмотра кода приложения.

Профили содержат сведения, используемые алгоритмами обработки цветов для преобразования цветов между разными цветовыми пространствами. Управление профилями позволяет запрашивать и указывать, какие профили используются на разных стадиях в модели обработки цветов для управления выходными цветами различных периферийных устройств с различными цветовыми характеристиками.

Управление профилями обеспечивает следующий набор функций:

 

1. Установка цветовых профилей для использования в системе.

 

2. Связывание одного или нескольких установленных цветовых профилей с любым конкретным устройством.

 

3. Выбор цветового профиля по умолчанию для конкретного типа в профилях, доступных для использования на определенном этапе обработки цветов. Это может быть для устройства в отношении профилей, связанных с ним, или из профилей, установленных в системе, а не для конкретных устройств.

 

4. Перечисление цветовых профилей, удовлетворяющих определенным условиям, между профилями, установленными в системе.

Расширения файлов профиля WCS — это ". КДМП" для Дмпс, ". Camp" для Camp и ". ГММП" для Гммпс.

 

**Управление профилями для отдельных пользователей и включение выполнения в контексте LUA**

Цель проектирования, описанная в текущем документе, выглядит следующим образом:

 

1. Устаревшая реализация ICM2 не обеспечивает поддержку управления профилями для отдельных пользователей. Разные пользователи не могут иметь собственные параметры профиля. В Vista инфраструктура управления профилями WCS позволяет пользователям настраивать индивидуальные параметры профиля для большинства функциональных возможностей.

 

2. Все устаревшие API-интерфейсы ICM2 управления профилями изменяют параметры всей системы и требуют прав администратора. в Windows Vista все пользователи работают в параметрах учетной записи пользователя с минимальными правами (LUA) большую часть времени, и администраторы могут выборочно повышать привилегии для запуска приложений, изменяющих параметры на уровне системы. В управлении профилями WCS все параметры профиля для каждого пользователя можно настроить в контексте LUA. Приложения управления профилями могут работать как параметры LUA, увеличивая их область использования и гарантируя, что безопасность системы не будет скомпрометирована.

Управление профилями в Vista обеспечивает следующие улучшения по сравнению с устаревшей инфраструктурой ICM2:

 

1. Он обеспечивает связь профилей с устройствами, параметрами профиля по умолчанию и перечислением профилей в области для отдельных пользователей и на уровне системы.

 

2. Установка профиля остается в масштабе всей системы и требует прав администратора. Это согласуется с установкой профиля во время установки устройства, так как установка устройства является всей системой и требует прав администратора.

 

Можно ли устанавливать устройства из контекста LUA, особенно для того, что поддерживается для этого класса устройства. Например, в Vista можно выполнить установку принтера из контекста LUA, если пользователю были предоставлены права на копирование файлов в хранилище драйверов администратором домена с помощью политик хранилища драйверов. Инфраструктуре управления цветовым профилем не требуется выполнять никаких специальных действий, так как установка происходит в контексте диспетчера очереди печати.

 

3. Изменение параметров профиля в области "на пользователя" может осуществляться в контексте LUA; изменения, необходимые для всей системы, требуют прав администратора. Операции управления профилями, для которых требуется чтение сведений о конфигурации, можно выполнять в контексте LUA как для отдельных пользователей, так и для всей системы.

Область управления профилями указывает область выполняемых операций. для каждого пользователя или для всей системы.

Для каждой операции указывается, можно ли выполнять из контекста LUA. Если операция не может быть выполнена в контексте LUA, соответствующий API управления профилями возвращает ошибку с отказом в доступе. Приложения, использующие API, например панель управления цветом, могут предоставить пользователю возможность повысить права до контекста администрирования (с помощью OTS-или пользовательского интерфейса согласия), а затем вызвать API из контекста с повышенными привилегиями, чтобы операция была выполнена.



Операция

Область управления профилями

Предварительное условие

Условие после

Исполняемый файл в контексте LUA

$ {ROWSPAN2} $Install профиль $ {Remove} $  

Для всей системы

Профиль скопирован, установлен в систему и доступен для использования. Профиль является перечислимым в области всей системы и текущего пользователя для всех пользователей.

Во время установки драйвера устройства регулируется политиками установки драйверов. Нет, в противном случае.

Текущий пользователь

Не поддерживается

$ {ROWSPAN2} $Uninstall профиль $ {Remove} $  

Для всей системы

Профиль установлен в системе

Профиль удаляется из системы и при необходимости удаляется из хранилища профилей. Профиль больше недоступен для использования и не является перечислимым в какой-либо области.

Нет

Текущий пользователь

Не поддерживается

$ {ROWSPAN2} $Associate профиль с устройством $ {Remove} $  

Для всей системы

Профиль установлен и имеет тип ICC или КДМП

Профиль доступен для использования на устройстве всеми пользователями. Это перечислимое значение, в области всей системы, а также в области текущего пользователя для всех пользователей, связанных с устройством.

Нет

Текущий пользователь

Профиль установлен. Не имеет значения, был ли профиль уже связан с устройством в области всей системы и имеет тип ICC или КДМП.

Профиль доступен для использования с устройством текущим пользователем. Он передается только в области текущего пользователя (кроме случаев, когда отсутствует связь на уровне системы), связанная с устройством.

Да

$ {ROWSPAN2} $Disassociate профиль с устройства $ {Remove} $  

Для всей системы

Профиль связан с устройством в области всей системы и имеет тип ICC или КДМП

Профиль больше не доступен для использования (за исключением пользователей с этой связью в области текущего пользователя). Он не является перечислимым в области всей системы. Это может быть перечислимое в области текущего пользователя, но для пользователя, имеющего эту ассоциацию в своей области.

Нет

Текущий пользователь

Профиль связан с устройством в области текущего пользователя (независимо от того, связан ли он с областью на уровне системы) и имеет тип ICC или КДМП.

Профиль больше не доступен для использования или перечислимый, как связанный с устройством, текущим пользователем (если он не связан с устройством в области всей системы).

Да

$ {ROWSPAN2} $Set профиль для типа (DMP или ICC) в качестве значения по умолчанию для устройства $ {Remove} $  

Для всей системы

Профиль имеет тип ICC или КДМП

Профиль используется по умолчанию для конкретного типа устройства для всех пользователей, за исключением тех, кто переопределил этот параметр в области текущего пользователя. (Профиль устанавливается и связывается с системой устройства, если это еще не так.)

Нет

Текущий пользователь

Профиль имеет тип ICC или КДМП

Профиль используется по умолчанию для конкретного типа с устройством в случае текущего пользователя, независимо от значения по умолчанию для всей системы. (Если это еще не так, профиль устанавливается и связывается с устройством для текущего пользователя.)

Да, если профиль уже установлен

$ {ROWSPAN2} $Set профиль для типа (ICC, DMP, CAMP, ГММП) и комбинации подтипов как глобальное по умолчанию $ {Remove} $  

Для всей системы

С устройствами могут быть связаны только профили ICC и КДМП.

Профиль используется по умолчанию для конкретного типа. Пользователи могут переопределить этот параметр в области текущего пользователя. (Профиль устанавливается, если это еще не так.)

Нет

Текущий пользователь

С устройствами могут быть связаны только профили ICC и КДМП.

Профиль используется по умолчанию для конкретного типа текущего пользователя. (Профиль устанавливается, если это еще не так.)

Да, если профиль уже установлен.

$ {ROWSPAN2} $Erase Переопределение текущего пользователя для определенного параметра профиля по умолчанию, чтобы система всегда использовалась по умолчанию (в качестве резервной), даже для текущей области пользователя. $ {Remove} $  

Для всей системы

Неприменимо

Текущий пользователь

Даже для запросов текущего пользователя о параметрах профиля по умолчанию для использования возвращаются параметры на уровне системы.

Да

$ {ROWSPAN2} $Enumerate установленные профили, удовлетворяющие определенным критериям (например, класс устройства, класс профиля и т. д.). $ {REMOVE} $  

Для всей системы

Только профили ICC и КДМП можно связать и перечислить для устройств.

Устанавливаются профили, удовлетворяющие заданным условиям в области всей системы, перечислены.

Да

Текущий пользователь

Только профили ICC и КДМП могут быть связаны с устройствами и, следовательно, перечисляются для устройств.

Установленные профили, удовлетворяющие заданным критериям в области всей системы, перечислены.

Да

$ {ROWSPAN2} $Enumerate профили, связанные с определенным устройством, удовлетворяющие определенным критериям, например класс устройства и класс профиля $ {Remove} $  

Для всей системы

Только профили ICC и КДМП можно связать и перечислить для устройств.

Профили, связанные с устройством в области всей системы и удовлетворяющие заданным критериям в области всей системы, перечисляются.

Да

Текущий пользователь

Только профили ICC и КДМП можно связать и перечислить для устройств.

Профили, которые доступны в соответствии с устройством в области текущего пользователя, включая сопоставления на уровне системы и удовлетворяющие заданным условиям в области текущего пользователя, перечислены.

Да



 

Допустимые типы цветовых профилей предоставляются перечислением КОЛОРПРОФИЛЕТИПЕ.

Допустимые подтипы цветового профиля предоставляются перечислением КОЛОРПРОФИЛЕСУБТИПЕ.

Допустимые сочетания типа или подтипа профиля показаны в следующей таблице.



COLORPROFILETYPE 

Допустимый КОЛОРПРОФИЛЕСУБТИПЕ

Примечания

По умолчанию для устройства

Глобальное значение по умолчанию

Предполагаемое использование

Предполагаемое использование

КПТ \_ ICC

КПСТ \_ None

Получить или задать профиль ICC по умолчанию, связанный с устройством

КПСТ \_ ргбворкингспаце или КПСТ \_ кустомворкингспаце

Возвращает или задает профиль ICC в качестве глобального RGB или пользовательского профиля рабочего пространства. См. примечание.

КОЛОРПРОФИЛЕТИПЕ КПТ \_ ICC и КПТ DMP являются взаимоисключающими \_ . Цветовой профиль по умолчанию, заданный для данного рабочего пространства (RGB или Custom), может быть либо профиль ICC, либо профиль DMP, но не оба.

КПТ \_ DMP

КПСТ \_ None

Получение или Установка профиля по умолчанию DMP, связанного с устройством

КПСТ \_ ргбворкингспаце или КПСТ \_ кустомворкингспаце

Скачайте или установите профиль DMP в качестве глобального RGB или пользовательского профиля рабочего пространства. См. примечание.

КОЛОРПРОФИЛЕТИПЕ КПТ \_ ICC и КПТ DMP являются взаимоисключающими \_ . Цветовой профиль по умолчанию, заданный для данного рабочего пространства (RGB или Custom), может быть либо профиль ICC, либо профиль DMP, но не оба.



 

> [!Note]  
> Когда Вкссетдефаултколорпрофиле вызывается для установки профиля DMP в качестве профиля по умолчанию для рабочего пространства RGB или пользовательского рабочего пространства, допустим только профиль DMP с типом Ргбвиртуалдевице, LCD или CRT.
>
>  
>
> Когда Вкссетдефаултколорпрофиле вызывается для задания ICC-профиля в качестве профиля по умолчанию для рабочего пространства RGB или пользовательского рабочего пространства, только ICC-профиль, класс которого имеет значение "Спак" или "Дозапись", а цветовое пространство "RGB" является допустимым.

 

Архитектура разработана в соответствии с требованиями операций, описанными в перечисленных выше перечислениях и таблицах.

### <a name="profile-management-public-api-layer"></a>Уровень общедоступного API управления профилями

Так как область управления профилями не поддерживается устаревшими API ICM2, необходимо создать новый набор API-интерфейсов управления профилями WCS, который определяет область управления профилями как для всей системы, так и для текущего пользователя. ? Устаревшие API ICM2 по-прежнему поддерживаются для обратной совместимости и работают с областью управления профилями, которая является неявной для вызова. o ICM2 API-интерфейсы, работающие с текущей областью пользователя? Это относится к операциям, которые поддерживаются как для всей системы, так и для текущего пользователя в управлении профилями WCS. Устаревшие API ICM2 вызывают новые API-интерфейсы WCS с областью управления профилями в качестве текущего пользователя. Это имеет смысл с точки зрения пользователя, так как это позволяет применять параметры для каждого пользователя из устаревших приложений, а также выполнять большинство операций в контексте LUA. o ICM2 API-интерфейсы, работающие в области всей системы? Это относится к операциям (Установка профилей и профилей удаления), поддерживающих только область всей системы. Новые API-интерфейсы управления профилями WCS не создаются, и существующие API-интерфейсы могут быть изменены.

Базовые реализации операций управления профилями работают со следующими сущностями данных конфигурации для создания контекста для алгоритмов цветовой обработки, обеспечивающих функциональные возможности управления цветом. Они относятся либо к устройствам, либо к глобальным (независимо от устройства) параметрам. выводить данные конфигурации для конкретных устройств:? Список профилей, связанных с определенным устройством. ? Профиль по умолчанию для различных типов профилей, связанных с устройством. ? Режим сопоставления профилей, используемых для перечисления. o глобальные данные конфигурации:? Список профилей, установленных в системе. ? Глобальный профиль по умолчанию для различных типов профилей. ? Базовые реализации хранилища данных конфигурации занимают область хранения для данных конфигурации (независимо от устройства или конкретного устройства), который может быть либо общесистемным, либо текущим пользователем. Это отличается от области управления профилями. Операция с областью управления профилями текущего пользователя может вызвать чтение из области хранения на уровне системы, если параметр текущего пользователя для этой операции отсутствует. ? Уровень API ICM2/WCS вызывает на этом уровне хранилища для получения и настройки данных с соответствующей областью хранения. Уровень хранилища прозрачен для области управления профилями. Логика для объединения данных из областей хранения текущего пользователя и всей системы для создания или обновления конфигурации в соответствии с областью управления профилями, заданной вызывающим объектом API. Эта логика имеется на уровне API ICM2/WCS.

### <a name="device-specific-storage-layer"></a>Уровень хранилища для конкретного устройства

Хранилище для различных классов устройств, таких как печать, захват или отображение, может отличаться друг от друга. Например, данные конфигурации для устройства печати должны храниться с помощью стандартных API печати, таких как Сетпринтердатаекс и Жетпринтердатаекс, чтобы включить копирование профилей и параметров для передачи на клиентский компьютер во время подключения «точка-печать». ? Этот слой экспортирует функциональные возможности для открытия хранилища, получения данных, настройки данных и закрытия хранилища с помощью стандартных предварительно определенных интерфейсов, чтобы уровень хранилища конфигурации управления профилями мог вызывать их, в то время как они прозрачны для сохранения данных для этого устройства.

Эта архитектура показана на следующей диаграмме.



Уровень общедоступного API управления профилями

$ {ROWSPAN2} $Legacy ICM2 API для операций, которые поддерживают только область управления профилем на уровне системы в Vista (установка, удаление и получение каталога цветов). Они вызывают уровень хранилища конфигурации с соответствующей областью хранения. $ {Remove} $  

Устаревший API ICM2 для операций, поддерживающих область управления профилями уровня системы и текущего пользователя в Vista (все операции, Кроме установки, удаления и получения каталога цветов). Они неявно работают с текущей областью действия пользователя и вызывают новый API WCS с областью управления профилями в качестве текущего пользователя.

Новый API-интерфейс WCS с поддержкой области управления профилями на уровне системы и текущего пользователя. Они вызывают уровень хранилища конфигурации с соответствующей областью хранения.



 



уровень служба хранилища конфигурации управления профилями

Универсальные программы глобальной конфигурации, независимые от устройства

Подпрограммы конфигурации для конкретных устройств

$ {ROWSPAN3} $Profile Установка и аппаратно-независимое управление параметрами профиля, поддерживаемое в области хранения на уровне системы и текущего пользователя. $ {Remove} $  

Сопоставление устройств и управление параметрами профиля по умолчанию для конкретных устройств, поддерживаемое в масштабах всей системы и в области хранения текущего пользователя.

уровень служба хранилища Device-Specific

Печать конкретного хранилища

Отображение конкретного хранилища

Записать определенное хранилище



 

Устаревшие API ICM2 для операций, которые поддерживают только область управления профилем на уровне системы в Vista, не имеют изменений в поведении. Операции установки и удаления попадают в эту категорию.

Устаревшие API-интерфейсы ICM2 для операций, которые поддерживают область управления профилями уровня системы и текущего пользователя, заменяют поведение для запроса и настройки текущих параметров пользователя. Все операции, отличные от install и Uninstall, попадают в эту категорию.

 

 




