---
title: Схема и алгоритмы схемы профиля модели карт гаммы WCS
description: Схема и алгоритмы схемы профиля модели карт гаммы WCS
ms.assetid: 64b9871a-1b4f-4e9a-be4d-4c25b3198b91
keywords:
- Цветовая система Windows (WCS), профиль модели карт цветов (ГММП)
- WCS (цветовая система Windows), профиль модели карт цветов (ГММП)
- Управление цветом изображений, профиль модели карт цветов (ГММП)
- Управление цветом, профиль модели карт цветов (ГММП)
- цвета, профиль модели соответствия цветовой палитры (ГММП)
- Цветовая система Windows (WCS), профили
- WCS (цветовая система Windows), профили
- Управление цветом изображений, профили
- Управление цветом, профили
- цвета, профили
- Профиль модели карт цветов (ГММП)
- ГММП (профиль модели карт цветов)
- Профиль модели карт цветовой гаммы WCS
- схемы, профиль модели карт цветов (ГММП)
- алгоритмы, профиль модели карт CMYK (ГММП)
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3714e5d7592cb1fbbbfa98e238642a2fcb38bafd
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "104571816"
---
# <a name="wcs-gamut-map-model-profile-schema-and-algorithms"></a>Схема и алгоритмы схемы профиля модели карт гаммы WCS

-   [Обзор](#overview)
-   [Архитектура профиля модели карт цветов](#gamut-map-model-profile-architecture)
-   [Создание границы цветового охвата](#generation-of-the-gamut-boundary)
-   [Схема ГММП](#the-gmmp-schema)
-   [Элементы схемы ГММП](#the-gmmp-schema-elements)
-   [гамутмапмодел](#defaultbaselinegamutmapmodel-type)
    -   [Пространство имен](#namespace)
    -   [Version](#version)
    -   [Документация](#documentation)
    -   [Тип Дефаултбаселинегамутмапмодел](#defaultbaselinegamutmapmodel-type)
    -   [плугингамутмаптипе](#plugingamutmaptype)
    -   [ExtensionType](#extensiontype)
-   [Базовые алгоритмы ГММП](#the-gmmp-baseline-algorithms)
-   [Согласование нейтральных осей](#aligning-the-neutral-axes)
    -   [Минимальная цветовая разница (Минкд)](#minimum-color-difference-mincd)
    -   [басикфото](#basicphoto)
    -   [Обзор](#overview)
    -   [При использовании оболочки одного цветового охвата](#the-case-of-single-gamut-shell)
    -   [Черное расширение](#black-enhancement)
    -   [Случаи использования оболочек с двойным охватом](#the-case-of-dual-gamut-shells)
    -   [Причины изменений в рекомендациях ЦИЕ TC8-03](#reasons-for-changes-from-the-cie-tc8-03-recommendations)
    -   [Сопоставление оттенков](#hue-mapping)
-   [Описание границы палитры и алгоритмы оболочки](#gamut-boundary-description-and-gamut-shell-algorithms)
    -   [Триангуляция границы цветового охвата](#triangulation-of-the-gamut-boundary)
    -   [Элементы линии границ](#boundary-line-elements)
    -   [Операция с охватом: Чеккгамут](#gamut-operation-checkgamut)
    -   [Плоскость полного оттенка: Intersect](#full-hue-plane-intersect)
    -   [Операция с охватом: Чеккгамут (продолжение)](#gamut-operation-checkgamut-continued)
    -   [Сопоставление палитры минимальных цветовых различий](#minimum-color-difference-gamut-mapping)
    -   [Сглаживание оттенков](#hue-smoothing)
    -   [Настройка первичных и вторичных баз данных в описании границы цветового охвата](#setting-primaries-and-secondaries-in-the-gamut-boundary-description)
    -   [Задание нейтральной оси в описании границы цветового охвата](#setting-the-neutral-axis-in-the-gamut-boundary-description)
-   [См. также](#related-topics)

## <a name="overview"></a>Обзор

Эта схема используется для указания содержимого профиля модели карт для цветового охвата (ГММП). Связанные базовые алгоритмы описаны в следующем разделе.

Базовая схема ГММП состоит из общих сведений о заголовках, необязательной ссылки на предпочтительный подключаемый модуль модели карт цветов и тегов расширений.

Кроме того, ГММП предоставляет явную информацию о целевой модели карт цветов и предоставляет политику для базовой модели резервного отображения цветового элемента, которая используется, если Целевая модель недоступна. Схема может включать в себя закрытые сведения о расширении, но не будет содержать другие лишние сведения.

## <a name="gamut-map-model-profile-architecture"></a>Архитектура профиля модели карт цветов

![Схема, на которой показан профиль модели карт цветов.](images/gmmp-image002.png)

Выборка колорантного дискового пространства выполняется путем прохода по колорантс с 0,0 до 1,0 с помощью дробного шага, накопления всех сочетаний колорант на каждом шаге, а затем преобразования их из колорант пространства устройства в область отображения цвета с помощью метода DM::D Евицетоколориметрикколорс, за которым следует метод «Камера:: Колориметриктоаппеаранцеколорс». Ниже приведен пример того, как это делается для RGB.


```C++
For (red= 0.0; red <= 1.0; red += redStep) {

     For (green = 0.0; green <= 1.0; green += greenStep) {

          For (blue = 0.0; blue <= 1.0; blue += blueStep) {

               Colorants[0] = red; colorants[1] = green; colorants[2] = blue;

               pRGBDM->DeviceToColorimetricColors(1, colorants, &amp;XYZ);

               pCAM->ColorimetricToAppearanceColors(1, &amp;XYZ, &amp;JCh);

          }

     }

}

```



## <a name="generation-of-the-gamut-boundary"></a>Создание границы цветового охвата

Существует три компонента границы цветового охвата: первичные, нейтральные выборки и оболочки. Первичные цвета создаются путем создания основных первичных устройств и применения преобразования Девицетоколориметрик/Колориметриктоаппеаранце. Нейтральные примеры создаются путем выборки пространства колоранта устройства в нейтральной области и применения того же преобразования. Для трех устройств колорант (RGB или КМИ) нейтральные образцы определяются так, что все колорантс равны, например, R = = G = = B. Для CMYK нейтральные выборки определяются как наличие C = = M = = Y = = 0.

Факторы, влияющие на данные, используемые для создания границы палитры, — это образцы данных (только базовые устройства) и условия просмотра. Размер шага, используемый для полной выборки пространства колорант (для мониторов и для оболочки правдоподобные), является внутренней константой и недоступен для внешней манипуляции. Изменение условий просмотра изменяет поведение модели цветового оформления (камера) и изменяет форму границы палитры, поэтому необходимо создать границу цветового охвата, привязанную к профилю условий просмотра. Если используется образец данных, как в случае с базовыми принтерами и устройствами записи, то выборка будет оказывать значительное влияние на форму эталонного уровня и влияет на поведение самой модели.

Для устройств ввода, таких как камеры и сканеры, используются различные выборки для создания справочной оболочки и оболочки правдоподобные. Эталонная оболочка создается на основе измерений, используемых для инициализации модели устройства. Оболочка правдоподобные создается аналогично предыдущему изображению для выходных устройств. Различие заключается в том, что при вводе типичного целевого объекта не получаются полностью насыщенные значения (где R, G или B = 255). Для оценки этих значений необходимо выполнить экстраполяцию с использованием модели устройства.

## <a name="the-gmmp-schema"></a>Схема ГММП


```C++
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema 
  xmlns:gmm="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:wcs="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes"
  targetNamespace="http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  elementFormDefault="qualified"
  attributeFormDefault="unqualified"
  blockDefault="#all"
  version="1.0">

  <xs:annotation>
    <xs:documentation>
      Gamut Map Model profile schema.
      Copyright (C) Microsoft. All rights reserved.
    </xs:documentation>
  </xs:annotation>

  <xs:import namespace="http://schemas.microsoft.com/windows/2005/02/color/WcsCommonProfileTypes" />

  <xs:element name="GamutMapModel">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="ProfileName" type="wcs:MultiLocalizedTextType"/>
        <xs:element name="Description" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="Author" type="wcs:MultiLocalizedTextType" minOccurs="0"/>
        <xs:element name="DefaultBaselineGamutMapModel">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:enumeration value="HPMinCD_Absolute"/>
              <xs:enumeration value="HPMinCD_Relative"/>
              <xs:enumeration value="SGCK"/>
              <xs:enumeration value="HueMap"/>
            </xs:restriction>
          </xs:simpleType>
        </xs:element>
        <xs:element name="PlugInGamutMapModel" minOccurs="0">
          <xs:complexType>
            <xs:sequence>
              <xs:any namespace="##other" processContents="skip"
                minOccurs="0" maxOccurs="unbounded" />
            </xs:sequence>
            <xs:attribute name="GUID" type="wcs:GUIDType" use="required"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
      <xs:attribute name="ID" type="xs:string" use="optional" />
    </xs:complexType>
  </xs:element>
</xs:schema>
```



## <a name="the-gmmp-schema-elements"></a>Элементы схемы ГММП

## <a name="gamutmapmodel"></a>гамутмапмодел

Этот элемент является последовательностью следующих вложенных элементов:

1.  Строка имени файла,
2.  Дефаултбаселинегамутмапмодел,
3.  Необязательная строка описания
4.  Необязательная строка автора
5.  Необязательный Плугингамутмап и
6.  Необязательный ExtensionType.

**Условия проверки** : каждый вложенный элемент проверяется по собственному типу.

### <a name="namespace"></a>Пространство имен

xmlns: ГММ = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "

targetNamespace = " http://schemas.microsoft.com/windows/2005/02/color/GamutMapModel "

### <a name="version"></a>Версия

Версия "1,0" в первом выпуске Windows Vista.

**Условия проверки** : 1,0 в Windows Vista. Версии &lt; 2,0 также являются допустимыми для поддержки некритических изменений формата.

### <a name="documentation"></a>Документация

Схема профиля модели карт цветов.

(C) корпорация Майкрософт (Microsoft Corporation). Все права защищены.

**Условия проверки** : каждый вложенный элемент проверяется по собственному типу.

### <a name="defaultbaselinegamutmapmodel-type"></a>Тип Дефаултбаселинегамутмапмодел

Тип UINT

Значения перечисления:

<dl> "Минкд \_ Absolute"  
"Минкд \_ относительный"  
"SIG \_ завяз"  
"Хуемап"  
</dl>

**Условия проверки** : значения должны соответствовать одному из перечисленных выше перечислений.

### <a name="plugingamutmaptype"></a>плугингамутмаптипе

Этот элемент является последовательностью Гуидтипе GUID и всех вложенных элементов.

**Условия проверки** : идентификатор GUID используется для сопоставления GUID подключаемого модуля ГММ DLL. Существует не более 100 000 настраиваемых вложенных элементов.

### <a name="extensiontype"></a>ExtensionType

Этот элемент является необязательной последовательностью всех вложенных элементов.

**Условия проверки** : может быть не более 100 000 вложенных элементов.

## <a name="the-gmmp-baseline-algorithms"></a>Базовые алгоритмы ГММП

## <a name="aligning-the-neutral-axes"></a>Согласование нейтральных осей

Большинство алгоритмов сопоставления цветовой палитры имеют цель сопоставления нейтральной оси исходного устройства с нейтральной осью целевого устройства: то есть белый цвет переключается в белый, черный на черный, а серый — на серый. Это устранено в части путем масштабирования яркости исходных цветов в соответствии с диапазоном освещенности целевого устройства. Но это не полностью решает проблему.

Это физическое свойство большинства устройств для работы с образами, которое не совпадает с цветовым изображением устройства. Например, белый цвет зависит от суммы цветов и относительных светимости трех первичных элементов, а монитор черного зависит от отражения поверхности отображения. Белый принтер зависит от насыщенности бумаги, тогда как черный принтер зависит от используемой краски или тонера. Модель внешнего вида, которая сопоставляет устройство в точности с нейтральной осью пространства внешнего вида (чрома точно равно нулю), не сопоставляет черный объект с нейтральной осью. Так как степень освещенности более важна для чроманых различий, то средние оттенки серого будут представлены еще больше, чем черные устройства. (На рис. 1 показана кривизна нейтральных осей в двух измерениях. Фактически, нейтральные оси формируют более сложную кривую в трех измерениях.)

Хотя Камера прогнозирует, что эти нейтральные цвета устройства будут выглядеть как цветное, фактические наблюдатели кажутся компенсировать это. Большинство пользователей не рассматривайте эти нейтральные значения устройства как цветные. Поэтому для большинства моделей сопоставления цветовых диапазонов следует по прежнему сопоставлять нейтральные источники с нейтральными к устройствам.

Чтобы сопоставить исходные нейтральные значения с нейтральными устройствами, настройте границы исходного и целевого диапазонов и каждый пиксель при применении алгоритма сопоставления палитры. Сначала скорректируйте каждое значение в исходном цвете, чтобы нейтральная ось исходного устройства на свете исходного цвета нападает непосредственно на нейтральную ось области внешнего вида. (См. левую часть рис. 1.) Затем измените описание границы цветовой гаммы устройства назначения таким образом, чтобы каждый цвет на нейтральной оси целевого устройства на уровне границы цветовой области конечного устройства направляться непосредственно на нейтральную ось пространства внешнего вида. (См. правую часть на рис. 1.)

![Диаграмма, на которой показана исходная диаграмма границы цветовой гаммы слева, а также Целевая граница цветовой гаммы справа.](images/gmmp-image004.png)

**Рисунок 1** . проиллюстрированное выравнивание нейтральных осей. Left: корректировка исходных точек относительно нейтральной оси исходного устройства. Right: изменение описания границы целевой палитры в соответствии с описанием границы целевой палитры.

Обратите внимание, что каждое значение исходного пикселя изменяется относительно нейтральной оси в этом значении освещенности. Это гарантирует, что нейтральность исходного устройства будет попадать в нейтральную ось модели внешнего вида. Вы также сдвигаете все остальные цвета на тот же самый уровень, чтобы в представлении исходного диапазона не было ненепрерывных отработок. Необходимо сдвинуть различные суммы на разных уровнях освещенности, так как нейтральные исходные устройства не представляются как цветовые значения на разных уровнях освещенности. Очевидно, что это не является тривиальным преобразованием.

Обработка значений целевых устройств немного сложнее. Изначально все границы целевой палитры настраиваются аналогичным образом, но относительно нейтральной оси целевого устройства. Это показано на рис. 1 в правой части. Эта корректировка гарантирует, что значения серого источника будут сопоставляться с целевыми значениями серого. Это пространство, в котором работают алгоритмы сопоставления палитры.

Однако это пространство не точно описывает истинное поведение целевого устройства. Необходимо обратить сопоставление, прежде чем сопоставленные цветовые значения будут переданы модели внешнего вида и модели целевого устройства. Все сопоставленные значения будут смещены на противоположное смещению, примененному ранее, к нейтральной оси целевого устройства. После этого Целевая Нейтральная ось преобразуется обратно к значению, представленному с помощью камера. Она делает то же самое для границы цветового охвата и всех промежуточных значений.

![Схема, на которой показан график отмены выравнивания нейтральной оси целевого устройства.](images/gmmp-image008.png)

**Рис. 2** . Отмена выравнивания нейтральной оси на целевом устройстве

### <a name="minimum-color-difference-mincd"></a>Минимальная цветовая разница (Минкд)

Минимальная и абсолютная цветовая разница (Минкд), эквивалентная намерению ICC-изображения.

> [!Note]  
> Минкд ГММ подходит для сопоставления графики и штрихового изображения с цветами "Logo" (плашечными цветами), градиентами цвета эмблемы с некоторыми цветами, которые выходят за пределы цветового охвата, а также для последнего этапа преобразований для подтверждения. Хотя Минкд ГММ может использоваться для фотографических изображений, полностью находящихся в пределах целевого диапазона, не рекомендуется для общей отрисовки фотографических изображений. Сопоставление цветов вне цветового охвата с цветами на поверхности целевой палитры может привести к нежелательным артефактам, таким как тоновые или чромае искажения, в плавных градиентах, пересекающих границы палитры. Басикфото рекомендуется использовать для фотографических изображений. Если для фотографического или полутонового изображения требуется сопоставление цветов, отличное от Басикфото, то в качестве альтернативы необходимо создать подключаемый модуль ГММ, реализующий это сопоставление, вместо использования Минкд.

 

Цвета в цветовой палитре остались без изменений. Для цветов вне цветового охвата освещение и чрома настраиваются путем нахождения точки в целевом наборе данных с минимальным расстоянием по цвету от входных точек вне цветового охвата. Расстояние цвета вычислено в ЖЧ пространстве. Тем не менее вы завесови расстояние на свете (J) и расстоянии в чрома (C) или оттенке (h) по-разному. Функция веса, зависящая от чрома, используется для расстояния в свете, чтобы вес был меньше для мелких чрома и больше для крупных чрома, пока не будет достигнут порог чрома, после которого вес остается равным 1, то есть таким же весом, как расстояние в чрома или оттенке. Это следует за рекомендуемым использованием для CMC и CIEDE2000. Существует два варианта: относительный и абсолютный.

**Относительная цветопередача:** Сначала выровняйте нейтральные исходные и конечные оси, как описано выше. Затем обрезает скорректированный исходный цвет до скорректированной границы цветовой области назначения. (См. рис. 4. Чрома сопоставление и постоянное освещение.) Измените значения целевых устройств, как описано выше. В случае границы цветовой палитры назначения Монохромная обрезка чрома означает, что значение чрома (C) установлено в ноль (0,0).

**Абсолютная цветопередача:** Это похоже на относительную цветопередачу, но без выравнивания исходной и целевой нейтральных осей. Исходное значение обрезается непосредственно на нейтральную независимую ось. Обратите внимание, что, если границы исходного и целевого диапазонов являются монохромными, поведение идентично относительным вариантам. то есть выполняется выравнивание нейтральных осей, а затем чрома обрезается до нуля. Это гарантирует достижение приемлемого результата, даже если носители и колорантс значительно отличаются.

![Схема, на которой показан граф для Минкд обрезки в скорректированный цветовой охват.](images/gmmp-image010.png)

**Рис. 3** . минкд Обрезка до скорректированного цветового охвата

### <a name="basicphoto"></a>басикфото

### <a name="overview"></a>Обзор

Басикфото — эквивалент предпочтительной цели ICC, виде рисунков или искусственного.

Этот алгоритм является вариантом сопоставления чроманости сигмоидал и КУСП завяз масштабирования (СГКК), описанного ЦИЕ TC8-03 в CIE156:2004. Этот вариант алгоритма поддерживает дескрипторы границ цветовой гаммы (Гбдс) с двумя оболочками. то есть Гбдс со справочной оболочкой и оболочкой правдоподобные. Алгоритм СГКК, изначально использующий только одну оболочку в ГБД, основан на \_ алгоритме SIG завяз (браун 1999), включающем в себя сопоставление несоответствий сигмоидал и функцию масштабирования завяз, предложенную Браун и фаирчилд (1999), в сочетании с чрома, зависящим от гкусп (моровик, 1998). Она удерживает воспринимаемую константу оттенка, например угол оттенка в исправленном Jab, и использует универсальное (независимое от изображения) масштабирование сигмоидал, которое применяется в зависимости от чрома и 90% завяз функции чрома. Вариант масштабируется вдоль линий постоянной освещенности.

### <a name="the-case-of-single-gamut-shell"></a>При использовании оболочки одного цветового охвата

Рекомендуется проверять алгоритм в случае, когда исходный и целевой Гбдс имеют только одну оболочку цветового охвата. В этом случае алгоритм состоит из следующих вычислений.

Сначала выполните начальное сопоставление освещения, используя следующую формулу:

![Показывает формулу для первоначального сопоставления освещенности.](images/gmmp-image012.png) (1)

где *j ₒ* — исходная лампочка, а *j <sub>R</sub>* — это освещение воспроизведения.

![Показывает вторую формулу сопоставления освещения.](images/gmmp-image014.png) (2)

Если исходная цветовая гамма является монохромной, значение чрома будет равно нулю для границы монохромной рамки из-за выравнивания нейтральной оси. Это приведет к вырождению случая, когда C равно нулю. В этом случае *p <sub>C</sub>* имеет значение 1.

*p <sub>C</sub>* — это чромай коэффициент взвешивания (моровик, 1998), зависящий от чрома исходного цвета, C и *J <sub>S</sub>* является результатом сопоставления исходной освещенности с помощью функции сигмоидал.

 

Чтобы вычислить *J <sub>S</sub>* (браун и фаирчилд, 1999), таблица одномерного уточняющего запроса (LUT) между значениями освещения исходного и воспроизведения сначала настраивается на основе дискретных кумулятивных функций.

![Показывает формулу для вычисления J s.](images/gmmp-image016.png) (3)

где x ₀ и S — среднее и стандартное отклонение нормального распределения соответственно, а *i* = 0, 1, 2... *m*,*m* — число точек, используемых в LUT. *S <sub></sub>* — это значение совокупной нормальной *функции для*  / *m* %. Параметры зависят от яркости черной точки в палитре воспроизведения и могут быть интерполяции из таблицы 1. Дополнительные сведения о вычислении этих параметров см. в разделе Браун and Фаирчилд (1999, p. 391).

:::row:::
    :::column:::
        J <sub>минаут</sub>
    :::column-end:::
    :::column:::
       5.0
    :::column-end:::
    :::column:::
        10.0
    :::column-end:::
    :::column:::
        15.0
    :::column-end:::
    :::column:::
        20,0
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        ₀ x
    :::column-end:::
    :::column:::
       53,7
    :::column-end:::
    :::column:::
        56,8
    :::column-end:::
    :::column:::
        58,2
    :::column-end:::
    :::column:::
        60,6
    :::column-end:::
:::row-end:::
:::row:::
    :::column:::
        S
    :::column-end:::
    :::column:::
       43,0
    :::column-end:::
    :::column:::
        40,0
    :::column-end:::
    :::column:::
        35,0
    :::column-end:::
    :::column:::
        34,5
    :::column-end:::
:::row-end:::


**Таблица 1** . Вычисление параметров басикфото освещенности

Чтобы использовать S как LUT (S <sub>LUT</sub> ), его сначала необходимо нормализовать в диапазон освещенности \[ 0100 \] . Нормализованные данные затем масштабируются в динамический диапазон целевого устройства, как показано в уравнении 4, где *j*<sub>min/ *out*</sub> и *J*<sub>Max \ *out*</sub> — это значения яркости черной точки и белой точки на носителе воспроизведения соответственно.

![Показывает формулу для S в качестве LUT сопоставления.](images/gmmp-image018.png) (4)

На этом этапе значения *J s* можно получить из <sub>LUT</sub> , выполнив интерполяцию между точками *m* соответствующих значений *j O* и *j S* , которые он содержит, и используя в качестве входных данных следующее уравнение.

![Показывает формулу для получения значений J S.](images/gmmp-image020.png) (5)

J <sub>Минин</sub> — это значение освещенности черной точки исходного носителя, j <sub>Максин</sub> — это значение освещенности белой точки исходного носителя, а j <sub>O</sub> — исходная лампочка. Для последующего использования можно обозначить функцию *сигмоидал,* определенную в описанной выше форме, как показано на следующем рисунке 4.

![Схема, показывающая граф для сопоставления чрома и постоянной освещенности.](images/gmmp-image024.png)

**Рисунок 4** . Сопоставление чрома вдоль постоянной освещенности

Во-вторых, если граница целевой палитры имеет цвет «цвет», сжимать чрома вдоль линий постоянной освещенности (l) и выполнять сжатие следующим образом.

![Показывает формулу для выполнения сжатия чрома.](images/gmmp-image026.png)  (6)

где *d* представляет расстояние от *E* на *l*; *g* представляет границу средней границы; *r* представляет воспроизведение; и *o* на исходном рисунке 5.

![Схема, показывающая диаграмму для чрома и сжатия яркости в Басикфото.](images/gmmp-image028.png)

**Рис. 5** . сжатие чрома и освещения в басикфото

Если граница цветовой гаммы назначения является монохромной, то значение чрома обрезается до нуля.

В-третьих, используйте клип Минкд (описан ранее), чтобы устранить ошибку остатка.

### <a name="black-enhancement"></a>Черное расширение

Предыдущий алгоритм можно изменить, чтобы улучшить черный цвет, если назначением является устройство принтера. Эта ошибка связана с выбором *J <sub>минаут</sub>*, который обычно не соответствует темному цвету, который может быть создан принтером.

В частности, цвет с наибольшей плотностью, полученный путем размещения 100 процентов красок (или максимально возможного покрытия, если действует ограничение ГКР/Ink), обычно не является нейтральным в области отображения цвета. См. рис. 6. Иными словами, если для целевого устройства используется нейтральная Минимальная освещенность, то создаваемый масштабируемый элемент будет сопоставляться с минимальным значением плотности, которое может быть достигнуто принтером. Рассмотрим дальнейший вариант использования монитора для печати. Черный монитор, R = G = B = 0, будет распечатан как не самая высокая плотность. Влияние на качество изображения заключается в том, что существует нехватка глубины и контрастности.

![Схема, показывающая, как черная точка устройства может быть темнее, чем нейтральная Минимальная освещенность.](images/gmmp-seqfigure01.png)

**Рис. 6** . Черная точка устройства может быть темнее, чем нейтральная Минимальная освещенность.

Предположим, что местом назначения "Черная точка устройства" является Жкакбк/Жкккх k. Если параметр C k не равен нулю, то черная точка устройства не нейтральна относительно CAM02. При использовании J k для назначения «нейтральная Минимальная освещенность» в построении масштабируемых элементов; то есть, параметр

*J <sub>минаут</sub> = ЖК*

и применить его к исходной оболочке палитры, вы получаете конфигурацию, показанную на рис. 7. На рисунке плоскость оттенок соответствует h k.

![Схема, на которой показан измененный масштабируемый элемент с черной точкой устройства назначения.](images/gmmp-seqfigure02.png)

**Рис. 7** . Геометрическая схема с помощью измененного средства масштабирования яркости с конечной точкой устройства назначения

Чтобы использовать последующий алгоритм сжатия чрома, необходимо согласовать максимальный и минимальный лигхтнессес в исходных и конечных оболочках. Это можно сделать, настроив конечную оболочку между J <sub>неутралмин</sub> и j k, перемещая точки влево. Кроме того, это преобразование должно применяться ко всему Jab пространству, а не только к плоскости оттенка, соответствующей h k.

Преобразование имеет значение

![Показывает формулу преобразования.](images/gmmp-seqfigure03.png)

На рис. 8 показан результат преобразования.

![Схема, на которой показан результат измененной масштабируемости освещения с помощью черной точки устройства назначения.](images/gmmp-seqfigure04.png)

**Рис. 8** . Геометрическая схема с помощью измененного средства масштабирования яркости с конечной точкой устройства назначения

После применения обычного алгоритма сжатия чрома точка должна быть перемещена обратно; это значит, что для получения окончательного сопоставленного цвета необходимо применить обратное преобразование.

![Показывает формулу для обратного преобразования для получения окончательного сопоставленного цвета.](images/gmmp-seqfigure05.png)

### <a name="the-case-of-dual-gamut-shells"></a>Случаи использования оболочек с двойным охватом

Целью является обобщение SIG \_ завяз для одной оболочки палитры, если исходное устройство ГБД или целевое устройство ГБД имеют структуру из двух оболочек. Внутренняя оболочка будет называться справочной оболочкой, а внешняя оболочка будет называться оболочкой правдоподобные. Необходимо учитывать следующие случаи.

(a) как исходный ГБД, так и целевой ГБД имеют структуру с двумя оболочками.

(б) источник ГБД имеет структуру с двумя оболочками; Целевой ГБД имеет только одну оболочку.

(c) источник ГБД имеет только одну оболочку; Целевой ГБД имеет структуру из двух оболочек.

(d) как исходный ГБД, так и целевой ГБД имеют только одну оболочку.

Вариант (d) — это случай оболочки одной палитры, которая обсуждалась ранее. В случаях (a), (b) и (c) можно обобщить перемасштабирование, чтобы использовать дополнительную информацию из двойной структуры оболочки. В случаях (b) и (c), где либо источник, либо назначение имеют только одну оболочку, вы привлечете «инициированную оболочку ссылок», которая будет рассмотрена в следующем разделе «Принудительная оболочка ссылок». Общий алгоритм для двух оболочек будет описан для случая (a). После объяснения созданной эталонной оболочки можно применить алгоритм к регистру (b) и (c). Как и для сжатия чрома, коэффициент сжатия определяется максимальными доступными оболочками. Иными словами, если доступны как оболочка правдоподобные, так и справочная оболочка, будет использоваться оболочка правдоподобные. в противном случае будет использоваться ссылка на оболочку.

*Обобщенное перемасштабирование освещенности*

Существование двух оболочек как для источника, так и для назначения ГБД означает, что необходимо соотнести набор из четырех точек из источника ГБД с соответствующим набором в целевом ГБД.

![Показывает, как сопоставлять набор из четырех точек с соответствующим набором.](images/gmmp-image030.png)

Индексы имеют следующие значения.

o или r: "Original" (источник) или "Воспроизведение" (назначение)

min или Max: минимальная нейтральная освещенность или максимальная нейтральная освещенность

PLA или ref: оболочка правдоподобные или эталонная оболочка

Упорядочение в каждом четвере также является ожидаемой относительной величиной этих точек.

В сопоставлении «Автомасштабирование» используются те же первые уравнения, что и в одной оболочке, но *J S* определяется кусочно-способом следующим образом.

![Показывает формулу для J S кусочно-способом.](images/gmmp-image032.png) (7)

Иными словами, он сигмоидал в оболочке справочника и линейный за пределами. См. рис. 9.

![Схема, на которой показан график для функции повторного масштабирования для двух оболочек Гбдс.](images/gmmp-image033.png)

**Рис. 9** . Функция повторного масштабирования для двух оболочек гбдс

**ОБОЛОЧКА ПРИНУДИТЕЛЬНОЙ ССЫЛКИ**

Если один ГБД имеет одну оболочку, а другая ГБД имеет две оболочки, необходимо создать "ссылку на оболочку" для ГБД только с одной оболочкой. Существующая оболочка, которая вызывалась как ссылка на оболочку, будет заменена на "оболочка правдоподобные". На самом деле, нет необходимости создавать оболочку в полном Jab пространстве. Так как в перемасштабировании освещенности используются только значения *j Max* и *j min*, то необходимо только сделать это значение для принудительной оболочки. Существует два варианта, в зависимости от того, какие ГБД имеют две оболочки.

Вариант 1. источник ГБД имеет две оболочки; Назначение ГБД имеет одну оболочку.

Определите конечную оболочку, принудительно вызывающую ссылку на нейтральную ось. то есть к оболочке J <sub>r, \ min, \ ref</sub> и J <sub>r, \ Max, \ ref</sub> . Это делается с помощью следующего алгоритма.

![Показывает алгоритм определения целевой оболочки, вызывающей привязку.](images/gmmp-induced01.png)

Факторы <sub>низкая</sub> и? <sub>Управление</sub> разделением между оболочкой правдоподобные и справочной оболочкой. Значение 1 означает, что значения, указанные в параметре J <sub>min</sub> или j m ₐ ₓ совпадают. Их значения — "принудительно" из исходной справочной оболочки и исходной оболочки правдоподобные.

![Показывает формулу для значений исходной оболочки и исходной оболочки правдоподобные.](images/gmmp-induced02.png)

«Параметрные факторы» F <sub>Low</sub> и f <sub>High</sub> являются *настраиваемыми параметрами* , которые должны находиться в диапазоне от 0 до 1. Если значение равно 0, то значения J <sub>min</sub> или j m ₐ ₓ напрямую помещаются из оболочек-источников. В этом случае выберите F <sub>Low</sub> = 0,95 и F <sub>High</sub> = 0,1.

Вариант 2. источник ГБД имеет одну оболочку; Назначение ГБД имеет две оболочки.

Определите исходную вызывающую оболочку на нейтральной оси. то есть с оболочкой J <sub>o, \ min, \ ref</sub> и J <sub>o, \ Max, \ ref</sub> . Это делается с помощью следующего алгоритма.

![Показывает алгоритм определения целевой оболочки на нейтральной оси.](images/gmmp-induced03.png)

Опять же, факторы? <sub>низкая</sub> и? <sub>Управление</sub> разделением между оболочкой правдоподобные и справочной оболочкой. Значение 1 означает, что значения параметра J <sub>min</sub> или j m ₐ ₓ совпадают. Их значения — "принудительно" из исходной справочной оболочки и исходной оболочки правдоподобные:

![Показывает алгоритм управления разделением между справочной оболочкой и исходной оболочкой правдоподобные.](images/gmmp-induced04.png)

### <a name="reasons-for-changes-from-the-cie-tc8-03-recommendations"></a>Причины изменений в рекомендациях ЦИЕ TC8-03

Басикфото отличается от рекомендаций ЦИЕ TC8-03 следующими способами.

1.  Чрома не сжимается в КУСП, но вдоль линий постоянной освещенности.
2.  Диапазон освещенности использует освещение самого темного цвета в цветовой гамме, а не точку, в которой граница цветового охвата пересекает нейтральную ось.
3.  Басикфото поддерживает как эталонную оболочку, так и оболочку правдоподобные-палитры, если какая-либо граница палитры в преобразовании имеет две оболочки.
4.  Басикфото использует CIECAM02; Вместо использования CIECAM97s для преобразования в D65 на компакт-диске 400 CD/m2 и последующем использовании цветового пространства рит скрип.

Было сделано первое изменение, чтобы избежать проблем с инверсией тона, которые могут возникнуть при использовании сжатия в КУСП. Как показано на рис. 10, сжатие КУСП может привести к инверсии тона. Это может произойти, когда цвета высокого чрома светлее, чем цвета более низкого чрома. Так как СГКК сжимает каждый пиксель независимо друг от друга и чрома, не гарантируется сохранение отношения падения между значениями пикселя после сжатия. Хорошо известное негативное противопоставление этому решению при сжатии по строкам постоянной освещенности заключается в том, что вы можете негативно пострадать от чрома, особенно в тех областях, где граница целевого диапазона является очень плоской, как это происходит с ярко-желтым цветом.

![Схема, показывающая инверсию тона, вызванную СГКК.](images/gmmp-toneinversion.png)

**Рис. 10** . Инверсия сигнала, ВЫЗВАНная сгкк

![Показывает исходный образ чайник.](images/originalteapot.jpg)![Показывает СГККный результат изображения чайник.](images/badteapot.jpg)![Показывает Басикфотоный результат изображения чайник.](images/betterteapot.jpg)

**Рис. 11** . исходный образ, результат сгкк и результат басикфото

На рис. 11 показана эта инверсия сигнала. Слева находится исходный образ, захваченный цифровой камерой. в центре образ воспроизводится с помощью СГКК; как и справа, образ воспроизводится Басикфото. Изображение слева находится в цветовой области цифровой камеры, а центральные и правые изображения — в цветовом пространстве ЖК-дисплея. В исходном изображении верхняя часть чайник темнее нижней, так как в нижней части отражена скатерть, в которой он находится. В изображении СГКК верхняя часть на самом деле светлее, чем нижняя, из-за инверсии тона. Кроме того, элементы, отображаемые в нижней части чайник, трудно увидеть. В правой версии Басикфото была исправлена инверсия тона, а отраженные статьи более четко различимы.

Было сделано второе изменение, чтобы улучшить воспроизведение почти черных цветов на принтерах, где черный черный не попадает непосредственно на нейтральную ось CIECAM02. На следующем рис. 12 показан образ, преобразованный в sRGB; воспроизводится для струйного принтера RGB с помощью СГКК; и воспроизводится для того же принтера с помощью Басикфото. Изображение в центре не использует полный черный на устройстве и поэтому не имеет контраста, показанного в оригинале. Контраст восстанавливается с помощью Басикфото.

![Показывает исходное изображение набора воспроизведения.](images/playstructure.jpg)![Показывает изображение набора воспроизведения, воспроизводимого для струйного принтера R G B с помощью СГКК.](images/playstructurebad.jpg)![Показывает изображение набора воспроизведения, воспроизводимого для струйного принтера R G B с помощью Басикфото.](images/betterplaystructure.jpg)

**Рис. 12** . Расширенный черный

Было внесено третье изменение для улучшения воспроизведения цветов для цифровых камер. В частности, в случаях, когда цифровая камера была профилирована с помощью эталонной цели, описание границы палитры, построенное на основе измеренных цветов, может не включать все цвета, которые могут быть записаны в реальной сцене. Вместо того чтобы обрезать все цвета до цветового охвата целевого объекта «измеряемый цвет», можно использовать экстраполяцию для создания границы правдоподобные-диапазона. Алгоритм Басикфото предназначен для поддержки такой экстраполяции границы охвата.

Было сделано четвертое изменение, так как CIECAM02 хорошо работает при сопоставлении цветовых диапазонов. Процесс, рекомендованный TC8-03 преобразования цветов устройства в D65 на компакт-диске 400 CD/m2, и последующее использование цветового пространства рит скрип — это как ресурсоемкие, так и длительные вычисления.

### <a name="hue-mapping"></a>Сопоставление оттенков

Хуемап является аналогом цели ICC-насыщенности.

Если исходная или конечная границы исходного диапазона не содержат первичных значений, эта модель возвращается к модели Минкд (относительной), описанной в предыдущем разделе. Например, устройства, для которых не могут быть определены первичные элементы (профили ICC с более чем четырьмя каналами) или монохромные ICC-профили.

Этот алгоритм сначала корректирует цветовой тон значения входного цвета. Затем он одновременно корректирует освещение и чрома с помощью сопоставленного сдвига. Наконец, он обрезает значение цвета, чтобы убедиться, что он находится в пределах цветового охвата.

Первым шагом является определение «колес оттенков». Найдите значения ЖЧ для основного и дополнительного цветов для исходного и целевого устройств. Вы просматриваете только компоненты оттенок. В результате получается первичный или вторичный колесо оттенка с шестью цветовыми точками для каждого устройства. (См. рис. 13.)

![Схема, на которой показаны колеса оттенков с шестью цветными точками.](images/gmmp-figure12.png)

**Рис. 13** . коцветовые колеса

Лучшие результаты можно получить, если источник синего источника не повернут на целевой синий первичный. Вместо этого исходный синий цвет основного оттенка используется в качестве целевого угла синего основного оттенка.

Затем выполните поворот оттенка для каждого цвета ввода из исходного изображения,

а), используя угол оттенок входного цвета, определите расположение цвета на колесо исходного оттенка относительно двух смежных первичных или вторичных цветов. Расположение можно рассматривать как процент от расстояния между первичными элементами. Например, цветовой тон входного цвета составляет 40 процентов от значения оттенка пурпурного к значению оттенка Red.

b) на целевом колесе оттенок найдите связанный угол оттенок, например 40 процентов от пурпурного к красному. Это значение будет иметь угол оттенок назначения.

Как правило, исходные первичные и вторичные реплики не будут иметь те же углы оттенков, что и целевые первичные и вторичные реплики. то есть угол оттенок назначения обычно будет отличаться от угла оттенок источника.

Например, предположим, что колеса оттенков создают следующие значения:

Источник M = 295 градусов, источник R = 355 градусов.

Назначение M = 290 градусов, назначение R = 346 градусов.

Если угол оттенок входного цвета равен 319 градусам, он составляет 40 процентов от угла (24 градуса) от источника M к исходному R. Угол от M до R — 60 градусов, а угол от M до входного оттенка — 24 градуса. Вычислите угол в назначении, 40% от назначения M до целевого R (22 градуса), чтобы угол оттенок целевого цвета был равен 312 градусам.

Затем вычислите опорные точки оттенок для исходного и целевого оттенков. Чтобы вычислить контрольную точку оттенок для конкретного значения h (оттенка), необходимо найти значение J (Light) и C (чрома).

-   Найдите значение J контрольной точки оттенок путем интерполяции между значениями J для смежной первичной или вторичной точки, используя относительное расположение оттенка; Например, в этом примере 40%.
-   Найти максимальное значение C в этом значении J и h. Теперь у вас есть ЖЧ контрольной точки оттенок для этого оттенка.

![Схема, на которой показан лист оттенков.](images/gmmp-figure13.png)

**Рис. 14** . лист оттенок (визуализация среза границы цветовой гаммы в заданном оттенке)

Следующим шагом является вычисление распределения сдвига для каждого пикселя. Во-первых, визуализируйте лист оттенка из исходного диапазона для угла цветового оттенка исходного цвета, а конечный цветовой диапазон — для угла оттенка назначения, вычисленного во время поворота оттенка. Листья оттенков создаются с помощью "среза" из области границы ЖЧ на уровне отдельных оттенков (см. рис. 14).

Примечание. в целях оптимизации производительности не создаются листья оттенков. они описаны и показаны здесь только в целях визуализации. Операции выполняются непосредственно на поверхности границы палитры в указанном оттенке. Затем вы Вычислите контрольные точки оттенок, чтобы определить сопоставление сдвига.

-   Выполните перемасштабирование, чтобы связать черные и белые точки исходного листа с конечным конечным листом (см. рис. 15). Черные и белые точки на конечном уровне источника оттенок сопоставляются линейно с черно-белыми точками конечного оттенок, путем масштабирования всех координат J исходной границы. Значение цвета, сопоставленное с оттенокм, масштабируется таким же образом.

![Схема, показывающая сопоставление освещенности.](images/gmmp-figure14.png)

**Рис. 15** . Сопоставление освещенности

-   Определите опорные точки оттенок для каждого листа оттенков. Примените сопоставление сдвига к исходному листу, чтобы исходная и Целевая эталонные точки совпадали (см. рис. 16). Опорная точка для цветового охвата в определенном оттенке — это контрольная точка интерполяции между смежными первичными элементами. Опорная точка исходного оттенка источника сопоставляется линейно с контрольной точкой конечного оттенок, используя операцию сдвига, которая блокирует ось J, сохраняя черные точки и белые точки. Черные точки, белые точки и опорные точки исходного и целевого оттенков должны совпадать.
-   Примените сопоставление сдвига к значению цвета ввода "светло-скорректированный". Координаты J и C исходного значения цвета пропорционально масштабируются относительно расстояния от оси J.
-   Далее, незаметное сжатие светлых чрома, направленное к значению J-value контрольной точки оттенок, выполняется на цветовой точке с сопоставленным сдвигом. Сжатие к ссылке оттенка J выполняется на основе гамма-фактора, где белый, черный, серый и точки на ссылке на оттенок J не затрагиваются. Все остальные точки обычно имеют ссылку на оттенок J в гладком режиме, слегка расходуясь на ссылку на оттенок J, с чрома оставшейся константой. Зависимость чрома гарантирует, что нейтральные цвета не затрагиваются, и результат увеличивается на цвет с более высоким чрома.

Ниже приведено математическое описание сжатия яркости к ссылке на оттенок J или корректировка значения J в точке назначения. Он называется точкой назначения, так как он был преобразован в целевой цветовой охват.

Во-первых, вычислите «Факторк» (коэффициент зависимостей чрома) для целевой точки, который определяет, насколько эффективно будет сжиматься степень освещенности. Точки, расположенные рядом или на оси J, будут иметь немалое сжатие; несколько точек, отброшенных от оси J (High-чрома), будут применены к большему сжатию. Умножьте на 0,5, чтобы убедиться, что Факторк меньше 1, так как Саурцек может быть немного больше Референцек, но не в два раза шире.

Факторк = (Дестинатионк/Референцек)? 0,5

где:

Дестинатионк — это значение точки назначения в C.

Референцек — это значение точки ссылки оттенок в C.

Затем определите, находится ли точка назначения J выше или ниже ссылки на оттенок J. Если это так, выполните следующие действия.

1.  Вычисление "Факторж" для целевой точки относительно Референцеж. Это значение Факторж будет находиться в диапазоне от 0 до 1 (0, если на Референцеж; 1, если в Максж).
2.  Факторж = (Дестинатионж-Референцеж)/(Максж-Референцеж)

    где:

    Дестинатионж — значение J точки назначения.

    Референцеж — это значение J-value контрольной точки оттенок.

    Максж — это максимальное значение параметра J-Value для цветового охвата.

3.  Примените функцию питания, подобную гамме, к Факторж, которая уменьшит Факторж на определенный объем. В этом примере используется степень 2 (квадрат). Вычтите уменьшенный Факторж из исходного Факторж и умножьте результат на общее значение J-Range над основным Референцеж, чтобы найти "Делтаж", который представляет изменение в J после сжатия яркости, но не включает зависимость чрома.
4.  Делтаж = (Факторж-(Факторж? Факторж))? (Максж-Референцеж)

5.  Примените Факторк к Делтаж (чем выше чрома, чем больше результат) и вычислите новое значение J-Value для целевой точки.
6.  Дестинатионж = Дестинатионж — (Делтаж? Факторк)

Если значение J-Value для целевой точки ниже Референцеж, то аналогичное вычисление на предыдущих шагах A-C выполняется с помощью Минж вместо Максж, чтобы найти диапазон в J для вычисления Факторж и учитывать полярность операций ниже Референцеж.

Факторж = (Референцеж-Дестинатионж)/(Референцеж-Минж)

Делтаж = (Факторж-(Факторж? Факторж))? (Референцеж-Минж)

Дестинатионж = Дестинатионж + (Делтаж? Факторк)

где:

Минж — это минимальное значение параметра J-Value для цветового охвата.

Чрома для цветовых точек ввода разворачивается линейно (по возможности), а постоянная освещенность пропорциональна максимальному значению чрома в исходном и конечном охвате этого оттенка и яркости. В сочетании с предыдущим сжатием, зависящим от чрома, это помогает сохранить насыщенность, так как при сопоставлении наклона с помощью опорных точек в чрома (см. рис. 16) происходит чрезмерное сжатие.

![Схема, показывающая сопоставление сдвига с опорными точками оттенок, до сдвига влево после сдвига вправо.](images/gmmp-shearmapping.png)

**Рис. 16** . Сопоставление наклона, сжатие яркости к ссылке на оттенок J и расширение чрома

Ниже приведено математическое описание процесса расширения чрома или корректировка C-value конечной точки. Она называется точкой назначения, так как она была сопоставлена и в целевом охвате сжато значение яркости.

1.  Прежде чем приступить к сопоставлению, определите Саурцеекстентк (экстент чрома в светлых и темных цветах исходной точки).
2.  После того как распределение сдвига и сжатие яркости, преобразуя исходную точку в конечную точку, определяют Дестекстентк (экстент чрома на свете и цветовой тон конечной точки).
3.  Если Саурцеекстентк больше, чем Дестекстентк, Настройка чрома для целевой точки не требуется, и вы можете пропустить следующий шаг.
4.  Настройте Дестинатионк (чрома конечной точки) для размещения в целевом экстенте чрома на этом освещении и оттенок.
5.  Дестинатионк = Дестинатионк? (Дестекстентк/Саурцеекстентк)

    где:

    Дестинатионк — это точка назначения C-value.

    Саурцеекстентк — это максимальное значение в C-значении исходного диапазона в светлых и темных цветах исходной точки.

    Дестекстентк — это максимальное значение C-Value для целевого диапазона в светлых и темных цветах целевой точки.

Наконец, выполните минимальный шаг с вырезой. Если цветовой тон, повернутый, затемненный и находящийся на сдвиге, все еще немного выходит за пределы целевого диапазона, обрежьте его (переместите) в ближайшую точку на границе целевой палитры (см. рис. 17).

![Схема, показывающая минимальную отрезку расстояния.](images/gmmp-figure15.png)

**Рис. 17** . Обрезка минимального расстояния

## <a name="gamut-boundary-description-and-gamut-shell-algorithms"></a>Описание границы палитры и алгоритмы оболочки

Функция границы цветовой области устройства использует механизм модели устройства и аналитические параметры для получения границы цветовой палитры устройства, описанной в виде индексированного списка вершин поверхности в области охвата устройства. Поверхности вычисляется по-разному в зависимости от того, работаете ли вы с аддитивными устройствами, такими как мониторы, проекторы или вычитание устройств. Индексированный список вершин хранится в Циежаб. Структура индексированного списка вершин оптимизирована для аппаратного ускорения DirectX.

Этот подход имеет множество хорошо известных решений. При поиске "выпуклой поверхности DirectX" в Интернете вы получаете более 100 попаданий. Например, имеется ссылка из 1983 по этой теме (компьютерные теории и приложения, Шифуллс, b-сплайновые поверхности и кадкам, PP. 34-49) со ссылками датировано от 1970 до 1982 в разделе.

Коллекцию точек можно определить из внешней доступной информации следующим образом:

-   Точки для Справочника по мониторам создаются с помощью выборки цветового Куба в колоранте устройства.
-   Точки для Справочника по принтерам и устройствам записи получаются из образца данных, используемого для инициализации модели.
-   Точки для ссылки на оболочку для scRGB и sRGB создаются с помощью выборки цветового Куба для sRGB.
-   Точки для оболочки правдоподобные для устройств записи создаются с помощью выборки цветового Куба в пространстве колорант устройства.
-   Точки для Справочника по проекторам создаются с помощью выборки многогранника в Кубе цветов в пространстве колорант устройства.
-   Точки для возможной оболочки для расширенных цветовых пространств диапазонов создаются с помощью выборки цветового Куба в самом пространстве.

Вы можете создать список вершин, который эффективно описывает цветовой охват устройства, учитывая профиль устройства и службы поддержки системы.

Для выходных устройств граница цветового охвата описывает диапазон цветов, которые могут отображаться устройством. Граница цветового охвата создается на основе тех же данных, которые используются для моделирования поведения устройства. По сути, вы выводите выборку диапазона цветов, которые может создать устройство, измеряют цвета, преобразуют измерения в область внешнего вида, а затем используете результаты для создания границы цветового охвата.

Устройства ввода сложнее. Каждый пиксель входного изображения должен иметь какое бы то ни было значение. Каждый пиксель должен иметь возможность представить любой цвет в реальном мире каким бы то ни было образом. В этом смысле цвета для входного устройства не имеют цветов "вне диапазона", так как они всегда могут быть представлены.

Все форматы цифровых изображений имеют фиксированный динамический диапазон. Из-за этого ограничения всегда существует несколько уникальных VisualStateManager, которые сопоставляются с одним и тем же цифровым значением. Таким образом, нельзя установить однозначное сопоставление между реальными цветами и значениями цифровой камеры. Вместо этого граница палитры формируется путем оценки диапазона реальных цветов, которые могут создавать цифровые ответы камеры. Этот предполагаемый диапазон используется в качестве цветового охвата для устройства ввода.

Включены первичные элементы для обеспечения соответствия цветовой палитры с намерениями для бизнес-графики.

В true объектно-ориентированный стиль является абстрактным базовым представлением границы палитры. Это дает возможность изменять представление в будущем. Чтобы понять дескриптор границы цветовой палитры (ГБД), используемый в новом CTE-выражении, необходимо сначала понять, как работают алгоритмы сопоставления палитры (Гмас). Как правило, Гмас разрабатывались в соответствии с потребностями сообщества графических изображений; то есть, для воспроизведения образов, которые уже были правильно подготовлены для устройства, на котором был создан входной образ. Цель графического искусство Гмас — обеспечить лучшее воспроизведение входного изображения на выходном устройстве. Новое ОТВ ГБД предназначено для решения четырех основных проблем.

Поскольку входное изображение отображается для устройства ввода, все цвета помещаются в пределах диапазона между белой точкой и черной точкой. Предположим, что изображение представляет собой фотографию сцены, в которой есть рассеянный белый цвет, такой как человек в белой teeной футболе, и отраженный свет, такой как светлое отражение окна или хрома Chrome. Сцена будет подготовлена к просмотру на носителе входных данных, чтобы зеркальное отображение сопоставлялось с белой точкой среднего, а рассеянный белый сопоставляется с некоторыми нейтральными цветами, чем в белой точке средней точки. Выбор способа преобразования цветов из сцены во входной носитель — это как зависимое от сцены решение, так и Aesthetic решение. Если в исходной сцене отсутствовала отраженная подсветка, то, вероятно, рассеянный белый объект был бы сопоставлен с белой точкой средней точки. В сцене с большим количеством выделенных элементов будет оставлено больше диапазонов между отражающим белым и рассеянным белым цветом. В сцене, в которой выделение не имеет значения, может остаться совсем немного диапазона.

Для предварительно визуализированных изображений сопоставление цветового охвата относительно просто. По сути, исходная белая точка среднего цвета сопоставлена с белой точкой воспроизведения, черная точка источника сопоставляется с черной точкой назначения, и большая часть сопоставления завершена. Различные Гмас в наличии предоставляют варианты для сопоставления других точек на тональной шкале исходного носителя и различные способы обработки значений чрома, выходящих за пределы охвата. Но сопоставление белого и белого и черного к черному параметрам согласовано во всех этих вариантах. Для этой реализации требуется, чтобы белый цвет был выше a J \* 50 и черного цвета ниже a j \* из 50.

Не все кодировки цвета ограничивают диапазоны цветов для входных изображений. Стандартная цветовая кодировка IEC (IEC 61966-2-2) предоставляет 16 бит для каждого из трех цветовых каналов: красный, зеленый и синий (RGB). В этой кодировке ссылка Black не кодируется как тройной RGB (0, 0, 0), но как (4096, 4096, 4096). Ссылка белого кодируется как (12288, 12288, 12288). Кодирование scRGB можно использовать для представления отраженных светов и деталей тени. Он включает в себя RGB-триадные цвета, которые не являются физически возможными, так как для них требуются отрицательные объемы освещения и кодировки, находящиеся за пределами ЦИЕ Спектрал очага. Очевидно, что ни одно устройство не может создать все цвета в охвате scRGB. На самом деле, ни одно из устройств не может создать все цвета, которые может видеть человек. Таким образом, устройства не могут заполнить охват scRGB, и было бы полезно иметь возможность представить часть цветового охвата, заполняемого ими. Каждое устройство имеет диапазон значений в пространстве scRGB, которые он может создать. Это "ожидаемое" цветовое значение для устройства; устройство будет выдавать цвета за пределами этого диапазона. Существует определенное преобразование из пространства scRGB для отображения пространства, поэтому каждое устройство также имеет диапазон значений внешнего вида, которые предполагается воспроизвести.

Как в scRGB, так и во входных данных из устройств захвата с фиксированным целевым объектом можно получить значение за пределами диапазона ожидаемых значений. При калибровке камеры до целевого объекта тестирования; а затем захватывает сцену с отраженными световыми фрагментами, могут быть более яркие Пиксели, чем белая точка целевого объекта. То же самое может произойти, если естественное значение красного цвета является более цветным, чем у целевого красного цвета. Если кто-то принимает изображение scRGB с устройства, а затем вручную изменяет цвета в изображении, можно создать Пиксели, которые выходят за пределы ожидаемого диапазона в пределах области охвата устройства, даже если они находятся внутри полного охвата scRGB.

Вторая проблема, по-видимому, может быть связана с этим. Это возникает при использовании целевого объекта цвета для определения устройства ввода, например камеры или сканера. Отражающие цели обычно создаются на бумаге и содержат ряд цветных исправлений. Мануфатурерс предоставляют файлы данных с цветовыми измерениями, созданными при фиксированном условии просмотра для каждого исправления цвета. Средства профилирования цветов создают сопоставление между этими измеряемыми значениями и значениями, возвращаемыми датчиками цветов на устройствах. Проблема в том, что часто эти целевые объекты цветов не охватывают весь спектр значений устройств. Например, сканер или камера могут возвращать значение (253, 253, 253) для ссылки на белую точку, а для ссылки Red-Patch — значение RGB (254, 12, 4). Они представляют собой диапазон ожидаемых значений для устройства ввода на основе целевых значений. Если вы характеризуют устройство ввода на основе ответов на целевой объект, то ожидаются только цвета в пределах этого ограниченного диапазона. Этот диапазон не только меньше, чем диапазон цветов, которые видят люди, но меньше, чем диапазон цветов, которые может создать устройство.

В обоих случаях сложно оценить охват входного устройства или изображения, несмотря на существование эталонной палитры или измерений. В первой проблеме цветовой охват правдоподобные для входного устройства меньше, чем полный охват scRGB. Во второй сложности эталонный охват целевого объекта меньше, чем полный возможный охват входного устройства.

Третья проблема заключается в сопоставлении тонов. Многие модели границ цветовых диапазонов, которые могут адекватно представлять предварительно подготовленные изображения, используемые в графическом изображении, были предложены, например, Браун и Фаирчилд Mountain Range ГБД (Браун \[ 97 \] ) и сегмент моровик сегмента прыжка (моровик \[ 98 \] ). Но эти модели предоставляют только сведения о экстремальных цветах для каждого устройства. в них отсутствуют сведения о других точках в сопоставлении тональности. Без такой информации Гмас может делать только приблизительные оценки оптимального сопоставления тонов. Что еще хуже, эти модели не предоставляют справку для расширенного динамического диапазона в scRGB и в изображениях цифровой камеры.

Как эта проблема решена в фотографике и видеографик отраслях? Камера захватывает изображение. Эксперты могут спорить, какой объем отрисовки выполняется на устройстве записи; но они договариваются о том, что это не значительный объем. Обе технологии не сопоставляют белый в захваченном монтажном кадре с белой точкой средней точки. Аналогичным образом они не сопоставляют черную точку из сцены с черной точкой среднего цвета. Поведение фотопленки описывается в области плотности с помощью кривой характеристик, которая часто называется «вред» и «Дриффиелд» или «H&D». Кривая показывает плотность исходной сцены и полученную плотность на пленке. На рис. 18 показана типичная кривая H&D. Ось x представляет увеличение уровня уязвимости журнала. Ось y представляет плотность слайда. Пять опорных точек отмечены на кривой: черный без подробностей, что представляет минимальную плотность отрицательного числа; черный с подробностями; Ссылка на среднюю серую карту; белый с подробностями; и белый без подробностей. Обратите внимание, что между черным пространством нет сведений (что представляет черный цвет) и черного с подробностями (затемнение черного цвета). Аналогичным образом между белыми и подробными сведениями (а также белыми) имеется пробел.

![Схема, показывающая кривую H и D для слайдовой пленки.](images/gmmp-image079.png)

**Рисунок 18** . H&ная кривая для слайдовой пленки

Видеоотрасль предоставляет "запас" и "футрум" в образах. В спецификации ITU 709 светимость (с именем Y) кодируется в 8 бит с диапазоном от 0 до 255. Однако ссылка Black кодируется на 15, а ссылка белого кодируется как 235. Это оставляет диапазон кодирования между 236 и 255 для представления отраженных светов.

Видеоотрасль представляет собой по сути замкнутую систему циклов. Хотя существует множество различных поставщиков оборудования, видеосистемы основаны на ссылочных устройствах. Для видеороликов предусмотрена стандартная кодировка. Нет необходимости связывать границы цветового охвата с изображениями видео, так как все изображения кодируются для воспроизведения на одном и том же устройстве. Пленка также является замкнутым циклом, так как нет необходимости передавать промежуточные данные между различными компонентами. Требуется решение, которое позволяет изображениям с устройств с разными охватами и представить как предварительно визуализированные, так и необработанные сцены, которые будут воспроизведены на выходе с различными охватами.

Четвертая проблема, которую должно решить новое ОТВ, заключается в том, что визуально серые цвета, создаваемые устройством, например, когда красный = зеленый = синий на мониторе, часто не попадают на нейтральную ось (если чрома = 0,0). Это вызывает значительные трудности для Гмас. Чтобы сделать Гмас хорошо работать, необходимо скорректировать описание цветового охвата устройства и точек входа, чтобы нейтральная ось устройства настроилась на нейтральную ось пространства внешнего вида. Необходимо скорректировать точки с нейтральной оси на одинаковую величину. В противном случае плавное увеличение изображения невозможно. После выхода из платформы GMA вы отменяют это сопоставление относительно нейтральной оси выходного устройства. Это называется выпрямлением оси «чиропрактик». Как и в случае с Чиропрактор, вы не только выравниваете скелет (нейтральную ось), но настраиваете остальную часть текста для перемещения вместе с скелетом. Как и в случае с Чиропрактор, вы не корректируете скелет с учетом того же объема, что и все пространство. Вместо этого вы настраиваете разные разделы по-разному.

![Схема, показывающая кривизну нейтральной оси устройства относительно нейтральной оси ЦИЕКАМ.](images/gmmp-image081.png)

**Рис. 19.** Кривизна нейтральной оси устройства относительно нейтральной оси ЦИЕКАМ

Новое выражение CTE — это модель границы цветового охвата, которая может использоваться для представления как визуализированных, так и невизуализированных исходных изображений, предоставления сведений о внешнем интерфейсе устройства и предоставления сведений для изображений сопоставления тонов с широким диапазоном освещенности.

![Схема, на которой показаны три интерпретатора цветов.](images/gmmp-image083.png)

**Рис. 20** . три оболочек с охватом

Граница палитры состоит из трех оболочек, которые определяют три области.

В новом CTE-выражении внешняя оболочка в цветовой области формируется с помощью выпуклой поверхности, сделанного из образцов точек в области охвата устройства. Поверхности формируется с помощью набора образцов и окружающих их поверхностью. Выпуклой поверхности имеет дополнительное свойство выпуклой везде. Таким образом, это не самый маленький возможный поверхности, который можно вписать в данные. Однако эксперименты показывают, что подгонка точек выборки слишком тесно приводит к непривлекательным артефактам в изображениях, например отсутствию плавной заливки. Выпуклой поверхности, вероятно, решил эти проблемы.

В алгоритме значения цвета получаются для набора точек, взятых с устройства. Для мониторов и принтеров значения цвета получаются путем вывода образцов и последующего их измерения. Можно также создать модель устройства, а затем выполнить искусственные данные с помощью модели устройства для прогнозирования измеряемых значений. Затем измеряемые значения преобразуются из скрытого пространства (XYZ) в область отображения (Jab), а поверхности — вокруг точек.

Ключевым моментом этого алгоритма является то, что принятая белая точка, используемая при преобразовании от + + до пространства внешнего вида, не должна быть белой точкой средней точки. Вместо этого можно выбрать точку в пределах области, а также на нейтральной оси (или почти). После этого точка будет иметь значение J-100. Выборки с измеряемым значением Y, превышающим принятые белые точки, будут заканчиваться значением J-value больше 100.

Если поместить белую точку рассеяния сцены в качестве принятой белой точки для преобразования цветового пространства, то отраженные блики в сцене будут легко определяться как имеющие значение J-value больше 100.

Так как цветовая модель CIECAM02 основана на системе человеческого визуальных элементов, после выбора принятого белого уровень яркости черной точки (J = 0) определяется моделью автоматически. Если входной образ имеет широкий динамический диапазон, возможно, имеются значения, сопоставленные со значениями J, меньшими нуля.

На следующем рисунке 21 показаны нейтральные устройства, выполняемые через центр правдоподобные и эталонных цветов.

![Схема, на которой показана Нейтральная ось устройства, добавленная в границы палитры.](images/gmmp-image085.png)

**Рис. 21** . Добавление нейтральной оси устройства в границу палитры

Все сопоставления цветовой гаммы обрезают входной диапазон до выходного диапазона или сжимают входной охват для размещения в пределах выходного диапазона. Более сложные алгоритмы формируются путем сжатия и обрезки в разных направлениях или путем деления цветового охвата на разные регионы, а затем для выполнения обрезки или сжатия в разных регионах.

Новое ОТВ расширяет эту концепцию для поддержки регионов возможного цветового охвата, правдоподобныего и эталонного региона, а также позволяет Гмас сопоставлять их различными способами. Кроме того, у Гмас есть сведения о независимой оси устройства. В следующем обсуждении рассматривается работа с ситуациями, когда правдоподобныеные и эталонные охваты свернуты друг над другом.

![Схема, показывающая G M A с двумя несвернутыми дескрипторами цветовой гаммы.](images/gmmp-image091.png)

**Рис. 22** . GMA с двумя несвернутыми дескрипторами цветового охвата

Этот пример можно увидеть, если вы сопоставляется с устройством ввода, например с камерой или сканером, которое характеризуется отражающим целевым объектом, до пространства scRGB. Здесь цвета правдоподобные, которые светлее ссылки на белый, являются отраженными. На практике характеризующие камера с целевым объектом может не создать полный диапазон значений, возможных на камере. Однако отраженные блики и очень яркие цвета будут обнаружены в природе. (Для передаваемой цели обычно используется исправление, которое является минимальной допустимой плотностью на носителе. При использовании такого целевого объекта отраженные блики будут находиться в пределах целевого диапазона.) Ссылка черного для отраженного целевого объекта будет начинаться с темной черной области. То есть, скорее всего, в тенях цвета темнее, чем черный на целевом объекте. Если изображение содержит много интересного содержимого в этом регионе, может быть целесообразно сохранить этот вариант тона.

![Схема, показывающая G M а с свернутым целевым диапазоном.](images/gmmp-image095.png)

**Рисунок 23** . цвет GMA с свернутым целевым диапазоном

На рис. 23 показан один из возможных алгоритмов сопоставления цветового охвата, когда целевой цветовой охват предоставляет диапазон от белого устройства к черному, и нет возможных цветов вне этого диапазона. Это может быть вызвано обычными устройствами вывода, такими как принтеры. Возможные цвета сопоставлены с границей целевого диапазона. Но у него отсутствует кривая тона для выходного устройства. GMA должен выбрать независимую точку низкого уровня освещенности для использования в качестве назначения для ссылки на белый. Для этого можно воспользоваться сложным алгоритмом, хистограмминг лигхтнессес в исходном изображении и увидеть, сколько попадают в диапазон ожидаемого, но более светлого, чем пустая ссылка. Чем больше лигхтнессес, тем больше места требуется на целевом устройстве между сопоставленными точками отраженных светов и ссылки белого. Более простой алгоритм может выбрать произвольное расстояние вниз от белого устройства, например 5 процентов. Аналогичный подход применяется к сопоставлению максимального черного и темного черного.

После создания кривой тонов назначения можно сопоставлять в методе, аналогичном тому, который использовался на предыдущем рис. 23. Все точки в кривой тонов назначения попадают в цветовую гамму устройства, и все точки в сопоставлении должны попадать в цветовой охват устройства.

Если вы меняете значения слева и справа, а также направления стрелок на рис. 23, можно описать случай, когда исходное изображение имеет только эталонный охват, а три цветовых элемента устройства вывода не свернуты друг с другом. Например, можно сопоставить монитор с scRGB. И опять же, он должен создать элементы управления для пяти точек на кривой тона для исходного изображения. Некоторые сопоставления могут содержать все точки кривой тона в пределах области охвата устройства scRGB, в то время как другие сопоставления могут использовать больше цветового охвата scRGB путем сопоставления рассеянного белого со ссылкой белого и допустить отражение белого для сопоставления с более светлым значением.

Наконец, существует ситуация, когда оба устройства имеют только эталонный охват, то есть как работают все алгоритмы сопоставления палитры. Это можно разрешить, просто вернувшись к текущим алгоритмам. Кроме того, если имеется разумный способ определения пяти опорных точек для исходных и целевых устройств, то можно выполнить упорядочивание для соответствия опорных точек.

В палитрах устройств содержится более пяти опорных точек на нейтральной оси. Они просто представляют границы между потенциальными регионами в изображении. Между каждой контрольной точкой можно использовать любой из существующих методов сопоставления палитры. Таким образом, можно обрезать диапазон непредвиденных цветов и сжимать все цвета между предполагаемым белым и черным элементами или вырезать все цвета за пределами диапазона ссылок и сжимать их в пределах этого диапазона. Существует множество возможностей, которые могут быть реализованы в разных Гмас. Кроме того, Гмас может сжимать и обрезать различные способы. Все эти сочетания описаны в этом Invention.

До сих пор в этом обсуждении цветовой охват считался только функцией устройства, на котором было создано, записано или отображено изображение. Однако нет причин того, что все изображения на устройстве должны иметь один и тот же цветовой охват. Гмас зависит от данных в ГБД. Если дескриптор изменяется между изображениями, Гмас не может быть осведомлена о них. В частности, если изображения не имеют отраженных светов, Гмас работает лучше, если дескриптор цветового охвата не показывает, что цвета светлее рассеянного белого.

В новой архитектуре CTE можно использовать более одной GMA. Использование нескольких Гмас по своей природе неверно определено. Например, если устройство записи связывает элемент GMA с его "внешним видом", он, как правило, имеет целевой цветовой охват. То же самое касается и выходных устройств, и «целевых» исходных диапазонов. Цветовой охват sRGB — это один из наиболее часто нацеленных подразумеваемых цветов. Поэтому настоятельно рекомендуется использовать один элемент GMA, если предсказуемость является приоритетной. Один рабочий процесс GMA должен быть значением по умолчанию для всех рабочих процессов, особенно потребительских и профпотребителя рабочих процессов. Хотя сопоставление цветового охвата для предпочтительного воспроизведения должно выполняться один раз, существуют экземпляры, в которых включены несколько процессов сопоставления. Во-первых, для подтверждения, вы выполняете предварительное сопоставление с цветовым охватом конечного целевого устройства, а затем передаете цветовую гамму устройства для подтверждения. Во-вторых, некоторые типы сопоставления используются для изменения характеристик изображения, но не включаются для сопоставления с палитрой устройства, например для регулировки кривой тона или цветовой характеристики. Если используется несколько Гмас, интерфейс преобразования принимает массив привязанных сопоставлений цветов, т. е. сопоставлений палитры, которые были инициализированы парой описаний границ палитры. При наличии нескольких сопоставлений цветовой гаммы граница входного диапазона для успешности сопоставленного диапазона должна совпадать с границей выходного диапазона для его предшественника.

Функция границы цветовой гаммы устройства принимает модуль модели устройства и аналитические параметры и извлекает цветовую границу палитры устройства, описанную в виде упорядоченного списка вершин выпуклой поверхности в области охвата устройства. Упорядоченный список вершин хранится в Циежаб. Структура упорядоченного списка вершин оптимизирована для аппаратного ускорения с помощью DirectX. Этот подход имеет множество хорошо известных решений (ищите «выпуклой поверхности DirectX» в Интернете и вы получаете более 100 попаданий). Кроме того, в этой статье содержится ссылка на 1983 по этой теме (компьютерные и видеоподсистемы и приложения, "Шифуллс, b-сплайновые поверхности и кадкам" PP. 34-49) со ссылками датировано от 1970 до 1982 в разделе.

Для расчета треугольников в оболочке цветовой области можно использовать два разных метода. Для других устройств, кроме дополнительных устройств RGB, вы Вычислите выпуклой поверхности. Вы можете исследовать невыпуклойную поддержку поверхности для других устройств, если у вас есть прямой доступ к таким устройствам для проверки надежности, производительности и точности алгоритмов. Это хорошо известный процесс, который не требует дальнейшего описания. Метод, используемый для аддитивных устройств RGB, описан ниже.

Разные Гбдс имеют свои преимущества и недостатки. Представление выпуклой поверхности гарантирует привлекательные геометрические свойства, такие как выпуклой срезы оттенков, которые обеспечивают уникальную точку пересечения с лучом оптимизации от точки на нейтральной оси. Недостатком представления выпуклой поверхности является также конвексити. Известно, что многие устройства, в частности, отображают устройства, имеют охваты, которые далеко не выпуклой. Если фактический охват сильно отличается от предположения конвексити, представление поверхности выпуклой будет неточным, возможно, в том, что он не представляет реальность.

После внедрения ГБД, который дает достаточно точное представление о фактическом охвате, возникают другие проблемы, некоторые из-за очень концепции среза оттенка. Существует по крайней мере две патология ситуации. На следующем рис. 24 цветовой охват CRT выдает срезы с «островами». На рис. 25 цветовой охват выводится на срез оттенка, а часть нейтральной оси отсутствует. В таких случаях срезы патология оттенок не вызываются особенно патологияными границами. Они вызваны очень концепцией среза «оттенок», так как (а) он принимается вместе с постоянным оттенком и (б) он занимает одну половину плоскости, которая соответствует значению угла оттенка.

![Схема, на которой показано верхнее представление и боковое представление "изгиб в" синих оттенков.](images/gmmp-image097.jpg)

**Рис. 24** . ТИПИЧный ЭЛТ-монитор имеет цветовой охват, который показывает довольно необычная «изгиб» в синих тона. Если в пределах этого диапазона оттенок помещаются срезы оттенка, то изолированные острова могут отображаться на срезах оттенка.

![Схема цветового охвата с пропуском в нейтральной оси.](images/gmmp-image099.jpg)

**Рис. 25** . принтер может иметь цветовой охват, имеющий "зазор" в нейтральной оси. При создании среза оттенок (который состоит только из одной половины плоскости) в части границы, которая является нейтральной, добавляется "выступ". Это может быть трудно устранить алгоритмически.

Чтобы устранить эти пасологиес, предлагается новая платформа, которая отменяет концепцию среза оттенка, который используется в качестве начальной точки. Вместо этого платформа использует набор "элементы линии границы" или линии, которые находятся на границе цветового охвата. Они не обязательно обеспечивают согласованную геометрическую визуализацию, например срезы оттенков, но поддерживают все общие операции с охватом. Помимо решения проблем, упомянутых выше, этот подход также предполагает, что создание срезов оттенков, даже если это возможно, является вычислительно непроизводительна.

### <a name="triangulation-of-the-gamut-boundary"></a>Триангуляция границы цветового охвата

Начальная точка — это ГБД, состоящий из триангуляции границы цветовой области. Известные методы создания Гбдс обычно обеспечивают эту триангуляцию. В частности, один из способов создания Гбдс для добавочных устройств описывается здесь. К этим устройствам относятся мониторы (на основе CRT и ЖК) и проекторы. Простая геометрия Куба позволяет ввести обычный Lattice в Кубе. Границы куба могут быть триангуляции в несколько приемов, например показанные на рис. 26. Архитектура предоставляет модель устройства для устройства, чтобы можно было получить значение, равное Lattice точкам алгоритмически, или измерения были сделаны непосредственно для этих точек. Архитектура также предоставляет CIECAM02, чтобы можно было предположить, что начальные данные уже были сопоставлены с CIECAM02 Jab пространством. Затем каждая точка Lattice на границах Куба RGB имеет соответствующую точку в Jab пространстве. Соединения точек, образующих набор треугольников в пространстве RGB, также применяют набор треугольников в Jab пространстве. Этот набор треугольников образует разумное триангуляцию границы палитры, если (а) Lattice в Кубе RGB достаточно, и (б) преобразование из пространства устройства в равномерное цветовое пространство топологически правильно. то есть он сопоставляет границу с границей и не перемещает охват внутрь, чтобы внутренние точки стали точками границ.

![Схема, на которой показан простой метод для трианглуате границы цветового охвата устройства с R G B в качестве пространства устройства.](images/gmmp-image100.png)

**Рис. 26** . простой способ триангуляции границы цветового охвата устройства с RGB в качестве пространства устройства

### <a name="boundary-line-elements"></a>Элементы линии границ

Центральным по отношению к этой платформе является концепция элементов границ линий; набор линейных сегментов, которые (a) находятся на границе цветового охвата, а (б) находится на плоскости. В этом случае плоскость является плоскостью оттенок. Каждый сегмент линии является результатом пересечения плоскости с треугольником границы цветовой гаммы. Хотя многие исследователи использовали конструкцию пересечения плоскости с границами треугольников, они обычно анализируют связь между этими сегментами линии и пытаются создать согласованный геометрический объект за пределами линейных сегментов. Разрабатываются разные алгоритмы, чтобы следовать этим сегментам строки один за другим, пока не будет получен весь срез оттенка, и для ускорения процесса поиска были сделаны многие попытки.

Этот подход отличается. Вы пересекаете плоскость с треугольниками для получения сегментов линии. Затем эти линейные сегменты следует рассматривать как *основные* концептуальные объекты. Необходимо проанализировать связь между сегментами линии; Вам не нужно уметь связываться друг с другом. Эта точка зрения решает проблему среза оттенок с островами. Известные подходы, которые попытаются создать срез оттенка, предполагают, что, если один из них начинается с одного сегмента линии и находится за ним в следующем сегменте строки и т. д. в итоге он вернется к начальной точке, после чего будет создан весь срез оттенка. К сожалению, этот подход будет пропускать остров (а в худшем случае — континент). Не настаивает на получении четкого геометрического изображения; Это значит, что можно легко справиться с проблемой острова. Еще одно важное различие в этом подходе заключается в том, что для ускорения построения сегментов линии используется «треугольный фильтр». Фильтр треугольника выдает определенные треугольники, которые в определенном случае не создают сегменты линии, которые могут быть полезны в текущей операции цветового охвата. Поскольку пересечение треугольника с плоскостью требует дорогостоящих вычислений, это повышает скорость. Побочным действием является то, что нельзя создать срез оттенок, так как некоторые сегменты линии будут отсутствовать из-за фильтрации по треугольнику.

### <a name="gamut-operation-checkgamut"></a>Операция с охватом: Чеккгамут

В следующем примере объясняется, как работает платформа, и как выполняется Чеккгамут, т. е. операция проверки того, находится ли цвет в цветовом охвате.

Общая инфраструктура показана на следующем рисунке 27. Существуют различные компоненты. Компоненты, отмеченные курсивом, — это компоненты, которые могут различаться в реализации в зависимости от рассматриваемой операции с охватом. Другие компоненты являются инвариантными для всех операций с охватом. Для начала ***входными данными*** является набор атрибутов цвета. В случае с Чеккгамут это цвет запроса. На рис. 27 и следующем обсуждении предполагается, что угол оттенка является либо из атрибутов цветового ввода, либо из них. Это очевидно, если входные данные являются всей цветовой точкой в Jab или ЖЧ, из которой можно вычислить угол оттенка. Обратите внимание, что угол оттенка необходим только в том случае, если используются плоскости оттенков. В зависимости от заданной операции с охватом, возможно, не потребуется использовать плоскость оттенок. Например, при создании подпрограммы Чеккгамут может потребоваться использовать плоскости с константой J. Это общая возможность, которая не будет использоваться или обсуждаться дальше; но может быть полезно помнить об этой гибкости методологии для поддержки других операций с охватом, когда плоскость оттенков может быть не лучшим выбором.

![Схема, показывающая последовательность для поддержки операций с охватом.](images/gmmp-image112.jpg)

**Рис. 27** . платформа для поддержки операций с охватом

Угол оттенка, полученный непосредственно из входных данных или вычисленных на основе входных данных, используется для инициализации плоскости оттенков, помеченной как **полная плоскость оттенков** на рисунке. «Full» выделена, так как это полная плоскость, а не только половина плоскости, содержащей оттенок. Полная плоскость содержит как угол оттенок ввода, так и угол 180 градусов в противоположном направлении. Ключевыми функциями плоскости оттенка является функция INTERSECT, которая описывается в следующем подразделе «полная плоскость оттенка»: «Intersect». Предположим, что ГБД уже был создан и доступен набор **треугольников границ цветовой** области. Пересекает треугольники, которые были несохранившикой **_треугольника_* _ с плоскостью оттенок с помощью Intersect. _Компонент «фильтр треугольников» отмечен курсивом, что означает, что компонент различается в реализации для различных операций с охватом. *Фильтр треугольника* для чеккгамут объясняется в разделе операция с охватом: чеккгамут (продолжение). Результат пересечения треугольника с плоскостью оттенка пуст или является **элементом границы линии** , то есть парой уникальных точек. Если результат не пуст, он передается в *_обработчик элемента строки_* *_ , который опять же выполняет различные действия в зависимости от операции с охватом. _Процессор элемента строки * обновляет внутреннюю структуру данных ***внутренние обработанные данные**_ , содержимое или макет которых также зависит от операции выбора цвета. Как правило, _внутренние обработанные данные * содержат ответ на проблему, который постоянно обновляется при обнаружении каждого нового элемента границы линии. После обработки всех элементов границ линии ответ был найден. Он продолжает обращаться к нему через **адаптер вывода***_. Так как _Internal обработанные данные * являются специфическими для операций с охватом, *выходной адаптер* также будет зависят от операций с цветовой палитрой.

### <a name="full-hue-plane-intersect"></a>Плоскость полного оттенка: Intersect

Функция Intersect вычисляет пересечение плоскости оттенок и треугольника. По мере того, как это звучит, эта функция важна по двум причинам.

Во-первых, пересечение каждого края треугольника с плоскостью может привести к порядку трех точек пересечения — геопоказательно невозможность. Причина, по которой это может произойти в вычислениях, заключается в том, что при выполнении вычислений в плавающей точке, например в формате IEEE, унцертаинтиес или «числовой шум» на каждом шаге влияет на то, пересекаются ли границы плоскости. Когда плоскость пересекает края в ближайшем к промаху ситуации, точки пересечения близки друг к другу, а определение того, находится ли точка пересечения в границах, является случайным. Несмотря на то, что шум в числовых значениях точек невелик, качественное заключение, что существует более двух точек пересечения, является геометрически невозможным и сложно правильно обработано в алгоритме.

Во-вторых, эта функция находится в критическом цикле для каждого края каждого отфильтрованного треугольника, поэтому важно оптимизировать его эффективность как можно больше.

Чтобы устранить первую выдачу числового шума, выполните вычисления в целых числах. Для устранения второй проблемы, связанной с оптимизацией своей эффективности, следует кэшировать наиболее часто используемый атрибут каждой вершины или "элемент" марка ", связанный с каждой вершиной. Передача в целые числа — типичный способ гарантировать геометрическую согласованность. Основная идея заключается в том, что если вам нужно квантуем, сделайте это в начале. Затем последующие вычисления могут выполняться в целых числах, а если целые числа достаточно широкие, чтобы избежать переполнения, вычисления можно выполнять с бесконечной точностью. Для этой цели полезна Следующая функция дискретизация.

Скалеандтрункате (x) = целая часть x \* 10000

Коэффициент масштабирования 10000 означает, что входное число с плавающей запятой имеет четыре десятичных знака, что достаточно точно для этого приложения. В зависимости от диапазона значений области отображения цвета необходимо выбрать целочисленный тип с битовым пространством, достаточным для хранения промежуточных вычислений. В большинстве пространств цветового представления диапазон каждой координаты находится в диапазоне от-1 000 до 1 000. Координата квантования имеет максимально возможное абсолютное значение 1 000 \* 10 000 = 10 000 000. Как вы увидите, промежуточное количество представляет собой точку, которая является суммой двух продуктов координат, поэтому она имеет максимально возможное абсолютное значение 2 \* (10 000 000) ₂ = 2? 10 ₁ ₄. Требуемое число битов — log ₂ (2? 10 ₁ ₄) = 47,51. Очень удобно выбрать целочисленный тип, поэтому 64-разрядные целые числа.

Чтобы гарантировать, что при пересечении плоскости с треугольником всегда предоставляется пустой набор или набор из двух точек, необходимо рассматривать треугольник как целый, а не как отдельные края треугольника отдельно. Чтобы разобраться в геометрической ситуации, рассмотрим «расстояния со знаком» вершин треугольника из плоскости «оттенок». Не вычислить эти расстояния со знаком напрямую; Вместо этого Вычислите пунктирные произведения векторов позиций вершин с квантованияным вектором нормали к плоскости. В частности, при инициализации плоскости оттенков квантованияный вектор нормали вычисляется следующим образом.

Нормалвектор = (Скалеандтрункате (-sin (тон)), Скалеандтрункате (cos (оттенок)))

Обратите внимание, что этот вектор является двумерным вектором. Можно использовать двухмерный вектор, поскольку плоскость оттенок является вертикальной, поэтому третий компонент обычного вектора всегда равен нулю. Более того, таблица уточняющих запросов с точками инициализируется таким образом, чтобы иметь запись для каждой вершины из треугольников границы цветовой гаммы, а соответствующий продукт с точкой имеет недопустимое значение.

Во время одной операции пересечения плоскости оттенка с треугольником выполняется поиск точки на каждой вершине треугольника. Если значение в таблице уточняющих запросов является недопустимым, то произведение точки будет вычислено с помощью следующего выражения.

Нормалвектор. \* скалеандтрункате (вершина a) + нормалвектор. b \* скалеандтрункате (вершина. b)

Опять же, компонент J-Component вершины никогда не используется, так как стандартный вектор является горизонтальным. После этого эта точка будет сохранена в таблице уточняющих запросов, чтобы ее не нужно было вычислить снова при запросе точки на вершине.

Кэширование позволяет быстро определить, пересекаются ли границы плоскости, после того, как в таблице уточняющих запросов будут отображаться пограничные продукты с точками, которые создаются последовательно по мере обработки вершин.

![Схема, на которой показана пересечение плоскости оттенок с треугольником.](images/gmmp-image114.jpg)

**Рис. 28** . пересечение плоскости оттенок с треугольником

Для треугольника на рисунке 28, пересекающего плоскость оттенка в сегменте вырожденной линии, при сортировке в возрастающем порядке должны находиться точки в одном из следующих шаблонов.

0, 0, +; -, 0, 0; -, 0, +; -,-,+; -,+,+

Конечная точка сегмента линии возникает, когда плоскость пересекается с вершинами с разными знаками в составе произведения с точкой. Если знак равен нулю, вершина находится непосредственно на плоскости, а пересечение границы с плоскостью является самой вершиной. Обратите внимание, что в случаях 0, 0, 0; -,-, 0; 0, +, + не отображаются. Первый случай (0, 0, 0) означает, что весь треугольник находится на плоскости. Это не сообщается, так как каждая граница треугольника должна относиться к соседнему треугольнику, который также не попадает на плоскость полностью. При рассмотрении этого треугольника появится сообщение о границе. Два других варианта (-,-, 0 и 0, +, +) соответствуют геометрической конфигурации, которую треугольник касается плоскости в одной вершине. Эти случаи не передаются, так как они не приводят к появлению вырожденного сегмента линии.

Предыдущий алгоритм определяет, когда следует вычислить пересечение между границей треугольника и плоскостью оттенка. После определения границы пересечение вычисляется с помощью параметрической формулы. Если один из таких продуктов имеет нулевое значение, то пересечением является сама вершина, поэтому вычисление не требуется. Предполагая, что обе точки в обеих вершинах ребра не равны нулю, vertex1 является вершиной с *отрицательной* точкой dotProduct1а продукта; и VERTEX2 — это вершина с *положительной* точкой dotProduct2. Этот порядок важен для того, чтобы вычисляемая точка пересечения не зависела от того, как упорядочение вершин отображается в представлении границы. Геометрическое понятие границы является симметричным по отношению к его вершинам. Вычислительный аспект использования параметрической формулы в пограничных элементах представляет асимметрию (Выбор начальной вершины), что может привести к слегка отличающимся точкам пересечения из-за числового шума и условий линейных уравнений, которые должны быть решены. В этом случае точка пересечения, пересечение, задается следующим образом.

t = dotProduct1/(dotProduct1-dotProduct2)

крайне. J = vertex1. J + t \* (VERTEX2. J-vertex1. Б

пересечение. a = vertex1. a + t \* (VERTEX2. a-vertex1. a)

пересечение. b = vertex1. b + t \* (VERTEX2. b-vertex1. b)

### <a name="gamut-operation-checkgamut-continued"></a>Операция с охватом: Чеккгамут (продолжение)

Базовый геометрический алгоритм, используемый для проверки цветовой гаммы, заключается в подсчете числа пересечений лучей. Для данной точки запроса рассмотрим луч, начинающийся с точки запроса и направленный вверх (направление J-Direction). Подсчитайте, сколько раз этот луч пересекает границу цветового охвата. Если это число четное, то точка запроса находится вне области охвата. Если это число нечетное, то точка находится внутри. В принципе, этот алгоритм может быть реализован в трехмерном виде, он обычно сталкивались с трудностями, вызванными вырожденными ситуациями, например с лучом (частично) на границе треугольника, или с меньшим измерением деженераци, например лучом (частично) на границе граничного треугольника. Даже в 2-D, вам придется обходиться с использованием таких ситуаций. но эта проблема проще и была устранена удовлетворительным образом. См \[ \] . о'раурке.

Для заданной входной точки Jab определите его угол оттенок h, как показано ниже.

h = ATAN (b/a),

Инициализируйте плоскость оттенок, а затем определите элементы границ линии, соответствующие этой плоскости оттенков. Так как элементы линии границ связаны только в том случае, если они пересекаются вверх вверх, настройте фильтр треугольника для удаления треугольников, которые предоставляют элементам линии, которые определенно не пересекаются вверх, вверх. В этом случае рассмотрите ограничивающий прямоугольник треугольника. Покрывающий луч не пересекается с треугольником, если точка запроса находится за пределами "теневого" с помощью ограничивающего прямоугольника, если источник освещения был непосредственно выше. Это немного с предварительно фиксированной допускной подготовкой для цифрового шума, чтобы случайно не создавать треугольники, которые могут дать полезные элементы линии. Результатом является прямоугольный цилиндр с частичным бесконечностью, показанный на рис. 29. Проверка того, находится ли точка запроса внутри или снаружи этого цилиндра, может быть эффективно реализована с помощью простых неравенства.

![Показывает фильтр треугольника для Чеккгамут.](images/gmmp-image116.jpg)

**Рис. 29** . фильтр треугольника для чеккгамут

Чеккгамут имеет три отдельных компонента для операций с охватом: *внутренние обработанные данные*,*обработчик элементов линии* и *выходной адаптер*. *Внутренние обработанные данные* — это список элементов Line, обработанных *обработчиком элементов линии*. В этом случае *обработчик элементов линии* просто добавляет в список элемент Line. Внутренней структурой данных для *внутренних обработанных данных* может быть либо связанный список, либо массив, размер которого может увеличиваться.

*Выходной адаптер* — это модуль, который обращается к списку элементов Line, определяет, пересекаются ли элементы строки вверх вверх (число 1) или нет (число 0). Суммирование всех этих счетчиков дает общее количество. *Выходной адаптер* в конечном итоге выводит ответ "Да" (в палитре) или "нет" (вне зависимости от того, является ли общий счетчик нечетным или четным). Шаг, на котором определяется, является ли элемент линии пересечением вверх вверх, заслуживает некоторого внимания, поскольку именно здесь возникает проблема деженераци, а также проблема пересчета. После \[ о'раурке \] для элемента Line, пересекающего луч, правая конечная точка (конечная точка с большим чрома) должна быть строго расположена в правой части луча. Это гарантирует, что, если конечная точка когда-либо полагается на луч, она будет считаться только один раз. Это же правило позволяет устранить ситуацию, когда элемент Line находится в точности на луч. Значение счетчика для этого элемента строки не увеличивается.

На рис. 30 показаны результирующие элементы строки образца охвата с точкой запроса в различных позициях.

![Схема, показывающая результирующие элементы в примере цветового охвата с точкой запроса в различных позициях.](images/gmmp-image118.jpg)

**Рис. 30** . принцип работы чеккгамут

### <a name="minimum-color-difference-gamut-mapping"></a>Сопоставление палитры минимальных цветовых различий

Минимальное соответствие цветовой гаммы в сопоставлении палитры Миндемап имеет простую спецификацию: Если цвет находится в-охвате, ничего делать не нужно. Если цвет выходит за пределы цветового охвата, выведите его в "ближайшую" точку на границе цветового охвата. Ключевое слово "ближайшего" не определено четко, пока вы не укажете, какое уравнение различия цветов будет использоваться. На практике, чтобы упростить и ускорить вычисления, евклидово расстояние выбранного пространства отображения цвета или его разновидность используется в качестве метрики цветовой разницы. Преимуществом метрики евклидово является то, что он совместим с точкой произведения пространства, что позволяет использовать линейную перерезку. В частности, если в пространстве определено ««марка», то расстояние может быть определено как квадратный корень от скалярного произведения вектора разницы с самим собой. Как правило, в качестве точки может быть определена положительная матрица 3x3 A.

u? v = u <sub>T</sub> AV

где правая часть — это обычное умножение матрицы. Если A является матрицей идентификаторов, то восстанавливается стандартная точка. На практике, если Jab является цветовым пространством, вы не хотите смешивать компоненты, поэтому можно использовать диагональную матрицу, отличную от матрицы идентификации. Кроме того, может потребоваться сохранить масштаб на и b без изменений, чтобы была сохранена мера оттенка. Поэтому полезным вариантом стандартного продукта евклидово Dot является следующее.

w <sub>j</sub> (j-мой компонент) (j component of v) + (компонент для вас) (компонент v) + (b компонента v)

где w <sub>J</sub> — положительное число. Еще один вариант — Разрешить w <sub>J</sub> зависеть от входной точки запроса:

w <sub>j \ =</sub> w <sub>j</sub> (куерипоинт)

Конечный результат представляет собой меру расстояния, которое асимметрично по отношению к двум точкам, с различными относительными весовыми коэффициентами освещения, чрома или оттенками, когда точка входного запроса изменяется. Это в соответствии с некоторыми наблюдениями, связанными с человеческими цветами, в которых различия цветов не имеют одинаковых весов во всех измерениях. Было обнаружено, что люди менее чувствительны к различиям в освещенности, чем различия в оттенокх и чрома.

Следующая функция веса полезна.

w <sub>J</sub> = k ₂-k ₁ (C-C m ₐ ₓ) n

где k ₂ = 1, k ₁ = 0,75/(C m ₐ ₓ) n, C m ₐ ₓ = 100, n = 2 и C — это меньшее из чрома в точке запроса и C m ₐ ₓ.

так что вес 0,25 помещается в термине J, когда чрома равен нулю, и вес 1, если чрома — 100. Тенденция размещения меньшего веса в J, когда чрома невелика, и более вес на J, если чрома является большим, соответствует рекомендуемому использованию для CMC и CIEDE2000.

![Граф, демонстрирующий функцию веса для компонента J метрики.](images/gmmp-image119.png)

**Рис. 31** . функция Weight для компонента J метрики

Используйте Jab пространство в следующем примере. Для определения ближайшей точки в метрике евклидово требуется поиск по всем граничным треугольникам. Ниже приведен простой подход к максимально эффективному использованию этого процесса без введения дополнительных предположений, которые могут ускорить процесс, но также можно получить лишь приблизительный ответ. Во-первых, необходимо понимать геометрическую процедуру проецирования точки на заданный треугольник. Здесь дается описание.

Сначала выполняется ортогональная проекция на бесконечную плоскость, содержащую треугольник. Кратчайшее расстояние точки запроса от плоскости можно определить в двух шагах.

**(a)** вычисление вектора обычной единицы к треугольнику.

**(б)** Рассчитайте скалярное произведение вектора базовой единицы и вектор, сформированный из точки запроса, и точку на треугольнике; то есть один из его вершин. Так как у обычного вектора есть длина единицы, абсолютное значение этого произведения точки — это расстояние точки запроса от плоскости.

Предполагаемая точка может не быть ответом, так как она может находиться за пределами треугольника. Поэтому сначала необходимо выполнить проверку. Вычисление эквивалентно вычислению координат барицентрик в проектируемой точке относительно треугольника. Если предполагаемая точка определена в пределах треугольника, это ответ. Если нет, то ближайшая точка запрашивается на одном из краев треугольника. Выполните поиск по каждому из трех краев. Определение проекции точки запроса на границе — это процесс, схожий с проекцией на треугольник, но с одним измерением меньше. Сначала вычисляется ортогональная проекция. Если предполагаемая точка находится на границе, это ответ. Если нет, то ближайшая точка запрашивается в одной из двух конечных точек. Выполните поиск по двум конечным точкам; то есть Вычислите расстояние от точки запроса до каждого из них и сравните, какой из них меньше.

Тщательный анализ показывает, что при прокрутке всех треугольников существует много повторяющихся результатов поиска, так как край всегда совместно используется двумя треугольниками, а вершина — по крайней мере на трех краях. Кроме того, вы не заинтересованы в поиске ближайших точек до одного конкретного треугольника. Вместо этого вы заинтересованы в поиске ближайшей точки для всей границы палитры. Однако одним из таких треугольников является тот, в котором это достигается. Существует две стратегии, которые можно использовать для ускорения поиска.

**Стратегия I**. Каждая вершина будет обрабатываться не чаще одного раза. Каждый ребр будет обрабатываться не чаще одного раза.

**Стратегия II**. В любой точке поиска вы получите лучший кандидат с соответствующим лучшим расстоянием. Если вы можете определить, по быстрой проверке, что треугольник не способен добиться лучшего расстояния, больше не нужно продолжать вычисление. Для этого треугольника не требуется ближайшая точка и расстояние.

![Схема, показывающая последовательность минимального сопоставления.](images/gmmp-image120.png)

**Рис. 32** . минимальное число сопоставлений схем

На рисунке 32 показан общий поток логики для Миндемапа карт цветов. Для точки запроса сначала вызывается функция Чеккгамут. Если точка находится в цветном охвате, то Map является оператором No-Op. Если точка находится вне области охвата, вызовите Прожектпоинттобаундари. Теперь перейдите на рис. 33. На этом этапе предполагается, что были вычислены следующие значения.

**(a)** вектор базовой единицы для каждого треугольника границы цветовой гаммы по отношению к стандартному продукту с точкой.

**(б)** список вершин и список кромок в дополнение к списку треугольников.

![Схема, показывающая подпрограммы «Прожектпоинттобаундари».](images/gmmp-image122.jpg)

**Рис. 33** . подпрограммы прожектпоинттобаундари

Все это является постоянной нагрузкой и снижение затрат при наличии достаточного количества запросов к этой границе. Как правило, это происходит при создании преобразования LUT с одного устройства на другое, где имеется только два фиксированных цветовых охвата, а преобразование LUT выполняется через точки в сетке с одинаковой выборкой. Вы заранее Вычислите обычные векторы по отношению к стандартному продукту с точкой, даже если понятие перпендикулярности будет основано на продукте с взвешенной точкой, который зависит от точки запроса, как описано выше. Причина заключается в том, что обычный вектор по отношению к продукту с взвешенной точкой можно легко получить из обычного вектора относительно стандартного продукта с точкой. Если n ₀ является нормальным вектором по отношению к стандартному продукту с точкой, то

n = (J-компонент n ₀/w <sub>J</sub>, a – компонент n ₀, b-компонент n ₀)

является нормальным для треугольника по отношению к продукту с взвешенной точкой. Из-за этой связи все равно полезно предварительно вычислить n ₀, хотя он должен быть скорректирован на основе точки запроса.

Подпрограммы Прожектпоинттобаундари начинаются с сброса "обработанного журнала" вершин и ребер. Это таблицы ЛОГИЧЕСКИХ флагов, которые определяют, была ли посещена вершина или ребро. Он также сбрасывает переменную Шортестдистанце в значение "Infinity", которое является максимальным закодированным значением в используемой системе счисления с плавающей запятой. Затем он выполняется с помощью цикла, который ищет ближайшую точку каждого треугольника с помощью вызова Процесстриангле. Процесстриангле является подпрограммы для обновления переменной Шортестдистанце и явно находится в критическом цикле. Одна из оптимизаций — завершение, если результат достаточно хорош. После каждого вызова Процесстриангле проверяется переменная Шортестдистанце. Если он соответствует предопределенному пороговому значению, его можно отключить. Предопределенное пороговое значение зависит от используемого цветового пространства и от необходимой точности системы создания образов цветов. Для типичного приложения не нужно выполнять ненужную работу, если цветовая разница меньше, чем может быть определено человеческим зрением. Для CIECAM02 это цветовое отличие равно 1. Однако используйте пороговое значение 0,005 в реализации, чтобы сохранить точность вычислений, так как это может быть только промежуточный шаг в цепочке преобразований.

Процесстриангле реализует предыдущую стратегию II. Получение обычного вектора от вектора обычной предварительно вычисленного блока к треугольнику по отношению к стандартному продукту с точкой, он рассчитывает расстояние от точки запроса до бесконечной плоскости, содержащей треугольник, путем формирования точки произведения вектора нормали единицы и Куеривектор, вектора от одной из вершин треугольника, vertex1 к точке запроса. , Куерипоинт.

Куеривектор = Куерипоинт — vertex1

Distance = \| нормалвектор \* куеривектор \| / \| \| нормалвектор\|\|

Это относительно недорогое вычисление, и расстояние требуется для выполнения дальнейших вычислений. Если это расстояние не меньше текущего наилучшего расстояния, Шортестдистанце, этот треугольник не даст лучшего расстояния, так как он не будет больше расстояния, чем плоскость, содержащая ее. В этом случае вы возвращаете управление в цикле треугольника. Если расстояние меньше Шортестдистанце, возможно, у вас есть более близкая точка, если эта точка находится внутри треугольника. Чтобы определить это, необходимо выполнить некоторые "сложные" вычисления (но не все линейные). Если две другие вершины треугольника являются VERTEX2 и vertex3, то формируют основные векторы Фирстбасисвектор и Секондбасисвектор.

Фирстбасисвектор = VERTEX2 — vertex1

Секондбасисвектор = vertex3 — vertex1

Используйте следующую линейную систему уравнений для решения неизвестных задач и v.

Фирстбасисвектор \* куеривектор = (фирстбасисвектор \* фирстбасисвектор) u + (фирстбасисвектор \* secondBasisVector) v

Секондбасисвектор \* куеривектор = (секондбасисвектор \* фирстбасисвектор) u + (секондбасисвектор \* secondBasisVector) v

а условия для проецированной точки должны находиться внутри треугольника:

0 ≤ u ≤ 1, 0 ≤ v ≤ 1 и + v ≤ 1

Если после этого вычисления определяется, что предполагаемая точка находится внутри треугольника, значит, обнаружена новая ближайшая точка; расстояние, вычисленное в начале, является новым кратчайшим расстоянием. В этом случае обновите переменные Шортестдистанце и Клосестпоинт. Если предполагаемая точка находится за пределами треугольника, вы можете найти более близкую точку на одном из ее краев. Таким образом, можно вызвать подпрограммы Процесседже для каждого из трех краев.

![Схема, показывающая поток подпрограмм Процесседже и Процессвертекс.](images/gmmp-image124.jpg)

**Рис. 34** . подпрограммы Процесседже и процессвертекс

Подпрограммы Процесседже реализуют стратегию I, которая проиллюстрирована на рис. 34. Процесседже начинает с проверки того, был ли обработано ребро. Если это так, дальнейшие действия не предпринимаются. В противном случае он продолжает вычислять ортогональную проекцию точки запроса на бесконечную линию, содержащую ребро. Линейная переработка, участвующая в вычислении, аналогична предыдущей формуле треугольников. Однако вычисление проще, но не описывается здесь. Если предполагаемая точка находится внутри границы, вы увидите расстояние от предполагаемой точки до точки запроса. Если это расстояние меньше Шортестдистанце, вы нашли новую ближайшую точку. Обновите Шортестдистанце и Клосестпоинт. Если предполагаемая точка находится за пределами границы, вызовите Процессвертекс в двух конечных точках. Перед возвратом управления Обновите журнал пограничных элементов таким образом, чтобы он был помечен как ОБРАБОТАНный.

Наконец, вы получите описание Процессвертекс. Подпрограммы Прожектвертекс также реализуют стратегию I и поддерживает таблицу журнала вершин. Как показано на рисунке 34, сначала он проверяет, была ли ранее обработана вершина. Если это так, дальнейшие действия не предпринимаются. В противном случае он продолжает вычислять расстояние от вершины до точки запроса. Если расстояние меньше Шортестдистанце, обновите как Шортестдистанце, так и Клосестпоинт. В итоге он обновляет журнал вершин, чтобы эта вершина была помечена как ОБРАБОТАНная.

Если во внешнем цикле управления исчерпаны все треугольники или выходы до порогового значения цветовой разницы, доступ к переменной Клосестпоинт осуществляется. Это результат Миндемап. Вызывающий объект также может получить Шортестдистанце, если интересно, насколько сопоставленный цвет относится к цвету запроса.

### <a name="hue-smoothing"></a>Сглаживание оттенков

![Диаграмма, на которой показаны два верхних представления сглаживания оттенков, оригинал сверху и цветовой тон, сглаженный по нижнему краю.](images/gmmp-image125.png)

**Рисунок 35** . сглаживание оттенков

Возникла ошибка в операциях с ограниченным оттенком. то есть операция учитывает только переменные в пределах плоскости оттенок. На рис. 35 показан пример цветового охвата срезов «непрерывного» оттенков синего цвета. В пределах этого диапазона оттенков для определенных углов оттенка граница палитры отношения к плоскости оттенка. Фактически это приводит к изменению структуры топологическом срезов оттенков. В приведенном примере, когда плоскость оттенок выводится в пределах этого диапазона оттенков, выводятся «островки» и подобъединения. Это изменение топологии приведет к разрыву конкретных операций оттенка. Например, КУСП на фиксированном оттенке будет резко меняться, когда изменяется угол оттенок в этом диапазоне.

Существует причина, по которой предпочтительно сохранять оттенок при определенных операциях. Чтобы устранить описанную выше проблему, исходные треугольники границ цветовых диапазонов должны быть сглажены. Как правило, сглаживание оттенков набора треугольников границ цветовой палитры представляет собой набор треугольников, в котором (a) образуется граница нового "палитры", которая может не соответствовать реальному спектру устройств, и содержит цветовой охват, определенный исходным набором треугольников. и (б) треугольники в новом наборе связаны от параллельного к плоскости оттенков.

Одним из практических способов получения сглаженного набора треугольников является получение выпуклой поверхности из исходных вершин. Как показано на рисунке 35, срезы оттенок выпуклой поверхности в диапазоне оттенок проблем незначительно меняются, не внося внезапного изменения в топологию.

### <a name="setting-primaries-and-secondaries-in-the-gamut-boundary-description"></a>Настройка первичных и вторичных баз данных в описании границы цветового охвата

Некоторые методы сопоставления палитры, такие как Хуемап, зависят от расположения первичных и вторичных реплик устройства. Для аддитивных устройств первичным, зеленым и синим цветами являются "красный", "зеленый" и "синий" (R, G и B); а вторичные базы данных — голубой, пурпурный и желтый (C, M и Y). Для вычитания устройств первичный элемент — C, M и Y; а вторичные базы данных — R, G и B. ГБД отслеживает все шесть этих значений, плюс белые и черные (W и K) в массиве значений цвета Jab. Эти значения задаются в описании границы цветового охвата при их создании. Для устройств вывода первичные элементы можно определить, запустив сочетания значений элементов управления устройствами с помощью модели устройства. Для устройств записи этот подход плохо подходит для создания ссылочного ГБД, поскольку почти невозможно записать образ, который возвращает полностью насыщенное значение чистого устройства, например (0,0, 0,0, 1,0). Профили устройств WCS содержат индексы первичных элементов в целевом объекте захвата. Так как эти значения не содержатся в ICC-профиле, используйте значения, измеренные из типичного целевого объекта сканера, после преобразования в Jab, относительно условий просмотра ICC.

### <a name="setting-the-neutral-axis-in-the-gamut-boundary-description"></a>Задание нейтральной оси в описании границы цветового охвата

Хуемап и относительные методы сопоставления гаммы Минкд используют независимую ось устройства для выпрямления. Для базовых выходных устройств можно определить нейтральную ось, запустив нейтральные значения устройства (R = G = B или C = M = Y) через метод Девицетоколориметрик, а затем через метод Колориметриктоаппеаранце объекта CIECAM02. Однако устройства записи не всегда возвращают нейтральное значение устройства при представлении с нейтральным примером. Это особенно справедливо, если окружающее освещение не является строго нейтральным. Профили устройств WCS содержат индексы нейтральных выборок в целевом объекте. Используйте эти примеры для установки нейтральной оси. Поскольку эти сведения недоступны для профилей ICC, необходимо использовать тот же метод, который используется для выходных устройств. Запустите образцы с независимыми устройствами с помощью метода Девицетоколориметрик, а затем присоедините входные значения и + +.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Основные понятия управления цветом](basic-color-management-concepts.md)
</dt> <dt>

[Схемы и алгоритмы цветовой системы Windows](windows-color-system-schemas-and-algorithms.md)
</dt> </dl>

 

 




