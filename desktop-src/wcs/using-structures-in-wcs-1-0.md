---
title: Использование структур в WCS 1.0
description: Большая часть структур, используемых WCS 1,0, очень проста и требует небольшое объяснение. Они описаны в разделе "Справочник по WCS 1,0", озаглавленном "структуры".
ms.assetid: 8d3682e2-38fd-4a33-b386-ab0716bb6972
keywords:
- Цветовая система Windows (WCS), структуры
- WCS (цветовая система Windows), структуры
- Управление цветом изображений, структуры
- Управление цветом, структуры
- цвета, структуры
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 13d6e434ccfa6d96aa815f0c1997dc7f34178a32
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "105720069"
---
# <a name="using-structures-in-wcs-10"></a>Использование структур в WCS 1.0

Большая часть структур, используемых WCS 1,0, очень проста и требует небольшое объяснение. Они описаны в разделе "Справочник по WCS 1,0", озаглавленном " [структуры](structures.md)".

Исключения представляют собой структуру [**колорматчсетупв**](/windows/win32/api/icm/ns-icm-colormatchsetupw) , используемую функцией [**сетупколорматчингв**](/windows/win32/api/icm/nf-icm-setupcolormatchingw) , и следующие структуры Windows, определенные в вингди. h:

-   [BITMAPV5HEADER](#windows-bitmap-header-structures)
-   [**логколорспаце**](/windows/desktop/api/Wingdi/ns-wingdi-taglogcolorspacea)
-   [**Циексиз**](/windows/desktop/api/Wingdi/ns-wingdi-tagciexyz)
-   [**Циексизтрипле**](/windows/desktop/api/Wingdi/ns-wingdi-tagicexyztriple)

В следующих разделах рассматривается более большая длина:

-   [Структуры заголовка битовой карты Windows](#windows-bitmap-header-structures)
-   [Различия между заголовками v4 и V5](#differences-between-v4-and-v5-headers)
-   [Bitmap.exe: служебная программа Command-Line для преобразования заголовков битовых карт](#bitmapexe-a-command-line-utility-for-converting-bitmap-headers)

## <a name="windows-bitmap-header-structures"></a>Структуры заголовка битовой карты Windows

WCS 1,0 позволяет связывать или внедрять цветовые профили ICC в DIB-аппаратные рисунки. Это позволяет точнее использовать цвета DIB, чем возможно с помощью WCS в Windows 95. [BITMAPV5HEADER](/windows/win32/api/wingdi/ns-wingdi-bitmapv5header) , Новая структура заголовка точечного рисунка, определена в вингди. h в выпуске Windows 98. В целях разработки он также включается в файл ICM. h со ссылкой этого программиста. Структура **BITMAPV5HEADER** выглядит следующим образом:


```C++
typedef struct {
    DWORD        bV5Size;
    LONG         bV5Width;
    LONG         bV5Height;
    WORD         bV5Planes;
    WORD         bV5BitCount;
    DWORD        bV5Compression;
    DWORD        bV5SizeImage;
    LONG         bV5XPelsPerMeter;
    LONG         bV5YPelsPerMeter;
    DWORD        bV5ClrUsed;
    DWORD        bV5ClrImportant;
    DWORD        bV5RedMask;
    DWORD        bV5GreenMask;
    DWORD        bV5BlueMask;
    DWORD        bV5AlphaMask;
    DWORD        bV5CSType;
    CIEXYZTRIPLE bV5Endpoints;
    DWORD        bV5GammaRed;
    DWORD        bV5GammaGreen;
    DWORD        bV5GammaBlue;
    DWORD        bV5Intent;         // Rendering intent for bitmap 
    DWORD        bV5ProfileData;    // Offset to profile data 
    DWORD        bV5ProfileSize;    // Size of embedded profile data 
    DWORD        bV5Reserved;       // Should be zero 
} BITMAPV5HEADER, FAR *LPBITMAPV5HEADER, *PBITMAPV5HEADER;
```



Элементу **bV5CSType** может быть присвоено значение \_ встроенный профиль или профиль, \_ чтобы указать, является ли профиль внедренным или связанным с ним. Элемент **bV5ProfileData** — смещение в байтах от начала структуры **BITMAPV5HEADER** до начала данных профиля. Если профиль внедрен, данные профилирования являются реальным профилем, и если он связан, данные профиля являются именем файла профиля, заканчивающимся нулем. Это не может быть строка в Юникоде. Он должен состоять исключительно из символов из набора символов Windows (кодовая страница 1252).

Когда DIB загружается в память, данные профиля (если они есть) должны следовать за таблицей цветов, а **bV5ProfileData** должно предоставлять смещение данных профиля от начала структуры **BITMAPV5HEADER** . Теперь значение этого элемента будет другим, так как биты битовой карты не следуют за таблицей цветов в памяти. Приложения должны изменить элемент **bV5ProfileData** после загрузки DIB в память.

Для упакованных DIB данные профиля должны соответствовать битовым изображениям, аналогичным формату файла. Элемент **bV5ProfileData** должен по-прежнему предоставлять смещение данных профиля от начала структуры **BITMAPV5HEADER** .

Приложения должны получать доступ к данным профиля, только если **bV5Size**  ==  **sizeof** ( **BITMAPV5HEADER** ) **ANDbV5CSType** является \_ встроенным или связанным с профилями \_ .

Если профиль связан, путь к профилю может быть любым полным именем (включая сетевой путь), который можно открыть с помощью функции Win32 **CreateFile** .

## <a name="differences-between-v4-and-v5-headers"></a>Различия между заголовками v4 и V5

При работе с новой структурой точечных рисунков полезно понимать различия в настройке структур **BITMAPV4HEADER** и **BITMAPV5HEADER** :



| Заголовок v4     | Значение                                                                                                                              |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------|
| **bV4CSType** | \_откалиброванный \_ RGB. Это значение подразумевает, что конечные точки и гаммы заданы в соответствующих полях. Фиктивные значения вызывают проблемы. |
| **bV4CSType** | LCS \_ sRGB. Это значение означает, что точечный рисунок находится в цветовом пространстве sRGB (гамма и конечные точки игнорируются).                                 |
| **bV4CSType** | \_ \_ цветовое пространство Windows LCS \_ . Это значение означает, что точечный рисунок находится в цветовом пространстве Windows по умолчанию.                                    |



 



| Заголовок V5     | Значение                                                                                                                                                      |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **bV5CSType** | \_откалиброванный \_ RGB. Это значение подразумевает, что конечные точки и гаммы заданы в соответствующих полях. Фиктивные значения вызывают проблемы.                         |
| **bV5CSType** | LCS \_ sRGB. Это значение означает, что точечный рисунок находится в цветовом пространстве sRGB (гамма и конечные точки игнорируются).                                                         |
| **bV5CSType** | \_внедренный профиль. Это значение подразумевает, что **bV5ProfileData** указывает на буфер памяти, который содержит используемый профиль (гамма и конечные точки игнорируются). |
| **bV5CSType** | \_связанный профиль. Это значение подразумевает, что **bV5ProfileData** указывает на имя файла профиля для использования (гамма и конечные точки игнорируются).                |
| **bV5CSType** | \_ \_ цветовое пространство Windows LCS \_ . Это значение означает, что точечный рисунок находится в цветовом пространстве Windows по умолчанию.                                                            |



 

Чтобы преобразовать старые точечные рисунки в новую структуру **BITMAPV5HEADER** , файл программы преобразования командной строки с именем Bitmap.exe включен в Справочник программиста по WCS 1,0.

## <a name="bitmapexe-a-command-line-utility-for-converting-bitmap-headers"></a>BitMap.exe: служебная программа Command-Line для преобразования заголовков битовых карт

Bitmap.exe — это программа командной строки, расположенная в \\ папке bin в указанной папке установки. Он изменяет заголовки точечных рисунков Windows, позволяя преобразовывать существующие растровые изображения из структур заголовков **битмапинфохеадер** и **BITMAPV4HEADER** в более новую структуру **BITMAPV5HEADER** и обратно. Синтаксис командной строки выглядит следующим образом:


```C++
BITMAP [/d] [/1|4|5] [/s] [/f] 
filename
```



Параметры командной строки имеют следующие последствия.



| Коммутатор | Значение                                                                  |
|--------|--------------------------------------------------------------------------|
| /d     | Значения по умолчанию автоматически вносятся в преобразованные заголовки.       |
| /1     | Преобразует указанные растровые изображения в **битмапинфохеадер**                    |
| /4     | Преобразует указанные растровые изображения в **BITMAPV4HEADER**                      |
| /5     | Преобразует указанные растровые изображения в **BITMAPV5HEADER**                      |
| /f     | Принудительное преобразование, даже если точечный рисунок уже имеет правый заголовок       |
| /s     | Преобразует точечные рисунки в указанной папке и всех подкаталогах в ней |



 

 

 