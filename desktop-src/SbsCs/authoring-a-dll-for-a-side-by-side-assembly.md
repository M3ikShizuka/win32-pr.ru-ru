---
description: При создании собственных параллельных сборок следуйте рекомендациям по созданию параллельных сборок.
ms.assetid: e5fc3bae-0646-4418-a8f7-369856f03cd5
title: Создание библиотек DLL для параллельных сборок
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa15f3876c60ce55be00d60d8f417eb0c2cbf6ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265026"
---
# <a name="authoring-dlls-for-side-by-side-assemblies"></a>Создание библиотек DLL для параллельных сборок

При создании собственных параллельных сборок следуйте [рекомендациям по созданию параллельных сборок](guidelines-for-creating-side-by-side-assemblies.md) и создайте все библиотеки DLL, используемые в сборке, в соответствии со следующими рекомендациями.

-   Библиотеки DLL должны быть спроектированы таким образом, чтобы несколько версий могли выполняться одновременно и в одном процессе, не мешая друг другу. Например, многие приложения размещают несколько подключаемых модулей, каждая из которых требует наличия отдельной версии одного компонента. Разработчику параллельной сборки необходимо разработать и протестировать, чтобы обеспечить правильную работу нескольких версий компонента при одновременном запуске в одном процессе.

-   Если вы планируете предоставить компонент в качестве общего компонента в системах, предшествующих Windows XP, необходимо продолжить установку компонента в этих системах в качестве общего компонента с одним экземпляром. В этом случае необходимо обеспечить обратную совместимость компонента.

-   Оцените использование объектов, если в системе выполняется несколько версий сборки. Определите, требуются ли для разных версий сборки отдельные структуры данных, такие как размещенные в памяти файлы, именованные каналы, зарегистрированные сообщения Windows и классы, Общая память, семафоры, мьютексы и драйверы оборудования. Все структуры данных, используемые в версиях сборок, должны быть обратно совместимыми. Определите, какие структуры данных можно использовать в разных версиях, и какие структуры данных должны быть частными для версии. Определите, требуются ли для общих структур данных отдельные объекты синхронизации, такие как семафоры и мьютексы.

-   Некоторые объекты, такие как классы окон и атомы, уникально именуются для каждого процесса. Объекты, такие как классы окон, должны иметь версию для каждой сборки, использующей манифест. Для таких объектов, как атомы, используйте идентификаторы, зависящие от версии, если не планируется совместное использование в разных версиях. Если используются идентификаторы, зависящие от версии, используйте номер версии из четырех частей.

-   Не включайте самостоятельно регистрируемый код в любую библиотеку DLL. Библиотека DLL в параллельной сборке не может быть самостоятельной регистрацией.

-   Определите все имена, зависящие от версии, в библиотеке DLL с помощью \# инструкций define. Это позволяет изменять все разделы реестра из одного расположения. При освобождении новой версии сборки необходимо только изменить эту \# инструкцию define. Пример:

    `#define MyRegistryKey "MyAssembly1.0.0.0"`

-   Храните все неустойчивые данные во временном каталоге.

-   Не помещайте пользовательские данные в глобальные расположения. Данные приложений следует размещать отдельно от данных пользователя.

-   Назначить всем общим файлам версию файла, которая зависит от имени приложения.

-   Назначьте всем сообщениям и структурам данных, используемым в процессах, версию, чтобы предотвратить непреднамеренное совместное использование между процессами.

-   Библиотека DLL не должна зависеть от общего доступа между версиями, которые могут не существовать, например разделами общей памяти, которые не являются общими для разных версий сборки.

-   При добавлении новых функций, которые не соответствуют контракту совместимости двоичного интерфейса исходной библиотеки DLL, необходимо назначить новый CLSID, ProgId и имя файла. Для использования этого идентификатора CLSID, ProgId и имени файла потребуется использовать будущие версии параллельной сборки. Это предотвращает конфликт, если непараллельная версия библиотеки DLL зарегистрирована в параллельной версии.

-   Если вы повторно использовали тот же идентификатор CLSID или ProgId, проверьте, чтобы обеспечить обратную совместимость сборки.

-   Инициализируйте и задайте параметры по умолчанию для сборки в коде сборки. Не сохраняйте параметры по умолчанию в реестре.

-   Назначение версий для всех структур данных.

-   Библиотека DLL должна хранить состояние параллельной сборки, как описано в разделе [Создание хранилища состояний для параллельных сборок](authoring-state-storage-for-side-by-side-assemblies.md).

 

 



