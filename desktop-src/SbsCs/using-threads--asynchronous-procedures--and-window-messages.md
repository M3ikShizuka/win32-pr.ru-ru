---
description: Контексты активации видимы во всем процессе.
ms.assetid: 6eda00d5-9dac-4267-bf61-b481814201f8
title: Потоки, асинхронные процедуры и сообщения окна
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 529be75a3bc72679f44dfb69196f9487aa4f1de4f3cdbeada4ec89e26f05d646
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119141707"
---
# <a name="using-threads-asynchronous-procedures-and-window-messages"></a>Использование потоков, асинхронных процедур и оконных сообщений

Контексты активации видимы во всем процессе. Стеки контекста активации, однако, относятся к одному потоку, и два потока в одном процессе могут иметь разные стеки активации. [**CreateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createthread) автоматически помещает текущий контекст активации в начало стека активации нового потока. Это может способствовать обновлению существующего кода для использования параллельных компонентов, поскольку новый поток может выполняться немедленно в текущем контексте активации.

Асинхронные вызовы процедур, обратные вызовы портов завершения и любые другие обратные вызовы других потоков автоматически получают контекст активации источника. При вызове обратного вызова очищается стек активации. Это означает, что приложение может использовать асинхронные вызовы процедур и обратные вызовы без явной активации каких-либо контекстов, так как управление контекста будет выполняться базовой инфраструктурой. Чтобы сделать другие контексты активными во время обратного вызова или нового потока, приложение может выполнить собственное управление контекста. В этом случае программа должна использовать правильную последовательность контекста активации и функции деактивировать функции.

Контексты активации являются независимыми от потоков. При активации контекста изменяется только стек текущего потока, и нельзя активировать контекст между потоками. Потоку A не удается принудительно применить контекст к потоку B. Функции API контекста активации также поддерживают потоки.

При использовании [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) или [**сообщения**](/windows/win32/api/winuser/nf-winuser-postmessagea) для отправки окна в другую процедуру окна в процессе текущий контекст активации активируется до передачи сообщения целевой процедуре. Текущий контекст активации поступает вместе с сообщением. Это гарантирует, что сообщения, ссылающиеся на объекты COM, имена DLL или другие параллельные ресурсы, сохраняют свои данные о контексте.

 

 
