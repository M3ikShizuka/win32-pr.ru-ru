---
description: В следующем примере рассматривается создание подписанной параллельной сборки, состоящей из манифеста сборки, каталога проверки и файлов сборки.
ms.assetid: fa95f292-36e6-4e88-8a0d-aa8bd08def2b
title: Пример подписывания сборки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3896da43b846edfd09348c6515fbf5e44fdd45dd2911b9fcdcf25e99f63fb6ea
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119142467"
---
# <a name="assembly-signing-example"></a>Пример подписывания сборки

В следующем примере рассматривается создание подписанной параллельной сборки, состоящей из манифеста сборки, каталога проверки и файлов сборки. Совместно используемые параллельные сборки должны быть подписаны. Операционная система проверяет подпись сборки перед установкой общей сборки в глобальном хранилище на стороне (WinSxS). Это затрудняет подмену издателя параллельной сборки.

Обратите внимание, что изменение файлов сборки или содержимого манифеста после создания каталога сборки сделает каталог и сборку недействительными. Если необходимо обновить файлы сборки или манифест после создания и подписи каталога, необходимо снова подписать сборку и создать новый каталог.

Начните с файлов сборки, манифеста сборки и файла сертификата, который будет использоваться для подписания сборки. Файл сертификата должен иметь размер 2048 или более. Вы не обязаны использовать доверенный сертификат. Сертификат используется только для проверки того, что сборка не повреждена.

запустите служебную программу [Pktextract.exe](pktextract-exe.md) , предоставляемую в пакете SDK для Microsoft Windows, чтобы извлечь маркер открытого ключа из файла сертификата. Для правильной работы Пктекстракт файл сертификата должен находиться в том же каталоге, что и программа. Используйте извлеченное значение токена открытого ключа, чтобы обновить атрибут **PublicKeyToken** элемента **assemblyIdentity** в файле манифеста.

Ниже приведен пример файла манифеста с именем Мисамплеассембли. manifest. Сборка Мисамплеассембли содержит только один файл, MYFILE.DLL. Обратите внимание, что значение атрибута **PublicKeyToken** элемента **assemblyIdentity** Обновлено значением маркера открытого ключа.

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity 
        type="win32" 
        name="Microsoft.Windows.MySampleAssembly" 
        version="1.0.0.0" 
        processorArchitecture="x86"         
        publicKeyToken="0000000000000000"/>
    <file name="myfile.dll"/>
</assembly>
```

затем запустите служебную программу [Mt.exe](mt-exe.md) , предоставленную в Windows SDK. Файлы сборки должны находиться в том же каталоге, что и манифест. В этом примере это каталог Мисамплеассембли. Вызовите Mt.exe для примера следующим образом:

**c: \\ мисамплеассембли>mt.exe-manifest мисамплеассембли. manifest-хашупдате-макекдфс**

Вот как выглядит пример манифеста после выполнения Mt.exe. Обратите внимание, что выполнение Mt.exe с параметром хашупдате добавляет хэш SHA-1 файла. Не изменяйте это значение.

``` syntax
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity 
        type="win32" 
        name=" Microsoft.Windows.MySampleAssembly" 
        version="1.0.0.0" 
        processorArchitecture="x86"         
        publicKeyToken="0000000000000000"/>
    <file name="myfile.dll"
hash="a1d362d6278557bbe965a684ac7adb4e57427a29" hashalg="SHA1"/>
</assembly>
```

Выполнение Mt.exe с параметром-макекдфс создает файл с именем Мисамплеассембли. manifest. CDF, описывающий содержимое каталога безопасности, который будет использоваться для проверки манифеста.

Чтобы создать каталог безопасности для сборки, необходимо выполнить Makecat.exe. CDF. Вызов Makecat.exe для этого примера будет выглядеть следующим образом:

**c: \\ мисамплеассембли>Макекат мисамплеассембли. manifest. CDF**

Последним шагом является запуск SignTool.exe для подписывания файла каталога с помощью сертификата. Это должен быть тот же сертификат, который использовался в предыдущем примере для создания токена открытого ключа. Дополнительные сведения о SignTool.exe см. в разделе средство [**SignTool**](../seccrypto/signtool.md) . Вызов **SignTool** для примера будет выглядеть следующим образом:

**c: \\ мисамплеассембли>средство SignTool с подписью/f \<fullpath> MyCompany. pfx/du HTTPS: \/ /www.mycompany.com/MySampleAssembly/t https: \/ /timestamp.DigiCert.com MySampleAssembly.cat**

Если у вас есть цифровой сертификат, прошедший проверку подлинности, и в центре сертификации для хранения закрытого ключа используется формат PVK-файла, можно использовать импортер файлов цифровых сертификатов (pvkimprt.exe), чтобы импортировать ключ в поставщик служб шифрования (CSP). Эта служебная программа позволяет экспортировать в формат PFX/P12 отраслевого стандарта. Дополнительные сведения об импортере файлов цифровых сертификатов PVK см. в разделе ресурсы развертывания библиотеки MSDN или в центре сертификации. Возможно, вы сможете получить pvkimprt.exe из https://office.microsoft.com/downloads/2000/pvkimprt.aspx .

См. также [Создание подписанных файлов и каталогов](creating-signed-files-and-catalogs.md).

 

 
