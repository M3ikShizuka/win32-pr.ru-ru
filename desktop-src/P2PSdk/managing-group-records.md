---
description: Запись группы — это конкретные данные, опубликованные для всех активных участников одноранговой группы, например сообщение разговора или обновление состояния, относящееся к приложению.
ms.assetid: 073ee4e9-0e97-451a-a808-8265575d073c
title: Управление записями групп
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3b6d9e3257cc597b715dc9c65eb5945c00c15286
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127057181"
---
# <a name="managing-group-records"></a>Управление записями групп

Запись группы — это конкретные данные, опубликованные для всех активных участников одноранговой группы, например сообщение разговора или обновление состояния, относящееся к приложению. Запись представляется структурой [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) и содержит следующие сведения о одноранговом узле:

-   Идентификатор записи — это значение, уникально идентифицирующее запись в одноранговой группе.
-   Идентификатор GUID, указывающий тип записи. Приложения могут поддерживать различные типы записей. Приложение интерпретирует поле **данных** записи на основе типа записи. Некоторые идентификаторы GUID зарезервированы, и вызов API **возвращает \_ \_ \_ несанкционированный доступ к узлу E** , когда приложение пытается их использовать.
-   Набор атрибутов записи, описанных в виде XML-строки. Атрибуты используются при поиске записей. Дополнительные сведения об атрибутах см. в разделе [запись атрибута Schema](record-attribute-schema.md).
-   Одноранговый момент создания записи.
-   Время на одноранговом уровне, в течение которого срок действия записи истекает.
-   Время на одноранговом уровне, в которое изменяется запись.
-   Создатель записи.
-   Член, который изменяет запись.
-   Структура [**\_ данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_data) , содержащая криптографическую подпись для всех полей в этой структуре [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) . Это поле нельзя обновить напрямую или изменить с помощью однорангового узла.
-   Структура [**\_ данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_data) , содержащая данные приложения, связанные с этой записью, в виде массива байтов. Тип данных, имеющихся в этом поле, определяется определяемым приложением типом записи.

## <a name="obtaining-peer-group-records"></a>Получение записей одноранговых групп

Отдельные записи получаются путем вызова [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) с идентификатором записи. При обработке всех записей определенного типа перечислимый набор всех текущих записей одноранговых групп получается путем первого вызова [**пирграупенумрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords) для открытия перечисления и последовательного вызова [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) до получения всех записей. По завершении закройте перечисление и освободите память, связанную с ней, вызвав [**пиренденумератион**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).

Когда запись создается, удаляется или обновляется одноранговым узлом, затронутая запись публикуется во всех членах одноранговой группы посредством события **\_ \_ \_ \_ изменения записи события одноранговой группы** . Обратите внимание, что если одноранговый узел не подключен к группе, он получит обновленную запись, а затем подключится к ней позже. Важно зарегистрировать это событие с помощью [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent) , если ваше приложение обслуживает и управляет записями любым осмысленным способом. Кроме того, приложение может запрашивать базу данных записей по запросу с помощью [**пирграупсеарчрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords).

При возникновении события **\_ \_ \_ \_ изменения записи о событии одноранговой группы** конкретный идентификатор и тип записи, а также тип изменения (Добавление, обновление, удаление) получаются в виде структуры [**данных однорангового \_ \_ \_ изменения \_ записей событий**](/windows/desktop/api/P2P/ns-p2p-peer_event_record_change_data) . Эта структура получается с помощью вызова [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata). Если изменение является добавлением или обновлением, следует использовать [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) для получения записи с ПРЕДОСТАВЛЕНным идентификатором. Локальная база данных записей для инфраструктуры обновляется автоматически.

Можно также выполнить поиск определенных записей на основе определенных пользовательских атрибутов, предоставляемых в поле **пвзаттрибутес** [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record), а также всех предопределенных атрибутов. Для этого используйте функцию [**пирграупсеарчрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupsearchrecords) с XML-запросом поиска в формате, указанном в разделе [Формат запроса поиска записей](record-search-query-format.md) .

Дополнительные сведения о работе с записями в одноранговой инфраструктуре см. в разделе " [записи](records.md) " статьи [использование одноранговой инфраструктуры](using-the-peer-infrastructure.md).

## <a name="administration-of-peer-group-records"></a>Администрирование записей одноранговых групп

Когда начальные приглашения выдаются создателем одноранговой группы, он может указать, что определенные члены будут обслуживать роль администратора (администратор роли одноранговой \_ группы \_ \_ ) при выдаче новых учетных данных пользователю (через [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) или [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials)). Администратор может непосредственно добавлять, удалять и обновлять любые записи одноранговых групп. И наоборот, член одноранговой группы, которому назначена роль **\_ \_ роли \_** одноранговой группы или участника роли **одноранговой \_ группы \_ \_ \_** , может добавлять, обновлять и удалять собственные записи.

Создатель имеет роль администратора по умолчанию.

Чтобы обновить запись, получите запись с помощью [**пирграупжетрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupgetrecord) или [**пирграупенумрекордс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumrecords), внесите изменения и передайте обновленную запись в [**пирграупупдатерекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupupdaterecord).

Чтобы удалить запись, передайте идентификатор записи для удаления в [**пирграупделетерекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupdeleterecord).

Чтобы добавить запись, создайте новую структуру [**одноранговой \_ записи**](/windows/desktop/api/P2P/ns-p2p-peer_record) и заполните следующие поля:

-   **двсизе**. Это поле содержит значение **sizeof**([**одноранговая \_ запись**](/windows/desktop/api/P2P/ns-p2p-peer_record)).
-   **фтекспиратион**. Это поле содержит дату и время истечения срока действия записи, выраженное во время пиринга в виде структуры **fileTime** .
-   **введите**. Это поле содержит значение **идентификатора GUID** , определяющее тип записи для приложения. Если этот тип является настраиваемым для инфраструктуры приложений, необходимо также заполнить поле **данных** .

Следующие поля заполняются инфраструктурой и будут игнорироваться, если они заданы приложением:

-   **id**
-   **пвзкреаторид**
-   **пвзластмодифиедбид**
-   **фткреатион**
-   **фтластмодифиед**
-   **секуритидата**

Остальные поля являются необязательными. Чтобы добавить эту новую запись в одноранговую группу, передайте ее в [**пирграупаддрекорд**](/windows/desktop/api/P2P/nf-p2p-peergroupaddrecord).

## <a name="importing-and-exporting-records"></a>Импорт и экспорт записей

Записи одноранговых групп обслуживаются локально в качестве базы данных. Чтобы сохранить текущий моментальный снимок базы данных записи одноранговой группы в локальном файле, вызовите [**пирграупекспортдатабасе**](/windows/desktop/api/P2P/nf-p2p-peergroupexportdatabase)и передайте ему маркер в одноранговую группу. Затем этот файл можно перенести на другой компьютер или приложение, что может извлекать и использовать эту базу данных записи путем вызова [**пирграупимпортдатабасе**](/windows/desktop/api/P2P/nf-p2p-peergroupimportdatabase).

 

 



