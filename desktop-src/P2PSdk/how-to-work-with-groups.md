---
description: Одноранговая группировка — это технология, позволяющая разработчикам быстро и эффективно создавать безопасные одноранговые сети.
ms.assetid: ee72f60b-1e5b-4b69-bda0-2ae80734c144
title: Работа с группами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7bebf958d0c3fdee6ad0dc400d495c54ec2e6fe
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127057198"
---
# <a name="how-to-work-with-groups"></a>Работа с группами

Одноранговая группировка — это технология, позволяющая разработчикам быстро и эффективно создавать безопасные одноранговые сети. В следующем списке перечислены основные моменты, которые необходимо учитывать при создании приложения однорангового группирования.

-   [Получение удостоверения однорангового узла](#obtaining-a-peer-identity)
-   [Запуск одноранговой группы](#starting-up-the-peer-grouping-infrastructure)
-   [Регистрация для группирования событий](#registering-for-peer-grouping-events)
-   [Подключение к группе](#obtaining-a-group-handle)
-   [Создание ролей администратора и члена](#creating-administrator-and-member-roles)
-   [Поиск однорангового узла](#finding-a-peer)
-   [Прямое подключение к одноранговому узлу](#connecting-directly-to-a-peer)
-   [Закрытие и завершение работы группы](#closing-and-shutting-down-a-peer-group)

## <a name="obtaining-a-peer-identity"></a>Получение удостоверения однорангового узла

Перед созданием или подключением к группе необходимо получить одноранговый идентификатор, который используется для уникальной идентификации однорангового узла в группе. Чтобы получить список всех идентификаторов одноранговых узлов, определенных на одноранговом узле, вызовите [**пиренумидентитиес**](/windows/desktop/api/P2P/nf-p2p-peerenumidentities), который возвращает маркер в перечисление. Чтобы получить идентификаторы одноранговых узлов, вызовите [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) с помощью маркера перечисления и числа извлекаемых элементов. Продолжайте вызывать **пиржетнекститем** , пока параметр *pCount* не вернет значение, меньшее запрошенного количества одноранговых идентификаторов.

Если одноранговый идентификатор для однорангового узла не существует, его можно создать, вызвав [**пиридентитикреате**](/windows/desktop/api/P2P/nf-p2p-peeridentitycreate). После создания удостоверения однорангового узла узел создает большой двоичный объект XML Identity, содержащий назначенный ему открытый ключ.

Сведения об удостоверении однорангового узла получаются путем вызова [**пиридентитижетксмл**](/windows/desktop/api/P2P/nf-p2p-peeridentitygetxml). Эти сведения об удостоверении однорангового узла используются создателем группы или администратором для выдаче учетных данных, необходимых для присоединения к группе, в качестве XML-объекта приглашения.

Дополнительные сведения о одноранговых удостоверениях см. в документации по [API диспетчера удостоверений](identity-manager-api.md) .

## <a name="starting-up-the-peer-grouping-infrastructure"></a>Запуск инфраструктуры однорангового группирования

Перед вызовом приложением любой функции в API однорангового группирования необходимо вызвать [**пирграупстартуп**](/windows/desktop/api/P2P/nf-p2p-peergroupstartup) . Эта функция инициализирует инфраструктуру однорангового группирования для приложения и задает поддерживаемую версию.

## <a name="obtaining-a-group-handle"></a>Получение маркера группы

Чтобы подключиться к группе и начать участвовать в ней, необходимо получить маркер одноранговой группы. В следующем списке приведены три способа подключения к одноранговой группе:

-   Создание одноранговой группы путем вызова [**пирграупкреате**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), которая инициализирует новую одноранговую группу и возвращает допустимый маркер с одноранговым узлом в качестве владельца и единственного администратора.
-   Присоединение к одноранговой группе путем вызова [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin). Чтобы присоединиться к одноранговой группе, одноранговый узел должен получить приглашение от администратора одноранговой группы. Чтобы получить приглашение, отправьте администратору, который создает приглашение, и отправляет его по внешнему механизму, например по электронной почте или FTP. Приглашение и одноранговый идентификатор передаются в **пирграупжоин**, который возвращает допустимый маркер в группу.
-   Открытие одноранговой группы, присоединенной к узлу ранее путем вызова [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen). В этом случае получение приглашения не требуется.

После получения допустимого маркера одноранговой группы из одной из перечисленных выше функций можно подключиться к одноранговой группе, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) с новым маркером.

> [!Note]  
> В случае сбоя соединения с одноранговой группой \_ \_ \_ \_ возникает событие сбоя подключения к одноранговой группе. Обработчик может попытаться восстановить соединение с одноранговой группой.

 

## <a name="registering-for-peer-grouping-events"></a>Регистрация для событий группирования одноранговых узлов

Прежде чем одноранговый узел участвует в одноранговой группе, он должен зарегистрировать события одноранговой группы. Чтобы выполнить регистрацию для определенных одноранговых событий, вызовите [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent)и передайте один или несколько типов событий однорангового узла, определенных в типе события одноранговой \_ группы \_ \_ . Для каждого однорангового события, применяемого к приложению, необходимо зарегистрировать. Например, чтобы получить данные через прямое подключение, зарегистрируйте события одноранговой \_ группы \_ с \_ прямым \_ подключением и \_ \_ СОБЫТИЕм \_ входящих данных событий одноранговой группы \_ . Каждый вызов принимает обработчик события и возвращает обработчик **хпиревент** для этого однорангового события.

Обработчики событий могут получать данные, связанные с однорангового события, передавая дескриптор зарегистрированным одноранговым событиям в [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata). Данные одноранговых событий возвращаются в виде \_ \_ объединения данных событий одноранговой группы \_ . Если одноранговая очередь событий пуста, эта функция возвращает одноранговые \_ элементы \_ без \_ \_ данных события.

Вы можете отменить регистрацию для одноранговых событий, вызвав [**пирграупунрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupunregisterevent) и предоставив маркер для события однорангового узла, регистрацию которого нужно отменить. После вызова функции одноранговые события, связанные с этим маркером, больше не регистрируются.

## <a name="creating-administrator-and-member-roles"></a>Создание ролей администратора и члена

Узел, создающий одноранговую группу, называется создателем одноранговой группы и имеет роль администратора по умолчанию. Только создатель одноранговой группы может задавать свойства группы.

Коллеги, приглашенные в одноранговую группу, могут быть либо администратором, либо членом. Если администратор, выдающий приглашение, назначает роль администратора, он может пригласить новых участников в одноранговую группу, а также назначить роль администратора другим участникам.

Роли членов одноранговых групп задаются в приглашениях, которые администратор передает участнику. Чтобы добавить дополнительных администраторов, присвойте параметру *Пролес* [**пирграупкреатеинвитатион**](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) значение "Администратор роли одноранговой \_ группы \_ \_ " при создании приглашения.

Участники могут участвовать в одноранговой группе, но не могут приглашать и авторизовать новые члены, задавать свойства группы или обновлять или удалять записи групп, которые они не создают. Чтобы назначить состояние участника участвующему одноранговому узлу,  [](/windows/desktop/api/P2P/nf-p2p-peergroupcreateinvitation) \_ \_ \_ при создании приглашения для этого узла задайте значение параметра пролес в параметре пирграупкреатеинвитатион в качестве участника роли одноранговой группы.

Чтобы изменить роль члена, необходимо выдать этому члену новые учетные данные, содержащие новую роль. Для этого получите структуру [**\_ \_ сведений об учетных данных однорангового узла**](/windows/desktop/api/P2P/ns-p2p-peer_credential_info) для этого элемента из структуры однорангового \_ члена, возвращенной [**пирграупенуммемберс**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers). Измените значение поля **пролес** в **поле \_ \_ сведения об учетных данных однорангового узла** на новую роль и передайте структуру в [**пирграуписсуекредентиалс**](/windows/desktop/api/P2P/nf-p2p-peergroupissuecredentials).

Новые учетные данные не вступят в силу для однорангового узла, пока они не подключаются к одноранговой группе. Если они подключены в данный момент, они должны закрыть группу и повторно подключиться, чтобы получить обновленные учетные данные.

## <a name="finding-a-peer"></a>Поиск однорангового узла

Чтобы получить список всех узлов, участвующих в одноранговой группе, вызовите [**пирграупенуммемберс**](/windows/desktop/api/P2P/nf-p2p-peergroupenummembers) с помощью маркера группы, который возвращает маркер в перечисление. Чтобы получить члены, вызовите [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem) с помощью маркера перечисления и числа извлекаемых элементов. Продолжайте вызывать **пиржетнекститем** , пока параметр *pCount* не вернет значение, меньшее запрошенного количества элементов. Обратите внимание, что полный список доступных членов не может быть возвращен.

Каждый элемент представляется в виде структуры [**однорангового \_ члена**](/windows/desktop/api/P2P/ns-p2p-peer_member) , которая содержит идентификаторы одноранговых узлов, идентификаторов узла и IP-адресов для активных одноранговых узлов.

По завершении закройте перечисление и освободите связанную память, вызвав [**пиренденумератион**](/windows/desktop/api/P2P/nf-p2p-peerendenumeration).

## <a name="connecting-directly-to-a-peer"></a>Прямое подключение к одноранговому узлу

При подключении однорангового узла к одноранговой группе инициируется непосредственная связь "один к одному" с другими подключенными членами с помощью вызова [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) и предоставления удостоверения другого однорангового узла. Этот вызов является асинхронным и возвращает 64-разрядный идентификатор соединения. Если вызов выполнен успешно, вы получаете событие однорангового \_ \_ \_ узла события прямого соединения с прямой группой, \_ \_ чтобы указать, что соединение прошло успешно. Если соединение установлено успешно, идентификатор соединения является допустимым и может использоваться для отправки и получения данных через прямое соединение.

Чтобы иметь возможность получать прямые подключения, другой узел также должен быть зарегистрирован ранее для события однорангового \_ \_ узла с \_ прямым \_ подключением.

Чтобы отправить данные на одноранговый узел, вызовите [**пирграупсенддата**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata) с ДОПУСТИМЫм идентификатором соединения. Для получения данных другой узел должен быть зарегистрирован для события однорангового \_ узла события одноранговой группы \_ \_ \_ . Аналогично, если отправляющий узел хочет получать данные в свою очередь, он также должен быть зарегистрирован для события однорангового \_ узла для события Peer в группе узлов \_ \_ \_ .

Чтобы получить общий набор активных в данный момент прямых подключений с другими одноранговыми узлами в группе, вызовите [**пирграупенумконнектионс**](/windows/desktop/api/P2P/nf-p2p-peergroupenumconnections) , чтобы открыть перечисление и выполнить итерацию по списку соединений с помощью [**пиржетнекститем**](/windows/desktop/api/P2P/nf-p2p-peergetnextitem).

Чтобы закрыть прямое соединение, вызовите [**пирграупклоседиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) и передайте идентификатор подключения.

## <a name="closing-and-shutting-down-a-peer-group"></a>Закрытие и завершение работы одноранговой группы

Чтобы закрыть соединение с одноранговой группой, вызовите [**пирграупклосе**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), который делает недействительным маркер группы, но не завершает работу инфраструктуры однорангового группирования. Данные одноранговой группы удаляются путем вызова [**пирграупделете**](/windows/desktop/api/P2P/nf-p2p-peergroupdelete).

После завершения работы приложения с помощью инфраструктуры однорангового группирования необходимо вызвать [**пирграупшутдовн**](/windows/desktop/api/P2P/nf-p2p-peergroupshutdown).

 

 



