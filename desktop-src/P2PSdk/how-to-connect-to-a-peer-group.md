---
description: В этом разделе описывается, как приложение подключается к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.
ms.assetid: 56fa28d8-3b3a-4cd5-8448-c8c4ce8d0b2c
title: Подключение к одноранговой группе
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d5bb3f41342573742e634a6e7ebce283188f3ffd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663333"
---
# <a name="how-to-connect-to-a-peer-group"></a>Подключение к одноранговой группе

В этом разделе описывается, как приложение подключается к одноранговой группе с помощью интерфейсов API группирования одноранговых узлов.

## <a name="joining-a-peer-group"></a>Присоединение к одноранговой группе

Чтобы присоединить одноранговую группу, вызовите [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin), передав имя удостоверения однорангового узла и приглашения (а также необязательное имя облака PNRP, если имя облака в приглашении неоднозначно).

В случае успеха [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) возвращает маркер одноранговой группы.

Если узел ранее присоединился к одноранговой группе, а затем закрыл его, то одноранговую группу следует повторно открыть, вызвав [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) и передав имя одноранговой группы. Этот вызов возвращает новый маркер одноранговой группы.

После успешного присоединения одноранговой группы одноранговый узел может подключиться непосредственно к одноранговой группе и начать взаимодействие, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect). После подключения узел считается подключенным к сети.

Если приложение не будет взаимодействовать с группой в это время, оно может остаться в автономном режиме. Если он принимает участие непосредственно в одноранговой группе на последующем экземпляре, последующий вызов [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) переводит его в режим «в сети». После того как одноранговая группа присоединилась к одноранговой группе, она должна подключаться по крайней мере один раз, прежде чем она сможет публиковать записи в одноранговой группе.

## <a name="opening-a-peer-group-without-connecting-offline"></a>Открытие одноранговой группы без подключения (вне сети)

Часто может потребоваться, чтобы приложение подключаться к одноранговой группе, но не участвовало в нем напрямую, получать и публиковать обновления записей, но не отправлять и не получать сообщения данных. Приложение находится в состоянии "вне сети" сразу после вызова [**пирграупкреате**](/windows/desktop/api/P2P/nf-p2p-peergroupcreate), [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin)или [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) .

Автономное приложение может подключиться к сети в любое время, вызвав [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect). После подключения одноранговая группа не может переключиться в автономный режим, пока все другие приложения, связанные с этим удостоверением и совместно с этой группой, также не будут закрыты.

Одноранговая группа — это общий ресурс с той же одноранговой группой, доступной для нескольких приложений. Если несколько приложений для одного и того же удостоверения и пользователя Windows используют одну и ту же одноранговую группу, они также используют одну и ту же основную базу данных и соединения (соседа и Direct). Если какое-либо из этих приложений вызывает [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect), все другие приложения для этого удостоверения или пользователя, участвующего в группе, также подключаются к группе. Если запись добавляется одним приложением, когда группа находится в автономном режиме, другие приложения также смогут ее увидеть. В результате приложение должно быть готово к подключению к сети в любое время.

## <a name="connecting-to-a-peer-group-online"></a>Подключение к одноранговой группе (в сети)

Чтобы приступить к участию в группе, вызовите [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) после создания, присоединения или открытия группы. В этом состоянии прямые подключения можно открыть с другими одноранговыми узлами, участвующими в той же группе, вызвав [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection).

Чтобы определить, не завершилась ли попытка соединения, зарегистрируйте \_ \_ \_ событие сбоя подключения к СОбытию одноранговой группы \_ . Это событие возникает, если инфраструктуре группирования не удается найти другой член, к которому необходимо подключиться, или если происходит сбой соединения перед синхронизацией базы данных группы и не удается установить другое соединение.

Хотя несколько приложений, которые выполняются на одноранговом узле и участвуют в одной группе с одним и тем же идентификатором однорангового узла, могут находиться вне сети, вызов [**пирграупконнект**](/windows/desktop/api/P2P/nf-p2p-peergroupconnect) в любом из приложений приводит к тому, что все приложения становятся в сети.

Кроме того, если одно приложение на одноранговом узле подключено к группе, все другие приложения, вызывающие [**пирграупжоин**](/windows/desktop/api/P2P/nf-p2p-peergroupjoin) или [**пирграупопен**](/windows/desktop/api/P2P/nf-p2p-peergroupopen) , также будут немедленно подключены. Если приложение вызывает [**пирграупклосе**](/windows/desktop/api/P2P/nf-p2p-peergroupclose), обработчик закрывается только для этого приложения. Таким же последующий вызов **пирграупопен** приложением возвращает новый маркер группы, и приложение немедленно переводится в режим «в сети», если другие приложения, участвующие в той же группе, все еще подключены.

## <a name="sending-and-receiving-data"></a>Отправка и получение данных

Для отправки и получения данных между конкретными узлами участника в группе необходимо установить прямые соединения с теми членами, с которыми планируется взаимодействовать. Установление прямого подключения является асинхронным вызовом [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection), передачей маркера для подключенной группы, а также идентификатором однорангового узла в группе, к которой вы хотите подключиться. Этот метод возвращает идентификатор соединения. Если вызов выполнен успешно, \_ \_ \_ \_ на одноранговом узле вызывается событие прямого подключения одноранговой группы, проверяющее идентификатор подключения.

Чтобы получить прямые подключения от других одноранговых узлов, зарегистрируйте событие прямого соединения для одноранговой \_ группы \_ с помощью \_ \_ вызова [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent).

После успешной установки прямого подключения приложение может начать отправку данных с помощью вызовов [**пирграупсенддата**](/windows/desktop/api/P2P/nf-p2p-peergroupsenddata), передав допустимый идентификатор соединения. Порядок передачи многокомпонентных данных обрабатывается **пирграупсенддата**. Однако приложения должны реализовать правильный стек протокола для обработки непрозрачных данных, возвращаемых этим вызовом API.

Чтобы получить данные через прямое соединение, приложение должно зарегистрироваться для \_ \_ события входящих данных события одноранговой группы \_ \_ с помощью [**пирграупрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergroupregisterevent). Обработчик событий отвечает за получение и упорядочение непрозрачных данных и передачу их в приложение. Эти данные получаются в обработчике событий путем вызова [**пирграупжетевентдата**](/windows/desktop/api/P2P/nf-p2p-peergroupgeteventdata) с дескриптором для зарегистрированных событий.

Прямое соединение закрывается вызовом [**пирграупклоседиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupclosedirectconnection) и передачей идентификатора соединения, полученного при предыдущем вызове метода [**пирграупопендиректконнектион**](/windows/desktop/api/P2P/nf-p2p-peergroupopendirectconnection) или полученного в данных события для прямого соединения с одноранговой \_ \_ группой событий \_ \_ .

 

 



