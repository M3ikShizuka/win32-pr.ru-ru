---
description: При работе с одноранговыми графами функции должны вызываться в определенном порядке. Поток вызовов зависит от того, создаете ли вы или открываете одноранговый граф. В этом разделе определяется последовательность вызовов функций в простом одноранговых приложениях графа.
ms.assetid: cb4f48d0-d1e2-4a4b-bd5a-6e8f66d03806
title: Работа с диаграммами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b4328b7a0109139421cf03c72a7228a3dc17e375
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663264"
---
# <a name="working-with-graphs"></a>Работа с диаграммами

При работе с одноранговыми графами функции должны вызываться в определенном порядке. Поток вызовов зависит от того, создаете ли вы или открываете одноранговый граф. В этом разделе определяется последовательность вызовов функций в простом одноранговых приложениях графа.

## <a name="starting-up-a-graph"></a>Запуск графа

Прежде чем приложение вызовет функцию в API одноранговых диаграмм, необходимо вызвать [**пирграфстартуп**](/windows/desktop/api/P2P/nf-p2p-peergraphstartup) , чтобы инициализировать API одноранговых диаграмм для приложения, а затем задать поддерживаемую версию.

## <a name="creating-a-peer-graph"></a>Создание однорангового графа

Следующая процедура определяет поток вызовов для создания однорангового графа.

> [!IMPORTANT]
> Только один одноранговый узел должен вызывать [**пирграфкреате**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate). Все остальные узлы должны вызывать [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen). Несколько вызовов **пирграфкреате** делают недействительным граф.

 

-   Создание однорангового графа. Вызовите [**пирграфкреате**](/windows/desktop/api/P2P/nf-p2p-peergraphcreate).
-   Регистрация для событий одноранговых узлов. Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).
    > [!Note]  
    > Дополнительные сведения о регистрации событий одноранговых узлов см. в разделе [инфраструктура событий](peer-events-infrastructure.md).

     

-   Прослушивать подключения к одноранговой диаграмме. Вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).
-   Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями.
-   Закройте соединение с одноранговой диаграммой. Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).

## <a name="opening-a-peer-graph"></a>Открытие однорангового графа

Поток вызовов функций для открытия однорангового графа зависит от возвращаемого значения вызова [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen). Наиболее важными значениями являются " **S \_** " и **" \_ Peer \_ S \_ Created**", которые описаны в следующих разделах этой статьи.

> [!Note]  
> Если вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) не возвращает значение **s \_ ОК** или не удается **\_ \_ \_ создать одноранговые данные**, обработайте ошибку.

 

## <a name="when-peergraphopen-returns-s_ok"></a>Когда Пирграфопен возвращает значение S \_ ОК

Когда вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает " **\_ ОК**", был открыт одноранговый граф и существующая база данных. Следующая процедура позволяет определить, что можно сделать для открытия однорангового графа, когда вызов **пирграфопен** возвращает **S \_ ОК** .

-   Регистрация для событий одноранговых узлов. Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).
    > [!Note]  
    > Дополнительные сведения о регистрации событий см. в разделе [инфраструктура событий](peer-events-infrastructure.md).

     

-   Нахождение узла. Это процесс, выполняемый за пределами инфраструктуры одноранговых диаграмм, с помощью метода или приложения, которые вы определяете. API одноранговых диаграмм не предоставляет специальный механизм поиска исходного узла графа для подключения. Приложение должно использовать другой механизм, например API [протокола PNRP](pnrp-namespace-provider-api.md) , для определения местонахождения исходного узла.
-   Если узел найден, подключитесь к нему. Вызовите [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), а затем вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) для прослушивания соединений с одноранговый граф.
    > [!Note]  
    > Если узел не найден, не вызывайте [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) и [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).

     

-   Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями в зависимости от того, подключен ли узел к одноранговой диаграмме или нет. Например, приложение может выбрать время ожидания или периодическое выполнение обнаружения активного узла в графе.
-   Закройте подключение к одноранговой диаграмме. Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).

## <a name="when-peergraphopen-returns-peer_s_data_created"></a>Когда Пирграфопен возвращает созданные одноранговые \_ \_ данные S \_

Когда [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает **созданные одноранговые \_ \_ данные \_ S**, это означает, что существующая база данных для однорангового графа не найдена, создается новая база данных и открывается при первом запуске. Для использования или прослушивания однорангового графа необходимо подключение к одноранговой диаграмме и синхронизация с одноранговой диаграммой.

Следующая процедура позволяет определить, что можно сделать для открытия однорангового графа, когда вызов [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen) возвращает **созданные одноранговые \_ \_ данные \_ S**.

-   Откройте одноранговый граф. Вызовите [**пирграфопен**](/windows/desktop/api/P2P/nf-p2p-peergraphopen).
-   Регистрация для событий одноранговых узлов. Вызовите [**пирграфрегистеревент**](/windows/desktop/api/P2P/nf-p2p-peergraphregisterevent).
    > [!Note]  
    > Дополнительные сведения о регистрации событий одноранговых узлов см. в разделе [инфраструктура событий](peer-events-infrastructure.md).

     

-   Нахождение узла. Это процесс, выполняемый за пределами инфраструктуры одноранговых диаграмм, с помощью метода или приложения, которые вы определяете. API одноранговых диаграмм не предоставляет специальный механизм поиска исходного узла графа для подключения. Приложение должно использовать другой механизм, например API [протокола PNRP](pnrp-namespace-provider-api.md) , для определения местонахождения исходного узла.
-   Если узел найден, подключитесь к нему. Вызовите [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect), а затем вызовите [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten) для прослушивания соединений с одноранговый граф.
    > [!Note]  
    > Если узел не найден, не вызывайте [**пирграфконнект**](/windows/desktop/api/P2P/nf-p2p-peergraphconnect) и [**пирграфлистен**](/windows/desktop/api/P2P/nf-p2p-peergraphlisten).

     

-   Выполнение функций, зависящих от приложения, для оставшейся части времени выполнения, например обработка одноранговых событий и работа с соединениями в зависимости от того, подключен ли узел к одноранговой диаграмме или нет. Например, приложение может выбрать время ожидания или периодическое выполнение обнаружения активного узла в графе.
-   Закройте подключение к одноранговой диаграмме. Вызовите [**пирграфклосе**](/windows/desktop/api/P2P/nf-p2p-peergraphclose).

 

 



