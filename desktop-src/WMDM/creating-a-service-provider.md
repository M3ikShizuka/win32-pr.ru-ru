---
title: Создание поставщика услуг
description: Создание поставщика услуг
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Диспетчер устройств Windows Media, создание поставщиков услуг
- Диспетчер устройств, создание поставщиков услуг
- Диспетчер устройств Windows Media, программное руководством
- Диспетчер устройств, программное руководством
- рекомендации по программированию, поставщики услуг
- инструкции по программированию, Windows Media диспетчер устройств
- инструкции по программированию, создание поставщиков услуг
- Диспетчер устройств Windows Media, поставщики услуг
- Диспетчер устройств, поставщики услуг
- поставщики услуг, создание
- Создание поставщиков услуг, сведения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105691528"
---
# <a name="creating-a-service-provider"></a>Создание поставщика услуг

Поставщик услуг — это компонент, который выступает в качестве середины между приложением и устройством. Windows Media диспетчер устройств направляет запросы от приложения к поставщику услуг, который затем отвечает за взаимодействие с устройством или выполнение запрошенного действия. Поставщик услуг обычно взаимодействует с драйвером для обеспечения взаимодействия с устройством. Поставщик услуг — это COM-компонент, реализующий интерфейсы, вызываемые Windows Media диспетчер устройств. Корневой интерфейс объекта поставщика услуг — [**имдсервицепровидер**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider). После получения этого интерфейса диспетчер устройств Windows Media может получить другие интерфейсы через реализацию различных методов поставщика услуг. Интерфейсы, которые должен реализовать поставщик службы, перечислены в списке [обязательные и необязательные интерфейсы](mandatory-and-optional-interfaces.md). Иерархия интерфейсов показана в [интерфейсах для поставщиков служб](interfaces-for-service-providers.md).

> [!Note]  
> Не пытайтесь создать поставщик службы MTP; Вместо этого следует использовать поставщик услуг MTP и драйверы, предоставляемые корпорацией Майкрософт.

 

Прежде чем пытаться создать поставщик услуг, необходимо тщательно разобраться в том, какие вызовы приложение будет выполнять на поставщике услуг. Ознакомьтесь с [созданием приложения Диспетчер устройств Windows Media](creating-a-windows-media-device-manager-application.md) , чтобы получить представление о базовых задачах и вызовах, которые приложение будет делать на поставщике услуг при попытке связаться с устройством.

В следующем списке приведены основные этапы разработки поставщика услуг.

1.  Включите (и при необходимости Скомпилируйте) необходимые файлы заголовка и библиотеки для проекта. Список необходимых файлов см. в разделе [необходимые библиотеки и заголовки для поставщика услуг](required-libraries-and-headers-for-a-service-provider.md) .
2.  Реализуйте все остальные обязательные или необязательные интерфейсы поставщика услуг (см. раздел [обязательные и необязательные интерфейсы](mandatory-and-optional-interfaces.md)). Как правило, интерфейсы будут вызываться в следующем порядке:
    -   [**икомпонентаусентикате**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   [**Имдсервицепровидер**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2
    -   [**имдспенумдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   [**Имдспдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2
    -   [**имдспенумстораже**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   [**Имдспстораже**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3
3.  Убедитесь, что поставщик услуг или устройство установили правильные разделы реестра во время установки. В этих разделах указываются параметры устройства, регистрируется поставщик услуг в качестве подключаемого модуля и включается самонастраивающийся уведомлений о доходе и удалении устройства. См. раздел [Параметры устройства](device-parameters.md), [Регистрация поставщика услуг](registering-the-service-provider.md)и [Включение PnP для устройств](enabling-pnp-for-devices.md).
4.  При создании экземпляра класса Проверьте подлинность поставщика службы в конструкторе. Для этого создайте класс [ксекуречаннелсервер](csecurechannelserver-class.md) и задайте сертификат. Реализуйте интерфейс [**икомпонентаусентикате**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) и вызовите методы класса ксекуречаннелсервер, созданного ранее. Сведения о том, как создать экземпляр класса Ксекуречаннелсервер и реализовать методы Икомпонентаусентикате, см. в разделе [Проверка подлинности поставщика услуг](authenticating-the-service-provider.md) .
5.  Диспетчер устройств Windows Media запрашивает у поставщика услуг список подключенных устройств, вызывая [**IMDServiceProvider2:: креатедевице**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) или [**Имдсервицепровидер:: енумдевицес**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices)в зависимости от того, обрабатывает ли поставщик службы Самонастраивающийся устройства. Поставщик услуг должен возвращать список объектов [**имдспдевице**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) , представляющих подключенные устройства. Дополнительные сведения см. в разделе [Перечисление устройств](enumerating-devices-service-provider.md) .
6.  Перед обработкой любого вызова убедитесь, что установлен безопасный канал. Вызовите метод [**ксекуречаннелсервер:: фисаусентикатед**](/previous-versions/bb231600(v=vs.85)) перед выполнением каких бы то ни было действий. Если этот вызов завершается неудачей, возвращается ВМДМ \_ E \_ нотцертифиед.
7.  Для работы с материалами, защищенными с помощью DRM, вам потребуется пара сертификатов или ключей, выпущенная корпорацией Майкрософт. Дополнительные сведения см. [в разделе Обработка защищенного содержимого в поставщике услуг](handling-protected-content-in-the-service-provider.md) .
8.  Чтобы устройство было автоматически синхронизировано с проигрывателем Windows Media, оно должно удовлетворять требованиям, перечисленным в подсистеме " [Включение синхронизации с помощью проигрывателя Windows Media](enabling-synchronization-with-windows-media-player.md)".
9.  Чтобы устройство отображалось в проводнике Windows, необходимо выполнить несколько специальных действий, а также подробное описание [требований к отображению портативных проигрывателей в проводнике Windows](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Инструкции по программированию**](programming-guide.md)
</dt> </dl>

 

 