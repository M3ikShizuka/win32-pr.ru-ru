---
title: Структура примера классического приложения
description: Структура примера классического приложения
ms.assetid: e042470d-dc78-488c-bcad-2e8d34714d5d
keywords:
- Windows Диспетчер устройств мультимедиа, примеры
- Диспетчер устройств, примеры
- Классические приложения, примеры
- Windows Диспетчер устройств мультимедиа, пример классического приложения
- Диспетчер устройств, пример классического приложения
- Примеры, классические приложения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a7dde8250a5efc8bc0f0b9582739bd8770d95ee586ea571a43bcbb9be69e8774
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119957164"
---
# <a name="structure-of-the-sample-desktop-application"></a>Структура примера классического приложения

Пример классического приложения состоит из двух основных частей:

-   Проект вмдапп содержит большинство классов, которые отображают пользовательский интерфейс, выполняют перетаскивание и выполняют все необходимые функции программы.
-   Проект прогхелп — это вспомогательное приложение, которое содержит ненужные классы для обслуживания уведомлений о состоянии и передачи файлов вручную с рабочего стола в приложение.

Исполняемый проект используется во вспомогательном проекте только в том случае, если пользователь выбирает **параметр** **использовать интерфейс операции** в меню Параметры для обработки вручную перемещения файлов на устройство, а также для увеличения строки состояния в форме ход загрузки. Все остальные приложения обрабатываются в проекте вмдапп.



| Класс                | Файл                    | Описание                                                                                                                                                                                                                                                                                                                                                                                     |
|----------------------|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| —                    | вмдмапп. cpp             | Класс, обрабатывающий родительское окно пользовательского интерфейса. Код в этом файле также обрабатывает некоторые входные пользователем данные, не обрабатываемые Кдевфилес, такие как создание списка воспроизведения или альбома на устройстве, удаление файлов и регистрация вариантов меню.                                                                                                                                                    |
| кдевицес             | Devices. cpp             | Класс, обрабатывающий левую панель главного окна приложения, где перечислены доступные устройства. Этот класс управляет циклом обмена сообщениями, который обрабатывает входные данные пользователя, такие как выбор устройства и уведомление панели Кдевфилес для загрузки соответствующих файлов при изменении выбора устройства.                                                                              |
| кдевфилес            | Девфилес. cpp            | Класс, обрабатывающий правую панель главного окна приложения, где перечислены файлы на выбранном устройстве. Этот класс управляет циклом обмена сообщениями и обрабатывает вводимые пользователем данные, такие как перетаскивание файлов на устройство и удаление файлов с устройства.                                                                                                                          |
| кстатус              | Status. cpp              | Класс, обрабатывающий нижнюю строку состояния в главном окне, где указано количество устройств и файлов, а также объем свободной и используемой памяти на выбранном устройстве.                                                                                                                                                                                                         |
| квмдм                | Вмдевмгр. cpp            | интерфейс верхнего уровня для Windows диспетчер устройств мультимедиа. Этот класс обрабатывает проверку подлинности, получает интерфейс **ивмдевицеманажер** верхнего уровня и регистрирует уведомления с помощью интерфейса **ивмдмнотификатион** .                                                                                                                                                                  |
| кпрогресс            | Progress. cpp            | Класс в главном проекте приложения, который создает и управляет диалоговым окном, отображающим ход выполнения события.                                                                                                                                                                                                                                                                             |
| Цитемдата            | Итемдата. cpp            | Класс-оболочка, который содержит указатель на хранилище (если представляет собой файл или папку на устройстве) или устройство (если представляет устройство), а также различные сведения об объекте, включая размер и атрибуты.                                                                                                                                                                  |
| кнотификатионхандлер | Нотификатионхандлер. cpp | Обрабатывает уведомления о получении и удалении устройств, уведомляя окно Кдевицес.                                                                                                                                                                                                                                                                                                               |
| кпрогресшелпер      | Прогресшелпер. cpp      | создано кдевфилес в локальных функциях для получения уведомлений от Windows мультимедиа диспетчер устройств путем реализации **ивмдмпрогресс**. Он используется классом Кпрогресс для определения объема полос на индикаторе выполнения и по завершении действия. Этот класс определен как COM-объект, предоставляющий интерфейс SDK **ивмдмпрогресс** и пользовательский интерфейс ивмдмпрогресшелпер. |
| коператионхелпер     | Оператионхелпер. cpp     | Этот класс реализует **ивмдмоператион** для выполнения ручной пересылки файлов. Это многопоточный процесс, позволяющий асинхронно выполняться и определяться как COM-объект, предоставляющий пользовательский интерфейс Ивмдмоператионхелпер для создания и инициализации класса. Этот класс используется только в том случае, если пользователь выбирает параметр "использовать интерфейс операции" в меню " **Параметры** ".                            |



 

В следующих списках описаны основные шаги, выполняемые для различных действий пользователя.

**При запуске**

При запуске примера приложения выполняются следующие основные шаги.

1.  Выполняется создание экземпляра и проверка подлинности глобальной переменной КВМДМ, а также регистрация для получения уведомлений.
2.  Создается глобальный Кдевицес, и вызывается Кдевицес:: Create для создания и заполнения панели устройства.
3.  Создается глобальный Кдевфилес, и вызывается Кдевфилес:: Create, чтобы создать панель файлов (которая не заполняется до тех пор, пока пользователь не выберет устройство).
4.  Создается глобальный Кстатус, и вызывается Кстатус:: Create для создания экземпляра строки состояния.
5.  \_Онвиеврефреш перечисляет все устройства и инициализирует и добавляет все устройства (Цитемдата) в Кдевицес и обновляет строку состояния для отображения числа устройств.
6.  Кдевицес:: AddItem добавляет элемент в TreeView, представляющий устройства, с указателем на себя в виде ТВИТЕМ. lParam. Все объекты Кдевице (Devices) и Кдевфилес (File) хранятся в этом элементе узла TreeView в соответствующем окне.

**Выбор устройства**

Следующие основные шаги выполняются, когда пользователь выбирает устройство в левой области окна приложения.

1.  Окно Кдевицес перехватывает щелчок и отправляет \_ сообщение УПДАТЕДЕВИЦЕ WM DRM \_ в само себя.
2.  Кдевицес получает собственное сообщение и вызывает UpdateSelection, который сообщает глобальному объекту Кдевфилес очистить все, перечислить все элементы верхнего уровня на устройстве и вызывает Кдевфилес:: AddItem, чтобы добавить их в область "файлы".
3.  Наконец, Кдевицес вызывает Кдевфилес:: Упдатестатусбар, чтобы обновить строку состояния, указав правильные сведения об устройстве и файле.

**Создание списка воспроизведения**

После нажатия кнопки "создать список воспроизведения" в меню " **контейнеры** " приложение вызывает локальную функцию \_ онкреатеплайлист, которая выполняет следующие действия:

1.  Получение числа выбранных элементов из глобальной переменной Кдевфилес.
2.  Вызовите локальную функцию Длгнамеплайлист, чтобы открыть диалоговое окно для получения имени списка воспроизведения.
3.  Вызовите метод Кпрогресс:: Create, чтобы создать диалоговое окно, отображающее ход выполнения действия, и задайте параметры для класса Кпрогресс, такие как текст заголовка, диапазон, текущее значение и т. д.
4.  Перебрать все выбранные элементы в объекте представления в виде дерева Кдевфилес и запросите объект Цитемдата, связанный с каждым выбранным файлом в представлении в виде дерева, увеличив диалоговое окно хода выполнения на каждый файл. Файлы добавляются в массив интерфейсов [**ивмдмстораже**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage) .
5.  Получить маркер текущего выбранного элемента и запросить его для интерфейса [**IWMDMStorageControl3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstoragecontrol3) , который будет использоваться позже для создания нового списка воспроизведения на устройстве.
6.  Запросите выбранный объект для [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3)и вызовите [**креатимптиметадатаобжект**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-createemptymetadataobject) , чтобы создать новый интерфейс [**ивмдмметадата**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmmetadata).
7.  Добавьте \_ \_ код формата вмдм форматкоде абстрактаудиовидеоплайлист в новый интерфейс **ивмдмметадата** и создайте список воспроизведения на устройстве, вызвав [**IWMDMStorageControl3:: Insert3**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstoragecontrol3-insert3), передав интерфейс метаданных. Метод получает указатель на новый **ивмдмстораже** на устройстве.
8.  Заполните список воспроизведения, запросив новое хранилище для [**IWMDMStorage4**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage4)и вызвав [**IWMDMStorage4:: сетреференцес**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage4-setreferences), передав массив **ивмдмстораженых** указателей, собранных на шаге 4.
9.  Наконец, создайте новый объект Цитемдата для хранения нового списка воспроизведения на устройстве, инициализируйте его с новым хранилищем и вызовите Кдевфилес:: AddItem, чтобы добавить его в область Кдевфилес.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Пример классического приложения**](sample-desktop-application.md)
</dt> </dl>

 

 




