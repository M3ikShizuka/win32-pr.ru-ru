---
title: О вводе с помощью мыши
description: В этом разделе рассматривается ввод с помощью мыши.
ms.assetid: 1f945a31-76d5-4e23-a55a-769ca114dbe9
keywords:
- Ввод данных пользователем, ввод с помощью мыши
- захват вводимых пользователем данных, ввод с помощью мыши
- ввод мыши
- указатель мыши
- курсоры, ввод с помощью мыши
- захват мыши
- Залипание мыши
- ксбуттонс
- Настройка мыши
- сообщения мыши
- Сообщение WM_NCHITTEST
- Специальные возможности мыши в режиме «исчезновение»
- Специальные возможности Sonar мыши
- колесо мыши
- Сообщение WM_MOUSEWHEEL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f2294027cb4ca2c97371a7a06c90a7e46188e3b7
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127461085"
---
# <a name="about-mouse-input"></a>О вводе с помощью мыши

Мышь — это важное, но необязательное пользовательское устройство ввода для приложений. Хорошо написанное приложение должно включать интерфейс мыши, но он не должен зависеть от мыши для получения вводимых пользователем данных. Приложение должно также обеспечивать полную поддержку клавиатуры.

Приложение получает ввод с помощью указателя мыши в форме сообщений, которые отправляются или публикуются в окнах.

В этом разделе описываются следующие темы:

-   [Курсор мыши](#mouse-cursor)
-   [Захват мыши](#mouse-capture)
-   [Залипание мыши](#mouse-clicklock)
-   [Настройка мыши](#mouse-configuration)
-   [ксбуттонс](#xbuttons)
-   [Сообщения мыши](#mouse-messages)
    -   [Сообщения мыши в области клиента](#client-area-mouse-messages)
    -   [Сообщения мыши неклиентской области](#nonclient-area-mouse-messages)
    -   [\_Сообщение НЧИТТЕСТ WM](/windows)
-   [Sonar мыши](#mouse-sonar)
-   [Кнопка "исчезновение"](#mouse-vanish)
-   [Колесико мыши](#the-mouse-wheel)
-   [Активация окна](#window-activation)

## <a name="mouse-cursor"></a>Курсор мыши

Когда пользователь перемещает мышь, система перемещает точечный рисунок на экране, который называется *курсором мыши*. Курсор мыши содержит точку с одним пикселем, называемую *активной* точкой, точку, которую система отслеживает и распознает как позицию курсора. При возникновении события мыши окно, содержащее активную точку, обычно получает сообщение мыши, полученное от события. Окно не должно быть активным или иметь фокус клавиатуры для получения сообщения мыши.

Система поддерживает переменную, управляющую скоростью мыши, то есть расстояние, на которое курсор перемещается, когда пользователь перемещает указатель мыши. Для получения или установки скорости мыши можно использовать функцию [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa) с флагом **SPI \_ Mouse** или **SPI \_ сетмаусе** . Дополнительные сведения о курсорах мыши см. в разделе [курсоры](/windows/desktop/menurc/cursors).

## <a name="mouse-capture"></a>Захват мыши

Обычно система отправляет в окно сообщение, содержащее активную точку курсора при возникновении события мыши. Приложение может изменить это поведение, используя функцию [**сеткаптуре**](/windows/win32/api/winuser/nf-winuser-setcapture) для перенаправления сообщений мыши в определенное окно. Окно получает все сообщения мыши до тех пор, пока приложение не вызовет функцию [**релеасекаптуре**](/windows/win32/api/winuser/nf-winuser-releasecapture) или не указывает другое окно захвата или пока пользователь не щелкнет окно, созданное другим потоком.

При изменении захвата мыши система отправляет в окно сообщение [**WM \_ каптуречанжед**](wm-capturechanged.md) , которое теряет захват мыши. Параметр *lParam* сообщения задает маркер окна, который получает захват мыши.

Только окно переднего плана может записывать ввод мыши. Когда окно в фоновом режиме пытается захватить ввод мыши, оно получает сообщения только для событий мыши, возникающих, когда активная область курсора находится в видимой части окна.

Захват ввода мыши удобен, если окно должно получить все входные данные мыши, даже когда курсор перемещается за пределы окна. Например, приложение обычно отслеживает позицию курсора после события нажатия кнопки мыши, следуя за курсором, пока не произойдет событие нажатия кнопки мыши. Если приложение не захватывает ввод мыши и пользователь отпускает кнопку мыши за пределами окна, окно не получает кнопку.

Поток может использовать функцию- [**захват**](/windows/win32/api/winuser/nf-winuser-getcapture) , чтобы определить, была ли одна из ее окон захвачена мышью. Если одно из окон потока захватило мышь, то **захват** Извлекает маркер окна.

## <a name="mouse-clicklock"></a>Залипание мыши

Функция залипания клавиш мыши позволяет пользователю блокировать основную кнопку мыши после одного щелчка. Для приложения кнопка по-прежнему отображается нажатой. Чтобы разблокировать кнопку, приложение может отправить любое сообщение мыши, или пользователь может щелкнуть любую кнопку мыши. Эта функция позволяет пользователю более просто выполнять сложные комбинации мыши. Например, с определенными физическими ограничениями можно выделить текст, перетащить объекты или легко открыть меню. Дополнительные сведения см. в следующих флагах и примечаниях в [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa):

-   **SPI \_ жетмаусекликклокк**
-   **SPI \_ сетмаусекликклокк**
-   **SPI \_ жетмаусекликклокктиме**
-   **SPI \_ сетмаусекликклокктиме**

## <a name="mouse-configuration"></a>Настройка мыши

Хотя мышь является важным устройством ввода для приложений, не все пользователи должны иметь мышь. Приложение может определить, включает ли система мышь, передав значение **SM \_ маусепресент** в функцию [**жетсистемметрикс**](/windows/desktop/api/winuser/nf-winuser-getsystemmetrics) .

Windows поддерживает мышь с тремя кнопками. При помощи мыши с тремя кнопками кнопки обозначены как левая, средняя и правая кнопки. Сообщения и именованные константы, связанные с кнопками мыши, используют буквы L, M и R для обозначения кнопок. Кнопка в однокнопкной мыши рассматривается как левая кнопка. несмотря на то, что Windows поддерживает мышь с несколькими кнопками, большинство приложений используют левую кнопку в основном, а другие — в том случае, если вообще.

Приложения также могут поддерживать колесико мыши. Колесо мыши можно нажать или повернуть. При нажатии колесика мыши оно действует как средняя (третья) кнопка, которая отправляет обычные сообщения средней кнопки в приложение. При повернутом приложении в приложение отправляется сообщение с колесиком. Дополнительные сведения см. [в разделе колесико мыши](#the-mouse-wheel) .

Приложения могут поддерживать кнопки для команд приложения. Эти кнопки, называемые кнопками X, предназначены для упрощения доступа к Интернет браузера, электронной почте и службам мультимедиа. При нажатии кнопки X в приложение отправляется сообщение [**WM \_ аппкомманд**](wm-appcommand.md) . Дополнительные сведения см. в описании в сообщении **WM \_ аппкомманд** .

Приложение может определить количество кнопок мыши, передав значение **SM \_ Кмаусебуттонс** функции [**жетсистемметрикс**](/windows/desktop/api/winuser/nf-winuser-getsystemmetrics) . Чтобы настроить мышь для левого пользователя, приложение может использовать функцию [**свапмаусебуттон**](/windows/win32/api/winuser/nf-winuser-swapmousebutton) , чтобы изменить значение левой и правой кнопок мыши. Передача значения **SPI \_ сетмаусебуттонсвап** в функцию [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa) является еще одним способом изменить значение кнопок. Однако обратите внимание, что мышь является общим ресурсом, поэтому обратная часть значения кнопок влияет на все приложения.

## <a name="xbuttons"></a>ксбуттонс

Windows поддерживает мышь с пятью кнопками. В дополнение к левой, средней и правой кнопкам есть XBUTTON1 и XBUTTON2, которые обеспечивают обратную и прямую навигацию при использовании браузера.

Диспетчер окон поддерживает XBUTTON1 и XBUTTON2 через **\_ сообщения WM ксбуттон \* *_ и _* WM \_ нкксбуттон \* *_. HIWORD _* wParam** в этих сообщениях содержит флаг, указывающий, какая кнопка X была нажата. Так как эти сообщения мыши также соответствуют константам **WM \_ Маусефирст** и **WM \_ мауселаст**, приложение может отфильтровать все сообщения мыши [**с помощью**](/windows/desktop/api/winuser/nf-winuser-getmessage) или [**PeekMessage**](/windows/desktop/api/winuser/nf-winuser-peekmessagea).

Следующие поддерживают XBUTTON1 и XBUTTON2:

-   [**WM \_ аппкомманд**](wm-appcommand.md)
-   [**WM \_ нкксбуттондблклк**](wm-ncxbuttondblclk.md)
-   [**WM \_ нкксбуттондовн**](wm-ncxbuttondown.md)
-   [**WM \_ нкксбуттонуп**](wm-ncxbuttonup.md)
-   [**WM \_ ксбуттондблклк**](wm-xbuttondblclk.md)
-   [**WM \_ ксбуттондовн**](wm-xbuttondown.md)
-   [**WM \_ ксбуттонуп**](wm-xbuttonup.md)
-   [**маусехукструктекс**](/windows/win32/api/winuser/ns-winuser-mousehookstructex)

Для поддержки этих кнопок были изменены следующие API:

-   [**\_событие мыши**](/windows/win32/api/winuser/nf-winuser-mouse_event)
-   [**шеллпрок**](/previous-versions/windows/desktop/legacy/ms644991(v=vs.85))
-   [**мсллхукструкт**](/windows/win32/api/winuser/ns-winuser-msllhookstruct)
-   [**маусеинпут**](/windows/win32/api/winuser/ns-winuser-mouseinput)
-   [**WM \_ парентнотифи**](/previous-versions/windows/desktop/inputmsg/wm-parentnotify)

Маловероятно, что дочернее окно в приложении компонента сможет напрямую реализовать команды для XBUTTON1 и XBUTTON2. Поэтому [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) отправляет сообщение [**WM \_ аппкомманд**](wm-appcommand.md) в окно при нажатии кнопки X. **Дефвиндовпрок** также отправляет сообщение **WM \_ аппкомманд** в родительское окно. Это похоже на то, как контекстное меню вызывается щелчком правой кнопкой мыши —**дефвиндовпрок** отправляет в меню сообщение [**WM \_ CONTEXTMENU**](/windows/desktop/menurc/wm-contextmenu) , а также отправляет его родительскому элементу. Кроме того, если **дефвиндовпрок** получает сообщение **WM \_ аппкомманд** для окна верхнего уровня, оно вызывает обработчик оболочки с кодом хшелл \_ аппкомманд.

Поддерживаются клавиатуры с дополнительными ключами для функций браузера, функций мультимедиа, запуска приложений и управления питанием. Дополнительные сведения см. в разделе [клавиши клавиатуры для просмотра и других функций](about-keyboard-input.md).

## <a name="mouse-messages"></a>Сообщения мыши

Мышь создает событие ввода, когда пользователь перемещает мышь, либо нажимает или отпускает кнопку мыши. Система преобразует события ввода мыши в сообщения и отправляет их в очередь сообщений соответствующего потока. Когда сообщения мыши публикуются быстрее, чем поток может обработать их, система отклоняет все, кроме последнего сообщения мыши.

Окно получает сообщение мыши при возникновении события мыши в тот момент, когда курсор находится внутри границ окна, или когда окно захватывает мышь. Сообщения мыши делятся на две группы: сообщения клиентской области и сообщения неклиентской области. Как правило, приложение обрабатывает сообщения в клиентской области и игнорирует сообщения области, не являющиеся клиентами.

В этом разделе описываются следующие темы:

-   [Сообщения мыши в области клиента](#client-area-mouse-messages)
-   [Сообщения мыши неклиентской области](#nonclient-area-mouse-messages)
-   [\_Сообщение НЧИТТЕСТ WM](/windows)

### <a name="client-area-mouse-messages"></a>Сообщения мыши в области клиента

Окно получает сообщение мыши клиентской области при возникновении события мыши в клиентской области окна. Система отправляет сообщение [**WM \_ MOUSEMOVE**](wm-mousemove.md) в окно, когда пользователь перемещает курсор в клиентскую область. Он отправляет одно из следующих сообщений, когда пользователь нажимает или отпускает кнопку мыши, когда курсор находится внутри области клиента.



| Сообщение                                       | Значение                                     |
|-----------------------------------------------|---------------------------------------------|
| [**WM \_ лбуттондблклк**](wm-lbuttondblclk.md) | При двойном щелчке мышью была нажата левая кнопка мыши.   |
| [**WM \_ лбуттондовн**](wm-lbuttondown.md)     | Была нажата левая кнопка мыши.          |
| [**WM \_ лбуттонуп**](wm-lbuttonup.md)         | Была отжата левая кнопка мыши.         |
| [**WM \_ мбуттондблклк**](wm-mbuttondblclk.md) | Дважды щелкнуть среднюю кнопку мыши. |
| [**WM \_ мбуттондовн**](wm-mbuttondown.md)     | Была нажата средняя кнопка мыши.        |
| [**WM \_ мбуттонуп**](wm-mbuttonup.md)         | Была освобождена средняя кнопка мыши.       |
| [**WM \_ рбуттондблклк**](wm-rbuttondblclk.md) | Дважды щелкнули правую кнопку мыши.  |
| [**WM \_ рбуттондовн**](wm-rbuttondown.md)     | Была нажата правая кнопка мыши.         |
| [**WM \_ рбуттонуп**](wm-rbuttonup.md)         | Была отжата правая кнопка мыши.        |
| [**WM \_ ксбуттондблклк**](wm-xbuttondblclk.md) | Двойным щелчком мыши была нажата клавиша X.       |
| [**WM \_ ксбуттондовн**](wm-xbuttondown.md)     | Нажата кнопка мыши X.              |
| [**WM \_ ксбуттонуп**](wm-xbuttonup.md)         | Была отжата кнопка мыши X.             |



 

Кроме того, приложение может вызвать функцию [**TrackMouseEven**](/windows/win32/api/winuser/nf-winuser-trackmouseevent) , чтобы система отправляла два других сообщения. Он отправляет сообщение [**WM \_ маусеховер**](wm-mousehover.md) при наведении курсора на клиентскую область в течение определенного периода времени. Он отправляет сообщение [**WM \_ MOUSELEAVE**](wm-mouseleave.md) , когда курсор покидает клиентскую область.

### <a name="message-parameters"></a>Параметры сообщения

Параметр *lParam* сообщения мыши клиентской области указывает позицию активной точки курсора. Слово нижнего порядка Указывает координату по оси x активной точки, а в верхнем порядке слово, указывающее координату y. Координаты указываются в клиентских координатах. В клиентской системе координат все точки на экране указываются относительно координат (0, 0) верхнего левого угла клиентской области.

Параметр *wParam* содержит флаги, указывающие состояние других кнопок мыши, а также клавиши CTRL и Shift во время события мыши. Эти флаги можно проверять, когда обработка сообщений мыши зависит от состояния другой кнопки мыши или клавиши CTRL или SHIFT. Параметр *wParam* может быть сочетанием следующих значений.



| Значение            | Описание                      |
|------------------|----------------------------------|
| **MK, \_ элемент управления**  | Нажата клавиша CTRL.            |
| **MK \_ лбуттон**  | Левая кнопка мыши не работает.   |
| **MK \_ мбуттон**  | Средняя кнопка мыши не работает. |
| **MK \_ рбуттон**  | Нажата правая кнопка мыши.  |
| **MK \_ SHIFT**    | Нажата клавиша SHIFT.           |
| **MK \_ XBUTTON1** | Первая кнопка X не работает.      |
| **MK \_ XBUTTON2** | Вторая кнопка X не работает.     |



 

### <a name="double-click-messages"></a>Сообщения Double-Click

Система создает сообщение двойного щелчка, когда пользователь дважды нажимает кнопку мыши для быстрого выполнения. Когда пользователь нажимает кнопку, система устанавливает прямоугольник вокруг активной точки курсора. Он также отмечает время, когда произошло нажатие. Когда пользователь нажимает одну и ту же кнопку во второй раз, система определяет, остается ли активная область в прямоугольнике, и вычисляет время, прошедшее с момента первого щелчка. Если активная область по-прежнему находится в пределах прямоугольника, а истекшее время не превышает значение времени ожидания двойного щелчка, система создает сообщение двойного щелчка.

Приложение может получать и задавать значения времени ожидания двойного щелчка с помощью функций [**жетдаублекликктиме**](/windows/win32/api/winuser/nf-winuser-getdoubleclicktime) и [**сетдаублекликктиме**](/windows/win32/api/winuser/nf-winuser-setdoubleclicktime) соответственно. Кроме того, приложение может установить значение двойного щелчка, используя флаг **SPI \_ сетдаублекликктиме** с функцией [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa) . Также можно задать размер прямоугольника, который система использует для обнаружения двойных щелчков, передав флаги **SPI \_ Сетдаублеклквидс** и **SPI \_ сетдаублеклкхеигхт** в **системпараметерсинфо**. Однако обратите внимание, что установка двойного щелчка — значения времени ожидания и прямоугольника влияет на все приложения.

Определяемое приложением окно по умолчанию не получает сообщения двойного щелчка. Из-за системных издержек, связанных с созданием сообщений двойного щелчка, эти сообщения создаются только для Windows, принадлежащих классам, имеющим стиль класса **CS \_ дблклкс** . Приложение должно задать этот стиль при регистрации класса окна. Дополнительные сведения см. в разделе [классы окон](/windows/desktop/winmsg/window-classes).

Сообщение двойного щелчка всегда является третьим сообщением в серии из четырех сообщений. Первыми двумя сообщениями являются кнопки и кнопки, созданные при первом щелчке. Второй щелчок создает сообщение двойного щелчка, за которым следует еще одно сообщение кнопки. Например, двойной щелчок левой кнопкой мыши создает следующую последовательность сообщений:

1.  [**WM \_ лбуттондовн**](wm-lbuttondown.md)
2.  [**WM \_ лбуттонуп**](wm-lbuttonup.md)
3.  [**WM \_ лбуттондблклк**](wm-lbuttondblclk.md)
4.  [**WM \_ лбуттонуп**](wm-lbuttonup.md)

Поскольку окно всегда получает сообщение о нажатии кнопки перед получением сообщения двойного щелчка, приложение обычно использует сообщение двойного щелчка для расширения задачи, которая была начата во время выполнения кнопки. например, когда пользователь щелкает цвет в цветовой палитре Microsoft Paint, Paint отображает выбранный цвет рядом с палитрой. когда пользователь дважды щелкает цвет, Paint отображает цвет и открывает диалоговое окно **изменение цветов** .

### <a name="nonclient-area-mouse-messages"></a>Сообщения мыши неклиентской области

При возникновении события мыши в любой части окна, за исключением клиентской области, окно получает сообщение о неклиентской области. Неклиентская область окна состоит из его границ, строки меню, строки заголовка, полосы прокрутки, меню окна, кнопки сворачивания и кнопки развернуть.

Система создает сообщения области, не являющиеся клиентами, в основном для собственного использования. Например, система использует сообщения области, не являющиеся клиентами, для изменения курсора на двустороннюю стрелку, когда активная область курсора перемещается в границу окна. Чтобы воспользоваться преимуществами встроенного интерфейса мыши, окно должно передать в функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) сообщения мыши неклиентской области.

Для каждого сообщения мыши клиентской области имеется соответствующее сообщение, не относящееся к клиентской области. Имена этих сообщений похожи, за исключением того, что именованные константы неклиентской области содержат имя NC. Например, при перемещении курсора в неклиентской области создается сообщение [**WM \_ нкмаусемове**](wm-ncmousemove.md) и нажимается левая кнопка мыши, когда курсор находится в неклиентской области, создает сообщение [**WM \_ нклбуттондовн**](wm-nclbuttondown.md) .

Параметр *lParam* сообщения мыши неклиентской области — это структура, содержащая координаты x и y для активной точки курсора. В отличие от координат сообщений мыши в области клиента, координаты указываются в экранных координатах, а не в клиентских координатах. В системе координат экрана все точки на экране зависят от координат (0, 0) верхнего левого угла экрана.

Параметр *wParam* содержит значение проверки нажатия, значение, указывающее, где в неклиентской области произошло событие мыши. В следующем разделе объясняется назначение значений проверки попадания.

### <a name="the-wm_nchittest-message"></a>\_Сообщение НЧИТТЕСТ WM

Всякий раз, когда происходит событие мыши, система отправляет сообщение [**WM \_ нчиттест**](wm-nchittest.md) в окно, содержащее активную точку курсора, или на окно, которое захватывает мышь. Система использует это сообщение, чтобы определить, следует ли отсылать сообщение клиентской области или неклиентской области. Приложение, которое должно получить сообщения указателя мыши и кнопки мыши, должно передавать сообщение **WM \_ нчиттест** в функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) .

Параметр *lParam* сообщения [**WM \_ нчиттест**](wm-nchittest.md) содержит экранные координаты активной точки курсора. Функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) проверяет координаты и возвращает значение проверки попадания, которое указывает расположение горячей точки. Значение проверки попадания может принимать одно из следующих значений.



| Значение             | Расположение горячей точки                                                                                                                                                                                |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **хтбордер**      | В границах окна, у которых нет границы изменения размера.                                                                                                                                       |
| **хтботтом**      | В нижней горизонтальной границе окна.                                                                                                                                                         |
| **хтботтомлефт**  | В левом нижнем углу границы окна.                                                                                                                                                        |
| **хтботтомригхт** | В правом нижнем углу границы окна.                                                                                                                                                       |
| **хткаптион**     | В заголовке окна.                                                                                                                                                                                     |
| **хтклиент**      | В клиентской области.                                                                                                                                                                                   |
| **хтклосе**       | В кнопке **Закрыть** .                                                                                                                                                                              |
| **хтеррор**       | На фоне экрана или на разделительной линии между окнами (то же, что и ХТНОВХЕРЕ, за исключением того, что функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) выдает системный сигнал для указания на ошибку). |
| **хтгровбокс**     | В поле размера (то же, что и **хтсизе**).                                                                                                                                                                 |
| **хселп**        | В кнопке **справки** .                                                                                                                                                                               |
| **хсскролл**     | В горизонтальной полосе прокрутки.                                                                                                                                                                         |
| **хтлефт**        | В левой границе окна.                                                                                                                                                                     |
| **хтмену**        | В меню.                                                                                                                                                                                          |
| **хтмаксбуттон**   | В кнопке **развертывания** .                                                                                                                                                                           |
| **хтминбуттон**   | В кнопке **сворачивания** .                                                                                                                                                                           |
| **хтновхере**     | На фоне экрана или на разделительной линии между окнами.                                                                                                                                     |
| **хтредуце**      | В кнопке **сворачивания** .                                                                                                                                                                           |
| **хтригхт**       | В правой границе окна.                                                                                                                                                                    |
| **хтсизе**        | В поле размера (то же, что и **хтгровбокс**).                                                                                                                                                              |
| **хтсисмену**     | В **системном** меню или в кнопке **закрытия** дочернего окна.                                                                                                                                    |
| **хттоп**         | В верхней горизонтальной границе окна.                                                                                                                                                         |
| **хттоплефт**     | В левом верхнем углу границы окна.                                                                                                                                                        |
| **хттопригхт**    | В правом верхнем углу границы окна.                                                                                                                                                       |
| **хттранспарент** | В окне, которое в настоящий момент охватывает другое окно в том же потоке.                                                                                                                                 |
| **хтвскролл**     | На вертикальной полосе прокрутки.                                                                                                                                                                         |
| **хтзум**        | В кнопке **развертывания** .                                                                                                                                                                           |



 

Если курсор находится в клиентской области окна, [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) возвращает значение **хтклиент** -проверки попадания в процедуру окна. Когда процедура окна возвращает этот код в систему, система преобразует экранные координаты активной точки курсора в клиентские координаты, а затем отправляет соответствующее сообщение мыши в области клиента.

Функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) возвращает одно из других значений проверки попадания, когда активная область курсора находится в неклиентской области окна. Когда процедура Window возвращает одно из этих значений проверки нажатия, система отправляет сообщение мыши неклиентской области, помещая значение проверки попадания в параметре *wParam* сообщения и координаты курсора в параметре *lParam* .

## <a name="mouse-sonar"></a>Sonar мыши

Функция Sonar специальных возможностей мыши кратко показывает несколько концентрических кругов вокруг указателя, когда пользователь нажимает и отпускает клавишу CTRL. Эта функция позволяет пользователю навести указатель мыши на экране, который находится в неправильном режиме или с установленным разрешением высокая, на мониторе низкого качества или для пользователей с ослабленным зрением. Дополнительные сведения см. в следующих флагах в [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa):

**SPI \_ жетмаусесонар**

**SPI \_ сетмаусесонар**

## <a name="mouse-vanish"></a>Кнопка "исчезновение"

Функция специальных возможностей указателя мыши скрывает указатель при вводе пользователем. Указатель мыши появляется, когда пользователь перемещает указатель мыши. Эта функция позволяет указателю не скрывать вводимый текст, например, в сообщении электронной почты или в другом документе. Дополнительные сведения см. в следующих флагах в [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa):

**SPI \_ жетмаусеваниш**

**SPI \_ сетмаусеваниш**

## <a name="the-mouse-wheel"></a>Колесико мыши

Колесико мыши сочетает функции колесика и кнопки мыши. У колесика есть дискретные и равномерно пробельные деления. При вращении колеса в приложение отправляется сообщение с колесиком, когда встречается каждое деление. кнопка колесика может также использоваться как обычная Windows средней (третьей) кнопки. Нажатие и отпускание колесика мыши отправляет стандартные сообщения [**WM \_ Мбуттонуп**](wm-mbuttonup.md) и [**WM \_ мбуттондовн**](wm-mbuttondown.md) . Двойной щелчок третьей кнопки отправляет стандартное сообщение [**WM \_ мбуттондблклк**](wm-mbuttondblclk.md) .

Колесико мыши поддерживается с помощью сообщения [**WM \_ маусевхил**](wm-mousewheel.md) .

При вращении указателя мыши сообщение [**WM \_ маусевхил**](wm-mousewheel.md) отправляется в окно фокуса. Функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) распространяет сообщение родительскому окну. Не должно быть внутренней пересылки сообщения, так как **дефвиндовпрок** распространяет его на родительскую цепочку до тех пор, пока не будет найдено окно, обрабатывающее его.

### <a name="determining-the-number-of-scroll-lines"></a>Определение количества полос прокрутки

Приложения должны использовать функцию [**системпараметерсинфо**](/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa) для получения числа строк, прокручиваемых документом для каждой операции прокрутки (деление колесика). Чтобы получить количество строк, приложение выполняет следующий вызов:


```
SystemParametersInfo(SPI_GETWHEELSCROLLLINES, 0, pulScrollLines, 0)
```



Переменная "Пулскролллинес" указывает на целочисленное значение без знака, которое получает предлагаемое число строк для прокрутки при вращении колесика мыши без клавиш-модификаторов:

-   Если это число равно 0, прокрутка не выполняется.
-   Если это число равно **\_ пажескролл колесика**, то необходимо интерпретировать колесико мыши, щелкнув один раз на странице или в областях полосы прокрутки.
-   Если число строк для прокрутки больше числа отображаемых строк, то операция прокрутки также должна интерпретироваться как операция страницы вниз или вверх.

Значение по умолчанию для количества строк прокрутки будет равно 3. Если пользователь изменяет число полос прокрутки с помощью страницы свойств мыши на панели управления, операционная система передает сообщение [**WM \_ сеттингчанже**](../winmsg/wm-settingchange.md) всем окнам верхнего уровня с указанным **SPI \_ сетвхилскролллинес** . Когда приложение получает сообщение **WM \_ сеттингчанже** , оно может получить новое число строк прокрутки, вызвав:


```
SystemParametersInfo(SPI_GETWHEELSCROLLLINES, 0, pulScrollLines, 0)
```



### <a name="controls-that-scroll"></a>Элементы управления, прокрутки которых

В таблице ниже перечислены элементы управления с функцией прокрутки (включая линии прокрутки, заданные пользователем). 

| Control                 | Прокрутка                                                                                                                                                               |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Изменить элемент управления            | Вертикальная и горизонтальная.                                                                                                                                                |
| Элемент управления "список"        | Вертикальная и горизонтальная.                                                                                                                                                |
| поле со списком;               | Если не раскрывается, каждая прокрутка получает следующий или предыдущий элемент. При перетаскивании Каждая прокрутка пересылает сообщение в список, который соответствующим образом прокручивает. |
| CMD (Командная строка)      | По вертикали.                                                                                                                                                               |
| Вид дерева               | Вертикальная и горизонтальная.                                                                                                                                                |
| Режим списка               | Вертикальная и горизонтальная.                                                                                                                                                |
| Прокрутка вверх/вниз         | По одному элементу за раз.                                                                                                                                                     |
| Прокрутка линейки        | По одному элементу за раз.                                                                                                                                                     |
| Microsoft Rich Edit 1,0 | По вертикали. обратите внимание, что Exchange клиент имеет собственные версии представления списка и элементов управления иерархического представления, которые не поддерживают круг.                                        |
| Microsoft Rich Edit 2,0 | По вертикали.                                                                                                                                                               |



 

### <a name="detecting-a-mouse-with-a-wheel"></a>Обнаружение мыши с помощью колесика

Чтобы определить, подключена ли мышь с колесом прокрутки, вызовите [**жетсистемметрикс**](/windows/desktop/api/winuser/nf-winuser-getsystemmetrics) с **SM \_ маусевхилпресент**. Возвращаемое значение **true** указывает, что мышь подключена.

Ниже приведен пример из окна процедуры для многострочного элемента управления Edit:


```
BOOL ScrollLines(
     PWNDDATA pwndData,   //scrolls the window indicated
     int cLinesToScroll); //number of times

short gcWheelDelta; //wheel delta from roll
PWNDDATA pWndData; //pointer to structure containing info about the window
UINT gucWheelScrollLines=0;//number of lines to scroll on a wheel rotation

gucWheelScrollLines = SystemParametersInfo(SPI_GETWHEELSCROLLLINES, 
                             0, 
                             pulScrollLines, 
                             0);

case WM_MOUSEWHEEL:
    /*
     * Do not handle zoom and datazoom.
     */
    if (wParam & (MK_SHIFT | MK_CONTROL)) {
        goto PassToDefaultWindowProc;
    }

    gcWheelDelta -= (short) HIWORD(wParam);
    if (abs(gcWheelDelta) >= WHEEL_DELTA && gucWheelScrollLines > 0) 
    {
        int cLineScroll;

        /*
         * Limit a roll of one (1) WHEEL_DELTA to
         * scroll one (1) page.
         */
        cLineScroll = (int) min(
                (UINT) pWndData->ichLinesOnScreen - 1,
                gucWheelScrollLines);

        if (cLineScroll == 0) {
            cLineScroll++;
        }

        cLineScroll *= (gcWheelDelta / WHEEL_DELTA);
        assert(cLineScroll != 0);

        gcWheelDelta = gcWheelDelta % WHEEL_DELTA;
        return ScrollLines(pWndData, cLineScroll);
    }

    break;
```



## <a name="window-activation"></a>Активация окна

Когда пользователь щелкает неактивное окно верхнего уровня или дочернее окно неактивного окна верхнего уровня, система отправляет сообщение [**WM \_ маусеактивате**](wm-mouseactivate.md) (помимо других) в окно верхнего или дочернего окна. Система отправляет это сообщение после публикации сообщения [**WM \_ нчиттест**](wm-nchittest.md) в окне, но до публикации сообщения кнопки. Когда **WM \_ маусеактивате** передается в функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) , система активирует окно верхнего уровня, а затем отправляет сообщение кнопки в окно верхнего или дочернего уровня.

Обрабатывая [**WM \_ маусеактивате**](wm-mouseactivate.md), окно может управлять тем, станет ли окно верхнего уровня активным окном в результате щелчка мышью, и будет ли окно, которое было выбрано, получит последующее сообщение. Для этого возвращается одно из следующих значений после обработки **WM \_ маусеактивате**.



| Значение                    | Значение                                                              |
|--------------------------|----------------------------------------------------------------------|
| **\_Активация MA**         | Активирует окно и не удаляет сообщение мыши.         |
| **MA не \_ активировать**       | Не активирует окно и не удаляет сообщение мыши. |
| **MA \_ активатеандеат**   | Активирует окно и отклоняет сообщение мыши.                 |
| **MA \_ ноактиватеандеат** | Не активирует окно, но отклоняет сообщение мыши.         |

## <a name="see-also"></a>См. также раздел

[Использование преимуществ High-Definition перемещения мыши](../dxtecharts/taking-advantage-of-high-dpi-mouse-movement.md)