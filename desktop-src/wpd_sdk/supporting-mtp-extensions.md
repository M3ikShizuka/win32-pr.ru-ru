---
description: Поддержка расширений MTP
ms.assetid: 9e5f3da6-346a-4eca-bc85-2755c569986d
title: Поддержка расширений MTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f26a6a5a585167984ec944528bb74a6746e42ac4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103912143"
---
# <a name="supporting-mtp-extensions"></a>Поддержка расширений MTP

## <a name="media-transfer-protocol"></a>Протокол передачи мультимедиа

Протокол передачи мультимедиа (MTP) является расширением протокола передачи изображений (PTP). В результате все семантики протокола PTP действительны в MTP.

MTP взаимодействует с помощью команд и ответов между двумя сторонами, инициатором и респондентом. Роли вовлеченных устройств четко определены. ПК обычно является инициатором, а устройство всегда является респондентом. Устройство, не являющееся ПК, также может быть инициатором (например, колодой автомобилей или Microsoft X). Устройство не может одновременно предположить обе роли.

Инициатор начинает обмен данными, отправляя команду в ответчик. Ответчик обрабатывает команду и отправляет соответствующий ответ. Возможно, имеется фаза данных, связанная с командой. В этом случае направление потока данных должно быть известно заранее и принято как инициатором, так и респондентом. Имейте в виду, что отсутствует описательный заголовок, указывающий потоки данных для новых команд.

Ответчик может начать обмен данными независимо от инициатора. Например, ответчик может отправить события инициатору. Однако данные не могут быть отправлены вместе с событием. При наличии данных, которые необходимо считать частью события, инициатор должен отправить команду MTP, а устройство — отправить данные в ответ на команду.

Полное описание MTP см. в [спецификации MTP](https://www.usb.org/sites/default/files/MTPv1_1.zip).

## <a name="sending-mtp-commands"></a>Отправка команд MTP

Приложения могут отсылать команды MTP на устройство, вызывая метод [**ипортабледевице:: сендкомманд**](/windows/desktop/api/PortableDeviceApi/nf-portabledeviceapi-iportabledevice-sendcommand) . Отправляемая команда зависит от наличия фазы данных, а также от того, считываются ли какие-либо сопутствующие данные с устройства или записываются на него. В следующей таблице описаны три возможные команды расширения MTP.

Имейте в виду, что эти команды относятся к MTP; и поэтому реализуются только драйвером класса WPD MTP.



|                                                                                                                                      |                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| Get-Help                                                                                                                              | Описание                                                                                       |
| [**\_команда WPD \_ , \_ \_ завершающая \_ \_ Перенос данных MTP**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-end-data-transfer)                                      | Выдает команду MTP, которая сигнализирует о завершении операции чтения или записи данных.              |
| [**\_команда WPD \_ , \_ \_ выполняемая \_ командой MTP, \_ без \_ \_ фазы данных**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-without-data-phase)  | Выдает команду MTP без соответствующей фазы данных.                                         |
| [**\_команда WPD \_ MTP \_ \_ выполнить \_ команду \_ с \_ данными \_ для \_ записи**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-write) | Выдает команду MTP, за которой следуют прилагаемые данные, которые будут записаны на устройство. |
| [**\_команда WPD \_ MTP \_ \_ Execute \_ команда \_ с \_ данными \_ для \_ чтения**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-execute-command-with-data-to-read)   | Выдает команду MTP, за которой следуют прилагаемые данные, которые считываются с устройства.       |
| [**\_команда WPD \_ MTP \_ \_ Read \_ Data**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-read-data)                                                       | Выдает команду MTP, которая отправляет данные с устройства на компьютер.                                  |
| [**\_команда WPD \_ MTP \_ ext \_ Write \_ Data**](/windows/desktop/wpd_sdk/wpd-command-mtp-ext-write-data)                                                     | Выдает команду MTP, которая отправляет данные на устройство с компьютера.                                  |



 

Независимо от этапа, необходимо указать **\_ свойство WPD \_ для \_ \_ \_ кода операции MTP** и **Свойства WPD в \_ \_ \_ \_ \_ параметрах операции MTP** .

Если драйверу MTP удалось отправить команду на устройство, возвращаемые значения всегда будут содержать **свойство WPD с \_ \_ \_ \_ \_ кодом ответа MTP**. Если код ответа указывает на успешное выполнение и если семантика команды допускает параметры ответа, то также будут доступны **Свойства WPD для \_ \_ \_ \_ ответов \_ MTP ext** .

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Инструкции по программированию**](programming-guide.md)
</dt> </dl>

 

 
