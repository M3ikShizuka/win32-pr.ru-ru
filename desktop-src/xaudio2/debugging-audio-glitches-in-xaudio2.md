---
description: Ошибки могут возникать в XAudio2. в этом разделе описывается, как они сообщаются, и некоторые подходы к их устранению.
ms.assetid: 360d1c5a-82e7-c982-82ea-5b5c7d69bc25
title: Отладка временных сбоев звука в XAudio2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 749c2ff69888f3411d86e13f95b84509587f22a4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103911112"
---
# <a name="debugging-audio-glitches-in-xaudio2"></a>Отладка временных сбоев звука в XAudio2

Ошибки могут возникать в XAudio2. в этом разделе описывается, как они сообщаются, и некоторые подходы к их устранению.

В этом обзоре рассматриваются следующие темы:

-   [Причины проблем с звуковым выходом или сбоев](#causes-of-audio-output-problems-or-glitches)
-   [Как XAudio2 сообщает о проблемах](#how-xaudio2-reports-problems)
-   [Подходы к устранению проблем](#approaches-to-fixing-problems)
-   [См. также](#related-topics)

## <a name="causes-of-audio-output-problems-or-glitches"></a>Причины проблем с звуковым выходом или сбоев

Сбои могут возникать в выходных данных XAudio2 по нескольким причинам.

-   XAudio2 исходный голоса недоступен. Клиент не отправляет на него новые звуковые файлы достаточно быстро. Вы получаете бездействия, так как у него нет данных для воспроизведения.
-   XAudio2 в целом является перегруженным. Получение *x* МС для звука занимает больше *x* МС. Вы получаете выпадение из-за того, что XAudio2 не может создавать данные так быстро, как это необходимо для звукового устройства. Возможно, в каждый момент времени выполняется слишком много голосов или эффектов, слишком много работы в ответных вызовах XAudio2 или слишком частое выполнение вызовов API XAudio2.
-   Поток обработки звука останавливается, так как реализация некоторых обратных вызовов XAudio2 клиентом выполняет действия, которые могут блокировать поток. Например, он может обращаться к диску, синхронизироваться с другими потоками или вызывать другие функции, которые могут блокироваться. Используйте фоновый поток с более низким приоритетом, который ответный вызов может передать для выполнения таких задач.
-   Система в целом перегружена. Другие потоки, работающие с тем же или более высоким приоритетом, чем XAudio2, выполняют слишком много усилий. Они конкурируют с звуковым потоком на время ЦП.

## <a name="how-xaudio2-reports-problems"></a>Как XAudio2 сообщает о проблемах

XAudio2 может сообщать о сбоях в отладочной сборке несколькими способами.

-   В случае нехватки голоса XAudio2 отображает сообщение в этой форме.

    ``` syntax
    XAudio2: WARNING: Voice at 0xNNNNNNNN starved: no more source buffers are available, but no end-of-stream marker was received
    ```

-   Если поток звука выполняется слишком долго, XAudio2 отображает сообщение в этой форме.

    ``` syntax
    XAudio2: WARNING: Spent Xms in audio thread; XAudio2 possibly overloaded
    ```

    Как правило, это сообщение появляется со следующим сообщением.

-   Если звуковой драйвер не может поставлять новые звуковые данные вовремя, XAudio2 отображает сообщение в этой форме.

    ``` syntax
    XAudio2: WARNING: Glitch at output sample X
    ```

-   Вызов [**IXAudio2:: жетперформанцедата**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-getperformancedata) предоставляет данные о производительности XAudio2, включая общее число сбоев с момента запуска обработчика XAudio2.

## <a name="approaches-to-fixing-problems"></a>Подходы к устранению проблем

Ниже перечислены возможные способы снижения числа сбоев звука.

-   В случае недоступности голоса: Увеличьте объем звуковых данных, помещенных в очередь на голоса. [**IXAudio2SourceVoice::**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2sourcevoice-getstate) at можно использовать для обнаружения количества буферов в очереди в данный момент. Если вы по-прежнему видите ошибки невозможности передачи голоса, но не можете слышать о сбоях, убедитесь, что вы настраиваете [**\_ буфер XAUDIO2**](/windows/desktop/api/xaudio2/ns-xaudio2-xaudio2_buffer).**Флаги** для \_ XAUDIO2 \_ конца \_ потока в конечном буфере звука. Это говорит о том, что XAudio2 не ожидается, что все буферы должны быть доступны сразу после завершения этого.

    В других случаях:

    -   Сократите число активных голосов и эффектов в графе, особенно дорогостоящих эффектов, таких как переглаголы.
    -   Отключите голоса и эффекты, которые вы не используете.
    -   Используйте \_ \_ Флаги XAUDIO2 Voice НОСРК и \_ XAUDIO2 \_ в [**IXAudio2:: креатесаурцевоице**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createsourcevoice), когда это возможно. Преобразование частоты дискретизации является дорогостоящим.
    -   Уменьшите частоту выборки отдельных голосов. Например, субмикс голоса, на котором размещено действие, может иметь меньшую частоту выборки, чем отправку исходного голоса. Такие звуки, как взрывы и гуншотс, которые не нуждаются в высокой точности, также могут быть записаны с низкой частотой выборки.
    -   Убедитесь, что реализации обратного вызова выполняют как можно меньше работы и никогда не блокируют.
    -   Сократите число вызовов XAudio2. Параметры звука обычно не нуждаются в обновлении для каждого кадра видео. Все равно 30 мс или достаточно. Необходимо устранить избыточные вызовы, такие как настройка тома несколько раз в ходе быстрой успешной операции.
    -   Сократите общую загрузку ЦП игры.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Отладочные средства](debugging-facilities.md)
</dt> <dt>

[Справочник по программированию в XAudio2](programming-reference.md)
</dt> </dl>

 

 
