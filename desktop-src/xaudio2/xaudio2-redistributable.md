---
description: Руководство разработчика по распространяемой версии XAudio 2.9
ms.assetid: ''
title: Руководство разработчика по распространяемой версии XAudio 2.9
ms.topic: article
ms.date: 10/17/2019
ms.openlocfilehash: a87c2dc44179f2c189270dfa91d2cf2696ea98a7
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "104000016"
---
# <a name="developer-guide-for-redistributable-version-of-xaudio-29"></a>Руководство разработчика по распространяемой версии XAudio 2.9

Версия Ксаудио 2,9 доступна в виде [пакета NuGet](/nuget/what-is-nuget). Разработчики могут распространять эту версию Ксаудио 2,9 вместе с их приложениями. Это позволяет приложению использовать Ксаудио 2,9 в более старых версиях Windows, которые не включают Ксаудио 2,9 в составе образа операционной системы. Использование этого распространяемого пакета предпочтительнее, чем распространение Ксаудио 2,7 из пакета SDK DirectX, так как Ксаудио 2,7 не обновлялся с 2010.

## <a name="supported-platforms"></a>Поддерживаемые платформы

Пакет NuGet Ксаудио 2,9 (*Microsoft. XAudio2. Redist. \* . nupkg*) включает 32-разрядную и 64-разрядную версию библиотеки DLL, которая РЕАЛИЗУЕТ API ксаудио 2,9. Библиотека DLL называется XAUDIO2 \_9REDIST.DLL. Эта библиотека DLL будет работать в Windows 7 с пакетом обновления 1 (SP1), Windows 8 Windows 8.1 и Windows 10.

Если библиотека DLL используется в системе Windows 10, она проверяет номер версии XAUDIO2 \_9.DLL, которая является частью операционной системы, и если операционная система более новая, она делегирует все вызовы API в XAUDIO2 \_9.DLL в операционной системе. Это гарантирует, что приложения всегда используют последнюю версию Ксаудио 2,9, доступную на текущей платформе.

Библиотека DLL не предназначена для Xbox One. При использовании в Xbox One библиотека DLL всегда делегирует все вызовы API XAUDIO2 \_9.DLL в операционной системе Xbox One.

Библиотека DLL не предназначена для приложений UWP. Приложения UWP должны использовать9.DLL XAUDIO2 \_ , который является частью операционной системы.

## <a name="installing-the-nuget-package"></a>Установка пакета NuGet

Самый простой способ установить пакет NuGet — использовать [Диспетчер пакетов NuGet](/nuget/consume-packages/install-use-packages-visual-studio) в Microsoft Visual Studio. В этом случае файл проекта Visual Studio будет автоматически обновлен для включения *Microsoft. XAudio2. Redist. targets*. Файл *Targets* добавляет папку include с файлами заголовков для XAudio2 в коллекцию включаемых путей проекта. Файл *Targets* также сделает. DLL или. Ссылка на EXE с XAUDIO2REDIST. LIB и КСАПОБАСЕРЕДИСТ. LIB.

Библиотека КСАПОБАСЕРЕДИСТ. LIB требуется только в том случае, если вы планируете импемент пользовательский объект обработки Ксаудио (КСАПО) и можете удалить его из *Microsoft. XAudio2. Redist. targets* , если он не используется.

Можно также использовать другие средства для извлечения содержимого пакета NuGet или даже переименовать расширение файла в ZIP-файл и извлечь файлы с помощью любого средства извлечения ZIP-файлов.

## <a name="compiling-your-app"></a>Компиляция приложения

### <a name="choosing-which-headers-to-include"></a>Выбор включаемых заголовков

Пакет NuGet Ксаудио 2,9 содержит те же файлы заголовков XAudio2, которые включены в пакет SDK для Windows 10. Однако файлы заголовков имели некоторые изменения, чтобы убедиться, что их можно использовать в явной ориентации на все [Поддерживаемые платформы](#supported-platforms), включая старые версии Windows.

Если [пакет NuGet устанавливается](#installing-the-nuget-package) с помощью диспетчера пакетов nuget в Microsoft Visual Studio то путь к файлам заголовков помещается перед путем к файлам заголовков Windows SDK. Это означает, что если код в проекте включает XAUDIO2. Заголовок H, он выберет заголовок кросс-платформенного из пакета NuGet. Обычно это предпочтительное поведение.

Следует быть внимательным, если добавить путь к заголовкам include вручную в проект, так как они указываются в неправильном порядке, может привести к появлению XAUDIO2 для конкретной версии ОС [. H](/windows/win32/api/xaudio2/) для включения в Windows SDK, а не на кросс-платформенную версию XAUDIO2. H.

Чтобы включить заголовки с меньшими подверженными ошибкам, пакет NuGet содержит версию каждого заголовка с добавлением Redist. Например, в дополнение к XAUDIO2. H, пакет NuGet также включает XAUDIO2REDIST. H. При желании код может напрямую включать XAUDIO2REDIST. H, чтобы исключить неоднозначность, связанную с тем, какой файл заголовка используется. При включении-Redist. H версия файла заголовка, порядок, в котором каталоги включаемых файлов указаны в файле проекта, не имеет значения.

Обратите внимание, что если приложение также компилируется для Xbox One, следует продолжить включать XAUDIO2. H при компиляции для Xbox One, так как некоторые API-интерфейсы Xbox One исключаются из XAUDIO2REDIST. H. Этот пакет NuGet не предназначен для Xbox One.

### <a name="loading-the-dll"></a>Загрузка библиотеки DLL

Мы рекомендуем связать приложение с XAUDIO2REDIST. LIB и установите XAUDIO2 \_9REDIST.DLL в той же папке, что и исполняемый файл приложения. Это приведет к \_ загрузке XAUDIO29REDIST.DLL сразу после запуска исполняемого файла. Однако при желании вы можете использовать [**LoadLibraryEx**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibraryexw) и [**GETPROCADDRESS**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) для загрузки XAUDIO2 \_9REDIST.DLL по запросу. Это хорошее решение, если приложению не всегда нужно использовать интерфейсы API XAudio2. Но если это сделать,9REDIST.DLL XAUDIO2 будет \_ загружаться до тех пор, пока приложение не завершит работу, так как попытка выгрузить библиотеку DLL может вызвать сбой, если фоновый поток по-прежнему выполняет код в библиотеке DLL.

В отличие от старых Ксаудио 2,7, невозможно использовать CoCreateInstance для загрузки библиотеки DLL.

### <a name="verifying-the-dll-signature"></a>Проверка подписи DLL

\_Двоичный9REDIST.DLL XAUDIO2 подписывается корпорацией Майкрософт с помощью подписи SHA-2. Код, который пытается проверить подпись, например, модули защиты от Памятка по для игр, должен поддерживать SHA-2. Обратите внимание, что операционная система Windows 7 с пакетом обновления 1 (SP1) изначально не поддерживала SHA-2 и требует обновления для добавления этой функции. Обновление доступно как [KB4474419](https://support.microsoft.com/help/4474419/sha-2-code-signing-support-update).

## <a name="testing"></a>Тестирование

### <a name="spatial-sound-in-newer-versions-of-windows-10"></a>Пространственный звук в более новых версиях Windows 10

Начиная с обновления Windows 10 1903, Ксаудио 2,9 автоматически использует [виртуальный объемный звук](#spatial-sound-and-virtual-surround)при соблюдении определенных условий. Мы рекомендуем проверить игру, которая создает многоканальный звук в Windows 10 1903 (или более новой версии), чтобы убедиться в том, что игра звучит должным образом.

#### <a name="enabling-spatial-sound"></a>Включение пространственного звука

Пользователь может включить пространственный звуковой формат, щелкнув правой кнопкой мыши значок динамика в области уведомлений Windows. 

Ксаудио 2,9 будет использовать выбранный пользователем формат пространственного звука только в том случае, если процесс, использующий API XAudio2, распознается как игра в игровой панели Windows. Во время разработки процесс не распознается в качестве игры игровой панелью. Чтобы изменить это, используйте клавишу Win + G Short-Cut, чтобы открыть игровую панель во время работы игры. Затем щелкните значок "Параметры" и установите флажок "Помните, что это игра".

#### <a name="opting-out-from-spatial-sound"></a>Отказаться от пространственного звука

Существует способ отказаться от использования XAudio2ного звукового кодировщика, указав определенные значения для параметра [**AUDIO_STREAM_CATEGORY**](/windows/win32/api/audiosessiontypes/ne-audiosessiontypes-audio_stream_category) в [**IXAudio2:: креатемастерингвоице**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice). 

Пространственный звук включается для следующих категорий:

* AudioCategory_ForegroundOnlyMedia
* AudioCategory_GameEffects
* AudioCategory_GameMedia
* AudioCategory_Movie
* AudioCategory_Media

Пространственный звук не включен, если указаны следующие категории:

* AudioCategory_Other
* AudioCategory_Communications
* AudioCategory_Alerts
* AudioCategory_SoundEffects
* AudioCategory_GameChat
* AudioCategory_Speech

### <a name="error-handling"></a>Обработка ошибок

Важно протестировать, что игра может изменить звуковое устройство, например, когда наушники подключены к сети или отключены. Это необходимо проверить с помощью наушников, которые поддерживают только частоту выборки 44,1 кГц. Многие низкоуровневые наушники USB и гарнитуры Bluetooth поддерживают 44,1 кГц. Переход между частотой выборки 48 кГц и частотой выборки 44,1 кГц может вызвать ошибку даже при использовании функции [конечной точки Virtual Audio](#virtual-audio-endpoint) . Ошибка не будет возникать, если наушники также поддерживают 48 кГц. Обратите внимание, что конечная точка Virtual Audio недоступна в Windows 7 с пакетом обновления 1 (SP1).

Код ошибки, возвращенный Ксаудио 2,9, когда не может автоматически восстановиться после изменения в конечной точке аудио, [XAUDIO2 \_ E \_ \_ недействителен](xaudio2-error-codes.md). Однако рекомендуется, чтобы приложения не жестко закодировать зависимость от кода ошибки, имеющего определенное значение.

Чтобы получать уведомления об ошибке, приложение должно реализовать интерфейс [**IXAudio2EngineCallback**](/windows/desktop/api/xaudio2/nn-xaudio2-ixaudio2enginecallback) и предоставить указатель на этот интерфейс, вызвав метод [**IXAudio2:: регистерфоркаллбаккс**](xaudio2-callbacks.md) . Реализация [**IXAudio2EngineCallback:: онкритикалеррор**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) в приложении будет вызываться API XAudio2, если во время воспроизведения возникает ошибка.

Обратите внимание, что [**IXAudio2EngineCallback:: онкритикалеррор**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2enginecallback-oncriticalerror) не обязательно вызывается, если работа конвейера аудиопотока приостановлена. Например, если пользователь свернется в приложение или приложение приостанавливается по любой причине, воспроизведение звука может быть приостановлено. Если изменение в звуковом устройстве происходит в течение этого времени, то ошибка возвращается только в том случае, если приложение вызывает [**IXAudio2:: ЗапускДвигателя**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2-startengine) и/или вызывает [**IXAudio2SourceVoice:: Start**](/windows/desktop/api/xaudio2/nf-xaudio2-ixaudio2sourcevoice-start). Если воспроизведение может быть приостановлено в приложении, следует протестировать смену звукового устройства во время приостановки воспроизведения, чтобы убедиться, что приложение по-прежнему может быть восстановлено в этой ситуации.

## <a name="xaudio-29-api-differences-compared-to-xaudio-27"></a>Различия в API Ксаудио 2,9 по сравнению с Ксаудио 2,7

В этом разделе представлен обзор некоторых различий API между Ксаудио 2,7 и распространяемой версией Ксаудио 2,9.

### <a name="supported-formats"></a>Поддерживаемые форматы

Ксаудио 2,9 поддерживает следующие форматы входных данных на компьютере:

* Линейный 16-разрядный PCM
* Линейный 32-разрядный PCM с плавающей запятой
* 16-разрядное ADPCM
* ксвма

Формат XMA поддерживается только на Xbox One.

### <a name="preferred-cpu-core"></a>Предпочтительное ядро ЦП

Можно указать, какой ЦП Core Ксаудио 2,9 должен использовать для потока обработки звука. Однако обычно рекомендуется позволить Ксаудио 2,9 выбирать это значение самим по себе. Это делается путем установки параметра **XAudio2Processor** в вызове [**XAudio2Create**](/windows/desktop/api/xaudio2/nf-xaudio2-xaudio2create) в XAUDIO2 \_ использовать \_ процессор по умолчанию \_ . 

Ксаудио 2,9 выберет разные ядра ЦП на Xbox, а не на ПК. Метод IXAudio2Extension:: препроцессора можно использовать для определения того, какое ядро ЦП выбирало XAudio2.

### <a name="virtual-audio-endpoint"></a>Конечная точка Virtual Audio

Ксаудио 2,9 по умолчанию будет использовать конечную точку виртуальной аудиоподсистемы при работе в Windows 8 или более поздней версии. Это означает, что при изменении конечной точки звука по умолчанию во время использования Ксаудио 2,9 будет предпринята попытка автоматически переключиться на новую конечную точку звука. Пример того, что это может произойти, если конечная точка аудио по умолчанию — пара головных телефонов, подключенных по USB, а затем пользователь отсоединяет наушники. Это приведет к тому, что динамики будут новой конечной точкой звука по умолчанию.

Если приложение указывает конкретный звуковой формат при вызове [**IXAudio2:: креатемастерингвоице**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice), то для выполнения этого параметра ксаудио 2,9 может быть невозможно. Например, если приложение указало, что для голоса используется частота выборки 48 кГц, а новое звуковое устройство поддерживает только 44,1 кГц, то автоматический коммутатор завершится сбоем, а Ксаудио 2,9 сообщит об ошибке " [ \_ \_ \_ недействительная ошибка устройства XAUDIO2 E](xaudio2-error-codes.md) ".

Приложение может отказаться от использования конечной точки Virtual Audio, передав флаг [**\_ клиента XAUDIO2 No \_ Virtual \_ Audio \_**](xaudio2-boundary-values-and-flags.md) в [**IXAudio2:: креатемастерингвоице**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice).

Конечные точки Virtual Audio недоступны в Windows 7 с пакетом обновления 1 (SP1). Флаг **\_ клиента XAUDIO2 \_ No \_ Virtual \_ Audio** не влияет на Windows 7 с пакетом обновления 1 (SP1).

### <a name="audio-categories"></a>Категории аудио

Приложение должно указать категорию для своего звукового потока. Это делается путем предоставления значения из перечисления Аудиокатегори при вызове метода [**IXAudio2:: креатемастерингвоице**](/windows/win32/api/xaudio2/nf-xaudio2-ixaudio2-createmasteringvoice) . Например, AudioCategory_GameEffects. Категория аудио может влиять на то, как Windows обрабатывает звук или представляет звуковый поток на панели управления томами. Категория "звук" также влияет на автоматическое включение [виртуальных окружающих звуковых эффектов](#spatial-sound-and-virtual-surround) .

### <a name="duration-of-audio-processing-quantum"></a>Длительность такта обработки звука

На большинстве компьютеров Ксаудио 2,9 обрабатывает звук в течение 10 миллисекунд. Это называется квантом обработки. Однако длительность этого такта может отличаться от 10 миллисекунд на каком-либо оборудовании. Приложения, которым необходимо знать точный такт, могут вызвать метод IXAudio2Extension:: Жетпроцессингкуантум для получения значения.

### <a name="spatial-sound-and-virtual-surround"></a>Пространственный звук и виртуальное окружение

Начиная с обновления Windows 10 1903, Ксаудио 2,9 автоматически использует виртуальный объемный звук при соблюдении определенных условий. Мы рекомендуем проверить игру, которая создает многоканальный звук в Windows 10 1903 (или более новой версии), чтобы убедиться в том, что игра звучит должным образом. Обсуждение того, как протестировать эту функцию, см. в разделе [тестирование пространственного звука](#spatial-sound-in-newer-versions-of-windows-10) .

Как правило, Ксаудио 2,9 выполняет свертывание любого многоканального звука в соответствии с "физическим" числом звуковых каналов, поддерживаемых конечной точкой аудио. Например, если игра предоставляет звуковой канал 7,1, но звук воспроизводится на наушниках, Ксаудио 2,9 выводит звуковую телеканал 7,1 в стерео, используя стандартную матрицу свертывания. Если компьютер подключен к конечной точке HDMI, канал 7,1 будет передаваться как есть через подключение HDMI.

В Windows 10 добавлена поддержка пространственного звука с помощью централизованного кодировщика, который кодирует звук в выбранный пользователем формат [пространственного звука](../coreaudio/spatial-sound.md) . Windows 10 поставляется с пространственным звуковым форматом, называемым Windows Sonic. Другие форматы, например Dolby атмос для наушников, можно скачать с Microsoft Store. Некоторые из пространственных звуковых форматов, таких как Windows Sonic и Dolby атмос для наушников, предназначены для использования на конечных точках стерео Audio. Эти форматы выделяют звук на стерео, используя собственные алгоритмы, которые обеспечивают "виртуальный" объемный звук. Иными словами, прослушиватель может воспринимать звуки, поступающие из разных позиций в трехмерном пространстве, даже при людьми наушников или при прослушивании одной пары стерео динамиков.

Аналогичные эффекты можно получить с помощью API-интерфейсов [X3DAudio](x3daudio.md) , которые входят в состав ксаудио 2,9. Основное отличие заключается в том, что X3DAudio требует, чтобы разработчик приложений явно запрограммирован для трехмерного аудио, а виртуальный объемный звук применяется автоматически к любому источнику звука на основе каналов традионал.

В Windows 10 1903 и более новых играх, использующих Ксаудио 2,9, будет использоваться пространственный формат на уровне системы, который пользователь включил на конечной точке аудио, если таковой имеется. Это означает, что Ксаудио 2,9 не выполнит обычное свертывание окружающего звука в стерео. Вместо этого звуковые сигналы будут переданы в кодировщик пространственного звука (например, Windows Sonic) для достижения виртуального эффекта звучания.

### <a name="createhrtfapo"></a>креатехртфапо

Функция [**креатехртфапо**](/windows/desktop/api/HrtfApoApi/nf-hrtfapoapi-createhrtfapo) доступна только в Windows 10. Он не реализован в распространяемом компоненте Ксаудио 2,9.
