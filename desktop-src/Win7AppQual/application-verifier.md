---
description: Средство проверки приложений (Windows 7 и Windows Server 2008 R2 Application Quality Cookbook)
ms.assetid: edf719b7-9bd9-4e23-9bba-d0d7c3c5dbf5
title: Средство проверки приложений (Windows 7 и Windows Server 2008 R2 Application Quality Cookbook)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bac2a8bc900ea9d1f35ae228371226355657b930
ms.sourcegitcommit: 95685061d5b0333bbf9e6ebd208dde8190f97005
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2021
ms.locfileid: "108088692"
---
# <a name="application-verifier-windows-7-and-windows-server-2008-r2-application-quality-cookbook"></a>Средство проверки приложений (Windows 7 и Windows Server 2008 R2 Application Quality Cookbook)

## <a name="affected-platforms"></a>Затронутые платформы

**Клиенты** — Windows XP, Windows Vista, Windows 7  
**Серверы** — windows Server 2003, windows Server 2008, windows Server 2008 R2  


## <a name="description"></a>Описание

Додвигайте и применяйте средство проверки приложений в качестве шлюза качества для всей разработки. Он включает несколько улучшений:

-   Мы предоставили дополнительные проверки для решения проблем, которые команда отчеты об ошибках Windows обнаружила во время использования пула потоков.
-   Мы объединили 32-и 64-разрядные версии пакета для устранения изменений в Windows 7, включая требования для тестирования 32-разрядных компонентов в рамках 64-разрядной версии Windows, а также для общего упрощения.
-   Мы включили дополнительные проверки для многопоточных приложений, запуская 32-разрядные приложения в 64-разрядной версии Windows, а также много исправлений ошибок.

Эти изменения не должны оказывать негативное влияние на пользователей, которые не включают проверки потоков; Пользователи должны получить дополнительную поддержку в процессе обнаружения и диагностики существующих проблем использования пула потоков. Независимо от того, включены ли проверки потоков, вы получите преимущество от других улучшений и исправлений ошибок в этой службе.

Несмотря на небольшое снижение производительности при использовании этой службы, уровни производительности должны оставаться приемлемыми, поскольку обычно не выполняются в розничных средах.

## <a name="usage"></a>Использование

**Общие сведения**

Для предоставления надежных приложений Windows:

1.  Протестируйте приложения, написанные на неуправляемом (машинном) коде, с средство проверки приложений в отладчике и в полной куче, прежде чем выпустить их для клиентов.
2.  Выполните действия, предоставленные средство проверки приложений, чтобы разрешить условия аномального.
3.  После выпуска приложения регулярно Отслеживайте отчеты о сбоях приложений, собранные отчеты об ошибках Windows.

Проверки пула потоков включены по умолчанию в заголовке проверки "Основные сведения". Так как это включено в параметр по умолчанию, пользователям нужно только выполнить средство проверки приложений в коде с параметрами по умолчанию, чтобы использовать новые проверки.

**Сведения**

Как минимум, следует запускать средство проверки приложений с выбранным параметром основы. Это необходимо для Винлого и Винкуал. Параметр Основные сведения проверяет следующее:

-   **Исключения, сведения об окончании исключений** . гарантирует, что приложения не скрывают нарушения прав доступа с помощью структурированной обработки исключений.
-   **Обрабатывает сведения о прерывании** — тесты, чтобы убедиться, что приложение не пытается использовать недопустимые дескрипторы
-   **Сведения о прерывании куч** — проверяет наличие проблем с повреждением памяти в куче
-   **Сведения об окончании ввода-вывода** — отслеживание выполнения асинхронных операций ввода/вывода и выполнение различных проверок
-   **Сведения о прекращении утечки** — обнаруживает утечки за счет отслеживания ресурсов, созданных библиотекой DLL, которые не освобождаются до момента выгрузки библиотеки DLL
-   **Подробные сведения о блокировках** — проверяет правильность использования критических секций.
-   **Сведения о прерывании памяти** . обеспечивает правильное использование API-интерфейсов для манипуляций с виртуальным пространством (например, VirtualAlloc, MapViewOfFile).
-   **Сведения об окончании TLS** . обеспечивает правильное использование интерфейсов API локального хранилища потока
-   **Сведения о прерывании ThreadPool** . обеспечивает правильное использование интерфейсов API ThreadPool и обеспечивает проверку согласованности в состояниях рабочего потока после обратного вызова.

Если приложение переходит с приложения "пред-Vista", необходимо использовать "Луаприв" (также называемые проверками UAC). У прогнозируемого права доступа к учетной записи пользователя (Луаприв) есть две основные цели:

-   **Прогноз**. при запуске приложения с правами администратора необходимо предсказать, будет ли это приложение работать, если оно работает с меньшими привилегиями (как правило, в качестве обычного пользователя). Например, если приложение записывает данные в файлы, которые разрешают доступ только администраторам, это приложение не сможет выполнять запись в тот же файл, если он запускается от имени администратора.
-   **Диагностика**. при запуске с привилегиями, не являющимися администраторами, выявление потенциальных проблем, которые могут уже существовать в текущем запуске. Продолжая предыдущий пример, если приложение пытается выполнить запись в файл, предоставляющий доступ только членам группы администраторов, приложение получит \_ ошибку отказа в доступе. Если приложение работает неправильно, эта операция может быть причиной.

Луаприв определяет следующие типы проблем:



| **Потенциальная ошибка**       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ограниченные пространства имен     | Создание именованного объекта синхронизации (события, семафора, мьютекса и т. д.) без пространства имен может усложнить выполнение без прав доступа в некоторых операционных системах, так как операционная система может выбрать размещение объекта в ограниченном пространстве имен. Для создания такого объекта в ограниченном пространстве имен (например, в глобальном пространстве имен) требуется Секреатеглобалпривилеже, который предоставляется только администраторам.<br/> Луаприв помечает эти проблемы, если они обнаруживаются.<br/> |
| Проверки жесткого администратора | Некоторые приложения передают маркер безопасности пользователя, чтобы узнать, сколько прав он имеет. В таких случаях приложение может изменить его поведение в зависимости от того, сколько энергии полагается на пользователя. <br/> Вызовы API Луаприв flags, возвращающие эту информацию.<br/>                                                                                                                                                                                                |
| Запрос прав доступа     | Приложение может попытаться включить необходимую для безопасности привилегию (например, SeTcbPrivilege или SeSecurityPrivilege) перед выполнением операции, которая ее требует. <br/> Флаги Луаприв попытаются включить привилегии, соответствующие безопасности. <br/>                                                                                                                                                                                                                               |
| Отсутствующие привилегии        | Если приложение пытается разрешить привилегию, которое у пользователя нет, то, вероятно, сообщает, что приложение принимает привилегию, что может привести к различиям в поведении. <br/> Неудачные запросы на привилегии Луаприв флагов. <br/>                                                                                                                                                                                                                                       |
| INI-File операции       | Попытки записи в сопоставленные INI-файлы (Вритеприватепрофилесектион и аналогичные API) могут завершаться сбоем в качестве пользователя без прав администратора. <br/> Луаприв помечает такие операции.<br/>                                                                                                                                                                                                                                                                                                            |
| доступ запрещен             | Если приложение пытается получить доступ к объекту (файлу, разделу реестра и т. д.), но попытка не удалась из-за недостаточного доступа, приложение, скорее всего, будет работать с более высоким уровнем привилегий. <br/> Луаприв flags Object — открытые попытки, которые завершаются сбоем с отказом в ДОСТУПе \_ и аналогичными ошибками.<br/>                                                                                                                                                               |
| Запретить ACE                 | Если объект запрещает ACE в списке DACL, он явно запрещает доступ к определенным сущностям. <br/> Это редкое и усложняет прогнозирование, поэтому флаги Луаприв отклоняют ACE при их обнаружении.<br/>                                                                                                                                                                                                                                                                     |
| Доступ ограничен         | Если приложение пытается открыть объект для получения прав, которые не предоставляются обычным пользователям (например, при попытке записи в файл, доступный только для чтения администраторам), приложение, скорее всего, не будет работать при запуске от имени обычного пользователя. <br/> Луаприв помечает такие операции.<br/>                                                                                                                                                                      |
| МАКСИМАЛЬНО \_ допустимое          | Если приложение открывает объект для максимального \_ допустимого значения, то фактическая проверка доступа к объекту будет выполняться в других местах. Большинство кода, выполняющего эту команду, работает неправильно и, по-своему, будет работать по-разному при выполнении без прав доступа. <br/> Таким же Луаприв помечает все инциденты максимально \_ допустимого числа. <br/>                                                                                                                                                            |



 

Распространенные проблемы записываются в туманны прочие проверки:

-   Сведения о неопасных интерфейсах API
-   Сведения об отмене "грязных" стеков
-   Смена времени

Мы добавили новый средство проверки печати. Этот уровень помогает находить и устранять неполадки, которые могут возникнуть, когда приложение вызывает подсистему печати. Средство проверки печати предназначено для двух уровней подсистемы печати, слоя Принтапи и слоя Принтдривер.

*Уровень API печати*

Средство проверки печати проверяет интерфейс между программой и Винспул. drv и prntvpt.dll и проверяет интерфейсы этих библиотек DLL. Правила вызова функций в этом интерфейсе см. в разделе справки MSDN, посвященном интерфейсам API, экспортируемым с помощью винспул. drv и prntvpt.dll.

*Уровень драйвера принтера*

Средство проверки печати также проверяет интерфейс между основным драйвером печати, таким как UNIDRV.DLL, UNIDRUI.DLL, PSCRIPT5.DLL, PS5UI.DLL или MXDWDRV.DLL, а также подключаемые модули драйвера печати. Сведения об этом интерфейсе можно найти в MSDN и WDK.

Обратите внимание, что некоторые из этих проверок предназначены только для Windows 7, а другие будут работать лучше под Windows 7.

Как правило, только отладочные версии запускают средство проверки приложений, поэтому производительность обычно не является проблемой. Если проблемы с производительностью возникают при использовании этой или любой другой проверки средство проверки приложений, выполните одну проверку за раз, пока не будут выполнены все необходимые проверки.

Почти 10% сбоев приложений в системах Windows вызваны повреждением кучи. Эти сбои практически невозможно отлаживать после факта. Лучшим способом избежать этих проблем является тестирование функций кучи страниц, найденных в средство проверки приложений. Существует две разновидности кучи страниц: Full и light. Параметр Full является значением по умолчанию. При обнаружении повреждений отладчик немедленно останавливается. Эта функция должна выполняться в отладчике. Однако это также самый ресурсоемкий ресурс. Если у пользователя возникают проблемы с временем и сценарий уже выполнялся в режиме полной кучи страниц, его установка в значение «Light», скорее всего, позволит решить эти проблемы. Кроме того, куча неустранимых страниц не завершает работу, пока процесс не завершится. Он обеспечивает трассировку стека для выделения, но может значительно дольше диагностировать, чем использование его полного аналога.

Отслеживайте состояние надежности приложений с помощью веб-портала Винкуал. На этом портале отображаются отчеты об ошибках, собранные с помощью отчеты об ошибках Windows, что позволяет легко находить наиболее частые сбои. Дополнительные сведения см. в отчеты об ошибках Windows: начало работы. Корпорация Майкрософт не взимается за эту службу.

Чтобы воспользоваться преимуществами Винкуал, необходимо:

1.  Зарегистрируйте компанию для Винкуал, для которой требуется идентификатор VeriSign. Сведения о Windows 7 для Винкуал можно найти на портале разработчика, сгруппированном под управлением Windows Vista с пакетом обновления 1 (SP1) \\ Windows Server 2008. В ближайшее время у него будет расположение Windows 7.
2.  Сопоставьте приложения ISV с именем продукта и именем ISV, которое связывает отчеты об ошибках с компанией. Другие независимые поставщики программного обеспечения не могут просматривать ваши отчеты об ошибках.
3.  Используйте портал для обнаружения основных проблем. Независимые поставщики программного обеспечения могут также создавать ответы, которые сообщают клиентам о том, какие действия следует предпринять после сбоя. Система ответа поддерживает более 10 языков по всему миру.

Еще одно Примечание. средство проверки приложений подходит только для ветвей кода, с которыми он выполняется. Значение объединения этого инструмента с инструментом покрытия кода не может быть переопределенно.

## <a name="links-to-other-resources"></a>Ссылки на другие ресурсы

**Средства отладки для Windows:**

-   [Обзор и загрузка сайта](https://msdn.microsoft.com/windows/hardware/bg127145)
-   [Документация MSDN в Интернете](/windows-hardware/drivers/debugger/)

**средство проверки приложений:**

-   [Обзор](/previous-versions/ms220948(v=vs.80))
-   [Загрузить](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&amp;DisplayLang=en)
-   [Средство проверки приложений для Microsoft Visual Studio 2008/платформа .NET Framework 3,5](/previous-versions/ms220948(v=vs.80))

    **Примечание.** версия средство проверки приложений, поставляемая в составе Visual Studio, весьма устаревша. По возможности используйте автономный пакет. По этой причине в будущих версиях Visual Studio больше не будет встроенных средство проверки приложений.

**Винкуал:**

-   [Веб-службы Windows Quality Services (Винкуал)](/windows-hardware/drivers/dashboard/winqual-submission-tool--winqualexe-)
-   [Отчеты об ошибках Windows: начало работы](../wer/using-wer.md)

 

 
