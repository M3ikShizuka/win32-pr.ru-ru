---
description: Изменения сортировки NLS
ms.assetid: 24617b5f-14f1-4f1b-a288-7d20a8166da0
title: Изменения сортировки NLS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a08f0cde98d115c129fdb7932ff3bb05063cb5c6fb8d903d55bff2a69753d774
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118994884"
---
# <a name="nls-sorting-changes"></a>Изменения сортировки NLS

## <a name="affected-platforms"></a>Затронутые платформы

 **клиенты** — Windows XP, Windows Vista, Windows 7  
**серверы** — Windows server 2003, Windows server 2008, Windows server 2008 R2  










## <a name="feature-impact"></a>Воздействие на функции

 **Серьезность** — высокая  
**Частота** — низкая (несколько приложений затронули, но если они затронуты, всегда нарушены)  


## <a name="description"></a>Описание

Функции поддержки национальных языков (NLS) помогают приложениям поддерживать различные потребности пользователей в разных языковых и национальных настройках. новые версии Windows почти неизменно включают изменения NLS. Это изменение влияет на параметры сортировки и сортировки, поэтому приложения с постоянными индексами.

Таблица параметров сортировки имеет два числа, которые определяют версию (редакция): определенную версию и версию NLS. Обе версии имеют значения DWORD, состоящие из основной версии и дополнительной версии. Первый байт значения зарезервирован, два следующих байта представляют основной номер версии, а последний байт представляет дополнительный номер версии. В шестнадцатеричных терминах используется шаблон 0xRRMMMMmm, где R равно reserved, M равно Major, а m равно Minor. Например, основная версия 3 с дополнительной версией 4 представлена как 0x304.

Для основной версии одна или несколько кодовых точек меняются, поэтому приложению необходимо повторно индексировать все данные, чтобы они были допустимыми. Для дополнительной версии ничего не перемещается, но добавляются кодовые точки. Для этого типа версии приложению необходимо только повторно индексировать строки с ранее несортированными значениями. Ниже приведены сведения о том, что означают номера версий в связи с изменением данных в таблицах исключений, зависящих от языкового стандарта, и в таблицах по умолчанию:

**Нлсверсион Major** — измененные кодовые точки в "Exception" или таблицах, зависящих от локали  
**Нлсверсион Minor** — добавлены новые позиции кода в таблицах "Exception" или "зависящие от языкового стандарта".  
**Дефинедверсион основной** — измененные кодовые точки в таблице по умолчанию  
**Дефинедверсион Minor** — добавлены новые кодовые точки в таблицу по умолчанию.  


**Сортировка номеров версий для выпущенных версий:**



| Операционная система    | Release           | Версия (0xRRMMMMmm)         |
|---------------------|-------------------|------------------------------|
| Windows XP          | RTM/SP1/SP2/SP3/... | Н/д — нет API Жетнлсверсион () |
| Windows Server 2003 | RTM И SP1           | 0x00 0000 01                 |
| Windows Vista       | RTM И SP1           | 0x00 0405 00                 |
| Windows Server 2008 | RTM               | 0x00 0501 00/0x00 5001 00  |
| Windows 7           | RTM               | 0x00060100                   |



 

## <a name="manifestation"></a>Проявление

Приложения (например, базы данных) с постоянными индексами, которые не проверяют версию NLS и повторно индексируются при изменении версии, не смогут правильно выполнить сортировку или выдать запрошенные результаты.

В случае пользовательских интерфейсов списки (например, буквы, цифры, буквы, символы и т. д.) могут быть неправильно отсортированы.

## <a name="solution"></a>Решение

приложение может вызывать либо **жетнлсверсионекс** (Windows Vista, либо более поздней версии), либо **жетнлсверсион** (до Windows Vista), чтобы получить определенную версию и версию NLS для таблицы параметров сортировки.

-   Жетнлсверсионекс:

*Извлекает сведения о текущей версии указанной возможности NLS для языкового стандарта, указанного по имени*  
Эта функция позволяет приложению, например Active Directory, определить, влияет ли изменение NLS на языковой стандарт, используемый для конкретной таблицы индексов. В противном случае нет необходимости повторно индексировать таблицу. Дополнительные сведения см. в разделе Обработка языковых стандартов и сведений о языке.  
Эта функция поддерживает пользовательские языковые стандарты. Если *лплокаленаме* указывает дополнительный языковой стандарт, полученные данные представляют собой правильные данные для порядка сортировки, связанного с дополнительным языковым стандартом.  

**Примечание.** версии Windows до Windows Vista не поддерживают **жетнлсверсионекс**.  


-   жетнлсверсион (используйте для приложений, работающих в версиях Windows до Windows Vista):

*Извлекает сведения о текущей версии указанной возможности NLS для языкового стандарта, заданного идентификатором*  
Эта функция позволяет приложению, например Active Directory, определить, влияет ли изменение NLS на идентификатор локали, используемый для конкретной таблицы индексов. В противном случае нет необходимости повторно индексировать таблицу. Дополнительные сведения см. в разделе Обработка языковых стандартов и сведений о языке.  
**Примечание.** Эта функция получает сведения только о языковом стандарте, заданном идентификатором. Функция **жетнлсверсионекс** поддерживает дополнительные языковые стандарты, функции и имена RFC 4646. однако версии Windows до Windows Vista не поддерживают **жетнлсверсионекс**.  
приложения, предназначенные для работы только в Windows Vista и более поздних версиях, должны использовать **жетнлсверсионекс** в качестве предпочтений этой функции. **Жетнлсверсионекс** обеспечивает хорошую поддержку дополнительных языковых стандартов.  


## <a name="compatibility-test"></a>Тест совместимости

**Пошаговые инструкции по изменению версии параметров сортировки (то есть необходимости повторного индексирования):**

-   **Используйте жетнлсверсионекс ()** для получения структуры **нлсверсионинфоекс** при выполнении исходной индексации данных.
-   Сохраните следующие свойства с индексом, чтобы определить версию:  **нлсверсионинфоекс. двнлсверсион** и **нлсверсионинфоекс. двдефинедверсион** — эти два свойства вместе указывают версию таблицы сортировки, которую вы используете.  
    **Нлсверсионинфоекс. двеффективеид** — указывает действующий языковой стандарт для сортировки. Пользовательский языковой стандарт будет указывать на сортировку в встроенном языковом стандарте.  
    
-   При использовании индекса используйте **жетнлсверсионекс ()** для обнаружения версии данных.
-   Если какое-либо из трех свойств было изменено, то используемые данные сортировки могут возвращать разные результаты, а любое индексирование может не найти записи.
-   Если известно, что данные не содержат недопустимые кодовые точки Юникода (т. е. все строки возвращали **значение true** из вызова **иснлсдефинедстринг ()**), вы можете считать их одинаковыми, если изменился только младший байт **двнлсверсион** и **двдефинедверсион** (дополнительные версии, описанные выше).

## <a name="links-to-other-resources"></a>Ссылки на другие ресурсы

-   [Интернационализация для приложений Windows](../intl/international-support.md)
-   [Функция Жетнлсверсионекс](/windows/win32/api/winnls/nf-winnls-getnlsversionex)
-   [Функция Жетнлсверсион](/windows/win32/api/winnls/nf-winnls-getnlsversion)
-   [Как определить, изменилась ли версия параметров сортировки](/archive/blogs/shawnste/)

 

 
