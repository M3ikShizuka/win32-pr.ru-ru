---
description: Использование API параметров родительского контроля
ms.assetid: 77a239e9-1cec-4710-b673-7d0cebd502e9
title: Использование API параметров родительского контроля
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1dde4827dfe3ed5ee7eec6787744e6ff92f18775
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103815361"
---
# <a name="using-parental-controls-settings-apis"></a>Использование API параметров родительского контроля

Параметры обсуждаются перед ведением журнала, так как ведение журнала выполняется в соответствии с параметрами пользователя.

## <a name="wmi-api-settings-writeread"></a>Параметры API WMI: запись и чтение

API инструментария WMI предоставляет неабстрактный (необработанный) доступ ко всем параметрам, созданным с помощью инфраструктуры родительского контроля, как определено в файле схемы Впкспров. mof. Хранилище параметров существует в \\ корневом \\ \\ пространстве имен CIMV2 Applications \\ виндовспаренталконтролс со следующими определениями классов, определяющими схему. Отмечаются элементы расширяемости.

На компьютер:

-   Впксистемсеттингс (один экземпляр)
    -   Методы AddUser () и Ремовеусер () для создания и удаления параметров родительского контроля для заданного идентификатора безопасности соответственно.
    -   Свойства текущей системы оценок игр в силе, отслеживание и уведомление, связанные с проверкой журналов администраторами.
    -   Расширяемость: свойства, доступные только для чтения и для чтения и записи HTTP-приложения и списки исключений URL для фильтрации содержимого, идентификатор переопределения для фильтра веб-содержимого и имя и идентификатор библиотеки ресурсов, а для пользовательского журнала — регистрационное число полей и имен заголовков.
-   Впкратингссистем (по одному экземпляру на каждую установленную систему оценок)
    -   Впкратинг (один экземпляр на уровень рейтинга).
    -   Впкратингдескриптор (один экземпляр для дескриптора оценки).
-   Расширяемость: Впцекстенсион (один экземпляр на каждую добавленную ссылку расширяемости панели родительского элемента управления).
    -   Свойства для GUID, подсистемы, идентификатора, пути к ресурсу изображения, путь к ресурсу изображения отключенного состояния, путь к исполняемому файлу, путь к DLL-файлу и идентификатор библиотеки ресурсов подзаголовка, путь к DLL-файлу субтитров и идентификатор.

Пользователь, контролируемый по:

-   Впкусерсеттингс (один экземпляр для одного управляемого пользователя)
    -   Свойства для идентификатора безопасности владельца, родительского контроля On/Off, флага включения и отключения, ограничения времени включения/отключения, флага включения/отключения и общих ограничений приложения.
    -   В Windows 8 существующее свойство представляет первый полчаса для каждого часа. Для представления второй половины каждого часа было добавлено новое свойство в половину часа. Было введено дополнительное новое свойство, представляющее дневную квоту времени.

        **Windows 7 и Windows Vista:** Ограничения таймера поддерживают 1 час.

-   Впквебсеттингс (один экземпляр для одного управляемого пользователя)
    -   Свойства для владельца безопасности, флаг фильтрации вкл. выкл., уровень фильтра, флаг блокировки загрузки файлов, флаг блокировки сайтов без оценок.
-   Впкурловерриде (один экземпляр на URL-адрес явно разрешен или запрещен в списке переопределения URL-адресов, используемом в качестве списка разрешений/блокировок для фильтрации веб-содержимого)
    -   Свойства идентификатора безопасности владельца, URL-адреса, затронутого, разрешенного или заблокированного состояния.
-   Впкапповерриде (один экземпляр на путь, явно разрешенный в списке "Общие ограничения приложения" список переопределений приложений)
    -   Свойства для идентификатора безопасности владельца. Идентификатор более безопасного правила, путь к приложению.
-   Впкгамессеттингс (один экземпляр для одного управляемого пользователя)
    -   Свойства для идентификатора SID владельца, флаг разрешенных игр, идентификатор GUID системы оценок для этих параметров, разрешить флаг игр без оценок, идентификатор максимальной допустимой оценки в текущей системе, коллекция запрещенных дескрипторов.
-   Впкгамеоверриде (один экземпляр на идентификатор приложения явно разрешен или запрещен)
    -   Свойства идентификатора безопасности владельца, идентификатора приложения, определяющего игру, состояние "разрешено/запрещено".

## <a name="data-representation-notes"></a>Примечания к представлению данных

Некоторые параметры в схеме ограничены MOF-файлом с атрибутом, отличным от \_ null. Для них нельзя задать значение типа Variant null. Для всех типов, не являющихся массивами, код родительского элемента управления инициализирует значения. Для массивов пустые состояния могут быть записаны с помощью варианта null, пустого варианта или массива вариантов нулевого размера. Поставщик WMI нормализует все эти значения до представления состояния типа Variant null при чтении.

## <a name="user-interface-extensibility-link-notes"></a>Заметки по ссылке на расширяемость пользовательского интерфейса

Для регистрации ссылки на расширяемость пользовательского интерфейса с помощью инструментария WMI необходимо указать следующие сведения:

-   GUID — несколько ссылок могут совместно использовать один GUID, если они являются частью общего пакета или набора.
-   Подсистема — предназначена для обозначения классификаций типов ссылок, таких как наборы или изолированные совместимые приложения.
-   Имя DLL-файла ресурсов и ИД — Указывает ресурс для отображаемого имени, отображаемого для ссылки.
-   Путь и идентификатор DLL ресурса подзаголовка — Указывает ресурс для дополнительного текста под именем.
-   Путь к изображению — полный путь к точечному рисунку размером 24 × 24 пикселя (BMP) с глубиной цвета 8 бит на пиксель и предпочтительным альфа-каналом. Это определяется способом, согласованным с расширениями оболочки: <file system path> , <negative resource ID> . Например: C: \\ Windows \\ system32 \\Wpccpl.dll,-20.
-   Отключенный путь к изображению — то же, что и путь к изображению выше, за исключением варианта точечного рисунка с отключенным Это изображение отображается, когда родительский контроль отключен.
-   Exe path — полный путь к исполняемому файлу, который вызывается с помощью ShellExecute (). Этот путь должен быть указан с символами обратной косой черты, или ссылка не будет вызывать исполняемый файл. Добавление маркера% SID% после пути к исполняемому файлу приведет к тому, что будет заменяться строка идентификатора безопасности для пользователя, для которого в данный момент выполняется просмотр страницы концентратора. Затем исполняемый объект может использовать строку идентификатора безопасности для управления функциями указанного пользователя.

При удалении приложения должна быть удалена регистрация ссылки для расширения.

## <a name="web-extensibility-link-and-web-content-filter-override-notes"></a>Примечания по ссылке веб-расширяемости и переопределению фильтра веб-содержимого

Если задать для свойства Филтерид тот же GUID, что и существующая ссылка на расширяемость пользовательского интерфейса, отображаемая ссылка будет переноситься с универсальной ссылки в других параметрах на ссылку монопольные веб-ограничения. Это параметр на уровне компьютера, и поэтому в встроенном фильтре веб-содержимого в Интернете будет пропускать фильтрацию для всех управляемых пользователей. Описательное имя также должно быть задано в свойстве FilterName, которое указывается путем к библиотеке DLL и ИДЕНТИФИКАТОРу ресурса.

Система родительского контроля рекомендует следующее из любого переопределяющего веб-фильтра:

-   Учитывается общее состояние родительского контроля для пользователя.
-   Соблюдайте параметры отчетов о действиях для пользователя.
-   Наблюдение за свойством Филтерид. Если он меняется с идентификатора GUID, указанного поставщиком, другой фильтр принимает владение, а фильтр поставщика должен отключить себя. Добавлен COM-интерфейс для снижения издержек на периодическую проверку для этого изменения и вызова WMI.
-   Настоятельно рекомендуется использовать как доступное только для чтения, так и чтение и запись HTTP-приложения и записи списка исключений URL-адресов.
-   Рекомендуется учитывать список переопределений URL-адресов для каждого пользователя (список разрешений/блокировок).
-   Обеспечить надежность для быстрого переключения пользователей.

Родительский контроль не помещает никаких ограничений на то, как веб-или другой фильтр содержимого подключается к Windows для реализации фильтрации. Поставщики могут использовать свои текущие инвестиции или предпочтительные технологии (LSP, TDI, Other).

При удалении фильтра поставщика необходимо отменить регистрацию записей Филтерид и FilterName. Это выполняется путем установки Филтерид в значение GUID \_ null и filtername в вариант null. После этого будет снова включен фильтр веб-содержимого в Интернете.

Обратите внимание, что при повторном включении встроенного веб-фильтра будут фильтроваться только новые сеансы, а не сеансы, активные в перед параметром.

## <a name="web-content-filter-allowblock-list-exportimport-format"></a>Фильтр веб-содержимого: разрешить/блокировать список форматов экспорта и импорта

Эта функция не поддерживается в Windows 8.

**Windows 7 и Windows Vista:** Эта функция поддерживается.

<WebAddresses>

<URL AllowBlock="1">https://alloweddomain.com/</URL>

<URL AllowBlock="1">https://allowedurl.com/allowed/default.html</URL>

<URL AllowBlock="2">https://blockeddomain.com/</URL>

<URL AllowBlock="2">https://blockedurl.com/blocked/default.html</URL>

</WebAddresses>

## <a name="application-restrictions-override-notes"></a>Заметки о переопределении ограничений приложения

Переопределения ограничений приложения задаются для каждого пользователя, чтобы разрешить определенные двоичные файлы или пути. Если настроен новый пользователь, управляемый по своему усмотрению, и для этого пользователя требуются переопределения ограничений приложения, рекомендуется использовать в реестре раздел запуска Windows с небольшим приложением, помеченным как требующее повышения прав, для записи переопределений. Это приведет к появлению запроса одноразовых учетных данных для настройки переопределений для пользователя, после чего целевые двоичные файлы для переопределений не будут неудобствомы пользователям из-за дальнейших запросов переопределения администратора.

## <a name="actions-required-for-settings-changes-to-become-effective"></a>Действия, необходимые для изменения параметров, вступают в силу

Если администратор изменяет параметры стандартного пользователя, выполнившего вход, выдается предупреждающее сообщение. Он указывает, что изменения параметров могут не вступить в силу, пока контролируемый пользователь не выйдет из системы и снова войдет в систему. Это консервативный дизайн. Большинство параметров вступят в силу почти сразу же, пока контролируемый пользователь вошел в систему. Одно исключение — для игр, где параметры вступят в силу при следующем запуске обозревателя игр или при вызове игры.

## <a name="sample-code"></a>Пример кода

Примеры C++ приведены в пакете SDK, демонстрирующим использование функций расширяемости параметров. См. раздел с примерами родительского контроля.

## <a name="independent-test-tools"></a>Независимые средства тестирования

Проверка классов и экземпляров упрощается с помощью подключаемого модуля wmimgmt. msc и средства Wbemtest.exe.

## <a name="64-bit-considerations"></a>64-разрядные замечания

в 64-разрядных версиях операционных систем Windows в настоящее время установлен и 32-разрядный поставщик WMI, и 64-разрядный поставщик.

## <a name="general-code-development-and-debugging"></a>Общие сведения о разработке и отладке кода

Если Visual Studio используется для разработки кода управления параметрами, для локальной отладки потребуется запуск Visual Studio с правами администратора (вызов с помощью команды Запуск от имени администратора с использованием командной строки или щелчка правой кнопкой мыши). Это связано с изоляцией процессов и сообщений, реализованных функцией UAC.

## <a name="minimum-compliance-api-settings-read"></a>Чтение минимальных параметров API соответствия

### <a name="interfaces-and-methods"></a>Интерфейсы и методы

API соответствия, управляемый файлом заголовка Впкапи. h, предоставляет упрощенный доступ только для чтения к следующим параметрам с помощью COM-интерфейсов.

[**Ивиндовспаренталконтролс**](/windows/desktop/api/Wpcapi/nn-wpcapi-iwindowsparentalcontrols) методы корневого интерфейса предоставляют доступ к:

-   Методы Ивпксеттингс:
    -   Ислоггингрекуиред () — отчеты о действиях, настроенные для пользователя?
    -   Жетластсеттингсчанжетиме () — приложение может быть осведомлено, изменились ли политики параметров с момента предыдущей проверки.
    -   Ограничения () — Узнайте, установлены ли ограничения на веб-сайт, ограничения по времени, ограничения игры или ограничения для приложений.
-   Методы Ивпквебсеттингс:
    -   Settings () — Получает флаги для фильтрации или отключения, а также загружает заблокированные.
    -   Рекуестурловерриде () — введите запрос в механизм переопределения администратором (утверждение налево), который будет представлять собой диалоговое окно, содержащее URL-адреса для утверждения.
-   Методы Ивпкгамессеттингс:
    -   Блокировка () — для заданного идентификатора игрового приложения — это игра, заблокированная родительским контролем и по которой причина.
-   Visibility () — сведения о том, скрыт ли в данный момент пользовательский интерфейс родительского контроля.
-   Жетвебфилтеринфо () — предоставляет интерфейс для получения идентификатора текущего активного фильтра веб-содержимого.

### <a name="sample-code"></a>Пример кода

Примеры C++ приведены в пакете SDK, демонстрирующим использование API соответствия. См. раздел с примерами родительского контроля.

 

 



