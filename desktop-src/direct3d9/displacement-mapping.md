---
description: Карты смещения похожи на карты текстур, но к ним обращаются ядро вершин.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Сопоставление замещения (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495312"
---
# <a name="displacement-mapping-direct3d-9"></a>Сопоставление замещения (Direct3D 9)

Карты смещения похожи на карты текстур, но к ним обращаются ядро вершин.

## <a name="block-diagram"></a>Блоковая схема

На ранней части канала вершин имеется дополнительный этап выборки, как показано на следующей схеме, где можно вычислить карту смещения для получения данных о смещении вершин.

![Схема этапа образца в канале вершин](images/tessellatordx9.png)

Состояние выборки карт смещения может быть задано [**сетсамплерстате**](/windows/desktop/api) с использованием этапа номер 256, который представляет собой новый номер этапа. Текстура с картой смещения задается параметром [**сеттекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).

Карту можно использовать в качестве предварительной выборки, а это означает, что она может быть упорядочена таким образом, что позволяет выполнять поиск значений смещения без фильтрации.

-   Карты смещения аналогичны картам текстур, но доступны механизму вершин.
-   На ранней части канала вершин имеется дополнительный этап выборки, который может быть примером схемы смещения. Доступ к этому этапу осуществляется обычным API Сетсамплерстате, но номер этапа — D3DDMAPSAMPLER = 256.
-   Состояние выборки для карт смещения можно задать с помощью Сетсамплерстате (D3DDMAPSAMPLER,...). API.
-   Текстура карт смещения задается API Сеттекстуре (D3DDMAPSAMPLER, текстура).
-   Карту можно предварительно выборке или нет. Это означает, что он может быть упорядочен определенным образом, который позволяет выполнять поиск значений смещения без фильтрации.
-   Изменения в структуре объявления позволяют спецификации координаты текстуры, используемой для поиска текстурной гиперкарты. Например, Stream0, offset, FLOAT2, УТОЧНЯющий запрос, \_ значение смещения. Это указывает тесселяции использовать 2D-вектор float в stream0 с определенным смещением в качестве координаты текстуры для поиска карт смещения и связывания \_ с ним семантики использования значения смещения. Объявление вершинного шейдера будет содержать строку, похожую на {дкл \_ Texture0, v0}, указывающую, что семантика Texture0 должна быть связана с входным регистром v0. Искомое значение смещения копируется во входной регистр v0.
-   Существует специальный тип сопоставления смещения, когда Текстурная схема предварительно выдается. Последовательный индекс созданных вершин используется в качестве координаты текстуры для текстурной гиперкарты. Например, 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ лукуппресамплед, Usage, усажеиндекс.
-   Выходные данные уточняющего запроса — 4 с плавающей запятой.
-   Сопоставление замещения поддерживается только с N-исправлениями.
-   Драйверы должны игнорировать D3DDMAPSAMPLER в Сеттекстурестажестате, если они не обрабатывают карты смещения.
-   \_Режим D3DTEXF анизотропного фильтра не поддерживается.
-   Если D3DSAMP \_ мипфилтер в образце карт смещения не D3DTEXF \_ None, уровень детализации вычисляются следующим образом (Обратите внимание, что Адаптивное состояние тесселяции используется, даже если D3DRS \_ Енаблеадаптиветесселлатион имеет **значение false**): тмакс = Render State D3DRS \_ макстесселлатионлевел
-   Вычисление уровня тесселяции на уровне мозаики для вершины VI: (XI, Yi, Zi) так же, как описано в разделе "Адаптивная тесселяция". Уровень детализации L = log2 (Тмакс) — log2 (TE).
-   Операции фильтрации и выборки текстур следуют тем же правилам, что и для конвейера пикселей (применяется уровень детализации (Лод) и т. д.).
-   Не все форматы можно использовать в качестве карт смещения, но только для тех, которые поддерживают D3DUSAGE \_ ДМАП. Приложение может запрашивать это с помощью Чеккдевицеформат [**чеккдевицеформат**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).
-   D3DUSAGE \_ ДМАП должен быть указан в [**креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) , чтобы уведомить драйвер о том, что эта текстура будет использоваться в качестве искривленной схемы.
-   D3DUSAGE \_ ДМАП можно использовать только с текстурами. Его нельзя использовать с картами или томами Куба.
-   Текстуры и целевые объекты отрисовки, созданные с помощью D3DUSAGE \_ ДМАП, можно задать на обычных стадиях и в качестве целевых объектов рендеринга.
-   Состояния отрисовки для установки режима переноса для координат текстуры не учитываются при сопоставлении замещения. Как правило, для подсистемы тесселяции нет режимов переноса.
-   В образце карт смещения есть поведение, идентичное поведению образцов текстур пикселей. Если выполняется поиск текстуры с менее чем четырьмя каналами (например, R32f), то искомые значения переходят к соответствующим каналам регистра назначения (входная регистрация вершинного шейдера, помеченная как \_ образец семантики), а другие каналы по умолчанию имеют значение (1, 1, 1). При поиске D3DFMT на \_ уровне 8 на каналах R, G, B и по умолчанию устанавливается значение 1. Средство программной прорисовки содержит полную информацию о реализации.

## <a name="pre-sampled-displacement-mapping"></a>Предварительная выборка сопоставления смещения

-   Новое состояние выборки: D3DSAMP \_ дмапоффсет (DWORD) — offset (в вершинах) в предварительно выборке карт смещения.
-   Появился новый метод объявления: D3DDECLMETHOD \_ лукуппресамплед.
-   Адаптивную тесселяцию следует отключить.
-   Параметры фильтра текстур игнорируются. Выборка точек выполнена. Предполагается, что фильтр текстуры MIP D3DTEXF \_ None. Все остальные режимы фильтра текстуры считаются D3DTEXF \_ Point.
-   Координаты текстуры вычисляются следующим образом: U = (индекс% Текстуревидсинпикселес)/(float) (Текстуревидсинпикселес) V = (index/Текстуревидсинпикселес)/(float) (Текстурехеигхтинпикселес), где index — последовательный индекс созданных вершин плюс TSS \[ D3DSAMP \_ DMAPOFFSET \] . Последовательный Индекс задается равным нулю в начале каждого примитива и увеличивается после создания вершины.

Это изменения API, поддерживающие сопоставление смещений.

-   Добавлен один формат канала, D3DFMT \_ L16.
-   Новый флаг использования, D3DUSAGE \_ ДМАП.
-   Специальный этап текстуры, используемый для установки текстуры карт смещения, D3DDMAPSAMPLER.
-   Добавлены новые ограничения на оборудование, D3DDEVCAPS2 \_ дмапнпатч и D3DDEVCAPS2 \_ пресампледдмапнпатч. См. [D3DDEVCAPS2](d3ddevcaps2.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Конвейер вершин](vertex-pipeline.md)
</dt> </dl>

 

 
