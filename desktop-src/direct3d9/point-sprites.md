---
description: Поддержка точек-спрайтов в Direct3D 9 обеспечивает высокопроизводительную визуализацию точек (системы частиц). Спрайты точек — это обобщенные обобщенные точки, позволяющие подготавливать произвольные формы, как определено текстурами.
ms.assetid: a9046c7e-779c-4f33-b8ff-f189da3dcfc5
title: Точки спрайтов (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c988a104eb65b5e2d7e56ff2444e8d422c422df2
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104537433"
---
# <a name="point-sprites-direct3d-9"></a>Точки спрайтов (Direct3D 9)

Поддержка точек-спрайтов в Direct3D 9 обеспечивает высокопроизводительную визуализацию точек (системы частиц). Спрайты точек — это обобщенные обобщенные точки, позволяющие подготавливать произвольные формы, как определено текстурами.

-   [Элементы управления отрисовкой точек-примитивов](#point-primitive-rendering-controls)
-   [Вычисления размера точки](#point-size-computations)
-   [Отрисовка точки](#point-rendering)

## <a name="point-primitive-rendering-controls"></a>Элементы управления отрисовкой точек-примитивов

Direct3D 9 поддерживает дополнительные параметры для управления отрисовкой точек спрайтов (примитивы точек). Эти параметры позволяют точкам иметь переменный размер и иметь полную карту текстуры. Размер каждой точки определяется заданным приложением размером в сочетании с функцией на основе расстояния, вычисленной Direct3D. Приложение может указать размер точки как на уровне вершины, так и с помощью параметра D3DRS \_ POINTSIZE, который применяется к точкам без размера каждой вершины. Размер точки выражается в единицах области камеры, за исключением того момента, когда приложение передается после преобразования вершинного формата вершин (ФВФ). В этом случае функция на основе расстояния не применяется, а размер точки выражается в единицах измерения для целевого объекта отрисовки.

Координаты текстуры, вычисленные и используемые при отрисовке точек, зависят от значения параметра D3DRS \_ поинтспритинабле. Если это значение равно **true**, координаты текстуры задаются таким образом, чтобы каждая точка отображала полную текстуру. Как правило, это полезно, только если точки значительно больше одного пикселя. Если D3DRS \_ поинтспритинабле имеет значение **false**, координата текстуры вершины каждой точки используется для всей точки.

## <a name="point-size-computations"></a>Вычисления размера точки

Размер точки определяется параметром D3DRS \_ поинтскалинабле. Если это значение равно **false**, то размер заданной в приложении точки используется в качестве размера экранного пространства (после преобразования). Вершины, которые передаются в Direct3D в пространстве экрана, не рассчитывают размеры точек. указанный размер точки интерпретируется как размер экранного пространства.

Если D3DRS \_ поинтскалинабле имеет **значение true**, Direct3D вычислит размер точки на экране в соответствии со следующей формулой. Заданный приложением размер точки выражается в единицах пространства камеры.

S s = вх \* s <sub>i</sub> \* Sqrt (1/(A + B \* D ₑ + C \* (D ₑ ²)))

В этой формуле размер входной точки, <sub>i</sub>, — это либо на вершину, либо на значение \_ состояния визуализации D3DRS POINTSIZE. Факторы масштаба точки, D3DRS \_ поинтскале \_ A, D3DRS \_ ПОИНТСКАЛЕ \_ B и D3DRS \_ Поинтскале \_ C, представлены точками A, B и c. Высота окна просмотра, V h, представляет собой элемент высоты [**D3DVIEWPORT9**](d3dviewport9.md) структуры, представляющий окно просмотра. Г ₑ, расстояние от глаза до позиции (глаз в источнике) вычисляются путем получения позиции области видимости (X ₑ, Y ₑ, Z ₑ) и выполнения следующей операции.

D ₑ = Sqrt (X ₑ ² + Y ₑ ² + Z ₑ ²)

Максимальный размер точки, PM ₐ ₓ, определяется путем получения меньшего значения элемента Макспоинтсизе структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) или \_ \_ максимального состояния визуализации D3DRS POINTSIZE. Минимальный размер точки (P<sub>мин</sub>) определяется путем запроса значения D3DRS \_ POINTSIZE \_ min. Таким образом, конечный размер экранной точки (S) определяется следующим образом.

-   Если SS > ₐ ₓ, то S = P m ₐ ₓ
-   Если S < P<sub>min</sub>, то s = p <sub>min</sub>
-   В противном случае S = S

## <a name="point-rendering"></a>Отрисовка точки

Точечная точка экрана, P = (X, Y, Z, W), размером пространства экрана, используется в виде растрового изображения как грани четырехсторонней из следующих четырех вершин.

((X + S/2, Y + S/2, Z, W), (X + S/2, Y-S/2, Z, W), (X-S/2, Y-S/2, Z, W), (X-S/2, Y + S/2, Z, W))

Атрибуты цвета вершины дублируются на каждой вершине; Таким же, каждая точка всегда отображается с постоянными цветами.

Назначение индексов текстур управляется \_ параметром состояния отрисовки D3DRS поинтспритинабле. Если D3DRS \_ поинтспритинабле имеет значение **false**, координаты текстуры вершин дублируются на каждой вершине. Если D3DRS \_ поинтспритинабле имеет значение **true**, координаты текстуры на четырех вершинах устанавливаются в следующие значения.

(0. F, 0. F), (0. F, 1. F), (1. F, 0. F), (1. F, 1. F)

Это показано на схеме ниже.

![Схема квадрата с пометками вершин для значений координат (u, v) и (x, y)](images/spritepoint.png)

Если обрезка включена, точки обрезаются следующим образом. Если вершина превышает диапазон значений глубины — Минз и Максз структуры [**D3DVIEWPORT9**](d3dviewport9.md) , в которую готовится визуализация сцены, то точка существует вне представления фрустум и не подготавливается к просмотру. Если точка, учитывающая размер точки, полностью выходит за пределы окна просмотра в X и Y, то точка не подготавливается к просмотру; остальные точки подготавливаются к просмотру. Расположение точки может находиться вне окна просмотра в X или Y и по-прежнему быть частично видимым.

Точки могут быть неправильно обрезаны на определяемых пользователем плоскостях клипов. Если D3DPMISCCAPS \_ клиппланескаледпоинтс не задан в элементе примитивемисккапс структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) , точки обрезаются до определяемых пользователем роликовых плоскостей на основе только позиции вершины, игнорируя размер точки. В этом случае масштабированные точки отображаются полностью, если позиция вершины находится внутри плоскости обрезки, и отбрасывается, когда позиция вершины находится за пределами плоскости обрезки. Приложения могут предотвратить потенциальные артефакты, добавив границу с границей к резким размерам, равным максимальному размеру точки.

Если \_ установлен бит КЛИППЛАНЕСКАЛЕДПОИНТС D3DPMISCCAPS, то масштабированные точки правильно обрезаются на пользовательские плоскости.

Аппаратная обработка вершин может не поддерживать размер точек. Например, если устройство создано с D3DCREATE \_ Hardware \_ вертекспроцессинг на слое абстрагирования оборудования (HAL) (D3DDEVTYPE \_ HAL), в котором для элемента макспоинтсизе структуры [**D3DCAPS9**](/windows/desktop/api/D3D9Caps/ns-d3d9caps-d3dcaps9) задано значение 1,0 или 0,0, то все точки представляют собой один пиксель. Для отрисовки спрайтов точек с точками, размер которых меньше 1,0, необходимо использовать вершину ФВФ TL (преобразованную и освещенную) или обработку вершин программного обеспечения (D3DCREATE \_ Software \_ вертекспроцессинг). в этом случае время запуска Direct3D эмулирует визуализацию точки спрайта.

Устройство, которое выполняет обработку вершин и поддерживает точки-спрайти — для вычисления размера непреобразованных спрайтов требуется Макспоинтсизе, для которых задано значение больше 1,0 f, и требуется правильно задать для вершин или D3DRS \_ POINTSIZED3DRS \_ POINTSIZE для ВЕРШИН в TL.

Дополнительные сведения о правилах отрисовки точек, линий и треугольников см. в разделе [правила растрирования (Direct3D 9)](rasterization-rules.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Конвейер вершин](vertex-pipeline.md)
</dt> </dl>

 

 



