---
description: Direct3D поддерживает как индексированные, так и неиндексированные методы рисования.
ms.assetid: 9b94ab86-2a6a-4abd-ab56-95315f473226
title: Отрисовка из буферов вершин и индексов (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbc42da3f25787d42b0bdccdd808013f51bfa3e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103894313"
---
# <a name="rendering-from-vertex-and-index-buffers-direct3d-9"></a>Отрисовка из буферов вершин и индексов (Direct3D 9)

Direct3D поддерживает как индексированные, так и неиндексированные методы рисования. Индексированные методы используют один набор индексов для всех компонентов вершины. Данные вершин хранятся в буферах вершин, а индексные данные хранятся в буферах индексов. Ниже приведено несколько распространенных сценариев рисования примитивов с использованием буферов вершин и индексов.

Эти примеры сравнивают использование [**IDirect3DDevice9::D равпримитиве**](/windows/desktop/api) и [**IDirect3DDevice9::D равиндекседпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawindexedprimitive)

## <a name="scenario-1-drawing-two-triangles-without-indexing"></a>Сценарий 1. Рисование двух треугольников без индексирования

Предположим, что вы хотите нарисовать Quad, показанный на следующем рисунке.

![Иллюстрация квадрата, состоящего из двух треугольников](images/dip-fig1.png)

Если для отрисовки двух треугольников используется тип-примитив список треугольников, каждый треугольник будет храниться в виде трех отдельных вершин, в результате чего аналогичный буфер вершин появится на следующем рисунке.

![схема буфера вершин, определяющая три вершины для двух треугольников](images/dip-fig2.png)

Вызов рисования очень прост; начиная с позиции 0 в буфере вершин Нарисуйте два треугольника. Если отбор включен, то порядок вершин будет важен. В этом примере предполагается, что состояние исключается по часовой стрелке по умолчанию, поэтому видимые треугольники должны отображаться в порядке по часовой стрелке. Тип-примитив списка треугольников просто считывает три вершины в линейном порядке из буфера для каждого треугольника, поэтому этот вызов будет рисовать треугольники (0, 1, 2) и (3, 4, 5):


```
DrawPrimitive( D3DPT_TRIANGLELIST, // PrimitiveType
               0,                  // StartVertex
               2 );                // PrimitiveCount
```



## <a name="scenario-2-drawing-two-triangles-with-indexing"></a>Сценарий 2. Рисование двух треугольников с помощью индексирования

Как вы заметите, буфер вершин содержит дублирующиеся данные в расположениях 0 и 4, 2 и 5. Это имеет смысл, поскольку два треугольника совместно используют две общие вершины. Эти дублирующиеся данные непроизводительна, а буфер вершин можно сжать с помощью буфера индексов. Буфер вершин меньшего размера сокращает объем данных вершин, которые должны быть отправлены на графический адаптер. Что еще более важно, использование буфера индексов позволяет адаптеру хранить вершины в кэше вершин. Если рисуемый примитив содержит недавно использовавшуюся вершину, эту вершину можно извлечь из кэша, а не считывать из буфера вершин, что приводит к значительному увеличению производительности.

Индексный буфер индексируется в буфере вершин, поэтому каждая уникальная вершина должна храниться в буфере вершин только один раз. На следующей схеме показан индексированный подход к предыдущему сценарию рисования.

![схема буфера индекса для предыдущего буфера вершин](images/dip-fig3.png)

В буфере индекса хранятся значения индекса VB, которые ссылаются на определенную вершину в буфере вершин. Буфер вершин можно рассматривать как массив вершин, поэтому индекс VB — это просто индекс в буфере вершин для целевой вершины. Точно так же, индекс в индексе является индексом в буфере индекса. Это может очень быстро обойтись, если не соблюдать осторожность, поэтому убедитесь, что вы знаете, какой словарь используется: индекс значений VB в буфере вершин, индекс значений индекса в буфере, а также буфер индексов, в котором хранятся значения индекса VB.

Вызов рисования показан ниже. Значения всех аргументов обсуждаются по длине для следующего сценария рисования. Теперь просто обратите внимание, что этот вызов снова указывает Direct3D отобразить список треугольников, содержащий два треугольника, начиная с позиции 0 в буфере индекса. Этот вызов выполнит рисование тех же двух треугольников в том же порядке, что и раньше, обеспечивая правильную ориентацию по часовой стрелке:


```
   
DrawIndexedPrimitive( D3DPT_TRIANGLELIST, // PrimitiveType
                    0,                  // BaseVertexIndex
                    0,                  // MinIndex
                    4,                  // NumVertices
                    0,                  // StartIndex
                    2 );                // PrimitiveCount
```



## <a name="scenario-3-drawing-one-triangle-with-indexing"></a>Сценарий 3. Рисование одного треугольника с помощью индексирования

Представьте, что теперь нужно нарисовать только второй треугольник, но вы хотите использовать тот же буфер вершин и буфер индексов, которые используются при рисовании целых чисел, как показано на следующей схеме.

![схема буфера индекса и буфера вершин для второго треугольника](images/dip-fig4.png)

Для этого вызова рисования используется первый индекс в виде 3; Это значение называется StartIndex. В качестве наименьшего используемого индекса VB используется 0; Это значение называется Мининдекс. Несмотря на то, что для рисования треугольника требуются только три вершины, эти три вершины распределяются по четырем смежным расположениям в буфере вершин. количество расположений внутри непрерывного блока памяти буфера вершин, необходимого для вызова рисования, называется Нумвертицес, а в этом вызове будет установлено значение 4. Значения Мининдекс и Нумвертицес — это просто подсказки, помогающие оптимизировать доступ к памяти во время обработки вершин на уровне программного обеспечения. можно просто задать включение всего буфера вершин по цене производительности.

Вот вызов рисования для одиночного треугольника; значение аргумента Басевертексиндекс будет объяснено далее:


```
   
DrawIndexedPrimitive( D3DPT_TRIANGLELIST, // PrimitiveType
                    0,                  // BaseVertexIndex
                    0,                  // MinIndex
                    4,                  // NumVertices
                    3,                  // StartIndex
                    1 );                // PrimitiveCount
```



## <a name="scenario-4-drawing-one-triangle-with-offset-indexing"></a>Сценарий 4. Рисование одного треугольника с корреспондирующей индексацией

Басевертексиндекс — это значение, которое эффективно добавляется в каждый индекс VB, хранящийся в буфере индекса. Например, если мы передали значение 50 для Басевертексиндекс во время предыдущего вызова, это было бы функционально таким же, как использование буфера индексов на следующей схеме в течение времени вызова Дравиндекседпримитиве:

![схема буфера индекса со значением 50 для басевертексиндекс](images/dip-fig5.png)

Это значение редко устанавливается для любого значения, кроме 0, но может быть полезно, если требуется отделить буфер индексов от буфера вершин: Если при заполнении буфера индекса для определенной сетки расположение сетки в буфере вершин еще не известно, можно просто указать вершины сетки в начале буфера вершин. Когда наступает время на вызов Draw, просто передайте фактическое начальное расположение в качестве Басевертексиндекс.

Этот метод также можно использовать при рисовании нескольких экземпляров сетки с помощью одного буфера индекса. Например, если в буфере вершин содержалась две сетки с одинаковым порядком рисования, но слегка разные вершины (возможно, другие рассеянные цвета или координаты текстуры), то обе сетки могут быть выведены с использованием различных значений для Басевертексиндекс. Понимая эту концепцию на один шаг дальше, можно использовать один буфер индексов для рисования нескольких экземпляров сетки, каждая из которых содержится в другом буфере вершин, просто переполнить, какой буфер вершин активен, и скорректировать Басевертексиндекс по мере необходимости. Обратите внимание, что значение Басевертексиндекс также автоматически добавляется в аргумент Мининдекс, что имеет смысл при рассмотрении того, как оно используется:

Представьте, что теперь нам пришлось бы порисовать только второй треугольник Quad, используя тот же буфер индекса, что и раньше; Однако используется другой буфер вершин, в котором четыре раздела находятся в VB index 50. Относительный порядок четырех вершин остается неизменным, а только начальное расположение в буфере вершин отличается. Буфер индекс и буфер вершин будут выглядеть так, как на следующей схеме.

![схема буфера индекса и буфера вершин с индексом VB 50](images/dip-fig6.png)

Ниже приведен соответствующий вызов Draw. Обратите внимание, что Басевертексиндекс — единственное значение, которое было изменено из предыдущего сценария.


```
   
DrawIndexedPrimitive( D3DPT_TRIANGLELIST, // PrimitiveType
                    50,                 // BaseVertexIndex
                    0,                  // MinIndex
                    4,                  // NumVertices
                    3,                  // StartIndex
                    1 );                // PrimitiveCount
```



## <a name="related-topics"></a>См. также

<dl> <dt>

[Отрисовка примитивов](rendering-primitives.md)
</dt> </dl>

 

 
