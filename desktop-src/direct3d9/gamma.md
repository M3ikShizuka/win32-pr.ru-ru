---
description: Содержимое текстур часто хранится в формате sRGB.
ms.assetid: d076140d-3e91-412a-b099-9baa52f8d7d8
title: Гамма (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cea4b3ba224452e1c3be8f96b7136f4e4f649c8
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105710563"
---
# <a name="gamma-direct3d-9"></a>Гамма (Direct3D 9)

Содержимое текстур часто хранится в формате sRGB. Обычно конвейеры пикселей предполагают, что цвета будут линейными, поэтому операции смешения выполнялись в линейном пространстве. Однако, поскольку содержимое sRGB корректирует гамму, операции смешения в линейном пространстве приведут к неверным результатам. Видеоадаптеры теперь могут устранить эту проблему, отменив гамму-коррекцию при считывании любого содержимого sRGB и преобразующие данные пикселей обратно в формат sRGB при записи пикселей. В этом случае все операции внутри пиксельного конвейера выполняются в линейном пространстве.

## <a name="gamma-correction"></a>Гамма-коррекция

Direct3D 9 может:

-   Укажите, исправлена ли текстура гамма-2,2 (sRGB или нет). Драйвер будет преобразовываться в линейную гамму для операций смешения во время Сеттекстуре, или если образец будет преобразован в линейные данные во время поиска.
-   Укажите, следует ли перевернуть конвейер пикселей в пространство sRGB при записи в целевой объект прорисовки.

Все остальные цвета (снятие цвета, цвета материала, цвета вершин и т. д.) считаются линейным пространством. Приложения могут выполнять гамма-коррекцию цветов, записанных в буфер кадров, с помощью инструкций шейдера пикселей. Линейную расрезку следует применять только к каналам RGB, а не к альфа-каналу.

Не все форматы поверхности могут быть линейно. Линейно можно выполнять только форматы, которые передают [**чеккдевицеформат**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) с помощью D3DUSAGE \_ запросов \_ сргбреад. Состояние образца D3DSAMP \_ сргбтекстуре игнорируется для остальных. Для этого преобразования должны поддерживаться только форматы текстур без знака. Неподписанные форматы текстур включают только компоненты R, G, B и L. Если имеется альфа-канал, он игнорируется. Если смешанные форматы поддерживают линейную расрезку sRGB, затрагиваются только неподписанные каналы. В идеале оборудование должно выполнить линейную фильтрацию до фильтрации, но в Direct3D 9 оборудование может выполнять линейную расрезку после фильтрации.

Не все форматы поверхности могут быть записаны в пространстве sRGB. Линейно можно использовать только форматы, которые проходят [**чеккдевицеформат**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat) с флагом использования D3DUSAGE \_ Query \_ сргбврите. Состояние отрисовки D3DRS \_ сргбвритинабле игнорируется для остальных. Для обеспечения этой возможности ожидается восемь бит на канал в форматах RGB без подписи.

В идеале оборудование должно выполнять операции смешения буферов кадров в линейном пространстве, но после построителя текстуры, но до постановки в буфер кадров это оборудование разрешается выполнять. Это означает, что операции смешения буферов кадров, которые выполняются в пространстве sRGB, приведут к неверным результатам. D3DRS \_ сргбвритинабле учитывается при выполнении очистки целевого объекта рендеринга. Для оборудования, поддерживающего [несколько целевых объектов отрисовки (Direct3D 9)](multiple-render-targets.md) или [текстур с несколькими элементами (Direct3D 9)](multiple-element-textures.md), записывается только первый целевой объект отрисовки или элемент.

### <a name="api-changes"></a>Изменения API


```
// New sampler state (DWORD)
// If this is nonzero, the texture is linearized on lookup.
D3DSAMP_SRGBTEXTURE       // Default FALSE

// New render state (DWORD)
D3DRS_SRGBWRITEENABLE     // Default FALSE

// New usage flags
D3DUSAGE_QUERY_SRGBWRITE
D3DUSAGE_QUERY_SRGBREAD
```



### <a name="windowed-swap-chains"></a>Цепочки подкачки с окнами

В приложениях очень важно, чтобы приложения продолжали буферы их цепочек подкачки в линейном пространстве, чтобы обеспечить правильные операции смешения. Так как рабочий стол обычно не находится в линейном пространстве, для представления содержимого заднего буфера требуется гамма-коррекция. Приложение может влиять на это исправление, выделяя дополнительный буфер и выполняя собственную копию из линейного буфера в задний буфер. Это требует дополнительной копии, которую можно избежать, если драйвер выполняет гамма-коррекцию в рамках презентации Блит.

В Direct3D 9 новый флаг, [D3DPRESENT \_ линейное \_ содержимое](d3dpresent.md), доступен для [**отображения**](/windows/desktop/api) , что позволяет презентации неявным образом преобразовать из линейного пространства в sRGB/гамма 2,2. Приложения должны указывать этот флаг, если формат буфера в виде 16-разрядной плавающей запятой соответствует режиму, заданному в оконном режиме, с возможностью гаммы полноэкранного режима, при условии, \_ \_ что для \_ \_ возможностей устройств, получаемых через [**жетдевицекапс**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-getdevicecaps), возвращается D3DCAPS3 линейное представление sRGB.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Буфер кадров](frame-buffer.md)
</dt> </dl>

 

 
