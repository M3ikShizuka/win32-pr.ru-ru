---
description: Для многих методов отрисовки и создания содержимого требуется уникальная, непересекающаяся схема 2D-сигнала (например, текстура) на сетке.
ms.assetid: 0ec19e8c-2a14-4392-93de-7ab832784085
title: Использование Уватлас (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8faeaa0a416f6f062c81c4101ff47d5222ca75d
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127580142"
---
# <a name="using-uvatlas-direct3d-9"></a>Использование Уватлас (Direct3D 9)

> [!NOTE]
> Изначально Уватлас была поставлена в библиотеку утилти D3DX9. Последняя версия доступна на странице [UV Atlas Command-Line Tool (uvatlas.exe)](https://github.com/Microsoft/UVAtlas).

Для многих методов отрисовки и создания содержимого требуется уникальная, непересекающаяся схема 2D-сигнала (например, текстура) на сетке. К таким методам относятся:

-   Сопоставление обычного и среднего смещения
-   Имитация PRTа текстуры и схемы освещения
-   Рисование поверхности
-   Освещение-пространство текстуры

Создание уникального UV-сопоставления вручную часто занимает много времени и утомительно; Это особенно важно, когда входная геометрическая фигура является сложной и эффективной или низкой интенсивностью использования пространства текстуры. На следующем рисунке показан пример сетки и соответствующая текстура Atlas.

![Показывает пример сетки и соответствующую текстуру Atlas.](images/uvatlas1.jpg)

В этом примере показана сетка слева и соответствующая нормальная схема UV-Space (справа). Обратите внимание, что текстура Atlas содержит несколько групп или кластеров данных. Каждый кластер называется диаграммой и в приведенном выше примере отображает обычные данные для части сетки.

API-интерфейсы D3DX Уватлас автоматически создают оптимальную, не пересекающую текстуру Atlas. Интерфейсы API предоставляют входные параметры, позволяющие:

-   Уменьшение растяжения, искажения и недовыборки текстур.
-   Максимальная плотность упаковки пространства текстуры для эффективного использования памяти.
-   Предоставьте одинаковую выборку по сети, уменьшая непрерывность при частоте выборки.

## <a name="how-uvatlas-works"></a>Как работает Уватлас

API-интерфейсы Уватлас (см. раздел [функции уватлас](dx9-graphics-reference-d3dx-functions-uvatlas.md)) создают текстуру Atlas, выключая поверхность на диаграммах и упаковку диаграмм в текстуру Atlas. Используйте [**D3DXUVAtlasPartition**](d3dxuvatlaspartition.md) и [**D3DXUVAtlasPack**](d3dxuvatlaspack.md) для выполнения этих действий отдельно. или используйте [**D3DXUVAtlasCreate**](d3dxuvatlascreate.md) для секционирования, параметризации и упаковки в одном вызове.

-   [Секционирование и параметризация сетки](#partitioning-and-parameterizing-a-mesh)
-   [Использование встроенных десятков метрик для управления параметризации](#using-integrated-metric-tensors-to-control-parameterization)
-   [Использование Соседовых данных для указанного пользователем Креасес](#using-adjacency-data-for-user-specified-creases)
-   [Упаковка диаграмм в Atlas](#packing-charts-into-an-atlas)

### <a name="partitioning-and-parameterizing-a-mesh"></a>Секционирование и параметризация сетки

Во-первых, сетка разделяется на диаграммы, а затем каждая из них преобразуется в собственный \[ 0-и 1 \] UV. Цилиндр может быть параметризован одной диаграммой; для сферы с другой стороны потребуется две диаграммы, как показано на следующем рисунке.

![Иллюстрация сферы, секционированная на две диаграммы](images/uvatlas3.jpg)

Сетка, которая может быть параметризована с одной диаграммой, классифицируется как «хомеоморфик на диск», что означает, что можно распределить бесконечно гибкое, бесконечное растяжение диска на диаграмме и полностью охватить геометрию. Это растяжение, называемое хомеоморфисм, является двунаправленной функцией. Это означает, что можно переходить от одной параметризации к другой без потери информации.

Очень мало реальных сеток можно разделить на два измерения, не разделив сетку на кластеры или диаграммы. На следующем рисунке показан другой пример сетки и соответствующая текстура Atlas.

![Показывает пример сетки с различными фигурами и соответствующей текстурой Atlas.](images/uvatlas2.jpg)

Число создаваемых диаграмм определяется двумя параметрами:

-   Максимальное число диаграмм, разрешенное для Atlas
-   Максимальный размер растяжения, разрешенный для каждой диаграммы

Степень растяжения определит количество создаваемых диаграмм и общее качество выборки. Растяжение диапазонов от 0,0 (без растяжения) до 1,0 (любой размер растяжения). D3DXUVAtlasCreate и D3DXUVAtlasPartition возвращают максимальное растяжение, созданное алгоритмом. На следующем рисунке показан другой пример сетки и соответствующая текстура Atlas.

![Иллюстрация сетки примера и соответствующей текстуры Atlas](images/uvatlas4.jpg)

### <a name="using-integrated-metric-tensors-to-control-parameterization"></a>Использование встроенных десятков метрик для управления параметризации

Приоритет пространства текстуры можно задать для каждого треугольника. Для управления растяжением треугольников в результирующем пространстве на основе текстур можно предоставить интегрированные десятки. ИМТ можно указать напрямую или вычислить на основе входного сигнала, используя вычислительные функции D3DX ИМТ. Интегрированная метрика тензорные (или ИМТ) — это симметричная матрица 2x2, которая описывает растяжение треугольника в Atlas. Каждый ИМТ определяется 3 плавающей точкой, вызывайте их (a, b, c). Их можно разместить в симметричной матрице 2x2 следующим образом:


```
a b
b c
```



Затем ИМТ можно использовать для поиска расстояния между двумя векторами. С учетом двух векторов V1 и v2, где:


```
vector v1
vector v2 = v1 + (s,t)
```



Расстояние между v1 и v2 можно вычислить следующим образом:


```
sqrt((s, t) * M * (s, t)^T)
```



Иными словами, векторы (s, t) могут быть величиной растяжения в произвольном направлении в пространстве u-v. В этом случае вектором s является направление от первой к второй вершиной, а t — перекрестное произведение обычных и s. Например:


```
(1,1) * (1,1) = (2,2)
        (1,1)
IMT(1,1,1) scales by 2
```




```
(1,-1) * (1,1) = (0,0)
         (1,1)
IMT(2,0,2) scales by 2 with no shearing
```



ИМТ можно указать напрямую или вычислить на основе сигнала ввода с помощью вычислительных функций D3DX ИМТ: D3DXComputeIMTFromPerVertexSignal, D3DXComputeIMTFromPerTexelSignal, D3DXComputeIMTFromSignal и D3DXComputeIMTFromTexture \_ Graphics.

Укажите данные ИМТ напрямую, если требуется управлять выделением пространства текстуры для отдельных треугольников. Таким образом, выделяйте больше областей в Atlas к важным областям сетки (например, к лицевой части символа или сундука логотипу или областям сцены рядом с прохождением по пути к игроку). При указании ИМТ, которые являются кратными матрицы идентификаторов, итоговые треугольники будут равномерно масштабироваться в пространстве текстуры.

Например, при наличии нормального сопоставления с высоким разрешением вы можете вычислить ИМТ, чтобы предоставить больше пространства текстуры для областей с более высокой частотой в обычной карте. Треугольники «Flat» (которые сопоставлены с областями констант исходной стандартной схемы) будут иметь меньше пространства текстуры. Треугольники, которые содержат большую часть сведений о нормальном сопоставлении, получат больше текстурной области в окончательном результате. Затем можно переделать нормальную карту на меньшую текстуру, но сохранить сведения или повторно вычислить нормальную карту с более оптимальным отображением UV.

### <a name="using-adjacency-data-for-user-specified-creases"></a>Использование Соседовых данных для указанного пользователем Креасес

Определяемые пользователем сведения о соотношении соседей могут быть предоставлены функции секционирования для описания предварительно определенных креасес в сетке и, таким же, определяют границы диаграммы между смежными лицами. Это простой способ, с помощью которого вызывающий объект может указать собственное секционирование диаграммы в качестве входных данных для алгоритма, который будет дополнительно уточнять диаграммы для переноса максимально допустимого значения.

### <a name="example"></a>Пример

В этом примере показано, как можно использовать API Уватлас и средство просмотра DirectX (Dxviewer.exe) для поиска и исправления небесперебойной работы модели, которые могут значительно повлиять на размер текстуры Atlas. Вы можете получить Dxviewer.exe и узнать о нем из пакета SDK DirectX. Dxviewer.exe был удален из пакета SDK DirectX после версии 2009 августа, поэтому для ее получения необходим по крайней мере пакет SDK DirectX за Август 2009. Сведения о пакете SDK для DirectX см. в разделе [где находится пакет DirectX SDK?](../directx-sdk--august-2009-.md).

Предположим, вы начали работу с какой-либо моделью в любимом программном обеспечении для создания содержимого (в этом примере используется Главная модель Dwarf, созданная в Maya). Экспортируйте текстурированную модель в файл x и создайте текстуру Atlas с помощью D3DXUVAtlasCreate. Полученная текстура Atlas будет выглядеть примерно так, как показано на следующем рисунке.

![Иллюстрация Atlas для модели dwarf](images/uvatlas5.jpg)

Atlas имеет 22 диаграммы и максимальный растяжение 0,994.

Теперь взгляните на текстурную модель, чтобы увидеть, насколько хорошо текстура Atlas сопоставляется с геометрическим объектом. Для этого загрузите модель в средство просмотра:

-   Откройте средство просмотра из служебных программ DirectX.
-   Загрузите файл. x, нажав кнопку Открыть.
-   Чтобы включить параметр просмотра величить, нажмите кнопку вид и выберите Креасес из всплывающего окна.

На следующем рисунке показано, что должно отображаться в средстве просмотра.

![Иллюстрация текстурированной сетки в средстве просмотра](images/uvatlas6c.jpg)

Каждая строка представляет собой величить, который является смежным ребром между двумя диаграммами в текстуре Atlas. Число диаграмм, созданных алгоритмом, вызвано незначительными различиями, возможно, из-за ненепрерывности нормальной работы. Эти небольшие различия можно сократить, Велдинг данные, то есть заставляя данные, которые почти равны. Чтобы расшва нормали и скинвеигхтс, сделайте следующее:

-   Запустите средство DirectX Ops (dxops.exe) со следующей командной строкой в сетке (замените "modelName. x" на имя модели):
    ```
    Dxops.exe -s "load 'modelName.x'; Optimize n:2.01 w:2.01 uv0:0.01;  save 'newModelName.x';"
    ```

    

Это сравнение обычных и скинвеигхтс и того, где они отличаются в значении меньшим, чем 2,01, данные становятся равными. На следующих иллюстрациях показано, как можно увидеть креасес перед Велдинг (слева) и креасес после Велдинг (справа):

![Иллюстрация креасес перед Велдинг](images/uvatlas6a.jpg)![Иллюстрация креасес после Велдинг](images/uvatlas6b.jpg)

Рис. 7. Удаление креасес by Велдинг

В этом примере Велдинг удалили 86 вершин из входной сетки. Если в сетке меньше креасес, можно повторно создать Atlas, как показано на следующем рисунке.

![Иллюстрация новой Atlas с удаленным креасес](images/uvatlas8.jpg)

Atlas содержит только 7 диаграмм и максимальный растяжение приблизительно 0,0776. Новая Atlas теперь занимает меньшую текстуру (в этом примере приблизительно 30% меньше).

### <a name="packing-charts-into-an-atlas"></a>Упаковка диаграмм в Atlas

После разделения сетки на отдельные параметризованные диаграммы необходимо эффективно упаковывать диаграммы в одну текстурную карту. Это выполняется в качестве второго шага D3DXUVAtlasCreate или может быть вызвано явным образом путем вызова D3DXUVAtlasPack.

Упакованные диаграммы разделяются заданной пользователем шириной переплета. Ширина переплета — это величина разделения между диаграммами, позволяющая билинейной интерполяцию и MIP-сопоставление, чтобы избежать артефактов отрисовки на границах диаграммы. D3DX предоставляет интерфейс для автоматического заполнения этих переплетов. Дополнительные сведения см. в разделе [**ID3DXTextureGutterHelper**](id3dxtexturegutterhelper.md) .

## <a name="integrating-uvatlas-into-your-pipeline"></a>Интеграция Уватлас в конвейер

Помимо прорисовки текстур, эти функции можно интегрировать в автоматизированный конвейер. Например, вызов Уватлас может быть выдан автоматически после обновления ресурса до выполнения PRT моделирования или нормального сопоставления. Это позволяет избежать необходимости вручную ручного восстановления UV, если топология сетки была изменена.

Пример использования функций Уватлас см. в разделе [инструмент UV Atlas Command-Line (uvatlas.exe)](https://github.com/Microsoft/UVAtlas) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Дополнительные разделы](advanced-topics.md)
</dt> </dl>

 

 
