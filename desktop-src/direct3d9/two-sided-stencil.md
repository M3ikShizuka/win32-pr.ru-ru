---
description: Теневые тома используются для рисования теней с использованием буфера трафарета.
ms.assetid: 8b71d871-ee66-47c4-8190-5c75419b28b2
title: Набор элементов Two-Sided (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 95bca0b960f96d1747b2b7ad51771276df2cfe1da1fa8ac9aa4d7c1ce8ea7c03
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118290514"
---
# <a name="two-sided-stencil-direct3d-9"></a>Набор элементов Two-Sided (Direct3D 9)

Теневые тома используются для рисования теней с использованием буфера трафарета. Приложение вычисляет теневые тома, переданные геометрией ограждения, вычисляя края силуэта и вытягивая их от света в набор трехмерных томов. Затем эти тома дважды отрисовываются в буфер трафарета.

В ходе первой отрисовки рисуются многоугольники переднего обзора и увеличиваются значения буфера трафарета. В ходе второй отрисовки рисуются многоугольники заднего вида, относящиеся к теневому тому, а значения буфера трафарета уменьшаются. Как правило, значения увеличения и уменьшения уравновешивают друг друга. Однако сцена уже была отрисована с нормальной геометрией, из-за чего некоторые пиксели не прошли проверку Z-буфера при отрисовке теневого тома. Значения, оставшиеся в буфере трафарета, соответствуют пикселям в тени. Оставшееся содержимое буфера трафарета используется в качестве маски, чтобы выполнить альфа-смешение крупного, всеобъемлющего черного квартета со сценой. Если буфер трафарета используется в качестве маски, в результате затеняются пиксели, которые находятся в тени.

Это означает, что теневая геометрия рисуется дважды для каждого источника света, оказывая давление на пропускную способность вершин графического процессора. Для устранения этого эффекта разработана функция двустороннего трафарета. При таком подходе существует два набора состояний трафарета (они указаны ниже): один — для треугольников переднего обзора, другой — для треугольников заднего вида. В этом случае для каждого теневого тома рисуется по одному проходу на источник освещения.

Изменения API ограничиваются новым набором состояний рендеринга. Новому состоянию отрисовки \_ D3DRS \_ \_ стенЦилмоде можно присвоить значение **true** или **false**. По умолчанию имеет **значение false** , означающее текущее поведение (DirectX 8). Если задано **значение true** (оно будет работать, только если \_ задан параметр D3DSTENCILCAPS твосидед), следующие состояния рендеринга будут применяться только к треугольникам переднего плана (по часовой стрелке).



| Состояние визуализации        | Описание                                                                              |
|---------------------|------------------------------------------------------------------------------------------|
| D3DRS \_ стенЦилфаил  | D3DSTENCILOP, если проверка трафарета завершается ошибкой.                                                |
| D3DRS \_ стенЦилзфаил | D3DSTENCILOP, если пройден тест трафарета и z-тест завершается ошибкой.                              |
| D3DRS \_ стенЦилпасс  | D3DSTENCILOP, если пройден и набор элементов, и z-тесты.                                     |
| D3DRS \_ стенЦилфунк  | D3DCMPFUNC Fn. Проверка набора элементов пройдена, если ((ref & Mask) стенЦилфн (маска шаблона &)) имеет значение true. |



 

Новый набор состояний рендеринга применяется к треугольникам с обратным переходом (против часовой стрелки).



| Состояние визуализации             | Описание                                                                                    |
|--------------------------|------------------------------------------------------------------------------------------------|
| D3DRS \_ CCW \_ стенЦилфаил  | D3DSTENCILOP, если проверка трафарета завершается ошибкой.                                                      |
| D3DRS \_ CCW \_ стенЦилзфаил | D3DSTENCILOP, если пройден тест трафарета и z-тест завершается ошибкой.                                    |
| D3DRS \_ CCW \_ стенЦилпасс  | D3DSTENCILOP, если пройден и набор элементов, и z-тесты.                                           |
| D3DRS \_ CCW \_ стенЦилфунк  | Функция D3DCMPFUNC. Проверка набора элементов пройдена, если ((ref & Mask) стенЦилфн (маска шаблона &)) имеет значение true. |



 

Остальные состояния рендеринга набора элементов всегда применяются к треугольникам по часовой стрелке и против часовой стрелки.

D3DRS \_ \_ \_ стенЦилмоде игнорируется для линий и спрайтов, что означает, что поведение не изменилось с DirectX 8. \_ \_ Состояния отрисовки набора элементов D3DRS CCW \* не учитываются.

Новый бит крепления указывает, поддерживает ли устройство эту функцию. Драйверы, которые не поддерживают эту функцию, должны игнорировать эти новые состояния рендеринга. Все остальные биты ограниченного набора элементов применяются к обоим режимам буферизации трафаретов. Поскольку двусторонний \_ набор \_ элементов предполагает возможность рисования с помощью набора D3DCULLMODE \_ None, соответствующее ограничение должно быть установлено драйвером, если он поддерживает этот новый режим набора элементов. это следует реализовать в лабораториях майкрософт, исWindows оборудования (WHQL).

Новые состояния рендеринга:


```
D3DRS_Two_Sided_StencilMODE // BOOL (default is FALSE)
D3DRS_CCW_STENCILFAIL     // Same default as D3DRS_STENCILFAIL
D3DRS_CCW_STENCILZFAIL    // Same default as D3DRS_STENCILZFAIL
D3DRS_CCW_STENCILPASS     // Same default as D3DRS_STENCILPASS
D3DRS_CCW_STENCILFUNC     // Same default as D3DRS_STENCILFUNC
```



Новое ограничение:


```
D3DSTENCILCAPS_TWOSIDED // a flag on D3DCAPS9.StencilCaps
```



## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Методы буфера шаблона](stencil-buffer-techniques.md)
</dt> <dt>

[**D3DRENDERSTATETYPE**](./d3drenderstatetype.md)
</dt> </dl>

 

 
