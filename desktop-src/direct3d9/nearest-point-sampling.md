---
description: От приложений не требуется использовать фильтрацию текстур.
ms.assetid: bba0e485-ac5a-4e43-9eb7-25cd0c90d316
title: Выборка Nearest-Point (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee8146ce8cfc2d5852cf3847233b431352d69b8bc1f0a52f41da5ac3c9a7c89d
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119458767"
---
# <a name="nearest-point-sampling-direct3d-9"></a>Выборка Nearest-Point (Direct3D 9)

От приложений не требуется использовать фильтрацию текстур. Интерфейс Direct3D можно настроить таким образом, чтобы он вычислял адрес текселя, который часто не является целым числом, и копировал цвет текселя с ближайшим целочисленным адресом. Этот процесс называется выборкой с ближайшей точки. Это может быть быстрым и эффективным способом обработки текстур, если размер текстуры аналогичен размеру изображения-примитива на экране. В противном случае текстуру необходимо увеличить или уменьшить. Результат может быть больших, псевдонимом или размытым изображением.

Приложение C++ может выбрать выборку с ближайшей точкой, вызвав метод [**IDirect3DDevice9:: сетсамплерстате**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) . Задайте для первого параметра значение целочисленного индекса (0-7) текстуры, для которой выбирается метод фильтрации текстур. Передайте D3DSAMP \_ магфилтер, D3DSAMP \_ МИНФИЛТЕР или D3DSAMP \_ мипфилтер во второй параметр, чтобы задать фильтр увеличения, минификации или функции текстурирования. Передайте \_ точку D3DTEXF в третьем параметре.

Следует тщательно использовать выборку с ближайшей точкой, так как иногда это может вызвать графические артефакты при выборе текстуры в границах между двумя пикселей текстуры. Эта граница представляет собой расположение вдоль одной из осей текстуры (u или v), в котором используемый тексель переходит от одного текселя к другому. При выборке в точке система выбирает один или другой тексель, и результат на разных текселях может резко отличаться, поскольку пересекается граница. Это может проявиться как нежелательные графические артефакты в отображаемой текстуре. Если используется линейная фильтрация, полученный тексель вычисляется на основании обоих соседних текселей, и он плавно переходит между ними, поскольку индекс текселя пересекает границу.

Этот эффект может быть виден при разметке очень маленькой текстуры на очень большом многоугольнике, такую операцию часто называют увеличением. Например, при использовании текстуры в виде шахматной доски, выборка в ближайшей точке приводит созданию более крупной шахматной доски, на которой четко видны края. В отличие от этого, линейная фильтрация текстур создает изображение, где цвета шахматной доски плавно меняются по поверхности многоугольника.

В большинстве случаев приложения достигают наилучших результатов, избегая выборку в ближайшей точке, где это возможно. Сегодня большая часть оборудования оптимизирована для линейной фильтрации, поэтому ваше приложение не должно испытывать снижение качества при работе. Если необходимый вам эффект неизбежно требует использования выборки в ближайшей точке, например при использовании текстуры для отображения читаемых текстовых символов, ваше приложение должно проявлять особую осторожность и не производить выборку на границах текселей, которая может привести к нежелательным последствиям. На иллюстрации ниже показано, как могут выглядеть такие артефакты.

![иллюстрация прямоугольника из шести сегментов с разрывами в горизонтальных линиях в двух правых верхних квадратах](images/ptrtfct.png)

Обратите внимание, что два квадрата в правом верхнем углу группы отображаются не так, как соседние, с диагональными смещениями, выполняемыми через них. Во избежание появления таких графических артефактов необходимо понимать правила выборки текстур в Direct3D при фильтрации по ближайшей точке. Direct3D сопоставляет координату текстуры с плавающей запятой в диапазоне от \[ 0,0, 1,0 \] (0,0 до 1,0 включительно) с целым шаг текселя значением пространства в диапазоне от \[ -0,5, n-0,5 \] , где n — число пикселей текстуры в заданном измерении текстуры. Полученный индекс текстуры округляется до ближайшего целого числа. Данное сопоставление может привести к неточности выборки на границах текселей.

В качестве простого примера представьте себе приложение, которое визуализирует многоугольники в \_ режиме адресации текстуры D3DTADDRESS. Используя такое применяемое Direct3D сопоставление, индекс текстуры u сопоставляется, как показано на следующей схеме для текстуры с шириной 4 текселя.

![схема координат текстуры 0,0 и 1,0 на границе между текселями](images/ptsmpprb.png)

Обратите внимание, что координаты текстуры 0,0 и 1,0 для этой иллюстрации находятся в точности на границе между пикселей текстуры. Используя метод, с помощью которого Direct3D сопоставляет значения, координаты текстуры находятся в диапазоне от \[ -0,5, 4-0,5 \] , где 4 — это ширина текстуры. В этом случае полученный при выборке тексель является текселем 0 для индекса текстуры 1,0. Однако, если координата текстуры будет немного меньше 1,0, полученный при выборке тексель будет текселем n, а не текселем 0.

Это означает, что увеличение небольшой текстуры с помощью координат текстуры, точно равных 0,0 и 1,0, и с использованием фильтрации по ближайшей точке в выровненном по экрану треугольнике приведет к созданию пикселей, для которых выборка в сопоставлении текстуры будет выполняться на границе между текселями. Любые неточности при вычислении координат текстуры, какими бы незначительными они ни были, приводят к возникновению артефактов рядом с теми областями в отрисованном изображении, которые соответствуют краям текселей в сопоставлении текстуры.

Выполнение этого сопоставления координат текстуры с плавающей запятой с целочисленными текселями с идеальной точностью является очень сложным, требует много времени и обычно не требуется. В большинстве аппаратных реализаций используется итеративный подход для вычисления координат текстуры в расположении каждого пикселя в треугольнике. Итеративные подходы обычно скрывают эти неточности, поскольку ошибки во время итераций накапливаются равномерно.

Средство программной прорисовки Direct3D использует подход с прямой оценкой для вычисления индексов текстуры в расположении каждого пикселя. Прямое вычисление отличается от итеративного подхода тем, что любая неточность в этой операции приводит к более беспорядочному распределению ошибок. Таким образом ошибки выборки, которые происходят на границах, могут быть более заметными, поскольку средство программной прорисовки не выполняет эту операцию с идеальной точностью.

Лучший подход — использовать фильтрацию по ближайшей точке только в случае необходимости. Если использовать ее необходимо, рекомендуется слегка смещать координаты текстуры от границы, чтобы избежать возникновения артефактов.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Фильтрация текстур](texture-filtering.md)
</dt> </dl>

 

 
