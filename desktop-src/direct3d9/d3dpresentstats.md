---
description: Описывает статистику имеющуюся цепочку буферов, связанную с вызовами Пресентекс.
ms.assetid: aa100b83-6fbf-442d-9891-7fc034a5b1d5
title: Структура D3DPRESENTSTATS (D3d9types.h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- D3DPRESENTSTATS
api_type:
- HeaderDef
api_location:
- d3d9types.h
ms.openlocfilehash: b49a589fa1702f61e5a5daef806a5b36d464d0ec
ms.sourcegitcommit: 14010c34b35fa268046c7683f021f86de08ddd0a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2021
ms.locfileid: "104273830"
---
# <a name="d3dpresentstats-structure"></a>Структура D3DPRESENTSTATS

Описывает статистику имеющуюся цепочку буферов, связанную с вызовами [**пресентекс**](/windows/win32/api/d3d9/nf-d3d9-idirect3ddevice9ex-presentex) .

## <a name="syntax"></a>Синтаксис


```C++
typedef struct _D3DPRESENTSTATS {
  UINT          PresentCount;
  UINT          PresentRefreshCount;
  UINT          SyncRefreshCount;
  LARGE_INTEGER SyncQPCTime;
  LARGE_INTEGER SyncGPUTime;
} D3DPRESENTSTATS;
```



## <a name="members"></a>Члены

<dl> <dt>

**пресенткаунт**
</dt> <dd>

Тип: **[ **uint**](../winprog/windows-data-types.md)**

</dd> <dd>

Текущее число успешных вызовов, выполненных отображаемым устройством, которое в настоящий момент переводится на экран. Этот параметр является фактически ИДЕНТИФИКАТОРом последнего текущего вызова и не обязательно является общим числом выполненных вызовов API.

</dd> <dt>

**пресентрефрешкаунт**
</dt> <dd>

Тип: **[ **uint**](../winprog/windows-data-types.md)**

</dd> <dd>

Счетчик вбланк, в котором на экране отображается последнее представление, число вбланк увеличивается после каждого интервала вбланк.

</dd> <dt>

**синкрефрешкаунт**
</dt> <dd>

Тип: **[ **uint**](../winprog/windows-data-types.md)**

</dd> <dd>

Число вбланк, когда планировщик последний раз выборке время на компьютере, вызывая QueryPerformanceCounter.

</dd> <dt>

**синккпктиме**
</dt> <dd>

Тип: **[ **большое \_ целое число**](/windows/win32/api/winnt/ns-winnt-large_integer-r1)**

</dd> <dd>

Время последней выборки на компьютере планировщика, полученное путем вызова [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).

</dd> <dt>

**синкгпутиме**
</dt> <dd>

Тип: **[ **большое \_ целое число**](/windows/win32/api/winnt/ns-winnt-large_integer-r1)**

</dd> <dd>

Это значение не используется.

</dd> </dl>

## <a name="remarks"></a>Комментарии

Когда приложение 9Ex применяет режим перелистывания (D3DSWAPEFFECT \_ флипекс), приложения могут обнаруживать удаление кадров, вызывая жетпресентстатистикс в любой момент времени. Фактически они могут выполнять следующие действия.

1.  Подготовка к просмотру в обратном буфере
2.  Имеется вызов
3.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS
4.  Преобразовать следующий кадр в задний буфер
5.  Имеется вызов
6.  Повторите шаги 4 и 5 1 или несколько раз.
7.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS
8.  Сравните значения Пресентрефрешкаунт из двух хранимых структур D3DPRESENTSTATS. Приложение может вычислить соответствующий Пресентрефрешкаунт определенного параметра Пресенткаунт, основываясь на предположений Пресентрефрешкаунт Increment и Пресенткаунт присваивания кадров. Если Пресентрефрешкаунт последний пример не соответствует Пресенткаунт (т. е. Если Пресентрефрешкаунт был увеличен, но Пресенткаунт — нет, то это значит, что произошло удаление кадра).

Приложения могут определить, была ли удалена рамка с помощью выборки двух экземпляров Пресенткаунт и Жетпресентстатс (путем вызова API Жетпресентстатс в любые две точки во времени). Например, приложение мультимедиа, представленное в той же скорости, что и частота обновления монитора (например, частота обновления монитора 60 Гц, приложение представляет кадр каждые 1/60 секунд), должно представлять кадры A, B, C, D, E, каждый из которых соответствует идентификаторам (Пресенткаунт) 1, 2, 3, 7, 8.

Код приложения выглядит так, как в следующей последовательности.

1.  Отображение кадра A в задний буфер
2.  Вызов Present, Пресенткаунт = 1
3.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS
4.  Отображать следующие 4 кадра, B, C, D, E соответственно
5.  Вызов представлен 4 раза, Пресенткаунтс = 2, 3, 7, 8 соответственно
6.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS
7.  Сравните значения Пресентрефрешкаунт из двух хранимых структур D3DPRESENTSTATS. Если разница составляет 2, т. е. 2 вбланк интервалов между двумя вызовами API Жетпресентстатс, последний представленный кадр должен быть кадром C. Так как приложение представляет один вбланк интервал (частота обновления монитора), время, прошедшее между выводимым кадром а и, если представление Frame C должно быть равно 2 вбланкс.
8.  Сравните значения Пресенткаунт из двух хранимых структур D3DPRESENTSTATS. Если первый Пресенткаунт — 1 (соответствующий кадру A), а второй Пресенткаунт — 3 (соответствующий кадру C), то кадры не были удалены. Если второй Пресенткаунт имеет значение 3, что соответствует кадру D, то приложение знает, что один кадр был удален.

Обратите внимание, что Жетпресентстатистикс будет обрабатываться после вызова, независимо от состояния ФЛИПЕКС режима Пресентекс вызовов.

**Windows Vista:** В настоящее время вызовы будут поставлены в очередь, а затем будут обработаны до обработки вызова Жетпресентстатс.

Когда приложение обнаруживает, что представление определенных кадров находится позади, оно может пропустить эти кадры и исправить презентацию для повторной синхронизации с вбланк. Для этого приложение может просто не визуализировать последние кадры и начать отрисовку со следующим правильным кадром в очереди. Однако если приложение уже запустило отрисовку последних кадров, оно может использовать новый параметр present в D3D9Ex с именем D3DPRESENT \_ форцеиммедиате. Флаг передается в параметрах текущего вызова API и указывает среде выполнения, что кадр будет обрабатываться немедленно в течение следующего вбланк интервала, который фактически не отображается на экране. Ниже приведен пример использования приложения после последнего шага в предыдущем примере.

1.  Преобразовать следующий кадр в задний буфер
2.  Обнаружение из Пресентрефрешкаунт, что следующий кадр уже поздно
3.  Задать для текущего интервала значение D3DPRESENT \_ форцеиммедиате
4.  Вызов, имеющийся на следующем кадре

Приложения могут синхронизировать видео-и звуковые потоки таким же образом, так как поведение Жетпресентстатистикс не меняется в этом сценарии.

Режим отражения D3D9Ex предоставляет сведения о статистике кадров для оконных приложений и полноэкранных 9Ex приложений.

**Windows Vista:** Используйте API DWM для получения текущей статистики.

Когда диспетчер окон рабочего стола отключена, оконный режим 9Ex приложения, использующие режим отражения, получит данные статистики ограниченной точности.

* * Windows Vista: * *

Если приложение не обладает достаточной скоростью, чтобы не допустить частоты обновления монитора, возможно, из-за низкой производительности оборудования или нехватки системных ресурсов, то может возникнуть сбой графики. Сбой — это так называемый Visual затруднения. Если монитор настроен на обновление с частотой 60 Гц и приложение может управлять только 30 кадрами/с, то половина этих кадров будет иметь сбой.

Приложения могут обнаружить сбой, отслеживая Синчрефрешкаунт. Например, приложение может выполнять следующую последовательность действий.

1.  Отрисовывается в обратном буфере.
2.  Имеется вызов.
3.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS.
4.  Прорисовка следующего кадра в задний буфер.
5.  Имеется вызов.
6.  Вызовите Жетпресентстатс и сохраните полученную структуру D3DPRESENTSTATS.
7.  Сравните значения Синкрефрешкаунт из двух хранимых структур D3DPRESENTSTATS. Если разность больше единицы, кадр пропускается.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------|----------------------------------------------------------------------------------------|
| Header<br/> | <dl> <dt>D3d9types. h</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Структуры Direct3D](dx9-graphics-reference-d3d-structures.md)
</dt> </dl>

 

 
