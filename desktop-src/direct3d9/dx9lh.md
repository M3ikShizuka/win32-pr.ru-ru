---
description: в этой документации особое внимание относится к расширениям Windows Vista для графики DirectX.
ms.assetid: 3cc0b08c-e126-4f1b-b5d1-0d6c1ebeb0c5
title: сводка функций (Direct3D 9 для Windows Vista)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 242af80fa4d6f00c1e55d4852884f9fbbf8de287c6792b3b4aaaad196a6cd113
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118523081"
---
# <a name="feature-summary-direct3d-9-for-windows-vista"></a>сводка функций (Direct3D 9 для Windows Vista)

в этой документации особое внимание относится к расширениям Windows Vista для графики DirectX. для разработки возможностей DirectX для Windows Vista необходимо установить пакет sdk для Windows Vista и пакет sdk для DirectX. приложения, использующие DirectX для Windows Vista, должны использовать оборудование, использующее драйвер WDDM (модель драйвера устройства Windows) в отличие от модели XPDM (модель драйвера для XP). драйверы, не реализующие WDDM, не могут создавать экземпляры графических интерфейсов DirectX Windows Vista.

узнайте о новых функциях графики DirectX в Windows Vista в одном из следующих разделов:

-   [Изменения в поведении устройства](#device-behavior-changes)
-   [Отключение обработки многопотоковых вершин программного обеспечения](#disabling-multithreaded-software-vertex-processing)
-   [Один битовый поверхностный](#one-bit-surfaces)
-   [Чтение буферов глубины и трафаретов](#reading-depthstencil-buffers)
-   [Совместное использование ресурсов](#sharing-resources)
-   [Преобразование sRGB перед наложением](#srgb-conversion-before-blending)
-   [Усовершенствования Стретчрект](#stretchrect-improvements)
-   [Создание текстуры в системной памяти](#texture-creation-in-system-memory)

## <a name="device-behavior-changes"></a>Изменения в поведении устройства

Теперь устройства теряются только при двух обстоятельствах. При сбросе оборудования из-за зависания и при остановке драйвера устройства. При зависании оборудования устройство можно сбросить, вызвав [**ресетекс**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-resetex). При зависании оборудования память текстуры теряется.

После остановки драйвера необходимо создать объект IDirect9Ex, чтобы возобновить подготовку к просмотру.

Если область презентации скрыта другим окном в оконном режиме или когда полноэкранное приложение свернется, [**пресентекс**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-presentex) возвратит S \_ D3DPRESENTATIONOCCLUDED. Полноэкранные приложения могут возобновлять отрисовку при получении сообщения обратного вызова [**WM \_ активатеапп**](../winmsg/wm-activateapp.md) .

В предыдущих версиях DirectX при изменении режима работы приложения единственным способом восстановления был сброс устройства и повторное создание всех ресурсов видеопамяти и цепочек обмена. теперь с DirectX для Windows Vista вызов метода Reset после изменения режима не приводит к потере поверхностей памяти текстуры, текстур и сведений о состоянии, а также не требует повторного создания этих ресурсов.

## <a name="disabling-multithreaded-software-vertex-processing"></a>Отключение обработки многопотоковых вершин программного обеспечения

Добавлен новый бит Caps (D3DCREATE \_ disable \_ ПСГП \_ Threading), который отключит многопоточность для обработки вершин программного обеспечения (СВВП). Используйте этот макрос для создания флага поведения для IDirect3D9:: Креатедевице.


```
#define D3DCREATE_DISABLE_PSGP_THREADING
```



## <a name="one-bit-surfaces"></a>Один битовый поверхностный

Существует новый тип формата битовой поверхности, который может быть особенно полезен для обработки глифов текста. Новый формат называется D3DFMT \_ a1. Одноразрядная поверхность предназначена для использования в качестве текстуры для каждого пикселя или выходных данных целевого объекта прорисовки, создаваемой Компосеректс или Колорфилл. Для ширины и высоты поверхности не существует отдельных политик. реализация должна поддерживать одну поверхность размера, которая равна 2 КБ пикселей текстуры x 8 КБ пикселей текстуры.

Одноразрядная поверхность имеет один бит на шаг текселя; Таким образом, один из них означает, что все компоненты (r, g, b, a) пикселя равны 1, а нулевое значение означает, что все компоненты равны 0. Вы можете использовать одноразрядные поверхности со следующими API: Колорфилл, Упдатесурфаце и Упдатетекстуре.

При считывании одноразрядной поверхности среда выполнения может выполнять выборку образца или фильтрацию свертки. Фильтр свертки является настраиваемым (см. [**сетконволутионмонокернел**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-setconvolutionmonokernel)).

Существуют некоторые ограничения для одноразрядных поверхностей.

-   MIP-сопоставление не поддерживается
-   данные sRGB нельзя читать или записывать в одноразрядную поверхность.
-   Одноразрядную поверхность нельзя использовать в качестве текстуры вершин или для многовыборочной выборки.

## <a name="reading-depthstencil-buffers"></a>Чтение буферов глубины и трафаретов

Используйте IDirect3DDevice9:: Упдатесурфаце для чтения или записи данных глубины или трафарета из поверхностей, полученных из IDirect3DDevice9:: КреатедепсстенЦилсурфаце или IDirect3DDevice9:: ЖетдепсстенЦилсурфаце.

Сначала создайте блокируемую, только глубину или трафаретную поверхность только с помощью IDirect3DDevice9:: Креатеоффскринплаинсурфаце. Используйте один из следующих форматов:

-   D3DFMT \_ D16 \_ блокируемый
-   D3DFMT \_ D32F \_ блокируемый
-   D3DFMT \_ d32 \_ блокируемый
-   D3DFMT \_ S8 \_ блокируемый

Во-вторых, перенесите данные между буфером глубины и трафарета и вновь созданной глубиной или областью набора элементов. Перенос выполняется с помощью IDirect3DDevice9:: Упдатесурфаце.

Упдатесурфаце завершится ошибкой, если оба поверхностей имеют БЛОКИРУЕМый формат или оба являются не блокируемыми.

Передача несуществующих данных приведет к ошибке (например, передача из неблокируемой поверхности только глубины в D3DFMT \_ S8 \_ запираемая поверхность).

Остальные ограничения для IDirect3DDevice9:: Упдатесурфаце по-прежнему применяются.

## <a name="sharing-resources"></a>Совместное использование ресурсов

Теперь ресурсы Direct3D можно совместно использовать между устройствами или процессами. Это относится к любому ресурсу Direct3D, включая текстуры, буферы вершин, буферы индексов или поверхности (например, целевые объекты отрисовки, буферы трафаретов глубины и необычные Экранные поверхности). Для общего доступа необходимо назначить ресурс для совместного использования во время создания и определить ресурс в пуле по умолчанию (D3DPOOL \_ по умолчанию). После создания ресурса для совместного использования он может быть общим для всех устройств внутри процесса или совместно использоваться процессами.

Для включения общих ресурсов интерфейсы API создания ресурсов имеют дополнительный параметр Handle. Это маркер, указывающий на общий ресурс. В предыдущих версиях DirectX этот аргумент был частью сигнатуры API, но он не используется и должен быть установлен в **значение NULL**. начиная с Windows Vista используйте пшаредхандле следующим образом:

-   Установите для указателя (Пшаредхандле) **значение NULL** , чтобы не предоставить общий доступ к ресурсу. это поведение аналогично поведению DirectX до Windows Vista.
-   Чтобы создать общий ресурс, вызовите любой API создания ресурсов (см. ниже) с неинициализированным маркером (сам указатель не равен **null** (пшаредхандле! = **null**), но указатель указывает на значение **null** ( \* пшаредхандле = = **null**)). API создаст общий ресурс и возвратит допустимый маркер.
-   Чтобы открыть ранее созданный общий ресурс и получить к нему доступ с помощью ненулевого общего ресурса, задайте Пшаредхандле в качестве адреса этого маркера. После открытия ранее созданного общего ресурса таким образом можно использовать возвращенный интерфейс в API Direct3D 9 или Direct3D 9Ex, как если бы интерфейс был типичным ресурсом этого типа.

Интерфейсы API для создания ресурсов включают- [**креатетекстуре**](/windows/desktop/api), [**креатеволуметекстуре**](/windows/desktop/api), [**креатекубетекстуре**](/windows/desktop/api), [**креатерендертаржет**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget), [**креатевертексбуффер**](/windows/desktop/api), [**CreateIndexBuffer**](/windows/desktop/api), [**CreateDepthStencilSurface**](/windows/desktop/api), [**CreateOffscreenPlainSurface**](/windows/desktop/api), [**CreateDepthStencilSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createdepthstencilsurfaceex), [**CreateOffscreenPlainSurfaceEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createoffscreenplainsurfaceex)и [**CreateRenderTargetEx**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9ex-createrendertargetex).

Существуют некоторые ограничения на использование общих ресурсов. приведенные ниже.

-   API-интерфейс, используемый для открытия общего ресурса, должен соответствовать API, который использовался для создания общего ресурса. Например, если вы использовали [**креатетекстуре**](/windows/desktop/api) для создания общего ресурса, необходимо использовать **креатетекстуре** , чтобы открыть этот общий ресурс. Если для создания общего ресурса использовался [**креатерендертаржет**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget) , необходимо использовать **креатерендертаржет** для открытия этого общего ресурса и т. д.
-   При открытии общего ресурса необходимо указать D3DPOOL \_ по умолчанию.
-   Блокируемые ресурсы (текстуры с \_ динамическими D3DUSAGE, буферами вершин и буферами индексов) могут испытывать низкую производительность при совместном использовании. Блокируемая рендертаржетс не будет совместно использоваться на определенном оборудовании.
-   Ссылки на общий ресурс перекрестной обработки должны иметь те же измерения, что и исходный ресурс. При передаче обработчика между процессами Включите сведения об измерении, чтобы ссылка могла быть создана одинаково.
-   В общих межпроцессных поверхностях не предусмотрен механизм синхронизации. При необходимости чтение и запись изменений в общей поверхности могут не отражать представление области ссылающегося процесса. Чтобы обеспечить синхронизацию, используйте запросы событий или заблокируйте текстуру.
-   Только процесс, который изначально создает общий ресурс, может заблокировать его (любой процесс, открывающий ссылку на этот общий ресурс, не сможет его заблокировать).
-   Если общий ресурс заблокирован, другие процессы не смогут проверить, доступен ли ресурс.

## <a name="srgb-conversion-before-blending"></a>Преобразование sRGB перед наложением

Теперь можно проверить, может ли устройство преобразовывать данные конвейера в sRGB перед смешением буфера кадров. Это означает, что устройство преобразует значения целевого объекта рендеринга из sRGB. Чтобы узнать, поддерживается ли преобразование оборудованием, проверьте наличие этого ограничения:


```
D3DPMISCCAPS_POSTBLENDSRGBCONVERT
```



Это ограничение определяет оборудование, которое поддерживает преобразование в sRGB перед наложением. Эта возможность важна для высококачественной отрисовки из fp16ных буферов кадров в диспетчере окон рабочего стола (DWM).

## <a name="stretchrect-improvements"></a>Усовершенствования Стретчрект

В предыдущих версиях DirectX Стретчрект имеет много ограничений для размещения различных драйверов (см. раздел IDirect3DDevice9:: Стретчрект). Windows Vista построена на основе модели драйвера устройства (WDDM) Windows. Эта новая модель драйвера гораздо более надежна и позволяет драйверам справляться с особыми случаями оборудования.

В целом, единственным оставшимся ограничением является то, что целевой объект отрисовки должен быть создан с использованием целевого объекта визуализации (D3DUSAGE \_ рендертаржет). Это ограничение ликвидируется, если вы выполняете простую копию (где источник и конечный объект имеют тот же формат и не имеют подпрямоугольников).

## <a name="texture-creation-in-system-memory"></a>Создание текстуры в системной памяти

Приложения, которым требуется более гибкое использование, выделение и удаление системной памяти, теперь могут создавать текстуры из указателя системной памяти. Например, приложение может создать текстуру Direct3D на основе указателя точечного рисунка памяти GDI.

Для создания такой текстуры необходимо выполнить два действия.

-   Выделите достаточно памяти системы, чтобы вместить текстурную поверхность. Минимальное число байтов — ширина x высота x байт на пиксель.
-   Передайте адрес указателя на поверхность системной памяти для \* параметра handle в IDirect3DDevice9:: креатетекстуре.

Ниже приведен прототип функции для IDirect3DDevice9:: Креатетекстуре:


```
STDMETHOD(CreateTexture)(THIS_ UINT Width, UINT Height, UINT Levels, 
    DWORD Usage, D3DFORMAT Format, D3DPOOL Pool, IDirect3DTexture9** ppTexture, 
    HANDLE* pSharedHandle)
```



Текстура системной памяти имеет следующие ограничения.

-   Высота текстуры должна равняться ширине текстуры, равной числу байтов на пиксель.
-   При использовании сжатых форматов (DXT formats) приложение отвечает за выделение правильного размера.
-   Поддерживаются только текстуры с одним уровнем mipmap.
-   Значение, передаваемое в Креатетекстуре для аргумента pool, должно быть D3DPOOL \_ системмем.
-   Этот API заключает в оболочку переданную память в текстуре. Не выделяйте эту память до тех пор, пока не завершите работу с ней.

 

 
