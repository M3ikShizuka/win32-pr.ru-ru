---
description: Объекты буфера вершин позволяют приложениям получать прямой доступ к памяти, выделенной для данных вершин.
ms.assetid: 63d255b7-fa7d-411b-9cdb-52113f30c933
title: Доступ к содержимому буфера вершин (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e1b5e4a4986e064d3736f83567f5dd6d479d0dbc
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673131"
---
# <a name="accessing-the-contents-of-a-vertex-buffer-direct3d-9"></a>Доступ к содержимому буфера вершин (Direct3D 9)

Объекты буфера вершин позволяют приложениям получать прямой доступ к памяти, выделенной для данных вершин. Указатель на память буфера вершин можно получить, вызвав метод [**IDirect3DVertexBuffer9:: Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dvertexbuffer9-lock) , а затем получая доступ к памяти по мере необходимости для заполнения буфера новыми данными вершин или для чтения уже содержащихся в нем данных. Метод **IDirect3DVertexBuffer9:: Lock** принимает четыре параметра. Первый, *оффсеттолокк*, является смещением данных вершин. Второй параметр — это размер данных вершин, измеряемый в байтах. Третий параметр принят — адрес указателя, указывающего на данные вершин, если вызов выполнен.

Последний параметр, *Флаги* сообщает системе о том, как должна быть заблокирована память. Укажите константы для параметра *flags* в соответствии с тем, как будет осуществляться доступ к данным вершин. Убедитесь, что значение, выбранное для [**D3DUSAGE**](d3dusage.md) , совпадает со значением, выбранным для [D3DLOCK](d3dlock.md). Например, при создании буфера вершин с доступом только для записи не имеет смысла пытаться прочитать данные, указав D3DLOCK \_ ReadOnly. Использование этих флагов позволяет драйверу заблокировать память и обеспечить наилучшую производительность с учетом требуемого типа доступа.

Завершив заполнение или чтение данных вершин, вызовите метод [**IDirect3DVertexBuffer9:: Unlock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dvertexbuffer9-unlock) , как показано в следующем примере кода.


```
// This code example assumes the g_pVB is a variable of type 
//   LPDIRECT3DVERTEXBUFFER9 and that g_Vertices has been  
//   properly initialized with vertices

// Lock the buffer to gain access to the vertices 
VOID* pVertices;

if(FAILED(g_pVB->Lock(0, sizeof(g_Vertices), 
        (BYTE**)&pVertices, 0 ) ) ) 
    return E_FAIL;

memcpy(pVertices, g_Vertices, sizeof(g_Vertices));
g_pVB->Unlock();
```



Если вы создаете буфер вершин с \_ флагом D3DUSAGE WRITEONLY, не используйте \_ флаг блокировки D3DLOCK ReadOnly. Используйте флаг D3DLOCK \_ ReadOnly, если приложение будет считывать только из памяти буфера вершин. Включение этого флага позволяет Direct3D оптимизировать свои внутренние процедуры для повышения эффективности, учитывая, что доступ к памяти будет доступен только для чтения.

Сведения [](performance-optimizations.md) об использовании D3DLOCK \_ Discard или D3DLOCK \_ нуверврите для параметра flags командлета [**IDirect3DVertexBuffer9:: Lock**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dvertexbuffer9-lock)см. в разделе Использование динамических буферов вершин и индексов.

В C++, так как вы напрямую обращаетесь к памяти, выделенной для буфера вершин, убедитесь, что приложение правильно обращается к выделенной памяти. В противном случае вы рискуете выявление недействительной памяти. Используйте шаг в формате вершин, который приложение использует для перехода с одной вершины в выделенном буфере на другую. Память буфера вершин — это простой массив вершин, указанный в ФВФ. Используйте шаг с любыми определенными структурами формата вершин. Можно вычислить шаг каждой вершины во время выполнения, изучив [D3DFVF](d3dfvf.md) , содержащиеся в описании буфера вершин. В следующей таблице показан размер каждого компонента вершины.



| Флаг формата вершины | Размер              |
|--------------------|-------------------|
| D3DFVF \_ диффузный    | sizeof (DWORD)     |
| D3DFVF, \_ Обычная     | sizeof (float) x 3 |
| \_Зеркальное отражение D3DFVF   | sizeof (DWORD)     |
| D3DFVF \_ тексн       | sizeof (float) x n |
| D3DFVF \_ XYZ        | sizeof (float) x 3 |
| D3DFVF \_ ксизрхв     | sizeof (float) x 4 |



 

Число координат текстуры, представленных в формате вершины, описывается \_ флагами D3DFVF да n (где n — это значение от 0 до 8). Умножьте число наборов координат текстуры на размер одного набора координат текстуры, которые могут находиться в диапазоне от 1 до четырех с плавающей запятой, чтобы вычислить объем памяти, необходимый для этого числа координат текстуры.

Используйте итоговый шаг вершины, чтобы увеличить и уменьшить указатель памяти по мере необходимости для доступа к определенным вершинам.

## <a name="retrieving-vertex-buffer-descriptions"></a>Получение описания буфера вершин

Сведения о буфере вершин можно получить, вызвав метод [**IDirect3DVertexBuffer9::-DESC**](/windows/desktop/api) . Этот метод заполняет члены структуры [**D3DVERTEXBUFFER \_ DESC**](d3dvertexbuffer-desc.md) сведениями о буфере вершин.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Буферы вершин](vertex-buffers.md)
</dt> </dl>

 

 
