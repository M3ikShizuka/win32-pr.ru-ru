---
description: Зеркальное отражение моделирования требует, чтобы система не только знала, в каком направлении находится в дороге, а также направлена на глаз средства просмотра.
ms.assetid: 35da0ac3-4e68-4d37-a987-405fc15d0cbf
title: Отраженное освещение (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84597b63ebd064fbe27ae90b673e9c91166be96f6f45b039ba29a16de9011054
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118520177"
---
# <a name="specular-lighting-direct3d-9"></a>Отраженное освещение (Direct3D 9)

Зеркальное отражение моделирования требует, чтобы система не только знала, в каком направлении находится в дороге, а также направлена на глаз средства просмотра. Система использует упрощенную версию модели отражения света Фонга, в которой применяется вектор полупути для аппроксимации интенсивности отраженного света.

В состоянии освещения по умолчанию блики отражения не рассчитываются. Чтобы включить зеркальное освещение, обязательно установите для параметра D3DRS \_ спекуларенабле значение **true**.

## <a name="specular-lighting-equation"></a>Уравнение отраженного света

Отраженное освещение описывается в следующем уравнении:

**Зеркальное освещение = CS \* Sum \[ Ls \* (N · З)<sup></sup> \* Аттен в \* точке P\]**



 

В следующей таблице указаны переменные, их типы и диапазоны.



| Параметр    | Значение по умолчанию | Тип          | Описание                                                                                                         |
|--------------|---------------|---------------|---------------------------------------------------------------------------------------------------------------------|
| Cₛ           | (0,0,0,0)     | D3DCOLORVALUE | Отраженный цвет.                                                                                                     |
| Sum          | Н/Д           | Н/Д           | Суммирование каждого компонента отраженного света.                                                                       |
| Нет            | Н/Д           | D3DVECTOR     | Нормальная вершина.                                                                                                      |
| H            | Н/Д           | D3DVECTOR     | Вектор полупути. См. раздел по вектору полупути.                                                             |
| <sup>P</sup> | 0,0           | FLOAT         | Сила отраженного света Диапазон от 0 до +бесконечность                                                                  |
| Lₛ           | (0,0,0,0)     | D3DCOLORVALUE | Цвет отраженного света.                                                                                               |
| Atten        | Н/Д           | FLOAT         | Значение ослабления света. См. раздел " [ослабление и прожектор" (Direct3D 9)](attenuation-and-spotlight-factor.md). |
| Немедленная оплата.         | Н/Д           | FLOAT         | Коэффициент узкой направленности света. См. раздел " [ослабление и прожектор" (Direct3D 9)](attenuation-and-spotlight-factor.md).        |



 

Значение для Cₛ — либо:


```
if(SPECULARMATERIALSOURCE == D3DMCS_COLOR1)
  C = color1;
```



-   Вершинный color1, если источником отраженных материалов является D3DMCS \_ color1, а первый цвет вершин указан в объявлении вершины.
-   Вершинный color2, если источником отраженных материалов является D3DMCS \_ color2, а второй цвет вершин указан в объявлении вершины.
-   цвет отражения материала

> [!Note]  
> Если используется параметр источника отраженных материалов и не указан цвет вершины, используется отражающий цвет материала.

 

Компоненты отражения ужимаются до диапазона 0-255, после отдельной обработки и интерполяции всех источников света.

## <a name="the-halfway-vector"></a>Вектор полупути

Вектор полупути (H) существует посередине между двумя векторами: вектором из вершины объекта к источнику света и вектором из вершины объекта к положению камеры. Direct3D предоставляет два способа расчета вектора полупути. Если \_ для параметра D3DRS локалвиевер задано **значение true**, система вычисляет посередине вектора с использованием расположения камеры и расположения вершины вместе с вектором направления освещения. Это демонстрируется в следующей формуле:

**H = норма (норма (CP-президент) + L <sub>dir</sub>)**



 



| Параметр       | Значение по умолчанию | Тип      | Описание                                                  |
|-----------------|---------------|-----------|--------------------------------------------------------------|
| Cₚ              | Н/Д           | D3DVECTOR | Позиция камеры.                                             |
| Vₚ              | Н/Д           | D3DVECTOR | Положение вершины.                                             |
| L<sub>dir</sub> | Н/Д           | D3DVECTOR | Вектор направления из положения вершины к позиции источника освещения. |



 

Нахождение вектора полупути таким образом может быть затратно в плане вычислений. В качестве альтернативы параметр D3DRS \_ локалвиевер = **false** предписывает системе действовать так, будто точка зрения не бесконечно удалена по оси z. Это отражено в следующей формуле.

**H = норма ((0, 0, 1) + L <sub>dir</sub>)**



 

Этот вариант требует меньше вычислений, но он гораздо менее точен, поэтому лучше всего применять его в приложениях с ортогональной проекцией.

## <a name="example"></a>Пример

В этом примере объект расцвечивается с помощью цвет отраженного света сцены и цвета отражения материала. Код показан ниже.


```
D3DMATERIAL9 mtrl;
ZeroMemory( &mtrl, sizeof(mtrl) );

D3DLIGHT9 light;
ZeroMemory( &light, sizeof(light) );
light.Type = D3DLIGHT_DIRECTIONAL;

D3DXVECTOR3 vecDir;
vecDir = D3DXVECTOR3(0.5f, 0.0f, -0.5f);
D3DXVec3Normalize( (D3DXVECTOR3*)&light.Direction, &vecDir );

light.Specular.r = 1.0f;
light.Specular.g = 1.0f;
light.Specular.b = 1.0f;
light.Specular.a = 1.0f;

light.Range = 1000;
light.Falloff = 0;
light.Attenuation0 = 1;
light.Attenuation1 = 0;
light.Attenuation2 = 0;
m_pd3dDevice->SetLight( 0, &light );
m_pd3dDevice->LightEnable( 0, TRUE );
m_pd3dDevice->SetRenderState( D3DRS_SPECULARENABLE, TRUE );

mtrl.Specular.r = 0.5f;
mtrl.Specular.g = 0.5f;
mtrl.Specular.b = 0.5f;
mtrl.Specular.a = 0.5f;
mtrl.Power = 20;
m_pd3dDevice->SetMaterial( &mtrl );
m_pd3dDevice->SetRenderState(D3DRS_SPECULARMATERIALSOURCE, D3DMCS_MATERIAL);
```



Согласно уравнению, получившийся цвет для вершин объекта — это сочетание цвета материала и цвета света.

На следующих двух иллюстрациях показан цвет отражения материала, серый, и цвет отраженного света, белый.

![иллюстрация серой сферы](images/amb1.jpg)![Иллюстрация белой сферы](images/lightwhite.jpg)

Итоговый блик показан на следующей иллюстрации.

![Иллюстрация блика](images/lights.jpg)

Объединение блика с рассеянным и общим светом дает следующий результат. Применение всех трех типов освещения дает более реалистичное изображение объекта.

![Иллюстрация сочетания бликов, общего и рассеянного света](images/lightads.jpg)

Отраженный свет требуют больше вычислительных ресурсов, чем рассеянный свет. Обычно он применяется для предоставления визуальных подсказок о материале поверхности. Блики варьируются по размеру и цвету для разных материалов поверхности.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Математика освещения](mathematics-of-lighting.md)
</dt> </dl>

 

 



