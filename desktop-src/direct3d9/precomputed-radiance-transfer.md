---
description: Предварительно вычисленный перенос Радианце (Direct3D 9)
ms.assetid: 2a233d23-9a9e-4774-9be0-f3bfe0369b21
title: Предварительно вычисленный перенос Радианце (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 94829a2559888c61ae795309bac5d1ab699d7f27
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104566860"
---
# <a name="precomputed-radiance-transfer-direct3d-9"></a>Предварительно вычисленный перенос Радианце (Direct3D 9)

## <a name="using-precomputed-radiance-transfer"></a>Использование предварительно вычисленного Радианценого перемещения

В интересных сценах есть несколько форм сложности, в том числе способ моделирования среды освещения (т. е. модели освещения с областями по отношению к точкам и направлениям) и модели глобальных эффектов (например, тени, взаимозависимости, точечные подповерхности). Традиционные методы интерактивной отрисовки моделируют ограниченную степень сложности. PRT обеспечивает эти эффекты с некоторыми существенными ограничениями.

-   Предполагается, что объекты являются жесткими (то есть без преобразований).
-   Это объектно-ориентированный подход (если объекты не перемещаются вместе, эти глобальные эффекты не поддерживаются).
-   Моделируются только освещение с низкой частотой (что приводит к мягким теням). Для индикаторов высокой частоты (острых теней) следует применять традиционные методы.

PRT требуется один из следующих типов, но не оба.

-   модели с высоким уровнем мозаики и VS \_ 1 \_ 1
-   PS \_ 2 \_ 0

### <a name="standard-diffuse-lighting-versus-prt"></a>Стандартное рассеянное освещение и PRT

Следующая иллюстрация отображается с использованием традиционной модели освещения (n · l). Четкие тени можно включить с помощью другого прохода и какой-то другой способ создания тени (карты глубины тени или теневые тома). Добавление нескольких источников света потребует нескольких проходов (при использовании теней) или более сложных шейдеров с традиционными методами.

![снимок экрана с изображением, отображаемым с помощью традиционной модели освещения](images/prt-diffuse-cropped.png)

Следующая иллюстрация отображается с PRT с использованием наилучшей аппроксимации одного направленного освещения, который он может разрешить. Это приводит к созданию мягких теней, которые трудно создать с помощью традиционных методов. Поскольку PRT всегда моделирует завершение сред освещения, добавляя несколько источников света или карту среды, вы только изменяете значения (но не число) констант, используемых шейдером.

![снимок экрана с изображением, отображаемым с помощью PRT](images/prt-diffuseshadows-cropped.png)

### <a name="prt-with-interreflections"></a>PRT с использованием взаимоотражений

Прямое освещение достигает поверхности непосредственно от света. При переходе на другую поверхность некоторые моменты между переделами становятся небольшими. PRT может моделировать это поведение без изменения производительности во время выполнения, просто запустив симулятор с различными параметрами.

Следующая иллюстрация создается только с прямым PRT (0 возвращается без прямых отражений).

![снимок экрана с изображением, отображаемым только с прямым PRT](images/prt-nointerreflections.png)

На следующем рисунке создается с помощью PRT с пересчетами (2 отскоками с взаимоотражениями).

![снимок экрана с изображением, отображаемым с помощью PRT с использованием взаимоотражений](images/prt-interreflections.png)

### <a name="prt-with-subsurface-scattering"></a>PRT с разбросами подповерхности

Рассеивание подповерхности — это метод, который моделирует, как освещение проходит через определенные материалы. Например, нажмите кнопку с изображением фонарика для ладони своей руки. Освещение от фонарик проходит через руки, перемещается вокруг (изменение цвета в процессе) и выходит с другой стороны руки. Это также можно моделировать с помощью простых изменений в симуляторе и без изменений в среде выполнения.

На следующем рисунке показано PRT с разбросами подповерхности.

![снимок экрана с изображением, отображаемым с помощью PRT с разбросами подповерхности](images/prt-subsurface.png)

## <a name="how-prt-works"></a>Как работает PRT

Следующие термины полезны для понимания того, как работает PRT, как показано на следующей схеме.

Source Радианце: источник радианце представляет среду освещения в целом. В PRT произвольная среда приблизительна с учетом сферического гармонического. это освещение предполагается удаленно относительно объекта (то же самое предположение, которое было сделано с картами среды).

Выход из Радианце: Exit радианце — это источник, который выходит с точки на поверхности с любого возможного источника (отражен радианце, рассеивание подповерхности, эмиссия).

Векторы передачи: векторы передачи сопоставляют источник Радианце с выходом радианце и предварительно вычисляются в автономном режиме с помощью сложной модели освещения.

![Схема работы PRT](images/prt-lightingpicture.png)

PRT факторы процесса отрисовки в два этапа, как показано на следующей схеме:

1.  Дорогостоящая модель освещения с низкой интенсивностью позволяет использовать коэффициенты передачи, которые могут использоваться во время выполнения.
2.  Относительно упрощенный этап времени выполнения сначала приблизительно отражает среду освещения с учетом сферического гармонического, а затем использует эти коэффициенты освещения и коэффициенты предварительно вычисленных передаваемых данных (из этапа 1) с простым шейдером, что приводит к выходу радианце (источнику, оставляемому объектом).

![Схема потока данных PRT](images/prt-dataflow.png)

### <a name="how-to-use-the-prt-api"></a>Как использовать API PRT

1.  Вычисление векторов перемещения с помощью одного из вычислений... методы [**ID3DXPRTEngine**](id3dxprtengine.md).

    Для непосредственного реагирования на эти векторы передач требуется значительный объем памяти и вычислений шейдеров. Сжатие значительно сокращает объем памяти и вычисление шейдера.

    Окончательные значения освещения вычисляются в шейдере вершин, который реализует следующее сжатое уравнение отрисовки.

    ![уравнение отрисовки PRT](images/prt-shaderequation.png)

    Где:

    

    | Параметр      | Описание                                                                                                     |
    |----------------|-----------------------------------------------------------------------------------------------------------------|
    | RP             | Один канал выхода радианце в вершине p и вычисляется на каждой вершине сетки.                     |
    | MK             | Среднее для Cluster k. Это порядковый вектор коэффициента ².                                               |
    | k              | ИДЕНТИФИКАТОР кластера для вершины p.                                                                                    |
    | L<sup>'</sup>  | Приближение радианце источника к функциям SH. Это порядковый вектор коэффициента ². |
    | j              | Целое число, которое суммирует по количеству векторов PCA.                                                            |
    | w<sub>PJ</sub> | Вес ЖС PCA для точки p. Это один коэффициент.                                                   |
    | Б<sub>KJ</sub> | Вектор ЖС PCA для кластера k. Это порядковый вектор коэффициента ².                               |

    

     

    Извлечение... методы [**ID3DXPRTCompBuffer**](id3dxprtcompbuffer.md) обеспечивают доступ к сжатым данным из имитации.

2.  Вычислите исходный радианце.

    В API есть несколько вспомогательных функций для решения различных распространенных сценариев освещения.

    

    | Функция                                                         | Назначение                                                                                                     |
    |------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
    | [**D3DXSHEvalDirectionalLight**](d3dxshevaldirectionallight.md) | Приблизительный обычный направленный источник.                                                              |
    | [**D3DXSHEvalSphericalLight**](d3dxshevalsphericallight.md)     | Приблизительные локальные источники освещения. (Обратите внимание, что PRT работает только с средами освещения расстояний.) |
    | [**D3DXSHEvalConeLight**](d3dxshevalconelight.md)               | Приближение к удаленному источнику освещения области. В качестве примера можно привести солнце (очень маленький угол конуса).              |
    | [**D3DXSHEvalHemisphereLight**](d3dxshevalhemispherelight.md)   | Вычисляет освещение, которое является линейной интерполяцией между двумя цветами (по одному на каждом полюсе сферы).         |

    

     

3.  Вычислите радианце выхода.

    Уравнение 1 теперь должно вычисляться в каждой точке с помощью шейдера вершин или пиксельных построителей текстуры. Перед вычислением шейдера необходимо предварительно вычислить константы и загрузить их в таблицу констант (Дополнительные сведения см. в [примере демонстрационного примера PRT](https://msdn.microsoft.com/library/Ee418763(v=VS.85).aspx) ). Сам шейдер является простой реализацией этого уравнения.

    ```
    struct VS_OUTPUT
    {
        float4 Position   : POSITION;   // vertex position 
        float2 TextureUV  : TEXCOORD0;  // vertex texture coordinates 
        float4 Diffuse    : COLOR0;     // vertex diffuse color
    };

    VS_OUTPUT Output;   
    Output.Position = mul(vPos, mWorldViewProjection);

    float4 vExitR = float4(0,0,0,0);
    float4 vExitG = float4(0,0,0,0);
    float4 vExitB = float4(0,0,0,0);
        
    for (int i=0; i < (NUM_PCA_VECTORS/4); i++) 
    {
       vExitR += vPCAWeights[i] * 
           vClusteredPCA[iClusterOffset+i+1+(NUM_PCA_VECTORS/4)*0];
       vExitG += vPCAWeights[i] * 
           vClusteredPCA[iClusterOffset+i+1+(NUM_PCA_VECTORS/4)*1];
       vExitB += vPCAWeights[i] * 
           vClusteredPCA[iClusterOffset+i+1+(NUM_PCA_VECTORS/4)*2];
    }
       
    float4 vExitRadiance = vClusteredPCA[iClusterOffset];
    vExitRadiance.r += dot(vExitR,1);
    vExitRadiance.g += dot(vExitG,1);
    vExitRadiance.b += dot(vExitB,1);

    Output.Diffuse = vExitRadiance;
    ```

    

## <a name="references"></a>Ссылки

Дополнительные сведения о PRT и сферных гармониях см. в следующих документах:


```
Precomputed Radiance Transfer for Real-Time Rendering in Dynamic, 
Low-Frequency Lighting Environments 
P.-P. Sloan, J. Kautz, J. Snyder
SIGGRAPH 2002 

Clustered Principal Components for Precomputed Radiance Transfer 
P.-P. Sloan, J. Hall, J. Hart, J. Snyder 
SIGGRAPH 2003 

Efficient Evaluation of Irradiance Environment Maps 
P.-P. Sloan 
ShaderX 2,  W. Engel 

Spherical Harmonic Lighting: The Gritty Details 
R. Green 
GDC 2003 

An Efficient Representation for Irradiance Environment Maps 
R. Ramamoorthi, P. Hanrahan 

A Practical Model for Subsurface Light Transport 
H. W. Jensen, S. R. Marschner, M. Levoy, and P. Hanrahan 
SIGGRAPH 2001 

Bi-Scale Radiance Transfer 
P.-P. Sloan, X. Liu, H.-Y. Shum, J. Snyder
SIGGRAPH 2003 

Fast, Arbitrary BRDF Shading for Low-Frequency Lighting Using Spherical 
Harmonics 
J. Kautz, P.-P. Sloan, J. Snyder
12th Eurographics Workshop on Rendering 

Precomputing Interactive Dynamic Deformable Scenes 
D. James, K. Fatahalian 
SIGGRAPH 2003 

All-Frequency Shadows Using Non-linear Wavelet Lighting Approximation 
R. Ng, R. Ramamoorth, P. Hanrahan 
SIGGRAPH 2003 

Matrix Radiance Transfer 
J. Lehtinen, J. Kautz
SIGGRAPH 2003 

Math World 
E. W. Weisstein, Wolfram Research, Inc. 

Quantum Theory of Angular Momentum 
D. A. Varshalovich, A.N. Moskalev, V.K. Khersonskii 
```



## <a name="related-topics"></a>См. также

<dl> <dt>

[Дополнительные разделы](advanced-topics.md)
</dt> <dt>

[Уравнения PRT (Direct3D 9)](prt-equations.md)
</dt> <dt>

[Представление PRT с текстурами (Direct3D 9)](representing-prt-with-textures.md)
</dt> <dt>

[**ID3DXPRTBuffer**](id3dxprtbuffer.md)
</dt> <dt>

[**ID3DXPRTCompBuffer**](id3dxprtcompbuffer.md)
</dt> <dt>

[**ID3DXPRTEngine**](id3dxprtengine.md)
</dt> <dt>

[**ID3DXTextureGutterHelper**](id3dxtexturegutterhelper.md)
</dt> <dt>

[Предварительно вычисленные функции пересылки Радианце](dx9-graphics-reference-d3dx-functions-prt.md)
</dt> <dt>

[Математические функции](dx9-graphics-reference-d3dx-functions-math.md)
</dt> </dl>

 

 



