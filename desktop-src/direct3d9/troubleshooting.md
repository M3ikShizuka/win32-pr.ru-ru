---
description: В этом разделе перечислены распространенные категории проблем, которые могут возникнуть при написании приложений Direct3D, и способы их предотвращения.
ms.assetid: 27b87f0f-7118-4252-b6e8-6ea18a9399e4
title: Устранение неполадок (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6726e761dd8c15e2da18e6c370472a73e82cef0b
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105710676"
---
# <a name="troubleshooting-direct3d-9"></a>Устранение неполадок (Direct3D 9)

В этом разделе перечислены распространенные категории проблем, которые могут возникнуть при написании приложений Direct3D, и способы их предотвращения.

## <a name="device-creation"></a>Создание устройства

Если во время создания устройства происходит сбой приложения, проверьте наличие следующих распространенных ошибок.

-   Убедитесь, что вы проверите возможности устройства, в частности, глубины прорисовки.
-   Изучите код ошибки. D3DERR \_ аутофвидеомемори всегда возможно.
-   Используйте отладочные библиотеки динамической компоновки DirectX (DLL) и проверьте выходные сообщения в отладчике.

## <a name="using-lit-vertices"></a>Использование освещенных вершин

Приложения, использующие освещенные вершины, должны отключить подсистему освещения Direct3D, установив \_ для состояния рендеринга D3DRS **значение false**. По умолчанию, когда освещение включено, система устанавливает цвет для любой вершины, которая не содержит обычного вектора в 0 (черный цвет), даже если входная вершина содержала ненулевое значение цвета. Так как освещенные вершины не, по своей природе, содержат нормальную вершину, любые сведения о цветах, передаваемые в Direct3D, теряются при отрисовке, если включен механизм освещения.

Очевидно, что цвет вершины важен для любого приложения, которое выполняет собственное освещение. Чтобы система не установления значения по умолчанию, убедитесь, что для параметра D3DRS \_ освещение установлено **значение false**.

Если приложение выполняется, но ничего не отображается, проверьте наличие следующих распространенных ошибок.

-   Убедитесь, что треугольники не выводятся.
-   Убедитесь, что ваши треугольники не исключаются.
-   Убедитесь, что преобразования внутренне согласованы.
-   Проверьте параметры окна просмотра, чтобы убедиться, что они позволяют видеть треугольники.

## <a name="debugging"></a>Отладка

Отладка приложения Direct3D может быть непростой задачей. Воспользуйтесь следующими методами, помимо проверки всех возвращаемых значений, особенно важных советов по программированию Direct3D, которые зависят от реализации оборудования.

-   Переключитесь на отладку библиотек DLL.
-   Принудительно использовать программное устройство, отключив аппаратное ускорение, даже если оно доступно.
-   Принудительный запуск поверхностей в системной памяти.
-   Создайте параметр для запуска в окне, чтобы можно было использовать встроенный отладчик.

Второй и третий параметры в этом списке позволяют избежать блокировки Win16, которая в противном случае может привести к зависанию отладчика.

Кроме того, попробуйте добавить следующие записи в Win.ini.


```
[Direct3D] 
debug=3 
[DirectDraw] 
debug=3 
```



## <a name="borland-floating-point-initialization"></a>Инициализация Floating-Point Borland

Компиляторы от Borland сообщают об исключениях с плавающей запятой способом, несовместимым с Direct3D. Чтобы решить эту проблему, включите \_ обработчик исключений matherr, как в следующем примере:


```
// Borland floating point initialization 
#include <math.h>
#include <float.h>

void initfp(void)
{
    // Disable floating point exceptions
    _control87(MCW_EM,MCW_EM);
}

int _matherr(struct _exception  *e)
{
    e;               // Dummy reference to catch the warning
    return 1;        // Error has been handled
}
```



## <a name="parameter-validation"></a>Проверка параметров

По соображениям производительности отладочная версия времени выполнения Direct3D в режиме интерпретации выполняет больше проверки параметров, чем розничная версия, которая иногда не выполняет никакой проверки. Это позволяет приложениям выполнять надежную отладку с медленным компонентом времени выполнения отладки, прежде чем использовать более быструю розничную версию для настройки производительности и окончательного выпуска.

Хотя несколько методов режима интерпретации Direct3D накладывают ограничения на значения, которые они могут принимать, эти ограничения часто проверяются и применяются в отладочной версии времени выполнения Direct3D Mode. Приложения должны соответствовать этим ограничениям, или непредсказуемые и нежелательные результаты могут возникать при выполнении в розничной версии Direct3D. Например, метод [**IDirect3DDevice9::D равпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitive) принимает параметр (примитивекаунт), который указывает количество примитивов, которые будут отображены методом. Метод может принимать значения только от 0 до D3DMAXNUMPRIMITIVES. В отладочной версии Direct3D при передаче более чем D3DMAXNUMPRIMITIVES примитивов метод завершается неудачно, выводит сообщение об ошибке в журнал ошибок и возвращает приложению значение ошибки. И наоборот, если приложение выполняет ту же ошибку при выполнении в розничной версии среды выполнения, поведение не определено. Из соображений производительности метод не проверяет параметры, что приводит к непредсказуемому и полностью определенному поведению в ситуации, когда они недопустимы. В некоторых случаях вызов может работать, и в других случаях это может привести к сбою памяти в Direct3D. Если недопустимый вызов постоянно работает с определенной конфигурацией оборудования и версией DirectX, нет никакой гарантии, что она будет продолжать работать на другом оборудовании или в более поздних версиях DirectX.

Если приложение сталкивается с неправильными сбоями при работе с файлом времени выполнения Direct3D для розничной торговли, протестируйте отладочную версию и внимательно просмотрите случаи, когда приложение передает недопустимые параметры. Используйте приложение панели управления DirectX, при необходимости переключитесь в среду выполнения отладки и установите флажок "прерывать на D3DError". Этот параметр приведет к тому, что среда выполнения будет использовать метод Windows DebugBreak для принудительного завершения приложения при обнаружении ошибки приложения.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Советы по программированию](programming-tips.md)
</dt> </dl>

 

 
