---
description: MIP-карта — это последовательность текстур, каждая из которых представляет собой одно и то же изображение с последовательно снижающимся разрешением.
ms.assetid: b64abca9-0efb-4939-849d-e75a8d0dc10b
title: Фильтрация текстур с помощью MIP-карты (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bdc109ae6de93a26b5d5e5b90e948761e92ee92c
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104553896"
---
# <a name="texture-filtering-with-mipmaps-direct3d-9"></a>Фильтрация текстур с помощью MIP-карты (Direct3D 9)

MIP-карта — это последовательность текстур, каждая из которых представляет собой одно и то же изображение с последовательно снижающимся разрешением. Высота и ширина каждого изображения, или уровня в mipmap, — это степень числа двух меньше предыдущего уровня. MIP-карты не обязаны быть квадратными.

Изображения MIP-карт с высоким разрешением используются для объектов, расположенных близко к пользователю. Изображения с низким разрешением используются для объектов, отображаемых дальше. Использование MIP-карт улучшает качество отображаемой текстуры за счет использования большего объема памяти.

Direct3D представляет MIP-карты как цепочку присоединенных поверхностей. Текстура с наиболее высоким разрешением находится в начале цепочки, а далее к ней присоединяются последующие уровни MIP-карты. Этот уровень тоже имеет вложение — следующий уровень MIP-карты, и так далее до самого низкого разрешения MIP-карты.

На следующих рисунках показан пример таких уровней. Точечные текстуры представляют собой знак на контейнере в трехмерной игре от первого лица. При создании MIP-карты текстура с самым высоким разрешением является первой в наборе. Каждая последующая текстура в наборе MIP-карт меньше предыдущей по высоте и ширине на число, соответствующее степени двух. В этом случае максимальное разрешение MIP-карты — 256 пикселей на 256 пикселей. Далее следует текстура размером 128x128 пкс. Последняя текстура в цепочке имеет размеры 64x64 пкс.

Этот знак расположен на максимальном расстоянии, на котором его можно увидеть. Если пользователь находится далеко от знака, игра отображает самую маленькую текстуру в цепочке MIP-карт, которая в данном случае имеет размер 64x64 пкс.

![изображение текстуры знака опасности размером 64x64 пкс](images/mip1.jpg)

Когда пользователь перемещает точку зрения ближе к знаку, используются текстуры цепочки MIP-карты с постепенно увеличивающимся разрешением. Разрешение на следующем рисунке — 128x128 пкс.

![изображение текстуры знака опасности размером 128x128 пкс](images/mip2.jpg)

Текстура с самым высоким разрешением используется, когда точка зрения пользователя находится на минимально допустимом расстоянии от знака, как показано на следующем рисунке.

![изображение текстуры знака опасности размером 256x256 пкс](images/mip3.jpg)

Это более эффективный способ имитации перспективы для текстур. Вместо отрисовки одной текстуры во многих разрешениях, быстрее использовать несколько текстур в разных разрешениях.

Direct3D может оценить, какая текстура в наборе MIP-карт имеет разрешение, наиболее близкое к требуемому для вывода, и сопоставляет пиксели пространству текселей. Если разрешение конечного изображения является промежуточным между двумя разрешениями текстур в наборе MIP-карт, Direct3D проверяет тексели обеих MIP-карт и накладывает их цветовые значения друг на друга.

Для использования MIP-карт ваше приложение должно построить набор MIP-карт. Приложения применяют MIP-карты, выбирая набор MIP-карт в качестве первой текстуры в наборе текущих текстур. Дополнительные сведения см. в разделе [смешение текстур (Direct3D 9)](texture-blending.md).

Затем приложение должно установить метод фильтрации, который использует Direct3D для выборки текселей. При самом быстром методе фильтрации MIP-карт Direct3D выбирает ближайший тексель. \_Чтобы выбрать это, используйте перечислимое значение точки D3DTEXF. С помощью Direct3D можно улучшить фильтрацию результатов, если приложение использует \_ значение линейной перечисленности D3DTEXF. В этом случае выбирается ближайшая MIP-карта, после чего вычисляется взвешенное среднее значение текселей, окружающих точку текстуры, которой сопоставлен текущий пиксель.

Текстуры MIP-карт используются в трехмерных сценах, чтобы уменьшить время, необходимое для обработки сцены. Они также повышают реалистичность сцены. Однако зачастую для этого требуется большой объем памяти.

## <a name="creating-a-set-of-mipmaps"></a>Создание набора MIP-карты

В следующем примере показано, как приложение может вызвать метод [**IDirect3DDevice9:: креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) для создания цепочки из пяти уровней mipmap: 256x256, 128x128, 64 x 64, 32x32 и 16x16.


```
// This code example assumes that m_d3dDevice is a
// valid pointer to a IDirect3DDevice9 interface

IDirect3DTexture9 * pMipMap;
m_pD3DDevice->CreateTexture(256, 256, 5, 0, D3DFMT_R8G8B8, 
    D3DPOOL_MANAGED, &pMipMap);
```



Первые два параметра, которые принимаются параметром [**IDirect3DDevice9:: креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) , имеют размер и ширину текстуры верхнего уровня. Третий параметр указывает количество уровней в текстуре. Если присвоить этому параметру значение 0, Direct3D создает цепочку поверхностей, каждая из которых меньше, чем предыдущая, и до наименьшего возможного размера 1x1. Четвертый параметр задает использование для этого ресурса; в этом случае указывается значение 0, указывающее на отсутствие конкретного использования ресурса. Пятый параметр указывает формат поверхности для текстуры. Используйте значение из перечисляемого типа [D3DFORMAT](d3dformat.md) для этого параметра. Шестой параметр указывает член перечислимого типа [**D3DPOOL**](./d3dpool.md) , указывающий класс памяти, в который будет размещен созданный ресурс. Если динамические текстуры не используются, \_ рекомендуется использовать управляемый D3DPOOL. Последний параметр принимает адрес указателя на интерфейс [**IDirect3DTexture9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dtexture9) .

> [!Note]  
> Каждая поверхность в цепочке mipmap имеет измерения, которые находятся в одной половине от предыдущей поверхности в цепочке. Если MIP-карта верхнего уровня имеет размер 256x128 пкс, размер MIP-карты второго уровня составит 128x64 пкс, третьего уровня — 64x32 пкс и так далее до 1x1 пкс. Невозможно запросить в Levels число уровней MIP-карт, которое приведет к тому, что ширина или высота любой из MIP-карт в цепочке станет меньше 1 пкс. В простом случае поверхности MIP-карты размером 4x2 пкс максимально допустимое значение Levels — 3. Размер верхнего уровня равен 4x2 пкс, размер второго уровня — 2x1, а третьего уровня — 1x1 пкс. При значении Levels больше 3 будет получено дробное значение высоты MIP-карты второго уровня, поэтому использование такого значения запрещено.

 

## <a name="selecting-and-displaying-a-mipmap"></a>Выбор и отображение mipmap

Вызовите метод [**IDirect3DDevice9:: сеттекстуре**](/windows/desktop/api) , чтобы задать текстуру mipmap в качестве первой текстуры в списке текущих текстур. Дополнительные сведения см. в разделе [смешение текстур (Direct3D 9)](texture-blending.md).

После того как приложение выберет набор текстур mipmap, ему необходимо присвоить значения из перечисляемого типа [**D3DTEXTUREFILTERTYPE**](./d3dtexturefiltertype.md) к \_ состоянию D3DSAMP мипфилтер. Затем Direct3D автоматически выполняет фильтрацию текстур mipmap. Включение фильтрации текстур mipmap демонстрируется в следующем примере кода.


```
m_pD3DDevice->SetTexture(0, pMipMap);
m_pD3DDevice->SetSamplerState(0, D3DSAMP_MIPFILTER, D3DTEXF_POINT);
```



Приложение также может вручную пройти по цепочке поверхностей mipmap с помощью метода [**IDirect3DTexture9:: жетсурфацелевел**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dtexture9-getsurfacelevel) и указать уровень mipmap для получения. В следующем примере передается цепочка mipmap от высшего до самого низкого разрешения.


```
IDirect3DSurface9 * pSurfaceLevel;
for (int iLevel = 0; iLevel < pMipMap->GetLevelCount(); iLevel++)
{
    pMipMap->GetSurfaceLevel(iLevel, &pSurfaceLevel);
    // Process this level
    pSurfaceLevel->Release();
}
```



Приложения должны вручную перемещаться по цепочке mipmap для загрузки данных точечного рисунка в каждую поверхность цепочки. Как правило, это единственная причина для обхода цепи. Приложение может извлекать количество уровней в mipmap путем вызова [**IDirect3DBaseTexture9:: жетлевелкаунт**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3dbasetexture9-getlevelcount).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Фильтрация текстур](texture-filtering.md)
</dt> </dl>

 

 
