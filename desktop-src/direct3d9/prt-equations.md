---
description: Чтобы полностью понять шейдер, который реализует PRT, полезно получить формулу, используемую шейдером для вычисления выходного радианце.
ms.assetid: 66876e9e-cde1-4d04-9b31-30be1c115e6b
title: Уравнения PRT (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a65559fada82fda7f7eed1c7d05543883a06a19e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104140198"
---
# <a name="prt-equations-direct3d-9"></a>Уравнения PRT (Direct3D 9)

Чтобы полностью понять шейдер, который реализует PRT, полезно получить формулу, используемую шейдером для вычисления выходного радианце.

Чтобы начать работу, следующее уравнение является общим уравнением для вычисления выходного радианце, полученного в результате прямого освещения на рассеянном объекте с произвольным удаленным освещением.

![уравнение радианце выхода, полученное в результате прямого освещения на рассеянном объекте с произвольным удаленным освещением](images/prt-theory-eq1.png)

где:



| Параметр     | Описание                                                                                             |
|---------------|---------------------------------------------------------------------------------------------------------|
| RP            | Радианце выхода в вершине p. Вычисляется на каждой вершине сетки.                                   |
| p<sub>d</sub> | Албедо поверхности.                                                                              |
| pi            | Константа, используемая в качестве коэффициента нормализации энергии.                                        |
| L (s)          | Среда освещения (источник радианце).                                                             |
| Вице — президент ₍ s ₎         | Двоичная функция видимости для точки p. Значение равно 1, если точка может видеть освещение, 0 в противном случае.             |
| ₎ ХНП ₍ s        | Косинус из закона Ламберта. Равно Max ((NP · s), 0), где NP — это нормальная поверхность в точке p. |
| s             | Переменная, которая интегрируется над сферой.                                                           |



 

Использование сферовых функций, таких как сферические гармонические колебания, в следующем уравнении приблизительно соответствует среде освещения.

![уравнение среды освещения](images/prt-theory-eq2.png)

где:



| Параметр        | Описание                                              |
|------------------|----------------------------------------------------------|
| L (s)             | Среда освещения (источник радианце).              |
| i                | Целое число, которое суммирует за число базисных функций. |
| O                | Порядок сферических гармоний.                        |
| l<sub>i</sub>    | Коэффициент.                                           |
| Y<sub>i (s)</sub> | Некоторой базовой функции над сферой.                     |



 

Коллекция этих коэффициентов, L, обеспечивает оптимальное приближение для функции L с использованием базисных функций Y (s). Подстановка и распространение дает следующее уравнение.

![Формула выхода радианце после подстановки l (s) и распространение](images/prt-theory-eq3.png)

Неотъемлемой частью<sub>i (s)</sub>вице-президента ₍ s ₎ ХНП ₍ s ₎ является коэффициент пересылки t<sub>Pi</sub> , который в симуляторе выполняет предварительное вычисление для каждой вершины в сети. При замене это дает следующее уравнение.

![уравнение радианце выхода после подстановки коэффициента пересылки](images/prt-theory-eq4.png)

При изменении этого значения на векторную нотацию выводится следующее несжатое уравнение для вычисления выходного радианце для каждого канала.

![уравнение радианце выхода после перехода на векторную нотацию](images/prt-theory-eq5.png)

где:



| Параметр     | Описание                                                                                                                                                                         |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| RP            | Радианце выхода в вершине p.                                                                                                                                                      |
| p<sub>d</sub> | Албедо поверхности.                                                                                                                                                          |
| Н            | Вектор l<sub>i</sub>и является проекцией исходного радианце в сферические функции-основания. Это порядок следования в виде вектора сферического гармонического коэффициента. |
| Пи            | Вектор перемещения Order ² для вершины p. Симулятор делит коэффициенты перемещения на p.                                                                                       |



 

Оба этих вектора являются вектором порядка следования для сферических гармонических коэффициентов, поэтому обратите внимание, что это просто элементный продукт. В зависимости от порядка, точка может быть дорогостоящей, поэтому можно использовать сжатие. Алгоритм, именуемый анализом кластеризованных основных компонентов (КПКА), эффективно сжимает данные. Это позволяет использовать грубые гармонические колебания более высокого порядка, что приводит к темным теням.

КПКА предоставляет следующее уравнение для приближения к вектору перемещения.

![уравнение приближенного вектора перемещения](images/prt-theory-eq6.png)

где:



| Параметр      | Описание                                          |
|----------------|------------------------------------------------------|
| Пи             | Вектор перемещения для вершины p.                    |
| MK             | Среднее для Cluster k.                              |
| j              | Целое число, которое суммирует по количеству векторов PCA. |
| Нет              | Число векторов PCA.                           |
| w<sub>PJ</sub> | Вес ЖС PCA для точки p.                      |
| Б<sub>KJ</sub> | Вектор ЖС PCA для кластера k.              |



 

Кластер — это просто некоторое количество вершин, имеющих одинаковый вектор. О том, как получить среднее значение кластера, весовые коэффициенты PCA, векторы PCA и идентификаторы кластеров для вершин обсуждаются ниже.

При замене этих двух формул выдается следующее:

![уравнение радианцеа выхода после подстановки вектора перемещения](images/prt-theory-eq7.png)

Затем при распространении произведения точки выдается следующее уравнение.

![Формула выхода радианце после распространения произведения точки](images/prt-theory-eq8.png)

Так как оба (MK · L ') и (B<sub>KJ</sub>· L ') — константа на вершину, пример вычисляет эти значения с помощью ЦП и передает их в виде констант в шейдер вершин. так как w<sub>PJ</sub> изменяется для каждой вершины, в этом примере данные для каждой вершины сохраняются в буфере вершин.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Предварительно вычисленный перенос Радианце](precomputed-radiance-transfer.md)
</dt> </dl>

 

 



