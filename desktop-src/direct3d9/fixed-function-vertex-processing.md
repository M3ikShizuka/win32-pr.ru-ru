---
description: В конвейере вершины фиксированной функции обработка вершин в буфере вершин применяет текущие матрицы преобразования для устройства.
ms.assetid: a882a5c5-b05e-4659-9040-92d3e2ccd89c
title: Обработка вершин фиксированной функции (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 827a293a4fbd552327d93076de773aec90dbd895faf3c086f4794036978984fe
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118988024"
---
# <a name="fixed-function-vertex-processing-direct3d-9"></a>Обработка вершин фиксированной функции (Direct3D 9)

В конвейере вершины фиксированной функции обработка вершин в буфере вершин применяет текущие матрицы преобразования для устройства. Также можно применять операции вершин, такие как освещение, создание флагов клипов и обновление экстентов. При использовании обработки вершин фиксированной функции изменение элементов в целевом буфере вершин управляется флагом [ \_ доноткопидата D3DPV](other-direct3d-constants.md) . Этот флаг применяется только к фиксированной обработке вершин для функции. Интерфейс [**IDirect3DDevice9**](/windows/desktop/api) предоставляет метод [**IDirect3DDevice9::P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices) для обработки вершин. Вы обрабатываете вершины из шейдера вершин в набор потоков входных данных, создавая один поток данных вершин с чередованием в целевой буфер вершин, вызывая метод **IDirect3DDevice9::P роцессвертицес** . Метод принимает пять параметров, описывающих расположение и количество вершин, для которых предназначен метод, целевой буфер вершин и параметры обработки. После вызова конечный буфер содержит обработанные данные вершин.

Первый, второй и третий параметры, Сркстартиндекс, Дестиндекс и Вертекскаунт, отражающие индекс первой загружаемой вершины, индекс в целевом буфере, куда будут помещены вершины, и общее количество вершин для обработки и размещения в целевом буфере соответственно. Четвертый параметр, Пдестбуффер должен быть установлен в адрес интерфейса [**IDirect3DVertexBuffer9**](/windows/win32/api/d3d9helper/nn-d3d9helper-idirect3dvertexbuffer9) объекта буфера вершин, который будет получать исходные вершины. Параметр Сркстартиндекс указывает индекс, по которому метод должен начать обработку вершин.

Последний параметр, flags, определяет специальные параметры обработки для метода. Для этого параметра можно задать значение 0 для обработки вершин по умолчанию или [D3DPV \_ доноткопидата](other-direct3d-constants.md) для оптимизации обработки в некоторых ситуациях. Можно также объединить \_ значение D3DPV доноткопидата с одним или несколькими значениями [D3DLOCK](d3dlock.md) , подходящими для целевого буфера. При установке флагов равным 0 компоненты вершин в формате вершин целевого буфера вершин, которые не затрагиваются операцией вершины, по-прежнему копируются из шейдера вершин или устанавливаются в значение 0. Однако при использовании D3DPV \_ Доноткопидата [**IDirect3DDevice9::P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices) не перезаписывает сведения о цвете и координатах текстуры в буфер назначения, если эти данные не создаются Direct3D. Рассеянный цвет создается при включении освещения, т. е. D3DRS \_ освещение имеет значение **true**. Отражающий цвет создается при включении освещения и включении отражения, т \_ . е. D3DRS спекуларенабле и D3DRSное \_ освещение имеют значение **true**. При включенном тумане также создается отраженный цвет. Координаты текстуры создаются при включении преобразования текстуры или формирования текстуры. **IDirect3DDevice9::P роцессвертицес** использует текущие состояния рендеринга для определения того, какая обработка вершин должна быть выполнена.

## <a name="fvf-usage-settings-for-destination-vertex-buffers"></a>Параметры использования фвф для конечных буферов вершин

Для метода [**IDirect3DDevice9::P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices) требуются определенные параметры [D3DFVF](d3dfvf.md) целевого буфера вершин. Параметры использования ФВФ должны быть совместимы с текущими параметрами для обработки вершин.

Для обработки фиксированной вершины функции [**IDirect3DDevice9: для:P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices) требуются следующие параметры фвф:

-   Тип расположения всегда [D3DFVF \_ ксизрхв](d3dfvf.md) , поэтому D3DFVF \_ XYZ и D3DFVF \_ XYZB1 до D3DFVF \_ XYZB5 являются недопустимыми.
-   Не следует задавать флаги [D3DFVF \_ Обычная](d3dfvf.md), D3DFVF \_ RESERVED0 и D3DFVF \_ RESERVED2.
-   Флаг [ \_ диффузии D3DFVF](d3dfvf.md) должен быть установлен, если операция или следующих условий возвращает значение true:
    -   Освещение включено; то есть, D3DRS \_ освещение имеет **значение true**.
    -   Освещение отключено, рассеянный цвет имеется во входных потоках вершин, а [D3DPV \_ доноткопидата](other-direct3d-constants.md) не задан.
-   Флаг [ \_ отражения D3DFVF](d3dfvf.md) должен быть установлен, если операция или следующих условий возвращает значение true:
    -   Освещение включено, а отраженный цвет включен. то есть D3DRS \_ спекуларенабле имеет **значение true**.
    -   Освещение отключено, отражающий цвет имеется во входных потоках вершин, а [D3DPV \_ доноткопидата](other-direct3d-constants.md) не задан.
    -   Вершинный туман включен; то есть D3DRS \_ фогвертексмоде не имеет значение D3DFOG \_ None.

Кроме того, значение счетчика координат текстуры должно быть задано следующим образом:

-   Если преобразование текстур и формирование текстур отключены для всех активных стадий текстуры, а [D3DPV \_ доноткопидата](other-direct3d-constants.md) не задан, то число и тип координат текстуры вывода должны совпадать с координатами входной текстуры вершины. Если \_ задан параметр D3DPV доноткопидата и преобразование текстур и формирование текстуры отключены, то координаты выходных текстур не учитываются.
-   Если преобразование текстуры или формирование текстуры включено для всех активных стадий текстуры, то может потребоваться, чтобы вершина вывода содержала больше наборов координат текстуры, чем у входной вершины. Это обусловлено увеличением координат текстуры из тех, которые создаются при формировании текстуры или производятся преобразованиями текстур. Обратите внимание, что аналогичное увеличение координат текстуры происходит во время [**IDirect3DDevice9::D равпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitive) вызовы, но не является видимым для программиста приложения. В этом случае Direct3D создает новый набор координат текстуры. Новый набор координат текстуры формируется путем пошагового выполнения этапов текстуры и анализа параметров создания текстуры, преобразования текстур и индекса координат текстуры, чтобы определить, требуется ли для этого этапа уникальный набор координат текстуры. Каждый раз, когда требуется новый набор, он выделяется в порядке возрастания. Обратите внимание, что максимальное и обычное требование — один набор на стадию, хотя это может быть менее из-за совместного использования непреобразованных координат текстуры через D3DTSS \_ текскурдиндекс.

Таким образом, для каждой стадии текстуры создается новый набор координат текстуры, если текстура привязана к этому этапу и выполняется любое из следующих условий.

-   Формирование текстур включено для этого этапа.
-   Преобразование текстур включено для этого этапа.
-   В первый раз ссылки на непреобразованные координаты текстуры указываются через D3DTSS \_ текскурдиндекс.

Когда Direct3D создает координаты текстуры, приложение должно выполнять следующие действия:

1.  Используйте целевой буфер вершин с соответствующим использованием ФВФ.
2.  Перепрограммирование D3DTSS \_ текскурдиндекс этапа текстуры в соответствии с размещением обработанных координат текстуры. Обратите внимание, что перепрограммирование \_ параметра D3DTSS текскурдиндекс происходит, когда обработанный буфер вершин используется в последующих [**IDirect3DDevice9::D Равпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawprimitive) и [**IDirect3DDevice9::D равиндекседпримитиве**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-drawindexedprimitive) вызовы.

Наконец, размерность координат текстуры ([D3DFVF \_ TEX0](d3dfvf.md) через D3DFVF \_ TEX8) должна быть задана следующим образом:

-   Для каждого набора координат текстуры, если преобразование текстуры и формирование текстуры отключены, размерность координаты текстуры вывода должна соответствовать входным данным. Если преобразование текстуры включено, размер выходных данных должен совпадать с числом, определенным в \_ параметрах D3DTTFF COUNT1, D3DTTFF \_ COUNT2, D3DTTFF \_ COUNT3 или D3DTTFF \_ COUNT4. Если преобразование текстур отключено и включено формирование текстур, то размер выходных данных должен соответствовать параметрам режима формирования текстуры. Сейчас все режимы формируют три значения с плавающей запятой.

Когда [**IDirect3DDevice9::P роцессвертицес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-processvertices) завершается сбоем из-за несовместимого кода целевого буфера вершин, ожидаемый код будет напечатан в выходных данных отладки (только для отладочных сборок).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Буферы вершин](vertex-buffers.md)
</dt> </dl>

 

 
