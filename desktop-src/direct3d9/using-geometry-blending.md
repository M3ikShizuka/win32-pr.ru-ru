---
description: Следующая определяемая пользователем структура может использоваться для вершин, которые будут смешиваться между двумя матрицами.
ms.assetid: 6bcabcf9-d14e-446a-8dd2-e741211cc704
title: Использование смешения геометрии (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fc12c4d7d83ce4c01c76bd338a07f8e0aac7c003
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105701101"
---
# <a name="using-geometry-blending-direct3d-9"></a>Использование смешения геометрии (Direct3D 9)

Следующая определяемая пользователем структура может использоваться для вершин, которые будут смешиваться между двумя матрицами.


```
// The flexible vertex format (FVF) descriptor for this vertex would be:
//   FVF = D3DFVF_XYZB1 | D3DFVF_NORMAL | D3DFVF_TEX1; 

struct D3DBLENDVERTEX {
    D3DVECTOR v;
    FLOAT     blend; 
    D3DVECTOR n;
    FLOAT     tu, tv;
};
```



Вес смешения должен располагаться после расположения и РХВ данных в ФВФ и до нормали вершины.

Обратите внимание, что предыдущий формат вершины содержит только одно значение веса смешения. Это связано с тем, что существует две мировые матрицы, определенные в состояниях преобразования [**D3DTS \_ ворлдматрикс**](d3dts-worldmatrix.md)(0) и **D3DTS \_ ворлдматрикс**(1). Система смешивает каждую вершину между этими двумя матрицами, используя значение одного веса. Для трех матриц требуются только два веса и т. д.

> [!Note]
>
> Определить весовые коэффициенты обложки несложно. Использование линейной функции расстояния между соединениями является хорошим началом, но более гладкая сигмоидальной функция выглядит лучше. Выбор функции распределения с учетом ширины обложки может привести к резкому креасесу в соединениях при необходимости, используя большой вариации в качестве веса на коротком расстоянии.

 

## <a name="setting-blending-matrices"></a>Настройка матриц смешения

Матрицы преобразования, между которыми накладываются системы, задаются путем вызова метода [**IDirect3DDevice9:: сеттрансформ**](/windows/desktop/api) . Присвойте первому параметру значение, определенное в макросе [**D3DTS \_ ворлдматрикс**](d3dts-worldmatrix.md) , и задайте для второго параметра адрес матрицы, которую необходимо задать.

Следующий пример кода C++ задает две мировые матрицы, между которыми смешивается, чтобы создать иллюзию совместной ARM.


```
// For this example, the d3dDevice variable is assumed to be a valid pointer
//   to an IDirect3DDevice9 interface for an initialized 3D scene.

float     BendAngle = 3.1415926f / 4.0f; // 45 degrees
D3DMATRIX matUpperArm, matLowerArm;

// The upper arm is immobile. Use the identity matrix.
D3DXMatrixIdentity( matUpperArm );
d3dDevice->SetTransform( D3DTS_WORLDMATRIX(0), &matUpperArm );

// The lower arm rotates about the x-axis, attached to the upper arm.
D3DXMatrixRotationX( matLowerArm, -BendAngle ); 
d3dDevice->SetTransform( D3DTS_WORLDMATRIX(1), &matLowerArm );
```



Настройка матрицы смешения лишь приводит к тому, что система кэширует матрицу для последующего использования. Он не указывает системе начать смешивание вершин.

## <a name="enabling-geometry-blending"></a>Включение смешения геометрии

По умолчанию отключено смешение геометрических объектов. Чтобы включить смешение геометрических объектов, вызовите метод [**IDirect3DDevice9:: сетрендерстате**](/windows/desktop/api) , чтобы установить в качестве \_ состояния отображения D3DRS вертексбленд значение из перечисляемого типа [**D3DVERTEXBLENDFLAGS**](./d3dvertexblendflags.md) . В следующем примере кода показано, как может выглядеть этот вызов при задании состояния отрисовки для смешения между двумя мировыми матрицами.


```
d3dDevice->SetRenderState( D3DRS_VERTEXBLEND, D3DVBF_1WEIGHTS );
```



Если для параметра D3DRS \_ вертексбленд задано любое значение, отличное от D3DVBF \_ Disable, система предполагает, что в формат вершины будет включено соответствующее количество весовых коэффициентов смешения. Вы обязаны предоставить совместимый формат вершин и предоставить правильное описание этого формата для методов рендеринга Direct3D.

Если этот параметр включен, система выполняет смешение геометрии для всех объектов, отображаемых методами подготовки Дравпримитиве.

## <a name="see-also"></a>См. также:

[Фиксированные коды ФВФ функций (Direct3D 9)](fixed-function-fvf-codes.md)


## <a name="related-topics"></a>См. также

<dl> <dt>

[Смешение геометрических объектов](geometry-blending.md)
</dt> </dl>

 

 
