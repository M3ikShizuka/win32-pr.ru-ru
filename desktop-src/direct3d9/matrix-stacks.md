---
description: Библиотека служебной программы D3DX предоставляет интерфейс ID3DXMATRIXStack.
ms.assetid: e3cfb29e-4ef6-4b48-ad6b-f0371f526507
title: Стеки матриц (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a480236bc42142b725e232a9fb92807be73fb03097104a0cc4fc08643f4361af
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119044341"
---
# <a name="matrix-stacks-direct3d-9"></a>Стеки матриц (Direct3D 9)

Библиотека служебной программы D3DX предоставляет интерфейс [**ID3DXMATRIXStack**](id3dxmatrixstack.md) . Он предоставляет механизм для включения и выталкивания матрицы в стеке матрицы. Реализация стека матрицы — это эффективный способ для трассировки матриц во время прохода по иерархии преобразований.

Библиотека служебной программы D3DX использует стек матриц для хранения преобразований в виде матриц. Различные методы интерфейса [**ID3DXMATRIXStack**](id3dxmatrixstack.md) связаны с текущей матрицей или с матрицей, расположенной поверх стека. Вы можете очистить текущую матрицу с помощью метода [**ID3DXMATRIXStack:: лоадидентити**](id3dxmatrixstack--loadidentity.md) . Чтобы явно указать определенную матрицу для загрузки в качестве текущей матрицы преобразования, используйте метод [**ID3DXMATRIXStack:: лоадматрикс**](id3dxmatrixstack--loadmatrix.md) . Затем можно вызвать метод [**ID3DXMATRIXStack:: мултматрикс**](id3dxmatrixstack--multmatrix.md) или метод [**ID3DXMATRIXStack:: мултматрикслокал**](id3dxmatrixstack--multmatrixlocal.md) для умножения текущей матрицы на указанную матрицу.

Метод [**ID3DXMATRIXStack::P Op**](id3dxmatrixstack--pop.md) позволяет вернуться к предыдущей матрице преобразования, а метод [**ID3DXMATRIXStack::P тельную**](id3dxmatrixstack--push.md) добавляет матрицу преобразования в стек.

Отдельные матрицы в стеке матрицы представлены как однородные матрицы 4x4, определяемые структурой [**D3DXMATRIX**](d3dxmatrix.md) библиотеки служебной программы D3DX.

Библиотека служебной программы D3DX предоставляет стек матрицы через объект модели COM.

## <a name="implementing-a-scene-hierarchy"></a>Реализация иерархии сцены

Стек матриц упрощает создание иерархических моделей, в которых сложные объекты формируются из ряда более простых объектов.

Сцена (или преобразование) обычно представляется древовидной структурой данных. Каждый узел в древовидной структуре данных содержит матрицу. Конкретная матрица представляет изменение в системах координат из родительского узла узлов узла. Например, при моделировании человека вы можете реализовать иерархию, показанную на следующей схеме.

![схема иерархии человеческих рычагов](images/stack1.png)

В этой иерархии текстовая матрица помещает текст в мир. Матрица Упперарм содержит поворот наплеча, матрица Ловерарм содержит поворот уступа, а матрица «рука» содержит поворот ладони. Чтобы определить, где находится рука относительно мира, можно умножить все матрицы от тела вниз до руки.

Предыдущая иерархия имеет более простую упрощенную структуру, поскольку каждый узел имеет только один дочерний элемент. Если вы начинаете моделировать руку более подробно, вам, вероятно, придется добавить пальцы и бегунок. Каждая цифра может быть добавлена в иерархию как дочерние элементы руки, как показано на следующей схеме.

![схема иерархии человеческого руки](images/stack2.png)

Если вы просматриваете весь граф ARM в порядке возрастания по глубине — обход по одному пути до перехода к следующему пути — для рисования сцены, вы выполняете последовательность сегментированной отрисовки. Например, чтобы визуализировать руки и пальцы, необходимо реализовать следующий шаблон.

1.  Отправьте матрицу руки в стек матриц.
2.  Нарисуйте руку.
3.  Передача матрицы Thumb в стек матриц.
4.  Нарисуйте бегунок.
5.  Откройте матрицу Thumb из стека.
6.  Перетащите матрицу Finger 1 в стек матриц.
7.  Нарисуйте первый палец.
8.  Откройте матрицу с пальцем 1 из стека.
9.  Помещает матрицу Finger 2 в стек матриц. Вы продолжите таким образом, пока не будут отображены все пальцы и бегунок.

После завершения подготовки к просмотру пальцев можно будет отключать матрицу «рука» из стека.

Этот базовый процесс можно выполнить в коде с помощью следующих примеров. Когда вы сталкиваетесь с узлом во время поиска в структуре дерева данных по глубину, помещаете матрицу на вершину стека матриц.


```
MatrixStack->Push();

MatrixStack->MultMatrix(pNode->matrix);
```



Завершив работу с узлом, разверните матрицу, расположенную на вершине стека матриц.


```
MatrixStack->Pop();
```



Таким образом, матрица в верхней части стека всегда представляет мировое преобразование текущего узла. Поэтому перед рисованием каждого узла необходимо задать матрицу Direct3D.


```
pD3DDevice->SetTransform(D3DTS_WORLDMATRIX(0), *MatrixStack->GetTop());
```



Дополнительные сведения о конкретных методах, которые можно выполнить в стеке матрицы D3DX, см. в разделе Справочник по [**ID3DXMATRIXStack**](id3dxmatrixstack.md) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Конвейер вершин](vertex-pipeline.md)
</dt> </dl>

 

 



