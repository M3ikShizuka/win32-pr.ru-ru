---
description: В Microsoft Direct3D 9 были изменены следующие функции. Если вы используете эти функции, см. Приведенные ниже изменения, которые помогут перенести приложение на Direct3D 9.
ms.assetid: 6f5b2cc1-5415-4af8-a964-051a5af42680
title: Преобразование в Direct3D 9
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: becdb878ad462bfc0157fb15b3c9c1ef2ba158dd
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105710767"
---
# <a name="converting-to-direct3d-9"></a>Преобразование в Direct3D 9

В Microsoft Direct3D 9 были изменены следующие функции. Если вы используете эти функции, см. Приведенные ниже изменения, которые помогут перенести приложение на Direct3D 9.

-   [Басевертексиндекс изменения](#basevertexindex-changes)
-   [Креатеимажесурфаце изменения](#createimagesurface-changes)
-   [D3DENUM \_ без \_ \_ изменений уровня WHQL](/windows)
-   [Создание изменений ресурсов](#create-resource-changes)
-   [Енумадаптермодес изменения](#enumadaptermodes-changes)
-   [Изменения Get и Сетстреамсаурце \_](#getsetstreamsource-changes)
-   [Изменение качества с множественной выборкой](#multisampling-quality-changes)
-   [Ресаурцеманажердискардбитес изменения](#resourcemanagerdiscardbytes-changes)
-   [Сетсофтваревертекспроцессинг изменения](#setsoftwarevertexprocessing-changes)
-   [Изменения в образце текстур](#texture-sampler-changes)
-   [Изменения в объявлении вершин](#vertex-declaration-changes)
-   [Интервалы \_ и \_ SwapEffects \_ изменения](#intervals-and-swapeffects-changes)

## <a name="basevertexindex-changes"></a>Басевертексиндекс изменения

В DirectX 8. x IDirect3DDevice8:: Сетиндицес требуется указатель на буфер индекса и Басевертексиндекс для начальной позиции в буфере вершин. Приложение, пакетное выполнение различных объектов в буфере вершин, пришлось переключить буфер индексов (или выполнить вызов IDirect3DDevice8:: Сетиндицес) перед вызовом IDirect3DDevice8::D Равиндекседпримитиве.

В Direct3D 9 начальная позицией в буфере вершин, *басевертексиндекс*, была перемещена в IDirect3DDevice9::D равиндекседпримитиве, а ее тип данных изменился с DWORD на int.


```
HRESULT IDirect3DDevice9::DrawIndexedPrimitive( 
    D3DPRIMITIVETYPE PrimType, 
    INT BaseVertexIndex, 
    UINT minIndex, 
    UINT NumVertices, 
    UINT startIndex, 
    UINT primCount); 

HRESULT SetIndices(IDirect3DIndexBuffer9* pIndexData); 
```



## <a name="createimagesurface-changes"></a>Креатеимажесурфаце изменения

IDirect3DDevice8:: Креатеимажесурфаце был переименован в [**креатеоффскринплаинсурфаце**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createoffscreenplainsurface). Добавлен дополнительный параметр, принимающий тип D3DPOOL. D3DPOOL \_ будет возвращать поверхность с одинаковыми характеристиками на поверхность, созданную IDirect3DDevice8:: креатеимажесурфаце. D3DPOOL \_ по умолчанию — соответствующий пул для использования с [**Стретчрект**](/windows/desktop/api) и [**колорфилл**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-colorfill).

## <a name="d3denum_no_whql_level-changes"></a>D3DENUM \_ без \_ \_ изменений уровня WHQL

Теперь приложениям необходимо явно запрашивать лаборатории WHQL, так как ответ принимается относительно долго (несколько секунд). D3DENUM \_ \_ . уровень лаборатории не был \_ удален, и \_ был \_ добавлен D3DENUM уровень WHQL.

## <a name="create-resource-changes"></a>Создание изменений ресурсов

К нескольким методам был добавлен маркер, и для него должно быть задано **значение NULL**. К этим методам относятся следующие.

-   [**креатетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture)
-   [**креатеволуметекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createvolumetexture)
-   [**креатекубетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createcubetexture)
-   [**креатевертексбуффер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createvertexbuffer)
-   [**креатеиндексбуффер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createindexbuffer)
-   [**креатерендертаржет**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createrendertarget)
-   [**креатедепсстенЦилсурфаце**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createdepthstencilsurface)
-   [**креатеоффскринплаинсурфаце**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createoffscreenplainsurface)

## <a name="enumadaptermodes-changes"></a>Енумадаптермодес изменения

Теперь [**енумадаптермодес**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-enumadaptermodes) принимает D3DFORMAT.


```
HRESULT IDirect3D9::EnumAdapterModes( 
       UINT Adapter, 
       D3DFORMAT Format, 
       UINT Mode, 
       D3DDISPLAYMODE *pMode); 
```



Формат поддерживает расширяемый набор режимов экрана. Чтобы защитить приложения от перечислений форматов, которые не были выпущены при отгрузке приложения, приложение должно сообщить Direct3D формат для режимов экрана, которые необходимо перечислить. Результирующий массив режимов вывода будет отличаться только шириной, высотой и частотой обновления.

Приложение указывает формат пикселей, а перечисление ограничено теми режимами экрана, которые точно соответствуют формату. Ниже приведен список разрешенных форматов.

-   D3DFMT \_ A1R5G5B5
-   D3DFMT \_ A2B10G10R10
-   D3DFMT \_ A8R8G8B8
-   D3DFMT \_ R5G6B5
-   D3DFMT \_ X1R5G5B5
-   D3DFMT \_ X8R8G8B8

Перечисление эквивалентно для альфа-и неальфа-версий того же формата. Возвращаемый формат всегда будет иметь тот же формат, что и приложение.

Этот метод обрабатывает 565 и 555 как эквивалентный и возвращает правильную версию в формате. Разница вступает в игру только в том случае, если приложение блокирует задний буфер, и существует явный флаг, который приложение должно установить для выполнения этой задачи.

## <a name="getsetstreamsource-changes"></a>Изменения Get и Сетстреамсаурце

К методам [**жетстреамсаурце**](/windows/desktop/api) и [**сетстреамсаурце**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setstreamsource) был добавлен один параметр. Смещение — это число байтов между началом потока и началом данных вершин. Измеряется в байтах. Это позволяет конвейеру поддерживать смещения потоков. Чтобы узнать, поддерживает ли устройство смещения потоков, см. раздел D3DDEVCAPS2 \_ стреамоффсет.


```
HRESULT GetStreamSource(
    UINT StreamNumber,
    IDirect3DVertexBuffer9 **ppStreamData,
    UINT *pOffsetInBytes,
    UINT *pStride);
```



## <a name="multisampling-quality-changes"></a>Изменение качества с множественной выборкой

Ранее было \_ Перечисление типов D3DMULTISAMPLE. Direct3D 9 удерживает это перечисление и добавляет идею уровня качества для каждого элемента перечисления. Уровень качества указывает на компромисс между качеством и производительностью, указывая число образцов с маской (в смысле D3DRS \_ мултисамплемаск).

Приложение должно выбрать, сколько примеров для маскирования требуется, а затем обратиться к Пкуалитилевелс. Если не равно нулю, это значение указывает количество уровней качества, которое приложение может передать различным функциям создания через Мултисамплекуалити. Поскольку драйверы предоставляют все свои Многовыборочные схемы как уровни качества в D3DMULTISAMPLE \_ без маскировки, можно перечислить все доступные Многовыборочные схемы с помощью этого типа, если приложению не нужно маскировать образцы.

Бит D3DPRASTERCAPS \_ стретчблтмултисампле Caps снят с учета. Этот бит используется для обозначения того, что метод многовыборки не поддерживал маски записи и не может быть включен и отключен между [**бегинсцене**](/windows/desktop/api) и [**ендсцене**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-endscene). Такие немаскированные методы теперь доступны через D3DMULTISAMPLE без \_ маскировки.


```
HRESULT CheckDeviceMultiSampleType( 
       UINT Adapter, 
       D3DDEVTYPE DeviceType, 
       D3DFORMAT SurfaceFormat, 
       BOOL Windowed, 
       D3DMULTISAMPLE_TYPE MultiSampleType, 
       DWORD * pQualityLevels); 
```



Для каждого числа образцов с маской существует другое значение. Например, примеры D3DMULTISAMPLE \_ 4 \_ могут иметь три уровня качества, тогда как у D3DMULTISAMPLE \_ 2 \_ образцов может быть только один. Существует не более восьми уровней качества для каждого числа образцов с маской (драйвер не может выразить больше). Диапазон качества — от нуля до ( \* пкуалитилевелс-1).

## <a name="resourcemanagerdiscardbytes-changes"></a>Ресаурцеманажердискардбитес изменения

Ресаурцеманажердискардбитес был заменен IDirect3DDevice9:: Евиктманажедресаурцес. Он может исключить все ресурсы, как Direct3D, так и драйверы.

Диспетчер ресурсов теперь обращается к, когда происходит сбой создания ресурса (управляемого или неуправляемого) из-за нехватки памяти видео. Руководителю будет автоматически предложено освободить достаточно ресурсов, чтобы процесс создания был выполнен. В DirectX 8,0 этот процесс не был автоматизирован.

## <a name="setsoftwarevertexprocessing-changes"></a>Сетсофтваревертекспроцессинг изменения

Приложение может создать устройство в смешанном режиме для использования обработки вершин программного обеспечения и оборудования.

Чтобы переключиться между двумя режимами обработки вершин в DirectX 8. x, вызовите IDirect3DDevice8:: Сетрендерстате. Это было заменено на [**сетсофтваревертекспроцессинг**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsoftwarevertexprocessing) для упрощения проблем, вызванных блоками состояния. Этот новый метод не записывается блоками состояния.

## <a name="texture-sampler-changes"></a>Изменения в образце текстур

Direct3D 9 поддерживает до 16 поверхностей текстуры за один проход, используя модель шейдера Pixel Shader 2 \_ 0, однако число координат текстуры остается ограниченным восемью. Состояние этапа текстуры связано с поверхностями, наборами координат, обработкой вершин и обработкой пикселей. Для управления этими различиями во время компиляции [**сеттекстурестажестате**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexturestagestate) разбивается на два метода:

-   IDirect3DDevice9:: Сеттекстурестажестате будет по-прежнему использоваться для состояния координат текстуры, например для режимов переноса и создания координат текстуры.
-   [**Сетсамплерстате**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setsamplerstate) был добавлен и теперь будет использоваться для фильтрации, мозаичного заполнения, фиксации, миплод и т. д. Это можно настроить до шестнадцати пробных выработок.

### <a name="settexturestagestate-changes"></a>Сеттекстурестажестате изменения

IDirect3DDevice9:: Сеттекстурестажестате теперь задает следующие состояния:

-   Состояние обработки фиксированной вершины функции. Это состояние управляет обработкой координат текстуры D3DTSS \_ текстуретрансформфлагс и D3DTSS \_ текскурдиндекс. Можно задать до восьми экземпляров (поскольку восемь координат текстуры всегда поддерживаются). D3DTSS \_ текскурдиндекс — это состояние обработки фиксированной вершины функции. Если используется программируемый шейдер вершин, это состояние игнорируется.
-   Фиксированное состояние шейдера пикселей функции (устаревший Текстурестажестате).

    -   D3DTSS \_ ALPHAARG0
    -   D3DTSS \_ ALPHAARG1
    -   D3DTSS \_ ALPHAARG2
    -   D3DTSS \_ алфаоп
    -   D3DTSS \_ бумпенвлоффсет
    -   D3DTSS \_ бумпенвлскале
    -   D3DTSS \_ BUMPENVMAT00
    -   D3DTSS \_ BUMPENVMAT01
    -   D3DTSS \_ BUMPENVMAT10
    -   D3DTSS \_ BUMPENVMAT11
    -   D3DTSS \_ COLORARG0
    -   D3DTSS \_ COLORARG1
    -   D3DTSS \_ COLORARG2
    -   D3DTSS \_ колороп
    -   D3DTSS \_ ресултарг

    Число состояний шейдера с фиксированной функцией, которые могут быть заданы, меньше или равно числу, представленному параметром Макстекстуреблендстажес.

Число доступных для приложения образцов текстуры определяется версией шейдера пикселей, как показано в следующей таблице.



| Имя                    | Число                                                         |
|-------------------------|----------------------------------------------------------------|
| PS \_ 1 \_ 1 – PS \_ 1 \_ 3    | 4 образцов текстуры                                             |
| PS \_ 1 \_ 4                | 6 образцов текстуры                                             |
| PS \_ 2 \_ 0                | 16 образцов текстуры                                            |
| фиксированный конвейер функций | Макстекстуреблендстажес/Макссимултанеаустекстуресные пробы |



 

Устройства, поддерживающие сопоставление смещений в Direct3D 9, будут поддерживать дополнительный образец (D3DDMAPSAMPLER), который показывает карты смещения в блоке тесселяции.

### <a name="setsamplerstate-changes"></a>Сетсамплерстате изменения

IDirect3DDevice9:: Сетсамплерстате задает состояние образца (включая ту, которая используется в блоке тесселяции для выборки карт смещения). Они были переименованы с \_ префиксом D3DSAMP, чтобы включить обнаружение ошибок во время компиляции при переносе из DirectX 8. x. Возможные состояния:

-   D3DSAMP \_ аддрессу
-   D3DSAMP \_ аддрессв
-   D3DSAMP \_ аддрессв
-   D3DSAMP \_ BORDERCOLOR
-   D3DSAMP \_ магфилтер
-   D3DSAMP \_ максанисотропи
-   D3DSAMP \_ максмиплевел
-   D3DSAMP \_ минфилтер
-   D3DSAMP \_ мипфилтер
-   D3DSAMP \_ мипмаплодбиас

## <a name="vertex-declaration-changes"></a>Изменения в объявлении вершин

Объявления вершин теперь отделены от создания шейдера вершин. Объявления вершин теперь используют интерфейс модели COM.

Для DirectX 8. x объявления вершин привязаны к шейдерам вершин.

-   Для конвейера фиксированной функции вызовите [**сетвертексшадер**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexshader) с помощью кода гибкого формата вершины (фвф) в буфере вершин.
-   Для шейдеров вершин вызовите IDirect3DDevice9:: Сетвертексшадер с маркером ранее созданного шейдера вершин. Шейдер включает объявление вершины.

Для Direct3D 9 объявления вершин отделены от шейдеров вершин и могут использоваться с фиксированным конвейером функций или с шейдерами.

-   Для конвейера фиксированной функции нет необходимости вызывать IDirect3DDevice9:: Сетвертексшадер. Однако если вы хотите переключиться на конвейер фиксированной функции и ранее использовала шейдер вершин, вызовите IDirect3DDevice9:: Сетвертексшадер (**null**). Когда это будет сделано, вам все равно потребуется вызвать [**сетфвф**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setfvf) для объявления кода фвф.
-   При использовании шейдеров вершин вызовите IDirect3DDevice9:: Сетвертексшадер с объектом шейдер вершин. Кроме того, вызовите метод IDirect3DDevice9:: Сетфвф, чтобы настроить объявление вершины. При этом используются сведения, неявные в ФВФ. [**Сетвертексдекларатион**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexdeclaration) может быть вызван вместо IDirect3DDevice9:: сетфвф, так как он поддерживает объявления вершин, которые не могут быть выражены с помощью фвф.

## <a name="intervals-and-swapeffects-changes"></a>Интервалы и SwapEffects изменения

Было внесено несколько изменений, чтобы предоставить пользователю больший контроль над частотой обновления монитора, частотой представления, а также фоновым буфером и рисованием заднего буфера. Вот они:

-   Удален один из эффектов переключения, D3DSWAPEFFECT \_ Copy \_ вертикальной синхронизации и один уровень представления, D3DPRESENTная \_ ставка \_ без ограничений.
-   Переименованные \_ Параметры D3DPRESENT. Полноэкранный \_ пресентатионинтервал до пресентатионинтервалс.
-   \_Немедленный добавлен интервал D3DPRESENT \_ , что означает, что презентация не синхронизирована с вертикальной синхронизацией. Как и в DirectX 8. x, D3DPRESENT \_ интервал \_ по умолчанию определяется как ноль и эквивалентен D3DPRESENT \_ Interval \_ 1. D3DPRESENT \_ Interval \_ по умолчанию — это удобство для инициализации \_ параметров D3DPRESENT равным нулю.

Подробное описание режимов и поддерживаемых интервалов см. в разделе D3DPRESENT.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Графика Direct3D 9](dx9-graphics.md)
</dt> </dl>

 

 
