---
description: Карты в кубических средах (иногда называемые картами кубов) — это текстуры, которые содержат графические данные, представляющие сцену вокруг объекта, как если бы объект находился в центре куба.
ms.assetid: 4879d59b-e6d3-4811-ab2c-bcce8f214e1c
title: Сопоставление кубических сред (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cecac83db067224195883485bcbd282aa82ae4b5
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423478"
---
# <a name="cubic-environment-mapping-direct3d-9"></a>Сопоставление кубических сред (Direct3D 9)

Карты в кубических средах (иногда называемые картами кубов) — это текстуры, которые содержат графические данные, представляющие сцену вокруг объекта, как если бы объект находился в центре куба. Каждая грань схемы кубической среды охватывает поле в виде поля с 90 по горизонтали и вертикали, а на карте Куба — шесть лиц. Ориентация сторон показана на следующем рисунке.

![Иллюстрация Куба с центральными осями координат, перпендикулярными граням Куба](images/cubemap-cube.png)

Каждое лицо Куба ориентировано перпендикулярно плоскости x/y, y/z или x/z в мировом пространстве. На следующем рисунке показано, как каждая плоскость соответствует грани.

![Иллюстрация граней Куба с координатами проекции с плоскостей](images/cube-faces.png)

Карты кубических сред реализуются как ряд объектов текстуры. Приложения могут использовать статические изображения для сопоставления в кубических средах или они могут быть отображены в лицах карты Куба для выполнения динамического сопоставления среды. Этот метод требует, чтобы поверхности схемы куба были допустимыми областями визуализации, созданными с \_ установленным флагом РЕНДЕРТАРЖЕТ D3DUSAGE.

Грани схемы куба не обязательно должны содержать чрезвычайно детализированные рендерингы окружающей сцены. В большинстве случаев карты среды применяются к изогнутым поверхности. Учитывая величину кривизны, используемую большинством приложений, полученное отраженное искажение дает очень подробную информацию в схеме среды, непроизводительна с точки зрения памяти и объема работ по подготовке к просмотру.

## <a name="mipmapped-cubic-environment-maps"></a>Карты мипмаппед кубической среды

Карты куба могут быть мипмаппед. Чтобы создать карту Куба мипмаппед, задайте для параметра Levels метода [**креатекубетекстуре**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createcubetexture) нужное количество уровней. Вы можете представить топографии этих поверхностей, как показано на следующей схеме.

![Схема схемы куба мипмаппед с n уровнями MIP](images/cubemap-mipped.png)

Приложения, создающие карты среды мипмаппед Безье, могут обращаться к каждому из них, вызывая метод [**жеткубемапсурфаце**](/windows/desktop/api) . Начните с установки соответствующего значения из перечислимого [**типа \_ D3DCUBEMAP**](./d3dcubemap-faces.md) , как описано в разделе [Создание поверхностей схемы кубической среды (Direct3D 9)](creating-cubic-environment-map-surfaces.md). Затем выберите уровень для получения, задав для параметра уровня **жеткубемапсурфаце** нужный уровень mipmap. Помните, что 0 соответствует изображению верхнего уровня.

## <a name="texture-coordinates-for-cubic-environment-maps"></a>Координаты текстуры для карт кубических сред

Координаты текстуры, которые индексируют карту кубической среды, не являются простыми координатами в стиле u и v, как это используется при применении стандартных текстур. Фактически, карты в кубических средах не используют координаты текстуры. Вместо набора координат текстуры для карт кубической среды требуется трехмерный вектор. Необходимо указать правильный формат вершины. Помимо указания системы на количество наборов координат текстуры, используемых приложением, необходимо предоставить сведения о количестве элементов в каждом наборе. Для этой цели Direct3D предлагает набор макросов [**D3DFVF \_ текскурдсизен**](d3dfvf-texcoordsizen.md) . Эти макросы принимают один параметр, определяя индекс набора координат текстуры, для которого описывается размер. В случае трехмерного вектора вы включаете битовый шаблон, созданный с помощью \_ макроса D3DFVF TEXCOORDSIZE3. В следующем примере кода показано, как используется этот макрос.


```
// Create a flexible vertex format descriptor for a vertex that contains
//   a position, normal, and one set of 3D texture coordinates.

DWORD dwFVF = D3DFVF_XYZ | D3DFVF_NORMAL | D3DFVF_TEX1 | D3DFVF_TEXCOORDSIZE3(0); 
```



В некоторых случаях, таких как рассеянное освещение, для вектора используется нормальная вершина камеры. В других случаях, например при сопоставлении с зеркальной средой, используется вектор отражения. Так как преобразованные нормали вершин широко понятны, информация здесь сосредоточена на вычислении вектора отражения.

Вычисление собственного вектора отражения требует понимания расположения каждой вершины и вектора от точки зрения к этой вершине. Direct3D может автоматически вычислять векторы отражения для своей геометрии. Использование этой функции экономит память, так как вам не нужно включать координаты текстуры для схемы среды. Это также сокращает пропускную способность и, в случае с устройством&L HAL, оно может быть значительно быстрее, чем вычисления, которые приложение может сделать самостоятельно. Чтобы использовать эту функцию, на стадии текстуры, содержащей карту кубической среды, задайте в качестве \_ состояния этапа текстуры D3DTSS текскурдиндекс сочетание \_ элемента D3DTSS тЦи Камераспацерефлектионвектор в \_ [**D3DTEXTURESTAGESTATETYPE**](./d3dtexturestagestatetype.md) и индекс набора координат текстуры. В некоторых ситуациях, например при сопоставлении рассеянного освещения, можно использовать D3DTSS \_ тЦи \_ Камераспаценормал в **D3DTEXTURESTAGESTATETYPE**, что приводит к тому, что система использует преобразованную, камеру-пространство, нормаль к вершине в качестве вектора адресации для текстуры. Индекс используется системой для определения режима обтекания текстуры.

В следующем примере кода показано, как используется это значение.


```
// The m_d3dDevice variable is a valid pointer
// to an IDirect3DDevice9 interface.

// Automatically generate texture coordinates for stage 2.
// This assumes that stage 2 is assigned a cube map.
// Use the wrap mode from the texture coordinate set at index 1.

m_d3dDevice->SetTextureStageState( 2, D3DTSS_TEXCOORDINDEX,
                                   D3DTSS_TCI_CAMERASPACEREFLECTIONVECTOR | 1); 
```



При включении автоматического создания координат текстуры система использует одну из двух формул для вычисления вектора отражения для каждой вершины. Если \_ для состояния отрисовки D3DRS локалвиевер задано **значение true**, используется следующая формула.

![Формула вектора отражения (r = 2 (EXN) n-e)](images/reflection-vector-local.png)

В предыдущей формуле R является вычисляемым вектором отражения, E — нормализованным вектором «позиционирование на глаз», а «N» — вершиной вершины на камере.

Если \_ для состояния отрисовки D3DRS локалвиевер задано **значение false**, система использует следующую формулу.

![Формула вектора отражения (r = 2nzn-i)](images/reflection-vector-nonlocal.png)

Элементы R и N в этой формуле идентичны предыдущей формуле. Элемент N<sub>z</sub> — это международный символ z вершины нормали, а I — вектор (0, 0, 1) неограниченной непрямой точки зрения. Система использует Вектор отражения из любой формулы для выбора и адресации соответствующей грани схемы куба.

> [!Note]  
> В большинстве случаев приложения должны включать автоматическую нормализацию нормалей вершин. Для этого задайте для параметра D3DRS \_ нормализенормалс значение **true**. Если не включить это состояние рендеринга, внешний вид схемы среды будет радикально отличаться от предполагаемого.

 

Дополнительные сведения содержатся в следующем разделе.

-   [Создание поверхностей карт кубической среды (Direct3D 9)](creating-cubic-environment-map-surfaces.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сопоставление окружения](environment-mapping.md)
</dt> </dl>

 

 
