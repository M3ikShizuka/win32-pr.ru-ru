---
description: Когда функция CreateFile открывает обработчик для ресурса последовательного подключения, система инициализирует и настраивает ресурс в соответствии со значениями, заданными при последнем открытии ресурса.
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: изменение Параметры ресурсов связи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127164355"
---
# <a name="modification-of-communications-resource-settings"></a>изменение Параметры ресурсов связи

Когда функция [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) открывает обработчик для ресурса последовательного подключения, система инициализирует и настраивает ресурс в соответствии со значениями, заданными при последнем открытии ресурса. Сохранение предыдущих параметров позволяет пользователю сохранить параметры, указанные с помощью команды **mode** , при повторном открытии устройства. Значения, унаследованные из предыдущей операции открытия, включают параметры конфигурации блока управления устройством (структура [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ) и значения времени ожидания, используемые в операциях ввода-вывода. Если устройство никогда не открывалось, для него задаются системные значения по умолчанию.

Чтобы определить начальную конфигурацию ресурса последовательного подключения, процесс вызывает функцию [**жеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , которая заполняет структуру последовательного порта [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) текущими параметрами конфигурации. Чтобы изменить эту конфигурацию, процесс задает структуру **DCB** в вызове функции [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) .

Элементы структуры [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) задают такие параметры конфигурации, как скорость передачи данных, число бит на байт и количество останавливаемых битов на байт. Другие элементы **DCB** задают специальные символы и обеспечивают проверку четности и управление потоком. Когда процессу необходимо изменить только некоторые из этих параметров конфигурации, сначала необходимо вызвать [**жеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , чтобы заполнить структуру **DCB** текущей конфигурацией. Затем процесс может скорректировать важные значения в структуре **DCB** и перенастроить устройство, вызвав [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) и указав измененную структуру **DCB** . Эта процедура гарантирует, что неизмененные элементы структуры **DCB** содержат соответствующие значения. Например, распространенной ошибкой является настройка устройства с структурой **DCB** , в которой элемент **ксончар** структуры равен элементу **ксоффчар** .

Функция [**буилдкоммдкб**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) предоставляет другой способ изменения структуры [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) . **Буилдкоммдкб** использует строку с той же формой, что и аргументы командной строки команды **mode** , для указания скорости передачи, схемы четности, количества останавливаемых бит и числа бит данных. Остальные элементы [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) не изменяются этой функцией, за исключением того, что для соответствующих членов задано отключение XON/XOFF и аппаратного управления потоком. **Буилдкоммдкб** изменяет только структуру **DCB** ; Он не перестраивает устройство.

Процесс может перенастроить ресурс связи с помощью функции [**жеткоммпропертиес**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) , чтобы получить сведения из драйвера устройства о параметрах конфигурации, которые он поддерживает. Процесс может использовать эти сведения, чтобы не указывать конфигурацию, которая не поддерживается.

Функция [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) перенастраивает ресурс связи, но не влияет на внутренние выходные данные и Входные буферы указанного драйвера. Буферы не записываются, а отложенные операции чтения и записи не прерываются преждевременно.

Процесс повторно инициализирует коммуникационный ресурс с помощью функции [**сетупкомм**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) , которая выполняет следующие задачи:

-   Прерывает ожидающие операции чтения и записи, даже если они не были завершены.
-   Отменяет непрочтенные символы и освобождает внутренние выходные и Входные буферы драйвера, связанного с указанным ресурсом.
-   Перераспределяет внутренние выходные и Входные буферы.

Процесс не требуется для вызова [**сетупкомм**](/windows/desktop/api/Winbase/nf-winbase-setupcomm). Если это не так, драйвер ресурса инициализирует устройство с параметрами по умолчанию при первом использовании обработчика ресурса связи.

 

 
