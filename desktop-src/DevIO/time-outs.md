---
description: В отношении ресурса связи имеется связанный набор параметров времени ожидания, влияющих на поведение операций чтения и записи.
ms.assetid: 271d4c68-1f6d-4483-a9a1-703220de761f
title: Время ожидания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db31fafc0f4d98832f1fb7fa5d22b32cba33d73
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807402"
---
# <a name="time-outs"></a>Время ожидания

В отношении ресурса связи имеется связанный набор параметров времени ожидания, влияющих на поведение операций чтения и записи. Время ожидания может привести к завершению операции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)или [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) по истечении интервала времени ожидания, даже если указанное число символов не было считано или записано. Она не считается ошибкой, когда время ожидания возникает во время операции чтения или записи (т. е. возвращаемое значение функции чтения или записи указывает на успешное выполнение). Число байтов, фактически считанных или записанных, передается функцией **ReadFile** или **WriteFile** (или с помощью функции [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) или [**филеиокомплетионраутине**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) , если операция ввода-вывода выполнялась в качестве перекрывающейся операции).

Когда приложение открывает ресурс связи, система устанавливает значения времени ожидания ресурса в значения, действующие при последнем использовании ресурса. Если ресурс связи никогда не открывался, система устанавливает для значений времени ожидания какое-либо значение по умолчанию. В любом случае приложение должно всегда определять текущие значения времени ожидания после открытия ресурса, а затем явно задавать их в соответствии с требованиями. Чтобы определить текущие значения времени ожидания для ресурса связи, используйте функцию [**жеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) . Чтобы изменить значения времени ожидания, используйте функцию [**сеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) .

Параметры времени ожидания включаются двумя типами времени ожидания. Время ожидания в интервале возникает, когда время между получением любого из двух символов превышает заданное число миллисекунд. Отсчет времени начинается при получении первого символа и перезапуска при получении каждого нового символа. Общее время ожидания происходит, когда общее количество времени, потребляемое операцией чтения, превышает вычисленное число миллисекунд. Время начинается сразу после начала операции ввода-вывода. Операции записи поддерживают только общие тайм-ауты. Операции чтения поддерживают как интервал, так и общее время ожидания, которые можно использовать отдельно или совместно.

Время (в миллисекундах) общего периода ожидания для операции чтения или записи вычисляется с использованием значений множителя и константы из структуры [**коммтимеаутс**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) , указанной в функции [**жеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) или [**сеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) . Используется следующая формула:


```C++
Timeout = (MULTIPLIER * number_of_bytes) + CONSTANT
```



Использование как множителя, так и константы позволяет изменять общее время ожидания в зависимости от объема запрашиваемых данных. Приложение может использовать только константу, установив множитель равным нулю, или использовать только множитель, установив константу в ноль. Если константа и множитель равны нулю, общее время ожидания не используется.

Если все параметры времени ожидания чтения равны нулю, то время ожидания чтения не используется, а операция чтения не завершается до тех пор, пока не будет считано запрошенное число байтов или не произойдет ошибка. Аналогично, если все параметры времени ожидания записи равны нулю, операция записи не будет завершена до тех пор, пока не будет записано запрошенное число байтов или не будет возникать ошибка.

Если параметр времени ожидания чтения равен значению **максдворд** и оба параметра времени ожидания Read ALL равны нулю, операция чтения выполняется сразу же после чтения всех символов, доступных во входном буфере, даже если он пуст.

Время интервала принудительное возвращение операции чтения при получении перерыва. Процесс, использующий интервалы времени ожидания, может задавать довольно короткий интервал, что позволяет быстро реагировать на небольшие, изолированные пакеты одного или нескольких символов, однако при получении данных в стабильном потоке он все равно может получать большие буферы символов с одним вызовом.

Время ожидания для операции записи может быть полезным, если передача блокируется каким-либо потоком управления потоками или при вызове функции [**сеткоммбреак**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) для приостановки передачи символов.

В следующей таблице обобщены сведения о поведении операций чтения на основе значений, указанных для параметра общий интервал и время ожидания.



| Итог | Интервал | Поведение                                                                                                                                                                                 |
|-------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0     | 0        | Возвращает, когда буфер полностью заполнен. Тайм-ауты не используются.                                                                                                                    |
| T     | 0        | Возвращает, когда буфер полностью заполнен или когда прошло T миллисекунд с начала операции.                                                                   |
| 0     | Да        | Возвращает, когда буфер полностью заполняется или прошло Y миллисекунд между получением любого из двух символов. Время не начинается до получения первого символа. |
| T     | Да        | Возвращает, когда буфер полностью заполнен или если выполняется любой из типов времени ожидания.                                                                                                     |



 

> [!Note]  
> Однако это время относится к системе, контролирующей физическое устройство. Для удаленного устройства, например модема, время определяется относительно серверной системы, к которой подключен модем. Задержка распространения в сети не включена в множители. Например, клиентское приложение может указать общее время ожидания, в течение которого вычисляются значения 500 миллисекунд. По истечении 500 миллисекунд на сервере клиенту возвращается ошибка истечения времени ожидания. Если задержка распространения по сети составляет 50 миллисекунд, клиент не будет уведомлен о времени ожидания до наступления примерно 50 миллисекунд после истечения времени ожидания.

 

> [!Note]  
> Параметры времени ожидания влияют на поведение перекрывающихся операций чтения и записи на коммуникационном устройстве. При использовании перекрывающихся операций ввода-вывода функция [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex)или [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) может вернуть до завершения операции. Параметры времени ожидания могут определить, когда была выполнена операция.

 

 

 
