---
description: В этом разделе содержатся рекомендации для разработчиков по повышению производительности и эффективности в стеке презентации на современных версиях Windows.
ms.assetid: B6B92F4F-B1D0-40B9-987D-F0C0F2CC7AD1
title: Для достижения оптимальной производительности используйте модель перелистывания DXGI
ms.topic: article
ms.date: 05/31/2018
ms.custom: RS5
ms.openlocfilehash: ce999bc735042132902158cfd6bd6d41296d29a3afc98ab27d9480dc6bd8b3b3
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119951224"
---
# <a name="for-best-performance-use-dxgi-flip-model"></a>Для достижения оптимальной производительности используйте модель перелистывания DXGI

В этом разделе содержатся рекомендации для разработчиков по повышению производительности и эффективности в стеке презентации на современных версиях Windows. он выбирает, где [модель перелистывания DXGI](dxgi-flip-model.md), [DirectX 12: режимы представления в Windows 10 (видео)](https://www.youtube.com/watch?v=E3wTajGZOsA)и [улучшения презентации в Windows 10: ранний взгляд (видео)](https://www.youtube.com/watch?v=nUZVV_mssWQ) слева.

## <a name="call-to-action"></a>Призыв к действию

Если вы по-прежнему **используете \_ отменяемый \_ результат \_ действия подкачки** или **\_ \_ \_ последовательное переключение DXGI** ( "БЛТ" модель представления), пора приостанавливаться!

Переключение на **\_ \_ \_ \_ последовательную отразить эффекты подкачки** или **\_ \_ \_ отразить \_ отменяемый результат переключения DXGI** модель перелистывания) обеспечивает лучшую производительность, низкое энергопотребление и предоставляет более широкий набор функций. (Дополнительные сведения об этих значениях см. в разделе [ \_ \_ перечисление эффектов подкачки DXGI](/windows/desktop/api/DXGI/ne-dxgi-dxgi_swap_effect) .)

Модель зеркального отражения — это то, что делает оконный режим фактически эквивалентным или лучшим по сравнению с классическим режимом «полноэкранный монопольный». На самом деле может потребоваться повторное рассмотрение того, действительно ли ваше приложение нуждается в полноэкранном режиме, так как преимущества перевернутого окна без границы модели включают более быстрый Alt-Tab переключения и лучшей интеграции с современными функциями отображения.

Почему их нужно использовать сегодня? До обновления за Апрель 2018 БЛТ модель может привести к видимому разрыву при использовании гибридных конфигураций GPU, часто находящихся в высоких ноутбуках (см. [статью KB 3158621](https://support.microsoft.com/help/3158621/hybrid-graphics-and-vsync-results-in-graphic-tearing-in-some-games-and)). В обновлении за Апрель 2018 это уничтожение было исправлено за счет дополнительной работы. Если вы выполняете БЛТ на высоком уровне фрамератес в гибридных графических процессорах, особенно при высоком разрешении, например 4 КБ, эта дополнительная работа может повлиять на общую производительность. Чтобы обеспечить оптимальную производительность этих систем, переключитесь с БЛТ на модель зеркального отображения. Кроме того, рассмотрите возможность уменьшения разрешения имеющуюся цепочку буферов, особенно в том случае, если это не основная точка взаимодействия с пользователем (как это часто случается с предварительной версией ОС).

## <a name="a-brief-history"></a>Краткий журнал

Что такое модель перелистывания? Каков альтернативный вариант?

до Windows 7 единственным способом представления содержимого из D3D было «блт» или скопировать его в область, которая принадлежит окну или экрану. начиная с D3D9's флипекс swap и поступающих на DXGI через \_ последовательный экран перелистывания в Windows 8, мы разработали более эффективный способ размещения содержимого на экране путем совместного использования его непосредственно с компоновщиком настольных систем с минимальными копиями. Общие сведения о технологии см. в разделе [модель перелистывания DXGI](dxgi-flip-model.md) .

такая оптимизация возможна благодаря DWM (диспетчер окон рабочего стола), который является компоновщиком, который управляет Windows рабочим столом.

## <a name="when-should-i-use-the-blt-model"></a>Когда следует использовать модель БЛТ?

Существует одна часть функциональности, которую не предоставляет модель перелистывания: возможность иметь несколько различных интерфейсов API, которые создают содержимое, которое все объединено в один и тот же **HWND**, на основе представления. в качестве примера можно использовать D3D для рисования фона окна, а затем [Windows GDI](/windows/desktop/gdi/windows-gdi) , чтобы нарисовать что-либо поверхнее, либо использовать два разных графических api или два цепочек переключений из одного api, чтобы создать чередующиеся кадры. Если взаимодействие на уровне **HWND** не требуется для компонентов графики, то модель БЛТ не требуется.

Существует вторая часть функциональных возможностей, которые не были предоставлены в исходной модели эргономичного перелистывания, но доступны сейчас, что является возможностью присутствия в нерегулируемой частоте кадров. Для приложения, использующего интервал синхронизации 0, не рекомендуется переключаться на функцию перелистывания модели, если только API [IDXGIFactory5:: чеккфеатуресуппорт](/windows/desktop/api/DXGI1_5/nf-dxgi1_5-idxgifactory5-checkfeaturesupport) недоступен, а отчеты, поддерживающие **функцию DXGI, \_ \_ \_ допускают \_ разрывы**. эта функция практически повсеместна в последних версиях Windows 10 и современного оборудования.

## <a name="directflip"></a>директфлип

если вы просмотрели [DirectX 12: режимы представления в Windows 10](https://www.youtube.com/watch?v=E3wTajGZOsA), вы увидите разговор о "Direct redirection" и "независимый переворот". Это оптимизации, которые включены для приложений, использующих перелистывание Model цепочек переключений. В зависимости от конфигурации окна и буфера можно обходить композицию рабочего стола полностью и напрямую отсылать на экран фреймы приложения, так же как и в монопольном полноэкранном режиме.

В эти дни оптимизация может действовать в одном из трех сценариев, в порядке возрастания функциональных возможностей:

1.  **Директфлип**: буферы имеющуюся цепочку буферов соответствуют размерам экрана, а область клиента окна охватывает экран. Вместо использования DWM имеющуюся цепочку буферов для отображения на экране используется приложение имеющуюся цепочку буферов.
2.  **Директфлип с панелью фиттерс**: область клиента окна охватывает экран, а буферы имеющуюся цепочку буферов находятся в пределах определенного аппаратного фактора масштабирования (например, от 0,25 x до 4X) экрана. Оборудование для сканирования GPU используется для масштабирования буфера при его отправке на экран.
3.  **Директфлип с наложением нескольких плоскостей (MPO)**. буферы имеющуюся цепочку буферов находятся в пределах аппаратно-зависимого коэффициента масштабирования размеров окна. DWM может зарезервировать выделенную аппаратную плоскость сканирования для приложения, которая затем сканируется и может растягиваться в подобласти с альфа-смешением экрана.

При использовании модели перелистывания с окнами приложение может запросить поддержку оборудования для различных сценариев Директфлип и реализовать различные типы динамического масштабирования с помощью [IDXGIOutput6:: чеккхардварекомпоситионсуппорт](/windows/desktop/api/DXGI1_6/nf-dxgi1_6-idxgioutput6-checkhardwarecompositionsupport). Необходимо помнить, что, если используются панели фиттерс, курсор может пострадать от побочных эффектов, которые указываются с помощью **\_ \_ флага поддержки компоновки оборудования DXGI, \_ \_ \_ \_ растянутого курсором**.

После того как имеющуюся цепочку буферов был "Директфлиппед", DWM может вернуться в спящий режим и вывести его только при изменении вне приложения. Кадры приложения отправляются непосредственно на экран независимо друг от друга с той же эффективностью, что и в полноэкранном режиме. Это "независимый" перелистывание и может действовать во всех приведенных выше сценариях. Если другое содержимое рабочего стола поверх остальных окон, DWM может легко перейти обратно в составной режим, эффективно «обратное создание» содержимого поверх приложения перед его отражением или использовать MPO для поддержания независимого режима отражения.

Ознакомьтесь с инструментом [пресентмон](https://github.com/GameTechDev/PresentMon) , чтобы получить представление о том, какой из вышеперечисленных использован.

## <a name="what-else-is-new-in-the-flip-model"></a>Что еще нового в модели перелистывания?

Помимо описанных выше усовершенствований, которые применяются к стандартным цепочек переключений без каких-либо специальных возможностей, существует несколько функций, доступных для перелистывания приложений модели для использования:

-   Уменьшение задержки с помощью **\_ \_ \_ \_ \_ \_ ожидающего \_ объекта блокировки цепочки ожидания в кадре**. при работе в независимом режиме перелистывания можно получить до 1 кадра задержки в последних версиях Windows, с корректной резервной версией до минимально возможной.
    -   предостережение. возникла ошибка, которая выдавала не менее двух кадров с задержкой в Windows 10 годовщине обновления и более ранних версиях. Дополнительные сведения см. в [этом разделе форума](https://www.gamedev.net/forums/topic/686507-windows-10-dx12-low-latency-tearing-free-rendering/) . Это исправлено в обновлении создателя отправителя.
-   **DXGI \_ Отменять \_ \_ перелистывание эффектов перелистывания \_** включает режим обратной композиции прямого отражения, что приводит к меньшей общей работе при отображении рабочего стола. DWM может порисован на буферах приложений и отправить их на экран, а не выполнять полную копию в своих собственных цепочек переключений.
-   **DXGI \_ \_Флаг цепочки ПОДкачки \_ \_ допускает \_ разрывы** , что может привести к более низкой задержке, чем у ожидающего объекта, даже в окне в системах с поддержкой наложения нескольких плоскостей.
-   Приложения имеют контроль над масштабированием содержимого, которое происходит во время изменения размера окна с использованием свойства [ \_ масштабирования DXGI](/windows/desktop/api/DXGI1_2/ne-dxgi1_2-dxgi_scaling) , заданного во время создания имеющуюся цепочку буферов.
-   Содержимое в форматах HDR (R10G10B10A2 \_ UNORM или R16G16B16A16 \_ float) не будет открепляться, если оно не состоялось на рабочем столе SDR.
-   Представление статистики доступно в оконном режиме.
-   существует большая совместимость с моделью приложения UWP (универсальная платформа Windows) и DX12, так как они совместимы только с моделью перелистывания.

## <a name="what-do-i-have-to-do-to-use-the-flip-model"></a>Что нужно сделать для использования модели перелистывания?

Отражение модели цепочек переключений имеет несколько дополнительных требований поверх БЛТ цепочек переключений:

1.  Число буферов должно быть не меньше 2.
2.  После [выполнения вызовов](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-present) задний буфер должен быть явно привязан к непосредственному КОНТЕКСТу D3D11, прежде чем его можно будет снова использовать.
3.  После вызова [сетфуллскринстате](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-setfullscreenstate)приложение должно вызвать [Ресизебуфферс](/windows/desktop/api/DXGI/nf-dxgi-idxgiswapchain-resizebuffers) перед его **присутствием**.
4.  MSAA (многовыборочное сглаживание) цепочек переключений не поддерживается напрямую в модели перелистывания, поэтому приложению потребуется выполнить решение MSAA, прежде чем выдать **представление**.

## <a name="how-to-choose-the-right-rendering-and-presentation-resolutions"></a>Как выбрать правильные разрешения отрисовки и представления

Традиционным шаблоном для приложений в прошлом было предоставление пользователю списка разрешений на выбор, когда пользователь выбирает эксклюзивный полноэкранный режим. Благодаря способности современных экранов легко начать масштабирование содержимого, рассмотрите возможность предоставления пользователям возможности выбора разрешения отрисовки для масштабирования производительности, независимо от разрешения вывода и даже в оконном режиме. Более того, приложения должны использовать **IDXGIOutput6:: чеккхардварекомпоситионсуппорт** , чтобы определить, нужно ли масштабировать содержимое перед его представлением или они должны позволить оборудованию выполнять масштабирование.

Может потребоваться миграция содержимого с одного GPU на другой в ходе текущей операции или композиции. Это часто справедливо для ноутбуков с несколькими GPU или систем с внешними GPU, подключенными к. Так как эти конфигурации становятся более распространенными, и как отображение с высоким разрешением становится более распространенным, стоимость предоставления полного разрешения имеющуюся цепочку буферов возрастает. Если целевой объект имеющуюся цепочку буферов не является основным моментом взаимодействия с пользователем, как это часто случается с названиями VR, которые представляют собой двухмерную предварительную версию сцены VR, в дополнительное окно, рассмотрите возможность использования более низкого разрешения имеющуюся цепочку буферов, чтобы уменьшить объем пропускной способности, которую необходимо передать на разных GPU.

## <a name="other-considerations"></a>Другие замечания

В первый раз, когда GPU запрашивает запись в задний буфер имеющуюся цепочку буферов, это время, в течение которого GPU будет ожидать освобождения буфера. По возможности откладывайте этот момент к кадру, как можно раньше.

 

 
