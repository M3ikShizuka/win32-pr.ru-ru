---
description: Гамма-коррекция или гамма для краткости — это имя нелинейной операции, используемой системами для кодирования и дешифрования значений пикселей в изображениях.
ms.assetid: 97ACDAE3-514E-4AAF-A27D-E5FFC162DB2A
title: Использование гамма-коррекции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c940db1a94fb41e9babecbeb3075aa9e01b3732
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127264443"
---
# <a name="using-gamma-correction"></a>Использование гамма-коррекции

Гамма-коррекция или гамма для краткости — это имя нелинейной операции, используемой системами для кодирования и дешифрования значений пикселей в изображениях.

-   [Что такое гамма и что это за?](#what-is-gamma-and-what-is-it-for)
-   [Фон гаммы на Windows](#background-of-gamma-on-windows)
-   [Развитие аппаратного обеспечения экрана](#evolution-of-display-hardware)
-   [Возможности управления гаммами в DXGI](#gamma-control-capabilities-in-dxgi)
-   [Установка элемента управления гамма с помощью DXGI](#setting-gamma-control-with-dxgi)
-   [Практические рекомендации по контролю гаммы](#gamma-control-practicalities)
-   [Связанные темы](#related-topics)

## <a name="what-is-gamma-and-what-is-it-for"></a>Что такое гамма и что это за?

В конце графического конвейера, когда изображение покидает компьютер, чтобы сделать его перемещение по кабелю монитора, существует небольшая часть оборудования, которая может преобразовывать значения пикселей на лету. Это оборудование обычно использует таблицу подстановки для преобразования пикселов. Это оборудование использует красные, зеленые и синие значения, которые поступают из поверхности, отображаемой для поиска скорректированных значений гаммы в таблице, а затем отправляет исправленные значения в монитор вместо фактических значений поверхности. Таким образом, эту таблицу подстановки можно заменить любым другим цветом. Хотя таблица имеет такой уровень мощности, типичное использование заключается в настройке изображений, чтобы компенсировать различия в ответе монитора. Ответ монитора — это функция, которая связывает числовое значение красного, зеленого и синего компонентов пикселя с отображаемой яркостью этого пикселя.

Именно для этого предназначена эта таблица, но разработчикам игр было обнаружено творческих применений, например мигание всего экрана Красного для психологической. В современных игровых приложениях в процессе последующей обработки каждого кадра мы обычно предоставляем другие способы выполнения таких задач. На самом деле, рекомендуется оставить только таблицу гаммы, так как она может использоваться для калибровки ответа монитора, а оптовые изменения гамма-шкалы приуничтожить эту тщательную калибровку.

Науки об определении гамма-коррекции сложны и не представлено здесь, за исключением освещения, откуда поступило название «гамма». CRT (т. е.) — это сложная функция, но физика этих мониторов означает, что они демонстрируют ответ, который может быть грубой, представленный этой функцией питания:

яркость (входные данные) =<sup>гамма</sup> ввода

Значение гаммы обычно близко к значению 2,0. ЖК-мониторы и все остальные новые технологии специально разработаны для похожих ответов, поэтому для этих новых технологий не нужно повторно откалибровать все наши программы и образы. Стандарт sRGB объявляет, что это значение гаммы равно 2,2, а это значение стало широко реализованным стандартом.

Человеческий глаз также имеет функцию ответа, которая примерно инвертирует функцию CRT. Это означает, что воспринимаемая яркость пикселя очень приблизительно соответствует значениям RGB в этом пикселе.

Поскольку значение гаммы 2,2 становится стандартом де-факто, обычно нам не нужно беспокоиться о кривой гамма, закодированной в этой таблице, и оставить ее в виде линейного сопоставления "один к одному". Для правильного сопоставления цветов необходимо екскуисите с этой функцией, но это обсуждение выходит за рамки данного раздела. Windows включает средство, которое позволяет пользователям откалибровать экраны до гамма-2,2, а это средство использует оборудование таблицы подстановки для получения тщательно подобранной тонкой корректировки своих компьютеров. Пользователи могут запустить это средство, выполнив поиск по строке "Калибровка цвета". Для конкретных мониторов, автоматизирующих этот процесс, также определены четко определенные цветовые профили. Инструмент «калибровка цвета» может обнаружить эти новые мониторы и информировать пользователей о том, что калибровка уже существует.

Это понятие о кодировании закона по питанию в значениях цвета полезно в других местах графического конвейера, особенно в текстурах. Для текстур требуется больше точности на темных цветах из-за ответа от логарифмического глаз, о котором мы только что говорили. Тщательная обработка гаммы в этой части конвейера очень важна. Дополнительные сведения см. [в разделе Преобразование данных для цветового пространства](converting-data-color-space.md).

Оставшаяся часть этого раздела посвящена только коррекции гаммы в последней части конвейера между данными буфера кадров и монитором. Если вы хотите написать Мастер калибровки или создать специальные эффекты в полноэкранном приложении, где этап последующей обработки не является практичным, то необходимо выполнить следующие действия.

## <a name="background-of-gamma-on-windows"></a>Фон гаммы на Windows

Windows компьютерах обычно имеет таблицу гаммы, которая является таблицей подстановки, которая принимает triplet байт и выводит triplet байт. Эти триады 768 (256 x 3) байт ОЗУ. Это нормально, если формат просмотра содержит Triplet значений RGB, но недостаточно выразительным для описания преобразований, которые могут потребоваться, если формат представления превышает значение \[ 0, 1 \] , например значения с плавающей запятой. api-интерфейсы в Windows, которые контролируют гамма управления, соблюдают развитие, так как форматы вывода стали более сложными.

первый Windows интерфейсов api для предложения гамма-управления — это Windows интерфейс графических устройств (GDI) [**сетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp) и [**жетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-getdevicegammaramp). Эти API-интерфейсы работают с входными массивами слов 3 256, при этом каждое слово кодируется с нуля до одного, представленного значениями 0 и 65535. Очень точность слова, как правило, недоступна в реальных таблицах подстановки оборудования, но эти API-интерфейсы должны быть гибкими. Эти API, в отличие от других, описанных далее в этом разделе, позволяют разрешить небольшое отклонение от функции IDENTITY. На самом деле любая запись в пандус должна быть в пределах 32768 значения идентификатора. Это ограничение означает, что ни одно из приложений не может полностью черный экран или какой-либо другой нечитаемый цвет.

Следующий API — это [**Сетгаммарамп**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setgammaramp)Microsoft Direct3D 9, который соответствует тем же шаблону и формату данных, что и [**сетдевицегаммарамп**](/windows/win32/api/wingdi/nf-wingdi-setdevicegammaramp). Значение по умолчанию гамма-шкалы Direct3D 9 не особенно полезно. Это кратность слов, инициализированных в 0-255, а не 0-65535, даже несмотря на то, что API определен с точки зрения 0-65535.

Последняя версия API — [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol). Этот API имеет более гибкую схему, чтобы выразить гамма-управление, так как увеличенный набор форматов экрана папке DXGI, включая десять целых бит на канал, 16-битные форматы с плавающей запятой и \_ формат расширенного диапазона смещения XR.

Все эти API работают на одном и том же оборудовании и изменяют одни и те же значения. API-интерфейсы Direct3D 9 и DXGI доступны только для записи. Невозможно прочитать значение оборудования, изменить его, а затем задать. Можно задать только пандус. Кроме того, гамма может быть задана только при полноэкранном режиме приложения. Это ограничение является еще одним способом гарантировать, что рабочий стол всегда читается. это значит, что приложение может завладеть собственным экраном, но Windows восстановит предыдущую гамму-шкалу при потере приложением полного экрана (например, с помощью alt-tab или ctrl-alt-del).

## <a name="evolution-of-display-hardware"></a>Развитие аппаратного обеспечения экрана

Некоторые новые мониторы могут отображать широкий диапазон интенситиес. Однако, если формат отображения может представлять только значения от 0 до одного, то отображение должно отображать ноль в самом темном значении, а другое — в самом светлом значении. Это самое яркое значение может оказаться слишком ярким для удобного просмотра веб-страниц с черным текстом на белом фоне, но это замечательно для более ярких специальных эффектов, таких как просмотр солнечного света, глиттеринг с помощью Lake или молнии. Поэтому нам нужен способ выразить эти более широкие диапазоны. В DXGI 1,1 и более поздних версиях содержатся значения формата отображения, которые позволяют 1,0 представлять удобное значение белого и зарезервировать более широкие значения формата отображения для более яркого применения специальных эффектов. DXGI 1,1 поддерживает два формата экрана, которые могут выражать эти более широкие значения: \_ \_ R10G10B10 \_ XR \_ смещение \_ a2 \_ UNORM и 16-разрядный с плавающей запятой. Полное описание этих форматов см. [в разделе подробные сведения о расширенном формате](/windows-hardware/drivers/display/details-of-the-extended-format). Далее мы рассмотрим, почему в API-интерфейсе [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) для функции DXGI требуются значения пикселей, превышающие 1,0.

## <a name="gamma-control-capabilities-in-dxgi"></a>Возможности управления гаммами в DXGI

Функция DXGI позволяет драйверу дисплея выражать свои элементы управления гамма в качестве пошаговой линейной функции. Эта линейная функция, ориентированная на пошаговую функцию, определяется контрольными точками этой функции, диапазоном значений, в которые функция может преобразовать, и дополнительными дополнительными операциями масштабирования и смещения, которые можно применить после преобразования. Приложение может вызвать метод [**идксгиаутпут:: жетгаммаконтролкапабилитиес**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) для получения всех этих возможностей управления в структуре [**\_ \_ \_ возможностей управления "гамма DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) ".

На этом графике показана линейная функция с четырьмя контрольными точками.

![линейная функция коррекции гаммы](images/gamma-linear-function.png)

DXGI определяет контрольные точки по их расположению вдоль цветовой оси поверхности. На приведенном выше графике расположение контрольных точек равно 0, 0,5, 0,75 и 1,0. Эти контрольные точки указывают на то, что оборудование может преобразовывать значения в диапазоне от 0 до 1,0. DXGI перечисляет эти контрольные точки в элементе массива **контролпоинтпоситионс** в [**\_ \_ \_ возможностях контроля гаммы DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) и всегда объявляет их в порядке возрастания. Функция DXGI заполняет только первые элементы массива **контролпоинтпоситионс** и указывает количество элементов с элементом **нумгаммаконтролпоинтс** **\_ \_ \_ возможностей элемента управления "гамма DXGI**". Если **нумгаммаконтролпоинтс** меньше 1025, то DXGI оставляет остальные элементы **контролпоинтпоситионс** неопределенными.

Оборудование, представленное этим графом, может преобразовывать значения в диапазон от 0 до 1,25. Таким образом, DXGI присваивает элементам **минконвертедвалуе** и **максконвертедвалуе** 0,0 f и 1,25 f соответственно.

DXGI задает элемент **скалеандоффсетсуппортед** в [**\_ \_ \_ возможностях гамма-управления DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) , чтобы указать, поддерживает ли оборудование возможность масштабирования и смещения. Если оборудование поддерживает масштабирование и смещение, оно сохраняет простую таблицу подстановки, но затем корректирует выходные данные таблицы для растяжения выходных данных в диапазон, превышающий \[ 0, 1 \] . Оборудование сначала Масштабирует значения, выходящие за пределы таблицы подстановки, а затем смещает их.

> [!Note]  
> Различные мониторы, подключенные к одному и тому же компьютеру, могут иметь различные возможности управления гаммами. Более того, возможности управления гамма-контроля могут фактически изменяться в зависимости от режима вывода. Следовательно, рекомендуется всегда вызывать [**идксгиаутпут:: жетгаммаконтролкапабилитиес**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-getgammacontrolcapabilities) , чтобы запрашивать возможности управления гамма-функции, когда приложение переходит в полноэкранный режим.

 

Эти значения возможностей управления гаммами можно использовать для получения значений элементов управления, которые затем можно задать с помощью API [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) .

## <a name="setting-gamma-control-with-dxgi"></a>Установка элемента управления гамма с помощью DXGI

Чтобы установить элементы управления гаммы, передайте указатель на [**структуру \_ \_ управления гаммы DXGI**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) при вызове API [**идксгиаутпут:: сетгаммаконтрол**](/windows/desktop/api/DXGI/nf-dxgi-idxgioutput-setgammacontrol) .

Элементы **Scale** и **offset** [**\_ \_ элемента управления "гамма**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) " объекта DXGI задаются для указания значений масштаба и смещения, которые должны применяться оборудованием к значениям, получаемым из таблицы подстановки. Можно безопасно установить **масштаб** равным 1 и выполнить **смещение** до нуля (т. е. масштаб на один не влияет, а смещение от нуля не оказывает никакого влияния), если вы не хотите использовать функцию масштабирования и смещения, или если оборудование не имеет такой возможности.

Вы устанавливаете элемент массива **гаммакурве** в [**\_ \_ элементе управления "гамма-характеристики" DXGI**](/previous-versions/windows/desktop/legacy/bb173061(v=vs.85)) в список структур [**\_ RGB**](/previous-versions/windows/desktop/legacy/bb173071(v=vs.85)) в режиме DXGI для точек на кривой гаммы. Каждый **элемент \_ RGB в DXGI** определяет значения с плавающей запятой, представляющие красный, зеленый и синий компоненты для этой точки. Кривая гамма не использует альфа-значения. Для заполнения этого числа элементов в массиве **гаммакурве** используется число, полученное от **нумгаммаконтролпоинтс** элементов [**\_ управления "гамма-характеристики \_ \_**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)) ". Каждый элемент, помещаемый в массив **гаммакурве** , является высотой каждой контрольной точки.

Обратите внимание, что в приведенном выше графе теперь вы управляете вертикальным размещением каждой контрольной точки, и у вас есть отдельный элемент управления для красного, зеленого и синего. Например, можно задать для всех зеленых и синих значений нулевое значение и установить для красного цвета в виде одной лестницы с нуля до одного. В этом случае отображаемое изображение отображает только красные части, синие и зеленые — черным цветом. Можно также задать нисходящий лестницой для всех цветов, что приводит к инвертированному отображению. Любое значение, помещаемое в массив **гаммакурве** , должно быть инклюзивным в пределах значений, полученных из членов **минконвертедвалуе** и **максконвертедвалуе** [**\_ возможностей управления "гамма" \_ \_ функции DXGI**](/previous-versions/windows/desktop/legacy/bb173062(v=vs.85)).

## <a name="gamma-control-practicalities"></a>Практические рекомендации по контролю гаммы

Элементы управления "гамма" для DXGI применяются только в том случае, если приложение находится во весь экран. Windows восстанавливает предыдущее состояние отображения, когда приложение завершает работу или возвращается в оконный режим. но Windows не восстанавливает гамму-состояние приложения, если приложение повторно перейдет в полноэкранный режим. Приложение должно явно восстановить состояние гаммы при повторном входе в полноэкранный режим.

Не все адаптеры поддерживают гамма-управление. Если адаптер не поддерживает гамма-управление, он игнорирует вызовы для установки гамма-шкалы.

Приложения, работающие под управлением удаленного рабочего стола, не могут управлять гаммой.

Курсор мыши, если он реализован в оборудовании (как и большинство), обычно не реагирует на параметр гаммы.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Руководством по программированию для DXGI](dx-graphics-dxgi-overviews.md)
</dt> </dl>

 

 
