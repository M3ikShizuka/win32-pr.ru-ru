---
description: Для повышения производительности может потребоваться создать более одной цепочки буферов для каждого устройства визуализации Direct3D.
ms.assetid: 29AB9799-9E4E-4A96-B4AB-F1B754794879
title: Повышение производительности с помощью нескольких цепочек переключения на каждое устройство отрисовки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f1e356434521054bc13b553c8ae3d6e43d8d98ef
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495222"
---
# <a name="improving-performance-with-multiple-swap-chains-per-rendering-device"></a>Повышение производительности с помощью нескольких цепочек переключения на каждое устройство отрисовки

Для повышения производительности может потребоваться создать более одной цепочки буферов для каждого устройства визуализации Direct3D. Этот подход используется для экономии памяти, необходимой для создания дополнительных устройств, или для сокращения времени отрисовки для отображения в отдельных цепочках подкачки каждого устройства отдельно или для сохранения памяти и уменьшения времени визуализации.

-   [Сценарии приложений с несколькими цепочками переключения на устройство](#app-scenarios-with-multiple-swap-chains-per-device)
-   [Управление несколькими цепочками переключения на устройство](#managing-multiple-swap-chains-per-device)
    -   [Задание максимальной задержки кадра](#setting-maximum-frame-latency)
    -   [Использование модели отражения с несколькими цепочками переключения на устройство](#using-flip-model-with-multiple-swap-chains-per-device)
-   [См. также](#related-topics)

## <a name="app-scenarios-with-multiple-swap-chains-per-device"></a>Сценарии приложений с несколькими цепочками переключения на устройство

Рассмотрите возможность использования нескольких цепочек, если сцена приложения состоит из отдельных экранных объектов, которые визуализируются и обновляются независимо друг от друга. Например, приложение постоянно изменяет анимацию, например видео с одной стороны и прокручиваемый текст на другой стороне. Для экономии памяти, которая обычно требуется для создания дополнительного устройства и упрощения обмена содержимым между двумя цепочками подкачки, можно создать обе цепочки переключения, привязанные к одному устройству визуализации Direct3D. Используйте одну цепочку буферов для анимации и одну цепочку подкачки для текста. Распространенным примером этого сценария является приложение Direct3D, которое также использует API [DirectComposition](../directcomp/directcomposition-portal.md) .

Другой сценарий заключается в том, что необходимо сохранить время отрисовки, установив несколько целевых объектов отрисовки одновременно для нескольких цепочек переключения. Например, предположим, что вы хотите визуализировать сложную сцену с большим количеством текстур и геометрических объектов, например для сбора автомобилей на дорожке, и вы хотите, чтобы в окне приложения отображались представления как на задней, так и на боковой стороне в двух окнах отображения, которые отображаются двумя цепочками подкачки. Если несколько цепочек перекачки заданы как целевые объекты рендеринга, приложению не нужно повторять время отрисовки в каждой цепочке подкачки отдельно.

## <a name="managing-multiple-swap-chains-per-device"></a>Управление несколькими цепочками переключения на устройство

Используйте рекомендации в этом разделе для управления несколькими цепочками переключения, создаваемыми для одного устройства визуализации Direct3D.

### <a name="setting-maximum-frame-latency"></a>Задание максимальной задержки кадра

Используйте метод [**IDXGIDevice1:: сетмаксимумфрамелатенци**](/windows/desktop/api/DXGI/nf-dxgi-idxgidevice1-setmaximumframelatency) , чтобы задать максимальное количество операций, которые операционная система может поместить в очередь для отрисовки на экране. Это максимальное число относится к устройству отрисовки Direct3D, а не по цепочке подкачки. Таким образом, чтобы убедиться, что в операционной системе отображаются операции, выполняемые по предполагаемому интервалу вертикальной синхронизации, рекомендуется не устанавливать максимальную задержку кадра равным 1 при создании нескольких цепочек перелистывания или BitBlt моделей для каждого устройства и при отображении нескольких цепочек переключения для каждого кадра. Как правило, если вы надежно отправляете только 2 существующих операций на кадр между всеми цепочками подкачки одного и того же устройства, можно установить максимальную задержку кадров равным 2. Если вы не можете обеспечить надежную отправку и подсчитать количество выполняемых операций на кадр, можно использовать [представленную статистику](dxgi-flip-model.md) для наблюдения за отображением операций в операционной системе.

### <a name="using-flip-model-with-multiple-swap-chains-per-device"></a>Использование модели отражения с несколькими цепочками переключения на устройство

Используйте эти рекомендации при использовании [модели отражения DXGI](dxgi-flip-model.md) с несколькими цепочками переключения, созданными для одного устройства отрисовки Direct3D.

### <a name="targeting-specific-vsync-intervals-with-each-swap-chains-present-operations"></a>Нацеливание на определенные интервалы вертикальной синхронизации с помощью всех существующих операций в цепочке подкачки

При создании двух или более перевернутых цепочек переключения моделей на каждое устройство Обратите внимание на различия в отображении при управлении порядком состояния устройства и последовательности вызовов метода [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) всех цепочек подкачки. Чтобы убедиться, что операционная система отображает каждую операцию текущей цепочки буферов, необходимо убедиться, что количество операций в очереди всегда по крайней мере на один меньше, чем число задних буферов для цепочки подкачки с наименьшим числом задних буферов.

### <a name="flip-model-swap-chains-with-two-buffers"></a>Перелистывание цепочек переключения моделей с помощью двух буферов

Приложение может ориентироваться на определенные вертикальной синхронизации интервалы, когда количество поступающих в очередь операций меньше или равно числу задних буферов — 1. Кроме того, необходимо использовать или визуализировать каждую цепочку подкачки отдельно, а затем прекратить использование каждой цепочки подкачки с текущей операцией. Таким образом, при отправке каждой текущей операции для цепочки переброски с двумя буферами достигается пороговое значение для количества задних буферов, на которые необходимо обратить особое внимание, если вы хотите, чтобы приложение заработало определенные вертикальной синхронизации интервалы.

В случае с 2-буферными цепочками перестановки для назначения конкретных вертикальной синхронизации интервалов необходимо убедиться, что операционная система завершает отображение каждой операции в цепочке подкачки перед отрисовкой в следующий буфер. Рекомендуется завершить настройку представления "рендеринг-целевого объекта" и другого состояния отрисовки, следующего рендеринга, а затем вызвать метод [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) для каждого из двух буферов одной цепочки, прежде чем выполнять одно и то же для другой цепочки буфера обмена. При работе с двумя или более цепочками подкачки необходимо сбросить целевой объект рендеринга и состояние отрисовки на устройстве для каждой цепочки буферов. Преимущество такого подхода состоит в том, чтобы избежать случая, когда одна или несколько операций в цепочке буферов перестановки пропустили свой предполагаемый интервал вертикальной синхронизации. В первом примере приложение с изменяемой анимацией и текстом, как описано в разделе [сценарии приложений с несколькими цепочками подкачки на устройство](#app-scenarios-with-multiple-swap-chains-per-device), нацеленными на определенные конкретные интервалы, гарантируется, что при обновлении анимации в одном окне отображения соответствующий текст, отображаемый отдельной цепочкой буферов, также отображается одновременно в другом окне отображения. Если приложению необходимо указать определенные интервалы вертикальной синхронизации, следуйте указаниям в этом руководстве.

На этой диаграмме показан пример потока кода для отрисовки и представления цепочки подкачки в приложении с двумя цепочками перелистывания моделей с двумя буферами. В этом случае необходимо ориентироваться на конкретный текущий интервал для каждой операции.

![Иллюстрация модели отражения с двумя буферами](images/flip-mode-2-buffers.png)

### <a name="reducing-rendering-time-by-simultaneously-setting-multiple-swap-chains-as-render-targets"></a>Уменьшение времени отрисовки за счет одновременного задания нескольких цепочек подкачки в качестве целевых объектов рендеринга

Во втором примере перечисление автомобилей на дорожке, как описано в разделе [сценарии приложений с несколькими цепочками перекачки на каждое устройство](#app-scenarios-with-multiple-swap-chains-per-device), может потребоваться выставить нацеливание на конкретные существующие вертикальной синхронизации интервалы с экономией времени отрисовки, которые вы получаете, установив несколько целевых объектов рендеринга одновременно для всех цепочек обмена. В этом случае можно одновременно задать несколько целевых объектов рендеринга, отобразить сцену в каждой цепочке буферов, а затем вызвать [**IDXGISwapChain1::P resent1**](/windows/desktop/api/DXGI1_2/nf-dxgi1_2-idxgiswapchain1-present1) для каждой цепочки буферов, используемой в сцене. Преимуществом этого подхода является сокращение времени отрисовки. Ограничение этого подхода заключается в том, что в цепочке одновременного переключения невозможно ориентироваться на те же вертикальной синхронизации при использовании цепочек переключения из двух буферов. Например, операционная система не будет отображать содержимое зеркального отображения на уровне гонки, пока 1 вертикальной синхронизации после того, как одно содержимое будет отображаться на зеркале просмотра сзади автомобиля.

На этой схеме показан пример потока кода для отрисовки и представления цепочки подкачки в приложении с двумя цепочками перелистывания моделей с двумя буферами. В этом примере вы сохраняете время отрисовки для перекачки цепочек 1 и 2 для буферов A и C. Но нельзя синхронизировать интервалы вертикальной синхронизации, в которых отображаются операции для буферов A и C. Эти шаблоны повторяются для кадра 2.

![Иллюстрация одновременного задания нескольких цепочек подкачки в качестве целевых объектов рендеринга](images/multi-swap-chains-as-render-targets.png)

Чтобы избежать отсутствия предполагаемого интервала вертикальной синхронизации из-за большого количества операций в очереди, можно увеличить число задних буферов в каждой цепочке подкачки. Но этот метод использует больше памяти для видео. Чтобы избежать отсутствующих интервалов целевого вертикальной синхронизации, рекомендуется всегда отключать число ожидающих операций в очереди, чем количество задних буферов в цепочке подкачки с наименьшим числом задних буферов. Если две цепочки перестановки заданы в качестве нескольких целевых объектов рендеринга, так как в обеих цепочках подкачки одновременно помещается две существующие операции, рекомендуется создавать цепочки подкачки с длиной не менее трех буферов.

На следующей схеме показан пример потока кода для отрисовки и представления цепочки подкачки в приложении с двумя цепочками перелистывания моделей, каждый из которых имеет длину три буфера. В этом случае, поскольку количество постановки в очередь для любого конкретного кадра равно 2, что меньше числа задних буферов на цепочку буферов, приложение может задать несколько целевых объектов рендеринга и по-прежнему ориентироваться на те же вертикальной синхронизации интервалы, что и буферы A и D в кадре 2 и в последующих кадрах.

![Иллюстрация одновременного задания нескольких цепочек подкачки в качестве целевых объектов рендеринга предназначенных одного вертикальной синхронизации](images/multi-swap-chains-as-render-targets-same-vsync.png)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Улучшение представления с помощью модели перелистывания, "грязных" прямоугольников и областей с прокруткой](dxgi-1-2-presentation-improvements.md)
</dt> </dl>

 

 
