---
title: Навигация по QueryInterface в объекте
description: Навигация по QueryInterface в объекте
ms.assetid: 7dec015f-7609-40eb-a71e-f6e9c9b9f8ff
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3dbd44d200bf0a992f47bc375d0782bdadacf6a3
ms.sourcegitcommit: 85688bbfbe5b121bc05ddf112d54c23a469dfbc0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "104336062"
---
# <a name="queryinterface-navigating-in-an-object"></a>QueryInterface: Навигация в объекте

После получения исходного указателя на интерфейс в объекте COM имеет очень простой механизм, позволяющий определить, поддерживает ли объект другой конкретный интерфейс и, если это так, получить указатель на него. (Дополнительные сведения о получении исходного указателя на интерфейс объекта см. в разделе [Получение указателя на объект](getting-a-pointer-to-an-object.md).) Этот механизм является методом [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) интерфейса [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) . Если объект поддерживает запрошенный интерфейс, метод должен вернуть указатель на этот интерфейс. Это позволяет объекту свободно перемещаться по интерфейсам, которые поддерживает объект. **QueryInterface** разделяет запрос "поддерживается ли данный контракт?" от высокопроизводительного использования этого контракта после успешного согласования.

Когда клиент изначально получает доступ к объекту, этот клиент получает по крайней мере указатель интерфейса [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) (самый фундаментальный интерфейс), с помощью которого он может управлять временем существования объекта, путем указания объекта, когда он выполняется с помощью объекта, и вызова [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)). Клиент программируется на запрос каждого управляемого объекта для выполнения некоторых операций, но интерфейс **IUnknown** не имеет функций для этих операций. Вместо этого эти операции выражаются через другие интерфейсы. Поэтому клиент запрограммирован на согласование с объектами для этих интерфейсов. В частности, клиент вызывает **QueryInterface** , чтобы запросить объект для интерфейса, через который клиент может вызывать нужные операции.

Поскольку объект реализует [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), он может принимать или отклонять запрос. Если объект принимает клиентский запрос, **QueryInterface** возвращает новый указатель на запрошенный интерфейс клиенту. Через этот указатель интерфейса клиент имеет доступ к методам этого интерфейса. С другой стороны, если объект отклоняет клиентский запрос, **QueryInterface** возвращает пустой указатель (Error), а клиент не имеет указателя, через который вызываются нужные функции. В этом случае клиент должен корректно работать с этой возможностью. Например, предположим, что клиент имеет указатель на интерфейс а в объекте и запрашивает интерфейсы B и C. Предположим также, что объект поддерживает интерфейс B, но не поддерживает интерфейс C. В результате объект возвращает указатель на B и сообщает, что C не поддерживается.

Ключевой момент заключается в том, что когда объект отклоняет вызов [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), клиент не может запросить объект для выполнения операций, выраженных через запрошенный интерфейс. Клиент должен иметь указатель интерфейса для вызова методов в этом интерфейсе. Если объект отказывается предоставить запрошенный указатель, клиент должен быть готов к выполнению без выполнения действий, не выполняя ни то ни было, что было предназначено для этого объекта, или попытайтесь вернуться на другой, возможно, менее мощный интерфейс. Эта функция COM-функций хорошо работает в сравнении с другими объектно-ориентированными системами, в которых невозможно определить, будет ли работать функция до тех пор, пока вы не выберете эту функцию, а также не уверены в том, что ошибка обработки не определена. **QueryInterface** предоставляет надежный и согласованный способ определить, поддерживает ли объект интерфейс перед попыткой вызова его методов.

Метод [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) также обеспечивает надежный и надежный способ указания того, что объект не поддерживает данный контракт. То есть, если при вызове **QueryInterface** один из них запрашивает "старый" объект, независимо от того, поддерживает ли он новый интерфейс (например, он был сформирован после доставки старого объекта), старый объект будет надежно, не вызывая сбоя, и ответить "нет". Технология, которая поддерживает это, — это алгоритм, по которому выделяются идентификаторов IID. Хотя это может показаться небольшой точкой, очень важно, чтобы общая архитектура системы, а также возможность запроса устаревших элементов о новых функциях, в удивлении, не содержится в большинстве других архитектур объектов.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование и реализация IUnknown](using-and-implementing-iunknown.md)
</dt> </dl>

 

 




