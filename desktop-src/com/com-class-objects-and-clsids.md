---
title: Объекты COM-классов и CLSID
description: COM-сервер реализуется как класс COM.
ms.assetid: 0073acdf-38a8-4f1a-aa26-379456a95fca
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1bbfde2f379c4c7589db4cde283c8c67d720b21d
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "105710389"
---
# <a name="com-class-objects-and-clsids"></a>Объекты COM-классов и CLSID

COM-сервер реализуется как класс COM. *Класс COM* является реализацией группы интерфейсов в коде, который выполняется при каждом взаимодействии с данным объектом. Существует важное различие между классом C++ и классом COM: в C++ класс является типом, а класс COM — просто определением объекта и не несет типа, хотя программист C++ может реализовать его с помощью класса C++. Модель COM предназначена для того, чтобы класс можно было использовать в различных приложениях, включая приложения, написанные без знания существования этого конкретного класса. Таким образом, код класса для данного типа объекта существует либо в динамической связанной библиотеке (DLL), либо в другом исполняемом приложении (EXE).

Каждый класс COM определяется *идентификатором CLSID*, уникальным 128-РАЗРЯДным идентификатором GUID, который сервер должен зарегистрировать. COM использует этот идентификатор CLSID в запросе клиента, чтобы связать определенные данные с библиотекой DLL или EXE, содержащей код, реализующий класс, создавая экземпляр объекта.

Для клиентов и серверов на одном компьютере идентификатором CLSID сервера является все, что требуется клиенту. На каждом компьютере COM поддерживает базу данных (она использует системный реестр на платформах Microsoft Windows и Macintosh) всех идентификаторов CLSID для серверов, установленных в системе. Это сопоставление между каждым идентификатором CLSID и расположением библиотеки DLL или EXE, в котором находится код для этого идентификатора CLSID. COM обращается к этой базе данных каждый раз, когда клиент хочет создать экземпляр класса COM и использовать его службы, чтобы клиент никогда не знал о абсолютном расположении кода на компьютере.

Для распределенных систем COM предоставляет записи реестра, позволяющие удаленному серверу регистрировать себя для использования клиентом. Хотя приложениям требуется знать только CLSID сервера, поскольку они могут полагаться на реестр для определения сервера, COM позволяет клиентам переопределять записи реестра и указывать расположения серверов, чтобы использовать все преимущества сети. (См. раздел [Поиск удаленного объекта](locating-a-remote-object.md).)

Базовый способ создания экземпляра класса — через *объект класса* com. Это просто промежуточный объект, который поддерживает функции, общие для создания новых экземпляров данного класса. Большинство объектов классов, используемых для создания объектов из CLSID, поддерживают интерфейс [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) — интерфейс, который включает важный метод [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) . Для каждого класса объекта, для которого создается экземпляр, реализуется интерфейс **IClassFactory** . (Дополнительные сведения о реализации **IClassFactory** см. в разделе [Реализация IClassFactory](implementing-iclassfactory.md).)

> [!Note]  
> Серверы, поддерживающие другой настраиваемый интерфейс фабрики класса, не должны поддерживать [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) специально. Однако для вызовов функций активации, отличных от [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) (например, [**кокреатеинстанцеекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstanceex)), требуется, чтобы сервер поддерживал **IClassFactory**.

 

Когда клиент хочет создать экземпляр объекта сервера, он использует CLSID требуемого объекта в вызове [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject). (Этот вызов может быть прямым или неявным с помощью одной из вспомогательных функций создания объекта.) Эта функция находит код, связанный с идентификатором CLSID, создает объект класса и предоставляет указатель на запрошенный интерфейс. (**Кожетклассобжект** принимает параметр *riid* , указывающий нужный указатель на интерфейс клиента.)

> [!Note]  
> Модель COM содержит всего несколько функций, с которыми строится множество других. Наиболее важным из них, вероятно, является [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject), который опирается на все функции создания экземпляра.

 

С помощью этого указателя вызывающий объект может создать экземпляр объекта и получить указатель на запрошенный интерфейс для объекта. Обычно это интерфейс инициализации, используемый для активации объекта (перевода его в состояние выполнения), чтобы клиент мог выполнять любые действия с объектом, который ему нужен. С помощью основных функций COM клиент должен также отпустить все указатели на объекты.

Еще один механизм активации экземпляров объектов — это моникер класса. Моникеры класса привязываются к объекту класса класса, для которого они созданы. Дополнительные сведения см. в разделе [моникеры класса](class-monikers.md).

COM предоставляет несколько вспомогательных функций, которые снижают объем работ по созданию экземпляров объектов. Они описаны в [вспомогательных функциях создания экземпляров](instance-creation-helper-functions.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание объекта через объект класса](creating-an-object-through-a-class-object.md)
</dt> </dl>

 

 