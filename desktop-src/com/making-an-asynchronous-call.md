---
title: Выполнение асинхронного вызова
description: Процедура выполнения синхронного вызова проста в том, что клиент получает указатель интерфейса на серверный объект и вызывает методы через этот указатель. Асинхронный вызов включает объект call, поэтому он включает еще несколько шагов.
ms.assetid: ab65d38d-836a-48d4-87c1-8812cbc8ff92
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 384a153b826e570920fca2a92f5b53ed2079c561cbcda899b793cef1f39473bf
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119755994"
---
# <a name="making-an-asynchronous-call"></a>Выполнение асинхронного вызова

Процедура выполнения синхронного вызова проста: клиент получает указатель интерфейса на серверный объект и вызывает методы через этот указатель. Асинхронный вызов включает объект call, поэтому он включает еще несколько шагов.

Для каждого метода в синхронном интерфейсе соответствующий асинхронный интерфейс реализует два метода. Эти методы присоединяют префиксы Begin \_ и Finish \_ к имени синхронного метода. Например, если интерфейс с именем Исимплестреам имеет метод Read, то интерфейс АсинЦисимплестреам будет иметь \_ метод Begin Read и готово \_ Read. Чтобы начать асинхронный вызов, клиент вызывает \_ метод Begin.

**Начало асинхронного вызова**

1.  Запросите объект сервера для интерфейса [**икаллфактори**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) . Если [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) возвращает E без \_ интерфейса, серверный объект не поддерживает асинхронный вызов.

2.  Вызовите метод [**икаллфактори:: креатекалл**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) , чтобы создать объект вызова, соответствующий нужному интерфейсу, а затем отпустите указатель на [**икаллфактори**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).

3.  Если вы не запрашивали указатель на асинхронный интерфейс из вызова [**креатекалл**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), запросите объект вызова для асинхронного интерфейса.

4.  Вызовите соответствующий \_ метод Begin.

Объект Server теперь обрабатывает асинхронный вызов, и клиент может выполнить другие действия, пока не потребуются результаты вызова.

Объект вызова может обрабатывать только один асинхронный вызов за раз. Если тот же или второй клиент вызывает \_ метод Begin до завершения ожидающего асинхронного вызова, \_ метод Begin ВОЗВРАТИТ \_ вызов RPC E \_ \_ в ожидании.

Если клиенту не нужны результаты \_ метода Begin, он может освободить объект вызова в конце этой процедуры. COM обнаруживает это условие и очищает вызов. Метод Finish \_ не вызывается, и клиент не получает никаких параметров out или возвращаемого значения.

Когда объект сервера готов к возврату из \_ метода Begin, он сигнализирует объекту вызова, что он выполнен. Когда клиент будет готов, он проверяет, сообщает ли объект вызова. Если это так, клиент может завершить асинхронный вызов.

Механизм для этой сигнализации и проверки между клиентом и сервером является интерфейсом [**исинчронизе**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) на объекте вызова. Объект Call обычно реализует этот интерфейс, выполнив статистическую обработку объекта синхронизации, предоставленного системой. Объект синхронизации служит оболочкой для дескриптора события, который сервер сообщает непосредственно перед возвратом из \_ метода Begin путем вызова [**исинчронизе:: Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).

**Завершение асинхронного вызова**

1.  Запросите объект вызова для интерфейса [**исинчронизе**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) .

2.  Вызовите [**исинчронизе:: wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).

3.  Если [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) возвращает RPC \_ E \_ timeout, метод Begin \_ не завершает обработку. Клиент может продолжить работу, а затем снова вызвать **Wait** . Он не может вызвать \_ метод Finish до  тех пор, пока не вернет значение S \_ ОК.

    Если [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) возвращает S \_ , то \_ возвращается метод Begin. Вызовите соответствующий \_ метод Finish.

Метод Finish \_ передает клиенту все параметры out. Поведение асинхронных методов, включая возвращаемое значение \_ метода Finish, должно точно совпадать с соответствующим синхронным методом.

Клиент может освободить объект вызова, как только будет \_ возвращен метод завершения, или же он может содержать указатель на объект вызова для выполнения дополнительных вызовов. В любом случае клиент несет ответственность за освобождение объекта Call, когда объект больше не нужен.

Если метод Finish вызывается \_ , когда вызов не выполняется, метод возвратит \_ вызов RPC E \_ \_ .

> [!Note]  
> Если клиентские и серверные объекты находятся в одном апартаменте, вызовы [**икаллфактори:: креатекалл**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) не гарантировано должным образом. Если объект сервера не поддерживает асинхронный вызов для определенного интерфейса, попытка создать объект вызова завершится ошибкой, и клиент должен использовать синхронный интерфейс.

 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Отмена асинхронного вызова](canceling-an-asynchronous-call.md)
</dt> <dt>

[Client Security во время асинхронного вызова](client-security-during-an-asynchronous-call.md)
</dt> <dt>

[Олицетворение и асинхронные вызовы](impersonation-and-asynchronous-calls.md)
</dt> </dl>

 

 