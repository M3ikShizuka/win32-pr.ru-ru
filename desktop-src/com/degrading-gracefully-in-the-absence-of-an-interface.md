---
title: Постепенное ухудшение в отсутствии интерфейса
description: Поскольку элемент управления может не поддерживать интерфейс, отличный от IUnknown, контейнер должен корректно понижаться, когда обнаруживает отсутствие какого-либо определенного интерфейса.
ms.assetid: 1b833900-2357-4b39-b88d-5ee6321f488e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fef1b329faa2d4da333cf2e201fc887764af96bc5ea2573060f41774b57c0d56
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119501282"
---
# <a name="degrading-gracefully-in-the-absence-of-an-interface"></a>Постепенное ухудшение в отсутствии интерфейса

Поскольку элемент управления может не поддерживать интерфейс, отличный от [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), контейнер должен корректно понижаться, когда обнаруживает отсутствие какого-либо определенного интерфейса.

Одним из них может быть вопрос о целесообразности элемента управления, не превышающем [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown). Но рассмотрите преимущества, которые элемент управления получает из среды визуального программирования контейнера (например, VB), когда контейнер распознает объект как элемент управления:

-   На панели элементов появится кнопка для объекта.
-   Можно создать объект, перетащив его с панели элементов на форму.
-   Можно присвоить объекту имя, которое распознается в среде визуального программирования.
-   То же имя в (3), приведенное выше, можно использовать сразу при написании любого другого кода для элементов управления в той же форме (или даже в другой форме).
-   Контейнер может автоматически предоставлять точки входа кода для всех событий, доступных из этого объекта.
-   Контейнер предоставляет собственный пользовательский интерфейс обзора свойств для всех доступных свойств.

Если объект не распознается как элемент управления, он потенциально теряет все эти очень эффективные и полезные функции интеграции. например, в Visual Basic 4,0 очень сложно интегрировать некоторый случайный объект, который не является элементом управления в полном смысле, но может по-прежнему иметь свойства и события. поскольку представление элемента управления в Visual Basic 4 является очень узким, объект не получает никаких функций интеграции, описанных выше. Но даже элемент управления с [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown), где всего времени существования элемента управления определяет существование некоторого ресурса, должен иметь возможность получить возможности интеграции, описанные выше.

Поскольку текущим средствам требуется большой набор интерфейсов управления для получения каких-либо преимуществ, элементы управления обычно привели к чрезмерной реализации, так что они содержат больше кода, чем действительно требуется. Элементы управления, которые могут быть 7K, могут оказаться 25K, что является серьезной проблемой производительности в таких областях, как Интернет. Это также привело к восприятию того, что одна из них может реализовать только элемент управления с одним средством, таким как CDK, из-за сложности реализации всех интерфейсов, и это имеет смысл, если для такого элемента управления требуется большая библиотека DLL, например OC30.DLL, что увеличивает рабочий набор. Если не все интерфейсы являются обязательными, то открывает множество разработчиков для написания очень мелких и легких элементов управления с помощью прямого OLE или других средств, уменьшая издержки для каждого элемента управления.

Именно поэтому в этом приложении элемент управления распознается как любой объект с идентификатором CLSID и интерфейсом [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) . Даже если бы ничего не было, контейнер с программной средой должен иметь возможность предоставить по крайней мере функции \# 3 и) в реестре, он получит \# 1 и \# 2. Если объект предоставляет [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) (и [**IProvideClassInfo**](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo) обычно) для некоторого набора событий, он получает \# 5, и если он поддерживает **IDispatch** для свойств и методов, он получает значение \# 6, а также улучшает интеграцию кода в контейнере.

Вкратце, объект должен иметь возможность реализовать как **IDispatch** и один набор событий, предоставляемый через [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) , чтобы получить все эти визуальные функции, описанные выше.

Учитывая это, в следующей таблице описывается, что может сделать контейнер при отсутствии какого-либо возможного интерфейса. Обратите внимание, что указаны только эти интерфейсы, которые контейнер будет напрямую получать через [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)). Другие интерфейсы, например [**метода IOleInPlaceActiveObject**](/windows/desktop/api/OleIdl/nn-oleidl-ioleinplaceactiveobject), получаются с помощью других средств.



| Интерфейс                                                                                                             | Значение отсутствия интерфейса                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2)<br/>                                                                       | Элемент управления не имеет визуальных элементов, для которых он будет нарисован, поэтому не имеет ограниченных экстентов. Во время выполнения контейнер просто не пытается рисовать что-либо, если этот интерфейс отсутствует. Во время разработки контейнер должен по крайней мере нарисовать некоторый тип прямоугольника по умолчанию с именем в нем для такого элемента управления, поэтому пользователь в среде визуального программирования может выбрать объект и извлечь его свойства, методы и события, которые существуют. Обработка отсутствия [**IViewObject2**](/windows/desktop/api/OleIdl/nn-oleidl-iviewobject2) крайне важна для поддержки хорошего визуального программирования.<br/> |
| [**иолеобжект**](/windows/desktop/api/OleIdl/nn-oleidl-ioleobject)<br/>                                                                           | Элементу управления не требуется никакой веб-узел, и он не участвует во встроенном согласовании макета объекта. Любые сведения (например, экстенты элементов управления), которые может ожидать контейнер от этого интерфейса, должны быть заполнены по умолчанию, предоставленные контейнером.<br/>                                                                                                                                                                                                                                                                                                       |
| [**иолеинплацеобжект**](/windows/desktop/api/OleIdl/nn-oleidl-ioleinplaceobject)<br/>                                                             | Элемент управления не переходит в активное место (например, метку) и поэтому никогда не пытается выполнить активацию таким образом. Единственной активацией может быть страница свойств.<br/>                                                                                                                                                                                                                                                                                                                                                                                                            |
| [**Метод интерфейса IOleControl**](/windows/desktop/api/OCIdl/nn-ocidl-iolecontrol)<br/>                                                                         | Элемент управления не имеет назначенных клавиш и не использует свойства окружения и не имеет значения, если контейнер игнорирует события. В отсутствие этого интерфейса контейнер просто не вызывает его методы.<br/>                                                                                                                                                                                                                                                                                                                                                                         |
| [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject)<br/>                                                                         | Элемент управления не предоставляет наборов свойств и визуальных элементов, которые могут быть кэшированы, поэтому в контейнере будет выбрано кэширование представления по умолчанию в отсутствие этого интерфейса (поддержка \_ МЕТАФИЛЕПИКТ CF) и отключены все связанные с набором свойств функции.<br/>                                                                                                                                                                                                                                                                            |
| **IDispatch**<br/>                                                                                              | Элемент управления не имеет пользовательских свойств или методов. В этом случае контейнеру не нужно попытаться отображать какие-либо свойства элемента управления. он должен запретить вызовы пользовательских методов, которые контейнер не распознает как принадлежащий его собственным расширенным элементам управления (которые могут поддерживать методы и свойства). Поскольку расширенные элементы управления, как правило, делегируют определенные вызовы **IDispatch** в элемент управления, расширенный элемент управления не должен ждать, пока элемент управления не будет иметь **IDispatch** .<br/>                                                                                          |
| [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer)<br/>                                             | Элемент управления не имеет событий, поэтому контейнеру не нужно думать об обработке.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [**IProvideClassInfo**](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo)<br/> [**IProvideClassInfo2**](/windows/desktop/api/OCIdl/nn-ocidl-iprovideclassinfo2)<br/> | Элемент управления либо не имеет сведений о типе, либо события, или контейнер должен попасть в сведения о типе элемента управления с помощью записей реестра элемента управления. Наличие этого интерфейса является оптимизацией.<br/>                                                                                                                                                                                                                                                                                                                                            |
| [**испеЦифипропертипажес**](/windows/desktop/api/OCIdl/nn-ocidl-ispecifypropertypages)<br/>                                                     | У элемента управления нет страниц свойств, поэтому, если контейнер содержит пользовательский интерфейс, который вызовет их, контейнер должен отключить этот пользовательский интерфейс.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [**иперпропертибровсинг**](/windows/desktop/api/OCIdl/nn-ocidl-iperpropertybrowsing)<br/>                                                       | Элемент управления не имеет отображаемого имени, не имеет предварительно заданной строки и значений и не имеет свойства для сопоставления страницы. Этот интерфейс почти всегда используется для создания пользовательского интерфейса контейнера, поэтому такие элементы пользовательского интерфейса будут отключены в отсутствие этого интерфейса.<br/>                                                                                                                                                                                                                                                                                                 |
| IPersist\*<br/>                                                                                                 | Элемент управления не имеет постоянного состояния, чтобы говорить, поэтому контейнеру не нужно беспокоиться о сохранении данных, относящихся к конкретному элементу управления. Конечно, контейнер будет сохранять свои собственные сведения об элементе управления в своей собственной форме или документе, но сам элемент управления не может участвовать в этой информации.<br/>                                                                                                                                                                                                                                                        |
| [**иолекаче**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache)<br/> [**IOleCache2**](/windows/desktop/api/OleIdl/nn-oleidl-iolecache2)<br/>                                 | Объект не поддерживает кэширование. Контейнер по-прежнему может поддерживать кэширование, просто создавая сам кэш данных с помощью [**креатедатакаче**](/windows/desktop/api/ObjBase/nf-objbase-createdatacache).<br/>                                                                                                                                                                                                                                                                                                                                                                                                    |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Контейнеры](containers.md)
</dt> </dl>

 

 





