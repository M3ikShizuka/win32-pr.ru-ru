---
title: Определение COM-интерфейсов
description: Корпорация Майкрософт определяет множество COM-интерфейсов. В большинстве случаев эти универсальные интерфейсы можно использовать повторно. Однако некоторые приложения имеют особые требования, которые делают его желательным или необходимым для определения собственных интерфейсов объектов.
ms.assetid: 8a94bd7d-d101-411c-97de-9e9a46bf9591
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 516c02a2c337b2c76229094b0e42d75b44f65d16
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127461212"
---
# <a name="defining-com-interfaces"></a>Определение COM-интерфейсов

Корпорация Майкрософт определяет множество COM-интерфейсов. В большинстве случаев эти универсальные интерфейсы можно использовать повторно. Однако некоторые приложения имеют особые требования, которые делают его желательным или необходимым для определения собственных интерфейсов объектов.

Все COM-интерфейсы должны быть прямо или косвенно производными от интерфейса [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) . В рамках этого ограничения пользовательский интерфейс может поддерживать почти любой метод или параметр, включая асинхронные методы. Можно также создать библиотеку типов для пользовательских интерфейсов, чтобы клиенты могли получать доступ к информации о методах объекта во время выполнения. После определения интерфейса опишите его в язык MIDL (MIDL), скомпилируйте и зарегистрируйте его, используйте его так же, как любой универсальный интерфейс. При использовании распределенной модели COM методы интерфейса доступны как для удаленных процессов, так и для других процессов на том же компьютере.

Наконец, для создания COM-интерфейсов требуется среда разработки, которая включает компилятор C/C++ и компилятор Midl.exe.

Ниже приведены действия по созданию COM-интерфейса.

-   Решите, как будет обеспечиваться поддержка маршалирования для интерфейса. с управляемой библиотекой типов, а также с помощью прокси-библиотеки или DLL-заглушки. Даже находящиеся в процессе интерфейсы должны быть упакованы, если они должны использоваться в границах апартамента. Рекомендуется создавать поддержку упаковки в каждый COM-интерфейс, даже если вы не считаете, что это потребуется. Дополнительные сведения см. в разделе [маршалирование интерфейса](interface-marshaling.md) .
-   Опишите интерфейс или интерфейсы в файле определения интерфейса (IDL). Кроме того, можно указать определенные локальные аспекты интерфейса в файле конфигурации приложения (ACF). Если используется управляемая библиотекой типов, то добавьте инструкцию [**Library**](/windows/desktop/Midl/library) , которая ссылается на интерфейсы, для которых нужно создать сведения о типе.
-   Используйте компилятор MIDL, чтобы создать файл библиотеки типов и файл заголовка, а также прокси-сервер языка C или файлы заглушки, файл идентификатора интерфейса, файл данных DLL и файл заголовка. Дополнительные сведения см. в разделе [Компиляция MIDL](midl-compilation.md) .
-   В зависимости от выбранного метода маршалирования напишите файл определения модуля (DEF), скомпилируйте и свяжите все файлы, созданные MIDL, с одной прокси-БИБЛИОТЕКой и зарегистрируйте интерфейс в системном реестре или зарегистрируйте библиотеку типов. Дополнительные сведения см. в статьях [Загрузка и регистрация библиотеки типов](loading-and-registering-a-type-library.md) и [Сборка и регистрация библиотеки DLL прокси-сервера](building-and-registering-a-proxy-dll.md) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Анатомия IDL-файла](anatomy-of-an-idl-file.md)
</dt> <dt>

[COM-клиенты и серверы](com-clients-and-servers.md)
</dt> <dt>

[Правила проектирования интерфейсов](interface-design-rules.md)
</dt> <dt>

[Модель COM](the-component-object-model.md)
</dt> </dl>

 

 