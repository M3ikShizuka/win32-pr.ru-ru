---
title: Архитектура подключаемых объектов
description: Архитектура подключаемых объектов
ms.assetid: 69949a3b-3ab8-4054-84d8-9256fbf39c7b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1215b013c3db751e90b07ed21d5f897ef0332000ce2cd2b3b167cbe86798927
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119993963"
---
# <a name="architecture-of-connectable-objects"></a>Архитектура подключаемых объектов

Подключаемый объект — это только один элемент общей архитектуры подключаемых объектов. Эта технология включает следующие элементы:

-   **Подключаемый объект.** Реализует интерфейс [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) ; создает по крайней мере один объект точки подключения; Определяет исходящий интерфейс для клиента.
-   **Компьютера.** Запрашивает объект для [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) , чтобы определить, является ли объект подсоединенным; Создает объект приемника для реализации исходящего интерфейса, определенного объектом, который можно подключить.
-   **Объект приемника.** Реализует исходящий интерфейс; используется для установления соединения с объектом, который можно подключить.
-   **Объект точки подключения.** Реализует интерфейс [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) и управляет подключением к приемнику клиента.

Отношения между клиентом, подключаемым объектом, точкой подключения и приемником показаны на следующей схеме:

![Схема, на которой показаны точки соединения между клиентом и подключенным объектом.](images/1cd44fec-5d2c-4427-846b-ccab7ec0b08a.png)

Перед тем как объект точки подключения вызывает методы в интерфейсе приемника на шаге 3 на предыдущей схеме, он должен иметь значение [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) для конкретного интерфейса, даже если указатель уже был передан в шаге 2 вызова метода [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) .

В этой архитектуре также участвуют два объекта перечислителя, но не показаны на рисунке. Один из них создается методом в [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) для перечисления точек соединения в объекте, доступном для соединения. Другой объект создается методом [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) для перечисления соединений, установленных в данный момент с этой точкой соединения. Одна точка соединения может поддерживать несколько подключенных интерфейсов приемников, и она должна выполнять итерацию по списку подключений каждый раз, когда он вызывает метод для этого интерфейса. Этот процесс называется многоадресным.

При работе с подключаемыми объектами важно понимать, что подключаемый объект, каждая точка подключения, каждый приемник и все перечислители являются отдельными объектами с отдельными реализациями [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) , отдельными счетчиками ссылок и отдельными жизненными циклами. Клиент, использующий эти объекты, всегда отвечает за освобождение всех счетчиков ссылок, которыми он владеет.

> [!Note]  
> Объект, который можно подключить, поддерживает несколько клиентов и может поддерживать несколько приемников в пределах одного клиента. Аналогичным образом приемник может быть подключен к более чем одному подключаемому объекту.

 

Ниже приведены действия по установлению соединения между клиентом и подключаемым объектом.

1.  Клиент запрашивает [**IConnectionPointContainer**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpointcontainer) для объекта, чтобы определить, является ли объект подсоединенным. Если этот вызов выполнен успешно, клиент содержит указатель на интерфейс **IConnectionPointContainer** в доступном для соединения объекте, а счетчик ссылки на объект, который можно подключить, был увеличен. В противном случае объект не подключается и не поддерживает исходящие интерфейсы.
2.  Если объект является подсоединенным, клиент затем пытается получить указатель на интерфейс [**IConnectionPoint**](/windows/desktop/api/OCIdl/nn-ocidl-iconnectionpoint) в точке соединения в объекте, доступном для соединения. Существует два метода получения этого указателя — в [**IConnectionPointContainer:: финдконнектионпоинт**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-findconnectionpoint) и в [**IConnectionPointContainer:: енумконнектионпоинтс**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpointcontainer-enumconnectionpoints). Если используется **енумконнектионпоинтс** , необходимо выполнить несколько дополнительных действий. (Дополнительные сведения см. [в разделе Использование IConnectionPointContainer](using-iconnectionpointcontainer.md) .) В случае успеха подключаемый объект и клиент поддерживают один и тот же исходящий интерфейс. Подключаемый объект определяет его и вызывает его, и клиент реализует его. Затем клиент может взаимодействовать через точку подключения в объекте, доступном для подключения.
3.  Затем клиент вызывает в точке подключения предложение [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) , чтобы установить соединение между интерфейсом приемника и точкой соединения объекта. После этого вызова точка соединения объекта содержит указатель на исходящий интерфейс в приемнике.
4.  Код внутри метода [**advise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-advise) вызывает [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) в переданном переданном указателе интерфейса и запрашивает конкретный идентификатор интерфейса, к которому он подключается.
5.  Объект вызывает методы в интерфейсе приемника по мере необходимости, используя указатель, удерживаемый его точкой соединения.
6.  Клиент вызывает [**unadvise**](/windows/desktop/api/OCIdl/nf-ocidl-iconnectionpoint-unadvise) для завершения подключения. Затем клиент вызывает метод **IConnectionPoint:: Release** , чтобы освободить место на точке подключения, и, следовательно, главный объект, который можно подключить. Клиент должен также вызвать метод **IConnectionPointContainer:: Release** , чтобы освободить его на основном подключаемом объекте.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Подключаемые интерфейсы объектов](connectable-object-interfaces.md)
</dt> </dl>

 

 




