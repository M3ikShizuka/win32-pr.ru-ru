---
title: Библиотека COM
description: Библиотека COM
ms.assetid: 51d4db4a-ad88-4627-8140-2f7906945752
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a285a89ca659907c37f92b7d00f3e3e04d0acf51
ms.sourcegitcommit: 307b14e9847ced354a52a1ac12d7f659722d99bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "103987257"
---
# <a name="the-com-library"></a>Библиотека COM

Любой процесс, использующий COM, должен инициализировать и деинициализировать библиотеку COM. Помимо спецификации, COM также реализует некоторые важные службы в этой библиотеке. Библиотека COM, предоставляемая в качестве набора библиотек DLL и exe (в основном Ole32.dll и Rpcss.exe) в Microsoft Windows, включает в себя следующее:

-   Небольшое количество фундаментальных функций, упрощающих создание приложений COM, как клиента, так и сервера. Для клиентов COM предоставляет базовые функции для создания объектов. Для серверов COM предоставляет средства предоставления своих объектов.

-   Службы локатора, с помощью которых определяется COM, от уникального идентификатора класса (CLSID), на котором сервер реализует этот класс и где расположен этот сервер. Эта служба включает поддержку уровня косвенного обращения, обычно системного реестра, между удостоверением класса объекта и упаковкой реализации, чтобы клиенты не зависели от упаковки, что может измениться в будущем.

-   Прозрачные удаленные вызовы процедур, когда объект выполняется на локальном или удаленном сервере.

-   Стандартный механизм, позволяющий приложению управлять распределением памяти внутри процесса, в частности, память, которая должна передаваться между соработаными объектами, чтобы ее можно было освободить правильно.

Для использования базовых служб COM все COM-потоки выполнения на клиентах и серверах вне обработки должны вызывать функцию [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) или [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) перед вызовом любой другой функции COM, за исключением вызовов выделения памяти. **CoInitializeEx** заменяет другую функцию, добавляя параметр, который позволяет указать потоковую модель потока: потоковое или беспотокное. Вызов функции **CoInitialize** просто устанавливает потоковую модель в потоковое подразделение.

Приложения составного документа OLE вызывают функцию [**олеинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize) , которая вызывает [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex) , а также выполняет некоторую инициализацию, необходимую для составных документов. Таким образом, потоки, вызывающие **олеинитиализе** , не могут быть свободными потоками. Сведения о потоках в клиентах и серверах см. в разделе [процессы, потоки и подразделения](processes--threads--and-apartments.md).

Внутрипроцессный сервер не вызывает функции инициализации, так как они загружаются в процесс, который уже сделал это. В результате внутрипроцессный серверы должны задать свою потоковую модель в реестре в разделе [InprocServer32](inprocserver32.md) Key. Подробные сведения о проблемах с потоками в внутрипроцессного серверах см. в разделе [проблемы потоковой обработки на сервере](in-process-server-threading-issues.md).

Также важно отменить инициализацию библиотеки. Для каждого вызова [**CoInitialize**](/windows/desktop/api/Objbase/nf-objbase-coinitialize) или [**CoInitializeEx**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializeex)должен быть соответствующий вызов [**CoUninitialize**](/windows/desktop/api/combaseapi/nf-combaseapi-couninitialize). Для каждого вызова [**олеинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleinitialize)должен быть соответствующий вызов [**олеунинитиализе**](/windows/desktop/api/Ole2/nf-ole2-oleuninitialize).

Внутрипроцессный сервер может предположить, что процесс, в который они загружаются, уже выполнил эти действия.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Модель COM](the-component-object-model.md)
</dt> </dl>

 

 




