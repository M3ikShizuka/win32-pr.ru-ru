---
title: Реализация и активация обработчика без дополнительных данных сервера
description: Реализация и активация обработчика без дополнительных данных сервера
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 81df2bcaf1b50a0727127c4008d9763b76e05e4f2a5d80bf4b282bbbe02e5bb5
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120070871"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a>Реализация и активация обработчика без дополнительных данных сервера

Чтобы создать экземпляр обработчика, если он не получает лишних данных сервера, сервер должен реализовать [**истдмаршалинфо**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) , но не [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal). **Истдмаршалинфо** имеет один метод [**жетклассфорхандлер**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), который извлекает идентификатор CLSID обработчика объекта, который будет использоваться в процессе назначения. COM вызывает это, когда вызывает [**комаршалинтерфаце**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) и активирует обработчик на стороне клиента.

Затем обе реализации сервера и обработчика должны вызывать функцию [**кожетстдмаршалекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) . Эта функция создает стандартный модуль упаковки на каждой стороне (который называется диспетчером прокси-сервера на стороне клиента и диспетчером заглушек на стороне сервера).

Сервер вызывает [**кожетстдмаршалекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), передавая серверу флаг смексф \_ . Это приведет к созданию стандартного модуля упаковки (диспетчера заглушек) на стороне сервера. Структура на стороне сервера показана на следующем рисунке:

![Схема, на которой показана структура на стороне сервера.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a>Структура Server-Side

Обработчик вызывает [**кожетстдмаршалекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), передавая обработчику флага смексф \_ . Это создает клиентский модуль упаковки (прокси-диспетчер) на стороне клиента и объединяет его с обработчиком на стороне клиента. Время существования обоих объектов управляется управляющим объектом Identity (реализующим [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)), который реализуется системой, когда обработчик вызывает **кожетстдмаршалекс**. Структура на стороне клиента показана на следующем рисунке.

![Схема, на которой показана структура на стороне клиента.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a>Структура Client-Side

Как показано на предыдущем рисунке, обработчик на самом деле Южны между диспетчером прокси-сервера и идентификатором и контролем неизвестных данных. Это дает системному элементу управления время существования объекта при предоставлении управления обработчиком для предоставляемых интерфейсов. Пунктирная линия между диспетчером удостоверений и прокси-сервера указывает на то, что две тесные интеграции через внутренние частные интерфейсы.

Когда COM вызывает [**каунмаршалинтерфаце**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) для клиента, он создает экземпляр обработчика и выполняет его статистическую обработку с удостоверением. Обработчик создаст стандартный модуль упаковки (через вызов [**кожетстдмаршалекс**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), передав ему неизвестный при создании элемент управления.) Обработчик не реализует [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , но просто возвращает **IMarshal** из стандартного модуля упаковки. Даже если обработчик реализует **IMarshal**, он не будет вызываться во время распаковки.

Если два потока одновременно демаршалируются один и тот же объект в первый раз, можно временно создать два обработчика. Затем один из них будет освобожден.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Упрощенный обработчик Client-Side](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 