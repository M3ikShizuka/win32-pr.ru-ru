---
title: Метод Change класса Win32_Service (Мбнапи. h) (Терминалсервице)
description: Изменяет \_ Терминалсервице Win32.
ms.assetid: 19E43A80-47C9-4C5A-8E73-723F206AA7C0
ms.tgt_platform: multiple
keywords:
- службы удаленных рабочих столов метода изменения
- Службы удаленных рабочих столов метода изменения, класс Win32_Service
- Класс Win32_Service службы удаленных рабочих столов, метод Change
topic_type:
- apiref
api_name:
- Win32_Service.Change
api_location:
- TSCfgWmi.dll
api_type:
- COM
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: c10e8c7b0a26ce2ca1e602478a64a888a1ad6b299f8ab7965303832bba7a3fc3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118604436"
---
# <a name="change-method-of-the-win32_service-class-mbnapih---terminalservice"></a>Метод Change класса Win32_Service (Мбнапи. h) — Терминалсервице

Метод  [класса WMI](/windows/desktop/WmiSdk/retrieving-a-class) Change изменяет [**\_ терминалсервице Win32**](win32-terminalservice.md).

В этом разделе используется синтаксис MOF-файл (MOF). Дополнительные сведения об использовании этого метода см. [в разделе вызов метода](/windows/desktop/WmiSdk/calling-a-method).

## <a name="syntax"></a>Синтаксис


```mof
uint32 Change(
  [in] string  DisplayName,
  [in] string  PathName,
  [in] uint32  ServiceType,
  [in] uint32  ErrorControl,
  [in] string  StartMode,
  [in] boolean DesktopInteract,
  [in] string  StartName,
  [in] string  StartPassword,
  [in] string  LoadOrderGroup,
  [in] string  LoadOrderGroupDependencies,
  [in] string  ServiceDependencies
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*DisplayName* \[ окне\]
</dt> <dd>

Отображаемое имя для службы. Максимальная длина этой строки равна 256 символам. В диспетчере управления службами имя сохраняется с учетом регистра. В сравнениях *DisplayName* всегда учитывается регистр.

Ограничения: принимает то же значение, что и свойство **Name** .

Например, "Атдиск".

</dd> <dt>

*Путь к файлу* \[ окне\]
</dt> <dd>

Полный путь к исполняемому файлу, реализующему службу, например " \\ СистемныйКорневойКаталог \\ system32 \\ Drivers \\afd.sys".

</dd> <dt>

*ServiceType* \[ окне\]
</dt> <dd>

Тип служб, предоставляемых процессам, которые их вызывают.

<dt>

1 (0x1)
</dt> <dd>

Драйвер ядра

</dd> <dt>

2 (0x2)
</dt> <dd>

Драйвер файловой системы

</dd> <dt>

4 (0x4)
</dt> <dd>

Адаптер

</dd> <dt>

8 (0x8)
</dt> <dd>

Драйвер распознавателя

</dd> <dt>

16 (0x10)
</dt> <dd>

Собственный процесс

</dd> <dt>

32 (0x20)
</dt> <dd>

Общий процесс

</dd> <dt>

256 (0x100)
</dt> <dd>

Интерактивный процесс

</dd> </dl> </dd> <dt>

*ErrorControl* \[ окне\]
</dt> <dd>

Серьезность ошибки, если не удается запустить службу во время запуска. Значение указывает действие, предпринимаемое программой запуска, если происходит сбой. Все ошибки регистрируются системой.

<dt>

0
</dt> <dd>

**Пропуск**. Запуск продолжится. Пользователю не удалось получить уведомление о сбое службы.

</dd> <dt>

1
</dt> <dd>

**Обычно.** Запуск продолжится. Перед входом пользователя в систему пользователь получает уведомление "не удалось выполнить по крайней мере одну службу или устройство во время запуска".

</dd> <dt>

2
</dt> <dd>

**Серьезные.** Компьютер пытается перезапуститься с последней удачной конфигурацией. Если служба снова завершается со сбоем, запуск продолжится и пользователю будет предоставлено уведомление.

</dd> <dt>

3
</dt> <dd>

**Критическое.** Компьютер пытается перезапуститься с последней удачной конфигурацией. Если служба снова завершается со сбоем, запуск останавливается.

</dd> </dl> </dd> <dt>

*StartMode* \[ окне\]
</dt> <dd>

режим запуска базовой службы Windows. Дополнительные сведения см. в разделе "Замечания".

<dt>

<span id="Boot"></span><span id="boot"></span><span id="BOOT"></span>

<span id="Boot"></span><span id="boot"></span><span id="BOOT"></span>**Файле**


</dt> <dd>

Драйвер устройства запущен загрузчиком операционной системы.

</dd> <dt>

<span id="System"></span><span id="system"></span><span id="SYSTEM"></span>

<span id="System"></span><span id="system"></span><span id="SYSTEM"></span>**Системой**


</dt> <dd>

Драйвер устройства запущен процессом инициализации операционной системы. Это значение допустимо только для служб драйверов.

</dd> <dt>

<span id="Automatic"></span><span id="automatic"></span><span id="AUTOMATIC"></span>

<span id="Automatic"></span><span id="automatic"></span><span id="AUTOMATIC"></span>**Автоматически**


</dt> <dd>

Служба запускается автоматически диспетчером управления службами во время запуска системы. Службы автозапуска запускаются до входа пользователя в систему и запуска, даже если пользователь не входит в систему.

</dd> <dt>

<span id="Manual"></span><span id="manual"></span><span id="MANUAL"></span>

<span id="Manual"></span><span id="manual"></span><span id="MANUAL"></span>**Вручную**


</dt> <dd>

Служба, запускаемая диспетчером управления службами, когда процесс вызывает метод [**StartService**](win32-terminalservice-startservice.md) . Хотя ручные службы должны быть специально запущены пользователем (или сценарием), они продолжают работать, даже если пользователь выходит из системы. Ручные службы часто называются службами по требованию.

</dd> <dt>

<span id="Disabled"></span><span id="disabled"></span><span id="DISABLED"></span>

<span id="Disabled"></span><span id="disabled"></span><span id="DISABLED"></span>**Доступ**


</dt> <dd>

Служба, которая больше не может быть запущена. Чтобы запустить отключенную службу, необходимо сначала изменить параметр запуска на Auto или Manual.

</dd> </dl> </dd> <dt>

*Десктопинтеракт* \[ окне\]
</dt> <dd>

Если **значение — true**, служба может создавать окно на рабочем столе или взаимодействовать с ним.

</dd> <dt>

*StartName* \[ окне\]
</dt> <dd>

Имя учетной записи, в которой выполняется служба. В зависимости от типа службы имя учетной записи может быть в формате имя_домена \\ имя пользователя или. \\ Имен. Процесс службы будет заноситься в журнал с использованием одной из этих двух форм при запуске. Если учетная запись принадлежит к встроенному домену,. \\ Можно указать имя пользователя. Если указано **значение NULL** , служба будет входить в систему как учетная запись LocalSystem. Для драйверов ядра или системного уровня *StartName* содержит имя объекта драйвера (то есть \\ FileSystem \\ RDR или \\ Driver \\ КСНС), которое используется системой ввода и вывода для загрузки драйвера устройства. Если указано **значение NULL** , драйвер запускается с именем объекта по умолчанию, созданным системой ввода-вывода на основе имени службы, например "двдом \\ Admin".

Можно также использовать формат имени участника-пользователя (UPN) для указания **StartName**, например *Username@DomainName* .

</dd> <dt>

*Стартпассворд* \[ окне\]
</dt> <dd>

Пароль к имени учетной записи, заданному параметром *StartName* . Если пароль не изменяется, укажите **значение NULL** . Если служба не имеет пароля, указывается пустая строка.

> [!Note]  
> При изменении службы с локальной системы на сеть или из сети в локальную систему *стартпассворд* должен быть пустой строкой (""), а не **null**.

 

</dd> <dt>

*Лоадордерграуп* \[ окне\]
</dt> <dd>

Имя группы, с которой она связана. Группы порядка загрузки содержатся в системном реестре и определяют последовательность, в которой службы загружаются в операционную систему. Если указатель равен **null** или указывает на пустую строку, служба не принадлежит группе. Дополнительные сведения см. в разделе "Замечания".

Зависимости между группами должны быть перечислены в параметре *лоадордерграупдепенденЦиес* . Сначала запускаются службы в списке группы упорядочения нагрузки, а затем — службы в группах, которые не входят в список групп порядка загрузки, за которыми следуют службы, не входящие в группу. Системный реестр содержит список групп упорядочения нагрузки, расположенных по адресу:

**HKey \_ \_** \\  \\  \\  \\ **ServiceGroupOrder** управления CurrentControlSet системы локального компьютера

</dd> <dt>

*ЛоадордерграупдепенденЦиес* \[ окне\]
</dt> <dd>

Список групп упорядочивания нагрузки, которые должны быть запущены перед запуском этой службы. Массив завершается двойным **нулем.** Если указатель имеет **значение NULL** или указывает на пустую строку, служба не имеет зависимостей. Имена групп должны быть префиксом **\_ \_ идентификатора группы SC** (определенного в файле винсвк. h), чтобы отличать их от имен служб, так как службы и группы служб используют одно и то же пространство имен. Зависимость от группы означает, что эту службу можно запустить, если хотя бы один член группы запущен после попытки запуска всех членов группы.

</dd> <dt>

*СервицедепенденЦиес* \[ окне\]
</dt> <dd>

Список, содержащий имена служб, которые должны быть запущены перед запуском этой службы. Массив завершается двойным **нулем.** Если указатель имеет **значение NULL** или указывает на пустую строку, служба не имеет зависимостей. Зависимость от службы указывает, что эта служба может выполняться, только если запущена служба, от которой она зависит.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Возвращает одно из значений, перечисленных в следующем списке, или любое другое значение, указывающее на ошибку. Дополнительные коды ошибок см. в разделе [**константы WMI Error**](/windows/desktop/WmiSdk/wmi-error-constants) или [**вбемерроренум**](/windows/desktop/api/wbemdisp/ne-wbemdisp-wbemerrorenum). Общие значения **HRESULT** см. в разделе [коды системных ошибок](/windows/desktop/Debug/system-error-codes).

<dl> <dt>

**0**
</dt> <dd>

Запрос принят.

</dd> <dt>

**1**
</dt> <dd>

Запрос не поддерживается.

</dd> <dt>

**2**
</dt> <dd>

У пользователя нет необходимых прав доступа.

</dd> <dt>

**3**
</dt> <dd>

Службу нельзя остановить, так как от нее зависят другие работающие службы.

</dd> <dt>

**4**
</dt> <dd>

Запрошенный управляющий код недопустим или неприемлем для данной службы.

</dd> <dt>

**5**
</dt> <dd>

Запрошенный управляющий код не может быть отправлен в службу, так как это состояние службы ([**Win32 \_ басесервице**](/windows/desktop/CIMWin32Prov/win32-baseservice).**Свойство State** ) равно 0, 1 или 2.

</dd> <dt>

**6**
</dt> <dd>

Служба не запущена.

</dd> <dt>

**7**
</dt> <dd>

Служба не ответила на запрос запуска за отведенное время.

</dd> <dt>

**8**
</dt> <dd>

Неизвестный сбой при запуске службы.

</dd> <dt>

**9**
</dt> <dd>

Не найден путь к каталогу исполняемого файла службы.

</dd> <dt>

**10**
</dt> <dd>

Служба уже запущена.

</dd> <dt>

**11**
</dt> <dd>

База данных для добавления новой службы заблокирована.

</dd> <dt>

**12**
</dt> <dd>

Зависимость, от которой зависит эта служба, удалена из системы.

</dd> <dt>

**13**
</dt> <dd>

Этой службе не удалось найти службу, которая необходима зависимой службе.

</dd> <dt>

**14**
</dt> <dd>

Эта служба была отключена в системе.

</dd> <dt>

**15**
</dt> <dd>

Эта служба не поддерживает проверку подлинности, необходимую для работы в системе.

</dd> <dt>

**16**
</dt> <dd>

Эта служба удаляется из системы.

</dd> <dt>

**17**
</dt> <dd>

Служба не имеет потока выполнения.

</dd> <dt>

**стр**
</dt> <dd>

Служба имеет циклические зависимости при запуске.

</dd> <dt>

**19**
</dt> <dd>

Служба выполняется с тем же именем.

</dd> <dt>

**20**
</dt> <dd>

Имя службы содержит недопустимые символы.

</dd> <dt>

**открыт**
</dt> <dd>

Службе переданы недопустимые параметры.

</dd> <dt>

**22**
</dt> <dd>

Учетная запись, под которой работает эта служба, либо недопустима, либо не имеет разрешений на запуск службы.

</dd> <dt>

**23**
</dt> <dd>

Служба существует в базе данных доступных в системе служб.

</dd> <dt>

**24**
</dt> <dd>

Служба в данный момент приостановлена в системе.

</dd> </dl>

## <a name="remarks"></a>Remarks

При запуске компьютера также запускаются все службы автозапуска. Иногда одна из этих служб может не запускаться вместе с компьютером. При сбое службы во время запуска системы компьютер принимает действия в соответствии со значением управляющего кода ошибки службы.

Большинство служб устанавливаются с помощью обычного управляющего кода ошибок. Некоторые исключения, которые устанавливаются с помощью команды игнорировать код ошибки, включают:

-   Служба репликации файлов
-   Смарт-карта
-   Вторичный вход в систему
-   WMI

Для служб, установленных с помощью команды игнорировать код ошибки, пользователю не выдается уведомление о том, что служба завершилась ошибкой. Если вы предпочитаете на экране уведомление о том, что не удалось запустить службу, можно использовать инструментарий WMI для изменения управляющего кода ошибки. Коды управления ошибками применяются только к загрузке компьютера; управляющие коды ошибок не используются, если вы останавливаете и попытаетесь перезапустить службу после запуска компьютера.

Иногда может потребоваться изменить учетную запись, под которой работает данная служба. Например, служба может запускаться под административной учетной записью. Поскольку это может привести к уязвимости системы безопасности, можно переключить службу на учетную запись с меньшим числом привилегий. Кроме того, могут быть запущены службы с учетной записью, которая будет удалена, или необходимо убедиться, что на всех серверах некоторые службы выполняются под определенными учетными записями. Можно использовать метод **Change** класса [**Win32 \_ терминалсервице**](win32-terminalservice.md) , чтобы настроить службы для работы с указанной учетной записью пользователя. При выборе учетной записи учитывайте следующее.

-   Учетная запись, используемая в качестве учетной записи службы, должна иметь право на вход в качестве службы. Это право можно предоставить с помощью групповая политика.
-   Учетная запись, используемая как учетная запись службы, не должна быть членом локальной группы администраторов, домена или администратора предприятия.
-   Каждый экземпляр службы должен работать под уникальной учетной записью пользователя. Это обеспечивает дополнительную безопасность и включает аудит отдельных экземпляров службы.
-   Если служба является интерактивной, она должна работать под учетной записью LocalSystem.

    LocalSystem является обязательным, так как только одна Windows-станция (WinSta0) может быть видимой и интерактивной в каждый момент времени. Если служба выполняется под учетной записью, отличной от LocalSystem, она выполняется в окне Service-0x03e7 $ \\ Default Windows Station, которое является невидимым окном. Службы, работающие на этой экранной станции, не могут принимать входные данные и отображать выходные данные.

При назначении учетной записи службе SCM требует для этой учетной записи правильный пароль, прежде чем приступать к назначению. При указании неверного пароля SCM отклоняет учетную запись. Если вы настраиваете учетную запись службы с помощью учетной записи LocalSystem, LocalService или NetworkService, вам не нужно указывать пароль учетной записи, так как у этих учетных записей нет паролей.

SCM хранит пароль учетной записи в базе данных служб. Однако после назначения пароля SCM не гарантирует, что пароль, хранящийся в базе данных служб, и пароль, назначенный учетной записи пользователя в Active Directory, будут по-прежнему совпадать. Следовательно, может произойти ситуация, подобная следующей:

-   . Служба настраивается для запуска от имени определенной учетной записи пользователя.
-   Служба запускается под этой учетной записью с использованием пароля текущей учетной записи.
-   Вы изменяете пароль для учетной записи пользователя.
-   Служба продолжит работу. Однако если служба остановлена, ее нельзя перезапустить, так как SCM продолжит использовать старый, недопустимый пароль. Изменение пароля в Active Directory не приводит к изменению пароля, хранящегося в базе данных служб.

При запуске служб с обычными учетными записями пользователей необходимо обновлять эти пароли служб при каждом изменении пароля учетной записи пользователя. Это может быть особенно трудоемким, если вы не уверены, какие службы выполняются под этой учетной записью или на каких компьютерах выполняются службы с этой учетной записью. К счастью, вы можете использовать инструментарий WMI для проверки учетных записей служб на всех компьютерах и при необходимости изменить пароль учетной записи службы.

Параметр [**Win32 \_ лоадордерграуп**](/windows/desktop/CIMWin32Prov/win32-loadordergroup) представляет группу системных служб, определяющих зависимости выполнения. Службы должны запускаться в порядке, указанном в группе порядок загрузки, так как службы зависят друг от друга. Для правильной работы этих зависимых служб требуется наличие предшествующих служб.

Чтобы изменить службу с сетевой службы на локальную систему, параметры *StartName* и *стартпассворд* должны иметь следующие значения:


```C++
StartName = "LocalSystem"
StartPassword = "" // - empty string, not NULL
```



Чтобы изменить службу с локальной системной службы на сеть, параметры *StartName* и *стартпассворд* должны иметь следующие значения:


```C++
StartName = "NT AUTHORITY\NetworkService"
StartPassword = "" // - empty string, not NULL
```



## <a name="examples"></a>Примеры

Следующая команда VBScript изменяет учетную запись службы для служб, выполняемых от имени указанной учетной записи пользователя, на LocalSystem.


```VB
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
 & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
Set colServiceList = objWMIService.ExecQuery _
 ("SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'")
For Each objService in colServices
 errServiceChange = objService.Change _
 ( , , , , , , ".\LocalSystem" , "")
Next
```



Следующая команда VBScript изменяет пароль учетной записи службы для всех сценариев, выполняемых в Нетсвк


```VB
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
 & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
Set colServiceList = objWMIService.ExecQuery _
 ("SELECT * FROM Win32_Service WHERE StartName = '.\\NetSvc'")
For Each objservice in colServiceList
 errReturn = objService.Change( , , , , , , , "password")
Next
```



## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Пространство имен<br/>                | Корневой \\ CIMv2 \\ терминалсервицес<br/>                                                |
| Header<br/>                   | <dl> <dt>Мбнапи. h</dt> </dl>     |
| MOF<br/>                      | <dl> <dt>Тскфгвми. mof</dt> </dl> |
| DLL<br/>                      | <dl> <dt>TSCfgWmi.dll</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**\_Служба Win32**](/windows/desktop/CIMWin32Prov/win32-service)
</dt> <dt>

[Классы операционной системы](/windows/desktop/CIMWin32Prov/operating-system-classes)
</dt> <dt>

[**\_Терминалсервице Win32**](win32-terminalservice.md)
</dt> <dt>

[Задачи WMI: службы](/windows/desktop/WmiSdk/wmi-tasks--services)
</dt> </dl>

 

