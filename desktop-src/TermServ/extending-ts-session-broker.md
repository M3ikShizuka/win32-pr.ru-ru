---
title: Расширение посредника сеансов служб терминалов
description: Можно расширить TS \ 160; Посредник сеансов с помощью COM-интерфейса Ивтссбплугин.
ms.assetid: f111d6e6-90ca-4eff-ab0e-02de25f7d6ad
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b84471bcf2125017b8eef273cdb78e61a9bc620
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103793117"
---
# <a name="extending-terminal-services-session-broker"></a>Расширение посредника сеансов служб терминалов

Посредник сеансов служб терминалов определяет, уже открыт ли сеанс для пользователя, инициирующего подключение. В этом случае посредник сеансов служб терминалов направляет входящее подключение к серверу узла сеансов удаленный рабочий стол (на узле сеанса удаленных рабочих столов) с помощью существующего сеанса. В противном случае посредник сеансов служб терминалов направляет входящее подключение к серверу узла сеансов удаленных рабочих столов с наименьшим числом сеансов.

Посредник сеансов служб терминалов можно расширить с помощью COM-интерфейса [**ивтссбплугин**](/windows/desktop/api/Tssbx/nn-tssbx-iwtssbplugin) . Этот интерфейс можно использовать для управления подключениями к серверам узла сеансов удаленных рабочих столов, а также подключения любого типа протокол удаленного рабочего стола (RDP), например, подключения к гостевым виртуальным машинам, на которых работает Windows Vista Enterprise (VECD), на узле виртуальных машин Hyper-V Windows Server 2008.

Интерфейс [**ивтссбплугин**](/windows/desktop/api/Tssbx/nn-tssbx-iwtssbplugin) предоставляет несколько преимуществ:

-   Нет необходимости устанавливать агент на клиент или сервер узла сеансов удаленных рабочих столов.
-   Подключаемый модуль может без проблем взаимодействовать с другими службами ролей службы удаленных рабочих столов, такими как удаленный рабочий стол шлюз (шлюз удаленных рабочих столов), и полагаться на информацию из посредника сеансов служб терминалов о состояниях сеансов и компьютеров.
-   Подключаемый модуль можно использовать для управления подключениями к клиентским или серверным устройствам, поддерживающим RDP 5,2 или более поздней версии.
-   Подключаемый модуль можно использовать для включения централизованных решений для настольных систем Windows Vista Enterprise.

При реализации методов этого интерфейса учитывайте следующие моменты.

-   Посредник сеансов служб терминалов может вызывать методы этого COM-объекта из нескольких потоков.
-   Если какой-либо из вызванных методов не возвращает немедленно и успешно, посредник сеансов служб терминалов не вызывает подключаемый модуль и возвращается к его собственной логике балансировки нагрузки. Чтобы возобновить вызовы к подключаемому модулю, необходимо перезапустить службу посредника сеансов служб терминалов.
-   Необходимо зарегистрировать подключаемый модуль в качестве объекта COM на уровне системы с помощью Regsvr32.exe. Так как служба посредника сеансов служб терминалов работает под учетной записью NetworkService, необходимо предоставить учетной записи NetworkService необходимые права на запуск, активацию и доступ с помощью Dcomcnfg.exe. Служба посредника сеансов служб терминалов ищет идентификатор CLSID COM-объекта, представляющего подключаемый модуль, в следующем подразделе реестра:

    **HKey \_ \_** CurrentControlSet Services System (локальные компьютеры) \\  \\  \\  \\ **Tssdis** \\ **Параметры** \\ **екстенсибилитиплугинклсид**

Дополнительные сведения о Dcomcnfg.exe см. в разделе [Включение безопасности COM с помощью DCOMCNFG](/windows/desktop/com/enabling-com-security-using-dcomcnfg).

## <a name="related-topics"></a>См. также

<dl> <dt>

[**ивтссбплугин**](/windows/desktop/api/Tssbx/nn-tssbx-iwtssbplugin)
</dt> </dl>

 

 