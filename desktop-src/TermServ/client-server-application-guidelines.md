---
title: Рекомендации для клиентских и серверных приложений
description: Клиентские и серверные приложения не должны рассчитывать на то, что соединение с одним компьютером эквивалентно сеансу одного пользователя.
ms.assetid: 69822ef1-eca8-4302-b014-8e5894d52109
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd0c1a71256f3ab469bfeb1c08b2d096b56ac1b5
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105681626"
---
# <a name="clientserver-application-guidelines"></a>Рекомендации для клиентских и серверных приложений

Клиентские и серверные приложения не должны рассчитывать на то, что соединение с одним компьютером эквивалентно сеансу одного пользователя. Это особый случай проблемы, описанной в разделе [IP-адреса и имена компьютеров](ip-addresses-and-computer-names.md).

Для уникальной идентификации подключения клиента/сервера каждый модуль клиента должен использовать уникальное имя или идентификатор. Приложения могут использовать именованные объекты или каналы, сокеты или другие методы IPC. Дополнительные сведения см. в разделе [пространства имен объектов ядра](kernel-object-namespaces.md).

Чтобы обеспечить совместимость с службы удаленных рабочих столов, серверный модуль в приложении клиента или сервера должен иметь возможность обрабатывать несколько клиентов, подключающихся к одному и тому же компьютеру. Для этого серверный модуль должен принимать клиентские подключения через четко определенный глобальный интерфейс, например RPC или именованные каналы. Сервер и клиент должны согласовывать разные каналы связи для каждого сеанса пользователя. Клиент должен установить соединение с сервером с помощью протоколов, которые легко поддерживают этот тип операции, например TCP/IP, где для каждого клиентского приложения может использоваться другое подключение к сокету.

Клиентский модуль может вызвать функцию [**процессидтосессионид**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-processidtosessionid) , чтобы получить идентификатор своего сеанса службы удаленных рабочих столов. Затем клиент использует некоторую форму межпроцессного взаимодействия для передачи идентификатора сеанса в серверный модуль. Затем клиентские и серверные модули могут использовать идентификатор сеанса для настройки частного канала связи. Например, серверный модуль может использовать идентификатор сеанса для доступа к объектам в пространстве имен сеанса для объектов ядра.

Кроме того, серверный модуль может использовать идентификатор сеанса в вызове [**втскуерисессионинформатион**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsquerysessioninformationa) для получения дополнительных сведений о клиенте. Серверный модуль также может использовать идентификатор сеанса в вызове [**втссендмессаже**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) для вывода сообщения в клиентском терминале. Серверный модуль также может создавать два события для наблюдения за подключением клиентов к сеансу и отключения от него. Однако для этого он должен быть зарегистрирован на сервере узла сеансов удаленный рабочий стол (узел сеансов удаленных рабочих столов). Дополнительные сведения см. в разделе [наблюдение за подключениями и отсоединениями сеансов](monitoring-session-connections-and-disconnections.md).

Запросы на ввод пользователя являются потенциальным источником проблем для клиентских и серверных приложений. Например, если служба вызывает функцию [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) , окно сообщения отображается на рабочем столе сервера узла сеансов удаленных рабочих столов, а не на клиентском компьютере. Чтобы отобразить сообщение на клиентском компьютере, служба может вызвать функцию [**втссендмессаже**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtssendmessagea) . Кроме того, служба может запросить входные данные из клиентского модуля, а клиентский модуль может отобразить пользовательский интерфейс и отправить полученные входные данные обратно в службу.

Процессы, порождаемые из нескольких сеансов, могут отправлять и получать данные друг от друга с помощью блоков общей памяти. Дополнительные сведения см. в разделе [Создание именованной общей памяти](/windows/desktop/Memory/creating-named-shared-memory). Общую память нельзя использовать при следующих условиях:

-   Процессы, использующие блок общей памяти, порождены несколькими сеансами.
-   Сеансы совместно используют одни и те же учетные данные проверки подлинности пользователя.

 

 