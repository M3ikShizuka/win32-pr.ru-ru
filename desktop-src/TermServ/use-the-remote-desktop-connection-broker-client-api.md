---
title: Как использовать API клиента компонента подключение к удаленному рабочему столу Broker
description: API клиента компонента подключение к удаленному рабочему столу Broker позволяет сторонним поставщикам протоколов использовать брокер подключений для ускорения обработки подключений, использующих протокол для подключения к виртуальным машинам или серверам удаленный рабочий стол в ферме.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338876"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a>Как использовать API клиента компонента подключение к удаленному рабочему столу Broker

API клиента компонента подключение к удаленному рабочему столу Broker позволяет сторонним поставщикам протоколов использовать брокер подключений для ускорения обработки подключений, использующих протокол для подключения к виртуальным машинам или серверам удаленный рабочий стол в ферме.

## <a name="instructions"></a>Инструкции

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a>Шаг 1. Получение интерфейса Иконнектионброкерклиент

После инициализации приложения или поставщика протокола выполните следующие действия.

1.  Вызовите функцию [**кбкреатеклиентинстанце**](cbcreateclientinstance.md) , чтобы получить интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) .
2.  Не заключайте интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) , пока он вам нужен.
3.  Если интерфейс [**иконнектионброкерклиент**](iconnectionbrokerclient.md) больше не нужен, вызовите метод [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .

### <a name="step-2-request-the-target-information"></a>Шаг 2. запрос сведений о целевом объекте

Когда поставщик протокола получает входящий запрос на подключение, выполните следующие действия, чтобы вызвать метод [**иконнектионброкерклиент:: жеттаржетинфо**](iconnectionbrokerclient-gettargetinfo.md) . Этот метод получает от посредника подключений соответствующий сервер для перенаправления подключения.

1.  Создайте событие, которое может быть сигнальным с помощью функции [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa)или аналогичной, для использования в качестве параметра *хстатусевент* .
2.  Выделите память для параметров *птаржетинфо* и *пресулт* . Эти блоки памяти должны оставаться на месте до тех пор, пока не завершится вся последовательность.
3.  Заполните [**структуру \_ \_ сведений о соединении CB**](cb-connection-info.md) , содержащую всю информацию о входящем соединении.
4.  Вызовите метод [**жеттаржетинфо**](iconnectionbrokerclient-gettargetinfo.md) , передав все необходимые параметры. Это асинхронный метод, который будет возвращать экземпляр интерфейса [**иконнектионброкеррекуест**](iconnectionbrokerrequest.md) .
5.  Дождитесь, пока будет установлено событие *хстатусевент* .
6.  Если задано событие *хстатусевент* , вызовите метод [**Иконнектионброкеррекуест:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) , чтобы определить состояние запроса.
7.  Когда [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) возвращает **\_ запрос о \_ состоянии \_ CB**, параметры *птаржетинфо* и *пресулт* будут содержать их сведения. Цикл ожидания можно прервать, так как параметр *хстатусевент* больше не будет использоваться.
8.  Используйте сведения в структуре [**\_ \_ сведений о целевом объекте CB**](cb-target-info.md) , представленной параметром *птаржетинфо* , чтобы определить, куда перенаправлять входящее подключение.
9.  Освободите интерфейс [**иконнектионброкеррекуест**](iconnectionbrokerrequest.md) .
10. Закройте обработчик событий *хстатусевент* или повторно используйте его для последующих запросов на подключение.

 

 