---
title: Клиентская библиотека виртуальных каналов
description: Клиент приложения виртуальных каналов — это библиотека DLL, которая загружается во время инициализации службы удаленных рабочих столов на клиентском компьютере. Библиотека DLL должна быть зарегистрирована на клиентском компьютере.
ms.assetid: fca0505c-c4a9-4230-aeaa-ff3dfa62f581
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f8f9ba01db57de6dc030e6c47b09c4173156ef8f85e3969716ae6e10dfc069f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119423584"
---
# <a name="virtual-channel-client-dll"></a>Клиентская библиотека виртуальных каналов

Клиент приложения виртуальных каналов — это библиотека DLL, которая загружается во время инициализации службы удаленных рабочих столов на клиентском компьютере. Библиотека DLL должна быть зарегистрирована на клиентском компьютере. Дополнительные сведения см. в статье [Регистрация клиента для виртуального канала](virtual-channel-client-registration.md).

Клиентская библиотека DLL должна экспортировать функцию [**виртуалчаннелентри**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) , которая службы удаленных рабочих столов вызовов во время инициализации. Точка входа **виртуалчаннелентри** получает указатель на структуру [**\_ \_ точек входа канала**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) . Эта структура содержит указатели на функции, которые клиентский DLL вызывает для доступа к виртуальным каналам.



| Функция                                                      | Описание                                                                                                                                                                                                                                                                           |
|---------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**виртуалчаннелинит**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit)<br/>   | Регистрирует имена виртуальных каналов, которые будут использоваться клиентом, и предоставляет функцию обратного вызова [**виртуалчаннелинитевент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) , с помощью которой службы удаленных рабочих столов уведомляет клиента о событиях, влияющих на клиентское соединение.<br/> |
| [**виртуалчаннелопен**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen)<br/>   | Открывает клиентский узел указанного виртуального канала и предоставляет функцию обратного вызова [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , с помощью которой службы удаленных рабочих столов уведомляет клиента о событиях, влияющих на виртуальный канал.<br/>                    |
| [**виртуалчаннелврите**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite)<br/> | Записывает данные в виртуальный канал. Службы удаленных рабочих столов отправляет эти данные на серверный конец виртуального канала. Серверная конечная точка вызывает функцию [**втсвиртуалчаннелреад**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) для чтения данных.<br/>                                             |
| [**виртуалчаннелклосе**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose)<br/> | Закрывает виртуальный канал.<br/>                                                                                                                                                                                                                                                  |



 

Функция [**виртуалчаннелентри**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) библиотеки DLL должна вызывать функцию [**виртуалчаннелинит**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) для инициализации доступа к виртуальным каналам. При вызове **виртуалчаннелинит** необходимо передать указатель на функцию обратного вызова [**виртуалчаннелинитевент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) . Службы удаленных рабочих столов вызывает эту функцию ответного вызова после завершения инициализации и снова при установке соединения с сервером узла сеансов удаленный рабочий стол.

После установления соединения можно вызвать функцию [**виртуалчаннелопен**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) , чтобы открыть виртуальные каналы, зарегистрированные вызовом [**виртуалчаннелинит**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) . Вызов **виртуалчаннелопен** указывает указатель на функцию обратного вызова [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) .

После возврата вызова [**виртуалчаннелопен**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) можно вызвать функцию [**виртуалчаннелврите**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) для записи в виртуальный канал. Операция записи является асинхронной, поэтому вы не должны освобождать или повторно использовать буфер, переданный в **виртуалчаннелврите** , до тех пор, пока службы удаленных рабочих столов не вызовет функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , чтобы указать, что операция записи завершена. При вызове **виртуалчаннелврите** можно передать часть пользовательских данных, определяющих операцию записи. Службы удаленных рабочих столов передает данные пользователя при вызове **виртуалчаннелопеневент** , чтобы уведомить о завершении операции. На сервере в конце виртуального канала надстройка сервера вызывает функцию [**втсвиртуалчаннелреад**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) для чтения данных.

Службы удаленных рабочих столов также вызывает функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) , когда данные записываются в виртуальный канал серверным модулем. Серверный модуль вызывает функцию [**втсвиртуалчаннелврите**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) для записи данных на серверный конец виртуального канала.

Клиентские и серверные модули могут записывать блоки данных любого размера в виртуальный канал. Однако перед отправкой данных службы удаленных рабочих столов сегменты данных на фрагменты \_ байтов длины фрагментов каналов \_ . Службы удаленных рабочих столов вызывает функцию [**виртуалчаннелопеневент**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) один раз для каждого фрагмента данных, а не перестраивать данные в блок исходного размера. Каждый вызов **виртуалчаннелопеневент** указывает размер блока, общий размер, записанный сервером, а также сведения о том, составляют ли данные начало, середину или конец блока, записанного сервером.

Чтобы закрыть канал, можно вызвать функцию [**виртуалчаннелклосе**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) . Однако вызывать его не нужно, так как службы удаленных рабочих столов автоматически закрывает все каналы при отключении клиента от сервера.

 

 





