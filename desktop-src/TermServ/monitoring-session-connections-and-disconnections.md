---
title: Наблюдение за подключениями и отсоединениями сеансов
description: Чтобы зарегистрировать приложение в службы удаленных рабочих столов, сохраните имя серверного приложения виртуального канала в реестре, добавив подраздел.
ms.assetid: 8524cb7a-a930-431a-bc5f-b0793781de15
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e819b13594ecec14a2b425560152cadedd4e9122
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070108"
---
# <a name="monitoring-session-connections-and-disconnections"></a>Наблюдение за подключениями и отсоединениями сеансов

Для приложения службы, такого как серверное приложение виртуального канала, для мониторинга соединений и отсоединений сеансов необходимо зарегистрировать его в службы удаленных рабочих столов. Чтобы зарегистрировать приложение в службы удаленных рабочих столов, сохраните имя серверного приложения виртуального канала в реестре, добавив подраздел в следующем расположении:

**HKey \_ \_** \\  \\  \\  \\  \\ **Надстройки** терминалсервер управления CurrentControlSet системы локального компьютера

У подраздела может быть любое имя. Он должен иметь значение **reg \_ SZ** , **имя**, которое содержит символическое имя приложения.

``` syntax
Name = AddinName
```

Максимальная длина подраздела и значения **имени** — 99 символов.

Подраздел также должен иметь значение **reg \_ DWORD** , указывающее тип серверного приложения.

``` syntax
Type = AddinType
```

*Аддинтипе* должно иметь следующее значение.



| Значение | Значение                               |
|-------|---------------------------------------|
| 3     | Приложение пользовательского режима, пространство сеанса. |



 

Регистрация приложения службы вступает в силу только в сеансах, созданных после выполнения регистрации.

Для каждого зарегистрированного приложения службы службы удаленных рабочих столов задаст набор объектов событий, когда клиент подключится к сеансу или отключится от него. Каждый подключаемый модуль виртуального канала должен зарегистрироваться и создать события уведомления путем вызова функции [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa). Имена этих объектов событий соответствуют следующему формату.

``` syntax
AddinName-Reconnect

AddinName-Disconnect
```

*AddinName* — это строка, указанная в значении **имени** подраздела реестра, в котором зарегистрировано серверное приложение. Создание этих событий в сеансе приводит к их созданию в специальном каталоге событий для каждого сеанса. Каталог событий обеспечивает дополнительную безопасность, предотвращая изменение состояния этих событий приложениями в других сеансах.

Чтобы контролировать, получены ли на сервере события повторного подключения и отключения, можно поместить флаг **ремотеконтролперсистент** в реестр в следующем разделе:

**HKey \_ Локальный \_ компьютер** \\ **система** \\ **CurrentControlSet** \\ **Управление** \\  \\ **надстройками** терминалсервер \\ *AddinName*

Флаг включает или отключает сигнал о событиях повторного подключения и отключения при запуске или остановке сеанса клиента. Синтаксис значения **\_ DWORD реестра** следующий.

``` syntax
RemoteControlPersistent = flag
```

Значение *флага* может быть равно одному или нулю. Значение по умолчанию равно нулю. Если задано значение One, приложение службы не будет уведомлено о запуске или остановке сеанса клиента. Если задано нулевое значение, событие повторного подключения получает сигнал при запуске сеанса клиента, а событие отключения сигнализирует о остановке сеанса клиента.

Предыдущий формат имени объекта события по-прежнему поддерживается в Windows Server 2008 для обеспечения обратной совместимости. Рекомендуется использовать новый формат Windows Server 2008, так как он более безопасен.

Формат предыдущего события выглядит следующим образом.

``` syntax
Global\AddinName-SessionId-Reconnect
 
Global\AddinName-SessionId-Disconnect
```

*AddinName* — это строка, указанная в значении **имени** подраздела реестра, в котором зарегистрировано серверное приложение. *SessionID* — это идентификатор сеанса клиента.

 

 