---
title: Предотвращение нескольких отправок
description: При передаче файла служба BITS создает идентификатор сеанса, который определяет сеанс передачи как клиенту BITS, так и серверу BITS.
ms.assetid: 97283f8e-d2fa-4383-9b92-a05f46680443
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae59bb1d605af7e4dd53b0c1d66618b6816e7886
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067423"
---
# <a name="preventing-multiple-uploads"></a>Предотвращение нескольких отправок

При передаче файла служба BITS создает идентификатор сеанса, который определяет сеанс передачи как клиенту BITS, так и серверу BITS. Если соединение между клиентом BITS и сервером разорвано, а BITS отправляет файл, клиент будет использовать идентификатор сеанса, чтобы попытаться возобновить передачу.

Если клиент BITS подключается к тому же серверу, что и ранее, сервер распознает идентификатор сеанса, и передача будет возобновлена с точки прерывания. Однако если клиент подключается к другому серверу, клиент должен начать отправку с начала, поскольку на новом сервере отсутствует контекст сеанса или ранее загруженные данные. Служба BITS может подключаться к другому серверу, если сервер BITS размещается на веб-ферме, а свойство расширения IIS BITS [битшостид](bits-iis-extension-properties.md)не задано. Свойство Битшостид предотвращает перезагрузку, заставляя клиент BITS подключаться к уникальному адресу предыдущего сервера вместо общего адреса сервера.

Сервер BITS попытается отправить файл отправки только один раз в серверное приложение, но возможно, что файл будет отправлен более одного раза. Это может произойти, например, если сервер BITS отправляет файл в серверное приложение, а затем завершается при ожидании ответа от серверного приложения. Клиент BITS получит код ошибки на уровне HTTP и повторит попытку отправки после задержки. Если сервер остается в автономном режиме дольше, чем время ожидания [битшостидфаллбакктимеаут](bits-iis-extension-properties.md) , клиент в конечном итоге отправит запрос к общему адресу сервера. другой сервер BITS получит файл и снова доставляет его в серверное приложение.

Аналогичный случай может происходить даже с одним сервером переднего плана. Например, когда клиент перегружает весь файл на сервер, последний блок заставляет сервер пересылать файл в серверное приложение. Если сервер BITS или серверное приложение прерывают работу после обработки файла, но перед отправкой подтверждения клиенту, клиент получит код ошибки и повторите попытку позже. Когда клиент повторяет попытку, сервер BITS увидит, что последний блок был отправлен, и снова перейдет файл в серверное приложение. Если получение файла отправки выполняется несколько раз, то следует рассмотреть возможность включения идентификатора транзакции в данные.

 

 




