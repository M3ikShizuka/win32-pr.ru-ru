---
title: Использование событий (журнал событий Windows)
description: События можно использовать из каналов или из файлов журнала.
ms.assetid: 17204d3f-0875-42c5-9af4-caca6349a67d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: adb3fb1b36a0cd4ecf836a8893bc1abc14e46451
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "105691738"
---
# <a name="consuming-events-windows-event-log"></a>Использование событий (журнал событий Windows)

События можно использовать из каналов или из файлов журнала. Для использования событий можно использовать все события или указать выражение XPath, определяющее события, которые требуется использовать. Сведения о том, как определить элементы и атрибуты события, которое можно использовать в выражении XPath, см. в разделе [схема событий](eventschema-schema.md).

Журнал событий Windows поддерживает подмножество XPath 1,0. Дополнительные сведения об ограничениях см. в разделе [ограничения XPath 1,0](#xpath-10-limitations).

В следующих примерах показаны простые выражения XPath.


```XML
// The following query selects all events from the channel or log file
XPath Query: *

// The following query selects all the LowOnMemory events from the channel or log file
XPath Query: *[UserData/LowOnMemory]

// The following query selects all events with a severity level of 1 (Critical) from the channel or log file
XPath Query: *[System/Level=1]

// The following query shows a compound expression that selects all events from the channel or log file
// where the printer's name is MyPrinter and severity level is 1.
XPath Query: *[UserData/*/PrinterName="MyPrinter" and System/Level=1]

// The following query selects all events from the channel or log file where the severity level is
// less than or equal to 3 and the event occurred in the last 24 hour period.
XPath Query: *[System[(Level <= 3) and TimeCreated[timediff(@SystemTime) <= 86400000]]]
```



Выражения XPath можно использовать непосредственно при вызове функций [**евткуери**](/windows/desktop/api/WinEvt/nf-winevt-evtquery) или [**евтсубскрибе**](/windows/desktop/api/WinEvt/nf-winevt-evtsubscribe) , либо можно использовать структурированный XML-запрос, содержащий выражение XPath. Для простых запросов, которые запрашивают события из одного источника, использование выражения XPath является точным. Если выражение XPath является составным выражением, содержащим более 20 выражений или выполняющих запросы к событиям из нескольких источников, необходимо использовать структурированный XML-запрос. Дополнительные сведения об элементах структурированного XML-запроса см. в разделе [Схема запроса](queryschema-schema.md).

Структурированный запрос определяет источник событий и один или несколько селекторов или подавления. Селектор содержит выражения XPath, выбирающие события из источника, а суппрессор содержит выражение XPath, которое предотвращает выбор событий. Можно выбрать события из нескольких источников. Если селектор и суппрессор обозначают одно и то же событие, это событие не включается в результат.

Ниже показан структурированный запрос XML, указывающий набор селекторов и подавления.


```XML
<QueryList>
  <Query Id="0">
    <Select Path="Application">
        *[System[(Level <= 3) and 
        TimeCreated[timediff(@SystemTime) <= 86400000]]]
    </Select>
    <Suppress Path="Application">
        *[System[(Level = 2)]]
    </Suppress>
    <Select Path="System">
        *[System[(Level=1  or Level=2 or Level=3) and 
        TimeCreated[timediff(@SystemTime) <= 86400000]]]
    </Select>
  </Query>
</QueryList>
```



Результирующий набор запроса не содержит моментальный снимок событий во время запроса. Вместо этого результирующий набор включает события во время запроса и также содержит все новые события, которые вызываются в соответствии с критериями запроса во время перечисления результатов.

> [!Note]  
> Порядок событий сохраняется для событий, записываемых тем же потоком. Однако события, записываемые отдельными потоками на разных процессорах компьютера с несколькими процессорами, могут отображаться неупорядоченно.

 

Дополнительные сведения о потреблении событий см. в следующих разделах:

-   [Запрос событий](querying-for-events.md)
-   [Подписка на события](subscribing-to-events.md)
-   [События отрисовки](rendering-events.md)
-   [Форматирование сообщений о событиях](formatting-event-messages.md)
-   [События закладок](bookmarking-events.md)

Ниже перечислены стандартные средства для использования событий.

-   [Просмотр событий](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc766042(v=ws.11))
-   Командлет [Get-WinEvent](/previous-versions//dd367894(v=technet.10)) Windows PowerShell
-   [**Средств**](windows-event-log-tools.md)

## <a name="xpath-10-limitations"></a>Ограничения XPath 1,0

Журнал событий Windows поддерживает подмножество XPath 1,0. Основное ограничение заключается в том, что селектором событий могут быть выбраны только элементы XML, представляющие события. Запрос XPath, который не выбирает событие, является недопустимым. Все допустимые пути селектора начинаются с \* или "Event". Все пути расположения работают на узлах событий и состоят из ряда шагов. Каждый шаг представляет собой структуру из трех частей: ось, тест узла и предикат. Дополнительные сведения об этих частях и о XPath 1,0 см. в разделе [язык XML-путей (XPath)](https://www.w3.org/TR/xpath). В журнале событий Windows в выражение помещаются следующие ограничения:

-   Axis: поддерживаются только дочерний элемент (по умолчанию) и атрибут (и его сокращенная ось "@").
-   Проверки узлов. поддерживаются только имена узлов и тесты NCName. \*Поддерживается символ "", который выбирает любой символ.
-   Предикаты. любое допустимое выражение XPath допустимо, если пути к расположению соответствуют следующим ограничениям.
    -   Поддерживаются **стандартные операторы,** **и, and**, =,! =, <=, <, >=, > и круглые скобки.
    -   Создание строкового значения для имени узла не поддерживается.
    -   Вычисление в обратном порядке не поддерживается.
    -   Наборы узлов не поддерживаются.
    -   Область видимости пространства имен не поддерживается.
    -   Узлы пространства имен, обработки и комментариев не поддерживаются.
    -   Размер контекста не поддерживается.
    -   Привязки переменных не поддерживаются.
    -   Функция позиционирования и ее сокращенная ссылка на массив поддерживаются (только на конечных узлах).
    -   Поддерживается функция Band. Функция выполняет побитовую операцию и для двух целочисленных аргументов числа. Если результат побитового и не равен нулю, функция возвращает значение true; в противном случае функция возвращает значение false.
    -   Поддерживается функция тимедифф. Функция вычислит разницу между вторым аргументом и первым аргументом. Один из аргументов должен быть литеральным числом. Аргументы должны использовать представление FILETIME. Результатом является число миллисекунд между двумя значениями времени. Результат является положительным, если второй аргумент представляет более позднее время; в противном случае это отрицательное значение. Если второй аргумент не указан, используется текущее системное время.

 

 
