---
title: Написание манифеста инструментирования
description: Приложения и библиотеки DLL используют манифест инструментирования для обнаружения поставщиков инструментирования и событий, записываемых поставщиками.
ms.assetid: eec9d129-acde-4302-9121-634b3fad8455
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 82b3462d6adc264fba8ba155620a2bbb402d51d5d6fc24f7dbe879b9e2a91ec9
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118587055"
---
# <a name="writing-an-instrumentation-manifest"></a>Написание манифеста инструментирования

Приложения и библиотеки DLL используют манифест инструментирования для обнаружения поставщиков инструментирования и событий, записываемых поставщиками. Манифест — это XML-файл, содержащий элементы, которые указывают поставщика. Соглашение заключается в использовании. Man в качестве расширения для манифеста. Манифест должен соответствовать XSD-манифесту события. Дополнительные сведения о схеме см. в разделе [Евентманифест Schema](eventmanifestschema-schema.md).

Поставщик инструментирования — это любое приложение или библиотека DLL, которые вызывают функции [**евентвритикс**](/windows/desktop/api/evntprov/nf-evntprov-eventwriteex), [**EventWriteString**](/windows/desktop/api/evntprov/nf-evntprov-eventwritestring)или [**EventWriteTransfer**](/windows/desktop/api/evntprov/nf-evntprov-eventwritetransfer) для записи событий в сеанс трассировки трассировки [событий](/windows/desktop/ETW/event-tracing-portal) (ETW) или канал журнала событий. Приложение может определить одного поставщика инструментирования, охватывающего все события, которые он записывает, или определить поставщика для приложения и поставщика для каждой из его библиотек DLL. Число поставщиков, определяемых приложением в манифесте, зависит только от того, как приложение хочет упорядочить записываемые события.

Преимущество указания поставщика для каждой библиотеки DLL заключается в том, что после этого можно включить и отключить отдельные поставщики и, таким же, события, которые они создают. Это преимущество применимо только в том случае, если поставщик включен в сеансе трассировки ETW. Все события, указывающие канал журнала событий, всегда записываются в этот канал.

Манифест должен выявлять поставщика и события, которые он записывает, но другие метаданные, такие как каналы, уровни и ключевые слова, являются необязательными. определение необязательных метаданных зависит от того, кто будет потреблять события. например, если администраторы или персонал службы поддержки используют события с помощью таких средств, как Windows Просмотр событий, считывающих события из каналов журнала событий, необходимо определить каналы, на которые записываются эти события. Однако если поставщик будет включен только сеансом трассировки событий Windows, то не нужно определять каналы.

Несмотря на то, что уровни, задачи, коды операций и метаданные ключевых слов необязательны, их следует использовать для логической группировки или сегментирования событий. Группирование событий помогает потребителям использовать только те события, которые представляют интерес. Например, потребитель может запрашивать все события, уровень "критический" и ключевое слово "Write", или запрашивать все события, записанные определенной задачей.

Помимо потребителей, использующих уровни и ключевые слова для использования конкретных типов событий, сеанс трассировки ETW может использовать метаданные уровня и ключевого слова, чтобы сообщения ETW могли ограничивать события, записываемые в журнал трассировки событий. Например, сеанс может ограничить события только событиями, для которых уровень — "ошибка" или "критическая", а ключевое слово "Read".

Поставщик может определять фильтры, которые сеанс использует для фильтрации событий на основе данных событий. С помощью уровня и ключевых слов ETW определяет, записывается ли событие в журнал, но с фильтрами поставщик использует критерии фильтрации данных, чтобы определить, записывает ли событие в этот сеанс. Фильтры применяются только в том случае, если сеанс трассировки ETW включает ваш поставщик.

В следующих разделах показано, как определить компоненты манифеста.

-   [Определение поставщика](identifying-the-provider.md)
-   [Определение каналов, на которых записываются события](defining-channels.md)
-   [Определение уровней серьезности событий, записываемых поставщиком](defining-severity-levels.md)
-   [Определение задач и операций, выполняемых поставщиком](defining-tasks-and-opcodes.md)
-   [Определение ключевых слов, которые классифицируют события, записываемые поставщиком](defining-keywords-used-to-classify-types-of-events.md)
-   [Определение фильтров, используемых поставщиком для фильтрации записываемых событий](defining-filters.md)
-   [Определение сопоставлений имен и значений, на которые ссылаются данные шаблона](defining-name-value-mappings.md)
-   [Определение шаблонов, определяющих данные, относящиеся к событиям](defining-event-data-templates.md)
-   [Определение событий, записываемых поставщиком](defining-events.md)

хотя манифест инструментирования можно создать вручную, следует использовать средство ECManGen.exe, которое входит в \\ папку Bin Windows SDK. Средство ECManGen.exe использует графический интерфейс пользователя, который помогает создать манифест с нуля без использования XML-тегов. Знание сведений в этом разделе и в разделе [схемы евентманифест](eventmanifestschema-schema.md) поможет при использовании этого средства.

при использовании Visual Studio в качестве редактора XML можно добавить в проект схему [евентманифест](eventmanifestschema-schema.md) (см. меню «xml»), чтобы воспользоваться преимуществами Intellisense, встроенной проверки схемы и другими функциями для упрощения и точной записи манифеста.

После записи манифеста используйте компилятор сообщений для проверки манифеста и создания файлов ресурсов и заголовков, включаемых в поставщик. Дополнительные сведения см. в разделе [Компиляция манифеста инструментирования](compiling-an-instrumentation-manifest.md).

В следующем примере показана скелет полностью определенного манифеста события.


```XML
<instrumentationManifest
    xmlns="http://schemas.microsoft.com/win/2004/08/events" 
    xmlns:win="http://manifests.microsoft.com/win/2004/08/windows/events"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    >

    <instrumentation>
        <events>
            <provider ...>
                <channels>
                    <importChannel .../>
                    <channel .../>
                </channels>
                <levels>
                    <level .../>
                </levels>
                <tasks>
                    <task .../>
                </tasks>
                <opcodes>
                    <opcode .../>
                </opcodes>
                <keywords>
                    <keyword .../>
                </keywords>
                <filters>
                    <filter .../>
                </filters>
                <maps>
                    <valueMap ...>
                        <map .../>
                    </valueMap>
                    <bitMap ...>
                        <map .../>
                    </bitMap>
                </maps>
                <templates>
                    <template ...>
                        <data .../>
                        <UserData>
                            <!-- valid XML fragment -->
                        </UserData>
                    </template>
                </templates>
                <events>
                    <event .../>
                </events>
            </provider>
        </events>
    </instrumentation>

    <localization>
        <resources ...>
            <stringTable>
                <string .../>
            </stringTable>
        </resources>
    </localization>

</instrumentationManifest>
```



 

 
