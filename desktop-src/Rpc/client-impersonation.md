---
title: Олицетворение клиента (RPC)
description: Олицетворение полезно в распределенных вычислительных средах, когда серверы должны передавать клиентские запросы другим серверным процессам или к операционной системе.
ms.assetid: 49d833d8-c61c-4746-91cf-c0753847cd3d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d03ad3b4d9e2984708e8b274ab9bc57c3235808b
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134359"
---
# <a name="client-impersonation"></a>Олицетворение клиента

Олицетворение полезно в распределенных вычислительных средах, когда серверы должны передавать клиентские запросы другим серверным процессам или к операционной системе. В этом случае сервер олицетворяет контекст безопасности клиента. Затем другие серверные процессы могут обрабатывать запрос так, как если бы он был создан исходным клиентом.

![сервер олицетворяет вызывающий клиент при последующих вызовах от имени клиента](images/impr.png)

Например, клиент выполняет запрос к серверу A. Если сервер A должен запрашивать сервер B для выполнения запроса, сервер A олицетворяет контекст безопасности клиента и выполняет запрос к серверу B от имени клиента. Сервер B использует контекст безопасности исходного клиента вместо удостоверения безопасности для сервера а, чтобы определить, следует ли выполнить задачу.

Сервер вызывает [**рпЦимперсонатеклиент**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcimpersonateclient) , чтобы перезаписать безопасность серверного потока с помощью контекста Client Security. После завершения задачи сервер вызывает [**рпкреверттоселф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoself) или [**рпкреверттоселфекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcreverttoselfex) для восстановления контекста безопасности, определенного для потока сервера.

При привязке клиент может указать сведения о контроле качества обслуживания, которые указывают, как сервер может олицетворять клиента. Например, один из параметров позволяет клиенту указать, что серверу не разрешено олицетворять его. Дополнительные сведения см. в разделе [качество обслуживания](quality-of-service.md).

Возможность вызова других серверов при олицетворении исходного клиента называется *делегированием*. При использовании делегирования сервер, выполняющий олицетворение клиента, может вызвать другой сервер и выполнить сетевые вызовы с учетными данными клиента. То есть с точки зрения второго сервера запросы, поступающие от первого сервера, не отличаются от запросов, поступающих от клиента. Не все поставщики безопасности поддерживают делегирование. Корпорация Майкрософт поставляется только с одним поставщиком безопасности, поддерживающим делегирование: Kerberos.

Делегирование может быть опасной возможностью из-за привилегий, которые клиент предоставляет серверу во время удаленного вызова процедуры. Именно поэтому Kerberos разрешает вызовы с уровнем олицетворения делегирования только в том случае, если запрашивается взаимная проверка подлинности. Администраторы домена могут ограничить компьютеры, на которых выполняется вызов с уровнем олицетворения делегирования, чтобы предотвратить неподозрительные клиенты от выполнения вызовов к серверам, которые могут привести к нарушению своих учетных данных.

Существует одно исключение из правила делегирования: вызовы с использованием [**нкалрпк**](/windows/desktop/Midl/ncalrpc). Когда эти вызовы становятся доступными, сервер получает права на делегирование, даже если задан уровень олицетворения олицетворения. То есть сервер может вызывать другие серверы от имени клиента. Это работает только для одного удаленного вызова. Например, если клиент A вызывает Local Server фунтов с помощью **нкалрпк** Local Server фунтов, может олицетворять и вызывать удаленный сервер RB. RB сможет действовать от имени клиента а, но только на удаленном компьютере, на котором запущена программа RB. Он не может выполнить другой сетевой вызов на удаленном компьютере C, если не указан уровень олицетворения делегата при вызове RB.

> [!Note]  
> Термин *олицетворение* представляет два перекрывающихся значения. Первое значение олицетворения — это общий процесс, действующий от имени клиента. Второе значение — это конкретный уровень олицетворения, называемый олицетворением. Контекст текста обычно уточняет значение.

 

 

 