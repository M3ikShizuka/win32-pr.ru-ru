---
title: Использование HTTP в качестве транспорта RPC
description: RPC-over-HTTP позволяет клиентским программам использовать Интернет для выполнения процедур, предоставляемых серверными программами в удаленных сетях.
ms.assetid: b5062d70-7625-4a9f-a8c1-025ef8342fcb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8775aab1771dcc6da9cade97d36c7141d6d66d8bc8172a20c8263ef64b8ed7ce
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119010791"
---
# <a name="using-http-as-an-rpc-transport"></a>Использование HTTP в качестве транспорта RPC

RPC-over-HTTP позволяет клиентским программам использовать Интернет для выполнения процедур, предоставляемых серверными программами в удаленных сетях. RPC через HTTP выполняет туннелирование своих вызовов через установленный HTTP-порт. Таким же вызов может пересекать сетевые брандмауэры как в клиентской, так и в серверной сети.

RPC через HTTP направляет свои вызовы прокси-серверу RPC, расположенному в сети сервера RPC. Прокси-сервер RPC устанавливает и поддерживает подключение к серверу RPC. Она служит прокси-сервером, отправляет вызовы удаленных процедур на сервер RPC и отправляет ответы сервера обратно через Интернет в клиентское приложение. Этот процесс показан на следующей схеме.

![взаимодействие между сервером RPC и сервером IIS для RPC HTTP](images/httprpc1.png)

На схеме показан брандмауэр в сети клиентского приложения. Это не требуется для функционирования RPC через HTTP. Однако если у клиентской сети есть брандмауэр, потребуется также программа прокси-сервера, например Microsoft Proxy Server.

Когда клиентская программа выдает удаленный вызов процедуры по протоколу HTTP в качестве транспорта, Библиотека времени выполнения RPC на клиенте обращается к прокси-серверу RPC. В зависимости от того, используется ли клиент RPC, используйте протокол HTTP или HTTPS (HTTP с SSL), порт 80 или порт 443, соответственно. Прокси-сервер RPC обращается к программе RPC Server и устанавливает подключение TCP/IP. Клиент и прокси-сервер RPC поддерживают подключения по протоколу HTTP или HTTPS через Интернет. Подключение по протоколу HTTP или HTTPS к прокси-серверу RPC может проходить через брандмауэр (подчиняются соответствующим разрешениям на доступ), если таковой имеется. Затем сервер может выполнить удаленный вызов процедуры и использовать подключение через прокси-сервер RPC для ответа клиенту. Прокси-сервер RPC — это расширение ISAPI, выполняющееся в контексте IIS.

Если клиент или сервер отключаются по какой-либо причине, прокси RPC определит его и завершит сеанс RPC. Пока сеанс будет продолжен, прокси-сервер RPC сохранит подключение к клиенту и серверу. Он будет пересылать удаленные вызовы процедур от клиента серверу и отправлять ответы от сервера клиенту.

Клиентская программа RPC может туннелировать вызовы RPC через Интернет, создав строковую привязку формы:

``` syntax
[object_uuid@]ncacn_http:rpc_server[endpoint,HttpProxy=proxy_server:http_port,RpcProxy=rpc_proxy:rpc_port,HttpConnectionOption=UseHttpProxy]
```

Где:

-   *\_ UUID объекта* указывает UUID объекта RPC. Дополнительные сведения см. в разделе [создание идентификаторов UUID интерфейса](generating-interface-uuids.md) и [строкового UUID](string-uuid.md).
-   **нкакн \_ http** выбирает спецификацию последовательности протоколов для RPC через HTTP. Дополнительные сведения см. в разделе [константы последовательности протоколов](protocol-sequence-constants.md) и [Привязка строк](string-binding.md).
-   *RPC- \_ сервер* — это сетевой адрес компьютера, на котором выполняется процесс RPC-сервера. Адрес сервера должен быть указан в форме, видимой и понятной компьютеру прокси-сервера RPC, а не клиенту. Поскольку клиент не подключается непосредственно к серверу, ему не нужно иметь возможность разрешить имя сервера или установить соединение с ним. Прокси-сервер RPC устанавливает подключение от имени клиента, поэтому *\_ сервер RPC* должен быть именем, распознаваемым прокси-сервером RPC.
-   *Конечная точка* указывает порт TCP/IP, который сервер RPC прослушивает для удаленных вызовов процедур. Дополнительные сведения см. в разделе [Поиск конечных точек](finding-endpoints.md).
-   При необходимости **полезных** указывает прокси-сервер HTTP в сети клиента RPC, такой как Microsoft Proxy Server. Если выбран прокси-сервер, то номер порта не указан, заглушка RPC использует порт 80 по умолчанию, если протокол SSL не запрошен, а порт 443, если указан протокол SSL.
-   **RPCProxy** задает адрес и номер порта компьютера IIS, который выступает в качестве прокси-сервера RPC. Его необходимо указать, только если сервер RPC находится на компьютере, отличном от компьютера прокси-сервера RPC. Если не указать номер порта, клиентская заглушка RPC по умолчанию использует порт 80, если SSL не указан, и использует порт 443, если указан протокол SSL (HTTPS).
-   **Хттпконнектионоптион** при необходимости позволяет направлять поведение RPC при установлении HTTP-соединений. Значение **усехттппрокси** предписывает RPC направить трафик через прокси-сервер HTTP в любое время, в том числе когда для клиента в Internet Explorer задан параметр «не использовать прокси-сервер для локальных адресов».

    этот параметр поддерживается в Windows 7, Windows Server 2008 r2, Windows 8.1 и Windows Server 2012 r2 с установленным KB2916915. этот параметр не поддерживается в Windows 8 и Windows Server 2012. Приложения могут определить, поддерживается ли этот параметр средой выполнения RPC, проверив значение реестра **коннектионоптионсфлаг** , расположенное в следующем разделе реестра:

    **HKEY \_ \_ \\ программное обеспечение локального компьютера \\ Microsoft \\ RPC**

    Если задан бит 0 (ЛСБ) этого значения реестра, этот параметр поддерживается. в противном случае этот параметр не поддерживается средой выполнения RPC в системе.

Дополнительные сведения о создании строковых привязок см. в разделе [Binding and Handles](binding-and-handles.md).

Программа RPC-сервера может принимать туннельные вызовы RPC путем прослушивания \_ последовательности протокола HTTP нкакн.

Корпорация Майкрософт имеет две основные реализации RPC по протоколу HTTP: версии 1 и версии 2.

версия 1 (называемая RPC через HTTP v1) поддерживается в Windows XP. версия 1 прокси-сервера RPC поддерживается через Windows 2000.

Версия 2 (называемая RPC через HTTP v2) — это текущая версия.

Две версии имеют различные возможности и ограничены возможностями взаимодействия. Сводка различий приведена здесь. Рекомендации по взаимодействию см. в статье [требования к системе и взаимодействие для RPC через HTTP](system-requirements-and-interoperability-for-rpc-over-http.md).

-   Для RPC через HTTP v1 необходимо включить туннелирование SSL для всех прокси-серверов HTTP и брандмауэров между клиентом RPC через HTTP и прокси-сервером RPC. RPC через HTTP v1 попытается создать ssl-Tunnel через порт 80, несмотря на то, что отправляемые им данные фактически не шифруются с помощью ssl. Прокси-серверы и брандмауэры обычно отклоняют такие запросы, если они не разрешены явным образом. RPC через HTTP v2 не имеет такого требования.
-   RPC через HTTP v1 не может установить сеанс SSL для прокси-сервера RPC. RPC через HTTP v2 может передавать весь трафик RPC через HTTP в сеансе SSL. по умолчанию версия 2 требует, чтобы данные отправлялись в сеансе SSL.
-   RPC через HTTP v1 не может пройти проверку подлинности прокси-сервера RPC. RPC через HTTP v2 может пройти проверку подлинности; по умолчанию v2 требует проверки подлинности прокси RPC.
-   RPC-прокси версии 1 не работает правильно, если компьютер IIS, на котором она установлена, является частью веб-фермы. Прокси-сервер RPC версии 2 работает правильно, если компьютер IIS, на котором он установлен, является частью веб-фермы.

> [!Note]  
> Если Microsoft Internet Explorer установлен на компьютере клиентской программы и клиент не указал **полезных** в своей строковой привязке, клиентская заглушка RPC будет выполнять поиск записи **полезных** в реестре на клиентском компьютере. Если он найден, будет использоваться прокси-сервер, указанный в записи реестра.

 

Предположим, например, что клиентская программа должна подключаться через Интернет к серверу RPC на компьютере с именем Server7.microsoft.com. Кроме того, предположим, что прокси RPC работает на Major7.microsoft.com. Программа RPC Server прослушивает порт 2225. Клиент будет использовать привязку строк:

``` syntax
ncacn_http:Server7.microsoft.com[2225, RpcProxy=Major7.microsoft.com]
```

Если прокси-сервер RPC может разрешить имя сервера как Server7, не требуя полного доменного имени, можно также указать:

``` syntax
ncacn_http:Server7 [2225, RpcProxy=Major7.microsoft.com]
```

Если клиентская сеть использует брандмауэр и прокси-сервер в Интернете с именем мипрокси, а Internet Explorer на клиенте не настроен для использования этого прокси-сервера, необходимо изменить привязку строки клиента на:

``` syntax
ncacn_http:Server7.microsoft.com[,HttpProxy=myproxy:80,RpcProxy=Major7.microsoft.com:80]
```

Это направляет клиента к подключению к программе RPC Server на Server7.microsoft.com. Для этого клиент сначала будет использовать порт 80 (или порт 443, если используется протокол SSL) для подключения к мипрокси. Это даст клиентской программе доступ к Интернету. При использовании Интернета клиентская программа затем подключается к прокси-серверу RPC на Major7.microsoft.com. Прокси-сервер RPC установит подключение к серверу RPC, работающему на Server7.microsoft.com.

Если клиентская сеть использует брандмауэр, а прокси-сервер RPC недоступен, для ускорения установки соединения можно изменить клиентскую привязку строки следующим образом:

``` syntax
ncacn_http:Server7.microsoft.com[RpcProxy=Major7.microsoft.com:80,HttpConnectionOption=UseHttpProxy]
```

**Хттпконнектионоптион** позволяет направлять поведение RPC при выполнении HTTP-соединений. Значение **усехттппрокси** предписывает RPC направить трафик через прокси-сервер HTTP в любое время, в том числе когда для клиента в Internet Explorer задан параметр «не использовать прокси-сервер для локальных адресов». Это направляет клиенту принудительное подключение к прокси-серверу RPC через прокси-сервер HTTP. Это ускоряет установку подключения, так как обходит любые задержки поиска сервера RPC непосредственно перед использованием HTTP-прокси.

Если используется параметр **хттпконнектионоптион** и Internet Explorer на клиенте не настроен для использования этого HTTP-прокси, то подключения могут завершаться сбоем **с \_ \_ недопустимыми \_ \_ параметрами сети RPC S**.

Большинство компьютеров сегодня настроены на просмотр веб-страниц. Таким образом, большинству клиентов не нужно указывать **полезных**, так как они будут получены из параметров подключения к Интернету.

 

 




