---
title: Пакет управления памятью RPCSS
description: Пара распределитель/распределитель по умолчанию, используемая заглушками и временем выполнения при выделении памяти от имени приложения, — это пользовательское \_ \_ выделение или MIDL пользователя MIDL \_ \_ .
ms.assetid: 9477e677-59cb-45d5-b485-ab0171ac17ba
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 93648b56ed47eb98a83b27a39b606fa2a51de9bf5791ad1b732e7169ef5dfa63
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120018184"
---
# <a name="rpcss-memory-management-package"></a>Пакет управления памятью RPCSS

Пара распределитель/распределитель по умолчанию, используемая заглушками и временем выполнения при выделении памяти от имени приложения, — это пользовательское **\_ \_ выделение** / **MIDL \_ \_** пользователем. Однако можно выбрать пакет RPCSS вместо значения по умолчанию с помощью атрибута ACF **\[ Enable \_ \]**. Пакет RPCSS состоит из функций RPC, начинающихся с префикса **RPCSS** или **рпксм**. пакет rpcss не рекомендуется для приложений Windows.

> [!Note]  
> Пакет управления памятью RPCSS устарел. Мы советуем использовать в своем расположении пользовательские пользовательские [**\_ \_ выделять**](/windows/desktop/Midl/midl-user-allocate-1) и [**\_ \_ MIDL**](/windows/desktop/Midl/midl-user-free-1) .

 

В режиме **/ОСФ** пакет RPCSS включает автоматически созданные MIDL-заглушки при использовании полных указателей, когда аргументы нуждаются в выделении памяти или в результате использования атрибута **\[ включения \_ выделения \]** . В режиме по умолчанию (Microsoft Extended) пакет RPCSS включен, только если используется атрибут **\[ включения \_ выделения \]** . Атрибут **\[ включить \_ выделение \] позволяет использовать** в качестве заглушки среду RPCSS на стороне сервера. На стороне клиента будет отображаться сообщение о возможности включения пакета RPCSS. В режиме **/ОСФ** на стороне клиента это не влияет.

Если пакет RPCSS включен, выделение памяти на стороне сервера осуществляется с помощью механизма выделения памяти частных вызовов RPC и дераспределителя. Можно выделить память, используя тот же механизм, вызвав [**рпксмаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) (или [**рпкссаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssallocate)). После возврата из заглушки сервера вся память, выделенная пакетом RPCSS, автоматически освобождается. В следующем примере показано, как включить пакет RPCSS:

``` syntax
/* ACF file fragment */

[ 
    implicit_handle(handle_t GlobalHandle),
    enable_allocate
]
interface iface
{
}

/*Server management routine fragment. Replaces p=midl_user_allocate(size); */

    p=RpcSsAllocate(size);                /*raises exception */
    p=RpcSmAllocate(size, &status);       /*returns error code */
```

Приложение может явно освободить память, вызвав функцию [**рпкссфри**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssfree) или [**рпксмфри**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmfree) . Обратите внимание, что эти функции фактически не освобождают память. Они помечаются для удаления. Библиотека RPC освобождает память, когда программа вызывает [**рпкссдисаблеаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdisableallocate) или [**рпкссдисаблеаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdisableallocate).

Можно также включить среду управления памятью для приложения, вызвав подпрограммы [**рпксменаблеаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmenableallocate) (и вы можете отключить ее, вызвав подпрограммы [**рпксмдисаблеаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmdisableallocate) ). После включения код приложения может распределять и освобождать память путем вызова функций из пакета RPCSS.

 

 