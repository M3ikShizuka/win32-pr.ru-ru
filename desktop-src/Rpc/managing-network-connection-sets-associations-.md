---
title: Управление наборами сетевых подключений (ассоциациями)
description: начиная с Windows 2000, время выполнения RPC может поддерживать более одного соединения между клиентом и сервером.
ms.assetid: 9b9c42e9-8ed5-46a6-b6ec-4093ce0128bb
keywords:
- Управление наборами сетевых подключений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: def88053639c2911dca26d57a080c7fbcbd71728000bee2f12ca7440cb56320b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118928390"
---
# <a name="managing-network-connection-sets-associations"></a>Управление наборами сетевых подключений (ассоциациями)

начиная с Windows 2000, время выполнения RPC может поддерживать более одного соединения между клиентом и сервером. Это упрощает работу с транспортами, которые не поддерживают изменение удостоверения клиента без повторного создания соединения, многопоточных клиентов и асинхронных клиентов. Набор соединений между клиентским процессом и конечной точкой сервера называется *Ассоциацией* в терминологии RPC. Понимание взаимосвязей может улучшить реализацию RPC.

В сценарии однопотокового удостоверения с одним потоком RPC открывает одно соединение между клиентским процессом и конечной точкой сервера для выполнения вызовов RPC. Когда выполняется синхронный вызов RPC, клиент отправляет запрос серверу через это подключение и получает ответ на него. Когда число потоков, выполняющих вызовы RPC в клиентском процессе, растет, идентификатор безопасности клиента может измениться. При смешении асинхронных вызовов/каналов с синхронными вызовами на клиенте RPC может потребоваться более одного сетевого подключения. Все соединения в наборе помещаются в пул соединений, называемый ассоциацией.

Синхронный удаленный вызов процедур использует только заданное соединение для обеспечения соответствия стандартам RPC. Соединение, используемое синхронным вызовом RPC, считается занятым, если запрос был отправлен, но ответ не был получен. В этом подключении не разрешается никакой другой трафик, пока не будет получен ответ. Во время выполнения RPC выполняется попытка мультиплексирования асинхронных вызовов RPC и вызова по конвейеру в одном соединении. Синхронные и асинхронные вызовы по конвейеру не могут смешиваться в одном соединении. Это означает, что данное соединение может использоваться для синхронных вызовов RPC или для асинхронных вызовов RPC/pipe.

RPC активно пытается повторно использовать подключения из пула. Когда выполняется новый вызов RPC, RPC пытается найти подходящее подключение из пула и создает новое соединение, только если не удается найти подходящее подключение. Чтобы соединение считалось подходящим, оно должно:

-   Должен иметь соответствующий тип (синхронный или асинхронный/канал).
-   Будьте свободны.
-   Имеют то же удостоверение безопасности, что и маркер привязки, для которого выполняется вызов. Если используется динамическое отслеживание идентификаторов, удостоверение маркера привязки обновляется из токена потока в начале вызова. Если используется статическое отслеживание идентификаторов, используется удостоверение клиента, помеченное для маркера привязки.

После получения ответа соединение помечается как свободное и может использоваться для других вызовов RPC.

Невозможно изменить удостоверение безопасности для соединения. Например, если большое количество вызовов одного и того же сервера выполняется с разными идентификаторами безопасности, количество соединений в пуле потоков растет. Сама Ассоциация подсчитывается по ссылкам, и когда все ссылки исчезают, она останавливает и закрывает все соединения. Каждый обработчик привязки и каждый обработчик контекста содержат ссылку на ассоциацию. Когда все закрываются, связь исчезает. в Windows XP ассоциации не обязательно исчезают немедленно. они могут остаться в течение короткого периода (целевой период составляет 20 секунд, но во время выполнения RPC может возникнуть задержка уничтожения связи, если нет доступных потоков для выполнения задачи). Если вы не хотите, чтобы связь оставалась в активном состоянии после закрытия последнего маркера контекста или маркера привязки, \_ Используйте \_ параметр RPC C opt \_ не \_ , чтобы принудительно закрыть среду выполнения RPC для немедленного закрытия подключения.

 

 




