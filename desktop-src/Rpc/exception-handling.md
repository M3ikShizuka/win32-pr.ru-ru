---
title: Обработка исключений (RPC)
description: RPC использует тот же подход к обработке исключений, что и Windows API.
ms.assetid: 7133d3f4-ed84-4cde-bc77-88e73ced9073
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25de594a648cddb70f26b42e8b0dbf1d6a9dd51d
ms.sourcegitcommit: 8fa6614b715bddf14648cce36d2df22e5232801a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "104488844"
---
# <a name="exception-handling-rpc"></a>Обработка исключений (RPC)

RPC использует тот же подход к обработке исключений, что и Windows API.

Структура [**рпктрифиналли**](rpctryfinally.md)  /  [**рпкфиналли**](/previous-versions/aa375699(v=vs.80))  /  [**рпцендфиналли**](/previous-versions/aa375634(v=vs.80)) эквивалентна оператору Windows **try-finally** . Конструкция RPC Exception [**рпктрексцепт**](rpctryexcept.md)  /  [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept)  /  [**рпцендексцепт**](/previous-versions/aa375629(v=vs.80)) эквивалентна инструкции **try, except** .

При использовании обработчиков исключений RPC исходный код на стороне клиента является переносимым. Различные файлы заголовков RPC, предоставляемые для каждой платформы, разрешают макросы **рпктри** и [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) для каждой платформы. В среде Windows эти макросы напрямую сопоставляются с инструкциями **try-finally** и **try-except** . В других средах эти макросы соответствуют другим реализациям обработчиков исключений для конкретной платформы.

Потенциальные исключения, создаваемые этими структурами, включают набор кодов ошибок, возвращаемых функциями RPC, с префиксами RPC \_ S \_ и RPC \_ X, а также набором исключений, возвращаемых Windows. Дополнительные сведения см. в разделе [возвращаемые значения RPC](rpc-return-values.md).

Хотя макросы **рпктри** и [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept) предоставляют настраиваемую платформу для обработки исключений в Windows Vista и более поздних версиях Windows, [**рпцексцептионфилтер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter) является рекомендуемым способом обработки исключений. Для записи многих наиболее распространенных структурных исключений не требуется записывать пользовательские фильтры. Однако для пользовательских фильтров исключений по-прежнему требуется **рпцексцепт**.

Исключения, возникающие в серверном приложении, заглушке сервера и библиотеке времени выполнения сервера (над транспортным уровнем), распространяются на клиент. Исключения не распространяются с транспортного уровня сервера. Рекомендуемым методом для серверной процедуры, возвращающей ошибки во время выполнения RPC, является исключение. Серверная процедура может использовать любые методы, подходящие для обмена сообщениями между серверными процедурами, но если возникает ошибка, которая не позволяет ей выполнить удаленную процедуру, она должна вызвать исключение после очистки и перед возвратом к времени выполнения RPC, вместо того чтобы возвращать значение RPC, которое только серверная процедура распознает как ошибку.

На следующем рисунке показано, как исключения возвращаются с сервера клиенту.

![исключения возвращаются с сервера клиенту через соответствующую среду выполнения RPC каждого компонента.](images/prog-a20.png)

Обработчики исключений RPC немного отличаются от открытых программных Foundation-Distributed вычислительной среды (использование-DCE), обрабатывающих исключения. **попробуйте**, **наконец** и **перехватите**. Различные поставщики предоставляют включаемые файлы, которые сопоставляют функции использование-DCE RPC с функциями Microsoft RPC, включая **try**, **catch**, **catch** \_ и **ендтри**. Эти файлы заголовков также сопоставляют \_ \_ \* коды ошибок RPC s с аналогами исключений использование-DCE, RPC \_ S \_ \* и сопоставляют \_ \_ \* коды ошибок RPC x с RPC \_ x \_ \* . Для переносимости использование-DCE используйте следующие включаемые файлы. Дополнительные сведения об обработчиках исключений RPC см. в разделе [**рпцексцептионфилтер**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcexceptionfilter), [**рпцексцепт**](/windows/desktop/api/Rpc/nf-rpc-rpcexcept), [**рпкфиналли**](/previous-versions/aa375699(v=vs.80)). Дополнительные сведения об обработчиках исключений Windows см. в разделе [структурированная обработка исключений](/windows/desktop/Debug/structured-exception-handling).

 

 
