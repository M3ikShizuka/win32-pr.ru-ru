---
title: Защита буфера МККП
description: Начиная с Windows Vista, механизм маршалинга RPC выполняет дальнейшие действия, чтобы попытаться предотвратить переполнение буфера на стороне клиента из-за возвращенных данных. Эта возможность называется Mini Computeing Protection (МККП).
ms.assetid: 37fe743b-c64e-469d-b8f4-abab9f05c813
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a70d04de57974bd9665d659129590d72513eb83e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103793500"
---
# <a name="mccp-buffer-protection"></a>Защита буфера МККП

Начиная с Windows Vista, механизм маршалинга RPC выполняет дальнейшие действия, чтобы попытаться предотвратить переполнение буфера на стороне клиента из-за возвращенных данных. Эта возможность называется Mini Computeing Protection (МККП).

Когда клиент передает указатель на существующий буфер для \[ [**выходного**](/windows/desktop/Midl/out-idl) \] или \[ [**входного**](/windows/desktop/Midl/in) \] параметра, возвращаемые данные для этого параметра копируются в существующий буфер. Если возвращенные данные больше, чем переданный буфер, может произойти переполнение буфера, когда RPC копирует возвращенные данные в слишком маленький буфер. См. раздел [указатели верхнего и внедренного уровня](top-level-and-embedded-pointers.md).

При использовании МККП RPC пытается обнаружить это условие и отклонить вызов, если он обнаружен. Для буферов со значением корреляции, например \[ [**size \_**](/windows/desktop/Midl/size-is), \] Если возвращенные данные не помещаются в указанном размере буфера, вызов отклоняется, и \_ \_ \_ возникает исключение "ошибка прокси \_ -службы RPC X". Для неразмерных строк вызов отклоняется, если размер существующего строки (Длина до **нулевого** терминатора) недостаточен для хранения возвращаемой строки, вызов отклоняется. RPC не может обнаруживать переполнения буфера во всех условиях, поэтому разработчику рекомендуется продолжать принимать обычные меры предосторожности относительно переполнения буфера.

Если клиент не передает существующий буфер для \[ [**выходного**](/windows/desktop/Midl/out-idl) \] параметра, а передает указатель разыменования в **null**, RPC будет следовать обычным правилам для выделения нового буфера от имени клиента. Этот буфер будет выделен с достаточным пространством для хранения возвращаемых данных.

Вторая защита заключается в том, что для коррелированных параметров RPC будет обеспечивать передачу буфера, отличного от **null** , если значение переменной счетчика корреляций не равно **null**.

``` syntax
HRESULT PassString( [in] DWORD Length, [in, unique, string, size_is( Length )]LPWSTR MyString );
```

Если параметр *MyString* имеет **значение NULL**, то RPC отклонит вызов, если для параметра *length* задано значение 0. Обратите внимание, что RPC допускает *длину* 0, в то время как *MyString* не имеет **значение NULL**, а RPC будет обрабатывать *MyString* как выделение буфера нулевой длины.

 

 