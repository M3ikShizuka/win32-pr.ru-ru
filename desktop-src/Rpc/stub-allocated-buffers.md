---
title: Буферы Stub-Allocated
description: Вместо того чтобы принудительно выполнять отдельный вызов для каждого узла дерева или графа, можно направлять заглушки для расчета размера данных и выделения и освобождения памяти, вызывая один вызов для \_ пользовательского \_ выделения или освобождения MIDL пользователем \_ \_ .
ms.assetid: 9911649d-00e8-47d8-b512-7d9b185d1e09
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 956acf6452c1a4e7d04afcd1da263439436e3bad
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127064871"
---
# <a name="stub-allocated-buffers"></a>Буферы Stub-Allocated

Вместо того чтобы принудительно выполнять отдельный вызов для каждого узла дерева или графа, можно направлять заглушки для расчета размера данных и выделения и освобождения памяти, вызывая один вызов для [ \_ пользовательского \_ выделения](/windows/desktop/Midl/midl-user-allocate-1) или [ \_ \_ освобождения](/windows/desktop/Midl/midl-user-free-1)MIDL пользователем. Атрибут ACF, **\[ выделяющий (все \_ узлы) \]** , направляет заглушки для выделения или освобождения всех узлов в одном вызове функций, предоставляемых пользователем — функции управления памятью.

Например, приложение RPC может использовать следующую структуру данных в двоичном дереве:

``` syntax
/* IDL file fragment */
typedef struct _TREE_TYPE 
{
    short sNumber;
    struct _TREE_TYPE * pLeft;
    struct _TREE_TYPE * pRight;
} TREE_TYPE;

typedef TREE_TYPE * P_TREE_TYPE;
```

Атрибут ACF **\[ allocate (все \_ узлы) \]** , примененный к этому типу данных, отображается в объявлении **typedef** в ACF как:

``` syntax
/* ACF file fragment */
typedef [allocate(all_nodes)] P_TREE_TYPE;
```

Атрибут **\[ выделения \]** может применяться только к типам указателей. Атрибут **\[ выделения \]** ACF является РАСШИРЕНИЕМ Майкрософт для устройства DCE IDL и, таким образом, недоступен при компиляции с параметром MIDL **/ОСФ** . Когда к типу указателя применяется **\[ выделение (все \_ узлы) \]** , суррогаты, созданные компилятором MIDL, проходят по указанной структуре данных для определения размера выделения. Затем заглушки выполняют один вызов, чтобы выделить весь объем памяти, необходимый графу или дереву. Клиентское приложение может освободить память гораздо эффективнее, делая один вызов для **пользователя MIDL \_ \_ свободным**. Однако при использовании выделения памяти для каждого узла обычно увеличивается производительность заглушки сервера, поскольку заглушки сервера часто могут использовать закрытую память, не требующую выделения памяти.

Дополнительные сведения см. в разделе [распределение и освобождение узлов по](node-by-node-allocation-and-deallocation.md)узлам.

 

 