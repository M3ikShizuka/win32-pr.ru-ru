---
title: Правила маршалирования для user_marshal и wire_marshal
description: В спецификации использование-DCE для маршалирования внедренных типов указателей необходимо учитывать следующие ограничения при реализации \_ функций Type усерсизе, Type \_ усермаршал и \_ усерунмаршал Type.
ms.assetid: 077cdd1a-9630-459e-8749-ab0c70b16ecb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e97f073a5745570aae5c52d4a61d2454b960d77a
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122883828"
---
# <a name="marshaling-rules-for-user_marshal-and-wire_marshal"></a>Правила маршалирования для пользовательского \_ маршалирования и передачи проводного \_ маршалирования

В спецификации использование-DCE для маршалирования внедренных типов указателей необходимо учитывать следующие ограничения при реализации &lt; &gt; \_ функций Type усерсизе, &lt; Type &gt; \_ усермаршал и &lt; &gt; \_ усерунмаршал Type. (Правила и примеры, приведенные здесь, предназначены для маршалирования. Однако подпрограммы изменения размера и распаковки должны соответствовать тем же ограничениям:

-   Если тип связи является плоским типом без указателей, подпрограммы упаковки для соответствующего усерм-типа должны просто маршалировать данные в соответствии с макетом типа связи. Пример.

    ``` syntax
    typedef [wire_marshal (long)] void * HANDLE_HANDLE;
    ```

    Обратите внимание, что тип провода, **Long**, является плоским типом. ОБРАБОТЧИК обрабатывает \_ \_ функцию усермаршал в **течение длительного времени** при \_ передаче ему объекта обработчика обработчика.

-   Если тип связи является указателем на другой тип, подпрограммы упаковки для соответствующего усерм-типа должны маршалировать данные в соответствии с макетом для типа, на который указывает тип связи. Подсистема доставки ОНД отвечает за указатель. Пример.

    ``` syntax
    typedef struct HDATA
    {
        long size;
        [size_is(size)] long * pData;
    } HDATA;

    typedef HDATA * WIRE_TYPE;
    typedef [wire_marshal(WIRE_TYPE)] void * HANDLE_DATA;
    ```

    Обратите внимание, что тип провода, **\_ Тип провода**, является типом указателя. \_ \_ Функция УСЕРМАРШАЛ данных Handle маршалирует данные, связанные с этим маркером, используя макет хдата, а не \* Макет хдата.

-   Тип связи должен быть либо плоским типом данных, либо типом указателя. Если тип трансмиссибле должен быть чем-то другим (например, структурой с указателями), используйте указатель на нужный тип в качестве типа связи.

Применение этих ограничений заключается в том, что типы, определенные \[ атрибутами " [**проводное \_ маршалирование**](/windows/desktop/Midl/wire-marshal) " \] или " \[ [**пользовательское \_ маршалирование**](/windows/desktop/Midl/user-marshal) ", \] можно свободно внедрять в другие типы.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**проводное \_ маршалирование**](/windows/desktop/Midl/wire-marshal)
</dt> <dt>

[**Пользовательская \_ Упаковка**](/windows/desktop/Midl/user-marshal)
</dt> <dt>

[Тип \_ Усерсизе функция](the-type-usersize-function.md)
</dt> <dt>

[Тип \_ Усермаршал функция](the-type-usermarshal-function.md)
</dt> <dt>

[Сетипе \_ усерунмаршалфунктион](the-type-userunmarshal-function.md)
</dt> <dt>

[Сетипе \_ усерфрифунктион](the-type-userfree-function.md)
</dt> </dl>

 

 
