---
title: Настройка балансировки нагрузки
description: Настройка балансировки нагрузки
ms.assetid: c78ffde1-1811-4065-941f-c24692eb144c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b82dbfc23e491d53a6687b50aa77b23878ce52ec
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338948"
---
# <a name="configuring-load-balancing"></a>Настройка балансировки нагрузки

Каждый прокси-сервер RPC, работающий в качестве сервера балансировки нагрузки (фунтов), должен быть настроен в качестве службы фунтов с знаниями о серверах в ферме серверов. При необходимости можно задать ресурс по умолчанию, а также настроить безопасность прокси-сервера в фунтах и фунтах в ФУНТах. Эти параметры настраиваются набором **обязательных разделов реестра** и **дополнительных разделов реестра** , как описано ниже.

## <a name="required-registry-keys"></a>Обязательные разделы реестра

Для настройки сервера фунтов требуется несколько разделов и значений реестра. Если какие-либо ключи отсутствуют или указаны в сообщении об ошибке, регистрируется событие Windows. См. описание каждого ключа и значения для сведений о событии в журнале.

Чтобы настроить ферму серверов, необходимо создать раздел реестра **HKLM \\ Software \\ Microsoft \\ RPC \\ RPCProxy** с именем **лбсконфигуратион**. В ключе **лбсконфигуратион** создается ключ для каждого ресурса в ферме серверов. Имя ключа — это строковое представление идентификатора GUID для ресурса. Должен существовать по крайней мере один ключ ресурса, и этот ресурс идентичен [**UUID**](./rpcdce/ns-rpcdce-uuid.md) , заданному клиентами на маркере привязки [**, \_ \_ маркером привязки RPC**](rpc-binding-handle.md)при создании привязки RPC/HTTP (Дополнительные сведения см. в разделе [**рпкбиндингсетобжект**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)). В каждом ключе UUID ресурса должно существовать значение DWORD с именем **конфигуратионтипе** , описывающее используемую конфигурацию. Кроме того, должны существовать **\_ SZ** идентификаторы серверов с разделителями-запятыми, которые называются **ферма серверов**. Серверы, указанные в разделе **ферма серверов** , являются серверами, входящими в ферму серверов балансировки нагрузки.

Ниже приведено подробное разбиение необходимых разделов и значений реестра.

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCProxy \\ лбсконфигуратион**

Раздел реестра. Ключ **лбсконфигуратион** — это раздел реестра, который содержит конфигурацию фунтов. Сюда входят [**идентификаторы UUID**](./rpcdce/ns-rpcdce-uuid.md) ресурсов, которые должны быть сбалансированы с балансировкой нагрузки, тип конфигурации для каждого ресурса и серверы в фермах серверов, участвующие в балансировке нагрузки. Если этот ключ отсутствует или является недопустимым, ФУНТы не будут считаться настроенными и служба фунтов не будет работать.

\-

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCPROXY \\ ЛБСКОНФИГУРАТИОН \\ XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX**

Раздел реестра. Ключ **UUID ресурса** определяет UUID ресурса для балансировки нагрузки. Этот идентификатор UUID ресурса совпадает с [**UUID**](./rpcdce/ns-rpcdce-uuid.md) , установленным клиентами в маркере привязки, [**\_ \_ маркером привязки RPC**](rpc-binding-handle.md). Для балансировки нагрузки должен существовать по крайней мере один UUID ресурса, а может быть несколько UUID ресурса. Может быть только одна ферма серверов, и все конечные точки должны быть на всех серверах в пределах фермы серверов. Если этот ключ не удается проанализировать до допустимого UUID, в журнал событий Windows будет записано событие **RPCPROXY \_ 0xC0000006 для \_ \_ недопустимых \_ ключей** .

\-

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCPROXY \\ ЛБСКОНФИГУРАТИОН \\ XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX \\ конфигуратионтипе**

DWORD. Параметр DWORD **конфигуратионтипе** хранится в ключе **UUID ресурса** . Допустимое значение равно 1. Если это значение отлично от 1, событие **RPCPROXY \_ EventLog \_ \_ неизвестный \_ \_ тип cfg (0XC0000007)** будет записано в журнал событий Windows.

\-

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCPROXY \\ ЛБСКОНФИГУРАТИОН \\ XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX \\ ферма серверов**

REG \_ SZ. Значение реестра **ферма серверов** содержит список идентификаторов серверов в виде точки с запятой делимитатед. Для идентификаторов сервера используется формат:

"ServerID1, ServerPort1, LBSPort1, \[ LBSPort2,... Лбспортн \] ; "

В разделе реестра **ферма серверов** должен быть указан несколько идентификаторов серверов. Они должны быть разделены точкой с запятой. Поля, являющиеся частью идентификатора сервера, описаны в следующей таблице. Если это поле не может быть проанализировано должным образом, запись журнала событий **RPCPROXY с \_ \_ \_ неправильными \_ настройками \_ (0XC0000008)** будет записана в журнал событий Windows.



| Поле идентификатора | Требование | Описание                                                                                                                                                                                                                                                                        |
|------------------|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ServerID         | Обязательно    | Разрешаемое сетевое имя для сервера. Это может быть DNS-имя, имя NetBIOS или IP-адрес.                                                                                                                                                                                |
| ServerPort       | Необязательно    | Указывает порт, прослушиваемый сервером на наличие подключений RPC/HTTP. Если этот параметр не указан, для поиска порта сервера используется средство сопоставления конечных точек на компьютере сервера.                                                                                                         |
| лбспорт          | Необязательно    | Указывает порт, на котором сервер прослушивает ФУНТы. Чтобы использовать этот ключ, для интерфейсов ФУНТа необходимо задать статическую конечную точку с помощью команды брандмауэра Netsh RPC. Примеры команды Netsh см. в разделе [рекомендации по балансировке нагрузки](load-balancing-best-practices.md) . |



 

## <a name="optional-registry-keys"></a>Необязательные разделы реестра

Существует три дополнительных значения реестра для настройки сервера фунтов. Ключи в основном контролируют уровень безопасности для вызовов и от службы фунтов, а также управляют используемым по умолчанию UUID ресурса. Ниже приведены необязательные значения.

Ниже приведено подробное разбиение необходимых разделов и значений реестра.

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCProxy \\ лбсконфигуратион \\ Security**

DWORD. Если параметр **DWORD отсутствует** или имеет значение 0, входящие небезопасные вызовы службы фунтов отклоняются. Если он есть, а не 0, входящие небезопасные вызовы службы фунтов не отклоняются. Этот ключ считывается один раз при запуске службы фунтов.

\-

**HKLM \\ Software \\ Microsoft \\ RPC \\ RPCProxy \\ лбсконфигуратион \\ ассумересаурцеууид**

DWORD. Если в **ассумересаурцеууид** DWORD нет изменений в службе фунтов, возникает ошибка. При его наличии необходимо задать допустимый [**UUID**](./rpcdce/ns-rpcdce-uuid.md). Этот **UUID** будет использоваться как идентификатор UUID ресурса для всех подключений, не указывающих UUID ресурса. Это часто используется в случаях, когда клиенты не указывают UUID ресурса при создании привязки RPC/HTTP, но администратор хочет сбалансировать нагрузку трафика RPC/HTTP с фермой серверов. Если этот ключ не может быть проанализирован в UUID, внутренняя ошибка RPC — это лоджед, создающая [**\_ Расширенные \_ \_ сведения об ошибке RPC**](/windows/win32/api/rpcasync/ns-rpcasync-rpc_extended_error_info) , если она включена.

\-

**HKLM \\ Software \\ Microsoft \\ RPC \\ рпчттплбссервер \\ Security**

DWORD. Если параметр **DWORD не** представлен или установлен в значение 0, то все исходящие вызовы, выполненные в фунтах служб, будут иметь безопасность. Если параметр существует и не имеет значение 0, то все исходящие вызовы к службам ФУНТа не будут иметь безопасности. Убедитесь, что этот параметр соответствует параметру **HKLM \\ Software \\ Microsoft \\ RPC \\ RPCProxy \\ лбсконфигуратион \\ Security** .

 

 