---
title: Функция type_UserSize
description: Функция Type \_ усерсизе — это вспомогательная функция для атрибутов \ "\ проводное \_ маршалирование \" и \ "пользовательское \_ маршалирование \".
ms.assetid: 74a46418-1a02-47ed-a3ab-35f3364cc38f
keywords:
- type_UserSize
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2f997d12e11f643eb2faf9990454a8508d15636
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122886037"
---
# <a name="the-type_usersize-function"></a>Тип \_ Усерсизе функция

Функция **&lt; Type &gt; \_ усерсизе** является вспомогательной функцией для \[ атрибутов [ \_ маршалирования](/windows/desktop/Midl/wire-marshal) \] и \[ [ \_ маршалирования пользователя](/windows/desktop/Midl/user-marshal) \] . Заглушки вызывают эту функцию для изменения размера буфера данных RPC для объекта данных пользователя перед упаковкой данных на стороне клиента или сервера. Функция определяется следующим образом:

``` syntax
unsigned long __RPC_USER  <type>_UserSize(
    unsigned long __RPC_FAR * pFlags,
    unsigned long StartingSize,
    <type>  __RPC_FAR *pMyObj);
```

&lt;Тип &gt; в имени функции означает усерм-тип, как указано в **\[ \_ \]** определении типа маршалирования или **\[ пользовательской \_ упаковки \]** . Этот тип может быть непригодным или даже при использовании с атрибутом **\[ пользовательской \_ маршалирования \]** , неизвестным компилятору MIDL. Имя типа провода (имя типа, переданного по сети) не используется в прототипе функции. Однако обратите внимание, что тип провода определяет макет для данных, как указано в использование DCE. Все данные должны быть преобразованы в формат представления данных сети (NDR).

Параметр *пфлагс* является указателем на **беззнаковое поле с длинным** флагом. Верхнее слово флага содержит флаги формата NDR в соответствии с определением использование DCE для чисел с плавающей запятой, порядка байтов и символьных представлений. В нижнем слове содержится флаг контекста маршалирования, определенный в канале COM. Точная структура флагов в поле показана в следующей таблице.



| Bits  | Флаг                                  | Значение                                                                                     |
|-------|---------------------------------------|-------------------------------------------------------------------------------------------|
| 31-24 | Представление с плавающей запятой         | 0 = IEEE 1 = VAX 2 = Cray 3 = IBM                                                         |
| 23-20 | Последовательность байтов и чисел с плавающей запятой | 0 = Big с обратным порядком байтов 1 = с прямым порядком байтов                                                          |
| 19-16 | Символьное представление              | 0 = ASCII 1 = EBCDIC                                                                      |
| 15-0  | Флаг контекста маршалирования               | 0 = МШКТКС \_ Local 1 = мшкткс \_ ношаредмем 2 = мшкткс \_ ДИФФЕРЕНТМАЧИНЕ 3 = мшкткс \_ INPROC |



 

Флаг контекста маршалинга позволяет изменить поведение подпрограммы в зависимости от контекста вызова RPC. Например, если имеется маркер (**Long**) для блока данных, то можно отправить маркер для внутрипроцессного вызова, но фактические данные будут отправлены для вызова на другой компьютер. Флаг контекста маршалирования и его значения определены в файлах Втипес. h и Втипес. idl в пакете SDK для платформы.

> [!Note]  
> Если тип провода определен правильно, нет необходимости использовать флаги формата NDR, так как модуль NDR выполняет необходимые преобразования.

 

Параметр *стартингсизе* , который является текущим смещением буфера. Начальный размер указывает смещение буфера для объекта пользователя, а также может быть неправильно согласовано. Ваша подпрограммы должна учитывать все необходимое заполнение.

Параметр *пмйобж* является указателем на объект пользовательского типа.

Возвращаемое значение — это новое смещение или позиция буфера. Функция должна возвращать совокупный размер, который является начальным размером, а также возможным заполнением и размером данных.

Функция **&lt; Type &gt; \_ усерсизе** может возвращать переоценку требуемого размера. Фактический размер буфера отправки определяется размером данных, а не размером выделения буфера.

Функция **&lt; Type &gt; \_ усерсизе** не вызывается, если размер сети можно вычислить во время компиляции. Обратите внимание, что для большинства объединений, даже если нет указателей, фактический размер представления подключения можно определить только во время выполнения.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Правила маршалирования для пользовательского \_ маршалирования и передачи проводного \_ маршалирования](marshaling-rules-for-user-marshal-and-wire-marshal.md)
</dt> <dt>

[Пользовательская \_ Упаковка](/windows/desktop/Midl/user-marshal)
</dt> <dt>

[проводное \_ маршалирование](/windows/desktop/Midl/wire-marshal)
</dt> </dl>

 

 
