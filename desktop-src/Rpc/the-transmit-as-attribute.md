---
title: Атрибут transmit_as
description: Атрибут \ "передать \_ как \" предоставляет способ управления упаковкой данных, не беспокоясь о том, что данные маршалируются на низком уровне \ 8212; то есть не беспокойтесь о размерах данных или обмене байтами в разнородной среде.
ms.assetid: 04e670c9-b091-457d-aeca-058cf5b664e8
keywords:
- Удаленный вызов процедур RPC, атрибуты, transmit_as
- transmit_as
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 617422c50bae46de72bac1e548b6f248b19d0cb2436ac0c08b265bbba4f5a6cb
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120016644"
---
# <a name="the-transmit_as-attribute"></a>Атрибут передачи \_ as

Атрибут " **\[** [**передать \_ как**](/windows/desktop/Midl/transmit-as) " **\]** позволяет управлять упаковкой данных, не беспокоясь о необходимости упаковки данных на низком уровне, то есть не беспокоясь о размерах данных или обмене байтами в разнородной среде. Позволяя сократить объем данных, передаваемых по сети, атрибут **\[ передачи \_ As \]** может повысить эффективность работы приложения.

Используйте атрибут **\[ передать \_ как \]** , чтобы указать тип данных, который заглушки RPC будет передавать по сети вместо использования типа данных, предоставленного приложением. Вы предоставляете подпрограммы, которые преобразуют тип данных в тип, используемый для передачи, и из него. Кроме того, необходимо предоставить подпрограммы для высвобождения памяти, используемой для типа данных, и переданного типа. Например, в следующем примере определяется **\_ тип xmit** , как тип данных, передаваемый для всех данных приложения, указанных как **тип \_ Spec**:

``` syntax
typedef [transmit_as (xmit_type)] type_spec type;
```

В следующей таблице описаны четыре названия подпрограмм, предоставляемых программистом. **Type** — это тип данных, известный приложению, а **\_ тип xmit** — тип данных, используемый для передачи.



| Подпрограмма                                                 | Описание                                                                                                                                     |
|---------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| [**Введите \_ \_ xmit**](the-type-to-xmit-function.md)     | Выделяет объект переданного типа и преобразовывает тип приложения в тип, передаваемый по сети (вызывающий объект и вызываемый). |
| [**Тип \_ из \_ xmit**](the-type-from-xmit-function.md) | Преобразует тип переданного переданного типа в тип приложения (вызывающий объект и называемый объектом).                                                                  |
| [**Введите \_ бесплатный \_ inst**](the-type-free-inst-function.md) | Освобождает ресурсы, используемые типом приложения (только вызываемый объект).                                                                              |
| [**Введите \_ бесплатный \_ xmit**](the-type-free-xmit-function.md) | Освобождает хранилище, возвращенное **типом** _\__ в подпрограмму *_\_ xmit_* (вызывающий и вызываемый объект).                                                      |



 

За исключением этих четырех предоставленных программистом функций, передаваемый тип не обрабатывается приложением. Передаваемый тип определяется только для перемещения данных по сети. После преобразования данных в тип, используемый приложением, память, используемая передаваемым типом, освобождается.

Эти подпрограммы, предоставляемые программистом, предоставляются как клиентом, так и серверным приложением на основе атрибутов направления. Если параметр доступен только **\[** [**в**](/windows/desktop/Midl/in) **\]** , клиент передает на сервер. Клиенту требуется **тип \_ для \_ xmit** и **Type \_ Free \_ xmit** functions. Серверу требуется **тип \_ из \_ xmit** и **введите бесплатные функции \_ \_ inst** . Для **\[** [](/windows/desktop/Midl/out-idl) **\]** параметра только для выхода сервер передает клиенту. Серверное приложение должно реализовать **тип \_ для \_ xmit** и **ввести бесплатные функции \_ \_ xmit** , тогда как клиентская программа должна предоставить **тип из функции \_ \_ xmit** . Для временных объектов **\_ типа xmit** заглушка вызывает **Type** _\__ *_Free \_ xmit_* , чтобы освободить память, выделенную вызовом **типа \_ в \_ xmit**.

Некоторые рекомендации относятся к экземпляру типа приложения. Если тип приложения является указателем или содержит указатель, то **тип** \_ **из подпрограммы \_ xmit** должен выделить память для данных, на которые указывает указатель (сам объект типа приложения управляется заглушкой обычным способом).

Для исходящих **\[ \] и \]** исходящих параметров или одного из компонентов типа, содержащего атрибут « **\[ передать \_ как \]** », автоматически вызывается подпрограммы **Type** Free **inst для объектов данных, имеющих атрибут. \[ \]** \_ **\_** Для **входных** параметров подпрограммы **типа** \_ **Free \_ inst** вызываются только в том случае, если к параметру был применен атрибут **\[ передачи \_ As \]** . Если атрибут применен к компонентам параметра, то подпрограммы **Type** \_ **Free \_ inst** не вызываются. Отсутствуют свободные вызовы для внедренных данных и один вызов (связанный с атрибутом верхнего уровня) для параметра только **в** .

Начиная с MIDL 2,0, клиент и сервер должны предоставлять все четыре функции. Например, связанный список может передаваться как массив размеров. Подпрограммы с **типом \_ to \_ xmit** просматривает связанный список и копирует упорядоченные данные в массив. Элементы массива упорядочены таким образом, что многие указатели, связанные со структурой списка, не должны передаваться. **Тип из подпрограммы \_ \_ xmit** считывает массив и помещает его элементы в структуру связанного списка.

Список с двойным связыванием ( \_ список прямых ссылок \_ ) включает данные и указатели на элементы списка "Предыдущий" и "следующий":

``` syntax
typedef struct _DOUBLE_LINK_LIST 
{
    short sNumber;
    struct _DOUBLE_LINK_LIST * pNext;
    struct _DOUBLE_LINK_LIST * pPrevious;
} DOUBLE_LINK_LIST;
```

Вместо того чтобы передавать сложную структуру, **\[** атрибут [**передачи \_ as**](/windows/desktop/Midl/transmit-as) **\]** можно использовать для отправки его по сети в качестве массива. Последовательность элементов в массиве удерживает порядок элементов в списке по меньшей цене:

``` syntax
typedef struct _DOUBLE_XMIT_TYPE 
{
    short sSize;
    [size_is(sSize)] short asNumber[];
} DOUBLE_XMIT_TYPE;
```

Атрибут **\[ передачи \_ As \]** отображается в IDL-файле:

``` syntax
typedef [transmit_as(DOUBLE_XMIT_TYPE)]  DOUBLE_LINK_LIST DOUBLE_LINK_TYPE;
```

В следующем примере **модифилистпрок** определяет параметр типа Double \_ Link \_ типа **\[ в \]** качестве параметра out:

``` syntax
void ModifyListProc([in, out] DOUBLE_LINK_TYPE * pHead)
```

Четыре определяемые программистом функции используют имя типа в именах функций и при необходимости используют представленные и передаваемые типы в качестве типов параметров:

``` syntax
void __RPC_USER DOUBLE_LINK_TYPE_to_xmit ( 
    DOUBLE_LINK_TYPE __RPC_FAR * pList, 
    DOUBLE_XMIT_TYPE __RPC_FAR * __RPC_FAR * ppArray);

void __RPC_USER DOUBLE_LINK_TYPE_from_xmit ( 
    DOUBLE_XMIT_TYPE __RPC_FAR * pArray,
    DOUBLE_LINK_TYPE __RPC_FAR * pList);

void __RPC_USER DOUBLE_LINK_TYPE_free_inst ( 
    DOUBLE_LINK_TYPE __RPC_FAR * pList);

void __RPC_USER DOUBLE_LINK_TYPE_free_xmit ( 
    DOUBLE_XMIT_TYPE __RPC_FAR * pArray);
```

 

 