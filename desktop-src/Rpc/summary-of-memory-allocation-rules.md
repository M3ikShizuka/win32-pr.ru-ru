---
title: Сводка правил выделения памяти
description: В следующей таблице перечислены ключевые правила выделения памяти.
ms.assetid: 0c1f8398-75e6-45ec-a9f9-9dcdbe21c24d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f9403bb5057b2004d966c0634bc101a3282fe92
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134242"
---
# <a name="summary-of-memory-allocation-rules"></a>Сводка правил выделения памяти

В следующей таблице перечислены ключевые правила выделения памяти.



| MIDL, элемент                                                                                                                                           | Описание                                                                                                                                                           |
|--------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \[ [Ссылочные](/windows/desktop/Midl/ref) \] указатели верхнего уровня                                                                                                                | Должны быть указатели, отличные от NULL.                                                                                                                                            |
| Возвращаемое значение функции                                                                                                                                  | Для возвращаемых значений указателей всегда выделяется новая память.                                                                                                             |
| \[Указатель " [уникальный](/windows/desktop/Midl/unique)", " [out](/windows/desktop/Midl/out-idl) " \] или " \[ [ptr](/windows/desktop/Midl/ptr) \] "                                                                   | Не разрешено MIDL.                                                                                                                                                  |
| Не относящийся к верхнему уровню \[ [уникальный](/windows/desktop/Midl/unique), [в](/windows/desktop/Midl/in), [выходной](/windows/desktop/Midl/out-idl) \] или \[ [ptr](/windows/desktop/Midl/ptr)- \] указатель, изменяющий значение NULL на значение, отличное от NULL | Клиентские заглушки выделяют новую память на стороне клиента при возврате.                                                                                                                 |
| Не относящийся к верхнему уровню \[ [уникальный](/windows/desktop/Midl/unique)указатель [](/windows/desktop/Midl/out-idl) [в](/windows/desktop/Midl/in), \] изменяющий значение, отличное от NULL, на null                                 | Память на клиенте потеряна. клиентское приложение отвечает за освобождение памяти и предотвращает утечки.                                                              |
| Указатель на неверхний уровень \[ указателя [ptr](/windows/desktop/Midl/ptr), [в](/windows/desktop/Midl/in), [](/windows/desktop/Midl/out-idl) \] который изменяет значения, отличные от NULL, на null                                       | Память будет потеряна на стороне клиента, если она не имеет псевдонима. клиентское приложение отвечает за освобождение и предотвращение утечек памяти в этом случае.                             |
| \[[ссылка](/windows/desktop/Midl/ref) \] указател                                                                                                                           | Уровень клиент-приложение обычно выделяется.                                                                                                                           |
| Не равно NULL \[ [](/windows/desktop/Midl/in), [](/windows/desktop/Midl/out-idl) \] указатель                                                                                                | Заглушки пытаются выполнить запись в существующее хранилище на клиенте. Если **\[ строка \]** и размер увеличиваются сверх размера, выделенного на клиенте, это вызовет сбой групповой политики при возврате. |



 

В следующей таблице приводится сводка влияния ключевых атрибутов IDL и ACF на управление памятью.



| MIDL, функция                                                                   | Проблемы с клиентом                                                                                                                                  | Проблемы с сервером                                                                                                                 |
|--------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| \[[выделение](/windows/desktop/Midl/allocate)(один \_ узел) \] , \[ выделение (все \_ узлы)\]         | Определяет, выполняется ли один или несколько вызовов функций памяти.                                                                         | То же, что и клиент, за исключением частной памяти, часто можно использовать для выделения (одного \_ узла) \[ в \] \[ данных и в \] .               |
| \[выделение (бесплатное) \] или \[ выделение (не \_ бесплатное)\]                                 | (Нет; влияет на сервер.)                                                                                                                        | Определяет, освобождается ли память на сервере после каждого вызова удаленной процедуры.                                            |
| атрибуты массива \[ [Max \_ имеют](/windows/desktop/Midl/max-is) \] \[ [размер \_ ](/windows/desktop/Midl/size-is) и\] | (Нет; влияет на сервер.)                                                                                                                        | Определяет размер выделяемой памяти.                                                                                    |
| \[[ \_ число байтов](/windows/desktop/Midl/byte-count)\]                                            | Клиент должен выделить буфер; заглушки клиента не выделяются или освобождаются.                                                                           | Атрибут параметра ACF определяет размер буфера, выделенного на сервере.                                                        |
| \[[включить \_ выделение](/windows/desktop/Midl/enable-allocate)\]                                  | Обычно нет. Однако клиент может использовать другую среду управления памятью.                                                     | Сервер использует другую среду управления памятью. [**Рпксмаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) следует использовать для выделения памяти. |
| \[[в](/windows/desktop/Midl/in) \] версию                                                    | Клиентское приложение, ответственное за выделение памяти для данных.                                                                                 | Выделено на сервере заглушками.                                                                                                 |
| \[[исходящий трафик](/windows/desktop/Midl/out-idl) \] версию                                             | Выделено на стороне клиента заглушками.                                                                                                                  | \[[исходящий трафик](/windows/desktop/Midl/out-idl) \] -Указатель должен быть \[ [](/windows/desktop/Midl/ref) \] указателем ref; выделен на сервере заглушками.                       |
| \[[ссылка](/windows/desktop/Midl/ref) \] версию                                                 | Память, на которую ссылается указатель, должна быть выделена клиентским приложением.                                                                          | Ссылочные указатели верхнего уровня и первого уровня, управляемые заглушками.                                                                |
| \[[уникальный](/windows/desktop/Midl/unique) \] версию                                           | Значение null, отличное от NULL, может привести к потере памяти. значение null, отличное от NULL, приводит к тому, что клиентская заглушка вызывает [ \_ \_ выделять пользователю MIDL](/windows/desktop/Midl/midl-user-allocate-1). | (Затрагивает клиент.)                                                                                                             |
| \[[ptr](/windows/desktop/Midl/ptr) \] -записи версию                                                 | (См \[ . [уникальный](/windows/desktop/Midl/unique) \] .)                                                                                                              | (См \[ . [уникальный](/windows/desktop/Midl/unique) \] .)                                                                                             |



 

 

 