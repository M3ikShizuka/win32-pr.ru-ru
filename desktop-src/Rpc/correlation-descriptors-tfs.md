---
title: Дескрипторы корреляции
description: Дескриптор корреляции — это строка формата, описывающая выражение, основанное на одном аргументе, связанном с другим аргументом.
ms.assetid: 9f5f5077-d6a9-4253-bddf-b8cd0c868973
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35f13f0793b99b80b7abb0b493c249b30ad53d76
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103891017"
---
# <a name="correlation-descriptors"></a>Дескрипторы корреляции

Дескриптор корреляции — это строка формата, описывающая выражение, основанное на одном аргументе, связанном с другим аргументом. Дескриптор корреляции необходим для обработки семантики, связанной с такими атрибутами, как \[ **size \_ — ()** \] , \[ **length \_ — ()** \] , \[ **Switch \_ имеет значение ()** , \] а \[ **IID \_ — ()** \] . Дескрипторы корреляции используются с массивами, указателями на размеры, объединениями и указателями на интерфейсы. Конечным значением выражения может быть размер, длина, discriminant объединения или указатель на IID соответственно. В терминах строк формата дескрипторы корреляции используются с массивами, объединениями и указателями интерфейсов. Указатель размера описывается в разделе строки формата как указатель на массив.

Существует две подпрограммы, выполняющие базовые вычисления выражений: Ндрпкомпутеконформанце используется для размеров, переключателей и IID, \* когда ндрпкомпутеварианце используется для длины. Существует также одна подпрограммы для проверки значения корреляции для функции отказа от атак.

Дескрипторы корреляции предназначены для поддержки только очень ограниченных выражений. В сложных ситуациях компилятор создает подпрограмму вычисления выражения, вызываемую ядром при необходимости.

Дескриптор корреляции имеет следующий формат:

``` syntax
correlation_type<1>
correlation_operator<1>
offset<2>
[robust_flags<2>]
```

Тип корреляции дескриптора корреляции \_<1> состоит из двух частей: 4 верхних бита описывают, где можно найти выражение, а младшие 4 бита описывают тип значения выражения.

Верхняя часть может иметь одно из следующих пяти значений:

``` syntax
00  FC_NORMAL_CONFORMANCE
10  FC_POINTER_CONFORMANCE
20  FC_TOP_LEVEL_CONFORMANCE
80  FC_TOP_LEVEL_MULTID_CONFORMANCE
40  FC_CONSTANT_CONFORMANCE
```

<dl> <dt>

<span id="FC_NORMAL_CONFORMANCE"></span><span id="fc_normal_conformance"></span>\_стандартное \_ соответствие FC
</dt> <dd>

Обычная ситуация соответствия, например, описанная в поле структуры.

</dd> <dt>

<span id="FC_POINTER_CONFORMANCE"></span><span id="fc_pointer_conformance"></span>\_соответствие указателей FC \_
</dt> <dd>

Для указателей с атрибутами (**size \_ — ()**, **length \_ — ()**), которые являются полями в структуре. Это влияет на способ установки указателя базовой памяти.

</dd> <dt>

<span id="FC_TOP_LEVEL_CONFORMANCE"></span><span id="fc_top_level_conformance"></span>\_соответствие верхнего \_ уровня \_ FC
</dt> <dd>

Для соответствия верхнего уровня, описываемого другим параметром.

</dd> <dt>

<span id="FC_TOP_LEVEL_MULTID_CONFORMANCE"></span><span id="fc_top_level_multid_conformance"></span>\_ \_ \_ многофункциональное соответствие высокого уровня FC \_
</dt> <dd>

Для соответствия верхнего уровня многомерного массива, описываемого другим параметром.

> [!Note]  
> Многомерные массивы и указатели активируют переключение на [**– оикф**](/windows/desktop/Midl/-oi).

 

</dd> <dt>

<span id="FC_CONSTANT_CONFORMANCE"></span><span id="fc_constant_conformance"></span>\_постоянное \_ соответствие FC
</dt> <dd>

Для постоянного значения. Компилятор предварительно вычисляет значение из константного выражения, предоставленного пользователем. В этом случае последующие 3 байта в описании соответствия содержат более 3 байта с длинным описанием размера соответствия. Дальнейшие вычисления не требуются.

</dd> </dl>

Нижняя часть дает тип значения, которое необходимо извлечь из памяти:

``` syntax
FC_LONG | FC_ULONG | 
FC_SHORT | FC_USHORT | 
FC_SMALL | FC_USMALL | 
FC_HYPER
```

> [!Note]
> 64-битовые выражения не поддерживаются. FC \_ Hyper используется только для **IID \_ — ()** на 64-разрядных платформах для извлечения значения указателя для IID \* .
>
> Компилятор устанавливает тип, равный нулю, для следующих случаев: константное выражение, упомянутое выше, и когда необходимо вызывать подпрограмму выражения вычисления, например, когда \_ используются постоянная \_ согласованность FC и \_ ответный вызов FC.

 

Размер \_ — \_ Op<1> поле позволяет применить одну из следующих операций к переменной соответствия:

``` syntax
FC_DEREFERENCE | 
FC_DIV_2 | FC_MULT_2 | FC_SUB_1 | FC_ADD_1 | 
FC_CALLBACK
```

\_Константа разыменования FC используется для связи с точкой, например для **\[ размера \_ ( \* pL) \]**. Арифметические операторы просто используют указанную константу. \_Константа обратного вызова FC указывает, что необходимо вызвать подпрограмму вычисления выражения.

Поле offset<2> обычно является относительным смещением памяти для переменной аргумента выражения. Это также может быть вычисление выражения — индекс подпрограммы. Как упоминалось ранее в этом документе, для константных выражений это часть фактического, завершающего значения выражения.

Интерпретация поля offset<2> в качестве смещения памяти зависит от сложности выражения, расположения переменной выражения и в случае массива, независимо от того, является ли массив указателем с атрибутом.

Если массив является указателем с атрибутами, а переменная соответствия является полем в структуре, Поле Offset содержит смещение от начала структуры до поля, описывающего соответствие. Если массив не является указателем с атрибутом, а переменная соответствия является полем в структуре, Поле Offset содержит смещение от конца несогласованной части структуры к полю, описывающему соответствие. Как правило, согласованный массив находится в конце структуры.

Для соответствия верхнего уровня поле offset содержит смещение от расположения первого параметра заглушки в стеке с параметром, описывающим соответствие. Он не используется в режиме **операционной системы** . Существуют другие исключения для интерпретации поля смещения. такие исключения описаны в описании этих типов.

Если offset<2> используется с \_ обратным вызовом FC, он содержит индекс в таблице подпрограммы вычисления выражений, созданной компилятором. Сообщение-заглушку передается в подпрограмму оценки, которая затем выполняет вычисление значения соответствия и присваивает его полю MaxCount сообщения-заглушки.

\_Для Windows 2000 был добавлен надежный флаг<2> для поддержки [**/robust**](/windows/desktop/Midl/-robust), например функции «отказ в атаке». В первом байте определены следующие флаги:

``` syntax
typedef  struct  _NDR_CORRELATION_FLAGS
  {
  unsigned char   Early     : 1;
  unsigned char   Split     : 1;
  unsigned char   IsIidIs   : 1;
  unsigned char   DontCheck : 1;
  unsigned char   Unused    : 4;
  } NDR_CORRELATION_FLAGS;
```

Ранний флаг означает раннее и позднее корреляцию. Ранняя корреляция заключается в том, что аргумент выражения предшествует описанному аргументу, например, аргумент размера находится перед аргументом указателя размера. Позднее корреляция происходит, когда аргумент выражения поступает после связанного аргумента. Подсистема выполняет проверку значений раннего корреляции прямо сейчас. значения поздней корреляции сохраняются для проверки после завершения распаковки.

Флаг разбиения указывает на асинхронное разбиение между \[ \] \[ аргументами in и out \] . Например, аргумент размера может быть в, \[ \] пока указатель имеет размер \[ \] . В асинхронном контексте DCOM эти аргументы находятся в разных стеках, поэтому подсистема должна быть осведомлена об этом.

Флаг Исиидис указывает, что **IID \_ имеет значение ()** корреляции. Подпрограммы Ндркомпутеконформанце привлекают указатель на IID в качестве значения выражения, но подпрограммы проверки не могут сравнивать такие значения (они будут указателями), поэтому флаг указывает на необходимость сравнения фактического идентификаторов IID.

### <a name="variance-description-and-other-array-attributes"></a>Описание дисперсии и другие атрибуты массива

Формат поля Описание дисперсии идентичен полю описание соответствия. Разница заключается в том, что модуль доставки NDR использует другое поле сообщения-заглушки как временную переменную. В случае с описанием дисперсии это оцениваемая длина, и соответствующее поле называется Актуалленгс.

С вариативностью начальное смещение обычно равно нулю и подсистема настроена соответствующим образом. Если к стандартному массиву применяется **первый атрибут \_ ()** , то принудительный обратный вызов подпрограммы вычисления выражения является обязательным.

 

 