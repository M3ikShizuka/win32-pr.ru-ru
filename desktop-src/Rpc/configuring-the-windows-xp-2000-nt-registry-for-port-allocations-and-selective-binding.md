---
title: Настройка реестра для выделения портов и выборочной привязки
description: начиная с Windows 2000, для установки привязок следует использовать служебную программу в пакете Windows resource Kit с именем Rpccfg.exe. дополнительные сведения см. в пакете Windows resource Kit для соответствующей версии операционной системы.
ms.assetid: a33b51e7-2ded-46bd-aadb-27cbd99e1029
keywords:
- Удаленный вызов процедур RPC, задачи, Настройка реестра для выделения портов и выборочная привязка
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8166e9cb4d6706e8eafb016fba309eb64a4c4910b5727bcf88c2e071a7077d70
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118931251"
---
# <a name="configuring-the-registry-for-port-allocations-and-selective-binding"></a>Настройка реестра для выделения портов и выборочной привязки

начиная с Windows 2000, для установки привязок следует использовать служебную программу в пакете Windows resource Kit с именем Rpccfg.exe. дополнительные сведения см. в пакете Windows resource Kit для соответствующей версии операционной системы.

для версий windows, предшествовавших Windows 2000, в разделах реестра в следующей таблице указаны системные значения по умолчанию для динамического выделения портов и привязки к сетевым картам на многосетевых компьютерах. Сначала необходимо создать эти ключи, а затем указать соответствующие параметры.

Применение функции [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) влияет на эти параметры. Разработчикам следует ознакомиться с параметрами реестра, описанными в этом разделе, и функцией **рпксерверусепротсекекс** при управлении выделением портов. Пример с тремя гипотетическыми приложениями следует таблицей ниже и иллюстрирует взаимодействие этих параметров и функции **рпксерверусепротсекекс** .

Если ключ отсутствует или содержит недопустимое значение, вся конфигурация помечается как недопустимая, и все вызовы **рпксерверусепротсек \** _ через [_ *нкакн \_ IP \_ TCP* *](/windows/desktop/Midl/ncacn-ip-tcp) или [**нкадг \_ IP \_ UDP**](/windows/desktop/Midl/ncadg-ip-udp) завершатся сбоем.

> [!Note]  
> Порты, выделенные для процесса, остаются выделенными до тех пор, пока процесс не завершится. Если все доступные порты используются, функция возвращает RPC \_ S \_ \_ из \_ ресурсов.

 



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Ключ порта</th>
<th>Тип данных</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Rpc
            Internet
               Ports</code></pre></td>
<td><strong>REG_MULTI_SZ</strong></td>
<td>Указывает набор диапазонов IP-портов, состоящий из всех портов, доступных из Интернета, или всех портов, недоступных через Интернет. Каждая строка представляет один порт или включающий набор портов (например, 1000-1050, 1984). Если какие бы то ни было записи находятся вне диапазона от 0 до 65535 или если любая строка не может быть интерпретирована, то во время выполнения RPC вся конфигурация будет считаться недопустимой.</td>
</tr>
<tr class="even">
<td><pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Rpc
            Internet
               PortsInternetAvailable</code></pre></td>
<td><strong>REG_SZ</strong></td>
<td>Y или N (без учета регистра). Если да, порты, перечисленные в разделе Ports, являются портами, доступными через Интернет на этом компьютере. Если N, порты, перечисленные в разделе Ports, являются портами, которые не являются доступными в Интернете.</td>
</tr>
<tr class="odd">
<td><pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Rpc
            Internet
               UseInternetPorts</code></pre></td>
<td><strong>REG_SZ</strong></td>
<td>Y или N (без учета регистра). Задает системную политику по умолчанию. Если да, то процессам, использующим значение по умолчанию, назначаются порты из набора портов, доступных в Интернете, как определено выше. Если N, то для процессов, использующих значение по умолчанию, будут назначены порты из набора портов только для интрасети.</td>
</tr>
<tr class="even">
<td><pre data-space="preserve"><code>HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Services
            Rpc
               Linkage
                  Bind</code></pre></td>
<td><strong>REG_MULTI_SZ</strong></td>
<td>Список имен устройств всех сетевых адаптеров, по умолчанию которые привязаны (например, \Device\AMDPCN1). Если ключ не существует, сервер будет привязан ко всем сетевым картам. Если ключ существует, сервер будет привязан к сетевым адаптерам, указанным в ключе, если для поля Никфлагс не задано значение RPC_C_BIND_TO_ALL_NICS. Если ключ имеет значение null ( &quot; &quot; ), то конфигурация будет помечена как недопустимая и все вызовы <strong>рпксерверусепротсек *</strong> через <a href="/windows/desktop/Midl/ncacn-ip-tcp"><strong>ncacn_ip_tcp</strong></a> или <a href="/windows/desktop/Midl/ncadg-ip-udp"><strong>ncadg_ip_udp</strong></a> завершатся ошибкой.</td>
</tr>
</tbody>
</table>



 

В следующей таблице показано, как на три примера приложений влияют параметры, определенные в предыдущей таблице, а также влияние на параметры, применяемые с помощью функции [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) .

В этом примере рассматриваются три гипотетических приложения:

-   Интернетапп: это приложение предназначено для работы в Интернете, и \_ \_ \_ \_ в элементе **ендпоинтфлагс** структуры [**\_ политики RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_policy) , переданном в функцию [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) , указан порт Интернета, используемый RPC C.
-   Локалапп: это приложение не предназначено для доступа к Интернету и указало \_ \_ \_ порт интрасети RPC C \_ в члене **ендпоинтфлагс** структуры [**\_ политики RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_policy) , передаваемой функции [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) .
-   DefaultApp: это приложение задает ноль в члене **ендпоинтфлагс** структуры [**\_ политики RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_policy) , передаваемой функции [**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex) .

В следующей таблице объясняется влияние этих параметров на значения, указанные в записях реестра, описанных в предыдущей таблице. При форматировании необходимо назначить следующие коды:

PIA = Портсинтернетаваилабле значение ключа

УиП = значение ключа Усеинтернетпортс

Значение ключа ports для этого примера — 5000-5100 для каждой записи.



| Развертывание | основная сборка взаимодействия | уип | Результат                                  |
|-------------|-----|-----|-----------------------------------------|
| интернетапп | Да   | Да   | Использует порты от 5000 до 5100        |
| локалапп    | Да   | Да   | Использует порт за пределами диапазона 5000-5100 |
| DefaultApp  | Да   | Да   | Использует порты от 5000 до 5100        |
| интернетапп | Д   | Нет   | Использует порты от 5000 до 5100        |
| локалапп    | Д   | Нет   | Использует порт за пределами диапазона 5000-5100 |
| DefaultApp  | Д   | Нет   | Использует порт за пределами диапазона 5000-5100 |
| интернетапп | Нет   | Д   | Использует порт за пределами диапазона 5000-5100 |
| локалапп    | Нет   | Д   | Использует порты от 5000 до 5100        |
| DefaultApp  | Нет   | Д   | Использует порт за пределами диапазона 5000-5100 |
| интернетапп | Нет   | Нет   | Использует порт за пределами диапазона 5000-5100 |
| локалапп    | Нет   | Нет   | Использует порты от 5000 до 5100        |
| DefaultApp  | Нет   | Нет   | Использует порты от 5000 до 5100        |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**\_Политика RPC**](/windows/desktop/api/Rpcdce/ns-rpcdce-rpc_policy)
</dt> <dt>

[**рпксерверусеаллпротсексекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsex)
</dt> <dt>

[**рпксерверусеаллпротсексифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseallprotseqsifex)
</dt> <dt>

[**рпксерверусепротсекекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqex)
</dt> <dt>

[**рпксерверусепротсекепекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)
</dt> <dt>

[**рпксерверусепротсекифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqifex)
</dt> <dt>

[**нкакн \_ IP \_ TCP**](/windows/desktop/Midl/ncacn-ip-tcp)
</dt> <dt>

[**нкадг \_ IP \_ UDP**](/windows/desktop/Midl/ncadg-ip-udp)
</dt> </dl>

 

 