---
title: Как работает RPC
description: Средства удаленного вызова процедур делают его пользователям, как будто клиент напрямую вызывает процедуру, расположенную в удаленной серверной программе.
ms.assetid: 265f31b8-9a41-4255-b070-fd50b00b935b
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12832d0de4eb972bb1d9d51df0c871191d4d079a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103777369"
---
# <a name="how-rpc-works"></a>Как работает RPC

Средства удаленного вызова процедур делают его пользователям, как будто клиент напрямую вызывает процедуру, расположенную в удаленной серверной программе. У каждого клиента и сервера есть свои адресные пространства; то есть каждый из них имеет свой собственный ресурс памяти, выделенный для данных, используемых процедурой. На следующем рисунке показана архитектура RPC.

![Архитектура RPC](images/prog-a11.png)

Как показано на рисунке, клиентское приложение вызывает локальную процедуру-заглушку вместо фактического кода, реализующего процедуру. Заглушки компилируются и связываются с клиентским приложением. Вместо того, чтобы содержать фактический код, реализующий удаленную процедуру, код заглушки клиента:

-   Извлекает необходимые параметры из адресного пространства клиента.
-   Преобразует необходимые параметры в стандартный формат NDR для передачи по сети.
-   Вызывает функции в клиентской библиотеке времени выполнения RPC для отправки запроса и его параметров на сервер.

Для вызова удаленной процедуры сервер выполняет следующие действия.

1.  Функции библиотеки времени выполнения RPC сервера принимают запрос и вызывают процедуру заглушки сервера.
2.  Заглушка сервера извлекает параметры из сетевого буфера и преобразует их из формата передачи сети в формат, который требуется серверу.
3.  Заглушка сервера вызывает фактическую процедуру на сервере.

Затем выполняется удаленная процедура, которая, возможно, создает выходные параметры и возвращаемое значение. После завершения удаленной процедуры аналогичная последовательность действий возвращает клиенту данные.

1.  Удаленная процедура возвращает свои данные в заглушку сервера.
2.  Заглушка сервера преобразует выходные параметры в формат, необходимый для передачи по сети, и возвращает их в функции библиотеки времени выполнения RPC.
3.  Функции библиотеки времени выполнения RPC сервера передают данные в сети клиентскому компьютеру.

Клиент завершает процесс, принимая данные по сети и возвращая их вызывающей функции.

1.  Библиотека времени выполнения RPC клиента получает возвращаемые из удаленной процедуры значения и возвращает их в клиентскую заглушку.
2.  Клиентская заглушка преобразует данные из отчета о недоставке в формат, используемый клиентским компьютером. Заглушка записывает данные в память клиента и возвращает результат вызывающей программе на клиенте.
3.  Вызывающая процедура продолжится, как если бы процедура была вызвана на том же компьютере.

Библиотеки времени выполнения предоставляются в двух частях: библиотеку импорта, которая связана с приложением и библиотекой времени выполнения RPC, которая реализована как библиотека динамической компоновки (DLL).

Серверное приложение содержит вызовы функций библиотеки времени выполнения сервера, которые регистрируют интерфейс сервера и позволяют серверу принимать удаленные вызовы процедур. Серверное приложение также содержит удаленные процедуры, связанные с конкретным приложением, которые вызываются клиентскими приложениями.

 

 




