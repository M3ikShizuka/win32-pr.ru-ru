---
title: Функция midl_user_allocate
description: '\_ \_ Функция пользовательского выделения MIDL — это процедура, которая должна быть предоставлена разработчиками приложений RPC.'
ms.assetid: 3def405c-da05-4cce-9dc4-499864a0de6e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b2e3196de79992f5856b7117b25f05ad782d26
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134239"
---
# <a name="the-midl_user_allocate-function"></a>\_ \_ Функция пользовательского выделения MIDL

Функция **\_ пользовательского \_ выделения MIDL** — это процедура, которая должна быть предоставлена разработчиками приложений RPC. Она выделяет память для заглушек RPC и подпрограмм библиотеки. Функция **\_ \_ выделения пользователем MIDL** должна соответствовать следующему прототипу:

``` syntax
void __RPC_FAR * __RPC_USER midl_user_allocate (size_t cBytes);
```

Параметр *кбитес* указывает число байтов для выделения. Как клиентские приложения, так и серверные приложения должны реализовать функцию **\_ пользовательского \_ выделения MIDL** , если не выполняется компиляция в режиме использование-Compatibility (/ОСФ). Приложения и созданные заглушки вызывают **пользователь MIDL, который \_ \_ выделяется** напрямую или косвенно для управления выделенными объектами. Пример:

-   Клиентские и серверные приложения вызывают вызов **\_ пользователю MIDL \_** для выделения памяти для приложения, например при создании нового узла в дереве или связанном списке.
-   Заглушка сервера вызывает метод **MIDL, \_ \_ выделяющий пользователя** при демаршалировании данных в адресное пространство сервера.
-   Клиентская заглушка вызывает метод **MIDL, \_ \_ выделяющий пользователя** при демаршалировании данных с сервера, на который ссылается \[ \] указатель out. Обратите внимание, что для \[ в \] , \[ \] и \[ уникальных \] указателей клиентская заглушка вызывает метод **MIDL \_ User, \_ выделяющий** , только если \[ значение уникального \] указателя было равно null во входных данных и при вызове изменяется значение, отличное от NULL. Если \[ \] во входных данных для уникального указателя задано значение, отличное от NULL, клиентская заглушка записывает связанные данные в существующую память.

Если **\_ пользователю MIDL \_** не удается выделить память, он должен вернуть пустой указатель.

Функция пользовательского выделения MIDL должна возвращать 8-байтный **\_ \_ выделенный** указатель.

Например, примеры программ, предоставляемые пакетом средств разработки программного обеспечения платформы (SDK), реализуют **\_ Пользовательский интерфейс \_ MIDL** с точки зрения функции C [**malloc**](pointers-and-memory-allocation.md):


```C++
void __RPC_FAR * __RPC_USER midl_user_allocate(size_t cBytes)
{
    return((void __RPC_FAR *) malloc(cBytes));
}
```



> [!Note]  
> Если пакет RPCSS включен (например, в результате использования \[ атрибута [**включить \_ выделение**](/windows/desktop/Midl/enable-allocate) \] ), используйте [**рпксмаллокате**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcsmallocate) для выделения памяти на стороне сервера. Дополнительные сведения о \[ **включении \_ выделения** см \] . в [справочнике по MIDL](/windows/desktop/Midl/midl-language-reference).

 

 

 