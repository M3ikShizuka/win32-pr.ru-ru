---
title: Разработка приложений RPC-Message Queuing
description: Чтобы воспользоваться преимуществами транспорта MSMQ в приложении RPC, необходимо крайне мало усилий.
ms.assetid: 1ea97df8-cdf5-43b8-88aa-9e8fa6ae845a
keywords:
- Удаленный вызов процедур RPC, задачи, разработка приложений очереди сообщений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09cf7b3a5d6d33facebb1de6a3c0f37eb9ba48f2afa54e6143ad5cb0169ad601
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118930577"
---
# <a name="developing-rpc-message-queuing-applications"></a>Разработка приложений RPC-Message Queuing

Чтобы воспользоваться преимуществами транспорта MSMQ в приложении RPC, необходимо крайне мало усилий. Для синхронного обмена сообщениями в качестве последовательности протокола необходимо указать только транспорт очереди сообщений ([**нкадг \_ MQ**](/windows/desktop/Midl/ncadg-mq)). Протокол **нкадг \_ MQ** поддерживает все стандартные функции датаграммы, кроме широковещательных вызовов. Кроме того, обратите внимание, что в настоящее время транспорт очереди сообщений не поддерживает динамические конечные точки.

Применив атрибут \[ [**Message**](/windows/desktop/Midl/message) \] к объявлениям удаленных процедур в IDL-файле, вы автоматически реализуете для этих вызовов очередь сообщений в асинхронном режиме. Это позволяет клиентским и серверным приложениям управлять многими свойствами, связанными с сообщениями и очередями сообщений, в том числе:

-   Качество обслуживания
-   Подтверждение получения
-   Ведение журнала
-   Приоритет вызова
-   Сохраняемость очереди серверных процессов

Качество обслуживания — это усилия, которые транспорты делают для предоставления вызова серверному процессу. Экспресс-доставка помещается в очередь в памяти, поэтому она выполняется довольно быстро, но вызов будет потерян, если компьютер или сетевое подключение перестанет работать в неправильное время. Восстанавливаемая доставка будет опубликована в файл на диске, пока он не будет доставлен, поэтому вызов не будет потерян даже в случае сбоя компьютера. Это обеспечит гарантированную доставку, но с учетом затрат на производительность при каждом обращении к диску.

Можно также сообщить транспорту MSMQ о необходимости ожидания подтверждения того, что вызов достиг очереди назначения (сервера) перед возвратом. При выборе этого параметра клиент блокируется, пока сервер не подтвердит вызов. в противном случае управление возвращается клиенту сразу после выполнения вызова.

С помощью ведения журнала вызовы могут записываться на диск. Если ведение журнала включено, каждый вызов заносится на диск в том виде, в котором он передается на следующий прыжок по пути к серверному процессу.

Приоритет вызова можно использовать в сочетании с \[ [](/windows/desktop/Midl/message) \] атрибутом функции RPC Message, чтобы разрешить вызовы с более высоким приоритетом, чтобы иметь приоритет над вызовами с более низким приоритетом, даже если вызовы с высоким приоритетом поступают позже. Приоритет вызова также будет работать в ограниченном режиме с помощью синхронного RPC, но синхронные вызовы RPC не могут выполняться так же, как асинхронные вызовы.

Клиентский процесс управляет всеми указанными выше свойствами путем вызова [**рпкбиндингсетоптион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption). После установки эти свойства остаются в силе до тех пор, пока они не будут изменены в другом вызове **рпкбиндингсетоптион**.

Процесс сервера RPC может управлять временем существования очереди получения. По умолчанию очередь удаляется при выходе из процесса сервера. Однако серверный процесс может использовать [**рпксерверусепротсекепекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) при настройке конечной точки, чтобы позволить транспорту продолжать существование очереди и принимать запросы вызовов, даже если серверный процесс не запущен. В этом случае вызовы помещаются в очередь и выполняются позже, когда серверный процесс возвращается в режим «в сети».

> [!Note]  
> При использовании асинхронных вызовов \[ [**сообщений**](/windows/desktop/Midl/message) \] в интерфейсе необходимо зарегистрировать интерфейс, вызвав [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) или [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) перед вызовом [**рпксерверусепротсекепекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(нкадг \_ MQ)**. После включения последовательности протоколов все вызовы, которые уже ожидают очередь для сервера, начнут быть считаны из очереди. Если соответствующий интерфейс RPC не был зарегистрирован, вызовы завершатся ошибкой. Такая ситуация может возникнуть, если для удаленных вызовов процедур настроена постоянная конечная точка, работа сервера была завершена, а клиенты продолжают отсылать вызовы на сервер. Эти вызовы будут помещены в очередь в очереди, ожидая считывания после того, как сервер вернется в режим «в сети».

 

Дополнительные сведения см. в разделе [**рпкбиндингсетоптион**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**рпксерверусепротсекепекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)и \[ [**Message**](/windows/desktop/Midl/message) \] , [**нкадг \_ MQ**](/windows/desktop/Midl/ncadg-mq).

 

 