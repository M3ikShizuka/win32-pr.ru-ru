---
title: Безопасность RPC через HTTP
description: RPC через HTTP предоставляет три типа защиты в дополнение к стандартному обеспечению безопасности RPC, что приводит к тому, что трафик RPC через HTTP защищается в RPC, а затем обеспечивается двойной защитой механизмом туннелирования, обеспечиваемым RPC через HTTP.
ms.assetid: 3a44c72b-b74c-433a-8826-1f76ca019f40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 527cf5ff74120c41606d83a248e355a6ea46d9d5
ms.sourcegitcommit: 5b98bf8c68922f8f03c14f793fbe17504900559c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2021
ms.locfileid: "104273213"
---
# <a name="rpc-over-http-security"></a>Безопасность RPC через HTTP

RPC через HTTP предоставляет три типа защиты в дополнение к стандартному обеспечению безопасности RPC, что приводит к тому, что трафик RPC через HTTP защищается в RPC, а затем обеспечивается двойной защитой механизмом туннелирования, обеспечиваемым RPC через HTTP. Описание стандартных механизмов безопасности RPC см. в разделе [Безопасность](security.md). Механизм туннелирования RPC через HTTP добавляет к обычной безопасности RPC следующий способ:

-   Обеспечивает безопасность через IIS (доступно только для RPC через HTTP v2).
-   Обеспечивает шифрование SSL и проверку прокси-сервера RPC (взаимная проверка подлинности). Также доступно только в RPC через HTTP v2.
-   Предоставляет ограничения на уровне прокси-сервера RPC, определяющие, на каких компьютерах в серверной сети разрешено принимать вызовы RPC через HTTP.

Каждая из этих трех функций безопасности подробно описана в следующих разделах.

## <a name="iis-authentication"></a>Проверка подлинности IIS

RPC через HTTP может использовать стандартный механизм проверки подлинности IIS. Виртуальный каталог для прокси-сервера RPC можно настроить с помощью узла RPC на веб-сайте по умолчанию в оснастке IIS MMC.

![Снимок экрана, показывающий узел RPC на веб-сайте по умолчанию в оснастке IIS MMC.](images/rpc-http-1.png)

Службы IIS можно настроить на отключение анонимного доступа и потребовать проверку подлинности в виртуальном каталоге для прокси-сервера RPC. Для этого щелкните правой кнопкой мыши узел RPC и выберите пункт **Свойства**. Откройте вкладку **Безопасность каталога** и нажмите кнопку **изменить** в группе **Управление доступом и проверками подлинности** , как показано ниже:

![Снимок экрана: диалоговое окно "свойства RPC".](images/rpc-http-2.png)

Хотя RPC через HTTP можно использовать, даже если виртуальный каталог RPC-прокси допускает анонимный доступ, корпорация Майкрософт настоятельно рекомендует отключить анонимный доступ к этому виртуальному каталогу по соображениям безопасности. Вместо этого для RPC через HTTP включите обычную проверку подлинности, встроенную проверку подлинности Windows или и то и другое. Помните, что только RPC через HTTP v2 может проходить проверку подлинности для прокси-сервера RPC, который требует обычной или встроенной проверки подлинности Windows; RPC через HTTP v1 не сможет подключиться, если запрещен **анонимный доступ** . Так как RPC через HTTP v2 является более безопасной и надежной реализацией, использование версии Windows, поддерживающей эту службу, повысит безопасность установок.

> [!Note]  
> По умолчанию виртуальный каталог RPC прокси-сервера помечен для разрешения анонимного доступа. Однако прокси-сервер RPC для RPC через HTTP v2 отклоняет запросы, которые не прошли проверку подлинности по умолчанию.

 

## <a name="traffic-encryption"></a>Шифрование трафика

RPC через HTTP может шифровать трафик между клиентом RPC через HTTP и прокси RPC с помощью SSL. Трафик между прокси-сервером RPC и RPC через HTTP-сервер шифруется с помощью обычных механизмов безопасности RPC и не использует SSL (даже если выбран протокол SSL между клиентом и прокси-сервером RPC). Это обусловлено тем, что часть трафика проходит через сеть Организации и защищена брандмауэром.

Трафик между клиентом RPC через HTTP и прокси-сервером RPC, который обычно перемещается через Интернет, может быть зашифрован с помощью SSL в дополнение к тому, какой механизм шифрования был выбран для RPC. В этом случае трафик в части Интернета маршрута будет иметь удвоенное шифрование. Шифрование трафика через прокси-сервер RPC обеспечивает дополнительную защиту, если прокси-сервер RPC или другие компьютеры в сети периметра скомпрометированы. Поскольку прокси RPC не может расшифровать дополнительный уровень шифрования, прокси-сервер RPC не имеет доступа к отправляемым данным. Дополнительные сведения см. в статье [рекомендации по развертыванию RPC поверх HTTP](rpc-over-http-deployment-recommendations.md) . Шифрование SSL доступно только при использовании RPC через HTTP v2.

## <a name="restricting-rpc-over-http-calls-to-certain-computers"></a>Запрещение вызовов RPC через HTTP к определенным компьютерам

Конфигурация безопасности IIS основана на разрешенном компьютере и диапазонах портов. Возможность использования RPC через HTTP контролируется двумя записями реестра на компьютере с IIS и прокси-сервером RPC. Первая запись — это флаг, который переключает функциональность прокси-сервера RPC. Второй — необязательный список компьютеров, на которых прокси-сервер может пересылать вызовы RPC.

По умолчанию клиент, который обращается к прокси-серверу RPC для вызовов RPC через HTTP, не может получить доступ к серверным процессам RPC, за исключением процессов сервера RPC через HTTP, запущенных на том же компьютере, что и прокси-сервер RPC. Если флаг ENABLED не определен или имеет нулевое значение, IIS отключает прокси-сервер RPC. Если флаг ENABLED определен и для него задано ненулевое значение, клиент может подключаться к RPC через HTTP-серверы на компьютере, на котором запущены службы IIS. Чтобы разрешить клиенту выполнять туннелирование на серверный процесс RPC через HTTP на другом компьютере, необходимо добавить запись реестра в список серверов RPC через HTTP на компьютере IIS.

Серверы RPC не могут принимать вызовы RPC через HTTP, если они специально не запросили RPC для прослушивания RPC через HTTP.

В следующем примере показано, как настроить реестр, чтобы разрешить клиентам подключаться к серверам через Интернет:

```
HKEY_LOCAL_MACHINE\
   Software\Microsoft\Rpc\RpcProxy\Enabled:REG_DWORD
   Software\Microsoft\Rpc\RpcProxy\ValidPorts:REG_SZ
```

Запись **ValidPorts** — это запись REG \_ SZ, содержащая список компьютеров, на которые прокси-сервер RPC IIS может пересылать вызовы RPC, а также порты, которые должны использоваться для подключения к серверам RPC. Запись REG \_ SZ имеет следующий вид: Роско: 593; Роско: 2000 — 8000; данные \* : 4000-8000.

В этом примере IIS может пересылать вызовы RPC через HTTP к серверу "Роско" на портах 593 и 2000 до 8000. Он также может отправить вызовы на любой сервер, имя которого начинается с "Data". Он будет подключаться к портам с 4000 по 8000. Кроме того, прежде чем перенаправить трафик на заданный порт на сервере RPC через HTTP, прокси-сервер RPC выполняет Специальный обмен пакетами со службой RPC, который прослушивает этот порт, чтобы убедиться, что он готов принимать запросы по протоколу HTTP.

Для примера, основанного на этих примерах параметров, если служба RPC прослушивает порт 4500 на сервере «файл1», но не вызвал одну из функций [ * *рпксерверусепротсек \** _](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseq) с параметром _ * нкакн \_ http * *, запрос будет отклонен. Это поведение обеспечивает дополнительную защиту серверов, прослушиваемых открытым портом из-за ошибки конфигурации; Если сервер специально не запрашивает прослушивание RPC через HTTP, он не будет получать вызовы, исходящие из-за пределов брандмауэра.

Записи в ключе **ValidPorts** должны точно соответствовать серверу RPC через HTTP, запрошенному клиентом (без учета регистра). Для упрощения обработки прокси-сервер RPC не выполняет каноническое имя, предоставленное клиентом RPC через HTTP. Таким образом, если клиент запрашивает rosco.microsoft.com и в **ValidPorts** содержится только Роско, прокси-сервер RPC не будет сопоставлять имена, даже если оба имени могут ссылаться на один и тот же компьютер. Кроме того, если IP-адрес Роско — 66.77.88.99, а клиент запрашивает 66.77.88.99, но ключ **ValidPorts** содержит только Роско, прокси-сервер RPC отклоняет подключение. Если клиент может запросить сервер RPC через HTTP по имени или по IP-адресу, вставьте оба параметра в ключ **ValidPorts** .

> [!Note]  
> Хотя RPC включен IPv6, прокси-сервер RPC не поддерживает адреса IPv6 в ключе **ValidPorts** . Если протокол IPv6 используется для подключения прокси-сервера RPC и RPC через HTTP-сервер, можно использовать только DNS-имена.

 

IIS считывает записи реестра **Enabled** и **ValidPorts** при запуске. Кроме того, RPC через HTTP заново считывает содержимое ключа **ValidPorts** примерно каждые 5 минут. Если запись **ValidPorts** изменена, изменения реализуются в течение 5 минут.

**RPC через HTTP v1:** ВЕБ-служба должна быть остановлена и перезапущена с помощью Service Manager Интернета для реализации новых значений в записях реестра.

 

 




