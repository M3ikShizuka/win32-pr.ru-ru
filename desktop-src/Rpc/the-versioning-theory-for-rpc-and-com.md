---
title: Теория управления версиями для RPC и COM
description: Теория управления версиями для удаленного вызова процедур (RPC) и COM.
ms.assetid: c4df0a7b-e1be-481d-9149-317ffc9179b9
keywords:
- Удаленный вызов процедур RPC, рекомендации, управление версиями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7e03b23c91bf69fbc3c4f72366b80812fd54330d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104134351"
---
# <a name="the-versioning-theory-for-rpc-and-com"></a>Теория управления версиями для RPC и COM

Только два метода, полностью защищенных методом, поддерживают новые функции без риска проблем с совместимостью сети:

-   Измените версию интерфейса в соответствии с правилами. Это предотвращает взаимодействие новых клиентов со старым сервером, а также может препятствовать взаимодействию старого клиента с новым сервером. Это объясняется далее в этом разделе.
-   Опишите другой интерфейс, посвященный новым функциональным возможностям.

Стандартный интерфейс RPC определяется с помощью комбинации GUID и номера версии. COM-интерфейс определяется по его идентификатору GUID. Версия состоит из основных и вспомогательных частей. Для стандартных интерфейсов с одним и тем же идентификатором GUID и разными номерами версий соединение может быть доступно только в том случае, если основная версия совпадает, а клиент не превышает дополнительный номер версии сервера.

Следствием является то, что изменение GUID интерфейса RPC нарушает совместимость сети, а изменение имени интерфейса — нет.

В стандартной RPC путь к обновлениям и расширениям определен правильно, и в основном требуется, чтобы новые методы были добавлены только в конце интерфейса, а новые типы использовались только в новых методах. Если такие дополнения необходимы, необходимо увеличить дополнительный номер версии. Любое другое изменение требует изменения в основной версии, так как программное обеспечение клиента и сервера будет несовместимо по сети. Соблюдение этих правил гарантирует, что при наличии соединения между новым клиентом и старым сервером, или наоборот, обе стороны полностью совместимы.

Для COM-интерфейса нельзя использовать атрибут Version. Создание новых интерфейсов и наследование от старых интерфейсов эквивалентно управлению версией в RPC. Как правило, лучшим подходом в COM является создание нового интерфейса для расширенной функциональности. Эквивалентом дополнительной версии является новый интерфейс, наследующий от старого. Для изменения старых методов или старых типов данных требуется совершенно новый COM-интерфейс — интерфейс, который не наследует от старого.

Для COM функция [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) — это установленный метод проверки того, поддерживает ли сервер интерфейс; Следовательно, ситуации, в которых клиент может взаимодействовать со старым или новой версией интерфейса, можно легко разрешить.

 

 