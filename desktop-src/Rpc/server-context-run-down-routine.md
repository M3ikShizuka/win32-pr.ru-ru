---
title: Подпрограммы запуска контекста сервера
description: Если связь нарушается, пока сервер обслуживает контекст от имени клиента, для очистки состояния, поддерживаемого сервером от имени данного клиента, может потребоваться подпрограмма очистки.
ms.assetid: b39654e4-6f03-43a0-8a5d-6f24bd0a529c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 73ad8afb7f698a258d7c4403143e74d566f813a5
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127461490"
---
# <a name="server-context-run-down-routine"></a>Подпрограммы запуска контекста сервера

Если связь нарушается, пока сервер обслуживает контекст от имени клиента, для очистки состояния, поддерживаемого сервером от имени данного клиента, может потребоваться подпрограмма очистки. Эта подпрограмма очистки называется *контекстной подпрограммы запуска*. При разрыве соединения Серверная заглушка и библиотека времени выполнения будут вызывать эту подпрограмму для каждого открытого в клиенте обработчика контекста.

Подпрограммы запуска контекста являются обязательными и неявно объявлены и именованы при применении \[ атрибута **\_ Handle** в \] определении типа. Сервер не будет вызывать подпрограммы контекстной выгрузки, если \[ **атрибут \_ Handle контекста** \] был применен непосредственно к параметру.

Синтаксис выполнения контекстного действия:

``` syntax
void __RPC_USER type-id_rundown (type-id);
```

Обратите внимание, что имя типа определяет имя подпрограммы запуска контекста.

Фрагмент кода, приведенный ниже, представляет собой подпрограмму выполнения примера контекста. Это вызывает процедуру Ремотеклосе, используемую в примере в [разработке интерфейса с помощью дескрипторов контекста](interface-development-using-context-handles.md), [разработки сервера с помощью дескрипторов контекста](server-development-using-context-handles.md)и [разработки клиентов с помощью дескрипторов контекста](client-development-using-context-handles.md). Эта процедура закрывает файловый обработчик, освобождает память, связанную с файлом, и присваивает **значение NULL** контексту. Присвоение **значения NULL** является результатом вызова функции ремотеклосе и не является обязательным в сценарии запуска. Время выполнения RPC очищает свое состояние независимо от того, задано ли для маркера контекста **значение NULL**.

``` syntax
//file: cxhndp.c (fragment of file containing remote procedures)
//The rundown routine is associated with the context handle type.  
void __RPC_USER PCONTEXT_HANDLE_TYPE_rundown(
    PCONTEXT_HANDLE_TYPE phContext)
{
    printf("Client died with an open file, closing it..\n");
    RemoteClose(&phContext);
    assert(phContext == 0);
}
```

 

 




