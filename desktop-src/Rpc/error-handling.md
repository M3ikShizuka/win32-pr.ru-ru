---
title: Обработка ошибок (RPC)
description: В синхронном RPC клиент выполняет удаленный вызов, который возвращает код успеха или ошибки.
ms.assetid: 7dfc9f84-ce3c-49f3-8f72-b212095133fd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6daf29091602c36a23c0ed7e08eb0459985e13ca26ec128f401754f64c2329ef
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120021663"
---
# <a name="error-handling-rpc"></a>Обработка ошибок (RPC)

В синхронном RPC клиент выполняет удаленный вызов, который возвращает код успеха или ошибки. Асинхронный вызов процедур (RPC) предоставляет больше возможностей для вызова сбоя, и эти сбои обрабатываются по-разному в зависимости от того, где и когда они происходят. В следующей таблице описаны способы, в которых вызов может завершиться неудачно, и как он обрабатывается.

## <a name="client-side-cleanup"></a>Очистка на стороне клиента



| Симптом сбоя                                                                                                                                  | Очистка                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| Клиент перехватывает исключение при вызове удаленной процедуры.                                                                                  | Вызовы API RPC не требуются. Все состояния RPC были очищены.                                                              |
| Клиент получает уведомление о завершении вызова, но при вызове [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall)он получает код ошибки. | Вызовы API RPC не требуются. Все состояния RPC были очищены.                                                              |
| Клиент выдает непрерванные или отмененные отмены.                                                                                                   | Клиент должен ждать уведомления и вызвать [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) при получении уведомления. |



 

При очистке на стороне сервера ключевой концепцией является точка передачи. Во время серверной обработки асинхронного вызова часть обработки обычно выполняется в потоке, который получил вызов (также известен как *поток Dispatcher*), а затем, при необходимости, поток диспетчера помещает достаточное состояние в блок памяти и сигнализирует другому потоку (также известному как *Рабочий поток*) продолжить обработку для вызова. Момент, когда поток Dispatcher успешно сигнализирует, что рабочий поток называется *точкой* передачи.

## <a name="server-side-cleanup"></a>Очистка на стороне сервера



| Произошла ошибка      | Очистка                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Перед отправной точкой. | Создать исключение. Вызов [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) не требуется.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| После отправной точки.  | Вызовите [**рпкасинкаборткалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasyncabortcall) или, если ошибка не является неустранимой, и результаты по-прежнему могут возвращаться клиенту [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall). Если вызов функции **рпкасинккомплетекалл** завершается ошибкой, среда выполнения RPC освобождает параметры. Пользователь не должен иметь доступ к этим параметрам. Поток Dispatcher не должен выполнять какую-либо значительную обработку, которая может завершиться ошибкой после точки, так как она больше не может безопасно прерывать вызов. В частности, он не должен вызывать исключение после точки, а также может привести к сбою сервера. |



 

## <a name="special-error-handling-cases-for-pipes"></a>Специальные случаи обработки ошибок для каналов

Существуют особые случаи обработки ошибок при использовании каналов. В следующем списке объясняется источник сбоя и способы его устранения.



| Источник сбоя                                                                                                 | Принцип обработки                                                                                                |
|-------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| Клиент вызывает принудительную отправку, и вызов завершается с ошибкой.                                                                             | Вызовы API RPC не требуются. Все состояния RPC были очищены.                                         |
| Клиент вызывает [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) перед стоком [**в**](/windows/desktop/Midl/in) каналах. | Вызов завершается ошибкой с соответствующим кодом ошибки заполнения канала.                                                   |
| Клиент вызывает метод Pull, и вызов завершается с ошибкой.                                                                             | Вызовы API RPC не требуются. Все состояния RPC были очищены.                                         |
| Клиент или сервер вызывает метод Push или Pull в неправильном порядке.                                                    | Время выполнения возвращает состояние ошибки заполнения канала.                                                                |
| Сервер вызывает метод Push или Pull, и вызов завершается с ошибкой.                                                                     | Функция Push возвращает код ошибки. Вызов [**рпкасинккомплетекалл**](/windows/desktop/api/Rpcasync/nf-rpcasync-rpcasynccompletecall) не требуется. |
| Сервер вызывает **рпкасинккомплетекалл** перед стоком каналов.                                         | Вызов канала возвращает состояние ошибки заполнения канала.                                                         |
| После отправки операция получения завершается ошибкой.                                                                    | В следующий раз, когда сервер вызывает метод Pull для получения данных канала, возвращается ошибка.                            |



 

 

 
