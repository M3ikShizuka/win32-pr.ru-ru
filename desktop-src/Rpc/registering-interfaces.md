---
title: Регистрация интерфейсов
description: Регистрация интерфейса удаленного вызова процедур (RPC).
ms.assetid: c22e3fa8-98be-461a-b06d-292d3f655ffc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ea9e851e8c9663c8f66d983d3400b1ee398a9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104252749"
---
# <a name="registering-interfaces"></a>Регистрация интерфейсов

В этом разделе представлено подробное описание процесса регистрации интерфейса RPC.

Сведения в этом разделе представлены в следующих разделах:

-   [Функции регистрации интерфейса](#interface-registration-functions)
-   [Векторы точки входа](#entry-point-vectors)
-   [Епвс Manager](#manager-epvs)
-   [Регистрация одной реализации интерфейса](#registering-a-single-implementation-of-an-interface)
-   [Регистрация нескольких реализаций интерфейса](#registering-multiple-implementations-of-an-interface)
-   [Правила вызова подпрограмм диспетчера](#rules-for-invoking-manager-routines)
-   [Отправка удаленного вызова процедуры в Server-Manager подпрограммы](#dispatching-a-remote-procedure-call-to-a-server-manager-routine)
-   [Предоставление собственной функции Object-Inquiry](#supplying-your-own-object-inquiry-function)

## <a name="interface-registration-functions"></a>Функции регистрации интерфейса

Серверы регистрируют свои интерфейсы, вызывая функцию [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) . Сложные серверные программы часто поддерживают более одного интерфейса. Серверные приложения должны вызывать эту функцию один раз для каждого поддерживаемого интерфейса.

Кроме того, серверы могут поддерживать несколько версий одного интерфейса, каждый из которых имеет собственную реализацию функций интерфейса. Если серверная программа делает это, необходимо предоставить набор точек входа. Точка входа — это подпрограммы диспетчера, которая отправляет вызовы для версии интерфейса. Для каждой версии интерфейса должна быть одна точка входа. Группа точек входа называется вектором точки входа. Дополнительные сведения см. в разделе [векторы точки входа](#entry-point-vectors).

Кроме стандартной функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), RPC также поддерживает другие функции регистрации интерфейса. Функция [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) расширяет возможности **рпксерверрегистериф** , позволяя задавать набор флагов регистрации (см. раздел [флаги регистрации интерфейса](interface-registration-flags.md)), максимальное количество одновременных запросов удаленного вызова процедур, которые может принимать сервер, и максимальный размер входящих блоков данных в байтах.

Библиотека RPC также содержит функцию с именем [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex). Как и функция [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) , эта функция регистрирует интерфейс. Эта функция также может использоваться в серверной программе для указания набора флагов регистрации (см. раздел [флаги регистрации интерфейса](interface-registration-flags.md)), максимального числа одновременных запросов удаленного вызова процедур, которые может принимать сервер, и функции обратного вызова безопасности.

Функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)и [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) задают значения в таблице реестра внутреннего интерфейса. Эта таблица используется для соотнесения UUID интерфейса и UUID объекта с ЕПВ Manager. Диспетчер ЕПВ — это массив указателей функций, который содержит ровно один указатель на функцию для каждого прототипа функции в интерфейсе, указанном в IDL-файле.

Сведения о предоставлении нескольких Епвс для предоставления нескольких реализаций интерфейса см. в разделе [реализации нескольких интерфейсов](#registering-multiple-implementations-of-an-interface).

Библиотека времени выполнения использует таблицу реестра интерфейса (задается вызовами функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)) и таблицей реестра объектов (задается вызовами функции [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)), чтобы сопоставлять идентификаторы UUID интерфейса и объекта с указателем на функцию.

Если необходимо, чтобы программа сервера удалила интерфейс из реестра библиотеки времени выполнения RPC, вызовите функцию [**рпксерверунрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif) . После удаления интерфейса из реестра библиотека времени выполнения RPC больше не будет принимать новые вызовы для этого интерфейса.

## <a name="entry-point-vectors"></a>Векторы точки входа

Вектор точки входа диспетчера (ЕПВ) — это массив указателей функций, указывающий на реализации функций, указанных в IDL-файле. Число элементов в массиве соответствует числу функций, указанных в IDL-файле. RPC поддерживает несколько векторов точки входа, представляющих несколько реализаций функций, указанных в интерфейсе.

Компилятор MIDL автоматически создает тип данных ЕПВ Manager для использования в конструкции Епвс Manager. Тип данных имеет имя * if-Name ***\_ Server \_ ЕПВ**, где *If-Name* указывает идентификатор интерфейса в файле IDL.

Компилятор MIDL автоматически создает и инициализирует диспетчер по умолчанию, ЕПВ по предположении, что для каждой процедуры в интерфейсе существует процедура управления с таким же именем и указана в IDL-файле.

Если сервер предлагает несколько реализаций одного интерфейса, сервер должен создать один дополнительный диспетчер ЕПВ для каждой реализации. Каждый ЕПВ должен содержать ровно одну точку входа (адрес функции) для каждой процедуры, определенной в IDL-файле. Серверное приложение объявляет и инициализирует одну переменную ЕПВ Manager типа *If-Name * * * \_ Server \_ ЕПВ** для каждой дополнительной реализации интерфейса. Чтобы зарегистрировать Епвс, он вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) один раз для каждого поддерживаемого типа объекта.

Когда клиент выполняет удаленный вызов процедуры на сервере, ЕПВ, содержащий указатель на функцию, выбирается на основе идентификатора UUID интерфейса и типа объекта. Тип объекта является производным от UUID объекта с помощью функции Object-запроса или сопоставления, управляемого табличным сопоставлением, управляемым [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).

## <a name="manager-epvs"></a>Епвс Manager

По умолчанию компилятор MIDL использует имена процедур из IDL-файла интерфейса для создания диспетчера ЕПВ, который компилятор помещает непосредственно в серверную заглушку. Этот ЕПВ по умолчанию статически инициализируется с помощью имен процедур, объявленных в определении интерфейса.

Чтобы зарегистрировать Диспетчер с помощью ЕПВ по умолчанию, укажите значение **null** в качестве значения параметра *мгрепв* в вызове функции [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) . Если имена подпрограмм, используемые диспетчером, соответствуют параметрам определения интерфейса, этот диспетчер можно зарегистрировать с помощью ЕПВ по умолчанию интерфейса, созданного компилятором MIDL. Вы также можете зарегистрировать менеджера с помощью ЕПВ, предоставляемого серверным приложением.

Сервер может (и иногда должен) создавать и регистрировать ЕПВ Manager, отличный от **null** , для интерфейса. Чтобы выбрать предоставленное серверное приложение ЕПВ, передайте адрес ЕПВ, значение которого было объявлено сервером в качестве значения параметра *мгрепв* a. Значение, отличное от **null** , для параметра *мгрепв* всегда переопределяет ЕПВ по умолчанию в заглушке сервера.

Компилятор MIDL автоматически создает тип данных ЕПВ диспетчера (RPC Manager \_ \_ ЕПВ) для серверного приложения, которое используется в конструировании диспетчера епвс. ЕПВ Manager должен содержать ровно одну точку входа (адрес функции) для каждой процедуры, определенной в IDL-файле.

Сервер должен предоставить ЕПВ, не **равный null** , в следующих случаях:

-   Когда имена подпрограмм диспетчера отличаются от имен процедур, объявленных в определении интерфейса
-   Когда сервер использует ЕПВ по умолчанию для регистрации другой реализации интерфейса

Сервер объявляет ЕПВ Manager, инициализируя переменную типа *If-Name * * * \_ Server \_ ЕПВ** для каждой реализации интерфейса.

## <a name="registering-a-single-implementation-of-an-interface"></a>Регистрация одной реализации интерфейса

Если сервер предлагает только одну реализацию интерфейса, сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) только один раз. В стандартном случае сервер использует диспетчер ЕПВ по умолчанию. (Исключением является то, что диспетчер использует имена подпрограмм, отличающиеся от объявленных в интерфейсе.)

В стандартном случае для вызовов [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)указываются следующие значения:

-   Епвс Manager

    Чтобы использовать ЕПВ по умолчанию, укажите значение **null** для параметра *мгрепв* a.

-   UUID типа диспетчера

    При использовании ЕПВ по умолчанию Зарегистрируйте интерфейс с ненулевым ИДЕНТИФИКАТОРом типа Manager, указав значение **null** или нуль-UUID для параметра *мгртипеууид* a. В этом случае все удаленные вызовы процедур, независимо от UUID объекта в их маркере привязки, отправляются в ЕПВ по умолчанию, предполагая, что вызовы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) не были выполнены.

    Можно также указать UUID типа, отличного от nil. В этом случае необходимо также вызвать подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .

## <a name="registering-multiple-implementations-of-an-interface"></a>Регистрация нескольких реализаций интерфейса

Можно указать несколько реализаций удаленных процедур, указанных в IDL-файле. Серверное приложение вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для сопоставления идентификаторов UUID объекта с типами UUID и вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RPCSERVERREGISTERIF2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для связывания диспетчера епвс с типом UUID. Когда удаленный вызов процедуры прибывает к объекту UUID, Библиотека времени выполнения RPC-сервера сопоставляет UUID объекта с типом UUID. Затем серверное приложение использует тип UUID и UUID интерфейса, чтобы выбрать диспетчер ЕПВ.

Можно также указать собственную функцию для разрешения сопоставления из UUID объекта с ИДЕНТИФИКАТОРом типа диспетчера. Функция сопоставления указывается при вызове [**рпкобжектсетинкфн**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn).

Чтобы предложить несколько реализаций интерфейса, сервер должен зарегистрировать каждую реализацию, вызвав [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) отдельно. Для каждой реализации, зарегистрированной сервером, предоставляется тот же *ифспек* параметра, но другая пара *мгртипеууид* и *мгрепв* параметров.

В случае с несколькими диспетчерами используйте [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) следующим образом:

-   Епвс Manager

    Чтобы предложить несколько реализаций интерфейса, сервер должен:

    -   Создайте ЕПВ Manager, отличный от **null** , для каждой дополнительной реализации.
    -   Укажите значение, отличное от **null** , для *параметра мгрепв* в [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).

    Обратите внимание, что сервер также может зарегистрироваться в ЕПВ Manager по умолчанию.

-   UUID типа диспетчера

    Укажите идентификатор типа менеджера для каждого ЕПВ интерфейса. Для одного из Епвс Manager может быть задан нулевой тип UUID (или значение **null** ) для параметра *мгртипеууид* . Каждый тип UUID должен быть разным.

## <a name="rules-for-invoking-manager-routines"></a>Правила вызова подпрограмм диспетчера

Библиотека времени выполнения RPC отправляет входящий вызов удаленной процедуры диспетчеру, который предлагает запрошенный интерфейс RPC. Если для интерфейса зарегистрировано несколько руководителей, Библиотека времени выполнения RPC должна выбрать один из них. Чтобы выбрать руководителя, Библиотека времени выполнения RPC использует объект UUID, указанный в маркере привязки вызова.

Библиотека времени выполнения применяет следующие правила при интерпретации UUID объекта удаленного вызова процедуры:

-   Идентификаторы UUID объекта nil

    UUID объекта nil автоматически назначается тип UUID типа nil (недопустимый идентификатор UUID объекта nil в подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) ). Таким образом, удаленный вызов процедуры, маркер привязки которого содержит пустой идентификатор объекта nil, автоматически отправляется диспетчеру, зарегистрированному с помощью nil UUID типа, если таковой имеется.

-   Идентификаторы UUID объекта, отличные от nil

    В принципе, удаленный вызов процедуры, маркер привязки которого содержит ненулевой объект UUID, должен обрабатываться диспетчером, UUID типа которого соответствует типу UUID объекта. Однако для определения правильного диспетчера необходимо, чтобы сервер указал тип UUID объекта, вызвав подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .

    Если серверу не удается вызвать подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для идентификатора UUID объекта, отличного от nil, удаленный вызов процедуры для этого UUID объекта перейдет к диспетчеру ЕПВ, который выполняет удаленный вызов процедур с ненулевым UUID объекта (т. е. UUID типа nil).

    Удаленные вызовы процедур с UUID объекта, отличного от nil, в маркере привязки не могут быть выполнены, если серверу назначено значение UUID типа, отличное от nil, путем вызова подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , но не зарегистрировали ЕПВ Manager для этого типа UUID, вызвав [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2).

В следующей таблице перечислены действия, которые библиотека времени выполнения использует для выбора подпрограммы диспетчера.



| UUID объекта Call | Тип набора серверов для объекта UUID? | Зарегистрированный сервер тип ЕПВ? | Действие диспетчеризации                                                                                                                                 |
|---------------------|----------------------------------|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| Указатель                 | Неприменимо                   | Да                         | Использует диспетчер с пустым типом UUID.                                                                                                           |
| Указатель                 | Неприменимо                   | Нет                          | Ошибка ( \_ \_ неподдерживаемый тип RPC S \_ ); отклоняет удаленный вызов процедуры.                                                                              |
| Не nil             | Да                              | Да                         | Использует диспетчер с одинаковым UUID типа.                                                                                                          |
| Не nil             | нет                               | Не учитывается                     | Использует диспетчер с пустым типом UUID. Если нет диспетчера с пустым типом UUID, ошибка (RPC \_ S \_ унсуппортедтипе); отклоняет удаленный вызов процедуры. |
| Не nil             | Да                              | Нет                          | Ошибка (RPC \_ S \_ унсуппортедтипе); отклоняет удаленный вызов процедуры.                                                                                |



 

Идентификатором UUID вызова является объект UUID, обнаруженный в маркере привязки для удаленного вызова процедуры.

Сервер задает тип UUID объекта, вызывая [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , чтобы указать тип UUID для объекта.

Сервер регистрирует тип для диспетчера ЕПВ, вызывая [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) , используя тот же тип UUID.

> [!Note]  
> UUID объекта nil всегда автоматически назначается тип UUID типа nil. Недопустимо указывать UUID объекта nil в подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) .

 

## <a name="dispatching-a-remote-procedure-call-to-a-server-manager-routine"></a>Отправка удаленного вызова процедуры в подпрограммы диспетчера сервера

В следующих таблицах показаны действия, выполняемые библиотекой времени выполнения RPC для отправки удаленного вызова процедур в подпрограммы диспетчера сервера.

Простой случай, когда сервер регистрирует диспетчер по умолчанию ЕПВ, описан в следующих таблицах.

**Таблица реестра интерфейса**



| UUID интерфейса | UUID типа диспетчера | Вектор точки входа |
|----------------|-------------------|--------------------|
| *uuid1*        | Указатель               | ЕПВ по умолчанию        |



 

**Таблица реестра объектов**



| UUID объекта             | Тип объекта |
|-------------------------|-------------|
| Указатель                     | Указатель         |
| (Любой другой идентификатор объекта) | Указатель         |



 

**Сопоставление маркера привязки с вектором точки входа (ЕПВ)**



| UUID интерфейса (из клиентского маркера привязки) | UUID объекта (из клиентского маркера привязки) | Тип объекта (из таблицы реестра объектов) | Диспетчер ЕПВ (из таблицы реестра интерфейса) |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| *uuid1*                                     | Указатель                                      | Указатель                                      | ЕПВ по умолчанию                                 |
| То же, что и выше                               | *UUID*                                  | Указатель                                      | ЕПВ по умолчанию                                 |



 

Следующие шаги описывают действия, выполняемые библиотекой времени выполнения RPC-сервера, как показано в предыдущих таблицах, когда клиент с UUID интерфейса *uuid1* вызывает его.

1.  Сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) , чтобы связать интерфейс, который он предлагает, с идентификатором UUID типа Manager и с созданным по умолчанию диспетчером MIDL ЕПВ. Этот вызов добавляет запись в таблицу реестра интерфейса. UUID интерфейса содержится в параметре *ифспек* .
2.  По умолчанию таблица реестра объектов связывает все ИДЕНТИФИКАТОРы объектов с пустым типом UUID. В этом примере сервер не вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype).
3.  Серверная библиотека времени выполнения получает код удаленной процедуры, содержащий UUID интерфейса, которому принадлежит вызов, и идентификатор UUID объекта из маркера привязки вызова.

    Сведения о том, как идентификатор UUID объекта задается в маркере привязки, см. в следующих справочных записях по функциям:

    -   [**рпкнсбиндингимпортбегин**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
    -   [**рпкнсбиндинглукупбегин**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
    -   [**рпкбиндингфромстрингбиндинг**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
    -   [**рпкбиндингсетобжект**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)

4.  Используя UUID интерфейса из удаленного вызова процедуры, Библиотека времени выполнения сервера находит идентификатор UUID интерфейса в таблице реестра Interface.

    Если сервер не зарегистрировал интерфейс с помощью [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2), удаленный вызов процедуры возвращает вызывающей стороне с RPC, \_ \_ неизвестным, \_ Если код состояния.

5.  Используя идентификатор UUID объекта из маркера привязки, Библиотека времени выполнения сервера находит этот идентификатор объекта в таблице реестра объектов. В этом примере все ИДЕНТИФИКАТОРы объекта сопоставляются с типом объекта nil.
6.  Библиотека времени выполнения сервера находит ненулевой тип диспетчера в таблице реестра Interface.
7.  Сочетание UUID интерфейса и типа nil в таблице реестра Interface разрешается в ЕПВ по умолчанию, который содержит подпрограммы диспетчера сервера, выполняемые для идентификатора UUID интерфейса, найденного в удаленном вызове процедуры.

Предположим, что сервер предлагает несколько интерфейсов и несколько реализаций каждого интерфейса, как описано в следующих таблицах.

**Таблица реестра интерфейса**



| UUID интерфейса | Идентификатор UUID типа "руководитель" | Вектор точки входа |
|----------------|-------------------|--------------------|
| *uuid1*        | Указатель               | *epv1*             |
| *uuid1*        | *uuid3*           | *epv4*             |
| *uuid2*        | *uuid4*           | *epv2*             |
| *uuid2*        | *uuid7*           | *epv3*             |



 

**Таблица реестра объектов**



| UUID объекта      | Тип объекта |
|------------------|-------------|
| *UUID*          | *uuid3*     |
| *ууидб*          | *uuid7*     |
| *ууидк*          | *uuid7*     |
| *с UUID*          | *uuid3*     |
| *UUID*          | *uuid3*     |
| *ууидф*          | *uuid8*     |
| Указатель              | Указатель         |
| (Любой другой UUID) | Указатель         |



 

**Сопоставление маркера привязки с вектором точки входа**



| UUID интерфейса (из клиентского маркера привязки) | UUID объекта (из клиентского маркера привязки) | Тип объекта (из таблицы реестра объектов) | Диспетчер ЕПВ (из таблицы реестра интерфейса) |
|---------------------------------------------|------------------------------------------|------------------------------------------|---------------------------------------------|
| *uuid1*                                     | Указатель                                      | Указатель                                      | *epv1*                                      |
| *uuid1*                                     | *UUID*                                  | *uuid3*                                  | *epv4*                                      |
| *uuid1*                                     | *с UUID*                                  | *uuid3*                                  | *epv4*                                      |
| *uuid1*                                     | *UUID*                                  | *uuid3*                                  | *epv4*                                      |
| *uuid2*                                     | *ууидб*                                  | *uuid7*                                  | *epv3*                                      |
| *uuid2*                                     | *ууидк*                                  | *uuid7*                                  | *epv3*                                      |



 

Следующие шаги описывают действия, выполняемые библиотекой времени выполнения сервера, как показано в предыдущих таблицах, когда клиент с UUID интерфейса *uuid2* и UUID объекта *ууидк* вызывает его.

1.  Сервер вызывает [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для связывания предоставляемых им интерфейсов с разными епвс Manager. Записи в таблице реестра Interface отображают четыре вызова [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для предложения двух интерфейсов с двумя реализациями (епвс) для каждого интерфейса.
2.  Сервер вызывает [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) , чтобы установить тип каждого предоставляемого им объекта. В дополнение к сопоставлению по умолчанию объекта nil с пустым типом, все остальные ИДЕНТИФИКАТОРы объектов, не найденные явным образом в таблице реестра Object, также сопоставляются с пустым типом UUID.

    В этом примере сервер вызывает подпрограммы [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) шесть раз.

3.  Серверная библиотека времени выполнения получает удаленный вызов процедуры, содержащий UUID интерфейса, к которому принадлежит вызов, и идентификатор UUID объекта из маркера привязки вызова.
4.  Используя UUID интерфейса из удаленного вызова процедуры, Библиотека времени выполнения сервера находит UUID интерфейса в таблице реестра Interface.
5.  Используя идентификатор UUID объекта *ууидк* из маркера привязки, Библиотека времени выполнения сервера находит идентификатор объекта в таблице реестра Object и обнаруживает, что он сопоставлен с типом *uuid7*.
6.  Чтобы узнать тип диспетчера, Библиотека времени выполнения сервера объединяет идентификатор UUID интерфейса *uuid2* и тип *uuid7* в таблице реестра Interface. Это разрешается в *epv3*, который содержит подпрограммы диспетчера сервера, выполняемые для удаленного вызова процедуры.

Подпрограммы в *epv2* никогда не будут выполняться, так как сервер не вызывал подсистему [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для добавления объектов с типом UUID *uuid4* в таблицу реестра Object.

Удаленный вызов процедур с UUID интерфейса *uuid2* и идентификатором UUID *ууидф* возвращает вызывающему объекту с \_ \_ кодом состояния "Неизвестный тип диспетчера RPC S" \_ \_ , так как сервер не вызывал [**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif), [**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)или [**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2) для регистрации интерфейса с типом диспетчера *uuid8*.

## <a name="return-values"></a>Возвращаемые значения

Эта функция возвращает одно из следующих значений.



| Значение                             | Значение                      |
|-----------------------------------|------------------------------|
| RPC \_ S \_ OK                        | Успешно                      |
| \_тип RPC \_ S \_ уже \_ зарегистрирован | UUID типа уже зарегистрирован |



 

## <a name="supplying-your-own-object-inquiry-function"></a>Предоставление собственной функции Object-запроса

Рассмотрим сервер, который управляет тысячами объектов различных типов. При каждом запуске сервера серверное приложение должно вызывать функцию [**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype) для каждого объекта, даже несмотря на то, что клиенты могут ссылаться только на некоторые из них (или занимать много времени для обращения к ним). Эти тысячи объектов, вероятно, будут находиться на диске, поэтому получение их типов может занять много времени. Кроме того, внутренняя таблица, которая сопоставляет UUID объекта с ИДЕНТИФИКАТОРом типа диспетчера, фактически дублирует сопоставление, поддерживаемое объектами.

Для удобства набор функций RPC включает функцию [**рпкобжектсетинкфн**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsetinqfn). С помощью этой функции вы предоставляете собственную функцию Object-запроса.

Например, вы можете указать собственную функцию Object-запроса при сопоставлении объектов 100 – 199 с типом Number 1, 200 – 299, типом Number 2 и т. д. Функцию запроса объекта также можно расширить на распределенную файловую систему, в которой серверное приложение не имеет списка всех доступных файлов (UUID объекта) или если идентификаторы UUID объекта имеют имена файлов в файловой системе и не хотят предварительно загружать все сопоставления между идентификаторами UUID объекта и UUID типа.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**рпкбиндингфромстрингбиндинг**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingfromstringbinding)
</dt> <dt>

[**рпкбиндингсетобжект**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetobject)
</dt> <dt>

[**рпкнсбиндинжекспорт**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingexporta)
</dt> <dt>

[**рпкнсбиндингимпортбегин**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindingimportbegina)
</dt> <dt>

[**рпкнсбиндинглукупбегин**](/windows/desktop/api/Rpcnsi/nf-rpcnsi-rpcnsbindinglookupbegina)
</dt> <dt>

[**рпкобжектсеттипе**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcobjectsettype)
</dt> <dt>

[**рпксерверрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif)
</dt> <dt>

[**RpcServerRegisterIf2**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif2)
</dt> <dt>

[**рпксерверрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex)
</dt> <dt>

[**рпксерверунрегистериф**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterif)
</dt> <dt>

[**рпксерверунрегистерифекс**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverunregisterifex)
</dt> </dl>

 

 




