---
description: В этом разделе описывается создание, определение, установка и удаление таймеров.
ms.assetid: 509a6fc4-ddee-4ff4-88a2-25dad4c48c2f
title: О таймерах
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b3163dbfd5357de516e0202665cd76d017335593
ms.sourcegitcommit: 9eebab0ead09cecdbc24f5f84d56c8b6a7c22736
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2021
ms.locfileid: "124370953"
---
# <a name="about-timers"></a>О таймерах

В этом разделе описывается создание, определение, установка и удаление таймеров. Приложение использует таймер, чтобы запланировать событие для окна по истечении заданного времени. Каждый раз, когда истечет указанный интервал (или значение времени ожидания) для таймера, система уведомляет окно, связанное с таймером. Поскольку точность таймера зависит от частоты системных часов и частоты, с которой приложение получает сообщения из очереди сообщений, значение времени ожидания будет приблизительным.

Этот раздел включает следующие подразделы:

-   [Операции с таймером](#timer-operations)
-   [Таймер с высоким разрешением](#high-resolution-timer)
-   [Ожидающие объекты таймера](#waitable-timer-objects)
-   [Связанные разделы](#related-topics)

## <a name="timer-operations"></a>Операции с таймером

Приложения создают таймеры с помощью функции [**сеттимер**](/windows/win32/api/winuser/nf-winuser-settimer) . Новый таймер начинает отсчет времени с момента создания. Приложение может изменить значение времени ожидания таймера с помощью **сеттимер** и может уничтожить таймер с помощью функции [**киллтимер**](/windows/win32/api/winuser/nf-winuser-killtimer) . Для эффективного использования системных ресурсов приложения должны удалять таймеры, которые больше не нужны.

Каждый таймер имеет уникальный идентификатор. При создании таймера приложение может либо указать идентификатор, либо создать в системе уникальное значение. Первый параметр сообщения [**\_ таймера WM**](wm-timer.md) содержит идентификатор таймера, который опубликовал сообщение.

Если указать маркер окна в вызове [**сеттимер**](/windows/win32/api/winuser/nf-winuser-settimer), приложение связывает таймер с этим окном. Если время ожидания для таймера истекает, система отправляет сообщение [**\_ таймера WM**](wm-timer.md) в окно, связанное с таймером. Если в вызове **сеттимер** не указан маркер окна, приложение, создавшее таймер, должно отслеживать его очередь сообщений на наличие сообщений **\_ таймера WM** и отправлять их в соответствующее окно. Если указать функцию обратного вызова [**тимерпрок**](/windows/win32/api/winuser/nc-winuser-timerproc) , то процедура окна по умолчанию вызывает функцию обратного вызова при обработке **\_ таймера WM**. Поэтому необходимо отправлять сообщения в вызывающем потоке даже при использовании **тимерпрок** вместо обработки **\_ таймера WM**.

Если необходимо получать уведомления по истечении времени таймера, используйте таймер ожидания. Дополнительные сведения см. в разделе [ожидающие объекты таймера](/windows/desktop/Sync/waitable-timer-objects).

## <a name="high-resolution-timer"></a>Таймер High-Resolution

Счетчик — это общий термин, используемый в программировании для ссылки на переменную приращения. Некоторые системы включают счетчик производительности высокого разрешения, который обеспечивает время, прошедшее с высоким разрешением.

Если в системе имеется счетчик производительности высокого разрешения, можно использовать функцию [**куериперформанцефрекуенци**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) для выражения частоты в количестве в секунду. Значение счетчика зависит от процессора. На некоторых процессорах, например, счетчик может быть циклической скоростью процессорных часов.

Функция [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) извлекает текущее значение счетчика производительности с высоким разрешением. Вызывая эту функцию в начале и конце раздела кода, приложение по сути использует этот счетчик как таймер высокого разрешения. Например, предположим, что [**куериперформанцефрекуенци**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancefrequency) указывает, что частота счетчика производительности высокого разрешения составляет 50 000 счетчиков в секунду. Если приложение вызывает **QueryPerformanceCounter** непосредственно перед и сразу после того, как раздел кода будет иметь время ожидания, значения счетчика могут быть 1500 числами и 3500 соответственно. Эти значения указывают на то, что во время выполнения кода прошло .04 секунд (число 2000).

## <a name="waitable-timer-objects"></a>Ожидающие объекты таймера

Ожидающий объект таймера — это объект синхронизации, состояние которого задается сигнальным по наступлении указанного времени выполнения. Существует два типа таймеров ожидания, которые можно создать: сброс и синхронизация вручную. Таймер любого типа также может быть периодическим таймером.

Поток использует функцию [**сбой createwaitabletimer**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerw) или [**креатеваитаблетимерекс**](/windows/win32/api/synchapi/nf-synchapi-createwaitabletimerexw) для создания объекта Timer. Создание потока указывает, является ли таймер таймером сброса вручную или таймером синхронизации. Создающий поток может указать имя для объекта Timer. Потоки в других процессах могут открыть обработчик для существующего таймера, указав его имя в вызове функции [**опенваитаблетимер**](/windows/win32/api/synchapi/nf-synchapi-openwaitabletimerw) . Любой поток с дескриптором объекта Timer может использовать одну из функций ожидания, чтобы ждать, пока состояние таймера не станет сигнальным.

Дополнительные сведения об использовании ожидающих объектов таймера для синхронизации потоков см. в разделе [ожидающие объекты таймера](/windows/desktop/Sync/waitable-timer-objects).

## <a name="related-topics"></a>Связанные разделы

<dl> <dt>

[Использование таймеров](using-timers.md)
</dt> </dl>

 

 
