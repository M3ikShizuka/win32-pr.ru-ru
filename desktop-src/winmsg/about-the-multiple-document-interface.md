---
description: Каждый документ в приложении с многодокументным интерфейсом (MDI) отображается в отдельном дочернем окне в клиентской области главного окна приложения.
ms.assetid: 35dff281-3b11-4954-85cf-a0f1c9ed346a
title: Сведения об интерфейсе нескольких документов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a0397127d7ec343ebdb7696c2dd7d57204a5d5ae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664611"
---
# <a name="about-the-multiple-document-interface"></a>Сведения об интерфейсе нескольких документов

Каждый документ в приложении с многодокументным интерфейсом (MDI) отображается в отдельном дочернем окне в клиентской области главного окна приложения. К типичным приложениям MDI относятся приложения для обработки текстов, позволяющие пользователю работать с несколькими текстовыми документами и приложениями электронных таблиц, которые позволяют пользователю работать с несколькими диаграммами и электронными таблицами. Дополнительные сведения см. в следующих разделах:

-   [Фрейм, клиент и дочерние окна](#frame-client-and-child-windows)
-   [Создание дочернего окна](#child-window-creation)
-   [Активация дочернего окна](#child-window-activation)
-   [Несколько меню документов](#multiple-document-menus)
-   [Несколько ускорителей документов](#multiple-document-accelerators)
-   [Размер и расположение дочернего окна](#child-window-size-and-arrangement)
-   [Окна заголовка значка](#icon-title-windows)
-   [Данные дочернего окна](#child-window-data)
    -   [Структура окна](#window-structure)
    -   [Свойства окна](#window-properties)

## <a name="frame-client-and-child-windows"></a>Фрейм, клиент и дочерние окна

Приложение MDI имеет три вида окон: окно фрейма, окно клиента MDI, а также ряд дочерних окон. *Окно фрейма* похоже на главное окно приложения: оно имеет границу изменения размера, строку заголовка, меню окна, кнопку сворачивания и кнопку развернуть. Приложение должно зарегистрировать класс окна для фрейма окна и предоставить процедуру окна для ее поддержки.

Приложение MDI не отображает выходные данные в клиентской области окна фрейма. Вместо этого отображается окно клиента MDI. *Клиентское окно MDI* — это специальный тип дочернего окна, принадлежащего предварительно зарегистрированному классу окна **мдиклиент**. Окно клиента является дочерним по отношению к окну фрейма; Он выступает в качестве фона для дочерних окон. Он также обеспечивает поддержку создания дочерних окон и управления ими. Например, приложение MDI может создавать, активировать или разворачивание дочерних окон, отправляя сообщения в окно клиента MDI.

Когда пользователь открывает или создает документ, окно клиента создает дочернее окно для документа. Окно клиента — это родительское окно всех дочерних окон MDI в приложении. У каждого дочернего окна есть граница размеров, строка заголовка, меню окна, Кнопка сворачивания и кнопка развертывания. Так как дочернее окно обрезается, оно ограничено окном клиента и не может находиться за пределами.

Приложение MDI может поддерживать более одного вида документов. Например, обычное приложение электронной таблицы позволяет пользователю работать с диаграммами и электронными таблицами. Для каждого поддерживаемого типа документа приложение MDI должно зарегистрировать класс дочернего окна и предоставить процедуру окна для поддержки окон, принадлежащих этому классу. Дополнительные сведения о классах окон см. в разделе [классы окон](window-classes.md). Дополнительные сведения о процедурах окна см. в разделе [процедуры окна](window-procedures.md).

Ниже приведено типичное приложение MDI. Он называется Мултипад.

![окно фрейма приложения мултипад MDI и окно клиента](images/csmdi-01.png)

## <a name="child-window-creation"></a>Создание дочернего окна

Чтобы создать дочернее окно, приложение MDI либо вызывает функцию [**креатемдивиндов**](/windows/win32/api/winuser/nf-winuser-createmdiwindowa) , либо отправляет сообщение [**WM \_ МДИКРЕАТЕ**](wm-mdicreate.md) в окно клиента MDI. Более эффективный способ создания дочернего окна MDI — вызов функции [**CreateWindowEx**](/windows/win32/api/winuser/nf-winuser-createwindowexa) с указанием расширенного стиля **WS \_ ex \_ мдичилд** .

Чтобы уничтожить дочернее окно, приложение MDI отправляет сообщение [**WM \_ мдидестрой**](wm-mdidestroy.md) в окно клиента MDI.

## <a name="child-window-activation"></a>Активация дочернего окна

Любое количество дочерних окон может отображаться в клиентском окне в любое время, но только один из них может быть активным. Активное дочернее окно позиционируется перед всеми остальными дочерними окнами, и его граница выделяется.

Пользователь может активировать неактивное дочернее окно, щелкнув его. Приложение MDI активирует дочернее окно, отправляя сообщение [**WM \_ мдиактивате**](wm-mdiactivate.md) в окно клиента MDI. По мере того как клиентское окно обрабатывает это сообщение, оно отправляет сообщение **WM \_ мдиактивате** в процедуру окна дочернего окна, чтобы активировать его, а также в процедуру окна дочернего окна, которое деактивируется.

Чтобы предотвратить активацию дочернего окна, обрабатывайте сообщение [**WM \_ нкактивате**](wm-ncactivate.md) до дочернего окна, возвращая **значение false**.

Система отслеживает расположение каждого дочернего окна в стеке перекрывающихся окон. Этот стек называется [Z-порядком](window-features.md). Пользователь может активировать следующее дочернее окно в Z порядке, нажав кнопку **Далее** в меню окно в активном окне. Приложение активирует следующее (или предыдущее) дочернее окно в Z-порядке, отправляя сообщение [**WM \_ мдинекст**](wm-mdinext.md) в окно клиента.

Чтобы получить маркер активного дочернего окна, приложение MDI отправляет сообщение [**WM \_ мдижетактиве**](wm-mdigetactive.md) в окно клиента.

## <a name="multiple-document-menus"></a>Несколько меню документов

Окно фрейма приложения MDI должно включать строку меню с меню «окно». Меню окно должно включать элементы, которые упорядочивают дочерние окна в окне клиента или закрывают все дочерние окна. Меню окна типичного приложения MDI может включать элементы, приведенные в следующей таблице.



| Элемент меню         | Назначение                                                                                                                  |
|-------------------|--------------------------------------------------------------------------------------------------------------------------|
| **Tile**          | Упорядочивает дочерние окна в формате мозаики, чтобы каждый из них полностью появился в окне клиента.                       |
| **Cascade**       | Упорядочивает дочерние окна в формате Cascade. Дочерние окна перекрываются друг с другом, но отображается заголовок каждого из них. |
| **Упорядочить значки** | Упорядочивает значки элементов с минимальными дочерними окнами в нижней части окна клиента.                                     |
| **Закрыть все**     | Закрывает все дочерние окна.                                                                                                |



 

При создании дочернего окна система автоматически добавляет новый пункт меню в меню окно. Текст пункта меню совпадает с текстом в строке меню нового дочернего окна. Щелкнув пункт меню, пользователь может активировать соответствующее дочернее окно. При уничтожении дочернего окна система автоматически удаляет соответствующий пункт меню из меню окно.

Система может добавить до десяти пунктов меню в меню окно. При создании десятого дочернего окна система добавляет в меню окно **больше элементов Windows** . Если щелкнуть этот элемент, откроется диалоговое окно **Выбор окна** . Диалоговое окно содержит список с названиями всех доступных в данный момент дочерних окон MDI. Пользователь может активировать дочернее окно, щелкнув его заголовок в списке.

Если приложение MDI поддерживает несколько типов дочерних окон, настройте строку меню, отражающую операции, связанные с активным окном. Для этого предоставьте отдельные ресурсы меню для каждого типа дочернего окна, которое поддерживает приложение. При активации нового типа дочернего окна приложение должно отправить сообщение [**WM \_ мдисетмену**](wm-mdisetmenu.md) в клиентское окно, передав ему маркер соответствующего меню.

Если дочернего окна не существует, строка меню должна содержать только элементы, используемые для создания или открытия документа.

Когда пользователь проходит через меню приложения MDI с помощью клавиш курсора, клавиши ведут себя иначе, чем при переходе пользователя по типичным меню приложения. В приложении MDI управление передается из меню окна приложения в меню окно активного дочернего окна, а затем к первому элементу в строке меню.

## <a name="multiple-document-accelerators"></a>Несколько ускорителей документов

Для получения и обработки сочетаний клавиш для дочерних окон приложение MDI должно содержать функцию [**транслатемдисисакцел**](/windows/win32/api/winuser/nf-winuser-translatemdisysaccel) в своем цикле обработки сообщений. Цикл должен вызвать **транслатемдисисакцел** перед вызовом функции [**TranslateAccelerator**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) или [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) .

Сочетания клавиш в меню окно для дочернего окна MDI отличаются от сочетаний для дочерних окон, не являющихся дочерними MDI. В дочернем окне MDI сочетание клавиш ALT + – (минус) открывает меню окно, сочетание клавиш CTRL + F4 закрывает активное дочернее окно, а сочетание клавиш CTRL + F6 активирует следующее дочернее окно.

## <a name="child-window-size-and-arrangement"></a>Размер и расположение дочернего окна

Приложение MDI управляет размером и положением его дочерних окон, отправляя сообщения в окно клиента MDI. Чтобы развернуть активное дочернее окно, приложение отправляет сообщение [**WM \_ мдимаксимизе**](wm-mdimaximize.md) в окно клиента. Когда дочернее окно разворачивается, его клиентская область полностью заполняет окно клиента MDI. Кроме того, система автоматически скрывает строку заголовка дочернего окна и добавляет значок меню окна дочернего окна и кнопку восстановить в строку меню приложения MDI. Приложение может восстановить исходное (развернутое) окно клиента до исходного размера и расположения, отправив клиентскому окну сообщение [**WM \_ мдиресторе**](wm-mdirestore.md) .

Приложение MDI может упорядочивать дочерние окна в виде каскадного или мозаичного представления. Когда дочерние окна располагаются каскадом, окна отображаются в стеке. Окно, расположенное внизу стека, занимает левый верхний угол экрана, а остальные окна смещаются вертикально и горизонтально, чтобы отображалась левая граница и заголовок каждого дочернего окна. Чтобы разместить дочерние окна в формате Cascade, приложение MDI отправляет сообщение [**WM \_ мдикаскаде**](wm-mdicascade.md) . Как правило, приложение отправляет это сообщение, когда пользователь щелкает **Каскад** в меню окна.

При мозаичном заполнении дочерних окон система отображает все дочерние окна целиком — пересекается ни с одной из окон. При необходимости все окна будут иметь размер в окне клиента. Чтобы упорядочить дочерние окна в формате плитки, приложение MDI отправляет сообщение [**WM \_ мдитиле**](wm-mditile.md) в окно клиента. Как правило, приложение отправляет это сообщение, когда пользователь щелкает **плитку** в меню окно.

Приложение MDI должно иметь разные значки для каждого типа дочернего окна, которое он поддерживает. Приложение задает значок при регистрации класса дочернего окна. При сворачивании дочернего окна система автоматически отображает значок дочернего окна в нижней части окна клиента. Приложение MDI направляет систему на размещение значков дочерних окон, отправляя сообщение [**WM \_ мдииконарранже**](wm-mdiiconarrange.md) в окно клиента. Как правило, приложение отправляет это сообщение, когда пользователь нажимает кнопку **Упорядочить значки** в меню окно.

## <a name="icon-title-windows"></a>Окна заголовка значка

Так как дочерние окна MDI могут быть сведены, приложение MDI должно избегать обработки окон заголовков значков, как если бы они были обычными дочерними окнами MDI. Окна с названиями значков отображаются, когда приложение перечисляет дочерние окна клиента MDI. Окна заголовков значков отличаются от других дочерних окон тем, что они принадлежат дочернему окну MDI.

Чтобы определить, является ли дочернее окно окном заголовка значка, используйте функцию "с помощью функции"- [**окна**](/windows/win32/api/winuser/nf-winuser-getwindow) "с \_ индексом владельца GW. Окна, не являющиеся заголовками, возвращают **значение NULL**. Обратите внимание, что этот тест недостаточен для окон верхнего уровня, так как меню и диалоговые окна являются собственностью Windows.

## <a name="child-window-data"></a>Данные дочернего окна

Поскольку количество дочерних окон зависит от того, сколько документов открывается пользователем, приложение MDI должно иметь возможность связывать данные (например, имя текущего файла) с каждым дочерним окном. Это можно сделать двумя способами.

-   Сохранение данных дочернего окна в структуре окна.
-   Используйте свойства окна.

### <a name="window-structure"></a>Структура окна

Когда приложение MDI регистрирует класс окна, оно может зарезервировать дополнительное пространство в структуре окна для данных приложений, относящихся к конкретному классу Windows. Для хранения и извлечения данных в это дополнительное пространство приложение использует функции [**жетвиндовлонг**](/windows/win32/api/winuser/nf-winuser-getwindowlonga) и [**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) .

Чтобы сохранить большой объем данных для дочернего окна, приложение может выделить память для структуры данных, а затем сохранить этот обработчик в памяти, содержащей структуру, в дополнительное пространство, связанное с дочерним окном.

### <a name="window-properties"></a>Свойства окна

Приложение MDI может также хранить данные отдельных документов с помощью свойств окна. *Данные по документу* — это данные, относящиеся к типу документа, содержащегося в конкретном дочернем окне. Свойства отличаются от дополнительного пространства в структуре окна тем, что при регистрации класса окна не требуется выделять дополнительное пространство. Окно может иметь любое количество свойств. Кроме того, когда для доступа к дополнительному пространству в структурах окон используются смещения, свойства называются именами строк. Дополнительные сведения о свойствах окна см. в разделе [Свойства окна](window-properties.md).

 

 
