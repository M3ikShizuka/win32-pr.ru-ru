---
description: Для чтения из представления файла следует обращаться к указателю, возвращенному функцией MapViewOfFile, как показано в примерах ниже.
ms.assetid: c2a3da09-d116-4c2c-9e6c-ec9e80c88b99
title: Чтение и запись в представлении файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4458f98e1ea4239c01b77983ac13a9cb2eec5d86
ms.sourcegitcommit: ccf7dea7222b925441486fa564a1a61b69395562
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2021
ms.locfileid: "123463071"
---
# <a name="reading-and-writing-from-a-file-view"></a>Чтение и запись в представлении файлов

Для чтения из представления файла следует обращаться к указателю, возвращенному функцией [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , как показано в примерах ниже.

Чтение или запись в представлении файла, отличного от файла подкачки, может вызвать исключение в случае **\_ \_ \_ ошибки страницы** . Например, если соединение с сервером потеряно, доступ к сопоставленному файлу, расположенному на удаленном сервере, может вызвать исключение. Исключения также могут возникать из-за переполнения диска, сбоя основного устройства или сбоя выделения памяти. Чтобы защититься от исключений из-за ошибок ввода-вывода, все попытки доступа к отображенным в памяти файлам должны быть заключены в структурированные обработчики исключений. При получении **исключения \_ на \_ странице \_ Ошибка** в фильтре, **\_ \_ Кроме** , убедитесь, что адрес находится в текущем сопоставлении. Если это так, восстановите или завершите работу успешно. в противном случае не обрабатывайте исключение.

В следующем примере используется указатель, возвращенный **MapViewOfFile** для чтения из представления файлов:


```C++
  DWORD dwLength;

  __try
  {
    dwLength = *((LPDWORD) lpMapAddress);
  }
  __except(GetExceptionCode()==EXCEPTION_IN_PAGE_ERROR ?
    EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH)
  {
    // Failed to read from the view.
  }
```



В следующем примере используется указатель, возвращенный функцией **MapViewOfFile** для записи в представление файла:


```C++
  DWORD dwLength;

  __try
  {
    *((LPDWORD) lpMapAddress) = dwLength;
  }
  __except (GetExceptionCode() == EXCEPTION_IN_PAGE_ERROR ? 
    EXCEPTION_EXECUTE_HANDLER : EXCEPTION_CONTINUE_SEARCH)
  {
    // Failed to write to the view.
  }
```



Функция [**флушвиевоффиле**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) Копирует указанное число байтов представления файла в физический файл, не дожидаясь возникновения кэшированной операции записи:


```C++
  if (!FlushViewOfFile(lpMapAddress, dwBytesToFlush)) 
  {
    printf("Could not flush memory to disk (%d).\n", GetLastError()); 
  }
```



При сопоставлении сжатого или разреженного файла в разделе NTFS может возникнуть дополнительная ошибка ввода-вывода при разбиении на страницы в части файла. В этом случае адресное пространство, сопоставленное [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , может не поддерживаться выделенным дисковым пространством. Это связано с тем, что разреженный файл может иметь области нулей, для которых NTFS не выделяет место на диске, а сжатый файл может занимать меньше места на диске, чем фактические данные, которые он представляет. При чтении или записи в часть разреженного или сжатого файла, который не поддерживается дисковым пространством, операционная система может попытаться выделить место на диске. Если диск заполнен, это может привести к возникновению исключения, указывающего на ошибку ввода-вывода.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Структурированная обработка исключений](../debug/structured-exception-handling.md)
</dt> </dl>

 

 
