---
Description: Ниже приведены параметры защиты памяти. При выделении или защите страницы в памяти необходимо указать одно из следующих значений. Атрибуты защиты нельзя присвоить части страницы; они могут быть назначены только целой странице.
ms.assetid: 09839db7-2118-4a7d-a707-a08c92bd600c
title: Константы защиты памяти (WinNT. h)
ms.topic: reference
ms.custom: snippet-project
ms.date: 07/27/2020
ms.openlocfilehash: 187e8e1f4e137823451771309c9cce19db2e7fbd9c5b57597b51cfc58ca61297
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119067694"
---
# <a name="memory-protection-constants"></a>Константы защиты памяти

Ниже приведены параметры защиты памяти. При выделении или защите страницы в памяти необходимо указать одно из следующих значений. Атрибуты защиты нельзя присвоить части страницы; они могут быть назначены только целой странице.

## <a name="example"></a>Пример

```cpp
STDMETHODIMP CExtBuffer::FInit
    (
    ULONG cItemMax,     //@parm IN | Maximum number of items ever
    ULONG cbItem,       //@parm IN | Size of each item, in bytes
    ULONG cbPage        //@parm IN | Size of system page size (from SysInfo)
    )
{
    BYTE  *pb;

    m_cbReserved = ((cbItem *cItemMax) / cbPage + 1) *cbPage;
    m_rgItem = (BYTE *) VirtualAlloc( NULL, m_cbReserved, MEM_RESERVE, PAGE_READWRITE );

    if (m_rgItem == NULL)
        return ResultFromScode( E_OUTOFMEMORY );

    m_cbItem  = cbItem;
    m_dbAlloc = (cbItem / cbPage + 1) *cbPage;
    pb = (BYTE *) VirtualAlloc( m_rgItem, m_dbAlloc, MEM_COMMIT, PAGE_READWRITE );
    if (pb == NULL)
        {
        VirtualFree((VOID *) m_rgItem, 0, MEM_RELEASE );
        m_rgItem = NULL;
        return ResultFromScode( E_OUTOFMEMORY );
        }

    m_cbAlloc = m_dbAlloc;
    return ResultFromScode( S_OK );
}
```
пример из [Windows классических примеров](https://github.com/microsoft/Windows-classic-samples/blob/1d363ff4bd17d8e20415b92e2ee989d615cc0d91/Samples/Win7Samples/dataaccess/oledb/sampprov/extbuff.cpp) на GitHub.

## <a name="constants"></a>Константы


| Константа/значение                                                                                                                                                                                                                                             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="PAGE_EXECUTE"></span><span id="page_execute"></span><dl> <dt>**Страница \_ ВЫПОЛНИТЬ**</dt> <dt>0x10</dt> </dl>                                       | Разрешает выполнение доступа к зафиксированной области страниц. Попытка записи в зафиксированную область приводит к нарушению прав доступа.<br/> Этот флаг не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="PAGE_EXECUTE_READ"></span><span id="page_execute_read"></span><dl> <dt>**Страница \_ ВЫПОЛНЕНИЕ \_ Read**</dt> <dt>0x20</dt> </dl>                       | Разрешает выполнение или доступ только для чтения к зафиксированной области страниц. Попытка записи в зафиксированную область приводит к нарушению прав доступа.<br/> **Windows Server 2003 и Windows XP:** этот атрибут не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , пока не Windows XP с пакетом обновления 2 (SP2) и Windows Server 2003 с пакетом обновления 1 (SP1).<br/>                                                                                                                                                                                                                                                                                                                                |
| <span id="PAGE_EXECUTE_READWRITE"></span><span id="page_execute_readwrite"></span><dl> <dt>**Страница \_ ВЫПОЛНЕНИЕ \_ ReadWrite**</dt> <dt>0x40</dt> </dl>        | Разрешает выполнение, доступ только для чтения или чтение и запись для зафиксированной области страниц.<br/> **Windows Server 2003 и Windows XP:** этот атрибут не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , пока не Windows XP с пакетом обновления 2 (SP2) и Windows Server 2003 с пакетом обновления 1 (SP1).<br/>                                                                                                                                                                                                                                                                                                                                                                                               |
| <span id="PAGE_EXECUTE_WRITECOPY"></span><span id="page_execute_writecopy"></span><dl> <dt>**Страница \_ ВЫПОЛНЕНИЕ \_ вритекопи**</dt> <dt>0x80</dt> </dl>        | Разрешает выполнение, доступ только для чтения или копирование при записи в сопоставленное представление объекта сопоставления файлов. Попытка записи в зафиксированную страницу копирования при записи приводит к получению закрытой копии страницы, выполняемой для процесса. Частная страница помечается как **Страница \_ Execute \_ ReadWrite**, а изменение записывается на новую страницу.<br/> Этот флаг не поддерживается функциями [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) или [**виртуалаллоцекс**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex) . **Windows Vista, Windows Server 2003 и Windows XP:** этот атрибут не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) , пока Windows Vista с пакетом обновления 1 (SP1) и Windows Server 2008.<br/> <br/> |
| <span id="PAGE_NOACCESS"></span><span id="page_noaccess"></span><dl> <dt>**Страница \_ Недоступно**</dt> <dt>0x01</dt> </dl>                                    | Отключает доступ к зафиксированной области страниц. Попытка чтения, записи или выполнения зафиксированной области приводит к нарушению прав доступа.<br/> Этот флаг не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="PAGE_READONLY"></span><span id="page_readonly"></span><dl> <dt>**Страница \_ ТОЛЬКО для чтения**</dt> <dt>0x02</dt> </dl>                                    | Разрешает доступ только для чтения к зафиксированной области страниц. Попытка записи в зафиксированную область приводит к нарушению прав доступа. Если включено [предотвращение выполнения данных](data-execution-prevention.md) , попытка выполнить код в зафиксированной области приведет к нарушению прав доступа.<br/>                                                                                                                                                                                                                                                                                                                                                                                            |
| <span id="PAGE_READWRITE"></span><span id="page_readwrite"></span><dl> <dt>**Страница \_**</dt> <dt>0x04</dt> ReadWrite </dl>                                 | Включает доступ только для чтения или чтение и запись для зафиксированной области страниц. Если включено [предотвращение выполнения данных](data-execution-prevention.md) , попытка выполнить код в зафиксированной области приведет к нарушению прав доступа.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span id="PAGE_WRITECOPY"></span><span id="page_writecopy"></span><dl> <dt>**Страница \_ ВРИТЕКОПИ**</dt> <dt>0x08</dt> </dl>                                 | Разрешает доступ только для чтения или копирование при записи в сопоставленное представление объекта сопоставления файлов. Попытка записи в зафиксированную страницу копирования при записи приводит к получению закрытой копии страницы, выполняемой для процесса. Частная страница помечается как **\_ ReadWrite** с добавлением в страницу, а изменение записывается на новую страницу. Если включено [предотвращение выполнения данных](data-execution-prevention.md) , попытка выполнить код в зафиксированной области приведет к нарушению прав доступа.<br/> Этот флаг не поддерживается функциями [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) или [**виртуалаллоцекс**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex) .<br/>                                                                               |
| <span id="PAGE_TARGETS_INVALID"></span><span id="page_targets_invalid"></span><dl> <dt>**Страница \_ ЦЕЛЕВые объекты \_ недопустимы**</dt> <dt>0x40000000</dt> </dl>        | Задает все расположения на страницах в качестве недопустимых целевых объектов для CFG. Используется вместе с любой защитой выполнения страницы, такой как **\_ выполнение страницы**, **\_ \_ чтение страницы**, выполнение **страницы \_ \_** и выполнение **\_ \_ вритекопи**. Любой непрямой вызов мест на этих страницах приведет к сбою проверки CFG, и процесс будет завершен. По умолчанию выделенные исполняемые страницы должны быть помечены как допустимые цели вызова для CFG.<br/> Этот флаг не поддерживается функциями [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) и [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/>                                                                                                              |
| <span id="PAGE_TARGETS_NO_UPDATE"></span><span id="page_targets_no_update"></span><dl> <dt>**Страница \_ ЦЕЛЕВые объекты \_ без \_ обновления**</dt> <dt>0x40000000</dt> </dl> | При изменении защиты для [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect)страницы в регионе не будут обновлять сведения о cfg. Например, если страницы в регионе были выделены с помощью **\_ \_ недопустимых целей страницы**, то при изменении защиты страницы будут поддерживаться недопустимые данные. Этот флаг допустим только в том случае, если защита изменяется на тип исполняемого файла, например **\_ выполнение страницы**, **\_ \_ чтение страницы выполнение**, **Страница \_ выполнение \_ ReadWrite** и **Страница \_ Execute \_ вритекопи**. Поведение по умолчанию для **VirtualProtect** защиты от изменения до исполняемого файла заключается в пометке всех расположений как допустимых целевых объектов вызова для cfg. <br/>                                           |



Ниже приведены модификаторы, которые можно использовать в дополнение к параметрам, приведенным в предыдущей таблице, за исключением указанных.



| Константа/значение                                                                                                                                                                                                                       | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="PAGE_GUARD"></span><span id="page_guard"></span><dl> <dt>**Страница \_ ПРЕДОХРАНИТЕЛЬ**</dt> <dt>0x100</dt> </dl>                      | Страницы в регионе становятся защищенными страницами. Любая попытка доступа к странице защиты приводит к тому, что система вызывает исключение **\_ \_ \_ нарушения страницы состояния** и отключает состояние страницы защиты. Таким образом, страницы защиты действуют как однократный сигнал доступа. Дополнительные сведения см. в разделе [Creating Guard Pages](creating-guard-pages.md).<br/> Если попытка доступа приводит к отключению состояния страницы защиты, то защита базовой страницы продолжается.<br/> Если исключение страницы защиты возникает во время системной службы, служба обычно возвращает индикатор состояния сбоя.<br/> Это значение нельзя использовать с **\_ недоступностью страницы**.<br/> Этот флаг не поддерживается функцией [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/>                                                                                                                                                                                                                              |
| <span id="PAGE_NOCACHE"></span><span id="page_nocache"></span><dl> <dt>**Страница \_**</dt> <dt>0X200</dt> с кэшем </dl>                | Задает все страницы, не являющиеся кэшируемые. Приложения не должны использовать этот атрибут, за исключением случаев, когда явно требуется для устройства. Использование блокируемых функций с памятью, сопоставленной с **\_ кэшем sec** , может привести к **исключению \_ недопустимых \_ инструкций** .<br/> Флаг **\_ некэширования страницы** не может использоваться со флагами **Page \_ Guard**, **\_ unaccess** или Page **\_ вритекомбине** .<br/> Флаг **\_ кэширования страницы** можно использовать только при выделении частной памяти с помощью функций [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), [**виртуалаллоцекс**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)или [**виртуалаллоцекснума**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocexnuma) . Чтобы включить доступ к некэшированной памяти для общей памяти, укажите **флаг \_ SEC в секунду** при вызове функции [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/>                                                                                                                                                   |
| <span id="PAGE_WRITECOMBINE"></span><span id="page_writecombine"></span><dl> <dt>**Страница \_ ВРИТЕКОМБИНЕ**</dt> <dt>0x400</dt> </dl> | Задает совместную запись всех страниц. <br/> Приложения не должны использовать этот атрибут, за исключением случаев, когда явно требуется для устройства. Использование блокируемых функций с памятью, сопоставленной как Объединенная запись, может привести к **исключению \_ недопустимых \_ инструкций** . <br/> Флаг **\_ вритекомбинеа страницы** не может быть указан с ФЛАГами **\_ недоступности страницы**, Application **\_ Guard** и **\_ кэша страницы** . <br/> Флаг **Page \_ вритекомбине** можно использовать только при выделении частной памяти с помощью функций [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), [**виртуалаллоцекс**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)или [**виртуалаллоцекснума**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocexnuma) . Чтобы включить совместное использование памяти для общей памяти, укажите флаг **\_ Вритекомбине в секунду** при вызове функции [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) .<br/> **Windows Server 2003 и Windows XP:** этот флаг не поддерживается до Windows Server 2003 с пакетом обновления 1 (SP1).<br/> |



Следующие константы можно использовать с функцией [**лоаденклаведата**](/windows/desktop/api/enclaveapi/nf-enclaveapi-loadenclavedata) только при указании анклава с архитектурой Intel Software Guard Extensions (SGX).



| Константа                                                                                                                                                                                                  | Описание                                                                                                                                 |
|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="PAGE_ENCLAVE_THREAD_CONTROL"></span><span id="page_enclave_thread_control"></span><dl> <dt>**\_ \_ элемент управления ПОТОКОМ анклава страницы \_**</dt> </dl> | Страница содержит структуру управления потоком (TCS).<br/>                                                                              |
| <span id="PAGE_ENCLAVE_UNVALIDATED"></span><span id="page_enclave_unvalidated"></span><dl> <dt>**Страница \_ анклава не \_ проверена**</dt> </dl>           | Предоставляемое содержимое страницы исключается из измерения с помощью инструкции ИКСТЕНД модели программирования Intel SGX.<br/> |



## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения XP\]<br/>                                                            |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2003\]<br/>                                                   |
| Заголовок<br/>                   | <dl> <dt>WinNT. h (включает Windows. h)</dt> </dl> |



## <a name="see-also"></a>См. также

<dl> <dt>

[**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)
</dt> <dt>

[Защита памяти](memory-protection.md)
</dt> <dt>

[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)
</dt> <dt>

[**виртуалаллоцекс**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex)
</dt> <dt>

[**лоаденклаведата**](/windows/desktop/api/enclaveapi/nf-enclaveapi-loadenclavedata)
</dt> </dl>

 

 
