---
description: Когда процесс завершается с помощью объекта сопоставления файлов, он должен уничтожить все представления файлов в своем адресном пространстве, используя функцию UnmapViewOfFile для каждого представления файлов.
ms.assetid: d62d068c-9b1d-4dbf-8b21-31a636a41456
title: Закрытие объекта сопоставления файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ab35152bd90d401ca7f30a7497d1f0b06263539
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909483"
---
# <a name="closing-a-file-mapping-object"></a>Закрытие объекта сопоставления файлов

Когда процесс завершается с помощью объекта сопоставления файлов, он должен уничтожить все представления файлов в своем адресном пространстве, используя функцию [**UnmapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile) для каждого представления файлов.

Отмена сопоставления сопоставленного представления файла делает диапазон, занятый представлением в адресном пространстве процесса, недействительным, а диапазон становится доступным для других выделений. Он удаляет запись рабочего набора для каждой несопоставленной виртуальной страницы, которая была частью рабочего набора процесса, и уменьшает размер рабочего набора процесса. Кроме того, уменьшается количество общих папок соответствующей физической страницы.

Измененные страницы в несопоставленном представлении не записываются на диск до тех пор, пока их количество не достигнет нуля или иными словами, пока они не будут сопоставлены или обрезаны из рабочих наборов всех процессов, которые совместно используют эти страницы. Даже после этого измененные страницы записываются "отложенным" на диск; то есть изменения могут быть кэшированы в памяти и записаны на диск позднее. Чтобы снизить риск потери данных в случае сбоя питания или сбоя системы, приложения должны явно очищать измененные страницы с помощью функции [**флушвиевоффиле**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) .

Когда каждый процесс завершает использование объекта сопоставления файлов и отменяет сопоставление всех представлений, он должен закрыть обработчик объекта сопоставления файла и файл на диске, вызвав [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle). Эти вызовы для **CloseHandle** выполняются, даже если существуют представления файлов, которые по-прежнему открыты. Однако отображение сопоставленных представлений файлов вызывает утечку памяти.

 

 
