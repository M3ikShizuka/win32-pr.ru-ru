---
description: Фрагментация кучи — это состояние, в котором доступная память разбивается на небольшие несмежные блоки.
ms.assetid: d10abf82-423c-4942-b05e-55de3a5c4219
title: Куча с низкой фрагментацией
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d4cc6f7f0e2427a20532f5e32cc1460f9b6601d1e6dddf0de603757895005e6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119067744"
---
# <a name="low-fragmentation-heap"></a>Куча с низкой фрагментацией

\[сведения в этом разделе относятся к Windows Server 2003 и Windows XP. начиная с Windows Vista, система использует кучу с низкой фрагментацией (LFH), необходимую для обслуживания запросов на выделение памяти. Приложениям не нужно включать LFH для своих куч.\]

Фрагментация кучи — это состояние, в котором доступная память разбивается на небольшие несмежные блоки. При фрагментации кучи выделение памяти может завершиться ошибкой, даже если общий объем доступной памяти в куче достаточно для удовлетворения запроса, так как ни один блок памяти недостаточно велик. Куча с низкой фрагментацией (LFH) позволяет уменьшить фрагментацию кучи.

LFH не является отдельной кучей. Вместо этого это политика, которую приложения могут включить для своих куч. Если LFH включен, система выделяет память в определенных заранее заданной размерах. Когда приложение запрашивает выделение памяти из кучи с включенным LFH, система выделяет минимальный блок памяти, достаточно большой для того, чтобы вместить запрошенный размер. Система не использует LFH для выделений, превышающих 16 КБ, независимо от того, включена ли LFH.

Приложение должно включать LFH только для кучи по умолчанию вызывающего процесса или для [частных куч](heap-functions.md) , созданных приложением. Чтобы включить LFH для кучи, используйте функцию [**жетпроцесшеап**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) для получения маркера в куче по умолчанию вызывающего процесса или используйте этот маркер для закрытой кучи, созданной функцией [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) . Затем вызовите функцию [**HeapSetInformation**](/windows/desktop/api/HeapApi/nf-heapapi-heapsetinformation) с помощью маркера.

LFH нельзя включить для куч, созданных с кучей, **\_ не выполнять \_ сериализацию** или для куч, созданных с фиксированным размером. LFH также нельзя включить, если вы используете средства отладки кучи в [средствах отладки для Windows](/windows-hardware/drivers/debugger/) или [Microsoft средство проверки приложений](https://www.microsoft.com/downloads/details.aspx?FamilyID=c4a25ab9-649d-4a1b-b4a7-c9d8b095df18&displaylang=en).

После включения LFH для кучи ее нельзя отключить.

Приложения, которые наиболее эффективно используют LFH, являются многопоточными приложениями, которые часто выделяют память и используют различные размеры выделения в 16 КБ. Однако не все приложения имеют преимущество от LFH. Чтобы оценить последствия включения LFH в приложении, используйте данные профилирования производительности.

 

 
