---
description: Предотвращение выполнения данных (DEP) — это функция защиты памяти на уровне системы, встроенная в операционную систему, начиная с Windows XP и Windows Server 2003.
ms.assetid: 75cd83a5-4b77-4ca9-b595-e32d0dd609d0
title: Предотвращение выполнения данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bc53febb383ef2789c2798b091960c2d20856d0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673683"
---
# <a name="data-execution-prevention"></a>Предотвращение выполнения данных

Предотвращение выполнения данных (DEP) — это функция защиты памяти на уровне системы, встроенная в операционную систему, начиная с Windows XP и Windows Server 2003. Функция DEP позволяет системе помечать одну или несколько страниц памяти как не являющиеся исполняемыми. Пометка областей памяти как неисполняемых файлов означает, что код не может быть выполнен из этого региона памяти, что усложняет использование переполнения буфера.

DEP предотвращает запуск кода из страниц данных, таких как куча по умолчанию, стеки и пулы памяти. Если приложение пытается выполнить код из защищенной страницы данных, возникает исключение нарушения прав доступа к памяти, а если исключение не обрабатывается, вызывающий процесс завершается.

DEP не предназначен для обеспечения полной защиты от всех эксплойтов; Он предназначен для использования в качестве другого средства, которое можно использовать для защиты приложения.

## <a name="how-data-execution-prevention-works"></a>Как работает предотвращение выполнения данных

Если приложение пытается выполнить код на защищенной странице, приложение получает исключение с **\_ \_ нарушением прав доступа** для кода состояния. Если приложение должно запускать код со страницы памяти, он должен выделить и установить соответствующие атрибуты [защиты виртуальной памяти](memory-protection.md) . Выделенная память должна быть помечена как **\_ выполнение страницы**, **\_ \_ чтение при выполнении страницы**, **выполнение страницы в \_ \_ ReadWrite** или **Страница \_ Execute \_ вритекопи** при выделении памяти. Выделение кучи, выполняемое вызовом функций **malloc** и [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) , не является исполняемым.

Приложения не могут выполнять код из кучи процесса по умолчанию или стека.

DEP настраивается при загрузке системы в соответствии с параметром политики "без выполнения" в данных конфигурации загрузки. Приложение может получить текущий параметр политики, вызвав функцию [**жетсистемдепполици**](/windows/desktop/api/WinBase/nf-winbase-getsystemdeppolicy) . В зависимости от параметра политики приложение может изменить параметр DEP для текущего процесса, вызвав функцию [**сетпроцессдепполици**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy) .

## <a name="programming-considerations"></a>Замечания по программированию

Приложение может использовать функцию [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) для выделения исполняемой памяти с соответствующими параметрами защиты памяти. Рекомендуется, чтобы приложение было задано как минимум с параметром " **\_ выполнить** защиту памяти" на странице. После создания исполняемого кода рекомендуется настроить для приложения защиту памяти, чтобы запретить доступ на запись к выделенной памяти. Приложения могут запретить доступ на запись к выделенной памяти с помощью функции [**VirtualProtect**](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) . Запрет доступа на запись обеспечивает максимальную защиту для исполняемых регионов адресного пространства процесса. Следует попытаться создать приложения, использующие наименьшее возможное адресное пространство исполняемого файла, что снизит объем памяти, предоставляемой для использования памяти.

Также следует попытаться управлять макетом виртуальной памяти приложения и создавать регионы исполняемых файлов. Эти регионы исполняемых файлов должны находиться в меньшем объеме памяти, чем в неисполняемых регионах. Поиск регионов исполняемых файлов под неисполняемыми областями помогает предотвратить переполнение буфера в исполняемой области памяти.

## <a name="application-compatibility"></a>Совместимость приложений

Некоторые функциональные возможности приложения несовместимы с DEP. Приложения, выполняющие динамическое создание кода (например, JIT-создание кода) и не позволяющие явно отмечать сформированный код с разрешением EXECUTE, могут столкнуться с проблемами совместимости на компьютерах, использующих DEP. Приложения, написанные в библиотеке активных шаблонов (ATL) версии 7,1 и более ранних версий, могут попытаться выполнить код на страницах, помеченных как не являющиеся исполняемыми, что запускает NX-ошибку и завершает работу приложения. Дополнительные сведения см. в разделе [**сетпроцессдепполици**](/windows/desktop/api/WinBase/nf-winbase-setprocessdeppolicy). Большинство приложений, выполняющих действия, несовместимые с DEP, должны быть обновлены для правильной работы.

Небольшое количество исполняемых файлов и библиотек может содержать исполняемый код в разделе данных файла изображения. В некоторых случаях приложения могут размещать небольшие сегменты кода (которые обычно называются преобразователями) в разделах данных. Однако DEP помечает разделы файла изображения, которые загружаются в память как неисполняемые, если в разделе не применен атрибут Executable.

Поэтому исполняемый код в разделах данных должен быть перенесен в раздел кода, или раздел данных, содержащий исполняемый код, должен быть явно помечен как исполняемый. Атрибут Executable, **image \_ SCN \_ mem \_**, должен быть добавлен в поле **характеристики** соответствующего заголовка раздела для разделов, содержащих исполняемый код. Дополнительные сведения о добавлении атрибутов в раздел см. в документации, входящей в состав вашего компоновщика.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Предотвращение выполнения данных (TechNet)](/previous-versions/windows/it-pro/windows-xp/bb457155(v=technet.10))
</dt> <dt>

[Настройка защиты памяти](https://www.microsoft.com/technet/security/prodtech/windowsxp/depcnfxp.mspx)
</dt> <dt>

[Статья базы знаний 875352](https://support.microsoft.com/kb/875352)
</dt> </dl>

 

 
