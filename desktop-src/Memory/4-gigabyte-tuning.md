---
description: '4-Гигабайтная настройка: BCDEdit и Boot.ini'
ms.assetid: 991eb86f-9e6f-4084-8b6f-f979e42104b5
title: '4-Гигабайтная настройка: BCDEdit и Boot.ini'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f997ae09748370d5ec8ec246da80b6440d7aaf45
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104264393"
---
# <a name="4-gigabyte-tuning-bcdedit-and-bootini"></a>4-Гигабайтная настройка: BCDEdit и Boot.ini

В 32-разрядных выпусках Windows приложение имеет 4 гигабайта (ГБ) доступного виртуального адресного пространства. Виртуальное адресное пространство делится так, что доступно 2 ГБ для приложения, а остальные 2 ГБ доступны только системе. Функция настройки 4 гигабайта (Настройка 4GT или 4GT RAM), включенная командой *BCDEdit/Set инкреасеусерва* , увеличивает объем виртуального адресного пространства, доступного приложению до 3 ГБ, и сокращает объем, доступный системе, от 1 до 2 ГБ.

Для приложений, интенсивно использующих память, таких как системы управления базами данных (СУБД), использование большего виртуального адресного пространства может обеспечить значительные преимущества производительности и масштабируемости. Однако размер кэша файлов, выгружаемого пула и невыгружаемого пула меньше, что может негативно сказаться на работе приложений с большими сетевыми ресурсами или операциями ввода-вывода. Поэтому может потребоваться протестировать приложение под нагрузкой и проверить счетчики производительности, чтобы определить, имеют ли ваши приложения преимущества из большего адресного пространства.

Чтобы включить 4GT, используйте команду [BCDEdit/Set](/windows-hardware/drivers/devtest/bcdedit--set) , чтобы установить параметр записи **инкреасеусерва** boot в значение от 2048 (2 ГБ) до 3072 (3 ГБ).

**Windows Server 2003 и более ранние версии:** Чтобы включить 4GT, добавьте параметр **/3gb** в файл Boot.ini. Параметр **/3gb** поддерживается в следующих системах:

-   Windows Server 2003
-   Windows XP Professional

Параметр **/3gb** позволяет приложениям полностью 3 ГБ виртуального адресного пространства, а также уменьшает объем, доступный системе, до 1 ГБ. В Windows Server 2003 объем адресного пространства, доступный для приложений, можно изменить, задав параметру **/USERVA** в Boot.ini значение от 2048 до 3072, что увеличит объем адресного пространства, доступного системе. Это помогает поддерживать общую производительность системы, когда приложению требуется более 2 ГБ, но менее 3 ГБ адресного пространства.

Чтобы приложение использовало больше места в адресном пространстве, в заголовке образа установите флаг с [**\_ \_ \_ \_ поддержкой большого адреса для файла изображения**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) . Компоновщик, входящий в состав Microsoft Visual C++, поддерживает параметр **/LARGEADDRESSAWARE** для установки этого флага. Установка этого флага и запуск приложения в системе без поддержки 4GT не должны повлиять на работу приложения.

В 64-разрядных выпусках Windows, 32-разрядных приложений, помеченных флагом "с [**\_ \_ \_ \_ учетом размера файла образа**](/windows/desktop/api/dbghelp/ns-dbghelp-loaded_image) ", доступно 4 ГБ адресного пространства.

**Выпуски Windows Server 2003 для Itanium:** До с пакетом обновления 1 (SP1) в 32-разрядных процессах доступно только 2 ГБ адресного пространства.

Используйте следующие рекомендации для поддержки 4GT в приложениях:

-   Адреса рядом с границей 2 ГБ обычно используются различными системными библиотеками DLL. Поэтому 32-разрядный процесс не может выделить более 2 ГБ непрерывной памяти, даже если доступно всего 4 ГБ адресного пространства.
-   Чтобы получить общий объем виртуального пространства пользователя, используйте функцию [**глобалмемористатусекс**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex) . Чтобы получить наибольший возможный адрес пользователя, используйте функцию [**жетсистеминфо**](/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) . Всегда выявлять реальное значение во время выполнения и не использовать определения жестко проводных констант, такие как: `#define HIGHEST_USER_ADDRESS 0xC0000000` .
-   Не используйте сравнения со знаком, так как они могут привести к сбою приложений в системе с поддержкой 4GT. Следующее условие имеет значение false для указателя, превышающего 2 ГБ: `if (pointer > 40000000)` .
-   Код, использующий максимальный бит указателя для определяемой приложением цели, завершится ошибкой, если 4GT включен. Например, 32-разрядное слово может рассматриваться как адрес пользовательского режима, если он ниже 0x80000000, и код ошибки, если он указан выше. Это не относится к 4GT.

[**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc) обычно возвращает младшие адреса до высоких адресов. Поэтому процесс может не использовать очень высокие адреса, если он не выделяет большой объем памяти или фрагментированное виртуальное адресное пространство. Чтобы принудительно распределять выделения с более высоких адресов перед более низкими адресами для целей тестирования, при вызове **VirtualAlloc** следует указать параметр **mem \_ сверху \_ вниз** или задать для следующего параметра реестра значение 0x100000:

**HKey \_ Локальный \_ компьютер** \\ **система** \\ **CurrentControlSet** \\ **Управление** \\  \\ **памятью** диспетчера сеансов \\ **аллокатионпреференце**

## <a name="related-topics"></a>См. также

<dl> <dt>

[Ограничения памяти для выпусков Windows](memory-limits-for-windows-releases.md)
</dt> <dt>

[Расширение физических адресов](physical-address-extension.md)
</dt> <dt>

[Технический справочник по 4GT](/previous-versions/windows/it-pro/windows-server-2003/cc778496(v=ws.10))
</dt> </dl>

 

 
