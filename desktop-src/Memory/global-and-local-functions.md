---
description: Глобальные и локальные функции поддерживают перенос из 16-разрядного кода или для обеспечения совместимости исходного кода с 16-разрядной системой Windows.
ms.assetid: 97707ce7-4c65-4d0e-ba69-47fdaee73a9b
title: Глобальные и локальные функции
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf356647f92f0e7d82e914a91020c438363ff082
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897193"
---
# <a name="global-and-local-functions"></a>Глобальные и локальные функции

Глобальные и локальные функции поддерживают перенос из 16-разрядного кода или для обеспечения совместимости исходного кода с 16-разрядной системой Windows. Начиная с 32-разрядных Windows, глобальные и локальные функции реализуются как функции-оболочки, вызывающие соответствующие [функции кучи](heap-functions.md) с помощью обработчика для кучи процесса по умолчанию. Таким образом, глобальные и локальные функции имеют больше ресурсов, чем другие функции управления памятью.

[Функции кучи](heap-functions.md) предоставляют больше функций и управляются, чем глобальные и локальные функции. Новые приложения должны использовать функции кучи, кроме случаев, когда документация специально указывает, что следует использовать глобальную или локальную функцию. Например, некоторые функции Windows выделяют память, которую необходимо освободить с помощью [**функции LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree), а глобальные функции по-прежнему используются с платформа динамических данных Exchange (DDE), функциями буфера обмена и объектами данных OLE. Полный список глобальных и локальных функций см. в таблице [функции управления памятью](memory-management-functions.md).

Управление памятью Windows не предоставляет отдельную локальную кучу и глобальную кучу, как и в случае 16-разрядной версии Windows. В результате глобальные и локальные семейства функций эквивалентны, и выбор между ними зависит от персональных предпочтений. Обратите внимание, что изменение из 16-битной модели сегментированной памяти на модель виртуальной памяти с 32 бит сделало некоторые связанные глобальные и локальные функции и их параметры ненужными или бессмысленными. Например, больше нет указателей NEAR и Far, так как локальные и глобальные выделения памяти возвращают 32-битные виртуальные адреса.

Объекты памяти, выделенные [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc) , находятся в закрытых, зафиксированных страницах с доступом для чтения и записи, которые недоступны для других процессов. Память, выделенная с помощью **GlobalAlloc** с **ГМЕМ \_ ддешаре** , на самом деле не предоставляется глобально, так как она находится в 16-разрядной версии Windows. Это значение не действует и доступно только для обеспечения совместимости. Приложения, которым требуется общая память для других целей, должны использовать объекты сопоставления файлов. Несколько процессов могут сопоставлять представление одного и того же объекта сопоставления файлов для предоставления именованной общей памяти. Дополнительные сведения см. в разделе [Сопоставление файлов](file-mapping.md).

Выделение памяти ограничено только доступной физической памятью, включая хранилище в файле подкачки на диске. При выделении фиксированной памяти [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc) возвращают указатель, который вызывающий процесс может немедленно использовать для доступа к памяти. При выделении памяти для перемещаемого объема возвращаемое значение является маркером. Чтобы получить указатель на перемещаемый объект памяти, используйте функции [**глобаллокк**](/windows/desktop/api/WinBase/nf-winbase-globallock) и [**локаллокк**](/windows/desktop/api/WinBase/nf-winbase-locallock) .

Фактический размер выделенной памяти может быть больше запрошенного размера. Чтобы определить фактическое число выделенных байтов, используйте функцию [**глобалсизе**](/windows/desktop/api/WinBase/nf-winbase-globalsize) или [**локалсизе**](/windows/desktop/api/WinBase/nf-winbase-localsize) . Если объем выделенной суммы превышает запрошенную сумму, процесс может использовать весь объем.

Функции [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc) и [**локалреаллок**](/windows/desktop/api/WinBase/nf-winbase-localrealloc) изменяют размер или атрибуты объекта памяти, выделенного [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc) и [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc). Размер может увеличиваться или уменьшаться.

Функции [**GlobalFree**](/windows/desktop/api/WinBase/nf-winbase-globalfree) и [**функции LocalFree**](/windows/desktop/api/WinBase/nf-winbase-localfree) выпускают память, выделенную [**GlobalAlloc**](/windows/desktop/api/WinBase/nf-winbase-globalalloc), [**локалаллок**](/windows/desktop/api/WinBase/nf-winbase-localalloc), [**LocalLock**](/windows/desktop/api/WinBase/nf-winbase-globalrealloc)или [**локалреаллок**](/windows/desktop/api/WinBase/nf-winbase-localrealloc). Чтобы удалить указанный объект памяти без проверки маркера, используйте функцию [**глобалдискард**](/windows/desktop/api/WinBase/nf-winbase-globaldiscard) или [**локалдискард**](/windows/win32/api/minwinbase/nf-minwinbase-localdiscard) . Этот маркер может быть использован позже **LocalLock** или **локалреаллок** для выделения нового блока памяти, связанного с тем же маркером.

Чтобы получить сведения об указанном объекте памяти, используйте функцию [**глобалфлагс**](/windows/desktop/api/WinBase/nf-winbase-globalflags) или [**локалфлагс**](/windows/desktop/api/WinBase/nf-winbase-localflags) . Эти сведения включают в себя счетчик блокировок объекта и указывает, будет ли объект удален или уже удален. Чтобы получить маркер объекта памяти, связанного с указанным указателем, используйте функцию [**глобалхандле**](/windows/desktop/api/WinBase/nf-winbase-globalhandle) или [**локалхандле**](/windows/desktop/api/WinBase/nf-winbase-localhandle) .

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сравнение методов выделения памяти](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 
