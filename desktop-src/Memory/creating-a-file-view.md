---
description: Чтобы связать данные из файла с виртуальной памятью процесса, необходимо создать представление файла.
ms.assetid: b1ebd9a4-cde4-4c0c-80d2-5ccb655cd3a4
title: Создание представления файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 498f7ba132efd9ecf82f9ec087492c9622824b51
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103998429"
---
# <a name="creating-a-file-view"></a>Создание представления файлов

Чтобы связать данные из файла с виртуальной памятью процесса, необходимо создать представление файла. Функции [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) и [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) используют объект сопоставления файлов, возвращенный [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) для создания представления файла или части файла в виртуальном адресном пространстве процесса. Эти функции завершаются ошибкой, если флаги доступа конфликтуют с указанными при создании объекта сопоставления файлов **CreateFileMapping** .

Функция [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) возвращает указатель на представление файла. При разыменовании указателя в диапазоне адресов, указанных в **MapViewOfFile**, приложение может считывать данные из файла и записывать данные в файл. Запись в представление файла приводит к внесению изменений в объект сопоставления файлов. Фактическая запись в файл на диске обрабатывается системой. Данные на самом деле не передаются на момент, в который записывается объект сопоставления файлов. Вместо этого большая часть входных и выходных файлов (I/O) кэшируется для повышения общей производительности системы. Приложения могут переопределить это поведение, вызвав функцию [**флушвиевоффиле**](/windows/win32/api/memoryapi/nf-memoryapi-flushviewoffile) , чтобы заставить систему немедленно выполнять транзакции диска.

Функция [**MapViewOfFileEx**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffileex) работает точно так же, как функция [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , за исключением того, что она позволяет процессу указать базовый адрес представления файла в виртуальном адресном пространстве процесса в параметре *лпвбасе* . Если на указанном адресе недостаточно места, вызов завершается с ошибкой. Таким образом, если необходимо сопоставлять файл с одним и тем же адресом в нескольких процессах, то процессы должны согласовать соответствующий адрес: параметр *лпвбасе* должен быть целым числом, кратным степени гранулярности выделения системной памяти, иначе вызов завершается ошибкой. Чтобы получить гранулярность выделения памяти системы, используйте функцию [**жетсистеминфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) , которая заполняет элементы структуры [**системных \_ сведений**](/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info) .

Приложение может создавать несколько представлений файлов из одного объекта сопоставления файлов. Представление файла может отличаться от размера объекта сопоставления файлов, из которого он является производным, но он должен быть меньше, чем объект сопоставления файлов. Смещение, заданное параметрами *двоффсесигх* и *двоффсетлов* [**MapViewOfFile**](/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile) , должно быть кратным степени гранулярности выделения системы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание представления в файле](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
