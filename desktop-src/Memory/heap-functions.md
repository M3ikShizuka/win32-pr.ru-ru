---
description: Каждый процесс имеет кучу по умолчанию, предоставляемую системой. Приложения, которые часто выделяют из кучи, могут повысить производительность с помощью частных куч.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Функции кучи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127144385"
---
# <a name="heap-functions"></a>Функции кучи

Каждый процесс имеет кучу по умолчанию, предоставляемую системой. Приложения, которые часто выделяют из кучи, могут повысить производительность с помощью частных куч.

Частная куча — это блок из одной или нескольких страниц в адресном пространстве вызывающего процесса. После создания закрытой кучи процесс использует такие функции, как [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) и [**хеапфри**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) , для управления памятью в этой куче.

Функции кучи также можно использовать для управления памятью в куче процесса по умолчанию с помощью маркера, возвращаемого функцией [**жетпроцесшеап**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) . Для этой цели новые приложения должны использовать функции кучи вместо [глобальных и локальных функций](global-and-local-functions.md) .

Между памятью, выделенной из закрытой кучи и выделенной с помощью других функций выделения памяти, нет различий. Полный список функций см. в таблице [функции управления памятью](memory-management-functions.md).

> [!Note]  
> Поток должен вызывать функции кучи только для кучи процесса по умолчанию и закрытых куч, которые создает и управляет потоком, используя дескрипторы, возвращаемые функцией [**жетпроцесшеап**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) или [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .

 

Функция [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) создает объект закрытой кучи, из которого вызывающий процесс может выделить блоки памяти с помощью функции [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) . **Хеапкреате** задает исходный и максимальный размеры кучи. Начальный размер определяет количество зафиксированных, прочитанных и записываемых страниц, изначально выделенных для кучи. Максимальный размер определяет общее число зарезервированных страниц. Эти страницы создают непрерывный блок в виртуальном адресном пространстве процесса, в котором может расти куча. Дополнительные страницы автоматически фиксируются из этого зарезервированного пространства, если запросы по **хеапаллок** превышают текущий размер зафиксированных страниц, предполагая, что физическое хранилище для него доступно. После фиксации страницы не будут выделены до завершения процесса или до уничтожения кучи путем вызова функции [**хеапдестрой**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) .

Память объекта закрытой кучи доступна только создавшему его процессу. Если библиотека динамической компоновки (DLL) создает частную кучу, она делает это в адресном пространстве процесса, вызвавшего библиотеку DLL. Он доступен только для этого процесса.

Функция [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) выделяет указанное число байтов из закрытой кучи и возвращает указатель на выделенный блок. Этот указатель можно использовать в функциях [**хеапфри**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**хеапреаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**хеапсизе**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)и [**хеапвалидате**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) .

Память, выделенная [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) , не может быть перемещена. Адрес, возвращаемый функцией **хеапаллок** , действителен до освобождения или повторного выделения блока памяти; блок памяти не обязательно должен быть заблокирован.

Поскольку система не может сжать частную кучу, она может стать фрагментированной. Приложения, которые выделяют большие объемы памяти в различных размерах выделения, могут использовать [кучу с низкой фрагментацией](low-fragmentation-heap.md) для уменьшения фрагментации кучи.

Можно использовать функции кучи, чтобы создать частную кучу при запуске процесса, указав начальный размер, достаточный для удовлетворения требований к памяти процесса. Если вызов функции [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) завершается с ошибкой, процесс может прервать или уведомить пользователя о нехватке памяти; Тем не менее, если она выполняется, процесс может быть уверен в наличии памяти.

Память, запрошенная [**хеапкреате**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) , может быть или не быть непрерывной. Память, выделенная в куче [**хеапаллок**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) , является непрерывной. Не следует выполнять запись или чтение из памяти в куче, за исключением того, что выделяется **хеапаллок**, а также не следует рассчитывать отношения между двумя областями памяти, выделенными **хеапаллок**.

Не следует ссылаться ни на один из способов памяти, освобожденных [**хеапфри**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree). После высвобождения памяти все данные, которые могли быть в ней, исчезнут. Если требуются сведения, не освобождайте память, содержащую сведения. Вызовы функций, возвращающие сведения о памяти (например, [**хеапсизе**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)), могут не использоваться с освобожденной памятью, так как они могут возвращать фиктивные данные.

Функция [**хеапдестрой**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) уничтожает объект закрытой кучи. Он отменяет фиксацию и освобождает все страницы объекта heap и делает дескриптор кучи недействительным.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Сравнение методов выделения памяти](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



