---
title: Устранение ошибок подписи пакета приложения
description: Сбой развертывания приложения может быть вызван сбоем при проверке цифровой подписи пакета приложения. Узнайте, как распознать эти сбои и что делать с ними.
ms.assetid: CE868296-87F6-4BD5-8AC5-914E429EDEBC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bdec41d2d058a48153d6126fea534c1efaf16e16ccabef5d5e940daa73e839a1
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119048952"
---
# <a name="how-to-troubleshoot-app-package-signature-errors"></a>Устранение ошибок подписи пакета приложения

Сбой развертывания приложения может быть вызван сбоем при проверке цифровой подписи пакета приложения. Узнайте, как распознать эти сбои и что делать с ними.

при развертывании упакованного Windows приложения Windows всегда пытается проверить цифровую подпись в пакете приложения. Сбои во время развертывания блока проверки подписи пакета. Но почему пакет не был проверен, может быть не очевидным. В частности, если вы подписываете пакеты с частными сертификатами для локального тестирования, вам часто требуется управлять доверием для этих сертификатов. Неправильная конфигурация доверия сертификатов может привести к сбоям проверки подписи.

## <a name="what-you-need-to-know"></a>Это важно знать

### <a name="technologies"></a>Технологии

-   [упаковка, развертывание и запрос приложений Windows](appx-portal.md)
-   [Проверка доверия сертификата](/windows/desktop/SecCrypto/certificate-trust-verification)

### <a name="prerequisites"></a>Предварительные требования

-   [Windows журнал событий](/windows/desktop/WES/windows-event-log) для диагностики сбоев установки.
-   [Задачи Certutil для управления сертификатами](/previous-versions/orphan-topics/ws.10/cc772898(v=ws.10)) для обработки хранилища сертификатов во время устранения неполадок

## <a name="instructions"></a>Инструкции

### <a name="step-1-examine-event-logs-for-diagnostic-information"></a>Шаг 1. Изучение журналов событий для получения диагностических сведений

В зависимости от того, как вы предпринимали попытку развертывания приложения, возможно, вы не получили осмысленный код ошибки для сбоя развертывания. В этом случае код ошибки обычно можно получить непосредственно из журналов событий.

**Получение кода ошибки из журналов событий**

1.  Запустите **eventvwr. msc**.
2.  перейдите в раздел **Просмотр событий (локальные)**  >  **журналы приложений и служб**  >  **Microsoft**  >  **Windows**.
3.  первый проверяемый журнал — **AppxPackagingOM**  >  **Microsoft-Windows-аппкспаккагинг/эксплуатация**.
4.  ошибки, связанные с развертыванием, записываются в **AppXDeployment-Server**  >  **Microsoft-Windows-AppXDeploymentServer/эксплуатация**.

    Для ошибок развертывания найдите Последнее событие ошибки 404. Это событие ошибки содержит код ошибки и описание причины сбоя развертывания. Если ошибка 465 предшествует событию 404, то возникла проблема при открытии пакета.

если ошибка 465 не возникла, см. раздел общие [сведения об устранении неполадок, а также о развертывании и запросе приложений Windows](troubleshooting.md). В противном случае обратитесь к этой таблице с общими кодами ошибок, которые могут отображаться в строке ошибки для события ошибки 465:

| Код ошибки | Error                                 | Описание                                                                                                          | Предложение                                                                                                                                                                                                 |
|------------|---------------------------------------|----------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x80073CF0 | Ошибка \_ \_ при установке открытого \_ пакета \_ | Не удалось открыть пакет приложения.                                                                                 | Эта ошибка обычно указывает на проблему с пакетом. Необходимо создать и подписать пакет еще раз. Дополнительные сведения см. [в разделе Использование упаковщика приложений](make-appx-package--makeappx-exe-.md). |
| 0x80080205 | APPX \_ E \_ Недопустимый \_ блоккмап            | Пакет приложения был изменен или имеет недопустимую карту блоков.                                                  | Пакет поврежден. Необходимо создать и подписать пакет еще раз. Дополнительные сведения см. [в разделе Использование упаковщика приложений](make-appx-package--makeappx-exe-.md).                                  |
| 0x800B0004 | ДОВЕРЯТЬ \_ \_ \_ \_ недоверенному субъекту E       | Пакет приложения был изменен.                                                                              | Содержимое пакета больше не соответствует цифровой подписи. Необходимо подписать пакет еще раз. Дополнительные сведения см. [в разделе как подписать пакет приложения с помощью средства SignTool](how-to-sign-a-package-using-signtool.md).  |
| 0x800B0100 | ДОВЕРЯТЬ \_ электронной \_ подписи                 | Пакет приложения не подписан.                                                                                         | развертывать можно только подписанные Windows пакеты приложений. Сведения о подписывании пакета приложения см. в разделе [как подписать пакет приложения с помощью средства SignTool](how-to-sign-a-package-using-signtool.md).                  |
| 0x800B0109 | \_ \_ недоверенный корень сертификата \_ E              | Цепочка сертификатов, использованная для подписания пакета приложения, заканчивается на корневом сертификате, который не является доверенным.           | Перейдите к шагу 2, чтобы устранить неполадки доверия сертификатов.                                                                                                                                                  |
| 0x800B010A | \_ \_ цепочка сертификатов E                     | Не удалось создать цепочку сертификатов для доверенного корневого центра сертификации от сертификата, который использовался для подписания пакета приложения. | Перейдите к шагу 2, чтобы устранить неполадки доверия сертификатов.                                                                                                                                                  |



 

### <a name="step-2-determine-the-certificate-chain-used-to-sign-the-app-package"></a>Шаг 2. Определение цепочки сертификатов, используемой для подписания пакета приложения

Чтобы определить сертификаты, которым должен доверять локальный компьютер, можно проверить цепочку сертификатов для цифровой подписи в пакете приложения.

**Определение цепочки сертификатов**

1.  В проводнике щелкните правой кнопкой мыши пакет приложения и выберите пункт **Свойства**.
2.  В диалоговом окне **Свойства** перейдите на вкладку **цифровые подписи** , где также будет указано, можно ли проверить подпись.
3.  В списке сигнатур выберите подпись и нажмите кнопку **сведения** .
4.  В диалоговом окне **сведения о цифровой подписи** нажмите кнопку **Просмотр сертификата** .
5.  В диалоговом окне **сертификат** перейдите на вкладку **путь сертификации** .

Лучшим сертификатом в цепочке является корневой сертификат, а нижний сертификат — сертификат подписи. Если в цепочке находится только один сертификат, сертификат подписи также является его собственным корневым сертификатом. Вы можете определить серийный номер для каждого сертификата, который затем используется с [certutil](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732443(v=ws.10)):

**Определение серийного номера для каждого сертификата**

1.  В области путь сертификации выберите сертификат и нажмите кнопку **Просмотр сертификата**.
2.  В диалоговом окне Сертификат перейдите на вкладку **сведения** , в которой отображается серийный номер и другие полезные свойства сертификата.

### <a name="step-3-determine-the-certificates-trusted-by-the-local-machine"></a>Шаг 3. Определение сертификатов, которые являются доверенными для локального компьютера

Чтобы иметь возможность развернуть пакет приложения, он должен быть не только доверенным в контексте пользователя, но и контекстом локального компьютера. В результате цифровая подпись может быть действительна при просмотре на вкладке цифровые подписи на предыдущем шаге, но по-прежнему не проходит проверку во время развертывания пакета приложения.

**Чтобы определить, является ли цепочка сертификатов, используемая для подписи пакета приложения, явно доверенной для локального компьютера**

1.  Выполните следующую команду:

    ``` syntax
    CertUtil.exe -store Root rootCertSerialNumber
    ```

2.  Выполните следующую команду:

    ``` syntax
    CertUtil.exe -store TrustedPeople signingCertSerialNumber
    ```

Если серийный номер сертификата не указан, [certutil](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732443(v=ws.10)) перечисляет все сертификаты, которые являются доверенными для локального компьютера для этого хранилища.

Пакет может не установиться из-за ошибок цепочки сертификатов, даже если сертификат для подписи не является самозаверяющим и корневой сертификат находится в корневом хранилище локального компьютера. В этом случае может возникнуть проблема с доверием для промежуточных центров сертификации. Дополнительные сведения об этой ошибке см. [в разделе Работа с сертификатами](/previous-versions/dotnet/netframework-3.0/ms731899(v=vs.85)).

## <a name="remarks"></a>Remarks

Если вы определили, что пакет не может быть развернут, так как сертификат для подписи не является доверенным, не устанавливайте пакет, если вы не уверены в его происхождении и доверяете ему.

Если вы хотите вручную доверять приложению для установки (например, для установки собственного пакета приложения, подписанного тестом), можно вручную добавить сертификат в отношение доверия сертификатов локального компьютера из пакета приложения.

**Чтобы вручную добавить сертификат к доверию сертификатов на локальном компьютере**

1.  В проводнике щелкните правой кнопкой мыши пакет приложения и во всплывающем контекстном меню выберите **Свойства**.
2.  В диалоговом окне **Свойства** выберите вкладку **цифровые подписи** .
3.  В списке сигнатур выберите подпись и нажмите кнопку **сведения** .
4.  В диалоговом окне **сведения о цифровой подписи** нажмите кнопку **Просмотр сертификата** .
5.  В диалоговом окне **сертификат** щелкните **установить сертификат...** .
6.  В мастере импорта сертификатов выберите **локальный компьютер** , а затем нажмите кнопку **Далее**. Чтобы продолжить, необходимо предоставить права администратора.
7.  Выберите **поместить все сертификаты в следующее хранилище** и перейдите к хранилищу **доверенных лиц** .
8.  Нажмите кнопку **Далее**, а затем кнопку **Готово** , чтобы завершить работу мастера.

После добавления этого вручную можно увидеть, что сертификат теперь является доверенным в диалоговом окне **сертификата** .

Сертификат можно удалить после того, как он больше не нужен.

**Удаление сертификата**

1.  Запустите **Cmd.exe** от имени администратора.
2.  В командной строке администратора выполните следующую команду:

    ``` syntax
    Certutil -store TrustedPeople
    ```

3.  Найдите серийный номер установленного сертификата. Это число является *certID*.
4.  Выполните следующую команду:

    ``` syntax
    Certutil -delStore TrustedPeople certID
    ```

Не рекомендуется вручную добавлять корневые сертификаты в [хранилище сертификатов доверенных корневых центров сертификации](/windows-hardware/drivers/install/trusted-root-certification-authorities-certificate-store)локального компьютера. Наличие нескольких приложений, подписанных сертификатами, которые связаны с одним и тем же корневым сертификатом, например бизнес-приложениями, может быть более эффективным, чем установка отдельных сертификатов в хранилище доверенных лиц. Хранилище доверенных лиц содержит сертификаты, которые считаются доверенными по умолчанию и поэтому не проверяются в списках или цепочках доверия сертификатов более высокого уровня. Рекомендации по добавлению сертификатов в хранилище сертификатов доверенных корневых центров сертификации см. в статье рекомендации по [подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85)).

## <a name="security-considerations"></a>Соображения безопасности

Добавив сертификат в [хранилища сертификатов локальной машины](/windows-hardware/drivers/install/local-machine-and-current-user-certificate-stores), вы меняете доверие сертификатов всех пользователей на компьютере. Рекомендуется установить все сертификаты подписи кода, необходимые для тестирования пакетов приложений в хранилище сертификатов "Доверенные лица". Немедленно удалите эти сертификаты, когда они больше не нужны, чтобы предотвратить их использование для компрометации доверия системы. Если вы создаете собственные тестовые сертификаты для подписания пакетов приложений, мы также рекомендуем ограничить привилегии, связанные с тестовым сертификатом. Сведения о создании тестовых сертификатов для подписи пакетов приложений см. [в разделе Создание сертификата для подписи пакета приложения](how-to-create-a-package-signing-certificate.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Примеры**
</dt> <dt>

[Пример создания пакета приложения](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/AppxPackingCreateAppx)
</dt> <dt>

**Основные понятия**
</dt> <dt>

[Устранение проблем с упаковкой и развертыванием приложений для Windows, а также с обращением к ним](troubleshooting.md)
</dt> <dt>

[Задачи Certutil для управления сертификатами](/previous-versions/orphan-topics/ws.10/cc772898(v=ws.10))
</dt> </dl>

 

 
