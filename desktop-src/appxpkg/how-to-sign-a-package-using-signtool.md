---
title: Подписание пакета приложения с помощью SignTool
description: узнайте, как использовать средство SignTool для подписывания пакетов приложений Windows, чтобы их можно было развернуть.
ms.assetid: 93541EB4-3419-45D1-AA63-563E6C6D3055
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2b4e4c0941cbcced30053b8fd31e44100adc9aa7
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122474890"
---
# <a name="how-to-sign-an-app-package-using-signtool"></a>Подписание пакета приложения с помощью SignTool

> [!Note]  
> сведения о подписывании пакета приложения Windows см. в статье подписывание [пакета приложения с помощью средства SignTool](/windows/msix/package/sign-app-package-using-signtool).

 

узнайте, как использовать средство [**SignTool**](/windows-hardware/drivers/devtest/signtool) для подписывания пакетов приложений Windows, чтобы их можно было развернуть. средство [**SignTool**](/windows-hardware/drivers/devtest/signtool) входит в состав пакета sdk (Windows Software Development Kit).

все пакеты приложений Windows должны иметь цифровую подпись, прежде чем их можно будет развернуть. хотя Microsoft Visual Studio 2012 и более поздних версий могут подписывать пакет приложения во время его создания, пакеты, созданные с помощью средства [упаковщика приложений (MakeAppx.exe)](make-appx-package--makeappx-exe-.md) из Windows SDK, не подписываются.

> [!Note]  
> средство [**SignTool**](/windows-hardware/drivers/devtest/signtool) можно использовать только для подписания пакетов приложений Windows на Windows 8 и более поздних версиях или в Windows Server 2012 и более поздних версиях. средство **SignTool** нельзя использовать для подписывания пакетов приложений в операционных системах нижнего уровня, таких как Windows 7 или Windows Server 2008 R2.

 

## <a name="what-you-need-to-know"></a>Это важно знать

### <a name="technologies"></a>Технологии

-   [Знакомство с подписыванием кода](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85))
-   [Пакеты и развертывание приложений](/previous-versions/windows/apps/hh464929(v=win.10))
-   [Средства для подписывания файлов и проверки подписей](/windows/desktop/SecCrypto/tools-to-sign-files-and-check-signatures)

### <a name="prerequisites"></a>Предварительные требования

-   средство [**SignTool**](/windows-hardware/drivers/devtest/signtool), являющееся частью Windows SDK
-   допустимый сертификат подписи кода, например файл личных данных Exchange (pfx), созданный с помощью средств [**MakeCert.exe**](/windows-hardware/drivers/devtest/makecert) и [**Pvk2Pfx.exe**](/windows-hardware/drivers/devtest/pvk2pfx)

    Сведения о создании допустимого сертификата подписи кода см. [в разделе Создание сертификата для подписи пакета приложения](how-to-create-a-package-signing-certificate.md).

-   упакованное Windows приложение, например appx-файл, созданный с помощью средства " [упаковщик приложений" (MakeAppx.exe)](make-appx-package--makeappx-exe-.md) .

**Дополнительные сведения**

Сертификат, используемый для подписи пакета приложения, должен соответствовать следующим критериям:

-   имя субъекта сертификата должно соответствовать атрибуту **Publisher** , содержащемуся в элементе [**Identity**](/uwp/schemas/appxpackage/appxmanifestschema/element-identity) файла AppxManifest.xml, который хранится в пакете. имя издателя является частью удостоверения упакованного Windows приложения, поэтому необходимо сделать имя субъекта сертификата соответствующим имени издателя приложения. Это позволяет проверять подлинность подписанных пакетов по цифровой подписи. Сведения об ошибках подписывания, которые могут возникнуть при подписывании пакета приложения с помощью средства [**SignTool**](/windows-hardware/drivers/devtest/signtool), см. в разделе "Примечания" статьи [Создание сертификата для подписи пакета приложения](how-to-create-a-package-signing-certificate.md).
-   Сертификат должен быть допустимым для подписывания кода. Это означает, что оба этих элемента должны быть истинными:

    -   Поле расширенного использования ключа (EKU) сертификата должно быть либо не установлено, либо содержать значение EKU для подписывания кода (1.3.6.1.5.5.7.3.3).
    -   Поле "использование ключа" (EKU) сертификата должно быть либо неопределенным, либо содержать бит использования для цифровой подписи (0x80).

-   Сертификат содержит закрытый ключ.
-   Сертификат действителен. Он активен, не просрочен и не был отозван.

## <a name="instructions"></a>Инструкции

### <a name="step-1-determine-the-hash-algorithm-to-use"></a>Шаг 1. Определение хэш-алгоритма для использования

При подписывании пакета приложения необходимо использовать тот же хэш-алгоритм, который использовался при создании пакета приложения. Если для создания пакета приложения использовались параметры по умолчанию, то используется алгоритм хэширования SHA256.

Если для создания пакета приложения использовался упаковщик приложений с конкретным алгоритмом хэширования, то для подписывания пакета используйте тот же алгоритм. Чтобы определить хэш-алгоритм, используемый для подписывания пакета, можно извлечь содержимое пакета и проверить файл AppxBlockMap.xml. Атрибут **хашмесод** элемента [**блоккмап**](/uwp/schemas/blockmapschema/element-blockmap) Указывает хэш-алгоритм, который использовался при создании пакета приложения. Пример:

``` syntax
<BlockMap xmlns="http://schemas.microsoft.com/appx/2010/blockmap" 
HashMethod="https://www.w3.org/2001/04/xmlenc#sha256">
```

Предыдущий элемент [**блоккмап**](/uwp/schemas/blockmapschema/element-blockmap) указывает, что использовался алгоритм SHA256. В следующей таблице приведено сопоставление доступных в настоящее время алгоритмов:

| Значение **хашмесод**                            | *hashAlgorithm* для использования |
|-------------------------------------------------|------------------------|
| <https://www.w3.org/2001/04/xmlenc#sha256>       | SHA256 (по умолчанию. appx) |
| <https://www.w3.org/2001/04/xmldsig-more#sha384> | SHA384                 |
| <https://www.w3.org/2001/04/xmlenc#sha512>       | SHA512                 |



 

### <a name="step-2-run-signtoolexe-to-sign-the-package"></a>Шаг 2. Запуск SignTool.exe для подписания пакета

**Подписание пакета сертификатом подписи из PFX-файла**

-   ``` syntax
    SignTool sign /fd hashAlgorithm /a /f signingCert.pfx /p password filepath.appx
    ```

Средство [**SignTool**](/windows-hardware/drivers/devtest/signtool) по умолчанию принимает параметр/FD *HASHALGORITHM* в значение SHA1, если он не указан, а SHA1 не подходит для подписывания пакетов приложений. Поэтому этот параметр необходимо указать при подписании пакета приложения. Чтобы подписать пакет приложения, созданный с помощью хэша SHA256 по умолчанию, укажите параметр/FD *hashAlgorithm* в качестве значения SHA256:

``` syntax
SignTool sign /fd SHA256 /a /f signingCert.pfx /p password filepath.appx
```

Параметр/p *Password* можно опустить, если используется PFX-файл, который не защищен паролем. Можно также использовать другие параметры выбора сертификатов, которые поддерживаются средством [**SignTool**](/windows-hardware/drivers/devtest/signtool) для подписывания пакетов приложений. Дополнительные сведения об этих параметрах см. в разделе [SignTool](/windows/desktop/SecCrypto/signtool).

> [!Note]  
> В подписанном пакете приложения нельзя использовать операцию неоднократной отметки времени [**SignTool**](/windows-hardware/drivers/devtest/signtool) . операция не поддерживается.

 

Если вы хотите отметку времени для пакета приложения, необходимо сделать это во время операции входа. Пример:

``` syntax
SignTool sign /fd hashAlgorithm /a /f signingCert.pfx /p password /tr timestampServerUrl 
filepath.appx
```

Установите параметр/tr *тиместампсерверурл* равным URL-адресу для сервера отметок времени RFC 3161.

## <a name="remarks"></a>Комментарии

В этом разделе обсуждаются ошибки подписывания для пакетов приложений.

### <a name="troubleshooting-app-package-signing-errors"></a>Устранение ошибок подписывания пакета приложения

Помимо ошибок подписывания, которые может возвращать средство [**SignTool**](/windows-hardware/drivers/devtest/signtool) , средство **SignTool** может также возвращать ошибки, характерные для подписывания пакетов приложений. Эти ошибки обычно отображаются в виде внутренних ошибок:

``` syntax
SignTool Error: An unexpected internal error has occurred.
Error information: "Error: SignerSign() failed." (-2147024885 / 0x8007000B) 
```

Если код ошибки начинается с 0x8008, например 0x80080206 APPX \_ E \_ поврежденного \_ содержимого, это означает, что подписанный пакет является недопустимым. В этом случае, прежде чем можно будет подписать пакет, необходимо перестроить пакет. Полный список \* ошибок 0x8008 см. в разделе [**коды ошибок COM (безопасность и настройка)**](/windows/desktop/com/com-error-codes-4).

Чаще всего это ошибка 0x8007000b (ошибочный \_ Формат ошибки \_ ). В этом случае можно найти более подробные сведения об ошибке в журнале событий:

**Поиск в журнале событий**

1.  Запустите eventvwr. msc.
2.  откройте журнал событий: Просмотр событий (локальный) > журналы приложений и служб > microsoft > Windows > AppxPackagingOM > microsoft-Windows-аппкспаккагинг/эксплуатация.
3.  Найдите Последнее событие ошибки.

Внутренняя ошибка обычно соответствует одному из следующих:


| Идентификатор события | Пример строки события | Предложение | 
|----------|----------------------|------------|
| 150 | ошибка 0x8007000B: имя издателя манифеста приложения (CN=Contoso) должно соответствовать имени субъекта сертификата подписи (CN=Contoso, C=US). | Имя издателя манифеста приложения должно точно соответствовать имени субъекта подписи.<blockquote>[!Note]<br />Эти имена задаются в кавычках и являются чувствительными к регистру и пробелами.</blockquote><br /> вы можете обновить строку атрибута <strong>Publisher</strong> , которая определена для элемента <a href="/uwp/schemas/appxpackage/appxmanifestschema/element-identity"><strong>Identity</strong></a> в файле AppxManifest.xml, в соответствии с именем субъекта предполагаемого сертификата подписи. Или выберите другой сертификат подписи с именем субъекта, совпадающим с именем издателя манифеста приложения. Имя издателя манифеста и имя субъекта сертификата указаны в сообщении о событии. | 
| 151 | ошибка 0x8007000B: указанный хэш-метод подписи (SHA512) должен соответствовать хэш-методу, использованному в схеме блоков пакета приложения (SHA256). | Неверное значение hashAlgorithm, указанное в параметре/FD (см. шаг 1. Определение хэш-алгоритма для использования). Повторно запустите средство <a href="/windows-hardware/drivers/devtest/signtool"><strong>SignTool</strong></a> с hashAlgorithm, которое соответствует сопоставлению блоков пакетов приложений. | 
| 152 | Ошибка 0x8007000B: содержимого пакета приложения должно подходить под схему блоков. | Пакет приложения поврежден и его необходимо перестроить для формирования новой схемы блока. дополнительные сведения о создании пакета приложения см. в статьях создание пакета приложения с помощью <a href="make-appx-package--makeappx-exe-.md">упаковщика приложений</a> или <a href="/previous-versions/hh975357(v=vs.110)">создание пакета приложения с Visual Studio 2012</a>. | 




 

## <a name="security-considerations"></a>Соображения безопасности

После подписания пакета сертификат, использованный для подписания пакета, должен быть доверенным для компьютера, на котором будет развернут пакет. Добавив сертификат в [хранилища сертификатов локальной машины](/windows-hardware/drivers/install/local-machine-and-current-user-certificate-stores), вы меняете доверие сертификатов всех пользователей на компьютере. Рекомендуется установить все сертификаты подписи кода, необходимые для тестирования пакетов приложений в хранилище сертификатов "Доверенные лица", и немедленно удалить эти сертификаты, если они больше не нужны. Если вы создаете собственные тестовые сертификаты для подписи пакетов приложений, мы также рекомендуем ограничить привилегии, связанные с тестовым сертификатом. Дополнительные сведения о создании тестовых сертификатов для подписи пакетов приложений см. [в разделе Создание сертификата для подписи пакета приложения](how-to-create-a-package-signing-certificate.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Примеры**
</dt> <dt>

[Пример создания пакета приложения](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/AppxPackingCreateAppx)
</dt> <dt>

**Основные понятия**
</dt> <dt>

[Рекомендации по подписывания кода](/previous-versions/windows/hardware/design/dn653556(v=vs.85))
</dt> <dt>

[подписывание пакета в Visual Studio 2012](/previous-versions/br230260(v=vs.110))
</dt> <dt>

[SignTool](/windows/desktop/SecCrypto/signtool)
</dt> <dt>

[Упаковщик приложений (MakeAppx.exe)](make-appx-package--makeappx-exe-.md)
</dt> <dt>

[Создание сертификата для подписи пакета приложения](how-to-create-a-package-signing-certificate.md)
</dt> </dl>

