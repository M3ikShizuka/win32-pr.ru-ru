---
title: Реализация COM-объекта расширения создания объекта
description: Модуль создания объектов — это COM-объект, реализованный как внутрипроцессный сервер. В расширениях создания основного и дополнительного объектов должен быть реализован интерфейс Идсадминневобжекст.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Реализация объекта COM для расширения создания объекта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a1c1d7eb9d3e2fe80e721068f39746e08f0ecf5a1db721658c02ec52aca39687
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118187642"
---
# <a name="implementing-the-object-creation-extension-com-object"></a>Реализация COM-объекта расширения создания объекта

Модуль создания объектов — это COM-объект, реализованный как внутрипроцессный сервер. В расширениях создания основного и дополнительного объектов должен быть реализован интерфейс [**идсадминневобжекст**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .

## <a name="implementing-idsadminnewobjext"></a>Реализация Идсадминневобжекст

После создания мастера создания объектов он инициализирует каждое расширение создания объекта, вызывая метод [**идсадминневобжекст:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) расширения. Метод **Initialize** предоставляет расширению сведения о контейнере, в котором создается объект, имя класса нового объекта и сведения о самом мастере. Если запущен мастер создания объектов для создания нового объекта из существующего объекта, параметр *падскописаурце* не будет иметь **значение NULL**. В этом случае расширение должно попытаться получить как можно больше данных из копируемого объекта.

После инициализации расширения вызывается метод [**идсадминневобжекст:: аддпажес**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) . Во время этого метода расширение должно добавить страницу или страницы в мастер. Страница мастера создается путем заполнения структуры [**пропшитпаже**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) , а затем передачи этой структуры в функцию [**креатепропертишитпаже**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) . Затем страница добавляется в мастер путем вызова функции обратного вызова, которая передается в **аддпажес** в параметре *лпфнаддпаже* .

Перед отображением страницы расширения вызывается [**идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) . Это обеспечивает расширение с помощью указателя интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads) для создаваемого объекта.

Во время отображения страницы мастера страница должна обрабатывать все необходимые сообщения уведомлений мастера, такие как [**PSN \_ Сетактиве**](../controls/psn-setactive.md) и [**PSN \_ визнекст**](../controls/psn-wiznext.md), и отвечать на них.

Когда пользователь завершит работу со всеми страницами мастера, в мастере отобразится страница "Готово", в которой содержится сводка по указанным данным. Мастер получает эти данные, вызывая метод [**идсадминневобжекст:: жетсуммаринфо**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) для каждого из расширений. Метод **жетсуммаринфо** предоставляет **строку BSTR** , содержащую текстовые данные, отображаемые на странице "Готово". Модуль создания объектов не должен предоставлять сводные данные. В этом случае **жетсуммаринфо** должен вернуть **E \_ нотимпл**. **Жетсуммаринфо** вызывается один раз для каждого расширения, а не для каждой страницы, поэтому если модуль создания объектов добавляет более одной страницы, то расширение должно объединять сводные данные в одну строку.

Когда пользователь нажимает кнопку " **Готово** " на странице "Готово", Мастер вызывает каждый из методов расширения [**Идсадминневобжекст:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) , используя контекст **\_ \_ \_ предфиксации DSA NEWOBJ CTX** . В этом случае расширение должно записать собранные данные в соответствующие свойства с помощью метода [**iAds::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) или [**iAds::P утекс**](/windows/desktop/api/iads/nf-iads-iads-putex) . Интерфейс [**iAds**](/windows/desktop/api/iads/nn-iads-iads) предоставляется для расширения в методе [**Идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) . Расширение не должно зафиксировать кэшированные свойства путем вызова метода [**iAds:: сетинфо**](/windows/desktop/api/iads/nf-iads-iads-setinfo). Когда все свойства будут записаны, расширение создания первичного объекта фиксирует изменения, вызвав метод **iAds:: сетинфо**. Более подробно эти сведения рассматриваются ниже.

При возникновении ошибки расширение будет уведомлено об ошибке и во время выполнения операции, возникшей при вызове метода [**идсадминневобжекст:: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) .

## <a name="implementing-a-primary-object-creation-wizard"></a>Реализация мастера создания основных объектов

Реализация мастера создания основных объектов идентична мастеру создания дополнительного объекта, за исключением того, что мастер создания основного объекта должен выполнить еще несколько шагов.

Перед закрытием первой страницы Мастер создания объектов должен создать временный объект каталога. Для этого вызовите метод [**идсадминневобжпримарисите:: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) . Указатель на интерфейс [**идсадминневобжпримарисите**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) получается путем вызова [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) с **IID \_ идсадминневобжпримарисите** в интерфейсе [**идсадминневобж**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) , который передается в [**идсадминневобжекст:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize). Метод **CreateNew** создает новый временный объект и вызывает [**Идсадминневобжекст:: setObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) для каждого расширения.

Когда мастер создания объектов содержит более одной страницы, система реализует страницу "Готово", которая отображает сводку сведений об объекте, которые необходимо сохранить. Когда вы наберете кнопку **Готово** на странице "Готово", система вызовет каждый из методов [**Идсадминневобжекст:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) расширения создания объекта и зафиксирует временный объект в постоянной памяти. Однако если мастер создания объектов содержит только одну страницу, то страница будет содержать кнопки **ОК** и **Отмена** , а не кнопки **назад**, **Далее** и **Отмена** , как обычно в мастере, а страница "Готово" не предоставляется. Поэтому мастер расширения создания объектов с одной страницей должен вызвать [**идсадминневобжпримарисите:: Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) для выполнения операций записи и сохранения. Расширение создания одностраничного первичного объекта должно вызывать **commit** в ответ на уведомление [**PSN \_ визфиниш**](../controls/psn-wizfinish.md) .

Поскольку другие модули создания объектов могут добавлять страницы в мастер, расширение создания основного объекта может не узнать, существует ли в мастере более одной страницы. Это не является проблемой по двум причинам: во-первых, если система реализует страницу "Готово", модуль создания первичного объекта получит уведомление [**PSN \_ визнекст**](../controls/psn-wiznext.md) вместо уведомления **PSN \_ визнекст** . Во-вторых, [**commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) завершается сбоем, если мастер содержит более одной страницы.

 

 