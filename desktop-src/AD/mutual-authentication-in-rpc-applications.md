---
title: Взаимная проверка подлинности в приложениях RPC
description: Службы RPC могут использовать точки подключения службы для публикации или могут использовать API-интерфейсы службы имен RPC (Рпкнс).
ms.assetid: 9f575aef-0a4b-4e1b-8ea9-5f40e6c3d9c7
ms.tgt_platform: multiple
keywords:
- Взаимная проверка подлинности в Active Directory для приложений RPC
- Active Directory, использование, взаимная проверка подлинности, RPC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05a8591056293c916205b5b600c1b1a061d169f0
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "103890407"
---
# <a name="mutual-authentication-in-rpc-applications"></a>Взаимная проверка подлинности в приложениях RPC

Службы RPC могут использовать точки подключения службы для публикации или могут использовать API-интерфейсы службы имен RPC (Рпкнс). В этом разделе описывается взаимная проверка подлинности со службой RPC, которая публикует себя с помощью API-интерфейсов службы имен RPC (Рпкнс).

**Регистрация имени участника-службы в каталоге**

1.  Вызовите функцию [**дсжетспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) , чтобы создать имя участника-службы (SPN) для службы.
2.  Вызовите функцию [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) , чтобы зарегистрировать имя субъекта-службы в учетной записи или учетной записи компьютера, в контексте которой будет выполняться служба.

**Регистрация службы в службе именования RPC**

1.  Убедитесь, что соответствующие имена участников-служб зарегистрированы в учетной записи, от имени которой запущена служба. Дополнительные сведения см. в разделе [задачи обслуживания учетной записи входа](logon-account-maintenance-tasks.md).
2.  Вызовите функцию [**рпксерверрегистераусинфо**](/windows/desktop/api/rpcdce/nf-rpcdce-rpcserverregisterauthinfo) для регистрации имени субъекта-службы в службе проверки подлинности RPC и укажите **RPC \_ C \_ AUTHN \_ GSS \_ Negotiate** как службу проверки подлинности для использования.

Дополнительные сведения о выполнении взаимной проверки подлинности в службе RPC см. в разделе [написание сервера SSPI с проверкой подлинности](/windows/desktop/Rpc/writing-an-authenticated-sspi-server).

**Проверка подлинности службы с клиента**

1.  Извлеките имя узла из привязки RPC.
2.  Создайте имя участника-службы для службы, вызвав функцию [**дсмакеспн**](/windows/desktop/api/Dsparse/nf-dsparse-dsmakespna) с классом службы, именем узла DNS и именем службы. это различающееся имя точки подключения в случае Рпкнс.

    Дополнительные сведения о создании имени субъекта-службы для службы Рпкнс см. в разделе [составление имен участников-служб для службы рпкнс](composing-spns-for-an-rpcns-service.md).

3.  Настройте структуру [**\_ \_ QoS безопасности RPC**](/windows/desktop/api/rpcdce/ns-rpcdce-rpc_security_qos) для запроса взаимной проверки подлинности.
4.  Вызовите функцию [**рпкбиндингсетаусинфоекс**](/windows/desktop/api/rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) , чтобы задать данные проверки подлинности для привязки RPC. Клиент должен запросить **\_ \_ \_ \_ \_ целостность PKT C AUTHN уровня RPC** , чтобы убедиться, что связь не была изменена. Для повышения безопасности клиент должен указать для шифрования запросов **RPC \_ C \_ AUTHN уровня " \_ \_ PKT \_** ".
5.  Выполните вызов RPC.

Дополнительные сведения о выполнении взаимной проверки подлинности в клиенте RPC см. в разделе [написание клиента SSPI с проверкой подлинности](/windows/desktop/Rpc/writing-an-authenticated-sspi-client).

**Проверка подлинности клиента из службы**

1.  Вызовите функцию [**рпкбиндингинкаусклиент**](/windows/desktop/api/rpcdce/nf-rpcdce-rpcbindinginqauthclient) , чтобы проверить параметры проверки подлинности, заданные клиентом. Если клиент не запрашивал нужный уровень проверки подлинности, отклоните вызов. Имейте в виду, что служба RPC должна проверять уровень проверки подлинности, службу проверки подлинности и удостоверение клиента при каждом вызове, чтобы обеспечить правильную проверку подлинности клиента.
2.  Вызовите функцию [**рпЦимперсонатеклиент**](/windows/desktop/api/rpcdce/nf-rpcdce-rpcimpersonateclient) для олицетворения клиента.
3.  Выполните запрошенную операцию.
4.  Вызовите функцию [**рпкреверттоселф**](/windows/desktop/api/rpcdce/nf-rpcdce-rpcreverttoself) , чтобы вернуться к контексту безопасности службы.

Дополнительные сведения об олицетворении клиента RPC см. в разделе [олицетворение](/windows/desktop/Rpc/client-impersonation)клиента.

Дополнительные сведения можно найти в разделе

-   [Публикация с помощью службы имен RPC (Рпкнс)](publishing-with-the-rpc-name-service-rpcns.md)
-   [Основы безопасности RPC](/windows/desktop/Rpc/rpc-security-essentials)

 

 