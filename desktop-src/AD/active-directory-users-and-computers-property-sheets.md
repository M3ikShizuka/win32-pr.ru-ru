---
title: Вкладки свойств «пользователи и компьютеры Active Directory»
description: Оснастка MMC "Active Directory пользователи и компьютеры" предназначена для вывода страницы свойств для различных объектов на сервере Active Directory.
ms.assetid: 38032d89-9549-475c-90aa-dac5cfe11084
ms.tgt_platform: multiple
keywords:
- Active Directory страниц свойств пользователей и компьютеров Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 30ea24f34e86f21af178e975852accb667bb69e4
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "103789649"
---
# <a name="active-directory-users-and-computers-property-sheets"></a>Вкладки свойств «пользователи и компьютеры Active Directory»

Оснастка MMC "Active Directory пользователи и компьютеры" предназначена для вывода страницы свойств для различных объектов на сервере Active Directory. Страница свойств содержит одну или несколько страниц, используемых для просмотра и изменения данных объекта. Для разных типов объектов отображаются разные наборы страниц. Оснастка MMC "Active Directory пользователи и компьютеры" также позволяет сторонним поставщикам добавлять пользовательские страницы в страницу свойств для определенного типа объектов. Дополнительные сведения см. в разделе [страницы свойств для использования с описателями экрана](property-pages-for-use-with-display-specifiers.md).

Некоторые приложения, кроме оснастки MMC "Active Directory пользователи и компьютеры", должны предоставить пользователю возможность просматривать и изменять атрибуты объекта на сервере Active Directory. Приложение может реализовать собственные страницы свойств, но лучше предложить согласованный пользовательский интерфейс для сокращения времени путаницы и обучения. К счастью, оснастка MMC "Active Directory пользователи и компьютеры" позволяет любому приложению OLE COM отображать страницу свойств для объекта, идентичного на странице свойств, которая будет отображаться оснасткой консоли управления Active Directory пользователи и компьютеры для одного и того же объекта.

Дополнительные сведения и пример кода, в котором размещена страница свойств Active Directory Users and Computers, см. в образце Пропшисост в пакете SDK для платформы.

## <a name="developer-audience"></a>Аудитория разработчиков

В этой документации предполагается, что читатель знаком с разработкой COM-операций и компонентов с помощью C++. В настоящее время невозможно создать Active Directory расширение вкладки свойств с помощью Visual Basic.

## <a name="hosting-an-active-directory-users-and-computers-property-sheet"></a>Размещение страницы свойств "пользователи и компьютеры" Active Directory

**Отображение страницы свойств объекта на сервере Active Directory**

1.  Создайте окно, которое может использоваться для обработки сообщений. Это может быть существующее окно или специальное окно специального назначения. Это называется *скрытым окном*.
2.  Создайте объект OLE COM, производный от [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject). Этот объект данных должен поддерживать следующие форматы данных:

    -   [**Кфстр \_ ДСОБЖЕКТНАМЕС**](cfstr-dsobjectnames.md) . Этот формат данных содержит [**дсобжектнамес**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) , определяющий объект, к которому применяется страница свойств. При размещении страницы свойств в следующем списке показаны более значимые элементы структуры **дсобжектнамес** .

        **клсиднамеспаце** Процессу. Задайте здесь идентификатор GUID приложения, если он используется в будущем.
        
        **аобжектс** Содержит массив структур [**дсбожект**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) . Каждая структура **дсбожект** представляет один объект каталога. Элемент **Цитемс** содержит количество элементов в массиве. Используется только первый объект в этом массиве. Другие объекты игнорируются.

    -   [**Кфстр \_ ДСДИСПЛАЙСПЕКОПТИОНС**](cfstr-ds-display-spec-options.md) этот формат данных содержит структуру [**дсдисплайспекоптионс**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) , содержащую данные, которые будут использоваться страницами свойств, например место загрузки страниц свойств с сервера, используемые учетные данные и т. д. Более значимые члены **дсдисплайспекоптионс** показаны в следующем списке.

        **оффсетаттрибпрефикс** Строка префикса атрибута определяет место получения списка страниц свойств. Он должен содержать одну из следующих строк.

        

        | Строка префикса атрибута | Описание                                              |
        |-------------------------|----------------------------------------------------------------------------------------------------------------------|
        | группы<br/>      | Страницы свойств загружаются из атрибута [**админпропертипажес**](/windows/desktop/ADSchema/a-adminpropertypages) .<br/> |
        | консоль<br/>      | Страницы свойств загружаются из атрибута [**шеллпропертипажес**](/windows/desktop/ADSchema/a-shellpropertypages) .<br/> |

        


    -   [**Кфстр \_ DS \_ пропшитконфиг**](cfstr-ds-propsheetconfig.md) . Этот формат данных содержит структуру [**пропшиткфг**](propsheetcfg.md) , содержащую данные узла страницы свойств. При размещении страницы свойств более значимые элементы структуры **пропшиткфг** содержат данные, показанные в следующем списке.

        **лнотифихандле** Должно быть равно нулю.
        **хвндпарентшит**  Содержит маркер окна для получения сообщений [**\_ \_ об \_ изменениях в WM адспроп**](wm-adsprop-notify-change.md) , когда что-либо на одной из страниц изменяется и применяется. Может иметь **значение NULL** , если это сообщение не требуется.

        **хвндхидден** Содержит маркер окна для получения [**\_ листа WM DSA \_ \_ Создание \_ уведомления**](wm-dsa-sheet-create-notify.md) и сообщения [**\_ \_ \_ \_ о закрытии**](wm-dsa-sheet-close-notify.md) окна. Задайте для него маркер скрытого окна.

        **впарамшитклосе** Содержит определяемый приложением идентификатор, возвращаемый в параметре *wParam* в сообщении [**\_ \_ \_ о закрытии \_ уведомления на листе WM DSA**](wm-dsa-sheet-close-notify.md) . Если этот член равен нулю, то в скрытом окне не будет отправлено сообщение об ошибке **\_ \_ \_ \_ закрытия листа WM DSA** .


3.  Создайте экземпляр объекта [**\_ дспропертипажес CLSID**](guids-of-user-interface-elements.md) и получите интерфейс [**ишеллекстинит**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) для объекта. Также можно дублировать поведение объекта **\_ дспропертипажес CLSID** . Дополнительные сведения см. в разделе дублирование поведения \_ объекта ДСПРОПЕРТИПАЖЕС CLSID.
4.  Инициализируйте объект [**CLSID \_ дспропертипажес**](guids-of-user-interface-elements.md) , вызвав метод [**ишеллекстинит:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) . Параметры *пидлфолдер* и *хкэйпрогид* не используются в этом методе. Параметр *пдтобж* — это указатель на объект данных, созданный на шаге 2. При вызове метода **ишеллекстинит:: Initialize** объект **CLSID \_ дспропертипажес** сохранит ссылку на объект данных.
5.  Получите интерфейс [**ишеллпропшитекст**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) для объекта [**CLSID \_ дспропертипажес**](guids-of-user-interface-elements.md) и вызовите метод [**ишеллпропшитекст:: аддпажес**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) . Параметр *лпфнаддпаже* — это адрес функции обратного вызова, которую необходимо реализовать. Формат этой функции показан ниже. Если функция обратного вызова объявлена как член класса C++, функция обратного вызова должна быть объявлена как **статическая**. Параметр *lParam* — это определяемое приложением значение, которое может использоваться для определения объекта, реализующего функцию обратного вызова. При вызове метода **ишеллпропшитекст:: аддпажес** объект **CLSID \_ дспропертипажес** получит данные из объекта данных и перечислит страницы свойств, зарегистрированные для описателей объекта. Затем **объект \_ дспропертипажес CLSID** перечисляет объекты страницы свойств, вызывая метод **ишеллпропшитекст:: аддпажес** для каждого объекта.

    ```C++
    BOOL CALLBACK AddPagesCallback(HPROPSHEETPAGE, LPARAM)
    ```

    

6.  Каждая страница, добавленная объектами страницы свойств, приведет к вызову функции обратного вызова с помощью маркера для страницы свойств и значения, определенного приложением. Функция обратного вызова должна хранить каждый передаваемый обработчик страницы свойств. Когда метод [**ишеллпропшитекст:: аддпажес**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) объекта [**CLSID \_ дспропертипажес**](guids-of-user-interface-elements.md) возвращает, все страницы будут добавлены с помощью функции обратного вызова.
7.  Заполните структуру [**пропшисеадер**](/windows/win32/api/prsht/ns-prsht-propsheetheadera_v2) для вывода страницы свойств. Член **фпаже** получает указатель на массив дескрипторов страниц, собранных функцией обратного вызова. Элемент **нпажес** получает количество страниц в массиве обработчиков страниц.
8.  Отобразите страницу свойств, вызвав функцию [**Страница свойств**](/windows/win32/api/prsht/nf-prsht-propertysheeta) .

Если данные на любой странице изменяются и нажаты кнопки **ОК** или **Применить** , окно, определяемое элементом **хвндпарентшит** структуры [**пропшиткфг**](propsheetcfg.md) , будет получать сообщение об [**\_ \_ \_ изменении уведомления WM адспроп**](wm-adsprop-notify-change.md) . Это сообщение является исключительно уведомлением и не требует каких-либо действий.

Когда страница закрывается, окно, определяемое членом **хвндхидден** структуры [**пропшиткфг**](propsheetcfg.md) , получит сообщение [**\_ \_ \_ о закрытии \_ уведомления для листа WM DSA**](wm-dsa-sheet-close-notify.md) . Это сообщение является исключительно уведомлением и не требует выполнения каких-либо действий.

В некоторых случаях для существующих страниц свойств потребуется отобразить вторичную страницу свойств. Например, при отображении страницы свойств для объекта пользователя и выборе **элемента** страница будет отображен список групп, членом которых является пользователь. Если дважды щелкнуть одну из этих групп в списке, отобразится страница свойств этой группы. Основная страница свойств не отображает вспомогательный лист сама по себе. Он запрашивает отображение дополнительного листа на узле, отправив [**лист WM \_ DSA \_ \_ Create \_ уведомление**](wm-dsa-sheet-create-notify.md) в окно, определяемое элементом **хвндхидден** структуры [**пропшиткфг**](propsheetcfg.md) . Параметр *wParam* сообщения о **\_ \_ \_ создании \_ уведомления для листа WM DSA** — это указатель на структуру [**\_ \_ \_ сведений о странице DSA sec**](dsa-sec-page-info.md) , которая содержит сведения о вторичной вкладке свойств и объекте, который она представляет. В ответ на это сообщение узел страницы свойств должен отображать дополнительную страницу свойств точно так же, как показано выше. После обработки сообщения **\_ \_ \_ \_ о создании уведомления на листе WM DSA** получатель сообщения должен освободить структуру **\_ \_ \_ сведений о странице DSA sec** , передав значение *wParam* в функцию [**функции LocalFree**](/windows/desktop/api/winbase/nf-winbase-localfree) .

## <a name="duplicating-the-behavior-of-the-clsid_dspropertypages-object"></a>Дублирование поведения \_ объекта ДСПРОПЕРТИПАЖЕС CLSID

**Дублирование поведения \_ объекта ДСПРОПЕРТИПАЖЕС CLSID**

1.  Перечислите значения в атрибуте [**админпропертипажес**](/windows/desktop/ADSchema/a-adminpropertypages) или [**шеллпропертипажес**](/windows/desktop/ADSchema/a-shellpropertypages) для описателя вывода класса Object. Каждое значение представляет собой строку, содержащую число, за которым следует запятая, а затем строковое представление идентификатора класса для расширения страницы свойств. Дополнительные сведения о формате значений описателей, отображаемых на страницах свойств, см. [в разделе Регистрация COM-объекта страницы свойств в описателе экрана](registering-the-property-page-com-object-in-a-display-specifier.md).
2.  Преобразуйте каждую строку идентификатора класса в **CLSID** с помощью функции [**клсидфромстринг**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .
3.  Отсортируйте идентификаторы класса расширения по номеру, который предшествует каждой строке идентификатора класса в значении атрибута. Если два числа идентичны, следует сортировать идентификаторы классов в порядке получения значений атрибутов с Active Directory сервера.
4.  Перечислите идентификаторы классов расширений, создавая экземпляр каждого расширения.
5.  Для каждого расширения в порядке, указанном выше, вызовите расширение [**ишеллекстинит:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) с теми же сведениями, которые описаны на шаге 4 процедуры размещения страницы свойств Active Directory Users and Computers.
6.  Для каждого расширения в порядке, указанном выше, вызовите расширение [**ишеллпропшитекст:: аддпажес**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) с теми же сведениями, которые описаны на шаге 5 процедуры размещения страницы свойств Active Directory Users and Computers.

По возможности используйте объект [**CLSID \_ дспропертипажес**](guids-of-user-interface-elements.md) для создания страниц вместо того, чтобы делать это вручную. **\_ Дспропертипажес CLSID** оптимизирован и правильно обрабатывает случаи сбоев, например, если для текущего языкового стандарта не доступен спецификатор вывода. Кроме того, объект **CLSID \_ дспропертипажес** может измениться в будущем. Это означает, что страницы свойств могут не совпадать в точности с параметрами, отображаемыми оснасткой консоли управления Active Directory пользователи и компьютеры.

## <a name="special-programming-elements"></a>Специальные программные элементы

В настоящее время в опубликованном файле заголовка не определены следующие элементы программирования. Чтобы использовать эти элементы, необходимо определить их самостоятельно в точном формате, показанном на конкретной справочной странице.

-   [**\_ПРОПШИТКОНФИГ кфстр DS \_**](cfstr-ds-propsheetconfig.md)
-   [**пропшиткфг**](propsheetcfg.md)
-   [**\_ \_ \_ уведомление о закрытии листа WM DSA \_**](wm-dsa-sheet-close-notify.md)
-   [**\_ \_ \_ уведомление о создании листа WM DSA \_**](wm-dsa-sheet-create-notify.md)
-   [**\_ \_ сведения о странице DSA sec \_**](dsa-sec-page-info.md)

## <a name="example-code"></a>Пример кода

В следующем примере кода C++ показан надежный способ определения этих элементов, которые будут продолжать работать, даже если эти элементы определены в опубликованном файле заголовка в будущем.


```C++
#ifndef CFSTR_DS_PROPSHEETCONFIG
    #define CFSTR_DS_PROPSHEETCONFIG_W L"DsPropSheetCfgClipFormat"
    #define CFSTR_DS_PROPSHEETCONFIG_A "DsPropSheetCfgClipFormat"

    #ifdef UNICODE
        #define CFSTR_DS_PROPSHEETCONFIG CFSTR_DS_PROPSHEETCONFIG_W
    #else
        #define CFSTR_DS_PROPSHEETCONFIG CFSTR_DS_PROPSHEETCONFIG_A
    #endif //UNICODE
#endif //CFSTR_DS_PROPSHEETCONFIG


#ifndef WM_ADSPROP_SHEET_CREATE
    #define WM_ADSPROP_SHEET_CREATE (WM_USER + 1108)
#endif


#ifndef WM_DSA_SHEET_CREATE_NOTIFY
    #define WM_DSA_SHEET_CREATE_NOTIFY (WM_USER + 6)
#endif


#ifndef WM_DSA_SHEET_CLOSE_NOTIFY
    #define WM_DSA_SHEET_CLOSE_NOTIFY (WM_USER + 5) 
#endif


#ifndef DSA_SEC_PAGE_INFO
    typedef struct _DSA_SEC_PAGE_INFO
    {
        HWND    hwndParentSheet;
        DWORD   offsetTitle;
        DSOBJECTNAMES dsObjectNames;
    } DSA_SEC_PAGE_INFO, *PDSA_SEC_PAGE_INFO;
#endif //DSA_SEC_PAGE_INFO

#ifndef PROPSHEETCFG
    typedef struct _PROPSHEETCFG
    {  
        LONG_PTR lNotifyHandle;  
        HWND hwndParentSheet;  
        HWND hwndHidden;  
        WPARAM wParamSheetClose;
    } PROPSHEETCFG, *PPROPSHEETCFG;
#endif //PROPSHEETCFG
```



 

