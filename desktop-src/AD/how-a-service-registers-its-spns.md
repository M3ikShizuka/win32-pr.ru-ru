---
title: Как служба регистрирует свои имена участников-служб
description: Прежде чем клиент сможет использовать имя субъекта-службы для проверки подлинности экземпляра службы, имя субъекта-службы должно быть зарегистрировано в учетной записи пользователя или компьютера, которую экземпляр службы будет использовать для входа в систему.
ms.assetid: 39712c1f-3a9a-4c98-a1cb-879ab0b4cb63
ms.tgt_platform: multiple
keywords:
- Как служба регистрирует свои имена участников-служб AD
- имя субъекта-службы AD, как служба регистрирует свои имена участников-служб
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 96ebf33ed0f28dff3acffdcdc96a880c21ec532ff677801dd52ac1801f44c80e
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118188587"
---
# <a name="how-a-service-registers-its-spns"></a>Как служба регистрирует свои имена участников-служб

Прежде чем клиент сможет использовать имя субъекта-службы для проверки подлинности экземпляра службы, имя субъекта-службы должно быть зарегистрировано в учетной записи пользователя или компьютера, которую экземпляр службы будет использовать для входа в систему. Как правило, регистрация имени участника-службы выполняется программой установки службы, которая выполняется с правами администратора домена.

Установщик службы, который устанавливает экземпляр службы на главном компьютере, обычно выполняет следующую процедуру.

**Регистрация имен участников-служб для экземпляра службы**

1.  Вызовите функцию [**дсжетспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) , чтобы создать один или несколько уникальных имен участников-служб для экземпляра службы. Дополнительные сведения см. в разделе [форматы имен для уникальных имен участников-служб](name-formats-for-unique-spns.md).
2.  Вызовите функцию [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) для регистрации имен в учетной записи входа службы.

[**Дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) регистрирует имена участников-служб в качестве свойства объекта учетной записи пользователя или компьютера в каталоге. объекты **пользователей** и **компьютеров** имеют атрибут «переадресить», который является многозначным **атрибутом** для хранения всех имен участников-служб, связанных с учетной записью пользователя или компьютера. Если служба выполняется под учетной записью пользователя, имена участников-служб хранятся **в атрибуте** «перечислить» этой учетной записи. Если служба выполняется в учетной записи LocalSystem, то имена участников-служб хранятся **в атрибуте** «перечислить» учетной записи главного компьютера службы. Вызывающий объект **дсвритеаккаунтспн** должен указывать различающееся имя объекта учетной записи, в котором хранятся имена участников-служб.

Чтобы убедиться, что зарегистрированные имена участников-служб безопасны **, атрибут** переводится в непосредственный журнал. Он может быть написан только путем вызова [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna). Вызывающий объект должен иметь доступ на запись к **атрибуту** "перечислить" целевой учетной записи. Как правило, доступ на запись предоставляется по умолчанию только администраторам домена. Однако существует особый случай, когда система позволяет службе, работающей под учетной записью LocalSystem, зарегистрировать собственные имена участников-служб в учетной записи компьютера узла службы. В этом случае записываемое имя участника-службы должно иметь форму " <service class> / <host> ", а " &lt; узел &gt; " — имя DNS локального компьютера.

[**Дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna) также может удалять имена участников-служб из учетной записи. Параметр операции указывает, следует ли добавлять имена участников-служб в учетную запись, удалять их из учетной записи или использовать для полной замены всех текущих имен участников-служб для учетной записи. При удалении экземпляра службы удалите все имена участников-служб, зарегистрированные для этого экземпляра.

Дополнительные сведения и пример кода, который регистрирует или отменяет регистрацию имен участников службы, см. в разделе [Регистрация имен участников-служб для службы](registering-the-spns-for-a-service.md).

Службы на основе узла, использующие простой формат имени участника-службы <service class> / <host> (SPN), имеют возможность использовать функцию [**дссерверрегистерспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsserverregisterspna) , которая создает и регистрирует имена участников-служб для экземпляра службы. **Дссерверрегистерспн** — это вспомогательная функция, которая вызывает [**дсжетспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsgetspna) и [**дсвритеаккаунтспн**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dswriteaccountspna).

Дополнительные сведения см. в статье [учетные записи входа в службу](service-logon-accounts.md).

 

 




