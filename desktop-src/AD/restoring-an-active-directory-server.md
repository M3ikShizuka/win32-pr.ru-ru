---
title: Восстановление сервера Active Directory
description: Active Directory серверы должны быть восстановлены в автономном режиме.
ms.assetid: 91fbbdc1-0e84-4b89-8a38-4c8d0268992b
ms.tgt_platform: multiple
keywords:
- Восстановление Active Directory Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 273d02fd50d6b3bd68a055a6a783566e4ebddcf7
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "103890375"
---
# <a name="restoring-an-active-directory-server"></a>Восстановление сервера Active Directory

Active Directory серверы должны быть восстановлены в автономном режиме. Необходимо перезапустить систему в режиме восстановления служб каталогов. В этом режиме операционная система работает без служб домен Active Directory и все пользователи проверяются с помощью диспетчера учетных записей безопасности (SAM) в реестре. Чтобы восстановить домен Active Directoryные службы, используйте учетные данные локального администратора на восстанавливаемом контроллере домена.

Вызывающий функции Restore должен иметь право доступа **SE \_ RESTORE \_ Name** . Используйте функцию [**дссетаусидентити**](dssetauthidentity.md) , чтобы задать контекст безопасности, в котором вызываются функции резервного копирования и восстановления каталога.

Имейте в виду, что при восстановлении домен Active Directory служб необходимо также восстановить другие компоненты состояния системы.

**Восстановление служб домен Active Directory Services**

1.  Вызовите функцию [**дсиснтдсонлине**](dsisntdsonline.md) , чтобы определить, работают ли службы домен Active Directory.
2.  Если службы домен Active Directory не выполняются, вызывается функция [**дсресторепрепаре**](dsrestoreprepare.md) для инициализации операции восстановления и получения маркера контекста резервного копирования. Если службы домен Active Directory работают, восстановление невозможно, и приложение Restore должно завершить операцию восстановления. Функция **дсресторепрепаре** требует, чтобы маркер срока действия был получен из функции [**дсбаккуппрепаре**](dsbackupprepare.md) во время операции резервного копирования.
3.  Вызовите функцию [**дсресторежетдатабаселокатионс**](dsrestoregetdatabaselocations.md) , чтобы определить каталоги, в которых будут восстанавливаться файлы. Если эта функция завершается сбоем, восстановите данные обратно в исходный каталог резервных копий. это каталог, из которого были скопированы данные.
4.  Вызовите функцию [**дсресторерегистер**](dsrestoreregister.md) , чтобы подготовить сервер Active Directory для операции восстановления и заблокировать каталоги восстановления.
5.  Используйте стандартные функции Win32 для восстановления файлов. Сначала удалите все файлы в целевом каталоге. затем скопируйте файлы резервных копий в каталог назначения.
6.  Вызовите функцию [**дсресторерегистеркомплете**](dsrestoreregistercomplete.md) , чтобы указать, что восстановление завершено.
7.  Вызовите функцию [**дсресторинд**](dsrestoreend.md) , чтобы освободить все ресурсы, связанные с контекстом.

После восстановления в режиме восстановления служб каталогов необходимо перезапустить контроллер домена в обычном режиме. При запуске службы каталогов контроллер домена выполнит нормальную проверку согласованности, и восстановленный каталог будет подключен к сети.

Имейте в виду, что восстановление сервера Active Directory всегда состоит из двух частей. Сначала восстановите базу данных до момента создания резервной копии. Во-вторых, выполните репликацию каталога, в котором только что восстановленный DSA реплицирует обновления после резервного копирования с других DSA в лесу домена и предприятия.

Компьютер, работающий под Windows 2000 или Windows Server 2003, который содержит реплику службы каталогов, является контроллером домена.

Функция [**дсресторерегистер**](dsrestoreregister.md) добавляет данные в реестр, который должен сохранить работоспособность процесса восстановления реестра для правильной работы восстановления. Чтобы убедиться, что данные реестра сохранены, восстановите домен Active Directory Services с помощью функций **дсресторе \*** перед перезагрузкой компьютера после вызова функции [**регреплацекэй**](/windows/desktop/api/winreg/nf-winreg-regreplacekeya) . Этот процесс работает потому, что **регреплацекэй** на самом деле не заменяет куст реестра, пока компьютер не будет перезагружен, а данные реестра, добавленные функцией **дсресторерегистер** , не будут заменены в результате операции восстановления реестра.

 

 