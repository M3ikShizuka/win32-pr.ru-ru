---
title: Привязка к глобальному каталогу
description: Глобальный каталог — это пространство имен, которое содержит данные каталога для всех доменов в лесу.
ms.assetid: c3c131c7-d9dd-4dbd-a909-abd0ffd9f375
ms.tgt_platform: multiple
keywords:
- Привязка к глобальному каталогу Active Directory
- Глобальный каталог Active Directory, привязка к
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 08fe40b944130f66617b0c111b361ca51cbef126
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069815"
---
# <a name="binding-to-the-global-catalog"></a>Привязка к глобальному каталогу

Глобальный каталог — это пространство имен, которое содержит данные каталога для всех доменов в лесу. Глобальный каталог содержит частичную реплику каждого каталога домена. Он содержит запись для каждого объекта в корпоративном лесу, но не содержит все свойства каждого объекта. Вместо этого он содержит только свойства, указанные для включения в глобальный каталог.

Глобальный каталог хранится на конкретных серверах в Организации. В качестве серверов глобального каталога могут выступать только контроллеры домена. Администраторы указывают, содержит ли данный контроллер домена глобальный каталог с помощью Active Directory сайтов и диспетчеров служб.

Чтобы выполнить привязку к глобальному каталогу с помощью ADSI, используйте моникер "GC:".

Существует два способа привязки к глобальному каталогу для выполнения поиска в лесу:

-   Выполните привязку к корневому объекту Enterprise для поиска по всем доменам в лесу.
-   Выполните привязку к конкретному объекту для поиска этого объекта и его дочерних элементов. Например, при привязке к домену с двумя доменами, расположенными под ним в дереве доменов леса, можно выполнять поиск по этим трем доменам. Обратите внимание, что различающееся имя объекта, с которым выполняется привязка, точно совпадает с различающимся именем, используемым для привязки к пространству имен «LDAP:». Помните, что "LDAP:" является полной репликой одного домена, а "GC:" является частичной репликой всех доменов в лесу.

Как и в случае с моникером "LDAP:", можно использовать бессерверную привязку или привязку к конкретному серверу глобального каталога. При поиске в текущем лесу используйте бессерверную привязку. Однако при поиске в другом лесу укажите либо доменное имя, либо сервер глобального каталога для привязки, как показано в следующих примерах.

Привяжите с помощью доменного имени:

``` syntax
GC://fabrikam.com
```

Привяжите с использованием имени сервера:

``` syntax
GC://servername
```

Также можно выполнить привязку к конкретному объекту в глобальном каталоге. Чтобы выполнить привязку к объекту Sales в домене Fabrikam, используйте следующий формат.

``` syntax
GC://fabrikam.com/DC=sales,DC=fabrikam,DC=com
```

Или, чтобы выполнить привязку к объекту Sales на сервере, используйте следующий формат.

``` syntax
GC://servername.fabrikam.com/DC=sales,DC=fabrikam,DC=com
```

**Поиск по всему лесу**

1.  Выполните привязку к корню пространства имен глобального каталога.
2.  Перечисление контейнера глобального каталога. Контейнер глобального каталога содержит один объект, который можно использовать для поиска в целом лесу.
3.  Используйте объект в контейнере для выполнения поиска. В C/C++ вызовите [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) , чтобы получить указатель [**IDirectorySearch**](/windows/desktop/api/iads/nn-iads-idirectorysearch) на объект, чтобы можно было использовать интерфейс **IDirectorySearch** для выполнения поиска. В Visual Basic используйте объект, возвращенный из перечисления в запросе ADO.

Чтобы перечислить серверы глобального каталога в сайте, выполните поиск по поддереву LDAP "CN = <yoursite> , CN = Sites <DN of the configurationNamingContext> ", используя следующую строку фильтра.

``` syntax
(&(objectCategory=nTDSDSA)(options:1.2.840.113556.1.4.803:=1))
```

Этот фильтр использует **\_ \_ бит правила сопоставления LDAP \_ \_ и** оператор правила сопоставления (1.2.840.113556.1.4.803) для поиска объектов **нтдсдса** с установленным битом низкого порядка в битовой маске атрибута **Options** . Бит низкого порядка, соответствующий **нтдсдса opt, — константа \_ \_ \_ GC** , определенная в NTDSAPI. h, идентифицирует объект **нтдсдса** сервера глобального каталога. Дополнительные сведения о правилах сопоставления см. в разделе [синтаксис фильтра поиска](/windows/desktop/ADSI/search-filter-syntax).

Родительским объектом объекта **нтдсдса** является серверный объект, а свойство **dNSHostName** объекта Server — DNS-имя сервера глобального каталога.

Нельзя использовать \# определенную константу, например **нтдсдса \_ OPT \_ — это \_** **\_ \_ бит правила сопоставления \_ \_ GC и LDAP и** непосредственно в строке фильтра поиска. Однако эти константы можно использовать как аргументы для функции, например [**swprintf \_ s**](/windows/win32/api/winuser/nf-winuser-wsprintfa) , чтобы вставить постоянные значения в строку фильтра.

Глобальный каталог не представляет всю структуру дерева леса. Например, вы можете ожидать, что в следующем примере кода будут перечислены все домены в лесу и все дочерние объекты каждого домена. На практике, то, что действительно делает, — перечисляет все домены в лесу, но ни один из перечисляемых объектов домена не содержит дочерних элементов. Это ограничение глобального каталога.


```VB
Dim oGC As IADs
Dim oDomain As IADs
Dim oChild As IADs

Set oGC = GetObject("GC:")
For Each oDomain In oGC
    ' Print the name of the domain.
    Debug.Print oDomain.Name
    
    ' Enumerate the child objects of the domain.
    For Each oChild In oDomain
        Debug.Print oChild.Name
    Next
Next
```



Чтобы исправить это, необходимо выполнить привязку к каждому объекту домена, а затем перечислить дочерние объекты каждого домена. В следующем примере кода показан соответствующий метод.


```VB
Dim oGC As IADs
Dim oDomainEnum As IADs
Dim oDomainBind As IADs
Dim oChild As IADs

Set oGC = GetObject("GC:")
For Each oDomainEnum In oGC
    ' Print the name of the domain.
    Debug.Print oDomainEnum.Name
    
    ' Bind to the domain.
    Set oDomainBind = GetObject("LDAP://" + oDomainEnum.Name)
    
    ' Enumerate the child objects of the domain.
    For Each oChild In oDomainBind
        Debug.Print oChild.Name
    Next
Next
```



Дополнительные сведения и примеры кода, демонстрирующие Поиск в целом лесу, см. в разделе [пример кода для поиска в лесу](example-code-for-searching-a-forest.md).

 

 