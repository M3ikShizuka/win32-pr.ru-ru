---
title: Резервное копирование сервера Active Directory
description: Резервное копирование Active Directory Server требует резервного копирования базы данных и журналов транзакций. В этом разделе содержится пошаговое руководство по резервному копированию службы каталогов Active Directory в приложении резервного копирования.
ms.assetid: 250b2f40-6d43-4aa5-a588-b0cd4839828d
ms.tgt_platform: multiple
keywords:
- Резервное копирование Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5affde952ee543afe1bb9b794cce074a74382aa7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067275"
---
# <a name="backing-up-an-active-directory-server"></a>Резервное копирование сервера Active Directory

Резервное копирование Active Directory Server требует резервного копирования базы данных и журналов транзакций. В этом разделе содержится пошаговое руководство по резервному копированию службы каталогов Active Directory в приложении резервного копирования.

Вызывающий эти функции резервного копирования должен иметь привилегию **SE \_ BACKUP \_ Name** . Для задания контекста безопасности, в котором вызываются функции резервного копирования и восстановления каталога, можно использовать функцию [**дссетаусидентити**](dssetauthidentity.md) .

**Чтобы создать резервную копию сервера Active Directory, выполните следующие действия.**

1.  Вызовите функцию [**дсиснтдсонлине**](dsisntdsonline.md) , чтобы определить, работают ли службы домен Active Directory.
2.  Если службы домен Active Directory работают, вызовите функцию [**дсбаккуппрепаре**](dsbackupprepare.md) , чтобы инициализировать маркер контекста резервного копирования. Если службы домен Active Directory не работают, резервное копирование невозможно, и приложение резервного копирования должно завершить операцию резервного копирования.
3.  Вызовите функцию [**дсбаккупжетдатабасенамес**](dsbackupgetdatabasenames.md) , чтобы получить список файлов для резервного копирования. Чтобы освободить память, возвращенную этой функцией, вызовите функцию [**дсбаккупфри**](dsbackupfree.md) .
4.  Для каждого имени в возвращенном списке файлов вызовите функцию [**дсбаккупопенфиле**](dsbackupopenfile.md) , а затем повторяющиеся вызовы функции [**дсбаккупреад**](dsbackupread.md) до тех пор, пока не будет считан весь файл. Завершив чтение файла, вызовите функцию [**дсбаккупклосе**](dsbackupclose.md) , чтобы закрыть ее.
5.  После резервного копирования всех файлов базы данных вызовите функцию [**дсбаккупжетбаккуплогс**](dsbackupgetbackuplogs.md) , чтобы получить список журналов транзакций. Этот список обрабатывается так же, как список файлов базы данных.
6.  После завершения резервного копирования журнала транзакций вызовите функцию [**дсбаккуптрункателогс**](dsbackuptruncatelogs.md) , чтобы удалить все зафиксированные журналы транзакций, резервные копии которых были созданы.
7.  Сохраните содержимое токена срока действия, предоставленного функцией [**дсбаккуппрепаре**](dsbackupprepare.md) . Его можно сохранить в файле или в какой-либо другой долговременной памяти. Этот токен должен быть передан функции [**дсресторепрепаре**](dsrestoreprepare.md) для инициации операции восстановления.
8.  Освободите память для токена истечения срока действия, передав указатель маркера функции [**дсбаккупфри**](dsbackupfree.md) .
9.  Наконец, вызовите функцию [**дсбаккупенд**](dsbackupend.md) , чтобы освободить все ресурсы, связанные с этим маркером контекста резервного копирования.

 

 




