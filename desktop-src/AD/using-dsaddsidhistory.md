---
title: Использование Дсаддсидхистори
description: В этом разделе описывается использование функции Дсаддсидхистори.
ms.assetid: cbf4983c-551d-4771-870e-a192ed898eb7
ms.tgt_platform: multiple
keywords:
- Использование Дсаддсидхистори Active Directory
- Active Directory Active Directory, использование с помощью Дсаддсидхистори
- Дсаддсидхистори Active Directory, использование
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6e987a55f7fe39a8e4705f6aca9e44189e0f7a2
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122881836"
---
# <a name="using-dsaddsidhistory"></a>Использование Дсаддсидхистори

Функция [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) получает идентификатор безопасности основной учетной записи (SID) субъекта безопасности из одного домена (исходного домена) и добавляет его к атрибуту **SIDHistory** субъекта безопасности в другом (целевом) домене в другом лесу. если исходный домен находится в основном режиме Windows 2000, эта функция также получает значения **sidhistory** исходного участника и добавляет их в **sIDHistory** целевого участника.

Добавление SID в **SIDHistory** субъекта безопасности — это чувствительная к безопасности операция, которая фактически предоставляет основному участнику доступ ко всем ресурсам, доступным для исходного участника, при условии, что отношения доверия между применимыми доменами ресурсов и конечным доменом существуют.

в основном режиме Windows 2000 домен. при входе пользователя в систему создается маркер доступа, содержащий идентификатор безопасности основной учетной записи пользователя и идентификатор безопасности группы, а также пользователь **sidhistory** и **sidhistory** групп, членом которых является пользователь. Наличие этих прежних идентификаторов SID (**SIDHistory** ) в маркере пользователя предоставляет пользователю доступ к ресурсам, защищенным списками управления доступом (ACL), содержащими бывшие идентификаторы безопасности.

эта операция упрощает некоторые сценарии развертывания Windows 2000. в частности, он поддерживает сценарий, в котором учетные записи в новом лесу Windows 2000 создаются для пользователей и групп, которые уже существуют в рабочей среде Windows NT 4,0. поместив идентификатор безопасности учетной записи Windows NT 4,0 в Windows 2000 учетная запись **sIDHistory**, доступ к сетевым ресурсам будет сохранен для пользователя, который подписывается на новую учетную запись Windows 2000.

[**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) также поддерживает перенос серверов ресурсов резервных контроллеров домена (bdc) Windows NT 4,0 (или контроллеров доменов и рядовых серверов в основном режиме Windows 2000) в домен Windows 2000 в качестве рядовых серверов. для этой миграции требуется создание в домене назначения Windows 2000 локальных групп домена, содержащих в параметре **sIDHistory** основные идентификаторы безопасности локальных групп, определенных в BDC (или локальных группах домена, указанных в списках acl на серверах Windows 2000) в исходном домене. При создании целевой локальной группы, содержащей **SIDHistory** и все члены исходной локальной группы, доступ к перенесенным ресурсам сервера, защищенным списками управления доступом, ссылающимися на исходную локальную группу, сохраняется для всех элементов.

> [!Note]  
> Использование [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) требует понимания его более широкого влияния на администрирование и безопасность в этих и других сценариях. дополнительные сведения см. в техническом документе "планирование миграции с Windows NT в Microsoft Windows 2000", которое доставляется в виде Dommig.doc в средствах поддержки Windows 2000. Эта документация также может быть найдена на компакт-диске продукта в разделе " \\ средства поддержки" \\ .

 

## <a name="authorization-requirements"></a>Требования к авторизации

[**Дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) требуются права администратора в исходном и целевом доменах. В частности, вызывающий этот API должен быть членом группы администраторов домена в конечном домене. Выполняется жестко заданная проверка членства. Кроме того, вызывающая сторона или учетная запись, указанная в параметре *сркдомаинкредс* , если она не **равна null**, должна быть членом группы администраторов или администраторов домена в исходном домене.

## <a name="domain-and-trust-requirements"></a>Требования к домену и доверию

для [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) требуется, чтобы конечный домен был в Windows 2000 в собственном режиме или более поздней версии, так как только этот тип домена поддерживает атрибут **sIDHistory** . исходный домен может быть либо Windows NT 4,0, либо Windows 2000, смешанный или основной режим. Исходный и конечный домены не должны находиться в одном лесу. домены Windows NT 4,0 по определению, а не в лесу. Это ограничение между лесами гарантирует, что дублированные идентификаторы SID, отображаемые как основные значения SID или **SIDHistory** , не будут создаваться в одном лесу.

[**Дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) требует наличия внешнего доверия от исходного домена к целевому домену в случаях, перечисленных в следующей таблице.



| Случай                                                                             | Описание                                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| исходный домен — Windows 2000.<br/>                                    | исходный атрибут **sIDHistory** , доступный только в исходных доменах Windows 2000, может быть прочитан только с помощью LDAP, что требует этого доверия для защиты целостности.<br/>                                                                                             |
| исходный домен — Windows NT 4,0, а *сркдомаинкредс* — **NULL**.<br/> | Олицетворение, необходимое для поддержки операций исходного домена с использованием учетных данных вызывающего объекта, зависит от этого доверия. Для олицетворения также требуется, чтобы конечный контроллер домена был включен по умолчанию "доверенный для делегирования" на контроллерах домена.<br/> |



 

однако нет необходимости в доверии между исходным и конечным доменами, если исходный домен находится Windows NT 4,0, а *сркдомаинкредс* не равен **NULL**.

## <a name="source-domain-controller-requirements"></a>Требования к исходному контроллеру домена

для [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) требуется, чтобы контроллер домена, выбранный в качестве целевого для операций в исходном домене, был PDC в доменах Windows NT 4,0 или pdc Emulator в доменах Windows 2000. аудит исходного домена создается с помощью операций записи, поэтому основной контроллер домена необходим в Windows NT 4,0 исходных доменах, и ограничение только pdc гарантирует, что аудиты **дсаддсидхистори** будут создаваться на одном компьютере. Это уменьшает необходимость просматривать журналы аудита всех контроллеров домена, чтобы отслеживать использование этой операции.

> [!Note]  
> для обеспечения надлежащей поддержки аудита в исходных доменах Windows NT 4,0 (для целевого объекта в исходном домене) должен быть установлен пакет обновления 4 (SP4) и более поздней версии.

 

следующее значение реестра должно быть создано в качестве значения REG \_ DWORD и установлено в 1 на исходном контроллере домена как для Windows NT 4,0, так и для Windows 2000 исходных dc.

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Control
            Lsa
               TcpipClientSupport
```

Установка этого значения включает вызовы RPC через транспорт TCP. Это необходимо, поскольку по умолчанию интерфейсы САМРПК поддерживают удаленное взаимодействие только по именованным каналам. Использование именованных каналов приводит к созданию системы управления учетными данными, которая подходит для интерактивного входа пользователей, выполняющих вызовы в сети, но не является гибким для системного процесса, осуществляющего сетевые вызовы с учетными данными, предоставленными пользователем. Для этой цели лучше подходит RPC через TCP. Установка этого значения не уменьшает безопасность системы. Если это значение — "создано" или "изменено", необходимо перезапустить исходный контроллер домена, чтобы этот параметр вступил в силу.

&lt; &gt; В исходном домене для целей аудита необходимо создать новую локальную группу "сркдомаиннаме $ $ $".

## <a name="auditing"></a>Аудит

[**Дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) операции аудита, чтобы убедиться, что администраторы исходного и конечного домена могут определить, когда была запущена эта функция. Аудит является обязательным в исходном и конечном доменах. **Дсаддсидхистори** проверяет, что режим аудита включен в каждом домене и что аудит управления учетными записями событий успехов и отказов включен. В конечном домене для каждой успешной или неудачной операции **дсаддсидхистори** создается уникальное событие аудита "Добавление журнала идентификаторов безопасности".

уникальные события аудита "добавление журнала Sid" недоступны в системах Windows NT 4,0. Чтобы создать события аудита, однозначно отражающие использование [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) с исходным доменом, он выполняет операции в специальной группе, имя которой является уникальным идентификатором в журнале аудита. Локальная группа " &lt; сркдомаиннаме &gt; $ $ $", имя которой состоит из NetBIOS-имени исходного домена, к которому добавлено три знака доллара ($) (код ASCII = 0X24 и Юникод = U + 0024), должны быть созданы на исходном контроллере домена до вызова **дсаддсидхистори**. Каждый исходный пользователь и Глобальная группа, которые являются целью этой операции, добавляются в, а затем удаляются из членства этой группы. При этом создаются события аудита добавления участников и удаления элементов в исходном домене, которые можно отслеживать, выполняя поиск событий, ссылающихся на имя группы.

> [!Note]  
> не удается выполнить аудит операций [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) с локальными группами в исходном домене Windows NT 4,0 или Windows 2000 в смешанном режиме, так как локальные группы нельзя сделать членами другой локальной группы, поэтому они не могут быть добавлены в специальную &lt; &gt; локальную группу "сркдомаиннаме $ $ $". Отсутствие аудита не представляет проблем безопасности в исходном домене, поскольку эта операция не влияет на доступ к ресурсам исходного домена. Добавление идентификатора безопасности исходной локальной группы в целевую локальную группу не предоставляет другим пользователям доступ к исходным ресурсам, защищенным этой локальной группой. Добавление членов в целевую локальную группу не предоставляет им доступ к исходным ресурсам. Добавленным членам предоставляется доступ только к серверам в конечном домене, перенесенным из исходного домена, который может иметь ресурсы, защищенные идентификатором безопасности исходной локальной группы.

 

## <a name="data-transmission-security"></a>Безопасность передачи данных

[**Дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) применяет следующие меры безопасности:

-   при вызове с рабочей станции Windows 2000 учетные данные вызывающего объекта используются для проверки подлинности и защиты конфиденциальности вызова RPC на целевом контроллере домена. Если *сркдомаинкредс* не равен **null**, то и Рабочая станция, и целевой контроллер домена должны поддерживать 128-разрядное шифрование для защиты учетных данных. Если 128-разрядное шифрование недоступно и предоставлены *сркдомаинкредс* , то вызов необходимо выполнить на ЦЕЛЕВом контроллере домена.
-   Конечный контроллер домена обменивается данными с исходным контроллером домена, используя либо *сркдомаинкредс* , либо учетные данные вызывающей стороны для взаимной проверки подлинности и целостности безопасности учетной записи-источника (с помощью поиска SAM) и **SIDHistory** (с использованием чтения LDAP).

## <a name="threat-models"></a>Модели угроз

В следующей таблице перечислены потенциальные угрозы, связанные с вызовом [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) , и рассматриваются меры безопасности, относящиеся к конкретной угрозе.




| Потенциальная угроза | Мера безопасности | 
|------------------|------------------|
| Мужчина в середине атаки<br /> Неавторизованный пользователь перехватывает <em>идентификатор безопасности поиска</em> в возвращенном вызове исходного объекта, заменяя идентификатор безопасности исходного объекта ПРОИЗВОЛЬНЫм идентификатором SID для вставки в целевой объект SIDhistory.<br /> | <em>Идентификатор безопасности для поиска исходного объекта</em> — это RPC с проверкой подлинности, использующий учетные данные администратора вызывающей стороны с защитой сообщений целостности пакетов. Это гарантирует, что вызов возврата невозможно будет изменить без обнаружения. Конечный контроллер домена создает уникальное событие аудита "Добавление журнала SID", которое отражает идентификатор SID, добавленный в учетную запись <strong>SIDHistory</strong>назначения.<br /> | 
| Троян исходного домена<br /> Неавторизованный пользователь создает исходный домен "троянского коня" в частной сети с тем же идентификатором безопасности домена и теми же идентификаторами безопасности учетной записи, что и у допустимого исходного домена. Затем неавторизованный пользователь пытается запустить <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>дсаддсидхистори</strong></a> в конечном домене для получения идентификатора безопасности исходной учетной записи. Это делается без необходимости в реальных учетных данных администратора исходного домена и не выходит за пределы журнала аудита в реальном исходном домене. Неавторизованный пользователь для создания исходного домена троянского коня может быть одним из следующих:<ul><li>Получение копии (резервное копирование BDC) исходного домена SAM.</li><li>Создайте новый домен, изменив идентификатор SID домена на диске в соответствии с действительным SID исходного домена, а затем создайте достаточное количество пользователей для создания экземпляра учетной записи с нужным идентификатором SID.</li><li>Создайте реплику BDC. Для этого требуются учетные данные администратора исходного домена. Затем неавторизованный пользователь принимает реплику в частной сети для реализации атаки.</li></ul><br /> | Несмотря на то, что неавторизованный пользователь может получить или создать нужный идентификатор безопасности исходного объекта, неавторизованный пользователь не сможет использовать его для обновления <strong>SIDHistory</strong> учетной записи, не являясь членом группы администраторов конечного домена. Поскольку проверка на целевом контроллере домена для членства в администраторе домена жестко запрограммирована, на целевом КОНТРОЛЛЕРе домена нет метода для изменения данных контроля доступа, защищающих эту функцию. В конечном домене выполняется попытка клонирования исходной учетной записи троянского коня. Эта атака уменьшается за счет резервирования членства в группе "Администраторы домена" только для пользователей с высоким уровнем доверия.<br /> | 
| Изменение журнала SID на диске<br /> Сложный неавторизованный пользователь с учетными данными администратора домена и физическим доступом к КОНТРОЛЛЕРу домена в конечном домене может изменить значение <strong>SIDHistory</strong> учетной записи на диске.<br /> | Эта попыток не включается с помощью <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>дсаддсидхистори</strong></a>. Эта атака снижается благодаря предотвращению физического доступа к контроллерам домена ко всем, Кроме администраторов с высоким уровнем доверия.<br /> | 
| Мошеннический код, используемый для снятия защиты<br /> Неавторизованный пользователь или злонамеренный администратор с физическим доступом к коду службы каталогов может создать мошеннический код, который:<ol><li>Удаляет проверку членства в группе администраторов домена в коде.</li><li>Изменяет вызовы на исходном контроллере домена, который указывает SID, на Лукупсидфромнаме, для которого не выполняется аудит.</li><li>Удаляет вызовы журнала аудита.</li></ol><br /> | Пользователь с физическим доступом к коду DS и знания, достаточные для создания мошеннического кода, имеет возможность произвольно изменять атрибут <strong>SIDHistory</strong> учетной записи. API <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>дсаддсидхистори</strong></a> не повышает эту угрозу безопасности.<br /> | 
| Ресурсы, уязвимые для заимствованных идентификаторов безопасности<br /> Если неавторизованный пользователь успешно использовал один из описанных здесь методов для изменения учетной записи <strong>SIDHistory</strong>, и если домены ресурсов, представляющие доверие, имеют несанкционированный домен учетных записей, то несанкционированный пользователь может получить несанкционированный доступ к ресурсам заимствованных SID, потенциально без учета журнала аудита в домене учетной записи, из которого был украден идентификатор безопасности.<br /> | Администраторы домена ресурсов защищают свои ресурсы, настроив только те отношения доверия, которые имеют смысл в перспективе безопасности. Использование <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>дсаддсидхистори</strong></a> ограничено в доверенном целевом домене членами группы администраторов домена, у которых уже есть широкие разрешения в рамках их обязанностей.<br /> | 
| Фальшивый конечный домен<br /> неавторизованный пользователь создает домен Windows 2000 с учетной записью, <strong>sIDHistory</strong> которой содержит идентификатор безопасности, украденный из исходного домена. Неавторизованный пользователь использует эту учетную запись для несанкционированного доступа к ресурсам.<br /> | Неавторизованный пользователь требует учетные данные администратора для исходного домена, чтобы использовать <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>дсаддсидхистори</strong></a>, и оставляет журнал аудита на исходном контроллере домена. Фальшивый конечный домен получает несанкционированный доступ только в других доменах, которые доверяют фальшивому домену, что требует прав администратора в этих доменах ресурсов.<br /> | 




 

## <a name="operational-constraints"></a>Операционные ограничения

В этом разделе описываются эксплуатационные ограничения использования функции [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) .

Идентификатор безопасности *сркпринЦипал* не должен существовать в целевом лесу как идентификатор безопасности первичной учетной записи или в **SIDHistory** учетной записи. Исключением является то, что [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) не создает ошибку при попытке добавить идентификатор безопасности в **SIDHistory** , который содержит идентичный идентификатор безопасности. Такое поведение позволяет запускать **дсаддсидхистори** несколько раз с идентичными входными данными, что приводит к успешному завершению и противоречивому состоянию, для простоты использования разработчиком инструментов.

> [!Note]  
> Задержка репликации глобального каталога может предоставить окно, в течение которого могут быть созданы дублирующиеся идентификаторы SID. Однако администратор может легко удалить дублирующиеся идентификаторы SID.

 

*СркпринЦипал* и *дстпринЦипал* должны иметь один из следующих типов:

-   Пользователь
-   Группа с включенной безопасностью, включая:

    <dl> Локальная группа  
    Глобальная группа  
    локальная группа домена (только для Windows 2000 в основном режиме)  
    универсальная группа (только Windows 2000 в основном режиме)  
    </dl>

Типы объектов *сркпринЦипал* и *дстпринЦипал* должны совпадать.

-   Если *сркпринЦипал* является пользователем, *ДстпринЦипал* должен быть пользователем.
-   Если *сркпринЦипал* является локальной или локальной группой домена, *ДстпринЦипал* должен быть локальной группой домена.
-   Если *сркпринЦипал* является глобальной или универсальной группой, *ДстпринЦипал* должен быть глобальной или универсальной группой.

*СркпринЦипал* и *дстпринЦипал* не могут быть одного из следующих типов: (в этих случаях [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) завершается с ошибкой)

-   Компьютер (Рабочая станция или контроллер домена)
-   Доверительные отношения между доменами
-   Временная повторяющаяся учетная запись (виртуальная неиспользуемая функция, устаревшая версия LANman)
-   Учетные записи с хорошо известными идентификаторами безопасности. Хорошо известные идентификаторы безопасности идентичны в каждом домене; таким образом, добавление их в **sIDHistory** нарушает требования уникальности SID для леса Windows 2000. Учетные записи с хорошо известными идентификаторами безопасности включают следующие локальные группы:

    <dl> Операторы учетных записей  
    Администраторы  
    Операторы резервного копирования  
    Гости  
    Операторы печати  
    Репликатор  
    Операторы сервера  
    Пользователи  
    </dl>

Если *сркпринЦипал* имеет хорошо известный относительный идентификатор (RID) и префикс, соответствующий домену, то есть администраторы домена, пользователи домена и компьютеры домена, то *дстпринЦипал* должен обладать тем же известным RID, чтобы [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) успешно. Учетные записи с хорошо известными идентификаторами RID включают следующие пользователи и глобальные группы:

-   Администратор
-   Гость
-   Администраторы домена
-   Гости домена
-   пользователи домена;

## <a name="setting-the-registry-value"></a>Установка значения реестра

В следующей процедуре показано, как задать значение реестра Ткпипклиентсуппорт.

**Установка значения реестра Ткпипклиентсуппорт**

1.  Создайте следующий параметр реестра в качестве значения REG \_ DWORD на исходном контроллере домена и присвойте ему значение 1.

    **HKEY \_ локальный \_ компьютер \\ система \\ CurrentControlSet \\ Управление \\ LSA \\ ткпипклиентсуппорт**

2.  Затем перезапустите исходный контроллер домена. Это значение реестра заставляет SAM прослушивать TCP/IP. [**Дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) завершится ошибкой, если это значение не задано на исходном контроллере домена.

## <a name="enabling-auditing-of-usergroup-management-events"></a>Включение аудита событий управления пользователями и группами

в следующей процедуре показано, как включить аудит событий управления пользователями и группами в Windows 2000 или Windows Server 2003 в исходном или конечном домене.

**включение аудита событий управления пользователями и группами в исходном или целевом домене Windows 2000 или Windows Server 2003**

1.  В оснастке MMC Active Directory пользователи и компьютеры выберите контейнер Контроллеры домена назначения.
2.  Щелкните правой кнопкой мыши элемент **контроллеры домена** и выберите пункт **свойства**.
3.  Перейдите на вкладку **Групповая политика** .
4.  Выберите **политику контроллеров домена по умолчанию** и нажмите кнопку **изменить**.
5.  в разделе **конфигурация компьютера \\ Windows Параметры \\ безопасность Параметры \\ \\ политика аудита локальные политики** дважды щелкните **аудит управления учетными записями**.
6.  В окне **Аудит управления учетной записью** выберите аудит **успехов** и **сбоев** . Обновления политики вступают в силу после перезапуска или после обновления.
7.  Убедитесь, что аудит включен, просмотрев действующую политику аудита в оснастке групповая политика MMC.

в следующей процедуре показано, как включить аудит событий управления пользователями и группами в домене Windows NT 4,0.

**включение аудита событий управления пользователями и группами в домене Windows NT 4,0**

1.  В **диспетчере пользователей для доменов** откройте меню **политики** и выберите пункт **Аудит**.
2.  Выберите **аудит этих событий**.
3.  Для **управления пользователями и группами** проверьте **успешность и сбой**.

в следующей процедуре показано, как включить аудит событий управления пользователями и группами в Windows NT 4,0, Windows 2000 или Windows Server 2003 source domain.

**включение аудита событий управления пользователями и группами в домене Windows NT 4,0, Windows 2000 или Windows Server 2003 исходный домен**

1.  В **диспетчере пользователей для доменов** щелкните меню **пользователь** и выберите **создать локальную группу**.
2.  Введите имя группы, состоящее из NetBIOS-имени исходного домена, к которому добавлено три знака доллара ($), например FABRIKAM $ $ $. В поле Описание должно быть указано, что эта группа используется для аудита использования [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) или клонирования операций. Убедитесь, что в группе нет элементов. Нажмите кнопку **ОК**.

Операция [**дсаддсидхистори**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) завершается ошибкой, если аудит источника и назначения не включен, как описано здесь.

## <a name="set-up-trust-if-required"></a>Настройка доверия при необходимости

Если одно из следующих условий истинно, необходимо установить отношение доверия между исходным доменом и конечным доменом (это должно происходить в другом лесу):

-   исходный домен — Windows Server 2003.
-   исходный домен — Windows NT 4,0, а *сркдомаинкредс* — **NULL**.

 

 





