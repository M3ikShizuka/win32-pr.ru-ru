---
title: Установка прав доступа для объекта
description: В этом разделе описывается, как создать запись ACE для права доступа и задать эту запись ACE в списке DACL объекта.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Установка прав доступа для объекта AD
- Объекты Active Directory, установка прав доступа для объекта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 36ca2c26e3e242656a1ae0471fe9ccd22fa132a8
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122881208"
---
# <a name="setting-access-rights-on-an-object"></a>Установка прав доступа для объекта

При использовании объектов ADSI COM [**иадссекуритидескриптор**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (дескриптор безопасности), [**иадсакцессконтроллист**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACL и SACL) и [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) для добавления элемента ACE в список ACL вы вносите изменения в свойство **нтсекуритидескриптор** указанного объекта в кэше свойств. Это означает, что для записи обновленного дескриптора безопасности в каталог из кэша свойств необходимо вызвать методы добавления для объектов, содержащих новый элемент ACE, и метод [**iAds. сетинфо**](/windows/desktop/api/iads/nf-iads-iads-setinfo) .

Дополнительные сведения и пример кода, который задает запись ACE для объекта в домен Active Directory Services, см. в разделе [пример кода для настройки записи ACE в объекте каталога](example-code-for-setting-an-ace-on-a-directory-object.md).

Используйте следующий общий процесс, чтобы создать ACE для права доступа и задать этот элемент управления доступом в списке DACL объекта.

1.  Получите указатель интерфейса [**iAds**](/windows/desktop/api/iads/nn-iads-iads) для объекта.
2.  Используйте метод [**iAds. Get**](/windows/desktop/api/iads/nf-iads-iads-get) для получения дескриптора безопасности объекта. Имя свойства, содержащего дескриптор безопасности, — **нтсекуритидескриптор**. Свойство будет возвращено как [**значение типа Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) , содержащее указатель [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (элемент **VT** является отправкой **VT \_**). Вызовите **QueryInterface** на этом указателе **IDispatch** , чтобы получить интерфейс [**иадссекуритидескриптор**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) для использования методов этого интерфейса для доступа к ACL дескриптора безопасности.
3.  Чтобы получить список DACL, используйте свойство [**иадссекуритидескриптор. дискретионарякл**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) . Метод возвращает указатель [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Вызовите метод **QueryInterface** для этого указателя **IDispatch** , чтобы получить интерфейс [**иадсакцессконтроллист**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) , чтобы использовать методы этого интерфейса для доступа к отдельным записям ACE в списке управления доступом.
4.  Используйте [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) для создания com-объекта ADSI для нового элемента ACE и получения указателя интерфейса [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) на этот объект. Имейте в виду, что ИДЕНТИФИКАТОРом класса является CLSID \_ акцессконтролентри.
5.  Задайте свойства элемента управления доступом с помощью методов [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) :

    1.  Используйте [**иадсакцессконтролентри::p UT \_**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы задать доверенное лицо, к которому применяется ACE. Доверенное лицо — это пользователь, группа или другой субъект безопасности. Приложение должно использовать значение из соответствующего свойства из объекта пользователя или группы доверенного лица, к которому требуется применить ACE. Доверенное лицо указывается как **BSTR** и может принимать следующие формы:
        -   учетная запись домена (имя входа, используемое в предыдущей версии Windows NT) в формате " &lt; домен &gt; \\ <user account> ", где " &lt; домен &gt; " — имя домена Windows NT, содержащего пользователя, а " &lt; учетная запись пользователя &gt; " — свойство **sAMAccountName** указанного пользователя. Например: "Fabrikam \\ жеффсмис".
        -   хорошо известный субъект безопасности, представляющий специальные удостоверения, определенные системой безопасности Windows NT, например все, локальная система, участник self, прошедший проверку подлинности пользователь, владелец-создатель и т. д. Объекты, представляющие хорошо известные субъекты безопасности, хранятся в контейнере "известные субъекты безопасности" под контейнером конфигурации. Например, анонимный вход в систему.
        -   встроенная группа, представляющая встроенные группы пользователей, определенные системой безопасности Windows NT. Он имеет форму «Builtin», \\ <group name> где « &lt; имя группы &gt; » — это имя встроенной группы пользователей. Объекты, представляющие встроенные группы, хранятся в контейнере Builtin под контейнером домена. Например, «Builtin \\ Администраторы».
        -   Идентификатор безопасности (формат строки) указанного пользователя, который является свойством **objectSid** указанного пользователя. Преобразовать в форму строки можно с помощью функции [**функция ConvertSidToStringSid вернула**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) в API безопасности Win32. Например: "S-1-5-32-548".
    2.  Используйте свойство [**иадсакцессконтролентри. AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы задать маску, определяющую право доступа. Перечисление [**прав на рекламу \_ \_**](/windows/win32/api/iads/ne-iads-ads_rights_enum) определяет права доступа, которые можно задать для объекта каталога.
    3.  Используйте свойство [**иадсакцессконтролентри. AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы указать, следует ли разрешать или запрещать права доступа, установленные **AccessMask**. Для стандартных прав это может быть **AD \_ ACETYPE \_ Access \_ Allowed** или **AD \_ ACETYPE \_ Access \_ Denied**. Для зависящих от объекта прав (прав, которые применяются к определенной части объекта или к конкретному типу объекта) используйте **ADS \_ ACETYPE \_ доступ к \_ \_** объекту или **ADS \_ ACETYPE \_ доступ к \_ \_ объекту**. Перечисление [**ADS \_ ACETYPE \_ enum**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) указывает типы доступа, которые можно задать для элемента управления доступом.
    4.  Используйте свойство [**иадсакцессконтролентри. AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы указать, могут ли другие контейнеры или объекты, расположенные ниже указанного объекта, наследовать элемент управления доступом. Перечисление [**ADS \_ ацефлаг \_ enum**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) указывает флаги наследования, которые можно задать для элемента управления доступом.
    5.  Используйте свойство [**иадсакцессконтролентри. flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы указать, применяется ли право к определенной части объекта, типу наследуемого объекта или к обоим.
    6.  Если параметр **flags** имеет **значение \_ \_ тип объекта \_ \_ флага ADS**, установите свойство [**иадсакцессконтролентри. ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) o Укажите строку, содержащую идентификатор GUID класса объекта (для **ADS \_ справа \_ DS \_ Создание \_ дочернего** элемента **DS или ADS \_ право \_ доменного \_ удаления \_**), свойства, набора свойств, проверенной записи или расширенного права, к которому применяется ACE. Идентификатор GUID должен быть указан в виде строки формы, созданной функцией [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) в библиотеке COM.
    7.  Если для **флагов** установлено значение флага **ADS, \_ \_ унаследованный \_ \_ тип объекта \_**, установите свойство [**иадсакцессконтролентри. инхеритедобжекттипе**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) , чтобы указать строку, содержащую идентификатор GUID наследуемого класса объекта, к которому применяется ACE. Идентификатор GUID должен быть указан в виде строки формы, созданной функцией [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) в библиотеке COM.

6.  Используйте метод **QueryInterface** объекта [**иадсакцессконтролентри**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) для получения указателя [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Для метода [**иадсакцессконтроллист. аддаце**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) требуется указатель интерфейса **IDispatch** на элемент управления доступом.
7.  Используйте [**иадсакцессконтроллист. аддаце**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) , чтобы добавить новый элемент управления доступом в список DACL. Имейте в виду, что порядок элементов ACE в списке ACL может повлиять на оценку доступа к объекту. Для правильного доступа к объекту может потребоваться создать новый список ACL, добавить записи ACE из существующего списка ACL в правильном порядке в новый список управления доступом, а затем заменить существующий список ACL в дескрипторе безопасности новым ACL. Дополнительные сведения см. [в разделе порядок элементов ACE в списке DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Используйте свойство [**иадссекуритидескриптор. дискретионарякл**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) для записи списка DACL, содержащего новый элемент ACE, в дескриптор безопасности. Дополнительные сведения о списках DACL см. в разделе пустые [списки DACL и пустой список DACL](null-dacls-and-empty-dacls.md).
9.  Используйте метод [**iAds. помещаем**](/windows/desktop/api/iads/nf-iads-iads-put) для записи дескриптора безопасности в свойство **нтсекуритидескриптор** объекта в кэш свойств.
10. Используйте метод [**iAds. сетинфо**](/windows/desktop/api/iads/nf-iads-iads-setinfo) для обновления свойства объекта в каталоге.

 

 
