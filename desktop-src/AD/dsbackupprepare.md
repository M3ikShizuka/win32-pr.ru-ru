---
title: Функция Дсбаккуппрепаре (Нтдсбкли. h)
description: Подготавливает каталог на указанном сервере для оперативной архивации и возвращает описатель контекста резервного копирования, используемый при последующих вызовах других функций резервного копирования.
ms.assetid: 18c6dbcf-b707-4674-9af5-40f2178e6d2b
ms.tgt_platform: multiple
keywords:
- Active Directory функции Дсбаккуппрепаре
topic_type:
- apiref
api_name:
- DsBackupPrepare
- DsBackupPrepareA
- DsBackupPrepareW
api_location:
- Ntdsbcli.dll
api_type:
- DllExport
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: fa561a7e41164ece68fb18fd882a8b05d6357cec
ms.sourcegitcommit: a1494c819bc5200050696e66057f1020f5b142cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2020
ms.locfileid: "104491025"
---
# <a name="dsbackupprepare-function"></a>Функция Дсбаккуппрепаре

\[Эта функция доступна для использования в операционных системах, указанных в разделе требования. В последующих версиях он может быть изменен или недоступен. Начиная с Windows Vista, вместо нее следует использовать [Служба теневого копирования томов (VSS)](../vss/volume-shadow-copy-service-overview.md) .\]

Функция **дсбаккуппрепаре** подготавливает каталог на указанном сервере для оперативной архивации и возвращает описатель контекста резервного копирования, используемый в последующих вызовах других функций резервного копирования.

## <a name="syntax"></a>Синтаксис


```C++
HRESULT DsBackupPrepare(
  _In_  LPCTSTR szBackupServer,
  _In_  ULONG   grbit,
  _In_  ULONG   btBackupType,
  _Out_ PVOID   *ppvExpiryToken,
  _Out_ LPDWORD pcbExpiryTokenSize,
  _Out_ HBC     *phbc
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*сзбаккупсервер* \[ окне\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая содержит имя сервера для резервного копирования. Предыдущие обратные косые черты необязательны. Сервер должен быть тем же компьютером, из которого вызывается эта функция. Имя сервера не может содержать символ подчеркивания ( \_ ). Пример имени сервера — \\ \\ Server1.

</dd> <dt>

*грбит* \[ окне\]
</dt> <dd>

Определяет, будут ли создаваться резервные копии файлов журнала. Это значение всегда должно быть равно 0, так как добавочные резервные копии не поддерживаются.

</dd> <dt>

*бтбаккуптипе* \[ окне\]
</dt> <dd>

Указывает тип резервной копии. Это может быть одно из следующих значений.

<dt>

<span id="BACKUP_TYPE_FULL"></span><span id="backup_type_full"></span>

<span id="BACKUP_TYPE_FULL"></span><span id="backup_type_full"></span>**Тип РЕЗЕРВной копии \_ \_ полон**


</dt> <dd>

Указывает полное резервное копирование. Выполняется резервное копирование всего каталога (DIT, файлов журнала и файлов обновления). Все данные архивируются, а файлы журнала транзакций усекаются. Поддерживаются только полные резервные копии.

</dd> <dt>

<span id="BACKUP_TYPE_LOGS_ONLY"></span><span id="backup_type_logs_only"></span>

<span id="BACKUP_TYPE_LOGS_ONLY"></span><span id="backup_type_logs_only"></span>**\_ \_ только журналы типа резервного копирования \_**


</dt> <dd>

Это значение не поддерживается. Указывает, что будет создана резервная копия только журналов базы данных, а не самой базы данных. Обычно это используется при выполнении разностного или добавочного резервного копирования.

</dd> <dt>

<span id="BACKUP_TYPE_INCREMENTAL"></span><span id="backup_type_incremental"></span>

<span id="BACKUP_TYPE_INCREMENTAL"></span><span id="backup_type_incremental"></span>**\_добавочный тип резервного копирования \_**


</dt> <dd>

Это значение не поддерживается. **Дсбаккуппрепаре** возвращает **ошибку " \_ Недопустимый \_ параметр**".

</dd> </dl> </dd> <dt>

*ппвекспиритокен* \[ заполняет\]
</dt> <dd>

Указатель на значение **PVOID** , которое получает указатель на маркер окончания срока действия, связанный с этой резервной копией. *пкбекспиритокенсизе* получает размер этих данных в байтах. Вызывающий объект должен сохранить содержимое этого маркера с резервной копией, так как при попытке восстановить данные маркер должен быть передан в [**дсресторепрепаре**](dsrestoreprepare.md) . После того как токен сохранен и больше не требуется, вызывающий объект должен освободить выделенную память с помощью [**дсбаккупфри**](dsbackupfree.md).

</dd> <dt>

*пкбекспиритокенсизе* \[ заполняет\]
</dt> <dd>

Указатель на значение **DWORD** , которое получает размер маркера (в байтах) в *ппвекспиритокен*.

</dd> <dt>

*ФБК* \[ заполняет\]
</dt> <dd>

Указатель на значение **ХБК** , которое получает маркер для резервной копии. Этот маркер используется при вызове других функций резервного копирования службы каталогов, таких как [**дсбаккупопенфиле**](dsbackupopenfile.md) и [**дсбаккупенд**](dsbackupend.md).

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Возвращает **значение \_ ОК** , если функция выполнена успешно, или в противном случае — код ошибки. В следующем списке перечислены другие возможные коды ошибок.

<dl> <dt>

**Ошибка \_ отказа в доступе \_**
</dt> <dd>

Вызывающий объект не имеет необходимых прав доступа для вызова этой функции. Функцию [**дссетаусидентити**](dssetauthidentity.md) можно использовать для задания учетных данных, используемых для функций резервного копирования и восстановления.

</dd> <dt>

**Ошибка \_ недопустимого \_ параметра**
</dt> <dd>

недопустимые *сзбаккупсервер* или *фбкбаккупконтекст* .

</dd> <dt>

**Ошибка \_ не \_ хватает \_ памяти**
</dt> <dd>

Ошибка при выделении памяти.

</dd> <dt>

**хркаулднотконнект**
</dt> <dd>

Не удалось найти сервер в *сзбаккупсервер* , не является контроллером домена, или *сзбаккупсервер* имеет неправильный формат. Это значение определено в нтдсбмсг. h.

</dd> <dt>

**хринвалидпарам**
</dt> <dd>

*ппвекспиритокен* и (или) *пкбекспиритокенсизе* являются недопустимыми. Это значение определено в Нтдсбмсг. h.

</dd> <dt>

**\_ \_ Недопустимая привязка RPC S \_**
</dt> <dd>

Функция вызывается удаленно, или сервер в *сзсервернаме* не является контроллером домена.

</dd> </dl>

## <a name="remarks"></a>Комментарии

Эта функция требует наличия у вызывающего пользователя привилегий **SE \_ BACKUP \_ Name** . Функцию [**дссетаусидентити**](dssetauthidentity.md) можно использовать для изменения контекста безопасности, в котором вызывается эта функция.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Header<br/>                   | <dl> <dt>Нтдсбкли. h</dt> </dl>   |
| Библиотека<br/>                  | <dl> <dt>Нтдсбкли. lib</dt> </dl> |
| DLL<br/>                      | <dl> <dt>Ntdsbcli.dll</dt> </dl> |
| Имя в кодировке Юникод и ANSI<br/>   | **Дсбаккуппрепарев** (Юникод) и **дсбаккуппрепареа** (ANSI)<br/>               |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**дсресторепрепаре**](dsrestoreprepare.md)
</dt> <dt>

[**дсбаккупфри**](dsbackupfree.md)
</dt> <dt>

[**дсбаккупопенфиле**](dsbackupopenfile.md)
</dt> <dt>

[**дсбаккупенд**](dsbackupend.md)
</dt> <dt>

[**дссетаусидентити**](dssetauthidentity.md)
</dt> <dt>

[Резервное копирование сервера Active Directory](backing-up-an-active-directory-server.md)
</dt> <dt>

[Функции резервного копирования каталога](directory-backup-functions.md)
</dt> </dl>

 

