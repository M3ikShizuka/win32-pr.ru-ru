---
title: Регистрация COM-объекта контекстного меню в спецификаторе экрана
description: В этом разделе показаны разделы реестра, которые необходимо изменить для регистрации COM-объекта контекстного меню.
ms.assetid: 389bc249-4849-4763-9d1b-b35598a51050
ms.tgt_platform: multiple
keywords:
- Регистрация COM-объекта контекстного меню в спецификаторе экрана
- контекстное меню COM-объект Active Directory, регистрация
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 62ae30c1a60a1a0bc5a8ec388a3578ab13829c95
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069751"
---
# <a name="registering-the-context-menu-com-object-in-a-display-specifier"></a>Регистрация COM-объекта контекстного меню в спецификаторе экрана

При использовании COM для создания библиотеки DLL расширения контекстного меню для службы Active Directory Directory, расширение должно быть зарегистрировано в реестре Windows и домен Active Directory служб, чтобы уведомить Active Directory административные оснастки MMC и оболочку Windows расширения.

## <a name="registering-in-the-windows-registry"></a>Регистрация в реестре Windows

Как и все серверы COM, расширение контекстного меню должно быть зарегистрировано в реестре. Расширение регистрируется в следующем разделе.

```
HKEY_CLASSES_ROOT
   CLSID
      <clsid>
```

*<clsid>* Строковое представление идентификатора CLSID, созданное функцией [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) . В *<clsid>* ключе имеется ключ **InprocServer32** , который идентифицирует объект как 32-разрядный сервер in-proc. В ключе **InprocServer32** расположение библиотеки DLL указывается в значении по умолчанию, а модель потоков указывается в значении **ThreadingModel** . Все расширения контекстного меню должны использовать потоковую модель "апартамента".

## <a name="registering-with-active-directory-domain-services"></a>Регистрация в домен Active Directory Services

Регистрация расширения контекстного меню зависит от одного языкового стандарта. Если расширение контекстного меню применяется ко всем языкам, оно должно быть зарегистрировано в объекте [**дисплайспеЦифиер**](/windows/desktop/ADSchema/c-displayspecifier) класса объекта во всех вложенных компонентах языкового стандарта в контейнере описатели вывода. Если расширение контекстного меню локализовано для определенного языкового стандарта, оно должно быть зарегистрировано в объекте **дисплайспеЦифиер** в подконтейнере этого языкового стандарта. Дополнительные сведения о контейнерах и языковых стандартах для описателей вывода см. в разделе [описатели](display-specifiers.md) и [контейнеры дисплайспеЦифиерс](displayspecifiers-container.md).

Существует два атрибута спецификаторов вывода, которые могут быть зарегистрированы в элементе расширения контекстного меню. Это [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) и [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu).

Атрибут [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) определяет административные контекстные меню, отображаемые в Active Directory административных оснастках. Контекстное меню появляется, когда пользователь отображает контекстное меню для объектов соответствующего класса в одной из оснасток Active Directory администрирования MMC.

Атрибут [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu) определяет контекстные меню конечных пользователей, отображаемых в оболочке Windows. Контекстное меню появляется, когда пользователь просматривает контекстное меню для объектов соответствующего класса в проводнике Windows. Начиная с Windows Server 2003, оболочка Windows больше не отображает объекты служб домен Active Directory.

Все эти атрибуты являются многозначными.

При регистрации расширения контекстного меню значения для атрибутов [**админконтекстмену**](/windows/desktop/ADSchema/a-admincontextmenu) и [**шеллконтекстмену**](/windows/desktop/ADSchema/a-shellcontextmenu) должны иметь следующий формат.


```C++
<order number>,<clsid>
```



&lt;Порядковый номер &gt; — это число без знака, представляющее позицию элемента в контекстном меню. При отображении контекстного меню значения сортируются с помощью сравнения "номер заказа" каждого значения &lt; &gt; . Если несколько значений имеют одинаковый &lt; порядковый номер, то &gt; расширения контекстного меню загружаются в том порядке, в котором они считываются с Active Directory сервера. Если возможно, используйте несуществующий " &lt; номер заказа &gt; ", то есть тот, который не использовался другими значениями в свойстве. В &lt; последовательности "номер заказа" не допускаются предписанные начальные положения и пробелы &gt; .

" &lt; CLSID &gt; " — это строковое представление идентификатора CLSID, созданное функцией [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid) .

В оболочке Windows поддерживаются элементы контекстного меню с множественным выбором. В этом случае для каждого выбранного объекта вызывается расширение контекстного меню. В Active Directory административные оснастки поддерживаются также элементы расширения контекстного меню с множественным выбором. В этом случае структура [**дсобжектнамес**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) будет содержать структуру [**дсобжект**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) для каждого выбранного объекта каталога.

> [!IMPORTANT]
> Для оболочки Windows сведения о спецификаторе экрана извлекаются при входе пользователя в систему и кэшируются для сеанса пользователя. Для административных оснасток данные описателя просмотра извлекаются при загрузке оснастки и кэшируются в течение этого процесса. Для оболочки Windows это означает, что изменения описателей экрана вступают в силу после выхода пользователя из системы и обратного входа. Для административных оснасток изменения вступают в силу при перезагрузке оснастки или файла консоли, то есть при запуске нового экземпляра файла консоли или нового экземпляра Mmc.exe и добавлении оснастки извлекаются последние данные описателя вывода.

 

Дополнительные сведения и пример кода реализации расширения контекстного меню см. в разделе [пример кода для реализации COM-объекта контекстного меню](example-code-for-implementation-of-the-context-menu-com-object.md).

 

 