---
title: Уведомления об изменениях в службах домен Active Directory Services
description: Домен Active Directory Services предоставляют механизм, с помощью которого клиентское приложение регистрируется на контроллере домена для получения уведомлений об изменениях.
ms.assetid: 27f6c7c1-b32e-457a-9be5-47836d097ab1
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee564727cfbcb2bfdb367f822fdc137bca7c4e37
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "104069814"
---
# <a name="change-notifications-in-active-directory-domain-services"></a>Уведомления об изменениях в службах домен Active Directory Services

Домен Active Directory Services предоставляют механизм, с помощью которого клиентское приложение регистрируется на контроллере домена для получения уведомлений об изменениях. Для этого клиент указывает управление уведомлением об изменениях LDAP в асинхронной операции поиска LDAP. Клиент также задает следующие параметры поиска.



| Параметр             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Область<br/>      | Укажите **\_ \_ базу области LDAP** для отслеживания только объекта или **\_ области LDAP \_ одноуровневой** , чтобы отслеживать непосредственные дочерние элементы объекта, не включая сам объект. Не указывайте **\_ \_ поддерево области LDAP**. Хотя область поддерева поддерживается, если базовый объект является корнем контекста именования, его использование может существенно повлиять на производительность сервера, так как при каждом изменении объекта в контексте именования создается сообщение с результатами поиска LDAP. Нельзя указать **\_ \_ поддерево области LDAP** для произвольного поддерева.<br/> |
| Фильтр<br/>     | Укажите фильтр поиска "(objectClass = \* )", что означает получение уведомлений об изменениях любого объекта в указанной области.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                |
| Атрибуты<br/> | Укажите список атрибутов, возвращаемых при возникновении изменений. Имейте в виду, что вы получаете уведомления об изменении любого атрибута, а не только об указанных атрибутах.<br/>                                                                                                                                                                                                                                                                                                                                                                               |



 

Можно зарегистрировать до пяти запросов на уведомление по одному LDAP-соединению. Необходимо иметь выделенный поток, который ожидает уведомлений и быстро обрабатывает их. При вызове \_ функции поиска LDAP \_ для регистрации запроса на уведомление функция возвращает идентификатор сообщения, определяющий этот запрос. Затем используйте функцию [**\_ результат LDAP**](/previous-versions/windows/desktop/api/winldap/nf-winldap-ldap_result) для ожидания уведомлений об изменениях. Когда происходит изменение, сервер отправляет сообщение LDAP, содержащее идентификатор сообщения для запроса уведомления, создавшего уведомление. Это приводит к возврату **\_ результирующей функции LDAP** с результатами поиска, которые обозначают измененный объект.

Клиентское приложение должно определить начальное состояние наблюдаемого объекта. Для этого необходимо сначала зарегистрировать запрос на уведомление, а затем прочитать текущее состояние.

Клиентское приложение также должно определить причину изменения. При поиске на базовом уровне уведомление возникает при изменении любого атрибута или при удалении или перемещении объекта. Для одноуровневого поиска уведомление происходит при создании, удалении, перемещении или изменении дочернего объекта. Имейте в виду, что перемещение или переименование объекта в иерархии выше целевого объекта не создает уведомление, даже если различающееся имя объекта изменилось в результате. Например, при наблюдении за изменениями дочерних объектов в контейнере уведомления не будут получаться, если контейнер перемещается или переименовывается.

Когда клиент обрабатывает результаты поиска, он может использовать \_ функцию LDAP Get DN, \_ чтобы получить различающееся имя измененного объекта. Не полагайтесь на различающиеся имена, чтобы определить, какие объекты отслеживание, так как различающиеся имена могут измениться. Вместо этого включите атрибут **objectGUID** в список извлекаемых атрибутов. **ObjectGUID** каждого объекта остается неизменным независимо от места перемещения объекта в корпоративном лесу.

Если объект в области поиска удаляется, клиент получает уведомление об изменении, а атрибут **IsDeleted** объекта — **значение true**. В этом случае результаты поиска сообщают о новом различающемся имени объекта в контейнере удаленные объекты его секции. Нет необходимости указывать элемент управления "захоронение" ([LDAP \_ Server \_ Показывать \_ Удаленный \_ OID](/previous-versions/windows/desktop/ldap/ldap-server-show-deleted-oid)) для получения уведомлений об удалении объектов. Дополнительные сведения см. в разделе [получение удаленных объектов](retrieving-deleted-objects.md).

Когда клиент зарегистрировал запрос на уведомление, клиент продолжит получать уведомления до тех пор, пока соединение не будет разорвано или клиент не прекратит поиск, вызвав функцию LDAP No \_ . Если клиент или сервер отключается, например, при сбое сервера запрос уведомления прерывается. Когда клиент повторно подключится, он должен снова зарегистрироваться для получения уведомлений, а затем прочитать текущее состояние интересующих объектов, если во время отключения клиента были внесены изменения.

Клиент может использовать значение атрибута **uSNChanged** объекта, чтобы определить, отражает ли текущее состояние объекта на сервере последние изменения, полученные клиентом. Система увеличивает атрибут **uSNChanged** объекта при перемещении или изменении объекта. Например, если сервер завершается с ошибкой и раздел каталога восстанавливается из резервной копии, то реплика сервера объекта может не отражать ранее отправленные на клиент изменения, в этом случае значение **uSNChanged** на сервере будет меньше значения, хранящегося в клиенте.

Дополнительные сведения и пример кода, в котором используется элемент управления уведомлениями об изменениях LDAP в асинхронной операции поиска LDAP, см. в разделе [пример кода для получения уведомлений об изменениях](example-code-for-receiving-change-notifications.md).

Дополнительные сведения о том, когда следует использовать управление уведомлениями об изменениях LDAP, см. в разделе [Общие сведения о методах отслеживание изменений](overview-of-change-tracking-techniques.md).

 

