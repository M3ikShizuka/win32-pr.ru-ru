---
description: На следующей странице представлена базовая структура основных различий между Direct3D 9 и Direct3D 10. В приведенной ниже структуре содержится ряд ценных сведений, помогающих разработчикам с поддержкой Direct3D 9 исследовать и связываться с Direct3D 10.
ms.assetid: 283b54e0-94cb-47a8-8cfc-5798e0538b9f
title: Рекомендации по Direct3D 9 к Direct3D 10 (Direct3D 10)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9e6c2dac7da24184bb5cc6a78f8e7d391c7d0f8b7000107915ba5a606188dcf4
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120120014"
---
# <a name="direct3d-9-to-direct3d-10-considerations-direct3d-10"></a>Рекомендации по Direct3D 9 к Direct3D 10 (Direct3D 10)

На следующей странице представлена базовая структура основных различий между Direct3D 9 и Direct3D 10. В приведенной ниже структуре содержится ряд ценных сведений, помогающих разработчикам с поддержкой Direct3D 9 исследовать и связываться с Direct3D 10.

Несмотря на то, что сведения в этом разделе сравнивают Direct3D 9 с Direct3D 10, поскольку Direct3D 11 построен на улучшениях Direct3D 10 и 10,1, эти сведения также необходимы для миграции с Direct3D 9 на Direct3D 11. Сведения о переходе с Direct3D 10 на Direct3D 11 см. [в разделе Переход на Direct3D 11](../direct3d11/d3d11-programming-guide-migrating.md).

-   [Обзор основных структурных изменений в Direct3D 10](#overview-of-the-major-structural-changes-in-direct3d-10)
    -   [Удаление функции FIXED](#removal-of-fixed-function)
    -   [Проверка времени создания объекта устройства](#device-object-creation-time-validation)
-   [Абстракции и разделение модулей](/windows)
    -   [Прямое удаление зависимостей Direct3D 9](#direct-removal-of-direct3d-9-dependencies)
-   [Рекомендации по быстрому решению проблем сборки приложений](#tricks-for-quickly-resolving-application-build-issues)
    -   [Переопределение типов Direct3D 9](#overriding-direct3d-9-types)
    -   [Устранение проблем с ссылками](#resolving-link-issues)
    -   [Имитация заглавных устройств](#simulating-device-caps)
-   [Управление API Direct3D 10](#driving-the-direct3d-10-api)
    -   [Создание ресурсов](#resource-creation)
    -   [Представления](#views)
    -   [Статический и динамический доступ к ресурсам](#static-versus-dynamic-resource-access)
    -   [Эффекты Direct3D 10](#direct3d-10-effects)
    -   [HLSL без эффектов](#hlsl-without-effects)
    -   [Компиляция шейдера](#shader-compilation)
    -   [Создание ресурсов шейдера](#creation-of-shader-resources)
    -   [Интерфейс слоя отражения шейдеров](#shader-reflection-layer-interface)
    -   [Макеты входного ассемблера — компоновка вершинного шейдера и входного потока](/windows)
    -   [Влияние удаления неработающего кода шейдера](#impact-of-shader-dead-code-removal)
    -   [Пример входной структуры шейдера вершин](#vertex-shader-input-structure-example)
    -   [Создание объекта состояния](#state-object-creation)
-   [Перенос текстур](#porting-textures)
    -   [Поддерживаемые форматы файлов](#file-formats-supported)
    -   [Сопоставление форматов текстур](#mapping-texture-formats)
-   [Перенос шейдеров](#porting-shaders)
    -   [Шейдер Direct3D 10 создается в HLSL](#direct3d-10-shaders-are-authored-in-hlsl)
    -   [Сигнатуры и компоновка шейдера](#shader-signatures-and-linkage)
    -   [Компоновки этапа шейдера HLSL](#hlsl-shader-stage-linkages)
    -   [Буферы констант](#constant-buffers)
    -   [Пользовательские плоскости в HLSL на уровне компонентов 9 и выше](#user-clip-planes-in-hlsl-on-feature-level-9-and-higher)
-   [Дополнительные отличия Direct3D 10 для отслеживания](#additional-direct3d-10-differences-to-watch-for)
    -   [Целые числа в качестве входных данных](#integers-as-input)
    -   [Курсоры мыши](#mouse-cursors)
    -   [Сопоставление пикселей текстуры с пикселами в Direct3D 10](#mapping-texels-to-pixels-in-direct3d-10)
    -   [Изменение поведения подсчета ссылок](#reference-counting-behavior-changes)
    -   [Уровень совместной проверки](#test-cooperative-level)
    -   [стретчрект](#stretchrect)
-   [Дополнительные различия Direct3D 10,1](#additional-direct3d-101-differences)
-   [Связанные темы](#related-topics)

## <a name="overview-of-the-major-structural-changes-in-direct3d-10"></a>Обзор основных структурных изменений в Direct3D 10

-   [Удаление функции FIXED](#removal-of-fixed-function)
-   [Проверка времени создания объекта устройства](#device-object-creation-time-validation)

Процесс подготовки к просмотру с помощью устройства Direct3D 10 структурно напоминает Direct3D 9.

-   Установка источника потока вершин
-   Настройка макета ввода в Direct3D 10 (установка объявления потока вершин в Direct3D 9)
-   Объявить топологию примитива
-   Задать текстуры
-   Задание объектов состояния
-   Задание шейдеров
-   Draw

Вызов [**Draw**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-draw) связывает операции вместе. порядок вызовов до вызова Draw является произвольным. Ниже приведены основные отличия в структуре API Direct3D 10.

-   Удаление функции FIXED
-   Снятие CAPS-битов. базовый набор функций Direct3D 10 гарантируется
-   Более строгое управление: доступ к ресурсам, состояние устройства, константы шейдеров, связывание шейдера (входы и выходы в шейдеры) между этапами
-   Изменение имени точки входа API отражает использование виртуальной памяти GPU (Map () вместо Lock ()).
-   Слой отладки можно добавить на устройство во время создания
-   Топология примитива теперь является явным состоянием (отделенным от вызова [**Draw**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-draw) )
-   Константы явных шейдеров теперь хранятся в буферах констант
-   Создание шейдера выполняется полностью в HLSL. Компилятор HLSL теперь находится в основной библиотеке DLL Direct3D 10.
-   Новый программируемый этап — шейдер геометрии
-   Удаление Бегинсцене ()/Ендсцене ()
-   Распространенные функции управления 2D, фокусами и адаптерами, реализованные в новом компоненте: DXGI

### <a name="removal-of-fixed-function"></a>Удаление функции FIXED

Иногда бывает удивительно, что даже в подсистеме Direct3D 9, которая полностью использует программируемый конвейер, остается ряд областей, зависящих от конвейера с фиксированной функцией (FF). Наиболее распространенные области обычно связаны с отрисовкой пользовательского интерфейса на уровне экрана. Именно по этой причине вам, скорее всего, потребуется создать шейдер для эмуляции FF или набор шейдеров, обеспечивающих необходимые варианты поведения при замене.

Эта документация содержит технический документ с замещающими источниками шейдеров для наиболее распространенных вариантов поведения FF (см. пример с помощью функции "ЕС" в разделе " [фиксированная функция](https://msdn.microsoft.com/library/Ee416406(v=VS.85).aspx)"). Некоторые функциональные возможности с фиксированной функцией, включая альфа-тест, были перемещены в шейдеры.

### <a name="device-object-creation-time-validation"></a>Проверка времени создания объекта устройства

Конвейер Direct3D 10 был переработан с самого начала в оборудовании и программном обеспечении с основной целью снижения нагрузки ЦП (во время вывода). Чтобы снизить затраты, всем типам данных устройства был присвоен объект с явными методами создания, предоставляемыми самим устройством. Это позволяет выполнять проверку данных в течение времени создания объекта, а не во время вызова Draw, как это часто происходит с Direct3D 9.

## <a name="engine-abstractions--separation"></a>Абстракции и разделение модулей

Для приложений, в том числе игр, которые хотят поддерживать Direct3D 9 и Direct3D 10, необходимо, чтобы уровни отрисовки были абстрактными от остальной части базы кода. Существует много способов добиться этого, но ключ ко всем ним является структурой уровня абстракции для устройства Direct3D нижнего уровня. Все системы должны взаимодействовать с оборудованием через общий уровень, предназначенный для предоставления ресурсов GPU и управления типами низкого уровня.

### <a name="direct-removal-of-direct3d-9-dependencies"></a>Прямое удаление зависимостей Direct3D 9

При переносе больших, ранее протестированных баз кода важно сокращать количество изменений в коде, которые абсолютно необходимы для сохранения ранее протестированных поведений в коде. Рекомендации включают в себя четкое документирование того, где изменяются элементы с помощью комментариев. Часто полезно иметь стандарт комментирования для этой работы, что позволяет быстро перемещаться по базе кода.

Ниже приведен пример списка стандартных комментариев одинарной и стартовой блоков, которые можно использовать для этой работы.



| Элемент                                                                                                                                                                             | Описание                                                                                                                                                                                                                                                                                                                    |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="___Direct3D_10_REMOVED"></span><span id="___direct3d_10_removed"></span><span id="___DIRECT3D_10_REMOVED"></span>УДАЛЕН Direct3D 10<br/>                     | Используйте это место, где удаляются строки или блоки кода<br/>                                                                                                                                                                                                                                                                   |
| <span id="___Direct3D_10_NEEDS_UPDATE"></span><span id="___direct3d_10_needs_update"></span><span id="___DIRECT3D_10_NEEDS_UPDATE"></span>ТРЕБУЕТСЯ обновление Direct3D 10<br/> | Он позволяет добавлять дополнительные примечания к комментарию по ОБНОВЛЕНию, который предлагает, какие рабочие и новые API следует использовать для последующих посещений кода для преобразования поведения. Интенсивное использование Assert (**false**) также следует использовать там, где требуется \\ \\ обновление Direct3D 10, чтобы гарантировать неизвестный код аномального.<br/> |
| <span id="___Direct3D_10_CHANGED"></span><span id="___direct3d_10_changed"></span><span id="___DIRECT3D_10_CHANGED"></span>Изменен Direct3D 10<br/>                     | Области, в которых были внесены существенные изменения, должны храниться для дальнейшего использования, но при этом закомментироваться<br/>                                                                                                                                                                                                                       |
| <span id="___Direct3D_10_END"></span><span id="___direct3d_10_end"></span><span id="___DIRECT3D_10_END"></span>ОКОНЧАНИе Direct3D 10<br/>                                     | Квалификатор конечного блока кода<br/>                                                                                                                                                                                                                                                                                            |



 

Для нескольких строк исходного кода следует использовать не только стили C/ \* \* /комментарии, но и добавить соответствующие комментарии начала и окончания вокруг этих областей.

## <a name="tricks-for-quickly-resolving-application-build-issues"></a>Рекомендации по быстрому решению проблем сборки приложений

-   [Переопределение типов Direct3D 9](#overriding-direct3d-9-types)
-   [Устранение проблем с ссылками](#resolving-link-issues)
-   [Имитация заглавных устройств](#simulating-device-caps)

### <a name="overriding-direct3d-9-types"></a>Переопределение типов Direct3D 9

Может оказаться полезным вставить файл заголовка высокого уровня, содержащий определения или переопределения типов для базовых типов Direct3D 9, которые больше не поддерживаются заголовками Direct3D 10. Это поможет вам сократить объем изменений в коде и интерфейсах, в которых имеется прямое сопоставление типа Direct3D 9 с только что определенным типом Direct3D 10. Этот подход также полезен для сохранения поведения кода вместе в одном исходном файле. В этом случае рекомендуется определить независимые от версии типы, которые описывают общие конструкции, используемые для отрисовки, но которые охватывают API Direct3D 9 и Direct3D 10. Например:


```
#if defined(D3D9)
typedef IDirect3DIndexBuffer9   IDirect3DIndexBuffer;
typedef IDirect3DVertexBuffer9  IDirect3DVertexBuffer;
#else //D3D10
typedef ID3D10Buffer            IDirect3DIndexBuffer;
typedef ID3D10Buffer            IDirect3DVertexBuffer
#endif
```



Другие примеры Direct3D 10 включают следующие.


```
typedef ID3D10TextureCube   IDirect3DCubeTexture;
typedef ID3D10Texture3D     IDirect3DVolumeTexture;
typedef D3D10_VIEWPORT      D3DVIEWPORT;
typedef ID3D10VertexShader  IDirect3DVertexShader;
typedef ID3D10PixelShader   IDirect3DPixelShader;
```



### <a name="resolving-link-issues"></a>Устранение проблем с ссылками

рекомендуется разрабатывать приложения Direct3D 10 и Windows Vista, используя последнюю версию Microsoft Visual Studio. однако можно создать приложение Windows Vista, которое зависит от Direct3D 10, с помощью более ранней версии 2003 Visual Studio. Direct3D 10 — это компонент платформы Windows Vista, который имеет зависимости (как в пакете SDK для сервера 2003 с пакетом обновления 1 (SP1)) в следующей библиотеке lib: буффероверфлову. lib для разрешения любых \_ проблем компоновщика проверки безопасности буфера.

### <a name="simulating-device-caps"></a>Имитация заглавных устройств

Многие приложения содержат области кода, которые зависят от доступных данных о заглавных дисках. Обойти это можно, переопределив перечисление устройств и заставляя ограничения для устройств в разумные значения. Запланируйте повторное посещение областей, в которых существуют зависимости от политик авторизации подключений позже, если это возможно.

## <a name="driving-the-direct3d-10-api"></a>Управление API Direct3D 10

В этом разделе рассматриваются изменения в работе, вызванные API Direct3D 10.

-   [Создание ресурсов](#resource-creation)
-   [Представления](#views)
-   [Статический и динамический доступ к ресурсам](#static-versus-dynamic-resource-access)
-   [Эффекты Direct3D 10](#direct3d-10-effects)
-   [HLSL без эффектов](#hlsl-without-effects)
-   [Компиляция шейдера](#shader-compilation)
-   [Создание ресурсов шейдера](#creation-of-shader-resources)
-   [Интерфейс слоя отражения шейдеров](#shader-reflection-layer-interface)
-   [Макеты входного ассемблера — компоновка вершинного шейдера и входного потока](/windows)
-   [Влияние удаления неработающего кода шейдера](#impact-of-shader-dead-code-removal)
-   [Пример входной структуры шейдера вершин](#vertex-shader-input-structure-example)
-   [Создание объекта состояния](#state-object-creation)

### <a name="resource-creation"></a>Создание ресурсов

API Direct3D 10 разрабатывал ресурсы как универсальные типы буфера, имеющие определенные флаги привязки в соответствии с запланированным использованием. Эта точка проектирования была выбрана для упрощения повсеместного доступа к ресурсам в конвейере для таких сценариев, как отрисовка в буфер вершин, а затем мгновенное Рисование результатов без прерывания работы ЦП. В следующем примере показано выделение буферов вершин и буфера индексов, где можно увидеть, что описание ресурса отличается только флагами привязки ресурсов GPU.

API Direct3D 10 предоставил вспомогательные методы текстуры для явного создания ресурсов типа текстуры, но как можно себе представить, это фактически вспомогательные функции.

-   CreateTexture2D()
-   Креатетекстурекубе ()
-   CreateTexture3D()

При использовании Direct3D 10, скорее всего, потребуется выделить больше элементов во время создания ресурса, чем вы используете с Direct3D 9. Это станет наиболее очевидным благодаря созданию буферов и текстур целевых объектов рендеринга, в которых необходимо также создать представление для доступа к буферу и настройки ресурса на устройстве.

[Учебник 1. Основные сведения о Direct3D 10](https://msdn.microsoft.com/library/Ee416436(v=VS.85).aspx)

> [!Note]  
> Direct3D 10 и более поздние версии Direct3D расширяют формат файлов DDS для поддержки новых форматов DXGI, массивов текстур и массивов карт Куба. Дополнительные сведения о расширении формата файла DDS см. в разделе [Guide по программированию для DDS](../direct3ddds/dx-graphics-dds-pguide.md).

 

### <a name="views"></a>Представления

Представление — это специально типизированный интерфейс для данных, хранящихся в буфере пикселей. Ресурс может одновременно выделить несколько представлений, и эта функция будет выделена в образце единого прохода render to кубической карты, который содержится в этом пакете SDK.

[Страница с руководством программистов по доступу к ресурсам](d3d10-graphics-programming-guide-resources-access-views.md)

[Пример кубической карты](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)

### <a name="static-versus-dynamic-resource-access"></a>Статический и динамический доступ к ресурсам

Для лучшей производительности приложения должны секционировать их данные с точки зрения статической и динамической природы данных. Direct3D 10 был разработан таким образом, чтобы воспользоваться преимуществами такого подхода и, таким образом, правила доступа для ресурсов значительно заблокировались по сравнению с Direct3D 9. Для статических ресурсов необходимо в идеале заполнить ресурс данными во время создания. Если ваш модуль разработан на основе точки проектирования создания, блокировки, заполнения и разблокировки Direct3D 9, вы можете отложить заполнение с помощью промежуточного ресурса и метода Упдатесубресаурце в интерфейсе ресурсов.

### <a name="direct3d-10-effects"></a>Эффекты Direct3D 10

Использование системы влияния Direct3D 10 выходит за рамки этой статьи. Система была написана, чтобы воспользоваться всеми преимуществами архитектурных преимуществ, предоставляемых Direct3D 10. Дополнительные сведения об использовании см. в разделе [Effects (Direct3D 10)](d3d10-graphics-programming-guide-effects.md) .

### <a name="hlsl-without-effects"></a>HLSL без эффектов

Конвейер шейдера Direct3D 10 может быть управляемым без использования системы влияния Direct3D 10. Обратите внимание, что в этом случае весь буфер констант, шейдер, образец и привязка текстуры должны управляться самим приложением. Для получения дополнительных сведений см. ссылку на образец и следующие разделы этого документа:

[Пример HLSL без эффектов](https://msdn.microsoft.com/library/Ee416414(v=VS.85).aspx)

### <a name="shader-compilation"></a>Компиляция шейдера

Компилятор Direct3D 10 HLSL предоставляет усовершенствования определения языка HLSL и, таким образом, имеет возможность работы в двух режимах. Для полной поддержки встроенных функций и семантики в стиле Direct3D 9 компиляцию следует вызывать с помощью флага режима СОВМЕСТИМОСТИ, который можно указать для каждой компиляции.

HLSLная семантика языка и встроенные функции для Direct3D 10 в модели шейдеров 4,0 можно найти по адресу [HLSL](../direct3dhlsl/dx-graphics-hlsl.md). Основные изменения в синтаксисе из Direct3D 9 HLSL, чтобы получить наиболее заметные уведомления, находятся в области доступа к текстурам. Новый синтаксис является единственной формой, поддерживаемой компилятором вне режима совместимости.

> [!Note]  
> api-интерфейсы типа компилятора direct3d 10 ([**D3D10CompileShader**](/windows/desktop/api/D3D10Shader/nf-d3d10shader-d3d10compileshader) и [**D3D10CompileEffectFromMemory**](/windows/desktop/api/D3D10Effect/nf-d3d10effect-d3d10compileeffectfrommemory)) предоставляются средами выполнения direct3d 10, 10,1 и 11, которые работают в Windows Vista и более поздних версиях. Интерфейсы API типа компилятора Direct3D 10 имеют те же функциональные возможности, что и компилятор HLSL, поставляемый в составе пакета SDK DirectX (Декабрь 2006). Этот компилятор HLSL не поддерживает профили Direct3D 10,1 (VS \_ 4 \_ 1, PS \_ 4 \_ 1, GS \_ 4 \_ 1, FX \_ 4 \_ 1), и в нем отсутствует ряд операций оптимизации и улучшений. Вы можете получить компилятор HLSL, который поддерживает профили Direct3D 10,1 из последней версии [пакета SDK DirectX](/previous-versions/windows/apps/hh452744(v=win.10))для предыдущих версий. Сведения о устаревшем пакете SDK DirectX см. в разделе [где находится пакет DirectX SDK?](../directx-sdk--august-2009-.md). последнюю версию HLSL Fxc.exe компилятор командной строки и интерфейсы api [D3DCompiler](../direct3dhlsl/dx-graphics-d3dcompiler-reference.md) можно получить из Windows SDK.

 

### <a name="creation-of-shader-resources"></a>Создание ресурсов шейдера

Создание скомпилированных экземпляров шейдеров за пределами Direct3D 10 Effects выполняется почти так же, как и Direct3D 9. Однако в Direct3D 10 важно, чтобы входные подписи шейдера использовались для последующего использования. Подпись возвращается по умолчанию в составе большого двоичного объекта шейдера, но может быть извлечена для уменьшения требований к памяти при необходимости. Дополнительные сведения см. [в разделе Использование шейдеров в Direct3D 10](../direct3dhlsl/dx-graphics-hlsl-using-shaders-10.md).

### <a name="shader-reflection-layer-interface"></a>Интерфейс слоя отражения шейдеров

Слой отражения шейдеров — это интерфейс, с помощью которого можно получить сведения о требованиях шейдера. Это особенно полезно при создании связей входных сборок (см. ниже), где вам может потребоваться выполнить обходные требования к входным данным шейдера, чтобы обеспечить правильную входную структуру шейдера. Можно создать экземпляр интерфейса уровня отражения одновременно с созданием экземпляра скомпилированного шейдера.

Слой отражения шейдера заменяет методы D3DX9, которые предоставляют аналогичные функциональные возможности. Например, [**испараметерусед**](../direct3d9/id3dxeffect--isparameterused.md) заменяется методом [**DESC**](/windows/desktop/api/D3D10Shader/nf-d3d10shader-id3d10shaderreflectionvariable-getdesc) .

### <a name="input-assembler-layouts---vertex-shader--input-stream-linkage"></a>Макеты входного ассемблера — компоновка вершинного шейдера и входного потока

Входной ассемблер (IA) заменяет объявление потока вершин в стиле Direct3D 9, и структура его описания очень похожа на форму. Основное отличие архитектуры IA заключается в том, что созданный объект макета IA должен напрямую сопоставляться с конкретным форматом входной подписи шейдера. Объект сопоставления, созданный для связывания входного потока с шейдером, может использоваться в любом числе шейдеров, где входная сигнатура шейдера совпадает с подписью шейдера, используемой для создания макета ввода.

Чтобы лучше использовать конвейер со статическими данными, следует рассмотреть перестановки формата входного потока на возможные входные сигнатуры шейдеров и создать экземпляры объектов макета IA как можно раньше и использовать их там, где это возможно.

### <a name="impact-of-shader-dead-code-removal"></a>Влияние удаления неработающего кода шейдера

В следующем разделе подробно описана существенная разница между Direct3D 9 и Direct3D 10, которая, скорее всего, требует тщательной обработки кода модуля. В шейдерах, содержащих условные выражения, в рамках процесса компиляции часто удаляются определенные пути кода. В Direct3D 9 два типа входных данных могут быть удалены (отмечены для удаления), если не используется: входные данные подписи (как в примере ниже) и постоянные входы. Если конец буфера констант содержит неиспользуемые записи, объявление размера в шейдере будет отражать размер буфера констант без неиспользуемых записей в конце. Оба этих типа входных данных остаются в сигнатурах или константных буферах Direct3D 10 с особым исключением в случае неиспользуемых входных констант в конце буфера констант. Это может повлиять на ядро при обработке больших шейдеров и создании макетов ввода. Элементы, удаленные с помощью оптимизации неработающих кодов в компиляторе, по-прежнему должны быть объявлены во входной структуре. Следующий пример демонстрирует это:

### <a name="vertex-shader-input-structure-example"></a>Пример входной структуры шейдера вершин


```
struct VS_INPUT
{
float4 pos: SV_Position;
float2 uv1 : Texcoord1;
float2 uv2 : Texcoord2; *
};
```



\* Удаление неработающего кода Direct3D 9 приведет к удалению объявления в шейдере из-за удаления условного кода


```
float4x4  g_WorldViewProjMtx;
static const bool g_bLightMapped = false; // define a compile time constant

VS_INPUT main(VS_INPUT i) 
{
    VS_INPUT o;
    o.pos = mul( i.pos, g_WorldViewProjMtx);
    o.uv1 = i.uv1;
    if ( g_bLightMapped )
    {
        o.uv2 = i.uv2;
    }
    return o;
}
```



Или можно сделать еще более очевидным, что константа является константой времени компиляции со следующим объявлением:


```
#define LIGHT_MAPPED false
```



В приведенном выше примере в Direct3D 9 элемент UV2 был удален из-за неработающей оптимизации кода в компиляторе. В Direct3D 10 неработающий код по-прежнему будет удален, но макет входного ассемблера шейдера требует наличия определения входных данных. Слой отражения шейдеров предоставляет средства для обработки этой ситуации в универсальном виде, позволяя проследить требования к входным данным шейдера и обеспечить полное описание входного потока для сопоставления сигнатур шейдера.

Ниже приведен пример функции для обнаружения существования семантического имени или индекса в сигнатуре функции:


```
// Returns true if the SemanticName / SemanticIndex is used in the input signature.
// pReflector is a previously acquired shader reflection interface.
bool IsSignatureElementExpected(ID3D10ShaderReflection *pReflector, const LPCSTR SemanticName, UINT SemanticIndex)
{
    D3D10_SHADER_DESC               shaderDesc;
    D3D10_SIGNATURE_PARAMETER_DESC  paramDesc;

    Assert(pReflector);
    Assert(SemanticName);

    pReflector->GetDesc(&shaderDesc);

    for (UINT k=0; k<shaderDesc.InputParameters; k++)
    {
        pReflector->GetInputParameterDesc( k, &paramDesc);
        if (wcscmp( SemanticName, paramDesc.SemanticName)==0 && paramDesc.SemanticIndex == SemanticIndex) 
            return true;
    }

    return false;
}
```



### <a name="state-object-creation"></a>Создание объекта состояния

При переносе кода модуля может помочь изначально использовать набор объектов состояния по умолчанию и отключить все параметры состояния визуализации устройства Direct3D 9 и состояния текстуры. Это приведет к визуализации артефактов, но является самым быстрым способом запуска и выполнения задач. Позднее можно создать систему управления объектами состояния, которая может использовать составной ключ, чтобы обеспечить максимальное повторное использование числа используемых объектов состояния.

## <a name="porting-textures"></a>Перенос текстур

### <a name="file-formats-supported"></a>Поддерживаемые форматы файлов

Функции **D3DXxxCreateXXX** и **D3DXxxSaveXXX** , которые создают или сохраняют текстуру из или в графический файл (например, [**D3DX10CreateTextureFromFile**](d3dx10createtexturefromfile.md)), поддерживают другой набор форматов файлов в Direct3D 10, чем в Direct3D 9:



| Формат файла | Direct3D 9 | Direct3D 10 |
|-------------|------------|-------------|
| BMP        | x          | x           |
| .jpg        | x          | x           |
| TGA        | x          |             |
| .png        | x          | x           |
| DDS        | x          | x           |
| стр/мин        | x          |             |
| DIB        | x          |             |
| . HDR        | x          |             |
| . ПФМ        | x          |             |
| TIFF       |            | x           |
| .gif        |            | x           |
| .tif        |            | x           |



 

Для получения дополнительных сведений Сравните перечисления Direct3D 9 [**D3DXIMAGE \_ FILEFORMAT**](../direct3d9/d3dximage-fileformat.md) с перечислениями [**\_ \_ \_ форматов файлов изображений D3DX10**](d3dx10-image-file-format.md) для Direct3D 10.

> [!Note]  
> Библиотека служебной программы D3DX (D3DX 9, D3DX 10 и D3DX 11) устарела для Windows 8. Для обработки файлов текстуры рекомендуется использовать [директкстекс](https://github.com/Microsoft/DirectXTex).

 

### <a name="mapping-texture-formats"></a>Сопоставление форматов текстур

В следующей таблице показано сопоставление форматов текстур с Direct3D 9 и Direct3D 10. Любое содержимое в форматах, недоступных для DXGI, необходимо преобразовать с помощью подпрограмм служебной программы.



| Формат Direct3D 9                   | Формат Direct3D 10                                                                                                                                                                                                                                   |
|-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| D3DFMT \_ неизвестный                     | \_неизвестный формат DXGI \_                                                                                                                                                                                                                                |
| D3DFMT \_ R8G8B8                      | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A8R8G8B8                    | \_Формат DXGI \_ B8G8R8A8 \_ UNORM & в \_ формате DXGI \_ B8G8R8A8 \_ UNORM \_ sRGB ¹                                                                                                                                                                                 |
| D3DFMT \_ X8R8G8B8                    | \_Формат DXGI \_ B8G8R8X8 \_ UNORM & в \_ формате DXGI \_ B8G8R8X8 \_ UNORM \_ sRGB ¹                                                                                                                                                                                 |
| D3DFMT \_ R5G6B5                      | \_Формат DXGI \_ B5G6R5 \_ UNORM ²                                                                                                                                                                                                                         |
| D3DFMT \_ X1R5G5B5                    | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A1R5G5B5                    | \_Формат DXGI \_ B5G5R5A1 \_ UNORM ²                                                                                                                                                                                                                       |
| D3DFMT \_ A4R4G4B4                    | \_Формат DXGI \_ B4G4R4A4 \_ UNORM ³                                                                                                                                                                                                                       |
| D3DFMT \_ R3G3B2                      | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A8                          | \_Формат DXGI \_ a8 \_ UNORM                                                                                                                                                                                                                              |
| D3DFMT \_ A8R3G3B2                    | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ X4R4G4B4                    | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A2B10G10R10                 | \_R10G10B10A2 формата \_ DXGI                                                                                                                                                                                                                            |
| D3DFMT \_ A8B8G8R8                    | \_Формат DXGI \_ R8G8B8A8 \_ UNORM & в \_ формате DXGI \_ R8G8B8A8 \_ UNORM \_ sRGB                                                                                                                                                                                  |
| D3DFMT \_ X8B8G8R8                    | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ G16R16                      | \_Формат DXGI \_ R16G16 \_ UNORM                                                                                                                                                                                                                          |
| D3DFMT \_ A2R10G10B10                 | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A16B16G16R16                | \_Формат DXGI \_ R16G16B16A16 \_ UNORM                                                                                                                                                                                                                    |
| D3DFMT \_ A8P8                        | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ P8                          | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ 8                          | \_Формат DXGI \_ R8 \_ UNORM. Примечание. Используйте. r свиззле в шейдере для дублирования красного в другие компоненты, чтобы получить поведение d3d9.                                                                                                                                    |
| D3DFMT \_ A8L8                        | \_Формат DXGI \_ R8G8 \_ UNORM Примечание. Используйте свиззле. рррг в шейдере, чтобы скопировать красный цвет и переместить зеленый в альфа-компоненты для получения поведения d3d9.                                                                                                            |
| D3DFMT \_ A4L4                        | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ V8U8                        | \_Формат DXGI \_ R8G8 \_ снорм                                                                                                                                                                                                                            |
| D3DFMT \_ L6V5U5                      | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ X8L8V8U8                    | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ Q8W8V8U8                    | \_Формат DXGI \_ R8G8B8A8 \_ снорм                                                                                                                                                                                                                        |
| D3DFMT \_ V16U16                      | \_Формат DXGI \_ R16G16 \_ снорм                                                                                                                                                                                                                          |
| D3DFMT \_ W11V11U10                   | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ A2W10V10U10                 | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ UYVY                        | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ R8G8 \_ B8G8                  | \_Формат DXGI \_ G8R8 \_ G8B8 \_ UNORM (в DX9 данные были увеличены с помощью 255.0 f, но это можно обработать в коде шейдера).                                                                                                                                   |
| D3DFMT \_ YUY2                        | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ G8R8 \_ G8B8                  | \_Формат DXGI \_ R8G8 \_ B8G8 \_ UNORM (в DX9 данные были увеличены с помощью 255.0 f, но это можно обработать в коде шейдера).                                                                                                                                   |
| D3DFMT \_ DXT1                        | \_Формат DXGI \_ BC1 \_ UNORM & в \_ формате DXGI \_ BC1 \_ UNORM \_ sRGB                                                                                                                                                                                            |
| D3DFMT \_ DXT2                        | \_Формат DXGI \_ BC1 \_ UNORM & \_ в формате DXGI \_ BC1 \_ UNORM \_ sRGB Примечание. DXT1 и DXT2 совпадают с точки зрения API и оборудования... только разница была "предварительно умноженный Альфа", который может быть записан приложением и не нуждается в отдельном формате. |
| D3DFMT \_ DXT3                        | \_Формат DXGI \_ BC2 \_ UNORM & в \_ формате DXGI \_ BC2 \_ UNORM \_ sRGB                                                                                                                                                                                            |
| D3DFMT \_ DXT4                        | \_Формат DXGI \_ BC2 \_ UNORM & \_ в формате DXGI \_ BC2 \_ UNORM \_ sRGB Примечание. DXT3 и DXT4 совпадают с точки зрения API и оборудования... только разница была "предварительно умноженный Альфа", который может быть записан приложением и не нуждается в отдельном формате. |
| D3DFMT \_ DXT5                        | \_Формат DXGI \_ BC3 \_ UNORM & в \_ формате DXGI \_ BC3 \_ UNORM \_ sRGB                                                                                                                                                                                            |
| D3DFMT \_ D16 & D3DFMT \_ D16 \_ блокируемый | \_Формат DXGI \_ D16 \_ UNORM                                                                                                                                                                                                                             |
| D3DFMT \_ d32                         | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ D15S1                       | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ D24S8                       | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ D24X8                       | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ D24X4S4                     | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ D16                         | \_Формат DXGI \_ D16 \_ UNORM                                                                                                                                                                                                                             |
| D3DFMT \_ D32F \_ блокируемый              | \_Формат DXGI \_ d32 \_ float                                                                                                                                                                                                                             |
| D3DFMT \_ D24FS8                      | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ S1D15                       | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ S8D24                       | \_Формат DXGI \_ D24 \_ UNORM \_ S8 \_ uint                                                                                                                                                                                                                   |
| D3DFMT \_ X8D24                       | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ X4S4D24                     | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ L16                         | \_Формат DXGI \_ R16 \_ UNORM Примечание. Используйте. r свиззле в шейдере для дублирования красного в другие компоненты, чтобы получить d3d9 поведение.                                                                                                                                   |
| D3DFMT \_ INDEX16                     | \_Формат DXGI \_ R16 \_ uint                                                                                                                                                                                                                              |
| D3DFMT \_ INDEX32                     | \_Формат DXGI \_ R32 \_ uint                                                                                                                                                                                                                              |
| D3DFMT \_ Q16W16V16U16                | \_Формат DXGI \_ R16G16B16A16 \_ снорм                                                                                                                                                                                                                    |
| D3DFMT \_ MULTI2 \_ ARGB8               | Недоступно                                                                                                                                                                                                                                        |
| D3DFMT \_ R16F                        | \_Формат DXGI \_ R16 \_ float                                                                                                                                                                                                                             |
| D3DFMT \_ G16R16F                     | \_Формат DXGI \_ R16G16 \_ float                                                                                                                                                                                                                          |
| D3DFMT \_ A16B16G16R16F               | \_Формат DXGI \_ R16G16B16A16 \_ float                                                                                                                                                                                                                    |
| D3DFMT \_ R32F                        | \_Формат DXGI \_ R32 \_ float                                                                                                                                                                                                                             |
| D3DFMT \_ G32R32F                     | \_Формат DXGI \_ R32G32 \_ float                                                                                                                                                                                                                          |
| D3DFMT \_ A32B32G32R32F               | \_Формат DXGI \_ R32G32B32A32 \_ float                                                                                                                                                                                                                    |
| D3DFMT \_ CxV8U8                      | Недоступно                                                                                                                                                                                                                                        |
| D3DDECLTYPE \_ FLOAT1                 | \_Формат DXGI \_ R32 \_ float                                                                                                                                                                                                                             |
| D3DDECLTYPE \_ FLOAT2                 | \_Формат DXGI \_ R32G32 \_ float                                                                                                                                                                                                                          |
| D3DDECLTYPE \_ FLOAT3                 | \_Формат DXGI \_ R32G32B32 \_ float                                                                                                                                                                                                                       |
| D3DDECLTYPE \_ FLOAT4                 | \_Формат DXGI \_ R32G32B32A32 \_ float                                                                                                                                                                                                                    |
| D3DDECLTYPED3DCOLOR                 | Недоступно                                                                                                                                                                                                                                        |
| D3DDECLTYPE \_ UBYTE4                 | \_Формат DXGI \_ R8G8B8A8 \_ uint Примечание. ШЕЙДЕР получает значения uint, но если требуется целочисленное число с плавающей запятой в стиле Direct3D 9 (0,0 f, 1,0 f... 255. f), UINT можно просто преобразовать в значение float32 в шейдере.                                                               |
| D3DDECLTYPE \_ SHORT2                 | \_Формат DXGI \_ R16G16 \_ Синт Примечание: ШЕЙДЕР получает значения Синт, но если требуется целочисленное число с плавающей запятой в стиле Direct3D 9, то можно просто преобразовать Синт в тип float32 в шейдере.                                                                                       |
| D3DDECLTYPE \_ SHORT4                 | \_Формат DXGI \_ R16G16B16A16 \_ Синт Примечание: ШЕЙДЕР получает значения Синт, но если требуется целочисленное число с плавающей запятой в стиле Direct3D 9, то можно просто преобразовать Синт в тип float32 в шейдере.                                                                                 |
| D3DDECLTYPE \_ UBYTE4N                | \_Формат DXGI \_ R8G8B8A8 \_ UNORM                                                                                                                                                                                                                        |
| D3DDECLTYPE \_ SHORT2N                | \_Формат DXGI \_ R16G16 \_ снорм                                                                                                                                                                                                                          |
| D3DDECLTYPE \_ SHORT4N                | \_Формат DXGI \_ R16G16B16A16 \_ снорм                                                                                                                                                                                                                    |
| D3DDECLTYPE \_ USHORT2N               | \_Формат DXGI \_ R16G16 \_ UNORM                                                                                                                                                                                                                          |
| D3DDECLTYPE \_ USHORT4N               | \_Формат DXGI \_ R16G16B16A16 \_ UNORM                                                                                                                                                                                                                    |
| D3DDECLTYPE \_ UDEC3                  | Недоступно                                                                                                                                                                                                                                        |
| D3DDECLTYPE \_ DEC3N                  | Недоступно                                                                                                                                                                                                                                        |
| D3DDECLTYPE \_ FLOAT16 \_ 2             | \_Формат DXGI \_ R16G16 \_ float                                                                                                                                                                                                                          |
| D3DDECLTYPE \_ FLOAT16 \_ 4             | \_Формат DXGI \_ R16G16B16A16 \_ float                                                                                                                                                                                                                    |
| FourCC 'ATI1'                       | \_Формат DXGI \_ BC4 \_ UNORM                                                                                                                                                                                                                             |
| FourCC 'ATI2'                       | \_Формат DXGI \_ Bc5 \_ UNORM                                                                                                                                                                                                                             |



 

¹ DXGI 1,1, включенная в среду выполнения Direct3D 11, включает форматы BGRA. однако поддержка этих форматов не является обязательной для устройств Direct3D 10 и 10,1 с драйверами, которые реализуются в Windows модели видеодрайверов (wddm) для Windows Vista (wddm 1,0). \_Вместо этого рекомендуется использовать формат DXGI \_ R8G8B8A8 \_ UNORM. Кроме того, вы можете создать устройство с помощью [**D3D10 \_ Create \_ Device \_ BGRA \_ support**](/windows/desktop/api/D3D10/ne-d3d10-d3d10_create_device_flag) , чтобы обеспечить поддержку только компьютеров со средой выполнения Direct3D 11,0 и драйвера WDDM 1,1 или более поздней версии.

² DXGI 1,0 определил формат 5:6:5 и 5:5:5:1, но они не поддерживались средой выполнения Direct3D 10. x или Direct3D 11,0. эти форматы поддерживаются при поддержке DXGI 1,2 в среде выполнения DirectX 11,1, которая необходима для видеоадаптеров уровня компонентов 11,1 и WDDM 1,2 (модель экрана с драйверами, начиная с Windows 8) и уже поддерживается на уровнях компонентов 10level9.

в ³ DXGI 1,2 появился формат 4:4:4:4. Этот формат дополнительно поддерживается в среде выполнения DirectX 11,1, которая необходима для видеоадаптеров уровня компонентов 11,1 и драйверов WDDM 1,2 и уже поддерживается на уровнях компонентов 10level9.

Для несжатых форматов DXGI ограничена поддержка произвольных шаблонов формата пикселей. Все несжатые форматы должны иметь тип RGBA. Это может потребовать группирующие существующих форматов пикселей, которые мы рекомендуем вычислять как предварительно автономный этап, где это возможно.

## <a name="porting-shaders"></a>Перенос шейдеров

### <a name="direct3d-10-shaders-are-authored-in-hlsl"></a>Шейдер Direct3D 10 создается в HLSL

Direct3D 10 ограничивает использование языка ассемблера только для целей отладки, поэтому все написанные шейдеры сборки, используемые в Direct3D 9, необходимо преобразовать в HLSL.

### <a name="shader-signatures-and-linkage"></a>Сигнатуры и компоновка шейдера

Мы обсудили требования для компоновки входных данных для входных подписей вершин шейдеров, приведенных ранее в этом документе (см. выше). Обратите внимание, что среда выполнения Direct3D 10 также заблокировала требования к этапу для промежуточной компоновки между шейдерами. Это изменение повлияет на источники шейдеров, где привязка между этапами может быть не полностью описана в Direct3D 9. Пример:


```
VS_OUTPUT                       PS_INPUT
float4   pos : SV_POSITION;     float4 pos : SV_POSITION;
float4   uv1 : TEXCOORD1;       float4 uv1 : TEXCOORD1;
float4x3 tangentSp : TEXCOORD2; float4 tangent : TEXCOORD2; *
float4   Color : TEXCOORD6;     float4 color : TEXCOORD6;
```



\* Неработающая компоновка VS-PS. Несмотря на то, что шейдер пикселей может не заинтересить полную матрицу, компоновка должна указывать полный float4x3.

Обратите внимание, что семантика компоновки между этапами должна точно совпадать, однако входные целевые этапы могут быть префиксом выходных значений. В приведенном выше примере шейдер пикселей может иметь координаты и texcoord1 в качестве единственных входных данных, но не может располагать и texcoord2 в качестве единственных входных данных из-за ограничений упорядочивания.

### <a name="hlsl-shader-stage-linkages"></a>Компоновки этапа шейдера HLSL

Связь между шейдерами может происходить в любой из следующих точек конвейера:

-   Вход ассемблера в шейдер вершин
-   Шейдер вершин к шейдеру пикселей
-   Шейдер вершин к шейдеру Geometry
-   Шейдер вершин для потокового вывода
-   Шейдер геометрии в шейдер пикселей
-   Шейдер геометрии для потоковой передачи

### <a name="constant-buffers"></a>Буферы констант

Для простоты переноса содержимого с Direct3D 9 первоначальный подход к управлению константами за пределами системы эффектов может привести к созданию единственного буфера константы, содержащего все необходимые константы. Важно, чтобы производительность упорядочивались константы в буферы с ожидаемой частотой обновления. Эта организация сокращает количество избыточных постоянных наборов до минимума.

### <a name="user-clip-planes-in-hlsl-on-feature-level-9-and-higher"></a>Пользовательские плоскости в HLSL на уровне компонентов 9 и выше

начиная с Windows 8 можно использовать атрибут функции **клиппланес** в [объявлении функции](../direct3dhlsl/dx-graphics-hlsl-function-syntax.md) HLSL, а не в [SV \_ клипдистанце](../direct3dhlsl/dx-graphics-hlsl-semantics.md) , чтобы сделать шейдер на [уровне функций](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md) 9 x, а \_ также на уровне функций 10 и выше. Дополнительные сведения см. [в статье пользовательские ролики на устройствах на уровне компонентов 9](../direct3dhlsl/user-clip-planes-on-10level9.md).

## <a name="additional-direct3d-10-differences-to-watch-for"></a>Дополнительные отличия Direct3D 10 для отслеживания

### <a name="integers-as-input"></a>Целые числа в качестве входных данных

В Direct3D 9 отсутствует фактическая поддержка целочисленных типов данных, однако оборудование Direct3D 10 поддерживает явные целочисленные типы. При наличии данных с плавающей запятой в буфере вершин необходимо иметь входные данные с плавающей точкой. В противном случае целочисленный тип будет представлен в виде битового шаблона значения с плавающей запятой. Целочисленный тип не допускается для входных шейдеров пикселей, если только значение не помечено для интерполяции (см. раздел [модификаторы интерполяции](../direct3dhlsl/dx-graphics-hlsl-struct.md)).

### <a name="mouse-cursors"></a>Курсоры мыши

в предыдущих версиях Windows стандартные подпрограммы для курсора мыши GDI не работали должным образом на всех полноэкранных эксклюзивных устройствах. Для этих случаев были добавлены API-интерфейсы [**сеткурсорпропертиес**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setcursorproperties), [**шовкурсор**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-showcursor)и [**сеткурсорпоситион**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setcursorposition) . так как версия GDI Windows Vista полностью понимает поверхности [DXGI](../direct3ddxgi/d3d10-graphics-programming-guide-dxgi.md) , нет необходимости в этом специализированном API курсора мыши, поэтому эквивалент Direct3D 10 не требуется. Вместо этого приложения Direct3D 10 должны использовать стандартные [подпрограммы](../menurc/cursors.md) для работы с курсорами мыши GDI.

### <a name="mapping-texels-to-pixels-in-direct3d-10"></a>Сопоставление пикселей текстуры с пикселами в Direct3D 10

В Direct3D 9 шаг текселя центры и пиксельные центры были половиной единицы (см. [непосредственное сопоставление пикселей текстуры с пикселами (Direct3D 9)](../direct3d9/directly-mapping-texels-to-pixels.md)). В Direct3D 10 центры шаг текселя уже находятся в половинных единицах, поэтому нет необходимости сдвигать координаты вершин.

Визуализация в полноэкранном режиме осуществляется более прямо вперед с помощью Direct3D 10. Четыре страницы с четырьмя экранами должны быть определены в клипспаце (-1, 1) и просто переданы через шейдер вершин без изменений. Таким образом, нет необходимости в повторной загрузке буфера вершин при каждом изменении разрешения экрана и отсутствии дополнительной работы в шейдере пикселей для управления координатами текстуры.

### <a name="reference-counting-behavior-changes"></a>Изменение поведения подсчета ссылок

В отличие от предыдущих версий Direct3D, различные функции наборов не будут содержать ссылку на объекты Devices. Это означает, что приложение должно обеспечить наличие в нем ссылки на объект до тех пор, пока этот объект должен быть привязан к конвейеру. Когда число ссылок объекта становится равным нулю, объект будет отключен от конвейера при его уничтожении. Этот стиль ссылки, удерживаемый также, называется слабой ссылкой, поэтому каждое место привязки в объекте устройства содержит слабую ссылку на интерфейс или объект. Если явно не указано иное, это поведение следует предполагать для всех методов набора. Всякий раз, когда уничтожение объекта приводит к тому, что точка привязки будет иметь **значение NULL** , отладочный слой выдаст предупреждение. Обратите внимание, что вызовы методов Get для устройства, такие как [**омжетрендертаржетс**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-omgetrendertargets) , увеличивают число ссылок возвращаемых объектов.

### <a name="test-cooperative-level"></a>Уровень совместной проверки

Функциональность API-интерфейса Direct3D 9 [**тесткуперативелевел**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-testcooperativelevel) аналогична настройке [ \_ \_ теста DXGI Present](../direct3ddxgi/dxgi-present.md) при вызове [**Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present).

### <a name="stretchrect"></a>стретчрект

Функция, аналогичная методу Direct3D 9 [**IDirect3DDevice9:: стретчрект**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-stretchrect) , недоступна в Direct3D 10 и 10,1. Чтобы скопировать поверхности ресурсов, используйте [**ID3D10Device:: кописубресаурцерегион**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion). Для операций изменения размера отрисовывается на текстуре с помощью фильтрации текстур. Для преобразования поверхностей MSAA в поверхности, не относящиеся к MSAA, используйте [**ID3D10Device:: ресолвесубресаурце**](/windows/desktop/api/d3d10/nf-d3d10-id3d10device-resolvesubresource).

## <a name="additional-direct3d-101-differences"></a>Дополнительные различия Direct3D 10,1

Windows В Vista с пакетом обновления 1 (SP1) содержится незначительное обновление Direct3D 10 и Direct3D 10,1, в котором доступны следующие дополнительные аппаратные функции:

-   Пошаговые шейдеры MSAA для каждого образца
-   Чтение глубины MSAA — назад
-   Независимые режимы наложения для каждого целевого объекта прорисовки
-   Массивы схем Куба
-   Преобразовать в форматы блочного сжатия (BC)

В обновлении Direct3D 10,1 добавлена поддержка следующих новых интерфейсов, которые являются производными от существующих интерфейсов:

-   [**ID3D10Device1**](/windows/desktop/api/D3D10_1/nn-d3d10_1-id3d10device1)
-   [**ID3D10BlendState1**](/windows/desktop/api/D3D10_1/nn-d3d10_1-id3d10blendstate1)
-   [**ID3D10ShaderResourceView1**](/windows/desktop/api/d3d10_1/nn-d3d10_1-id3d10shaderresourceview1)

Обновление Direct3D 10,1 также включало следующие дополнительные структуры:

-   [**D3D10 \_ визуализации \_ целевого объекта \_ Blend \_ DESC1**](/windows/desktop/api/d3d10_1/ns-d3d10_1-d3d10_render_target_blend_desc1)
-   [**D3D10 \_ Blend \_ DESC1**](/windows/desktop/api/D3D10_1/ns-d3d10_1-d3d10_blend_desc1)
-   [**\_ \_ \_ DESC1 представления ресурсов шейдера \_ D3D10**](/windows/desktop/api/d3d10_1/ns-d3d10_1-d3d10_shader_resource_view_desc1)

API-интерфейс Direct3D 10,1 содержит новую концепцию с именем Feature Level. Эта концепция означает, что вы можете использовать API Direct3D 10,1 для работы с Direct3D 10,0 [**( \_ уровень компонентов D3D10 \_ \_ 10 \_ 0**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1)) или Direct3D 10,1 ([**D3D10 \_ компонентов \_ уровня \_ 10 \_ 1**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1)). Поскольку API Direct3D 10,1 является производным от интерфейсов Direct3D 10, приложения могут создать устройство Direct3D 10,1, а затем использовать его в качестве устройства Direct3D 10,0, за исключением тех, где требуются новые функции, характерные для 10,1 (при условии, что D3D10 уровень функций **\_ \_ \_ 10 \_ 1** имеется и поддерживает эти функции).

> [!Note]  
> Устройства Direct3D 10,1 могут использовать существующие профили шейдеров HLSLа 10,0 (VS \_ 4 \_ 0, PS \_ 4 \_ 0, GS \_ 4 \_ 0) и новые профили 10,1 (VS \_ 4 \_ 1, PS \_ 4 \_ 1, GS \_ 4 \_ 1) с дополнительными инструкциями и возможностями HLSL.

 

Windows 7 содержал незначительное обновление для API direct3d 10,1, включенного в среду выполнения direct3d 11. Это обновление добавляет поддержку следующих уровней функций:

-   [**D3D10 \_ \_ уровень функций \_ 9 \_ 1**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1)
-   [**D3D10 \_ \_ уровень функций \_ 9 \_ 2**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1)
-   [**D3D10 \_ \_ уровень компонентов \_ 9 \_ 3**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1)

Windows 7 также добавлена поддержка Direct3D 10,1 для [Windows расширенной платформы растрирования (деформации)](../direct3darticles/directx-warp.md). Драйвер деформации можно указать с помощью функции [**\_ \_ \_ искривления типа драйвера D3D10**](/windows/desktop/api/D3D10misc/ne-d3d10misc-d3d10_driver_type).

Дополнительные сведения о Direct3D 10,1 см. в разделе [функции direct3d 10,1](d3d10-graphics-programming-guide-10-1.md) и перечисление [**D3D10 \_ компонентов \_ level1**](/windows/desktop/api/D3D10_1/ne-d3d10_1-d3d10_feature_level1) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Рекомендации по программированию для Direct3D 10](d3d10-graphics-programming-guide.md)
</dt> </dl>

 

 
