---
description: В этой статье описывается, как обновить реализацию ВАСАПИ, чтобы воспользоваться преимуществами автоматической маршрутизации потоков.
ms.assetid: 718CBEB9-A7A0-4898-81B7-CBD76AFA3A06
title: Автоматическая маршрутизация потоков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87a9848c5fd764ee49e485fc112c35c347a0f84d
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990774"
---
# <a name="automatic-stream-routing"></a>Автоматическая маршрутизация потоков

В этой статье описывается, как обновить реализацию ВАСАПИ, чтобы воспользоваться преимуществами автоматической маршрутизации потоков.

Начиная с Windows 7, всякий раз, когда звуковое устройство по умолчанию изменится, поток воспроизведения звука в приложении плавно передается с предыдущего звукового устройства по умолчанию на новое звуковое устройство по умолчанию. Этот перенос происходит автоматически без дополнительного кода приложения. Однако до Windows 10 версии 1607 приложения, в которых использовался API нижнего уровня Windows Audio (ВАСАПИ), не могли участвовать в этой функции автоматической маршрутизации потоков. Приложения, использующие ВАСАПИ, требовались для реализации собственной формы потоковой маршрутизации путем добавления дополнительного кода для обнаружения прибытия и удаления звуковых устройств и переключения потока на соответствующие устройства. Приложения, использующие ВАСАПИ, которые не реализуют собственный механизм маршрутизации потоков при получении или удалении устройства, подвержены риску, что обеспечивает менее оптимальное взаимодействие с пользователем.

Начиная с Windows 10 версии 1607, приложения, использующие ВАСАПИ, могут воспользоваться преимуществами автоматической маршрутизации потоков. Если приложение использует ВАСАПИ, настоятельно рекомендуется обновить приложение, чтобы воспользоваться преимуществами этой новой возможности, выполнив следующие действия.

1.  Windows 10, версия 1607, определяет два новых идентификатора GUID, которые можно использовать для активации интерфейса отрисовки аудио или записи с автоматической маршрутизацией, [девинтерфаце \_ воспроизведения \_ звука](/windows/desktop/CoreAudio/devinterface-xxx-guids) и [девинтерфаце \_ \_ записи звука](/windows/desktop/CoreAudio/devinterface-xxx-guids). Получите строковое представление этих идентификаторов GUID, вызвав [**Ошибка stringfromiid**](/windows/desktop/api/combaseapi/nf-combaseapi-stringfromiid). В следующем примере показан этот вызов для GUID отрисовки аудио.

    ```C++
    PWSTR audioRenderGuidString;
    StringFromIID(DEVINTERFACE_AUDIO_RENDER, &audioRenderGuidString);
    ```

    

2.  Активируйте конечную точку аудио, передав строку идентификатора в функцию ВАСАПИ [**активатеаудиоинтерфацеасинк**](/windows/desktop/api/mmdeviceapi/nf-mmdeviceapi-activateaudiointerfaceasync) . В следующем примере передается идентификатор прорисовки аудио, полученный на шаге 1.

    ```C++
    //Activate the default audio interface
    ActivateAudioInterfaceAsync(audioRenderGuidString
                                __uuidof(IAudioClient),
                                NULL,
                                completionHandler.Get(),
                                operation.GetAddressOf()));
    ```

    

3.  Освободите память, выделенную для хранения идентификатора конечной точки:

    ```C++
    CoTaskMemFree(audioRenderGuidString);  //free the string memory
    ```

    

После изменения приложения для активации звукового интерфейса описанным выше способом он будет участвовать в функции автоматической маршрутизации.

Чтобы продемонстрировать автоматическую маршрутизацию потоков, используйте ноутбук или планшет, оснащенные внутренними динамиками для воспроизведения звука. Вы должны слышать звук, воспроизводимый внутренними динамиками устройства. Во время воспроизведения звука подключите пару наушников. Теперь вы должны слышать звук, проигрывается по наушникам. Затем, Отсоедините наушники и аудио, должны автоматически маршрутизироваться к внутренним динамикам.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Потоковая маршрутизация](stream-routing.md)
</dt> <dt>

[**Медиадевице. Жетдефаултаудиорендерид**](/uwp/api/windows.media.devices.mediadevice.getdefaultaudiorenderid)
</dt> <dt>

[**Медиадевице. Жетдефаултаудиокаптуреид**](/uwp/api/windows.media.devices.mediadevice.getdefaultaudiocaptureid)
</dt> <dt>

[**активатеаудиоинтерфацеасинк**](/windows/desktop/api/mmdeviceapi/nf-mmdeviceapi-activateaudiointerfaceasync)
</dt> </dl>

 

 
