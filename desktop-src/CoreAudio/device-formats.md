---
description: Форматы устройств
ms.assetid: 591437e4-21ef-42f1-a752-7f50440cbd63
title: Форматы устройств
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbcd1b611075191e522cf00d959f120abfb3baa9
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104140827"
---
# <a name="device-formats"></a>Форматы устройств

В случае с звуковым приложением преимущество использования аудио API более высокого уровня, например DirectSound или функций **вавеауткскскс** мультимедиа Windows, заключается в том, что API автоматически преобразуется между форматами потоков, используемых приложением, и форматами, используемыми звуковым устройством. В отличие от этого, основные API-интерфейсы аудиоподсистемы более ограничены, так как для них требуется, чтобы потоки приложений использовали те же форматы, что и, или тесно связаны с форматами, используемыми устройством. Таким же приложениям, использующим основные API аудио для воспроизведения или записи звуковых потоков, может потребоваться выполнить некоторые или все преобразования между форматами потока.

Приложение, использующее ВАСАПИ для управления потоками в общем режиме, может полагаться на обработчик аудио, чтобы выполнять только ограниченные преобразования формата. Обработчик аудио может выполнять преобразование между стандартным размером образца PCM, используемым приложением, и примерами с плавающей запятой, которые ядро использует для его внутренней обработки. Однако формат потока приложения, как правило, должен иметь одинаковое количество каналов и частоту выборки в формате потока, используемом устройством.

Если приложение использует устройство в монопольном режиме, приложение должно использовать формат потока, который будет явно поддерживаться звуковым оборудованием. В монопольном режиме обмен данными между приложением и устройством осуществляется напрямую, без вмешательства обработчика звука.

Многие звуковые устройства поддерживают как форматы потока PCM, так и потоки без PCM. Однако обработчик звука может смешивать только потоки PCM. Поэтому только потоки с монопольным режимом могут иметь форматы, отличные от форматов PCM. Кроме того, в монопольном режиме поддерживаются только форматы, не относящиеся к PCM с фиксированными тарифными данными. Примером нестандартного формата с фиксированной частотой является поток аудио Windows Media Audio Professional (WMA Pro) 48 кГц, который проходит через ссылку на цифровой интерфейс Sony/PDIF в цифровой форме без декодирования. Дополнительные сведения об использовании потоков WMA Pro через S/PDIF см. в следующей документации:

-   Описание \_ ТЕГА Wave формата \_ WMA \_ SPDIF в документации по Windows DDK.
-   Технический документ под названием "Поддержка аудио драйвера для формата WMA Pro-over-S/PDIF" на веб-сайте [технологии аудио устройства для Windows](https://www.microsoft.com/whdc/device/audio/default.mspx) .

ВАСАПИ использует структуру **вавеформатекс** или **вавеформатекстенсибле** для указания формата потока. Структура **вавеформатекстенсибле** фактически является структурой **вавеформатекс** , расширенной для описания большего диапазона форматов. Любой формат, который может быть описан в автономной структуре **вавеформатекс** , также может быть описан структурой **вавеформатекстенсибле** .

Первый элемент структуры **вавеформатекстенсибле** является структурой **вавеформатекс** . Содержимое структуры **вавеформатекс** указывает, является ли она изолированной структурой **вавеформатекс** или частью структуры **вавеформатекстенсибле** .

Автономная структура **вавеформатекс** может адекватно описать формат с одним или двумя каналами, а также размер выборки, кратный 8 битам. Сама по себе структура **вавеформатекс** не может указывать сопоставление каналов с положениями докладчика. Кроме того, несмотря на то, что **вавеформатекс** указывает размер контейнера для каждого звукового образца, он не может указать число битов точности в выборке (например, 20 бит точности в 24-разрядном контейнере). В отличие от этого, структура **вавеформатекстенсибле** может задавать как сопоставление каналов, так и число бит точности в каждом выборке.

Дополнительные сведения о **вавеформатекс** и **вавеформатекстенсибле** см. в документации по Windows DDK.

Начиная с Windows 7, **вавеформатекстенсибле** был расширен для представления форматов устройств для передачи закодированных аудио-файлов через совместимый с IEC 61937 интерфейс. Дополнительные сведения о новой структуре см. в разделе [представление форматов для передач IEC 61937](representing-formats-for-iec-61937-transmissions.md).

### <a name="specifying-the-device-format"></a>Указание формата устройства

Следующие методы ВАСАПИ используют структуры **вавеформатекс** и **вавеформатекстенсибле** для описания форматов потоков:

-   [**Иаудиоклиент:: Жетмиксформат**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getmixformat)
-   [**Иаудиоклиент:: Исформатсуппортед**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-isformatsupported)
-   [**Иаудиоклиент:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize)

Метод **жетмиксформат** извлекает формат потока, который используется обработчиком аудио для внутренней обработки потоков общего режима. Метод всегда использует структуру **вавеформатекстенсибле** вместо изолированной структуры **вавеформатекс** для указания формата.

Метод **исформатсуппортед** указывает, поддерживает ли устройство конечной точки аудио определенный формат потока. Вызывающий объект должен указать, предназначен ли формат потока для использования в режиме общего доступа или в монопольном режиме. Для форматов общего режима метод запрашивает обработчик аудио, чтобы определить, поддерживает ли он указанный формат. Для форматов, исключающих монопольный режим, метод запрашивает драйвер устройства. Некоторые драйверы устройств сообщают о том, что они поддерживают одноканальный или двухканальный формат PCM, если формат указывается автономной структурой **вавеформатекс** , но отклоняет тот же формат, если он задан структурой **вавеформатекстенсибле** . Чтобы получить надежные результаты из этих драйверов, приложения с эксклюзивным режимом должны вызывать **исформатсуппортед** дважды для каждого формата PCM из одного канала или из двух каналов — один вызов должен использовать изолированную структуру **вавеформатекс** для указания формата, а другой вызов должен использовать структуру **вавеформатекстенсибле** для указания того же формата.

После того как приложение использовало **жетмиксформат** или **исформатсуппортед** для поиска соответствующего формата для потока в общем или монопольном режиме, приложение может вызвать метод **Initialize** для инициализации потока с этим форматом. Приложение, которое пытается инициализировать поток общего режима с форматом, который не идентичен формату Mix, полученному из метода **жетмиксформат** , но с тем же количеством каналов и частотой выборки, что и формат Mix, скорее всего, будет успешно выполнена. Перед вызовом **Initialize** приложение может вызвать **исформатсуппортед** , чтобы убедиться, что **Инициализация** будет принимать формат.

Формат MIX, используемый обработчиком аудио для внутренней обработки потоков общего режима, тесно связан с, но не обязательно идентичен формату потока, который устройство конечной точки аудио использует в общем режиме. С помощью панели управления Windows мультимедиа Mmsys.cpl пользователь может выбрать формат потока, который будет использоваться устройством конечной точки звука при работе в общем режиме. Для этого необходимо выполнить следующие шаги:

1.  Чтобы запустить Mmsys.cpl, откройте окно командной строки и введите следующую команду:

    **mmsys.cplуправления**

    Кроме того, можно запустить Mmsys.cpl, щелкнув правой кнопкой мыши значок динамика в области уведомлений в правой части панели задач и выбрав либо **устройства воспроизведения** , либо **записывающие устройства**.

2.  После открытия окна Mmsys.cpl выберите устройство в списке устройств воспроизведения или в списке устройств записи и нажмите кнопку **Свойства**.
3.  Когда откроется окно Свойства, нажмите кнопку **Дополнительно** и выберите формат из списка доступных форматов в поле **Формат по умолчанию**.

Например, предположим, что пользователь выбирает следующий формат по умолчанию из списка доступных форматов для устройства воспроизведения:

**2 канала, 16 бит, 44100 Гц (качество компакт-диска)**

Это формат, который будет впоследствии использоваться устройством при работе в общем режиме. В Windows Vista для внутренней обработки потоков в общем режиме обработчик аудиозаписей будет использовать немного измененную версию этого формата. Обработчик аудиозаписей будет использовать формат с одинаковым числом каналов (два) и одинаковой частотой выборки (44100 Гц), но при этом будут преобразованы образцы в числа с плавающей запятой перед их обработкой. Обработчик аудиозаписей преобразует примеры с плавающей запятой из выходного набора в 16-разрядные целые числа, прежде чем воспроизводить их через устройство.

Приложение может запросить свойство [**PKEY \_ аудиоенгине \_ девицеформат**](pkey-audioengine-deviceformat.md) устройства конечной точки, чтобы получить формат общего режима, который пользователь выбрал для устройства. Сведения о запросе свойств устройства см. в разделе [Свойства устройства](device-properties.md).

Некоторые приложения могут найти формат, заданный свойством **PKEY \_ аудиоенгине \_ девицеформата** устройства, в качестве подходящего формата для открытия потока с монопольным режимом на устройстве. Другие приложения, которые управляют потоками в монопольном режиме, могут иметь дополнительные требования, которые требуют согласования сложного формата с устройством. Как правило, одно из этих приложений формирует список подходящих форматов с предпочтительными форматами в начале списка. Затем приложение последовательно вызывает **исформатсуппортед** с каждым последовательным форматом в списке, начиная с начала списка, пока не найдет формат, поддерживаемый устройством.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Устройства конечных точек звука](audio-endpoint-devices.md)
</dt> </dl>

 

 



