---
description: В Windows 7 API-интерфейсы высокоуровневой платформы, использующие основные API аудио, такие как Media Foundation, DirectSound и Wave API, реализуют функцию маршрутизации потоков путем обработки переключения потоков с существующего устройства на новую конечную точку звука по умолчанию.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Соответствующие уведомления для потоковой маршрутизации
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef3d253ce2ec5d6e3bef025a33233a9d377ca44b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104141617"
---
# <a name="relevant-notifications-for-stream-routing"></a>Соответствующие уведомления для потоковой маршрутизации

В Windows 7 API-интерфейсы высокоуровневой платформы, использующие основные API аудио, такие как Media Foundation, DirectSound и Wave API, реализуют функцию маршрутизации потоков путем обработки переключения потоков с существующего устройства на новую конечную точку звука по умолчанию. Приложения мультимедиа, использующие эти API, используют поведение маршрутизации потока без каких-либо изменений в источнике. Клиенты Direct ВАСАПИ могут использовать уведомления, отправленные основными компонентами, и реализовать функцию маршрутизации потоков.

Чтобы реализовать функцию маршрутизации потоков, клиент должен прослушивать два типа событий: уведомления об изменении устройства и уведомления об отключении сеанса. В реализации, предоставляемой интерфейсами API высокого уровня, эти события отправляются для конечных точек устройств по умолчанию, созданных путем вызова [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint). Дополнительные сведения см. [в разделе Получение конечной точки устройства для маршрутизации потоков](getting-the-default-device-endpoint-for-stream-routing.md).

Основной звуковой компонент Ммдевицеапи обеспечивает обратные вызовы уведомлений при добавлении, удалении или изменении звуковых устройств. Изменения формата и сеанса звука выводятся как события через ВАСАПИ.

## <a name="device-change-notifications"></a>Уведомления об изменении устройств

Ммдевицеапи вызывает события при добавлении, удалении или изменении звуковых устройств. Если клиент должен предоставлять функции маршрутизации потоковой передачи, необходимо реализовать интерфейс [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) и зарегистрировать его реализацию с помощью ммдевицеапи.

Чтобы получать уведомления об изменении устройств, клиент должен выполнить следующие задачи:

-   Реализуйте интерфейс [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) для управления уведомлениями об изменении устройств, отправленных ммдевицеапи.
-   Зарегистрируйте реализацию [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) с помощью ммдевицеапи, вызвав метод [**Иммдевицеенумератор:: регистерендпоинтнотификатионкаллбакк**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) .

После регистрации реализации этих интерфейсов клиентом клиент получает уведомления в форме обратных вызовов через методы этих интерфейсов. Методы [**иммнотификатионклиент**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) вызываются ммдевицеапи, когда он вызывает события уровня конечной точки (изменения состояния конечной точки, новые прибытия конечной точки, удаления конечных точек, изменения конечной точки по умолчанию и изменения свойств конечной точки).

Если клиент хочет предоставить потоковую маршрутизацию для устройства по умолчанию, клиент должен реализовать поведение изменения устройства при получении уведомления с помощью обратного вызова [**иммнотификатионклиент:: ондефаултдевицечанжед**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) .

## <a name="audio-session-change-notifications"></a>Уведомления об изменении сеанса аудио

Изменения в сеансе аудио и изменении формата передаются в виде событий сеанса звука через ВАСАПИ. Клиент ВАСАПИ реализует интерфейс [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) и регистрирует реализацию с помощью васапи.

Чтобы получать уведомления об изменении сеанса аудио, клиент должен выполнить следующие задачи:

-   Реализуйте интерфейс [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) для работы с уведомлениями об изменении формата, отправленных васапи.
-   Зарегистрируйте реализацию [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) с помощью васапи, вызвав метод [**Иаудиосессионконтрол:: регистераудиосессионнотификатион**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) .

Методы [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) вызываются васапи, когда происходят изменения в сеансе звука. Эти события возникают при изменении отображаемого имени сеанса, пути к значку, тома, параметра группирования или изменения состояния.

Чтобы реализовать функцию маршрутизации потоков, клиент должен дождаться уведомления об отключении сеанса. Если сеанс аудио отключен или изменился формат устройства, ВАСАПИ отправляет клиентские уведомления в виде обратных вызовов через [**иаудиосессионевентс:: онсессиондисконнектед**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected). С помощью уведомления о разрыве соединения ВАСАПИ также отправляет значение, указывающее, почему сеанс был отключен. Это может произойти по нескольким причинам, таким как устройство было удалено, сервер остановлен и т. д. Полный список причин см. в описании перечисления **аудиосессиондисконнектреасон** , определенного в аудиополици. h. Если устройство по умолчанию изменяется, клиент должен ждать уведомлений (если они еще не были получены), которые сопровождаются значением **дисконнектреасондевицеремовал** . В ответ на такие уведомления клиент может повторно открыть поток на новом устройстве по умолчанию.

Так как все эти операции являются асинхронного, порядок, в котором приложение получает уведомления, не может быть прогнозируемым. Однако обычно приложение получает значение **аудиосессиондисконнект** перед уведомлением об изменении устройства по умолчанию.

### <a name="format-change-notifications"></a>Уведомления об изменении формата

Изменения в звуковом формате происходят при изменении формата потока. Это может произойти, когда пользователь выбирает новый формат на панели управления **звуком** или новое устройство по умолчанию поддерживает новый формат (например, HDMI или некоторые профессиональные звуковые интерфейсы с ручной корректировкой курсов). Чтобы уведомить клиента об этих типах изменений формата, ВАСАПИ отправляет уведомление сеанса зарегистрированной реализацией [**иаудиосессионевентс:: онсессиондисконнектед**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) с причиной отключения **дисконнектреасонформатчанжед**. Клиент может справиться с уведомлением, повторно открыв поток в новом формате.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сведения об API Ммдевице](mmdevice-api.md)
</dt> <dt>

[О ВАСАПИ](wasapi.md)
</dt> <dt>

[Потоковая маршрутизация](stream-routing.md)
</dt> </dl>

 

 



