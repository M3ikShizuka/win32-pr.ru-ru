---
description: Элементы управления громкостью
ms.assetid: e6d112f9-08c9-4d95-b37b-267beebd0d7f
title: Элементы управления громкостью
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: add29b18b39c942c54926190ef9c0f85e447bb88
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896069"
---
# <a name="session-volume-controls"></a>Элементы управления громкостью

Как упоминалось ранее, клиенты ВАСАПИ могут отдельно контролировать уровень громкости каждого [сеанса аудио](audio-sessions.md). ВАСАПИ применяет параметр тома для сеанса единообразно для всех потоков в сеансе. Каждый уровень громкости — это значение в диапазоне от 0,0 до 1,0, где 0,0 означает тишину, а 1,0 — полный том (без затухания).

Клиент неявно создает сеанс, назначая первый поток этому сеансу. Уровень громкости нового сеанса по умолчанию — 1,0. Как обсуждалось ранее, пользователь может настроить уровень громкости сеанса с помощью пользовательского интерфейса управляющей программы (например, Сндвол), которая является клиентом ВАСАПИ. Параметры элемента управления являются постоянными.

В дополнение к параметрам, управляемым клиентом, система применяет собственные параметры тома к сеансам. Эти параметры основаны на политике аудио и динамически изменяются в ответ на изменения в потоках, составляющих глобальные звуковые МИКШЕРЫ. Дополнительные сведения о политике аудио см. в разделе [звуковые компоненты пользовательского режима](user-mode-audio-components.md).

Системное программное обеспечение, реализующее регулятор громкости для каждого потока, умножает примеры PCM в потоке на действующий уровень громкости. Эффективный уровень громкости — это результат умножения параметров "клиент" и "системный том". Таким результатом, результирующее изменение в амплитуде сигнала — это линейное сочетание уровней громкости клиента и системного тома. Например, если уровень громкости клиента — 0,8, а системный уровень громкости — 0,5, то действует действующий уровень громкости (0,8)<sup>.</sup> (0,5) = 0,4.

Обратите внимание, что воспринимаемая громкость не является линейной по отношению к амплитуде сигнала. Вместо этого громкость варьируется примерно как логарифм уровня громкости v:

громкость в децибел = 20<sup>.</sup> log ₁ ₀ (v)

Таким образом, установка v = 0,5 ослабления громкости исходного сигнала (сигнала до применения уровня громкости) на 6 децибел, установка v = 0,25 ослабление сигнала на 12 децибел и т. д. Уровень громкости v = 1,0, соответствующий 0 децибел, не изменяет исходный уровень сигнала.

Звуковые приложения с пользовательскими интерфейсами для управления уровнем громкости обычно отображают ползунки, которые создают изменения в воспринимаемом звуке, линейно пропорционально изменениям в положении ползунка. Чтобы создать линейную связь между наблюдаемой громкостью и положением ползунка, приложение должно определить нелинейную связь между уровнями громкости v и ползунком. Дополнительные сведения см. в разделе [регуляторы громкости звука](audio-tapered-volume-controls.md).

Как упоминалось ранее, программа системного управления громкостью, Сндвол, отображает ползунки громкости для звуковых сеансов, которые воспроизводятся на каждом устройстве отображения звука. Эти ползунки отображаются в поле Группа под названием **приложения** в окне сндвол. Как правило, каждый сеанс содержит все потоки воспроизведения из определенного окна приложения. С помощью ползунков в окне Сндвол пользователи управляют уровнями громкости отдельных звуковых приложений.

Как правило, приложение должно назначить все потоки воспроизведения одному и тому же сеансу звука. ВАСАПИ не мешает приложению распространять потоки воспроизведения между несколькими сеансами. Однако итоговый рост количества ползунков громкости в Сндвол может запутать пользователей.

Как вариант, окно приложения может отображать ползунок громкости. Ползунок приложения должен всегда отражать состояние соответствующего ползунка Сндвол. Таким образом, если пользователь изменяет уровень громкости, перемещая ползунок в окне приложения, соответствующий ползунок в окне Сндвол должен перемещаться в одновременном с помощью ползунка приложения. Аналогичным образом, если пользователь перемещает ползунок Сндвол, то ползунок приложения должен перемещаться в одновременном с помощью ползунка Сндвол.

Для поддержки такого поведения ВАСАПИ реализует интерфейс [**исимплеаудиоволуме**](/windows/desktop/api/Audioclient/nn-audioclient-isimpleaudiovolume) . Когда пользователь перемещает ползунок приложения, приложение вызывает метод [**исимплеаудиоволуме:: сетмастерволуме**](/windows/desktop/api/Audioclient/nf-audioclient-isimpleaudiovolume-setmastervolume) , чтобы соответствующим образом настроить уровень громкости сеанса. Сндвол отслеживает изменения тома, сделанные с помощью этого метода, и отражает изменения в ползунках громкости, которые он отображает. Кроме того, приложение может получать уведомления об изменениях в томе сеанса, которые пользователь выполняет через Сндвол. Для этой цели приложение реализует интерфейс [**иаудиосессионевентс**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) и регистрирует интерфейс с помощью васапи. Затем каждый раз, когда пользователь изменяет уровень громкости сеанса через Сндвол, приложение получает вызов уведомления через метод [**иаудиосессионевентс:: онсимплеволумечанжед**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsimplevolumechanged) . Пример кода, в котором реализуется интерфейс **иаудиосессионевентс** , см. в разделе [события сеанса звука](audio-session-events.md). Пример кода, который регистрирует интерфейс **иаудиосессионевентс** , см. в разделе [события аудио для устаревших аудио приложений](audio-events-for-legacy-audio-applications.md).

Интерфейс **исимплеаудиоволуме** применяет одинаковый уровень громкости ко всем каналам в сеансе аудио. Несмотря на то что этот интерфейс должен удовлетворять требованиям к управлению томами большинства приложений, для некоторых приложений может потребоваться более специализированный набор возможностей управления томами. Интерфейс [**иаудиостреамволуме**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiostreamvolume) управляет объемом отдельного потока в сеансе относительно других потоков в сеансе. **Иаудиостреамволуме** также позволяет клиенту отдельно управлять уровнями громкости всех каналов в потоке. Например, приложение может использовать эту возможность для достижения звуковых эффектов, таких как имитация пространственного перемещения источника звука путем панорамирования слева направо. Другой специализированный интерфейс, [**ичаннелаудиоволуме**](/windows/desktop/api/Audioclient/nn-audioclient-ichannelaudiovolume), управляет уровнями громкости отдельных каналов в сеансе. Например, приложение может использовать **ичаннелаудиоволуме** для реализации контроля баланса для звуковой системы стереофоник.

Ползунки громкости в поле **приложения** в сндвол отражает только изменения томов, сделанные через интерфейс **исимплеаудиоволуме** . Они не отображают изменения томов, сделанные через интерфейсы **иаудиостреамволуме** и **ичаннелаудиоволуме** . Хотя некоторые приложения могут позволить пользователям напрямую или косвенно управлять параметрами тома с помощью **иаудиостреамволуме** и **ичаннелаудиоволуме**, разработчикам следует избегать показа ползунков приложения для этих параметров, которые пользователи могут запутать с ползунками громкости в сндвол. В противном случае пользователь может переместить ползунок приложения, ожидаемый, чтобы увидеть изменение, отраженное в Сндволм ползунке, и стать запутанным, если такое изменение не происходит. Разработчики могут избежать этой проблемы с помощью тщательного проектирования пользовательского интерфейса.

Эффективный уровень громкости любого канала в сеансе субмикс, как слышал на динамиках, — это произведение следующих четырех факторов уровня громкости:

-   Уровни громкости на одном канале потоков в сеансе, которые клиенты могут контролировать с помощью методов в интерфейсе **иаудиостреамволуме** .
-   Уровень громкости на уровне канала, который клиенты могут контролировать с помощью методов в интерфейсе **ичаннелаудиоволуме** .
-   Главный уровень громкости сеанса, который клиенты могут контролировать с помощью методов в интерфейсе **исимплеаудиоволуме** .
-   Уровень громкости сеанса, основанный на политиках, который динамически изменяется при изменении глобальных наборов.

Каждый из четырех факторов уровня громкости в приведенном выше списке представляет собой значение в диапазоне от 0,0 до 1,0, где 0,0 означает тишину, а 1,0 — полный том (без затухания). Действующий уровень громкости также является значением в диапазоне от 0,0 до 1,0.

Обработчик звука применяет действующий уровень громкости для каждого канала к каналам в потоке, прежде чем смешивать поток с другими потоками в сеансе аудио. Если любые примеры значений в канале превышают 0 децибел после того, как звуковая подсистема умножает их на действующий уровень громкости, подсистема обрезает примеры перед их добавлением в сеанс субмикс.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Регуляторы громкости](volume-controls.md)
</dt> </dl>

 

 



