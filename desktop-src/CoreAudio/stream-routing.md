---
description: Маршрутизация потоков — это способность приложения мультимедиа переключать потоки между устройствами с минимальным перерывом в воспроизведении или сеансе записи.
ms.assetid: fc6efe89-013c-47af-870e-8705fa60c99c
title: Потоковая маршрутизация
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b21cd15a4467cb9b08747119aab999882ae3b5f
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496350"
---
# <a name="stream-routing"></a>Потоковая маршрутизация

*Маршрутизация потоков* — это способность приложения мультимедиа переключать потоки между устройствами с минимальным перерывом в воспроизведении или сеансе записи.

Компьютер может иметь несколько устройств отрисовки и записи. Система перечисляет эти устройства на панели управления " **звуки** ". Из этого списка пользователь может задать устройство как устройство по умолчанию для каждой роли: воспроизведение, запись или четыре роли связи (визуализация консоли, захват консоли, Визуализация связи или захват связи). Список устройств может быть изменен динамически, так как некоторые из этих устройств могут быть временно доступны, например гарнитура USB. Если доступно несколько устройств, пользователь может изменить устройство по умолчанию на другое. Пользователь также может изменить формат устройства (частота выборки, бит на выборку и т. д.) на вкладке **Дополнительно** для свойств устройства.

Рассмотрим ситуацию, в которой пользователь выбирает **динамики** в качестве устройства по умолчанию для подготовки к просмотру звуковых потоков. Затем пользователь подключает гарнитуру USB, выбирает гарнитуру в качестве нового устройства по умолчанию и изменяет частоту дискретизации устройства с 44,1 кГц на 48 кГц. Пользователь хочет воспроизвести аудиопоток на гарнитуре с новым темпом дискретизации с минимальным перерывом в сеансе потоковой передачи.

В этом сценарии существует два варианта, которые должны быть обработаны приложением мультимедиа:

-   Поток должен быть передан на новое устройство по умолчанию с минимальным перерывом в воспроизведении.
-   Новое устройство должно возобновить воспроизведение в новом формате (то есть пользователь может изменить больше частоты выборки).

В Windows Vista для поддержки этого сценария приложению мультимедиа пришлось предоставить реализацию для потоковой маршрутизации. Приложение было ответственным за завершение существующих потоков и перезапуск потоков на новом устройстве. Если пользователь изменил устройство по умолчанию или изменил его формат Mix, все связанные сеансы были закрыты и приложению пришлось бы справиться с восстановлением.

В Windows 7 приложение может легко передавать поток из существующего устройства по умолчанию в новую конечную точку звука по умолчанию. Высокоуровневые наборы API аудио, такие как Media Foundation, DirectSound и WAVE API, реализуют функцию маршрутизации потоков. Приложения мультимедиа, использующие эти наборы API для воспроизведения или записи потока из устройства по умолчанию, используют реализацию по умолчанию и не должны изменять приложение. Однако если приложение мультимедиа использует Ммдевицеапи или ВАСАПИ напрямую, приложение должно предоставить реализацию маршрутизации потоков.

> [!Note]  
> Ммдевицеапи и ВАСАПИ — это основные компоненты API аудио, которые приложение может использовать для отображения или записи потока на устройстве. Ммдевицеапи обнаруживает новое устройство конечной точки аудио, а ВАСАПИ управляет потоком звуковых данных между приложением мультимедиа и устройством конечной точки аудио.

 

Чтобы реализовать функцию маршрутизации потоков, приложение должно прослушивать уведомления, отправленные Ммдевицеапи и ВАСАПИ, когда:

-   Устройство по умолчанию изменяется пользователем.
-   Существующее устройство по умолчанию удаляется, и добавляется новое устройство по умолчанию.
-   Формат устройства изменился.

Обрабатывая эти уведомления, приложение может выполнять необходимые операции управления потоками при передаче потока на новое устройство по умолчанию. Кроме того, приложение может отображать или записывать существующие потоки, используя новый формат, заданный пользователем, пока активен сеанс отрисовки.

В этом разделе рассматриваются следующие вопросы.

-   [Получение конечной точки устройства для маршрутизации потоков](getting-the-default-device-endpoint-for-stream-routing.md)
-   [Соответствующие уведомления для потоковой маршрутизации](relevant-device-notifications-for-stream-routing.md)
-   [Рекомендации по реализации потоковой маршрутизации](stream-routing-implementation-considerations.md)

Следующие примеры, включенные в Windows SDK, демонстрируют, как приложение может управлять уведомлениями маршрутизации потоков.

-   [рендершаредтимердривен](rendersharedtimerdriven.md)
-   [рендершаредевентдривен](rendersharedeventdriven.md)
-   [рендерексклусиветимердривен](renderexclusivetimerdriven.md)
-   [рендерексклусививентдривен](renderexclusiveeventdriven.md)
-   [каптурешаредтимердривен](capturesharedtimerdriven.md)
-   [каптурешаредевентдривен](capturesharedeventdriven.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Управление потоками](stream-management.md)
</dt> <dt>

[Сведения об API Ммдевице](mmdevice-api.md)
</dt> <dt>

[О ВАСАПИ](wasapi.md)
</dt> </dl>

 

 



