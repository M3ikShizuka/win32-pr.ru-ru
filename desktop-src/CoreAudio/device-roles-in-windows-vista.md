---
description: Работа с ролями устройств
ms.assetid: 3b2cb1fe-0f11-4509-a6f3-513d2755cd29
title: Работа с ролями устройств
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c21ea667a6974634c1f9f0657dd02c13a621641c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103990330"
---
# <a name="working-with-device-roles"></a>Работа с ролями устройств

[API ммдевице](mmdevice-api.md) поддерживает роли устройств. Перечисление [**ероле**](/windows/win32/api/mmdeviceapi/ne-mmdeviceapi-erole) определяет роли устройств, поддерживаемые API ммдевице.

> [!Note]  
> Хотя [API ммдевице](mmdevice-api.md) поддерживает роли устройств, Пользовательский интерфейс в Windows Vista не реализует поддержку этой функции.

 

Приложение может использовать API Ммдевице для поддержки [ролей устройств](device-roles.md) с помощью методов [**Иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) и [**иммнотификатионклиент:: ондефаултдевицечанжед**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) . Однако пользовательский интерфейс в Windows Vista не поддерживает назначение отдельных ролей различным устройствам. В Windows Vista пользовательский интерфейс позволяет пользователю выбрать звуковое устройство по умолчанию для подготовки к просмотру и звуковое устройство по умолчанию для записи. Когда пользователь выбирает устройство подготовки или записи по умолчанию, система назначает этому устройству все три роли устройств (Еконсоле, Емултимедиа и Екоммуникатионс). Приложения не могут изменять роли, назначенные устройствам конечных точек звука. Операционная система позволяет назначать роли устройства только пользователю.

Клиент может зарегистрироваться для получения уведомления от API Ммдевице каждый раз при возникновении изменений в назначении ролей для устройств конечных точек звука. Когда роль перемещается с одного устройства на другое, клиент может выбрать, следует ли продолжить воспроизведение (или запись) своих потоков через то же устройство или переключить потоки на другое устройство. По умолчанию потоки продолжают воспроизводиться (или записываются) через исходное устройство. Чтобы переключить потоки на другое устройство в Windows Vista, клиент должен удалить потоки на исходном устройстве и создать на новом устройстве потоки для замены. В Windows 7 клиент может прослушивать новые уведомления, чтобы реализовать простой коммутатор без прерывания воспроизведения или сеанса записи. Дополнительные сведения см. в статье [Маршрутизация потоков](stream-routing.md).

Если вы планируете использовать Windows Vista для тестирования приложения, можно настроить тестовую среду, чтобы убедиться, что приложение ведет себя ожидаемым образом, когда пользователь может назначить отдельные роли устройств различным устройствам. Чтобы узнать больше, отправьте электронное письмо по адресу uaa@microsoft.com.

## <a name="communication-devices"></a>Устройства связи

Пользовательский интерфейс Windows 7 обладает возможностью добавления *устройств связи*. Панель управления **звуком** позволяет пользователю выбрать устройство связи по умолчанию для отображения и записи звукового потока. По умолчанию при подключении нового устройства к компьютеру операционная система выполняет автоматическую определение роли и определяет, подходит ли устройство для роли Екоммуникатион. Нацеливание на устройства связи позволяет разрабатывать приложения, использующие основные API-интерфейсы для внедрения решений для обмена данными с телефоном. Например, приложение VoIP может назначать потоковые входные и выходные потоки для записи по умолчанию и визуализации устройств конечных точек с помощью роли Екоммуникатионс. Как и любой другой поток, коммуникационное приложение должно получить ссылку на конечную точку коммуникационного устройства, вызвав [**иммдевицеенумератор:: жетдефаултаудиоендпоинт**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint). В этом вызове приложение должно указать **екоммуникатионс** в параметре *Role* . Операции потока ВАСАПИ в потоке, открытом на коммуникационном устройстве, похожи на любой другой аудиопоток. Приложение для обмена данными может улучшить взаимодействие с пользователем, реализуя такие поведения, как дуккинг, обрабатывая уведомления из конечной точки устройства. Дополнительные сведения см. в разделе [Использование коммуникационного устройства](using-the-communication-device.md).

## <a name="automatic-device-role-detection"></a>Автоматическое обнаружение роли устройства

Рассмотрим ситуацию, в которой компьютер имеет устройство отрисовки по умолчанию, динамики и устройство записи по умолчанию — микрофон. Пользователь подключает гарнитуру USB к компьютеру. После установки соответствующих драйверов операционная система пытается определить роль, которую нужно назначить новому звуковому устройству.

В Windows 7 функция обнаружения ролей устройства значительно улучшилась, чтобы определить соответствующие роли для звуковых устройств. Все звуковые устройства содержат набор параметров конфигурации, заполненных OEM-производителем устройства, что помогает системе решить, как использовать устройство. Эти параметры включают в себя такие сведения, как физическое расположение аудиоразъемов, тип устройства, подтип розетки и возможности обнаружения, чтобы система могла определить, подключено ли устройство. Извлекая эти значения с устройства, операционная система определяет роль, назначенную устройству. В этом сценарии система запросила USB-устройство гарнитуры, выполнил автоматическое обнаружение ролей и решил, что устройство лучше всего подходит для устройства связи.

Приложение также может получать сведения о гнездах с помощью основных API-интерфейсов аудио. Дополнительные сведения см. в разделе [**иксжаккдескриптион**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription) и [**IKsJackDescription2**](/windows/desktop/api/Devicetopology/nn-devicetopology-iksjackdescription2).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Роли устройств](device-roles.md)
</dt> </dl>

 

 



