---
description: Сеансы аудио
ms.assetid: b8a1b656-a582-4112-99e9-bd575719ebb3
title: Сеансы аудио
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57ae67a3eafe7a76add2fad192823868304e860d
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127165135"
---
# <a name="audio-sessions"></a>Сеансы аудио

*Сеанс звука* — это группа связанных звуковых потоков, которыми может управлять клиент васапи. Клиенты могут управлять уровнем громкости и состоянием отключения каждого отдельного сеанса. Система применяет указанный клиентом том и постоянно выключает параметры для всех потоков в сеансе.

Когда клиент инициализирует звуковой поток, он назначает звуковой поток сеансу аудио. Дополнительные сведения см. в разделе [**иаудиоклиент:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize).

Сеанс звука содержит либо потоки отрисовки, либо потоки записи, но не оба. По умолчанию том и выключение параметров для сеанса подготовки к просмотру сохраняется во время перезагрузки системы. Том и параметры отключения для сеанса записи не являются постоянными. (Сеанс, содержащий потоки, работающие в режиме замыкания на себя, обрабатывается как сеанс записи. То есть параметры сеанса не являются постоянными. Дополнительные сведения о режиме замыкания на себя см. в разделе [запись замыкания на себя](loopback-recording.md).)

Каждый поток аудио принадлежит ровно одному сеансу. Клиент назначает звуковой поток определенному сеансу во время инициализации объекта потока. Поток оставляет свое членство в сеансе в течение времени существования потока. После создания объекта Stream объект существует до тех пор, пока клиент не выпустит последнюю подсчитанную ссылку на объект, а затем объект будет удален.

Хотя клиент не может изменить сеанс, к которому назначен существующий поток, он может добиться аналогичного результата, удалив поток (освобождая все ссылки на него), создав новый поток для замены удаленного потока и назначив новый поток другому сеансу.

Каждый сеанс отрисовки представляет собой подмножество потоков, образующих глобальный набор, который воспроизводится через определенное [устройство аудио конечных точек](audio-endpoint-devices.md). Глобальный набор объединяет все сеансы всех приложений, совместно использующих устройство.

Часто приложение с несколькими потоками назначает все свои потоки одному сеансу. Однако приложение может в качестве варианта назначить различные потоки для разных сеансов. Любой поток, который приложение явно не назначает сеансу, принадлежит сеансу по умолчанию.

Обычные звуковые приложения следует избегать изменения громкости и отключения параметров сеансов. Вместо этого пользователи управляют этими параметрами с помощью пользовательских интерфейсов управляющих программ. например, в Windows Vista системная программа, Sndvol.exe, отображает элемент управления "громкость" и выключает управление для каждого активного или недавно активного сеанса отрисовки в системе. С помощью этих элементов управления пользователи могут настраивать том и отключить параметры для всех сеансов в системе.

В настоящее время программа Сндвол отображает регуляторы громкости для отображения звуковых устройств в конечных точках. Он не отображает элементы управления громкостью для устройств записи звука.

Сеанс активен, если он содержит один или несколько активных потоков. Активный поток находится в *состоянии выполнения*. Неактивный поток находится в *остановленном состоянии*. Если первый поток станет активным, сеанс станет активным. Сеанс станет неактивным, когда его последний активный поток станет неактивным. После неактивности сеанса в течение определенного периода времени система изменяет состояние сеанса с неактивного на срок действия.

Сндвол отображает громкость и выключает элементы управления для всех активных и неактивных сеансов отрисовки. Сндвол удаляет том и выключает элементы управления для сеанса, когда состояние сеанса меняется с неактивного на истечение срока действия или когда сеанс завершается. (Сеанс завершается при удалении последнего из его потоков; то есть когда клиент освобождает итоговый счетчик ссылок на последний оставшийся объект потока в сеансе.) Единственным исключением из этого правила является звук системного уведомления. Сндвол всегда отображает том и выключает элементы управления для звуков системного уведомления, независимо от состояния сеанса для этих звуков.

Как правило, поток принадлежит сеансу, который охватывает только процесс, содержащий приложение, создавшее поток. Однако приложения имеют возможность определять межпроцессные сеансы, объединяющие потоки из двух или более процессов.

ВАСАПИ поддерживает сеансы между процессами в основном, чтобы:

-   Программа Сндвол может предоставить пользователю единый регулятор громкости для управления звуком системного уведомления во всех приложениях.
-   Проигрыватель мультимедиа, работающий в одном процессе, может передавать защищенное содержимое в программу расшифровки, которая выполняется в другом процессе.

Аналогично параметрам управления для сеансов отрисовки, зависящих от процесса, параметры управления для сеансов отрисовки между процессами по умолчанию сохраняются в постоянном перезапуске системы. ВАСАПИ предоставляет такое поведение в основном для преимуществ звуков уведомлений системы, которые должны хранить громкость пользователя и отключать параметры, так как набор приложений изменяется со временем.

Программа Сндвол помечает регулятор громкости для каждого сеанса с отображаемым именем и значком. Клиент имеет возможность явно назначить отображаемое имя и значок для сеанса. Если клиент не предоставил эти элементы, Сндвол отображает имя по умолчанию и значок по умолчанию. Имя по умолчанию включает сведения, такие как заголовок окна приложения. Значок по умолчанию — значок для окна приложения. В случае сеансов, зависящих от процесса, эти значения по умолчанию предоставляют пользователям осмысленную информацию. Обратите внимание, что межпроцессный сеанс может быть связан с более чем одним приложением. В этом случае значимыми являются только отображаемые имя и значок, предоставленные клиентом.

Несмотря на то, что громкость и параметры выключения для сеанса подготовки к просмотру сохраняются, по умолчанию, сохраняемые при перезапуске системы, отображаемое имя и значок, предоставляемые клиентом, не являются. Чтобы убедиться, что в Сндвол отображается имя и значок, предоставленные клиентом, клиент должен явно назначить имя и значок для сеанса в момент, когда клиент назначит первый поток в сеансе. Система оставляет отображаемое имя и значок для сеанса только до завершения сеанса.

Каждый сеанс идентифицируется идентификатором GUID сеанса. В момент открытия потока клиентом он назначает этот поток определенному сеансу. Клиент предоставляет следующие два фрагмента информации для обнаружения этого сеанса:

-   Идентификатор GUID сеанса.
-   Является ли сеанс межпроцессным или зависящим от процесса. сеанс, зависящий от процесса, содержит только потоки из процесса клиента.

Эти сведения достаточно для того, чтобы отличить определенный сеанс от всех других сеансов на том же компьютере. Идентификатор GUID сеанса для сеанса конкретного процесса однозначно определяет сеанс только в пределах области процесса, владеющего сеансом. Идентификатор GUID сеанса для межпроцессного сеанса, напротив, уникален в пределах области действия всех процессов, запущенных на компьютере.

В случае сеанса конкретного процесса система использует сочетание идентификатора GUID сеанса и идентификатора процесса для уникальной идентификации сеанса в области действия компьютера. Таким образом, если клиенты в двух разных процессах присваивают своим потокам два сеанса для конкретного процесса с идентичными идентификаторами GUID сеанса, система рассматривает сеансы как отдельные, так как их идентификаторы различаются. Кроме того, если межпроцессный сеанс использует тот же идентификатор GUID сеанса, что и один или несколько сеансов конкретного процесса, система рассматривает межпроцессный сеанс как отдельный от сеансов конкретного процесса, даже если они совместно используют один и тот же идентификатор GUID сеанса.

например, в Windows Vista api-интерфейсы более высокого уровня, такие как Windows мультимедийные функции **вавеауткскскс** и DirectSound, обычно назначают потоковые потоки, которые они создают, по умолчанию, сеансы конкретного процесса, определяемые значением guid guid для сеанса \_ NULL. Для клиентов этих API сеанс по умолчанию для каждого клиентского процесса отделен от сеансов по умолчанию для других клиентских процессов, даже если сеансы имеют идентичные идентификаторы GUID сеанса. Кроме того, если одно или несколько приложений назначают потоки в межпроцессный сеанс, определенный ИДЕНТИФИКАТОРом GUID GUID сеанса \_ null, система рассматривает этот межпроцессный сеанс как отдельный от сеансов по умолчанию, зависящих от процесса, использующих один и тот же идентификатор GUID сеанса. Соответственно, программа Сндвол отображает отдельный регулятор громкости для каждого сеанса, используемого по умолчанию для каждого клиента, и отображает дополнительный регулятор громкости для межпроцессного сеанса, который определяется ИДЕНТИФИКАТОРом GUID сеанса \_ null, если этот сеанс существует.

Каждый сеанс связан только с одним устройством звуковой конечной точки. Если два сеанса имеют идентичные идентификаторы GUID сеанса и идентификаторы процессов, но связаны с разными устройствами, система рассматривает два сеанса как отдельные. Сеанс не может содержать потоки захвата и отрисовки, так как поток отслеживания может быть связан только с устройством записи, а поток отрисовки может быть связан только с устройством отрисовки.

Как упоминалось ранее, объем и параметры звука для сеанса сохраняются во время перезагрузки системы. Два или более экземпляра приложения могут создавать сеансы, связанные с конкретными процессами, с идентичными идентификаторами GUID сеанса. С помощью программы Сндвол пользователь может выбрать другой том и отключить параметры для каждого из этих сеансов. После завершения этих сеансов система оставляет параметры управления только одного из этих сеансов — последний сеанс для завершения. Позже, если новый экземпляр приложения создает сеанс определенного процесса с тем же идентификатором GUID сеанса, что и раньше, этот сеанс наследует сохраненный ранее том и отключать параметры.

Приложение не должно пытаться добавить поток или управлять уровнем громкости сеанса, который принадлежит другому, несвязанному приложению. Кроме того, приложение не должно пытаться контролировать уровень громкости сеанса, управляемого системой, для звуковых уведомлений. Однако приложение может воспроизвести звук через сеанс системы для звуков уведомлений, вызвав функцию **PlaySound** . Дополнительные сведения см. в разделе [звуковые оповещения для устаревших аудио приложений](notification-sounds-for-legacy-audio-applications.md).

Приложение может зарегистрироваться для получения уведомлений при изменении состояния сеанса. Дополнительные сведения см. в разделе [события сеанса звука](audio-session-events.md).

В редких случаях приложение, которое создает сеанс конкретного процесса, может потребовать консолидации управления сеансами конкретного процесса для двух или более экземпляров приложения в одном элементе управления "том" в Сндвол. Дополнительные сведения см. в разделе [Группирование параметров](grouping-parameters.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Руководство по программированию](programming-guide.md)
</dt> </dl>

 

 



