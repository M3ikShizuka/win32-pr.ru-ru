---
description: Надежность и безопасность
ms.assetid: 1cbfabce-3d56-4e23-b9a7-02369c67e392
title: Надежность и безопасность
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8a0f0e4a244de2c1463cdadb76162c18b041812b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105684034"
---
# <a name="reliability-and-security"></a>Надежность и безопасность

Поскольку кодеки компонента Windows Imaging Component (WIC) будут вызываться из оболочки Windows и фотоальбома, авторы кодеков должны выполнить все усилия, чтобы обеспечить высокий уровень надежности и безопасности кодеков WIC.

Написание надежного кода во многом зависит от оптимальных методов программирования, эффективных проверок кода, тщательного тестирования модулей и тестирования сценариев. Кроме того, следующие рекомендации помогут убедиться, что кодек соответствует политикам Windows Vista в отношении надежности.

-   Включить отмену ввода-вывода.

    Авторы кодека должны предоставить конечному пользователю возможность отмены любой длительной операции. Эти кодеки поддерживаются кодеками WIC путем реализации Ивикбитмаппрогресснотификатион. Это позволяет вызывающему приложению указать функцию обратного вызова, которая будет вызываться кодеком через определенные интервалы для уведомления вызывающего объекта о ходе выполнения текущей операции. Когда приложение возвращает ошибку \_ , отменяемую из функции обратного вызова, кодек должен отменить все выполняющиеся операции и передать HRESULT обратно вызывающему объекту. Это особенно важно для необработанных кодеков, поскольку для декодирования полного необработанного изображения может потребоваться несколько секунд, а приложениям требуется способ отмены этой обработки.

-   Убедитесь, что код выполняется в наименьшей области, необходимой для выполнения своей функции.

    Авторы кодека должны убедиться, что кодек не потребляет больше ресурсов, чем требуется, или иметь больший объем области, чем требует. Областью кодеков в WIC является один файл изображения; кодек создается при загрузке файла изображения, а кодек освобождается при закрытии изображения. Так как компонент WIC является расширяемой платформой на основе компонентов, кодеки WIC будут перекрываться и выгружаться, а также запускаться и останавливаться в рамках одного процесса. Если базовая инфраструктура кодека требует, чтобы операции запуска и завершения в области больше одного образа, будет затронуто надежность. Программные кодеки с поддержкой WIC будут использоваться проводником Windows, а также другими приложениями. Таким образом, если кодек остается загруженным в течение времени существования процесса, память не будет эффективно освобождена, а сбой кодека может зависнуть в проводнике Windows и потенциально требует перезагрузки компьютера. (Рассмотрите, что кодек будет вызываться каждый раз при первом эскизе изображения в проводнике Windows: очень важно, чтобы это была упрощенная операция.)

-   Используйте средства статического и динамического анализа кода.

    -   Средства статического анализа:

        PREfix — для обнаружения ошибок во время компиляции.

        Предварительная проверка кода на наличие ошибок.

    -   Средства динамического анализа:

        AppVerifier — позволяет сделать приложения более устойчивыми, имитируя распространенные проблемы с реальными приложениями.

-   Проверьте все входные данные в проверках кода.

    Все параметры экспортированных методов и всех файловых данных должны быть тщательно проверены на допустимость и надежно отклоняться в случае сбоя, чтобы обеспечить защиту от переполнения буфера и невыполнения, арифметического переполнения, нестрогого потока и непредвиденных типов.

-   Используйте методы нечеткого тестирования файлов для обнаружения возможных сбоев и зависаний.

    Нечеткое тестирование файлов — это процесс тестирования кодека с произвольными входными переставляются.

    Существует две формы нечетких файлов: ненаправленный (случайный) нечеткий и направленный нечеткий. Непрямое нечеткое преобразование приводит к перенаправлению случайных битов, чтобы увидеть, может ли случайный ввод завершить работу кодека. При нечетком вводе пермутес входные данные на основе некоторых знаний о формате файла. Например, если имеется проверка избыточности цикла (CRC) в байте со смещением 32, то изменение всех байтов без обновления контрольной суммы, скорее всего, не будет выполнять большую часть кодепасс. В этом примере направленный четкий запрос должен исправить CRC при изменении любого байта.

    Входной набор образов для нечетких файлов должен быть создан таким образом, чтобы проверялось каждое сочетание параметров, поддерживаемое декодером. Например, если декодер поддерживает файлы с небольшим и обратным порядком байтов и три параметра сжатия, входной набор изображения должен состоять из файлов с прямым порядком байтов для каждого параметра сжатия и файлов с обратным порядком байтов для каждого параметра сжатия. Этот подход даст вам большой, но очень надежный набор входных образов для тестирования. Даже если ни одна камера не создает каждое из сочетаний, но декодер поддерживает эти теоретическые сочетания, авторы кодеков должны четко использовать эти входные данные.

    Безопасность может значительно повыситься за счет регулярного выполнения тестирования методом Монте для файлов изображений во время разработки кодека. Кодеки всегда должны иметь возможность обнаруживать повреждение файла изображения и корректно завершать работу в случае неправильно сформированного запроса или неверно сформированных данных.

-   Нагрузить код.

    Протестируйте кодек, запустив его непрерывно в нескольких одновременных процессах, выполняя все поддерживаемые операции во всех возможных последовательностях, на изображениях разного размера (включая очень крупные изображения) с каждой поддерживаемой камеры.

-   Безопасность потоков.

    Начиная с Windows 7, компонент WIC требует, чтобы необработанные КОДЕки применялись к типу подразделения COM "both". Это означает, что необходимо выполнить соответствующую блокировку для обработки вызывающих объектов и вызывающих потоков в многопоточных сценариях. Объекты в многопоточном апартаменте (MTA) могут вызываться параллельно любым числом потоков в MTA, что позволяет повысить производительность многоядерных систем и определенных серверных сценариев. Кроме того, КОДЕки WIC, которые находятся в агенте передачи сообщений, могут вызывать другие объекты, действующие в MTA, без затрат на упаковку, связанные с вызовом между потоками, которые находятся в разных апартаментах STA. В Windows 7 все встроенные КОДЕки WIC обновлены для поддержки MTA, включая JPEG, TIFF, PNG, GIF, ICO и BMP. сторонние КОДЕки, которые не поддерживают MTA, приводят к значительным затратам на производительность в многопоточных приложениях из-за упаковки. Для включения поддержки агента передачи сообщений необходимо, чтобы в коде стороннего производителя была реализована правильная синхронизация. Точная реализация этих методов синхронизации выходит за рамки данного документа. Ниже приведен общий справочник по синхронизации COM-объектов.

    https://msdn.microsoft.com/library/ms809971.aspx

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Общие сведения о компоненте создания образов Windows](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[Рекомендации по WIC для форматов необработанных изображений Camera](-wic-rawguidelines.md)
</dt> <dt>

[Написание WIC-Enabled КОДЕка](-wic-howtowriteacodec.md)
</dt> </dl>

 

 



