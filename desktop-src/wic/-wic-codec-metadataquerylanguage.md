---
description: В этом разделе описывается язык запросов метаданных для компонента Windows Imaging Component (WIC).
ms.assetid: 5ffa0a69-b53d-4be3-b802-deaaa743e6bd
title: Общие сведения о языке запросов метаданных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee4b55bdc7079565f98411e28977d3d8c41e191f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104551049"
---
# <a name="metadata-query-language-overview"></a>Общие сведения о языке запросов метаданных

В этом разделе описывается язык запросов метаданных для компонента Windows Imaging Component (WIC). Язык запросов метаданных используется для создания выражений, позволяющих находить определенные данные (элементы метаданных) и расположения (блоки метаданных) в метаданных изображения.

В этом разделе содержатся следующие подразделы.

-   [Предварительные условия](#prerequisites)
-   [Введение](#introduction)
-   [Анатомия выражения пути](#anatomy-of-a-path-expression)
    -   [Выбор блоков](#block-selection)
    -   [Выбор элементов](#item-selection)
    -   [Escape-символ](#escape-character)
    -   [Образцы выражений](#sample-expressions)
-   [Выражения политики метаданных фотографий](#photo-metadata-policy-expressions)
-   [Сводка по языку запросов метаданных](#metadata-query-language-summary)
-   [См. также](#related-topics)

## <a name="prerequisites"></a>Предварительные условия

Чтобы понять этот раздел, необходимо ознакомиться с системой метаданных WIC, как описано в статье [Общие сведения о метаданных WIC](-wic-about-metadata.md) и доступе к метаданным, как описано в [обзоре чтения и записи метаданных изображения](-wic-codec-readingwritingmetadata.md).

## <a name="introduction"></a>Введение

Взаимодействие с платформой метаданных в основном осуществляется через два компонента модели COM: средство чтения запросов, представленное интерфейсом [**ивикметадатакуериреадер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataqueryreader) , и модуль записи запроса, представленный интерфейсом [**ивикметадатакуеривритер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataquerywriter) . Эти компоненты позволяют считывать и записывать метаданные с помощью языка запросов метаданных. Язык запросов описывает синтаксис выражения пути, а компоненты запроса используют это выражение пути для доступа к нужным метаданным. Это выражение пути описывает расположение блока метаданных или элемента.

Блок метаданных — это именованная группа метаданных в определенном формате. Блок метаданных может содержать отдельные элементы метаданных, такие как автор или время создания, а также дополнительные блоки метаданных. Имя блока метаданных определяется его форматом. Например, блок метаданных, содержащий метаданные App1, будет называться App1. К общим форматам метаданных относятся App1, EXIF, IFD и XMP.

Элемент метаданных — это пара "имя-значение", описывающая такие характеристики, как "Автор", "заголовок" и "Оценка".

Выражение пути содержит одно или несколько имен блоков метаданных. Он также может указывать элемент метаданных в блоке метаданных. Следующее выражение пути представляет блок App1, содержащий блок IFD, который содержит элемент метаданных:

-   /APP1/IFD/{ushort = 18249}

На следующей схеме показан пример описывающего изображения в формате JPEG с четырьмя корневыми блоками метаданных: APP0, App1, XMP и неизвестный блок. Каждый выделенный элемент запрашивает тип метаданных (блок или элемент) и выражение запроса, используемое для получения данных.

![изображение JPEG с выносками метаданных](graphics/jpegwithcallouts.png)

> [!Note]  
> Содержимое этой схемы упоминается в этом документе и используется во многих примерах.

 

## <a name="anatomy-of-a-path-expression"></a>Анатомия выражения пути

Для доступа к метаданным с помощью API-интерфейсов WIC в большинстве случаев следует использовать полное выражение запроса. В этом разделе обсуждаются полные выражения для доступа к метаданным. Если вам нужны сведения о случаях, когда используются выражения, не являющиеся полными, см. раздел выражение политики метаданных фотографии далее в этом документе.

Что такое полное выражение запроса? В WIC полное выражение — это строка, которая начинается с символа косой черты (/), за которым следует путь перехода к блоку метаданных или определенный элемент метаданных. Каждый шаг в пути навигации отделяется косой чертой, образуя выражение для доступа к блоку метаданных или элементу метаданных. Например, ниже приведено полное выражение запроса, которое обращается к рейтингу Microsoft Photo в блоке IFD, вложенном в блок APP1:

-   /APP1/IFD/{ushort = 18249}

Когда компонент WIC анализирует это выражение, сначала он выполняет поиск блока метаданных APP1 в метаданных изображения. Если блок APP1 найден, он продолжит поиск в поисках вложенного блока метаданных IFD. Если блок IFD найден, он ищет конкретный элемент метаданных, в данном случае Микрософтфото оценку в теге 18249 в блоке метаданных IFD. Если компонент WIC не находит блок метаданных или элемент, он прерывает запрос.

### <a name="block-selection"></a>Выбор блока

Простейшее выражение запроса метаданных WIC — это выражение для получения модуля чтения или записи запроса для определенного блока метаданных. Получение модуля чтения и записи запросов позволяет перенаправлять последующие запросы непосредственно в вложенный блок метаданных без работы с родительским блоком. Выражение запроса выборки блока представляет собой путь перехода к нужному блоку метаданных. Например, на предыдущем рисунке имеется пять блоков метаданных, два из которых вложены в другие блоки метаданных. Ниже приведены выражения пути к каждому блоку метаданных в примере JPEG:

-   /app0
-   /APP1
-   /app1/ifd
-   /app1/ifd/exif
-   /ксмп

При использовании модуля чтения или записи запроса для выполнения запроса он возвращает новый модуль чтения или записи запроса, который служб выполняет запросы в области заданного блока метаданных. Например, если выполнить запрос «/App1», то будет получен новый модуль чтения запросов, а запросы к новому модулю чтения будут относиться к блоку App1. Это означает, что запрос "/ИФД" является допустимым для нового модуля чтения, так как блок APP1 содержит блок IFD. Однако "/КСМП" не будет работать, так как этот блок APP1 не содержит блок метаданных XMP.

Язык запросов также поддерживает нотацию индекса. Нотация индекса предоставляет доступ к определенному блоку метаданных, если существует несколько блоков одного типа. В примере с форматом JPEG можно использовать следующее выражение индексированного пути:

-   /\[0 \] APP1/ \[ 0 \] IFD

В языке запросов все индексы начинаются с нуля. В предыдущем выражении первые нулевые запросы к первому блоку App1 и второму нулю запрашивают первый вложенный блок IFD. Нотация индекса по-прежнему может использоваться, даже если не существует несколько блоков одного типа. Если в примере JPEG включен второй блок APP1 с внедренным блоком IFD, то \[ \] для доступа к второму блоку APP1 будет использоваться выражение "/1 APP1/IFD".

Нотация индекса становится более распространенной при работе с фрагментами текста в формате PNG, поскольку вполне вероятно, что изображение PNG будет иметь более одного текстового фрагмента.

> [!Note]  
> Индексы многомерных массивов не поддерживаются.

 

### <a name="item-selection"></a>Выбор элементов

Можно получить доступ к элементам метаданных в блоке метаданных, создав их в выражениях выбора блоков. В примере с форматом JPEG рассмотрите свойства XMP и Microsoft Photo рейтинга. Эти метаданные существуют в двух блоках метаданных: в блоках APP1/IFD и XMP. Поэтому для доступа к одним и тем же данным можно использовать более одного выражения. Следующее выражение обращается к оценке Микрософтфото в блоке XMP:

-   /КСМП/КСМП: Оценка

Часть "XMP:" выражения является понятным идентификатором схемы. XMP является расширяемым стандартом и позволяет сторонним субъектам публиковать собственные схемы, которые определяют способ хранения определенных элементов метаданных. Схема XMP полностью идентифицируется по URL-адресу, но WIC предоставляет набор понятных идентификаторов для хорошо известных схем. Дополнительные сведения см. в разделе [запросы метаданных в формате образа в машинном код](-wic-native-image-format-metadata-queries.md) .

Для изображений JPEG сведения о рейтинге также могут храниться в вложенном блоке IFD в App1. Однако, в отличие от примера рейтинга XMP, блок IFD не использует имя схемы для доступа к сведениям о рейтинге. Вместо этого используется выражение данных. Следующее выражение используется для доступа к оценке Микрософтфото в вложенном блоке IFD в App1:

-   /APP1/IFD/{ushort = 18249}

В этом выражении часть "/APP1/IFD" выражения представляет собой путь перехода к блоку IFD (как обсуждалось ранее в разделе выбора блока). Вторая часть выражения "/{ушорт = 18249}" обращается к данным. Эта часть выражения указывает средству синтаксического анализа запросов найти данные, внедренные в короткий тег без знака с идентификатором тега 18249.

> [!Note]  
> Список стандартных форматов метаданных, поддерживаемых каждым форматом изображений в, см. в разделе [запросы метаданных в формате образов в машинном код](-wic-native-image-format-metadata-queries.md) .

 

{Ushort = 18249} является выражением данных и может принимать несколько форм. Выражение данных — это выражение из двух частей, содержащее тег или ключ запрошенных метаданных, в данном случае "18249", и тип данных ключа, в данном случае "ushort". Две части разделяются знаком равенства (=). Виксуппортс большую часть общих типов данных C/C++. Язык запросов принимает следующие типы данных:

-   char
-   учар
-   short
-   ushort
-   long
-   ulong
-   INT
-   uint
-   longlong
-   FLOAT
-   double
-   str
-   встр
-   guid
-   bool

> [!Note]  
> В этом списке указываются только типы данных, поддерживаемые языком запросов метаданных. Используйте эти типы данных при создании выражения данных запроса метаданных, например {ushort = 18249}. WIC возвращает значение элемента метаданных в виде ПРОПВАРИАНТ, которое определяет собственную систему типов.

 

"18249" в примере является тегом данных. Это конкретное число определяется корпорацией Майкрософт для включения оценки Микрософтфото. В качестве тега данных может использоваться любое число, строка или идентификатор GUID в зависимости от искомого элемента данных.

В отличие от примера оценки XMP, конфликт имен для значения рейтинга в блоке APP1/IFD отсутствует. Это обусловлено тем, что значение рейтинга XMP фактически хранится в другом теге ushort 18246. Таким образом, выражение для доступа к рейтингу XMP в блоке APP1/IFD:

-   /APP1/IFD/{ushort = 18246}

> [!Note]  
> Формальное описание языка запросов метаданных см. в разделе Сводка по языку запросов метаданных далее в этом документе.

 

### <a name="escape-character"></a>Escape-символ

Язык запросов не учитывает регистр и обрабатывает все символы как строчные. Однако некоторые форматы метаданных (например, XMP) чувствительны к регистру. При работе с форматом метаданных с учетом регистра используйте символ обратной косой черты ( \\ ), если нужно указать символ в верхнем регистре.

Escape-символ используется анализатором языка, а следующий символ, следующий за ним, интерпретируется напрямую. Например, выражение {Char = \\ \\ } разрешается как " \\ ", а {char = \\ c} разрешается как прописная буква c. Без escape-символа {char = \\ } будет недопустимым выражением, а {char = C} будет интерпретироваться как строчная C. Обязательно используйте escape-символ обратной косой черты перед всеми прописными буквами в форматах метаданных с учетом регистра.

### <a name="sample-expressions"></a>Образцы выражений

В следующей таблице приведены некоторые примеры выражений и описаний их интерпретации анализатором языка запросов. 

| Выражение                     | Описание                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IFD/XMP/EXIF: автор            | Соответствует следующему пути перехода: "блок IFD-> XMP->" author "в схеме EXIF.                                                                                                                                                                                                                                            |
| /\[1 \] IFD/ \[ 0 \] XMP/EXIF: автор | То же, что и первый элемент в этой таблице, за исключением того, что \[ \# \] префикс описывает элемент для перехода в случае конфликта имен.                                                                                                                                                                                                                                |
| /ИФД/{ушорт = 700}/Аусор       | То же, что и первый элемент в этой таблице, за исключением того, что в нем используется выражение данных для ссылки на блок XMP вместо имени блока XMP (блок XMP внедряется под идентификатором неподписанного короткого тега 700). Кроме того, свойство Author не указывает схему. Средство синтаксического анализа запросов будет пытаться сопоставить свойство во всех схемах и вернуть первое совпадение. |
| /ифд/ксмп                       | Предоставляет путь навигации к блоку метаданных. Если блок найден, возвращается новый модуль чтения и записи метаданных.                                                                                                                                                                                                                                                 |
| /\[\*\]Текст/ключевое слово            | Возвращает или задает свойство ключевого слова для фрагмента PNG. Так как спецификация метаданных PNG позволяет создавать несколько фрагментов определенного типа, \[ \* \] нотация получает или задает фрагмент данных PNG с соответствующим свойством. В соответствии со спецификацией PNG ни один из двух блоков не может иметь одни и те же свойства.                                                                |



 

Каждый блок метаданных также однозначно идентифицируется идентификатором GUID метаданных, который можно использовать вместо понятного имени блока. Вместо указания имен блоков можно использовать следующий синтаксис: "/{гуид = GUID}/ \[ n \] {GUID = GUID}/счема: тагидентифиер"

В следующей таблице приведены некоторые недопустимые примеры и причины, по которым они будут отклонены. 

| Недопустимое выражение         | Описание отклонения                                                                                                                                                  |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| /ИФД/ \[ 0 \] \[ 2 \] EXIF/       | Отклонено, так как многомерные индексы массивов не поддерживаются.                                                                                                    |
| /ИФД/{ушорт = 1}/{ушорт = 2} | Отклонено, если IFD имеет tagID = 1, который является обработчиком метаданных, содержащим элемент метаданных с tagID = 2.                                                        |
| /{ушорт = 1}                | Отклонено, если обработка запроса выполняется относительно верхнего уровня иерархии метаданных. Это связано с тем, что верхний уровень содержит только блоки метаданных, а не элементы данных. |



 

## <a name="photo-metadata-policy-expressions"></a>Выражения политики метаданных фотографий

Как отмечалось ранее, полное выражение запроса начинается с косой черты (/). Выражения, не начинающиеся с косой черты, оцениваются как выражения политики. Выражение политики позволяет запрашивать метаданные фотографий для [свойств оболочки](https://msdn.microsoft.com/library/ms788673(VS.85).aspx)Windows, связанных с изображением. В разделе "Выбор данных" выше в этом документе выражение "/КСМП/КСМП: Оценка" использовалось для доступа к свойству рейтинга XMP. Это свойство можно также запрашивать с помощью следующего выражения политики:

-   System. Симплератинг

Чтобы получить доступ к свойству рейтинга из схемы Микрософтфото, можно использовать следующее выражение запроса:

-   System. Оценка

Выражения политики метаданных фотографий работают не так, как в полностью определенных запросах метаданных.

Во-первых, при доступе к метаданным с помощью выражения политики компонент WIC выполняет арбитраж и разрешение конфликтов в случае, если одно и то же свойство доступно в нескольких блоках метаданных. Например, значения Микрософтфото и оценки XMP хранятся как в блоке APP1/IFD, так и в блоке XMP. Политика метаданных фотографий определяет приоритет, при котором значение блока возвращается при чтении метаданных. При написании метаданных политика метаданных фотографий гарантирует, что одни и те же свойства в разных блоках будут одинаковыми. При использовании запроса к метаданным, например "/КСМП/КСМП: Оценка", вы несете ответственность за арбитратинг между различными расположениями метаданных.

> [!Note]  
> Список поддерживаемых выражений политики и их политик сопоставления см. в разделе о [политиках метаданных фотографий](photo-metadata-policies.md) .

 

Во вторых, выражения политики метаданных фотографий не зависят от формата изображения, а полные запросы метаданных — нет. Например, запрос «/КСМП/КСМП: Оценка» относится к формату JPEG. Изображения в формате TIFF также поддерживают метаданные XMP, но хранятся по-разному по сравнению с форматом JPEG, поэтому запрос TIFF будет иметь вид "/ИФД/КСМП/КСМП: рейтинг". Однако в обоих случаях выражение политики будет иметь вид "System. Симплератинг".

Выражения политики метаданных фотографий обеспечивают более высокий уровень абстракции и простоты по сравнению с полными запросами к метаданным, поэтому они должны быть предпочтительными в случаях, когда не требуется доступ к метаданным низкого уровня. Однако выражения политики предоставляют доступ только к ограниченному набору метаданных изображения, тогда как язык запросов метаданных обеспечивает доступ практически ко всем метаданным, хранящимся в файле изображения.

## <a name="metadata-query-language-summary"></a>Сводка по языку запросов метаданных

Следующая таблица является формальным определением языка запросов метаданных WIC. Каждый символ грамматики представляет выражение, состоящие из других символов. Выражение может быть другим символом или последовательностью других символов, разделенных вертикальной чертой ( \| ), указывающей на вариант "или". Полное выражение справа — возможная подстановка для указанного символа слева. 

| Символ                   | Expression                                                                                                                                                                  |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \<path>             | \<name> \| '/' \<property path>                                                                                                                                   |
| \<property path>    | \<metadata item> \| \<property path> '/' \<property path>                                                                                                    |
| \<metadata item>    | \<index name> \| \<item name> \| \<schema name> ':' \<item name>                                                                                        |
| \<schema name>      | \<item name>                                                                                                                                                           |
| \<item name>        | \<metadata item> \| <indexed item><index>                                                                                                                  |
| \<indexed item>     | \<item> \| \<implied metadata>\<item>                                                                                                                        |
| \<implied metadata> | "<" \<name> > "                                                                                                                                                    |
| \<item>             | \<name> \| \<index> \<data> \| \<data>                                                                                                                  |
| \<data>             | '{' \<data type> '=' \<value> '}'                                                                                                                                 |
| \<index>            | '\[' \<number> \| \<star> '\]'                                                                                                                                    |
| \<data type>        | ' char ' \| ' Учар ' \| ' Short ' ' \| UShort ' \| ' длинное ' \| ulong ' \| ' int ' \| ' uint ' \| ' лонглонг ' \| ' улонглонг ' \| ' float ' \| ' Double ' ' \| str ' \| ' встр ' \| ' GUID ' ' \| bool ' |
| \<data value>       | \<number> \| \<name> \| \<guid>                                                                                                                              |
| \<star>             | '\*'                                                                                                                                                                        |
| \<number>           | number                                                                                                                                                                      |
| \<name>             | строка                                                                                                                                                                      |
| \<guid>             | guid                                                                                                                                                                        |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Общие сведения о компоненте создания образов Windows](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[Общие сведения о метаданных компонента WIC](-wic-about-metadata.md)
</dt> <dt>

[Общие сведения о чтении и записи метаданных изображений](-wic-codec-readingwritingmetadata.md)
</dt> <dt>

[Общие сведения о расширяемости метаданных](-wic-codec-metadatahandlers.md)
</dt> <dt>

[Пошаговое руководство. повторное кодирование изображения JPEG с помощью метаданных](-wic-codec-jpegmetadataencoding.md)
</dt> </dl>

 

 



