---
description: Реализация Ивикбитмапкодекпрогресснотификатион (декодер)
ms.assetid: 686b0875-c7ec-45ee-bd3e-94bfd9e5dcda
title: Реализация Ивикбитмапкодекпрогресснотификатион (декодер)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ff9af6bbd8c0457a5bf97f2f8b378cdeaca9269e792f7ed4696ab8e6a23b89a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119088066"
---
# <a name="implementing-iwicbitmapcodecprogressnotification-decoder"></a>Реализация Ивикбитмапкодекпрогресснотификатион (декодер)

## <a name="iwicbitmapcodecprogressnotification"></a>ивикбитмапкодекпрогресснотификатион

Когда кодек выполняет операцию ввода-вывода, например [**CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapsource-copypixels) , на большом изображении, выполнение может занять несколько секунд или даже минут. Если конечные пользователи не могут прерывать работу длительной операции, это может привести к зависанию приложения. Пользователи часто закрывают приложение или даже перезапускают свои компьютеры при попытке восстановить контроль над компьютером, когда приложение перестает отвечать на запросы.

Этот интерфейс позволяет приложению указать функцию обратного вызова, которую кодек может вызывать через заданные интервалы, чтобы уведомить вызывающего объекта о ходе выполнения текущей операции. Приложение может использовать эту функцию обратного вызова для отображения сведений о ходе выполнения в пользовательском интерфейсе, чтобы уведомить пользователя о состоянии операции. Если пользователь нажимает кнопку **Отмена** в диалоговом окне **ход выполнения** , приложение возвращает **винкодек Err \_ , \_ прерванное** из функции обратного вызова. В этом случае кодек должен отменить указанную операцию и передать этот **HRESULT** обратно вызывающему методу метода, который выполнял операцию.

Этот интерфейс должен быть реализован в классе декодера уровня контейнера.


```C++
interface IWICBitmapCodecProgressNotification : public IUnknown
{
    HRESULT RegisterProgressNotification ( 
        PFNProgressNotification pfnProgressNotification,
        LPVOID pvData,
        DWORD dwProgressFlags );
}
```



-   [регистерпрогресснотификатион](#registerprogressnotification)
-   [пфнпрогресснотификатион](#pfnprogressnotification)

### <a name="registerprogressnotification"></a>регистерпрогресснотификатион

[**Регистерпрогресснотификатион**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapcodecprogressnotification-registerprogressnotification) вызывается приложением для регистрации функции обратного вызова, которую кодек может вызывать через указанные интервалы. Первый параметр, *пфнпрогресснотификатион*, является указателем на функцию обратного вызова, которую кодек должен вызывать через регулярные интервалы.

Параметр *пвдата* указывает на некоторый объект, который вызывающий объект хочет передать кодеку обратно в функцию обратного вызова при вызове функции обратного вызова. Этот объект может быть любым, но не имеет особой значимости для кодека.

Параметр *двпрогрессфлагс* указывает, когда кодек должен вызывать функцию обратного вызова. Для этого параметра можно выполнить функцию или с двумя перечислениями. Перечисление [**викпрогрессоператион**](/windows/desktop/api/Wincodec/ne-wincodec-wicprogressoperation) указывает, следует ли вызывать функцию обратного вызова во время декодирования (**викпрогрессоператионкопипикселс**), кодировки (**Викпрожерссоператионвритепикселс**) или обоих (**WICProgressOperationAll**).


```C++
enum WICProgressOperation
{
   WICProgressOperationCopyPixels,
   WICProgerssOperationWritePixels,
   WICProgressOperationAll      
};
```



Кодек должен вызывать функцию обратного вызова через регулярные интервалы во всей операции, но вызывающая сторона может указать определенные требования. Перечисление [**викпрогресснотификатион**](/windows/desktop/api/Wincodec/ne-wincodec-wicprogressnotification) указывает, в какой точке операции следует вызвать функцию обратного вызова. Если вызывающий объект указывает **викпрогресснотификатионбегин**, необходимо вызвать его в начале операции (0,0). Если вызывающий объект не указывает это, он является необязательным. Аналогично, если вызывающий объект указывает **викпрожерсснотификатионенд**, необходимо вызвать его после завершения операции (1,0). Если вызывающий объект указывает **викпрогресснотификатионалл**, необходимо вызвать его в начале и в конце, а также через регулярные интервалы во всей операции. Вызывающий объект также может указывать **викпрожерсснотификатионфрекуент**, который указывает, что они должны быть вызваны с частыми интервалами, например после каждой пары строк проверки. (Вызывающий объект обычно использует этот флаг только для очень большого образа.) В противном случае обычно приходится выполнять обратный вызов с интервалом примерно 10% от общего числа обрабатываемых строк сканирования.


```C++
enum WICProgressNotification
{
   WICProgressNotificationBegin,
   WICProgerssNotificationEnd,
   WICProgerssNotificationFrequent,
   WICProgressNotificationAll
};
```



Только одна функция обратного вызова в каждый момент времени может быть зарегистрирована для конкретного декодера или экземпляра кодировщика. Если приложение вызывает [**регистерпрогресснотификатион**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapcodecprogressnotification-registerprogressnotification) несколько раз, замените ранее зарегистрированную функцию обратного вызова новой. Чтобы отменить регистрацию обратного вызова, вызывающий объект установит значение **null** для параметра *пфнпрогресснотификатион* .

### <a name="pfnprogressnotification"></a>пфнпрогресснотификатион

[**Пфнпрогресснотификатион**](/windows/desktop/api/Wincodec/nc-wincodec-pfnprogressnotification) — это функция обратного вызова со следующей сигнатурой.


```C++
typedef HRESULT (*PFNProgressNotification) ( 
   LPVOID pvData,
   ULONG uFrameNum,
   WICProgressOperation operation,
   double dblProgress );
```



При вызове функции обратного вызова используйте параметр *пвдата* , чтобы передать тот же *пвдата* , что и приложение, заданное при регистрации функции обратного вызова.

Параметр *уфраменум* должен указывать индекс обрабатываемого кадра.

Задайте для параметра операции значение **викпрогрессоператионкопипикселс** при декодировании и **викпрогрессоператионвритепикселс** при кодировании.

Параметр *дблпрогресс* должен быть числом в диапазоне от 0,0 (начало операции) до 1,0 (завершение операции). Значение должно отражать долю строк сканирования, уже обработанных относительно общего количества обрабатываемых строк сканирования.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Reference**
</dt> <dt>

[**прогресснотификатионкаллбакк**](/windows/desktop/api/Wincodec/nc-wincodec-pfnprogressnotification)
</dt> <dt>

[**ивикбитмапкодекпрогресснотификатион**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapcodecprogressnotification)
</dt> <dt>

**Зрения**
</dt> <dt>

[Реализация Ивикбитмапдекодер](-wic-imp-iwicbitmapdecoder.md)
</dt> <dt>

[Реализация IWICBitmapSource](-wic-imp-iwicbitmapsource.md)
</dt> <dt>

[Написание WIC-Enabled КОДЕка](-wic-howtowriteacodec.md)
</dt> <dt>

[Windows Общие сведения о компонентах обработки изображений](-wic-about-windows-imaging-codec.md)
</dt> </dl>

 

 



