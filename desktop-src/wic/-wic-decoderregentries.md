---
description: Decoder-Specific записи реестра
ms.assetid: 64ef260a-ed7f-4253-a644-bd3352b0ee41
title: Decoder-Specific записи реестра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 17485e7adca62abd31643d84d371a0002724ea9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105719729"
---
# <a name="decoder-specific-registry-entries"></a>Decoder-Specific записи реестра


В дополнение к записям реестра, необходимым для всех кодировщиков и декодеров, для декодеров требуются следующие записи реестра.

Эти записи регистрируют декодер в категории декодеров компонента обработки изображений Windows (WIC). Первым идентификатором GUID в этих записях является идентификатор категории (CATID) для [**wicbitmapencoders**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder).

```
HKEY_CLASSES_ROOT
   CLSID
      {7ED96837-96F0-4812-B211-F13C24117ED3}
         Instance
            {Decoder CLSID}
               CLSID = {Decoder CLSID}
               FriendlyName = {Name of Decoder}
```

Как отмечалось в разделе [Обнаружение и арбитраж](-wic-howwicworks.md) , как работает компонент Windows Imaging, механизм, который позволяет обнаружить соответствующий декодер для определенного изображения во время выполнения, основан на соответствии идентифицирующему шаблону, внедренному в файл изображения, с шаблоном, указанным в записи реестра декодера. Чтобы включить обнаружение декодеров во время выполнения, необходимо зарегистрировать уникальный идентифицирующий шаблон для формата изображения следующим образом. Все эти записи реестра являются обязательными, за исключением записи **EndOfStream** , которая является необязательной, как описано в следующей таблице.

```
HKEY_CLASSES_ROOT
   CLSID
      {Decoder CLSID}
         Patterns
            {0}
               Position = Offset in block
               Length = Length of pattern
               Pattern = Pattern to match
               Mask = FF FF FF FF
               EndOfStream = 0|1
```



| Значение       | Описание                                                                                                                                                                                                                                                                                                                     |
|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Положение    | Смещение в файле, где можно найти шаблон.                                                                                                                                                                                                                                                                        |
| Длина      | Длина шаблона.                                                                                                                                                                                                                                                                                                      |
| Модель     | Фактические биты, составляющие шаблон. Это биты, которые сопоставляются с идентифицирующим шаблоном в файле изображения во время обнаружения.                                                                                                                                                                                |
| Mask        | Позволяет использовать подстановочные значения в шаблонах. Маска применяется путем выполнения логической операции AND над шаблоном и маской. Любой бит в шаблоне, соответствующий биту маски со значением 0, игнорируется.                                                                                                       |
| EndOfStream | Смещение идентифицирующего шаблона должно быть вычислено с конца потока, а не с начала. Некоторые форматы изображений помещают идентифицирующий шаблон в конец файла или рядом с ним. Поскольку значение по умолчанию — поиск с начала, если шаблон не находится ближе к концу файла, эту запись можно опустить. |



 

Кодек может поддерживать более одного идентифицирующего шаблона. В этом случае следует повторить все ключи в разделе **классы hKey root CLSID \_ \_ \\ \\ {декодер CLSID} \\** и использовать числовой ключ (0 в примере) для различения различных шаблонов. Необходимо включить каждое из четырех значений в ключе для каждого шаблона.

## <a name="registering-a-container-format-with-metadata-readers"></a>Регистрация формата контейнера с помощью средств чтения метаданных

При создании нового формата контейнера для кодека необходимо также создать записи реестра для поддержки обнаружения модулей чтения метаданных для блоков метаданных в изображениях так же, как и для модулей записи метаданных. Следующие записи должны быть созданы с идентификатором класса (CLSID) модуля чтения метаданных для каждого формата метаданных, поддерживаемого вашим форматом контейнера. (Обратите внимание, что если кодек использует контейнер формата TIFF, эта информация уже находится в реестре.)

```
HKEY_CLASSES_ROOT
   CLSID
      {Metadata Reader CLSID}
         Containers
            {Container Format GUID}
               
                  Position = Offset relative to its container
                  Pattern = Pattern used for metadata header
                  Mask = FF FF FF FF
                  DataOffset = Offset from beginning of header
```

Так как записи для модулей чтения метаданных также используются для обнаружения, они очень похожи на записи для декодеров. Эти записи используются фабрикой компонентов для поиска модулей чтения метаданных, поддерживаемых контейнером, и выбора соответствующего элемента, когда реализация [**ивикметадатаблоккреадер**](/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockreader) запрашивает средство чтения метаданных.



| Значение      | Описание                                                                                                                                                                                                                                                                 |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Положение   | Смещение в контейнере блока метаданных, в котором можно найти заголовок метаданных. Для блоков метаданных верхнего уровня это смещение в файловом потоке. Для блоков метаданных, вложенных в другие блоки метаданных, это смещение относительно содержащего его блока метаданных. |
| Модель    | Фактические биты, составляющие шаблон. Это биты, которые сопоставляются с идентифицирующим шаблоном в файле изображения во время обнаружения.                                                                                                                            |
| Mask       | Заголовок метаданных обычно определяется обработчиком метаданных. Следует использовать стандартный заголовок метаданных для каждого модуля чтения, если по какой-либо причине шаблон должен иметь другой формат в вашем контейнере.                                                          |
| Смещение в виде значения | Смещение от начала заголовка метаданных, с которого начинаются фактические данные. В случаях, когда метаданные расположены не в указанном смещении от заголовка, эту запись можно опустить.                                                                            |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Записи реестра, относящиеся к кодировщику](-wic-encoderregentries.md)
</dt> <dt>

[Интеграция с Фотоальбомом Windows и проводником Windows](-wic-integrationregentries.md)
</dt> <dt>

[Написание WIC-Enabled КОДЕка](-wic-howtowriteacodec.md)
</dt> <dt>

[Общие сведения о компоненте создания образов Windows](-wic-about-windows-imaging-codec.md)
</dt> </dl>

 

 



