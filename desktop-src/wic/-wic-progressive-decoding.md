---
description: В этом разделе описывается прогрессивное декодирование и использование прогрессивного декодирования в приложениях.
ms.assetid: d22c2c59-0fa1-4452-93f1-dbf151033714
title: Обзор прогрессивного декодирования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2bf005dfb5b4cf5a69ca45020776fee9f0641eee
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265855"
---
# <a name="progressive-decoding-overview"></a>Обзор прогрессивного декодирования

В этом разделе описывается прогрессивное декодирование и использование прогрессивного декодирования в приложениях. Кроме того, здесь приводятся рекомендации по созданию кодеков, поддерживающих прогрессивное декодирование.

В этом разделе содержатся следующие подразделы.

-   [Введение](#introduction)
-   [Что такое прогрессивное декодирование?](#what-is-progressive-decoding)
-   [Поддержка прогрессивного декодирования в Windows 7](#progressive-decoding-support-in-windows-7)
-   [Прогрессивное декодирование JPEG](#jpeg-progressive-decoding)
-   [Прогрессивное декодирование PNG/GIF](#pnggif-progressive-decoding)
    -   [Прогрессивное декодирование PNG](#png-progressive-decoding)
    -   [Прогрессивное декодирование GIF](#gif-progressive-decoding)
-   [Прогрессивное декодирование в приложениях](#progressive-decoding-in-applications)
-   [Поддержка пользовательского кодека для прогрессивного декодирования](#custom-codec-support-for-progressive-decoding)
-   [См. также](#related-topics)

## <a name="introduction"></a>Введение

Прогрессивное декодирование обеспечивает возможность постепенного декодирования и отрисовки фрагментов изображения до завершения загрузки всего изображения. Эта функция значительно повышает удобство работы пользователя при просмотре изображений из Интернета, поскольку пользователю не нужно ждать загрузки всего образа перед началом декодирования. Пользователи могут увидеть предварительный просмотр образа с доступными данными до загрузки всего образа. Эта функция необходима для любого приложения, используемого для просмотра изображений из Интернета или из источников данных с ограниченной пропускной способностью.

Компонент Windows Imaging Component (WIC) в Windows 7 поддерживает прогрессивное декодирование популярных форматов изображений, таких как JPEG, PNG и GIF. WIC также поддерживает все кодеки, не относящиеся к компоненту WIC, которые реализуют прогрессивное декодирование. Прогрессивная кодировка не поддерживается в текущем выпуске WIC. В этом разделе описывается прогрессивное декодирование в Windows 7 и процедура включения прогрессивного декодирования в приложениях.

## <a name="what-is-progressive-decoding"></a>Что такое прогрессивное декодирование?

Прогрессивное декодирование — это возможность постепенного декодирования фрагментов изображения из неполного файла изображения. Перед началом декодирования для традиционного декодирования требуется полный файл образа. Прогрессивное декодирование начинается после завершения загрузки последовательного уровня образа. Декодер выполняет декодирование на текущем последовательном уровне образа. Затем он выполняет несколько проходов декодирования образа по мере загрузки каждого последовательного уровня. Каждый проход декодирования показывает больше изображений, пока образ не будет полностью скачан и декодирован. Число проходов, необходимых для декодирования полного образа, зависит от формата файла изображения и процесса кодирования, используемого для создания образа.

Образы должны быть специально закодированы для реализации прогрессивного декодирования, но не все форматы изображений поддерживают его. В следующем списке перечислены требования для использования прогрессивной декодирования.

-   Файл изображения должен поддерживать прогрессивное декодирование. Большинство форматов изображений не поддерживают прогрессивное декодирование, хотя в популярных форматах изображений — JPEG, PNG и GIF.
-   Файл изображения должен быть закодирован в виде последовательного изображения. Файлы изображений, которые не были созданы с помощью последовательной кодировки изображений, не могут реализовывать прогрессивное декодирование, даже если формат файла в противном случае будет поддерживать его.
-   Должен быть доступен кодек, поддерживающий прогрессивное декодирование. Если кодек не поддерживает прогрессивное декодирование, изображение, закодированное как прогрессивное изображение, будет декодировано как традиционное изображение.

## <a name="progressive-decoding-support-in-windows-7"></a>Поддержка прогрессивного декодирования в Windows 7

Windows 7 предоставляет встроенные кодеки, поддерживающие прогрессивное декодирование форматов изображений JPEG, PNG и GIF. Каждый из этих кодеков Windows 7 выполняет несколько проходов декодирования изображения. Каждый этап соответствует определенному уровню и части декодированного изображения, что в конечном итоге приведет к полному декодированию изображения.

Каждый формат изображения обрабатывает прогрессивное декодирование другим способом. В следующей таблице приведены сведения о количестве последовательных уровней и методе декодирования, поддерживаемом прогрессивными форматами декодирования Windows 7. 

| Формат образа | Число поддерживаемых последовательных уровней | Прогрессивный метод декодирования |
|--------------|----------------------------------------|-----------------------------|
| JPEG         | Определяется изображением                       | Увеличение разрешения       |
| PNG          | 7                                      | Чередование                 |
| GIF          | 4                                      | Чередование                 |



 

Кроме того, прогрессивное декодирование можно реализовать в кодеках, предоставив поддержку последовательных интерфейсов и методов. Если прогрессивное декодирование не поддерживается в кодека, то при вызове этих методов должны возвращаться соответствующие сообщения об ошибках.

## <a name="jpeg-progressive-decoding"></a>Прогрессивное декодирование JPEG

Прогрессивное декодирование JPEG представляет данные изображений с более высоким разрешением для каждого уровня, пока не будет доступно изображение с полным разрешением. Каждый уровень образа настроен для предоставления другого уровня разрешения. По мере появления более последовательных уровней изображение отображается с более высоким разрешением, пока не будет устранен полный образ разрешения.

Количество доступных уровней и набор разрешений на каждом уровне полностью зависят от закодированного JPEG. На следующих двух изображениях показан пример прогрессивного декодирования JPEG на двух последовательных уровнях.

![примеры прогрессивной декодирования JPEG](graphics/Progressive_JPEG_Comparison.jpg)

Изображение слева декодировано в последовательном уровне 0. Изображение справа полностью декодировано после пяти последовательных уровней.

## <a name="pnggif-progressive-decoding"></a>Прогрессивное декодирование PNG/GIF

В прогрессивном декодировании PNG и GIF используется последовательный метод декодирования с чередованием. Процесс декодирования для обоих форматов очень похож.

### <a name="png-progressive-decoding"></a>Прогрессивное декодирование PNG

Файлы изображений PNG предоставляют семь последовательных уровней для декодирования, как описано в спецификации PNG. Прогрессивное декодирование PNG реализуется путем декодирования определенного шаблона пикселей на каждом проходе декодера. Шаблон в следующей таблице из спецификации PNG реплицируется для всего образа. Каждое число представляет последовательный уровень, в котором будет декодироваться соответствующий пиксель.



|     |     |     |     |     |     |     |     |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 1   | 6   | 4   | 6   | 2   | 6   | 4   | 6   |
| 7   | 7   | 7   | 7   | 7   | 7   | 7   | 7   |
| 5   | 6   | 5   | 6   | 5   | 6   | 5   | 6   |
| 7   | 7   | 7   | 7   | 7   | 7   | 7   | 7   |
| 3   | 6   | 4   | 6   | 3   | 6   | 4   | 6   |
| 7   | 7   | 7   | 7   | 7   | 7   | 7   | 7   |
| 5   | 6   | 5   | 6   | 5   | 6   | 5   | 6   |
| 7   | 7   | 7   | 7   | 7   | 7   | 7   | 7   |



 

Из приведенной выше таблицы можно определить Пиксели, которые будут декодированы при каждом прохождении декодера. В отличие от кодека GIF-файла Windows 7, кодек PNG Windows 7 реплицирует самый левый доступный пиксель на строке просмотра для заполнения пустых пикселов.

На следующих изображениях показан пример последовательного декодирования для Windows 7 PNG на трех последовательных уровнях.

![примеры прогрессивной декодирования PNG](graphics/PNG_Progressive_Comparison.jpg)

Изображение в верхнем левом углу показывает, что изображение в формате PNG декодировано в последовательном уровне 0. В правом верхнем углу изображено то же изображение в формате PNG, декодированное в последовательном уровне 3. В нижней части изображения показано полное декодированное изображение после 7 последовательных уровней.

### <a name="gif-progressive-decoding"></a>Прогрессивное декодирование GIF

Файлы изображений в формате GIF предоставляют четыре последовательных уровня для декодирования, как описано в спецификации GIF. Каждый проход заполняет определенные строки в изображении, создавая полный образ после четвертого прохода. В следующей таблице из спецификации GIF показано, какие строки проверки декодированы при каждом прохождении декодера. 

| Номер уровня/номер этапа | Заполненные строки сканирования   | Начало строки сканирования |
|---------------------------|------------------------|--------------------|
| 1                         | Каждая восьмая строка сканирования | 0                  |
| 2                         | Каждая восьмая строка сканирования | 4                  |
| 3                         | Каждая четвертая строка сканирования | 2                  |
| 4                         | Каждая вторая строка сканирования | 1                  |



 

Несмотря на то, что кодеки могут указывать содержимое пустых пикселей на любом конкретном уровне, кодек GIF в Windows заполняет пустые строки, копируя заполненные строки просмотра над пустой строкой просмотра.

## <a name="progressive-decoding-in-applications"></a>Прогрессивное декодирование в приложениях

Основной прогрессивный интерфейс декодирования — это интерфейс [**ивикпрогрессивелевелконтрол**](/windows/desktop/api/Wincodec/nn-wincodec-iwicprogressivelevelcontrol) . Чтобы получить ссылку на интерфейс, запросите кадр изображения ([**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode)) для **ивикпрогрессивелевелконтрол**. Затем к прогрессивным методам можно получить доступ из интерфейса.

В приведенном ниже коде приведен пример использования прогрессивного декодирования в приложениях.


```
IWICProgressiveLevelControl *pProgressive = NULL;

HRESULT hr = (pBitmapFrame->QueryInterface(
   IID_IWICProgressiveLevelControl, 
   (void**) &pProgressive));
                
if (SUCCEEDED(hr))
{
   for (UINT uCurrentLevel = 0; SUCCEEDED(hr); uCurrentLevel++)
   {
      hr = pProgressive->SetCurrentLevel(uCurrentLevel);
               if (WINCODEC_ERR_INVALIDPROGRESSIVELEVEL == hr)
      {
         // No more levels
         break;
      }

      if (SUCCEEDED(hr))
      {
         // Output the current level
         hr = pBitmapFrame->CopyPixels(...);
      }                      
   }
}

if (pProgressive)
{
   pProgressive->Release();
}
```



Приведенный выше код предоставляет базовые функции, необходимые для реализации прогрессивного декодирования в большинстве приложений. С помощью кода можно получить доступ к последовательным уровням, так как данные в точках изображения становятся доступными. Функция [**сеткуррентлевел**](/windows/desktop/api/Wincodec/nf-wincodec-iwicprogressivelevelcontrol-setcurrentlevel) блокирует выполнение до тех пор, пока не будет запрошен уровень.

## <a name="custom-codec-support-for-progressive-decoding"></a>Поддержка пользовательского кодека для прогрессивного декодирования

Разработчики кодеков могут выбрать реализацию [**ивикпрогрессивелевелконтрол**](/windows/desktop/api/Wincodec/nn-wincodec-iwicprogressivelevelcontrol) , если форматы изображений поддерживают прогрессивное декодирование. Поддержка прогрессивного декодирования не является требованием для обнаружения и арбитража с помощью WIC. Однако прогрессивное декодирование значительно улучшает взаимодействие с пользователем, и по возможности следует рассматривать реализацию.

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Общие сведения о компоненте создания образов Windows](-wic-about-windows-imaging-codec.md)
</dt> <dt>

**Другие ресурсы**
</dt> <dt>

[Цифровое сжатие и программирование Continuous-Tone по-прежнему образами — требования и рекомендации](https://www.w3.org/Graphics/JPEG/itu-t81.pdf)
</dt> <dt>

[Формат обмена файлами JPEG](https://www.w3.org/Graphics/JPEG/jfif3.pdf)
</dt> <dt>

[Спецификация GIF89a](https://www.w3.org/Graphics/GIF/spec-gif89a.txt)
</dt> <dt>

[Спецификация и расширения Portable Network Graphics (PNG)](http://www.libpng.org/pub/png/spec/)
</dt> </dl>

 

 



