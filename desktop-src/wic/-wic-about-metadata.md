---
description: в этом разделе представлены сведения о поддержке метаданных для создания образов, предоставляемых компонентом Windows imaging (WIC).
ms.assetid: 35727810-3c4c-4c11-a4a2-3ae2cf3b8142
title: Общие сведения о метаданных компонента WIC
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 44f5031759dd73861a97aace623b35f229b75952
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122472030"
---
# <a name="wic-metadata-overview"></a>Общие сведения о метаданных компонента WIC

в этом разделе представлены сведения о поддержке метаданных для создания образов, предоставляемых компонентом Windows imaging (WIC). Он содержит вводные сведения о чтении и записи метаданных изображений, языке запросов метаданных и расширяемости обработчика метаданных.

Метаданные образа — это данные, внедренные в файл изображения, который предоставляет дополнительные сведения о изображении, например устройство, используемое для записи изображения или размеры изображения. Хотя он содержится в самом файле образа, эти метаданные не являются частью данных отрисовки. Компонент WIC предоставляет интерфейсы, позволяющие считывать и записывать эти метаданные для нескольких распространенных форматов метаданных, в том числе расширяемой платформы метаданных (XMP), файла с обменом изображениями (EXIF) и текстовых данных PNG (текст).

В этом разделе содержатся следующие подразделы.

-   [Предварительные требования](#prerequisites)
-   [Введение](#introduction)
-   [Чтение метаданных изображения](#reading-image-metadata)
-   [Запись метаданных образа](#writing-image-metadata)
-   [Расширяемость метаданных](#metadata-extensibility)
-   [Поддерживаемые форматы метаданных](#supported-metadata-formats)
-   [Сводка компонента метаданных](#metadata-component-summary)
-   [Связанные темы](#related-topics)

## <a name="prerequisites"></a>Предварительные требования

чтобы понять этот раздел, необходимо ознакомиться с интерфейсами кодировщика и декодера WIC и связанных с ним компонентов модели COM, как описано в разделе [общие сведения о компоненте создания образов Windows](-wic-about-windows-imaging-codec.md). Кроме того, он позволяет получить общее представление о некоторых используемых в настоящее время форматах метаданных образов.

## <a name="introduction"></a>Введение

Метаданные предоставляют расширенные сведения о изображении. Эти сведения можно использовать несколькими способами. Изображение может содержать такие метаданные, как описание, оценка, Теги категорий и сведения об авторских правах. Доступ к метаданным упрощает выполнение таких задач, как управление ресурсами, расположение файлов или определение сведений об авторских правах. например, Windows фотоальбом в Windows Vista позволяет добавлять описания и теги категорий к изображениям. Это обеспечивает более эффективное обнаружение изображений и удобный способ классификации изображений. Используя API-интерфейсы WIC и общие форматы метаданных, приложения могут легко записывать или читать метаданные этого типа в изображениях или из них.

На следующей диаграмме показано содержимое файла JPEG, содержащего внедренные блоки метаданных и элементы метаданных.

![изображение JPEG с метаданными оценки](graphics/jpeg.png)

В этом примере изображения метаданные внедряются в файл изображения в кадре изображения. Формат JPEG не поддерживает несколько кадров изображений, поэтому метаданные концептуально присоединяются к этому одному кадру. Форматы, поддерживающие несколько фреймов, например TIFF, могут иметь метаданные, присоединенные к каждому кадру изображения, как показано на этой схеме. Некоторые форматы изображений могут также поддерживать метаданные за пределами фрейма изображения, но не так часто и не поддерживаются в кодеках машинного кода. Компонент WIC достаточно гибок для обработки метаданных и метаданных на уровне кадров за пределами отдельного кадра изображения.

## <a name="reading-image-metadata"></a>Чтение метаданных изображения

API-интерфейсы WIC предоставляют компоненты COM, облегчающие приложениям чтение и запись метаданных образа.

Основным способом чтения метаданных является использование средства чтения запросов метаданных ([**ивикметадатакуериреадер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataqueryreader)) для доступа к конкретным элементам метаданных. Компонент чтения запросов метаданных реализуется кодеком и доступен на уровне декодера или через отдельные кадры изображения, что является наиболее распространенным методом. В следующем коде показано, как получить доступ к модулю чтения запросов для отдельного кадра с помощью метода **жетметадатакуериреадер** читателя запроса.


```
// Get the query reader
if (SUCCEEDED(hr))
{
    hr = pFrameDecode->GetMetadataQueryReader(&pQueryReader);
}
```



Средство чтения запросов предоставляет методы для получения сведений о конкретных метаданных, а также средства для указания извлекаемого элемента метаданных. В следующем коде выражение запроса используется для запроса определенного элемента метаданных в блоке каталога вложенных файлов изображений APP1 (IFD). Это делается с помощью метода **жетметадатабинаме** читателя запросов. Следующий код демонстрирует использование средства чтения запросов для получения значения рейтинга Микрософтфото.


```
PROPVARIANT value;
PropVariantInit(&value);

LPCWSTR pwzRatingQuery = L"/app1/ifd/{ushort=18249}";

if (SUCCEEDED(hr))
{
    hr = pQueryReader->GetMetadataByName(pwzRatingQuery, &value);
}
```



Переменная Пвзратингкуери в предыдущем примере представляет собой строку запроса для доступа к оценке элемента метаданных Микрософтфото. Эта строка создается с помощью языка запросов метаданных. Чтобы создать эту строку, необходимо знание формата метаданных и языка запросов метаданных для получения отдельных элементов метаданных. Дополнительные сведения о языке запросов метаданных см. в разделе [Общие сведения о языке запросов метаданных](-wic-codec-metadataquerylanguage.md).

В фоновом режиме средство чтения запросов использует средство чтения метаданных ([**ивикметадатареадер**](/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatareader)) для доступа к метаданным, описанным в выражении запроса. Помимо использования средства чтения запросов, доступ к модулю чтения метаданных можно получить непосредственно для чтения метаданных. Средство чтения метаданных можно получить из декодера или отдельных кадров, запрашивая интерфейс модуля чтения блока ([**ивикметадатаблоккреадер**](/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockreader)).

## <a name="writing-image-metadata"></a>Запись метаданных образа

Процесс написания метаданных аналогичен тому, как он читается, за исключением того, что используется средство записи запросов метаданных ([**ивикметадатакуеривритер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataquerywriter)). Интерфейс модуля записи запросов реализуется кодировщиком изображений и, как в модуле чтения запросов, доступ к метаданным осуществляется как по кодировщику, так и к отдельным кадрам (в зависимости от поддержки формата изображения).

В следующем коде показано, как получить модуль записи запроса из кадра кодировщика и удалить значение рейтинга, которое было ранее считано.


```
// Get the frame's query writer
if (SUCCEEDED(hr))
{
    hr = pFrameEncode->GetMetadataQueryWriter(&pFrameQWriter);
}

if (SUCCEEDED(hr))
{
    hr = pFrameQWriter->RemoveMetadataByName(L"/app1/ifd/{ushort=18249}");
}
```



Другим способом записи метаданных является быстрое обновление метаданных. Быстрая кодировка метаданных — это способ записи метаданных образа без необходимости повторной кодировки файла изображения. Это делается путем записи новых метаданных в дополненную область формата метаданных. Кодировщик метаданных Fast ([**ивикфастметадатаенкодер**](/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder)) получается из фабрики компонентов на основе декодера изображений. Затем быстрый кодировщик метаданных получает модуль записи запроса, который используется для записи метаданных. Наконец, быстрый кодировщик фиксирует изменения.

В следующем коде показано, как получить кодировщик метаданных FAST и использовать его для записи значения Микрософтратинг.


```
if (SUCCEEDED(hr))
{
    IWICFastMetadataEncoder *pFME = NULL;
    IWICMetadataQueryWriter *pFMEQW = NULL;

    hr = pFactory->CreateFastMetadataEncoderFromFrameDecode(
        pFrameDecode,
        &pFME);

    if (SUCCEEDED(hr))
    {
        hr = pFME->GetMetadataQueryWriter(&pFMEQW);
    }

    if (SUCCEEDED(hr))
    {
        // Add additional metadata
        PROPVARIANT value;

        PropVariantInit(&value);

        value.vt = VT_UI4;
        value.uiVal = 99;
        hr = pFMEQW->SetMetadataByName(L"/app1/ifd/{ushort=18249}", &value);

        PropVariantClear(&value);
    }

    if (SUCCEEDED(hr))
    {
        hr = pFME->Commit();
    }
}
```



Не все форматы метаданных поддерживают быстрые метаданные. Чтобы узнать, какие форматы в собственном формате поддерживают быстрое кодирование метаданных, см. таблицу в разделе [Поддерживаемые форматы метаданных](#supported-metadata-formats) далее в этом документе.

В фоновом режиме средство записи запросов использует модуль записи метаданных ([**ивикметадатавритер**](/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatawriter)) для записи метаданных, описываемых выражением запроса. Помимо использования средства чтения запросов, можно также получить доступ к модулю записи метаданных непосредственно для записи метаданных. Модуль записи метаданных можно получить из декодера или отдельных кадров, используя запросы к интерфейсу модуля записи блоков ([**ивикметадатаблокквритер**](/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockwriter)).

## <a name="metadata-extensibility"></a>Расширяемость метаданных

Как упоминалось ранее, компонент WIC предоставляет несколько обработчиков метаданных для чтения и записи метаданных для общих форматов метаданных. Однако существуют некоторые форматы метаданных, которые изначально не поддерживаются. Таким образом, компонент WIC предоставляет API-интерфейсы для создания дополнительных обработчиков метаданных, которые могут расширять поддержку метаданных в другие форматы.

Для полной поддержки других форматов метаданных необходимо разработать два типа обработчиков — средство чтения метаданных для чтения метаданных и модуль записи метаданных для записи метаданных. Хотя эти два обработчика обычно реализуются в парах для определенного формата, это не обязательно. Возможно, в некоторых случаях требуется только возможность чтения или только возможность записи.

Дополнительные сведения о расширении метаданных с помощью API-интерфейсов WIC см. в разделе [Общие сведения о расширяемости метаданных](-wic-codec-metadatahandlers.md).

## <a name="supported-metadata-formats"></a>Поддерживаемые форматы метаданных

Компонент WIC обеспечивает поддержку нескольких распространенных форматов метаданных. В следующей таблице перечислены поддерживаемые форматы метаданных, их версии, форматы изображений, поддерживающие формат метаданных, а также указывается, поддерживает ли формат метаданных быструю кодировку метаданных. Дополнительные сведения о быстрых кодировках метаданных см. в разделе [запись метаданных образа](#writing-image-metadata) ранее в этом документе.



| Поддерживаемые форматы метаданных | Версия спецификации метаданных | Поддержка формата изображения | Поддерживает быструю кодировку метаданных |
|----------------------------|--------------------------------|----------------------|---------------------------------|
| App0                       | JFIF 1,02                      | JPEG                 | Нет                              |
| Приложение 1                       | JFIF 1,02                      | JPEG, TIFF           | Нет                              |
| App13                      | Неизвестно                        | JPEG, TIFF           | Нет                              |
| IFD                        | TIFF 6,0                       | JPEG, TIFF           | Да                             |
| ирб                        | Неизвестно                        | JPEG, TIFF           | Нет                              |
| Exif                       | EXIF 2,2                       | JPEG, TIFF           | Да                             |
| ПОДДЕРЖИВАЮЩ                        | XMP 1,0 (Сентябрь 2005)            | JPEG, TIFF           | Да                             |
| GPS                        | EXIF 2,2                       | JPEG, TIFF           | Да                             |
| IPTC                       | IPTC 4,0                       | JPEG, TIFF           | Да                             |
| полнотекстовым                       | PNG 1,2                        | PNG                  | Нет                              |



 

> [!Note]  
> IPTC поддерживает FME только при увеличении размера блоков, так как IPTC не поддерживает заполнение.

 

## <a name="metadata-component-summary"></a>Сводка компонента метаданных

В следующей таблице описаны интерфейсы WIC, поддерживающие метаданные, и соответствующие им компоненты. Эти компоненты предоставляют доступ к метаданным образа. дополнительные сведения об этих компонентах см. в разделе [общие сведения о компоненте Windows imaging](-wic-about-windows-imaging-codec.md). 


| Компонент | Описание | 
|-----------|-------------|
| Декодер точечных рисунков (<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapdecoder"><strong>ивикбитмапдекодер</strong></a>) | <ul><li>Считывает поток изображения и создает пригодный для использования исходный точечный рисунок. Связан с форматом контейнера, таким как TIFF или Объединенная группа экспертов (JPEG).</li><li>Реализует интерфейс <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockreader"><strong>ивикметадатаблоккреадер</strong></a> для перечисления всех блоков метаданных в потоке данных декодера, не находящихся внутри рамки.</li><li>Предоставляет средство чтения запросов для чтения метаданных, связанных с изображением, которое не находится внутри рамки.</li></ul> | 
| Декодирование кадров точечного рисунка (<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode"><strong>IWICBitmapFrameDecode</strong></a>) | <ul><li>Обращается к отдельным кадрам из потока изображений, удерживаемого декодером.</li><li>Реализует интерфейс <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockreader"><strong>ивикметадатаблоккреадер</strong></a> для перечисления всех блоков метаданных в потоке данных кадра.</li><li>Предоставляет средство чтения запросов для чтения метаданных, связанных с кадром, с помощью выражений запросов.</li></ul> | 
| Растровый кодировщик (<a href="/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapencoder"><strong>ивикбитмапенкодер</strong></a>) | <ul><li>Записывает источник растрового изображения в поток изображений. Связан с форматом контейнера, например TIFF или JPEG.</li><li>Реализует интерфейс <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockwriter"><strong>ивикметадатаблокквритер</strong></a> для создания списка блоков метаданных для записи в поток данных кодировщика.</li><li>Предоставляет средство записи запроса для записи метаданных, связанных с изображением, с помощью выражений запросов.</li></ul> | 
| Кодировка кадра битма (<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode"><strong>ивикбитмапфраминкоде</strong></a>) | <ul><li>Создает кадр, который будет кодироваться в поток, удерживаемый кодировщиком.</li><li>Реализует интерфейс <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockwriter"><strong>ивикметадатаблокквритер</strong></a> для создания списка блоков метаданных для записи в поток данных кадра.</li><li>Предоставляет средство записи запроса для записи метаданных, связанных с кадром, с помощью выражений запросов.</li></ul> | 




 

В следующей таблице описаны компоненты метаданных компонента WIC. Эти компоненты позволяют считывать и записывать метаданные в образ, предоставляемый компонентами, перечисленными в предыдущей таблице. 


| Компонент | Описание | 
|-----------|-------------|
| Средство чтения запросов метаданных (<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataqueryreader"><strong>ивикметадатакуериреадер</strong></a>) | <ul><li>Принимает строку запроса и выполняет навигацию по базовой иерархии метаданных для получения метаданных.</li></ul> | 
| Средство записи запросов метаданных (<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicmetadataquerywriter"><strong>ивикметадатакуеривритер</strong></a>) | <ul><li>Принимает строку запроса и выполняет навигацию по базовой иерархии метаданных для получения, установки и удаления метаданных.</li></ul> | 
| Считыватель блоков метаданных (<a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockreader"><strong>ивикметадатаблоккреадер</strong></a>) | <ul><li>Управляет коллекцией объектов <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatareader"><strong>ивикметадатареадер</strong></a> , доступную только для чтения, в верхней части иерархии метаданных и включает перечисление всех блоков метаданных.</li><li>Реализуется растровым декодером и декодированным кадром точечного рисунка.</li><li>Реализован сторонними разработчиками компонентов для пользовательских кодеков.</li></ul> | 
| Модуль записи блоков метаданных (<a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatablockwriter"><strong>ивикметадатаблокквритер</strong></a>) | <ul><li>Управляет коллекцией объектов <a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatawriter"><strong>ивикметадатавритер</strong></a> , предназначенных для чтения и записи, в верхней части иерархии метаданных.</li><li>Реализуется кодировщиком растрового изображения и кодированием кадра растрового изображения.</li><li>Реализован сторонними разработчиками компонентов для пользовательских кодеков.</li></ul> | 
| Средство чтения метаданных (<a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatareader"><strong>ивикметадатареадер</strong></a>) | <ul><li>Анализирует поток метаданных и управляет коллекцией элементов метаданных, доступную только для чтения. Связан с форматом метаданных, например EXIF, IFD и XMP.</li><li>Выступает в качестве словаря и возвращает значение при наличии пары форматов и ИДЕНТИФИКАТОРов.</li><li>Реализован сторонними разработчиками компонентов для пользовательских типов метаданных.</li></ul> | 
| Модуль записи метаданных (<a href="/windows/desktop/api/Wincodecsdk/nn-wincodecsdk-iwicmetadatawriter"><strong>ивикметадатавритер</strong></a>) | <ul><li>Анализирует и сериализует поток метаданных и управляет коллекцией элементов метаданных, предназначенной для чтения и записи.</li><li>Реализован сторонними разработчиками компонентов для пользовательских типов метаданных.</li></ul> | 
| Быстрый кодировщик метаданных<a href="/windows/desktop/api/Wincodec/nn-wincodec-iwicfastmetadataencoder"><strong>ивикфастметадатаенкодер</strong></a> | <ul><li>Предоставляет семантику для записи в иерархии метаданных, которая будет обновлять метаданные на месте без повторной кодировки изображения.</li></ul> | 




 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

**Зрения**
</dt> <dt>

[Windows Общие сведения о компонентах обработки изображений](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[Общие сведения о языке запросов метаданных](-wic-codec-metadataquerylanguage.md)
</dt> <dt>

[Общие сведения о чтении и записи метаданных изображений](-wic-codec-readingwritingmetadata.md)
</dt> <dt>

[Общие сведения о расширяемости метаданных](-wic-codec-metadatahandlers.md)
</dt> <dt>

[Пошаговое руководство. повторное кодирование изображения JPEG с помощью метаданных](-wic-codec-jpegmetadataencoding.md)
</dt> </dl>

 

 



