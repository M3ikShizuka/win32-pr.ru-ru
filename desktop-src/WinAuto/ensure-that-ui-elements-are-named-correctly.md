---
title: Проверка правильности имен элементов пользовательского интерфейса
description: В этом разделе описывается правильный способ указания имен элементов пользовательского интерфейса в приложениях Microsoft Win32, чтобы Microsoft Active Accessibility мог точно предоставлять имена клиентским приложениям через метод IAccessible \ 32; Имя свойства.
ms.assetid: 5b8f23cb-9906-4cc4-83d4-73fdf96ed681
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db3c4f1fc129aea9b793bac1935d678645b28fc
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987570"
---
# <a name="ensuring-that-ui-elements-are-correctly-named"></a>Проверка правильности имен элементов пользовательского интерфейса

В этом разделе описывается правильный способ указания имен элементов пользовательского интерфейса в приложениях Microsoft Win32, чтобы Microsoft Active Accessibility мог точно предоставлять имена клиентским приложениям через [свойство имя](name-property.md) [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) .

Сведения в этом разделе относятся только к Microsoft Active Accessibility. Он не применяется к приложениям, использующим автоматизацию пользовательского интерфейса Майкрософт или основанным на языках разметки, таких как HTML, Dynamic HTML (DHTML) или XML.

-   [Обзор](#overview)
-   [Как неправильное именование вызывает проблемы](#how-incorrect-naming-causes-problems)
-   [Как MSAA получает свойство Name](#how-msaa-gets-the-name-property)
-   [Поиск и устранение проблем именования](#how-to-find-and-correct-naming-problems)
-   [Как правильно присвоить имя TrackBar](#how-to-correctly-name-a-trackbar)
-   [Использование невидимых меток для именования элементов управления](#how-to-use-invisible-labels-to-name-controls)
-   [Как использовать прямую заметку для указания свойства Name](#how-to-use-direct-annotation-to-specify-the-name-property)
    -   [Действия по аннотированию свойства Name](#steps-for-annotating-the-name-property)
    -   [Пример аннотирования свойства Name](#example-of-annotating-the-name-property)
-   [См. также](#related-topics)

## <a name="overview"></a>Обзор

В Microsoft Active Accessibility каждый элемент пользовательского интерфейса в приложении представлен объектом, предоставляющим интерфейс [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) . Клиентские приложения используют свойства и методы интерфейса **IAccessible** для взаимодействия с элементом пользовательского интерфейса и получения сведений о нем. Одним из наиболее важных свойств, предоставляемых интерфейсом **IAccessible** , является [свойство Name](name-property.md). Клиентские приложения используют свойство Name для поиска, определения или объявления элемента пользовательского интерфейса пользователю. Если Microsoft Active Accessibility не может правильно предоставить свойство Name определенного элемента пользовательского интерфейса, клиентские приложения не смогут представить этот элемент пользовательского интерфейса пользователю, а элемент пользовательского интерфейса будет недоступен для пользователей с ограниченными возможностями.

## <a name="how-incorrect-naming-causes-problems"></a>Как неправильное именование вызывает проблемы

Чтобы продемонстрировать проблемы, вызванные неверным именованием элементов пользовательского интерфейса, рассмотрите форму ввода имени, показанную на следующем рисунке.

![Иллюстрация простой формы для ввода имени и фамилии](images/incorrect-form.png)

Хотя элементы пользовательского интерфейса в форме выглядят нормально, программная реализация неверна. Для клиента Microsoft Active Accessibility, такого как средство чтения с экрана, [свойство Name](name-property.md) элемента управления "поле ввода" имеет значение "Last Name:", а свойство Name нижнего элемента управления "поле ввода" — пустая строка (""). Средство чтения с экрана получит верхний элемент управления "поле ввода" как "Фамилия", хотя пользователь должен ввести имя. Средство чтения с экрана будет считывать второй элемент управления "поле ввода" как "без имени", поэтому пользователь не сможет понять, что вводить во второй элемент управления "поле ввода". Средство чтения с экрана не может помочь пользователю ввести данные в эту простую форму.

Еще одна проблема с формой заключается в том, что никакие сочетания клавиш не назначены ни одному из элементов управления редактирования. Пользователь вынужден переходить на любую вкладку элементов управления или использовать мышь.

В следующих разделах объясняется источник этих проблем и приводятся рекомендации по их исправлению.

## <a name="how-msaa-gets-the-name-property"></a>Как MSAA получает свойство Name

Microsoft Active Accessibility получает строку [свойства Name](name-property.md) из различных расположений в зависимости от типа элемента пользовательского интерфейса. Для большинства элементов пользовательского интерфейса, имеющих связанный текст окна, Microsoft Active Accessibility использует текст окна в качестве строки свойства Name. Примерами такого типа элемента пользовательского интерфейса являются элементы управления, такие как кнопки, элементы меню и подсказки.

Для следующих элементов управления Microsoft Active Accessibility игнорирует текст окна и вместо этого ищет статическую текстовую метку (или метку поля группы) непосредственно перед элементом управления в последовательности табуляции.

-   Поля со списком
-   Выбор даты и времени
-   Элементы управления редактированием и форматированным редактированием
-   Элементы управления IP-адресами
-   Списки
-   Представления списка
-   Индикаторы выполнения
-   Полосы прокрутки
-   Статические элементы управления, имеющие \_ значок SS или \_ стиль битовой карты SS
-   Линейки воспроизведения
-   Представления в виде дерева

Если предыдущие элементы управления не сопровождаются статическими текстовыми метками или неправильно реализованы метки, Microsoft Active Accessibility не может предоставить для клиентских приложений правильное [свойство Name](name-property.md) .

Большинство предыдущих элементов управления фактически имеют связанный текст окна. Редактор ресурсов автоматически создает текст окна, состоящий из универсальной строки, такой как "Edit1" или "listbox3". Несмотря на то, что разработчики могут заменить созданный текст окна более осмысленным текстом, большинство из них никогда не делают этого. Поскольку созданный текст окна не имеет смысла для пользователя, Microsoft Active Accessibility пропускает его и использует вместо этого сопроводительную статическую текстовую метку.

## <a name="how-to-find-and-correct-naming-problems"></a>Поиск и устранение проблем именования

В форме ввода имени, показанной в описании того, как неправильное именование вызывает проблемы, причина проблем заключается в том, что порядок табуляции элементов управления неверен. Анализ пользовательского интерфейса с помощью средства тестирования, такого как [Проверка](inspect-objects.md) , привело бы к проблемам с иерархией объектов. На следующем снимке экрана показана неработающая иерархия объектов в форме ввода имени в том виде, в котором она отображается при проверке.

![снимок экрана средства проверки, показывающего неправильную иерархию объектов в форме ввода имени](images/incorrect-object-hierarchy.png)

На предыдущем снимке экрана Обратите внимание, что иерархия объектов не соответствует структуре элементов управления, отображаемым в пользовательском интерфейсе формы ввода имени. Также обратите внимание на то, что [Проверка](inspect-objects.md) назначила неверное имя элементу "следующий к последнему" (это элемент управления для ввода имени, который должен иметь имя "First Name:"). Наконец, обратите внимание, что проверка не смогла найти имя последнего элемента (это элемент управления для ввода фамилии и должен иметь имя «Last Name:»).

В следующем примере показано содержимое файла ресурсов для формы ввода имени. Обратите внимание, что порядок табуляции не согласуется с логической структурой элементов управления, отображаемых в пользовательском интерфейсе. Также обратите внимание, что для двух элементов управления для редактирования не заданы сочетания клавиш.

``` syntax
IDD_INPUTNAME DIALOGEX 22, 17, 312, 118
STYLE DS_SETFONT | DS_MODALFRAME | WS_CAPTION | WS_SYSMENU
CAPTION "Enter your name"
FONT 8, "System", 0, 0, 0x0
BEGIN
    DEFPUSHBUTTON   "OK",IDOK,179,35,30,11,WS_GROUP
    LTEXT           "First Name:",IDC_STATIC,8,16,43,8
    LTEXT           "Last Name:",IDC_STATIC,8,33,43,8
    EDITTEXT        IDC_EDIT1,53,15,120,12,ES_AUTOHSCROLL
    EDITTEXT        IDC_EDIT2,53,34,120,12,ES_AUTOHSCROLL
END
```

Чтобы устранить проблемы с формой ввода имени, необходимо изменить файл ресурса (RC), чтобы указать сочетания клавиш, и элементы управления должны размещаться в следующем порядке:

1.  Статическая текстовая метка "&First Name:".
2.  Элемент управления редактированием для ввода имени (IDC \_ EDIT1).
3.  Статическая текстовая метка "&Last Name:".
4.  Элемент управления редактированием для ввода фамилии (IDC \_ EDIT2).
5.  Кнопка "ОК" по умолчанию.

В следующем примере показан исправленный файл ресурсов для формы ввода имени:

``` syntax
IDD_INPUTNAME DIALOGEX 22, 17, 312, 118
STYLE DS_SETFONT | DS_MODALFRAME | WS_CAPTION | WS_SYSMENU
CAPTION "Enter your name"
FONT 8, "System", 0, 0, 0x0
BEGIN
    LTEXT           "&First Name:",IDC_STATIC,8,16,43,8
    EDITTEXT        IDC_EDIT1,53,15,120,12,ES_AUTOHSCROLL
    LTEXT           "&Last Name:",IDC_STATIC,8,33,43,8
    EDITTEXT        IDC_EDIT2,53,34,120,12,ES_AUTOHSCROLL
    DEFPUSHBUTTON   "OK",IDOK,179,35,30,11,WS_GROUP
END
```

Чтобы внести исправления в файл ресурсов, можно либо изменить файл напрямую, либо воспользоваться инструментом «порядок табуляции» в Microsoft Visual Studio. Доступ к средству "порядок табуляции" в Visual Studio можно получить, нажав клавиши CTRL + D или выбрав **последовательность табуляции** в меню **Формат** .

После исправления и перестроения приложения пользовательский интерфейс формы ввода имен будет выглядеть так же, как и раньше. Однако Microsoft Active Accessibility теперь будет предоставлять правильные свойства имени для клиентских приложений и будет правильно устанавливать фокус при нажатии клавиш ALT + F или ALT + L. Кроме того, при [проверке](inspect-objects.md) отобразится правильная иерархия объектов, как показано на следующем снимке экрана.

![снимок экрана с доступным инструментом обозревателя, отображающий правильную иерархию объектов в форме ввода имени](images/correct-object-hierarchy.png)

## <a name="how-to-correctly-name-a-trackbar"></a>Как правильно присвоить имя TrackBar

При определении значения TrackBar (или ползунка) убедитесь, что Главная статическая текстовая метка для TrackBar отображается перед TrackBar и что статические текстовые метки для минимального и максимального диапазонов отображаются после значения TrackBar. Помните, что в Microsoft Active Accessibility используется статическая текстовая метка, которая непосредственно предшествует элементу управления в качестве [свойства Name](name-property.md) для элемента управления. Размещение основной статической метки непосредственно перед TrackBar и другими метками после нее гарантирует, что Microsoft Active Accessibility предоставляет клиенту правильное свойство Name.

На следующем рисунке показана типичная линейка с главной статической текстовой меткой "Speed", а также статические текстовые метки для минимального ("min") и максимального ("Max") диапазона.

![Иллюстрация элемента управления TrackBar, имеющего главную метку и метки для минимального и максимального диапазонов](images/speed-trackbar.png)

В следующем примере показан правильный способ определения TrackBar и его статических текстовых меток в файле ресурсов:

``` syntax
BEGIN
    ...

    LTEXT           "&Speed",IDC_STATIC,47,20,43,8
    CONTROL         "",IDC_SLIDER1,"msctls_trackbar32",
                    TBS_AUTOTICKS | TBS_BOTH | WS_TABSTOP,
                    32,32,62,23
    LTEXT           "min",IDC_STATIC,16,37,15,8
    LTEXT           "max",IDC_STATIC,94,38,43,8

    ...
END
```

## <a name="how-to-use-invisible-labels-to-name-controls"></a>Использование невидимых меток для именования элементов управления

Не всегда возможно или нежелательно иметь видимую метку для каждого элемента управления. Например, иногда Добавление меток может привести к нежелательным изменениям в внешнем виде пользовательского интерфейса. В этом случае можно использовать невидимые метки. Microsoft Active Accessibility будет по-прежнему выбирать текст, связанный с невидимой меткой, но метка не будет отображаться в визуальном пользовательском интерфейсе или мешать ему.

Как и в случае с видимыми метками, невидимая метка должна находиться непосредственно перед элементом управления в последовательности табуляции. Чтобы сделать метку невидимой в файле ресурсов (. RC), добавьте `NOT WS_VISIBLE` или `|~WS_VISIBLE` в часть Style элемента управления "статический текст". Если вы используете редактор ресурсов в Visual Studio, можно задать для свойства Visible значение false.

## <a name="how-to-use-direct-annotation-to-specify-the-name-property"></a>Как использовать прямую заметку для указания свойства Name

Прокси-серверы по умолчанию, включаемые в компонент среды выполнения Microsoft Active Accessibility, Oleacc.dll, автоматически предоставляют объект [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) для всех стандартных элементов управления Windows. При настройке стандартного элемента управления Windows прокси-серверы по умолчанию лучше всего обеспечивают точное предоставление всех свойств **IAccessible** для настраиваемого элемента управления. Необходимо тщательно протестировать пользовательский элемент управления, чтобы гарантировать, что прокси-серверы по умолчанию предоставляют точные и полные значения свойств. Если при тестировании раскрываются неточные или неполные значения свойств, можно использовать методику динамической аннотации под названием "непосредственная Аннотация" для предоставления правильных значений свойств и добавления недостающих.

Обратите внимание, что динамическая Аннотация не только для элементов управления, поддерживаемых учетными записями-посредниками Microsoft Active Accessibility. Его также можно использовать для изменения или предоставления свойств для любого элемента управления, предоставляющего собственную реализацию [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) .

В этом разделе основное внимание уделяется использованию прямой аннотации для предоставления правильного значения [свойства Name](name-property.md) объекта [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) для элемента управления. Кроме того, можно использовать прямую заметку для предоставления и других значений свойств. Кроме того, доступны другие методики динамической аннотации для прямых заметок, а функции и возможности API динамической аннотации выходят далеко за рамки, описанной в этом разделе. Дополнительные сведения о динамической аннотации см. в разделе [Динамическая Аннотация API](dynamic-annotation-api.md).

### <a name="steps-for-annotating-the-name-property"></a>Действия по аннотированию свойства Name

Использование непосредственной аннотации для изменения [свойства Name](name-property.md) элемента управления включает следующие шаги.

1.  Включить следующие файлы заголовков:
    -   Инитгуид. h
    -   Олеакк. h

    > [!Note]  
    > Чтобы определить идентификаторы GUID, необходимо включить Инитгуид. h перед Олеакк. h в том же файле.

     

2.  Инициализируйте библиотеку модели COM, вызывая функцию [CoInitializeEx](/windows/win32/api/combaseapi/nf-combaseapi-coinitializeex) , как правило, в процессе инициализации приложения.
3.  Вскоре после создания целевого элемента управления (обычно во время сообщения [WM \_ инитдиалог](../dlgbox/wm-initdialog.md) ) создайте экземпляр диспетчера заметок и получите указатель на его [**иаккпропсервицес**](/windows/desktop/api/oleacc/nn-oleacc-iaccpropservices) указатель.
4.  Заметка [свойства Name](name-property.md) целевого элемента управления с помощью метода [**Иаккпропсервицес:: сесвндпропстр**](/windows/desktop/api/Oleacc/nf-oleacc-iaccpropservices-sethwndpropstr) .

5.  Отпустите указатель [**иаккпропсервицес**](/windows/desktop/api/oleacc/nn-oleacc-iaccpropservices) .
6.  Перед уничтожением целевого элемента управления (обычно при обработке сообщения [WM \_ destroy](../winmsg/wm-destroy.md) ) создайте экземпляр диспетчера заметок и получите указатель на его интерфейс [**иаккпропсервицес**](/windows/desktop/api/oleacc/nn-oleacc-iaccpropservices) .
7.  Используйте метод [**иаккпропсервицес:: клеархвндпропс**](/windows/desktop/api/Oleacc/nf-oleacc-iaccpropservices-clearhwndprops) , чтобы очистить заметки [свойства Name](name-property.md) из целевого элемента управления.
8.  Отпустите указатель [**иаккпропсервицес**](/windows/desktop/api/oleacc/nn-oleacc-iaccpropservices) .
9.  Перед завершением работы приложения (как правило, при обработке сообщения [WM \_ destroy](../winmsg/wm-destroy.md) ) ОСВОБОДИТе библиотеку COM, вызвав функцию [CoUninitialize](/windows/win32/api/combaseapi/nf-combaseapi-couninitialize) .

Функция [**иаккпропсервицес:: сесвндпропстр**](/windows/desktop/api/Oleacc/nf-oleacc-iaccpropservices-sethwndpropstr) принимает пять параметров. Первые три —*HWND*, *идобжект* и *идчилд*— объединяются для обнаружения элемента управления. Четвертый параметр, *идпроп*, указывает идентификатор изменяемого свойства. Чтобы изменить [свойство Name](name-property.md), задайте для *идпроп* значение **PropID \_ ACC \_ Name**. (Список других свойств, которые можно задать через прямую заметку, см. в разделе [использование прямой заметки](using-direct-annotation.md).) Последним параметром **сесвндпропстр**, *str* является новая строка, используемая в качестве свойства Name.

### <a name="example-of-annotating-the-name-property"></a>Пример аннотирования свойства Name

В следующем примере кода показано, как использовать прямую заметку для изменения [свойства Name](name-property.md) объекта [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) для элемента управления. Для простоты в примере используется жестко заданная строка ("New Control Name") для задания свойства Name. Жестко запрограммированные строки не следует использовать в окончательной версии приложения, так как они не могут быть локализованы. Вместо этого всегда загружайте строки из файла ресурсов. Кроме того, в примере не показаны вызовы функций [CoInitializeEx](/windows/win32/api/combaseapi/nf-combaseapi-coinitializeex) и [CoUninitialize](/windows/win32/api/combaseapi/nf-combaseapi-couninitialize) .


```C++
#include <initguid.h>
#include <oleacc.h>

// AnnotateControlName - Uses direct annotation to change the Name property 
// of the IAccessible object for a control.
//
// hDlg - Handle of the dialog box that contains the control.
// hwndCtl - Handle of the control whose Name property is to be changed.
HRESULT AnnotateControlName(HWND hDlg, HWND hwndCtl)
{
    HRESULT hr;        

    IAccPropServices *pAccPropSvc = NULL;  

    // Create an instance of the annotation manager and retrieve the 
    // IAccPropServices pointer.
    hr = CoCreateInstance(CLSID_AccPropServices, NULL, CLSCTX_SERVER, 
        IID_IAccPropServices, (void **) &pAccPropSvc);

    if (hr != S_OK || pAccPropSvc == NULL)
        return hr;

    // Set the Name property for the control.
    // Note: A hard-coded string is used here to keep the example simple.
    // Always use localizable string resources in your applications. 
    hr = pAccPropSvc->SetHwndPropStr(hwndCtl, OBJID_CLIENT, CHILDID_SELF, 
        PROPID_ACC_NAME, L"New Control Name");

    pAccPropSvc->Release();
    
    return hr;
}

// RemoveAnnotatedNameFromControl - Removes the annotated name from the 
// Name property of the IAccessible object for a control.
//
// hDlg - Handle of the dialog box that contains the control.
// hwndCtl - Handle of the control whose annotated name is to be removed.
HRESULT RemoveAnnotatedNameFromControl(HWND hDlg, HWND hwndCtl)
{
    HRESULT hr;

    IAccPropServices *pAccPropSvc = NULL;

    // Create an instance of the annotation manager and retrieve the 
    // IAccPropServices pointer.
    hr = CoCreateInstance(CLSID_AccPropServices, NULL, CLSCTX_SERVER, 
        IID_IAccPropServices, (void **) &pAccPropSvc);

    if (hr != S_OK || pAccPropSvc == NULL)
        return hr;

    // Remove the annotated name from the Name property for the control.
    MSAAPROPID propid = PROPID_ACC_NAME;
    hr = pAccPropSvc->ClearHwndProps(hwndCtl, OBJID_CLIENT, CHILDID_SELF, 
        &propid, 1);

    // Release the annotation manager.
    pAccPropSvc->Release();

    return hr;
}
```



## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Динамический API аннотации](dynamic-annotation-api.md)
</dt> <dt>

[Предоставление свойства Name](providing-the-name-property.md)
</dt> <dt>

[Средства тестирования](testing-tools.md)
</dt> </dl>

 

 