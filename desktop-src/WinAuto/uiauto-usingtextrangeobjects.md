---
title: Использование текстовых диапазонов
description: В этом разделе описывается использование свойств и методов интерфейса Иуиаутоматионтекстранже для доступа к текстовому содержимому элемента управления на основе текста и управления им.
ms.assetid: 66BC7324-5322-4996-AF62-766936559F0E
keywords:
- Клиенты, использование объектов текстового диапазона
- текстовые элементы управления
- Клиенты, текстовые диапазоны
- Клиенты, шаблон элемента управления TextRange
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6a2aef7c23db6903e3492fec7c83ba7c14599c63
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127342699"
---
# <a name="using-text-ranges"></a>Использование текстовых диапазонов

В этом разделе описывается использование свойств и методов интерфейса [**иуиаутоматионтекстранже**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) для доступа к текстовому содержимому элемента управления на основе текста и управления им. Он содержит следующие подразделы:

-   [Что такое текстовый диапазон?](#using-text-ranges)
-   [Получение объектов текстового диапазона](#acquiring-text-range-objects)
-   [Выбор текста в текстовом диапазоне](#selecting-text-in-a-text-range)
-   [Извлечение текста из текстового диапазона](#retrieving-text-from-a-text-range)
-   [Получение текстовых атрибутов из текстового диапазона](#retrieving-text-attributes-from-a-text-range)
-   [Получение внедренных объектов из текстового диапазона](#retrieving-embedded-objects-from-a-text-range)
-   [Управление диапазоном текста](#manipulating-a-text-range)
-   [Прокрутка текстового диапазона в представление](#scrolling-a-text-range-into-view)
-   [Извлечение включающего элемента текстового диапазона](#retrieving-the-enclosing-element-of-a-text-range)
-   [Сравнение и клонирование диапазонов текста](#comparing-and-cloning-text-ranges)
-   [Получение заметок](#retrieving-annotations)
    -   [Получение типов заметок из текстового диапазона](#retrieving-annotations-types-from-a-text-range)
    -   [Извлечение всех заметок из текстового диапазона](#retrieving-all-annotations-from-a-text-range)
    -   [Получение сведений о конкретной заметке](#retrieving-information-about-a-particular-annotation)
    -   [Извлечение целевого текста заметки](#retrieving-the-annotation-target-text)
-   [Получение визуальных стилей](#retrieving-visual-styles)
-   [Вызов контекстных меню из текстовых диапазонов](#invoking-context-menus-from-text-ranges)
-   [Связанные темы](#related-topics)

## <a name="what-is-a-text-range"></a>Что такое текстовый диапазон?

Объектная модель текста Microsoft UI Automation основана на концепции *текстового диапазона*. Текстовый диапазон — это объект, предоставляющий интерфейс [**иуиаутоматионтекстранже**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) , который представляет непрерывный участок текста в элементе управления на основе текста. Каждый текстовый диапазон имеет как начальную, так и конечную конечную точку, и все текстовое содержимое между двумя конечными точками считается частью диапазона. Текстовый диапазон, начальная конечная точка и конечная точка которого находятся в одном расположении, называется *вырожденным* (или пустым) текстовым диапазоном. Вырожденный диапазон текста используется для пометки определенного расположения внутри текста элемента управления, например расположения точки вставки текста.

## <a name="acquiring-text-range-objects"></a>Получение объектов текстового диапазона

Клиентские приложения получают объекты текстового диапазона с помощью свойств и методов интерфейса [**иуиаутоматионтекстпаттерн**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextpattern) . Свойство [**иуиаутоматионтекстранжепаттерн::D окументранже**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_documentrange) Извлекает текстовый диапазон, представляющий все текстовое содержимое элемента управления на основе текста, а другие методы получают текстовые диапазоны, представляющие некоторую часть содержимого, например выделенный текст, видимый текст или объект, внедренный в текст.

Методы [**иуиаутоматионтекстранжепаттерн:: жетвисиблеранжес**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getvisibleranges) и методического [**выбора**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-getselection) могут извлекать массивы объектов текстового диапазона. Если элемент управления частично скрывается перекрытием окна или другого объекта, **жетвисиблеранжес** возвращает массив, содержащий объект текстового диапазона для каждой частично видимой строки текста. Аналогично, если текстовый элемент управления поддерживает выбор нескольких необъединяемых диапазонов текста, метод **GetObject возвращает массив, содержащий** объект текстового диапазона для каждого выбранного диапазона.

Метод [**иуиаутоматионтекстранжепаттерн:: ранжефромчилд**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-rangefromchild) позволяет клиентскому приложению получить текстовый диапазон, охватывающий объект, внедренный в текстовое содержимое. Клиент указывает указатель интерфейса [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) внедренного объекта, например изображение, таблицу или гиперссылку, а метод возвращает текстовый диапазон, охватывающий объект. Однако если с внедренным объектом не связан никакой текст, метод возвращает вырожденный текстовый диапазон.

Клиентское приложение может использовать метод [**иуиаутоматионтекстранжепаттерн:: ранжефромпоинт**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider-rangefrompoint) для получения текстового диапазона для видимого текста или внедренного объекта, ближайшего к заданным координатам экрана.

## <a name="selecting-text-in-a-text-range"></a>Выбор текста в текстовом диапазоне

Интерфейс [**иуиаутоматионтекстранже**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) включает ряд методов, позволяющих клиентскому приложению управлять выбором текста в элементе управления на основе текста.

Клиентские приложения могут использовать метод [**иуиаутоматионтекстранже:: SELECT**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-select) , чтобы выбрать текст, соответствующий диапазону текста, и удалить предыдущее выделение (при наличии) из элемента управления "текст". При вызове **SELECT** с разрожденным текстовым диапазоном точка вставки перемещается в расположение текстового диапазона без выбора текста.

Если элемент управления поддерживает выделение нескольких необъединяемых диапазонов текста, клиент может использовать методы [**иуиаутоматионтекстранже:: аддтоселектион**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) и [**ремовефромселектион**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) для добавления диапазонов текста в и удаления из коллекции выбранных текстовых диапазонов. Если элемент управления поддерживает только один выделенный текстовый диапазон за раз, но операция выбора приведет к выбору нескольких необъединяемых текстовых диапазонов, метод возвращает либо ошибку **E \_ INVALIDOPERATION** , либо расширяет или усекает текущий выделенный фрагмент. Клиентское приложение может определить, поддерживает ли элемент управления выбор одного или нескольких фрагментов текста, или вообще ничего, путем проверки свойства [**иуиаутоматионтекстпаттерн:: суппортедтекстселектион**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextpattern-get_supportedtextselection) .

Если текстовый элемент управления поддерживает вставку текста, вызов [**иуиаутоматионтекстранже:: аддтоселектион**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-addtoselection) или [**ремовефромселектион**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-removefromselection) в диапазоне вырожденного текста в элементе управления перемещает точку вставки, но не выделяет текст.

## <a name="retrieving-text-from-a-text-range"></a>Извлечение текста из текстового диапазона

Клиентские приложения могут использовать метод [**иуиаутоматионтекстранже:: GetText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-gettext) для получения обычного текста текстового диапазона. Обычный текст включает все управляющие символы, найденные в исходном тексте, такие как возврат каретки и знак Юникода слева направо (ЛРМ). Обычный текст не включает теги разметки, такие как HTML, которые могут присутствовать в исходном тексте. Кроме того, все Escape-коды в исходном тексте преобразуются в эквиваленты обычного текста. Например, " &nbsp; " преобразуется в простой символ пробела.

Если внедренный объект охватывает диапазон текста, обычный текст включает в себя внутренний текст объекта, но не дополнительный текст (свойство Name внедренного объекта). Дополнительные сведения см. в статье [как модель автоматизации пользовательского интерфейса предоставляет внедренные объекты](uiauto-textpattern-and-embedded-objects-overview.md).

Метод [**иуиаутоматионтекстранже:: строки FindText**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findtext) ищет в текстовом диапазоне определенную строку и, если она найдена, возвращает новый текстовый диапазон, охватывающий строку.

## <a name="retrieving-text-attributes-from-a-text-range"></a>Получение текстовых атрибутов из текстового диапазона

Текстовые атрибуты определяют стиль форматирования текста в элементе управления на основе текста и включают такие элементы, как цвет переднего плана, стиль маркера, размер шрифта и т. д. Модель автоматизации пользовательского интерфейса поддерживает ряд атрибутов текста и определяет идентификатор для каждого поддерживаемого атрибута. Клиентское приложение может запросить значение определенного текстового атрибута в текстовом диапазоне, указав идентификатор атрибута в вызове метода [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) вместе с указателем на структуру [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) , которая получает значение атрибута. Подробные сведения о каждом атрибуте Text, поддерживаемом в модели автоматизации пользовательского интерфейса, см. в разделе [идентификаторы текстовых атрибутов](uiauto-textattribute-ids.md).

Значение, полученное [**GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) , представляет значение атрибута во всем текстовом диапазоне. Если весь текст в диапазоне использует одно и то же значение для указанного атрибута, это значение возвращается функцией **GetAttributeValue**. Однако если значение атрибута изменяется в пределах текстового диапазона, **GetAttributeValue** возвращает указатель [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) на объект статического маркера, именуемый объектом **ресерведмикседаттрибуте** . Чтобы определить, изменяется ли значение атрибута в пределах текстового диапазона, клиентское приложение должно сравнить результаты **GetAttributeValue** с объектом **ресерведмикседаттрибуте** , полученным из свойства [**иуиаутоматион:: ресерведмикседаттрибутевалуе**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservedmixedattributevalue) .

Элемент управления на основе текста не требуется для поддержки всех атрибутов текста модели автоматизации пользовательского интерфейса. Если клиент вызывает метод [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) и передает идентификатор неподдерживаемого атрибута, метод возвращает указатель [**IUnknown**](/windows/desktop/api/unknwn/nn-unknwn-iunknown) на статический объект маркера, именуемый объектом **ресерведнотсуппортед** . Чтобы определить, поддерживается ли определенный атрибут, клиентское приложение должно сравнить результаты **GetAttributeValue** с объектом **ресерведнотсуппортед** , полученным из свойства [**иуиаутоматион:: ресерведнотсуппортедвалуе**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-get_reservednotsupportedvalue) .

Клиентские приложения могут использовать метод [**иуиаутоматионтекстранже:: финдаттрибуте**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-findattribute) для поиска текста в текстовом диапазоне с определенным атрибутом текста. Если объект найден, метод возвращает новый текстовый диапазон, охватывающий соответствующий текст. Обратите внимание, что **финдаттрибуте** Возвращает текстовый диапазон для соответствующего текста, даже если текст не виден.

## <a name="retrieving-embedded-objects-from-a-text-range"></a>Получение внедренных объектов из текстового диапазона

Текстовый диапазон может включать в себя внедренные объекты, такие как таблицы, изображения, гиперссылки и т. д. Клиентское приложение может получить коллекцию всех внедренных объектов в диапазоне, вызвав метод [**иуиаутоматионтекстранже:: Children**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) . Внедренные объекты, которые перекрываются с диапазоном, но не полностью включены в него, также включаются в коллекцию. Если диапазон не содержит внедренных объектов, то **дочерние** коллекции получают пустую коллекцию.

Несмотря на то, что он зависит от поставщика текстового элемента управления, метод [**Children**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) обычно не возвращает потомков внедренных элементов. Например, если текстовый диапазон содержит таблицу с числом дочерних ячеек, метод **дочернего** элемента обычно возвращает только элемент Table, а не элементы ячейки.

В целях повышения производительности или архитектуры [**дочерние элементы**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getchildren) могут не иметь возможности извлечения объектов [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) для всех внедренных объектов в текстовом диапазоне. Вместо этого поставщик может возвращать коллекцию, содержащую виртуализированные элементы. Дополнительные сведения см. в разделе [Работа с виртуализированными элементами](uiauto-workingwithvirtualizeditems.md).

## <a name="manipulating-a-text-range"></a>Управление диапазоном текста

Интерфейс [**иуиаутоматионтекстранже**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) предоставляет несколько методов для манипулирования текстовыми диапазонами и перемещения по ним в элементе управления на основе текста. Методы [**иуиаутоматионтекстранже:: Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move), [**мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit)и [**експандтоенклосингунит**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit) перемещают текстовый диапазон или одну из его конечных точек на указанную единицу текста, например символ, слово, абзац и т. д. Дополнительные сведения см. в разделе [единицы измерения текста модели автоматизации пользовательского интерфейса](/windows/desktop/WinAuto/uiauto-uiautomationtextunits).

Несмотря на свое имя, метод [**експандтоенклосингунит**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-expandtoenclosingunit) не обязательно расширяет текстовый диапазон. Вместо этого он нормализует текстовый диапазон, перемещая конечные точки таким образом, чтобы диапазон затронул указанную единицу текста в точности. Диапазон расширяется, если он меньше указанной единицы, или сокращен, если он превышает заданную единицу. На следующей схеме показано, как **експандтоенклосингунит** нормализует текстовый диапазон, перемещая конечные точки диапазона.

![Схема, показывающая позиции конечных точек до и после вызова експандтоенклосингунит](images/expandtoenclosingunit.jpg)

Если текстовый диапазон начинается с начала текстового блока и заканчивается в начале (или до) следующей границы единицы текста, конечная точка перемещается на следующую границу единицы текста (см. 1 и 2 на предыдущем рисунке).

Если текстовый диапазон начинается в начале текстового блока и заканчивается на единице (или после), конечная точка остается или перемещается назад на следующую границу единицы после начальной конечной точки (см. 3 и 4 на предыдущем рисунке). Если между начальной и конечной конечными точками имеется более одной границы единицы текста, конечная точка перемещается назад к следующей границе единицы после начальной конечной точки, что приводит к подлине текстового диапазона, имеющего одну единицу текста.

Если диапазон текста начинается в середине единицы текста, начальная конечная точка перемещается назад в начало текстового блока, а конечная конечная точка перемещается вперед или назад по мере необходимости на границу следующей единицы после начальной конечной точки (см. описание 5 – 8 на предыдущем рисунке).

При вызове метода [**иуиаутоматионтекстранже:: Move**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-move) поставщик нормализует текстовый диапазон на заданную единицу текста. Затем поставщик перемещает диапазон назад или вперед по заданному числу единиц текста. При перемещении диапазона поставщик игнорирует границы любых внедренных объектов в тексте. (Однако сама граница единицы может зависеть от существования внедренного объекта). На следующей схеме показано, как метод **Move** перемещает текстовый диапазон, единицу измерения между внедренными объектами и границами единиц текста.

![Диаграмма, показывающая, как метод Move перемещает конечные точки диапазона между объектами и границами единиц текста](images/move.jpg)

Метод [**иуиаутоматионтекстранже:: мовиндпоинтбюнит**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyunit) перемещает одну из конечных точек вперед или назад по указанной единице текста. На следующем рисунке показано, как конечная точка перемещается вперед.

![Диаграмма, показывающая, как мовиндпоинтбюнит перемещает конечную точку диапазона](images/moveendpointbyunit.gif)

Метод [**иуиаутоматионтекстранже:: мовиндпоинтбиранже**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-moveendpointbyrange) позволяет клиентскому приложению задать одну конечную точку текстового диапазона в том же расположении, что и указанная конечная точка второго текстового диапазона.

## <a name="scrolling-a-text-range-into-view"></a>Прокрутка текстового диапазона в представление

Метод [**иуиаутоматионтекстранже:: скроллинтовиев**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-scrollintoview) прокручивает текстовый диапазон, чтобы текст был виден в окне просмотра текстового элемента управления. При вызове **скроллинтовиев** клиент может указать, следует ли выровняйте текст по верхнему или нижнему краю окна просмотра.

## <a name="retrieving-the-enclosing-element-of-a-text-range"></a>Извлечение включающего элемента текстового диапазона

Клиентское приложение может использовать метод [**иуиаутоматионтекстранже:: жетенклосинжелемент**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getenclosingelement) для получения указателя на интерфейс [**иуиаутоматион**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) самого внутреннего элемента, охватывающего текстовый диапазон. Включающий элемент обычно является поставщиком текста, предоставляющим текстовый диапазон. Однако если поставщик текста поддерживает дочерние элементы, такие как таблицы или гиперссылки, то включающий элемент может быть потомком поставщика текста.

## <a name="comparing-and-cloning-text-ranges"></a>Сравнение и клонирование диапазонов текста

Интерфейс [**иуиаутоматионтекстранже**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange) включает два метода для сравнения текстовых диапазонов. Метод [**иуиаутоматионтекстранже:: Compare**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-compareendpoints) сравнивает начальную и конечную конечные точки двух текстовых диапазонов и возвращает **значение true** , если обе конечные точки одинаковы. Метод **иуиаутоматионтекстранже:: компариндпоинтс** сравнивает либо начальную, либо конечную конечную точку двух диапазонов. Возвращаемое значение равно нулю, если конечные точки совпадают, или положительное значение или отрицательное значение, указывающее относительное положение двух конечных точек.

Клиентские приложения могут использовать метод [**иуиаутоматионтекстранже:: Clone**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-clone) для создания точной копии текстового диапазона. Новый текстовый диапазон можно манипулировать независимо от исходного диапазона текста.

## <a name="retrieving-annotations"></a>Получение заметок

Текстовый диапазон может содержать заметки, если элемент управления на основе текста поддерживает их. Существует много различных типов заметок. Файл заголовка UIAutomationClient. h определяет набор именованных постоянных значений, которые определяют типы заметок, поддерживаемых автоматизацией пользовательского интерфейса. Дополнительные сведения см. в разделе [**идентификаторы типов заметок**](uiauto-annotation-type-identifiers.md).

Некоторые типы заметок представлены элементом автоматизации, который поддерживает шаблон элемента управления [Annotation](uiauto-implementingannotation.md) (интерфейс [**иуиаутоматионаннотатионпаттерн**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) ). Другие типы заметок предоставляются с помощью шаблона элемента управления [TextRange](uiauto-about-text-and-textrange-patterns.md) . Например, поставщик может предоставить простой индикатор орфографической ошибки, получив метод [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextrangeprovider-getattributevalue) , возвращающий атрибут [**Аннотатионтипес**](uiauto-textattribute-ids.md) Text для [**аннотатионтипе \_ Спеллинжеррор**](uiauto-annotation-type-identifiers.md)и значение NULL для атрибута [**аннотатионобжектс**](uiauto-textattribute-ids.md) Text.

### <a name="retrieving-annotations-types-from-a-text-range"></a>Получение типов заметок из текстового диапазона

Список типов заметок, которые содержатся в текстовом диапазоне, можно получить с помощью метода [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) . При вызове метода укажите идентификатор текстового атрибута [**UIA \_ аннотатионтипесаттрибутеид**](uiauto-textattribute-ids.md) и указатель на параметр типа [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant). Когда метод возвращает значение, параметр **Variant** содержит список идентификаторов типов заметок, по одному для каждого типа заметок в текстовом диапазоне. Дополнительные сведения см. в разделе [**идентификаторы типов заметок**](uiauto-annotation-type-identifiers.md).

### <a name="retrieving-all-annotations-from-a-text-range"></a>Извлечение всех заметок из текстового диапазона

Чтобы получить заметки из текстового диапазона, вызовите метод [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) , указав идентификатор текстового атрибута [**UIA \_ аннотатионобжектсаттрибутеид**](uiauto-textattribute-ids.md) и указатель на параметр типа [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant). Когда метод возвращает значение, параметр **Variant** содержит интерфейс [**иуиаутоматионелементаррай**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelementarray) , представляющий массив элементов автоматизации, по одному для каждой заметки в диапазоне текста. Свойство [**иуиаутоматионелементаррай:: Length**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-get_length) указывает количество элементов в массиве, а метод [**иуиаутоматионелементаррай::-element**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelementarray-getelement) Извлекает интерфейс [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) для определенного элемента.

### <a name="retrieving-information-about-a-particular-annotation"></a>Получение сведений о конкретной заметке

Чтобы получить сведения о конкретной заметке, сначала извлеките интерфейс [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) для элемента Annotation, как описано в предыдущем разделе. Затем извлеките интерфейс [**иуиаутоматионаннотатионпаттерн**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationannotationpattern) для аннотации, вызвав метод [**Иуиаутоматионелемент:: жеткуррентпаттернас**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas) с идентификатором шаблона элемента управления [**UIA \_ аннотатионпаттернид**](uiauto-controlpattern-ids.md), идентификатором интерфейса IID \_ IUIAutomationAnnotationPattern и адресом переменной, которая получает указатель **IUIAutomationAnnotation** для заметки. Запросите свойства интерфейса **иуиаутоматионаннотатион** , чтобы получить имя типа заметки и идентификатор типа, имя автора заметки, дату и время заметки, а также интерфейс **иуиаутоматионелемент** для элемента, для которого задается заметка.

### <a name="retrieving-the-annotation-target-text"></a>Извлечение целевого текста заметки

Как правило, аннотация применяется к некоторым подмножествам текста в текстовом диапазоне. После получения интерфейса [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) для аннотации можно передать интерфейс методу [**IUIAutomationTextRange2:: ранжефроманнотатион**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-itextprovider2-rangefromannotation) , чтобы получить текстовый диапазон, содержащий текст, который является целевым объектом заметки.

## <a name="retrieving-visual-styles"></a>Получение визуальных стилей

Поставщик реализует шаблон элемента управления [styles](/windows/desktop/WinAuto/uiauto-implementingstyles) для описания элемента пользовательского интерфейса, имеющего конкретный стиль, цвет заливки, шаблон заливки или форму. Это особенно полезно при описании элементов в документе, которые часто имеют такие стили. Такие стили часто содержат информацию, которая полезна для клиентов с ограниченными возможностями. Например, стили могут описывать определенную строку как заголовок документа или определенный объект блок-схемы как ромб или окружность.

Для получения имен и идентификаторов визуальных стилей, используемых в текстовом диапазоне, можно использовать метод [**иуиаутоматионтекстранже:: GetAttributeValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange-getattributevalue) . Используйте атрибут [**\_ Стиленамеаттрибутеид текста UIA**](uiauto-textattribute-ids.md) для получения имен стилей и [**UIA \_ стилеидаттрибутеид**](uiauto-textattribute-ids.md) для получения идентификаторов стилей.

Элемент управления на основе текста, поддерживающий стили оформления, может реализовать шаблон элемента управления [styles](/windows/desktop/WinAuto/uiauto-implementingstyles) , чтобы позволить клиентам получать доступ к информации о визуальном стиле, используемом элементом управления. Клиенты обращаются к шаблону элемента управления Styles через интерфейс [**иуиаутоматионстилеспаттерн**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern) . Этот интерфейс можно получить, вызвав метод [**иуиаутоматионелемент:: GetCurrentPattern**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpattern) или [**Жеткуррентпаттернас**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpatternas) , указав [**UIA \_ стилеспаттернид**](uiauto-controlpattern-ids.md) в качестве идентификатора шаблона элемента управления.

Интерфейс [**иуиаутоматионстилеспаттерн**](/windows/desktop/api/uiautomationclient/nn-uiautomationclient-iuiautomationstylespattern) содержит свойства и методы, которые предоставляют следующие сведения о визуальном стиле:

-   Имя визуального стиля, например "нормальный" или "Заголовок 1".
-   Идентификатор визуального стиля. Дополнительные сведения см. в разделе [**идентификаторы стилей**](uiauto-style-identifiers.md).
-   Цвет, используемый для заполнения элемента управления на основе текста.
-   Цвет шаблона, используемого для заполнения элемента управления на основе текста.
-   Форма элемента управления на основе текста.
-   Расширенные свойства; то есть список имен и значений стиля для конкретного элемента управления.

## <a name="invoking-context-menus-from-text-ranges"></a>Вызов контекстных меню из текстовых диапазонов

начиная с Windows 8.1, текстовые диапазоны могут поддерживать интерфейс [**IUIAutomationTextRange2**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationtextrange2) . Этот интерфейс поддерживает метод [**шовконтекстмену**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtextrange2-showcontextmenu) . Этот метод можно вызвать для вызова любого контекстного меню, связанного с текстовым диапазоном. В этом сценарии используется Автозамена диапазонов текста или выбора кандидатов IME. В этих случаях появляется контекстное меню, поддерживающее взаимодействие с пользователем.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Шаблоны элементов управления Text и TextRange](uiauto-implementingtextandtextrange.md)
</dt> <dt>

[Поддержка модели автоматизации пользовательского интерфейса для текстового содержимого](uiauto-ui-automation-textpattern-overview.md)
</dt> <dt>

[Работа с элементами управления на основе текста](uiauto-workingwithtextbasedcontrols.md)
</dt> </dl>

 

 