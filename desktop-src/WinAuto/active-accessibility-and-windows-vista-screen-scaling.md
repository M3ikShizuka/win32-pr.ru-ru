---
title: масштабирование экрана Active Accessibility и Windows Vista
description: Windows Vista позволяет пользователям изменять параметр точек на дюйм (DPI), чтобы большинство элементов пользовательского интерфейса отображались крупнее.
ms.assetid: c781fefd-09f0-4340-b3d3-f4e57308f392
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: acf9c1ff6755507541c08b34e183dd751e0941fc646a1f691e4488884e572c79
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118327064"
---
# <a name="active-accessibility-and-windows-vista-screen-scaling"></a>масштабирование экрана Active Accessibility и Windows Vista

Windows Vista позволяет пользователям изменять параметр точек на дюйм (DPI), чтобы большинство элементов пользовательского интерфейса отображались крупнее. хотя эта функция была доступна в Microsoft Windows, в предыдущих версиях масштабирование пришлось бы реализовать в приложениях. в Windows Vista диспетчер окон рабочего стола выполняет масштабирование по умолчанию для всех приложений, которые не обрабатывали собственное масштабирование. Клиентские приложения Microsoft Active Accessibility должны учитывать эту функцию.

## <a name="scaling-in-windows-vista"></a>Масштабирование в Windows Vista

Значение dpi по умолчанию — 96. Это означает, что 96 пикселов занимают ширину или высоту на одном определенном дюйме. Точный размер "дюйма" зависит от размера и физического разрешения монитора. Например, на мониторе шириной в 12 дюймов при горизонтальном разрешении в 1280 пикселей горизонтальная линия в 96 пикселей имеет протяженность около 9/10 дюйма.

Изменение параметра dpi отличается от изменения разрешения экрана. При масштабировании dpi количество физических пикселей на экране остается неизменным. Однако масштабирование применяется к размеру и расположению элементов пользовательского интерфейса. Это масштабирование может автоматически выполняться диспетчером окон рабочего стола для рабочего стола и для приложений, в которых не указан явный запрет на масштабирование.

Фактически, когда пользователь устанавливает коэффициент масштабирования 120 dpi, вертикальный или горизонтальный дюйм на экране станет больше 25%. Все измерения масштабируются согласованно. Смещение окна от верхнего и левого краев экрана увеличивается на 25 процентов. Размер окна увеличивается в той же пропорции вместе с смещениями и размерами всех элементов пользовательского интерфейса, которые он содержит.

По умолчанию DWM не выполняет масштабирование для приложений, не поддерживающих dpi, когда пользователь устанавливает значение dpi равным 120, но выполняет его, если для dpi задано пользовательское число 144 или выше. Тем не менее пользователь может переопределить поведение по умолчанию.

Масштабирование экрана создает новые проблемы для приложений, которые каким-либо образом связаны с экранными координатами. Теперь экран содержит две системы координат: физическую и логическую. Физические координаты точки являются фактическим смещением в пикселях от верхнего левого угла начала координат. Логические координаты — это смещения, какими они были бы, если бы сами пиксели масштабировались.

Предположим, вы разрабатываете диалоговое окно с кнопкой, имеющей координаты (100, 48). Когда это диалоговое окно отображается по умолчанию 96 dpi, кнопка находится в расположениях с физическими координатами (100, 48). В 120 dpi он находится в физических координатах (125, 60). Однако логические координаты одинаковы при любом значении DPI: (100, 48).

Логические координаты важны, так как они делают поведение операционной системы и приложений совместимым, независимо от параметра dpi. Например, **System. Windows. Forms. Cursor. положением** обычно возвращает логические координаты. При перемещении курсора по элементу в диалоговом окне возвращаются одни и те же координаты независимо от параметра dpi. Если нарисовать элемент управления в (100, 100), он выводится на эти логические координаты и будет занимать ту же относительную точку при любом значении DPI.

## <a name="scaling-in-active-accessibility-clients"></a>Масштабирование в Active Accessibility клиентов

Microsoft Active Accessibility не использует логические координаты. Следующие методы и функции возвращают физические координаты или принимают их в качестве параметров.

-   [**IAccessible:: Акчиттест**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acchittest)
-   [**IAccessible:: Акклокатион**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation)
-   [**акцессиблеобжектфромпоинт**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint)

По умолчанию клиентское приложение Microsoft Active Accessibility, работающее в среде без 96 dpi, не сможет получить правильные результаты этих вызовов. Например, поскольку положением курсора являются логические координаты, клиент не может просто передать эти координаты [**акцессиблеобжектфромпоинт**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint) , чтобы получить элемент, находящийся под курсором.

Кроме того, приложение, которое создает окно за пределами клиентской области, например приложение для специальных возможностей, которое выделяет элементы пользовательского интерфейса, не создает окно в правильном расположении на экране, так как окно будет помещено на логические координаты, а не на физические координаты, возвращаемые методом [**IAccessible:: акклокатион**](/windows/desktop/api/Oleacc/nf-oleacc-iaccessible-acclocation).

Решение состоит из двух частей:

-   Установите клиентское приложение "с учетом dpi". Для этого вызовите функцию [**сетпроцессдпиаваре**](/windows/win32/api/winuser/nf-winuser-setprocessdpiaware) при запуске. Эта функция выполняет весь процесс, учитывающий dpi, что означает, что все окна, принадлежащие процессу, не масштабируются.
-   Используйте функции с поддержкой dpi. Например, чтобы получить координаты курсора, вызовите функцию [**жетфисикалкурсорпос**](/windows/win32/api/winuser/nf-winuser-getphysicalcursorpos) . Не используйте [**жеткурсорпос**](/windows/win32/api/winuser/nf-winuser-getcursorpos). его поведение в приложениях, поддерживающих dpi, не определено.

Если приложение выполняет прямое межпроцессное взаимодействие с приложениями, не поддерживающими dpi, возможно преобразование между логическими и физическими координатами с помощью функций [**фисикалтологикалпоинт**](/windows/win32/api/winuser/nf-winuser-physicaltologicalpoint) и [**логикалтофисикалпоинт**](/windows/win32/api/winuser/nf-winuser-logicaltophysicalpoint) .

 

 