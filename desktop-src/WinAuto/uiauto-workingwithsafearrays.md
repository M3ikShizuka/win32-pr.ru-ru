---
title: Рекомендации по использованию безнадежных массивов
description: Многие методы интерфейса службы автоматизации пользовательского интерфейса Майкрософт \ 32; API принимает аргументы, называемые безнадежными массивами, типа данных SAFEARRAY. В этом разделе описаны рекомендации по использованию безнадежных массивов в приложениях автоматизации пользовательского интерфейса.
ms.assetid: 07e87cfd-d565-41b5-a68d-b99dd191fa95
keywords:
- Модель автоматизации пользовательского интерфейса, надежные массивы
- Автоматизация пользовательского интерфейса, поставщики
- Модель автоматизации пользовательского интерфейса, клиенты
- Модель автоматизации пользовательского интерфейса, преобразование типов данных
- Клиенты, надежные массивы
- поставщики, модель автоматизации пользовательского интерфейса
- надежные массивы
- типы данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b12ade30398f8fbeb43336707f66a0709dfab83d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "105700899"
---
# <a name="best-practices-for-using-safe-arrays"></a>Рекомендации по использованию безнадежных массивов

Многие методы интерфейса API Microsoft UI Automation принимают аргументы, называемые безнадежными массивами, типа данных [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) . В этом разделе описаны рекомендации по использованию безнадежных массивов в приложениях автоматизации пользовательского интерфейса.

## <a name="clients"></a>Клиенты

Все надежные массивы, используемые с методами API клиента автоматизации пользовательского интерфейса, — это одномерные массивы, начинающиеся с нуля. Чтобы создать защищенный массив для клиентского метода автоматизации пользовательского интерфейса, используйте функцию [**сафеаррайкреатевектор**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-safearraycreatevector) , а для чтения из безопасного массива и записи в него используйте функции [**сафеаррайжетелемент**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-safearraygetelement) и [**сафеаррайпутелемент**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-safearrayputelement) . По завершении использования безопасного массива всегда уничтожайте его с помощью функции [**сафеаррайдестрой**](/windows/desktop/api/oleauto/nf-oleauto-safearraydestroy) , независимо от того, был ли вы создали сейфовый массив или получили его из клиентского метода автоматизации пользовательского интерфейса.

Несколько методов автоматизации пользовательского интерфейса, включая методы получения свойств, такие как [**GetCurrentPropertyValue**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpropertyvalue), получают [**варианты**](/windows/win32/api/oaidl/ns-oaidl-variant), которые могут содержать структуры [**Point**](/previous-versions//dd162805(v=vs.85)) или [**уиарект**](/windows/desktop/api/UIAutomationCore/ns-uiautomationcore-uiarect) . **Точка** упаковывается в **Variant** как надежный массив значений типа Double (VT \_ R8) с элементом **x** с индексом 0, а элемент **y** — с индексом 1. Аналогичным образом **уиарект** упаковывается в **вариант** в виде безопасного массива значений типа Double с **левым**, **верхним**, **шириной** и **высотой** в индексах от 0 до 3 соответственно. Для массива структур **уиарект** надежный массив содержит последовательный массив из четырех значений Double для каждого **уиарект**. Элементы **левого**, **верхнего**, **ширины** и **высоты** первого **уиарект** занимают индекс от 0 до 3, элементы второго прямоугольника занимают индекс 4 – 7 и т. д.

Интерфейс [**иуиаутоматион**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomation) включает следующие методы для преобразования между [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) и различными типами данных.



| Метод                                                                                               | Описание                                                                                                     |
|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| [**Иуиаутоматион:: Интнативеаррайтосафеаррай**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-intnativearraytosafearray)   | Преобразует массив целых чисел в тип [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray).                                          |
| [**Иуиаутоматион:: Интсафеаррайтонативеаррай**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-intsafearraytonativearray)   | Преобразует массив [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) целых чисел в массив.                                          |
| [**Иуиаутоматион:: Сафеаррайторектнативеаррай**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-safearraytorectnativearray) | Преобразует массив [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) , содержащий координаты прямоугольника, в массив типа **Rect**. |



 

## <a name="providers"></a>Поставщики

Поставщик должен реализовать ряд методов интерфейса, которые вызываются автоматизацией пользовательского интерфейса для получения сведений от поставщика. Множество раз эта информация состоит из массива значений. Чтобы вернуть массив в модель автоматизации пользовательского интерфейса, поставщик должен упаковать массив в структуру [**SAFEARRAY**](/windows/win32/api/oaidl/ns-oaidl-safearray) . Элементы массива должны иметь ожидаемый тип данных и должны находиться в ожидаемом порядке.

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Общие сведения о свойствах автоматизированного пользовательского интерфейса](uiauto-propertiesoverview.md)
</dt> <dt>

[Основы модели автоматизации пользовательского интерфейса](entry-uiautocore-overview.md)
</dt> </dl>

 

 