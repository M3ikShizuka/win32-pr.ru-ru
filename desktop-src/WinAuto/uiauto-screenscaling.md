---
title: Основные сведения о проблемах масштабирования экрана
description: Windows Vista и более поздние версии операционной системы позволяют пользователям изменять параметр точек на дюйм (DPI), чтобы большинство элементов пользовательского интерфейса отображались крупнее.
ms.assetid: 27dc49e7-2466-4ea3-a6d9-5ea86d6b4c60
keywords:
- Клиенты, масштабирование экрана модели автоматизации пользовательского интерфейса
- Клиенты, масштабирование экрана
- Клиенты, масштабирование
- Модель автоматизации пользовательского интерфейса, масштабирование экрана
- Модель автоматизации пользовательского интерфейса, масштабирование
- Масштабирование экрана
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4dcdc8d586b4320e4da04dfdd7e0264f36074cc59fa53f42333ec5a6c3dd135
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119614294"
---
# <a name="understanding-screen-scaling-issues"></a>Основные сведения о проблемах масштабирования экрана

Windows Vista и более поздние версии операционной системы позволяют пользователям изменять параметр точек на дюйм (DPI), чтобы большинство элементов пользовательского интерфейса отображались крупнее. в более ранних версиях Windows масштабирование было реализовано приложениями. в Windows Vista и более поздних версиях диспетчер окон рабочего стола (DWM) выполняет масштабирование по умолчанию для всех приложений, которые не обрабатывали собственное масштабирование. Клиентские приложения Microsoft UI Automation должны учитывать эту функцию.

Этот раздел состоит из следующих подразделов.

-   [масштабирование в Windows Vista и более поздних версиях](#scaling-in-windows-vista-and-later)
-   [Масштабирование в клиентах автоматизации пользовательского интерфейса](#scaling-in-ui-automation-clients)

## <a name="scaling-in-windows-vista-and-later"></a>масштабирование в Windows Vista и более поздних версиях

Значение dpi по умолчанию — 96. Это означает, что 96 пикселов занимают ширину или высоту на одном определенном дюйме. Точный размер "дюйма" зависит от размера и физического разрешения монитора. Например, на мониторе шириной в 12 дюймов при горизонтальном разрешении в 1280 пикселей горизонтальная линия в 96 пикселей имеет протяженность около 9/10 дюйма.

Изменение параметра dpi отличается от изменения разрешения экрана. При масштабировании dpi количество физических пикселей на экране остается неизменным. Однако масштабирование применяется к размеру и расположению элементов пользовательского интерфейса. Это масштабирование может выполняться автоматически с помощью DWM для настольных систем и для приложений, которые явно не запрашивают масштабирование.

Фактически, когда пользователь устанавливает коэффициент масштабирования 120 dpi, вертикальный или горизонтальный дюйм на экране станет больше 25%. Все измерения масштабируются согласованно. Смещение окна приложения от верхнего и левого края экрана увеличивается на 25 процентов. Если масштабирование приложений включено и приложение не учитывает dpi, размер окна увеличивается в той же пропорции, а также смещения и размеров всех элементов пользовательского интерфейса, которые он содержит.

> [!Note]  
> По умолчанию DWM не выполняет масштабирование для приложений, не поддерживающих разрешение dpi, когда пользователь устанавливает значение dpi равным 120, но выполняет масштабирование, если значение dpi равно значению 144 или выше. Тем не менее пользователь может переопределить поведение по умолчанию.

 

Масштабирование экрана создает новые проблемы для приложений, которые каким-либо образом связаны с экранными координатами. Теперь экран содержит две системы координат: физическую и логическую. Физические координаты точки являются фактическим смещением в пикселях от левого верхнего угла исходной точки. Логические координаты — это смещения, какими они были бы, если бы сами пиксели масштабировались.

Предположим, вы разрабатываете диалоговое окно с кнопкой, имеющей координаты (100, 48). Когда это диалоговое окно отображается по умолчанию 96 dpi, кнопка находится в расположениях с физическими координатами (100, 48). В 120 dpi он находится в физических координатах (125, 60). Однако логические координаты одинаковы при любом значении DPI: (100, 48).

Логические координаты важны, так как они делают поведение операционной системы и приложений совместимым, независимо от параметра dpi. Например, функция [**жеткурсорпос**](/windows/desktop/api/winuser/nf-winuser-getcursorpos) возвращает логические координаты. При перемещении курсора по элементу в диалоговом окне возвращаются те же координаты независимо от параметра dpi. Если нарисовать элемент управления в (100, 100), он выводится на эти логические координаты и будет занимать ту же относительную точку при любом значении DPI.

## <a name="scaling-in-ui-automation-clients"></a>Масштабирование в клиентах автоматизации пользовательского интерфейса

API модели автоматизации пользовательского интерфейса не использует логические координаты. Следующие методы и свойства возвращают физические координаты или принимают физические координаты в качестве параметров.

-   [**Иуиаутоматион:: Елементфромпоинт**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompoint)
-   [**Иуиаутоматион:: Елементфромпоинтбуилдкаче**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompointbuildcache)
-   [**Иуиаутоматионелемент:: Жеткликкаблепоинт**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getclickablepoint)
-   [**Иуиаутоматионелемент:: Куррентбаундингректангле**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_currentboundingrectangle)
-   [**Иуиаутоматионелемент:: Качедбаундингректангле**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_cachedboundingrectangle)
-   [**Иравелементпровидерфрагмент:: Баундингректангле**](/windows/desktop/api/UIAutomationCore/nf-uiautomationcore-irawelementproviderfragment-get_boundingrectangle)

По умолчанию приложения автоматизации пользовательского интерфейса, работающие в среде, для которой не задано значение 96 dpi, не получат правильные результаты из этих методов и свойств. Например, поскольку расположение курсора находится в логических координатах, клиент не может передать эти координаты в [**иуиаутоматион:: елементфромпоинт**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompoint) , чтобы получить элемент, находящийся под курсором. Кроме того, такое приложение не сможет правильно разместить окна за пределами клиентской области.

Решение состоит из двух частей.

Во-первых, сделайте так, чтобы клиентское приложение было ориентировано на dpi. Для этого вызовите функцию [**сетпроцессдпиаваре**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) при запуске. Эта функция выполняет весь процесс, учитывающий dpi, что означает, что все окна, принадлежащие процессу, не масштабируются.

Во вторых, чтобы получить координаты курсора, вызовите функцию [**жетфисикалкурсорпос**](/windows/desktop/api/winuser/nf-winuser-getphysicalcursorpos) .

 

 