---
title: Кэширование свойств и шаблонов элементов управления автоматизации пользовательского интерфейса
description: При использовании Microsoft UI Automation клиентам часто требуется получить несколько свойств для нескольких элементов автоматизации.
ms.assetid: 948b3bb9-75a9-4197-9680-e6fe7bb86feb
keywords:
- кэширование, свойства модели автоматизации пользовательского интерфейса
- кэширование, свойства
- кэширование, шаблоны элементов управления модели автоматизации пользовательского интерфейса
- кэширование, шаблоны элементов управления
- Модель автоматизации пользовательского интерфейса, свойства кэширования
- Модель автоматизации пользовательского интерфейса, кэширование свойств
- Клиенты, свойства автоматизации пользовательского интерфейса кэширования
- Клиенты, шаблоны элементов управления автоматизации пользовательского интерфейса для кэширования
- Модель автоматизации пользовательского интерфейса, шаблоны элементов управления кэшированием
- Модель автоматизации пользовательского интерфейса, кэширование шаблонов элементов управления
- шаблоны элементов управления, кэширование
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 69f75a7dc9491565fdfdc0ecc73808c2fb6a9d82
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104410764"
---
# <a name="caching-ui-automation-properties-and-control-patterns"></a>Кэширование свойств и шаблонов элементов управления автоматизации пользовательского интерфейса

При использовании Microsoft UI Automation клиентам часто требуется получить несколько свойств для нескольких элементов автоматизации. Клиент может получить отдельные свойства по одному элементу за раз, используя методы получения свойств, такие как [**иуиаутоматионелемент:: куррентнаме**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_currentname) или [**куррентакцесскэй**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_currentaccesskey). Однако этот метод работает достаточно долго и неэффективно, поскольку для каждого получаемого свойства требуется кросс-процессный вызов. Для повышения производительности клиенты могут использовать функции кэширования (также называемые массовым извлечением) модели автоматизации пользовательского интерфейса. Кэширование позволяет клиенту получать все необходимые свойства для всех нужных элементов с помощью одного вызова метода. Затем клиент может получить отдельные свойства из кэша по мере необходимости и периодически получать новый моментальный снимок кэша, обычно в ответ на события, которые обозначают изменения в пользовательском интерфейсе.

Приложение может запрашивать кэширование при извлечении элемента модели автоматизации пользовательского интерфейса с помощью метода, такого как [**иуиаутоматион:: елементфромпоинтбуилдкаче**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-elementfrompointbuildcache), [**Иуиаутоматионтривалкер:: жетфирстчилделементбуилдкаче**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationtreewalker-getfirstchildelementbuildcache)или [**IUIAutomationElement:: FindFirstBuildCache**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-findfirstbuildcache).

Кэширование также происходит при указании запроса кэша во время подписки на события. Элемент модели автоматизации пользовательского интерфейса, переданный обработчику событий как источник события, содержит кэшированные свойства и шаблоны элементов управления, заданные запросом кэша. Любые изменения, внесенные в запрос кэша после подписки на событие, не действуют.

В этом разделе содержатся следующие подразделы.

-   [Запросы кэша](#cache-requests)
    -   [Указание свойств и шаблонов элементов управления для кэширования](#specifying-property-and-control-patterns-to-cache)
    -   [Указание области и фильтрации запроса кэширования](#specifying-the-scoping-and-filtering-of-a-caching-request)
    -   [Стойкость ссылок на элементы](#strength-of-element-references)
-   [Получение кэшированных дочерних и родительских элементов](#retrieving-cached-children-and-parents)
-   [Получение нового моментального снимка кэша](#retrieving-a-new-snapshot-of-the-cache)
-   [Примеры](#examples)
-   [См. также](#related-topics)

## <a name="cache-requests"></a>Запросы кэша

Кэширование включает определение извлекаемых свойств и элементов, из которых они извлекаются, а затем использование этих сведений для создания запроса кэша. Всякий раз, когда клиент получает интерфейс [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) для элемента пользовательского интерфейса, модель автоматизации пользовательского интерфейса кэширует сведения, указанные в запросе кэша.

Чтобы создать запрос к кэшу, начните с использования метода [**иуиаутоматион:: креатекачерекуест**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomation-createcacherequest) , чтобы получить указатель на интерфейс [**иуиаутоматионкачерекуест**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationcacherequest) . Затем настройте запрос кэша с помощью методов **иуиаутоматионкачерекуест**.

### <a name="specifying-property-and-control-patterns-to-cache"></a>Указание свойств и шаблонов элементов управления для кэширования

Вы можете указать свойства для кэширования, вызвав [**иуиаутоматионкачерекуест:: AddProperty**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-addproperty). Вы можете указать шаблоны элементов управления для кэширования, вызвав [**иуиаутоматионкачерекуест:: аддпаттерн**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-addpattern). При кэшировании шаблона элемента управления его свойства не кэшируются автоматически. необходимо указать свойства, которые необходимо кэшировать с помощью **AddProperty**.

Можно получить свойство шаблона элемента управления (например, свойство Value шаблона элемента управления [value](uiauto-implementingvalue.md) ), не получая весь шаблон элемента управления в кэш. Шаблон элемента управления необходимо получить только в том случае, если необходимо использовать метод шаблона элемента управления.

### <a name="specifying-the-scoping-and-filtering-of-a-caching-request"></a>Указание области и фильтрации запроса кэширования

Можно указать элементы, свойства и шаблоны элементов управления, которые необходимо кэшировать, задав свойство [**иуиаутоматионкачерекуест:: TreeScope**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-get_treescope) перед использованием запроса. Область задается относительно элементов, извлекаемых методом, к которому передается запрос кэша. Например, если задать только [**\_ дочерние элементы TreeScope**](/windows/desktop/api/UIAutomationClient/ne-uiautomationclient-treescope), а затем извлечь элемент модели автоматизации пользовательского интерфейса, будут кэшироваться свойства и шаблоны элементов управления дочерних элементов, но свойства и шаблоны элементов управления самого элемента не кэшируются. Чтобы обеспечить кэширование для полученного элемента, необходимо включить **\_ элемент TreeScope** в свойство **иуиаутоматионкачерекуест:: TreeScope** . Невозможно задать область **TreeScope \_ родительских** или **TreeScope \_ предков**. Однако родительский элемент может быть кэширован, когда кэшируется дочерний элемент; см. подраздел "Получение кэшированных дочерних и родительских элементов" в этом разделе.

На экстент кэширования также влияет свойство [**иуиаутоматионкачерекуест:: трифилтер**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-get_treefilter) . По умолчанию кэширование выполняется только для элементов, которые отображаются в представлении элемента управления дерева модели автоматизации пользовательского интерфейса. Однако можно изменить это свойство, чтобы кэширование применялось ко всем элементам или только к элементам, отображаемым в представлении содержимого.

### <a name="strength-of-element-references"></a>Стойкость ссылок на элементы

При извлечении элемента автоматизации по умолчанию у вас есть доступ ко всем свойствам и шаблонам элементов управления этого элемента, включая те свойства и шаблоны элементов управления, которые не были кэшированы. Однако можно указать, что ссылка на элемент ссылается только на кэшированные данные, задав для свойства [**иуиаутоматионкачерекуест:: аутоматионелементмоде**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-get_automationelementmode) значение **аутоматионелементмоде \_ None**. В этом случае у вас нет доступа к некэшированным свойствам и шаблонам элементов управления извлеченных элементов. Это означает, что вы не можете получить доступ к любым текущим свойствам, таким как [**иуиаутоматионелемент:: куррентисенаблед**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-get_currentisenabled) , или получить шаблон элемента управления с помощью [**Иуиаутоматионелемент:: GetCurrentPattern**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcurrentpattern). В кэшированных шаблонах элементов управления нельзя вызывать методы, выполняющие действия с элементом управления, например [**иуиаутоматионинвокепаттерн:: Invoke**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationinvokepattern-invoke).

Примером приложения, которое может не требовать полных ссылок на объекты, является средство чтения с экрана, которое может выполнять предварительную выборку имени и свойства типа элементов в окне, не требуя самих объектов элементов автоматизации.

## <a name="retrieving-cached-children-and-parents"></a>Получение кэшированных дочерних и родительских элементов

При получении элемента автоматизации и запросе кэширования для дочерних элементов этого элемента через свойство [**иуиаутоматионкачерекуест:: TreeScope**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationcacherequest-get_treescope) запроса можно получить дочерние элементы, вызвав [**Иуиаутоматионелемент:: жеткачедчилдрен**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcachedchildren) в извлеченном элементе.

Если [**\_ элемент TreeScope**](/windows/desktop/api/UIAutomationClient/ne-uiautomationclient-treescope) был включен в область запроса кэша, корневой элемент запроса можно получить, вызвав [**иуиаутоматионелемент:: жеткачедпарент**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-getcachedparent) в любом из дочерних элементов.

> [!Note]  
> Нельзя кэшировать родителей или предков корневого элемента запроса.

 

## <a name="retrieving-a-new-snapshot-of-the-cache"></a>Получение нового моментального снимка кэша

Кэш действителен только при условии, что в пользовательском интерфейсе ничего не меняется. Приложение отвечает за получение нового моментального снимка кэша, как правило, в ответ на события.

При оформлении подписки на событие с запросом кэша вы получаете [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) новый моментальный снимок кэша в качестве источника события при каждом вызове обработчика событий. Можно также получить новый моментальный снимок кэшированных данных для элемента, вызвав [**иуиаутоматионелемент:: буилдупдатедкаче**](/windows/desktop/api/UIAutomationClient/nf-uiautomationclient-iuiautomationelement-buildupdatedcache). Вы можете передать исходный [**иуиаутоматионкачерекуест**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationcacherequest) , чтобы получить новый моментальный снимок всех данных, которые были ранее кэшированы.

Получение нового моментального снимка кэша не изменяет свойства существующих ссылок [**иуиаутоматионелемент**](/windows/desktop/api/UIAutomationClient/nn-uiautomationclient-iuiautomationelement) .

## <a name="examples"></a>Примеры

Примеры кода, демонстрирующие использование возможностей кэширования в модели автоматизации пользовательского интерфейса, см. [в статье Использование кэширования](uiauto-howto-use-caching.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

**Зрения**
</dt> <dt>

[Общие сведения о шаблонах элементов управления модели автоматизации пользовательского интерфейса](uiauto-controlpatternsoverview.md)
</dt> <dt>

[Получение элементов автоматизации пользовательского интерфейса](uiauto-obtainingelements.md)
</dt> <dt>

[Общие сведения о свойствах автоматизированного пользовательского интерфейса](uiauto-propertiesoverview.md)
</dt> </dl>

 

 




