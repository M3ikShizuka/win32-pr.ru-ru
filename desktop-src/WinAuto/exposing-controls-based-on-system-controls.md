---
title: Предоставление доступа к элементам управления на основе системных элементов управления
description: Предоставление доступа к элементам управления на основе системных элементов управления
ms.assetid: 9291b79e-3ed0-4f3c-a610-38215d84f5ff
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea2fe31eae8c2283c020de93b0c1f3350bd0f417
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127145813"
---
# <a name="exposing-controls-based-on-system-controls"></a>Предоставление доступа к элементам управления на основе системных элементов управления

Прежде чем приступать к приему, описанному в этом разделе, следует рассмотреть возможность использования динамической аннотации (прямой, картой значений или сервера). Дополнительные сведения см. в разделе [Динамическая Аннотация API](dynamic-annotation-api.md).

В большинстве случаев Microsoft Active Accessibility предоставляет сведения об элементах управления класса или подклассов. Создание классов и подклассов позволяет разработчику приложения создавать пользовательские элементы управления с базовой функциональностью системного элемента управления и включать улучшения, предоставляемые приложением. Элемент управления "веб-класс" имеет имя класса окна, отличное от имени системного элемента управления, на котором он основан. Элемент управления с подклассом имеет то же имя класса окна. дополнительные сведения о классах и подклассах см. в документации по пакету Windows Software Development Kit (SDK).

Поскольку Microsoft Active Accessibility предоставляет сведения о предоставляемых системой элементах управления, Microsoft Active Accessibility предоставляет измененный элемент управления, если только он не сильно отличается от базового элемента управления. Чтобы определить, доступен ли измененный элемент управления, разработчики приложений должны использовать такие служебные программы, как [Проверка](inspect-objects.md) и [доступ к наблюдателю событий](accessible-event-watcher.md) , чтобы сравнить поведение измененного элемента управления с базовым элементом управления.

Если после использования этих служебных программ вы определили, что измененный элемент управления недоступен, элемент управления необходимо рассматривать как любой другой пользовательский элемент управления. Элемент управления должен активировать события, а процедура окна приложения должна реагировать на сообщение [**WM \_ GetObject**](wm-getobject.md), предоставив интерфейс [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) , используемый клиентскими приложениями для получения сведений об элементе управления.

## <a name="createstdaccessibleproxy-and-createstdaccessibleobject"></a>Креатестдакцессиблепрокси и Креатестдакцессиблеобжект

Если все или большинство свойств [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) для измененного элемента управления совпадают с базовым элементом управления, используйте [**креатестдакцессиблепрокси**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleproxya) или [**креатестдакцессиблеобжект**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleobject) , чтобы упростить реализацию интерфейса **IAccessible** элемента управления.

> [!Note]  
> При использовании класса, реализующего класс, или подклассом, необходимо учитывать, что объект, полученный функцией [**креатестдакцессиблеобжект**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleobject) , может реализовывать не только интерфейс [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) . Он может включать другие интерфейсы, такие как [IEnumVARIANT](/windows/win32/api/oaidl/nn-oaidl-ienumvariant). Возможно, потребуется обернуть эти дополнительные интерфейсы, чтобы обеспечить поддержку специальных возможностей, предоставляемых исходным историей элемента управления.

 

Функции [**креатестдакцессиблепрокси**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleproxya) и [**креатестдакцессиблеобжект**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleobject) извлекают указатель интерфейса [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) для указанного системного элемента управления. Разница в этих функциях заключается в том, что **креатестдакцессиблеобжект** использует имя класса Window, полученное из параметра *HWND* , тогда как **креатестдакцессиблепрокси** использует имя класса Window, указанное в его параметре *сзкласснаме* . Таким образом, если вы решили использовать эти функции, используйте **креатестдакцессиблепрокси** , чтобы предоставить сведения о элементах управления с помощью класса, и либо функцию с подклассом Controls.

После получения указателя интерфейса [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) на системный элемент управления используйте указатель в реализации интерфейса **IAccessible** для измененного элемента управления. Если свойство или метод для измененного элемента управления совпадает с базовым элементом управления, используйте указатель **IAccessible** , чтобы получить сведения, предоставленные базовым элементом управления. Если свойство измененного элемента управления отличается от базового элемента управления, переопределите свойство базового элемента управления.

В следующем примере **какккустомбуттон** — это определяемый приложением класс, производный от [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible). Переменная-член **m \_ паккдефаултбуттон** является указателем на интерфейс **IAccessible** , который был получен из [**креатестдакцессиблеобжект**](/windows/desktop/api/Oleacc/nf-oleacc-createstdaccessibleobject) во время процедуры инициализации элемента управления. В этом примере свойство **Role** для пользовательского элемента управления совпадает со свойством **Role** элемента управления System, поэтому возвращается свойство **Role** базового элемента управления. Однако свойство **Description** отличается от базового элемента управления, поэтому это свойство переопределяется.


```C++
HRESULT CAccCustomButton::Initialize( HWND hWnd, HINSTANCE hInst )
{
.
.
.
    hr = CreateStdAccessibleObject( m_hWnd, 
                                    OBJID_CLIENT, 
                                    IID_IAccessible, 
                                    (void **) &m__pAccDefaultButton );
.
.
.
}

STDMETHODIMP CAccCustomButton::get_accRole( VARIANT varID )
{
    return m_pAccDefaultButton->get_accRole(varID);
}


STDMETHODIMP CAccCustomButton::get_accDescription( VARIANT varChild,
                                                   BSTR* pszDesc )
{
    TCHAR   szString[256];
    OLECHAR wszString[256];

    LoadString( m_hInst, ID_DESCRIPTION, szString, 256 );
    MultiByteToWideChar( CP_ACP, 0, szString, -1, wszString, 256 );
   *pszDesc = SysAllocString( wszString );
   if ( !pszDesc )
       return S_OK;
   else
       return E_OUTOFMEMORY;
}
```



Дополнительные сведения о свойствах и методах [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) системных элементов управления см. [в приложении A: Поддерживаемые ссылки на элементы пользовательского интерфейса](appendix-a--supported-user-interface-elements-reference.md).

 

 