---
description: Извлекает дескриптор указанного принтера, сервера печати или других типов дескрипторов в подсистеме печати при настройке некоторых параметров принтера.
ms.assetid: e2370ae4-4475-4ccc-a6f9-3d33d1370054
title: Функция OpenPrinter2 (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- OpenPrinter2
- OpenPrinter2A
- OpenPrinter2W
api_type:
- DllExport
api_location:
- Spoolss.dll
ms.openlocfilehash: 132e7225850899cb33ff815c2fce309fd70a9d288839da2bbf20a6e9f8aafc50
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119776504"
---
# <a name="openprinter2-function"></a>Функция OpenPrinter2

Извлекает дескриптор указанного принтера, сервера печати или других типов дескрипторов в подсистеме печати при настройке некоторых параметров принтера.

## <a name="syntax"></a>Синтаксис


```C++
BOOL OpenPrinter2(
  _In_  LPCTSTR            pPrinterName,
  _Out_ LPHANDLE           phPrinter,
  _In_  LPPRINTER_DEFAULTS pDefault,
  _In_  PPRINTER_OPTIONS   pOptions
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*ппринтернаме* \[ окне\]
</dt> <dd>

Указатель на константную строку, завершающуюся нулем, которая указывает имя принтера или сервера печати, объект принтера, Ксквмонитор или Ксквпорт.

Для объекта принтера используйте: Принтернаме, задание XXXX. Для Ксквмонитор используйте: ServerName, Ксквмонитор Мониторнаме. Для Ксквпорт используйте: ServerName, Ксквпорт Портнаме.

**Windows Vista:** **Значение NULL** указывает на локальный сервер печати.

</dd> <dt>

*фпринтер* \[ заполняет\]
</dt> <dd>

Указатель на переменную, которая получает маркер для открытого принтера или объекта сервера печати.

</dd> <dt>

*пдефаулт* \[ окне\]
</dt> <dd>

Указатель на структуру [**\_ по умолчанию принтера**](printer-defaults.md) . Это значение может быть **равно NULL**.

</dd> <dt>

*поптионс* \[ окне\]
</dt> <dd>

Указатель на структуру [**\_ параметров принтера**](printer-options.md) . Это значение может быть **равно NULL**.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение будет ненулевым.

Если функция выполняется неудачно, возвращается нулевое значение. Для получения расширенных сведений об ошибках вызовите [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror).

## <a name="remarks"></a>Remarks

Не вызывайте этот метод в [**DllMain**](/windows/desktop/Dlls/dllmain).

> [!Note]  
> Это блокирующая или синхронная функция, которая может не возвращать значение немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Версия ANSI этой функции не реализована и возвращает ошибку \_ не \_ поддерживается.

Параметр *пдефаулт* позволяет указать тип данных и значения режима устройства, используемые для печати документов, отправляемых функцией [**стартдокпринтер**](startdocprinter.md) . Однако эти значения можно переопределить с помощью функции [**сетжоб**](setjob.md) после запуска документа.

Можно вызвать функцию **OpenPrinter2** , чтобы открыть обработчик для сервера печати или определить права доступа клиента к серверу печати. Для этого укажите имя сервера печати в параметре *ппринтернаме* , установите для элементов **пдататипе** и **пдевмоде** структуры [**принтеров \_ по умолчанию**](printer-defaults.md) **значение NULL**, а для элемента **десиредакцесс** задайте значение маски доступа сервера, например сервер \_ все \_ доступ. По завершении работы с маркером передайте его в функцию [**клосепринтер**](closeprinter.md) , чтобы закрыть его.

Используйте элемент **десиредакцесс** в структуре [**\_ параметров принтера**](printer-defaults.md) , чтобы указать необходимые права доступа. Права доступа могут быть одним из следующих.



| Требуемое значение доступа                        | Значение                                                                                                                                                                                      |
|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| доступ к ПРИНТЕРу — \_ \_ Администрирование                 | Для выполнения административных задач, например, предоставляемых [**сетпринтер**](setprinter.md).                                                                                                 |
| \_Использование доступа к принтерам \_                        | Для выполнения основных операций печати.                                                                                                                                                        |
| \_доступ ко всем принтерам \_                        | Для выполнения всех административных задач и базовых операций печати, кроме синхронизации. См. раздел [стандартные права доступа](/windows/desktop/SecAuthZ/standard-access-rights).                                         |
| доступ к ПРИНТЕРу — \_ \_ Управление \_ ограниченным доступом            | Для выполнения административных задач, например, предоставляемых [**сетпринтер**](setprinter.md) и [**сетпринтердата**](setprinterdata.md). Это значение доступно начиная с Windows 8.1. |
| универсальные значения безопасности, такие как запись \_ DAC | Для разрешения конкретных прав доступа. См. раздел [стандартные права доступа](/windows/desktop/SecAuthZ/standard-access-rights).                                                                                      |



 

Если у пользователя нет разрешения на открытие указанного принтера или сервера печати с требуемым доступом, вызов **OpenPrinter2** завершится ошибкой, а [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) вернет значение "ошибка \_ отказа в доступе" \_ .

Если *ппринтернаме* является локальным принтером, **OpenPrinter2** игнорирует все значения **dwFlags** , что на структуру [**\_ параметров принтера**](printer-options.md) указывает на использование *поптионс*, за исключением \_ изменения клиента для параметра принтера \_ \_ . Если последний передается, **OpenPrinter2** будет возвращать ошибку \_ отказа в доступе \_ . Соответственно, при открытии локального принтера **OpenPrinter2** не предоставляет преимуществ по сравнению с [**опенпринтер**](openprinter.md).

**Windows Vista:** Данные принтера, возвращаемые **OpenPrinter2** , извлекаются из локального кэша, если в поле **DwFlags** структуры [**\_ параметров принтера**](printer-options.md) , на которую ссылается *поптионс*, не установлен флаг " **\_ параметр принтера \_ без \_ кэша** ".

## <a name="examples"></a>Примеры

В этом примере **OpenPrinter2** завершается с ошибкой, когда \_ доступ к принтеру \_ управляется в \_ структуре [**\_ по умолчанию**](printer-defaults.md) , а пользователь не имеет соответствующего разрешения.


```C++
// Specify the limited management permission.
PRINTER_DEFAULTS defaults = {};
defaults.DesiredAccess = PRINTER_ACCESS_MANAGE_LIMITED;

// Open a printer to which the user has no administrative rights.
HANDLE printer = nullptr;
assert(!OpenPrinter2(L QueueWithNoAdminRights , // Queue name
                     &printer,                  // Printer handle
                     &defaults,                 // Printer defaults
                     nullptr));                 // Printer options

assert(GetLastError() == ERROR_ACCESS_DENIED);

if (printer)
{
    ClosePrinter(printer);
}
```



Пример программы, демонстрирующий использование этой функции, см. в разделе [инструкции. печать с помощью API печати GDI](how-to--print-using-the-gdi-print-api.md).

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения Vista\]<br/>                                                            |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>винспул. h (включает Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Spoolss.dll</dt> </dl>                    |
| Имя в кодировке Юникод и ANSI<br/>   | **OpenPrinter2W** (Юникод) и **OpenPrinter2A** (ANSI)<br/>                                       |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**клосепринтер**](closeprinter.md)
</dt> <dt>

[**\_значения по умолчанию для принтера**](printer-defaults.md)
</dt> <dt>

[**\_Параметры принтера**](printer-options.md)
</dt> <dt>

[**сетжоб**](setjob.md)
</dt> <dt>

[**сетпринтер**](setprinter.md)
</dt> <dt>

[**стартдокпринтер**](startdocprinter.md)
</dt> <dt>

[**опенпринтер**](openprinter.md)
</dt> </dl>

 

