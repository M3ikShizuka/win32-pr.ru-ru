---
description: Функция Финднекстпринтерчанженотификатион извлекает сведения о последнем уведомлении об изменении для объекта уведомления о изменении, связанного с принтером или сервером печати.
ms.assetid: ea7774ae-361f-41e4-bbc6-3f100028b22a
title: Функция Финднекстпринтерчанженотификатион (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- FindNextPrinterChangeNotification
api_type:
- DllExport
api_location:
- Spoolss.dll
ms.openlocfilehash: 37b05603a75f7bc8e68ead2d0dffdec2e99e7618e5461360760f2d9c89ae52da
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120112484"
---
# <a name="findnextprinterchangenotification-function"></a>Функция Финднекстпринтерчанженотификатион

Функция **финднекстпринтерчанженотификатион** извлекает сведения о последнем уведомлении об изменении для объекта уведомления о изменении, связанного с принтером или сервером печати. Вызывайте эту функцию, если выполняется операция ожидания объекта уведомления об изменении.

Функция также сбрасывает объект уведомления об изменении на несигнальное состояние. Затем можно использовать объект в другой операции ожидания, чтобы продолжить наблюдение за принтером или сервером печати. Операционная система задаст объекту сигнальное состояние при следующем выполнении одного из указанных изменений на принтере или на сервере печати. Функция [**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md) создает объект уведомления об изменении и задает набор отслеживаемых изменений.

## <a name="syntax"></a>Синтаксис


```C++
BOOL FindNextPrinterChangeNotification(
  _In_      HANDLE hChange,
  _Out_opt_ PDWORD pdwChange,
  _In_opt_  LPVOID pPrinterNotifyOptions,
  _Out_opt_ LPVOID *ppPrinterNotifyInfo
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*хчанже* \[ окне\]
</dt> <dd>

Маркер объекта уведомления об изменении, связанного с принтером или сервером печати. Такой обработчик можно получить, вызвав функцию [**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md) . Операционная система устанавливает этот объект уведомления об изменении в сигнальное состояние при обнаружении одного из изменений, указанных в фильтре уведомлений об изменении объекта.

</dd> <dt>

*пдвчанже* \[ out, необязательно\]
</dt> <dd>

Указатель на переменную, биты которой заданы, чтобы указать, какие изменения вызвали самое последнее уведомление. Битовые флаги, которые могут быть заданы, соответствуют указанным в параметре *фдвфилтер* вызова [**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md) . Система устанавливает один или несколько следующих битовых флагов.



| Значение                                                                                                                                                                                                                                             | Значение                                                   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
| <span id="PRINTER_CHANGE_ADD_FORM"></span><span id="printer_change_add_form"></span><dl> <dt>**\_ \_ Добавление формы изменения \_ принтера**</dt> </dl>                                                     | На сервер была добавлена форма.<br/>                |
| <span id="PRINTER_CHANGE_ADD_JOB"></span><span id="printer_change_add_job"></span><dl> <dt>**\_ \_ Добавление задания изменения \_ принтера**</dt> </dl>                                                        | Задание печати было отправлено на принтер.<br/>           |
| <span id="PRINTER_CHANGE_ADD_PORT"></span><span id="printer_change_add_port"></span><dl> <dt>**\_ \_ Добавление порта для изменения принтера \_**</dt> </dl>                                                     | На сервер был добавлен порт или монитор.<br/>     |
| <span id="PRINTER_CHANGE_ADD_PRINT_PROCESSOR"></span><span id="printer_change_add_print_processor"></span><dl> <dt>**\_Изменение принтера \_ Добавление \_ \_ обработчика печати**</dt> </dl>                   | Обработчик заданий печати был добавлен на сервер.<br/>     |
| <span id="PRINTER_CHANGE_ADD_PRINTER"></span><span id="printer_change_add_printer"></span><dl> <dt>**\_Изменение принтера \_ Добавление \_ принтера**</dt> </dl>                                            | На сервер был добавлен принтер.<br/>             |
| <span id="PRINTER_CHANGE_ADD_PRINTER_DRIVER"></span><span id="printer_change_add_printer_driver"></span><dl> <dt>**\_Изменение принтера \_ Добавление \_ \_ драйвера принтера**</dt> </dl>                      | На сервер был добавлен драйвер принтера.<br/>      |
| <span id="PRINTER_CHANGE_CONFIGURE_PORT"></span><span id="printer_change_configure_port"></span><dl> <dt>**\_Изменение принтера \_ Настройка \_ порта**</dt> </dl>                                   | Порт был настроен на сервере.<br/>           |
| <span id="PRINTER_CHANGE_DELETE_FORM"></span><span id="printer_change_delete_form"></span><dl> <dt>**\_ \_ форма удаления изменения \_ принтера**</dt> </dl>                                            | Форма была удалена с сервера.<br/>            |
| <span id="PRINTER_CHANGE_DELETE_JOB"></span><span id="printer_change_delete_job"></span><dl> <dt>**\_ \_ Задание удаления изменений \_ принтера**</dt> </dl>                                               | Задание удалено.<br/>                             |
| <span id="PRINTER_CHANGE_DELETE_PORT"></span><span id="printer_change_delete_port"></span><dl> <dt>**\_ \_ порт удаления для изменения принтера \_**</dt> </dl>                                            | Порт или монитор был удален с сервера.<br/> |
| <span id="PRINTER_CHANGE_DELETE_PRINT_PROCESSOR"></span><span id="printer_change_delete_print_processor"></span><dl> <dt>**\_ \_ \_ обработчик печати изменения принтера \_**</dt> </dl>          | Обработчик заданий печати был удален с сервера.<br/> |
| <span id="PRINTER_CHANGE_DELETE_PRINTER"></span><span id="printer_change_delete_printer"></span><dl> <dt>**\_Изменение принтера \_ Удаление \_ принтера**</dt> </dl>                                   | Принтер удален.<br/>                         |
| <span id="PRINTER_CHANGE_DELETE_PRINTER_DRIVER"></span><span id="printer_change_delete_printer_driver"></span><dl> <dt>**\_Изменение принтера \_ Удаление \_ \_ драйвера принтера**</dt> </dl>             | С сервера удален драйвер принтера.<br/>  |
| <span id="PRINTER_CHANGE_FAILED_CONNECTION_PRINTER"></span><span id="printer_change_failed_connection_printer"></span><dl> <dt>**принтер \_ \_ не смог изменить \_ подключение \_**</dt> </dl> | Сбой подключения принтера.<br/>               |
| <span id="PRINTER_CHANGE_SET_FORM"></span><span id="printer_change_set_form"></span><dl> <dt>**\_ \_ форма набора изменений \_ принтера**</dt> </dl>                                                     | Форма была установлена на сервере.<br/>                  |
| <span id="PRINTER_CHANGE_SET_JOB"></span><span id="printer_change_set_job"></span><dl> <dt>**\_Задание по изменению \_ набора принтеров \_**</dt> </dl>                                                        | Задание задано.<br/>                                 |
| <span id="PRINTER_CHANGE_SET_PRINTER"></span><span id="printer_change_set_printer"></span><dl> <dt>**\_Настройка принтера \_ изменить \_ принтер**</dt> </dl>                                            | Установлен принтер.<br/>                             |
| <span id="PRINTER_CHANGE_SET_PRINTER_DRIVER"></span><span id="printer_change_set_printer_driver"></span><dl> <dt>**изменение принтера " \_ \_ задать \_ \_ драйвер принтера"**</dt> </dl>                      | Установлен драйвер принтера.<br/>                      |
| <span id="PRINTER_CHANGE_WRITE_JOB"></span><span id="printer_change_write_job"></span><dl> <dt>**\_ \_ Задание записи изменения \_ принтера**</dt> </dl>                                                  | Данные задания были записаны.<br/>                          |
| <span id="PRINTER_CHANGE_TIMEOUT"></span><span id="printer_change_timeout"></span><dl> <dt>**\_ \_ время ожидания изменения принтера**</dt> </dl>                                                         | Время ожидания задания истекло.<br/>                             |
| <span id="PRINTER_CHANGE_SERVER"></span><span id="printer_change_server"></span><dl> <dt>**\_сервер изменения \_ принтера**</dt> </dl>                                                            | Windows 7: произошло изменение на сервере.<br/>    |



 

</dd> <dt>

*ппринтернотифйоптионс* \[ в необязательное\]
</dt> <dd>

Указатель на структуру [**\_ \_ параметров уведомления принтера**](printer-notify-options.md) . Установите для элемента **flags** этой структуры значение **принтер \_ \_ Параметры уведомления \_ Обновить**, чтобы функция возвращала текущие данные для всех отслеживаемых полей сведений о принтерах. Функция игнорирует все остальные члены структуры. Этот параметр может принимать значение **NULL**.

</dd> <dt>

*пппринтернотифинфо* \[ out, необязательно\]
</dt> <dd>

Указатель на переменную указателя, которая получает указатель на выделенный системой буфер, доступный только для чтения. Вызовите функцию [**фрипринтернотифинфо**](freeprinternotifyinfo.md) , чтобы освободить буфер по завершении работы с ним. Если сведения не требуются, этот параметр может иметь **значение NULL** .

Буфер содержит структуру [**\_ \_ сведений об уведомлении принтера**](printer-notify-info.md) , которая содержит массив информационных структур [**\_ \_ \_ данных принтера**](printer-notify-info-data.md) . Каждый элемент массива содержит сведения об одном из полей, указанных в параметре *ппринтернотифйоптионс* вызова [**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md) . Как правило, функция предоставляет данные только для тех полей, которые были изменены, чтобы вызвать самое последнее уведомление. Однако если структура, на которую указывает параметр *ппринтернотифйоптионс* , указывает **\_ Параметры уведомления для \_ принтера \_ Обновить**, функция предоставляет данные для всех отслеживаемых полей.

Если бит **" \_ уведомление \_ \_ принтера** " установлен в элементе **flags** в структуре [**\_ \_ сведений о принтере**](printer-notify-info.md) , то произошло переполнение или ошибка, а уведомления могли быть потеряны. В этом случае никакие дополнительные уведомления не будут отправляться, пока вы не выполните второй вызов **финднекстпринтерчанженотификатион** , указывающий **\_ Параметры уведомления принтера \_ \_ Обновить**.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение будет ненулевым.

Если функция выполняется неудачно, возвращается нулевое значение.

## <a name="remarks"></a>Remarks

> [!Note]  
> Это блокирующая или синхронная функция, которая может не возвращать значение немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Вызов функции **финднекстпринтерчанженотификатион** после выполнения операции ожидания для объекта уведомления, созданного с помощью [**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md) , удовлетворен. Вызов **финднекстпринтерчанженотификатион** позволяет получить сведения об изменениях, удовлетворяющих операции ожидания, и сбрасывает объект уведомления, чтобы он мог получать сигналы при следующем изменении.

За одним исключением не следует вызывать функцию **финднекстпринтерчанженотификатион** , если объект уведомления об изменении не находится в сигнальном состоянии. Если функция Wait возвращает значение **\_ времени ожидания ожидания**, объект изменения не находится в сигнальном состоянии. Вызовите функцию **финднекстпринтерчанженотификатион** только в том случае, если функция Wait завершилась без времени ожидания. Исключением является то, что при вызове **финднекстпринтерчанженотификатион** с параметром " **\_ \_ \_ Обновить" параметры уведомления принтера** , заданные в аргументе *ппринтернотифйоптионс* . Обратите внимание, что даже если этот флаг установлен, в параметре *пппринтернотифинфо* по-прежнему может быть задан флаг **\_ \_ \_ отклонения сведений о принтере** .

Чтобы продолжить наблюдение за изменениями принтера или сервера печати, повторите цикл вызова одной из [функций ожидания](/windows/desktop/Sync/wait-functions) , а затем вызовите функцию **финднекстпринтерчанженотификатион** , чтобы проверить изменение и сбросить объект уведомления.

**Финднекстпринтерчанженотификатион** может объединять несколько изменений одного и того же поля сведений о принтере в одно уведомление. В этом случае функция, как правило, сворачивает все изменения для поля в одну запись в массиве структур [**\_ \_ \_ данных с уведомлением принтера**](printer-notify-info-data.md) в *пппринтернотифинфо*; одна запись содержит только самые актуальные сведения. Однако для некоторых полей сведений о заданиях и принтерах функция может возвращать несколько записей массива для одного поля. В этом случае последняя запись массива для поля сообщает о текущих данных, а более ранние записи содержат данные для промежуточных этапов.

Если объект уведомления об изменениях больше не нужен, закройте его, вызвав функцию [**финдклосепринтерчанженотификатион**](findcloseprinterchangenotification.md) .

> [!Note]  
> в Windows XP с пакетом обновления 2 (sp2) и более поздних версий брандмауэр подключения к интернету (ICF) по умолчанию блокирует порты принтера, но можно включить исключение для общего доступа к файлам и принтерам. Если пользователь устанавливает подключение принтера к другому компьютеру и исключение не включено, пользователь не будет получать уведомления об изменении принтера с сервера. Администратор компьютера должен включить исключение.

 

## <a name="examples"></a>Примеры

В следующем образце кода показано, как можно отслеживать состояние принтера с помощью этих функций.


```C++
// Get change notification handle for the printer   
chgObject = FindFirstPrinterChangeNotification( 
                hPrinter, 
                PRINTER_CHANGE_JOB, 
                0, 
                NULL); 

if (chgObject != INVALID_HANDLE_VALUE) {
    while (bKeepMonitoring) {
        // Wait for the change notification 
        WaitForSingleObject(chgObject, INFINITE);

        fcnreturn = FindNextPrinterChangeNotification(
                        chgObject, 
                        pdwChange, 
                        NULL, 
                        NULL);

        if (fcnreturn) {
            // Check value of *pdwChange and 
            //  deal with the indicated change 
        }
        // Insert some mechanism to stop monitoring
        //  such as: 
        //
        // if (something happens) {
        //     bKeepMonitoring = false; 
        // }
        //
    }
    // Close Printer Change Notification handle when finished. 
    FindClosePrinterChangeNotification(chgObject);
} else {
    // Unable to open printer change notification handle 
    dwStatus = GetLastError();
}
```



## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                                                |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>винспул. h (включает Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Spoolss.dll</dt> </dl>                    |



## <a name="see-also"></a>См. также

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**финдклосепринтерчанженотификатион**](findcloseprinterchangenotification.md)
</dt> <dt>

[**финдфирстпринтерчанженотификатион**](findfirstprinterchangenotification.md)
</dt> <dt>

[**\_сведения об уведомлении принтера \_**](printer-notify-info.md)
</dt> <dt>

[**\_данные уведомления \_ принтера \_**](printer-notify-info-data.md)
</dt> <dt>

[**\_Параметры уведомления \_ принтера**](printer-notify-options.md)
</dt> </dl>

 

