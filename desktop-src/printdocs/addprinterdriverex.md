---
description: Функция Аддпринтердриверекс устанавливает локальный или удаленный драйвер принтера и связывает файлы конфигурации, данных и драйверов.
ms.assetid: 472adb7d-39cc-4c76-b96c-610ff9d276ad
title: Функция Аддпринтердриверекс (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- AddPrinterDriverEx
- AddPrinterDriverExA
- AddPrinterDriverExW
api_type:
- DllExport
api_location:
- Winspool.drv
ms.openlocfilehash: c431d710ddad7f723d063fd5bf046bae08b77b7a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673636"
---
# <a name="addprinterdriverex-function"></a>Функция Аддпринтердриверекс

Функция **аддпринтердриверекс** устанавливает локальный или удаленный драйвер принтера и связывает файлы конфигурации, данных и драйверов. Помимо возможностей [**аддпринтердривер**](addprinterdriver.md), у нее также есть параметры, обеспечивающие жесткое обновление, более пониженную версию, копирование только новых файлов и копирование всех файлов (независимо от отметки времени файла).

> [!Note]  
> Установка драйвера принтера без пакета драйверов больше не рекомендуется. Вместо этого используйте [**инсталлпринтердриверфромпаккаже**](installprinterdriverfrompackage.md) .

 

## <a name="syntax"></a>Синтаксис


```C++
BOOL AddPrinterDriverEx(
  _In_    LPTSTR pName,
  _In_    DWORD  Level,
  _Inout_ LPBYTE pDriverInfo,
  _In_    DWORD  dwFileCopyFlags
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*pName* \[ окне\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает имя сервера, на котором должен быть установлен драйвер. Если этот параметр имеет **значение NULL**, функция устанавливает драйвер на локальном компьютере.

</dd> <dt>

*Уровень* \[ окне\]
</dt> <dd>

Версия структуры, на которую указывает *пдриверинфо* . Это значение может быть равно 2, 3, 4, 6 или 8.

</dd> <dt>

*пдриверинфо* \[ в, out\]
</dt> <dd>

Указатель на структуру, содержащую сведения о драйвере принтера. Может быть одним из следующих.



| Значение уровня                                                                                       | \_Структура сведений о драйвере \_ \*                          |
|------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| <span id="2"></span><dl> <dt>**2**</dt> </dl> | [**\_Сведения о драйвере \_ 2**](driver-info-2.md)<br/> |
| <span id="3"></span><dl> <dt>**3-5**</dt> </dl> | [**\_Сведения о драйвере \_ 3**](driver-info-3.md)<br/> |
| <span id="4"></span><dl> <dt>**четырех**</dt> </dl> | [**\_Сведения о драйвере \_ 4**](driver-info-4.md)<br/> |
| <span id="6"></span><dl> <dt>**6**</dt> </dl> | [**\_Сведения о драйвере \_ 6**](driver-info-6.md)<br/> |
| <span id="8"></span><dl> <dt>**8**</dt> </dl> | [**\_Сведения о драйвере \_ 8**](driver-info-8.md)<br/> |



 

Если элемент **пенвиронмент** структуры, на который указывает *Пдриверинфо* , имеет **значение NULL**, функция использует текущую среду вызывающего или клиентского объекта, а не среду назначения или сервера.

</dd> <dt>

*двфилекопифлагс* \[ окне\]
</dt> <dd>

Параметры для копирования файлов драйверов. Этот параметр может принимать одно из указанных ниже значений.



| Значение                                                                                                                                                                                         | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="APD_COPY_ALL_FILES"></span><span id="apd_copy_all_files"></span><dl> <dt>**APD \_ Копировать \_ все \_ файлы**</dt> </dl>                | Добавьте драйвер принтера и скопируйте все файлы в каталог драйвера принтера. Метки времени файла игнорируются этим параметром.<br/>                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="APD_COPY_FROM_DIRECTORY"></span><span id="apd_copy_from_directory"></span><dl> <dt>**APD \_ Копировать \_ из \_ каталога**</dt> </dl> | Добавьте драйвер принтера с полными именами файлов, указанными в структуре [**драйвера \_ \_ 6**](driver-info-6.md) . Этот флаг ORed в сочетании с одним из других флагов копирования. Если этот флаг установлен, **аддпринтердриверекс** завершится ошибкой, если файлы, где они указаны, существуют в структуре **драйвера \_ \_ 6** . Файлы не нужно копировать в каталог драйвера принтера системы. См. примечания.<br/> **Windows 2000:** Этот флаг не поддерживается.<br/> |
| <span id="APD_COPY_NEW_FILES"></span><span id="apd_copy_new_files"></span><dl> <dt>**APD \_ Копировать \_ новые \_ файлы**</dt> </dl>                | Добавьте драйвер принтера и скопируйте файлы в каталог драйвера принтера, который новее, чем все файлы, используемые в данный момент. Этот флаг эмулирует поведение [**аддпринтердривер**](addprinterdriver.md).<br/>                                                                                                                                                                                                                                                                                  |
| <span id="APD_STRICT_DOWNGRADE"></span><span id="apd_strict_downgrade"></span><dl> <dt>**APD \_ с \_ пониженным уровнем**</dt> </dl>           | Добавьте драйвер принтера, только если все файлы в каталоге драйвера принтера старше всех файлов, используемых в настоящее время.<br/>                                                                                                                                                                                                                                                                                                                                                                              |
| <span id="APD_STRICT_UPGRADE"></span><span id="apd_strict_upgrade"></span><dl> <dt>**APD с \_ четким \_ обновлением**</dt> </dl>                 | Добавьте драйвер принтера, только если все файлы в каталоге драйвера принтера новее, чем все файлы, используемые в настоящее время.<br/>                                                                                                                                                                                                                                                                                                                                                                              |



 

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение будет ненулевым.

Если функция выполняется неудачно, возвращается нулевое значение.

Если известно, что драйвер принтера не работает с операционной системой, **аддпринтердриверекс** завершится с одним из следующих кодов ошибок:



| Код ошибки                      | Значение                                                                                                                                                   |
|---------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_драйвер принтера \_ ошибок \_ заблокирован | Драйвер не работает в операционной системе.                                                                                                         |
| предупреждение об ОШИБКе \_ \_ драйвера принтера \_  | Драйвер не является надежным в операционной системе. Однако если \_ \_ указан драйвер предупреждения установки APD \_ , драйвер устанавливается и предупреждение не выдается. |



 

Дополнительные сведения см. в разделе «Примечания».

## <a name="remarks"></a>Комментарии

> [!Note]  
> Это блокирующая или синхронная функция, которая может не возвращать значение немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Вызывающий объект должен иметь [селоаддриверпривилеже](/windows/desktop/SecAuthZ/authorization-constants).

Перед вызовом функции **аддпринтердриверекс** все файлы, необходимые для драйвера, должны быть скопированы в каталог системного драйвера принтера. Чтобы получить имя этого каталога, вызовите функцию [**жетпринтердривердиректори**](getprinterdriverdirectory.md) .

Чтобы определить, какие драйверы принтера в настоящий момент установлены, вызовите функцию [**енумпринтердриверс**](enumprinterdrivers.md) .

Если драйвер принтера был успешно добавлен, функция вызывает функцию Дрвдриверевент ( \_ Инициализация события драйвера, \_ уровень, \_ сведения о драйвере \_ \* , lParam), чтобы разрешить драйверу выполнять инициализацию, необходимую во время установки драйвера принтера. Дополнительные сведения о **дрвдриверевент** см. в пакете средств разработки драйверов Microsoft Windows (DDK).

Драйвер не должен использовать вызов пользовательского интерфейса во время вызова **дрвдриверевент**. Чтобы выполнять задания, связанные с пользовательским интерфейсом, установщик должен либо использовать запись Вендорсетуп в INF-файле принтера, либо, для устройств самонастраивающийся, установщик может использовать соустановщик для конкретного устройства. Дополнительные сведения о Вендорсетуп см. в пакете DDK.

Файлы, на которые ссылается структура [**драйвера \_ \_ 6**](driver-info-6.md) , должны быть локальными для компьютера, на котором выполняется вызов. Имя файла может представлять собой UNC-имя, если имя UNC является локальным компьютером.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                                                |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>Винспул. h (включение Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Винспул. drv</dt> </dl>                   |
| Имя в кодировке Юникод и ANSI<br/>   | **Аддпринтердриверексв** (Юникод) и **аддпринтердриверекса** (ANSI)<br/>                           |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**аддпринтердривер**](addprinterdriver.md)
</dt> <dt>

[**\_Сведения о драйвере \_ 2**](driver-info-2.md)
</dt> <dt>

[**\_Сведения о драйвере \_ 3**](driver-info-3.md)
</dt> <dt>

[**\_Сведения о драйвере \_ 4**](driver-info-4.md)
</dt> <dt>

[**\_Сведения о драйвере \_ 6**](driver-info-6.md)
</dt> <dt>

[**делетепринтердриверекс**](deleteprinterdriverex.md)
</dt> <dt>

[**енумпринтердриверс**](enumprinterdrivers.md)
</dt> <dt>

[**жетпринтердривердиректори**](getprinterdriverdirectory.md)
</dt> </dl>

 

