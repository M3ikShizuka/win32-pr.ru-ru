---
description: Функция Опенпринтер извлекает дескриптор указанного принтера или сервера печати или других типов дескрипторов в подсистеме печати.
ms.assetid: 96763220-d851-46f0-8be8-403f3356edb9
title: Функция Опенпринтер (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- OpenPrinter
- OpenPrinterA
- OpenPrinterW
api_type:
- DllExport
api_location:
- Winspool.drv
- Ext-MS-Win-printer-Winspool-l1-1-0.dll
- Ext-MS-Win-printer-Winspool-l1-1-1.dll
- Ext-MS-Win-Printer-WinSpool-l1-1-2.dll
- Ext-MS-Win-Printer-WinSpool-L1-1-3.dll
ms.openlocfilehash: 48f25f9c8aec314b997a4600335e22bea2f0bbd8eefa78235ddbb25192f556f2
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117868606"
---
# <a name="openprinter-function"></a>Функция Опенпринтер

Функция **опенпринтер** извлекает дескриптор указанного принтера или сервера печати или других типов дескрипторов в подсистеме печати.

## <a name="syntax"></a>Синтаксис


```C++
BOOL OpenPrinter(
  _In_  LPTSTR             pPrinterName,
  _Out_ LPHANDLE           phPrinter,
  _In_  LPPRINTER_DEFAULTS pDefault
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*ппринтернаме* \[ окне\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает имя принтера или сервера печати, объект принтера, Ксквмонитор или Ксквпорт.

Для объекта принтера используйте: Принтернаме, задание XXXX. Для Ксквмонитор используйте: ServerName, Ксквмонитор Мониторнаме. Для Ксквпорт используйте: ServerName, Ксквпорт Портнаме.

**Значение NULL** указывает на локальный сервер печати.

</dd> <dt>

*фпринтер* \[ заполняет\]
</dt> <dd>

Указатель на переменную, которая получает маркер (не является потокобезопасным) на открытый принтер или объект сервера печати.

Параметр *фпринтер* может возвращать маркер кскв для использования с функцией ксквдата. Дополнительные сведения о Ксквдата см. в пакете DDK.

</dd> <dt>

*пдефаулт* \[ окне\]
</dt> <dd>

Указатель на структуру [**\_ по умолчанию принтера**](printer-defaults.md) . Это значение может быть **равно NULL**.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение будет ненулевым.

Если функция выполняется неудачно, возвращается нулевое значение.

## <a name="remarks"></a>Remarks

Не вызывайте этот метод в [**DllMain**](/windows/desktop/Dlls/dllmain).

> [!Note]  
> Маркер, полученный для удаленного принтера путем вызова **опенпринтер** для удаленного принтера, обращается к принтеру через локальный кэш в службе диспетчера очереди печати. Этот кэш не является точным в режиме реального времени. Чтобы получить точные данные, замените вызов Опенпринтер на [**OpenPrinter2**](openprinter2.md) с Поптионс. dwFlags установленным в \_ параметре Printer ( \_ нет \_ кэша). Обратите внимание, что работает только OpenPrinter2W. Функция возвращает маркер принтера, который использует другие вызовы API печати и обходит локальный кэш. Этот метод блокируется при ожидании сетевого подключения к удаленному принтеру, поэтому он может не возвращаться немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

> [!Note]  
> Маркер, полученный при вызове **опенпринтер** для удаленного принтера, будет обращаться к принтеру через локальный кэш в службе диспетчера очереди печати. Этот кэш, по своей структуре, не является точным в реальном времени. Если необходимо получить точные данные, замените вызов **опенпринтер** параметром [**OpenPrinter2**](openprinter2.md) с *поптионс. dwFlags* , установленным в [**режим принтера, \_ \_ нет \_ кэша**](printer-options.md). Обратите внимание, что работает только **OpenPrinter2W** . Таким образом, функция возвращает маркер принтера, который делает другие вызовы API печати для обхода локального кэша. Обратите внимание, что этот подход будет заблокирован при ожидании сетевого подключения к удаленному принтеру, поэтому он может не возвращаться немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно спрогнозировать при написании приложения. Поэтому вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Маркер, на который указывает *фпринтер* , не является потокобезопасным. Если вызывающие объекты должны одновременно использовать его в нескольких потоках, они должны предоставить настраиваемый доступ к обработке принтера с помощью [функций синхронизации](/windows/desktop/Sync/synchronization-functions). Чтобы избежать написания пользовательского кода, приложение может по мере необходимости открывать маркеры принтера в каждом потоке.

Параметр *пдефаулт* позволяет указать тип данных и значения режима устройства, используемые для печати документов, отправляемых функцией [**стартдокпринтер**](startdocprinter.md) . Однако эти значения можно переопределить с помощью функции [**сетжоб**](setjob.md) после запуска документа.

Параметры [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) , определенные в структуре [**\_ по умолчанию**](printer-defaults.md) параметра *пдефаулт* , не используются, если значение элемента *пдататипе* структуры [**документа \_ info \_ 1**](doc-info-1.md) , переданной в параметре *пдоЦинфо* вызова [**стартдокпринтер**](startdocprinter.md) , — "RAW". если документ высокого уровня (например, файл Adobe PDF или Microsoft Word) или другие данные принтера (например, PCL, PS или хпгл) отправляются непосредственно на принтер с *пдататипе* , для которого задано значение "RAW", документ должен полностью описывать параметры задания печати в стиле **DEVMODE** на языке, понятном оборудовании.

Можно вызвать функцию **опенпринтер** , чтобы открыть обработчик для сервера печати или определить права доступа клиента к серверу печати. Для этого укажите имя сервера печати в параметре *ппринтернаме* , установите для элементов **пдататипе** и **пдевмоде** структуры [**принтеров \_ по умолчанию**](printer-defaults.md) **значение NULL**, а для элемента **десиредакцесс** задайте значение маски доступа сервера, например сервер \_ все \_ доступ. После завершения работы с маркером передайте его в функцию [**клосепринтер**](closeprinter.md) , чтобы закрыть его.

Используйте элемент **десиредакцесс** в структуре [**\_ по умолчанию принтера**](printer-defaults.md) , чтобы указать права доступа, необходимые для принтера. Права доступа могут быть одним из следующих. (Если *пдефаулт* имеет **значение NULL**, то права доступа являются принтером \_ ДОСТУП к \_ использованию.)



| Требуемое значение доступа                        | Значение                                                                                                                                                                                      |
|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| доступ к ПРИНТЕРу — \_ \_ Администрирование                 | Для выполнения административных задач, например, предоставляемых [**сетпринтер**](setprinter.md).                                                                                                 |
| \_Использование доступа к принтерам \_                        | Для выполнения основных операций печати.                                                                                                                                                        |
| \_доступ ко всем принтерам \_                        | Для выполнения всех административных задач и базовых операций печати, за исключением синхронизации (см. раздел [стандартные права доступа](/windows/desktop/SecAuthZ/standard-access-rights)).                                     |
| доступ к ПРИНТЕРу — \_ \_ Управление \_ ограниченным доступом            | Для выполнения административных задач, например, предоставляемых [**сетпринтер**](setprinter.md) и [**сетпринтердата**](setprinterdata.md). Это значение доступно начиная с Windows 8.1. |
| универсальные значения безопасности, такие как запись \_ DAC | Для разрешения конкретных прав доступа. См. раздел [стандартные права доступа](/windows/desktop/SecAuthZ/standard-access-rights).                                                                                      |



 

Если у пользователя нет разрешения на открытие указанного принтера или сервера печати с требуемым доступом, вызов **опенпринтер** завершится ошибкой с возвращаемым нулевым значением, а [**GETLASTERROR**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) вернет значение Ошибка \_ отказа в доступе \_ .

## <a name="examples"></a>Примеры

Пример программы, использующей эту функцию, см. в разделе [инструкции. печать с помощью API печати GDI](how-to--print-using-the-gdi-print-api.md).

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                                                |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>винспул. h (включает Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Винспул. drv</dt> </dl>                   |
| Имя в кодировке Юникод и ANSI<br/>   | **Опенпринтерв** (Юникод) и **опенпринтера** (ANSI)<br/>                                         |



## <a name="see-also"></a>См. также

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**вритепринтер**](writeprinter.md)
</dt> <dt>

[**клосепринтер**](closeprinter.md)
</dt> <dt>

[**\_значения по умолчанию для принтера**](printer-defaults.md)
</dt> <dt>

[**сетжоб**](setjob.md)
</dt> <dt>

[**сетпринтер**](setprinter.md)
</dt> <dt>

[**стартдокпринтер**](startdocprinter.md)
</dt> </dl>

 

