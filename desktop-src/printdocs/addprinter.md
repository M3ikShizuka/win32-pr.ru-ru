---
description: Функция Аддпринтер добавляет принтер в список поддерживаемых принтеров для указанного сервера.
ms.assetid: ffc4fee8-46c6-47ad-803d-623bf8efdefd
title: Функция Аддпринтер (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- AddPrinter
- AddPrinterA
- AddPrinterW
api_type:
- DllExport
api_location:
- Winspool.drv
ms.openlocfilehash: 51416ed59bc1c6df1d2c69de87d61bdecab522f0
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127571607"
---
# <a name="addprinter-function"></a>Функция Аддпринтер

Функция **аддпринтер** добавляет принтер в список поддерживаемых принтеров для указанного сервера.

## <a name="syntax"></a>Синтаксис


```C++
HANDLE AddPrinter(
  _In_ LPTSTR *pName,
  _In_ DWORD  Level,
  _In_ LPBYTE pPrinter
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*pName* \[ окне\]
</dt> <dd>

Указатель на строку, завершающуюся нулем, которая указывает имя сервера, на котором должен быть установлен принтер. Если эта строка имеет **значение NULL**, принтер устанавливается локально.

</dd> <dt>

*Уровень* \[ окне\]
</dt> <dd>

Версия структуры, на которую указывает *ппринтер* . Это значение должно быть равно 2.

</dd> <dt>

*ппринтер* \[ окне\]
</dt> <dd>

Указатель на структуру [**\_ \_ 2 принтера**](printer-info-2.md) , содержащий сведения о принтере. Перед вызовом **аддпринтер** необходимо указать значения, отличные от **null** , для элементов **ппринтернаме**, **ппортнаме**, **пдривернаме** и **ппринтпроцессор** этой структуры.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение является обработчиком (непотокобезопасным) для нового объекта принтера. По завершении работы с маркером передайте его в функцию [**клосепринтер**](closeprinter.md) , чтобы закрыть его.

Если функция завершается ошибкой, возвращается значение **null**.

## <a name="remarks"></a>Remarks

Не вызывайте этот метод в [**DllMain**](/windows/desktop/Dlls/dllmain).

> [!Note]  
> Это блокирующая или синхронная функция, которая может не возвращать значение немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Вызывающий объект должен иметь [селоаддриверпривилеже](/windows/desktop/SecAuthZ/authorization-constants).

Возвращенный маркер не является потокобезопасным. Если вызывающие объекты должны одновременно использовать его в нескольких потоках, они должны предоставить настраиваемый доступ к обработке принтера с помощью [функций синхронизации](/windows/desktop/Sync/synchronization-functions). Чтобы избежать написания пользовательского кода, приложение может по мере необходимости открывать маркеры принтера в каждом потоке.

Ниже приведены элементы структуры « [**\_ сведения о принтере \_ 2**](printer-info-2.md) », которые можно задать до вызова функции **аддпринтер** .

-   **Атрибуты**
-   **ппринтпроцессор**
-   **дефаултприорити**
-   **Приоритет**
-   **пкоммент**
-   **псекуритидескриптор**
-   **пдататипе**
-   **псепфиле**
-   **пдевмоде**
-   **пшаренаме**
-   **плокатион**
-   **StartTime**
-   **ппараметерс**
-   **унтилтиме**

Элементы **Status**, **кжобс** и **Аверажеппм** структуры " [**\_ сведения о \_ принтере**](printer-info-2.md) " зарезервированы для использования функцией [**PrintOut**](getprinter.md) . Их не следует задавать перед вызовом **аддпринтер**.

Если **псекуритидескриптор** имеет **значение NULL**, система присваивает принтеру дескриптор безопасности по умолчанию. Дескриптор безопасности по умолчанию имеет следующие разрешения.



| Значение                          | Описание                                                                                                                                                                                                                                                                                                                                            |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Администраторы и опытные пользователи. | Полный доступ к очереди печати. Это означает, что члены этих групп могут печатать, управлять очередью (может удалять очередь, изменять любые параметры очереди, включая дескриптор безопасности) и управлять заданиями печати всех пользователей (удаление, приостановка, возобновление и перезапуск заданий). обратите внимание, что опытные пользователи не существуют до Windows XP Professional.<br/> |
| Создатель/владелец                  | Может управлять собственными заданиями. Это означает, что пользователь, отправивший задания, может управлять своими заданиями (удалять, приостанавливать, возобновлять, перезапускать).                                                                                                                                                                                                                                  |
| Все                       | Выполнение и Стандартный контроль чтения. Это означает, что члены группы «все» могут печатать и читать свойства очереди печати.                                                                                                                                                                                                                     |



 

После того как приложение создает объект принтера с помощью функции **аддпринтер** , он должен использовать функцию [**принтерпропертиес**](printerproperties.md) для указания правильных параметров драйвера принтера, связанного с объектом Printer.

Функция **аддпринтер** возвращает ошибку, если объект принтера с таким именем уже существует, если этот объект не помечен как ожидающий удаления. В этом случае существующий принтер не удаляется, а параметры создания **аддпринтер** используются для изменения существующих параметров принтера (как если бы приложение использовало функцию [**сетпринтер**](setprinter.md) ).

Используйте функцию [**енумпринтпроцессорс**](enumprintprocessors.md) для перечисления набора обработчиков печати, установленных на сервере. Используйте функцию [**енумпринтпроцессордататипес**](enumprintprocessordatatypes.md) для перечисления набора типов данных, поддерживаемых обработчиком печати. Используйте функцию [**енумпортс**](enumports.md) для перечисления набора доступных портов. Используйте функцию [**енумпринтердриверс**](enumprinterdrivers.md) для перечисления установленных драйверов принтера.

Вызывающая функция **аддпринтер** должна иметь доступ к серверу \_ для \_ администрирования доступа к серверу, на котором будет создан принтер. Маркер, возвращаемый функцией, будет иметь \_ \_ разрешение на доступ к принтеру и может использоваться для выполнения административных операций на принтере.

Если функции **дрвпринтеревент** передается \_ флаг события принтера \_ \_ без \_ флага пользовательского интерфейса, драйвер не должен использовать вызов пользовательского интерфейса во время **дрвпринтеревент**. Чтобы выполнять задания, связанные с пользовательским интерфейсом, установщик должен либо использовать запись **вендорсетуп** в INF-файле принтера, либо, для устройств Самонастраивающийся, установщик может использовать соустановщик для конкретного устройства. дополнительные сведения о **вендорсетуп** см. в пакете sdk для Microsoft Windows Driver Kit (DDK).

Брандмауэр подключения к Интернету (ICF) блокирует порты принтера по умолчанию, но при запуске **аддпринтер** включается исключение для общего доступа к файлам и принтерам.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                                                |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>винспул. h (включает Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Винспул. drv</dt> </dl>                   |
| Имя в кодировке Юникод и ANSI<br/>   | **Аддпринтерв** (Юникод) и **аддпринтера** (ANSI)<br/>                                           |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**клосепринтер**](closeprinter.md)
</dt> <dt>

[**делетепринтер**](deleteprinter.md)
</dt> <dt>

[**EnumPorts**](enumports.md)
</dt> <dt>

[**енумпринтердриверс**](enumprinterdrivers.md)
</dt> <dt>

[**енумпринтпроцессорс**](enumprintprocessors.md)
</dt> <dt>

[**енумпринтпроцессордататипес**](enumprintprocessordatatypes.md)
</dt> <dt>

[**Наложение**](getprinter.md)
</dt> <dt>

[**\_Сведения о принтере \_ 2**](printer-info-2.md)
</dt> <dt>

[**принтерпропертиес**](printerproperties.md)
</dt> <dt>

[**сетпринтер**](setprinter.md)
</dt> </dl>

 

