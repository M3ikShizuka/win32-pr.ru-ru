---
description: Функция Сетпринтер задает данные для указанного принтера или задает состояние указанного принтера путем приостановки печати, возобновления печати или очистки всех заданий печати.
ms.assetid: ade367c5-20d6-4da9-bb52-ce6768cf7537
title: Функция Сетпринтер (Винспул. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- SetPrinter
- SetPrinterA
- SetPrinterW
api_type:
- DllExport
api_location:
- WinSpool.drv
- Ext-MS-Win-printer-WinSpool-l1-1-0.dll
- Ext-MS-Win-printer-WinSpool-l1-1-1.dll
- Ext-MS-Win-Printer-WinSpool-l1-1-2.dll
- Ext-MS-Win-Printer-WinSpool-L1-1-3.dll
ms.openlocfilehash: 5f2c58d97315ff108c8f12bd029849993a307025
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105712387"
---
# <a name="setprinter-function"></a>Функция Сетпринтер

Функция **сетпринтер** задает данные для указанного принтера или задает состояние указанного принтера путем приостановки печати, возобновления печати или очистки всех заданий печати.

## <a name="syntax"></a>Синтаксис


```C++
BOOL SetPrinter(
  _In_ HANDLE hPrinter,
  _In_ DWORD  Level,
  _In_ LPBYTE pPrinter,
  _In_ DWORD  Command
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*хпринтер* \[ окне\]
</dt> <dd>

Маркер принтера. Используйте функцию [**опенпринтер**](openprinter.md), [**OpenPrinter2**](openprinter2.md)или [**аддпринтер**](addprinter.md) для получения маркера принтера.

</dd> <dt>

*Уровень* \[ окне\]
</dt> <dd>

Тип данных, которые функция хранит в буфере, на который указывает *ппринтер*. Если параметр *команды* не равен нулю, параметр *уровня* должен равняться нулю.

Это значение может быть равно 0, 2, 3, 4, 5, 6, 7, 8 или 9.

</dd> <dt>

*ппринтер* \[ окне\]
</dt> <dd>

Указатель на буфер, содержащий данные, задаваемые для принтера, или содержит сведения о команде, указанной параметром *команды* . Тип данных в буфере определяется значением *Level*.



| Level                                                                                                | Структура                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="0"></span><dl> <dt>**0**</dt> </dl> | Если параметр *Command* имеет значение **\_ \_ \_ Status элемента управления принтера**, *ппринтер* должен содержать значение **DWORD** , указывающее новое состояние принтера для установки. Список возможных значений состояния см. в описании элемента **Status** в структуре [**Printer \_ info \_ 2**](printer-info-2.md) . Обратите внимание, что **\_ состояние принтера \_ приостановлено** , а **\_ состояние принтера \_ ожидает \_ удаления** — недопустимые значения состояния для задания.<br/> Если *Level* имеет значение 0, но *параметр команды* не имеет **\_ \_ \_ состояние управления принтерами**, *ппринтер* должен иметь **значение NULL**.<br/> |
| <span id="2"></span><dl> <dt>**2**</dt> </dl> | Структура [**сведений о принтере \_ \_ 2**](printer-info-2.md) , содержащая подробные сведения о принтере.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| <span id="3"></span><dl> <dt>**3-5**</dt> </dl> | Структура [**принтера \_ info \_ 3**](printer-info-3.md) , содержащая сведения о безопасности принтера.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="4"></span><dl> <dt>**четырех**</dt> </dl> | Структура [**принтера с информацией \_ \_ 4**](printer-info-4.md) , содержащая минимальные сведения о принтерах, включая имя принтера, имя сервера, а также то, является ли принтер удаленным или локальным.<br/>                                                                                                                                                                                                                                                                                                                                         |
| <span id="5"></span><dl> <dt>**5.0**</dt> </dl> | Структура сведений о принтере [**\_ \_ 5**](printer-info-5.md) , содержащая сведения о принтерах, такие как атрибуты принтера и параметры времени ожидания.<br/>                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span id="6"></span><dl> <dt>**6**</dt> </dl> | Структура [**принтера с \_ информацией \_ 6**](printer-info-6.md) , указывающая значение состояния принтера.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span id="7"></span><dl> <dt>**7**</dt> </dl> | Структура [**принтера с \_ информацией \_ 7**](printer-info-7.md) . Член *двактион* этой структуры указывает, должна ли **сетпринтер** публиковать, отменять публикацию, повторно публиковать или обновлять данные принтера в службе каталогов.<br/>                                                                                                                                                                                                                                                                                                                |
| <span id="8"></span><dl> <dt>**8**</dt> </dl> | Структура [**принтера \_ info \_ 8**](printer-info-8.md) , указывающая глобальные параметры принтера по умолчанию.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span id="9"></span><dl> <dt>**9**</dt> </dl> | Структура [**принтера с \_ информацией \_ 9**](printer-info-9.md) , указывающая параметры принтера по умолчанию для каждого пользователя.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                      |



 

</dd> <dt>

*Команда* \[ окне\]
</dt> <dd>

действие для выполнения.

Если параметр *Level* имеет ненулевое значение, присвойте этому параметру нулевые значения. В этом случае принтер оставляет свое текущее состояние, а функция перенастраивает данные принтера в соответствии с параметрами *Level* и *ппринтер* .

Если значение параметра *Level* равно нулю, присвойте этому параметру одно из следующих значений.



| Значение                                                                                                                                                                                                  | Значение                                                                                                                                             |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="PRINTER_CONTROL_PAUSE"></span><span id="printer_control_pause"></span><dl> <dt>**приостановка управления ПРИНТЕРом \_ \_**</dt> </dl>                 | Приостановка принтера.<br/>                                                                                                                       |
| <span id="PRINTER_CONTROL_PURGE"></span><span id="printer_control_purge"></span><dl> <dt>**\_Очистка элемента управления принтера \_**</dt> </dl>                 | Удаление всех заданий печати на принтере.<br/>                                                                                                    |
| <span id="PRINTER_CONTROL_RESUME"></span><span id="printer_control_resume"></span><dl> <dt>**\_возобновление элемента управления принтера \_**</dt> </dl>              | Возобновление работы приостановленного принтера.<br/>                                                                                                                 |
| <span id="PRINTER_CONTROL_SET_STATUS"></span><span id="printer_control_set_status"></span><dl> <dt>**\_состояние набора элементов управления принтера \_ \_**</dt> </dl> | Задайте состояние принтера.<br/> Задайте для параметра *ппринтер* указатель на значение **типа DWORD** , указывающее новое состояние принтера.<br/> |



 

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если функция выполнена, возвращаемое значение будет ненулевым.

Если функция выполняется неудачно, возвращается нулевое значение.

Если *уровень* равен 7, а действие публикации завершилось неудачей, **сетпринтер** возвращает **ошибку ввода-вывода об ошибке \_ \_** и пытается выполнить действие в фоновом режиме. Если *уровень* равен 7, а действие обновления завершилось с ошибкой, **Сетпринтер** возвращает **\_ файл ошибки \_ не \_ найден**.

## <a name="remarks"></a>Комментарии

> [!Note]  
> Это блокирующая или синхронная функция, которая может не возвращать значение немедленно. Скорость возврата этой функцией зависит от факторов времени выполнения, таких как состояние сети, Конфигурация сервера печати и факторы реализации драйвера принтера, которые трудно предсказать при написании приложения. Вызов этой функции из потока, который управляет взаимодействием с пользовательским интерфейсом, может привести к невозможности реагирования приложения.

 

Нельзя использовать **сетпринтер** для изменения принтера по умолчанию.

Чтобы изменить текущие параметры принтера, вызовите функцию [**PrintOut**](getprinter.md) , чтобы получить текущие параметры в структуре [**принтера с \_ информацией \_ 2**](printer-info-2.md) , при необходимости измените элементы этой структуры, а затем вызовите **сетпринтер**.

Функция **сетпринтер** игнорирует элементы **псервернаме**, **аверажеппм**, **Status** и **кжобс** структуры « [**\_ сведения о принтере \_ 2**](printer-info-2.md) ».

Приостановка принтера приостанавливает планирование всех заданий печати для этого принтера, за исключением одного задания печати, которое может быть напечатано в данный момент. Задания печати могут быть отправлены на приостановленный принтер, но никакие задания не будут запланированы для печати на этом принтере до тех пор, пока печать не будет возобновлена. Если принтер сброшен, все задания печати для этого принтера удаляются, за исключением текущего задания печати.

При использовании **сетпринтер** для изменения структуры [**DEVMODE**](/windows/win32/api/wingdi/ns-wingdi-devmodea) по умолчанию для принтера (глобально настроив значения по умолчанию для принтера) необходимо сначала вызвать функцию [**DocumentProperties**](documentproperties.md) для проверки структуры **DEVMODE** .

Для структур [**" \_ сведения \_ о принтере 2**](printer-info-2.md) " и " [**\_ сведения о принтере \_ 3**](printer-info-3.md) ", которые содержат указатель на дескриптор безопасности, функция может задавать только те компоненты дескриптора безопасности, которые у вызывающего объекта есть разрешение на изменение. Чтобы задать определенные компоненты дескриптора безопасности, необходимо указать необходимые права доступа при вызове функции [**опенпринтер**](openprinter.md) или [**OpenPrinter2**](openprinter2.md) для получения дескриптора принтера. В следующей таблице показаны права доступа, необходимые для изменения различных компонентов дескриптора безопасности.



| Разрешение на доступ            | Компонент дескриптора безопасности             |
|------------------------------|-------------------------------------------|
| **\_владелец записи**             | Владелец<br/> Основная группа<br/> |
| **ЗАПИСЬ \_ DAC**               | Список управления доступом на уровне пользователей (DACL)  |
| **ДОСТУП \_ к \_ безопасности системы** | Системный доступ — список управления (SACL)         |



 

Если дескриптор безопасности содержит компонент, для которого вызывающий объект не имеет права доступа для изменения, **сетпринтер** завершается с ошибкой. Эти компоненты дескриптора безопасности, которые не нужно изменять, должны иметь **значение NULL** или отсутствовать, если это уместно. Если вы не хотите изменять дескриптор безопасности и вызываете **сетпринтер** со структурой [**сведений о принтере \_ \_ 2**](printer-info-2.md) , установите для элемента **псекуритидескриптор** этой структуры **значение NULL**.

Брандмауэр подключения к Интернету (ICF) блокирует порты принтера по умолчанию, но можно включить исключение для общего доступа к файлам и принтерам. Если **сетпринтер** вызывается администратором машины, он включает исключение. Если он вызывается не администратором, а исключение еще не включено, вызов завершается ошибкой.

Чтобы опубликовать, отменить публикацию или обновить данные службы каталогов для принтера, можно использовать уровень 7 с структурой " [**\_ сведения о принтере \_ 7**](printer-info-7.md) ". Данные службы каталогов для принтера включают все данные, хранящиеся в \_ \* ключах сплдс, путем вызова функции [**сетпринтердатаекс**](setprinterdataex.md) для принтера. Перед вызовом **сетпринтер** установите для элемента **псзобжектгуид** в **\_ сведениях \_ о принтере 7** **значение NULL** и задайте для элемента *двактион* одно из следующих значений.



| Значение                             | Описание                                                                                                                                                                                                                                                                                                                                                                             |
|-----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **\_Публикация дспринт**<br/>   | Публикует данные службы каталогов.<br/>                                                                                                                                                                                                                                                                                                                                        |
| **ДСПРИНТ \_ Повторная публикация**<br/> | Данные службы каталогов для принтера не публикуются, а затем публикуются снова, обновляются все свойства на опубликованном принтере. Повторная публикация также изменяет идентификатор GUID опубликованного принтера. Используйте это значение, если вы подозреваете, что опубликованные данные принтера повреждены.<br/>                                                                                         |
| **ДСПРИНТ \_ отменить публикацию**<br/> | Отменяет публикацию данных службы каталогов.<br/>                                                                                                                                                                                                                                                                                                                                      |
| **\_Обновление дспринт**<br/>    | Обновляет данные службы каталогов. Это то же самое, что и **дспринт \_ Publish**, за исключением того, что **сетпринтер** завершается сбоем, но **\_ файл ошибок \_ не \_ найден** , если принтер еще не опубликован.<br/> Используйте **\_ Обновление дспринт** для обновления опубликованных свойств, но не для принудительной публикации. Драйверы принтеров всегда должны **использовать \_ Обновление дспринт** , а не **дспринт \_ Publish**.<br/> |



 

**Дспринт \_ PENDING** не является допустимым значением *Двактион* для **сетпринтер**.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                                                |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                                      |
| Заголовок<br/>                   | <dl> <dt>Винспул. h (включение Windows. h)</dt> </dl> |
| Библиотека<br/>                  | <dl> <dt>Винспул. lib</dt> </dl>                   |
| DLL<br/>                      | <dl> <dt>Винспул. drv</dt> </dl>                   |
| Имя в кодировке Юникод и ANSI<br/>   | **Сетпринтерв** (Юникод) и **сетпринтера** (ANSI)<br/>                                           |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Вывод на печать](printdocs-printing.md)
</dt> <dt>

[Функции API очереди печати принтера](printing-and-print-spooler-functions.md)
</dt> <dt>

[**аддпринтер**](addprinter.md)
</dt> <dt>

[**Наложение**](getprinter.md)
</dt> <dt>

[**опенпринтер**](openprinter.md)
</dt> <dt>

[**OpenPrinter2**](openprinter2.md)
</dt> <dt>

[**\_Сведения о принтере \_ 2**](printer-info-2.md)
</dt> <dt>

[**\_Сведения о принтере \_ 3**](printer-info-3.md)
</dt> <dt>

[**\_Сведения о принтере \_ 4**](printer-info-4.md)
</dt> <dt>

[**\_Сведения о принтере \_ 5**](printer-info-5.md)
</dt> <dt>

[**\_Сведения о принтере \_ 6**](printer-info-6.md)
</dt> <dt>

[**\_Сведения о принтере \_ 7**](printer-info-7.md)
</dt> <dt>

[**\_Сведения о принтере \_ 8**](printer-info-8.md)
</dt> <dt>

[**\_Сведения о принтере \_ 9**](printer-info-9.md)
</dt> <dt>

[**сетпринтердатаекс**](setprinterdataex.md)
</dt> </dl>

 

 




