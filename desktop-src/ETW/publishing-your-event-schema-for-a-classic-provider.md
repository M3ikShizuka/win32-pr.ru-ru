---
description: Классические поставщики должны использовать MOF-файл (MOF) для публикации макета данных о событиях. Затем потребители могут считывать опубликованный макет из WMI во время выполнения и использовать его для чтения данных событий.
ms.assetid: eb3d8422-2352-47cf-9825-cba9916791a9
title: Публикация схемы событий для классического поставщика
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6607e2e9b940df5afd6e8070e9235fe40566ef2b6d2b31b3c14656756835bab2
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119069824"
---
# <a name="publishing-your-event-schema-for-a-classic-provider"></a>Публикация схемы событий для классического поставщика

[Классические](about-event-tracing.md) поставщики должны использовать [MOF-файл](../wmisdk/managed-object-format--mof-.md) (MOF) для публикации макета данных о событиях. Затем потребители могут считывать опубликованный макет из WMI во время выполнения и использовать его для чтения данных событий.

Если вы используете MOF для публикации макета данных событий в WMI, обычно в корневом пространстве имен WMI создаются следующие три типа классов MOF \\ :

-   [Класс MOF поставщика](#provider-mof-classes)
-   [Один или несколько классов MOF событий](#event-mof-classes)
-   [Класс MOF одного или нескольких типов событий](#event-type-mof-classes)

## <a name="provider-mof-classes"></a>Классы MOF поставщика

При публикации макета данных события необходимо создать класс MOF, определяющий поставщика. Этот класс должен быть производным от класса **евенттраце** MOF и должен быть пустым (без свойств или методов). Класс также должен включать квалификатор **GUID** , который уникальным образом идентифицирует поставщик. Это тот же идентификатор GUID, который вы используете при вызове функции [**регистертрацегуидс**](/windows/win32/api/evntrace/nf-evntrace-registertraceguidsa) для регистрации поставщика.

## <a name="event-mof-classes"></a>Классы событий MOF

Класс событий MOF определяет класс событий, предоставляемых поставщиком. Этот класс является производным от класса MOF поставщика и должен быть пустым (без свойств или методов). Класс также должен включать квалификатор **GUID** , который однозначно определяет класс событий, определяемых его дочерними классами. Поставщик использует этот же идентификатор GUID при задании элемента **GUID** структуры [**\_ \_ заголовка трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) .

## <a name="event-type-mof-classes"></a>Классы MOF типа событий

Класс MOF типа события определяет фактические данные события. Этот класс является производным от родительского класса событий MOF. При присвоении имени классу MOF типа события используется имя класса MOF события в начале типа события имя класса MOF. Например, если имя класса MOF события — Хвконфиг, а класс событий MOF представляет сведения о ЦП, следует присвоить классу MOF типа события, Хвконфиг \_ CPU.

Используйте квалификатор **EventType** в классе события типа MOF для задания типа события. Если несколько типов событий используют одни и те же данные событий, они могут использовать один и тот же класс MOF. Поставщик использует то же значение типа события для указания события при задании члена **класса. Type** в структуре [**\_ \_ заголовка трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) .

Класс MOF типа события содержит свойства. Порядок этих свойств определяет макет данных события. В следующей таблице указаны типы данных и квалификаторы, которые можно использовать для определения свойств. Дополнительные сведения о квалификаторах свойств и классов, которые можно использовать, см. в разделе [Квалификаторы MOF для трассировки событий](event-tracing-mof-qualifiers.md).



| Тип данных              | Квалификаторы                        | Описание                                                                                                                                                                                                                                                                                                              |
|------------------------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **sint8**, **Uint8**   | **Формат**                        | Объявляет 1-байтовое десятичное целое число. Чтобы объявить символ ANSI, используйте квалификатор **формата** и присвойте ему значение "c".                                                                                                                                                                                                  |
| **sint16**, **UInt16** | **Формат**                        | Объявляет 2-байтовое десятичное целое число. Чтобы указать, что число является шестнадцатеричным числом, используйте квалификатор **формата** . Например, Format ("x").                                                                                                                                                                               |
| **Sint32**, **UInt32** | **Формат**                        | Объявляет 4-байтовое десятичное целое число. Чтобы указать, что число является шестнадцатеричным числом, используйте квалификатор **формата** и присвойте ему значение "x".                                                                                                                                                                                |
| **sint64**, **UInt64** | **Формат**                        | Объявляет 8-байтовое десятичное целое число. Чтобы указать, что число является шестнадцатеричным числом, используйте квалификатор **формата** и присвойте ему значение "x".                                                                                                                                                                                |
| **boolean**            |                                   | Объявляет логическое значение. Потребитель события должен интерпретировать значение как BOOL (4-байтовое целое число).                                                                                                                                                                                                                        |
| **char16**             |                                   | Объявляет широкий символ. Потребитель событий должен интерпретировать Char16 массивы в событиях ядра как строки расширенных символов. (Используйте размер массива для копирования строки. Некоторые строки могут содержать начальные символы NULL.)                                                                                                      |
| **object**             | **Расширение**                     | Объявляет двоичный BLOB-объект. Квалификатор **расширения** указывает тип данных в большом двоичном объекте.                                                                                                                                                                                                                              |
| **строка**             | **Формат**, **стрингтерминатион** | Объявляет строковое значение. Чтобы указать, что строка является строкой расширенных символов, используйте квалификатор **формата** и задайте для его значения значение w. Строка считается строкой ANSI, если не указан квалификатор **формата** . Чтобы указать, как завершается строка, используйте квалификатор **стрингтерминатион** . <br/> |



 

Чтобы указать массив, можно использовать квадратные скобки, \[ \] . Квадратные скобки могут включать размер массива. Пример:

`[WmiDataId(1), read] uint8 MyGuid[16];`

Квалификатор **Max** также можно использовать для указания размера массива. Пример:

`[WmiDataId(1), Max(16), read] uint8 MyGuid[];`

При включении размера массива в квадратные скобки компилятор MOF создает для вас квалификатор Max.

Важно использовать квалификатор **Description** для каждого свойства. Описание должно содержать отображаемое имя, которое потребитель может использовать при отображении значений свойств.

В следующем примере показано содержимое MOF-файла, описывающего класс MOF, события и типа события.

``` syntax
#pragma namespace("\\\\.\\root\\wmi")

[dynamic: ToInstance, Description("Defines my event provider"),
 Guid("{7C214FB1-9CAC-4b8d-BAED-7BF48BF63BB3}")]
class MyProvider : EventTrace
{
};

[dynamic: ToInstance, Description("Defines a category of events that my provider logs."): Amended,
 Guid("{B49D5931-AD85-4070-B1B1-3F81F1532875}")]
class MyCategory : MyProvider
{
};

[dynamic: ToInstance, Description("Defines an event within the category of events that my provider logs."): Amended,
 EventType(1)]
class MyCategory_MyEvent : MyCategory
{
    [WmiDataId(1), Description("Cost factor"): Amended, read] sint32 Cost;
    [WmiDataId(2), Description("Index values"): Amended, read] uint32 Indices[3];
    [WmiDataId(3), Description("Signature"): Amended, read, StringTermination("NullTerminated"), Format("w")] string Signature;
    [WmiDataId(4), Description("Is complete copy"): Amended, read] boolean IsComplete;
    [WmiDataId(5), Description("Class identifier"): Amended, read, Extension("Guid")] object ID;
};
```

Обратите внимание, что имена классов типа "поставщик", "событие" и "тип события" должны быть уникальными в пределах всего пространства имен. Чтобы избежать конфликтов имен, следует использовать уникальные и описательные имена для всех имен классов. Свойства класса также должны быть описательными и уникальными в пределах иерархии классов — дочерний класс, содержащий то же имя свойства, что и родительский класс, перезаписывает свойство родительского класса.

Определив классы MOF, используйте компилятор MOF для создания схемы событий и добавления ее в репозиторий CIM. Затем потребители могут считывать схему из репозитория и программно считывать данные о событиях. Полное описание синтаксиса MOF и использование компилятора MOF (Mofcomp.exe) для добавления классов MOF в репозиторий CIM см. в разделе [MOF-файл](../wmisdk/managed-object-format--mof-.md). сведения об использовании Wbemtest.exe для доступа к репозиторию CIM см. в разделе [инструментарий управления Windows (WMI)](../wmisdk/wmi-start-page.md) (WMI).

## <a name="versioning-mof-class"></a>Управление версиями класс MOF

При добавлении или изменении класса MOF типа события в соглашении используется версия класса MOF события и его дочерние классы MOF. Чтобы получить версию текущего класса MOF события, добавьте \_ VN в имя класса, где n — это добавочный номер, начинающийся с 0. Если это первая редакция класса, добавьте \_ v0 к имени класса. Необходимо также добавить в класс квалификатор **евентверсион** . Используйте тот же номер версии, который использовался в имени класса для значения квалификатора **евентверсион** .

Новая версия класса MOF события должна использовать то же имя и квалификатор **GUID** , что и исходный класс. Новый класс может дополнительно добавить квалификатор **евентверсион** . Класс MOF события, не содержащий квалификатор **евентверсион** , считается последней версией, или если все версии класса содержат квалификатор **евентверсион** , то класс с самым высоким номером версии считается последней версией. Поставщик использует член **класса. Version** структуры [**\_ \_ заголовка трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) для выявления версии события, включаемого в трассировку.

В следующем примере показано, как выполнить версию класса MOF события.

``` syntax
#pragma namespace("\\\\.\\root\\wmi")
#pragma classflags("forceupdate")

[dynamic: ToInstance, Description("Defines my event provider"),
 Guid("{7C214FB1-9CAC-4b8d-BAED-7BF48BF63BB3}")]
class MyProvider : EventTrace
{
};

[dynamic: ToInstance, Description("Defines a category of events that my provider logs."),
 Guid("{B49D5931-AD85-4070-B1B1-3F81F1532875}"),
 EventVersion(1)]
class MyCategory : MyProvider
{
};

[dynamic: ToInstance, Description("Defines an event within the category of events that my provider logs."): Amended,
 EventType(1),
 EventName("MyEvent")]
class MyCategory_MyEvent : MyCategory
{
    [WmiDataId(1), Description("Cost factor"): Amended, read] sint32 Cost;
    [WmiDataId(2), Description("Index values"): Amended, read] uint32 Indices[3];
    [WmiDataId(3), Description("Signature"): Amended, read, StringTermination("NullTerminated"), Format("w")] string Signature;
    [WmiDataId(4), Description("Is complete copy"): Amended, read] boolean IsComplete;
    [WmiDataId(5), Description("Identifier"): Amended, read, Extension("Guid")] object ID;
    [WmiDataId(6), Description("Buffer Size"): Amended, read] uint32 Size;
};

[dynamic: ToInstance, Description("Defines a category of events that my provider logs."): Amended,
 Guid("{B49D5931-AD85-4070-B1B1-3F81F1532875}"),
 EventVersion(0)]
class MyCategory_V0 : MyProvider
{
};

[dynamic: ToInstance, Description("Defines an event within the category of events that my provider logs."): Amended,
 EventType(1)]
class MyCategory_V0_MyEvent : MyCategory_V0
{
    [WmiDataId(1), Description("Cost factor"): Amended, read] sint32 Cost;
    [WmiDataId(2), Description("Index values"): Amended, read] uint32 Indices[3];
    [WmiDataId(3), Description("Signature"): Amended, read, StringTermination("NullTerminated"), Format("w")] string Signature;
    [WmiDataId(4), Description("Is complete copy"): Amended, read] boolean IsComplete;
    [WmiDataId(5), Description("Identifier"): Amended, read, Extension("Guid")] object ID;
};
```

 

 
