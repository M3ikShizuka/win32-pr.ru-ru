---
description: Чтобы настроить сеанс трассировки событий, используйте \_ структуру Свойства трассировки событий, \_ чтобы указать свойства сеанса.
ms.assetid: 8a6aa39c-ec81-42ac-a26e-29f1f6960220
title: Настройка и запуск сеанса трассировки событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0f86ec57975e8f12ede17e5e2cda962c010aa1af
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104986136"
---
# <a name="configuring-and-starting-an-event-tracing-session"></a>Настройка и запуск сеанса трассировки событий

Чтобы настроить сеанс трассировки событий, используйте структуру [**\_ \_ Свойства трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties) , чтобы указать свойства сеанса. Память, выделенная для структуры **\_ \_ свойств трассировки событий** , должна быть достаточно большой, чтобы также содержать имена сеансов и файлов журналов, которые следуют за структурой в памяти.

После указания свойств сеанса вызовите функцию [**старттраце**](/windows/win32/api/evntrace/nf-evntrace-starttracea) , чтобы запустить сеанс. Если функция выполнена, параметр *сессионхандле* будет содержать обработчик сеанса, а свойство **логжернамеоффсет** будет содержать смещение к имени сеанса.

Чтобы включить поставщиков, которые будут регистрировать события в сеансе, вызовите функцию [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) , чтобы включить классические поставщики и функцию [**енаблетрацеекс**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) для включения поставщиков [на основе манифеста](about-event-tracing.md) . Чтобы включить поставщиков, которые должны записывать события в журнал при фильтрации сеанса при определенных условиях Windows 8.1, Windows Server 2012 R2 и более поздних версиях, вызовите функцию [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) .

Кроме того, можно также отслеживать дополнительные сведения о событии с помощью вызова функции [**трацесетинформатион**](/windows/win32/api/evntrace/nf-evntrace-tracesetinformation) . **Трацесетинформатион** помещает дополнительные сведения о трассировке в раздел расширенных данных события и может включать такие сведения, как сведения о версии трассировки или о том, какие поставщики в настоящее время зарегистрированы в системе. Дополнительные сведения см. в разделе [Получение дополнительных данных трассировки событий](retrieving-additional-event-tracing-data.md).

До восьми сеансов трассировки можно включить и получить события из одного и того же поставщика [на основе манифеста](about-event-tracing.md) . Однако [классический](about-event-tracing.md) поставщик может включить только один сеанс трассировки. Если несколько сеансов трассировки пытаются включить классический поставщик, первый сеанс перестанет получать события, когда второй сеанс включит поставщик. Например, если в сеансе включен поставщик 1, а затем в сеансе B включен поставщик 1, то только сеанс б будет принимать события от поставщика 1.

Вы можете использовать любую из трех функций для включения поставщика, но при использовании [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) для включения поставщика на основе манифеста можно потерять функциональность, так как вы не сможете предоставить значение матчаллкэйворд, указать расширенные элементы данных для включения в событие или предоставить данные фильтра, определенные поставщиком. Дополнительные сведения см. в разделе "Примечания" каждой функции.

В Windows 8.1, в Windows Server 2012 R2 и более поздних версиях фильтры анализа полезных данных события, области действия и стека могут использоваться функцией [**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2) , [**а \_ \_ параметры включения трассировки**](/windows/win32/api/evntrace/ns-evntrace-enable_trace_parameters) и [**\_ \_ дескриптора фильтра событий**](/windows/desktop/api/Evntprov/ns-evntprov-event_filter_descriptor) — для фильтрации по конкретным условиям сеанса ведения журнала. Дополнительные сведения о фильтрах полезных данных событий см. в статьях функции [**тдхкреатепайлоадфилтер**](/windows/desktop/api/Tdh/nf-tdh-tdhcreatepayloadfilter)и [**тдхаггрегатепайлоадфилтерс**](/windows/desktop/api/Tdh/nf-tdh-tdhaggregatepayloadfilters) , а также структуры [**\_ \_ предикатов**](/windows/desktop/api/Tdh/ns-tdh-payload_filter_predicate) **включения \_ трассировки \_**, **\_ \_ дескриптора фильтра событий** и фильтра полезных данных.

Чтобы определить уровень и ключевые слова, используемые для включения поставщика на основе манифеста, используйте одну из следующих команд:

-   *Имя поставщика* **запроса** **Logman**
-   Средство **wevtutil** **GP** *provider-Name*

Команды выводит только уровень и ключевые слова. поставщик должен документировать требования к данным фильтра для потенциальных контроллеров.

Для перечисления поставщиков на основе манифеста используется средство **wevtutil** **EP**.

Для классических поставщиков поставщику необходимо документировать и сделать доступным для потенциальных контроллеров уровни серьезности или включить поддерживаемые им флаги. Если поставщик хочет включить какой-либо контроллер, поставщик должен принять значение 0 для уровня серьезности и включить флаги и интерпретировать 0 как запрос на выполнение журнала по умолчанию (что может быть).

Вы можете включить поставщик до или после того, как поставщик зарегистрировал свою регистрацию. После включения поставщика ETW будет вызывать функцию обратного вызова поставщика. Если поставщик не зарегистрирован, ETW будет вызывать функцию обратного вызова поставщика после регистрации.

Можно также использовать функцию [**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace) , чтобы отключить поставщик (отключить его от ведения журнала событий в сеанс) или обновить уровень ведения журнала или включить флаги поставщика. С помощью функции [**енаблетрацеекс**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex) можно отключить поставщик или обновить уровень, ключевые слова, Расширенные данные и фильтровать данные. Каждый раз при вызове функции **енаблетраце** или **енаблетрацеекс** ETW вызывает функцию обратного вызова поставщика. Поставщик остается включенным для сеанса, пока сеанс не отключается поставщиком.

Чтобы отключить сеанс трассировки после сбора событий, вызовите функцию [**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea) и передайте \_ Управление трассировкой событий в \_ \_ качестве управляющего кода. Чтобы указать сеанс для завершения, можно передать обработчик сеанса трассировки событий, полученный из предыдущего вызова функции [**старттраце**](/windows/win32/api/evntrace/nf-evntrace-starttracea) , или имя ранее запущенного сеанса. Перед остановкой сеанса обязательно отключите все поставщики. Если вы останавливаете сеанс перед первым отключением поставщика, ETW отключит поставщик и попытается вызвать функцию обратного вызова элемента управления поставщика. Если приложение, запустившего сеанс, завершается без отключения поставщика или вызова функции **контролтраце** , то поставщик остается включенным.

Если [**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea) успешно, свойства сеанса обновляются в соответствии с последними значениями свойств и запускают статистику для сеанса трассировки событий.

Пример, в котором запускается сеанс трассировки событий, см. в следующих статьях:

-   [Пример создания сеанса и включения поставщика на основе манифеста](example-that-creates-a-session-and-enables-a-manifest-based-provider.md) — запуск сеанса трассировки, включение поставщика на основе манифеста, отключение поставщика и прекращение сеанса.

Дополнительные сведения о запуске сеанса трассировки см. в описании одного из следующих действий.

-   [Настройка и запуск сеанса Системтрацепровидер](configuring-and-starting-a-systemtraceprovider-session.md)
-   [Настройка и запуск сеанса ведения журнала ядра NT](configuring-and-starting-the-nt-kernel-logger-session.md)
-   [Настройка и запуск сеанса авторегистратора](configuring-and-starting-an-autologger-session.md)
-   [Настройка и запуск сеанса глобального журнала](configuring-and-starting-the-global-logger-session.md)
-   [Настройка и запуск закрытого сеанса ведения журнала](configuring-and-starting-a-private-logger-session.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Настройка и запуск закрытого сеанса ведения журнала](configuring-and-starting-a-private-logger-session.md)
</dt> <dt>

[Настройка и запуск сеанса Системтрацепровидер](configuring-and-starting-a-systemtraceprovider-session.md)
</dt> <dt>

[Настройка и запуск сеанса авторегистратора](configuring-and-starting-an-autologger-session.md)
</dt> <dt>

[Настройка и запуск сеанса ведения журнала ядра NT](configuring-and-starting-the-nt-kernel-logger-session.md)
</dt> <dt>

[**контролтраце**](/windows/win32/api/evntrace/nf-evntrace-controltracea)
</dt> <dt>

[**енаблетраце**](/windows/win32/api/evntrace/nf-evntrace-enabletrace)
</dt> <dt>

[**енаблетрацеекс**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex)
</dt> <dt>

[**EnableTraceEx2**](/windows/win32/api/evntrace/nf-evntrace-enabletraceex2)
</dt> <dt>

[**ВКЛЮЧИТЬ \_ \_ Параметры трассировки**](/windows/win32/api/evntrace/ns-evntrace-enable_trace_parameters)
</dt> <dt>

[**\_дескриптор фильтра \_ событий**](/windows/desktop/api/Evntprov/ns-evntprov-event_filter_descriptor)
</dt> <dt>

[**\_Свойства трассировки \_ событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties)
</dt> <dt>

[**\_предикат фильтра полезных данных \_**](/windows/desktop/api/Tdh/ns-tdh-payload_filter_predicate)
</dt> <dt>

[**старттраце**](/windows/win32/api/evntrace/nf-evntrace-starttracea)
</dt> <dt>

[**тдхаггрегатепайлоадфилтерс**](/windows/desktop/api/Tdh/nf-tdh-tdhaggregatepayloadfilters)
</dt> <dt>

[**тдхкреатепайлоадфилтер**](/windows/desktop/api/Tdh/nf-tdh-tdhcreatepayloadfilter)
</dt> <dt>

[Обновление сеанса трассировки событий](updating-an-event-tracing-session.md)
</dt> </dl>

 

 
