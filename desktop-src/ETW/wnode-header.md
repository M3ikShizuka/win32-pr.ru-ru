---
description: '\_Структура заголовка вноде является элементом \_ \_ структуры свойств трассировки событий.'
ms.assetid: 862a8f46-a326-48c6-92b7-8bb667837bb7
title: Структура WNODE_HEADER (Вмистр. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- WNODE_HEADER
api_type:
- HeaderDef
api_location:
- Wmistr.h
ms.openlocfilehash: 6a2ed615d2b67cbd47a817234a14b7cf1221f601
ms.sourcegitcommit: 11f52354f570aacaf1ba2a266b2e507abd73352a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104987416"
---
# <a name="wnode_header-structure"></a>\_Структура заголовка вноде

Структура **\_ заголовка вноде** является элементом структуры [**\_ \_ свойств трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties) .

## <a name="syntax"></a>Синтаксис


```C++
typedef struct _WNODE_HEADER {
  ULONG BufferSize;
  ULONG ProviderId;
  union {
    ULONG64 HistoricalContext;
    struct {
      ULONG Version;
      ULONG Linkage;
    };
  };
  union {
    HANDLE        KernelHandle;
    LARGE_INTEGER TimeStamp;
  };
  GUID  Guid;
  ULONG ClientContext;
  ULONG Flags;
} WNODE_HEADER, *PWNODE_HEADER;
```



## <a name="members"></a>Участники

<dl> <dt>

**BufferSize**
</dt> <dd>

Общий размер выделенной памяти (в байтах) для свойств сеанса трассировки событий. Размер памяти должен включать место для структуры [**\_ \_ свойств трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties) , а также строку имени сеанса и имя файла журнала, которые следуют за структурой в памяти.

</dd> <dt>

**ProviderId**
</dt> <dd>

Зарезервировано для внутреннего использования.

</dd> <dt>

**хисторикалконтекст**
</dt> <dd>

На выходе — это обработчик сеанса трассировки событий.

</dd> <dt>

**Версия**
</dt> <dd>

Зарезервировано для внутреннего использования.

</dd> <dt>

**Компоновка**
</dt> <dd>

Зарезервировано для внутреннего использования.

</dd> <dt>

**кернелхандле**
</dt> <dd>

Зарезервировано для внутреннего использования.

</dd> <dt>

**TimeStamp**
</dt> <dd>

Время обновления сведений в этой структуре за 100-наносекундных интервалов с полуночи 1 января 1601 г.

</dd> <dt>

**Устройства**
</dt> <dd>

Идентификатор GUID, определенный для сеанса.

Для сеанса ведения журнала ядра NT установите для этого элемента значение **системтрацеконтролгуид**.

Если для этого члена задано значение **системтрацеконтролгуид** или **глобаллогжергуид**, средство ведения журнала будет системным журналом.

Для закрытого сеанса ведения журнала задайте для этого элемента идентификатор GUID поставщика, который будет включен для сеанса.

Если вы запускаете сеанс, который не является средством ведения журнала ядра или закрытым сеансом ведения журнала, указывать идентификатор GUID сеанса не требуется. Если идентификатор GUID не указан, ETW создаст его. Идентификатор GUID сеанса необходимо указывать только в том случае, если необходимо изменить разрешения по умолчанию, связанные с конкретным сеансом. Дополнительные сведения см. в описании функции Евентакцессконтрол.

Нельзя запустить более одного сеанса с одинаковым идентификатором GUID сеанса.

**До Windows Vista:** Можно запустить более одного сеанса с одним идентификатором GUID сеанса.

</dd> <dt>

**ClientContext**
</dt> <dd>

Разрешение часов, используемое при записи метки времени для каждого события. Значение по умолчанию — счетчик производительности запросов (QPC).

**До Windows Vista:** По умолчанию используется системное время.

**До Windows 10, версия 1703:** Все системные средства ведения журнала могут одновременно использовать не более 2 различных типов часов.

**Начиная с Windows 10, версия 1703:** Ограничение типа "Часы" было удалено. Все три типа часов теперь могут использоваться системными журналами одновременно.

Можно указать одно из следующих значений.



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Значение</th>
<th>Значение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><dl> <dt>1</dt> </dl></td>
<td>Счетчик производительности запросов (QPC). Счетчик QPC предоставляет метку времени высокого разрешения, которая не влияет на системные часы. Метка времени, хранящаяся в событии, эквивалентна значению, возвращаемому API QueryPerformanceCounter. Дополнительные сведения о характеристиках этой метки времени см. в разделе <a href="/windows/win32/sysinfo/acquiring-high-resolution-time-stamps">Получение меток времени с высоким разрешением</a>.<br/> Это разрешение следует использовать при наличии высокой частоты событий или в случае, если потребитель объединяет события из разных буферов. В таких случаях точность и стабильность отметок времени QPC обеспечивают лучшую точность при упорядочении событий из разных буферов. Однако отметка времени QPC не отражает обновления системных часов, например, если системные часы настраиваются вперед из-за синхронизации с сервером NTP во время трассировки, то отметки времени QPC в трассировке будут продолжать отражать время, как если бы обновление не происходило.<br/> Чтобы определить разрешение, используйте член <strong>перффрек</strong> <a href="/windows/win32/api/evntrace/ns-evntrace-trace_logfile_header"><strong>TRACE_LOGFILE_HEADER</strong></a> при использовании события.<br/> Чтобы преобразовать отметку времени события в единицы 100-NS, используйте следующую формулу преобразования: <br/> Скаледтиместамп = Евентрекорд. Евенсеадер. TimeStamp. Куадпарт * 10000000,0/Логфилехеадер. Перффрек. Куадпарт<br/> Обратите внимание, что на старых компьютерах отметка времени может быть неточной, так как счетчик иногда пропускается из-за ошибок оборудования.<br/></td>
</tr>
<tr class="even">
<td><dl> <dt>2</dt> </dl></td>
<td>Системное время. Системное время предоставляет отметку времени, которая отслеживает изменения системных часов, например, если системные часы корректируются из-за синхронизации с сервером NTP во время выполнения трассировки, то временные метки времени в трассировке также будут перенаправлены в соответствие с новым значением системных часов. <br/>
<ul>
<li>В системах до Windows 10 метка времени, хранящаяся в событии, эквивалентна значению, возвращаемому API GetSystemTimeAsFileTime.</li>
<li>В Windows 10 или более поздней версии метка времени, хранящаяся в событии, эквивалентна значению, возвращаемому API ЖетсистемтимепреЦисеасфилетиме.</li>
</ul>
До Windows 10 разрешение этой метки времени было разрешением такта системных часов, как указано элементом Тимерресолутион в TRACE_LOGFILE_HEADER. Начиная с Windows 10, разрешение этой метки времени является разрешением счетчика производительности, как указано элементом Перффрек в TRACE_LOGFILE_HEADER.<br/> Чтобы преобразовать отметку времени события в единицы 100-NS, используйте следующую формулу преобразования: <br/> Скаледтиместамп = Евентрекорд. Евенсеадер. TimeStamp. Куадпарт<br/> Обратите внимание, что когда события фиксируются в системе под управлением операционной системы до Windows 10, если объем событий высок, разрешение системного времени может быть недостаточно точным для определения последовательности событий. В этом случае набор событий будет иметь одинаковую отметку времени, но порядок, в котором трассировки событий Windows доставляет события, может быть неверным. Начиная с Windows 10, штамп времени записывается с дополнительной точностью, хотя некоторые нестабильность могут возникать в случаях, когда системные часы были скорректированы во время записи трассировки.<br/></td>
</tr>
<tr class="odd">
<td><dl> <dt>3-5</dt> </dl></td>
<td>Счетчик циклов ЦП. Счетчик ЦП имеет наивысшую отметку времени разрешения и является наименьшим ресурсоемким ресурсом. Однако счетчик ЦП является ненадежным и не должен использоваться в рабочей среде. Например, на некоторых компьютерах таймеры изменяют частоту из-за температурных и энергосберегающих изменений, а также в некоторых состояниях.<br/> Чтобы определить разрешение, используйте член <strong>кпуспидинмхз</strong> <a href="/windows/win32/api/evntrace/ns-evntrace-trace_logfile_header"><strong>TRACE_LOGFILE_HEADER</strong></a> при использовании события.<br/> Если оборудование не поддерживает этот тип часов, ETW использует системное время.<br/> <strong>Windows Server 2003, Windows XP с пакетом обновления 1 (SP1) и Windows XP:</strong> Это значение не поддерживается, оно представлено в Windows Server 2003 с пакетом обновления 1 (SP1) и Windows XP с пакетом обновления 2 (SP2).<br/></td>
</tr>
</tbody>
</table>



 

**Windows 2000:** Элемент **ClientContext** не поддерживается.

</dd> <dt>

**Флаги**
</dt> <dd>

Должен содержать **флаг вноде с \_ \_ трассировкой \_** , чтобы указать, что структура содержит сведения о трассировке событий.

</dd> </dl>

## <a name="remarks"></a>Примечания

Не забудьте инициализировать память для этой структуры до нуля перед установкой любых элементов.

Чтобы преобразовать метку времени ETW в FILETIME, выполните следующую процедуру.

<dl> 1. Для каждого обрабатываемого сеанса или файла журнала (т. е. для \_ каждого \_ журнала трассировки событий) следует проверить поле файл_журнала. процесстрацемоде, чтобы определить, \_ установлен ли флаг " \_ \_ необработанная \_ Метка времени трассировки процесса". По умолчанию этот флаг не установлен. Если этот флаг не установлен, среда выполнения ETW автоматически преобразует метку времени каждой \_ записи события в FILETIME перед отправкой \_ записи события в функцию евентрекордкаллбакк, поэтому дополнительная обработка не требуется. Следующие шаги следует использовать только в том случае, если трассировка обрабатывается с \_ \_ \_ \_ установленным флагом метки времени необработанного режима трассировки процесса.  
2. Для каждого обрабатываемого сеанса или файла журнала (т. е. для \_ каждого \_ журнала трассировки событий) Проверьте поле файл_журнала. Логфилехеадер. ресерведфлагс, чтобы определить шкалу времени для файла журнала. В зависимости от значения Ресерведфлагс выполните одно из следующих действий, чтобы определить значение, которое будет использоваться для Тиместампскале на оставшихся шагах. <dl> a. Если Ресерведфлагс = = 1 (QPC): DOUBLE Тиместампскале = 10000000,0/файл_журнала. Логфилехеадер. Перффрек. Куадпарт;  
b. Если Ресерведфлагс = = 2 (системное время): DOUBLE Тиместампскале = 1,0;  
Обратите внимание, что оставшиеся шаги не нужны для событий, использующих системное время, так как события уже содержат отметки времени в единицах FILETIME. Оставшиеся шаги будут работать, но не нужны, и в них будет представлено небольшое сообщение об ошибке округления.  
c. Если Ресерведфлагс = = 3 (счетчик циклов ЦП): DOUBLE Тиместампскале = 10,0/файл_журнала. Логфилехеадер. Кпуспидинмхз;  
</dl> </dd> 3. On the FIRST call to your EventRecordCallback function for a particular log file, use data from the logFile (EVENT\_TRACE\_LOGFILE) and from the eventRecord (EVENT\_RECORD) to compute the timeStampBase that will be used for the remaining events in the log file: INT64 timeStampBase = logFile.LogfileHeader.StartTime.QuadPart - (INT64)(timeStampScale \* eventRecord.EventHeader.TimeStamp.QuadPart);  
4. For each eventRecord (EVENT\_RECORD), convert the event’s timestamp into FILETIME as follows, using the timeStampScale and timeStampBase values calculated in steps 2 and 3: INT64 timeStampInFileTime = timeStampBase + (INT64)(timeStampScale \* eventRecord.EventHeader.TimeStamp.QuadPart);  
</dl>

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Приложения Windows 2000 Professional \[ классические приложения \| UWP\]<br/>                   |
| Минимальная версия сервера<br/> | \[Приложения UWP для классических приложений Windows 2000 \|\]<br/>                         |
| Header<br/>                   | <dl> <dt>Вмистр. h</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[*контролкаллбакк*](/windows/win32/api/evntrace/nc-evntrace-wmidprequest)
</dt> <dt>

[**\_Свойства трассировки \_ событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_properties)
</dt> <dt>

[**жеттрацелогжерхандле**](/windows/win32/api/evntrace/nf-evntrace-gettraceloggerhandle)
</dt> <dt>

[**БОЛЬШОЕ \_ целое число**](/windows/win32/api/winnt/ns-winnt-large_integer-r1)
</dt> </dl>

 

 
