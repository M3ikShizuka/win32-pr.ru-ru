---
description: 'В этой статье представлен обзор того, что следует рассчитывать на полное путешествие события для каждой из четырех технологий отслеживания, предоставляемых корпорацией Майкрософт: Трацелоггинг, на основе манифеста, WPP и MOF.'
ms.assetid: 6102593C-C6D5-4BDB-A0EF-067AF91DE00B
title: Общие сведения о метаданных событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0c16853ef2639fd560f5b5da30447556119ec877
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497025"
---
# <a name="event-metadata-overview"></a>Общие сведения о метаданных событий

В этой статье представлен обзор того, что следует рассчитывать на полное путешествие события для каждой из четырех технологий отслеживания, предоставляемых корпорацией Майкрософт: [трацелоггинг](../tracelogging/trace-logging-about.md), [на основе манифеста](writing-manifest-based-events.md), [WPP](windows-software-trace-preprocessor.md)и [MOF](tracing-events.md). Он приближается к проблеме в отношении полезных данных отдельного события и сопутствующих метаданных, описывающих его структуру, что позволяет впоследствии декодировать событие в разумные фрагменты данных. Понимание пути к каждому элементу события важно при выборе технологии трассировки для проекта. Для трассировки не существует такого решения.

## <a name="event-payloads"></a>Полезные данные события

Для любой из технологий отслеживания, предоставляемых корпорацией Майкрософт, при вызове команды Write (для экземпляра [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite) для манифеста или [**трацелоггингврите**](/windows/win32/api/traceloggingprovider/nf-traceloggingprovider-traceloggingwrite) для трацелоггинг) данные, предоставляемые для события во время выполнения, сведены в непрерывный двоичный BLOB-объект, называемый полезной нагрузкой событий. Это отдельно от схемы событий или метаданных событий (описываемых ниже), описывающих структуру двоичного BLOB-объекта для средств декодирования. То, как именно будет создаваться полезная нагрузка события, зависит от используемой технологии трассировки и в конечном итоге является ли событие классическим ([**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) Style) или современным (**EventWrite** Style).

Для классических событий флаг в [**\_ \_ заголовке трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) передается в [**TraceEvent**](/windows/win32/api/evntrace/nf-evntrace-traceevent) , который определяет, как это происходит:

\- Если **задан \_ флаг вноде \_ использовать \_ MOF \_ ptr** , массив [**\_ полей MOF**](/windows/win32/api/evntrace/ns-evntrace-mof_field) следует за [**\_ \_ заголовком трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header) в памяти. Среда выполнения ETW будет объединять данные событий, как указано в этих полях, для формирования полезных данных события.

\- Если **\_ флаг вноде \_ использовать \_ MOF \_ ptr** не указан, полезные данные события создаются пользователем непосредственно в памяти после [**\_ \_ заголовка трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace_header).

MOF и WPP являются классическими поставщиками. Тем не менее, реализация КОНВЕЙЕРа позаботится об этом.

Для неклассических событий в [**EventWrite**](/windows/desktop/api/Evntprov/nf-evntprov-eventwrite)передается ряд [**\_ \_ дескрипторов данных событий**](/windows/desktop/api/Evntprov/ns-evntprov-event_data_descriptor) . Среда выполнения ETW будет объединять данные событий, как указано в дескрипторах, для формирования полезных данных события.

Технологии на основе манифеста и Трацелоггинг обычно являются современными поставщиками. При использовании на основе манифеста, если вы разрешите mc.exe создать код ведения журнала для вас (коммутатор UM или км), будет создана полезная нагрузка. Создание полезных данных всегда осуществляется с помощью Трацелоггинг.

Конечным результатом является то, что полезная нагрузка для события создается во время выполнения. Все полезные данные в основном похожи на двоичные BLOB-объекты данных, содержащие только данные полей для конкретного события, независимо от используемой технологии трассировки и того, какие типы полей поддерживаются этой технологией трассировки. Без метаданных событий полезные данные события не имеют смысла и заняться.

Затем обязанность среды выполнения ETW перемещает этот большой двоичный объект события от поставщика к потребителю, где он повторно связывается с метаданными и становится декодабле. В среде выполнения ETW будет добавлено несколько дополнительных метаданных, указывающих на обстоятельства полезной нагрузки — например, отметка времени, идентификатор потока и ключевые слова события. Эта информация связана с тем, как событие направляется через среду выполнения, и оно также полезно для понимания удостоверения и контекста события во время декодирования. В конечном итоге он отображается как часть [**\_ трассировки событий**](/windows/win32/api/evntrace/ns-evntrace-event_trace) или [**\_ записи события**](/windows/win32/api/evntcons/ns-evntcons-event_record) для потребителя.

## <a name="event-metadata"></a>Метаданные события

Путь к метаданным события отличается в зависимости от используемой технологии трассировки и является одним из самых крупных факторов при сравнении каждой технологии.

### <a name="mof"></a>MOF

Метаданные события создаются вручную создателем события в виде специальной схемы MOF в MOF-файле. Созданная схема должна соответствовать полезной нагрузке, которая заносится в журнал, чтобы событие было правильно декодировано потребителями. Для использования декодеров событий необходимо, чтобы MOF-файл был зарегистрирован в системе с помощью [mofcomp.exe](../wmisdk/mofcomp.md). Дополнительные сведения о публикации схем MOF см. в статье [Публикация схемы событий для классического поставщика](publishing-your-event-schema-for-a-classic-provider.md).

### <a name="wpp"></a>ПУБЛИКАЦИИ

Метаданные события создаются автоматически и сохраняются в файле. pdb путем tracewpp.exe в процессе сборки. Эти метаданные впоследствии можно извлечь в виде автономного файла ТМФ, используя tracepdb.exe. Для декодеров событий обычно требуется файл. pdb или. ТМФ. Дополнительные сведения о tracepdb.exe см. в разделе Общие сведения о [трацепдб](/windows-hardware/drivers/devtest/tracepdb-overview)и дополнительные сведения о tracewpp.exe см. в разделе [задача трацевпп](/windows-hardware/drivers/devtest/tracewpp-task).

### <a name="manifest-based"></a>На основе манифеста

Определения событий создаются в man-файле. Манифесты событий выполняются с помощью компилятора манифеста ([mc.exe](../wes/message-compiler--mc-exe-.md)), создавая заголовки, необходимые для компиляции источника, а также несколько двоичных файлов ресурсов bin. Затем эти файлы ресурсов должны быть скомпилированы в виде ресурсов в двоичный файл, а результирующий двоичный файл, который планируется декодировать события из этого поставщика на основе манифеста, будет помещен в систему. Кроме того, манифест должен быть установлен в системе с помощью [wevtutil.exe](../wes/windows-event-log-tools.md) что самое важное, атрибуты **ресаурцефиленаме** и **мессажефиленаме** в XML-элементе provider в установленном манифесте события должны правильно определять полный абсолютный путь к двоичному файлу, в который были помещены файлы ресурсов. Обратите внимание, что эти пути могут быть перезаписаны во время установки манифеста с помощью параметров wevtutil.exe/РФ и/МФ.. Система, которая неправильно и полностью выполнила эти действия, не сможет декодировать события от этого поставщика. Поэтому для декодеров событий требуется установленный манифест и двоичный файл со связанными ресурсами, установленными в расположении, указанном в пути к ресурсам и файлам сообщений. Дополнительные сведения о публикации схем на основе манифеста см. в статье [Публикация схемы событий для поставщика на основе манифеста](publishing-your-event-schema-for-a-manifest-base-provider.md).

### <a name="tracelogging"></a>TraceLogging

Все события Трацелоггинг являются самоописывающимися. Метаданные события, необходимые для декодирования события, автоматически создаются и передаются вместе с полезными данными в компактном двоичном формате. Декодерам событий требуется только событие Трацелоггинг и понимание формата метаданных Трацелоггинг.

## <a name="configuring-tdh-for-decoding"></a>Настройка TDH для декодирования

Существует множество средств декодирования. Однако рекомендуется использовать TDH там, где это возможно, так как он декодирует все технологии трассировки с помощью унифицированного API. В зависимости от типа трассировки, которую вы хотите декодировать, TDH может потребовать явной настройки.

### <a name="mof"></a>MOF

TDH использует данные для декодирования MOF, зарегистрированные в системе, с помощью mofcomp.exe. Дополнительные сведения см. в статье [Публикация схемы событий для классического поставщика](publishing-your-event-schema-for-a-classic-provider.md).

### <a name="wpp"></a>ПУБЛИКАЦИИ

TDH должен указывать на PDB-файл или связанный. ТМФ для поставщика WPP, который вы пытаетесь декодировать. Это можно выполнить путем вызова [**тдхсетдекодингпараметер**](/windows/desktop/api/Tdh/nf-tdh-tdhsetdecodingparameter). В противном случае механизм декодирования будет возвращаться \_ \_ к пути поиска в формате трассировки переменной среды \_ .

### <a name="manifest-based"></a>На основе манифеста

TDH использует все поставщики на основе манифеста, зарегистрированные в системе, с помощью wevtutil.exe.

### <a name="tracelogging"></a>TraceLogging

Новейшие версии TDH автоматически обнаруживают и декодируются события Трацелоггинг без дополнительных действий.

 

 
