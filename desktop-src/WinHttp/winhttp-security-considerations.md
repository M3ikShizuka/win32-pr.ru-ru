---
description: 'Следующие вопросы безопасности применяются к приложениям, использующим WinHTTP: сертификаты сервера проверяются только один раз за сеанс.'
ms.assetid: 287e85ed-a324-4785-872a-26e4ab37986d
title: Вопросы безопасности WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b80d813fa5b50cb9c880598d3187c697412d1dab1d7fdd80b4507d17d03eff6a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119955694"
---
# <a name="winhttp-security-considerations"></a>Вопросы безопасности WinHTTP

Следующие вопросы безопасности относятся к приложениям, использующим WinHTTP.

-   **Сертификаты сервера проверяются только один раз за сеанс.** После проверки сертификата он остается действительным в течение текущего сеанса. Если отпечаток сертификата совпадает, что означает, что сертификат не изменился, сертификат будет продолжать проверяться повторно. В результате все изменения в условиях проверки с помощью флагов протокол, отзыв или сертификат-ошибка-игнорировать не вступают в силу после проверки сертификата. Чтобы принудительно применить это изменение немедленно, необходимо завершить текущий сеанс и запустить новый. Аналогично, срок действия сертификата в течение сеанса может быть обнаружен только в том случае, если само приложение периодически проверяет сервер сертификатов на получение данных об истечении срока действия.
-   **Автоматический прокси включает загрузку и выполнение скриптов.** Поддержка автоматического обнаружения прокси-сервера включает в себя обнаружение через DHCP или DNS, загрузку и выполнение скриптов прокси-сервера, таких как сценарии Java. Чтобы обеспечить более высокий уровень безопасности, приложение должно избегать передачи флага **запуска автоматического \_ прокси WinHTTP \_ \_** , чтобы автоматическое обнаружение прокси-сервера было инициировано вне процесса. Несмотря на это, служба WinHTTP пытается запустить скрипт автоматического прокси-сервера по умолчанию, если сценарий не работает должным образом. Если вы считаете, что данное резервное поведение является неприемлемым, отключите поведение отката с помощью флага **\_ запуска "автопрокси WinHTTP \_ \_ \_ только обработка** ".
-   **\_ \_ Функции обратного вызова состояния WinHTTP должны быстро возвращаться.** При написании одной из этих функций ответного вызова Будьте внимательны, чтобы они не блокировались. Например, ни обратный вызов, ни любая функция, которая вызывает, не должна отображать диалоговое окно пользователя или ожидать события. Если функция [*\_ \_ обратного вызова состояния WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) блокируется, она влияет на внутреннее планирование WinHTTP и приводит к отказу других запросов в пределах того же процесса.
-   **\_ \_ Функции обратного вызова состояния WinHTTP должны быть повторными.** При написании обратного вызова Избегайте использования статических переменных или других конструкций, которые не являются ненадежными при перевходе, и избегайте вызова других функций, которые не являются повторными.
-   **Если возможна асинхронная операция, передайте значения NULL для параметров OUT.** Если асинхронная операция включена путем регистрации функции обратного вызова, всегда передавать значения **null** для таких параметров out в *качестве лпдвдатааваилабле* для [**винхттпкуеридатааваилабле**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpquerydataavailable), *лпдвбитесреад* для [**WinHttpReadData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreaddata)или *лпдвбитесвриттен* для [**WinHttpWriteData**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpwritedata). В некоторых обстоятельствах вызывающий поток завершается до завершения операции, а если выходные параметры не **равны NULL**, функция может завершить запись в память, которая уже была освобождена.
-   **Проверка подлинности паспорта не гарантируется.** Любая схема проверки подлинности на основе файлов cookie уязвима для атак. Паспорт версии 1,4 основан на файлах cookie и, следовательно, подвержен уязвимостям, связанным с любым файлом cookie или схемой проверки подлинности на основе форм. Поддержка паспорта отключена по умолчанию в WinHTTP; его можно включить с помощью [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Обычная проверка подлинности должна использоваться только через безопасное соединение.** Обычная проверка подлинности, которая отправляет имя пользователя и пароль в виде открытого текста (см. [RFC 2617](https://www.ietf.org/rfc/rfc2617.txt)), следует использовать только через зашифрованные соединения SSL или TLS.
-   **Установка для политики автоматического входа значения "низкая" может представлять риск.** Если для политики автоматического входа задано значение низкий, для проверки подлинности на любом сайте можно использовать учетные данные входа пользователя. Однако не рекомендуется использовать проверку подлинности на ненадежных сайтах.
-   **SSL-соединения 2,0 не используются, если явно не включено.** Протоколы безопасности TLS 1,0 и SSL 3,0 считаются более безопасными, чем SSL 2,0. По умолчанию WinHTTP запрашивает TLS 1,0 или SSL 3,0 при согласовании SSL-соединения, а не SSL 2,0. Поддержку SSL 2,0 в WinHTTP можно включить только путем вызова [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Необходимо явно запросить проверку отзыва сертификатов.** По умолчанию при выполнении проверки подлинности сертификата служба WinHTTP не проверяет, отозван ли сертификат сервера. Проверку отзыва сертификатов можно включить с помощью [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption).
-   **Приложения должны гарантировать, что сеанс сопоставляется с одним удостоверением.** Сеанс WinHTTP должен сопоставляться с одним и только одним удостоверением. то есть сеанс WinHTTP используется для управления Интернет-работой одного пользователя, прошедшего проверку подлинности, или группы анонимных пользователей. Однако поскольку служба WinHTTP не применяет это сопоставление автоматически, приложение должно предпринять шаги, чтобы убедиться в том, что участвует только одно удостоверение.
-   **Операции с обработчиком запросов WinHTTP должны быть синхронизированы.** Например, приложение не должно закрывать обработчик запроса в одном потоке, пока другой поток отправляет или получает запрос. Чтобы завершить асинхронный запрос, закройте обработчик запроса во время уведомления обратного вызова. Чтобы завершить синхронный запрос, закройте этот обработчик при возвращении предыдущего вызова WinHTTP.
-   **Файлы трассировки содержат конфиденциальную информацию.** Файлы трассировки защищаются с помощью списков Access-Control (ACL), поэтому доступ к одному из них обычно может осуществлять только локальный администратор или учетная запись пользователя, создавшая его. Старайтесь не нарушить безопасность файлов трассировки при любом несанкционированном доступе.
-   **Старайтесь не передавать конфиденциальные данные через** [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption). Не указывайте имя пользователя, пароль или другие учетные данные для **винхттпсетоптион** , так как вы не контролируете используемую схему проверки подлинности, а конфиденциальные данные могут быть неожиданно отправлены в виде открытого текста. Для настройки учетных данных используйте [**винхттпкуеряуссчемес**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpqueryauthschemes) и **винхттпсеткредентиалс** вместо **винхттпсетоптион** .
-   **Автоматическое перенаправление может представлять угрозу безопасности.** По умолчанию перенаправление (сообщение 302) пройдет автоматически даже для записи. Чтобы избежать возможного ложного перенаправления, приложения должны отключить автоматическое перенаправление или перенаправление монитора в обратных вызовах при отправке конфиденциальной информации.
-   **Определяемые пользователем заголовки передаются при неизменном перенаправлении.** Определяемые пользователем заголовки, например файлы cookie, добавленные с помощью **винхттпаддрекуессеадерс**, передаются по перенаправлениям без изменения, а заголовки, формируемые WinHTTP, обновляются автоматически. Если пересылка определяемого пользователем заголовка между перенаправлениями создает угрозу безопасности, используйте обратный вызов [*\_ \_ обратного вызова состояния WinHTTP*](/windows/win32/api/winhttp/nc-winhttp-winhttp_status_callback) с **\_ состоянием обратного вызова WinHTTP \_ \_** , чтобы изменить заданный заголовок при каждом перенаправлении.
-   **Служба WinHTTP не передается в синхронном режиме.** Так как WinHTTP не перенадается в синхронном режиме, не запланируйте асинхронные вызовы процедур (APC), которые могут вызывать WinHTTP в потоке приложения, выполняемом внутри функции WinHTTP. В синхронном режиме WinHTTP выполняет "ожидание с предупреждением", и если ожидающий поток предварительно виртуальная машина прервана для выполнения APC, а затем снова введет WinHTTP, то внутреннее состояние WinHTTP может быть повреждено.

 

 
