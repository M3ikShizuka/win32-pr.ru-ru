---
description: Чтобы упростить настройку параметров прокси-сервера, WinHTTP 5,1 реализует протокол автоматического обнаружения веб-прокси (WPAD), также известный как автопрокси.
ms.assetid: f766f37b-a1aa-420f-ac3b-d03485630d88
title: Поддержка автопрокси WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 26584bd0b1809f3866ed42adc7198275f40f991c
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127066617"
---
# <a name="winhttp-autoproxy-support"></a>Поддержка автопрокси WinHTTP

Чтобы упростить настройку параметров прокси-сервера, WinHTTP 5,1 реализует протокол автоматического обнаружения веб-прокси (WPAD), также известный как автопрокси.

## <a name="overview-of-autoproxy"></a>Общие сведения об автопрокси

Приложения и компоненты, использующие WinHTTP для отправки HTTP-запросов, должны обеспечить правильную настройку прокси-сервера. Если у клиента нет прямого подключения к Интернету, HTTP-запрос обычно должен отправляться через сервер веб-прокси, соединяющий локальную сеть клиента с Интернетом (например, это часто случается для клиентов в корпоративной локальной сети). Для серверных приложений конфигурация прокси-сервера обычно управляется администратором сервера с помощью служебной программы ProxyCfg.exe WinHTTP. Администратор сервера знает имя прокси-сервера заранее и использует ProxyCfg.exe для записи этого параметра в реестре, где служба WinHTTP может его найти. Однако требуется, чтобы пользователи клиентского рабочего стола вручную настроили параметры прокси-сервера WinHTTP. Конечному пользователю может быть неизвестно имя прокси-сервера; необходимость запуска программы ProxyCfg.exe может быть недоступна для Организации. Для поддержки хорошего взаимодействия с пользователем веб-клиентское приложение должно определять конфигурацию прокси-сервера без вмешательства пользователя.

Чтобы упростить настройку параметров прокси-сервера для приложений на базе WinHTTP, служба WinHTTP теперь реализует [протокол автоматического обнаружения веб-прокси (WPAD)](https://tools.ietf.org/html/draft-ietf-wrec-wpad-01), который часто называют *автопрокси*. Это тот же протокол, который реализуется веб-браузерами для автоматического обнаружения конфигурации прокси, не требуя от пользователя указывать прокси-сервер вручную. эта функция доступна начиная с версии WinHTTP 5,1 в Windows 2000 с пакетом обновления 3 (sp1) Windows XP с пакетом обновления 1 (sp1) и Windows Server 2003. Обратите внимание, что хотя Microsoft Internet Explorer и Microsoft WinHTTP поддерживают WPAD, спецификация никогда не выходит за пределы "Интернет-черновиков" и срок ее действия истекает 2001 мая.

Протокол WPAD работает следующим образом.

1.  При использовании сетевых протоколов DHCP и/или DNS происходит обнаружение URL-адреса файла автоматической настройки прокси-сервера (PAC). URL-адрес определяет файл PAC в локальной сети клиента. WinHTTP поддерживает только URL-адреса PAC "http:" и "https:"; Например, он не поддерживает URL-адреса "file:".
2.  Файл PAC загружается и при необходимости кэшируется на клиентском компьютере. PAC-файл — это исполняемый скрипт, создающий список из одного или нескольких прокси-серверов по заданному имени и URL-адресу целевого узла. WinHTTP поддерживает только файлы PAC на основе ECMAScript.
3.  В каждом HTTP-запросе выполняется код скрипта PAC с именем узла и URL-адресом запроса HTTP, переданным в качестве параметров. Службы WinHTTP предполагают, что код сценария PAC содержит функцию с именем **финдпроксифорурл** в следующем виде:
4.  ``` syntax
    FindProxyForURL( url, host );
    ```

    Эта функция вычислит список из одного или нескольких прокси-серверов, которые могут использоваться клиентом HTTP для передачи запроса. Если сценарий PAC определяет, что HTTP-клиент может связаться с целевым сервером напрямую, не используя прокси-сервер, он указывает, что используется специальное возвращаемое значение.

## <a name="autoproxy-topics"></a>Разделы по автопрокси

-   [Функции автопрокси WinHTTP](winhttp-autoproxy-api.md)
-   [Обнаружение без файла автоматической настройки](discovery-without-an-auto-config-file.md)
-   [Проблемы с автопрокси в WinHTTP](autoproxy-issues-in-winhttp.md)
-   [Настройка конфигураций прокси-сервера WinInet в WinHTTP](setting-wininet-proxy-configurations-in-winhttp.md)
-   [Кэш автопрокси](autoproxy-cache.md)
-   [Расширения IPv6 для формата файла автоматической настройки Navigator](ipv6-extensions-to-navigator-auto-config-file-format.md)

 

 



