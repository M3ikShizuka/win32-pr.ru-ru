---
description: в этом разделе объясняется использование средства настройки прокси-сервера служб Microsoft Windows HTTP (WinHTTP) &\# 0034; ProxyCfg.exe&\# 0034;.
ms.assetid: f96adf59-59be-414e-ad6f-9eac05f4b975
title: Netsh.exe и ProxyCfg.exe прокси Средства настройки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ef64c952db59fb4709614c498b4d9c732403798e
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122885823"
---
# <a name="netshexe-and-proxycfgexe-proxy-configuration-tools"></a>Netsh.exe и ProxyCfg.exe прокси Средства настройки

* * Windows Vista и Windows Server 2008: * *

ProxyCfg.exe не рекомендуется к использованию. Он заменяется командами [ winhttpNetsh.exe](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731131(v=ws.10)) .

в этом разделе объясняется использование средства настройки прокси-сервера [служб Microsoft Windows HTTP (WinHTTP)](about-winhttp.md) "ProxyCfg.exe".

существует два способа доступа к серверам http и протоколам HTTPS через прокси с помощью служб Microsoft Windows HTTP Services (WinHTTP). Сначала можно указать параметры прокси-сервера в приложении WinHTTP. Во-вторых, можно указать параметры прокси по умолчанию вне приложения с помощью служебной программы настройки прокси-сервера, расположенной в каталоге% WINDIR% \\ System32.

Вы можете программно задать данные прокси-сервера в приложении или скрипте. Если вы пишете приложение с помощью API WinHTTP, воспользуйтесь одним из следующих двух методов изменения параметров прокси-сервера.

-   Используйте функцию [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) . Укажите тип доступа во втором параметре, имя прокси-сервера в третьем параметре и список пропусков в четвертом параметре. В следующем примере показано, как можно использовать функцию [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) для задания данных прокси-сервера.

    ``` syntax
    hSession = WinHttpOpen( L"WinHTTP Example/1.0",  
                            WINHTTP_ACCESS_TYPE_NAMED_PROXY,
                            L"proxy_name", 
                            L"<local>", 
                            0);
    ```

-   Используйте функцию [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) . Флаг [**\_ \_ прокси-сервера параметра WinHTTP**](option-flags.md) позволяет указать параметры прокси-сервера с помощью структуры [**\_ \_ сведений о прокси-сервере WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) . В следующем примере кода показано, как можно использовать функцию [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) для задания данных прокси-сервера.

    ``` syntax
    WINHTTP_PROXY_INFO proxyInfo;
    proxyInfo.dwAccessType = WINHTTP_ACCESS_TYPE_NAMED_PROXY;
    proxyInfo.lpszProxy = L"proxy_name";
    proxyInfo.lpszProxyBypass = L"<local>";
        
    // Set the proxy information for this session.
    WinHttpSetOption( hSession, 
                      WINHTTP_OPTION_PROXY, 
                      &proxyInfo, 
                      sizeof(proxyInfo));
    ```

При написании скрипта или приложения с помощью объекта [**WinHttpRequest**](winhttprequest.md) используйте следующую методику для изменения параметров прокси-сервера.

-   Используйте метод [**сетпрокси**](iwinhttprequest-setproxy.md) . Укажите тип доступа в первом параметре, имя прокси-сервера во втором параметре и список пропусков в третьем параметре. В следующем примере показано, как можно использовать метод [**сетпрокси**](iwinhttprequest-setproxy.md) в скрипте для задания данных прокси-сервера.

    ``` syntax
    WinHttpReq.SetProxy( HTTPREQUEST_PROXYSETTING_PROXY, 
                         "proxy_server:80", 
                         "*.microsoft.com");
    ```

Чтобы указать параметры по умолчанию и исключить необходимость использования метода [**сетпрокси**](iwinhttprequest-setproxy.md) или функции [**винхттпсетоптион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) , используйте служебную программу настройки прокси-сервера. С помощью этой служебной программы можно указать, что приложение получает доступ к сети напрямую через прокси-сервер или через сочетание прямого и прокси-доступа, указав список обхода. При использовании API WinHTTP средство настройки прокси-сервера определяет параметры только при передаче флага **\_ \_ \_ по умолчанию для типа доступа WinHTTP** в API [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) . Объект [**WinHttpRequest**](winhttprequest.md) по умолчанию использует параметры средства настройки прокси-сервера.

Параметры прокси-сервера для WinHTTP не являются параметрами прокси-сервера для Microsoft Internet Explorer. параметры прокси-сервера для WinHTTP нельзя настроить на панели управления Microsoft Windows. Использование служебной программы настройки прокси-сервера WinHTTP не изменяет параметры, используемые для Internet Explorer.

> [!Note]  
> Если попытаться открыть и отправить HTTP-запрос с помощью WinHTTP, а параметры прокси-сервера неверны, возникает ошибка.

 

## <a name="command-line-parameters"></a>Параметры командной строки

В следующей таблице перечислены параметры командной строки, доступные для использования с инструментом ProxyCfg.exe.



| Параметр | Описание                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| нет      | Если параметры не указаны, отображаются текущие параметры прокси-сервера WinHTTP.                                                                                                                                                                                                                                                                                                                                               |
| ?         | Откроется справочная информация.                                                                                                                                                                                                                                                                                                                                                                                                    |
| d         | Указывает, что приложения WinHTTP обращаются напрямую к сети без прокси-сервера.                                                                                                                                                                                                                                                                                                                                                 |
| p         | Указывает прокси-сервер. Можно также указать необязательный список серверов, доступ к которым осуществляется без использования прокси-сервера.                                                                                                                                                                                                                                                                                                                   |
| u         | Указывает, что приложения WinHTTP используют параметры прокси-сервера текущего пользователя для Internet Explorer. Этот параметр не работает, если Internet Explorer автоматически обнаруживает параметры прокси-сервера или если он использует URL-адрес автоматической настройки для установки сведений о прокси-сервере.                                                                                                                                                      |
| i         | Указывает, что приложения WinHTTP используют параметры прокси-сервера текущего пользователя для Internet Explorer. Работает только в том случае, если ProxyCfg.exe ранее не использовался. Если установлен ProxyCfg.exe, укажите, что параметр командной строки "u" использует параметры вручную. Этот параметр не работает, если Internet Explorer автоматически обнаруживает параметры прокси-сервера или использует URL-адрес автоматической настройки для установки сведений о прокси-сервере. |



 

Вы можете указать учетные записи-посредники в строке, разделенной пробелами. Списки прокси-серверов могут содержать номер порта, который используется для доступа к прокси-серверу. Чтобы получить список прокси-сервера для конкретного протокола, строка должна соответствовать формату, &lt; Protocol &gt; = https://<имя прокси-сервера \_>. Допустимые протоколы — HTTP и HTTPS. Например, чтобы получить список прокси-сервера HTTP, допустима строка HTTP = https://http\_proxy\_name:80 , где HTTP \_ -прокси- \_ имя — это имя прокси-сервера, а 80 — номер порта, который необходимо использовать для доступа к прокси-серверу. Если прокси-сервер использует номер порта по умолчанию для этого протокола, можно опустить номер порта. Если имя прокси-сервера указано отдельно, его можно использовать в качестве прокси-сервера по умолчанию для любых протоколов, у которых нет указанного прокси-сервера. Например, HTTP = https://http\_proxy другой прокси-сервер \_ использует \_ прокси HTTP для любых операций HTTP, а протокол HTTPS использует прокси-сервер с именем другой \_ прокси-сервер.

В списке обхода прокси-сервера можно перечислить локально известные имена узлов или IP-адреса. Этот список может содержать подстановочные знаки, например " \* ", что приводит к тому, что приложение обходит прокси-сервер для адресов, соответствующих указанному шаблону, например " \* . Microsoft.com" или " \* . org". Подстановочные знаки должны быть самыми левыми символами в списке. Например, "AAA. \* " не поддерживается. Чтобы вывести несколько адресов и имен узлов, разделите их пробелами или точками с запятой в строке обхода прокси-сервера. При указании &lt; локального &gt; макроса функция обходит любое имя узла, которое не содержит точку.

> [!WARNING]
> После выполнения Proxycfg.exe вы не сможете восстановить предыдущие параметры прокси-сервера. Однако можно полностью удалить параметры прокси-сервера.

 

## <a name="usage"></a>Использование

Чтобы использовать средство настройки прокси-сервера, откройте окно командной строки и запустите служебную программу настройки прокси-сервера с соответствующими параметрами. В следующем разделе приведены примеры синтаксиса.

## <a name="example-syntax"></a>Пример синтаксиса

### <a name="example-1-use-a-proxy-only-for-external-resources"></a>Пример 1. использование прокси-сервера только для внешних ресурсов

Ниже приведен наиболее распространенный пример использования Proxycfg.exe. Эта команда указывает, что доступ к серверам HTTP и HTTPS осуществляется через прокси-сервер с именем "прокси- \_ сервер", за исключением имен узлов, которые не содержат точки.

**proxycfg-p прокси- \_ сервер " &lt; локальный &gt; "**

### <a name="example-2-use-a-proxy-for-all-resources"></a>Пример 2. использование прокси-сервера для всех ресурсов

В следующем примере указывается, что доступ к серверам HTTP и HTTPS осуществляется через прокси-сервер с именем "прокси- \_ сервер". Список обхода не указан.

**proxycfg-p прокси- \_ сервер**

### <a name="example-3-use-a-different-proxy-for-secure-resources"></a>Пример 3. Использование другого прокси-сервера для защиты ресурсов

В следующем примере указывается, что доступ к серверам HTTP осуществляется через прокси-сервер HTTP, \_ а серверы HTTPS — через \_ прокси-сервер HTTPS. Сайты локальной интрасети и любой сайт в \* домене. Microsoft.com обходят прокси-сервер.

**proxycfg-p "HTTP = HTTP \_ прокси HTTPS = HTTPS \_ proxy" " &lt; Local &gt; ; \* . microsoft.com "**

## <a name="removing-proxycfgexe"></a>Удаление ProxyCfg.exe

После использования средства настройки прокси-сервера восстановить исходные параметры прокси-сервера нельзя. Однако при необходимости можно удалить параметры реестра, создаваемые служебной программой. Чтобы удалить записи реестра, создаваемые ProxyCfg.exe, необходимо удалить значение **винхттпсеттингс** из следующего раздела реестра.

**HKey \_ \_** \\ **программное обеспечение** локального компьютера \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Internet Параметры** \\ **connections** \\ **винхттпсеттингс**

При удалении значения *винхттпсеттингс* удаляются все конфигурации прокси-сервера.

## <a name="proxycfgexe-and-authentication"></a>ProxyCfg.exe и проверка подлинности

Служебная программа настройки прокси-сервера задает политику проверки подлинности по умолчанию. Так как не следует выполнять проверку подлинности NTLM с недоверенными узлами, проверка подлинности NTLM выполняется автоматически с узлами в списке обхода прокси-сервера. Если прокси-сервер отсутствует, можно по-прежнему использовать ProxyCfg.exe для указания списка обхода узлов, которым вы доверяете для выполнения проверки подлинности NTLM. При использовании ProxyCfg.exe для этой цели требуется имя прокси-сервера, но вместо действительного имени прокси-сервера можно использовать любую допустимую строку.

Дополнительные сведения о политике автоматического входа в систему см. в разделе [Автоматическая политика входа в систему](authentication-in-winhttp.md).

 

 
