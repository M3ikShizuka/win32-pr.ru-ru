---
description: Если файл автоматической конфигурации прокси-сервера не был развернут в локальной сети, WinHttpGetProxyForUrl не сможет найти прокси-сервер.
ms.assetid: a170e63a-8586-47df-af5e-4ee3621795b2
title: Обнаружение без файла автоматической настройки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b6a5ec281c2ef74e2a377cecbd30f16cbc49bd79
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127462494"
---
# <a name="discovery-without-an-auto-config-file"></a>Обнаружение без файла автоматической настройки

Если файл автоматической конфигурации прокси-сервера не был развернут в локальной сети, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) не сможет найти прокси-сервер. В случае сбоя **WinHttpGetProxyForUrl** существует несколько возможных стратегий отката для получения работоспособной конфигурации прокси-сервера в зависимости от среды выполнения. К ним относятся запросы настройки прокси-сервера через пользовательский интерфейс, необходимость сохранения конфигурации прокси-сервера в реестре с помощью служебной программы WinHTTP "ProxyCfg.exe" или с помощью [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) для проверки того, указан ли прокси-сервер в параметрах Internet Explorer.

Возможно, отсутствует файл автоматической настройки прокси-сервера, так как у клиента есть прямое подключение к Интернету, например через поставщика услуг Интернета, и не требуется прокси-сервер.

С другой стороны, может потребоваться прокси-сервер, но локальная сеть может не поддерживать WPAD. В этом случае конфигурация прокси-сервера должна быть получена от пользователя или находиться в другом месте на клиентском компьютере.

Приложение на базе WinHTTP, работающее в среде сервера среднего уровня, например в приложении COM+ или ASP, должно полагаться на администратора сервера, настроив конфигурацию прокси-сервера по умолчанию в реестре с помощью служебной программы "ProxyCfg.exe". Эти сведения о конфигурации по умолчанию можно получить с помощью функции [**винхттпжетдефаултпроксиконфигуратион**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetdefaultproxyconfiguration) или просто указав в вызове [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) флаг **\_ \_ \_ настройки типа доступа WinHTTP** .

С другой стороны, приложение WinHTTP, работающее на клиентском компьютере клиента, может попытаться проверить параметры прокси Internet Explorer. [**Винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) заполняет структуру [**\_ \_ \_ \_ \_ конфигурации прокси-сервера WinHTTP текущего**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) пользователя, используя параметры прокси Internet Explorer текущего пользователя для текущего активного подключения (коммутируемое подключение, VPN или локальная сеть). Такая конфигурация может указывать на то, что используется автоматическое обнаружение или может указываться URL-адрес для файла автоматической конфигурации прокси-сервера, или же он может указывать на действующий прокси-сервер или сочетание трех. Если эти сведения включают URL-адрес PAC или прокси-сервер, то приложение WinHTTP может использовать их.

Пример, в котором используются функции [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) и [**винхттпжетиепроксиконфигфоркуррентусер**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) , можно найти в примерах WinHTTP в пакете SDK для платформы.

 

 



