---
description: Кэш автопрокси
ms.assetid: 087104e8-ab38-4ba4-be70-23a5ea2bb130
title: Кэш автопрокси
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6d0492bec116bad8a82da0e961cf6d851d27c787
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127580675"
---
# <a name="autoproxy-cache"></a>Кэш автопрокси

Функция [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) выполняет поиск по запросу автопрокси для каждого запроса на основе указанного URL-адреса. Если возвращается несколько прокси-серверов, клиентские приложения должны протестировать каждый прокси перед отправкой запроса (Дополнительные сведения см. в разделе " [единственный прокси-сервер сейчас поддерживается](autoproxy-issues-in-winhttp.md) " в статье проблемы с автопрокси в WinHTTP). Сведения в этом разделе применяются к вызовам **WinHttpGetProxyForUrl** , когда клиент указывает автоматическое обнаружение прокси-сервера.

[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) при необходимости находит URL-адрес автопрокси и скачивает сценарий автопрокси с этого сайта. WinHttp использует скрипт автопрокси для нахождение прокси-серверов. URL-адрес автопрокси и скрипт автопрокси кэшируются для указанного сеанса. Для каждого сеанса кэшируются только один URL-адрес и сценарий для автопрокси. Как правило, скрипт и URL-адрес автопрокси кэшируются до тех пор, пока не изменится IP-адрес, связанный с компьютером. Если при вызове **WinHttpGetProxyForUrl** обнаружен новый IP-адрес, вызов попытается найти новый URL-адрес и скрипт для автопрокси-сервера и кэшировать результаты. В каждом сеансе должно быть разрешено только одного пользователя, чтобы кэшированные данные не были доступны другим пользователям на компьютере. Дополнительные сведения см. в статье [Общие сведения о сеансах WinHTTP](winhttp-sessions-overview.md).

Если служба вне процесса активна при вызове [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , кэшированный URL-адрес и скрипт для автопрокси доступны для всего компьютера. Однако если используется служба вне процесса и флаг **фаутологонифчалленжед** в структуре *паутопроксйоптионс* имеет значение true, то URL-адрес и сценарий для автопрокси не кэшируются. Поэтому вызов **WinHttpGetProxyForUrl** с набором элементов **фаутологонифчалленжед** , равным **true** , приводит к дополнительным операциям с дополнительной нагрузкой, которые могут повлиять на производительность. Для повышения производительности можно использовать следующие шаги.

**Для повышения производительности**

1.  Вызовите [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , указав для параметра фаутологонифчалленжед значение **false**. URL-адрес и скрипт для автопрокси кэшируются для будущих вызовов **WinHttpGetProxyForUrl**.
2.  Если шаг 1 завершается ошибкой, при **ошибке \_ \_ входа WinHTTP \_ возникла ошибка**, затем вызовите [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) , указав для члена **фаутологонифчалленжед** значение **true**.

 

 



