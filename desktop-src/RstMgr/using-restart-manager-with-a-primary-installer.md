---
title: Использование диспетчера перезапуска с основным установщиком
description: В следующей процедуре описывается, как с помощью диспетчера перезапуска завершить работу и перезапустить приложения и службы. При использовании диспетчера перезапуска с одним установщиком этот установщик также является основным установщиком, который управляет пользовательским интерфейсом.
ms.assetid: 8d2b4129-c595-4b11-9771-6dc953f4db40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 764086166fc895d44f1a555f453d2941487c5d999adfa8d38581a12f07c9c45c
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119010012"
---
# <a name="using-restart-manager-with-a-primary-installer"></a>Использование диспетчера перезапуска с основным установщиком

В следующей процедуре описывается, как с помощью диспетчера перезапуска завершить работу и перезапустить приложения и службы. При использовании диспетчера перезапуска с одним установщиком этот установщик также является основным установщиком, который управляет пользовательским интерфейсом.

**Использование диспетчера перезапуска с основным установщиком**

1.  Установщик вызывает функцию [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) для запуска сеанса диспетчера перезапуска и получения маркера сеанса и ключа.
2.  Установщик вызывает функцию [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) для регистрации ресурсов. Диспетчер перезапуска может использовать зарегистрированные ресурсы только для определения того, какие приложения и службы должны быть выключены и перезапущены. Все ресурсы, на которые может повлиять установка, должны быть зарегистрированы в сеансе. Ресурсы можно идентифицировать по имени файла, краткому имени службы или структуре [**\_ уникального \_ процесса RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) .
3.  Установщик вызывает функцию [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) для получения массива структур [**\_ \_ сведений о процессе RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) , в котором перечислены все приложения и службы, которые должны быть выключены и перезапущены.

    Если значение параметра *лпдвребутреасон* , возвращаемое функцией [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) , не равно нулю, диспетчеру перезапуска не удается освободить зарегистрированный ресурс при завершении работы приложения или службы. В этом случае для продолжения установки требуется завершение работы системы и перезапуск. Установщик должен запрашивать у пользователя действие, прекращать работу программ или служб или запланировать завершение работы и перезагрузку системы.

    Если значение параметра *лпдвребутреасон* , возвращаемое функцией [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) , равно нулю, установщик должен вызвать функцию [**рмшутдовн**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) . При этом службы и приложения, использующие зарегистрированные ресурсы, завершаются. Затем установщик должен выполнить системные изменения, необходимые для завершения установки. Наконец, установщик должен вызвать функцию [**рмрестарт**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) , чтобы диспетчер перезапуска мог перезапустить приложения, работа которых была завершена и которые были зарегистрированы для перезапуска.

4.  Установщик может использовать функцию [**рмаддфилтер**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) для предотвращения завершения или перезапуска определенных приложений и служб с помощью операций диспетчера перезапуска. Функция [**рмжетфилтерлист**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) возвращает список приложений и служб, для которых необходимо выполнить фильтрацию после завершения работы и перезапуска. Функция [**рмремовефилтер**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) удаляет фильтр.
5.  Установщик вызывает функцию [**рмендсессион**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) , чтобы закрыть сеанс диспетчера перезапуска.

Пример фрагмента кода, демонстрирующий запуск и использование сеанса диспетчера перезапуска с помощью основного установщика и последующего присоединения дополнительного установщика к существующему сеансу, см. в разделе [Использование диспетчера перезапуска с дополнительным установщиком](using-restart-manager-with-a-secondary-installer.md).

 

 




