---
title: Рекомендации для служб
description: Службы должны соблюдать эти рекомендации, чтобы диспетчер перезапуска мог завершить работу и перезапустить службы, если это необходимо для установки обновлений. Приложения могут использовать рекомендации, описанные в разделе рекомендации для приложений.
ms.assetid: 69a98f82-71bb-4780-8a3f-294cc5629900
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51374c0a4c6fc561b8259aadf15e3d5487e12483
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070345"
---
# <a name="guidelines-for-services"></a>Рекомендации для служб

Службы должны соблюдать эти рекомендации, чтобы диспетчер перезапуска мог завершить работу и перезапустить службы, если это необходимо для установки обновлений. Приложения могут использовать рекомендации, описанные в разделе [рекомендации для приложений](guidelines-for-applications.md).

-   Службы должны быть способны завершить работу и перезапуститься с помощью [диспетчера управления службами](/windows/desktop/Services/service-control-manager) без перезагрузки системы. Исключениями из этого правила являются критические системные процессы, выполняемые в контексте lsass.exe или services.exe.
-   Диспетчер перезапуска учитывает зависимости служб. После завершения работы и перезапуска службы зависимые службы будут выключены и перезапущены.
-   Службы должны указывать интервал восстановления и сбросить период в [диспетчере управления службами (SCM)](/windows/desktop/Services/service-control-manager). Интервал восстановления — это время (в мс) после последней ошибки, которое SCM ожидает перед выполнением действия восстановления. Период сброса — это время в секундах после последнего сбоя, которое диспетчер управления службами ожидает до сброса счетчика ошибок в 0. Службы могут использовать функцию [**ChangeServiceConfig2**](/windows/desktop/api/winsvc/nf-winsvc-changeserviceconfig2a) для изменения параметров конфигурации.

    [Критические службы](critical-system-services.md) должны использовать следующие параметры восстановления, чтобы указать, что служба должна перезапуститься через одну минуту после первого сбоя при перезапуске службы, перезапуститься через две минуты после второй ошибки и перезагрузить компьютер через одну минуту после третьего сбоя. После 300 секунд счетчик ошибок сбрасывается в 0.

    <dl> Действия восстановления: Restart/60000/Restart/120000/reboot/60000 & сброс = 300  
    </dl>

    [Критические службы](critical-system-services.md) должны запускаться до некритических служб. Службы, которые не являются важными службами, должны использовать следующие параметры восстановления, чтобы указать, что служба должна перезапуститься через две минуты после первого сбоя при перезапуске службы. После второй ошибки служба не перезапускается, и в этом случае необходимо иметь права администратора. После 900 секунд счетчик ошибок сбрасывается в 0.

    <dl> Действия восстановления: Restart/120000/Restart/300000/None/0 & Reset = 900  
    </dl>

 

 