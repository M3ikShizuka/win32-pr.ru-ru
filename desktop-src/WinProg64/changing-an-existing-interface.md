---
title: Изменение существующего интерфейса
description: Везде, где это возможно, реализуйте новый интерфейс для приложения, а не вносите изменения в существующий.
ms.assetid: 29845cf5-445c-403d-b298-d4e07c3536b7
keywords:
- изменение существующих интерфейсов, 64-разрядное программирование Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 51a656ee768dcc2e88725d2cff0ddc5604fd771f
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127056260"
---
# <a name="changing-an-existing-interface"></a>Изменение существующего интерфейса

Везде, где это возможно, реализуйте новый интерфейс для приложения, а не вносите изменения в существующий. Если не удается изменить существующий интерфейс, следует использовать новые типы данных только в новых методах. Внедрение нового типа данных или изменение существующего типа является наиболее распространенным источником проблем совместимости. Модель времени выполнения RPC предполагает, что получающее приложение знает о типах получаемых данных, поэтому данные помещаются в сеть без универсального описания данных. Когда получатель принимает тип данных, отличный от того, который отправитель поместит на канал передачи, заглушка вызывает исключение (или передача завершается неудачно другим способом).

Интерфейс RPC определяется его UUID и основными и дополнительными номерами версий. При изменении существующего интерфейса следует добавить новые методы в конце интерфейса и изменить дополнительный номер версии. Если вы добавляете методы в любое другое место или вносите другие изменения в интерфейс, вам также потребуется изменить основной номер версии.

В реальной ситуации бывают случаи, когда невозможно изменить даже дополнительный номер версии, так как новый клиент не сможет взаимодействовать со старым сервером, и вы не сможете обновить сервер. Время выполнения RPC вызывает исключение RPC \_ \_ прокнум \_ вне \_ \_ допустимого диапазона, когда клиент вызывает метод за пределами, заданными для его интерфейса с сервером. Для решения этой проблемы необходимо оставить номера версий без изменений и написать код клиента для корректной работы с этим исключением. Клиент может устранить его производительность, например, или каким-либо способом подходит для вашего приложения.

Существует аналогичный обходной путь для одного особого случая изменения типа данных в существующем методе. Если имеется [**объединение**](/windows/desktop/Midl/union) , ветви которого являются указателями и не имеет ветви по умолчанию для нераспознаваемых типов, можно добавить новую ветвь, использующую новый тип данных. При этом размер структуры данных не изменится. Когда клиент обращается к новому серверу, он может использовать новый тип данных. Однако если клиент обращается к старому серверу, то во время выполнения будет вызван \_ \_ Недопустимый тег исключения RPC S \_ . Опять же, вам потребуется написать клиентский код для правильной обработке этого исключения.

Интерфейс DCOM определяется по его идентификатору GUID. В DCOM интерфейсы считаются неизменяемыми, и вы можете вносить изменения только путем создания нового интерфейса, который наследует от старого. Эти правила гарантируют, что клиенты и серверы останутся совместимыми.

 

 