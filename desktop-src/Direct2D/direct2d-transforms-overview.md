---
title: Общие сведения о классах Transform
description: представляет API преобразования Microsoft Direct2D для Windows 7. Direct2D позволяет разработчикам Win32 выполнять двумерные преобразования графики.
ms.assetid: eea8177d-c19e-4972-a9a6-ad5d541b090f
keywords:
- Direct2D, общие сведения о преобразованиях
- Direct2D, системы координат
- Direct2D, целевые объекты отрисовки
- Direct2D, 2-D преобразования
- двумерные преобразования
- преобразования, о
- преобразования, целевые объекты отрисовки
- преобразования, объекты
- целевые объекты рендеринга, преобразования
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 80f2fad970af1d231adab691ad9345377c585b839053625ad49b3d8f7a9e203a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119833110"
---
# <a name="transforms-overview"></a>Общие сведения о классах Transform

В этом разделе рассматриваются основы преобразований Direct2D и приведены примеры различных преобразований. Он содержит следующие компоненты:

-   [Что такое преобразование Direct2D?](#what-is-a-direct2d-transform)
-   [Direct2D координатное пространство](#the-direct2d-coordinate-space)
-   [Создание матриц преобразования](#creating-transformation-matrices)
-   [Преобразование целевых объектов отрисовки](#rendering-target-transforms)
-   [Преобразования кистей](#brush-transforms)
-   [Преобразования геометрии](#geometry-transforms)
-   [Влияние преобразования целевого объекта прорисовки на клипы](#how-a-render-target-transform-affects-clips)
-   [Сводка](#summary)
-   [Связанные темы](#related-topics)

## <a name="what-is-a-direct2d-transform"></a>Что такое преобразование Direct2D?

Преобразование определяет способ отображения точек объекта из одного пространства координат в другое или из одной позиции в другую в пределах одного пространства координат. Это сопоставление описывается матрицей преобразования, определенной как коллекция из трех строк с тремя столбцами значений FLOAT, как показано в следующей таблице.



|    &nbsp;       |       &nbsp;    |  &nbsp; |
|-----------------|-----------------|-----|
| M11Default: 1,0 | M12Default: 0,0 | 0,0 |
| M21Default: 0,0 | M22Default: 1,0 | 0,0 |
| M31OffsetX: 0,0 | M32OffsetY: 0,0 | 1.0 |



 

В этой матрице члены M11, M12, M21 и M22 определяют линейное преобразование, которое может масштабировать, поворачивать или наклонять объект. элементы Оффсеткс и Offset определяют перевод, применяемый после выполнения линейного преобразования. Для аффинных преобразований значения в третьем столбце всегда имеют значение 0,0, 0,0 и 1,0.

Так как Direct2D поддерживает только аффинных (линейные) преобразования, ее матрица преобразований определяется как матрица размером 3 на 2, в которой опущен третий столбец из предыдущей матрицы преобразования. В следующей таблице показан макет матрицы преобразования «Direct2D».



|    &nbsp;       |       &nbsp;    | 
|-----------------|-----------------|
| M11Default: 1,0 | M12Default: 0,0 |
| M21Default: 0,0 | M22Default: 1,0 |
| M31OffsetX: 0,0 | M32OffsetY: 0,0 |



 

В Direct2D эта матрица с 3 по 2 представлена структурой [**D2D1 \_ Matrix \_ 3X2**](/windows/desktop/api/dcommon/ns-dcommon-d2d_matrix_3x2_f) . Для упрощения общих операций матрицы Direct2D также предоставляет класс с именем [**Matrix3x2F**](/windows/win32/api/d2d1helper/nl-d2d1helper-matrix3x2f), который является производным от структуры **D2D1 \_ Matrix \_ 3X2** .

Конструктор по умолчанию для [**Matrix3x2F**](/windows/win32/api/d2d1helper/nl-d2d1helper-matrix3x2f) оставляет объект неинициализированным. Чтобы получить матрицу идентификаторов, используйте [**Matrix3x2F:: Identity**](/windows/desktop/api/d2d1helper/nf-d2d1helper-identitymatrix).

При применении преобразования «идентификатор» к объекту он не изменяет расположение, форму или размер объекта. Аналогично тому, что умножение числа на 1 не приводит к изменению числа. Иными словами, преобразование «идентификатор» оставляет координаты только точек и не смещает точки до новой позиции. Любое преобразование, отличное от преобразования Identity, изменит расположение, форму и (или) размер объектов.

Преобразования — это все о координатах, и важно понимать Direct2D пространство координат для понимания использования преобразований.

## <a name="the-direct2d-coordinate-space"></a>Direct2D координатное пространство

Direct2D использует левое пространство координат; то есть положительные значения оси x увеличиваются вправо, а положительные значения оси y увеличиваются вниз. Все на экране располагается относительно начала координат, что является точкой пересечения осей x и y (0, 0), как показано на следующем рисунке. Целевые объекты рендеринга Direct2D используют это пространство координат.

![Иллюстрация оси x и оси y для левого пространства координат](images/coordinatespace.png)

Управляя значениями в матрице преобразования, можно поворачивать, масштабировать, отклонять и перемещать (перевод) объект. Например, если для Оффсеткс задано значение 100, а для параметра offset — 200, то объект перемещается вправо на 100 пикселей и вниз 200 пикселей.

Чтобы увидеть результат перемещения объекта, необходимо применить преобразование «Преобразование» для визуализации целевых объектов, кистей или геометрических элементов. Применение преобразования к объектам отрисовки влияет на весь экран, а применение преобразования к кисти или геометрии влияет только на эту конкретную кисть или геометрию. Чтобы создать матрицу преобразования, используйте класс [**Matrix3x2F**](/windows/desktop/api/d2d1helper/nl-d2d1helper-matrix3x2f) .

## <a name="creating-transformation-matrices"></a>Создание матриц преобразования

Для создания преобразований «вращение», «масштабирование», «наклон» и «преобразование» класс [**Matrix3x2F**](/windows/desktop/api/d2d1helper/nl-d2d1helper-matrix3x2f) предоставляет статические методы, показанные в следующей таблице. В этом примере столбец таблицы содержит ссылки на разделы с инструкциями, демонстрирующими использование каждого метода преобразования.



| Метод                                                                   | Описание                                                                                                     | Пример                                            | Иллюстрация                                                                                                                            |
|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| [**matrix3x2f:: вращение**](/windows/win32/api/d2d1helper/nf-d2d1helper-matrix3x2f-rotation)                          | создает преобразование поворота с заданным углом и Центральной точкой.                                | [Поворот объекта](how-to-rotate.md)       | ![Иллюстрация квадрата, повернутого на 45 градусов по часовой стрелке относительно центра исходного квадрата](images/rotate-ovw.png)                 |
| [**matrix3x2f:: Scale**](/windows/win32/api/d2d1helper/nf-d2d1helper-matrix3x2f-scale(d2d1_size_f_d2d1_point_2f)) | создает преобразование шкалы с указанными коэффициентами масштабирования и Центральной точкой.                           | [Масштабирование объекта](how-to-scale.md)         | ![Иллюстрация квадрата с масштабированием 130%](images/scale-ovw.png)                                                                           |
| [**matrix3x2f:: асимметрия**](/windows/win32/api/d2d1helper/nf-d2d1helper-matrix3x2f-skew)                              | создает преобразование «наклон» с заданными значениями осей x и y и центральной точки.                 | [как наклон объекта](how-to-skew.md)           | ![Иллюстрация квадратно наклоненного 30 градусов против часовой стрелки от оси y](images/skew-ovw.png)                                     |
| [**matrix3x2f:: Translation**](/windows/win32/api/d2d1helper/nf-d2d1helper-matrix3x2f-translation(d2d1_size_f))                | создает преобразование «Преобразование» и задает смещения в направлении оси x и оси y. | [преобразование объекта](how-to-translate.md) | ![Иллюстрация квадрата, перемещенного на 20 единиц вдоль положительной оси x и 10 единиц вдоль положительной оси y](images/translation-ovw.png) |



 

## <a name="rendering-target-transforms"></a>Преобразование целевых объектов отрисовки

Целевой объект отрисовки — это ресурс, который наследует от интерфейса [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) . Он создает ресурсы для рисования и выполнения фактических операций рисования. Он также предоставляет методы для преобразования пространства координат. Можно вызвать метод [**ID2D1RenderTarget:: сеттрансформ**](id2d1rendertarget-settransform.md) , чтобы применить указанное преобразование к целевому объекту прорисовки. Все последующие операции рисования происходят в преобразованном пространстве.

Для отображения содержимого используйте методы рисования целевого объекта рендеринга. Перед началом рисования вызовите метод [**бегиндрав**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) . Чтобы завершить отрисовку содержимого, вызовите метод [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) . Пример см. в разделе [применение нескольких преобразований к объекту](how-to-apply-multiple-transforms.md).

## <a name="brush-transforms"></a>Преобразования кистей

Можно настроить преобразование на кисти, вызвав [**сеттрансформ**](/windows/win32/api/d2d1/nf-d2d1-id2d1brush-settransform(constd2d1_matrix_3x2_f_)). Для этого преобразования можно представить себе кисть как большую часть бумаги и различные примитивы отрисовки (текст, геометрия, прямоугольник и т. д.) в качестве наборов элементов. При настройке преобразования кисти это так же, как при перемещении большой части бумаги под трафаретом без изменения позиции самого набора элементов. Этот метод можно использовать для плавного исчезновения текста с желтого на черный в трехмерном пространстве.

Когда преобразование «кисть» является преобразованием «идентификация», кисти отображаются в том же пространстве координат, что и целевой объект рендеринга, в котором они рисуются. Преобразование «кисть» позволяет вызывающему объекту изменить способ, которым координаты кисти сопоставляются с этим пространством.

пространство кисти указано по-разному в Direct2D, чем в Windows Presentation Foundation (WPF). В Direct2D пространство кисти не связано с рисуемым объектом, а является текущей системой координат целевого объекта отрисовки, которая преобразуется с помощью преобразования кисти, если таковое имеется. Чтобы кисть заполнила объект как выполненный в WPF, необходимо перевести источник пространства кисти в левый верхний угол ограничивающего прямоугольника объекта, а затем масштабировать пространство кисти таким образом, чтобы базовый элемент мозаики заполнил ограничивающий прямоугольник объекта.

Дополнительные сведения о преобразованиях кистей см. в разделе [Общие сведения о Direct2D Brush](direct2d-brushes-overview.md).

## <a name="geometry-transforms"></a>Преобразования геометрии

При масштабировании, перемещении, преобразовании или отклонении геометрических объектов можно напрямую применить преобразование к определенной геометрии, а не к преобразованию целевого объекта прорисовки, которое повлияет на весь экран. Преобразование целевого объекта прорисовки обычно влияет на штрих и заливку геометрии. В отличие от этого, геометрическое преобразование влияет только на заливку геометрии, так как преобразование применяется к геометрии перед обводкой.

> [!Note]  
> начиная с Windows 8, преобразование «мир» не влияет на штрих, если для параметра тип обводки задано значение D2D1 обводки [**\_ \_ \_ \_ фиксированный**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_stroke_transform_type) или [**D2D1 \_ \_ тип преобразования «трансформация \_ \_**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_stroke_transform_type)».

 

Можно настроить преобразование для геометрии, вызвав [**ID2D1Factory:: креатетрансформеджеометри**](/previous-versions/windows/desktop/legacy/dd371304(v=vs.85)) , чтобы создать объект [**ID2D1TransformedGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1transformedgeometry) . Дополнительные сведения о преобразованиях геометрии см. в разделе [Общие сведения о геометрических Direct2Dях](direct2d-geometries-overview.md).

## <a name="how-a-render-target-transform-affects-clips"></a>Влияние преобразования целевого объекта прорисовки на клипы

Преобразование в целевом объекте прорисовки влияет на то, как вычисляются ограничивающие прямоугольники для вырезок, выданных по осям. При вызове [**пушаксисалигнедклип**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) параметр *клипрект* преобразуется в соответствии с текущим мировым преобразованием, заданным для целевого объекта отрисовки. После применения преобразования к *клипрект* вычисление ограничивающего прямоугольника для *клипрект* вычисляются по осям. Для повышения эффективности содержимое обрезается по этому ограничивающему прямоугольнику по оси, а не к первоначально переданному *клипрект* . На следующих диаграммах показано, как преобразование «вращение» применяется к цели рендеринга, результирующему *клипрект* и вычисляемому ограничивающему прямоугольнику с масштабированием по осям.

1.  Предположим, что прямоугольник на следующем рисунке является целевым объектом отрисовки, который выводится в пикселях экрана.

    ![Иллюстрация прямоугольника (цель прорисовки)](images/pushaxisalignedclip-step1-rendertarget.png)

2.  Примените преобразование вращения к целевому объекту прорисовки. На следующем рисунке черный прямоугольник представляет исходный целевой объект отрисовки, а Красный пунктирный прямоугольник представляет преобразованный целевой объект рендеринга.

    ![Иллюстрация исходного прямоугольника и повернутого прямоугольника (преобразованного целевого объекта рендеринга)](images/pushaxisalignedclip-step2-transformed.png)

3.  После вызова [**пушаксисалигнедклип**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-pushaxisalignedclip(constd2d1_rect_f__d2d1_antialias_mode)) к *клипрект* применяется преобразование поворота. На следующем рисунке синий прямоугольник представляет преобразованный *клипрект*.

    ![Иллюстрация меньшего синего прямоугольника (клипрект) внутри повернутого прямоугольника (преобразованный целевой объект рендеринга)](images/pushaxisalignedclip-step3-cliprecttransformed.png)

4.  Вычисляется ограничивающий прямоугольник, ориентированный по осям. На приведенном ниже рисунке зеленый пунктирный прямоугольник представляет ограничивающее поле. Все содержимое обрезается по этому ограничивающему прямоугольнику, ориентированному на оси.

    ![Иллюстрация зеленой ограничивающей рамки на маленьком синем прямоугольнике (клипрект)](images/pushaxisalignedclip-step4-boundingbox.png)

## <a name="summary"></a>Сводка

Direct2D упрощает преобразование двумерных объектов с упрощенными пространствами координат и связанными классами. Используя различные типы преобразований, можно переводить, поворачивать, отклонять и масштабировать объекты для достижения множества впечатляющих визуальных эффектов.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Справочник по Direct2D](reference.md)
</dt> </dl>

 

 