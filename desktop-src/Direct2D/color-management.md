---
title: Эффекты управления цветом
description: Используйте эффекты управления цветом для преобразования изображения из одного цветового профиля ICC (Международный цветовой консорциум) в другой. Этот результат преобразует изображение в соответствии со спецификацией ICC.
ms.assetid: 7351C4B4-F289-4236-BB42-1B3BD8753248
keywords:
- эффекты управления цветом
ms.topic: article
ms.date: 02/05/2019
ms.openlocfilehash: 274591312ab110a24fb315d01f72d23a22a938ad41f380620d94a865602e82a8
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117826702"
---
# <a name="color-management-effect"></a>Эффекты управления цветом

Используйте эффекты управления цветом для преобразования изображения из одного цветового профиля ICC (Международный цветовой консорциум) в другой. Этот результат преобразует изображение в соответствии со [спецификацией ICC](https://www.color.org).

Идентификатором CLSID для этого действия является CLSID \_ D2D1ColorManagement.

- [Свойства эффектов](#effect-properties)
- [Режимы намерения отрисовки](#rendering-intent-modes)
- [Режимы альфа-канала входного изображения](#input-image-alpha-modes)
- [Соответствие спецификации ICC](#compliance-with-icc-specification)
- [Поведение альфа-канала](#alpha-channel-behavior)
- [Режимы качества](#quality-modes)
- [Образец кода](#sample-code)
- [Требования](#requirements)
- [Связанные темы](#related-topics)

## <a name="effect-properties"></a>Свойства эффектов

| Отображаемое имя и перечисление индекса | Описание |
|-|-|
| SourceContext<br/> \_ \_ \_ \_ Контекст цвета источника D2D1 колорманажемент \_<br/> | Сведения об исходном цветовом пространстве. Тип — [**ID2D1ColorContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1colorcontext).<br/> Значение по умолчанию — NULL.<br/> |
| саурцеинтент<br/> D2D1 \_ колорманажемент \_ , \_ \_ Цель визуализации \_ источника<br/> | Какую цель визуализации ICC использовать. Тип — D2D1 \_ колорманажемент \_ \_ .<br/> Значение по умолчанию — D2D1 \_ колорманажемент с \_ намерением подготовки к просмотру \_ \_ искусственного.<br/> |
| дестинатионконтекст<br/> \_ \_ \_ Контекст целевого цвета назначения \_ \_ D2D1 колорманажемент<br/> | Сведения о цветовом пространстве назначения. Тип — [**ID2D1ColorContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1colorcontext).<br/> Значение по умолчанию — NULL.<br/> |
| дестинатионинтент<br/> \_ \_ \_ \_ Цель визуализации назначения D2D1 колорманажемент \_<br/> | Какую цель визуализации ICC использовать. Тип — D2D1 \_ колорманажемент \_ \_ .<br/> Значение по умолчанию — D2D1 \_ колорманажемент с \_ намерением подготовки к просмотру \_ \_ искусственного.<br/> |
| алфамоде<br/> D2D1 \_ колорманажемент \_ prop \_ , \_ режим альфа<br/> | Способ интерпретации альфа-данных, содержащихся во входном изображении. Тип — D2D1 \_ колорманажемент \_ Alpha \_ mode.<br/> Значение по умолчанию — D2D1 колорманажемент Alpha с предварительным \_ \_ \_ \_ умножением.<br/> |
| Качество<br/> D2D1 \_ колорманажемент \_ prop \_ Quality<br/> | Уровень качества преобразования. Тип — D2D1 \_ колорманажемент \_ Quality.<br/> Значение по умолчанию — D2D1 \_ колорманажемент \_ Quality ( \_ нормальное качество).<br/> |

## <a name="rendering-intent-modes"></a>Режимы намерения отрисовки

| Перечисление | Описание |
|-|-|
| D2D1 \_ колорманажемент с \_ намерением подготовки к просмотру \_ \_ искусственного | Этот действие сжимает или развертывает полный цветовой охват изображения, чтобы заполнить цветовую гамму устройства, чтобы сохранить серый баланс, но точность изображения не может быть сохранена. |
| D2D1 \_ колорманажемент, \_ Цель рендеринга — \_ \_ Относительный \_ | Этот результат сохраняет чрома цветов в изображении с возможностью оттенок и яркости. |
| D2D1 \_ колорманажемент \_ , \_ насыщенность с намерением визуализации \_ | Этот результат корректирует цвета, которые выходят за пределы диапазона цветов, отображаемых устройством вывода, до ближайшего доступного цвета. Он не сохраняет белую точку. |
| \_ \_ Цель отрисовки D2D1 колорманажемент — \_ \_ Абсолютная \_ | Этот результат корректирует все цвета, которые выходят за пределы диапазона, который может быть отображен выходным устройством, до ближайшего к просмотру цвета. Этот результат не изменяет другие цвета и сохраняет белую точку. |

## <a name="input-image-alpha-modes"></a>Режимы альфа-канала входного изображения

| Перечисление | Описание |
|-|-|
| Предварительное \_ \_ \_ \_ умножение режима альфа-D2D1 колорманажемент | Результат предполагает, что предварительно умножается режим альфа. |
| D2D1 \_ колорманажемент \_ Alpha \_ , \_ прямой режим | Результат предполагает, что альфа-канал имеет прямой режим. |

## <a name="d2d1_gamma1_g2084-behavior-changes"></a>D2D1_GAMMA1_G2084 изменения поведения
    
Если приложение использует [D2D1_GAMMA1_G2084ое](/windows/desktop/api/d2d1_3/ne-d2d1_3-d2d1_gamma1) пространство или одно из значений перечисления [DXGI_COLOR_SPACE_TYPE](/windows/desktop/api/dxgicommon/ne-dxgicommon-dxgi_color_space_type) , использующих цветовое пространство SMPTE St. 2084 (искусственного куантизер), приложение будет работать с данными HDR.

API [**ID2D1DeviceContext5:: креатеколорконтекстфромсимплеколорпрофиле**](/windows/desktop/api/d2d1_3/nf-d2d1_3-id2d1devicecontext5-createcolorcontextfromsimplecolorprofile(constd2d1_simple_color_profile__id2d1colorcontext1)) и [**ID2D1DeviceContext5:: креатеколорконтекстфромдксгиколорспаце**](/windows/desktop/api/d2d1_3/nf-d2d1_3-id2d1devicecontext5-createcolorcontextfromdxgicolorspace) не учитывается. Вместо этого содержимое HDR масштабируется для размещения в диапазоне 0-1 во время операции деG2084 дегаммы.

На практике содержимое, закодированное в этом пространстве гамма, использует ссылку на 10 000 Вхителевел НИТС, который обычно представлен в КККС как 10 000/80 = 125,0. Таким образом, чтобы лучше упростить работу с приложением, это простейшее гамма-преобразование также позволяет масштабировать светимость на 125. начиная с Windows 10, версия 1809 (10,0; Сборка 17763), поведением управления цветом является то, что оно применяет это масштабирование. Это означает, что вы, как разработчик, не должны применять второй [цветовой коррекции белого уровня](white-level-adjustment-effect.md) к конвейеру.

## <a name="compliance-with-icc-specification"></a>Соответствие спецификации ICC

Результат управления цветом соответствует спецификации ICC версии 4.3 с этими ограничениями:

- Этот результат поддерживает цветовые пространства 1, 3 и 4 канала.
- Этот результат не поддерживает Колорспаце или именованные профили цветов.

## <a name="alpha-channel-behavior"></a>Поведение альфа-канала

В целом, если в исходном изображении нет альфа-данных, то в качестве значения альфа-канала устанавливается значение 1 (непрозрачный), а при отсутствии места в целевом изображении данные не удаляются. В таблице здесь описывается поведение альфа.

<table>
<thead>
<tr class="header">
<th>Исходный колорспаце, формат пикселей</th>
<th>Целевой колорспаце, формат пикселей</th>
<th>Поведение альфа-канала</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="4">1 канал, формат пикселей R $ {Remove} $<br />
</td>
<td>1 канал, формат пикселей R</td>
<td>(Нет альфа-данных)</td>
</tr>
<tr class="even">
<td>1 канал, формат пикселей RGBA</td>
<td>Для альфа-данных задано значение 1 (непрозрачный)</td>

</tr>
<tr class="odd">
<td>3 канала, формат пикселей RGBA</td>
<td>Для альфа-данных задано значение 1 (непрозрачный)</td>

</tr>
<tr class="even">
<td>4 канала, формат пикселей RGBA</td>
<td>(Нет альфа-данных)</td>

</tr>
<tr class="odd">
<td rowspan="4">1 канал, формат пикселей RGBA $ {Remove} $<br />
</td>
<td>1 канал, формат пикселей R</td>
<td>Данные Alpha отбрасываются</td>
</tr>
<tr class="even">
<td>1 канал, формат пикселей RGBA</td>
<td>Альфа-данные передаются через</td>

</tr>
<tr class="odd">
<td>3 канала, формат пикселей RGBA</td>
<td>Альфа-данные передаются через</td>

</tr>
<tr class="even">
<td>4 канала, формат пикселей RGBA</td>
<td>Данные Alpha отбрасываются</td>

</tr>
<tr class="odd">
<td rowspan="4">3 канала, формат пикселей RGBA $ {Remove} $<br />
</td>
<td>1 канал, формат пикселей R</td>
<td>Данные Alpha отбрасываются</td>
</tr>
<tr class="even">
<td>1 канал, формат пикселей RGBA</td>
<td>Альфа-данные передаются через</td>

</tr>
<tr class="odd">
<td>3 канала, формат пикселей RGBA</td>
<td>Альфа-данные передаются через</td>

</tr>
<tr class="even">
<td>4 канала, формат пикселей RGBA</td>
<td>Данные Alpha отбрасываются</td>

</tr>
<tr class="odd">
<td rowspan="4">4 канала, формат пикселей RGBA $ {Remove} $<br />
</td>
<td>1 канал, формат пикселей R</td>
<td>(Нет альфа-данных)</td>
</tr>
<tr class="even">
<td>1 канал, формат пикселей RGBA</td>
<td>Для альфа-данных задано значение 1 (непрозрачный)</td>

</tr>
<tr class="odd">
<td>3 канала, формат пикселей RGBA</td>
<td>Для альфа-данных задано значение 1 (непрозрачный)</td>

</tr>
<tr class="even">
<td>4 канала, формат пикселей RGBA</td>
<td>(Нет альфа-данных)</td>

</tr>
</tbody>
</table>

## <a name="quality-modes"></a>Режимы качества

| Режим | Описание |
|-|-|
| D2D1 \_ колорманажемент \_ качество \_ | Режим наименьшего качества. Для этого режима требуется уровень Feature 9 \_ 1 или более поздней версии. |
| \_ \_ Нормальное качество D2D1 колорманажемент \_ | Режим нормального качества. Для этого режима требуется уровень Feature 9 \_ 1 или более поздней версии. |
| \_ \_ Лучшее качество D2D1 \_ колорманажемент | Режим наилучшего качества. Для этого режима требуется уровень компонентов 10 \_ 0 или выше, а также буферы точности с плавающей точкой. Этот режим поддерживает точность с плавающей запятой, а также расширенный диапазон, как определено в спецификации ICC v 4.3. |

Если приложение запрашивает режим качества, не поддерживаемый оборудованием, эффекты управления цветом вызовут ошибку. Уровень функций можно определить при вызове [**D3D11CreateDevice**](/windows/desktop/api/d3d11/nf-d3d11-d3d11createdevice). Чтобы проверить поддержку буфера с плавающей точкой, вызовите [**ID2D1EffectContext:: исбуфферпреЦисионсуппортед**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported) со значением [**D2D1 \_ buffer \_ Precision \_ 32BPC \_ float**](/windows/desktop/api/D2d1_1/ne-d2d1_1-d2d1_buffer_precision).

## <a name="sample-code"></a>Пример кода

Чтобы получить пример этого эффекта, скачайте [Пример коррекции фотографии Direct2D Effects](https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment)и ознакомьтесь с занятием 4 примера.

## <a name="requirements"></a>Требования

| Требование | Значение |
|-|-|
| Минимальная версия клиента | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Минимальная версия сервера | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Header | d2d1effects. h |
| Библиотека | D2D1. lib, дксгуид. lib |

## <a name="related-topics"></a>Связанные темы

* [Интерфейс ID2D1Effect](/windows/desktop/api/d2d1_1/nn-d2d1_1-id2d1effect)
