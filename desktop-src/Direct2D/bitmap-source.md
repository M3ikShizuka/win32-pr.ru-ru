---
title: Исходный растровый результат
description: Используйте эффекты источника точечного рисунка для создания ID2D1Image из IWICBitmapSource для использования в качестве входных данных в графе эффектов.
ms.assetid: 86646111-208A-4E6D-A28C-7B23A1742D24
keywords:
- исходный растровый результат
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 19889372c7ebd4268f1b6fd8b77c360f290cc416631e9fb5e1cd3a0b0320844c
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119833325"
---
# <a name="bitmap-source-effect"></a>Исходный растровый результат

Используйте эффекты источника точечного рисунка для создания [**ID2D1Image**](/windows/win32/api/d2d1/nn-d2d1-id2d1image) из [**IWICBitmapSource**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapsource) для использования в качестве входных данных в графе эффектов. Этот результат выполняет масштабирование и вращение на ЦП. Кроме того, при необходимости можно создать mipmap системной памяти, что может быть оптимизацией производительности для активного масштабирования очень больших изображений при различных уменьшенных разрешениях.

> [!Note]  
> Результат источника точечного рисунка принимает свои входные данные как свойство, а не как вход изображения. Необходимо использовать метод [**SetValue**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1properties-setvalue(uint32_constbyte_uint32)) , а не метод [**сетинпут**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1effect-setinput) . В свойстве *викбитмапсаурце* указываются входные данные изображения.

 

Идентификатором CLSID для этого действия является CLSID \_ D2D1BitmapSource.

-   [Свойства эффектов](#effect-properties)
-   [Режимы интерполяции](#interpolation-modes)
-   [Orientation](#orientation)
-   [Режимы альфа](#alpha-modes)
-   [Замечания](#remarks)
-   [Требования](#requirements)
-   [Связанные темы](#related-topics)

## <a name="effect-properties"></a>Свойства эффектов



| Отображаемое имя и перечисление индекса                                                          | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| викбитмапсаурце<br/> \_ \_ \_ \_ Источник точечного рисунка WIC \_ для D2D1<br/>         | [IWICBitmapSource](/windows/desktop/wic/-wic-imp-iwicbitmapsource) , содержащий данные изображения для загрузки.<br/> Тип — [IWICBitmapSource](/windows/desktop/wic/-wic-imp-iwicbitmapsource).<br/> Значение по умолчанию — NULL.<br/>                                                                                                                                                                                                                   |
| Масштабирование<br/> \_ \_ \_ МАСШТАБИРОВАНие Prop D2D1<br/>                                 | Размер шкалы в направлении X и Y. Результат умножает ширину на значение X и высоту по значению Y. Это свойство является D2D1 \_ вектором \_ 2F, определенным как: (масштаб X, Масштаб Y). Значения масштаба FLOAT, без единицы и должны быть положительными или равными 0.<br/> Тип — D2D1 \_ vector \_ 2F.<br/> Значение по умолчанию — {1.0 f, 1.0 f}.<br/>                                                                           |
| Интерполатионмоде.<br/> \_ \_ \_ Режим ИНТЕРПОЛЯЦИи Prop D2D1 \_<br/>      | Режим интерполяции, используемый для масштабирования изображения. Дополнительные сведения см. в разделе [режимы интерполяции](#interpolation-modes) .<br/> Если в режиме отключается mipmap, Битмапсауце будет кэшировать изображение с разрешением, определенным свойствами Scale и Енабледпикорректион.<br/> Тип — D2D1, \_ \_ Режим интерполяции \_ .<br/> Значение по умолчанию — D2D1 — \_ \_ \_ линейный режим интерполяции \_ .<br/> |
| енабледпикорректион<br/> D2D1ое \_ \_ разрешение Prop — \_ \_ \_ исправление dpi<br/> | Если задать для этого свойства значение TRUE, то будет масштабировать входной образ для преобразования DPI, сообщаемого [**IWICBitmapSource**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapsource) , на значение dpi контекста устройства. В результате используется режим интерполяции, заданный с помощью свойства Интерполатионмоде. Если присвоить этому параметру значение FALSE, то в результате для выходного изображения будет использоваться значение DPI 96,0.<br/> Тип — BOOL.<br/> Значение по умолчанию — FALSE.<br/>   |
| алфамоде<br/> D2D1 \_ - \_ режим "Альфа- \_ канал \_ "<br/>                       | Режим альфа для выходных данных. Это может быть либо предварительное умножение, либо прямое. Дополнительные сведения см. в разделе [режимы альфа-канала](#alpha-modes) .<br/> Тип — D2D1овый \_ \_ режим альфа-канала \_ .<br/> Значение по умолчанию — D2D1о — альфа-канал с предварительным \_ \_ \_ \_ умножением.<br/>                                                                                                                                                              |
| Orientation<br/> Ориентация свойства "D2D1" \_ \_ \_<br/>                     | Операция отражения или вращения, выполняемая над изображением. Дополнительные сведения см. в разделе [ориентация](#orientation) .<br/> Тип — D2D1ая \_ \_ ориентация.<br/> По умолчанию используется значение по умолчанию D2D1 для \_ \_ ориентации \_ .<br/>                                                                                                                                                                                 |



 

## <a name="interpolation-modes"></a>Режимы интерполяции

Этот режим выполняет интерполяцию с использованием этого режима при масштабировании изображения или при исправлении DPI. Режимы интерполяции, используемые этим действием, рассчитываются ЦП, а не GPU.



| Имя                                                       | Описание                                                                                                                                                                                                                          |
|------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ \_ \_ Ближайший сосед в режиме интерполяции \_ D2D1 | Выбирает ближайшую одиночную точку и использует ее. Не создает mipmap.                                                                                                                                                           |
| \_ \_ \_ Линейный режим интерполяции \_ D2D1            | Использует выборку с четырьмя точками и линейную интерполяцию. Не создает mipmap.                                                                                                                                                        |
| D2D1ный \_ \_ Режим интерполяции, \_ \_ кубический             | Использует 16-примерный ядро кубических для интерполяции. Не создает mipmap.                                                                                                                                                          |
| \_ \_ Фант режим ИНТЕРПОЛЯЦИи \_ D2D1 \_              | Использует фант интерполяцию WIC, то же, что и интерфейс [**ивикбитмапскалер**](/windows/desktop/api/wincodec/nn-wincodec-iwicbitmapscaler) . Не создает mipmap.                                                                                       |
| D2D1 \_ \_ \_ переMIPMAP режим интерполяции, \_ \_ линейный    | Создает цепочку mipmap в системной памяти с помощью интерполяции билинейной. Для каждого mipmap результат масштабируется до ближайшего числа, кратного 0,5 с помощью интерполяции билинейной, а затем масштабирует оставшуюся сумму с помощью линейной интерполяции. |



 

## <a name="orientation"></a>Orientation

Свойство Orientation можно использовать для применения флага ориентации EXIF, внедренного в изображение.



| Имя                                                                    | Описание                                                        |
|-------------------------------------------------------------------------|--------------------------------------------------------------------|
| Ориентация D2D1ного \_ \_ перенаправления \_ по умолчанию                                | По умолчанию. Этот результат не изменяет ориентацию входных данных.   |
| \_Отразить \_ \_ \_ по горизонтали ориентацию D2D1                       | Переворачивает изображение по горизонтали.                                      |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE180                   | Поворот изображения на 180 градусов по часовой стрелке.                           |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE180 \_ перелистывание \_ по горизонтали | Поворот изображения на 180 градусов по часовой стрелке и отражение его по горизонтали. |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE270 \_ перелистывание \_ по горизонтали | Поворот изображения на 270 градусов по часовой стрелке и отражение его по горизонтали. |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE90                    | Поворот изображения на 90 градусов по часовой стрелке.                            |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE90 \_ перелистывание \_ по горизонтали  | Поворот изображения на 90 градусов по часовой стрелке и отражение его по горизонтали.  |
| D2D1а, \_ \_ ориентация, \_ поворот \_ CLOCKWISE270                   | Поворот изображения на 270 градусов по часовой стрелке.                           |



 

В этом фрагменте кода показано, как преобразовать значения ориентации EXIF (определенные в PKEY. h) в значения D2D1ного \_ \_ расположения.


```C++
#include <propkey.h>
#include <d2d1effects.h>

D2D1_BITMAPSOURCE_ORIENTATION GetBitmapSourceOrientation(unsigned short PhotoOrientation)
{
       switch (PhotoOrientation)
       {
       case PHOTO_ORIENTATION_NORMAL:
              return D2D1_BITMAPSOURCE_ORIENTATION_DEFAULT;
       case PHOTO_ORIENTATION_FLIPHORIZONTAL:
              return D2D1_BITMAPSOURCE_ORIENTATION_FLIP_HORIZONTAL;
       case PHOTO_ORIENTATION_ROTATE180:
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE180;
       case PHOTO_ORIENTATION_FLIPVERTICAL:
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE180_FLIP_HORIZONTAL;
       case PHOTO_ORIENTATION_TRANSPOSE: 
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE90_FLIP_HORIZONTAL;
       case PHOTO_ORIENTATION_ROTATE270:
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE90;
       case PHOTO_ORIENTATION_TRANSVERSE:
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE270_FLIP_HORIZONTAL;
       case PHOTO_ORIENTATION_ROTATE90:
              return D2D1_BITMAPSOURCE_ORIENTATION_ROTATE_CLOCKWISE270;
       default:
              return D2D1_BITMAPSOURCE_ORIENTATION_DEFAULT;
       }
}
```



## <a name="alpha-modes"></a>Режимы альфа



| Имя                                           | Описание                                            |
|------------------------------------------------|--------------------------------------------------------|
| Предварительное \_ \_ \_ умножение режима альфа-канала D2D1 \_ | В выходных данных эффектов используется предварительно умноженное альфа-значение.<br/> |
| D2D1ный \_ \_ режим альфа-канала \_ \_      | В выходных данных эффектов используется прямая альфа-составляющая.<br/>      |



 

## <a name="remarks"></a>Remarks

Чтобы оптимизировать производительность при совместном использовании WIC и [Direct2D](./direct2d-portal.md) , следует использовать [**ивикформатконвертер**](/windows/desktop/api/wincodec/nn-wincodec-iwicformatconverter) для преобразования в соответствующий формат пикселей на основе сценария приложения и собственной точности образа.

В большинстве случаев конвейер [Direct2D](./direct2d-portal.md) приложений требует только 8 бит на канал (бит/с) точности, либо образ обеспечивает только 8-битную точность, поэтому необходимо преобразовать в GUID \_ WICPixelFormat32bppPBGRA. Однако если вы хотите воспользоваться преимуществами дополнительной точности изображения (например, JPEG-XR или TIFF с более 8 битами на канал), следует использовать формат пикселей на основе RGBA. В таблице ниже приведены дополнительные сведения.



| Требуемая точность   | Собственная точность изображения | Рекомендуемый формат пикселей                |
|---------------------|-------------------------------|-----------------------------------------|
| 8 бит на канал  | <= 8 бит на канал      | GUID \_ WICPixelFormat32bppPBGRA          |
| Как можно выше | <= 8 бит на канал      | GUID \_ WICPixelFormat32bppPBGRA          |
| Как можно выше | > 8 бит на канал       | Порядок каналов RGBA, предварительно умноженный альфа-канал |



 

Так как многие форматы изображений поддерживают несколько уровней точности, следует использовать [**IWICBitmapSource:: жетпикселформат**](/windows/desktop/wic/-wic-codec-iwicbitmapsource-getpixelformat-proxy) для получения собственного формата пикселей Image s, а затем использовать [**ивикпикселформатинфо**](/windows/desktop/api/wincodec/nn-wincodec-iwicpixelformatinfo) , чтобы определить, сколько бит на канал точности для этого формата доступно. Кроме того, обратите внимание, что не все оборудование поддерживает форматы пикселей высокой точности. В таких случаях приложению может потребоваться вернуться на устройство деформации, чтобы обеспечить высокую точность.

## <a name="requirements"></a>Требования



| Требование | Значение |
|--------------------------|------------------------------------------------------------------------------------|
| Минимальная версия клиента | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Минимальная версия сервера | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Header                   | d2d1effects. h                                                                      |
| Библиотека                  | D2D1. lib, дксгуид. lib                                                               |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**ID2D1Effect**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1effect)
</dt> </dl>

 

