---
title: Эффект свертки матрицы
description: Используйте эффекты матрицы, чтобы применить произвольный 2D-ядро к изображению. Этот эффект можно использовать для размытия, обнаружения краев, приподнятости или повышения резкости изображения.
ms.assetid: D9C23AC4-0090-4F16-AC59-B952FB616FA9
keywords:
- вращение матрицы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9e3b988e0bd48fece4d767fad29b63fe021c82d49d07dae5ab3f1b10b3f9794f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119833382"
---
# <a name="convolve-matrix-effect"></a>Эффект свертки матрицы

Используйте эффекты матрицы, чтобы применить произвольный 2D-ядро к изображению. Этот эффект можно использовать для размытия, обнаружения краев, приподнятости или повышения резкости изображения.

Идентификатором CLSID для этого действия является CLSID \_ D2D1ConvolveMatrix.

-   [Пример изображения](#example-image)
-   [Свойства эффектов](#effect-properties)
-   [Режимы масштабирования](#scale-modes)
-   [Режимы границ](#border-modes)
-   [Битовая карта вывода](#output-bitmap)
-   [Требования](#requirements)
-   [Связанные темы](#related-topics)

## <a name="example-image"></a>Пример изображения

В этом примере показаны входные и выходные данные влияния матрицы вращения на ядро 3 x 3.



| До                                                         |
|----------------------------------------------------------------|
| ![изображение перед результатом.](images/default-before.jpg)     |
| После                                                          |
| ![изображение после преобразования.](images/6-convolvematrix.png) |



 


```C++
ComPtr<ID2D1Effect> convolveMatrixEffect;
m_d2dContext->CreateEffect(CLSID_D2D1ConvolveMatrix, &convolveMatrixEffect);

convolveMatrixEffect->SetInput(0, bitmap);
float matrix[9] = {-1, -1, -1, -1, 9, -1, -1, -1, -1};
convolveMatrixEffect->SetValue(D2D1_CONVOLVEMATRIX_PROP_KERNEL_MATRIX, matrix);

m_d2dContext->BeginDraw();
m_d2dContext->DrawImage(convolveMatrixEffect.Get());
m_d2dContext->EndDraw();
```



## <a name="effect-properties"></a>Свойства эффектов



| Отображаемое имя и перечисление индекса                                                      | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| кернелунитленгс<br/> \_ \_ \_ \_ Длина единицы ядра D2D1 конволвематрикс \_<br/> | Размер одной единицы в ядре. Единицы измерения находятся в (DIP/единица ядра), где единица ядра — это размер элемента в ядре свертки. Значение 1 (DIP/единица ядра) соответствует одному пикселю в изображении с 96 DPI.<br/> Тип — FLOAT.<br/> Значение по умолчанию — 1,0 f.<br/>                                                                                                                                                                                                                   |
| ScaleMode<br/> \_ \_ \_ Режим масштабирования D2D1 конволвематрикс \_<br/>                 | Режим интерполяции, который применяется для масштабирования изображения до соответствующей длины единицы ядра. Существует шесть режимов масштабирования, имеющих высокое качество и скорость.<br/> Тип — D2D1 \_ конволвематрикс ( \_ масштабируемый \_ режим).<br/> Значение по умолчанию — \_ D2D1 \_ конволвематрикс \_ \_ линейный режим масштабирования.<br/>                                                                                                                                                                                                                     |
| кернелсизекс<br/> D2D1 \_ конволвематрикс \_ , \_ \_ размер ядра \_ X<br/>           | Ширина матрицы ядра. Единицы измерения указываются в единицах ядра. Тип — UINT32.<br/> Значение по умолчанию равно 3.<br/>                                                                                                                                                                                                                                                                                                                                                                                        |
| кернелсизэй<br/> D2D1 \_ конволвематрикс \_ prop \_ \_ размер ядра \_ Y<br/>           | Высота матрицы ядра. Единицы измерения указываются в единицах ядра. Тип — UINT32.<br/> Значение по умолчанию равно 3.<br/>                                                                                                                                                                                                                                                                                                                                                                                       |
| кернелматрикс<br/> \_ \_ \_ Матрица ядра D2D1 \_ конволвематрикс<br/>           | Матрица ядра, применяемая к образу. Элементы ядра не связаны и задаются как плавающие.<br/> Первый набор чисел *кернелсизекс* в элементе float \[ \] соответствует первой строке в ядре. Второй набор *кернелсизекс* чисел соответствует второй строке и так далее до *кернелсизэй* строк.<br/> Тип — FLOAT \[ \] .<br/> Значением по умолчанию является {0,0 f, 0,0 f, 0,0 f, 0,0 f, 1,0 f, 0,0 f, 0,0 f, 0,0 f, 0,0 f}.<br/>                                                       |
| Делитель<br/> D2D1 \_ конволвематрикс \_ prop \_ делитель<br/>                       | Матрица ядра применяется к пикселю, а затем результат делится на это значение. <br/> 0 ведет себя как значение float Эпсилон.<br/> Тип — FLOAT.<br/> Значение по умолчанию — 1,0 f.<br/>                                                                                                                                                                                                                                                                                                           |
| Смещение<br/> D2D1 \_ конволвематрикс \_ prop, \_ смещение<br/>                             | Этот результат применяет матрицу ядра, делитель, а затем добавляет сдвиг к результату. Смещение не ограничено и не имеет единицы. Тип — FLOAT.<br/> Значение по умолчанию — 0,0 f.<br/>                                                                                                                                                                                                                                                                                                                              |
| кернелоффсет<br/> \_ \_ \_ Смещение ядра D2D1 конволвематрикс \_ prop<br/>           | Сдвигает ядро свертки от центрированной точки выходных данных к заданному расположению влево/вправо и вверх/вниз. Смещение определяется в единицах ядра.<br/> С некоторыми смещениями и размерами ядра, примеры свертки ядра не будут направляться в центр изображений в пикселях. Значения пикселей для образца ядра вычисляются с помощью билинейной интерполяции.<br/> Тип — D2D1 \_ vector \_ 2F.<br/> Значение по умолчанию — {0.0 f, 0,0 f}.<br/>                                                          |
| пресервеалфа<br/> D2D1 \_ конволвематрикс \_ prop, \_ Сохранение \_ альфа-канала<br/>         | Указывает, применяется ли ядро свертки к альфа-каналу или только к цветовым каналам.<br/> Если задано **значение true** , ядро свертки применяется только к цветным каналам.<br/> Если задано **значение false** , ядро свертки применяется ко всем каналам.<br/> Тип — BOOL.<br/> Значение по умолчанию — FALSE.<br/>                                                                                                                                               |
| бордермоде<br/> \_Режим границы D2D1 конволвематрикс " \_ prop" \_ \_<br/>               | Режим, используемый для вычисления границы изображения: Soft или Hard. Дополнительные сведения см. в разделе [режимы границ](https://www.bing.com/search?q=Border+modes) .<br/> Тип — D2D1 \_ границы \_ .<br/> Значение по умолчанию — D2D1 \_ границы \_ режима \_ Soft.<br/>                                                                                                                                                                                                                                                                                     |
| клампаутпут<br/> \_ \_ \_ Выходные данные среза D2D1 конволвематрикс \_<br/>             | Будет ли результат заменять цветовые значения в диапазоне от 0 до 1 перед тем, как результат передаст значения следующему результату в графе. Этот результат выполняет фиксацию значений перед тем, как он умножает альфа-канал.<br/> Если присвоить этому параметру значение TRUE, то действие будет выполнять фиксацию значений. Если присвоить этому параметру значение FALSE, то эффект не будет выполнять фиксацию цветовых значений, но другие эффекты и поверхность вывода могут попытаться отразить значения, если они не имеют достаточно высокой точности.<br/> Тип — BOOL.<br/> Значение по умолчанию — FALSE.<br/> |



 

## <a name="scale-modes"></a>Режимы масштабирования



| Перечисление                                              | Описание                                                                                                                                                                                          |
|----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ \_ \_ Ближайший соседний D2D1 конволвематрикс режим масштабирования \_     | Выбирает ближайшую одиночную точку и использует ее. В этом режиме используется меньше времени на обработку, но выводится изображение самого низкого качества.                                                                           |
| \_ \_ \_ Линейный режим масштабирования D2D1 конволвематрикс \_                | Использует выборку с четырьмя точками и линейную интерполяцию. В этом режиме выводится изображение с более высоким качеством, чем в ближайшем соседнем режиме.                                                                              |
| D2D1 \_ конволвематрикс \_ Scale \_ , \_ кубический режим                 | Использует 16-примерный ядро кубических для интерполяции. Этот режим использует наибольшее время обработки, но выводит изображение с более высоким качеством.                                                                        |
| D2D1 \_ конволвематрикс \_ режим масштабирования с \_ \_ несколькими \_ образцами \_ | Использует 4 линейных образца в пределах одного пикселя для удобного сглаживания. Этот режим хорошо подходит для уменьшения масштаба по небольшим объемам на изображениях с небольшими пикселями.                                              |
| D2D1 \_ конволвематрикс \_ режим масштабирования — \_ \_ анизотропная           | Использует анизотропную фильтрацию для выборки шаблона в соответствии с преобразованной формой точечного рисунка.                                                                                                     |
| \_ \_ \_ \_ \_ Высококачественное \_ кубический режим масштабирования D2D1 конволвематрикс  | Использует высококачественное ядро кубического размера для выполнения предварительно довнскале образа, если довнскалинг участвует в матрице преобразования. Затем использует режим интерполяции кубических для окончательного вывода. |



 

> [!Note]  
> Если не выбрать режим, то по умолчанию применяется \_ режим МАСШТАБИРОВАНИЯ D2D1 конволвематрикс \_ \_ \_ линейный.

 

## <a name="border-modes"></a>Режимы границ



| Имя                     | Описание                                                                                                                                                                                                                                                              |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ Мягкий режим границы \_ D2D1 | При применении ядра свертки к входному изображению применяются прозрачные черные пиксели для выборки за пределами входных данных. При этом создается мягкая сторона для изображения, а в процессе разворачивается точечный рисунок с размером ядра.<br/> |
| Жесткое D2D1 в \_ \_ режиме границы \_ | Этот результат расширяет входной образ с помощью преобразования границы зеркального типа для выборок за пределами входных данных. Размер выходного растрового изображения равен размеру входного точечного рисунка.<br/>                                                                       |



 

## <a name="output-bitmap"></a>Битовая карта вывода

Размер выходных данных результата зависит от размера ядра свертки, смещения ядра, длины блока ядра и параметра режима границы.

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|--------------------------|------------------------------------------------------------------------------------|
| Минимальная версия клиента | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Минимальная версия сервера | Windows 8 и обновление платформы для Windows 7 \[ классических приложений \| Windows приложения магазина\] |
| Заголовок                   | d2d1effects. h                                                                      |
| Библиотека                  | D2D1. lib, дксгуид. lib                                                               |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**ID2D1Effect**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1effect)
</dt> </dl>

 

