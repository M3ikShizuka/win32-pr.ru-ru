---
title: Общие сведения о ресурсах
description: Описание ресурсов Direct2D и их совместного использования.
ms.assetid: afd308a7-9524-4436-9a0e-8575383d96fa
keywords:
- Direct2D, ресурсы
ms.topic: article
ms.date: 05/31/2018
ms.custom: seodec18
ms.openlocfilehash: bf4eb807a25b592e32a2d83436532af17462d70c
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127162608"
---
# <a name="resources-overview"></a>Общие сведения о ресурсах

Ресурс Direct2D — это объект, который используется для рисования и представлен интерфейсом Direct2D, например [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) или [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget). В этом разделе описываются виды ресурсов Direct2D и способы их совместного использования.

Этот раздел состоит из следующих подразделов.

-   [О ресурсах Direct2D](#about-direct2d-resources)
-   [Ресурсы, независимые от устройства](#device-independent-resources)
-   [Ресурсы, зависящие от устройства](#device-dependent-resources)
-   [Совместное использование ресурсов фабрики](#sharing-factory-resources)
-   [Общий доступ к целевым ресурсам рендеринга](#sharing-render-target-resources)
    -   [Целевые объекты рендеринга оборудования](#hardware-render-targets)
    -   [Целевые объекты прорисовки поверхности DXGI](#dxgi-surface-render-targets)
    -   [Совместимые целевые объекты рендеринга и общие точечные рисунки](#compatible-render-targets-and-shared-bitmaps)

## <a name="about-direct2d-resources"></a>О ресурсах Direct2D

Многие двумерные API с аппаратным ускорением разрабатываются на основе модели ресурсов, ориентированной на ЦП, и набора операций рендеринга, которые хорошо работают на процессорах. затем часть API работает с аппаратным ускорением. Для реализации этих API требуется диспетчер ресурсов для сопоставления ресурсов ЦП с ресурсами в GPU. Из-за ограничений GPU некоторые операции не могут быть ускорены в каждом случае. В таких случаях диспетчер ресурсов должен обмениваться данными между ЦП и GPU (что дорого), чтобы он мог переходить на визуализацию ЦП. В некоторых случаях это может привести к непредсказуемому принудительному выполнению подготовки к просмотру процессора. Кроме того, операции отрисовки, которые отображаются простыми, могут потребовать временных промежуточных этапов отрисовки, которые не представлены в API и для которых требуются дополнительные ресурсы GPU.

Direct2D обеспечивает более прямое сопоставление для полного использования GPU. Он предоставляет две категории ресурсов: независимые от устройства и устройства.

-   Ресурсы, независимые от устройства, такие как [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry), ХРАНЯТСЯ на ЦП.
-   Ресурсы, зависящие от устройства, такие как [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) и [**ID2D1LinearGradientBrush**](/windows/win32/api/d2d1/nn-d2d1-id2d1lineargradientbrush), напрямую сопоставляются с ресурсами на GPU (если доступно аппаратное ускорение). Вызовы отрисовки выполняются путем объединения сведений о вершинах и покрытии из геометрии со сведениями о текстурировании, созданными ресурсами, зависящими от устройства.

При создании ресурсов, зависящих от устройства, системные ресурсы (GPU, если они доступны или ЦП) распределяются при создании устройства и не меняются с одной операции отрисовки на другую. Это исключает необходимость в диспетчере ресурсов. В дополнение к общим улучшениям производительности, обеспечиваемым при отключении диспетчера ресурсов, эта модель позволяет напрямую управлять любой промежуточной отрисовкой.

Так как Direct2D обеспечивает настолько большой контроль над ресурсами, необходимо понимать различные типы ресурсов и, когда их можно использовать вместе.

## <a name="device-independent-resources"></a>Ресурсы Device-Independent

Как описано в предыдущем разделе, ресурсы, независимые от устройства, всегда находятся в ЦП и никогда не связаны с устройством отрисовки оборудования. Ниже перечислены ресурсы, независимые от устройства.

-   [**ID2D1DrawingStateBlock**](/windows/win32/api/d2d1/nn-d2d1-id2d1drawingstateblock)
-   [**ID2D1Factory**](/windows/win32/api/d2d1/nn-d2d1-id2d1factory)
-   [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) и интерфейсы, наследующие от него.
-   [**ID2D1GeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometrysink) и [ **ID2D1SimplifiedGeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1simplifiedgeometrysink)
-   [**ID2D1StrokeStyle**](/windows/win32/api/d2d1/nn-d2d1-id2d1strokestyle)

Для создания ресурсов, независимых от устройства, используйте [**ID2D1Factory**](/windows/win32/api/d2d1/nn-d2d1-id2d1factory), который сам по себе является аппаратно-независимым ресурсом. (Чтобы создать фабрику, используйте функцию [**CreateFactory**](/windows/desktop/api/d2d1/nf-d2d1-d2d1createfactory) .)

За исключением целевых объектов прорисовки, все ресурсы, созданные фабрикой, не зависят от устройства. Целевой объект прорисовки — это ресурс, зависящий от устройства.

## <a name="device-dependent-resources"></a>Ресурсы Device-Dependent

Любой ресурс, не имеющий имени в предыдущем списке, является ресурсом, зависимым от устройства. Ресурсы, зависящие от устройства, связаны с конкретным устройством отрисовки. Если доступно аппаратное ускорение, это устройство является GPU. В других случаях это ЦП.

Для создания большинства ресурсов, зависящих от устройства, используйте целевой объект рендеринга. В большинстве случаев для создания целевого объекта рендеринга используется фабрика.

Ниже приведены примеры ресурсов, зависящих от устройства.

-   [**ID2D1Brush**](/windows/win32/api/d2d1/nn-d2d1-id2d1brush) и интерфейсы, наследующие от него. Используйте целевой объект прорисовки для создания кистей.
-   [**ID2D1Layer**](/windows/win32/api/d2d1/nn-d2d1-id2d1layer). Используйте целевой объект отрисовки для создания слоев.
-   [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) и интерфейсы, наследующие от него. Чтобы создать целевой объект рендеринга, используйте фабрику или другой целевой объект рендеринга.

> [!Note]  
> начиная с Windows 8, существуют новые интерфейсы, которые создают ресурсы, зависящие от устройства. [**ID2D1Device**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1device) и [**ID2D1DeviceContext**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1devicecontext) могут совместно использовать ресурс, если контекст устройства и ресурс создаются из одного и того же **ID2D1Device**.

 

Ресурсы, зависящие от устройства, становятся непригодными для использования, если связанные устройства отрисовки становятся недоступными. Это означает, что при получении целевой ошибки повторного создания D2DERR для целевого объекта прорисовки необходимо заново создать целевой объект рендеринга и все его ресурсы. [**\_ \_**](direct2d-error-codes.md)

## <a name="sharing-factory-resources"></a>Совместное использование ресурсов фабрики

Вы можете поделиться всеми аппаратно-независимыми ресурсами, созданными фабрикой, с другими ресурсами (не зависящими от устройства или устройствами), созданными той же фабрикой. Например, можно использовать два объекта [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) для рисования одного и того же [**ID2D1RectangleGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1rectanglegeometry) , если оба этих объекта **ID2D1RenderTarget** были созданы одной фабрикой.

Интерфейсы приемника ([**ID2D1SimplifiedGeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1simplifiedgeometrysink), [**ID2D1GeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometrysink)и [**ID2D1TessellationSink**](/windows/win32/api/d2d1/nn-d2d1-id2d1tessellationsink)) могут использоваться совместно с ресурсами, созданными любой фабрикой. В отличие от других интерфейсов в Direct2D, можно использовать любую реализацию интерфейса приемника. Например, можно использовать собственную реализацию **ID2D1SimplifiedGeometrySink**.

## <a name="sharing-render-target-resources"></a>Общий доступ к целевым ресурсам рендеринга

Возможность совместного использования ресурсов, созданных целевым объектом рендеринга, зависит от типа целевого объекта рендеринга. При создании целевого объекта отрисовки типа [**D2D1 \_ рендеринга \_ \_ \_ по умолчанию**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_render_target_type)ресурсы, созданные этим целевым объектом отрисовки, могут использоваться только этим целевым объектом отрисовки (если целевой объект прорисовки не соответствует ни одной из категорий, описанных в следующих разделах). Это происходит из-за того, что неизвестно, какое устройство будет использовать целевой объект рендеринга — это может привести к отрисовке на локальном оборудовании, программном обеспечении или на оборудовании удаленного клиента. Например, можно написать программу, которая перестает работать при удаленном отображении или при увеличении размера целевого объекта отрисовки сверх максимального размера, поддерживаемого оборудованием визуализации.

В следующих разделах описываются обстоятельства, при которых ресурс, созданный одним целевым объектом прорисовки, может совместно использоваться с другим целевым объектом рендеринга.

### <a name="hardware-render-targets"></a>Целевые объекты рендеринга оборудования

Можно совместно использовать ресурсы любого целевого объекта рендеринга, который явно использует оборудование, при условии, что режим удаленного взаимодействия совместим. Режим удаленного взаимодействия гарантированно совместим только в том случае, если оба целевого объекта прорисовки используют [**D2D1ный \_ целевой объект рендеринга для \_ \_ \_ \_ \_ удаленного взаимодействия**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_render_target_usage) или D2D1 для целевого объекта прорисовки, **\_ \_ \_ \_ \_ совместимый с GDI** , или если ни один из флагов не указан. Эти параметры гарантируют, что ресурсы будут всегда находиться на одном и том же компьютере. Чтобы указать режим использования, задайте поле **Usage** в структуре [**\_ \_ \_ свойств целевого объекта отрисовки D2D1**](/windows/desktop/api/d2d1/ns-d2d1-d2d1_render_target_properties) , которая использовалась для создания целевого объекта отрисовки с одним или несколькими флагами **\_ \_ \_ использования целевого объекта прорисовки D2D1** .

Чтобы создать целевой объект отрисовки, который в явном виде использует аппаратную отрисовку, задайте поле **тип** в структуре [**\_ \_ \_ свойств целевого объекта отрисовки D2D1**](/windows/desktop/api/d2d1/ns-d2d1-d2d1_render_target_properties) , которая использовалась для создания целевого объекта отрисовки для [**D2D1 \_ \_ целевого \_ типа \_ визуализации**](/windows/desktop/api/d2d1/ne-d2d1-d2d1_render_target_type).

### <a name="dxgi-surface-render-targets"></a>Целевые объекты прорисовки поверхности DXGI

Ресурсы, созданные на поверхности DXGI, можно совместно использовать с любым другим целевым объектом отрисовки поверхности DXGI, использующим то же базовое устройство Direct3D.

### <a name="compatible-render-targets-and-shared-bitmaps"></a>Совместимые целевые объекты рендеринга и общие точечные рисунки

Можно совместно использовать ресурсы между целевым объектом рендеринга и совместимыми целевыми объектами рендеринга, созданными этим целевым объектом рендеринга. Чтобы создать совместимый целевой объект рендеринга, используйте метод [**ID2D1RenderTarget:: креатекомпатиблерендертаржет**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-createcompatiblerendertarget(id2d1bitmaprendertarget)) .

Метод [**ID2D1RenderTarget:: креатешаредбитмап**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsharedbitmap) можно использовать для создания [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) , который может совместно использоваться двумя целевыми объектами отрисовки, указанными в вызове метода, если метод выполняется. Этот метод будет выполнен, если два целевого объекта отрисовки используют для отрисовки одно и то же базовое устройство.

 

 
