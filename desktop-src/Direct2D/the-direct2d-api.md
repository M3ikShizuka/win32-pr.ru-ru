---
title: Обзор API Direct2D
description: Содержит общие сведения об объектной модели Direct2D.
ms.assetid: b1362ef6-40fc-4fa5-ba5b-22c622c39f04
keywords:
- Direct2D, о программе
- Direct2D, файлы заголовков
- Direct2D, объектная модель
- Direct2D, интерфейсы
- Интерфейс ID2D1Factory
- Direct2D, целевые объекты отрисовки
- целевые объекты рендеринга, сведения
- Direct2D, команды рисования
- цели рендеринга, команды рисования
- Direct2D, обработка ошибок
- целевые объекты рендеринга, обработка ошибок
- обработку ошибок
- кисти
- целевые объекты рендеринга, кисти
- geometries
- Direct2D, геометрические объекты
- точечные рисунки для Direct2D
- Direct2D, точечные рисунки
- Primitives
- Direct2D, примитивы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 54f318e3542d54ee92817193ef6b749a3ba1cf4678407ca7a12f28c6c187ae86
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119074998"
---
# <a name="direct2d-api-overview"></a>Обзор API Direct2D

Direct2D предоставляет API, аналогичный Direct3D, для использования с C или C++. API предоставляет разнообразные функции, связанные с рисованием:

-   Целевые объекты отрисовки для отображения и вывода на экран с помощью Direct2D, Direct3D или GDI.
-   Объекты для управления состоянием рисования, такие как преобразования координатного пространства и режимы сглаживания.
-   Представления геометрических данных и функции для обработки геометрии.
-   Функции отрисовки для точечных рисунков, геометрических объектов и текста.
-   Подготавливается к использованию графического содержимого, созданного с помощью GDI или Direct3D.

В этом разделе содержится обзор объектов, составляющих API Direct2D. Он содержит следующие подразделы:

-   [Файлы заголовков Direct2D](#direct2d-header-files)
-   [Интерфейсы Direct2D](#direct2d-interfaces)
-   [Интерфейс ID2D1Factory](#the-id2d1factory-interface)
-   [Целевые объекты рендеринга](#render-targets)
    -   [Функции целевого объекта прорисовки](#render-target-features)
    -   [Целевые ресурсы рендеринга](#render-target-resources)
    -   [Команды рисования](#drawing-commands)
    -   [Обработка ошибок](#error-handling)
-   [Рисование ресурсов](#drawing-resources)
    -   [Кисти](#brushes)
    -   [Геометрические объекты](#geometries)
    -   [Растровые изображения](#bitmaps)
-   [Рисование текста](#drawing-text)
-   [Примитивы Direct2D](#direct2d-primitives)
-   [Связанные темы](#related-topics)

## <a name="direct2d-header-files"></a>Файлы заголовков Direct2D

API Direct2D определяется следующими файлами заголовков.

| Файл заголовка         | Описание                                                                                                                  |
|---------------------|------------------------------------------------------------------------------------------------------------------------------|
| D2D1. h              | Определяет версии первичного API Direct2D для C и C++.                                                                      |
| d2d1helper. h        | Определяет вспомогательные функции, классы и структуры C++.                                                                       |
| d2dbasetypes. h      | Определяет примитивы рисования для Direct2D, такие как точки и прямоугольники. Этот заголовок включен в D2D1. h.                 |
| d2derr. h            | Определяет коды ошибок для Direct2D. Этот заголовок включен в D2D1. h.                                                   |
| D2D1 \_ 1. h           | определяет версии первичного API Direct2D для версий C и C++ для Windows 8 и более поздних версий.                                              |
| D2D1 \_ 1helper. h     | определяет вспомогательные функции, классы и структуры C++ для Windows 8 и более поздних версий.                                               |
| d2d1effects. h       | определяет версии эффектов изображения в C и C++ части API Direct2D для Windows 8 и более поздних версий.                            |
| d2d1effecthelpers. h | определяет вспомогательные функции C++, классы и структуры для эффектов изображения части API Direct2D для Windows 8 и более поздних версий. |



 

Чтобы использовать Direct2D, приложение должно включать заголовочный файл D2D1. h.

Чтобы скомпилировать приложение Direct2D, добавьте D2D1. lib в список библиотек. d2d1. h и d2d1. lib можно найти в [Windows пакете средств разработки программного обеспечения (SDK) для Windows 7](https://msdn.microsoft.com/windows/bb980924.aspx).

В следующих разделах описываются некоторые из распространенных интерфейсов, предоставляемых API Direct2D.

## <a name="direct2d-interfaces"></a>Интерфейсы Direct2D

В корне API Direct2D находятся интерфейсы [**ID2D1Factory**](/windows/win32/api/d2d1/nn-d2d1-id2d1factory) и [**ID2D1Resource**](/windows/win32/api/d2d1/nn-d2d1-id2d1resource) . Объект **ID2D1Factory** создает объекты **ID2D1Resource** и служит отправной точкой для использования Direct2D. Все остальные объекты Direct2D наследуются от интерфейса **ID2D1Resource** . Существует два типа ресурсов Direct2D: независимые от устройства ресурсы и ресурсы, зависящие от устройства.

-   Ресурсы, независимые от устройства, не связаны с конкретным устройством отрисовки и могут сохраняться в течение всего времени существования приложения.
-   Ресурсы, зависящие от устройства, связаны с конкретным устройством отрисовки и перестают функционировать, если это устройство будет удалено.

(Дополнительные сведения о ресурсах и общем доступе к ресурсам см. в разделе [Общие сведения](resources-and-resource-domains.md)о ресурсах.)

## <a name="the-id2d1factory-interface"></a>Интерфейс ID2D1Factory

Интерфейс [**ID2D1Factory**](/windows/win32/api/d2d1/nn-d2d1-id2d1factory) является отправной точкой для использования Direct2D. Для создания экземпляров ресурсов Direct2D используется **ID2D1Factory** . Чтобы создать ID2D1Factory, используйте один из методов [**CreateFactory**](/windows/win32/api/d2d1/nf-d2d1-d2d1createfactory) .

Фабрика определяет набор методов создания *ресурсов* , которые могут создавать следующие ресурсы для рисования:

-   Целевые объекты отрисовки — это объекты, которые визуализируют команды рисования.
-   Блоки состояния рисования — это объекты, хранящие сведения о состоянии прорисовки, такие как текущее преобразование и режим сглаживания.
-   Геометрические объекты представляют простые и потенциально сложные фигуры.

Одним из наиболее полезных объектов, которые может создать фабрика, является [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget), описанный в следующем разделе.

## <a name="render-targets"></a>Целевые объекты рендеринга

Целевой объект отрисовки — это ресурс, который наследует от интерфейса [**ID2D1RenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget) . Целевой объект прорисовки создает ресурсы для рисования и выполнения операций рисования. Существует несколько видов целевых объектов отрисовки, которые можно использовать для визуализации графики следующими способами.

-   Объекты [**ID2D1HwndRenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1hwndrendertarget) отображают содержимое в окне.
-   Объекты [**ID2D1DCRenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1dcrendertarget) отрисовывается в контексте устройства GDI.
-   Целевые объекты прорисовки растрового изображения отображают содержимое на экран, расположенный на экране.
-   Объекты для визуализации объекта DXGI визуализируются на поверхности DXGI для использования с Direct3D.

Так как целевой объект прорисовки связан с конкретным устройством отрисовки, это ресурс, зависящий от устройства, и прекращает работу при удалении устройства.

### <a name="render-target-features"></a>Функции целевого объекта прорисовки

Можно указать, должен ли целевой объект прорисовки использовать аппаратное ускорение и должна ли отображаться удаленное отображение на локальном или удаленном компьютере. Целевые объекты отрисовки могут быть настроены для отрисовки с псевдонимами или сглаженными. Для визуализации сцен с большим количеством примитивов разработчик может также визуализировать плоскую графику в режиме с псевдонимами и использовать многовыборочную раскрывающий сглаживание для достижения большей масштабируемости.

Целевые объекты рендеринга также могут группировать операции рисования в слои, представленные интерфейсом [**ID2D1Layer**](/windows/win32/api/d2d1/nn-d2d1-id2d1layer) . Слои удобно использовать для сбора операций рисования, объединяемых вместе при отрисовке кадра. В некоторых сценариях это может быть полезной альтернативой для подготовки к просмотру целевого объекта прорисовки изображения, а затем повторного использования содержимого растрового изображения, так как затраты на распределение для уровней ниже, чем для [**ID2D1BitmapRenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmaprendertarget).

Целевые объекты рендеринга могут создавать новые объекты рендеринга, совместимые с самими, что полезно для промежуточного отображения на экране, сохраняя различные свойства целевого объекта рендеринга, установленные в исходном объекте.

Также можно выполнить отрисовку с помощью GDI для целевого объекта отрисовки Direct2D, вызвав [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) в целевом объекте прорисовки для [**ID2D1GdiInteropRenderTarget**](/windows/win32/api/d2d1/nn-d2d1-id2d1gdiinteroprendertarget), который содержит методы [**GetDC**](/windows/win32/api/d2d1/nf-d2d1-id2d1gdiinteroprendertarget-getdc) и [**релеаседк**](/windows/win32/api/d2d1/nf-d2d1-id2d1gdiinteroprendertarget-releasedc) , которые можно использовать для получения контекста устройства GDI. Отрисовка через GDI возможна только в том случае, если целевой объект прорисовки был создан с установленным флагом [**D2D1 \_ рендеринга, \_ \_ \_ \_ совместимым с GDI**](/windows/win32/api/d2d1/ne-d2d1-d2d1_render_target_usage) . Это полезно для приложений, которые в основном отображаются с помощью Direct2D, но имеют модель расширяемости или другое устаревшее содержимое, которое требует возможности отображения с помощью GDI. Дополнительные сведения см. в статье [Общие сведения о взаимодействии Direct2D и GDI](direct2d-and-gdi-interoperation-overview.md).

### <a name="render-target-resources"></a>Целевые ресурсы рендеринга

Как и в случае с фабрикой, целевой объект отрисовки может создавать ресурсы рисования. Все ресурсы, созданные целевым объектом рендеринга, — это ресурсы, зависящие от устройства (как и в целевом объекте прорисовки). Целевой объект прорисовки может создавать ресурсы следующих типов:

-   Растровые изображения
-   Кисти
-   Слои
-   Сетки

### <a name="drawing-commands"></a>Команды рисования

Для отображения содержимого используются методы рисования целевого объекта рендеринга. Перед началом рисования вызовите метод [**ID2D1RenderTarget:: бегиндрав**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-begindraw) . После завершения рисования вызовите метод [**ID2D1RenderTarget:: EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) . Между этими вызовами используются методы рисования и заливки для отрисовки ресурсов рисования. Большинство методов рисования и заливки принимают фигуру (либо примитив, либо геометрию) и кисть для заполнения или структурирования фигуры.

Целевые объекты рендеринга также предоставляют методы для обрезки, применения масок непрозрачности и преобразования пространства координат.

Direct2D использует левую систему координат: положительные значения оси x откладываются вправо, а положительные значения оси y — сверху вниз.

### <a name="error-handling"></a>Обработка ошибок

Команды прорисовки целевого объекта не указывают, была ли запрошенная операция успешной. Чтобы определить, возникали ли ошибки при прорисовке, вызовите метод [**flush**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-flush) целевого объекта Render или метод [**EndDraw**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-enddraw) для получения **значения HRESULT**.

## <a name="drawing-resources"></a>Рисование ресурсов

В следующих разделах описываются некоторые ресурсы, которые можно создать с помощью целевого объекта рендеринга и интерфейсов фабрики.

### <a name="brushes"></a>Кисти

Кисть, представленная интерфейсом [**ID2D1Brush**](/windows/win32/api/d2d1/nn-d2d1-id2d1brush) , является ресурсом, зависимым от устройства, созданным целевым объектом отрисовки, который закрашивает область с выходными данными. Разные кисти имеют различные типы выводимых данных. Некоторые кисти закрашивать область сплошным цветом, другими — градиентом или изображением. Direct2D предоставляет четыре типа кистей:

-   [**ID2D1SolidColorBrush**](/windows/win32/api/d2d1/nn-d2d1-id2d1solidcolorbrush) закрашивает область сплошным цветом.
-   [**ID2D1LinearGradientBrush**](/windows/win32/api/d2d1/nn-d2d1-id2d1lineargradientbrush) заполняет область линейным градиентом, который смешивает два или более цвета в линии, оси градиента.
-   [**ID2D1RadialGradientBrush**](/windows/win32/api/d2d1/nn-d2d1-id2d1radialgradientbrush) закрашивает область с радиальным градиентом, который смешивает два или более цветов вокруг эллипса.
-   [**ID2D1BitmapBrush**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmapbrush) закрашивает область с растровым изображением.

Чтобы создать кисть, используйте один из методов [**ID2D1RenderTarget::**](/windows/win32/api/d2d1/nn-d2d1-id2d1rendertarget)Create *<Type>* Brush, например [**креатерадиалградиентбруш**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createradialgradientbrush(constd2d1_radial_gradient_brush_properties__constd2d1_brush_properties__id2d1gradientstopcollection_id2d1radialgradientbrush)). Кисти можно использовать с целевыми методами прорисовки и заливки, чтобы закрасить штрих или контур фигуры либо как маску непрозрачности.

Дополнительные сведения о кистях см. в разделе [Общие сведения о кистях](direct2d-brushes-overview.md).

### <a name="geometries"></a>Геометрия

В дополнение к основным примитивам рисования, таким как точки, прямоугольники и эллипсы, Direct2D предоставляет интерфейс [**ID2D1Geometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometry) для описания простых и сложных фигур. Интерфейсы, наследующие от **ID2D1Geometry** , определяют различные типы фигур, например [**ID2D1RectangleGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1rectanglegeometry) для представления прямоугольников, [**ID2D1RoundedRectangleGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1roundedrectanglegeometry) для представления скругленных прямоугольников и [**ID2D1EllipseGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1ellipsegeometry) для представления эллипсов.

Более сложные фигуры можно создавать с помощью интерфейса [**ID2D1GeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1geometrysink) , чтобы указать ряд фигур, состоящих из линий, кривых и дуг. **ID2D1GeometrySink** передается методу Open объекта [**ID2D1PathGeometry**](/windows/win32/api/d2d1/nn-d2d1-id2d1pathgeometry) для создания сложной геометрии. [**ID2D1SimplifiedGeometrySink**](/windows/win32/api/d2d1/nn-d2d1-id2d1simplifiedgeometrysink) также можно использовать с API DirectWrite для извлечения контуров форматированного текста для художественной отрисовки.

Геометрические интерфейсы предоставляют методы для управления фигурами путем расширения или упрощения существующих геометрических объектов или путем создания пересечения или объединения нескольких геометрических объектов. Они также предоставляют методы для определения того, пересекаются геометрические или перекрывающиеся, извлекаются сведения о границах, выполняется вычисление области или длины геометрии и интерполяция расположений вдоль геометрии. Direct2D также предоставляет возможность создания сетки треугольников, тесселяции из геометрии.

Чтобы создать геометрию, используйте один из методов [**ID2D1Factory**](/windows/win32/api/d2d1/nn-d2d1-id2d1factory):: Create *<Type>* Geometry, например [**креатепасжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1factory-createpathgeometry). Геометрия является аппаратно-независимым ресурсом.

Для визуализации геометрии используются методы [**DrawGeometry**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawgeometry) и [**филлжеометри**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-fillgeometry) целевого объекта прорисовки.

Дополнительные сведения о геометрических элементах см. в [обзоре геометрических объектов](direct2d-geometries-overview.md).

### <a name="bitmaps"></a>Растровые изображения

Direct2D не предоставляет методы для загрузки или хранения растровых изображений. вместо этого он позволяет создавать растровые изображения с помощью [компонента Windows imaging (WIC)](../wic/-wic-about-windows-imaging-codec.md). Ресурсы растрового изображения можно загрузить с помощью WIC, а затем использовать для создания [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) с помощью метода [**ID2D1RenderTarget:: креатебитмапфромвикбитмап**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createbitmapfromwicbitmap(iwicbitmapsource_constd2d1_bitmap_properties_id2d1bitmap)) .

Точечные рисунки можно также создавать из данных в памяти, которые были настроены с помощью других средств. После создания растрового изображения его можно изобразить с помощью метода [**дравбитмап**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawbitmap(id2d1bitmap_constd2d1_rect_f__float_d2d1_bitmap_interpolation_mode_constd2d1_rect_f_)) целевого объекта прорисовки или с помощью растровой кисти.

Поскольку создание ресурсов точечного рисунка на аппаратных целевых объектах отрисовки часто является дорогостоящей операцией, Direct2D может обновить содержимое растрового изображения (или его части) с помощью методов [**копифромбитмап**](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrombitmap), [**копифромрендертаржет**](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfromrendertarget)и [**копифроммемори**](/windows/win32/api/d2d1/nf-d2d1-id2d1bitmap-copyfrommemory) . Использование этих методов может привести к экономии затрат, связанных с выделением дополнительных текстур GPU.

## <a name="drawing-text"></a>Рисование текста

Direct2D был разработан для работы с текстовыми операциями нового API текста DirectWrite. чтобы упростить использование DirectWrite API, цели рендеринга предоставляют три метода для отрисовки DirectWrite текстовых ресурсов: [**DrawText**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)), [**дравтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout)и [**DrawGlyphRun**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun). Так как Direct2D использует GPU для процесса отрисовки текста ClearType, Direct2D обеспечивает более низкое использование ЦП, чем GDI для текстовых операций и улучшает масштабируемость, так как доступно больше вычислительных ресурсов GPU.

[**ID2D1RenderTarget::D равтекст**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode)) предназначен для простейших сценариев, включающих визуализацию строки текста в Юникоде с минимальным форматированием. Более сложная структура и типографская гибкость обеспечиваются с помощью метода [**ID2D1RenderTarget::D равтекстлайаут**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtextlayout) , который использует объект [**идвритетекстлайаут**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) для указания содержимого и форматирования для подготовки к просмотру. **Идвритетекстлайаут** позволяет задать индивидуальное форматирование для подстрок текста и других расширенных типографских параметров.

Для сценариев, в которых требуется точный контроль макета на уровне глифов, метод [**ID2D1RenderTarget::D равглифрун**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawglyphrun) можно использовать в сочетании с возможностями измерения, предоставляемыми [DirectWrite](../directwrite/direct-write-portal.md).

чтобы использовать DirectWrite API, включите заголовок дврите. h. как и Direct2D, DirectWrite использует фабрику, [**идвритефактори**](/windows/win32/api/dwrite/nn-dwrite-idwritefactory) для создания текстовых объектов. используйте функцию [**двритекреатефактори**](/windows/win32/api/dwrite/nf-dwrite-dwritecreatefactory) для создания фабрики, а затем используйте ее методы create для создания DirectWrite ресурсов (например, [**идвритетекстформат**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-drawtext(constwchar_uint32_idwritetextformat_constd2d1_rect_f__id2d1brush_d2d1_draw_text_options_dwrite_measuring_mode))).

дополнительные сведения о DirectWrite см. в разделе [введение в DirectWrite](../directwrite/introducing-directwrite.md) .

## <a name="direct2d-primitives"></a>Примитивы Direct2D

Direct2D определяет набор примитивов, похожих на те, которые предоставляются другими API-интерфейсами рисования. Он предоставляет цветовую структуру, матрицу для выполнения преобразований, а также версии точек, прямоугольников, эллипсов и структур с плавающей запятой и целыми числами. Обычно используются версии этих структур с плавающей запятой.

Вы не используете фабрику или целевой объект прорисовки для создания экземпляров примитивов Direct2D. Вы можете создать их напрямую или использовать вспомогательные методы, определенные в d2d1helper. h, для их создания.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Справочник по Direct2D](reference.md)
</dt> <dt>

[DirectWrite Пример Hello World](/samples/browse/?redirectedfrom=MSDN-samples)
</dt> <dt>

[Введение в DirectWrite](../directwrite/introducing-directwrite.md)
</dt> <dt>

[Общие сведения о ресурсах](resources-and-resource-domains.md)
</dt> <dt>

[Компонент обработки изображений Windows (WIC)](../wic/-wic-about-windows-imaging-codec.md)
</dt> </dl>

 

 