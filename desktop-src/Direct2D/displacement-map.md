---
title: Результат распределения искривлений
description: Используйте эффекты распределения смещения, чтобы не размещать пикселы входного изображения по значениям интенсивности второго входного изображения.
ms.assetid: 07AA64B1-B570-428E-924F-D7DF3E4DB3F8
keywords:
- результат распределения искривлений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd0ad2deb0c584ccc9c55faebd60f803d66efa42
ms.sourcegitcommit: a1494c819bc5200050696e66057f1020f5b142cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2020
ms.locfileid: "104135186"
---
# <a name="displacement-map-effect"></a>Результат распределения искривлений

Используйте эффекты распределения смещения, чтобы не размещать пикселы входного изображения по значениям интенсивности второго входного изображения.

Идентификатором CLSID для этого действия является CLSID \_ D2D1DisplacementMap.

-   [Пример изображения](#example-image)
-   [Свойства эффектов](#effect-properties)
-   [Цветовые каналы](#color-channels)
-   [Битовая карта вывода](#output-bitmap)
-   [Требования](#requirements)
-   [См. также](#related-topics)

## <a name="example-image"></a>Пример изображения



| До                                                           |
|------------------------------------------------------------------|
| ![изображение перед результатом.](images/default-before.jpg)       |
| После                                                            |
| ![изображение после преобразования.](images/19-displacementmap.png) |



 


```C++
ComPtr<ID2D1Effect> displacementMapEffect;
m_d2dContext->CreateEffect(CLSID_D2D1DisplacementMap, &displacementMapEffect);

displacementMapEffect->SetInput(0, bitmap);
displacementMapEffect->SetValue(D2D1_DISPLACEMENTMAP_PROP_SCALE, 100.0f);

// The second input of the displacement effect determines how the input image is transformed.
// For this example, we will use a turbulence effect as the second input to randomly distort the image.
ComPtr<ID2D1Effect> turbulenceEffect;
m_d2dContext->CreateEffect(CLSID_D2D1Turbulence, &turbulenceEffect);
displacementMapEffect->SetInputEffect(1, turbulenceEffect.Get());

m_d2dContext->BeginDraw();
m_d2dContext->DrawImage(displacementMapEffect.Get());
m_d2dContext->EndDraw();
```



Расположение пикселей в выходных данных определяется с помощью следующей формулы:

C "(x, y) = C (x + Scale \* (ксчаннелселектор (смещение смещения (x, y))-0,5), y + Scale \* (Ичаннелселектор (битовая карта смещения (x, y))-0,5))

Где:<dl> *C (x, y)* является выходным пикселем в (x, y).  
*C (x, y)* — это входной пиксель в (x, y).  
*Битовая карта смещения (x, y)* — это интенсивность пикселя смещения в указанных координатах  
*Ксчаннелселекторет* интенсивность выбранного канала RGBA из битовой карты смещения, которая вымещает изображение ввода в направлении X.  
*Ичаннелселекторет* интенсивность выбранного канала RGBA из битовой карты смещения, которая перемещает входной рисунок в направлении Y.  
</dl>

Этот результат позволяет повторно выполнить выборку входного изображения в соответствии со свойством Scale и интенсивностью изображения смещения. Он использует интерполяцию билинейной, если выборка между пикселями во входном изображении.

Этот результат работает с прямыми и предварительно умноженными альфа-образами. Формат вывода альфа совпадает с форматом ввода.

## <a name="effect-properties"></a>Свойства эффектов



| Отображаемое имя и перечисление индекса                                                   | Тип и значение по умолчанию                                                   | Описание                                                                                                                                                                               |
|--------------------------------------------------------------------------------------|--------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Масштабирование<br/> D2D1 \_ дисплацементмап \_ prop \_ Scale<br/>                       | FLOAT<br/> указано<br/>                                         | Умножает интенсивность выбранного канала от изображения смещения. Чем выше значение этого свойства, тем больше будет расположить Пиксели.<br/>                       |
| ксчаннелселект<br/> D2D1 \_ дисплацементмап \_ prop \_ X \_ \_ Выбор канала<br/> | \_Выбор канала \_ D2D1<br/> \_Селектор каналов \_ D2D1 \_<br/> | Этот результат извлекает интенсивность из этого канала цвета и использует его для пространственного размещения изображения в направлении X. Дополнительные сведения см. в разделе [цветовые каналы](#color-channels) .<br/> |
| ичаннелселект<br/> \_SELECT D2D1 \_ дисплацементмап \_ prop \_ Y \_<br/> | \_Выбор канала \_ D2D1<br/> \_Селектор каналов \_ D2D1 \_<br/> | Этот результат извлекает интенсивность из этого канала цвета и использует его для пространственного размещения изображения в направлении Y. Дополнительные сведения см. в разделе [цветовые каналы](#color-channels) .<br/> |



 

## <a name="color-channels"></a>Цветовые каналы



| Перечисление                | Описание                                                      |
|----------------------------|------------------------------------------------------------------|
| \_Выбор канала \_ D2D1 \_ R | Этот результат извлекает интенсивность выходных данных из красного канала.   |
| \_Селектор канала \_ D2D1 \_ G | Этот результат извлекает интенсивность выходных данных из зеленого канала. |
| \_Селектор каналов \_ D2D1 \_ B | Этот результат извлекает интенсивность выходных данных из синего канала.  |
| \_Селектор каналов \_ D2D1 \_ | Этот результат извлекает интенсивность выходных данных из альфа-канала. |



 

## <a name="output-bitmap"></a>Битовая карта вывода

Вы можете определить максимальный размер выходного точечного рисунка со следующими уравнениями:

Выводить точечный рисунок? ПКС = (размер входного точечного рисунка?) ( DIP) + Scale) \* (dpi пользователя/96)

Выходное битовое изображение<sub>y</sub> пикселей = (размер входного рисунка<sub>y</sub>(DIP) + масштаб) \* (dpi пользователя/96)

## <a name="requirements"></a>Требования



| Требование | Значение |
|--------------------------|------------------------------------------------------------------------------------|
| Минимальная версия клиента | Windows 8 и обновление платформы для \[ классических приложений Windows 7 \| приложения для Магазина Windows\] |
| Минимальная версия сервера | Windows 8 и обновление платформы для \[ классических приложений Windows 7 \| приложения для Магазина Windows\] |
| Header                   | d2d1effects. h                                                                      |
| Библиотека                  | D2D1. lib, дксгуид. lib                                                               |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[**ID2D1Effect**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1effect)
</dt> </dl>

 

