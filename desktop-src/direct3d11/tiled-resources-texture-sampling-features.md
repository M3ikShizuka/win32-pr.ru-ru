---
title: Функции выборки текстур для мозаичных ресурсов
description: В этом разделе описываются функции выборки текстуры для мозаичных ресурсов.
ms.assetid: E56737CE-C468-4D3C-84EE-E8EB2AB6F505
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1356b274b5e101a730e3de92a6cdf98b1f293515228fb420a77642f4603757c3
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120119484"
---
# <a name="tiled-resources-texture-sampling-features"></a>Функции выборки текстур для мозаичных ресурсов

В этом разделе описываются функции выборки текстуры для мозаичных ресурсов.

## <a name="requirements-of-tiled-resources-texture-sampling-features"></a>Требования к функциям выборки текстур для мозаичных ресурсов

Описанные здесь функции выборки текстуры нуждаются в уровне уровня [2](tier-2.md) для поддержки мозаичных ресурсов.

## <a name="shader-feedback-about-mapped-areas"></a>Обратная связь шейдера с сопоставленными областями

Любая инструкция шейдера, которая считывает и (или) выполняет запись в мозаичный ресурс, вызывает запись сведений о состоянии. Этот статус предоставляется как дополнительное возвращаемое значение в каждой инструкции доступа к ресурсу, которая попадает в 32-разрядный временный регистр. Содержимое возвращаемого значения является непрозрачным. То есть его прямое чтения программой-шейдером запрещено. Однако вы можете использовать функцию [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped), чтобы извлечь сведения о статусе.

## <a name="fully-mapped-check"></a>Проверка полного сопоставления

Функция [**CheckAccessFullyMapped**](/windows/desktop/direct3dhlsl/checkaccessfullymapped) интерпретирует статус, возвращенный при доступе к памяти и указывает, все ли запрошенные данные были сопоставлены в ресурсе. **CheckAccessFullyMapped** возвращает значение true (0xFFFFFFFF), если данные сопоставлены и значение false (0x00000000) в ином случае.

Иногда во время выполнения операций фильтров вес определенного текселя окажется равным 0.0. Примером является линейная выборка с координатами текстуры, точно попадающими на центр текселя: 3 других текселя (какие именно зависит от оборудования) участвуют в фильтре, но с весом равным 0. Эти тексели с нулевым весом совсем не влияют на результат фильтра, так что если они попадут на плитки **NULL**, они не будут считаться доступом без сопоставления. Обратите внимание, что те же гарантии действуют для фильтров текстур с несколькими уровнями MIP-карт. Если тексели в одной из этих карт не сопоставлены, но их вес равен 0, то эти тексели не будут считаться как доступ без сопоставления.

При выборке из формата, который содержит менее 4 компонентов (например, \_ Формат DXGI \_ R8 \_ UNORM), любые пикселей текстуры, которые попадают на плитки **null** , приводят к тому, что полученный доступ сопоставляется со **значением NULL** независимо от того, какие компоненты на самом деле просматриваются шейдером в результате. Например, чтение из R8 \_ UNORM и маскирование результата чтения в шейдере с помощью. Гба/. ИЗВ не появлялось, чтобы полностью прочитать текстуру. Но если адрес текселя это плитка, сопоставленная с **NULL**, операция все равно считается как доступ к **NULL** карте.

Шейдер может проверить этот статус и выполнить любую линию поведения в случае ошибки. Например, зарегистрировать «промахи» в журнале (например, через UAV-запись) и/или выдать другую инструкцию чтения, скрепленную с более грубым LOD, который точно сопоставлен. Приложению также может потребоваться отслеживать успешные операции доступа, чтобы понять, какая часть сопоставленного набора плиток находится в работе.

Одна сложность для ведения подобного журнала заключается в том, нет механизма для регистрации точного набора плиток, к которым был осуществлен доступ. Приложение может принимать консервативные предположения на основе сведений о координатах, используемых для доступа, а также использовать инструкцию Лод (например, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)), которая возвращает сведения о вычислении оборудования Лод.

Другая сложность — множество операций доступа будет для одних и тех же плиток, поэтому в журнале будет избыточная информация и возможны конфликты при обращении к памяти. Будет удобно, если оборудованию дать возможность не регистрировать доступ к плитке, если это было сделано где-то раньше. Возможно, состояние такого отслеживания можно будет сбросить из API (скорее всего на границе кадра).

## <a name="per-sample-minlod-clamp"></a>Скрепление MinLOD-по выборке

Чтобы помочь шейдеру избежать областей в мипмаппед мозаичных ресурсах, которые известны как несопоставленные, большинство инструкций шейдера, использующих выборку (фильтрация), имеют новый режим, позволяющий шейдеру передавать дополнительный параметр float32 Минлод среза в образец текстуры. Это значение указывается в численном пространстве MIP-карты представления в противоположность нижележащему ресурсу.

Оборудование выполняет [**Max**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-max)(Фшадерминлодкламп, фкомпутедлод) в том же месте в вычислении Лод, где происходит минлодный зажим для каждого ресурса, что также является **максимальным**().

Если результатом применения скрепления LOD для каждого образца и любых других закреплений LOD, определенных в дискретизаторе, является пустое множество, то результатом будет тот же доступ вне границ как и при поресурсном закреплении minLOD: 0 для компонент в формате поверхности и значения по умолчанию для отсутствующих компонент.

Инструкция Лод (например, [**tex2Dlod**](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-tex2dlod)), которая является префиксом для каждого образца минлод, описанного здесь, возвращает как векторную, так и нефрагментную Лод. Скрепленный LOD, возвращенный из этой инструкции LOD, отражает все скрепления, включая скрепления по ресурсам, но не скрепления по выборкам. Скрепление по выборке все равно известно шейдеру и контролируется им, поэтому автор шейдера по желанию может вручную применить это скрепление к возвращенному значением инструкции LOD.

## <a name="minmax-reduction-filtering"></a>Фильтрация сокращения минимумов и максимумов

Приложения могут управлять собственными структурами данных, которые сообщают о том, как выглядят сопоставления для мозаичного ресурса. Примером может быть поверхность, содержащая шаг текселя для хранения информации о каждой плитке в мозаичном ресурсе. Например, можно сохранить первый LOD, сопоставленный в заданном расположении плитки. С помощью тщательной выборки структуры данных аналогично тому, как предполагается выборка мозаичного ресурса, можно обнаружить минимальное Лод, полностью сопоставленное для всего объема фильтра текстур. Чтобы упростить этот процесс, Direct3D 11.2 предлагает новый режим дискретизатора общего назначения — min/max фильтрация.

Возможности min/max фильтрации для отслеживания LOD могут пригодиться и для других целей, например, для фильтрации поверхности глубин.

Min/max фильтрации сокращения — это режим дискретизаторов, который извлекает тот же набор текселей,что даст и обычный текстурный фильтр. Но вместо смешивания значений для получения результата, он возвращает min() или max() извлеченных текселей по отдельным компонентам (например, минимум всех R-значений, отдельно от минимума всех G-значений и т. д).

Операции min/max действуют согласно правилам арифметической точности Direct3D. Порядок сравнений не важен.

Иногда во время операций фильтра, которые не относится к режиму min/max, вес определенного текселя может оказаться равен 0.0. Примером является линейная выборка с координатами текстуры, которые попадают непосредственно в шаг текселя Center-3 другие пикселей текстуры (то есть они могут варьироваться в зависимости от оборудования), участвующие в фильтре, но с нулевым весом. Любые из этих текселей, которые будут иметь вес 0 в фильтре, отличном от min/max, в случае фильтра min/max, по-прежнему не будут влиять на результат (и веса никаким образом не повлияют на работу фильтра min/max).

Полный список режимов фильтрации показан в перечислении [**\_ фильтров D3D11**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_filter) с МИНИМАЛЬным и максимальным значениями перечисления.

Поддержка этой функции зависит от поддержки [уровня 2](tier-2.md) для мозаичного распределения ресурсов.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Доступ конвейера к мозаичным ресурсам](pipeline-access-to-tiled-resources.md)
</dt> </dl>

 

 