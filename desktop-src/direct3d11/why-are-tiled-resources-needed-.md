---
title: Зачем нужны ресурсы мозаичного заполнения
description: Требуется выполнить мозаичное выделение ресурсов, так что память с графическим процессором не тратится на хранение областей поверхностей, к которым известно приложение, и оборудование может понять, как выполнять фильтрацию по смежным плиткам.
ms.assetid: E2179D65-56D3-481F-A5F3-B9C45A11A179
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d42ccccf66a73d224d8bab9a9d10c87cc330be43
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104983988"
---
# <a name="why-are-tiled-resources-needed"></a>Зачем нужны мозаичные ресурсы?

Требуется выполнить мозаичное выделение ресурсов, так что память с графическим процессором не тратится на хранение областей поверхностей, к которым известно приложение, и оборудование может понять, как выполнять фильтрацию по смежным плиткам.

В графической системе (то есть операционной системе, видеодрайвере и графическом оборудовании) без поддержки мозаичных ресурсов графическая система управляет всеми выделениями памяти Direct3D во время гранулярности подресурсов. Для [буфера](overviews-direct3d-11-resources-buffers.md)весь буфер является подресурсом. Для [текстуры](overviews-direct3d-11-resources-textures.md) (например, [**Texture2D**](/windows/desktop/direct3dhlsl/sm5-object-texture2d)) каждый уровень MIP является подресурсом. для массива текстуры (например, [**Texture2DArray**](/windows/desktop/direct3dhlsl/sm5-object-texture2darray)) каждый уровень MIP в заданном срезе массива является подресурсом. Графическая система лишь предоставляет возможность управлять сопоставлениями выделения памяти на этом уровне вложенных ресурсов. В контексте мозаичных ресурсов "сопоставление" означает, что данные видны GPU.

Предположим, что приложение знает, что определенной операции отрисовки необходим доступ лишь к небольшой части цепочки MIP-карт (возможно, даже не к полной области определенной MIP-карты). В идеале приложение должно сообщить графической системе об этой потребности. Тогда графическая система обеспечит сопоставление лишь необходимого количества памяти графического процессора, не задействуя лишнюю память. В реальности, без поддержки мозаичных ресурсов, графическая система может сообщить только о памяти, которая должна быть сопоставлена с GPU во время гранулярности подресурсов (например, диапазон полного уровня mipmap, к которому можно получить доступ). В графической системе также невозможен отказ от требования выделения памяти, поэтому возможно использование излишне большого количества памяти графического процессора для полного сопоставления всех вложенных ресурсов перед выполнением команды отрисовки, ссылающейся на какую-либо часть памяти. Это лишь одна проблема, которая затрудняет использование больших объемов памяти в Direct3D без поддержки мозаичного размещения ресурсов.

Direct3D 11 поддерживает [**Texture2Dные**](/windows/desktop/direct3dhlsl/sm5-object-texture2d) поверхности на заданной стороне до 16384 пикселей. Изображение, размером 16 384 пкс в ширину, 16 384 в высоту и 4 байтами на пиксель потребляет 1 ГБ видеопамяти (и добавление MIP-карт удваивает это значение). На практике редко возникает необходимость использовать в одной операции отрисовки весь 1 ГБ памяти.

Некоторые разработчики игр создают модели поверхностей ландшафтов размером плоть до 128 на 128 тыс. пикселей. На существующих графических процессорах это становится возможным благодаря разбиению поверхности на плитки, которые достаточно малы для обработки оборудованием. Приложение должно определить, какие плитки могут потребоваться, и загрузить их в кэш текстур графического процессора — систему программной подкачки. Существенный недостаток этого подхода состоит в том, что оборудование не знает о том, что происходит при разбиении на страницы: когда часть изображения должна отображаться на экране, на которой находятся плитки, оборудование не узнает, как выполнять фиксированную функцию (то есть эффективную) фильтрацию по плиткам. Это означает, что приложение, управляющее собственным программным разбиением на плитки, вынуждено использовать ручную фильтрацию текстур в коде шейдера (что требует очень большого количества ресурсов, если требуется высококачественная анизотропная фильтрация) и (или) тратить память на создание вокруг плиток полей, которые содержат данные из соседних плиток, чтобы аппаратная фильтрация с фиксированной функцией могла продолжать оказывать некоторую помощь.

Если мозаичное представление выделения поверхности может быть первым классом в графической системе, приложение может сообщить оборудованию, какие плитки сделать доступными. Таким образом меньшее количество памяти графического процессора тратится на хранение областей поверхности, доступ к которым, как известно приложению, осуществляться не будет. Оборудованию при этом известно, как производить фильтрацию соседних плиток, чтобы разрешить часть проблем, с которыми сталкиваются разработчики, выполняющие программное разделение на плитки самостоятельно.

Однако для того, чтобы решение было полнофункциональным, необходимо каким-то образом решить проблему того, что вне зависимости от наличия поддержки разбиения поверхности на плитки максимальные размеры поверхности в данный момент составляют 16 384 пикселей, что значительно меньше 128 тысяч, которые уже требуются приложениям. Одним из подходов может быть просто требование поддержки текстур большего размера оборудованием, однако такой подход связан с значительными расходами и компромиссами. Путь для фильтра текстур Direct3D 11 и путь подготовки к просмотру уже насыщены с точки зрения точности в соответствии с другими требованиями, такими как вспомогательные области окна просмотра, которые выходят за пределы поверхности во время подготовки к просмотру, или поддерживают отработку текстуры от края поверхности во время фильтрации. Существует возможность найти компромисс так, чтобы по мере увеличения размера текстуры за пределы 16 тысяч пикселей определенным образом снижались функциональные возможности или точность. Однако даже при этой уступке могут потребоваться дополнительные затраты на оборудование в плане способности всей аппаратной системы к переходу к текстурам увеличенного размера.

Со значительным увеличением размера текстур возникает проблема, состоящая в том, что координаты текстуры одинарной точности с плавающей запятой (и связанные интерполяторы для поддержки растеризации) не располагают достаточной точностью, чтобы безошибочно указывать расположение на поверхности. Это приводит к дрожанию при фильтрации текстур. Затратным решением является требование поддержки интерполятора двойной точности, но при наличии разумной альтернативы оно представляется избыточным.

Альтернативное имя для мозаичных ресурсов — «разреженная текстура». "Делимые" означает одновременно мозаичный характер ресурсов, а также, возможно, основную причину разбиения их на плитки — не все из них должны сопоставляться одновременно. На самом деле, приложение может создать мозаичный ресурс, в котором никакие данные не создаются для всех регионов и MIPS ресурса, намеренно. Таким образом, само содержимое может быть разреженным, а сопоставление содержимого в памяти GPU в заданное время будет подмножеством этого (еще более разреженным).

Другой сценарий, который может быть обслужен мозаичными ресурсами, включает несколько ресурсов различных измерений и форматов для совместного использования одной и той же памяти. Иногда приложения имеют особые наборы ресурсов, которые не должны использоваться одновременно, или ресурсы, которые создаются только для очень краткого использования и затем удаляются, после чего создаются другие ресурсы. Форма универсальности, которая может выдаваться из "мозаичных ресурсов", заключается в том, что можно разрешить пользователю указывать несколько различных ресурсов в одной (перекрывающей) памяти. Другими словами, создание и уничтожение "ресурсов" (которые определяют размер, формат и т. д.) может быть отделено от управления памятью, выделяемой для этих ресурсов, с точки зрения приложения.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Мозаичные ресурсы](tiled-resources.md)
</dt> </dl>

 

 