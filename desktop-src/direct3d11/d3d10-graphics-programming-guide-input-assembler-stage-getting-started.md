---
title: Начало работы с этапом Input-Assembler
description: Для инициализации этапа ввода-ассемблера необходимо выполнить несколько действий.
ms.assetid: 84c0ca29-2356-4b7f-98ee-ff1758edc540
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 513e7452eebf157a80d4239127bf1d04a014375f7bbaf06e4f5814199d7ba053
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119858214"
---
# <a name="getting-started-with-the-input-assembler-stage"></a>Начало работы с этапом Input-Assembler

Для инициализации этапа ввода-ассемблера необходимо выполнить несколько действий. Например, необходимо создать ресурсы буфера с данными вершин, необходимыми для конвейера, сообщить этапу IA, где находятся буферы и какие типы данных они содержат, и указать тип примитивов для сборки из данных.

Основные шаги, связанные с настройкой этапа IA, как показано в следующей таблице, описаны в этом разделе.



| Шаг                                                                                    | Описание                                                                                           |
|-----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| [Создание входных буферов](#create-input-buffers)                                           | Создание и инициализация входных буферов с входными данными вершин.                                           |
| [Создание объекта Input-Layout](#create-the-input-layout-object)                       | Определите, каким способом потоковая передача данных из буфера вершин будет выполняться на этапе IA с помощью объекта input-Layout. |
| [Привязка объектов к Input-Assembler этапу](#bind-objects-to-the-input-assembler-stage) | Привяжите созданные объекты (Входные буферы и объект макета ввода) к этапу IA.                 |
| [Укажите тип-примитив](#specify-the-primitive-type)                               | Определение того, как вершины будут собираться в примитивы.                                          |
| [Методы рисования вызова](#call-draw-methods)                                                 | Отправьте данные, привязанные к этапу IA через конвейер.                                             |



 

Когда вы понимаете эти шаги, переходите к [использованию значений System-Generated](d3d10-graphics-programming-guide-input-assembler-stage-using.md).

## <a name="create-input-buffers"></a>Создание входных буферов

Существует два типа входных буферов: [буферы вершин](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-resources-types) и буферы индексов. Буферы вершин предоставляют данные вершин на этап IA. Буферы индексов необязательны; они предоставляют индексы вершинам из буфера вершин. Вы можете создать один или несколько буферов вершин и, при необходимости, буфер индексов.

После создания ресурсов буфера необходимо создать объект макета ввода, чтобы описать макет данных на этапе IA, а затем привязать ресурсы буфера к этапу IA. Создание и привязка буферов не требуется, если шейдеры не используют буферы. Пример простой вершины и шейдера пикселей, который рисует один треугольник, см. [в разделе использование Input-Assembler этапа без буферов](d3d10-graphics-programming-guide-input-assembler-stage-no-buffers.md).

Дополнительные сведения о создании буфера вершин см. в разделе [Создание буфера вершин](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-resources-creating). Дополнительные сведения о создании буфера индексов см. в разделе Создание буфера индексов.

## <a name="create-the-input-layout-object"></a>Создание объекта Input-Layout

Объект входной макет инкапсулирует состояние входного этапа IA. Сюда входит описание входных данных, привязанных к этапу IA. Данные передаются на стадию IA из памяти из одного или нескольких буферов вершин. Описание определяет входные данные, привязанные из одного или нескольких буферов вершин, и дает среде выполнения возможность проверять типы входных данных на соответствие типам входных параметров шейдера. Эта проверка типа не только проверяет совместимость типов, но и то, что каждый из элементов, необходимых шейдеру, доступен в буферных ресурсах.

Объект макета ввода создается из массива описаний входных элементов и указателя на скомпилированный шейдер (см. раздел [**ID3D11Device:: креатеинпутлайаут**](/windows/desktop/api/D3D11/nf-d3d11-id3d11device-createinputlayout)). Массив содержит один или несколько входных элементов; Каждый элемент ввода описывает один элемент данных вершины из одного буфера вершин. Весь набор описаний input-element описывает все элементы vertex-data из всех буферов вершин, которые будут привязаны на этапе IA.

Следующее описание макета описывает один буфер вершин, который содержит три элемента данных вершины:


```
D3D11_INPUT_ELEMENT_DESC layout[] =
{
    { L"POSITION", 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 0, 
          D3D11_INPUT_PER_VERTEX_DATA, 0 },
    { L"TEXCOORD", 0, DXGI_FORMAT_R32G32_FLOAT, 0, 12, 
          D3D11_INPUT_PER_VERTEX_DATA, 0 },
    { L"NORMAL", 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 20, 
          D3D11_INPUT_PER_VERTEX_DATA, 0 },
};
```



Описание элемента ввода описывает каждый элемент, содержащийся в одной вершине в буфере вершин, включая размер, тип, расположение и назначение. Каждая строка определяет тип данных с помощью семантики, семантического индекса и формата данных. [Семантика](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics) — это текстовая строка, которая определяет, как будут использоваться данные. В этом примере первая строка определяет данные о положении 3 компонента (например,*XYZ*); Вторая строка определяет 2-компонентные данные текстуры (например,*UV*); Третья строка определяет обычные данные.

В этом примере описания входного элемента семантический индекс (второй параметр) устанавливается в ноль для всех трех строк. Семантический индекс помогает отличать две строки, использующие одну и ту же семантику. Так как в этом примере нет подобной семантики, для семантического индекса можно задать значение по умолчанию, равное нулю.

Третьим параметром является *Формат*. Формат (см. [**раздел \_ Формат DXGI**](/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format)) указывает количество компонентов на элемент и тип данных, определяющий размер данных для каждого элемента. Формат можно полностью ввести во время создания ресурса или создать ресурс с помощью **\_ формата DXGI**, который определяет количество компонентов в элементе, но оставляет тип данных не определенным.

### <a name="input-slots"></a>Входные слоты

Данные поступают на этап IA через входные данные, называемые *входными слотами*, как показано на следующем рисунке. На этапе IA есть *n* слотов ввода, которые предназначены для размещения до *n* буферов вершин, предоставляющих входные данные. Каждый буфер вершин должен быть назначен другому слоту; Эти сведения сохраняются в объявлении input-Layout при создании объекта input-Layout. Вы также можете указать смещение от начала каждого буфера до первого элемента в буфере для чтения.

![Иллюстрация входных слотов для этапа IA](images/d3d10-ia-slots.png)

Следующие два параметра — это *входной слот* и *смещение входных данных*. При использовании нескольких буферов их можно привязать к одному или нескольким входным слотам. Смещение ввода — это число байтов между началом буфера и началом данных.

### <a name="reusing-input-layout-objects"></a>Повторное использование объектов Input-Layout

Каждый объект макета ввода создается на основе сигнатуры шейдера. Это позволяет API проверить элементы входного макета в соответствии с подписью входного шейдера, чтобы убедиться в точности соответствия типов и семантики. Можно создать один объект макета ввода для многих шейдеров, если все входные сигнатуры шейдера точно совпадают.

## <a name="bind-objects-to-the-input-assembler-stage"></a>Привязка объектов к Input-Assembler этапу

После создания ресурсов буфера вершин и объекта макета входных данных их можно привязать к этапу IA, вызвав [**ссылку ID3D11DeviceContext:: иасетвертексбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetvertexbuffers) и [**ссылку ID3D11DeviceContext:: иасетинпутлайаут**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetinputlayout). В следующем примере показана привязка одного буфера вершин и объекта макета ввода к этапу IA:


```
UINT stride = sizeof( SimpleVertex );
UINT offset = 0;
g_pd3dDevice->IASetVertexBuffers( 
    0,                // the first input slot for binding
    1,                // the number of buffers in the array
    &g_pVertexBuffer, // the array of vertex buffers
    &stride,          // array of stride values, one for each buffer
    &offset );        // array of offset values, one for each buffer

// Set the input layout
g_pd3dDevice->IASetInputLayout( g_pVertexLayout );
```



Для привязки к объекту входного макета требуется только указатель на объект.

В предыдущем примере привязывается один буфер вершин. Однако несколько буферов вершин могут быть привязаны одним вызовом к [**ссылку ID3D11DeviceContext:: иасетвертексбуфферс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetvertexbuffers), а в следующем коде показан такой вызов для привязки трех буферов вершин:


```
UINT strides[3];
strides[0] = sizeof(SimpleVertex1);
strides[1] = sizeof(SimpleVertex2);
strides[2] = sizeof(SimpleVertex3);
UINT offsets[3] = { 0, 0, 0 };
g_pd3dDevice->IASetVertexBuffers( 
    0,                 //first input slot for binding
    3,                 //number of buffers in the array
    &g_pVertexBuffers, //array of three vertex buffers
    &strides,          //array of stride values, one for each buffer
    &offsets );        //array of offset values, one for each buffer
```



Буфер индекса привязан к этапу IA путем вызова [**ссылку ID3D11DeviceContext:: иасетиндексбуффер**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetindexbuffer).

## <a name="specify-the-primitive-type"></a>Укажите тип-примитив

После привязки входных буферов на этапе IA необходимо сообщить, как объединить вершины в примитивы. Это делается путем указания типа- [примитива](/windows/desktop/direct3d11/d3d10-graphics-programming-guide-primitive-topologies) путем вызова [**ссылку ID3D11DeviceContext:: иасетпримитиветопологи**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-iasetprimitivetopology); Следующий код вызывает эту функцию для определения данных в виде списка треугольников без соседей:


```
g_pd3dDevice->IASetPrimitiveTopology( D3D_PRIMITIVE_TOPOLOGY_TRIANGLELIST );
```



Остальные типы-примитивы перечислены в [**\_ \_ топологии примитивов D3D**](/windows/desktop/api/D3DCommon/ne-d3dcommon-d3d_primitive_topology).

## <a name="call-draw-methods"></a>Методы рисования вызова

После привязки входных ресурсов к конвейеру приложение вызывает метод Draw для отрисовки примитивов. Существует несколько методов Draw, которые показаны в следующей таблице. Некоторые буферы индексов, некоторые используют данные экземпляра и некоторые повторно используемые данные из этапа потоковой передачи переводятся в качестве входных данных на этапе входного ассемблера.



| Методы рисования                                                                                  | Описание                                                                                            |
|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| [**ID3D11DeviceContext::Draw**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-draw)                                 | Рисование неиндексированных, не являющихся экземплярами примитивов.                                                            |
| [**ID3D11DeviceContext::DrawInstanced**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawinstanced)               | Нарисуйте неиндексированные экземпляры-примитивы.                                                                |
| [**ID3D11DeviceContext::DrawIndexed**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexed)                   | Рисование индексированных, не являющихся экземплярами примитивов.                                                                |
| [**ID3D11DeviceContext::DrawIndexedInstanced**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawindexedinstanced) | Рисование индексированных, экземплярных примитивов.                                                                    |
| [**ID3D11DeviceContext::DrawAuto**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-drawauto)                         | Нарисуйте неиндексированные некластеризованные примитивы из входных данных, поступающих из этапа потокового вывода. |



 

Каждый метод Draw отображает один тип топологии. Во время отрисовки неполные примитивы (без достаточных вершин, отсутствующие индексы, частичные примитивы и т. д.) автоматически отбрасываются.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Этап ввода-ассемблера](d3d10-graphics-programming-guide-input-assembler-stage.md)
</dt> </dl>

 

 