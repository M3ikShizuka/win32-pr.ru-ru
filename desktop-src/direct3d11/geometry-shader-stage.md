---
title: Стадия шейдера геометрии
description: На этапе Geometry-Shader (GS) выполняется заданный приложением код шейдера с вершинами в качестве входных данных и возможность создания вершин на выходе.
ms.assetid: F3208862-980E-403F-9154-13B34A882787
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3099ed5ede8dd89dc607ed838ff6e3fabfb16a69
ms.sourcegitcommit: ca37395fd832e798375e81142b97cffcffabf184
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/24/2021
ms.locfileid: "110335368"
---
# <a name="geometry-shader-stage"></a><span data-ttu-id="210cb-103">Стадия шейдера геометрии</span><span class="sxs-lookup"><span data-stu-id="210cb-103">Geometry Shader Stage</span></span>

<span data-ttu-id="210cb-104">На этапе Geometry-Shader (GS) выполняется заданный приложением код шейдера с вершинами в качестве входных данных и возможность создания вершин на выходе.</span><span class="sxs-lookup"><span data-stu-id="210cb-104">The geometry-shader (GS) stage runs application-specified shader code with vertices as input and the ability to generate vertices on output.</span></span>

## <a name="the-geometry-shader"></a><span data-ttu-id="210cb-105">Шейдер геометрии</span><span class="sxs-lookup"><span data-stu-id="210cb-105">The Geometry Shader</span></span>

<span data-ttu-id="210cb-106">В отличие от шейдеров вершин, которые работают с одной вершиной, входные шейдеры Geometry являются вершинами для полного примитива (две вершины для линий, три вершины для треугольников или одна вершина для Point).</span><span class="sxs-lookup"><span data-stu-id="210cb-106">Unlike vertex shaders, which operate on a single vertex, the geometry shader's inputs are the vertices for a full primitive (two vertices for lines, three vertices for triangles, or single vertex for point).</span></span> <span data-ttu-id="210cb-107">Шейдеры Geometry также могут переносить данные вершин для примитивов, смежных с краями, в качестве входных данных (дополнительные две вершины для линии, дополнительные три для треугольника).</span><span class="sxs-lookup"><span data-stu-id="210cb-107">Geometry shaders can also bring in the vertex data for the edge-adjacent primitives as input (an additional two vertices for a line, an additional three for a triangle).</span></span> <span data-ttu-id="210cb-108">На следующем рисунке показан треугольник и линия со смежными вершинами.</span><span class="sxs-lookup"><span data-stu-id="210cb-108">The following illustration shows a triangle and a line with adjacent vertices.</span></span>

![иллюстрация треугольника и линии со смежными вершинами](images/d3d10-gs.png)

|     | <span data-ttu-id="210cb-110">Тип</span><span class="sxs-lookup"><span data-stu-id="210cb-110">Type</span></span>                |
|-----|-----------------|
| <span data-ttu-id="210cb-111">**TV**</span><span class="sxs-lookup"><span data-stu-id="210cb-111">**TV**</span></span>  | <span data-ttu-id="210cb-112">Вершина треугольника</span><span class="sxs-lookup"><span data-stu-id="210cb-112">Triangle vertex</span></span> |
| <span data-ttu-id="210cb-113">**AV**</span><span class="sxs-lookup"><span data-stu-id="210cb-113">**AV**</span></span>  | <span data-ttu-id="210cb-114">Смежная вершина</span><span class="sxs-lookup"><span data-stu-id="210cb-114">Adjacent vertex</span></span> |
| <span data-ttu-id="210cb-115">**LV**</span><span class="sxs-lookup"><span data-stu-id="210cb-115">**LV**</span></span>  | <span data-ttu-id="210cb-116">Вершина линии</span><span class="sxs-lookup"><span data-stu-id="210cb-116">Line vertex</span></span>     |



 

<span data-ttu-id="210cb-117">На этапе Geometry-Shader может использоваться \_ [формируемое системой значение](d3d10-graphics-programming-guide-input-assembler-stage-using.md) SV примитивеид, автоматически формируемое IA.</span><span class="sxs-lookup"><span data-stu-id="210cb-117">The geometry-shader stage can consume the SV\_PrimitiveID [system-generated value](d3d10-graphics-programming-guide-input-assembler-stage-using.md) that is auto-generated by the IA.</span></span> <span data-ttu-id="210cb-118">Это позволяет при необходимости получать или вычислять данные каждого примитива.</span><span class="sxs-lookup"><span data-stu-id="210cb-118">This allows per-primitive data to be fetched or computed if desired.</span></span>

<span data-ttu-id="210cb-119">На этапе геометрического шейдера может выводиться несколько вершин, формирующих одну выбранную топологию (доступны следующие топологии выходных данных этапа GS: тристрип, линестрип и поинтлист).</span><span class="sxs-lookup"><span data-stu-id="210cb-119">The geometry-shader stage is capable of outputting multiple vertices forming a single selected topology (GS stage output topologies available are: tristrip, linestrip, and pointlist).</span></span> <span data-ttu-id="210cb-120">Количество сгенерированных примитивов может свободно меняться при каждом вызове шейдера геометрии, но максимальное количество генерируемых вершин необходимо объявить статически.</span><span class="sxs-lookup"><span data-stu-id="210cb-120">The number of primitives emitted can vary freely within any invocation of the geometry shader, though the maximum number of vertices that could be emitted must be declared statically.</span></span> <span data-ttu-id="210cb-121">Длины полос, выдаваемые из вызова шейдера Geometry, могут быть произвольными, а новые ленты можно создавать с помощью функции [рестартстрип](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL.</span><span class="sxs-lookup"><span data-stu-id="210cb-121">Strip lengths emitted from a geometry shader invocation can be arbitrary, and new strips can be created via the [RestartStrip](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL function.</span></span>

<span data-ttu-id="210cb-122">Выходные данные шейдера геометрии можно передавать на этап растеризации или в буфер вершин в памяти через этап потокового вывода.</span><span class="sxs-lookup"><span data-stu-id="210cb-122">Geometry shader output may be fed to the rasterizer stage and/or to a vertex buffer in memory via the stream output stage.</span></span> <span data-ttu-id="210cb-123">Выходные данные, переданные в память, разворачиваются в отдельные списки точек, линий или треугольников (в точности так, как они были бы переданы средству отрисовки).</span><span class="sxs-lookup"><span data-stu-id="210cb-123">Output fed to memory is expanded to individual point/line/triangle lists (exactly as they would be passed to the rasterizer).</span></span>

<span data-ttu-id="210cb-124">Если шейдер геометрии активен, он вызывается единожды для каждого примитива, переданного или созданного ранее в рамках конвейера.</span><span class="sxs-lookup"><span data-stu-id="210cb-124">When a geometry shader is active, it is invoked once for every primitive passed down or generated earlier in the pipeline.</span></span> <span data-ttu-id="210cb-125">При каждом вызове шейдер геометрии считает входными данные вызвавшего его примитива, будь то одна точка, одна линия или один треугольник.</span><span class="sxs-lookup"><span data-stu-id="210cb-125">Each invocation of the geometry shader sees as input the data for the invoking primitive, whether that is a single point, a single line, or a single triangle.</span></span> <span data-ttu-id="210cb-126">Полоса треугольника с более раннего этапа конвейера привела бы к вызову шейдера геометрии для каждого отдельного треугольника в полосе (как если бы полоса была развернута в список треугольников).</span><span class="sxs-lookup"><span data-stu-id="210cb-126">A triangle strip from earlier in the pipeline would result in an invocation of the geometry shader for each individual triangle in the strip (as if the strip were expanded out into a triangle list).</span></span> <span data-ttu-id="210cb-127">Все входные данные для каждой вершины в отдельном примитиве доступны (т. е. 3 вершины для треугольника), а также соседние данные вершин, если они применимы или доступны.</span><span class="sxs-lookup"><span data-stu-id="210cb-127">All the input data for each vertex in the individual primitive is available (i.e. 3 vertices for triangle), plus adjacent vertex data if applicable/available.</span></span>

<span data-ttu-id="210cb-128">Шейдер геометрии выводит данные по одной вершине путем добавления вершин к объекту потокового вывода.</span><span class="sxs-lookup"><span data-stu-id="210cb-128">A geometry shader outputs data one vertex at a time by appending vertices to an output stream object.</span></span> <span data-ttu-id="210cb-129">Топология потоков определяется с помощью фиксированного объявления, выбрав один из следующих элементов: Поинтстреам, Линестреам или Трианглестреам в качестве выходных данных для этапа GS.</span><span class="sxs-lookup"><span data-stu-id="210cb-129">The topology of the streams is determined by a fixed declaration, choosing one of: PointStream, LineStream, or TriangleStream as the output for the GS stage.</span></span> <span data-ttu-id="210cb-130">Существует три типа объектов Stream: Поинтстреам, Линестреам и Трианглестреам, которые являются объектами в шаблоне.</span><span class="sxs-lookup"><span data-stu-id="210cb-130">There are three types of stream objects available, PointStream, LineStream and TriangleStream which are all templated objects.</span></span> <span data-ttu-id="210cb-131">Топология выходных данных определяется их соответствующим типом объекта, а формат вершин, добавленных к потоку, определяется типом шаблона.</span><span class="sxs-lookup"><span data-stu-id="210cb-131">The topology of the output is determined by their respective object type, while the format of the vertices appended to the stream is determined by the template type.</span></span> <span data-ttu-id="210cb-132">Выполнение экземпляра шейдера геометрии атомарно относительно других вызовов с тем исключением, что добавляемые в потоки данные последовательны.</span><span class="sxs-lookup"><span data-stu-id="210cb-132">Execution of a geometry shader instance is atomic from other invocations, except that data added to the streams is serial.</span></span> <span data-ttu-id="210cb-133">Выходные данные отдельного вызова шейдера геометрии независимы от других вызовов (хотя порядок учитывается).</span><span class="sxs-lookup"><span data-stu-id="210cb-133">The outputs of a given invocation of a geometry shader are independent of other invocations (though ordering is respected).</span></span> <span data-ttu-id="210cb-134">Шейдер геометрии, создающий полосы треугольников, при каждом вызове будет создавать новую полосу.</span><span class="sxs-lookup"><span data-stu-id="210cb-134">A geometry shader generating triangle strips will start a new strip on every invocation.</span></span>

<span data-ttu-id="210cb-135">Если выходные данные шейдера Geometry определены как системное интерпретируемое значение (например, ОКП \_ рендертаржетаррайиндекс или SV \_ ), оборудование просматривает эти данные и выполняет определенное поведение, зависящее от значения, а также передает данные на следующий этап шейдера для ввода.</span><span class="sxs-lookup"><span data-stu-id="210cb-135">When a geometry shader output is identified as a System Interpreted Value (e.g. SV\_RenderTargetArrayIndex or SV\_Position), hardware looks at this data and performs some behavior dependent on the value, in addition to being able to pass the data itself to the next shader stage for input.</span></span> <span data-ttu-id="210cb-136">Если такие выходные данные шейдера Geometry имеют значение для каждого примитива (например, ОКП \_ рендертаржетаррайиндекс или SV \_ виевпортаррайиндекс), а не на уровне каждой вершины (например, ОКП \_ КЛИПДИСТАНЦЕ \[ n \] или SV \_ ), то данные для каждого примитива берутся из ведущей вершины, порожденной для примитива.</span><span class="sxs-lookup"><span data-stu-id="210cb-136">When such data output from the geometry shader has meaning to the hardware on a per-primitive basis (such as SV\_RenderTargetArrayIndex or SV\_ViewportArrayIndex), rather than on a per-vertex basis (such as SV\_ClipDistance\[n\] or SV\_Position), the per-primitive data is taken from the leading vertex emitted for the primitive.</span></span>

<span data-ttu-id="210cb-137">Шейдер геометрии может создать частично завершенные примитивы, если работа шейдера геометрии завершена, а примитив остался неполным.</span><span class="sxs-lookup"><span data-stu-id="210cb-137">Partially completed primitives could be generated by the geometry shader if the geometry shader ends and the primitive is incomplete.</span></span> <span data-ttu-id="210cb-138">Неполные примитивы удаляются без уведомления.</span><span class="sxs-lookup"><span data-stu-id="210cb-138">Incomplete primitives are silently discarded.</span></span> <span data-ttu-id="210cb-139">Аналогичным образом обращается с частично завершенными примитивами сборщик входных данных.</span><span class="sxs-lookup"><span data-stu-id="210cb-139">This is similar to the way the IA treats partially completed primitives.</span></span>

<span data-ttu-id="210cb-140">шейдер геометрии может выполнять операции загрузки и выборки, для которых не требуются производные пространства экрана (samplelevel, samplecmplevelzero, samplegrad).</span><span class="sxs-lookup"><span data-stu-id="210cb-140">The geometry shader can perform load and texture sampling operations where screen-space derivatives are not required (samplelevel, samplecmplevelzero, samplegrad).</span></span>

<span data-ttu-id="210cb-141">Алгоритмы, которые могут быть реализованы в шейдере Geometry, включают:</span><span class="sxs-lookup"><span data-stu-id="210cb-141">Algorithms that can be implemented in the geometry shader include:</span></span>

-   <span data-ttu-id="210cb-142">расширение спрайтов точек;</span><span class="sxs-lookup"><span data-stu-id="210cb-142">Point Sprite Expansion</span></span>
-   <span data-ttu-id="210cb-143">динамические системы частиц;</span><span class="sxs-lookup"><span data-stu-id="210cb-143">Dynamic Particle Systems</span></span>
-   <span data-ttu-id="210cb-144">Создание меха/"плавников"</span><span class="sxs-lookup"><span data-stu-id="210cb-144">Fur/Fin Generation</span></span>
-   <span data-ttu-id="210cb-145">Создание объемных теней</span><span class="sxs-lookup"><span data-stu-id="210cb-145">Shadow Volume Generation</span></span>
-   <span data-ttu-id="210cb-146">Однопроходная отрисовка с использованием кубической карты</span><span class="sxs-lookup"><span data-stu-id="210cb-146">Single Pass Render-to-Cubemap</span></span>
-   <span data-ttu-id="210cb-147">Замена материалов по примитивам</span><span class="sxs-lookup"><span data-stu-id="210cb-147">Per-Primitive Material Swapping</span></span>
-   <span data-ttu-id="210cb-148">Настройка Per-Primitiveных материалов, включая создание координат барицентрик в виде примитивных данных, чтобы построитель текстуры мог выполнять интерполяцию настраиваемых атрибутов (например, при обычной интерполяции более высокого порядка см. [Пример CubeMapGS](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).</span><span class="sxs-lookup"><span data-stu-id="210cb-148">Per-Primitive Material Setup - Including generation of barycentric coordinates as primitive data so that a pixel shader can perform custom attribute interpolation (for an example of higher-order normal interpolation, see [CubeMapGS Sample](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="210cb-149">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="210cb-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="210cb-150">Графический конвейер</span><span class="sxs-lookup"><span data-stu-id="210cb-150">Graphics Pipeline</span></span>](overviews-direct3d-11-graphics-pipeline.md)
</dt> <dt>

[<span data-ttu-id="210cb-151">Этапы конвейера (Direct3D 10)</span><span class="sxs-lookup"><span data-stu-id="210cb-151">Pipeline Stages (Direct3D 10)</span></span>](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

 