---
title: Стадия шейдера геометрии
description: На этапе Geometry-Shader (GS) выполняется заданный приложением код шейдера с вершинами в качестве входных данных и возможность создания вершин на выходе.
ms.assetid: F3208862-980E-403F-9154-13B34A882787
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 94d568b9eb62b2545721acebfda865f7f2553597fb999a3a647164106c836369
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119952914"
---
# <a name="geometry-shader-stage"></a>Стадия шейдера геометрии

На этапе Geometry-Shader (GS) выполняется заданный приложением код шейдера с вершинами в качестве входных данных и возможность создания вершин на выходе.

## <a name="the-geometry-shader"></a>Шейдер геометрии

В отличие от шейдеров вершин, которые работают с одной вершиной, входные шейдеры Geometry являются вершинами для полного примитива (две вершины для линий, три вершины для треугольников или одна вершина для Point). Шейдеры Geometry также могут переносить данные вершин для примитивов, смежных с краями, в качестве входных данных (дополнительные две вершины для линии, дополнительные три для треугольника). На следующем рисунке показан треугольник и линия со смежными вершинами.

![иллюстрация треугольника и линии со смежными вершинами](images/d3d10-gs.png)

|     | Тип                |
|-----|-----------------|
| **TV**  | Вершина треугольника |
| **AV**  | Смежная вершина |
| **LV**  | Вершина линии     |



 

На этапе Geometry-Shader может использоваться \_ [формируемое системой значение](d3d10-graphics-programming-guide-input-assembler-stage-using.md) SV примитивеид, автоматически формируемое IA. Это позволяет при необходимости получать или вычислять данные каждого примитива.

На этапе геометрического шейдера может выводиться несколько вершин, формирующих одну выбранную топологию (доступны следующие топологии выходных данных этапа GS: тристрип, линестрип и поинтлист). Количество сгенерированных примитивов может свободно меняться при каждом вызове шейдера геометрии, но максимальное количество генерируемых вершин необходимо объявить статически. Длины полос, выдаваемые из вызова шейдера Geometry, могут быть произвольными, а новые ленты можно создавать с помощью функции [рестартстрип](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-so-restartstrip) HLSL.

Выходные данные шейдера геометрии можно передавать на этап растеризации или в буфер вершин в памяти через этап потокового вывода. Выходные данные, переданные в память, разворачиваются в отдельные списки точек, линий или треугольников (в точности так, как они были бы переданы средству отрисовки).

Если шейдер геометрии активен, он вызывается единожды для каждого примитива, переданного или созданного ранее в рамках конвейера. При каждом вызове шейдер геометрии считает входными данные вызвавшего его примитива, будь то одна точка, одна линия или один треугольник. Полоса треугольника с более раннего этапа конвейера привела бы к вызову шейдера геометрии для каждого отдельного треугольника в полосе (как если бы полоса была развернута в список треугольников). Все входные данные для каждой вершины в отдельном примитиве доступны (т. е. 3 вершины для треугольника), а также соседние данные вершин, если они применимы или доступны.

Шейдер геометрии выводит данные по одной вершине путем добавления вершин к объекту потокового вывода. Топология потоков определяется с помощью фиксированного объявления, выбрав один из следующих элементов: Поинтстреам, Линестреам или Трианглестреам в качестве выходных данных для этапа GS. Существует три типа объектов Stream: Поинтстреам, Линестреам и Трианглестреам, которые являются объектами в шаблоне. Топология выходных данных определяется их соответствующим типом объекта, а формат вершин, добавленных к потоку, определяется типом шаблона. Выполнение экземпляра шейдера геометрии атомарно относительно других вызовов с тем исключением, что добавляемые в потоки данные последовательны. Выходные данные отдельного вызова шейдера геометрии независимы от других вызовов (хотя порядок учитывается). Шейдер геометрии, создающий полосы треугольников, при каждом вызове будет создавать новую полосу.

Если выходные данные шейдера Geometry определены как системное интерпретируемое значение (например, ОКП \_ рендертаржетаррайиндекс или SV \_ ), оборудование просматривает эти данные и выполняет определенное поведение, зависящее от значения, а также передает данные на следующий этап шейдера для ввода. Если такие выходные данные шейдера Geometry имеют значение для каждого примитива (например, ОКП \_ рендертаржетаррайиндекс или SV \_ виевпортаррайиндекс), а не на уровне каждой вершины (например, ОКП \_ КЛИПДИСТАНЦЕ \[ n \] или SV \_ ), то данные для каждого примитива берутся из ведущей вершины, порожденной для примитива.

Шейдер геометрии может создать частично завершенные примитивы, если работа шейдера геометрии завершена, а примитив остался неполным. Неполные примитивы удаляются без уведомления. Аналогичным образом обращается с частично завершенными примитивами сборщик входных данных.

шейдер геометрии может выполнять операции загрузки и выборки, для которых не требуются производные пространства экрана (samplelevel, samplecmplevelzero, samplegrad).

Алгоритмы, которые могут быть реализованы в шейдере Geometry, включают:

-   расширение спрайтов точек;
-   динамические системы частиц;
-   Создание меха/"плавников"
-   Создание объемных теней
-   Однопроходная отрисовка с использованием кубической карты
-   Замена материалов по примитивам
-   Настройка Per-Primitiveных материалов, включая создание координат барицентрик в виде примитивных данных, чтобы построитель текстуры мог выполнять интерполяцию настраиваемых атрибутов (например, при обычной интерполяции более высокого порядка см. [Пример CubeMapGS](https://msdn.microsoft.com/library/Ee416398(v=VS.85).aspx)).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Графический конвейер](overviews-direct3d-11-graphics-pipeline.md)
</dt> <dt>

[Этапы конвейера (Direct3D 10)](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

 