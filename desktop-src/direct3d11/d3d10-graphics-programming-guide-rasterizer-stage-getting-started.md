---
title: начало работы с этапом средства прорисовки
description: В этом разделе описывается настройка окна просмотра, прямоугольника ножниц, состояния средства прорисовки и множественная выборка.
ms.assetid: d78c3845-76fd-4bd7-a603-bb1d8c66ac49
keywords:
- многовыборка, состояние средства отображения программной прорисовки (Direct3D 10)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ac95a15221f6fd4bd422e96c0686816afb35d4e8
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104337580"
---
# <a name="getting-started-with-the-rasterizer-stage"></a>начало работы с этапом средства прорисовки

В этом разделе описывается настройка окна просмотра, прямоугольника ножниц, состояния средства прорисовки и множественная выборка.

## <a name="set-the-viewport"></a>Задание окна просмотра

Окно просмотра сопоставляет позиции вершины (в пространстве обрезки) с положениями целевого объекта отрисовки. На этом шаге трехмерные позиции масштабируются в двухмерном пространстве. Цель прорисовки ориентирована на оси Y, указывающие вниз. для этого необходимо, чтобы координаты Y были отражены в масштабе окна просмотра. Кроме того, экстенты x и y (диапазон значений x и y) масштабируются в соответствии с размером окна просмотра согласно следующим формулам:


```
X = (X + 1) * Viewport.Width * 0.5 + Viewport.TopLeftX
Y = (1 - Y) * Viewport.Height * 0.5 + Viewport.TopLeftY
Z = Viewport.MinDepth + Z * (Viewport.MaxDepth - Viewport.MinDepth) 
```



В этом руководстве 1 создается окно просмотра 640 × 480 с помощью [**\_ окна просмотра D3D11**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_viewport) и вызывается [**ссылку ID3D11DeviceContext:: рссетвиевпортс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-rssetviewports).


```
    D3D11_VIEWPORT vp[1];
    vp[0].Width = 640.0f;
    vp[0].Height = 480.0f;
    vp[0].MinDepth = 0;
    vp[0].MaxDepth = 1;
    vp[0].TopLeftX = 0;
    vp[0].TopLeftY = 0;
    g_pd3dDevice->RSSetViewports( 1, vp );
```



В описании окна просмотра указывается размер окна просмотра, диапазон для отображения глубины (с помощью *миндепс* и *MaxDepth*) и расположение верхнего левого края окна просмотра. *Миндепс* должно быть меньше или равно *MaxDepth*; диапазоны для *миндепс* и *MaxDepth* находятся в диапазоне от 0,0 до 1,0 включительно. Обычно окно просмотра сопоставляется с целевым объектом отрисовки, но не является обязательным. Кроме того, окно просмотра не обязательно должно иметь тот же размер или расположение, что и целевой объект рендеринга.

Можно создать массив окна просмотра, но только один из них можно применить к примитивным выходным данным из шейдера Geometry. Одновременно можно задать только одно окно просмотра. В процессе растрирования конвейер использует окно просмотра по умолчанию (и прямоугольный прямоугольник, который обсуждается в следующем разделе). Значение по умолчанию всегда является первым окном просмотра (или прямоугольным прямоугольником) в массиве. Для выполнения примитивного выбора окна просмотра в шейдере Geometry укажите семантику Виевпортаррайиндекс для соответствующего компонента вывода GS в объявлении выходной подписи GS.

Максимальное количество окна просмотра (и прямоугольных прямоугольников), которое может быть привязано к этапу средства прорисовки в любой момент времени, равно 16 (задается в окне **\_ просмотра D3D11 \_ и \_ \_ число объектов сЦиссоррект \_ \_ на \_ конвейер**).

## <a name="set-the-scissor-rectangle"></a>Задать прямоугольный прямоугольник

Прямоугольный прямоугольник дает еще одну возможность уменьшить количество пикселей, которые будут отправлены на этап слияния выходных данных. Пиксели за пределами прямоугольной прямоугольной области отбрасываются. Размер прямоугольной прямоугольной области задается в целых числах. Только один прямоугольный прямоугольник (на основе *виевпортаррайиндекс* в [семантике системных значений](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics)) можно применить к треугольнику во время растрирования.

Чтобы включить прямоугольный прямоугольник, используйте элемент *сЦиссоренабле* (в [**D3D11 \_ растеризации \_ DESC1**](/windows/desktop/api/D3D11_1/ns-d3d11_1-cd3d11_rasterizer_desc1)). Прямоугольный прямоугольник по умолчанию является пустым прямоугольником; то есть все значения Rect равны 0. Иными словами, если не настроить прямоугольный прямоугольник и ножницы включены, вы не будете пересылать Пиксели на этап слияния вывода. Наиболее распространенной установкой является инициализация прямоугольного прямоугольника до размера окна просмотра.

Чтобы задать для устройства массив прямоугольных прямоугольников, вызовите [**ссылку ID3D11DeviceContext:: рссетсЦиссорректс**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-rssetscissorrects) с [**D3D11 \_ Rect**](d3d11-rect.md).


```
D3D11_RECT rects[1];
  rects[0].left = 0;
  rects[0].right = 640;
  rects[0].top = 0;
  rects[0].bottom = 480;

  D3DDevice->RSSetScissorRects( 1, rects );
```



Этот метод принимает два параметра: (1) число прямоугольников в массиве и (2) массив прямоугольников.

Конвейер использует индекс прямоугольной области по умолчанию во время растрирования (по умолчанию это прямоугольник нулевого размера с отключенной обрезками). Чтобы переопределить это, укажите в \_ объявлении выходной сигнатуры GS семантику SV виевпортаррайиндекс для выходного компонента GS. Это приведет к тому, что этап GS пометит этот компонент вывода GS в качестве компонента, созданного системой, с этой семантикой. Этап средства развертки распознает эту семантику и будет использовать параметр, к которому он присоединен, в качестве индекса прямоугольной прямоугольной области для доступа к массиву прямоугольных прямоугольников. Не забудьте сообщить этапу средства создания программной прорисовки, что вы определили, какой прямоугольный прямоугольник задаете, включив значение *сЦиссоренабле* в описании средства программной прорисовки перед созданием объекта средства программной прорисовки.

## <a name="set-rasterizer-state"></a>Задать состояние средства отображения программной прорисовки

Начиная с Direct3D 10, состояние средства программной прорисовки инкапсулируется в объекте состояния средства программной прорисовки. Можно создать до 4096 объектов состояния средства прорисовки, которые затем можно задать для устройства, передав обработчик в объект State.

Используйте [**ID3D11Device1:: CreateRasterizerState1**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11device1-createrasterizerstate1) для создания объекта состояния средства программной прорисовки из описания средства создания программной прорисовки (см. раздел [**D3D11 \_ растеризации \_ DESC1**](/windows/desktop/api/D3D11_1/ns-d3d11_1-cd3d11_rasterizer_desc1)).


```
    ID3D11RasterizerState1 * g_pRasterState;

    D3D11_RASTERIZER_DESC1 rasterizerState;
    rasterizerState.FillMode = D3D11_FILL_SOLID;
    rasterizerState.CullMode = D3D11_CULL_FRONT;
    rasterizerState.FrontCounterClockwise = true;
    rasterizerState.DepthBias = false;
    rasterizerState.DepthBiasClamp = 0;
    rasterizerState.SlopeScaledDepthBias = 0;
    rasterizerState.DepthClipEnable = true;
    rasterizerState.ScissorEnable = true;
    rasterizerState.MultisampleEnable = false;
    rasterizerState.AntialiasedLineEnable = false;
    rasterizerState.ForcedSampleCount = 0;
    pd3dDevice->CreateRasterizerState1( &rasterizerState, &g_pRasterState );
```



В этом примере набора состояний может быть, возможно, самая базовая настройка средства программной прорисовки:

-   Режим сплошной заливки
-   Изъятие или удаление задних граней; Предполагаемый порядок поворота по часовой стрелке для примитивов
-   Отключить смещение глубины, но включить буферизацию глубины и включить прямоугольный прямоугольник
-   Отключение многовыборочной и многострочного сглаживания

Кроме того, базовые операции программной прорисовки всегда включают следующее: обрезка (в представлении фрустум), деление перспективы и масштаб окна просмотра. После успешного создания объекта состояния средства программной прорисовки задайте устройство следующим образом:


```
    pd3dDevice->RSSetState(g_pRasterState);
```



### <a name="multisampling"></a>Множественная дискретизация

Множественная выборка демонстрирует некоторые или все компоненты изображения с более высоким разрешением (за которым следует понижение до исходного разрешения), чтобы уменьшить наиболее видимую форму псевдонимов, вызванную рисованием краев многоугольников. Несмотря на то, что для множественной выборки требуются образцы в виде фрагментов, в современных GPU реализуется многовыборка, чтобы построитель текстуры выполнялся один раз на пиксель. Это обеспечивает приемлемый компромисс между производительностью (особенно в приложении, привязанном к GPU) и сглаживанием окончательного образа.

Чтобы использовать многофакторную выборку, задайте поле Enable в [**описании растрирования**](/windows/desktop/api/D3D11_1/ns-d3d11_1-cd3d11_rasterizer_desc1), создайте целевой объект рендеринга с множественной выборкой и либо прочтите целевой объект отрисовки с помощью шейдера, чтобы разрешить выборку в один цвет пикселя, либо вызовите [**ссылку ID3D11DeviceContext:: ресолвесубресаурце**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-resolvesubresource) для разрешения образцов с помощью видеоадаптера. Наиболее распространенным сценарием является прорисовка в один или несколько целевых объектов рендеринга с несколькими примерами.

Многовыборочная выборка не зависит от того, используется ли образец маски, включено [альфа-покрытие](d3d10-graphics-programming-guide-blend-state.md) или операции с наборами элементов (которые всегда выполняются по образцу).

На тестирование глубины влияет множественная выборка:

-   Если включена многовыборочная выборка, для выборки глубины используется интерполяция, а для каждого образца выполняется проверка глубины и трафарета. выходной цвет шейдера пикселей дублируется для всех передаваемых образцов. Если глубина выходных данных шейдера пикселей превышает глубину, значение глубины дублируется для всех выборок (хотя этот сценарий теряет преимущество многовыборки).
-   Если множественная выборка отключена, тестирование глубины и набора элементов по-прежнему выполняется для каждого образца, но глубина не поддается интерполяции по образцу.

Не существует ограничений на смешивание многовыборочной и многовыборочной отрисовки в пределах одного целевого объекта рендеринга. Если включить многофакторную выборку и нарисовать на целевой объект рендеринга, не являющийся множественной выборкой, то результат будет таким же, как если бы многовыборочная выборка не была включена. выборка выполняется с одним примером на пиксель.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Этап растеризации](d3d10-graphics-programming-guide-rasterizer-stage.md)
</dt> </dl>

 

 