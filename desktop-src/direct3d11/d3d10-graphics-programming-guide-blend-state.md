---
title: Настройка функций смешения
description: Операции смешения выполняются на всех выходных данных шейдера пикселей (значение RGBA) перед записью выходного значения в целевой объект отрисовки. Если включена многовыборка, смешивание выполняется для каждого мультисэмплинга; в противном случае смешивание выполняется для каждого пикселя.
ms.assetid: f5c79baf-7bd3-4f58-abe7-8e96cd6be9d3
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 08acf1ea286b29a1cb96873bbfe170c6f38699f7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104997063"
---
# <a name="configuring-blending-functionality"></a>Настройка функций смешения

Операции смешения выполняются на всех выходных данных шейдера пикселей (значение RGBA) перед записью выходного значения в целевой объект отрисовки. Если включена многовыборка, смешивание выполняется для каждого мультисэмплинга; в противном случае смешивание выполняется для каждого пикселя.

-   [Создание состояния смешения](#create-the-blend-state)
-   [Привязка состояния смешения](#bind-the-blend-state)
-   [Разделы, посвященные расширенному смешению](#advanced-blending-topics)
    -   [Альфа-версия](#alpha-to-coverage)
    -   [Выходные данные шейдера пикселей смешения](#blending-pixel-shader-outputs)
-   [См. также](#related-topics)

## <a name="create-the-blend-state"></a>Создание состояния смешения

Состояние смешения — это коллекция состояний, используемых для управления наложением. Эти состояния (определенные в [**D3D11 \_ Blend \_ DESC1**](/windows/desktop/api/D3D11_1/ns-d3d11_1-cd3d11_blend_desc1)) используются для создания объекта состояния смешения путем вызова [**ID3D11Device1:: CreateBlendState1**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11device1-createblendstate1).

Например, ниже приведен очень простой пример создания состояния смешения, который отключает альфа-смешение и не использует маскирование пикселов для каждого компонента.


```
ID3D11BlendState1* g_pBlendStateNoBlend = NULL;

D3D11_BLEND_DESC1 BlendState;
ZeroMemory(&BlendState, sizeof(D3D11_BLEND_DESC1));
BlendState.RenderTarget[0].BlendEnable = FALSE;
BlendState.RenderTarget[0].RenderTargetWriteMask = D3D11_COLOR_WRITE_ENABLE_ALL;
pd3dDevice->CreateBlendState1(&BlendState, &g_pBlendStateNoBlend);
```



Этот пример похож на [Пример HLSLWithoutFX10](https://msdn.microsoft.com/library/Ee416414(v=VS.85).aspx).

## <a name="bind-the-blend-state"></a>Привязка состояния смешения

После создания объекта состояния Blend привяжите объект состояния Blend к этапу слияния вывода путем вызова [**ссылку ID3D11DeviceContext:: омсетблендстате**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-omsetblendstate).


```
float blendFactor[4] = { 0.0f, 0.0f, 0.0f, 0.0f };
UINT sampleMask   = 0xffffffff;

pd3dDevice->OMSetBlendState(g_pBlendStateNoBlend, blendFactor, sampleMask);
```



Этот API принимает три параметра: объект состояния Blend, коэффициент смешения четырех компонентов и пример маски. Можно передать **значение NULL** для объекта режима Blend, чтобы указать состояние смешения по умолчанию или передать объект состояния Blend. Если вы создали объект-состояние Blend с [**\_ \_ \_ коэффициентом смешения D3D11 Blend**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_blend) или [**D3D11 \_ Blend \_ Inv \_ \_**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_blend), можно передать коэффициент смешения для модуляции значений для шейдера пикселей, целевого объекта прорисовки или и того и другого. Если вы не создали объект состояния Blend с коэффициентом **\_ \_ смешения D3D11 \_ Blend** или **D3D11 \_ Blend \_ Inv \_ \_**, вы по-прежнему можете передать коэффициент смешения, отличный от NULL, но на этапе смешения не используется коэффициент смешения; среда выполнения сохраняет коэффициент смешения, и позднее можно вызвать [**ссылку ID3D11DeviceContext:: омжетблендстате**](/windows/desktop/api/D3D11/nf-d3d11-id3d11devicecontext-omgetblendstate) , чтобы получить коэффициент смешения. Если передать **значение NULL**, среда выполнения использует или сохраняет коэффициент смешения, равный {1, 1, 1, 1}. Образец маски — это определяемая пользователем маска, которая определяет способ выборки существующего целевого объекта отрисовки перед его обновлением. Маска выборки по умолчанию — 0xFFFFFFFF, которая обозначает выборку точек.

В самых глубоких схемах буферизации точка, ближайшая к камере, — это тот, который рисуется. При [настройке состояния трафарета глубины](d3d10-graphics-programming-guide-depth-stencil.md)элемент **Депсфунк** [**\_ шаблона глубины D3D11 \_ \_ DESC**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_depth_stencil_desc) может быть любым [**D3D11ным \_ сравнением \_ Func**](/windows/desktop/api/D3D11/ne-d3d11-d3d11_comparison_func). Как правило, необходимо, чтобы **Депсфунк** **D3D11 \_ Сравнение \_**, так что пикселы, ближайшие к камере, будут перезаписывать Пиксели, находящиеся за ними. Однако в зависимости от потребностей приложения для тестирования глубины можно использовать любые другие функции сравнения.

## <a name="advanced-blending-topics"></a>Разделы, посвященные расширенному смешению

-   [Альфа-версия](#alpha-to-coverage)
-   [Выходные данные шейдера пикселей смешения](#blending-pixel-shader-outputs)

### <a name="alpha-to-coverage"></a>Альфа-версия

Альфа-версия — это метод многофакторной выборки, который наиболее удобен для таких ситуаций, как сжатый фолиаже, где имеется несколько перекрывающихся многоугольников, которые используют альфа-прозрачность для определения краев внутри поверхности.

Вы можете использовать элемент **алфатоковеражеенабле** из [**D3D11 \_ Blend \_ DESC1**](/windows/desktop/api/D3D11_1/ns-d3d11_1-cd3d11_blend_desc1) или [**D3D11 \_ Blend \_ DESC**](/windows/desktop/api/D3D11/ns-d3d11-d3d11_blend_desc) , чтобы указать, будет ли среда выполнения преобразовывать. компонент (альфа) выходной регистр [( \_](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics)Alpha) из шейдера пикселей в n-этапную маску покрытия (с учетом n-примерного **рендертаржет**). Среда выполнения выполняет операцию **и** для этой маски с типичным примером покрытия для пикселя в примитиве (в дополнение к образцу маски), чтобы определить, какие примеры следует обновить во всех активных **рендертаржет**.

Если построитель текстуры выводит данные о [ \_ покрытии](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics), среда выполнения отключает альфа-покрытие.

> [!Note]  
> При многовыборочной обработке среда выполнения использует только одно покрытие для всех **рендертаржет**. Тот факт, что среда выполнения считывает и преобразует. из выходной [позиции \_ ОКП](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics)0 в покрытие, когда **алфатоковеражеенабле** имеет значение true, не изменяет. значение, которое передается в режим смешения по **рендертаржет** 0 (если **рендертаржет** нужно задать). В общем случае, если включить альфа-покрытие, вы не повлияете на то, как все цветовые выводы шейдеров пикселей взаимодействуют с **рендертаржет** s через [стадию слияния (Output-слиянием](d3d10-graphics-programming-guide-output-merger-stage.md) ), за исключением того, что среда выполнения выполняет операцию **и** маску покрытия с маской альфа-покрытия. Альфа-к покрытию работает независимо от того, может ли среда выполнения смешивать **рендертаржет** или использовать смешивание в **рендертаржет**.

 

Графическое оборудование не точно указывает, как оно преобразует построитель текстуры [ОКП в \_ мишень](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-semantics)0. a (альфа) в маску покрытия, за исключением того, что альфа-канал 0 (или меньше) должен сопоставляться с покрытием, а альфа-канал 1 (или больше) должен сопоставляться с полным покрытием (перед выполнением операции **и** с фактическим покрытием примитивов). Так как альфа-канал переходит от 0 к 1, результирующий объем обычно увеличивается монотонно. Тем не менее, оборудование может выполнять дизеринг участка, чтобы обеспечить более дискретизация альфа-значений за счет пространственного разрешения и шума. Альфа-значение NaN (не число) приводит к отсутствию покрытия (нулевой) маски.

Альфа-к покрытию также традиционно используется для прозрачности экранной дверцы или для определения подробного силхауеттес для непрозрачных других спрайтов.

### <a name="blending-pixel-shader-outputs"></a>Выходные данные шейдера пикселей смешения

Эта функция позволяет слиянию выходных данных использовать одновременно выходные данные шейдера пикселей в качестве источников входных данных в операцию смешения с одним целевым объектом рендеринга в слоте 0.

Этот пример принимает два результата и объединяет их в один проход, объединяя один в назначение с множителем, а другой — с помощью Add:


```
SrcBlend = D3D11_BLEND_ONE;
DestBlend = D3D11_BLEND_SRC1_COLOR;
```



Этот пример настраивает первый выход шейдера пикселей в качестве исходного цвета и второй выход в качестве коэффициента смешения для каждого цвета.


```
SrcBlend = D3D11_BLEND_SRC1_COLOR;
DestBlend = D3D11_BLEND_INV_SRC1_COLOR;
```



В этом примере показано, как коэффициенты смешения должны соответствовать свиззлес шейдера:


```
SrcFactor = D3D11_BLEND_SRC1_ALPHA;
DestFactor = D3D11_BLEND_SRC_COLOR;
OutputWriteMask[0] = .ra; // pseudocode for setting the mask at
                          // RenderTarget slot 0 to .ra
```



Вместе факторы смешения и код шейдера подразумевают, что шейдер пикселей требуется для вывода как минимум O0. r и O1. a. Дополнительные выходные компоненты могут выводиться шейдером, но они будут проигнорированы, но меньшее количество компонентов приведет к неопределенному результату.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Стадия средства слияния вывода](d3d10-graphics-programming-guide-output-merger-stage.md)
</dt> <dt>

[Этапы конвейера (Direct3D 10)](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

 