---
title: Стадия средства слияния вывода
description: Стадия Output-слияния (OM) формирует окончательный визуализированный цвет пикселя с помощью сочетания состояния конвейера, данных пикселов, созданных построителейми текстур пикселей, содержимого целевых объектов отрисовки и содержимого буферов глубины и трафаретов.
ms.assetid: 8be68c15-2deb-4804-b683-30080a876189
keywords:
- Стадия слияния выходных данных (Direct3D 10)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c8de2851fdea3a22cc42033d2c13454be72ba8ab
ms.sourcegitcommit: ca37395fd832e798375e81142b97cffcffabf184
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/24/2021
ms.locfileid: "110335218"
---
# <a name="output-merger-stage"></a>Стадия средства слияния вывода

Стадия Output-слияния (OM) формирует окончательный визуализированный цвет пикселя с помощью сочетания состояния конвейера, данных пикселов, созданных построителейми текстур пикселей, содержимого целевых объектов отрисовки и содержимого буферов глубины и трафаретов. Этап OM — это заключительный шаг для определения того, какие пикселы видимы (с тестированием шаблона глубины) и смешивается с конечными цветами пикселов.



Различия между Direct3D 9 и Direct3D 10:

- Direct3D 9 реализует Альфа-тестирование (с помощью [состояния "Альфа – тестирование](/windows/desktop/direct3d9/alpha-testing-state)") для управления записью пиксела в выходной целевой объект прорисовки.
- Direct3D 10 и выше не реализует альфа-тест (или состояние тестирования Alpha). Это можно контролировать с помощью шейдера пикселей или с помощью функций глубины и трафарета.



 

## <a name="depth-stencil-testing-overview"></a>Общие сведения о тестировании Depth-Stencil

Буфер трафарета глубины, который создается как ресурс текстуры, может содержать данные глубины и трафарета. Данные глубины позволяет определить, какие пиксели размещены ближе всего к камере, а данные трафарета используются для маскировки пикселей, которые можно обновить. В конечном счете все эти значения применяются на этапе слияния и вывода, чтобы определить, рисуется ли пиксель. На следующей схеме показаны схематический процесс тестирования трафарета глубины.

![схема работы тестирования трафарета глубины](images/d3d10-depth-stencil-test.png)

Сведения о настройке тестирования трафарета глубины см. в разделе [Настройка функции трафарета глубины](d3d10-graphics-programming-guide-depth-stencil.md). В объекте трафарета глубины инкапсулируется состояние трафарета глубины. Приложение может указать состояние трафарета глубины, или же на этапе OM будут использоваться значения по умолчанию. Если множественная дискретизация отключена, операции смешения выполняются отдельно для каждого пикселя. Если множественная дискретизация включена, смешение происходит отдельно для каждого объекта мультисэмплинга.

Процесс использования буфера глубины для определения рисуемых пикселей называется буферизацией глубины или z-буферизацией.

Когда значения глубины достигают этапа слияния и вывода (после интерполяции или применения пиксельного шейдера), они всегда ужимаются: z = min(Viewport.MaxDepth,max(Viewport.MinDepth,z)) (в соответствии с форматом или точностью буфера глубины с использованием правил с плавающей запятой). После преобразования значение глубины сравнивается (с помощью DepthFunc) от существующим значением буфера глубины. Если ни один буфер глубины не привязан, тест глубины всегда будет пройден.

Если компонент трафарета в формате буфера глубины или привязанный буфер глубины не существуют, тест трафарета всегда будет пройден. В противном случае функциональные возможности не изменяются с Direct3D 9.

Только один буфер глубины трафарета может быть активен в заданный момент времени. Все связанные ресурсов должны соответствовать (по размеру и габаритам) представление глубины трафарета. Это не означает, что размер ресурса должен совпадать — совпадать должен только размер представления.

Дополнительные сведения о тестировании элементов глубины см. в [руководстве 14](https://msdn.microsoft.com/library/Ee416550(v=VS.85).aspx).

## <a name="blending-overview"></a>Общие сведения об смешении

Во время смешения одно или несколько значений пикселей объединяются для получения окончательного цвета. На следующей схеме показан процесс смешения пиксельных данных.

![схема работы смешения данных](images/d3d10-blend-state.png)

Концептуально можно визуализировать эту блок-схему, реализованную дважды на стадии слияния. Первый из них смешивает данные RGB, а второй — альфа-данные. Сведения об использования API для создания и настройки состояния смешения см. в разделе [Настройка смешения](d3d10-graphics-programming-guide-blend-state.md).

Смешение с фиксированной функцией можно включить независимо для каждого целевого объекта отрисовки. Однако существует только один набор элементов управления смешением, поэтому одно смешение применяется ко всем целевым объектам отрисовки, если смешение включено. Значения смешения (в том числе BlendFactor) всегда ужимаются до диапазона формат целевого объекта отрисовки перед смешением. Преобразование выполняется на одном целевом объекте отрисовки с учетом типа объекта. Единственное исключение — форматы float16, float11 и float10, которые не ужимаются таким образом, чтобы операции смешения можно было выполнить с такой же точностью или диапазоном, как у формата вывода. Не числа (NaN) и нули со знаком распространяются во всех случаях (в том числе для весов 0,0).

При использовании целевых объектов отрисовки sRGB среда выполнения преобразует цвет объекта в линейное пространство перед смешением. Среда выполнения преобразует окончательное значение в пространство sRGB перед его сохранением в целевом объекте прорисовки.

Различия между Direct3D 9 и Direct3D 10:

- В Direct3D 9 функция наложения с фиксированной функцией может быть включена независимо для каждого целевого объекта отрисовки.
- В Direct3D 10 и более поздних версиях имеется одно описание состояния Blend. Таким образом, можно задать одно значение смешения для всех целевых объектов отрисовки.



 

### <a name="dual-source-color-blending"></a>Dual-Sourceное смешение цветов

Эта функция позволяет этапу слияния вывода одновременно использовать выходные данные шейдера пикселей (O0 и O1) в качестве входных данных для операции смешения с одним целевым объектом рендеринга в слоте 0. К допустимым операциям смешения относятся добавление, вычитание и revsubtract. Допустимые варианты смешения для Сркбленд, Дестбленд, Сркблендалфа или Дестблендалфа включают: **D3D11 \_ Blend \_ SRC1 \_ Color**, **D3D11 \_ Blend \_ Inv \_ SRC1 \_ Color**, **D3D11 \_ Blend \_ SRC1 \_ альфа**, **D3D11 \_ Blend \_ Inv \_ SRC1 \_ альфа**. Уравнение смешения и маска записи выходных данных определяют, какие компоненты выводит пиксельный шейдер. Дополнительные компоненты игнорируются.

Запись в другие выходы пиксельного шейдера (o2, o3 и т. д.) не определена. Невозможно записать данные в целевой объект прорисовки, если он не привязан к слоту 0. Запись oDepth во время смешения цветов с двумя источниками допускается.

Примеры см. в разделе [вывод шейдера пикселей в режиме смешения](d3d10-graphics-programming-guide-blend-state.md).

## <a name="multiple-rendertargets-overview"></a>Обзор нескольких Рендертаржетс

Пиксельный шейдер можно использовать для отображения как минимум восьми отдельных целевых объектов отрисовки, все которые должны быть одного типа (буфер, Texture1D, Texture1DArray и т. д.). Кроме того, все целевые объекты отрисовки должны быть одного размера по всем измерениям (ширина, высота, глубина, размер массива, число выборок). Каждая однобуферная прорисовка может иметь свой формат данных.

Вы можете использовать любое сочетание слотов целевых объектов отрисовки (до восьми). Однако представление ресурса невозможно привязать к нескольким слотам целевых объектов отрисовки одновременно. Представление можно использовать повторно, если ресурсы не применяются одновременно.

## <a name="output-write-mask-overview"></a>Общие сведения о маске Output-Write

Маска записи выходных данных используется для управления тем, какие данные можно записать в целевой объекте прорисовки для каждого компонента.

## <a name="sample-mask-overview"></a>Общие сведения о примерах маски

Маска дискретизации — это 32-разрядная маска покрытия, которая определяет какие образцы обновляются в активных целевых объектах прорисовки. Допускается только одна маска дискретизации. Сопоставление разрядов маски дискретизации с образцами в ресурсе определяется пользователем. Для отрисовки с n-дискретизацией используются первые n разрядов (от LSB) маски дискретизации (максимальное количество разрядов — 32).


## <a name="in-this-section"></a>В этом разделе



| Раздел                                                                                                    | Описание                                                                                                                                                                                                                                                      |
|----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Настройка функциональных возможностей Depth-Stencil](d3d10-graphics-programming-guide-depth-stencil.md)<br/> | В этом разделе приводится пошаговая инструкция по настройке буфера трафарета глубины и рассматривается состояние трафарета глубины для стадии слияния вывода.<br/>                                                                                                                           |
| [Настройка функций смешения](d3d10-graphics-programming-guide-blend-state.md)<br/>        | Операции смешения выполняются на всех выходных данных шейдера пикселей (значение RGBA) перед записью выходного значения в целевой объект отрисовки. Если включена многовыборка, смешивание выполняется для каждого мультисэмплинга; в противном случае смешивание выполняется для каждого пикселя.<br/> |
| [Смещение глубины](d3d10-graphics-programming-guide-output-merger-stage-depth-bias.md)<br/>             | Многоугольники, копланар в трехмерном пространстве, могут выглядеть так, как если бы они не копланар, добавляя z-смещение (или смещение глубины) к каждому из них.<br/>                                                                                                              |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Графический конвейер](overviews-direct3d-11-graphics-pipeline.md)
</dt> <dt>

[Этапы конвейера (Direct3D 10)](/windows/desktop/direct3d10/d3d10-graphics-programming-guide-pipeline-stages)
</dt> </dl>

 

