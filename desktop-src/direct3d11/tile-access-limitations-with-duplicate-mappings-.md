---
title: Ограничения доступа к плитке с повторяющимися сопоставлениями
description: В этом разделе описаны ограничения на доступ к плиткам с повторяющимися сопоставлениями.
ms.assetid: 7A498E0D-9151-4A89-B7C3-C4F476457D17
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0909b0d10e286e5f774f6893b692abdeb19d3ef7
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104067496"
---
# <a name="tile-access-limitations-with-duplicate-mappings"></a>Ограничения доступа к плитке с повторяющимися сопоставлениями

В этом разделе описаны ограничения на доступ к плиткам с повторяющимися сопоставлениями.

## <a name="copying-tiled-resources-with-overlapping-source-and-destination"></a>Копирование мозаичных ресурсов с перекрывающимися источниками и назначениеми

Если плитки в области источника и назначения \* операции копирования имеют дубликаты сопоставлений в области копирования, которые были бы перекрыто, даже если оба ресурса не были заполнены ресурсами \* , а операция копирования поддерживает перекрывающиеся копии, \* операция копирования будет работать нормально (как если бы источник копировался во временное расположение перед переходом к назначению). Но если перекрытие не является очевидным (например, когда ресурсы источника и назначения различаются, но имеют общие сопоставления, или сопоставления дублируются на определенной поверхности), результаты операции копирования для общих плиток будут не определены.

## <a name="copying-to-tiled-resource-with-duplicated-tiles-in-destination-area"></a>Копирование в мозаичный ресурс с повторяющимися плитками в области назначения

Копирование в мозаичный ресурс с повторяющимися плитками в целевой области приведет к неопределенному результату на этих плитках, если только сами данные не идентичны. плитки могут записываться в разные заказы.

## <a name="uav-accesses-to-duplicate-tiles-mappings"></a>Доступ UAV к сопоставлениям дублирующихся плиток

Предположим, что неупорядоченное представление доступа (UAV) в мозаичном ресурсе содержит дубликаты сопоставлений плиток в области или с другими ресурсами, привязанными к конвейеру. Порядок доступа к этим повторяющимся плиткам не определен, если выполняется разными потоками, так же, как и любой порядок доступа к памяти в представлениях неупорядоченного доступа.

## <a name="rendering-after-tile-mapping-changes-or-content-updates-from-outside-mappings"></a>Отрисовка после изменения сопоставления плиток или обновления содержимого из внешних сопоставлений

Если изменились сопоставления плитки мозаичного ресурса или содержимое сопоставленных плиток мозаичного пула изменилось с помощью сопоставления другого мозаичного ресурса, и мозаичный ресурс будет подготовлен к просмотру с помощью представления целевого объекта прорисовки или представления трафарета глубины, приложение должно быть очищено (с помощью функций очистки API с фиксированной функцией) или полностью копировать с помощью \* \* API-интерфейсов Copy/Update. плитки, измененные в области визуализации (сопоставленные или нет). Сбой приложения для очистки или копирования в этих случаях приводит к тому, что структуры оптимизации оборудования для данного представления целевого объекта прорисовки или представления трафарета глубины устарели, что приведет к несогласованности оборудования и несоответствия между различными аппаратными средствами. Эти скрытые структуры данных оптимизации, используемые оборудованием, могут быть локальными для отдельных сопоставлений и недоступны другим сопоставлениям одной и той же памяти.

Операция [**ID3D11DeviceContext1:: клеарвиев**](/windows/desktop/api/D3D11_1/nf-d3d11_1-id3d11devicecontext1-clearview) поддерживает очистку целевых представлений прорисовки с помощью прямоугольников. Для оборудования, поддерживающего мозаичные ресурсы, **клеарвиев** также должен поддерживать очистку представлений трафаретов глубины с прямоугольниками, для поверхностей только глубины (без трафарета). Эта операция позволяет приложениям очистить только необходимые области поверхности.

Если приложению необходимо сохранить содержимое памяти областей в мозаичном ресурсе, в котором изменились сопоставления, это приложение должно обойти требование четко. Приложение может решить эту задачу, сначала сохранив содержимое, в котором изменились сопоставления плиток (путем копирования их на временную поверхность, например с помощью [**ID3D11DeviceContext2:: копитилес**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-copytiles)), выполнив необходимую команду CLEAR, а затем скопировав содержимое обратно. Несмотря на то, что задача сохранения содержимого поверхности для постепенной отрисовки будет выполнена, недостаток состоит в том, что может снизиться производительность последующей отрисовки на данной поверхности, так оптимизации отрисовки могут быть потеряны.

Если плитка сопоставлена с несколькими мозаичными ресурсами одновременно, а содержимое плитки обрабатывается любыми средствами (рендеринг, копирование и т. д.) с помощью одного из мозаичных ресурсов, то, если одна и та же плитка должна быть подготовлена к просмотру с помощью любого другого мозаичного ресурса, плитку необходимо сначала очистить, как описано выше.

## <a name="rendering-to-tiles-shared-outside-render-area"></a>Отрисовка общих плиток вне области отрисовки

Предположим, что область в мозаичном ресурсе готовится к просмотру, а плитки пула плиток, на которые ссылается область прорисовки, также сопоставляются с внешней областью прорисовки (включая через другие мозаичные ресурсы одновременно). Правильное отображение данных на этих плитках не гарантируется при просмотре через другие сопоставления, даже если базовая структура памяти совместима. Это происходит из-за структур данных оптимизации, используемых некоторым оборудованием, которые могут быть локальными для отдельных сопоставлений отрисовываемых поверхностей и недоступны другим сопоставлениям того же участка памяти. Это ограничение можно обойти, произведя копирование из отрисованного сопоставления во все остальные сопоставления той же памяти, к которым может осуществляться доступ (или очистку памяти либо копирование в нее других данных, если старое содержимое больше не требуется). Несмотря на то, что этот обходной путь выглядит избыточным, благодаря ему все остальные сопоставления для одного и того же участка памяти способны получить доступ к его содержимому, и сохраняется экономия памяти благодаря наличию единого резерва физической памяти. Кроме того, при переключении между использованием различных мозаичных ресурсов с общими сопоставлениями (если только чтение не выполняется) необходимо вызвать API [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) между коммутаторами.

## <a name="rendering-to-tiles-shared-within-render-area"></a>Отрисовка общих плиток внутри области отрисовки

Если область в мозаичном ресурсе готовится к просмотру, а в области прорисовки несколько плиток сопоставляются с одним и тем же расположением пула плиток, то результаты отрисовки на этих плитках не определены.

## <a name="data-compatibility-across-tiled-resources-sharing-tiles"></a>Совместимость данных по плиткам совместного использования ресурсов

Предположим, что несколько мозаичных ресурсов имеют сопоставления с одними и теми же расположениями пула плиток, а каждый ресурс используется для доступа к одним и тем же данным. Этот сценарий допустим только в том случае, если другие правила, связанные с устранением проблем с структурами оптимизации оборудования, исключаются, выполняются соответствующие вызовы [**ID3D11DeviceContext2:: тиледресаурцебарриер**](/windows/desktop/api/D3D11_2/nf-d3d11_2-id3d11devicecontext2-tiledresourcebarrier) , а ресурсы мозаичного заполнения совместимы друг с другом. Последнее описывается в терминах того, что означает, что для мозаичного разделения ресурсов плитки не совместимы. Условием несовместимости при доступе к одним и тем же данным в повторяющихся сопоставлениях плиток является использование различных размеров или форматов поверхностей, либо наличие у ресурсов флагов привязки трафарета глубины или целей отрисовки. Запись в память с одним типом сопоставления дает неопределенные результаты, если в дальнейшем производить чтение или отрисовку через сопоставление несовместимого ресурса. Если другие сопоставления общих ресурсов сначала инициализируются с новыми данными (утилизация памяти для другой цели), последующие операции чтения или отрисовки проходят нормально, так как данные не подвергаются несовместимым интерпретациям. Но при переключении между доступом к несовместимым сопоставлениям, таким как это, необходимо вызвать API **тиледресаурцебарриер** .

Если флаг привязки цели отрисовки или трафарета глубины не установлен ни на одном ресурсе, имеющем общие сопоставления с другими ресурсами, ограничений становится гораздо меньше. Если формат и типы поверхностей (например, Texture2D) совпадают, плитки могут использоваться совместно. Поддерживаются различные форматы, например, поверхности BC \* и эквивалентный размер несжатого 32 бита или 16 бит на один формат компонента, например BC6H и R32G32B32A32. Многие форматы 32 бит на элемент могут иметь псевдонимы R32 \_ \* (R10G10B10A2 \_ \* , R8G8B8A8 \_ \* , B8G8R8A8 \_ \* , B8G8R8X8 \_ \* , R16G16 \_ \* ). Эта операция всегда была разрешена для ресурсов без мозаичного заполнения.

Совместное использование упакованных и не упакованных плиток допускается, если форматы совместимы, а плитки заполняются сплошным цветом.

И наконец, если у ресурсов, использующих общее сопоставление плиток, нет ничего общего, за исключением отсутствующих флагов привязки цели отрисовки или трафарета глубины, безопасно можно совместно использовать только память, заполненную нулями; сопоставление будет отображаться в виде декодированного нуля для определения формата конкретного ресурса (обычно просто 0).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Доступ конвейера к мозаичным ресурсам](pipeline-access-to-tiled-resources.md)
</dt> </dl>

 

 




