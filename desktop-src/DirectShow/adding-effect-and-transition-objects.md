---
description: Добавление эффектов и объектов перехода
ms.assetid: fe82392f-33e2-432a-a6e3-710e475547b3
title: Добавление эффектов и объектов перехода
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 929678759d55a51b022cd7b870ddfa7cc5abb72279bcabe1694b5cc4eef211b7
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118160065"
---
# <a name="adding-effect-and-transition-objects"></a>Добавление эффектов и объектов перехода

\[Этот API не поддерживается и может быть изменен или недоступен в будущем.\]

В DES результат или переход представлен двумя объектами:

-   *Объект временной шкалы* представляет собой результат или переход в пределах временной шкалы. Для эффектов объект временной шкалы поддерживает интерфейс [**иамтимелиниффект**](iamtimelineeffect.md) . Для переходов он поддерживает интерфейс [**иамтимелинетранс**](iamtimelinetrans.md) . Оба типа поддерживают интерфейс [**иамтимелинеобж**](iamtimelineobj.md) .
-   *Подобъект* — это объект, который реализует обработку данных для данного действия или перехода. Объект временной шкалы содержит указатель на подобъект.

Чтобы добавить действие или переход, выполните следующие действия.

**1. Создание объекта временной шкалы**

Чтобы создать объект временной шкалы, вызовите метод [**иамтимелине:: креатимптиноде**](iamtimeline-createemptynode.md) . Задайте для какого-либо действия тип, равный **\_ основному \_ типу \_ временной шкалы** , или **\_ \_ \_ смену основного типа временной шкалы** для перехода.

В следующем примере создается объект перехода.


```C++
IAMTimelineObj *pTransObj = NULL;
pTimeline->CreateEmptyNode(&pTransObj, TIMELINE_MAJOR_TYPE_TRANSITION);
```



**2. Указание подобъекта**

Объект временной шкалы выступает в качестве оболочки для другого объекта, называемого *подобъектом*, который выполняет реальную работу. Подобъект реализует преобразование данных, которое создает нужный результат или переход. Список переходов и эффектов, предоставляемых DES, см. в разделе [переходы и эффекты](transitions-and-effects.md).

Чтобы задать подобъект, вызовите метод [**иамтимелинеобж:: сетсубобжектгуид**](iamtimelineobj-setsubobjectguid.md) для объекта Timeline, передав ему идентификатор класса (CLSID) подобъекта. DirectShow предоставляет перечислитель для видеоэффектов и видеопереходов, которые можно использовать для получения идентификатора CLSID. Дополнительные сведения см. в разделе [перечисление эффектов и переходов](enumerating-effects-and-transitions.md).

В следующем примере в качестве подобъекта задается [Переход на очистку SMPTE](smpte-wipe-transition.md) .


```C++
hr = pTransObj->SetSubObjectGUID(CLSID_DxtJpeg);  // SMPTE Wipe
```



**3. Задание времени начала и окончания**

Чтобы задать время начала и окончания, вызовите метод [**иамтимелинеобж:: сетстартстоп**](iamtimelineobj-setstartstop.md) . Эти значения времени задаются относительно времени начала родительского объекта. Эффекты могут пересекаться в пределах одного объекта, но переходы не могут.

В следующем примере время начала устанавливается равным 5 секундам, а время окончания — 10 секундам:


```C++
const REFERENCE_TIME ONE_SECOND = 10000000
hr = pTransObj->SetStartStop(5 * ONE_SECOND, 10 * ONE_SECOND);
```



При подготовке к просмотру ход перехода в каждом кадре вычисляется на основе свойства **Progress** , которое нормализовано до диапазона от 0,0 до 1,0. DES использует время начала каждого кадра для вычисления значения хода выполнения. Это означает, что если время прекращения перехода равно значению времени прекращения источника, то значение **хода выполнения** никогда не достигнет ровно 1,0, так как время начала последнего кадра немного, чем время окончания. Чтобы переход был достигнут до 1,0, установите время окончания перехода как минимум на один кадр, который раньше, чем время окончания источника.

**4. Вставка объекта на временную шкалу**

Чтобы вставить объект на временную шкалу, вызовите один из следующих методов родительского элемента, в зависимости от типа объекта:

-   Эффекты: [ **иамтимелиниффектабле:: еффектинсбефоре**](iamtimelineeffectable-effectinsbefore.md)
-   Переходы: [ **иамтимелинетрансабле:: трансадд**](iamtimelinetransable-transadd.md)

В методе [**иамтимелиниффектабле:: еффектинсбефоре**](iamtimelineeffectable-effectinsbefore.md) необходимо указать приоритет этого действия. Когда эффекты перекрываются для одного и того же объекта, они применяются в порядке приоритета. Звуковым результатом конверта тома является исключение. Дополнительные сведения см. в справочнике по [эффекты конверта тома](volume-envelope-effect.md) . В составе композиции все звуковые дорожки смешиваются до применения звуковых эффектов для этой композиции.

Поскольку переходы не могут перекрывать один и тот же объект, они не имеют значения приоритета.

В следующем примере объект перехода добавляется к дорожке:


```C++
IAMTimelineTransable *pTransable = NULL;
hr = pTrack->QueryInterface(IID_IAMTimelineTransable, (void **)&pTransable);
hr = pTransable->TransAdd(pTransObj);  
pTransable->Release();
```



В примере запрашивается объект Track для интерфейса [**иамтимелинетрансабле**](iamtimelinetransable.md) перед вызовом аддтранс.

**5. Задание свойств**

Многие эффекты и переходы поддерживают пользовательские свойства. Дополнительные сведения см. [в разделе Задание свойств для эффектов и переходов](setting-properties-on-effects-and-transitions.md).

Пример

В следующем примере кода добавляется [Переход SMPTE очистки](smpte-wipe-transition.md) к дорожке. Предполагается, что объект Track уже существует на временной шкале.


```C++
IAMTimeline *pTL;
IAMTimelineTrack *pTrack;

// Create timeline with track (not shown).

// Create the transition object. 
IAMTimelineObj *pTransObj = NULL;
hr = pTL->CreateEmptyNode(&pTransObj, TIMELINE_MAJOR_TYPE_TRANSITION);

// Set the subobject. 
hr = pTransObj->SetSubObjectGUID(CLSID_DxtJpeg);  // SMPTE Wipe

// Set the start and stop times. 
hr = pTransObj->SetStartStop(50000000, 100000000);

// Insert the transition object into the timeline. 
IAMTimelineTransable *pTransable = NULL;
hr = pTrack->QueryInterface(IID_IAMTimelineTransable, (void **)&pTransable);
hr = pTransable->TransAdd(pTransObj);  
pTransable->Release();
pTransObj->Release();
```



## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Работа с эффектами и переходами](working-with-effects-and-transitions.md)
</dt> </dl>

 

 



