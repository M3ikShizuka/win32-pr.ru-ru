---
description: Справочник по файлу AVI Metallica
ms.assetid: 2d8cf5be-1252-4b58-89b1-f5c53ea17d0e
title: Справочник по файлу AVI Metallica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83f28a7254ac9eb927381e313603ffd2bd0d050c
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495663"
---
# <a name="avi-riff-file-reference"></a>Справочник по файлу AVI Metallica

Формат AVI-файла Microsoft — это спецификация файлов Metallica, которая используется в приложениях, записывающих, редактирующих и воспроизводящих звуковые видеопоследовательности. Как правило, AVI-файлы содержат несколько потоков различных типов данных. Большинство последовательностей AVI используют потоки аудио и видео. Простой вариант для последовательности AVI использует видеоданные и не требует наличия звукового потока.

В этом разделе не описываются расширения формата AVI для файлов Опендмл. Дополнительные сведения об этих расширениях см. в разделе *расширения формата AVI-файлов опендмл*, опубликованные в Подкомитете формат файла Опендмл AVI M – JPEG.

## <a name="fourccs"></a>фаурккс

FOURCC (код из четырех символов) — это 32-разрядное целое число без знака, созданное путем сцепления четырех символов ASCII. Например, FOURCC ' ABCD ' представлена в Little-Endian системе как 0x64636261. Фаурккс может содержать пробелы, поэтому "ABC" является допустимым набором FOURCC. Формат AVI использует коды FOURCC для обнаружения типов потоков, фрагментов данных, записей индекса и других сведений.

## <a name="riff-file-format"></a>Формат файла Metallica

Формат AVI-файла основан на формате документа Metallica (формат файла обмена ресурсами). Файл Metallica состоит из заголовка Metallica, за которым следует ноль или более *списков* и *блоков*.

-   Заголовок Metallica имеет следующую форму:

    `'RIFF' fileSize fileType (data)`

    где "Metallica" является литеральным кодом FOURCC "Metallica", `fileSize` является 4-байтовым значением, определяющим размер данных в файле, и является типом `fileType` FourCC, идентифицирующим конкретный тип файла. Значение `fileSize` включает размер объекта `fileType` FourCC плюс размер данных, приведенных ниже, но не включает размер "Metallica" FourCC или размер `fileSize` . Файловые данные состоят из фрагментов и списков в любом порядке.

-   Фрагмент имеет следующий вид:

    `ckID ckSize ckData`

    где `ckID` — это FourCC, идентифицирующая данные, содержащиеся в блоке, `ckSize` — это 4-байтовый параметр, определяющий размер данных в `ckData` , а `ckData` также ноль или более байтов данных. Данные всегда дополняются до ближайшей границы **слова** . `ckSize` Предоставляет размер допустимых данных в блоке; Он не включает в себя заполнение, размер `ckID` или размер `ckSize` .

-   Список имеет следующий вид:

    `'LIST' listSize listType listData`

    где "LIST" является строковым кодом FOURCC "LIST", `listSize` является 4-байтовым значением, определяющим размер списка, `listType` является кодом FourCC и `listData` состоит из фрагментов или списков в любом порядке. Значение параметра `listSize` включает размер `listType` плюс размер `listData` ; он не включает в себя "List" FourCC или размер `listSize` .

Оставшаяся часть этого раздела использует следующую нотацию для описания фрагментов Metallica:

`ckID ( ckData )`

где размер фрагмента данных является неявным. С помощью этой нотации список можно представить следующим образом:

`'LIST' ( listType ( listData ) )`

Необязательные элементы помещаются в квадратные скобки: `[ optional element ]`

## <a name="avi-riff-form"></a>Форма AVI Metallica

Файлы AVI идентифицируются с помощью FOURCC "AVI" в заголовке Metallica. Все файлы AVI содержат два фрагмента обязательных СПИСКОВ, которые определяют формат потоков и потоковых данных соответственно. Файл AVI также может содержать фрагмент индекса, который задает расположение фрагментов данных в файле. Файл AVI со следующими компонентами имеет следующий вид:


```C++
RIFF ('AVI '
      LIST ('hdrl' ... )
      LIST ('movi' ... )
      ['idx1' (<AVI Index>) ]
     )
```



Список "хдрл" определяет формат данных и является первым обязательным блоком списка. Список "Мови" содержит данные для последовательности AVI и второй обязательный блок списка. Список "idx1" содержит индекс. Файлы AVI должны иметь соответствующие три компонента в правильной последовательности.

> [!Note]  
> Расширения Опендмл определяют другой тип индекса, идентифицируемый FOURCC "индкс".

 

Списки "хдрл" и "Мови" используют для своих данных подблоки. В следующем примере показана форма AVI Metallica, развернутая с блоками, необходимыми для выполнения этих списков:


```C++
RIFF ('AVI '
      LIST ('hdrl'
            'avih'(<Main AVI Header>)
            LIST ('strl'
                  'strh'(<Stream header>)
                  'strf'(<Stream format>)
                  [ 'strd'(<Additional header data>) ]
                  [ 'strn'(<Stream name>) ]
                  ...
                 )
             ...
           )
      LIST ('movi'
            {SubChunk | LIST ('rec '
                              SubChunk1
                              SubChunk2
                              ...
                             )
               ...
            }
            ...
           )
      ['idx1' (<AVI Index>) ]
     )
```



## <a name="avi-main-header"></a>Основной заголовок AVI

Список "хдрл" начинается с основного заголовка AVI, который содержится в блоке "авих". Основной заголовок содержит глобальные сведения для всего файла AVI, например число потоков в файле, а также ширину и высоту последовательности AVI. Основной фрагмент заголовка состоит из структуры [**авимаинхеадер**](/previous-versions/windows/desktop/api/Aviriff/ns-aviriff-avimainheader) .

## <a name="avi-stream-headers"></a>Заголовки потока AVI

Один или несколько списков "СТРЛ" следуют за главным заголовком. Для каждого потока данных требуется список "СТРЛ". Каждый список "СТРЛ" содержит сведения о одном потоке в файле и должен содержать фрагмент заголовка потока ("стрх") и фрагмент формата потока ("стрф"). Кроме того, список "СТРЛ" может содержать фрагмент данных заголовка потока ("стрд") и фрагмент имени потока ("стрн").

Блок заголовка потока ("стрх") состоит из структуры [**авистреамхеадер**](/previous-versions/windows/desktop/api/avifmt/ns-avifmt-avistreamheader) .

Блок формата потока ("стрф") должен следовать за фрагментом заголовка потока. Блок формата потока описывает формат данных в потоке. Данные, содержащиеся в этом фрагменте, зависят от типа потока. Для видеопотоков информация является структурой [**битмапинфо**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) , включая сведения о палитре, если это уместно. Для звуковых потоков эта информация является структурой [**вавеформатекс**](/previous-versions/dd757713(v=vs.85)) .

Если имеется фрагмент данных заголовка потока ("стрд"), он следует за блоком формата потока. Формат и содержимое этого фрагмента определяется драйвером кодека. Как правило, драйверы используют эти сведения для настройки. Приложениям, считывающим и записывающим файлы AVI, не нужно интерпретировать эти сведения. они просто переносят их в драйвер и из него в виде блока памяти.

Необязательный блок "стрн" содержит текстовую строку, завершающуюся нулем, описывающую поток.

Заголовки потока в списке "хдрл" связаны с потоковых данных в списке "Мови" в соответствии с порядком фрагментов "СТРЛ". Первый блок "СТРЛ" применяется к потоку 0, второй — к потоку 1 и т. д.

## <a name="stream-data-movi-list"></a>Потоковые данные (список "Мови")

После сведений о заголовке находится список "Мови", содержащий фактические данные в потоках, то есть видеоматериалы и образцы аудио. Фрагменты данных могут находиться непосредственно в списке "Мови" или быть сгруппированы в списках "REC". Группирование "REC" подразумевает, что сгруппированные фрагменты должны считываться с диска все сразу и предназначены для файлов, которые чередуются для воспроизведения с компакт-диска.

Объект FOURCC, определяющий каждый блок данных, состоит из двузначного номера потока, за которым следует код из двух символов, определяющий тип данных в фрагменте.



| Код из двух символов | Описание              |
|--------------------|--------------------------|
| db                 | Несжатый кадр видео |
| dc                 | Сжатый кадр видео   |
| пк                 | Изменение палитры           |
| WB                 | Звуковые данные               |



 

Например, если поток 0 содержит звук, фрагменты данных для этого потока будут иметь FOURCC ' 00wb '. Если поток 1 содержит видео, фрагменты данных для этого потока будут иметь FOURCC ' 01db ' или ' 01dc '. Фрагменты данных видео также могут определять новые записи палитры для обновления палитры во время последовательности AVI. Каждый блок изменения палитры ("кскспк") содержит структуру [**авипалчанже**](/previous-versions/windows/desktop/api/avifmt/ns-avifmt-avipalchange) . Если поток содержит изменения палитры, установите флаг **ависф \_ Video \_ Палчанжес** в элемент **dwFlags** структуры [**авистреамхеадер**](/previous-versions/windows/desktop/api/avifmt/ns-avifmt-avistreamheader) для этого потока.

Текстовые потоки могут использовать произвольные коды из двух символов.

## <a name="avi-index-entries"></a>Записи индекса AVI

<dl> <dt>

<span id="AVI_1.0_index"></span><span id="avi_1.0_index"></span><span id="AVI_1.0_INDEX"></span>Индекс AVI 1,0
</dt> <dd>

Необязательный фрагмент индекса ("idx1") может следовать за списком "Мови". Индекс содержит список фрагментов данных и их расположение в файле. Он состоит из структуры [**авиолдиндекс**](/previous-versions/windows/desktop/api/Aviriff/ns-aviriff-avioldindex) с записями для каждого фрагмента данных, включая фрагменты «REC». Если файл содержит индекс, установите флаг **Авиф \_ хасиндекс** в элементе **dwFlags** структуры [**авимаинхеадер**](/previous-versions/windows/desktop/api/Aviriff/ns-aviriff-avimainheader) .

</dd> <dt>

<span id="AVI_2.0_index"></span><span id="avi_2.0_index"></span><span id="AVI_2.0_INDEX"></span>Индекс AVI 2,0
</dt> <dd>

Индекс AVI 2,0 может отображаться как один блок. Кроме того, сегменты индекса могут быть чередованием в блоке "Мови". Если сегменты индекса размещаются в блоке "Мови", супер-индекс содержит индекс сегментов индекса. Структура [**авиметаиндекс**](/previous-versions/windows/desktop/api/aviriff/ns-aviriff-avimetaindex) является базовой структурой для сегментов индекса и Super index. Дополнительные сведения см. в разделе *расширения формата AVI-файлов опендмл*, опубликованного в Подкомитете формат файла Опендмл AVI M – JPEG. (Этот ресурс может быть недоступен в некоторых языках и странах.)

</dd> </dl>

## <a name="other-data-chunks"></a>Другие фрагменты данных

Данные могут быть согласованы в файле AVI путем вставки нежелательных блоков по мере необходимости. Приложения должны игнорировать содержимое нежелательного фрагмента.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Формат файла AVI](avi-file-format.md)
</dt> </dl>

 

 
