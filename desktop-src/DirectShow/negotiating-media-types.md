---
description: Согласование типов мультимедиа
ms.assetid: 9872128c-4e3d-4ac8-afc4-b3dc516a0925
title: Согласование типов мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0bdcb78cfef6b8396d866ea148267c5a899cd353
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127254257"
---
# <a name="negotiating-media-types"></a>Согласование типов мультимедиа

когда диспетчер Graphа фильтра вызывает метод [**ипин:: Подключение**](/windows/desktop/api/Strmif/nf-strmif-ipin-connect) , он имеет несколько параметров для указания типа мультимедиа:

-   **Полный тип:** Если тип носителя указан полностью, ПИН-коды пытаются подключиться к этому типу. В противном случае попытка подключения завершится неудачей.
-   **Тип частичного носителя:** Тип мультимедиа является *разделяемым* , если основной тип, подтип или тип формата имеют \_ значение GUID null. Значение GUID \_ , равное NULL, действует как "подстановочный знак", что означает приемлемое значение. Эти контакты согласовывают тип, который согласуется с частичным типом.
-   **Нет типа носителя:** если фильтр Graph Manager передает **пустой** указатель, они могут согласиться с любым типом мультимедиа, допустимым для обоих пин-кодов.

Если ПИН-коды выполняют подключение, подключение всегда имеет полный тип носителя. назначение типа носителя, заданного фильтром Graph Manager, — ограничение возможных типов соединения.

Во время процесса согласования выходной ПИН-код предлагает тип мультимедиа, вызывая метод [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) входного контакта. Входной ПИН-код может принять или отклонить предложенный тип. Этот процесс повторяется до тех пор, пока входной ПИН-код не примет тип или выходной ПИН-код выходит за пределы типов, а соединение завершается с ошибкой.

Как закрепление вывода выбирает типы носителей для предложения, зависит от реализации. в базовых классах DirectShow выходной пин-код вызывает [**ипин:: енуммедиатипес**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) для входного пин-кода. Этот метод возвращает перечислитель, который перечисляет предпочтительные типы мультимедиа для входного контакта. В таком случае закрепление вывода перечисляет свои собственные предпочтительные типы.

**Работа с типами мультимедиа**

В любой функции, которая получает **параметр \_ \_ типа мультимедиа AM** , всегда проверяйте значения **кбформат** и **форматтипе** перед разыменованием элемента **пбформат** . Следующий код неверный:


```C++
if (pmt->formattype == FORMAT_VideoInfo)
{
    VIDEOINFOHEADER *pVIH = (VIDEOINFOHEADER*)pmt->pbFormat;
    // Wrong!
}
```



Следующий код правильный:


```C++
if ((pmt->formattype == FORMAT_VideoInfo) && 
    (pmt->cbFormat > sizeof(VIDEOINFOHEADER) &&
    (pbFormat != NULL))
{
    VIDEOINFOHEADER *pVIH = (VIDEOINFOHEADER*)pmt->pbFormat;
    // Now you can dereference pVIH.
}
```



 

 



