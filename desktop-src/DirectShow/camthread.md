---
description: Класс Камсреад является абстрактным классом для управления рабочими потоками.
ms.assetid: c217d879-0203-4566-96ad-7463b05bc990
title: Класс Камсреад (Вксутил. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CAMThread
api_type:
- COM
api_location:
- Strmbase.lib
- Strmbase.dll
- Strmbasd.lib
- Strmbasd.dll
ms.openlocfilehash: e5c2bde058267ae4c530f33a96778792d5fe247b
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105665479"
---
# <a name="camthread-class"></a>Класс Камсреад

`CAMThread`Класс является абстрактным классом для управления рабочими потоками.



| Защищенные переменные членов                                 | Описание                                                                  |
|------------------------------------------------------------|------------------------------------------------------------------------------|
| [**m \_ хсреад**](camthread-m-hthread.md)                  | Обработчик для потока.                                                        |
| Открытые переменные члена                                    | Описание                                                                  |
| [**m \_ акцесслокк**](camthread-m-accesslock.md)            | Критическая секция, которая блокирует доступ к потоку из других потоков. |
| [**m \_ воркерлокк**](camthread-m-workerlock.md)            | Критическая секция, которая блокирует данные, общие для потоков.                       |
| Открытые методы                                             | Описание                                                                  |
| [**камсреад**](camthread-camthread.md)                   | Метод конструктора.                                                          |
| [**~ Камсреад**](camthread--camthread.md)                | Метод деструктора. Виртуализаци.                                                  |
| [**инитиалсреадпрок**](camthread-initialthreadproc.md)   | Вызывает метод Среадпрок при создании потока.                      |
| [**Создать**](camthread-create.md)                         | Создает поток.                                                          |
| [**каллворкер**](camthread-callworker.md)                 | Сигнализирует потоку запрос.                                           |
| [**Закрыть**](camthread-close.md)                           | Ожидает завершения работы потока, а затем освобождает его ресурсы.                   |
| [**среадексистс**](camthread-threadexists.md)             | Запрашивает, существует ли поток.                                           |
| [**Запрос на**](camthread-getrequest.md)                 | Ожидает следующего запроса.                                                  |
| [**чеккрекуест**](camthread-checkrequest.md)             | Проверяет, есть ли запрос, без блокировки.                              |
| [**Ответить**](camthread-reply.md)                           | Ответ на запрос.                                                        |
| [**жетрекуессандле**](camthread-getrequesthandle.md)     | Извлекает дескриптор события, сигнального методом Каллворкер.           |
| [**жетрекуестпарам**](camthread-getrequestparam.md)       | Извлекает последний запрос.                                                |
| [**коинитиализехелпер**](camthread-coinitializehelper.md) | Вызывает CoInitializeEx в начале потока.                             |
| Чистые виртуальные методы                                       | Описание                                                                  |
| [**среадпрок**](camthread-threadproc.md)                 | Потоковая процедура.                                                            |



 

## <a name="remarks"></a>Комментарии

Этот класс предоставляет методы для создания рабочего потока, передачи запросов в поток и ожидания выхода из потока. Чтобы использовать этот класс, выполните следующие действия.

-   Создайте класс, производный от класса `CAMThread` , и переопределите чистый виртуальный метод [**камсреад:: среадпрок**](camthread-threadproc.md). Этот метод является процедурой потока, которая вызывается в начале потока.
-   В приложении создайте экземпляр производного класса. Создание объекта не приводит к созданию потока. Чтобы создать поток, вызовите метод [**камсреад:: Create**](camthread-create.md) .
-   Чтобы отправить запросы в поток, вызовите метод [**камсреад:: каллворкер**](camthread-callworker.md) . Этот метод принимает параметр DWORD, значение которого определяется вашим классом. Метод блокируется до тех пор, пока поток не ответит (см. ниже).
-   В потоковой процедуре отвечайте на запросы, вызывая либо [**камсреад:: WebRequest**](camthread-getrequest.md) , либо [**Камсреад:: чеккрекуест**](camthread-checkrequest.md). Метод WebRequest блокируется до тех пор, пока другой поток не вызовет Каллворкер. Метод Чеккрекуест не блокируется, что позволяет потоку проверять наличие новых запросов при асинхронной работе.
-   Когда поток получает запрос, вызовите [**камсреад:: Reply**](camthread-reply.md) , чтобы разблокировать вызывающий поток. Метод Reply принимает параметр DWORD, который передается в вызывающий поток в качестве возвращаемого значения для Каллворкер.

Завершив работу с потоком, вызовите метод [**камсреад:: Close**](camthread-close.md) . Этот метод ожидает выхода из потока, а затем закрывает обработчик потока. Сообщение Среадпрок должно быть гарантированно закрыто самостоятельно или в ответ на запрос Каллворкер. Метод деструктора также вызывает Close.

В следующем примере показаны эти действия.


```C++
class MyThread : public CAMThread
{
protected:
    DWORD ThreadProc(void);
};

DWORD MyThread::ThreadProc()
{
    BOOL bShutDown = FALSE;
    while (!bShutDown)
    {
        DWORD req = GetRequest();
        printf("Request: %d\n", req);
        bShutDown = (req == 0);
        Reply(bShutDown ? S_FALSE : S_OK);
    }
    printf("Quitting Thread\n");
    return 1;
}

void main()
{
    MyThread thread;
    DWORD reply;
    
    thread.Create();
    reply = thread.CallWorker(3);
    reply = thread.CallWorker(0); // Thread exits.
}
```



В производном классе можно также определить функции элементов, которые проверяют параметры на Каллворкер. В следующем примере показан типичный способ этого:


```C++
enum Command {CMD_INIT, CMD_RUN, CMD_STOP, CMD_EXIT};

HRESULT Init(void)  { return CallWorker(CMD_INIT); }
HRESULT Run(void)   { return CallWorker(CMD_RUN); }
HRESULT Stop(void)  { return CallWorker(CMD_STOP); }
HRESULT Exit(void)  { return CallWorker(CMD_EXIT); }
```



`CAMThread`Класс предоставляет два критических раздела в виде общих переменных члена. Используйте `CAMThread::m_AccessLock` , чтобы заблокировать поток от доступа других потоков. (Например, методы Create и Каллворкер хранят эту блокировку для сериализации операций в потоке.) Используйте [**камсреад:: m \_ воркерлокк**](camthread-m-workerlock.md) для блокировки данных, которые являются общими для потоков.

## <a name="requirements"></a>Требования



| Требование | Значение |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Header<br/>  | <dl> <dt>Вксутил. h (включение Streams. h)</dt> </dl>                                                                                    |
| Библиотека<br/> | <dl> <dt>Стрмбасе. lib (розничные сборки); </dt> <dt>Стрмбасд. lib (отладочные сборки)</dt> </dl> |



 

 




