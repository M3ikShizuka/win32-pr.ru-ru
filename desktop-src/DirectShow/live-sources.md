---
description: Активные источники
ms.assetid: 571fe5e5-9616-463b-837c-f8dbb8adf1be
title: Активные источники
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43486cf3db797f493c9446bf782989b8beaae829
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495066"
---
# <a name="live-sources"></a>Активные источники

Активный источник, который также называется *источником push-уведомлений*, получает данные в режиме реального времени. Примеры включают видеозапись и широковещательные сети. Как правило, активный источник не может управлять скоростью поступления данных.

Фильтр считается активным источником, если выполняется одно из следующих условий.

-   Фильтр возвращает для фильтра i \_ \_ \_ Флаги \_ -источники флаги \_ источника из метода [**иамфилтермискфлагс:: жетмискфлагс**](/windows/desktop/api/Strmif/nf-strmif-iamfiltermiscflags-getmiscflags) , а по крайней мере один из его выходных контактов предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) .
-   Фильтр предоставляет интерфейс [**икспропертисет**](ikspropertyset.md) и имеет ПИН-код записи ( \_ запись категории закрепления \_ ). Дополнительные сведения см. в разделе [закрепить набор свойств](pin-property-set.md) .

Если фильтр источника содержит часы, диспетчер графа фильтров будет предпочитать этот момент времени при выборе часового таймера. Дополнительные сведения см. в разделе [эталонные часы](reference-clocks.md) .

**Задержка**

Задержка фильтра — это период времени, в течение которого Фильтр обрабатывает пример. Для активных источников задержка определяется размером буфера, используемого для хранения выборок. Например, предположим, что граф фильтра имеет источник видео с задержкой 33 миллисекунд (МС) и источником звука с задержкой 500 мс. Каждый видеокадр поступает на устройство визуализации видео о 470 МС, прежде чем соответствующий образец будет достигить модуль подготовки звука. Если граф не компенсирует разницу, аудио и видео не будут синхронизированы.

Динамические источники можно синхронизировать с помощью интерфейса [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) . Диспетчер графов фильтров не синхронизирует активные источники, если приложение не поддерживает синхронизацию путем вызова метода [**иамграфстреамс:: синкусингстреамоффсет**](/windows/desktop/api/Strmif/nf-strmif-iamgraphstreams-syncusingstreamoffset) . Если синхронизация включена, диспетчер графа фильтров запрашивает каждый фильтр источника для **иампушсаурце**. Если фильтр поддерживает **иампушсаурце**, диспетчер графа фильтров вызывает [**иамлатенци::**](/windows/desktop/api/Strmif/nf-strmif-iamlatency-getlatency) для получения ожидаемой задержки фильтра. (Интерфейс **иампушсаурце** наследует [**иамлатенци**](/windows/desktop/api/Strmif/nn-strmif-iamlatency).) Из Объединенных значений задержки диспетчер графов фильтров определяет максимальную ожидаемую задержку в графе. Затем он вызывает метод [**иампушсаурце:: сетстреамоффсет**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-setstreamoffset) , чтобы каждому исходному фильтру присвоено смещение потока, которое фильтр добавляет к создаваемым им штампам времени.

Этот метод предназначен в первую очередь для интерактивной предварительной версии. Однако обратите внимание, что предварительный ПИН-код на устройстве записи в режиме реального времени (например, на камере) не устанавливает штампы временных меток для образцов, которые она предоставляет. Поэтому для использования этого метода с устройством записи в реальном времени необходимо предварительно просмотреть ПИН-код записи. Дополнительные сведения см. в статье [Фильтры захвата видео DirectShow](directshow-video-capture-filters.md).

В настоящее время интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) поддерживается фильтром [записи VFW](vfw-capture-filter.md) и фильтром [записи звука](audio-capture-filter.md) .

**Сопоставление частоты**

Если фильтр модуля подготовки отчетов планирует выборку с помощью одного эталонного таймера, но фильтр источника создает их, используя разные часы, при воспроизведении могут возникать сбои. Модуль подготовки отчетов может работать быстрее, чем источник, что приводит к пропуску данных. Или может выполняться медленнее, чем источник, что приводит к тому, что выборка выполняется в несколько точек до тех пор, пока на диаграмме образцы не будут удалены. Как правило, активный источник не может управлять своей производственной частотой, поэтому модуль подготовки отчетов должен соответствовать тарифам с источником.

В настоящее время сопоставление скорости выполняется только модулем подготовки звука, так как сбои в воспроизведении аудио являются более заметными, чем сбои в видео. Чтобы выполнить согласование скорости, модуль подготовки звука должен выбрать что-то, с которым он будет соответствовать тарифам. Он использует следующий алгоритм:

-   Если граф не использует ссылочный период, модуль подготовки звука не пытается согласовать тарифы. (Если на графе нет эталонного таймера, выборки всегда подготавливаются сразу же после их прибытия.)
-   В противном случае, если для графа имеется эталонный таймер, модуль подготовки звука проверяет, существует ли потоковая передача в реальном времени, используя описанные выше критерии. Если нет, то модуль подготовки звука не соответствует тарифам.
-   Если имеется потоковая передача в реальном времени и этот источник предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) на выходном ПИН-коде, модуль подготовки звука вызывает [**Иампушсаурце:: жетпушсаурцефлагс**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags). Он ищет один из следующих флагов:
    -   \_пушсаурцекапс \_ внутренний \_ RM. Этот флаг означает, что фильтр источника имеет собственный механизм сопоставления ставок, поэтому модуль подготовки звука не соответствует тарифам.
    -   \_пушсаурцекапс \_ не \_ проживает. Этот флаг означает, что фильтр источника не является фактически исходным источником, несмотря на то, что он предоставляет интерфейс [**иампушсаурце**](/windows/desktop/api/Strmif/nn-strmif-iampushsource) . Таким образом, модуль подготовки звука не соответствует тарифам.
    -   \_пушсаурцекапс \_ закрытые \_ часы. Этот флаг означает, что фильтр источника использует закрытые часы для создания меток времени. В этом случае модуль подготовки звука сопоставляет ставки с метками времени. (Если для образцов не заданы отметки времени, модуль подготовки отчетов игнорирует этот флаг.)
-   Если [**жетпушсаурцефлагс**](/windows/desktop/api/Strmif/nf-strmif-iampushsource-getpushsourceflags) не возвращает флаги (ноль), поведение модуля подготовки звука зависит от часов графа, а также от того, имеют ли образцы отметки времени:
    -   Если модуль подготовки звука не является часами графа, а образцы имеют отметки времени, модуль подготовки звука соответствует тарифам в соответствии с отметками времени.
    -   Если у образцов нет штампов времени, модуль подготовки звука пытается согласовать скорость входящих звуковых данных.
    -   Если модуль подготовки звука является часами графа, он пытается сопоставить входящую скорость передачи данных.

Причиной последнего варианта является следующее: Если модуль подготовки звука является эталонным, а фильтр источника использует те же часы для создания штампов времени, то модуль подготовки звука не может согласовать скорости с отметками времени. Если это так, то, в свою очередь, попытается согласовать тарифы с самим собой, что может привести к смещению часов. Поэтому в этом случае модуль подготовки отчетов соответствует скорости входящих звуковых данных.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Время и часы в DirectShow](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



