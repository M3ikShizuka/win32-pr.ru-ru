---
description: Общие сведения о построении графов
ms.assetid: 5753f06c-ecfd-48d7-a8e9-768b798e9279
title: Общие сведения о построении графов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f69ef9ea0f4f9e21d33372ad2a37a59b512d5dcc
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104139895"
---
# <a name="overview-of-graph-building"></a>Общие сведения о построении графов

Чтобы создать граф фильтра, начните с создания экземпляра диспетчера графа фильтров:


```C++
IGraphBuilder* pIGB;
HRESULT hr = CoCreateInstance(CLSID_FilterGraph,
    NULL, CLSCTX_INPROC_SERVER, IID_IGraphBuilder,
    (void **)&pIGB);
```



Диспетчер графов фильтров поддерживает следующие методы построения диаграмм:

-   [**Ифилтерграф:: коннектдирект**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-connectdirect) пытается установить прямое соединение между двумя контактами. Если ПИН-коды не могут подключиться, метод завершается с ошибкой.
-   [**Играфбуилдер:: Connect**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-connect) соединяет два контакта. По возможности он устанавливает прямое соединение. В противном случае для завершения подключения используются промежуточные фильтры.
-   [**Играфбуилдер:: Render**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-render) начинается с выходного ПИН-кода и создает оставшуюся часть графа. Эти методы добавляют фильтры по мере необходимости, работают нисходящими, пока не достигнет фильтра модуля подготовки отчетов.
-   [**Играфбуилдер:: renderFile**](/windows/desktop/api/Strmif/nf-strmif-igraphbuilder-renderfile) создает полный граф воспроизведения файлов.
-   [**Ифилтерграф:: аддфилтер**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-addfilter) добавляет фильтр в граф. Он не подключается к фильтру. Перед вызовом этого метода необходимо создать фильтр, вызвав **CoCreateInstance** или перечислителя фильтров или перечислитель системных устройств.

Эти методы предоставляют три основных подхода к построению графа:

1.  Диспетчер графов фильтров строит весь граф.
2.  Диспетчер графов фильтров строит часть графа.
3.  Приложение создает весь граф.

**Диспетчер графов фильтров строит весь граф**

Если нужно просто воспроизвести файл, созданный в известном формате, например AVI, MPEG, WAV или MP3, используйте метод **RenderFile** . В статье [как воспроизвести файл](how-to-play-a-file.md) показано, как это сделать.

Метод **RenderFile** начинается с просмотра в реестре исходного фильтра, который может проанализировать файл. Он использует протокол (например `https://` , в URL-адресе), расширение файла или предварительно определенные шаблоны байтов в файле для определения фильтра источника. Дополнительные сведения см. [в разделе Регистрация пользовательского типа файлов](registering-a-custom-file-type.md).

Чтобы построить остальную часть графа, диспетчер графов фильтров использует итеративный процесс, где он принимает типы мультимедиа, поддерживаемые фильтром, на закреплениях вывода, а также выполняет поиск фильтров в реестре, которые принимают этот тип мультимедиа в качестве входных данных. Он использует несколько критериев, чтобы сократить количество фильтров поиска и приоритизации:

-   *Категория фильтра* определяет общие функциональные возможности фильтра.
-   Тип носителя описывает, какие данные может принимать фильтр в качестве входных данных или доставки в качестве выходных данных.
-   Неудача *определяет порядок* , в котором будут применяться фильтры. Если два фильтра в одной и той же категории фильтров поддерживают одни и те же типы входных данных, диспетчер графа фильтров выбирает один из них с наибольшим значением. Некоторым фильтрам назначено небольшое значение, поскольку они предназначены для специализированных целей и должны добавляться только в граф приложения.

Диспетчер графов фильтров использует объект [сопоставителя фильтров](filter-mapper.md) для поиска в реестре.

При добавлении каждого фильтра диспетчер графа фильтров пытается подключить его к выходному ПИН-коду предыдущего фильтра. Фильтры согласовываются, чтобы определить, могут ли они подключаться, и, если да, какой тип носителя использовать для соединения. Если новый фильтр не может подключиться, диспетчер графа фильтра отклоняет его и пытается выполнить другой фильтр. Этот процесс продолжится до подготовки каждого потока.

**Диспетчер графов фильтров строит часть графа**

Чтобы сделать что-то, помимо простого воспроизведения файла, приложение должно выполнить по крайней мере некоторые операции построения графа. Например, приложение для записи видео должно выбрать фильтр источника захвата и добавить его в граф. Если данные записываются в файл AVI, на диаграмму необходимо добавить фильтры мультиплексора и модуль записи файлов AVI. Однако часто можно позволить диспетчеру графа фильтров завершить график. Например, можно отобразить ПИН-код для предварительного просмотра, вызвав метод **Render** .

**Приложение создает весь граф**

В некоторых сценариях приложению может потребоваться построить граф, добавив и подключив каждый фильтр. В этом случае, возможно, вам известно, какие фильтры следует добавить к диаграмме. При таком подходе приложение добавляет каждый фильтр путем вызова **аддфилтер**, перечисляет контакты в фильтрах и подключает их, вызывая **Connect** или **коннектдирект**.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Построение диаграмм с помощью построителя графа записи](building-graphs-with-the-capture-graph-builder.md)
</dt> <dt>

[Перечисление устройств и фильтров](enumerating-devices-and-filters.md)
</dt> <dt>

[Перечисление объектов в графе фильтра](enumerating-objects-in-a-filter-graph.md)
</dt> <dt>

[Общие методы Graph-Building](general-graph-building-techniques.md)
</dt> <dt>

[Построение графа фильтра](building-the-filter-graph.md)
</dt> </dl>

 

 



