---
description: Общие сведения о Копп
ms.assetid: 4421ab65-e44a-4d1f-8d9b-b187227429c6
title: Общие сведения о Копп
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 41fc83293c1914ed69700cabb9507841d03a7ad3
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105682241"
---
# <a name="overview-of-copp"></a>Общие сведения о Копп

Ниже приведены основные шаги, которые необходимо выполнить приложению для использования протокола Копп.

**Получение цепочки сертификатов драйвера**

1.  Создайте граф воспроизведения DirectShow, который визуализирует видео с помощью формирователя микширования видео (VMR-7 или VMR-9) или [**расширенного**](enhanced-video-renderer-filter.md) фильтра модуля подготовки отчетов (Евр).
2.  Запросите VMR для интерфейса [**иамцертифиедаутпутпротектион**](/windows/desktop/api/Strmif/nn-strmif-iamcertifiedoutputprotection) .
3.  Вызовите [**иамцертифиедаутпутпротектион:: кэйексчанже**](/windows/desktop/api/Strmif/nf-strmif-iamcertifiedoutputprotection-keyexchange). Этот метод возвращает 128-разрядное случайное число из драйвера, а также цепочку сертификатов, содержащую 2048-разрядный открытый ключ RSA драйвера.

**Проверка цепочки сертификатов**

1.  Проверьте цепочку сертификатов. Если цепочка сертификатов недействительна, прервите ее.
2.  Проверьте список отзыва сертификатов (CRL). Если какой бы то ни было сертификат в цепочке сертификатов появился в списке отзыва, прервите его.
3.  Получите открытый ключ RSA из цепочки сертификатов.

**Инициализация сеанса Копп**

1.  Создайте 128-разрядный ключ сеанса AES. Этот ключ используется для подписывания данных и проверки того, что подписанные данные не были изменены.
2.  Создание двух криптографических безопасных случайных чисел с защитой 32. Первый — это порядковый номер состояния, второй — порядковый номер команды. Каждый раз, когда приложение отправляет команду или запрос состояния, оно увеличивает соответствующий порядковый номер и включает этот номер в команду Копп или данные запроса.
3.  Объедините 128-разрядное случайное число из графического драйвера, ключа сеанса AES, порядкового номера состояния и порядкового номера команды. Зашифруйте этот массив байтов с помощью открытого ключа драйвера и передайте результат в [**иамцертифиедаутпутпротектион:: сессионсекуенцестарт**](/windows/desktop/api/Strmif/nf-strmif-iamcertifiedoutputprotection-sessionsequencestart).

**Отправка команд Копп и запросов состояния**

1.  Запросите доступные типы защиты и другие сведения, вызвав [**иамцертифиедаутпутпротектион::P ротектионстатус**](/windows/desktop/api/Strmif/nf-strmif-iamcertifiedoutputprotection-protectionstatus).
2.  Задайте требуемые уровни защиты, вызвав [**иамцертифиедаутпутпротектион::P ротектионкомманд**](/windows/desktop/api/Strmif/nf-strmif-iamcertifiedoutputprotection-protectioncommand).
3.  Периодически запрашивает текущий локальный уровень защиты. Остановка воспроизведения при неожиданном изменении локального уровня защиты или обнаружении проблемы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование протокола сертифицированной выходной защиты (Копп)](using-certified-output-protection-protocol--copp.md)
</dt> </dl>

 

 



