---
description: Класс Кбасеаллокатор является абстрактным базовым классом, реализующим распределитель. Распределительы предоставляют интерфейс Имемаллокатор.
ms.assetid: 3c9003d8-f15c-4e85-9712-9aaa87dffdf3
title: Класс Кбасеаллокатор (Амфилтер. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CBaseAllocator
api_type:
- COM
api_location:
- Strmbase.lib
- Strmbase.dll
- Strmbasd.lib
- Strmbasd.dll
ms.openlocfilehash: 068dd45ee3ffac5c3b915c3b0cdd8bc87756377e
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105688775"
---
# <a name="cbaseallocator-class"></a>Класс Кбасеаллокатор

![Иерархия классов кбасеаллокатор](images/filter10.png)

Класс **кбасеаллокатор** является абстрактным базовым классом, реализующим распределитель. Распределительы предоставляют интерфейс [**имемаллокатор**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .

*Распределитель* — это объект, который выделяет буферы памяти. Распределитель поддерживает список доступных буферов. Когда клиент (как правило, фильтр) запрашивает буфер, распределитель получает его из списка. Клиент заполняет буфер данными и может передать буфер другому объекту. В конечном итоге буфер освобождается, и распределитель возвращает его в список доступных буферов.

Каждый буфер инкапсулируется объектом, называемым *примером мультимедиа*. Примеры носителей — это способ упаковки указателей на блоки памяти в среде COM. Примеры носителей предоставляют интерфейс [**имедиасампле**](/windows/desktop/api/Strmif/nn-strmif-imediasample) и реализуются с помощью класса [**кмедиасампле**](cmediasample.md) . Пример носителя содержит указатель на связанный буфер, доступ к которому можно получить путем вызова метода [**имедиасампле::-Point**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer) . Дополнительные сведения см. в разделе [Samples and распределителяs](samples-and-allocators.md).

Чтобы использовать этот класс, выполните следующие действия.

1.  Вызовите метод [**кбасеаллокатор:: SetProperties**](cbaseallocator-setproperties.md) , чтобы указать требования к буферу, включая количество буферов и размер каждого буфера.
2.  Вызовите метод [**кбасеаллокатор:: Commit**](cbaseallocator-commit.md) , чтобы выделить буферы.
3.  Вызовите метод [**кбасеаллокатор::**](cbaseallocator-getbuffer.md) WebMethod для получения примеров мультимедиа. Этот метод блокируется до тех пор, пока не станет доступным следующий образец.
4.  Завершив работу с каждым образцом, вызовите метод **IUnknown:: Release** в примере. Этот образец не удаляется, когда счетчик ссылок достигает нуля. Вместо этого пример возвращается в свободный список распределителя.
5.  По завершении использования распределителя вызовите метод [**кбасеаллокатор::D екоммит**](cbaseallocator-decommit.md) , чтобы освободить память для буферов.

Метод [**commit**](cbaseallocator-commit.md) вызывает виртуальный метод [**Кбасеаллокатор:: Alloc**](cbaseallocator-alloc.md), который выделяет память для буферов. Метод [**uncommit**](cbaseallocator-decommit.md) вызывает чистый виртуальный метод [**Кбасеаллокатор:: Free**](cbaseallocator-free.md), который освобождает память. Производные классы должны переопределять эти два метода.

Базовый класс [**кмемаллокатор**](cmemallocator.md) является производным от **кбасеаллокатор**. Базовые классы фильтров используют класс **кмемаллокатор** .



| Защищенные переменные членов                                                   | Описание                                                                                |
|------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| [**m \_ лфри**](cbaseallocator-m-lfree.md)                                   | Указатель на список доступных (бесплатных) образцов мультимедиа.                                       |
| [**m \_ хсем**](cbaseallocator-m-hsem.md)                                     | Семафор, сигнальный при появления образца.                                |
| [**m \_ лваитинг**](cbaseallocator-m-lwaiting.md)                             | Число потоков, ожидающих выборок.                                                      |
| [**m \_ lCount**](cbaseallocator-m-lcount.md)                                 | Количество буферов для предоставления.                                                              |
| [**m \_ лаллокатед**](cbaseallocator-m-lallocated.md)                         | Количество буферов, выделенных в настоящий момент.                                                     |
| [**m \_ лсизе**](cbaseallocator-m-lsize.md)                                   | Размер каждого буфера.                                                                       |
| [**m \_ лалигнмент**](cbaseallocator-m-lalignment.md)                         | Выравнивание каждого буфера.                                                                  |
| [**m \_ лпрефикс**](cbaseallocator-m-lprefix.md)                               | Префикс каждого буфера.                                                                     |
| [**m \_ бчанжед**](cbaseallocator-m-bchanged.md)                             | Флаг, указывающий, изменились ли требования к буферу.                              |
| [**m \_ бкоммиттед**](cbaseallocator-m-bcommitted.md)                         | Флаг, указывающий, зафиксирован ли распределитель.                                  |
| [**m \_ бдекоммитинпрогресс**](cbaseallocator-m-bdecommitinprogress.md)       | Флаг, указывающий, выполняется ли операция дефиксации.                               |
| [**m \_ пнотифи**](cbaseallocator-m-pnotify.md)                               | Указатель на интерфейс обратного вызова, который вызывается при освобождении образцов.                |
| [**m \_ фенаблерелеасекаллбакк**](cbaseallocator-m-fenablereleasecallback.md) | Флаг, указывающий, включен ли обратный вызов выпуска.                                   |
| Защищенные методы                                                            | Описание                                                                                |
| [**Идентификатор**](cbaseallocator-alloc.md)                                        | Выделяет память для буферов. Виртуализаци.                                                 |
| Открытые методы                                                               | Описание                                                                                |
| [**кбасеаллокатор**](cbaseallocator-cbaseallocator.md)                      | Метод конструктора.                                                                        |
| [**~ Кбасеаллокатор**](cbaseallocator--cbaseallocator.md)                   | Метод деструктора.                                                                         |
| [**сетнотифи**](cbaseallocator-setnotify.md)                                | Является устаревшей.                                                                                  |
| [**жетфрикаунт**](cbaseallocator-getfreecount.md)                          | Возвращает количество неиспользуемых выборок мультимедиа.                                 |
| [**нотифисампле**](cbaseallocator-notifysample.md)                          | Освобождает все потоки, ожидающие выборки.                                         |
| [**сетваитинг**](cbaseallocator-setwaiting.md)                              | Увеличивает число ожидающих потоков.                                                   |
| Чистые виртуальные методы                                                         | Описание                                                                                |
| [**Free**](cbaseallocator-free.md)                                          | Освобождает всю буферную память.                                                         |
| Методы Имемаллокатор                                                        | Описание                                                                                |
| [**SetProperties**](cbaseallocator-setproperties.md)                        | Указывает количество выделяемых буферов и размер каждого буфера.                   |
| [**GetProperties**](cbaseallocator-getproperties.md)                        | Извлекает количество буферов, которые будут созданы распределителем, и свойства буфера. |
| [**Сохраните**](cbaseallocator-commit.md)                                      | Выделяет память для буферов.                                                      |
| [**Освобождения**](cbaseallocator-decommit.md)                                  | Отменяет фиксацию буферов.                                                                     |
| [**GetBuffer**](cbaseallocator-getbuffer.md)                                | Извлекает пример носителя, содержащий буфер.                                           |
| [**релеасебуффер**](cbaseallocator-releasebuffer.md)                        | Возвращает пример носителя в список примеров бесплатных носителей.                                  |



 

## <a name="requirements"></a>Требования



| Требование | Значение |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Header<br/>  | <dl> <dt>Амфилтер. h (включение Streams. h)</dt> </dl>                                                                                  |
| Библиотека<br/> | <dl> <dt>Стрмбасе. lib (розничные сборки); </dt> <dt>Стрмбасд. lib (отладочные сборки)</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Предоставление пользовательского распределителя](providing-a-custom-allocator.md)
</dt> </dl>

 

 




