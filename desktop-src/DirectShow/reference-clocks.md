---
description: Эталонные часы
ms.assetid: 43f1a4d6-dbed-4940-a301-d863ddd34bce
title: Эталонные часы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9b958787f4dbdb20cd595b10cf486f59222a072
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "105673000"
---
# <a name="reference-clocks"></a>Эталонные часы

Одна из функций диспетчера графа фильтров — синхронизировать все фильтры в графе с теми же часами, которые называются *ссылочным временем*.

Любой объект, предоставляющий интерфейс [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock) , может использоваться в качестве эталонного времени. Ссылочное время может предоставляться фильтром DirectShow — обычно модулем подготовки звука, который имеет доступ к аппаратному таймеру. В качестве резервного варианта диспетчер графа фильтров может использовать системное время.

В номинальной величине эталонное значение измеряет время в 100-наносекундных интервалах, хотя фактическая точность часов может быть меньше. Чтобы получить текущее время часов, вызовите метод [**иреференцеклокк:: OnTime**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) . Базовый показатель часов — время, с которого он начинает подсчитаться, зависит от реализации, поэтому значение, возвращаемое методомического **времени** , не является значимым. Важность — это Дельта, начиная с момента начала работы графа.

Хотя точность ссылочного времени может быть различной, время, возвращаемое [**методом Times**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) , гарантированно увеличивается монотонно. Иными словами, время часы никогда не переходят назад. Если эталонный таймер создает часы из аппаратного источника, а аппаратные часы переходят назад (например, при наличии корректировки для часов) **, метод Times** должен возвращать Последнее сообщаемое время до тех пор, пока аппаратные часы не будут перехватываться. Дополнительные сведения см. в разделе [**класс кбасереференцеклокк**](cbasereferenceclock.md).

**Эталонный таймер по умолчанию**

Диспетчер графов фильтров автоматически выбирает эталонный таймер при выполнении графа. Для выбора часов используется следующий алгоритм:

-   Если приложение выбрало часы (см. ниже), используйте это время.
-   Если граф содержит фильтр активного источника, поддерживающий [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), используйте этот фильтр. Определение активного источника см. в разделе [Динамические источники](live-sources.md).
-   Если граф не содержит фильтров источника Live, используйте любой фильтр в графе, который поддерживает [**иреференцеклокк**](/windows/desktop/api/Strmif/nn-strmif-ireferenceclock), начиная с модулей подготовки отчетов и рабочего потока. Предпочитать подключенные фильтры по неподключенным фильтрам. (Если граф выполняет визуализацию аудиопотока, этот шаг обычно выбирает фильтр модуля подготовки звука.)
-   Если ни один из фильтров не предоставляет подходящее время, используйте [системные часы](system-reference-clock.md), которые основаны на системном времени.

**Задание ссылочного времени**

Приложение может выбрать часы, вызвав метод [**имедиафилтер:: сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) в диспетчере графов фильтров. Это следует делать только в том случае, если есть конкретная причина для того, чтобы предпочитать другие часы.

Можно указать диспетчеру графа фильтров не использовать время ссылки, вызвав [**сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) со значением **null**. Например, это можно сделать для быстрой обработки образцов как можно быстрее. Чтобы восстановить ссылочное время по умолчанию, вызовите метод [**ифилтерграф:: сетдефаултсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-ifiltergraph-setdefaultsyncsource) в диспетчере графов фильтров.

При изменении ссылочного времени диспетчер графа фильтров уведомляет каждый фильтр, вызывая его метод [**имедиафилтер:: сетсинксаурце**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-setsyncsource) . Приложения никогда не должны вызывать этот метод для фильтров.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Настройка часов графа](setting-the-graph-clock.md)
</dt> <dt>

[Время и часы в DirectShow](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



