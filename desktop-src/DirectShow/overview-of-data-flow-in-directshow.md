---
description: Общие сведения о потоке данных в DirectShow
ms.assetid: a1b30592-5106-44f5-8ee0-577573670167
title: Общие сведения о потоке данных в DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5b5a34444991d6cba62026935f5ec2d7aa4eba77
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495447"
---
# <a name="overview-of-data-flow-in-directshow"></a>Общие сведения о потоке данных в DirectShow

В этом разделе содержится общий обзор работы потока данных в DirectShow. Подробные сведения можно найти в других разделах документации.

Данные хранятся в буферах, которые представляют собой просто массивы байтов. Каждый буфер упаковывается COM-объектом, называемым *примером мультимедиа*, который реализует интерфейс [**имедиасампле**](/windows/desktop/api/Strmif/nn-strmif-imediasample) . Образцы создаются другим типом объекта, который называется распределителем, реализующим интерфейс [**имемаллокатор**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) . Распределитель назначается для каждого подключения к ПИН-коду, хотя два или более подключения ПИН-кода могут использовать один и тот же распределитель. Этот процесс показан на следующем рисунке.

![буферы, примеры и распределительы](images/dataflow.png)

Каждый распределитель создает пул образцов носителей и выделяет буферы для каждого образца. Каждый раз, когда фильтр должен заполнить буфер данными, он запрашивает выборку из распределителя путем вызова [**имемаллокатор::-buffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer). Если распределитель содержит какие-либо выборки, которые в настоящее время не используются другим фильтром **, метод метода** WebMethod возвращает значение сразу с указателем на образец. Если все примеры распределителя используются, метод блокируется до тех пор, пока образец не станет доступным. Когда метод возвращает образец, фильтр помещает данные в буфер, устанавливает соответствующие флаги для образца (обычно включая метку времени) и доставляет пример в нисходящей.

Когда фильтр модуля подготовки отчетов получает образец, он проверяет метку времени и удерживает ее в образце до тех пор, пока не будет указано, что данные должны быть визуализированы. После того как фильтр отрисовывает данные, он освобождает пример. Этот пример не возвращается в пул образцов распределителя, пока значение счетчика ссылок в образце не равно нулю, то есть каждый фильтр освободил пример. Этот процесс показан на следующем рисунке.

![декодер, ожидающий пример свободного носителя](images/dataflow2.png)

Вышестоящий фильтр может работать впереди модуля подготовки отчетов, т. е. он может заполнять буферы быстрее, чем при использовании модуля подготовки отчетов. Несмотря на это, образцы не отображаются на раннем этапе, так как модуль подготовки отчетов хранит их до времени презентации. Более того, вышестоящий фильтр случайно не перезаписывает буферы, так как метод- **Sample** возвращает только образцы, которые не используются в других случаях. Величина, на которую воспроизводится вышестоящий фильтр, определяется количеством выборок в пуле распределителя.

На предыдущей схеме показан только один распределитель, но обычно существует несколько распределительов на поток. Таким же, когда модуль подготовки отчетов освобождает пример, он может иметь каскадный результат. На следующей диаграмме показана ситуация, когда декодер содержит сжатый кадр видео, в то время как он ожидает освобождения примера в модуле подготовки отчетов. Фильтр анализатора также ожидает, пока декодер выдаст пример.

![два фильтра ожидают выборки](images/dataflow3.png)

Когда модуль подготовки к выпуску выдает свой пример, в нем возвращаются вызовы метода **buffer** . Затем декодер может декодировать сжатый видеокадр и выпустить пример, который он удерживает, тем самым разблокируя отложенный вызов **метода** noframes средства синтаксического анализа.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Поток данных в графе фильтра](data-flow-in-the-filter-graph.md)
</dt> </dl>

 

 



