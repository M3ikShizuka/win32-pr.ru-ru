---
description: Сведения о типах носителей в DirectShow. Тип мультимедиа является универсальным и расширяемым способом описания форматов цифрового мультимедиа.
ms.assetid: 9984ba36-4e43-4886-a073-34b330274c9c
title: Сведения о типах носителей (DirectShow)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fa3034581e443472f1b73c0bc42ca7b8b532a18120df3e067b02ad16f37930e
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119074898"
---
# <a name="about-media-types-directshow"></a>Сведения о типах носителей (DirectShow)

поскольку DirectShow является модульной, ему требуется способ описания формата данных в каждой точке графа фильтра. Например, рассмотрите возможность воспроизведения AVI. Данные вводятся в граф в виде потока фрагментов Metallica. Они анализируются по потокам видео и аудио. Поток видео состоит из кадров видео, которые, вероятно, сжимаются. После декодирования видеопоток представляет собой серию несжатых точечных рисунков. Поток аудио проходит через аналогичный процесс.

типы носителей: как DirectShow представляет форматы

*Тип мультимедиа* является универсальным и расширяемым способом описания форматов цифрового мультимедиа. При подключении двух фильтров они согласовывают тип носителя. Тип носителя определяет, какой тип данных будет доставлен вышестоящим фильтром в нисходящий фильтр, и физический макет данных. Если два фильтра не могут согласовать тип носителя, они не будут подключаться.

Для некоторых приложений не придется беспокоиться о типах носителей. например, при воспроизведении файла DirectShow обрабатывает все сведения. Другим типам приложений может потребоваться работать непосредственно с типами мультимедиа.

Типы носителей определяются с помощью [**структуры \_ \_ типов мультимедиа AM**](/windows/win32/api/strmif/ns-strmif-am_media_type) . Эта структура содержит следующие сведения:

-   **Основной тип**: основной тип — это идентификатор GUID, определяющий общую категорию данных. К основным типам относятся видео, звуковые, непроанализированные байтовые потоки, данные MIDI и т. д.
-   **Подтип**: подтип — еще один идентификатор GUID, который дополнительно определяет формат. Например, в основном типе видео существуют подтипы для RGB-24, RGB-32, UYVY и т. д. В аудио есть звук PCM, полезные данные MPEG-1 и другие. Подтип предоставляет больше информации, чем основной тип, но не определяет все сведения о формате. Например, подтипы видео не определяют размер изображения или частоту кадров. Они определяются блоком format, описанным ниже.
-   **Блок формата**. блок формата представляет собой блок данных, подробно описывающий формат. Блок формата выделяется отдельно от структуры [**\_ \_ типа мультимедиа AM**](/windows/win32/api/strmif/ns-strmif-am_media_type) . Элемент **пбформат** структуры **\_ \_ типов мультимедиа** указывает на блок формата.

    Элемент **пбформат** типизирован **void \** _, так как макет блока форматирования изменяется в зависимости от типа носителя. Например, в звуковом PCM используется структура [_ *вавеформатекс* *](/previous-versions/dd757713(v=vs.85)) . Видео использует различные структуры, включая [**видеоинфохеадер**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) и [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2). Элемент **форматтипе** структуры [**\_ \_ типа мультимедиа AM**](/windows/win32/api/strmif/ns-strmif-am_media_type) представляет собой идентификатор GUID, указывающий, какая структура содержится в блоке формата. Каждой структуре формата назначается идентификатор GUID. Элемент **кбформат** задает размер блока Format. Всегда проверяйте эти значения перед разыменованием указателя **пбформат** .

Если блок формата заполнен, основной тип и подтип содержат избыточные сведения. Однако основной тип и подтип предоставляют удобный способ для распознавания форматов без полного блока форматирования. Например, можно указать универсальный 24-разрядный формат RGB (МЕДИАСУБТИПЕ \_ Rgb24), не зная всю информацию, необходимую для структуры [**видеоинфохеадер**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) , например размер изображения и частоту кадров.

Например, фильтр может использовать следующий код для проверки типа мультимедиа:


```C++
HRESULT CheckMediaType(AM_MEDIA_TYPE *pmt)
{
    if (pmt == NULL) return E_POINTER;

    // Check the major type. We're looking for video.
    if (pmt->majortype != MEDIATYPE_Video)
    {
        return VFW_E_INVALIDMEDIATYPE;
    }

    // Check the subtype. We're looking for 24-bit RGB.
    if (pmt->subtype != MEDIASUBTYPE_RGB24)
    {
        return VFW_E_INVALIDMEDIATYPE;
    }

    // Check the format type and the size of the format block.
    if ((pmt->formattype == FORMAT_VideoInfo) &&
         (pmt->cbFormat >= sizeof(VIDEOINFOHEADER) &&
         (pmt->pbFormat != NULL))
    {
        // Now it's safe to coerce the format block pointer to the
        // correct structure, as defined by the formattype GUID.
        VIDEOINFOHEADER *pVIH = (VIDEOINFOHEADER*)pmt->pbFormat;
    
        // Examine pVIH (not shown). If it looks OK, return S_OK.
        return S_OK;
    }

    return VFW_E_INVALIDMEDIATYPE;
}
```



Структура [**\_ \_ типа файлов мультимедиа AM**](/windows/win32/api/strmif/ns-strmif-am_media_type) также содержит некоторые необязательные поля. Они могут использоваться для предоставления дополнительных сведений, но для их использования не требуются фильтры.

-   **лсамплесизе**. Если это поле не равно нулю, оно определяет размер каждого образца. Если он равен нулю, это означает, что размер выборки может измениться с Sample на Sample.
-   **бфикседсизесамплес**. Если этот логический флаг имеет значение **true**, это означает, что значение в **лсамплесизе** является допустимым. В противном случае следует игнорировать **лсамплесизе**.
-   **бтемпоралкомпрессион**. Если этот логический флаг имеет **значение false**, это означает, что все кадры являются ключевыми кадрами.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[фильтр Graph и его компоненты](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 
