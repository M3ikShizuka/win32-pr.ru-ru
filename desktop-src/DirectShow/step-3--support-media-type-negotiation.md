---
description: Шаг 3.
ms.assetid: b2b5dafc-d38d-4ec3-a390-55229495b4f9
title: Шаг 3. Поддержка согласования типов мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb3ff8539d0d7de2c9b7300ddb90ad86ca471710
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "103914127"
---
# <a name="step-3-support-media-type-negotiation"></a>Шаг 3. Поддержка согласования типов мультимедиа

Это шаг 3 учебника [Создание фильтров преобразования](writing-transform-filters.md).

Когда два контакта соединяются, они должны согласовать тип носителя для подключения. Тип носителя описывает формат данных. Без типа носителя фильтр может доставлять данные одного типа, только если другой фильтр обрабатывает его как нечто другое.

Основным механизмом согласования типов мультимедиа является метод [**Ипин:: рецеивеконнектион**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) . Закрепление вывода вызывает этот метод для входного ПИН-кода с предложенным типом мультимедиа. Входной ПИН-код принимает соединение или отклоняет его. Если подключение отклоняется, закрепление вывода может попытаться использовать другой тип мультимедиа. Если подходящие типы не найдены, соединение завершается сбоем. При необходимости входной ПИН-код может объявить список типов, которые он предпочитает, с помощью метода [**Ипин:: енуммедиатипес**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) . Закрепление вывода может использовать этот список, если он предлагает типы мультимедиа, хотя это и не обязательно.

Класс **ктрансформфилтер** реализует общую платформу для этого процесса следующим образом:

-   Входной ПИН-код не имеет предпочтительных типов мультимедиа. Он полностью зависит от вышестоящего фильтра, чтобы предложить тип мультимедиа. Для данных видео это имеет смысл, так как тип носителя включает размер изображения и частоту кадров. Как правило, эта информация должна быть предоставлена фильтром вышестоящего источника или фильтром синтаксического анализатора. В случае с звуковыми данными набор возможных форматов меньше, поэтому входные данные могут быть очень практичными для предоставления некоторых предпочтительных типов. В этом случае Переопределите [**кбасепин:: жетмедиатипе**](cbasepin-getmediatype.md) для входного ПИН-кода.
-   Когда вышестоящий фильтр предлагает тип мультимедиа, входной ПИН-код вызывает метод [**ктрансформфилтер:: чеккинпуттипе**](ctransformfilter-checkinputtype.md) , который принимает или отклоняет тип.
-   ПИН-код выхода не будет подключаться, если только входной ПИН-код не подключен первыми. Это поведение типично для фильтров преобразования. В большинстве случаев фильтр должен определить тип входных данных, прежде чем он сможет задать тип выходных данных.
-   Когда закрепление вывода подключается, он получает список типов мультимедиа, которые он предлагает для подчиненного фильтра. Он вызывает метод [**ктрансформфилтер:: жетмедиатипе**](ctransformfilter-getmediatype.md) для создания этого списка. Закрепление выходных данных также попытается использовать типы мультимедиа, предлагаемые нисходящим фильтром.
-   Чтобы проверить, совместим ли определенный тип выходных данных с типом входных данных, закрепление вывода вызывает метод [**ктрансформфилтер:: чекктрансформ**](ctransformfilter-checktransform.md) .

Три приведенных выше метода **ктрансформфилтер** являются чисто виртуальными методами, поэтому производный класс должен их реализовать. Ни один из этих методов не принадлежит к COM-интерфейсу; они просто являются частью реализации, предоставляемой базовыми классами.

В следующих разделах каждый метод описан более подробно.

-   [Шаг 3A. Реализация метода Чеккинпуттипе](step-3a--implement-the-checkinputtype-method.md)
-   [Шаг 3B. Реализация метода Жетмедиатипе](step-3b--implement-the-getmediatype-method.md)
-   [Шаг 3C. Реализация метода Чекктрансформ](step-3c--implement-the-checktransform-method.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Как подключаются фильтры](how-filters-connect.md)
</dt> <dt>

[Написание фильтров DirectShow](writing-directshow-filters.md)
</dt> </dl>

 

 



