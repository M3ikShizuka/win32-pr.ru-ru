---
description: Сопоставление координат в VMR
ms.assetid: f0821b90-51d1-4e77-8aed-04337a3dd623
title: Сопоставление координат в VMR
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c18b38249471e6e68e36f1b9051f51e920f62b31
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103894361"
---
# <a name="coordinate-mapping-in-the-vmr"></a>Сопоставление координат в VMR

В этом разделе описаны пять преобразований, применяемых к исходному изображению перед его сопоставлением VMR с окончательным выходным изображением.

1.  Преобразование *T (src)* сопоставляет исходный прямоугольник с конечным прямоугольником. Они задаются членами **рксаурце** и **рктаржет** структуры [**видеоинфохеадер**](/previous-versions/windows/desktop/api/amvideo/ns-amvideo-videoinfoheader) или [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) в типе мультимедиа. Это сопоставление предварительно обрабатывает исходное изображение, которое передается в VMR.
2.  Преобразование *T (флаг)* выполняет любые манипуляции с изображениями, заданные флагами в примере носителя. Эти преобразования, такие как вертикальное преобразование и масштабирование, удовлетворяют флагам чересстрочную развертки. Преобразование «развертка» удваивает высоту изображения и, возможно, преобразует изображение на половину строки видео, если оно находится в нечетном поле.
3.  Преобразование *T (AR)* корректирует изображение до квадратных пикселей на основе пропорций изображения. Для типов мультимедиа **видеоинфохеадер** пропорции определяются размером изображения. Для типов **VIDEOINFOHEADER2** пропорции определяются полями **двпиктаспектратиокс** и **двпиктаспектратиой** , если только не \_ задано амконтрол Pad \_ на \_ 16x9 или амконтрол \_ Pad \_ в \_ 4x3 flags. Это преобразование предполагает, что параметр отображения монитора соответствует физическому пропорции монитора. Например, если у пользователя есть монитор с пропорциями 4 x 3, но устанавливает дисплей на 1280 x 768 пикселей (5 x 3), изображение не будет иметь правильных пропорций.
4.  Преобразования «Преобразование *T (Mix)* » размещает изображение в целевом изображении с использованием нормализованных прямоугольников, указанных в методах [**ивмрмиксерконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrmixercontrol) . Нормализованные прямоугольники позволяют приложению организовать расположение и масштабирование исходных потоков и масштабировать их относительно друг друга. VMR Вычисляет целевое изображение, вычисляя максимальные размеры всех исходных изображений и выровнять каждый из них внутри общего ограничивающего прямоугольника. Углы ограничивающего прямоугольника назначаются диапазону (0, 0) (1, 1). Ограничивающий прямоугольник фиксируется до выполнения графа и остается постоянным, даже если потоки добавляются или удаляются. Прямоугольники назначения для каждого потока могут находиться вне диапазона (0, 0) до (1, 1) и по-прежнему быть допустимыми.
5.  Наконец, часть смешанного изображения может быть преобразована с помощью сопоставления *T (DST)*, заданного исходным и целевым прямоугольниками в интерфейсе [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo) в VMR. Если Allocator-Presenter заменяется и интерфейс **ибасиквидео** не используется, приложение должно реализовать интерфейс [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) и сопоставлять координаты обратно в плоское линейное пространство. Координаты мыши, возвращаемые в Навигатор DVD, также должны находиться в этом пространстве. Например, если приложение визуализирует видео в вращающийся куб, оно будет сообщать о полном отображении элемента управления без окон и возвращать координаты мыши относительно отображения.

Полное преобразование образа из источника данных в окончательный модуль подготовки отчетов:

T = T (src) \* t (флаг) t (AR) t (Mix) \* t (DST)\*

где \* указывает, что изображение можно обрезать на целевом изображении на этом этапе. Обратите внимание, что это все аффинных преобразования, поэтому VMR может объединить их в одно преобразование.

Обратная часть преобразования:

![обратное преобразование](images/vmrmapping-t-1.png)

Коэффициент t (src) t (флаг) T (AR) задается относительно разрешения источника. В коэффициенте T (Mix) нормализованный исходный прямоугольник является относительным к исправленному изображению. Нормализованный конечный прямоугольник является относительным для разрешения вывода. Эти связи показаны на следующей схеме.

![шаги преобразования изображений](images/vmrmapping-transform-steps.png)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование VMR для разработчиков фильтров DirectShow](using-the-vmr-for-directshow-filter-developers.md)
</dt> </dl>

 

 



