---
description: Смешение без квадрата
ms.assetid: 8d27a921-5638-43ac-807d-e3bd7b9b2de8
title: Смешение без квадрата
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4674891b7b9d44cb35522b6040723bc71436d677b10a4326d9f00a269ce3aff2
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120102422"
---
# <a name="non-square-mixing"></a>Смешение без квадрата

этот раздел относится к Windows XP с пакетом обновления 2 (sp2) или более поздней версии.

Когда VMR-9 наследует два или более потока, существует две точки, в которых может произойти масштабирование: когда микшер передает входные потоки и когда распределитель-представление визуализирует составное изображение.

![операции смешения VMR](images/vmr-nonsquare-mixing.png)

Предыдущие версии VMR-9 всегда составируют входные потоки с помощью квадратного (1:1) пиксельного пропорций (НОМИНАЛа), даже если существовал только один видеопоток. Если входной поток имел неквадратные Пиксели, это привело к ненужной операции масштабирования. Масштабирование следует избегать по возможности, так как оно снижает качество окончательного изображения.

начиная с версии Windows XP с пакетом обновления 2 (sp2), VMR-9 поддерживает два разных способа избежать проблемы двойного масштабирования:

-   Реализуйте пользовательский распределитель-представление и поддержку интерфейса [**IVMRSurfaceAllocatorEx9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrsurfaceallocatorex9) .
-   Использовать режим смешения в режиме без квадрата.

В этом разделе описывается режим смешения в квадратных отделах. Приложения могут сочетать оба метода.

**Принцип работы без квадратных смешений**

В режиме смешения с квадратом VMR-9 выбирает один входной поток в качестве целевого размера и НОМИНАЛа. Микшер VMR не масштабирует видео из этого потока или из других потоков с тем же размером изображения и НОМИНАЛом. Потоки с другим размером или пропорциями масштабируется в соответствии с целевыми номиналами и леттербоксед в соответствии с конечным размером выходного изображения.

Выбор потоков зависит от текущего режима смешивания:

-   Режим смешения YUV ограничен одним видеопотоком на ПИН-коде 0. (Другие ПИН-коды могут иметь подизображение или потоки закрытых титров.) Поэтому VMR-9 всегда выбирает закрепление 0 для целевого образа и НОМИНАЛа.
-   В режиме смешения RGB фильтр VMR выбирает поток с самым большим размером изображения. Если имеется более одного, он выбирается с максимальным z-порядком. Если по-прежнему есть связь, он выбирает поток с наименьшим PIN-кодом.

**Примеры операций**

**Пример 1.** Поток 0 — 720 x 480 пикселей с пропорциями изображения в 16:9. Поток 1 — 640 x 480 пикселей с пропорциями изображения в 4:3.

В этом примере поток 0 имеет самый крупный размер изображения, поэтому VMR выбирает этот поток независимо от режима смешения RGB или режима смешивания ЮБ. Номинал равен 32:27 (16:9/720:480). Это означает, что изображение должно растягиваться по горизонтали с помощью этого соотношения для получения правильных пропорций изображения в 16:9.

Чтобы сопоставить целевую НОМИНАЛу, микшер VMR масштабирует поток 1 на обратный коэффициент (27:32), что приводит к получению изображения 540 x 480. Затем два потока объединяются на одной поверхности. Для правильного отображения полученного изображения распределитель должен горизонтально растянуть изображение в соответствии с пропорциями рисунка 16:9.

![Пример 1.](images/vmr-nonsquare-mixing2.png)

**Пример 2.** Поток 0 — 720 x 480 пикселей с пропорциями изображения в 16:9. Поток 1 — 1024 x 768 пикселей с пропорциями изображения в 4:3.

Если VMR-9 использует режим смешения YUV, он всегда выбирает поток 0. Таким образом, он растягивает поток 1 до 540 x 480 пикселей в соответствии с НОМИНАЛом потока 0.

Если фильтр VMR-9 использует режим смешения RGB, то в качестве целевого объекта выбирается Stream 1, так как этот поток имеет самый крупный размер изображения. Он растягивает поток 0 до размера изображения 1024 x 576 пикселей. Обратите внимание, что в этом случае составной образ имеет значение 1:1, поэтому распределитель-представление не нужно исправлять для неквадратных пикселей. (По-прежнему может потребоваться растяжение видео для учетной записи конечного прямоугольника.)

**Использование режима смешивания без квадрата**

Если выполняется одно из следующих условий, рекомендуется использовать режим смешения, не являющийся квадратным.

-   Приложение никогда не отправляет более одного видеопотока на VMR-9.
-   Приложение визуализирует файлы DVD, телепередач или MS-DVR. В этом случае следует также использовать режим микширования YUV, если графическое оборудование его поддерживает.

Если приложение смешивает несколько потоков видео, которые могут иметь различные размеры изображения или пропорции пикселей, рекомендуется использовать режим смешения по умолчанию.

Чтобы настроить режим смешения друг от друга, граф фильтра должен быть остановлен и все входные контакты отключены на VMR-9. Затем вызовите [**IVMRMixerControl9:: сетмиксингпрефс**](/previous-versions/windows/desktop/api/Vmr9/nf-vmr9-ivmrmixercontrol9-setmixingprefs) с \_ флагом MixerPref9 нонскуаремиксинг:


```C++
DWORD dwPrefs;
pMixControl->GetMixingPrefs(&dwPrefs);  
dwPrefs |= MixerPref9_NonSquareMixing;
pMixControl->SetMixingPrefs(dwPrefs);
```



> [!Note]  
> Если вы объединяете \_ флаг MixerPref9 нонскуаремиксинг с \_ флагом MixerPref9 АРАДЖУСТКСОРИ, VMR-9 игнорирует \_ флаг MixerPref9 араджустксори.

 

Если приложение использует пользовательский распределитель-представление с неквадратным режимом смешения, имейте в виду, что составное изображение может иметь неквадратные НОМИНАЛы. Распределитель-выступающий должен масштабировать изображение до квадрата (1:1) номинал.

**Статические растровые изображения**

Если вы используете интерфейс [**IVMRMixerBitmap9**](/previous-versions/windows/desktop/api/Vmr9/nn-vmr9-ivmrmixerbitmap9) для смешения статического растрового изображения на видео, вы должны считать, что точечный рисунок является вторым видеопотоком в целях смешения в режиме VMR.

VMR считает, что точечный рисунок имеет то же значение номинал, что и целевой объект. Он не масштабирует точечный рисунок для настройки пропорций целевого пикселя. В конфигурации VMR по умолчанию у целевого объекта есть 1:1 номинал, который соответствует большинству точечных рисунков. В режиме неквадратной смешения целевой объект может иметь неквадратные Пиксели. Чтобы обеспечить правильное отображение точечного рисунка, приложение должно предоставить изображение, номинал которого соответствует целевому НОМИНАЛу.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Использование режима смешения VMR](using-vmr-mixing-mode.md)
</dt> </dl>

 

 



