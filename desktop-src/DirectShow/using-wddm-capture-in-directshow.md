---
description: Использование захвата WDDM в DirectShow
ms.assetid: 57ee86b0-50bc-4992-94d4-f290f83d2afc
title: Использование захвата WDDM в DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7926af70a3b7f1c4ba67c791d98c9928c3809b89
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105673985"
---
# <a name="using-wddm-capture-in-directshow"></a>Использование захвата WDDM в DirectShow

Этот раздел относится к Windows Vista и более поздним версиям.

Некоторые видеоадаптеры имеют встроенные функции видеозаписи. На этих картах захваченные видеоматериалы помещаются в видеопамяти (видеопамять). До Windows Vista стандартный механизм обработки кадров, оставшихся в видеопамяти, не существовал. Вместо этого данные должны быть скопированы в системную память, обработаны, а затем скопированы обратно в видеоадаптер для вывода. В Windows Vista DirectShow теперь поддерживает механизм хранения кадров видео в видеопамяти на протяжении всего конвейера обработки, от записи до вывода.

Фильтр Кспрокси определяет, поддерживает ли драйвер захват видеоповерхности путем запроса драйвера для \_ Свойства "Предпочтительная \_ поверхность захвата кспроперти" \_ . (Это свойство описано в документации к пакету драйверов Windows.) Если драйвер поддерживает захват видеоповерхности, Кспрокси выделяет специальный вид мультимедийного примера, который содержит указатель на поверхность Direct3D.

Затем Кспрокси определяет, поддерживает ли нисходящий фильтр ускорение видео DirectX (ДКСВА) 2,0 следующим образом:

1.  Кспрокси запрашивает нисходящий входной ПИН-код для интерфейса **имфжетсервице** .
2.  Если ПИН-код представляет **имфжетсервице**, Кспрокси вызывает **имфжетсервице::-Service** для интерфейса **IDirect3DDeviceManager** . Идентиер службы — это \_ \_ Служба ускорения видео в Mr \_ .

Оба этих интерфейса описаны в документации по Media Foundation SDK.

Если подчиненный фильтр не поддерживает ДКСВА 2,0, Кспрокси выделяет дополнительный буфер системной памяти. Он использует этот буфер для копирования видеокадров из видеопамяти в системную память. Метод [**имедиасампле::-Point**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getpointer) примера мультимедиа возвращает указатель на этот буфер системной памяти.

Однако если нисходящий фильтр поддерживает ДКСВА 2,0, то Кспрокси не выделяет буфер системной памяти. **В этом случае метод метода** Нотимпл возвращает E \_ . Вместо этого ожидается, что нисходящий фильтр обращается к поверхности Direct3D образца напрямую. Существует два способа, с помощью которых подчиненный фильтр получает указатель на поверхность, оба они эквивалентны:

-   Запросите пример для интерфейса **имфжетсервице** и вызовите метод **WebService** для интерфейса **IDirect3DSurface9** . Идентификатор службы — это \_ Служба буфера MR \_ .
-   Выполните запрос к образцу для интерфейса [**IMediaSample2Config**](/windows/desktop/api/Strmif/nn-strmif-imediasample2config) и вызовите [**IMediaSample2Config::**](/windows/desktop/api/Strmif/nf-strmif-imediasample2config-getsurface).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Разделы, посвященные расширенному записи](advanced-capture-topics.md)
</dt> </dl>

 

 



