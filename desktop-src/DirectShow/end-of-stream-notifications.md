---
description: Уведомления о завершении потока
ms.assetid: cf2b13bc-5b54-4ac7-8a33-7434126fdf31
title: Уведомления о завершении потока
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53fcdfef1225aa5b93b56aeaa0d8ae9d0a8550c9
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104262451"
---
# <a name="end-of-stream-notifications"></a>Уведомления о завершении потока

Когда фильтр источника выполняет отправку данных, он вызывает метод [**Ипин:: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) для нисходящего входного ПИН-кода. Нисходящий фильтр распространяет вызов на следующий фильтр и т. д. Когда вызов **EndOfStream** достигает модуля подготовки отчетов, модуль подготовки отчетов отправляет событие [**\_ завершения EC**](ec-complete.md) в Диспетчер графа фильтров. Если модуль подготовки отчетов имеет несколько входных ПИН-кодов, он доставляет \_ событие EC Complete после того, как каждый входной ПИН-код получил уведомление об окончании потока.

Фильтр должен сериализовать вызовы [**EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) с другими вызовами потоковой передачи, например [**Имеминпутпин:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive). (Иными словами, нисходящий фильтр должен всегда принимать вызовы в правильном порядке.)

В некоторых случаях нисходящий фильтр может обнаружить конец потока перед выполнением фильтра источника. (Например, нисходящий фильтр может анализировать поток.) В этом случае нисходящий фильтр может отправить уведомление о завершении потока. в этом случае он должен вернуть \_ значение false от [**имеминпутпин:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) до тех пор, пока граф не прекратит работу или не выполнит очистку. \_Возвращаемое значение false информирует фильтр источника о том, что прекращает отправку данных.

### <a name="default-handling-of-ec_complete"></a>Обработка по умолчанию EC \_ Complete

По умолчанию диспетчер графов фильтров не пересылает каждое \_ событие завершения EC в приложение. Вместо этого он ждет, пока все потоки не получит сигнал EC о \_ завершении, а затем отправит одно \_ событие завершения EC. Поэтому приложение получает событие после завершения каждого потока.

Чтобы определить количество потоков, диспетчер графа фильтров подсчитывает количество фильтров, поддерживающих поиск (с помощью [**имедиасикинг**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) или [**имедиапоситион**](/windows/desktop/api/Control/nn-control-imediaposition)), и имеет *отображаемый* ПИН-код ввода, который определен как входной ПИН-код без соответствующих выходных данных. Диспетчер графов фильтров определяет, отображается ли ПИН-код одним из двух способов:

-   Метод [**Ипин:: куеринтерналконнектионс**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryinternalconnections) в закреплениях возвращает ноль в параметре *НПИН* .
-   Фильтр предоставляет интерфейс [**иамфилтермискфлагс**](/windows/desktop/api/Strmif/nn-strmif-iamfiltermiscflags) и возвращает флаг модуля подготовки к \_ \_ \_ \_ \_ просмотру.

### <a name="end-of-stream-notifications-in-pull-mode"></a>Уведомления о завершении потока в режиме опроса

В соединении [**иасинкреадер**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) фильтр источника не отправляет уведомление о завершении потока. Инстреад это выполняется нисходящим фильтром, который обычно является фильтром синтаксического анализатора. Средство синтаксического анализа отправляет вызов [**EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) в нисходящем направлении. Он не отправляет один вышестоящий поток в фильтр источника.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Доставка конца потока](delivering-the-end-of-stream.md)
</dt> </dl>

 

 



