---
description: Кперсистстреам является базовым классом для постоянных свойств фильтров (то есть для фильтрации свойств в сохраненных графах).
ms.assetid: 8073e2be-aaf9-4b01-a7d5-bab5c1dcc19b
title: Класс Кперсистстреам
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CPersistStream
api_type:
- COM
api_location: ''
ms.openlocfilehash: 60a48b35ae1559e9b8dfa718c5bca38689cdf0101ce4a343a907b713c8988de0
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119073587"
---
# <a name="cpersiststream-class"></a>Класс Кперсистстреам

![Иерархия классов кперсистстреам](images/pstrm01.png)

`CPersistStream` является базовым классом для постоянных свойств фильтров (то есть для фильтрации свойств в сохраненных графах).

Самый простой способ использовать `CPersistStream` :

1.  Расположите фильтр для наследования этого класса.
2.  Реализуйте [**вритетостреам**](cpersiststream-writetostream.md) и [**реадфромстреам**](cpersiststream-readfromstream.md) в своем классе. Здесь переопределяются функции, которые ничего не делают, но выступают в качестве заполнителей.
3.  Измените **нонделегатингкуеринтерфаце** , чтобы он обрабатывал **IPersistStream**.
4.  Реализуйте [**сиземакс**](cpersiststream-sizemax.md) , чтобы получить верхнюю границу числа сохраненных данных.

    При сохранении данных в Юникоде™ следует помнить, что значение WCHAR равно 2 байтам.

5.  При изменении данных вызовите [**сетдирти**](cpersiststream-setdirty.md).

## <a name="version-numbers"></a>Номера версий

В какой-то момент вы можете изменить или расширить формат данных. После этого вы должны иметь номер версии во всех старых сохраненных потоках, чтобы вы могли указать, что при чтении они представляют старую или новую форму. Чтобы помочь вам, этот класс записывает и считывает номер версии. При записи он вызывает [**жетсофтвареверсион**](cpersiststream-getsoftwareversion.md) , чтобы выполнить запрос как к версии программного обеспечения, используемого в данный момент. (Фактически это номер версии структуры данных в файле.) Он записывает его в первую очередь на данные. Если вы хотите изменить версию, реализуйте (Переопределите) **жетсофтвареверсион**. Он считывает номер версии из файла в **mPS \_ двфилеверсион** перед вызовом [**Реадфромстреам**](cpersiststream-readfromstream.md), поэтому в **реадфромстреам** можно проверить **mPS \_ двфилеверсион** , чтобы узнать, считывается ли файл старой версии. Обычно следует принимать файлы, версия которых не новее версии программного обеспечения, считывающего их.

**Кперсистстреам** реализует [**IPersistStream**](/windows/desktop/api/objidl/nn-objidl-ipersiststream). Дополнительные сведения о реализации см. в справочнике по COM в пакете SDK для платформы Майкрософт.



| Защищенные члены данных                                          | Описание                                                                   |
|-----------------------------------------------------------------|-------------------------------------------------------------------------------|
| mPS \_ двфилеверсион                                              | Номер версии файла.                                                   |
| mPS \_ фдирти                                                     | Данные для этого потока должны быть сохранены.                                           |
| Функции элементов                                                | Описание                                                                   |
| [**кперсистстреам**](cpersiststream-cpersiststream.md)         | Конструирует объект **кперсистстреам** .                                       |
| [**сетдирти**](cpersiststream-setdirty.md)                     | Указывает, что объект должен быть сохранен в потоке.                        |
| Переопределяемые функции элементов                                    | Описание                                                                   |
| [**GetClassID**](cpersiststream-getclassid.md)                 | Получает идентификатор класса этого потока.                                |
| [**жетсофтвареверсион**](cpersiststream-getsoftwareversion.md) | Возвращает номер версии для этого формата файла.                            |
| [**реадфромстреам**](cpersiststream-readfromstream.md)         | Считывает данные фильтра из потока.                                      |
| [**сиземакс**](cpersiststream-sizemax.md)                       | Возвращает число байтов, необходимых для данных (не включая номер версии). |
| [**вритетостреам**](cpersiststream-writetostream.md)           | Записывает данные фильтра в поток.                                       |
| Методы IPersistStream                                          | Описание                                                                   |
| [**жетсиземакс**](cpersiststream-getsizemax.md)                 | Возвращает число байтов, необходимых для данных (включая номер версии).     |
| [**IsDirty**](cpersiststream-isdirty.md)                       | Проверяет, нужно ли сохранить объект.                                           |
| [**Загрузить**](cpersiststream-load.md)                             | Загружает данные из потока в память.                                   |
| [**Сохранить**](cpersiststream-save.md)                             | Сохраняет данные из памяти в поток.                                     |



 

 

 
