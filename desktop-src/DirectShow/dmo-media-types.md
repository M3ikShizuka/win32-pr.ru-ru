---
description: Типы мультимедиа DMO
ms.assetid: 40958e12-09c7-4ce5-aa4d-5ed8b1f40aa3
title: Типы мультимедиа DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1997abb1cc3c8eb10301778982ef7a46690855ed
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "104547426"
---
# <a name="dmo-media-types"></a>Типы мультимедиа DMO

Тип носителя описывает формат, связанный с потоком данных мультимедиа. В этой статье описывается, как дмос обрабатывает типы мультимедиа. В основном он предназначен для разработчиков, создающих собственные пользовательские дмос.

Типы носителей определяются с помощью [**структуры \_ \_ типа мультимедиа DMO**](/previous-versions/windows/desktop/api/mediaobj/ns-mediaobj-dmo_media_type) . Эта структура включает следующие сведения:

-   *Основной тип* — это глобальный уникальный идентификатор (GUID), определяющий обширную категорию, например аудио или видео.
-   *Подтип* — это идентификатор GUID, определяющий более конкретные аспекты типа. Например, в видео подтипы включают 16-битный RGB, 24-разрядный RGB, UYVY, видео в кодировке DV и т. д.
-   *Блок формата* — это вторичная структура, полностью определяющая формат. Макет блока форматирования зависит от типа данных. Например, в звуковом PCM используется структура **вавеформатекс** . Видео использует различные структуры, включая **видеоинфохеадер** и **VIDEOINFOHEADER2**. Макет блока формата определяется идентификатором GUID типа. Например, FORMAT \_ вавеформатекс указывает структуру **вавеформатекс** .

При первом создании DMO потоки не имеют типа мультимедиа. Прежде чем DMO сможет обработать какие-либо данные, клиент должен задать тип носителя для каждого потока. Этот процесс описан в разделе [Настройка типов мультимедиа в DMO](setting-media-types-on-a-dmo.md)с точки зрения клиента.

**Типы носителей в реестре**

DMO может добавить список типов мультимедиа, которые он поддерживает, в реестр, вызвав функцию [**дморегистер**](/previous-versions/windows/desktop/api/Dmoreg/nf-dmoreg-dmoregister) . Приложение может использовать эти сведения для поиска дмос, соответствующих определенному формату. Сведения в реестре не должны быть исчерпывающими. Обычно включаются только основные типы, поддерживаемые DMO. Запись реестра имеет отдельные ключи для входных и выходных типов, но не различает отдельные потоки.

Функция **дморегистер** использует [**\_ частичную структуру \_ носителя DMO**](/previous-versions/windows/desktop/api/Dmoreg/ns-dmoreg-dmo_partial_mediatype) для описания типов мультимедиа. Эта структура содержит подмножество сведений, находящихся в **структуре \_ \_ типов мультимедиа DMO** — а именно — основной тип и подтип. Он не включает блок формата, поскольку блок формата обычно содержит сведения, которые слишком детализированы для включения в реестр, такие как высота и ширина изображения видео.

**Предпочтительные типы носителей**

После создания приложения DMO оно может запросить объекты DMO для поддерживаемых им типов мультимедиа. Для каждого потока DMO создает список типов мультимедиа (возможно, пустых), упорядоченный в порядке предпочтения. Методы [**имедиаобжект:: жетинпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputtype) и [**Имедиаобжект:: жетаутпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputtype) перечисляют предпочтительные типы. Предпочтительные типы потока могут изменяться динамически, когда приложение задает типы носителей в других потоках. Например, список предпочтительных типов выходных данных может измениться после установки типа входных данных или наоборот. Однако DMO не требуется динамически обновлять предпочтительные типы. Приложение не может предположить, что каждый тип, который он получает, является допустимым. По этой причине методы [**имедиаобжект:: сетинпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setinputtype) и [**Имедиаобжект:: сетаутпуттипе**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-setoutputtype) поддерживают флаг для проверки определенного типа.

Методы **жетинпуттипе** и **жетаутпуттипе** возвращают структуру **\_ \_ типа мультимедиа DMO** . DMO может оставить часть информации в этой структуре пустой, чтобы указать диапазон типов. Основной тип или подтип может иметь \_ значение GUID null, а блок формата может быть пустым (0 байт). Если блок формата пуст, тип формата должен быть \_ РАВЕН GUID null.

После того как приложение установит все типы входных данных DMO, объекты DMO должны возвращать по крайней мере один полный тип для каждого потока вывода. Полный тип вывода упрощает тестирование, и приложения могут использовать его в качестве разумного значения по умолчанию. Это поведение зависит от тестового приложения DMO. (См. раздел [Использование приложения дмотест](using-the-dmotest-application.md).)

**Настройка типов мультимедиа**

Приложения используют методы **сетинпуттипе** и **сетаутпуттипе** для проверки, установки и очистки типов в указанном потоке. Приложение должно полностью указать тип. DMO проверяет, может ли он принять предложенный тип. Ответ может зависеть от того, какие типы были установлены для других потоков. \_ \_ Флаг Clear Set ТИПЕФ-DMO \_ очищает тип потока, поэтому приложение может выполнить команду "обратное" и попробовать другое сочетание.

**Примеры сценариев**

В следующих примерах описываются некоторые типичные сценарии, иллюстрирующие точки, сделанные в предыдущих разделах.

-   **Видеодекодеры.** В обычном видеодекодере тип ввода частично определяет тип выходных данных. Например, обычно оба потока должны иметь одинаковую частоту кадров и размеры изображения. Один из вариантов — не определять предпочтительные типы выходных данных до тех пор, пока не будет задан тип входных данных. Другой вариант — перечислить набор незавершенных типов, пропуская блок формата. Используйте подтип для указания поддерживаемых несжатых типов, таких как 16-разрядный RGB, 24-разрядный RGB и т. д. Кроме того, видеодекодеры обычно не поддерживают задание типа выходных данных перед входным типом. Обычным сценарием является декодирование из известного формата входных данных, чтобы это ограничение было разумным.
-   **Звуковые декодеры.** Звуковой декодер может поддерживать ограниченный фиксированный набор выходных форматов. В этом случае перед известным форматом входных данных может быть создан список предпочтительных форматов вывода.
-   **Программы сжатия.** В большинстве случаев программа сжатия видео не может полностью указывать Предпочтительные форматы вывода, пока приложение не настроит входной формат и наоборот. Вместо этого DMO должен возвращать неполный тип без блока Format. Для сжатия звука и видео обычно приложению необходимо задать различные выходные параметры, например скорость потока. Однако после установки типа входных данных программа сжатия должна вернуть по крайней мере один полный выходной тип по причинам, упомянутым выше.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Написание DMO](writing-a-dmo.md)
</dt> </dl>

 

 



