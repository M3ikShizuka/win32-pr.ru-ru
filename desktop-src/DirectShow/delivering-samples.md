---
description: Доставка образцов
ms.assetid: 31aabb6d-dec6-41fa-b24d-35a77b67bc4a
title: Доставка образцов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 083bc8c88649c04bdf9f93f86ebcc277ee48e75e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104423165"
---
# <a name="delivering-samples"></a>Доставка образцов

В этой статье описывается, как фильтр доставляет пример. В нем описывается как модель push-уведомлений с помощью методов [**имеминпутпин**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) , так и модель извлечения с помощью [**иасинкреадер**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).

**Модель push-уведомлений: Доставка образца**

Закрепление вывода предоставляет пример вызова метода [**имеминпутпин:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) или метода [**Имеминпутпин:: рецеивемултипле**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) , который эквивалентен, но доставляет массив примеров. Входной ПИН-код может блокироваться внутри **Receive** (или **рецеивемултипле**). Если ПИН-код может быть заблокирован, его метод [**имеминпутпин:: рецеивеканблокк**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) должен вернуть значение S \_ ОК. Если ПИН-код никогда не блокируется, **рецеивеканблокк** должен возвращать \_ значение S false. \_Возвращаемое значение S ОК не означает, что **Receive** всегда блокируется, просто это может быть.

Несмотря на то, что **Receive** может блокировать доступность ресурса, он не должен блокировать ожидание дополнительных данных из вышестоящего фильтра. Это может привести к взаимоблокировке, когда вышестоящий фильтр ожидает, пока нисходящий фильтр выдаст пример, который не происходит, так как подчиненный фильтр ожидает вышестоящего фильтра. Однако если у фильтра есть несколько входных ПИН-кодов, один из них может ожидать получения данных другим ПИН-кодом. Например, фильтр [мультиплексора](avi-mux-filter.md) в формате AVI делает это для чередования аудио и видео данных.

ПИН-код может отклонить выбор по ряду причин:

-   ПИН-код очищается (см. раздел [Очистка](flushing.md)).
-   ПИН-код не подключен.
-   Фильтр остановлен.
-   Произошла другая ошибка.

В первом случае метод **Receive** должен возвращать \_ значение false, а в других случаях — код сбоя. Вышестоящий фильтр должен закончить отправку образцов, если код возврата имеет значение, отличное от S \_ ОК.

Первые три варианта можно рассматривать как «ожидаемые» сбои, в том смысле, что фильтр находился в неправильном состоянии для получения образцов. Непредвиденный сбой может привести к тому, что ПИН-код отклонит выборку, даже если ПИН-код находится в состоянии получения. При возникновении ошибки такого типа ПИН-код должен отсылать уведомление о завершении потока и отправить событие [**EC \_ Еррораборт**](ec-errorabort.md) в Диспетчер графа фильтров.

В базовых классах DirectShow метод [**кбасеинпутпин:: чеккстреаминг**](cbaseinputpin-checkstreaming.md) проверяет общие случаи сбоев — запись на диск, остановка и т. д. Производный класс должен проверять наличие сбоев, характерных для фильтра. В случае ошибки метод [**кбасеинпутпин:: Receive**](cbaseinputpin-receive.md) отправляет уведомление об окончании потока и \_ событие EC еррораборт.

**Модель извлечения: запрос примера**

В интерфейсе **иасинкреадер** входной ПИН-код запрашивает примеры из выходного ПИН-кода, вызывая один из следующих методов:

-   [**Иасинкреадер:: Request**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-request)
-   [**Иасинкреадер:: Синкреад**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncread)
-   [**Иасинкреадер:: Синкреадалигнед**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncreadaligned)

Метод **запроса** является асинхронным; входной ПИН-код вызывает [**иасинкреадер:: ваитфорнекст**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) , чтобы дождаться завершения запроса. Два других метода являются синхронными.

**Время доставки данных**

Фильтр всегда доставляет образцы, пока находится в состоянии выполняется. В большинстве случаев фильтр также доставляет образцы при приостановке. Это позволяет диаграмме занимать данные, чтобы воспроизведение начиналось сразу же после вызова метода **Run** (см. сведения о [состояниях фильтра](filter-states.md)). Если фильтр не доставляет данные при приостановке, метод **имедиафилтер::** noreturn фильтра должен возвращать VFW s не \_ \_ удается \_ подсказку в приостановленном состоянии. Этот код возврата сигнализирует графу фильтра не ждать данных из фильтра до завершения перехода на паузу. В противном случае метод **Pause** будет заблокирован бесконечно. Пример кода см. в разделе [**кбасефилтер:: «State**](cbasefilter-getstate.md)».

Ниже приведены некоторые примеры того, когда фильтру может потребоваться вернуть в \_ очередь VFW S, не \_ могу \_ подсказку:

-   Динамические источники, такие как фильтры записи, не должны отсылать данные при приостановке. См. раздел [Создание данных в фильтре записи](producing-data-in-a-capture-filter.md).
-   Фильтр разделителя может отсылать или не передавать данные во время приостановки, в зависимости от реализации. Если фильтр использует отдельные потоки для ввода данных в очередь каждого выходного контакта, он может отправить данные при приостановке. Но если фильтр использует один поток для каждого выходного контакта, первый ПИН-код может блокировать поток при вызове **Receive**, что предотвратит передачу данных другими контактами. В этом случае следует возвращать VFW \_ S не \_ удается \_ подсказку.
-   Фильтр может доставлять данные нерегулярно. Например, он может анализировать пользовательский поток данных и отфильтровывать некоторые пакеты при доставке других. В этом случае фильтр может не гарантировать доставку данных при приостановке.

Фильтр источника (с использованием модели push-уведомлений) или фильтр средства синтаксического анализа (с использованием модели принудительной отправки и извлечения) создает один или несколько потоков потоковой передачи, которые предоставляют образцы как можно быстрее. Нисходящие фильтры, такие как декодеры и преобразования, обычно отправляют данные только при вызове метода **Receive** на входных ПИН-кодах.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Получение и доставка примеров](receiving-and-delivering-samples.md)
</dt> </dl>

 

 



