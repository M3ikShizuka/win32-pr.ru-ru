---
description: Объединение видеозаписей и предварительной версии
ms.assetid: bffc1900-be05-4d7e-ab8d-3177365aeb7a
title: Объединение видеозаписей и предварительной версии
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c1894e9431cbfa9e7bbbd0ef0bcec48021055350030b54ffd2f3e2729db81c4
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120084333"
---
# <a name="combining-video-capture-and-preview"></a>Объединение видеозаписей и предварительной версии

В предыдущих разделах описывается запись видео в различные форматы файлов. В разделе [Предварительный просмотр видео](previewing-video.md) описано, как создать график динамической предварительной версии. Однако многие приложения должны одновременно выполнять обе операции. Чтобы создать объединенную предварительную версию и граф для создания файлов, просто сделайте два вызова [**ICaptureGraphBuilder2:: RenderStream**](/windows/desktop/api/Strmif/nf-strmif-icapturegraphbuilder2-renderstream):


```C++
// Render the preview stream to the video renderer.
hr = pBuild->RenderStream(&PIN_CATEGORY_PREVIEW, &MEDIATYPE_Video, pCap, 
    NULL, NULL);

// Render the capture stream to the mux.
hr = pBuild->RenderStream(&PIN_CATEGORY_CAPTURE, &MEDIATYPE_Video, pCap, 
    NULL, pMux);
```



в этом коде построитель Graphа записи скрывает некоторые сведения:

-   Если фильтр записи имеет ПИН-код предварительной версии или PIN-код, а также ПИН-код записи, метод [**RenderStream**](/windows/desktop/api/Strmif/nf-strmif-icapturegraphbuilder2-renderstream) просто визуализирует оба контакта, как показано на следующем рисунке.

    ![Диаграмма записи и предварительного просмотра](images/vidcap04.png)

-   если фильтр имеет только пин-код записи, то построитель Graph записи использует фильтр [Smart Tee](smart-tee-filter.md) для разделения потока записи. На следующем рисунке показан граф с Smart Tee.

    ![запись и предварительный просмотр графа с помощью интеллектуального фильтра Tee](images/vidcap05.png)

Фильтр Smart tee имеет ПИН-код захвата и предварительный ПИН-код. Он принимает один поток видео из фильтра записи и разделяет его на два потока: один для захвата и один для предварительного просмотра. Чтобы обеспечить пропускную способность для ПИН-кода записи, при необходимости предварительный ПИН-код удаляет кадры. кроме того, он позволяет отформатировать отметки времени от каждого примера перед его доставкой, по причинам, описанным в разделе [DirectShow фильтров записи видео](directshow-video-capture-filters.md).

Хотя Smart tee разделяет поток, он физически не дублирует данные видео. Вместо этого он использует пользовательские образцы объектов мультимедиа, которые совместно используют буферы. Образцы помечаются как "только для чтения", чтобы не записывать данные в подчиненных фильтрах.

если на диаграмме записи есть окно предварительного просмотра, некоторые из них могут привести к тому, что фильтр Graph Manager останавливает весь граф, включая поток записи:

-   Блокировка компьютера.
-   Нажав клавиши CTRL + ALT + DELETE на компьютере, который является членом домена.
-   Запуск полноэкранного приложения Direct3D, такого как игра или экранная заставка.
-   Переключение мониторов или изменение разрешения экрана.
-   запуск программы, в результате которой Windows отображает диалоговое окно контроля учетных записей (UAC). (Windows Vista или более поздней версии).
-   Запуск полноэкранного окна DOS.

Любое из этих событий может привести к прерыванию сеанса записи, возможно, в результате потери данных. (Вот что происходит внутри: модуль подготовки видео теряет необходимые ресурсы Direct3D или DirectDraw. в процессе восстановления этих ресурсов модуль подготовки отчетов должен повторно подключиться к вышестоящему фильтру, что приведет к тому, что диспетчер Graph фильтра останавливает граф.)

Ниже приведены два возможных решения этой проблемы.

-   Не включайте поток предварительной версии. Однако имейте в виду, что метод [**ICaptureGraphBuilder2:: RenderStream**](/windows/desktop/api/Strmif/nf-strmif-icapturegraphbuilder2-renderstream) автоматически добавляет окно предварительного просмотра, когда устройство записи имеет ПИН-код видеопорта. См. раздел [Контакты видеопортов в записи файлов](video-port-pins-in-file-capture.md).
-   Используйте механизм буфера потока для отправки потока просмотра в граф в другом процессе.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Запись видео в файл](capturing-video-to-a-file.md)
</dt> </dl>

 

 



