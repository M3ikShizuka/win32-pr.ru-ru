---
description: В этом разделе описывается, как пользовательский фильтр захвата DirectShow должен формировать выходные данные.
ms.assetid: e407e9ed-f1f7-43c4-a048-c27476c910ea
title: Создание данных в фильтре записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8d9c9e5bed6fc7e01aa89bf6f495c1bbdf6e42a0
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103990156"
---
# <a name="producing-data-in-a-capture-filter"></a>Создание данных в фильтре записи

В этом разделе описывается, как пользовательский фильтр захвата DirectShow должен формировать выходные данные.

## <a name="filter-state-changes"></a>Фильтрация изменений состояния

Фильтр записи должен создавать данные только при выполнении фильтра. Не отправляйте данные с ваших ПИН-кодов при приостановке фильтра. Кроме того, при приостановке фильтра следует возвращать **VFW \_ S не \_ удается \_ подсказку** из метода [**кбасефилтер::**](cbasefilter-getstate.md) noreturn. Это возвращаемое значение информирует диспетчер графа фильтра о том, что не следует ждать каких-либо данных из фильтра, пока фильтр приостановлен. Дополнительные сведения см. в разделе [Фильтрация состояний](filter-states.md).

В следующем коде показано, как реализовать метод [**имедиафилтер::**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-getstate) WebMethod:


```C++
CMyVidcapFilter::GetState(DWORD dw, FILTER_STATE *pState)
{
    CheckPointer(pState, E_POINTER);
    *pState = m_State;
    if (m_State == State_Paused)
    {
        return VFW_S_CANT_CUE;
    }
    else
    {
        return S_OK;
    }
}
```



## <a name="controlling-individual-streams"></a>Управление отдельными потоками

Выходные сигналы фильтра записи должны поддерживать интерфейс [**иамстреамконтрол**](/windows/desktop/api/Strmif/nn-strmif-iamstreamcontrol) , чтобы приложение может включать или отключать каждый ПИН-код отдельно. Например, приложение может выполнить предварительный просмотр без записи, а затем переключиться в режим записи без перестроения графа фильтра. Для реализации этого интерфейса можно использовать класс [**кбасестреамконтрол**](cbasestreamcontrol.md) .

## <a name="time-stamps"></a>Метки времени

Когда фильтр захватывает пример, отметка времени для образца с текущим временем потока. Время окончания — это время начала и длительность. Например, если фильтр записывается в десять выборок в секунду, а время потока составляет 200 000 000 единиц, когда фильтр захватывает образец, отметки времени должны быть 200000000 и 201000000. (10 000 000 единиц в секунду.)

Чтобы вычислить время потока, вызовите метод [**иреференцеклокк:: Time**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-gettime) , чтобы получить текущее время ссылки, а затем вычитание исходное время начала. Кроме того, можно вызвать метод [**кбасефилтер:: стреамтиме**](cbasefilter-streamtime.md) , который выполняет то же вычисление. Чтобы задать метку времени для образца, вызовите метод [**имедиасампле:: setTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) .

Однако если фильтр имеет предварительный ПИН-код, образцы из ПИН-кода предварительной версии не должны иметь отметки времени. Причина в том, что образцы всегда будут обращаться к модулю прорисовки немного позже, чем время записи. Если образцы имеют отметку времени, то модуль подготовки отчетов будет обрабатывать их как последние и может попытаться отследить, удалив образцы. (Дополнительные сведения см. в статье [Фильтры захвата видео DirectShow](directshow-video-capture-filters.md).) Обратите внимание, что интерфейс [**иамстреамконтрол**](/windows/desktop/api/Strmif/nn-strmif-iamstreamcontrol) требует, чтобы ПИН-код следит за временем выборки. Для предварительного просмотра ПИН-кода может потребоваться изменить реализацию, чтобы не полагаться на отметки времени.

Метки времени должны всегда увеличиваться от одного до следующего. Это справедливо даже в случае приостановки фильтра. Если фильтр выполняется, приостанавливает работу, а затем снова запускается, первый пример после приостановки должен иметь более крупную метку времени, чем последняя выборка до приостановки.

В зависимости от собираемых данных может быть целесообразно установить время мультимедиа для образцов.

Дополнительные сведения см. [в разделе время и часы в DirectShow](time-and-clocks-in-directshow.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Фильтры захвата видео DirectShow](directshow-video-capture-filters.md)
</dt> <dt>

[Время и часы в DirectShow](time-and-clocks-in-directshow.md)
</dt> <dt>

[Запись фильтров записи](writing-capture-filters.md)
</dt> </dl>

 

 



