---
description: В этом разделе описывается написание пользовательского модуля подготовки видео для DirectShow.
ms.assetid: abba5113-125f-4dac-b566-99c0d9b5978c
title: Альтернативные модули подготовки видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 070e55375d9d1d5a32c306853aafcb431a76c368
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "103806610"
---
# <a name="alternative-video-renderers"></a>Альтернативные модули подготовки видео

В этом разделе описывается написание пользовательского модуля подготовки видео для DirectShow.

> [!Note]  
> Вместо написания пользовательского модуля подготовки отчетов к просмотру рекомендуется написать подключаемый модуль распределительного устройства для микширования видео (VMR) или [**расширенного обработчика видео**](enhanced-video-renderer-filter.md) (Евр). Этот подход дает вам все преимущества VMR/евр, в том числе поддержку ускорения видео DirectX (ДКСВА), аппаратное чередование и пошаговое выполнение кадров, и, скорее всего, будет более устойчивым, чем пользовательский модуль визуализации видео. Дополнительные сведения см. в следующих разделах:
>
> -   [Режим воспроизведения VMR (пользовательский распределитель — выступающие)](vmr-renderless-playback-mode--custom-allocator-presenters.md)
> -   [Написание выступающего Евр](/windows/desktop/medfound/how-to-write-an-evr-presenter)

 

## <a name="writing-an-alternative-renderer"></a>Создание альтернативного модуля подготовки отчетов

Microsoft DirectShow предоставляет модуль подготовки видео на основе окон; Он также предоставляет полноэкранный рендеринг во время выполнения установки. Базовые классы DirectShow можно использовать для записи альтернативных модулей подготовки видео. Чтобы альтернативные модули подготовки отчетов правильно взаимодействовали с приложениями на основе DirectShow, модули подготовки отчетов должны соблюдать рекомендации, описанные в этой статье. Вы можете использовать классы [**кбасерендерер**](cbaserenderer.md) и [**кбасевидеорендерер**](cbasevideorenderer.md) , чтобы следовать этим рекомендациям при реализации альтернативной прорисовки видео. Из-за текущей разработки DirectShow регулярно просматривайте свою реализацию, чтобы убедиться, что модули подготовки отчетов совместимы с самой последней версией DirectShow.

В этом разделе обсуждаются многие уведомления о том, что модуль подготовки отчетов отвечает за обработку. Краткий обзор уведомлений DirectShow может помочь задать этап. В DirectShow есть три вида уведомлений:

-   *Потоковые уведомления*— это события, происходящие в потоке мультимедиа и передаваемые из одного фильтра в следующий. Это могут быть уведомления о начале, сбросе или окончании потока, а также отправляются путем вызова соответствующего метода для входного ПИН-кода подчиненного фильтра (например, [**Ипин:: бегинфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush)).
-   *Отфильтруйте уведомления графа*, которые являются событиями, отправленными из фильтра в Диспетчер графа фильтров, например [**EC \_ Complete**](ec-complete.md). Это достигается путем вызова метода [**имедиаевентсинк:: notify**](/windows/desktop/api/Strmif/nf-strmif-imediaeventsink-notify) в диспетчере графа фильтров.
-   *Уведомления приложения*, которые извлекаются из диспетчера графа фильтра управляющим приложением. Приложение вызывает метод [**имедиаевент:: четный**](/windows/desktop/api/Control/nf-control-imediaevent-getevent) в диспетчере графа фильтров для получения этих событий. Часто диспетчер графа фильтров проходит через события, которые он получает в приложение.

В этом разделе обсуждается ответственность фильтра модуля подготовки отчетов об обработке получаемых им уведомлений о потоках и отправке соответствующих уведомлений графа фильтра.

## <a name="handling-end-of-stream-and-flushing-notifications"></a>Обработка уведомлений о завершении потока и записи на диск

Уведомление о завершении потока начинается с вышестоящего фильтра (такого как фильтр источника), когда этот фильтр обнаруживает, что он может отсылать больше данных. Он передается через каждый фильтр в графе и в конечном итоге завершается модулем подготовки отчетов, который отвечает за последующее отправление уведомления о [**\_ завершении EC**](ec-complete.md) в Диспетчер графа фильтров. Модули подготовки отчетов имеют специальные обязанности, когда речь идет об обработке этих уведомлений.

Модуль подготовки отчетов получает уведомление о завершении потока, когда метод [**Ипин:: EndOfStream**](/windows/desktop/api/Strmif/nf-strmif-ipin-endofstream) из входного контакта вызывается вышестоящим фильтром. Модуль подготовки отчетов должен отметить это уведомление и продолжить подготовку к просмотру уже полученных данных. После получения всех оставшихся данных модуль подготовки отчетов должен отправить уведомление о [**\_ завершении EC**](ec-complete.md) в Диспетчер графа фильтров. Уведомление **о \_ завершении EC** должно отправляться модулем подготовки отчетов только один раз при достижении конца потока. Кроме того, уведомления о **\_ завершении EC** не должны отправляться, за исключением случаев, когда выполняется граф фильтра. Таким образом, если граф фильтра приостанавливается, когда фильтр источника отправляет уведомление об окончании потока, то не следует отправлять данные **EC \_ Complete** , пока граф фильтра не запустится.

Любые вызовы методов [**имеминпутпин:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) или [**Имеминпутпин:: рецеивемултипле**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) после уведомления о завершении потока должны быть отклонены. **Д \_ НЕПРЕДВИДЕНное** сообщение об ошибке, которое необходимо вернуть в этом случае.

При остановке графа фильтра любое кэшированное уведомление конца потока должно быть сброшено и не передаваться при следующем запуске. Это связано с тем, что диспетчер графов фильтров всегда приостанавливает все фильтры непосредственно перед их запуском, чтобы обеспечить правильное выполнение очистки. Например, если граф фильтра приостановлен и получено уведомление о завершении потока, а затем граф фильтра остановлен, модуль подготовки отчетов не должен отправить уведомление о [**\_ завершении EC**](ec-complete.md) при последующем запуске. Если поиск не выполнялся, фильтр источника будет автоматически отправит еще одно уведомление о прекращении потока во время паузы, предшествующее состоянию выполнения. Если, с другой стороны, при остановке графа фильтра возникла операция поиска, то фильтр источника может содержать данные для отправки, поэтому он не отправляет уведомление об окончании потока.

Модули подготовки видео часто зависят от уведомлений на конец потока, что превышает отправку уведомлений [**о \_ завершении EC**](ec-complete.md) . Например, если поток завершил воспроизведение (то есть отправляется уведомление об окончании потока), а другое окно перемещается через окно средства просмотра видео, будет создано несколько сообщений окна программы [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) . Типичная практика запуска модуля подготовки видео — не перерисовывать текущий кадр при получении сообщений **WM \_ Paint** (в зависимости от предположения, что будет получен другой кадр). Однако при отправке уведомления конца потока модуль подготовки отчетов находится в состоянии ожидания; Он по-прежнему работает, но имеет в виду, что он не будет получать дополнительные данные. В этих случаях модуль подготовки отчетов создает черный область воспроизведения.

Обработка очистки — это дополнительная сложность для модулей подготовки отчетов. Очистка выполняется с помощью пары методов [**Ипин**](/windows/desktop/api/Strmif/nn-strmif-ipin) , именуемых [**бегинфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) и [**ендфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush). Очистка по сути является дополнительным состоянием, которое должен обрабатываться модулем подготовки отчетов. Недопустимый фильтр источника для вызова **бегинфлуш** без вызова **ендфлуш**, поэтому мы будем надеяться, что штат является коротким и дискретным. Однако модуль подготовки отчетов должен правильно обрабатывать данные или уведомления, получаемые при переходе на диск.

Все данные, полученные после вызова [**бегинфлуш**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) , следует отклонять немедленно, возвращая **\_ значение S false**. Кроме того, любое кэшированное уведомление конца потока также должно быть очищено при сбросе модуля подготовки отчетов. Модуль подготовки отчетов, как правило, очищается в ответ на поиск. Очистка гарантирует, что старые данные будут удалены из графа фильтра перед отправкой новых образцов. (Как правило, воспроизведение двух разделов потока, один за другим, лучше всего обрабатывается через отложенные команды вместо того, чтобы ждать завершения одного раздела и затем выполнить команду Seek.)

## <a name="handling-state-changes-and-pause-completion"></a>Обработка изменений состояния и Приостановка выполнения

Фильтр модуля подготовки отчетов работает так же, как и любой другой фильтр в графе фильтра при изменении его состояния, за исключением следующего. После приостановки модуль подготовки отчетов будет содержать некоторые данные, готовые к просмотру при последующем запуске. Когда модуль подготовки видео остановлен, он удерживает данные в очереди. Это исключение в правиле DirectShow, которое не должно храниться в фильтрах во время остановки графа фильтра.

Причина этого исключения заключается в том, что при удержании ресурсов модуль подготовки отчетов всегда будет иметь изображение, с помощью которого можно перерисовать окно, если оно получит сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) . Он также имеет изображение для удовлетворения методов, таких как [**кбасеконтролвидео:: жетстатиЦимаже**](cbasecontrolvideo-getstaticimage.md), которые запрашивают копию текущего изображения. Еще одним следствием удержания ресурсов является то, что при переходе на изображение распределитель останавливается, что, в свою очередь, делает следующее изменение состояния гораздо быстрее, так как буферы изображений уже выделены.

Модуль подготовки отчетов должен визуализировать и выпустить образцы только во время выполнения. При приостановке фильтр может визуализировать их (например, при рисовании статического изображения афиши в окне), но не должен освобождать их. Модули подготовки звука не будут выполнять отрисовку при приостановке (хотя они могут выполнять другие действия, например, подготавливать звуковое устройство). Время, когда следует подготавливать выборки, получается путем объединения времени потока в примере со временем ссылки, переданным в качестве параметра в метод [**имедиаконтрол:: Run**](/windows/desktop/api/Control/nf-control-imediacontrol-run) . Модули подготовки отчетов должны отклонять выборки с временем начала меньше или равным времени окончания.

Когда приложение приостанавливает граф фильтра, граф фильтра не возвращает метод [**имедиаконтрол::P Аусе**](/windows/desktop/api/Control/nf-control-imediacontrol-pause) , пока данные не помещаются в очередь модулей подготовки отчетов. Чтобы обеспечить это, когда модуль подготовки отчетов приостанавливается, он должен вернуть \_ значение false, если данные, ожидающие подготовки к просмотру, отсутствуют. Если в очереди есть данные, они могут вернуть **S \_ ОК**.

Диспетчер графов фильтров проверяет все возвращаемые значения при приостановке графа фильтра, чтобы убедиться, что модули подготовки отчетов имеют данные в очереди. Если один или несколько фильтров не готовы, диспетчер графа фильтров опрашивает фильтры в графе, вызывая [**имедиафилтер:: State**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-getstate). Метод **WebMethod** принимает параметр времени ожидания. Фильтр (обычно модуль подготовки отчетов), который по-прежнему ожидает поступления данных перед завершением изменения состояния, возвращает **VFW \_ S \_ State \_** , если метод **метода WebMethod** истекает. Когда данные поступают в модуль подготовки отчетов, параметру " **State** " следует немедленно возвращаться с помощью **S \_ ОК**.

В состоянии "промежуточное" и "завершено" состояние отфильтрованного фильтра будет \_ приостановлено. Только возвращаемое значение указывает, действительно ли фильтр готов. Если, в то время как модуль подготовки отчетов ожидает поступления данных, его фильтр источника отправляет уведомление о завершении потока, а затем также завершает изменение состояния.

После того как все фильтры на самом деле имеют данные, ожидающие подготовки к просмотру, граф фильтра завершит изменение состояния приостановки.

## <a name="handling-termination"></a>Завершение обработки

Модули подготовки видео должны правильно обрабатывать события завершения от пользователя. Это означает правильное скрытие окна и знание того, что нужно делать, если окно впоследствии будет отображено. Кроме того, модули подготовки видео должны уведомлять диспетчер графов фильтров, когда его окно уничтожается (или точнее, когда модуль подготовки отчетов удаляется из графа фильтра) для освобождения ресурсов.

Если пользователь закрывает окно видео (например, нажав клавиши ALT + F4), то в соответствии с соглашением вы немедленно скрываете окно и отправляете уведомление [**EC \_ Усераборт**](ec-userabort.md) в Диспетчер графа фильтров. Это уведомление передается в приложение, что приведет к прерыванию воспроизведения графа. После отправки **EC \_ усераборт** модуль подготовки отчетов должен отклонять любые дополнительные образцы, доставляемые на него.

Отметка "граф остановлена" должна быть оставлена модулем подготовки отчетов до тех пор, пока он не будет остановлен, после чего он должен быть сброшен, чтобы приложение может переопределить действие пользователя и продолжить воспроизведение графа по своему последствии. Если во время работы видео нажата клавиша ALT + F4, окно будет скрыто, и все последующие выборки будут отклонены. Если окно отображается последующим образом (например, через [**ивидеовиндов::p UT \_ Visible**](/windows/desktop/api/Control/nf-control-ivideowindow-put_visible)), то уведомления о [**\_ перерисовке EC**](ec-repaint.md) создаваться не должны.

Модуль подготовки отчетов также должен отправить на граф фильтра уведомление о [**\_ \_ поврежденном окне EC**](ec-window-destroyed.md) при завершении работы модуля обработки видео. На самом деле лучше обрабатывать это, когда метод [**ибасефилтер:: жоинфилтерграф**](/windows/desktop/api/Strmif/nf-strmif-ibasefilter-joinfiltergraph) визуализатора вызывается с параметром null (что означает, что модуль подготовки отчетов будет удален из графа фильтра), а не ждать, пока не будет уничтожено реальное окно видео. Отправка этого уведомления позволяет подключаемому модулю распространителя в диспетчере графов фильтров передавать ресурсы, зависящие от фокуса, на другие фильтры, такие как звуковые устройства.

## <a name="handling-dynamic-format-changes"></a>Обработка изменений динамического формата

В некоторых случаях вышестоящий фильтр модуля подготовки отчетов может попытаться изменить формат видео во время воспроизведения видео. Чаще всего это декомпрессор видео, запускающее динамическое изменение формата.

Вышестоящий фильтр, который пытается динамически изменить форматы, всегда должен вызывать метод [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) для входного ПИН-кода модуля подготовки отчетов. Модуль подготовки видео имеет некоторые отклонения, как и какие виды изменений динамического формата он должен поддерживать. Как минимум, он должен позволить вышестоящему фильтру изменить палитры. Когда вышестоящий фильтр изменяет типы носителей, он прикрепляет тип носителя к первому образцу, доставке в новом формате. Если модуль подготовки отчетов хранит образцы в очереди для подготовки к просмотру, он не должен изменять формат до тех пор, пока не будет отображен образец с изменением типа.

Модуль обработки видео также может запрашивать изменение формата от декодера. Например, он может попросить декодера предоставить совместимый с DirectDraw формат с отрицательным **бихеигхт**. Когда модуль подготовки отчетов приостанавливается, он должен вызвать [**куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) для вышестоящего ПИН-кода, чтобы узнать, какие форматы может предоставить декодер. Однако декодер может не перечислять все типы, которые он может принять, поэтому модуль подготовки отчетов должен предлагать некоторые типы, даже если декодер не объявляет их.

Если декодер может переключиться в запрошенный формат, он возвращает значение **S \_ ОК** из [**куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept). Затем модуль подготовки отчетов присоединяет новый тип мультимедиа к следующему примеру носителя в вышестоящем распределителе. Чтобы это работало, модуль подготовки отчетов должен предоставить пользовательский распределитель, реализующий частный метод для присоединения типа мультимедиа к следующему примеру. (В этом частном методе вызовите [**имедиасампле:: сетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) , чтобы задать тип.)

Входной ПИН-код модуля подготовки отчетов должен возвращать пользовательский распределитель модуля подготовки отчетов в методе [**имеминпутпин::-распределителя**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator) . Переопределите [**имеминпутпин:: нотифяллокатор**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) , чтобы он завершился ошибкой, если вышестоящий фильтр не использует распределитель модуля подготовки отчетов.

При использовании некоторых декодеров установка **бихеигхт** в положительное число в типах YUV приводит к тому, что декодер выводит изображение на 180 градусов. (Это неверно, и его следует рассматривать как ошибку в декодере.)

При обнаружении изменения формата модулем подготовки видео он должен отправить уведомление об [**\_ \_ изменении дисплея EC**](ec-display-changed.md) . Большинство модулей обработки видео выбирают формат во время подключения, чтобы его можно было эффективно прорисовывать через GDI. Если пользователь изменяет текущий режим отображения без перезагрузки компьютера, модуль подготовки отчетов может обнаружить неверное соединение с форматом изображения и отправить это уведомление. Первым параметром должен быть ПИН-код, требующий повторного подключения. Диспетчер графов фильтров будет упорядочивать график для остановки и повторного подключения ПИН-кода. Во время последующего повторного подключения модуль подготовки отчетов может принять более подходящий формат.

Всякий раз, когда модуль обработки видео обнаруживает изменение палитры в потоке, он должен отправить уведомление об [**\_ \_ изменении палитры EC**](ec-palette-changed.md) в Диспетчер графа фильтров. Модули подготовки видео DirectShow обнаруживают, что палитра действительно изменилась в динамическом формате. Модули подготовки видео делают это не только для фильтрации количества **\_ \_ измененных уведомлений в палитре EC** , но и для уменьшения объема, необходимого для создания, установки и удаления палитры.

Наконец, модуль подготовки отчетов может также обнаружить, что размер видео изменился. в этом случае он должен отправить уведомление об [**\_ \_ \_ изменении размера видео EC**](ec-video-size-changed.md) . Приложение может использовать это уведомление для согласования пространства в составном документе. Фактические измерения видео доступны через интерфейс элемента управления [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo) . Модули подготовки DirectShow определяют, изменился ли размер видео на самом деле, или не перед отправкой этих событий.

## <a name="handling-persistent-properties"></a>Обработка постоянных свойств

Все свойства, заданные через интерфейсы [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo) и [**ивидеовиндов**](/windows/desktop/api/Control/nn-control-ivideowindow) , должны быть постоянными в соединениях. Таким образом, отсоединение и повторное подключение модуля подготовки отчетов к просмотру не должно полагаться на размер окна, его расположение или стили. Однако при изменении размеров видео между соединениями модуль подготовки отчетов должен сбрасывать исходные и конечные прямоугольники в значения по умолчанию. Исходное и конечное положения задаются через интерфейс **ибасиквидео** .

Как [**ибасиквидео**](/windows/desktop/api/Control/nn-control-ibasicvideo) , так и [**ивидеовиндов**](/windows/desktop/api/Control/nn-control-ivideowindow) предоставляют достаточный доступ к свойствам, позволяя приложению сохранять и восстанавливать все данные в интерфейсе в постоянном формате. Это будет полезно для приложений, которые должны сохранять точную конфигурацию и свойства графов фильтра во время сеанса редактирования и восстанавливать их позже.

## <a name="handling-ec_repaint-notifications"></a>Обработка \_ уведомлений о ПЕРЕрисовке EC

Уведомление [**о \_ перерисовке EC**](ec-repaint.md) отправляется, только если модуль подготовки отчетов приостановлен или остановлен. Это уведомление сигнализирует диспетчеру графа фильтра о том, что модуль подготовки отчетов нуждается в данных. Если граф фильтра был остановлен при получении одного из этих уведомлений, это приведет к приостановке графа фильтра, дожидаться получения данных всеми фильтрами (путем вызова метода " [**State**](/windows/desktop/api/Strmif/nf-strmif-imediafilter-getstate)") и последующей остановки. При остановке обработчик видео должен удерживаться на изображении, чтобы можно было обрабатывать последующие сообщения [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) .

Таким образом, если модуль подготовки видео получает сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) при остановке или приостановке и не содержит ничего, с которым будет закрашиваться окно, оно должно ОТсылать [**\_ перерисовки EC**](ec-repaint.md) в Диспетчер графа фильтров. Если при приостановке получается уведомление о **\_ перерисовке EC** , диспетчер графа фильтров вызывает [**имедиапоситион::p UT \_ CurrentPosition**](/windows/desktop/api/Control/nf-control-imediaposition-put_currentposition) с текущей позицией (т. е. выполняет поиск в текущей положении). Это приводит к тому, что фильтры источника сбрасывают граф фильтра и вызывают отправку новых данных через граф фильтра.

Модуль подготовки отчетов должен отправлять только одно из этих уведомлений за раз. Таким образом, когда модуль подготовки отчетов отправляет уведомление, он должен гарантировать, что все больше не будут отправляться, пока не будут доставлены некоторые образцы. Обычный способ сделать это — установить флаг, означающий, что перерисовку можно отправить, что будет отключено после отправки уведомления о [**\_ перерисовке EC**](ec-repaint.md) . Этот флаг должен быть сброшен после доставки данных или ввода ПИН-кода для записи на диск, но не в случае, если на входном заметке сообщается конец потока.

Если модуль подготовки отчетов не отслеживает уведомления о [**\_ перерисовке EC**](ec-repaint.md) , он переводит диспетчер графов фильтров в запросы **\_ перерисовки EC** (которые относительно ресурсоемких процессов). Например, если у модуля подготовки отчетов нет изображения для рисования, а другое окно перемещается по окну модуля отрисовки в операции полного перетаскивания, модуль подготовки отчетов получает несколько сообщений [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) . Только первый из них должен создавать уведомление о событии **EC \_ перерисовки** из модуля подготовки к просмотру диспетчера графа фильтров.

Модуль подготовки отчетов должен отправить свой входной ПИН-код в качестве первого параметра в уведомление о [**\_ перерисовке EC**](ec-repaint.md) . При этом будет выполнен запрос к присоединенному закреплениям выходных данных для [**имедиаевентсинк**](/windows/desktop/api/Strmif/nn-strmif-imediaeventsink), и если оно поддерживается, уведомление о **\_ перерисовке EC** будет отправлено в первую очередь. Это позволяет выходным закреплениям обрабатывать перерисовки до того, как необходимо затронуть граф фильтра. Это не будет выполнено, если граф фильтра остановлен, поскольку буферы не будут доступны из распределителя незафиксированного модуля подготовки отчетов.

Если выходной ПИН-код не может обрабатывать запрос и граф фильтра работает, уведомление о [**\_ перерисовке EC**](ec-repaint.md) игнорируется. Закрепление вывода должно возвращать значение **S \_ ОК** от [**имедиаевентсинк:: notify**](/windows/desktop/api/Strmif/nf-strmif-imediaeventsink-notify) , чтобы сообщить о том, что запрос на перерисовку успешно обработан. Закрепление вывода будет вызываться в рабочем потоке диспетчера графа фильтра, что позволяет избежать непосредственного вызова выходного ПИН-кода и сидестепс всех проблем взаимоблокировки. Если граф фильтра остановлен или приостановлен, а выходные данные не обрабатывают запрос, обработка по умолчанию выполняется.

## <a name="handling-notifications-in-full-screen-mode"></a>Обработка уведомлений в режиме Full-Screen

Подключаемый модуль [**ивидеовиндов**](/windows/desktop/api/Control/nn-control-ivideowindow) (PID) в графе фильтра управляет воспроизведением на полноэкранном режиме. Он будет переключать модуль визуализации видео на средство подготовки полноэкранного режима для специалистов, растянуть окно модуля подготовки отчетов в полноэкранный режим или подготовить его к полноэкранному воспроизведению напрямую. Для взаимодействия с полноэкранными протоколами модуль подготовки отчетов должен отправить уведомление об [**\_ активации EC**](ec-activate.md) всякий раз, когда его окно активируется или деактивируется. Иными словами, для каждого сообщения WM активатеапп, полученного модулем подготовки, должно быть отправлено уведомление об **\_ активации EC** \_ .

При использовании модуля подготовки отчетов в полноэкранном режиме эти уведомления управляют переключением в полноэкранный режим и из него. Деактивация окна обычно происходит, когда пользователь нажимает ALT + TAB для переключения на другое окно, которое модуль подготовки отчетов DirectShow использует в качестве подсказки для возврата в обычный режим рендеринга.

Когда уведомление [**о \_ активации EC**](ec-activate.md) отправляется в Диспетчер графов фильтров при выходе из полноэкранного режима, диспетчер графа фильтров отправляет в управляющее приложение уведомление о [**\_ неполноэкранном \_ режиме EC**](ec-fullscreen-lost.md) . Приложение может использовать это уведомление для восстановления состояния полноэкранной кнопки, например. Уведомления **об \_ активации EC** используются внутри DirectShow для управления полноэкранным переключением в подсказках из модулей подготовки видео.

## <a name="summary-of-notifications"></a>Сводка уведомлений

В этом разделе перечислены уведомления графа фильтра, которые могут отправляться модулем подготовки отчетов.



| Уведомление о событии                                        | Описание                                                                                                                                                                                       |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**\_Активация EC**](ec-activate.md)                       | Отправляется модулями подготовки видео в полноэкранном режиме для каждого \_ полученного сообщения WM активатеапп.                                                                                                  |
| [**EC \_ завершено**](ec-complete.md)                       | Посылается модулями подготовки отчетов после подготовки к просмотру всех данных.                                                                                                                                               |
| [**\_изменение дисплея \_ EC**](ec-display-changed.md)        | Отправляется модулями подготовки видео при изменении формата отображения.                                                                                                                                            |
| [**\_Изменение палитры EC \_**](ec-palette-changed.md)        | Отправляется каждый раз, когда модуль подготовки видео обнаруживает изменение палитры в потоке.                                                                                                                            |
| [**\_ПЕРЕрисовка EC**](ec-repaint.md)                         | Отправляется остановленными или приостановленными модулями подготовки видео, когда \_ получено сообщение WM Paint и отсутствуют данные для отображения. Это приводит к тому, что диспетчер графов фильтров создает рамку для рисования на экране. |
| [**EC \_ усераборт**](ec-userabort.md)                     | Отправляется модулями подготовки видео для сигнализации о закрытии, запрошенном пользователем (например, при закрытии видео окна).                                                                               |
| [**\_Размер видео \_ EC \_ изменен**](ec-video-size-changed.md) | Отправляется модулями подготовки видео при обнаружении изменений в собственном размере видео.                                                                                                                       |
| [**\_окно EC \_ уничтожено**](ec-window-destroyed.md)      | Посылается модулями подготовки видео, когда фильтр удаляется или уничтожается, чтобы ресурсы, зависящие от фокуса окна, можно было передавать другим фильтрам.                                                     |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Написание модулей подготовки видео](writing-video-renderers.md)
</dt> </dl>

 

 
