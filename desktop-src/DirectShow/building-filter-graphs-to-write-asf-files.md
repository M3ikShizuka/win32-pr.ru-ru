---
description: Создание графов фильтра для записи файлов ASF
ms.assetid: c4885152-d7d2-4749-a79a-e0effd38837d
title: Создание графов фильтра для записи файлов ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0581672f9fd3e4bfa5e2c678c3bd3c0d3ea22fa0
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127148026"
---
# <a name="building-filter-graphs-to-write-asf-files"></a>Создание графов фильтра для записи файлов ASF

при создании Windows содержимого на основе носителя приложения обычно используют один из следующих сценариев.

-   преобразование или перекодирование содержимого из другого формата в Windowsный формат мультимедиа.
-   вставка содержимого, не Windows на основе мультимедиа (собственные форматы потока) в файлы ASF.
-   запись динамических данных и их кодирование непосредственно в Windows формате носителя.

Перекодирование файлов ASF

Вы можете создать граф фильтра для перекодирования файлов с помощью [модуля записи WM ASF](wm-asf-writer-filter.md) различными способами. Самый простой способ — добавить модуль записи WM ASF в граф фильтра, а затем использовать метод Играфбуилдер:: RenderFile для автоматической сборки графа.

Другой способ — добавить каждый фильтр на диаграмму вручную и соединить эти контакты. После добавления модуля записи WM ASF настройте его с помощью методов Иконфигасфвритер, если профиль по умолчанию не подходит, и подключите входные ПИН-коды модуля записи WM ASF к соответствующим выходным контактам в вышестоящем фильтре.

На следующем рисунке показана типичная конфигурация графа фильтра модуля записи WM ASF.

![граф фильтра перекодирования](images/asf-transcode.png)

Вставка собственных форматов потока в файлы ASF

по умолчанию фильтр модуля записи WM ASF ждет несжатые аудио-и видеопотоки на входных пин-кодах и использует Windows media audio и Windows media video для сжатия потоков. Однако контейнер файлов ASF можно использовать для любого типа данных. Помещая цифровые мультимедийные данные в контейнер файлов ASF, можно добавлять функции, предоставляемые ASF, такие как метаданные и управление цифровыми правами (DRM), без необходимости перекодирования содержимого.

чтобы создать файл ASF, содержащий содержимое, которое не Windows на основе носителя, приложение должно сжать поток в графе фильтра в виде вышестоящего потока модуля записи wm asf и обойти механизм сжатия модуля записи wm asf, вызвав [**IConfigAsfWriter2:: сетпарам**](/previous-versions/windows/desktop/api/Dshowasf/nf-dshowasf-iconfigasfwriter2-setparam) следующим образом:


```C++
pConfigAsfWriter2->SetParam(AM_CONFIGASFWRITER_PARAM_DONTCOMPRESS,TRUE,0)
```



Затем настройте фильтр с нужным профилем. Очень важно, чтобы тип носителя входного потока точно совпадал с форматом в профиле. В некоторых случаях может потребоваться проверить формат входного потока и создать настраиваемый профиль для его сопоставления.

При подключении модуля записи WM ASF к вышестоящему фильтру используйте метод Играфбуилдер:: Коннектдирект. не используйте методы intelligent connect, такие как играфбуилдер:: Подключение или играфбуилдер:: RenderFile, для подключения фильтра, так как это приведет к отключению режима "обходного сжатия" фильтра.

Запись непосредственно с устройства в ASF-файл

При записи аудио или видео непосредственно в файл ASF граф фильтра будет выглядеть примерно так, как показано ниже, в зависимости от типа используемого устройства записи.

![граф захвата видео Windows Media](images/asf-webcam.png)

Дополнительные сведения о создании графов видеороликов и видеозаписей см. в следующих разделах:

-   [Запись звука](audio-capture.md)
-   [Видеозапись](video-capture.md)

Модуль записи WM ASF не будет работать, пока не будут подключены все его ПИН-коды. Если настроить модуль записи WM ASF с помощью системного профиля по умолчанию (не рекомендуется) или любого профиля с аудио-и видеопотоками, то он создаст входной ПИН-код для каждого потока, и каждый из этих контактов должен быть подключен. Если вы не собираетесь записывать звук, например, не забудьте настроить фильтр с помощью профиля только для видео, чтобы не создавался звуковой ПИН-код.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Создание файлов ASF в DirectShow](creating-asf-files-in-directshow.md)
</dt> </dl>

 

 



