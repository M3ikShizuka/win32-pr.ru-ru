---
description: Метки времени
ms.assetid: 445fe6b9-9d5b-45fd-9c9e-8c632c5228ae
title: Метки времени
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ed14f0155a0bfbf209719f4aff97cbbd19501e6aa32d57e9f0c1cbb2df0964b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119072318"
---
# <a name="time-stamps"></a>Метки времени

*Метка времени* определяет время начала и окончания образца носителя, измеряемое во время потока. Метка времени иногда называется *временем презентации*. При чтении оставшейся части этой статьи важно помнить, что не все форматы используют метки времени одинаковым образом. Например, не все образцы MPEG имеют отметку времени. В графах фильтра MPEG отметка времени не применяется к каждому кадру, пока они не выводятся из декодера.

Когда фильтр модуля подготовки отчетов получает образец, он планирует отрисовку на основе метки времени. Если пример приступит к опозданию или не имеет отметки времени, фильтр немедленно выводит пример. В противном случае фильтр ожидает до тех пор, пока не будет отображен пример. (Он ждет времени начала, вызвав метод [**иреференцеклокк:: адвисетиме**](/windows/desktop/api/Strmif/nf-strmif-ireferenceclock-advisetime) .)

Фильтры источников и фильтры анализатора отвечают за установку правильных меток времени для обрабатываемых образцов. Используйте следующие рекомендации.

-   Воспроизведение файла: Первая выборка имеет отметку времени начала, равное нулю. Последующие отметки времени определяются длиной выборки и скоростью воспроизведения, которая определяется форматом файла. Фильтр, который анализирует файл, отвечает за вычисление правильных меток времени (например, [разделителя AVI](avi-splitter-filter.md)).
-   Запись видео и звука. Каждый образец имеет время начала, равное времени выполнения потока при записи, со следующими предупреждениями.
    -   Видеокадры из предварительной версии ПИН-кода (в отличие от ПИН-кода захвата) не имеют метки времени. Из-за задержки графа видеокадр, помеченный временем записи, всегда приступит к работе модуля подготовки видео. Это может привести к тому, что модуль подготовки отчетов выполнит удаление кадров в попытке контроля качества. Сведения об управлении качеством см. в разделе [Управление качеством](quality-control-management.md).
    -   Запись звука. фильтр записи звука использует собственный набор буферов, отличный от тех, которые используются драйвером аудиоподсистемы. Драйвер аудиоподсистемы заполняет буферы фильтра записи с фиксированными интервалами. Интервал зависит от драйвера, но обычно не превышает 10 миллисекунд. Метки времени на звуковых примерах соответствуют времени, когда драйвер заполняет буферы фильтра записи звука. Эти значения времени могут быть немного неточными, особенно если приложение использует очень маленький размер буфера. Тем не менее, время передачи мультимедиа будет точно отражать число образцов аудио в буфере.
-   Фильтры мультиплексора. в зависимости от формата выходных данных для фильтра мультиплексора может потребоваться создать отметки времени или не может быть. Например, формат AVI-файла использует фиксированную частоту кадров без штампов времени, поэтому фильтр для [AVI-мультиплексора](avi-mux-filter.md) предполагает, что выборки поступают приблизительно в нужное время. Если штампы времени поступающего показывают промежуток, превышающий один кадр, то в случае, если в формате AVI имеется запись индекса с нулевым размером, это означает, что кадр был удален. При воспроизведении файлов новые отметки времени создаются во время выполнения, как описано выше.

Чтобы задать метку времени для образца, вызовите метод [**имедиасампле:: setTime**](/windows/desktop/api/Strmif/nf-strmif-imediasample-settime) .

**Время передачи мультимедиа**

При необходимости фильтр также может указать *время носителя* для образца. В потоке видео время мультимедиа представляет номер кадра. В звуковом потоке время носителя представляет образец номера в пакете. Например, если каждый пакет содержит одну секунду для звука 44,1 килохертз (кГц), первый пакет имеет нулевое время начала и время окончания, равное 44100. В потоке, доступном для поиска, время мультимедиа всегда указывается относительно времени начала потока. Например, предположим, что вы зайдете на 2 секунды с начала видеопотока из 15 кадров в секунду. Первый пример носителя после операции поиска имеет отметку времени, равную нулю, но время мультимедиа, равное 30.

Фильтры визуализации и мультиплексора могут использовать время мультимедиа, чтобы определить, были ли удалены фреймы или образцы, путем проверки наличия пропусков. Однако для установки времени мультимедиа фильтры не требуются. Чтобы задать время мультимедиа в образце, вызовите метод [**имедиасампле:: сетмедиатиме**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatime) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Время и часы в DirectShow](time-and-clocks-in-directshow.md)
</dt> </dl>

 

 



