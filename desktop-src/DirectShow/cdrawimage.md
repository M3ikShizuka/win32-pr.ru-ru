---
description: Класс Кдравимаже — это вспомогательный класс, который управляет рисованием для фильтра модуля визуализации видео.
ms.assetid: 7a6b3726-dbf5-4b60-8cf1-42034a321293
title: Класс Кдравимаже (Винутил. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CDrawImage
api_type:
- COM
api_location:
- Strmbase.lib
- Strmbase.dll
- Strmbasd.lib
- Strmbasd.dll
ms.openlocfilehash: 001b91338b2956f663d777cbc9597fa2d9a478f3
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105669434"
---
# <a name="cdrawimage-class"></a>Класс Кдравимаже

`CDrawImage`Класс является вспомогательным классом, который управляет рисованием для фильтра модуля визуализации видео. Все операции рисования выполняются с помощью GDI. Этот класс не обеспечивает поддержку отрисовки с помощью DirectDraw. `CDrawImage`Класс требует, чтобы фильтр-владелец также использовал класс [**кбасевиндов**](cbasewindow.md) , который управляет окном видео. `CDrawImage`Конструктор принимает указатель на объект **кбасевиндов** .

На следующей схеме показан предпочтительный способ использования этого класса в пользовательском фильтре модуля подготовки отчетов видео.

![пользовательский модуль подготовки видео с помощью кдравимаже](images/videorenderer.png)

Чтобы использовать этот класс, выполните следующие действия.

-   При подключении к контактам вызывайте методы [**кдравимаже:: нотифимедиатипе**](cdrawimage-notifymediatype.md) и [**Кдравимаже:: нотифяллокатор**](cdrawimage-notifyallocator.md) .
-   При каждом изменении типа мультимедиа вызовите **нотифимедиатипе** еще раз.
-   Перед отрисовкой вызовите метод [**кдравимаже:: сетдравконтекст**](cdrawimage-setdrawcontext.md).
-   Вызовите метод [**кдравимаже:: сетсаурцерект**](cdrawimage-setsourcerect.md) , если исходный прямоугольник изменяется, и [**Кдравимаже:: сеттаржетрект**](cdrawimage-settargetrect.md) , если целевой прямоугольник изменяется.
-   Управление палитрой для изображений палеттизед, как описано в разделе палитры ниже.

## <a name="allocators"></a>Распределители

Фильтр, показанный на предыдущей схеме, использует пользовательский класс распределителя [**Цимажеаллокатор**](cimageallocator.md). Этот распределитель создает DIB в общей памяти с помощью функции GDI **креатедибсектион** . Примеры, созданные распределителем, являются объектами [**Цимажесампле**](cimagesample.md) .

Если фильтр владеет распределителем подключения, то образцы носителей гарантированно будут [**Цимажесампле**](cimagesample.md) объектами. В этом случае объект **кдравимаже** может оптимизировать рисование с помощью **BitBlt** или стретчблт. В противном случае он должен использовать более медленные функции **сетдибитстодевице** или **стретчдибитс** . Более быстрый вариант реализуется методом [**кдравимаже:: фастрендер**](cdrawimage-fastrender.md) , который является более медленным при помощи метода [**Кдравимаже:: словрендер**](cdrawimage-slowrender.md) . (Несмотря на имя, вы, скорее всего, не увидите значительных проблем с производительностью в **словрендер**, особенно на более новом оборудовании.)

## <a name="palettes"></a>Палитр

Если для рисования используется метод [**фастрендер**](cdrawimage-fastrender.md) , а изображение — палеттизед, то фильтр должен управлять палитрой следующим образом:

-   Класс [**Цимажесампле**](cimagesample.md) содержит номер версии палитры, хранящийся в структуре [**дибдата**](dibdata.md) . Значение инициализируется, когда распределитель создает образец.
-   Класс **кдравимаже** также содержит номер версии палитры, который инициализируется при создании.
-   При каждом изменении типа мультимедиа на новый формат палеттизед вызовите [**кдравимаже:: инкрементпалеттеверсион**](cdrawimage-incrementpaletteversion.md). Этот метод увеличивает номер версии палитры объекта **кдравимаже** . Если фильтр использует класс [**Цимажепалетте**](cimagepalette.md) для управления сведениями о палитре, можно просто вызвать [**Цимажепалетте::P репарепалетте**](cimagepalette-preparepalette.md) при каждом изменении типа мультимедиа. Метод **препарепалетте** увеличивает версию палитры, только если это необходимо.
-   Метод [**фастрендер**](cdrawimage-fastrender.md) сравнивает версию палитры **кдравимаже** с версией палитры образца. Если номер версии образца отстает от номера версии **кдравимаже** , то метод **фастрендер** вызывает [**кдравимаже:: упдатеколауртабле**](cdrawimage-updatecolourtable.md). Метод **упдатеколауртабле** задает таблицу цветов в контексте устройства с помощью функции GDI **сетдибколортабле** . Кроме того, версия палитры в образце обновляется до номера текущей версии.
-   Если ПИН-код повторно подключится, то фильтр должен вызвать [**кдравимаже:: ресетпалеттеверсион**](cdrawimage-resetpaletteversion.md) , чтобы сбросить версию палитры. При переподключении ПИН-кода распределитель перераспределяет все примеры.



| Защищенные переменные членов                                            | Описание                                                                                                                     |
|-----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| [**m \_ бстретч**](cdrawimage-m-bstretch.md)                          | Указывает, нужно ли растянуть изображение видео по размеру окна назначения.                                              |
| [**m \_ бусингимажеаллокатор**](cdrawimage-m-busingimageallocator.md)  | Указывает, является ли распределитель для соединения с закреплением объектом **Цимажеаллокатор** .                                         |
| [**m \_ ендсампле**](cdrawimage-m-endsample.md)                        | Указывает время окончания последнего примера.                                                                              |
| [**m \_ HDC**](cdrawimage-m-hdc.md)                                    | Обработайте с контекстом устройства окна-владельца.                                                                              |
| [**m \_ меморидк**](cdrawimage-m-memorydc.md)                          | Обработчик контекста устройства памяти в окне-владельце.                                                                       |
| [**m \_ палеттеверсион**](cdrawimage-m-paletteversion.md)              | Используется для трассировки изменения палитры.                                                                                         |
| [**m \_ пбасевиндов**](cdrawimage-m-pbasewindow.md)                    | Указатель на объект-владелец **кбасевиндов** .                                                                                   |
| [**m \_ пмедиатипе**](cdrawimage-m-pmediatype.md)                      | Указатель на текущий тип мультимедиа.                                                                                              |
| [**m \_ саурцерект**](cdrawimage-m-sourcerect.md)                      | Задает исходный прямоугольник для рисования.                                                                                     |
| [**m \_ стартсампле**](cdrawimage-m-startsample.md)                    | Указывает время начала последнего примера.                                                                             |
| [**m \_ таржетрект**](cdrawimage-m-targetrect.md)                      | Задает целевой прямоугольник для рисования.                                                                                     |
| Защищенные методы                                                     | Описание                                                                                                                     |
| [**дисплайсамплетимес**](cdrawimage-displaysampletimes.md)           | Рисует метки времени для примера мультимедиа поверх видеоизображения.                                                              |
| [**фастрендер**](cdrawimage-fastrender.md)                           | Отображает изображение видео с помощью функций **BitBlt** или **стретчблт** .                                                         |
| [**сетстретчмоде**](cdrawimage-setstretchmode.md)                   | Вычисляет, нужно ли растянуть изображение видео.                                                                           |
| [**словрендер**](cdrawimage-slowrender.md)                           | Отображает изображение видео с помощью функций **сетдибитстодевице** или **стретчдибитс** .                                           |
| [**упдатеколауртабле**](cdrawimage-updatecolourtable.md)             | Обновляет таблицу цветов с помощью новой палитры.                                                                                     |
| Открытые методы                                                        | Описание                                                                                                                     |
| [**кдравимаже**](cdrawimage-cdrawimage.md)                           | Метод конструктора.                                                                                                             |
| [**DrawImage**](cdrawimage-drawimage.md)                             | Рисует кадр видео в окне видео.                                                                                        |
| [**драввидеоимажехере**](cdrawimage-drawvideoimagehere.md)           | Рисует изображение из примера носителя в заданном контексте устройства.                                                               |
| [**жетпалеттеверсион**](cdrawimage-getpaletteversion.md)             | Извлекает версию палитры.                                                                                                  |
| [**жетсаурцерект**](cdrawimage-getsourcerect.md)                     | Извлекает текущий исходный прямоугольник.                                                                                         |
| [**жеттаржетрект**](cdrawimage-gettargetrect.md)                     | Извлекает текущий конечный прямоугольник.                                                                                    |
| [**инкрементпалеттеверсион**](cdrawimage-incrementpaletteversion.md) | Увеличивает версию палитры.                                                                                                 |
| [**нотифяллокатор**](cdrawimage-notifyallocator.md)                 | Информирует `CDrawImage` объект о том, является ли распределитель для соединения объектом **Цимажеаллокатор** .                       |
| [**нотифенддрав**](cdrawimage-notifyenddraw.md)                     | Не поддерживается.                                                                                                                  |
| [**нотифимедиатипе**](cdrawimage-notifymediatype.md)                 | Уведомляет объект о текущем типе мультимедиа.                                                                                  |
| [**нотифистартдрав**](cdrawimage-notifystartdraw.md)                 | Не поддерживается.                                                                                                                  |
| [**ресетпалеттеверсион**](cdrawimage-resetpaletteversion.md)         | Сбрасывает версию палитры.                                                                                                     |
| [**скалесаурцерект**](cdrawimage-scalesourcerect.md)                 | Масштабирует указанный исходный прямоугольник, если существует разница между собственным размером видео и форматом типа мультимедиа. Виртуализаци. |
| [**сетдравконтекст**](cdrawimage-setdrawcontext.md)                   | Задает контексты устройств, используемые для рисования.                                                                                      |
| [**сетсаурцерект**](cdrawimage-setsourcerect.md)                     | Задает исходный прямоугольник.                                                                                                      |
| [**сеттаржетрект**](cdrawimage-settargetrect.md)                     | Задает целевой прямоугольник.                                                                                                      |
| [**усингимажеаллокатор**](cdrawimage-usingimageallocator.md)         | Указывает, является ли текущий распределитель объектом [**Цимажеаллокатор**](cimageallocator.md) .                                 |



 

## <a name="requirements"></a>Требования



| Требование | Значение |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Header<br/>  | <dl> <dt>Винутил. h (включение Streams. h)</dt> </dl>                                                                                   |
| Библиотека<br/> | <dl> <dt>Стрмбасе. lib (розничные сборки); </dt> <dt>Стрмбасд. lib (отладочные сборки)</dt> </dl> |



 

 




