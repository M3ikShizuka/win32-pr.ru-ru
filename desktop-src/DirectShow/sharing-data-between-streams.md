---
description: Обмен данными между потоками
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Обмен данными между потоками
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104495234"
---
# <a name="sharing-data-between-streams"></a>Обмен данными между потоками

> [!Note]  
> Эти API-интерфейсы являются устаревшими. Приложения должны использовать [**образец фильтра захвата**](sample-grabber-filter.md) или реализовать настраиваемый фильтр для получения данных из графа фильтра DirectShow.

 

Для обработки мультимедийных данных обычно требуется большой объем системных ресурсов. Поэтому следует избегать копирования данных везде, где это возможно. Архитектура потоковой передачи поддерживает примеры общих потоков — механизм, который перемещает данные из одного потока в другой без копирования. Этот буфер обеспечивает эффективный транспорт данных между двумя потоками, даже если целевой поток не поддерживает базовый формат данных.

Например, предположим, что у вас есть мультимедийный поток с тремя потоками данных: видео и аудио, а также данные URL-адреса со временем, которые соответствуют содержимому видео. Вы хотите написать приложение, которое добавляет уведомление об авторских правах в каждый кадр видеозаписи и записывает данные в другой поток для хранения, но ваше приложение не понимает никаких форматов данных, кроме видеопотока. Для видеопотока вы создаете пример, присоединенный к нужной поверхности DirectDraw. Затем можно создать выходной поток, вызвав метод [**идиректдравмедиастреам:: креатесампле**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) с этим указателем на ту же поверхность или [**Имедиастреам:: креатешаредсампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample). В обоих случаях входные и выходные потоки совместно используют поверхность DirectDraw. Так как вы понимаете формат видео, при необходимости вы можете получить доступ к этой поверхности.

Чтобы получить другие указатели исходного потока (аудио и URL), перечислите исходный поток контейнера и захватите указатели на видеопотоки. Каждый из этих исходных потоков имеет связанный выходной поток в контейнере потока вывода. Получите эти выходные указатели, вызвав метод [**имултимедиастреам:: жетмедиастреам**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) в контейнере вывода с каждым из указателей исходного потока. Следующие шаги описывают данный процесс.

1.  Вызовите метод [**имултимедиастреам:: енуммедиастреамс**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) , чтобы получить указатель на исходный поток. Убедитесь, что это не видеопоток, так как приложение уже распознает свой формат.
2.  Вызовите метод [**имултимедиастреам:: жетмедиастреам**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) в выходном потоке контейнера с указателем из шага 1. Он возвращает указатель на нужный выходной поток.
3.  Вызовите [**аллокатесампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) в исходном потоке.
4.  Вызовите [**креатешаредсампле**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) в потоке вывода.
5.  Чтобы считать данные, вызовите метод [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) в исходном потоке.
6.  Вызовите метод [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) в потоке вывода, чтобы записать данные.

Повторите эти действия для каждого потока, формат которого не поддерживается. После завершения обновления обоих образцов выходной поток получает все данные из исходного потока и все готово.

 

 



