---
description: Обработка изменений формата из модуля подготовки видео
ms.assetid: ac7d7b1c-3c9a-4693-87ea-0a10a8ab915c
title: Обработка изменений формата из модуля подготовки видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fc1dd0ec2f87a8604d3b03aa6c2f334161d218f4d7fb45c76aad1015f071d947
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119905304"
---
# <a name="handling-format-changes-from-the-video-renderer"></a>Обработка изменений формата из модуля подготовки видео

В этом разделе описывается, как фильтр декодера или фильтр преобразования должен обрабатывать изменения формата из модуля подготовки видео.

**Фильтр модуля подготовки отчетов видео**

При подключении старого фильтра модуля подготовки отчетов к [просмотру](video-renderer-filter.md) требуется формат RGB, соответствующий формату отображения основного монитора. Это позволяет использовать GDI для отрисовки, если DirectDraw недоступен. При запуске воспроизведения модуль подготовки отчетов может переключиться в формат, совместимый с DirectDraw. Чтобы верфифи, может ли вышестоящий фильтр поддерживать новый формат, модуль подготовки видео вызывает [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) в выходном ПИН-коде вышестоящего фильтра. Если вышестоящий фильтр принимает новый формат, метод **куерякцепт** возвращает значение S \_ ОК. Модуль подготовки видео переключает форматы, присоединяя к следующему примеру носителя тип мультимедиа с новым форматом, возвращенный его распределителем. Вышестоящий фильтр должен проверить изменения формата, вызвав [**имедиасампле:: жетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) для каждого образца. Модуль обработки видео может переключаться между исходным форматом и новым форматом в любое время во время потоковой передачи. Он не вызывает **куерякцепт** после первого изменения формата. После того, как вышестоящий фильтр принял новый формат, он должен иметь возможность переключения обратно и назад.

Вышестоящий фильтр может отклонить изменение формата, возвращая S \_ false из **куерякцепт**. В этом случае модуль подготовки видео продолжит использовать GDI с исходным форматом.

**Фильтр модуля подготовки видео микшера**

Фильтр визуализации видео микширования (VMR-7 и VMR-9) будет подключаться к любому формату, поддерживаемому графическим оборудованием в системе. VMR-7 всегда использует DirectDraw для отрисовки и выделяет базовые поверхности DirectDraw при соединении вышестоящего фильтра. VMR-9 всегда использует Direct3D для отрисовки и выделяет базовые поверхности Direct3D при соединении вышестоящего фильтра.

Для графического оборудования может потребоваться больший размер поверхности, чем ширина изображения. В этом случае VMR запрашивает новый формат, вызывая **куерякцепт**. Он отображает шаг поверхности в элементе **бивидс** в [**битмапинфохеадер**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader) в формате видео. Если вышестоящий фильтр не возвращает значение S \_ ОК из **куерякцепт**, то VMR отклоняет формат и пытается подключиться, используя следующий формат, объявленный вышестоящим фильтром. VMR присоединяет тип мультимедиа к новому формату для первого примера носителя. После первой выборки формат остается постоянным. фильтр VMR не будет переключать форматы во время работы графа.

**Улучшенная визуализация видео (Евр)**

Евр всегда использует Direct3D для отрисовки. Если необходим больший шаг, ЕВР использует тот же механизм **куерякцепт** , что и VMR.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Куерякцепт (вышестоящий)](queryaccept--upstream.md)
</dt> </dl>

 

 



