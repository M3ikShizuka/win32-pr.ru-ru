---
description: Как аппаратные устройства участвуют в графе фильтра
ms.assetid: 27e1c097-9bb4-4f9c-b9f9-0d4225c0d290
title: Как аппаратные устройства участвуют в графе фильтра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 68794bbc046e633e9a435b2628a20b8ea8aab174
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104494307"
---
# <a name="how-hardware-devices-participate-in-the-filter-graph"></a>Как аппаратные устройства участвуют в графе фильтра

В этой статье описывается взаимодействие DirectShow с аудио и видео оборудованием.

**Фильтры оболочки**

Все фильтры DirectShow являются программными компонентами пользовательского режима. Чтобы устройство с режимом ядра, например карта видеозаписи, присоединяется к графу фильтра DirectShow, оно должно быть представлено в виде фильтра в пользовательском режиме. Эта функция выполняется специальными фильтрами оболочки, поставляемыми с DirectShow. Эти фильтры включают фильтр [записи звука](audio-capture.md) , фильтр [записи VFW](vfw-capture-filter.md) , фильтр ТВ- [тюнера](tv-tuner-filter.md) , фильтр [ТВ-звука](tv-audio-filter.md) и [аналоговый фильтр видеомикшера](analog-video-crossbar-filter.md) . DirectShow также предоставляет фильтр с именем Кспрокси, который может представлять любой тип устройства потоковой передачи WDM (WDM). Поставщики оборудования могут расширять Кспрокси для поддержки пользовательских функций, предоставляя *подключаемый модуль кспрокси*— COM-объект, агрегированный по кспрокси.

Фильтры-оболочки предоставляют интерфейсы COM, представляющие возможности устройства. Приложение использует эти интерфейсы для передачи информации в фильтр и обратно. Фильтр преобразует вызовы метода COM в вызовы драйвера устройства, передает эти сведения драйверу в режиме ядра, а затем преобразует результат обратно в приложение. Фильтры ТВ-тюнера, ТВ-аудио, аналогового видеомикшера и фильтров Кспрокси поддерживают настраиваемые свойства драйверов через интерфейс [**икспропертисет**](ikspropertyset.md) . Фильтр записи VFW и фильтр записи звука не расширяемы таким образом.

Для разработчиков приложений фильтры-оболочки позволяют приложению управлять устройствами так же, как и любым другим фильтром DirectShow. Никакого специального программирования не требуется; сведения о взаимодействии с устройством режима ядра инкапсулируются в фильтре.

**Видео для устройств Windows**

Фильтр записи VFW поддерживает более ранние видеокарты для захвата видео для Windows (VfW). Если на целевой системе имеется карта VfW, ее можно обнаружить и добавить на граф фильтра с помощью [перечислителя системных устройств](system-device-enumerator.md)DirectShow. Дополнительные сведения см. в разделе [Перечисление устройств и фильтров](enumerating-devices-and-filters.md).

**Звуковая запись и смешивание устройств (звуковые карты)**

Новые звуковые карты имеют розетки ввода для микрофонов и устройств других типов. Как правило, эти карты также имеют встроенные возможности смешивания для управления томом, высоких частотой и низкие частоты каждого отдельного входа. В DirectShow входные и микшерные звуковые карты упаковываются фильтром записи звука. Каждую звуковую карту можно обнаружить с помощью перечислителя системных устройств. Чтобы просмотреть звуковые карты в системе, запустите Графедит и выберите категорию источники звукозаписи. Каждый фильтр в этой категории является отдельным экземпляром фильтра записи звука. (См. раздел [Использование графедит](using-graphedit.md).)

**Устройства потоковой передачи WDM**

Новые аппаратные декодеры и карты захвата соответствуют спецификации WDM (WDM). Эти устройства обладают большей функциональностью, чем устройства VfW. Карты видеозаписи WDM могут поддерживать функции, недоступные в VfW, включая перечисление форматов записи, программное управление параметрами видео, такими как оттенок и яркость, Программный выбор ввода и поддержка ТВ-тюнера.

Для поддержки устройств потоковой передачи WDM в DirectShow предусмотрен фильтр Кспрокси (ksproxy.ax). Кспрокси назывался «фильтром Швейцарии армии нож», так как он делает так много различных вещей. Количество ПИН-кодов в фильтре и количество интерфейсов COM, предоставляемых фильтром, зависят от возможностей базового драйвера. Кспрокси не отображается в графе фильтра под именем "Кспрокси". Он всегда принимает понятное имя устройства, которое находится в реестре. Чтобы просмотреть устройства WDM в системе, запустите Графедит и выберите из категорий потоковой передачи WDM. Даже если в системе имеется только одна карта WDM, она может содержать несколько устройств. Каждое устройство представляется в виде отдельного фильтра, и каждый из этих фильтров на самом деле Кспрокси.

Приложение использует перечислитель системных устройств для поиска моникеров устройств WDM в системе. Экземпляр Кспрокси создается путем вызова **биндтубжект** для моникера. Так как Кспрокси может представлять все виды устройств WDM, он должен запросить драйвер, чтобы определить, какие из свойств поддерживаются драйвером. Наборы свойств — это коллекции структур данных, используемых драйверами WDM, а также фильтры пользовательского режима, такие как программные декодеры MPEG-2. Кспрокси настраивается для предоставления интерфейсов COM, соответствующих этим наборам свойств. Кспрокси преобразует вызовы COM-методов в наборы свойств и отправляет их драйверу. Поставщики оборудования могут расширять Кспрокси, предоставляя подключаемые модули, которые являются интерфейсами конкретного поставщика, которые предоставляют специальные возможности устройства. Все эти сведения скрыты от приложения. Приложение управляет устройством с помощью Кспрокси так же, как и любого другого фильтра DirectShow.

**Потоковая передача ядра**

Устройства WDM поддерживают потоковую передачу ядра, в котором данные полностью передаются в режиме ядра без переключения в пользовательский режим. Переключение между режимом ядра и пользовательским режимом занимает много вычислительных ресурсов; Потоковая передача ядра обеспечивает высокую скорость передачи данных без нагрузки на ЦП узла. Фильтры на основе WDM могут использовать потоковую передачу ядра для передачи мультимедийных данных непосредственно с одного аппаратного устройства на другое на одной карте или на другой карте без копирования данных в основную память системы.

С точки зрения приложения он выглядит так, как если бы данные переперемещались из одного фильтра пользовательского режима в следующий. На практике данные могут никогда не передаваться в пользовательский режим, а могут передаваться напрямую из одного устройства режима ядра в другое, пока оно не будет отображено на видеоадаптере. В некоторых сценариях, например при записи в файл, требуется, чтобы данные в некоторый момент передавались из режима ядра в пользовательский режим. Однако этот параметр не обязательно требует копирования данных в новое место в памяти.

Разработчикам приложений обычно не требуется заботиться о потоковой передаче ядра, за исключением фоновых сведений. Более подробные сведения о WDM, потоковой передаче в ядро, Кспрокси и связанных разделах см. в Microsoft DDK.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Граф фильтра и его компоненты](the-filter-graph-and-its-components.md)
</dt> </dl>

 

 



