---
description: в этом разделе описано, как реализовать библиотеку DLL для фильтра DirectShow с помощью базовых классов DirectShow.
ms.assetid: d47980d1-6d0c-4b0d-a875-7b072562944a
title: Фабрики классов и шаблоны фабрики
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9b9329a0b8cfd22a316add88664604df190ae96c765359c723aa2302c5b1fa1b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118402224"
---
# <a name="class-factories-and-factory-templates"></a>Фабрики классов и шаблоны фабрики

в этом разделе описано, как реализовать библиотеку DLL для фильтра DirectShow с помощью [базовых классов DirectShow](directshow-base-classes.md).

Прежде чем клиент создаст экземпляр COM-объекта, он создает экземпляр фабрики класса объекта, используя вызов функции [**кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) . Затем клиент вызывает метод **IClassFactory:: CreateInstance** фабрики классов. Это фабрика класса, которая фактически создает компонент и возвращает указатель на запрашиваемый интерфейс. (Функция [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) объединяет эти шаги в вызове функции.)

На следующем рисунке показана последовательность вызовов методов.

![вызовы методов для создания фабрики класса](images/classfactory.png)

[**Кожетклассобжект**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) вызывает функцию [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) , которая определена в библиотеке DLL. Эта функция создает фабрику класса и возвращает указатель на интерфейс в фабрике класса. DirectShow реализует **DllGetClassObject** , но функция зависит от кода особым образом. чтобы понять, как это работает, необходимо понять, как DirectShow реализует фабрики классов.

Фабрика классов — это COM-объект, предназначенный для создания другого COM-объекта. Каждая фабрика классов имеет один тип объекта, который он создает. в DirectShow каждая фабрика классов является экземпляром одного и того же класса C++ **кклассфактори**. Фабрики классов являются специализированными с помощью другого класса, [**кфакторитемплате**](cfactorytemplate.md), также называемого *шаблоном фабрики*. Каждая фабрика классов содержит указатель на шаблон фабрики. Шаблон фабрики содержит сведения о конкретном компоненте, например идентификатор класса компонента (CLSID) и указатель на функцию, которая создает компонент.

Библиотека DLL объявляет глобальный массив шаблонов фабрики, по одному для каждого компонента в библиотеке DLL. Когда [**DllGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-dllgetclassobject) создает новую фабрику классов, она ищет в массиве шаблон с соответствующим идентификатором CLSID. При условии, что он находит один, он создает фабрику класса, содержащую указатель на соответствующий шаблон. Когда клиент вызывает метод **IClassFactory:: CreateInstance**, фабрика класса вызывает функцию создания экземпляра, определенную в шаблоне.

На следующем рисунке показана последовательность вызовов методов.

![шаблоны фабрик классов в библиотеке DLL](images/classfactory2.png)

Преимуществом этой архитектуры является то, что вы можете определить лишь несколько вещей, относящихся к конкретному компоненту, например функцию создания экземпляра, без реализации всей фабрики классов.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[создание библиотеки DLL для фильтра DirectShow](how-to-create-a-dll.md)
</dt> </dl>

 

 
