---
description: Предоставление пользовательского Allocator-Presenter для VMR-7
ms.assetid: 19b43c9b-2578-418f-b03b-af7c7a3a46e4
title: Предоставление пользовательского Allocator-Presenter для VMR-7
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1e79f191401f990214b2551f9210fab4dfe4d43b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104571179"
---
# <a name="supplying-a-custom-allocator-presenter-for-vmr-7"></a>Предоставление пользовательского Allocator-Presenter для VMR-7

Распределитель-выступающий отвечает за выделение поверхностей DirectDraw и показ видеокадров для подготовки к просмотру. В подавляющем большинстве случаев функциональные возможности распределителя по умолчанию будут более чем достаточными для нужд приложения. Но благодаря подключению пользовательского распределителя, приложение может получить прямой доступ к видеороликам и полностью управлять процессом отрисовки. Компромисс для этой повышенной мощности заключается в том, что приложение должно справиться со сложенной сложностью управления поверхностью DirectDraw.

![Использование пользовательского распределителя-выступающего](images/custom-ap.png)

На предыдущем рисунке показаны интерфейсы связи, используемые VMR и распределителя-Presenter. Пользовательский распределитель-выступающий, переопределяющий все функции выделения и представления по умолчанию, должен реализовывать интерфейсы [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) и [**ивмрсурфацеаллокатор**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) и, при необходимости, [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol).

Для замены распределителя по умолчанию приложение вызывает метод [**ивмрсурфацеаллокаторнотифи:: адвисесурфацеаллокатор**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) и передает указатель на новый объект распределителя-Presenter. В ответ на этот вызов VMR будет вызывать метод [**ивмрсурфацеаллокатор:: адвисенотифи**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocator-advisenotify) распределителя-Presenter, чтобы предоставить указатель на интерфейс [**ивмрсурфацеаллокаторнотифи**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocatornotify) VMR. Распределитель-выступающий будет использовать этот указатель интерфейса при передаче событий в VMR с помощью метода [**ивмрсурфацеаллокаторнотифи:: нотифевент**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-notifyevent) .

В качестве альтернативного решения приложение может использовать как собственное средство выделения-выступающего, так и средство распределения по умолчанию. В этом сценарии пользовательский распределитель-выступающий обрабатывает только те вызовы, в которых требуется пользовательская функциональность, и передает остальные вызовы из VMR в интерфейс распределителя-Presenter по умолчанию. Во многих случаях необходимо переопределить только интерфейс [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) .

![использование двух средств выделения-выступающих](images/custom-ap2.png)

Чтобы использовать пользовательский распределитель-объект и средство распределения по умолчанию, приложение сначала вызывает метод [**ивмрсурфацеаллокаторнотифи:: адвисесурфацеаллокатор**](/windows/desktop/api/Strmif/nf-strmif-ivmrsurfaceallocatornotify-advisesurfaceallocator) , чтобы предоставить указатель на новый распределитель-представление. Это приводит к уничтожению распределителя по умолчанию, поэтому приложение должно создать другой экземпляр, вызвав **QueryInterface** на VMR и запрашивая интерфейс [**ивмрсурфацеаллокатор**](/windows/desktop/api/Strmif/nn-strmif-ivmrsurfaceallocator) . Как показано на предыдущем рисунке, пользовательский распределитель-представление переопределяет методы интерфейса [**ивмримажепресентер**](/windows/desktop/api/Strmif/nn-strmif-ivmrimagepresenter) и просто передает все вызовы интерфейса **ивмрсурфацеаллокатор** через реализацию по умолчанию. На рисунке также показан интерфейс [**ивмрвиндовлессконтрол**](/windows/desktop/api/Strmif/nn-strmif-ivmrwindowlesscontrol) , реализованный в распределителе-Presenter.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Предоставление пользовательского Allocator-Presenter для VMR-9](supplying-a-custom-allocator-presenter-for-vmr-9.md)
</dt> <dt>

[Режим воспроизведения VMR (пользовательский распределитель — выступающие)](vmr-renderless-playback-mode--custom-allocator-presenters.md)
</dt> </dl>

 

 



