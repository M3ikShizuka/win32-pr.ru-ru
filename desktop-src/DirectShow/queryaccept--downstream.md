---
description: Куерякцепт (нисходящий)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: Куерякцепт (нисходящий)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87ec5c26209839f0dcd8351cc9a7ca84227faa2289d44d46c2c321fce0429e3f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119747742"
---
# <a name="queryaccept-downstream"></a>Куерякцепт (нисходящий)

Этот механизм позволяет выходному закреплениям предлагать новый формат его нижестоящим одноранговым узлам. Новый формат не должен требовать большего размера буфера. Закрепление вывода выполняет следующие действия:

1.  Вызывает [**Ипин:: куерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) или [**Ипинконнектион::D инамиккуерякцепт**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) на нижестоящий ПИН-коде, чтобы проверить, может ли другой ПИН-код принимать новый тип носителя (см. иллюстрацию, шаг а).
2.  Если возвращенное значение из шага 1 равно S \_ , ПИН-код прикрепляет тип мультимедиа к следующему примеру. Для этого сначала вызывается [**имемаллокатор::-buffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) для получения образца (B). Затем вызывается [**имедиасампле:: сетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) , чтобы присоединить тип мультимедиа к этому примеру (C). Присоединив к образцу тип мультимедиа, фильтр указывает, что формат изменился, начиная с этого примера.
3.  ПИН-код доставляет пример (D).
4.  Когда нисходящий фильтр получает образец, он вызывает [**имедиасампле:: жетмедиатипе**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) для получения нового типа мультимедиа.

    ![куерякцепт (нисходящий)](images/dynformat3.png)

Все ПИН-коды поддерживают `QueryAccept` метод. Однако этот метод немного неоднозначен, поскольку возвращаемое значение S \_ ОК не всегда гарантирует, что вы можете изменить формат, пока граф активен. Некоторые фильтры могут вернуть \_ значение S ОК, но отклонить изменение, если граф активен. Метод **динамиккуерякцепт** , поддерживаемый некоторыми входными ПИН-кодом, явно определяет S \_ как, что означает, что ПИН может изменять форматы в активном состоянии. Если входной ПИН-код поддерживает интерфейс **ипинконнектион** , следует вызвать **динамиккуерякцепт** , а не `QueryAccept` .

В большинстве случаев этот механизм не допускает радикальных изменений в формате, например при изменении глубины битов. Ситуация, когда ее можно использовать, заключается в том, что видеодекодер переключает палитры. Основные сведения о формате остаются неизменными, такие как размеры изображения и битовая глубина, но новый тип мультимедиа имеет другой набор записей палитры.

**Примечание о реализации**

в DirectShow базовых классах [**кбасепин:: куерякцепт**](cbasepin-queryaccept.md) вызывает метод **чеккмедиатипе** , который также вызывается во время первоначального подключения пин-кода. В случае фильтра преобразования метод **чеккмедиатипе** входного контакта всегда должен проверять, подключен ли выходной ПИН-код, и если да, то является ли тип входного носителя совместимым с выходным типом носителя. Поэтому эта реализация, скорее всего, будет действительна для `QueryAccept` . В противном случае необходимо переопределить, `QueryAccept` чтобы выполнить дополнительные проверки, которые необходимы. Кроме того, обратите внимание, что класс [**ктрансформфилтер**](ctransformfilter.md) инкапсулирует эту логику в методы **чеккинпуттипе** и **чекктрансформ** . Класс [**ктрансинплацефилтер**](ctransinplacefilter.md) , с другой стороны, всегда вызывает `QueryAccept` следующий вышестоящий или нисходящий фильтр.

Метод [**кбасеинпутпин:: Receive**](cbaseinputpin-receive.md) проверяет тип носителя во входящем примере, и, если таковой имеется, вызывает **чеккмедиатипе**. Однако он не обновляет элемент **m \_** , закрепление которого содержит текущий тип носителя. Когда фильтр обрабатывает пример, следует проверить пример для типа мультимедиа. Если имеется новый тип, возможно, потребуется сохранить его, вызвав **сетмедиатипе** на вашем ПИН-коде или задав значение **m \_ MT** напрямую. С другой стороны, класс [**квидеотрансформфилтер**](cvideotransformfilter.md) , предназначенный для фильтров преобразования видео, сохраняет тип мультимедиа при его изменении. дополнительные сведения см. в исходном коде для [**квидеотрансформфилтер:: Receive**](cvideotransformfilter-receive.md) в библиотеке базовых классов DirectShow.

В некоторых случаях можно просто передать `QueryAccept` вызов, а затем присоединить тип мультимедиа к образцу вывода и позволить нисходящим фильтрам изменять формат.

 

 



