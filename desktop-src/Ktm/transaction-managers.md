---
description: Диспетчер транзакций (TM) является экземпляром журнала. В KTM объекты TM определяют журнал и некоторые функции TM. Обычно на определенном узле доступно множество объектов TM. Диспетчеры ресурсов (RMs) должны быть связаны с конкретным TM.
ms.assetid: 8d43977a-84cf-4109-b7db-f9c94a226c5d
title: Диспетчеры транзакций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 313215816642201c75ae5f0facae3bf98799c8d1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673598"
---
# <a name="transaction-managers"></a>Диспетчеры транзакций

Диспетчер транзакций (TM) является экземпляром журнала. В KTM объекты TM определяют журнал и некоторые функции TM. Обычно на определенном узле доступно множество объектов TM. Диспетчеры ресурсов (RMs) должны быть связаны с конкретным TM. Существует три типа TMs:

-   Временный TM-журнал, в котором нет журнала.
-   Обычный TM, который имеет журнал и используется для координации транзакций одного или нескольких RMs.
-   Старший диспетчер транзакций.

## <a name="volatile-transaction-managers"></a>Временные диспетчеры транзакций

Энергонезависимая TM — это диспетчер операций с правами только для чтения или для временного RMs. Он не имеет журнала и не сохраняет состояние транзакций при перезапуске системы.

## <a name="transaction-managers"></a>Диспетчеры транзакций

В TMs имеется журнал, один или более устойчивый или временный RMs или оба. Диспетчер транзакций будет сохранять состояние транзакции по перезапуску системы до завершения транзакций. Используется Предполагаемая модель прекращения, поэтому выполняется откат транзакций, которые были активны, но не были подготовлены при завершении работы объекта TM. При первом запуске TM необходимо восстановить TM, вызвав функцию [**рековертрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager) .

## <a name="superior-transaction-managers"></a>Старшие диспетчеры транзакций

Старший TM — TM для других TMs. Он координирует транзакции. Он также выдает **\_ уведомление о \_ подготовке транзакций** к диспетчеру транзакций ядра (KTM). Примером старший TM является Microsoft координатор распределенных транзакций (DTC). Эта возможность связана с дополнительными обязанностями времени восстановления. Во время восстановления RM должен сначала вызвать функцию [**опененлистмент**](/windows/desktop/api/Ktmw32/nf-ktmw32-openenlistment) , чтобы повторно открыть зачисление. Он также должен доставлять (или повторно доставлять) результат транзакции, если транзакция была зафиксирована. можно допустить результат, вызвав либо функцию [**CommitTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction) , либо функцию [**RollbackTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransaction) . Это обязательство не заканчивается до тех пор, пока не будет получено событие уведомления о завершении **\_ \_ фиксации \_** или **\_ \_ отката \_ транзакции** уведомление о завершении транзакции. Если диспетчеру TM не удается выполнить эти операции во время восстановления, то KTM очистит все транзакции, которые не получали результаты в конце фазы восстановления. Однако это может привести к несовместимости результатов транзакций.

## <a name="transaction-manager-functions"></a>Функции диспетчера транзакций

С диспетчерами транзакций используются следующие функции.



| Функция                                                                            | Описание                                                                                    |
|-------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| [**креатетрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-createtransactionmanager)                        | Создает новый объект диспетчера транзакций (TM) и возвращает маркер с указанным доступом.  |
| [**жеткуррентклокктрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-getcurrentclocktransactionmanager) | Получает значение виртуального часов из диспетчера транзакций.                                      |
| [**жеттрансактионманажерид**](/windows/desktop/api/Ktmw32/nf-ktmw32-gettransactionmanagerid)                          | Получает идентификатор для указанного диспетчера транзакций.                                   |
| [**опентрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-opentransactionmanager)                            | Открывает существующий диспетчер транзакций.                                                         |
| [**рековертрансактионманажер**](/windows/desktop/api/Ktmw32/nf-ktmw32-recovertransactionmanager)                      | Восстанавливает состояние диспетчера транзакций из файла журнала.                                      |
| [**роллфорвардтрансактионманажер**](/windows/desktop/api/KtmW32/nf-ktmw32-rollforwardtransactionmanager)              | Восстанавливает состояние диспетчера транзакций из файла журнала до указанного значения виртуального часов. |



 

 

 



