---
description: Транзакция — это объект, определяющий логическую единицу работы.
ms.assetid: 29661a58-ada9-4b7c-8d85-ab65b824c7cd
title: Транзакции (диспетчер транзакций ядра)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 471d2ece52d510c1a77baa59ee3af980c4e4630a17d0911fdcbe590bad78903f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119913885"
---
# <a name="transactions"></a>Transactions

Транзакция — это объект, определяющий логическую единицу работы. Транзакция выполняется до тех пор, пока существует обработчик, ссылающийся на эту транзакцию, и считается активным, если транзакция еще не была зафиксирована или не была выполнена ее откат. Если транзакция создана и все ее дескрипторы были закрыты до выполнения фиксации или отката, то будет выполнен откат транзакции.

Рассмотрим случай транзакционного клиента пользовательского режима, который создает транзакцию для определения области ее операций, а затем выполняет обновления в одном или нескольких диспетчерах ресурсов. Происходят следующие события.

1.  Клиент вызывает функцию [**CreateTransaction**](/windows/desktop/api/KtmW32/nf-ktmw32-createtransaction) для создания транзакции и получает в качестве возвращаемого значения маркер этой транзакции.

    Транзакция может быть открыта или унаследована любым количеством процессов. Поэтому каждый процесс участвует в транзакции. Сбой любого из этих процессов приведет к прерыванию транзакции.

    Эта транзакция еще не может быть постоянной. Только транзакции, которые достигли подготовленного состояния, должны быть восстановлены между сбоями системы, если в транзакции используется ведение журнала с предполагаемым преобразованием.

2.  Клиент должен явно передать транзакцию в Resource Manager.
3.  Клиент выполняет все свои транзакционные операции с одним или несколькими службами RMs, такими как транзакционные файловые системы.
4.  Клиент вызывает функцию [**CommitTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction) .
5.  Диспетчер ресурсов получает уведомления от KTM для подготовки и фиксации своих данных.

## <a name="transactions-and-threads"></a>Транзакции и потоки

Транзакции не совпадают с потоками. Несколько потоков или процессов могут быть частью одной транзакции. И наоборот, поток может быть частью нескольких разных транзакций в разное время.

## <a name="transaction-functions"></a>Функции транзакций

В транзакциях используются следующие функции.



| Функция                                                            | Описание                                                                                   |
|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| [**CommitTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransaction)                      | Запрашивает фиксацию указанной транзакции.                                         |
| [**коммиттрансактионасинк**](/windows/desktop/api/Ktmw32/nf-ktmw32-committransactionasync)            | Запрашивает фиксацию указанной транзакции.                                         |
| [**CreateTransaction**](/windows/desktop/api/KtmW32/nf-ktmw32-createtransaction)                      | Создает новый объект Transaction.                                                             |
| [**жеттрансактионинформатион**](/windows/desktop/api/Ktmw32/nf-ktmw32-gettransactioninformation) | Возвращает запрошенные сведения об указанной транзакции.                            |
| [**опентрансактион**](/windows/desktop/api/Ktmw32/nf-ktmw32-opentransaction)                          | Открывает существующую транзакцию.                                                                |
| [**RollbackTransaction**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransaction)                  | Запросы, для которых была произведена откат указанной транзакции.                                       |
| [**роллбакктрансактионасинк**](/windows/desktop/api/Ktmw32/nf-ktmw32-rollbacktransactionasync)        | Запросы, для которых была произведена откат указанной транзакции. Эта функция возвращает асинхронно. |
| [**сеттрансактионинформатион**](/windows/desktop/api/Ktmw32/nf-ktmw32-settransactioninformation)      | Задает сведения о транзакции для указанной транзакции.                               |



 

 

 



