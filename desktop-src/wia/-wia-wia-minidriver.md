---
description: Приложения видят устройства для получения изображений Windows (WIA) в виде иерархического дерева объектов Ивиаитем или IWiaItem2 с корневым элементом, представляющим само устройство.
ms.assetid: ae4ded93-09be-4caa-ad6e-1a9071fdb4b6
title: WIA Минидривер
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5aadaf55cfe2e8102d4e0e02cf9787b9696e327
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541906"
---
# <a name="wia-minidriver"></a>WIA Минидривер

Приложения видят устройства для получения изображений Windows (WIA) в виде иерархического дерева объектов [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) с корневым элементом, представляющим само устройство. Устройства WIA могут использоваться одновременно несколькими приложениями. Поэтому необходимо, чтобы представление каждого приложения объекта **ивиаитем** или **IWiaItem2** было независимым от представлений другого приложения. Это достигается за счет наличия двух различных объектов Item. Драйвер создает дерево элементов драйвера для объектов [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) , также называемых элементами драйвера, с помощью методов служб драйвера WIA. Это глобальные объекты, используемые драйвером для представления внутренних элементов каждого драйвера. Когда приложение создает объект **ивиаитем** или **IWiaItem2** (также называемый элементом приложения), этот объект связывается с соответствующим [интерфейсом ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) драйвера в дереве элементов драйвера. Счетчик ссылок сохраняется в объекте [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) в соответствии со следующими правилами:

-   Когда драйвер добавляет объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) в дерево элементов драйвера, счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) увеличивается. Обычно это происходит во время [ивиаминидрв::D рвинитиализевиа](https://msdn.microsoft.com/library/ms794097.aspx) или при \_ \_ обработке команды WIA cmd SYNCHRONIZE.
-   Когда драйвер удаляет объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) из дерева элементов драйвера, счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) уменьшается, а объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) помечается таким образом, что он не может снова получить доступ к устройству. Обычно это происходит при отключении устройства или удалении элемента. Приложения по-прежнему могут считывать свойства из объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) , даже если соответствующий объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) был удален из дерева элементов драйвера.
-   При создании объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) он связывается с соответствующим объектом [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) . Счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) увеличивается.
-   При освобождении объекта [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) ссылка на соответствующий ему объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) является серьезной, а счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) уменьшается.
-   Если счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) становится равным нулю, объект [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) удаляется. Это относится ко всем объектам [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) , включая корневой элемент. Счетчик ссылок объекта [интерфейса ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) становится равным нулю, только если элементы приложения ссылаются на него и больше не связаны с деревом элементов драйвера.

Используя эту схему подсчета ссылок, многие объекты [**ивиаитем**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiaitem) или [**IWiaItem2**](-wia-iwiaitem2.md) могут ссылаться на один [интерфейс ивиадрвитем](https://msdn.microsoft.com/library/ms793976.aspx) без помех. Так как каждый **ивиаитем** или **IWiaItem2** содержит собственное хранилище свойств, приложение может продолжить чтение свойств элемента даже после удаления элемента, но никаких операций, требующих доступа к устройству, будет успешно. Так как свойства элемента хранятся в объекте **ивиаитем** или **IWiaItem2** , драйвер должен задать свойства объекта **ивиаитем** или **IWiaItem2** для устройства перед передачей данных.

 

 



