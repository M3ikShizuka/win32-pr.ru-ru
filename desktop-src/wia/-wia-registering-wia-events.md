---
description: 'Приложения могут регистрироваться для получения уведомлений о событиях аппаратного устройства получения образа Windows (WIA) путем вызова одного из следующих методов интерфейса Ивиадевмгр или IWiaDevMgr2: Ивиадевмгр:: Регистеревенткаллбаккклсид или IWiaDevMgr2:: Регистеревенткаллбаккклсидивиадевмгр:: RegisterEventCallbackInterface или IWiaDevMgr2:: RegisterEventCallbackInterfaceIWiaDevMgr:: RegisterEventCallbackProgram или IWiaDevMgr2:: RegisterEventCallbackProgram'
ms.assetid: 0c142083-835f-4bbd-ab32-eb6130f99c59
title: Регистрация событий WIA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa9fc36540a64211428579bc13b84902490ea103
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991151"
---
# <a name="registering-wia-events"></a>Регистрация событий WIA

Приложения могут регистрироваться для получения уведомлений о событиях аппаратного устройства получения образа Windows (WIA) путем вызова одного из следующих методов интерфейса [**ивиадевмгр**](/windows/desktop/api/wia_xp/nn-wia_xp-iwiadevmgr) или [**IWiaDevMgr2**](-wia-iwiadevmgr2.md) :

-   [**Ивиадевмгр:: регистеревенткаллбаккклсид**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackclsid) или [ **IWiaDevMgr2:: регистеревенткаллбаккклсид**](-wia-iwiadevmgr2-registereventcallbackclsid.md)
-   [**Ивиадевмгр:: регистеревенткаллбаккинтерфаце**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackinterface) или [ **IWiaDevMgr2:: регистеревенткаллбаккинтерфаце**](-wia-iwiadevmgr2-registereventcallbackinterface.md)
-   [**Ивиадевмгр:: регистеревенткаллбаккпрограм**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiadevmgr-registereventcallbackprogram) или [ **IWiaDevMgr2:: регистеревенткаллбаккпрограм**](-wia-iwiadevmgr2-registereventcallbackprogram.md)

Все эти методы принимают параметры, указывающие событие и устройство, для которого приложение должно получать уведомления. Приложения регистрируются для получения события для всех устройств WIA путем передачи значения **null** для параметра, указывающего устройство.

Метод **регистеревенткаллбаккинтерфаце** регистрирует приложение для получения события аппаратного устройства WIA, если приложение выполняется в момент возникновения события. При возникновении события, для которого регистрируется приложение, WIA вызывает метод [**ивиаевенткаллбакк:: имажеевенткаллбакк**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) предоставленного приложением объекта для передачи сведений о событии.

Метод **регистеревенткаллбаккклсид** регистрирует приложение, которое является зарегистрированным компонентом модели компонентов компонента (com) для получения события аппаратного устройства WIA, даже если приложение не работает. В дополнение к параметрам, упомянутым выше, этот метод принимает параметр *пклсид*, указывающий идентификатор класса приложения. Когда происходит указанное событие, система WIA использует функцию [CoCreateInstance](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) и идентификатор класса, указанный параметром *пклсид* , для создания нового экземпляра приложения и вызывает метод [**ивиаевенткаллбакк:: имажеевенткаллбакк**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaeventcallback-imageeventcallback) этого приложения для передачи сведений о событии.

Метод **регистеревенткаллбаккпрограм** регистрирует приложение для получения события аппаратного устройства WIA, даже если приложение не выполняется при возникновении этого события. Приложение не обязательно должно быть зарегистрированным COM-компонентом. WIA запускает приложение с помощью инструкции командной строки. **Регистеревенткаллбаккпрограм** принимает параметр *бстркоммандлине*, который указывает полный путь и имя файла исполняемого приложения. **Регистеревенткаллбаккпрограм** существует для обеспечения обратной совместимости с приложениями, которые не были написаны для WIA, и следует избегать. Вместо этого используйте **регистеревенткаллбаккинтерфаце** или **регистеревенткаллбаккклсид** .

Чтобы определить, какие обработчики зарегистрированы для событий на конкретном устройстве WIA, приложение вызывает метод [**ивиаитем:: енумрегистеревентинфо**](/windows/desktop/api/wia_xp/nf-wia_xp-iwiaitem-enumregistereventinfo) или [**IWiaItem2:: енумрегистеревентинфо**](-wia-iwiaitem2-enumregistereventinfo.md) корневого элемента. Этот метод создает объект перечисления для сведений о регистрации. Затем приложение может использовать интерфейс [**Caps иенумвиа \_ dev \_**](/windows/desktop/api/wia_xp/nn-wia_xp-ienumwia_dev_caps) этого объекта для перечисления сведений о обработчиках, зарегистрированных для получения событий для этого устройства.

Если происходит событие, для которого запущенное приложение регистрируется через **регистеревенткаллбаккинтерфаце** и либо **Регистеревенткаллбаккклсид** , либо **регистеревенткаллбаккпрограм**, WIA уведомляет запущенное приложение и не пытается запустить новый экземпляр приложения, так как регистрация событий через **RegisterEventCallbackInterface** имеет приоритет над **RegisterEventCallbackCLSID** и **RegisterEventCallbackProgram**.

> [!Note]  
> В многопоточном приложении нет никакой гарантии, что поток, возвращаемый обратным вызовом уведомлений о событиях, будет в том же потоке, который зарегистрировал обратный вызов.

 

 

 
