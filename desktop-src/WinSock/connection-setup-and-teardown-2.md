---
description: Функция Всаакцепт позволяет приложению получать сведения о вызывающем объекте, такие как идентификатор вызывающего объекта и качество обслуживания, прежде чем принимать решение о принятии входящего запроса на подключение.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Установка и уничтожение подключений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127462482"
---
# <a name="connection-setup-and-teardown"></a>Установка и уничтожение подключений

Функция [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) позволяет приложению получать сведения о вызывающем объекте, такие как идентификатор вызывающего объекта и качество обслуживания, прежде чем принимать решение о принятии входящего запроса на подключение. Это делается с помощью обратного вызова к функции условия, предоставляемой приложением.

Данные пользователя на пользователя, указанные параметрами в функции [**всаконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) и функцией Condition объекта [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) , можно передать на одноранговый узел во время установки соединения, если эта функция поддерживается поставщиком услуг.

Кроме того, можно (для протоколов, поддерживающих эту возможность) обмениваться данными пользователей между конечными точками во время уничтожения соединения. Конец, инициирующий уничтожение, может вызвать функцию [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) , чтобы указать, что больше данных не нужно отправлять и инициировать последовательность разрывов соединения. Для некоторых протоколов часть демонтажа — это доставка данных об отключении от инициатора уничтожения. После получения уведомления о том, что удаленное окончание инициировало уничтожение (как правило, с помощью \_ указания по закрытию демона), функцию [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) можно вызвать для получения данных об отключении, если они есть.

Чтобы продемонстрировать, как можно использовать данные об отключении, рассмотрим следующий сценарий. Клиентская часть приложения клиента/сервера отвечает за завершение подключения к сокету. КоинЦидент с завершением работы, он предоставляет (с помощью отключения данных) общее число транзакций, обработанных сервером. Сервер, в свою очередь, отвечает совокупному объему транзакций, обработанных всеми клиентами. Последовательность вызовов и указаний может быть следующей:

| На стороне клиента                                                                                                              | На сервере                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| (1) вызовите [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) , чтобы завершить сеанс и указать общую сумму транзакции.            |                                                                                                                                                                                                                               |
|                                                                                                                          | (2) получите демо-фильтра \_ , [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) с возвращаемым нулевым значением или [Всаедискон](windows-sockets-error-codes-2.md) ошибку возврата из [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) , что означает, что выполняется корректное завершение работы. |
|                                                                                                                          | (3) вызовите [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) , чтобы получить общую сумму транзакции клиента.                                                                                                                                |
|                                                                                                                          | (4) вычисление совокупного общего итога по всем транзакциям.                                                                                                                                                                       |
|                                                                                                                          | (5) чтобы передать общий итог, вызовите [**всасенддисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) .                                                                                                                                          |
| (6) получить сведения о закрытии для демо-фильтра \_ .                                                                                        | (5a) вызовите [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).                                                                                                                                                                             |
| (7) вызовите [**всареквдисконнект**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) для получения и хранения совокупного общего итога транзакций. |                                                                                                                                                                                                                               |
| (8) вызов [ **функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)                                                                          |                                                                                                                                                                                                                               |



 

Обратите внимание, что шаг (5a) должен следовать за шагом (5), но не имеет отношения времени к шагу (6), (7) или (8).

 

 



