---
description: Структура ВСАКУЕРИСЕТ используется для формирования запросов функции Нсплукупсервицебегин и используется для доставки результатов запроса функции Нсплукупсервиценекст.
ms.assetid: 017b5828-bc6e-42b7-aba7-21648b2dd707
title: Query-Related структур данных в SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: abcbd83ab427a6ec3f09c67f416fe5eb8d7ebaad165bf4e687dfd31dce882cda
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119569373"
---
# <a name="query-related-data-structures-in-the-spi"></a>Query-Related структур данных в SPI

Структура [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) используется для формирования запросов к [**нсплукупсервицебегин**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin)и используется для доставки результатов запроса [**нсплукупсервиценекст**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext). Это сложная структура, так как она содержит указатели на несколько других структур, некоторые из которых ссылаются еще на другие структуры. Связь между **всакуерисет** и структурами, на которые она ссылается, показана ниже.

![структуры всакуерисет](images/ovrvw3-2.png)

В структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) большинство участников говорят сами за себя, но некоторые из них заслуживают дополнительных пояснений. **Двсизе** будет заполняться с помощью sizeof ( **всакуерисет**) и может использоваться поставщиками пространств имен для обнаружения и адаптации к различным версиям структуры **всакуерисет** , которые могут появиться.

Элемент **дваутпутфлагс** используется поставщиком пространства имен для предоставления дополнительных данных о результатах запроса. Дополнительные сведения см. в разделе [**нсплукупсервиценекст**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).

Структура [**всаекомпаратор**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) , на которую ссылается **лпверсион** , используется как для ограничения запроса, так и для результатов. Для запросов элемент **двверсион** указывает требуемую версию службы. Элемент **ечов** является перечислимым типом, который указывает, как будет выполняться сравнение. Возможные варианты: COMP \_ Equals, для которых требуется точное совпадение в версии, или Comp \_ нотлесс, указывающий, что номер версии службы не должен быть меньше значения **двверсион**.

Интерпретация **двнамеспаце** и **лпнспровидерид** зависит от того, как используется структура и описывается далее в отдельных описаниях функций, использующих эту структуру.

Элемент **лпсзконтекст** применяется к иерархическим пространствам имен и задает начальную точку запроса или расположение в иерархии, где находится служба. Общие правила

-   Значение **null**, пустое ("") запустит Поиск в контексте по умолчанию.
-   Значение " \\ " запускает поиск в верхней части пространства имен.
-   Любое другое значение начинает поиск с указанной точки.

Поставщики, не поддерживающие включение, могут возвращать ошибку, если указано любое значение, отличное от "" или " \\ ". Поставщики, поддерживающие ограниченное включение, например группы, должны принимать "", " \\ " или определенную точку. Контексты зависят от пространства имен. Если **двнамеспаце** имеет значение NS \_ , то в качестве контекста следует передавать только "" или " \\ ", так как они распознаются всеми пространствами имен.

Элемент **лпсзкуеристринг** используется для предоставления дополнительных сведений о запросе, относящихся к пространству имен, таких как строка, описывающая известное имя службы и транспортного протокола, например "FTP/TCP".

Структура [**афпротоколс**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) , на которую ссылается **лпафппротоколс** , используется только в целях запроса и предоставляет список протоколов для ограничения запроса. Эти протоколы представляются в виде пар (семейств адресов, протоколов), поскольку значения протокола имеют только значение в контексте семейства адресов.

Массив структуры [**\_ сведений о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) , на который ссылается **лпксабуффер** , содержит все сведения, необходимые для использования службой при установлении прослушивания, или клиент, используемый для установления соединения со службой. Члены **локаладдр** и **ремотеаддр** непосредственно содержат структуру [**\_ адресов сокетов**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) . Служба создает сокет с помощью кортежа (Локаладдр. Лпсоккаддр->\_ семейства SA, исоккеттипе, ипротокол). Он привязывает сокет к локальному адресу с помощью Локаладдр. Лпсоккаддр и Локаладдр. Лпсоккаддрленгс. Клиент создает сокет с кортежем (Ремотеаддр. Лпсоккаддр->\_ семейства SA, исоккеттипе, ипротокол) и использует сочетание ремотеаддр. лпсоккаддр и ремотеаддр. лпсоккаддрленгс при создании удаленного подключения.

 

 
