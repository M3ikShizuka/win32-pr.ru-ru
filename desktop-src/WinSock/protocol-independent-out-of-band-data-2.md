---
description: Абстракция сокета потока включает понятие данных внешнего контроллера управления.
ms.assetid: 1a517885-2688-421f-9389-2d329e5c3d56
title: Protocol-Independent нестандартных данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a929f4273d9cc9f268a296b711649406622ca9b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104343472"
---
# <a name="protocol-independent-out-of-band-data"></a>Protocol-Independent нестандартных данных

Абстракция сокета потока включает понятие данных внешнего контроллера управления. Многие протоколы позволяют каким бы то ни было особым образом помечать части входящих данных как особые, и эти специальные блоки данных могут доставляться пользователю из обычной последовательности. К примерам относятся срочные данные в X. 25 и другие протоколы OSI и срочные данные в использовании протокола TCP в среде BSD UNIX. В следующем разделе описывается обработка данных OOB независимо от протокола. Обсуждение данных OOB, реализованных с помощью срочных данных TCP, следует за независимым от протокола описанием. В каждом обсуждении использование [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) также подразумевает [**реквфром**](/windows/desktop/api/winsock/nf-winsock-recvfrom), [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv)и [**всареквфром**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom), а ссылки на [**всаасинкселект**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) также применяются к [**всаевентселект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect).

## <a name="protocol-independent-oob-data"></a>Независимые от протокола данные OOB

Данные OOB — это логически независимый канал передачи, связанный с каждой парой подключенных сокетов потоков. Данные OOB могут быть переданы пользователю независимо от обычных данных. Абстракция определяет, что средства данных OOB должны поддерживать надежную доставку по крайней мере одного блока данных OOB за раз. Этот блок данных может содержать по крайней мере один байт данных, и хотя бы один блок данных OOB может быть отложенной доставкой пользователя в любой момент времени. Для протоколов связи, поддерживающих последовательное получение сигналов (например, TCP, когда срочные данные поступают последовательно с обычными данными), система обычно извлекает данные OOB из потока обычных данных и сохраняет их отдельно (в потоке данных в обычном режиме остается разрыв). Это позволяет пользователям выбирать между получением данных OOB по порядку и их получением из последовательности без необходимости буферизации всех промежуточных данных. Можно просматривать данные, не являющиеся внешними (OOB).

Пользователь может определить, ожидают ли какие-либо данные OOB для чтения с помощью функции [**иоктлсоккет**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket) или [**всаиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl) с **сиокатмарк** IOCTL. Для протоколов, в которых понятна концепция положения блока данных OOB в обычных потоках данных, например TCP, поставщик службы Windows Sockets поддерживает концептуальный маркер, указывающий позицию последнего байта данных OOB в потоке обычных данных. Это необязательно для реализации функций **иоктлсоккет** или **всаиоктл** , поддерживающих **сиокатмарк**. Присутствие или отсутствие данных OOB является обязательным.

Для протоколов, где концепция положения блока данных OOB в обычном потоке данных имеет смысл, приложение может обрабатывать нестандартные данные встроенным образом как часть обычного потока данных. Это достигается путем установки параметра Socket для \_ убинлине с функцией [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) . Для других протоколов, в которых блоки данных OOB действительно не зависят от обычного потока данных, попытка установить таким образом \_ убинлине приведет к ошибке. Приложение может использовать функцию [**иоктлсоккет**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket) или [**всаиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl) с **сиокатмарк** ioctl, чтобы определить, есть ли непрочтенные данные OOB перед меткой. Например, эта информация может использоваться для повторной синхронизации с одноранговым узлом, гарантируя, что все данные в потоке данных отбрасываются при необходимости.

WITH \_ убинлине Disabled (значение по умолчанию):

-   Сокеты Windows уведомляют приложение о \_ событии OOB, если приложение, зарегистрированное для уведомления с [**всаасинкселект**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect), точно так же, как и \_ прочитанное, используется для уведомления о присутствии обычных данных. Это значит, что демон \_ OOB публикуется, когда данные OOB поступают без ранее поставленных в очередь данных OOB. \_При считывании данных с помощью \_ флага OOB, а некоторые данные OOB остаются в очереди после возвращения операции чтения. Сообщения ДЕМОна \_ чтения не размещаются для данных OOB.
-   Сокеты Windows возвращаются из [**SELECT**](/windows/desktop/api/Winsock2/nf-winsock2-select) с соответствующим набором сокетов *ексцептфдс* , если данные OOB поставлены в очередь на сокете.
-   Приложение может вызвать метод [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) с сообщением \_ OOB для чтения блока срочных данных в любое время. Блок данных OOB переходит в очередь.
-   Приложение может вызвать метод [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) без сообщения \_ OOB для чтения потока обычных данных. Блок данных OOB не отображается в потоке данных с обычными данными. Если данные OOB остаются после вызова метода **recv**, сокеты Windows уведомляют приложение с помощью демона \_ OOB или WITH *ексцептфдс* при использовании инструкции [**SELECT**](/windows/desktop/api/Winsock2/nf-winsock2-select).
-   Для протоколов, в которых данные OOB имеют позицию в потоке обычных данных, одна операция [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) не охватывает эту позицию. Одна инструкция **recv** возвращает обычные данные перед меткой, **а вторая —** для начала чтения данных после метки.

При \_ включенном убинлине:

-   \_Сообщения OOB не размещаются для данных OOB. Данные OOB обрабатываются как обычные для функций [**SELECT**](/windows/desktop/api/Winsock2/nf-winsock2-select) и [**всаасинкселект**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) и указываются путем установки сокета в *реадфдс* или отправки сообщения демо- \_ чтения, соответственно.
-   Приложение не может вызвать [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) с \_ флагом сообщения OOB, установленным для чтения блока данных OOB. Возвращается код ошибки ВСАЕИНВАЛ.
-   Приложение может вызвать метод [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) без \_ установленного флага сообщения OOB. Все данные OOB доставляются в правильном порядке в потоке обычных данных. Данные OOB никогда не смешиваются с обычными данными. Для получения данных OOB необходимо три запроса на чтение. Первый возвращает обычные данные до блока данных OOB, второй возвращает данные OOB, третий — обычные данные, следующие за данными OOB. Иными словами, границы блоков данных OOB сохраняются.

Подпрограммы [**всаасинкселект**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) особенно хорошо подходят для обработки уведомлений о присутствии нестандартных данных, когда \_ убинлине выключен.

## <a name="oob-data-in-tcp"></a>Данные OOB в TCP

> [!IMPORTANT]
> Следующее обсуждение нестандартных данных (OOB), реализованных с помощью срочных данных TCP, соответствует модели, используемой в распространении программного обеспечения Berkeley. Пользователи и разработчики должны иметь в виду следующее:

 

-   В настоящее время существует две конфликтующие интерпретации [RFC 793](https://www.ietf.org/rfc/rfc793.txt) (где представлена концепция).
-   Реализация данных OOB в программе Berkeley Software Distribution (BSD) не соответствует требованиям к узлу, указанным в [RFC 1122](https://www.ietf.org/rfc/rfc1122.txt).

    В частности, срочный указатель TCP в BSD указывает на байт после байта срочных данных и срочный указатель TCP, совместимый с RFC, указывает на байт срочных данных. В результате, если приложение отправляет срочные данные из реализации, совместимой с BSD, в реализацию, совместимую с RFC 1122, получатель считывает неправильный байт срочных данных (он считывает байт, расположенный после правильного байта в потоке данных в качестве срочного байта данных).

    Чтобы избежать проблем взаимодействия, разработчикам приложений рекомендуется не использовать данные OOB, если это не требуется для взаимодействия с существующей службой. Поставщики сокетов Windows — это законодателей для документирования семантики OOB (BSD или RFC 1122), реализуемой их продуктом.

Получение сегмента TCP с установленным флагом УРГ (для срочной) указывает на существование одного байта данных OOB в потоке данных TCP. Блок данных OOB имеет размер один байт. Срочный указатель — это положительное смещение от текущего порядкового номера в заголовке TCP, которое указывает расположение блока данных OOB (неоднозначно, как указано выше). Поэтому он может указывать на данные, которые еще не были получены.

Если \_ убинлине отключен (по умолчанию), то при получении сегмента TCP, содержащего байт, на который указывает срочный указатель, блок данных OOB (один байт) удаляется из потока данных и перемещается в буфер. Если последующий сегмент TCP поступает с установленным флагом срочности (и новым срочным указателем), байт OOB, находящиеся в очереди, может быть потерян, так как он заменяется новым блоком данных OOB (как происходит при распространении программного обеспечения). Однако он никогда не заменяется в потоке данных.

Если \_ убинлине включен, срочные данные остаются в потоке данных. В результате блок данных OOB никогда не будет потерян при поступлении нового сегмента TCP, содержащего срочные данные. Существующая метка данных OOB обновляется до новой должности.

> [!Note]  
> Если \_ установлен параметр убинлине Socket, то СИОКАТМАРК ioctl всегда возвращает **значение true**, а данные OOB возвращаются пользователю в виде обычных данных.

 

 

 



