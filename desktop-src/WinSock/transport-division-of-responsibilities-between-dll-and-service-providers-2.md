---
description: В этом разделе приводятся общие сведения о делении ответственности между Ws2 \_32.dll и поставщиками транспортной службы.
ms.assetid: e1ea1e99-a2bc-4e76-91f6-e388c39dfbbb
title: Распределение обязанностей между библиотекой DLL и поставщиками услуг
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 33c256cb03bcc9e3f8746db5196c21fc2de0a8b157304a205587b275acc0bbb3
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119733224"
---
# <a name="transport-division-of-responsibilities-between-dll-and-service-providers"></a>Распределение обязанностей между библиотекой DLL и поставщиками услуг

В этом разделе приводятся общие сведения о делении ответственности между Ws2 \_32.dll и поставщиками транспортной службы.

## <a name="ws2_32dll-functionality-for-transport"></a>\_Функции32.dll Ws2 для транспорта

Основная задача транспортной части Ws2 \_32.dll — служить диспетчером трафика между поставщиками услуг и приложениями. При наличии нескольких разных поставщиков служб, взаимодействующих с одним и тем же приложением, каждый поставщик служб взаимодействует строго с \_32.dll Ws2. Библиотека DLL принимает следующие меры.

-   Выбор подходящего поставщика услуг для создания сокетов на основе описания протокола.
-   Пересылка вызовов процедур приложений, включающих сокет, к соответствующему поставщику услуг, который создал или управляет этим сокетом. Поставщики услуг не знают, что происходит любое из этих ситуаций.

Им не нужно беспокоиться о взаимодействии друг с другом или даже о существовании других поставщиков услуг. Путем абстракции поставщиков служб в согласованный интерфейс DLL и выполнения этой функции автоматической маршрутизации трафика Ws2 \_32.dll позволяет приложениям взаимодействовать с различными поставщиками, не требуя от приложений подсчета подразделений между поставщиками, где установлены разные поставщики.

Ws2 \_32.dll полагается на параметры функций создания сокетов API ( [**Socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) и [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)), чтобы определить, какой поставщик услуг использовать. Выбранный поставщик транспортной службы будет вызываться с помощью функции [**вспсоккет**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) . В случае функции **сокета** Ws2 \_32.dll находит первую запись в наборе структур [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , соответствующих значениям в кортеже, сформированном параметрами (*семейство адресов*, *тип сокета*, *протокол*). Чтобы сохранить обратную совместимость, Ws2 \_32.dll считает нулевое значение для *семейства адресов* или *типа сокета* как значение с подстановочным знаком. Нулевое значение для протокола не считается подстановочным значением32.dll Ws2, \_ если такое поведение не указано для конкретного протокола, так как в \_ \_ \_ структуре **\_ сведений всапротокол** установлен флаг PFL, соответствующий протоколу 0.

Для функции [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , если для *лппротоколинфо* задано значение null, поведение будет точно так же, как было описано для [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket). Однако если [**ссылка \_ на структуру всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) указана, то Ws2 \_32.dll не выполняет ни одной функции сопоставления, но немедленно передает запрос на создание сокета поставщику службы транспорта, связанному с указанной структурой **\_ сведений о всапротокол** . Значения для кортежей (*семейство адресов,* *тип сокета,*) предоставляются поставщиком услуг в функции [**вспсоккет**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) . Поставщики услуг можно игнорировать или обратить внимание на значения параметров (*семейство адресов,* *тип сокета,*), так как это уместно, но они не должны указывать на ошибку, если значение *семейства адресов* или *типа сокета* равно нулю. Кроме того, поставщики услуг не должны указывать на ошибку, если константа манифеста \_ из \_ сведений о протоколе содержится в любом из параметров (*семейство адресов,* *тип сокета,*). Это значение просто указывает, что приложение должно использовать значения, находящиеся в соответствующих параметрах структуры **всапротокол \_ info** : (**иаддрессфамили**, **исоккеттипе**, **ипротокол**).

В рамках создания сокета поставщик услуг информирует Ws2 \_32.dll о взаимосвязи между собой и новым сокетом с помощью параметров, передаваемых [**Впукреатесоккесандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) или [**впумодифифшандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle). Ws2 \_32.dll отслеживает эту связь между дескрипторами сокетов и конкретными поставщиками услуг. При вызове функции интерфейса приложения, ссылающейся на маркер сокета, Ws2 \_32.dll ищет ассоциацию и вызывает соответствующую функцию интерфейса поставщика услуг соответствующего поставщика услуг.

Помимо основной службы маршрутизации трафика Ws2 \_32.dll предоставляет ряд других служб, таких как перечисление протоколов, управление дескрипторами сокетов (выделение, освобождение и сопоставление значений контекста) для поставщиков служб, не использующих системные системы, Блокировка управления обработчиками для каждого потока, служебные программы для обмена байтами, очередь вызовов асинхронных процедур (APC) для упрощения вызова подподпрограмм завершения ввода-вывода и согласования версий между приложениями и \_32.dll Ws2, а также между Ws2 \_32.dll и поставщиками служб.

## <a name="transport-service-provider-functionality"></a>Функциональные возможности поставщика услуг транспорта

Поставщики услуг реализуют фактический транспортный протокол, который включает такие функции, как Настройка подключений, передача данных, применение управления потоком, Управление ошибками и т. д.32.dll Ws2 \_ не имеет сведений о том, как реализуются запросы к поставщикам услуг; это относится к реализации поставщика услуг. Реализация таких функций может сильно отличаться от одного поставщика к другому. Поставщики услуг скрывают сведения, относящиеся к реализации, о том, как выполняются сетевые операции.

Поставщики транспортной службы можно разделить на две категории: те, у которых дескрипторы сокетов являются реальными дескрипторами файловой системы (и которые в дальнейшем называются поставщиками устанавливаемой файловой системы (IFS); остальные называются поставщиками, не являющимися файлами IFS. Ws2 \_32.dll всегда передает дескриптор сокета поставщика транспортного приложения в Windowsное приложение, поэтому приложения могут использовать преимущества дескрипторов сокетов, которые обрабатываются в файловой системе, если это так.

Итоги. поставщики служб реализуют низкоуровневые сетевые протоколы. Ws2 \_32.dll обеспечивает управление трафиком на среднем уровне, которое позволяет подключать эти транспортные протоколы к приложениям. Приложения, в свою очередь, предоставляют политику того, как потоки трафика и операции, связанные с сетью, используются для выполнения нужных пользователю функций.

 

 
