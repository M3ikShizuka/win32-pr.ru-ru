---
description: Позволяет приложению включать или отключать возврат сведений о пакетах функцией Всареквмсг на сокете IPv6.
ms.assetid: 7BF17538-BE92-44FE-BA3C-6B44F61D478A
title: Параметр IPV6_PKTINFO Socket (Ws2ipdef. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 5afd5b19cbaba7f6a66f5ba6fbd85d74eb2f2e3f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692283"
---
# <a name="ipv6_pktinfo-socket-option"></a>\_Параметр сокета ПКТИНФО IPv6

\_Параметр сокета ПКТИНФО IPv6 позволяет приложению включать или отключать возврат сведений о пакетах функцией [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) на сокете IPv6.

Чтобы запросить состояние этого параметра сокета, вызовите функцию [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) . Чтобы установить этот параметр, вызовите функцию [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) со следующими параметрами.

## <a name="socket-option-value"></a>Значение параметра сокета

Константа, представляющая этот параметр сокета, составляет 19.

## <a name="syntax"></a>Синтаксис


```C++
int getsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) IPPROTO_IPV6,   // level
  (int) IPV6_PKTINFO, // optname
  (char *) optval, // output buffer,
  (int) optlen,  // size of output buffer
);
```




```C++
int setsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) IPPROTO_IPV6,   // level
  (int) IPV6_PKTINFO, // optname
  (char *) optval, // input buffer,
  (int) optlen,  // size of input buffer
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*s* \[ в\]
</dt> <dd>

Дескриптор, идентифицирующий сокет.

</dd> <dt>

*уровень* \[ окне\]
</dt> <dd>

Уровень, на котором определен параметр. Для этой операции используйте **\_ IPv6 иппрото** .

</dd> <dt>

*optname* \[ окне\]
</dt> <dd>

Параметр сокета, для которого необходимо получить или задать значение. \_Для этой операции используйте ПКТИНФО IPv6.

</dd> <dt>

*оптвал* \[ заполняет\]
</dt> <dd>

Указатель на буфер, содержащий значение для устанавливаемого параметра. Этот параметр должен указывать на буфер, который больше или равен размеру значения **DWORD** .

Это значение рассматривается как логическое значение с 0, которое указывает **false** (отключено), и ненулевое значение, указывающее на значение **true** (включено).

</dd> <dt>

*оптлен* \[ в, out\]
</dt> <dd>

Указатель на размер (в байтах) буфера *оптвал* . Этот размер должен быть больше или равен размеру значения **DWORD** .

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если операция завершается успешно, функция [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) или [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) возвращает ноль.

Если операция завершается неудачно, возвращается значение ошибки СОКЕТа \_ и можно получить конкретный код ошибки, вызвав [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).



| Код ошибки                                                                                                                                              | Значение                                                                                                                                                                                                                                                    |
|---------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>**[WSANOTINITIALISED](windows-sockets-error-codes-2.md)**</dt> </dl> | Перед использованием этой функции должен быть выполнен успешный вызов [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) .<br/>                                                                                                                                                     |
| <dl> <dt>**[WSAENETDOWN](windows-sockets-error-codes-2.md)**</dt> </dl>             | Сбой сетевой подсистемы.<br/>                                                                                                                                                                                                               |
| <dl> <dt>**[WSAEFAULT](windows-sockets-error-codes-2.md)**</dt> </dl>                 | Один из параметров *оптвал* или *оптлен* указывает на память, которая не находится в допустимой части адресного пространства пользователя. Эта ошибка также возвращается, если значение, на которое указывает параметр *оптлен* , меньше, чем размер значения **DWORD** .<br/> |
| <dl> <dt>**[всаеинпрогресс](windows-sockets-error-codes-2.md)**</dt> </dl>       | Выполняется блокировка вызова Windows Sockets 1,1, или поставщик услуг все еще обрабатывает функцию обратного вызова.<br/>                                                                                                                            |
| <dl> <dt>**[всаеинвал](windows-sockets-error-codes-2.md)**</dt> </dl>                 | Указан недопустимый аргумент. Эта ошибка возвращается, если параметр *уровня* неизвестен или недопустим. В Windows Vista и более поздних версиях эта ошибка также возвращается, если сокет находился в переходном состоянии.<br/>                                     |
| <dl> <dt>**[всаенопротупт](windows-sockets-error-codes-2.md)**</dt> </dl>       | Параметр неизвестен или не поддерживается указанным семейством протоколов. Эта ошибка возвращается, если параметр *типа* для дескриптора сокета, переданного в параметре *s* , не **Сокк \_ дграм** или **Сокк \_ RAW**. <br/>                          |
| <dl> <dt>**[всаенотсокк](windows-sockets-error-codes-2.md)**</dt> </dl>             | Дескриптор не является сокетом.<br/>                                                                                                                                                                                                                 |



 

## <a name="remarks"></a>Комментарии

Функция [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) , вызываемая с \_ параметром сокета IPv6 пктинфо, позволяет приложению определить, должны ли сведения о пакете возвращаться функцией [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg)для сокета IPv6.

Функция [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) , вызываемая с \_ параметром сокета IPv6 пктинфо, позволяет приложению включать или отключать возврат сведений о пакетах функцией [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) . Параметр IPV6 \_ пктинфо для сокета по умолчанию отключен (имеет значение **false**).

Если этот параметр сокета включен на сокете IPv6 типа **Сокк \_ Дграм** или **сокк \_ RAW**, функция [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) возвращает сведения о пакете в структуре [**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) , на которую указывает параметр *лпмсг* . Один из объектов данных элемента управления в возвращенной структуре **всамсг** будет содержать структуру [**in6 \_ пктинфо**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in6_pktinfo) , используемую для хранения полученных сведений об адресе пакета.

Для датаграмм, полученных функцией [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) по протоколу IPv6, элемент **управления** в полученной [**структуре всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) будет содержать структуру [**всабуф**](/windows/desktop/api/ws2def/ns-ws2def-wsabuf) , содержащую структуру **всакмсгхдр** . Элемент **\_ уровня КМСГ** этой структуры **всакмсгхдр** будет содержать **иппрото \_ IPv6**, член **\_ типа КМСГ** этой структуры будет содержать **IPv6 \_ пктинфо**, а элемент **\_ данных КМСГ** будет содержать структуру [**in6 \_ пктинфо**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in6_pktinfo) , используемую для хранения полученных сведений об адресе IPv6-пакета. IPv6-адрес в структуре **in6 \_ пктинфо** — это IPv6-адрес, с которого получен пакет.

Для сокета датаграмм с двумя стеками, если приложению требуется функция [**LPFN_WSARECVMSG (всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg) , возвращающая сведения о пакете в структуре [**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg) для датаграмм, полученных по протоколу IPv4, то параметр сокета [IP \_ пктинфо](ip-pktinfo.md) должен быть установлен в значение true на сокете. Если только параметр IPV6 \_ пктинфо имеет значение true для сокета, сведения о пакете будут предоставлены для датаграмм, полученных по протоколу IPv6, но могут не предоставляться для датаграмм, полученных по протоколу IPv4.

Обратите внимание, что заголовочный файл *Ws2ipdef. h* автоматически включается в *Ws2tcpip. h* и никогда не должен использоваться напрямую.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|------------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Только для \[ классических приложений Windows XP\]<br/>                                                                |
| Минимальная версия сервера<br/> | \[Только для настольных приложений Windows Server 2003\]<br/>                                                       |
| Header<br/>                   | <dl> <dt>Ws2ipdef. h (включение Ws2tcpip. h)</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Сокеты с двумя стеками](dual-stack-sockets.md)
</dt> <dt>

[**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[**in6 \_ пктинфо**](/windows/desktop/api/Ws2ipdef/ns-ws2ipdef-in6_pktinfo)
</dt> <dt>

[IP- \_ пктинфо](ip-pktinfo.md)
</dt> <dt>

[**\_Параметры сокета иппрото IPv6**](ipproto-ipv6-socket-options.md)
</dt> <dt>

[**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt)
</dt> <dt>

[**фиксатор**](/windows/desktop/api/Winsock2/nf-winsock2-socket)
</dt> <dt>

[**всамсг**](/windows/desktop/api/Ws2def/ns-ws2def-wsamsg)
</dt> <dt>

[**LPFN_WSARECVMSG (Всареквмсг)**](/windows/win32/api/mswsock/nc-mswsock-lpfn_wsarecvmsg)
</dt> </dl>

 

 
