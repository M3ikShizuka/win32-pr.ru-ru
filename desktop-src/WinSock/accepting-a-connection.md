---
description: После того как сокет прослушивает соединение, программа должна выполнять запросы на подключение к этому сокету.
ms.assetid: d01f3d90-4d83-442e-aada-e7b082ef7699
title: Принятие подключения (сокеты Windows 2)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 03e066b53c22dd9964ad44dc8d67c15969641362
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105650536"
---
# <a name="accepting-a-connection-windows-sockets-2"></a>Принятие подключения (сокеты Windows 2)

После того как сокет прослушивает соединение, программа должна выполнять запросы на подключение к этому сокету.

**Принятие подключения на сокете**

1.  Создайте временный объект **Socket** с именем клиентсоккет для приема соединений от клиентов.
    ```C++
    
    SOCKET ClientSocket;

    
    ```

    

2.  Обычно серверное приложение предназначено для прослушивания подключений от нескольких клиентов. Для высокопроизводительных серверов несколько потоков обычно используются для управления несколькими клиентскими подключениями.

    Существует несколько различных методов программирования, использующих Winsock, которые можно использовать для прослушивания нескольких клиентских подключений. Одним из методов программирования является создание непрерывного цикла, который проверяет наличие запросов на подключение с помощью функции [**Listen**](/windows/desktop/api/Winsock2/nf-winsock2-listen) (см. раздел [прослушивание на сокете](listening-on-a-socket.md)). Если происходит запрос на соединение, приложение вызывает функцию [**Accept**](/windows/desktop/api/Winsock2/nf-winsock2-accept), [**акцептекс**](/windows/win32/api/mswsock/nf-mswsock-acceptex)или [**всаакцепт**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) и передает работу другому потоку для обработки запроса. Возможно несколько других приемов программирования.

    Обратите внимание, что этот простой пример очень прост и не использует несколько потоков. Пример также просто прослушивает и принимает только одно соединение.

    ```C++
    
    ClientSocket = INVALID_SOCKET;

    // Accept a client socket
    ClientSocket = accept(ListenSocket, NULL, NULL);
    if (ClientSocket == INVALID_SOCKET) {
        printf("accept failed: %d\n", WSAGetLastError());
        closesocket(ListenSocket);
        WSACleanup();
        return 1;
    }
     
    
    ```

    

3.  Когда клиентское соединение принято, серверное приложение обычно передает принятый клиентский сокет (переменную Клиентсоккет в приведенном выше примере кода) в рабочий поток или порт завершения ввода-вывода и продолжает принимать дополнительные соединения. В этом базовом примере сервер переходит к следующему шагу.

    Существует ряд других методов программирования, которые можно использовать для прослушивания и принятия нескольких подключений. Они включают использование функций [**SELECT**](/windows/desktop/api/Winsock2/nf-winsock2-select) или [**всаполл**](/windows/win32/api/winsock2/nf-winsock2-wsapoll) . Примеры некоторых из этих методов программирования показаны в [расширенных примерах Winsock](getting-started-with-winsock.md) , входящих в состав пакета средств разработки программного обеспечения (SDK) для Microsoft Windows.

    > [!Note]  
    > В системах Unix общий метод программирования для серверов был для того, чтобы приложение было прослушивать подключения. Когда соединение было принято, родительский процесс вызовет функцию **ветвления** для создания нового дочернего процесса для обработки клиентского соединения, наследуя сокет от родительского. Этот метод программирования не поддерживается в Windows, так как функция **ветвления** не поддерживается. Эта методика обычно не подходит для высокопроизводительных серверов, так как ресурсы, необходимые для создания нового процесса, гораздо больше, чем те, которые необходимы для потока.

     

Следующий шаг: [Получение и отправка данных на сервере](receiving-and-sending-data-on-the-server.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[начало работы с помощью Winsock](getting-started-with-winsock.md)
</dt> <dt>

[Серверное приложение Winsock](winsock-server-application.md)
</dt> <dt>

[Прослушивание на сокете](listening-on-a-socket.md)
</dt> </dl>

 

 
