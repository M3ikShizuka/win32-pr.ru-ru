---
description: Управление трассировкой Winsock
ms.assetid: b079bdfc-b192-451c-967d-dcefa94b7ec7
title: Управление трассировкой Winsock
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 75f256c4e3927672bc13b14bfb72ca3b02c22bde
ms.sourcegitcommit: 95685061d5b0333bbf9e6ebd208dde8190f97005
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2021
ms.locfileid: "108110552"
---
# <a name="control-of-winsock-tracing"></a>Управление трассировкой Winsock

Трассировку Winsock можно контролировать с помощью любого из следующих методов.

-   Программы командной строки

    В Windows Vista и Windows Server 2008 включены два средства командной строки, которые используются для управления трассировкой и преобразования двоичного файла журнала трассировки в читаемый текст.

    Средство **logman.exe** используется для запуска или завершения трассировки Winsock.

    Средство **tracerpt.exe** используется для преобразования двоичного файла журнала трассировки в читаемый текстовый файл.

-   Средство просмотра событий

    Просмотр событий в Windows Vista и более поздних версиях также можно использовать для включения трассировки Winsock. Просмотр событий доступен в меню "Пуск" в разделе "Администрирование".

## <a name="using-logman-and-tracert"></a>Использование программы Logman и tracert

По умолчанию в Windows Vista и более поздних версиях трассировка событий сети Winsock отключена.

Следующая команда запускает трассировку событий сети Winsock на компьютере, устанавливает имя сеанса трассировки событий в мивинсокксессион и отправляет выходные данные в двоичный файл журнала с именем винсокклогфиле. ETL:

**Logman Start-ETS мивинсокксессион-o винсокклогфиле. ETL-p Microsoft-Windows-Winsock-АФД**

Файлы журнала создаются в текущем каталоге с именами файлов в формате винсокклогфиле \_ 000001. ETL.

Следующая команда останавливает приведенную выше трассировку Winsock на компьютере для сеанса с именем мивинсокксессион:

**Logman-ETS мивинсокксессион**

Двоичный файл журнала будет записан в расположение, указанное параметром – o. Чтобы преобразовать двоичный файл в читаемый текстовый файл, используется **tracerpt.exe** :

**tracerpt.exe <имя ETL-файла> – o winsocktracelog.txt**

Если предпочтительным является выходной файл, содержащий XML, а не обычный текст, используется следующая команда:

**tracerpt.exe <имя ETL-файла> – o winsocktracelog.xml – of XML.**

Трассировка изменений каталога Winsock включена по умолчанию в Windows Vista и более поздних версиях.

> [!Note]  
> Многоуровневые поставщики служб являются устаревшими. Начиная с Windows 8 и Windows Server 2012, используйте [платформу фильтрации Windows](../fwp/windows-filtering-platform-start-page.md).

 

Следующая команда запускает трассировку изменений каталога Winsock для многоуровневых поставщиков служб (LSP) на компьютере, устанавливает имя сеанса трассировки событий в мивинсокккаталогсессион и отправляет выходные данные в двоичный файл журнала с именем винсокккаталоглогфиле. ETL:

**Logman Start-ETS мивинсокккаталогсессион-o винсокккаталоглогфиле. ETL-p Microsoft-Windows-Winsock-WS2HELP**

Файлы журнала создаются в текущем каталоге с именами файлов в формате винсокккаталоглогфиле \_ 000001. ETL.

Следующая команда останавливает приведенную выше трассировку Winsock на компьютере для сеанса с именем MySession:

**Logman-ETS мивинсокккаталогсессион**

Двоичный файл журнала будет записан в расположение, указанное параметром – o. Чтобы преобразовать двоичный файл в читаемый текстовый файл, используется **tracerpt.exe** :

**tracerpt.exe <имя ETL-файла> – o winsockcatalogtracelog.txt**

Если предпочтительным является выходной файл, содержащий XML, а не обычный текст, используется следующая команда:

**tracerpt.exe <имя ETL-файла> – o winsockcatalogtracelog.xml – of XML.**

## <a name="using-event-viewer-to-start-winsock-network-event-tracing"></a>Использование Просмотр событий для запуска трассировки событий сети Winsock

При открытии Просмотр событий в левой области содержится список событий. Откройте **журналы приложений и служб** и перейдите к **\\ \\ сетевому событию Microsoft Windows Winsock** в качестве источника и выберите пункт **Операционная**.

В области Действие выберите **Свойства журнала** и установите флажок **включить ведение журнала** . После включения ведения журнала можно также изменить размер файла журнала, если это необходимо.

Теперь трассировка событий сети Winsock включена, и все, что нужно сделать, — это действие Обновить, чтобы обновить список событий, которые были занесены в журнал. Чтобы прерывать ведение журнала, просто снимите флажок в том же переключателе.

Может потребоваться увеличить размер журнала в зависимости от количества событий, которые вы хотите просмотреть. Недостаток использования Просмотр событий для трассировки Winsock заключается в том, что он не загружает все строковые ресурсы, поэтому сообщения, отображаемые в поле Описание (после выбора события), иногда трудно читать (например, аргумент, который должен быть отформатирован как шестнадцатеричный, будет отображаться в десятичном формате). Однако можно выбрать вкладку **сведения** в описании события, которая показывает необработанную запись в журнале XML, которая обычно упрощает понимание аргументов.

## <a name="using-event-viewer-to-start-winsock-catalog-change-tracing"></a>Использование Просмотр событий для запуска трассировки изменений каталога Winsock

При открытии Просмотр событий в левой области содержится список событий. Откройте **журналы приложений и служб** и перейдите в раздел **Microsoft \\ Windows \\ Winsock Каталог изменение** в качестве источника и выберите **Операционная**.

В области Действие выберите **Свойства журнала** и установите флажок **включить ведение журнала** . После включения ведения журнала можно также изменить размер файла журнала, если это необходимо.

Трассировка изменений каталога Winsock теперь включена, и все, что нужно сделать, — это действие Обновить, чтобы обновить список событий, которые были занесены в журнал. Чтобы прерывать ведение журнала, просто снимите флажок в том же переключателе.

Может потребоваться увеличить размер журнала в зависимости от количества событий, которые вы хотите просмотреть. Недостаток использования Просмотр событий для трассировки Winsock заключается в том, что он не загружает все строковые ресурсы, поэтому сообщения, отображаемые в поле Описание (после выбора события), иногда трудно читать (например, аргумент, который должен быть отформатирован как шестнадцатеричный, будет отображаться в десятичном формате). Однако можно выбрать вкладку **сведения** в описании события, которая показывает необработанную запись в журнале XML, которая обычно упрощает понимание аргументов.

## <a name="interpreting-winsock-tracing-logs"></a>Анализ журналов трассировки Winsock

Все события трассировки Winsock в журнале содержат два типа данных:

-   Система
-   EventData

Сведения о системе содержат уровень ведения журнала, время создания записи журнала, идентификатор события, представляющий тип события, идентификатор процесса выполнения, идентификатор потока выполнения и другие сведения о системе. Уровень журнала 4 в трассировке Winsock представляет ведение журнала информационных событий. Уровень журнала 5 в трассировке Winsock представляет подробное ведение журнала событий.

Идентификатор процесса выполнения и идентификатор потока в сведениях о системе указывают процесс и поток, которые выполнялись при возникновении события. Во многих случаях это будет представлять ядро, Рабочий поток и процесс, а не поток пользовательского режима и процесс приложения. Это поле обычно не очень полезно.

Каждый тип события трассировки Winsock имеет уникальный идентификатор события в системном разделе записанных данных. Эти идентификаторы событий можно легко использовать для фильтрации файла журнала для конкретных событий трассировки Winsock.

В процессе EVENTDATA содержатся сведения, относящиеся к типу события.

Параметр Process в сведениях о EVENTDATA представляет собой адрес структуры ядра ЕПРОЦЕСС для процесса, а не для фактического PID. Чтобы сопоставить событие с ИДЕНТИФИКАТОРом пользовательского режима, Возьмите значение процесса из любой записи журнала и просмотрите его ранее в журнале для события создания сокета со значением Process. После обнаружения совпадения последний параметр в данных события создания сокета — это идентификатор процесса пользовательского режима, создавший сокет.

Параметр Address в сведениях о EVENTDATA возвращается в некоторых событиях трассировки Winsock. Параметр Address представляет IP-адрес, но он отображается в текстовом файле, созданном средством **tracerpt.exe** или в Просмотр событий как необработанные байты или числа. Адреса IPv6 отображаются в шестнадцатеричном виде, поэтому их легче понять. IPv4-адреса отображаются в виде большого десятичного числа. Разработчикам потребуется вручную преобразовать необработанные байты IPv4-адреса в более знакомую нотацию с точками в формате IPv4, чтобы лучше интерпретировать это значение.

Параметр ошибки в EVENTDATA возвращается в некоторых событиях трассировки Winsock. Параметр ошибки имеет вид кода ошибки NTSTATUS или HRESULT. Этот параметр ошибки отображается в текстовом файле, созданном средством **tracerpt.exe** , или в Просмотр событий в виде десятичного числа. Разработчикам придется вручную преобразовать десятичное число в шестнадцатеричное число, чтобы лучше интерпретировать код ошибки в некоторых случаях.

## <a name="related-topics"></a>Связанные разделы

<dl> <dt>

[Трассировка Winsock](winsock-tracing.md)
</dt> <dt>

[Сведения о трассировке изменений каталога Winsock](winsock-layered-service-provider-tracing-event-details.md)
</dt> <dt>

[Сведения о трассировке событий сети Winsock](winsock-tracing-event-details.md)
</dt> <dt>

[Уровни трассировки Winsock](winsock-tracing-levels.md)
</dt> </dl>

 

 
