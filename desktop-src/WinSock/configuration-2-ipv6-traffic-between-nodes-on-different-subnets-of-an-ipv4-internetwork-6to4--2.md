---
description: 6to4 — это метод подключения узлов или сайтов IPv6 через существующую интернет-инфраструктуру IPv4.
ms.assetid: 3ca8518d-42f0-428c-b94c-ff244d17b314
title: 'Конфигурация 2: трафик IPv6 между узлами в разных подсетях объединенной сети IPv4 (6to4)'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e1abd5477005e6a1e71c13aaf19a734e9191097d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104497466"
---
# <a name="configuration-2-ipv6-traffic-between-nodes-on-different-subnets-of-an-ipv4-internetwork-6to4"></a>Конфигурация 2: трафик IPv6 между узлами в разных подсетях объединенной сети IPv4 (6to4)

6to4 — это метод подключения узлов или сайтов IPv6 через существующую интернет-инфраструктуру IPv4. Он использует уникальный префикс адреса для предоставления изолированным сайтам IPv6 собственного адресного пространства IPv6. 6to4 похож на "псевдо-ISP", предоставляя возможность подключения по протоколу IPv6. Вы можете использовать 6to4 для прямого взаимодействия с другими сайтами 6to4. 6to4 не требует использования маршрутизаторов IPv6 и трафика IPv6, инкапсулированного в заголовок IPv4.

На следующем рисунке показана конфигурация двух узлов в отдельных подсетях с помощью 6to4 для взаимодействия через маршрутизатор IPv4.

![узлы, использующие 6to4 для взаимодействия через маршрутизатор IPv4.](images/v6mig-2.png)

Основным требованием для использования 6to4 является один глобально маршрутизируемый IPv4-адрес для сайта. Предположим, что ваш сайт состоит из коллекции компьютеров IPv6, которыми вы управляете (в некоторых системах используется протокол IPv6 Microsoft и некоторые другие реализации IPv6). Предположим также, что все компьютеры IPv6 подключены напрямую с использованием Ethernet или 6-over-4. Глобальный маршрутизируемый IPv4-адрес должен быть назначен одному из компьютеров, на которых установлен протокол IPv6. Этот компьютер будет шлюзом 6to4.

Если у вас есть адрес IPv4, который является частью частного адресного пространства (10.0.0.0/8, 172.16.0.0/12 или 192.168.0.0/16) или адресного пространства автоматического частного IP-адреса (APIPA) 169.254.0.0/16, используемого Windows 2000, он не поддерживает глобальную маршрутизацию. В противном случае он, вероятно, является общедоступным IP-адресом и поддерживает глобальную маршрутизацию. См. раздел [Отладка конфигурации 6to4](#debugging-6to4-configuration) в этом документе для получения дополнительной помощи в определении того, поддерживает ли подключение к поставщику услуг Интернета 6to4.

## <a name="the-6to4cfgexe-tool"></a>Средство 6to4cfg.exe

Средство 6to4cfg.exe автоматизирует конфигурацию 6to4, автоматически обнаруживает IPv4-адрес глобальной маршрутизации и создает префикс 6to4. Он либо выполняет настройку напрямую, либо может написать скрипт конфигурации, который можно проверить и запустить позже.

Ниже приведен синтаксис команды Basic 6to4cfg.exe.

``` syntax
6to4cfg [-r] [-s] [-u] [-R relay] [-b] [-S address] [filename]
```

<dl> <dt>

<span id="_filename_"></span><span id="_FILENAME_"></span>\[*файлов*\]
</dt> <dd>

Записывает скрипт конфигурации в файл, если указать имя файла. В скрипте конфигурации используется Ipv6.exe.

Можно указать Con в качестве имени файла для записи скрипта конфигурации в выходные данные консоли, что полезно для просмотра 6to4cfg.exe, выполняемых в тестовом сценарии.

Если имя файла не указано, 6to4cfg.exe напрямую обновляет конфигурацию IPv6 на компьютере.

</dd> <dt>

<span id="-r"></span><span id="-R"></span>-r
</dt> <dd>

Станет маршрутизатором шлюза 6to4 для вашей локальной сети, что обеспечивает маршрутизацию всех интерфейсов и назначенных префиксов подсети.

</dd> <dt>

<span id="-s"></span><span id="-S"></span>-s
</dt> <dd>

Включает адрес локальной адресации сайта на сайте 6to4. Эта команда полезна только при использовании совместно с параметром-r.

</dd> <dt>

<span id="-u"></span><span id="-U"></span>-u
</dt> <dd>

Указывает, что конфигурация 6to4 должна быть отменена. Таким образом, 6to4cfg-u меняет воздействие 6to4cfg и 6to4cfg-r-u на обратный результат 6to4cfg-r и т. д.

</dd> <dt>

<span id="-R_relay"></span><span id="-r_relay"></span><span id="-R_RELAY"></span>-R *Relay*
</dt> <dd>

Указывает имя или IPv4-адрес маршрутизатора ретранслятора 6to4. Имя по умолчанию — 6to4.ipv6.microsoft.com, маршрутизатор ретранслятора 6to4 в Интернете.

</dd> <dt>

<span id="-b"></span><span id="-B"></span>-б
</dt> <dd>

Указывает, что 6to4cfg.exe выбирает "лучший" адрес ретранслятора вместо первого.

</dd> <dt>

<span id="-S_address"></span><span id="-s_address"></span><span id="-S_ADDRESS"></span>-S *адрес*
</dt> <dd>

Задает локальный IPv4-адрес для префикса 6to4.

</dd> </dl>

## <a name="manual-6to4-configuration"></a>Настройка 6to4 вручную

В этом примере адресом шлюза 6to4 является 172.31.42.239. Для использования 6to4 необходим собственный глобально направляемый IPv4-адрес.

> [!Note]  
> IP-адрес 172.31.42.239 используется только в качестве примера. Это частный адрес, который не поддерживает глобальную маршрутизацию в Интернете.

 

32-битный глобально поддерживающий адресацию адрес IPv4 объединяется с 16-разрядным префиксом 2002::/16 для 48 формирования префикса IPv6-адреса для сайта. В этом примере префиксом сайта 6to4 является 2002: ac1f: 2aef::/48. Обратите внимание, что ac1f: 2aef — шестнадцатеричная кодировка 172.31.42.239 (разумеется, вы будете использовать другой префикс, основанный на глобально маршрутизируемой IPv4-адресе). С помощью префикса сайта 6to4 можно назначать адреса и префиксы подсетей внутри сайта.

В этом примере предполагается, что вы используете подсеть 0 для ручной настройки адреса 6to4 на компьютере шлюза 6to4 и используете подсеть 1 для автоматической настройки адресов в сегменте сети Ethernet. Однако возможны и другие варианты.

1.  Используйте Ipv6.exe, чтобы включить 6to4 на компьютере шлюза 6to4:

    **IPv6-рту 2002::/16 2**

    Команда **IPv6 рту** выполняет обновление таблицы маршрутизации. Его можно использовать для добавления, удаления или обновления маршрута. В этом случае он включает 6to4.

    Аргумент 2002::/16 — это префикс маршрута, указывающий уникальный префикс 6to4.

    Аргумент 2 указывает интерфейс по ссылке для этого префикса. Интерфейс \# 2 — это "псевдо-интерфейс", используемый для настроенных туннелей, автоматического туннелирования и 6to4. Если адрес назначения IPv6 соответствует префиксу 2002::/16, то для формирования IPv4-адреса назначения извлекаются биты 32, которые следуют за префиксом в адресе назначения. Пакет инкапсулируется с помощью заголовка IPv4 и отправляется на адрес назначения IPv4.

2.  Настройте адрес 6to4 на компьютере шлюза 6to4:

    **IPv6 аду 2/2002: ac1f: 2aef:: ac1f: 2aef**

    Команда **IPv6 аду** выполняет обновление адреса. Его можно использовать для добавления, удаления или обновления адреса в интерфейсе. В этом экземпляре настраивается адрес 6to4 компьютера.

    Аргумент 2/2002: ac1f: 2aef:: ac1f: 2aef задает как интерфейс, так и адрес. Для этого требуется настроить адрес 2002: ac1f: 2aef:: ac1f: 2aef в интерфейсе \# 2. Адрес создается с помощью префикса сайта 2002: ac1f: 2aef::/48, Subnet 0 — префикс подсети 2002: ac1f: 2aef::/64 и идентификатор 64-разрядного интерфейса. В соглашении показано использование IPv4-адреса компьютера для идентификатора интерфейса, назначенного интерфейсу \# 2. Для использования ac1f: 2aef следует заменить на шестнадцатеричную кодировку собственного глобально направляемого IPv4-адреса.

Две предыдущие команды достаточно для обеспечения взаимодействия с другими сайтами 6to4. Например, можно попробовать проверить связь с сайтом Microsoft 6to4:

**ping6 2002:836b: 9820:: 836b: 9820**

Чтобы обеспечить связь с 6bone, необходимо создать туннель по умолчанию для ретранслятора 6to4. Вы можете использовать маршрутизатор ретранслятора Microsoft 6to4, 131.107.152.32:

**IPv6-рту::/0 2/:: 131.107.152.32 Pub Life 1800**

Команда **IPv6 рту** выполняет обновление таблицы маршрутизации, устанавливая в этом экземпляре маршрут по умолчанию к ретранслятору 6to4.

Аргумент::/0 является префиксом маршрута. Префикс нулевой длины указывает, что это маршрут по умолчанию.

Аргумент 2/:: 131.107.152.32 указывает соседа следующего прыжка для этого префикса. Для этого необходимо перенаправить пакеты, соответствующие префиксу, на адрес:: 131.107.152.32, используя интерфейс \# 2. Пересылка пакета в:: 131.107.152.32 в интерфейсе \# 2 приводит к тому, что он инкапсулируется в заголовок v4 и отправляется в 131.107.152.32.

Аргумент Pub делает этот маршрут опубликованным. Так как это касается только маршрутизаторов, оно не действует, пока не будет включена маршрутизация. Аналогичным образом время жизни в 30 минут соответствует только в том случае, если включена маршрутизация.

Вы можете получить доступ к сайтам 6bone и сайтам 6to4. Чтобы протестировать это, можно использовать следующую команду:

**ping6 3FFE: 1CFF: 0: F5:: 1**

Последним шагом является включение маршрутизации на шлюзе 6to4. В этом примере предполагается, что интерфейс \# 3 на компьютере шлюза является интерфейсом Ethernet, а интерфейс \# 4 — с 6 по 4. Ваш компьютер может по-разному почислить свои интерфейсы. Следующие две команды присваивают префиксы подсети двум ссылкам. Префиксы подсети являются производными от префикса 6to4 сайта 2002: ac1f: 2aef::/48:

**IPv6 рту 2002: ac1f: 2aef: 1::/64 3 Pub Life 1800**

**IPv6 рту 2002: ac1f: 2aef: 2::/64 4 Pub Life 1800**

Команда **IPv6 рту** указывает, что префикс 2002: ac1f: 2aef: 1::/64 — ссылка на интерфейс \# 3. Он настраивает первый префикс подсети в интерфейсе Ethernet. Маршрут публикуется со временем существования 30 минут.

Аналогичным образом, префикс 2002: ac1f: 2aef: 2::/64 настраивается в интерфейсе 6-over-4.

Следующие три команды позволяют компьютеру шлюза 6to4 работать как маршрутизатор:

**IPv6-ИФК 2 форв**

**IPv6 ИФК 3 форв**

**IPv6 ИФК 4 форв**

Команда **IPv6 ИФК** управляет атрибутами интерфейса. Маршрутизатор перенаправляет пакеты и отправляет объявления маршрутизатора. В реализации Microsoft IPv6 эти атрибуты каждого интерфейса управляются отдельно.

Интерфейс \# 2 не требуется для рекламы, так как он является псевдо-интерфейсом.

Если у компьютера есть дополнительные интерфейсы, их также следует настроить для перенаправления и рекламы.

После выполнения этих команд протокол IPv6 Microsoft автоматически настраивает адреса в интерфейсах \# 3 и \# 4 с помощью соответствующих префиксов подсети, и два интерфейса начинают отправлять объявления маршрутизатора примерно через 3 – 10 минут.

Узлы, принимающие эти объявления маршрутизатора, автоматически настраивают маршрут по умолчанию и адрес 6to4, полученный из префикса подсети. Они будут обмениваться данными с другими сайтами 6to4 и 6bone через компьютер шлюза.

## <a name="debugging-6to4-configuration"></a>Отладка конфигурации 6to4

**Отладка конфигурации 6to4**

1.  Проверьте подключение IPv4 к маршрутизатору ретранслятора 6to4:

    **Проверка связи 6to4.ipv6.microsoft.com**

    Если это не удается, значит, у вас нет глобальных подключений к Интернету.

2.  Проверка инкапсуляции IPv6 с помощью автоматического туннелирования:

    **ping6:: 131.107.152.32**

    Если это не удается, возможно, имеется брандмауэр или транслятор сетевых адресов (NAT) между компьютером и Интернетом. В случае успеха подключение к Интернету может поддерживать 6to4.

3.  Проверьте отображение команды IPv6 RT. Вы увидите маршрут 2002::/16-> 2. Проверьте отображение команды IPv6 if 2. Вы увидите предпочтительный адрес с префиксом 2002::/16.

> [!Note]  
> Адрес IPv4 маршрутизатора ретранслятора Microsoft 6to4 для 131.107.152.32 может быть изменен. Если шаг 2 выше не работает, проверьте выходные данные команды ping в шаге 1, чтобы проверить IPv4-адрес маршрутизатора ретранслятора Microsoft 6to4.

 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Рекомендуемые конфигурации для IPv6](recommended-configurations-2.md)
</dt> <dt>

[Одна подсеть с адресами локальной связи](configuration-1-single-subnet-with-link-local-addresses-2.md)
</dt> <dt>

[Использование IPsec между двумя узлами локальной связи](configuration-4-using-ipsec-between-two-local-link-hosts-2.md)
</dt> </dl>

 

 



