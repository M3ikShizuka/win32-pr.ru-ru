---
description: Основы протоколов Всплистен, Вспакцепт и Вспконнект для установления подключения через сокет к сокетам Windows (Winsock).
ms.assetid: b1b4d6b9-36db-4000-9c6b-662765b6d091
title: 'Основные сведения об протоколе: прослушивание, подключение, принятие'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d62ef290d71e571154b4d022c24c7e21f8fffa1c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144977"
---
# <a name="protocol-basics-listen-connect-accept"></a>Основные сведения об протоколе: прослушивание, подключение, принятие

Основные операции, связанные с установлением подключения к сокету, могут быть наиболее подробно описаны в плане клиент-серверной концепции.

На стороне сервера сначала создается сокет, привязывается к хорошо известному локальному адресу (чтобы клиент мог его найти) и переведите сокет в режим прослушивания через [**всплистен**](/previous-versions/windows/hardware/network/ff566297(v=vs.85)), чтобы подготовиться к любому входящему запросу подключения и указать длину очереди невыполненной работы подключения. Поставщики услуг хранят ожидающие запросы на подключение в очереди невыполненной работы до тех пор, пока клиент не закончит работу с сервером или не будет отозван (из-за истечения времени ожидания). Поставщик услуг может без вмешательства пользователя игнорировать запросы на увеличение размера очереди невыполненной работы за пределы заданного поставщиком верхнего предела.

На этом этапе, если используется Блокирующий сокет, серверная часть может немедленно вызвать [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept) , который будет заблокирован, пока запрос на подключение не будет завершен. И наоборот, сервер может также использовать один из описанных выше механизмов сетевых индикаторов событий для упорядочения уведомлений о входящих запросах на подключение. В зависимости от выбранного механизма уведомления поставщик либо выдает сообщение Windows, либо сообщает объекту события о появлении запросов на подключение. См. раздел [уведомление о событиях сети](notification-of-network-events-2.md) , чтобы узнать, как выполнить регистрацию для события «демон по \_ допуску».

На стороне клиента будет создан соответствующий сокет и инициировано подключение путем вызова [**вспконнект**](/previous-versions/windows/hardware/network/ff566275(v=vs.85))с указанием известного адреса сервера. Обычно клиенты не выполняют явную операцию [**привязки**](/windows/desktop/api/winsock/nf-winsock-bind) перед инициализацией соединения, позволяя поставщику служб выполнять неявную привязку от своего имени. Если сокет находится в блокирующем режиме, **вспконнект** будет блокироваться до тех пор, пока сервер не получит запрос на соединение (или пока не истечет время ожидания). В противном случае клиент должен использовать один из описанных выше механизмов сетевого обозначения событий для упорядочения уведомления о новом установленном подключении. В зависимости от выбранного механизма уведомления поставщик будет указывать это либо через сообщение Windows, либо с помощью сигнализации объекта события.

Когда сервер вызывает [**вспакцепт**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspaccept), поставщик услуг вызывает функцию, предоставляемую приложением, используя параметры функции для передачи сведений о сервере из верхней записи в очереди невыполненной работы запроса на подключение. Эти сведения включают в себя адрес узла подключения, любые доступные данные пользователя и любые доступные сведения о QoS. Используя эти сведения, функция условия сервера определяет, следует ли принять запрос, отклонить запрос или отложить принятие решения до последующего. Это решение указывается с помощью возвращаемого значения функции Condition. См. раздел [уведомление о событиях сети](notification-of-network-events-2.md) , чтобы узнать, как выполнить регистрацию для события демона \_ подключения к сети.

Если сервер принимает решение принять запрос, поставщик должен создать новый сокет со всеми теми же атрибутами и регистрациями событий, что и у прослушивающего сокета. Исходный сокет остается в состоянии прослушивания, поэтому могут быть получены последующие запросы на подключение. С помощью выходных параметров функции условия сервер может также предоставлять любые данные пользователя ответа и назначать параметры QoS (при условии, что эти операции поддерживаются поставщиком услуг).

 

 
