---
description: Функция Всадупликатесоккет используется для включения совместного использования сокетов в процессах.
ms.assetid: f7cf40e9-f3a6-4b62-8a78-df25464e2365
title: Общие сокеты
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb6753b01f6389254756254d2ebe196af8e2a8a3
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127168559"
---
# <a name="shared-sockets"></a>Общие сокеты

Функция [**всадупликатесоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) используется для включения совместного использования сокетов в процессах. Исходный процесс вызывает **всадупликатесоккет** , чтобы получить специальную [**структуру \_ сведений о всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) для идентификатора целевого процесса. Он использует некоторый механизм межпроцессного взаимодействия (IPC) для передачи содержимого этой структуры в целевой процесс. Затем целевой процесс использует структуру **\_ сведений всапротокол** в вызове [**вспсоккет**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket). Дескриптор сокета, возвращаемый этой функцией, будет дополнительным дескриптором сокета для базового сокета, который, таким же, становится общим. Сокеты могут совместно использоваться потоками в данном процессе без использования функции **всадупликатесоккет** , поскольку дескриптор сокета допустим во всех потоках процесса.

Два (или более) дескрипторов, которые ссылаются на общий сокет, можно использовать независимо, когда речь идет о вводе-выводе. Однако интерфейс Winsock не реализует какой-либо тип управления доступом, поэтому процессы должны координировать любые операции на общем сокете. Типичный пример совместного использования сокетов — использование одного процесса для создания сокетов и установления соединений. Затем этот процесс передает сокеты другим процессам, ответственным за обмен информацией.

Функция [**всадупликатесоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) создает дескрипторы сокетов, а не базовый сокет. В результате все состояния, связанные с сокетом, хранятся как общие для всех дескрипторов. Например, операция [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) , выполняемая с помощью одного дескриптора, впоследствии отображается с помощью [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) из дескрипторов любого или всех. Процесс может вызвать [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) для повторяющегося сокета, и дескриптор будет освобожден. Однако базовый сокет остается открытым до тех пор, пока не будет вызван **функции closesocket** с последним оставшимся дескриптором.

Уведомления на общих сокетах подчиняются обычным ограничениям функций [**всаасинкселект**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) и [**всаевентселект**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) . При выдаче любого из этих вызовов с помощью любого из общих дескрипторов отменяется любая предыдущая регистрация событий для сокета, независимо от того, какой дескриптор использовался для выполнения этой регистрации. Таким образом, нельзя было бы иметь возможность обрабатывать события «получить ДЕМОна \ \ \_ чтение» и «обработка б» на получение \_ событий записи. В ситуациях, когда требуется такая тесная координация, рекомендуется, чтобы разработчики использовали потоки вместо отдельных процессов.

 

 
