---
description: Базовая версия очень плохо выполняемого приложения в сокетах Windows (Winsock).
ms.assetid: 923884c4-f1bd-4f72-983e-6158f368e0dd
title: 'Базовая версия: очень плохо выполняемое приложение'
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f7c094be5fd5cf6e3b9eaeb07c7ff38880e651dd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702387"
---
# <a name="the-baseline-version-a-very-poor-performing-application"></a>Базовая версия: очень плохо выполняемое приложение

Исходный, неудовлетворительный пример кода, используемый для вычисления обновлений, выглядит следующим образом:

> [!Note]  
> Для простоты в следующих примерах нет обработки ошибок. Любое рабочее приложение всегда проверяет возвращаемые значения.

 

> [!WARNING]
> Первые несколько примеров приложения обеспечивают намеренно низкую производительность, чтобы продемонстрировать улучшения производительности, внесенные в код. Не используйте эти примеры кода в приложении. они предназначены только для иллюстрации.

 


```C++
#include <windows.h>

BOOL Map[ROWS][COLS];

void LifeUpdate()
{
    ComputeNext( Map );
    for( int i = 0 ; i < ROWS ; ++i )     //serialized
        for( int j = 0 ; j < COLS ; ++j )
            Set( i, j, Map[i][j] );    //chatty
}

BYTE Set(row, col, bAlive)
{
    SOCKET s = socket(...);
    BYTE byRet = 0;
    setsockopt( s, SO_SNDBUF, &Zero, sizeof(int) );
    bind( s, ... );
    connect( s, ... );
    send( s, &row, 1 );
    send( s, &col, 1 );
    send( s, &bAlive, 1 );
    recv( s, &byRet, 1 );
    closesocket( s );
    return byRet;
}
```



В этом состоянии приложение имеет наихудшую возможную производительность сети. Ниже перечислены проблемы с этой версией примера приложения.

-   Приложение находится в чате. Каждая транзакция слишком мала — ячейки не нужно обновлять по одной.
-   Транзакции строго сериализуются, несмотря на то, что ячейки могут обновляться параллельно.
-   Буфер отправки имеет нулевое значение, и в приложении возникает задержка 200-миллисекунда для каждой отправки — три раза на ячейку.
-   Приложение очень активно подключается, подключаясь к каждой ячейке один раз. Приложения ограничены числом подключений в секунду для данного назначения из-за состояния ожидания, но это не является проблемой, так как каждая транзакция занимает более 600 миллисекунд.
-   Приложение является файловой системой FAT; Многие транзакции не влияют на состояние сервера, так как многие ячейки не изменяются с обновления на обновление.
-   Приложение имеет низкую потоковую передачу; небольшие отправки потребляют много ресурсов ЦП и ОЗУ.
-   В приложении предполагается, что для отправки используется представление с прямым порядком байтов. Это естественное предположение для текущей платформы Windows, но может быть опасно для долгосрочного кода.

## <a name="key-performance-metrics"></a>Ключевые метрики производительности

Следующие метрики производительности выражаются в времени кругового пути (RTT), Гудпут и служебных издержках. Описание этих терминов см. в разделе [терминология сети](network-terminology-2.md) .

-   Время ячейки, сетевое время для одного обновления ячейки требует 4 \* RTT + 600 мс для взаимодействия Nagle и отложенного подтверждения.
-   Гудпут меньше 6 байт.
-   Дополнительная нагрузка на протокол составляет 99,6%.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Повышение скорости работы приложения](improving-a-slow-application-2.md)
</dt> <dt>

[Терминология сети](network-terminology-2.md)
</dt> <dt>

[Редакция 1. Очистка очевидных](revision-1-cleaning-up-the-obvious-2.md)
</dt> <dt>

[Редакция 2. перепроектирование для уменьшения количества подключений](revision-2-redesigning-for-fewer-connects-2.md)
</dt> <dt>

[Редакция 3: отправка сжатого блока](revision-3-compressed-block-send-2.md)
</dt> <dt>

[Будущие улучшения](future-improvements-2.md)
</dt> </dl>

 

 



