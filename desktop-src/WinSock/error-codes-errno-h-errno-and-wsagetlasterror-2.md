---
description: в приложениях Winsock коды ошибок извлекаются с помощью функции всажетластеррор. для функции Windows GetLastError заменяются соединители Windows.
ms.assetid: cb73fc92-74bd-4c8b-a1c0-6daf4d298aa1
title: Коды ошибок — "ошибка", "h_errno" и "Всажетластеррор"
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b2e9c4372bd479ee4b94bd3226128737dae3d5637be94046eb013716590ac285
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119132637"
---
# <a name="error-codes---errno-h_errno-and-wsagetlasterror"></a>Коды ошибок — код возврата, h \_ и всажетластеррор

в приложениях Winsock коды ошибок извлекаются с помощью функции [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) . для функции Windows [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) заменяются соединители Windows. коды ошибок, возвращаемые сокетами Windows, схожи с константами кода UNIX сокета, но все константы имеют префикс WSA. таким образом, в приложениях Winsock возвращается код ошибки всаеваулдблокк, а в UNIX приложениях возвращается код ошибки еваулдблокк.

коды ошибок, установленные сокетами Windows, не предоставляются *через переменную* "код ошибки". Кроме того, для класса **жетксбии** функций коды ошибок не становятся доступными через переменную *h н. \_* Функция [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) предназначена для обеспечения надежного способа для потока в многопоточном процессе получения сведений об ошибках для каждого потока.

для обеспечения совместимости с Berkeley UNIX (BSD) ранние версии Windows (Windows 95 с обновлением сокета Windows Socket 2 и Windows 98, например) переопределяются регулярные константы bind, обычно находящиеся в обновлении в формате " *н. h* " в BSD, как эквивалентные Windowsные сокеты WSA. Например, ЕКОННРЕФУСЕД был определен как **всаеконнрефусед** в файле заголовка *Winsock. h* . в последующих версиях Windows (Windows NT 3,1 и более поздних версий) эти определения были добавлены в комментарий, чтобы избежать конфликтов с параметрами возврата *. h* , используемыми с Microsoft C/C++ и Visual Studio.

заголовочный файл *Winsock2. h* , входящий в состав пакета средств разработки Microsoft Windows software development kit (sdk), пакета sdk и Visual Studio, по-прежнему содержит блок, задающийся комментарием, в \# блоке ifdef 0 и \# endif, который определяет коды ошибок сокета BSD так же, как и константы WSA. они могут использоваться для обеспечения некоторой совместимости с программированием сокетов UNIX, BSD и Linux. Для совместимости с BSD приложение может изменить параметр *Winsock2. h* и раскомментировать этот блок. Однако разработчикам приложений настоятельно не рекомендуется раскомментировать этот блок, так как из-за неизбежного возникновения конфликтов с ошибкой возврата *. h* в большинстве приложений. кроме того, ошибки сокета BSD определяются как значения, отличные от используемых в программах UNIX, BSD и Linux. Разработчикам приложений настоятельно рекомендуется использовать постоянные ошибки WSA в приложениях сокетов.

Эти определения остаются в комментарии в заголовке *Winsock2. h* в \# блоке ifdef 0 и \# endif. Если разработчик приложения настаивает на использовании кодов ошибок BSD для совместимости, то приложение может включить строку в форму:


```C++
#include <windows.h>

#define errno WSAGetLastError()
```



Это позволяет сетевому коду, написанному для использования глобального кода, правильно работать в *среде с одним* потоком. Есть некоторые очень серьезные недостатки. Если исходный файл включает в себя код, который проверяет, что используется *как для* сокетов, так и для функций, не являющихся сокетами, этот механизм использовать нельзя. Более того, приложению не может быть *присвоено новое значение.* (в Windows сокетах для этой цели может использоваться функция [**всасетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsasetlasterror) .)

Типичный стиль BSD


```C++
r = recv(...);
if (r == -1
    && errno == EWOULDBLOCK)
    {...}
```



Предпочтительный стиль


```C++
r = recv(...);
if (r == -1       /* (but see below) */
    && WSAGetLastError() == EWOULDBLOCK)
    {...}
```



Несмотря на то, что для обеспечения совместимости предоставляются константы ошибок, соответствующие сокетам Berkeley 4,3, приложениям настоятельно рекомендуется использовать определения кодов ошибок WSA. это обусловлено тем, что коды ошибок, возвращаемые определенными Windows сокетами, относятся к стандартному диапазону кодов ошибок, как определено в Microsoft C ©. Таким образом, более эффективной версией предыдущего фрагмента исходного кода является:


```C++
r = recv(...);
if (r == -1       /* (but see below) */
    && WSAGetLastError() == WSAEWOULDBLOCK)
    {...}
```



Исходная спецификация Winsock 1,1, определенная в 1995, рекомендует набор кодов ошибок и список возможных ошибок, которые могут быть возвращены в результате каждой функции. Windows сокеты 2 добавили функции и функции с другими Windows кодами ошибок сокетов, возвращенных в исходной спецификации Winsock. В течение времени были добавлены дополнительные функции для улучшения использования Winsock для разработчиков. например, добавлены новые функции службы имен (например,[**функцию getaddrinfo**](/windows/desktop/api/Ws2tcpip/nf-ws2tcpip-getaddrinfo) и [**жетнамеинфо**](/windows/desktop/api/Ws2tcpip/nf-ws2tcpip-getnameinfo)), поддерживающие IPv6 и IPv4 в Windows XP и более поздних версиях. Некоторые из старых функций службы имен с протоколом IPv4 (например, класс **жетксбии** функций) являются устаревшими.

полный список возможных кодов ошибок, возвращаемых функциями Windows сокетов, приведен в разделе по [кодам ошибок сокетов Windows](windows-sockets-error-codes-2.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Обработка ошибок Winsock](handling-winsock-errors.md)
</dt> <dt>

[Перенос приложений сокета в Winsock](porting-socket-applications-to-winsock.md)
</dt> <dt>

[Windows Коды ошибок сокетов](windows-sockets-error-codes-2.md)
</dt> <dt>

[Вопросы программирования Winsock](winsock-programming-considerations.md)
</dt> </dl>

 

 
