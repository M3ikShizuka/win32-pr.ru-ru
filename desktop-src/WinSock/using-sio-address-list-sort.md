---
description: Запрос IOCTL с помощью \_ списка адресов SIO \_ \_ позволяет разработчикам приложений сортировать список адресов назначения IPv6 и IPv4, чтобы определить лучший доступный адрес для создания подключения. Запрос \_ \_ ioctl списка адресов SIO \_ поддерживается в Windows XP и более поздних версиях.
ms.assetid: bf380ddf-8171-4ef4-be47-94c7a6aabf0a
title: Использование SIO_ADDRESS_LIST_SORT
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6452023b69ccf72c78b393c5059fee497997af51
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104272243"
---
# <a name="using-sio_address_list_sort"></a>Использование функции \_ \_ сортировки списка \_ адресов SIO

Запрос IOCTL с помощью **\_ \_ списка адресов \_ SIO** позволяет разработчикам приложений сортировать список адресов назначения IPv6 и IPv4, чтобы определить лучший доступный адрес для создания подключения. Запрос **ioctl \_ \_ списка адресов \_ SIO** поддерживается в Windows XP и более поздних версиях.

В Windows Vista и более поздних версиях функция [**креатесортедаддресспаирс**](/windows/win32/api/netioapi/nf-netioapi-createsortedaddresspairs) принимает предоставленный список возможных IP-адресов назначения, пары адресов назначения с ЛОКАЛЬНЫМИ IP-адресами главного компьютера и сортирует пары в соответствии с тем, какая пара адресов лучше всего подходит для обмена данными между двумя одноранговыми узлами. Функцию **креатесортедаддресспаирс** следует использовать вместо **\_ списка адресов SIO \_ \_ Сортировать** ioctl в Windows Vista и более поздних версиях.

В следующих разделах описываются рекомендации по использованию **для \_ \_ \_ сортировки списка адресов SIO**.

## <a name="parameters"></a>Параметры

Буфер, переданный **в \_ \_ список адресов \_ SIO** , является структурой [**\_ \_ списка адресов сокетов**](/previous-versions/windows/desktop/legacy/aa385467(v=vs.85)) . Каждый [**\_ адрес сокета**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) в списке должен быть в \_ формате SOCKADDR IN6.

При **\_ \_ \_ сортировке по списку адресов SIO** ioctl выполняет сортировку адресов IPv6 и IPv4 в Windows Vista и более поздних версиях. Все адреса IPv4 в списке должны быть отсортированы в формате IPv6-адреса, сопоставленного с IPv4. Дополнительные сведения о формате IPv6-адресов, сопоставленных с IPv4, см. в разделе [сокеты с двойным стеком](dual-stack-sockets.md).

В Windows Server 2003 и Windows XP в **\_ \_ списке \_ адресов SIO** сортируются только адреса IPv6. Адреса IPv4 в формате IPv6-адресов, сопоставленных с IPv4, не поддерживаются.

В выходных данных элемент **иаддресскаунт** структуры [**\_ \_ списка адресов сокетов**](/previous-versions/windows/desktop/legacy/aa385467(v=vs.85)) может быть меньше, чем при вводе, если код ioctl определяет, что некоторые адреса назначения недопустимы.

## <a name="sorting-determination"></a>Определение сортировки

Порядок сортировки адресов IPv6 для \_ списка адресов SIO \_ \_ Сортировка ioctl выполняется на основе таблицы префиксной политики. Таблица политик префиксов настраивается с помощью служебной программы командной строки *Netsh.exe* . Следующие фрагменты командной строки иллюстрируют основные команды конфигурации таблицы политики префикса *Netsh.exe* :

``` syntax
netsh interface ipv6 show prefixpolicies
netsh interface ipv6 add prefixpolicy ::/96 3 4
netsh interface ipv6 delete prefixpolicy ::/96
netsh interface ipv6 set prefixpolicy ::/96 3 4
```

> [!Note]  
> В Windows Server 2003 и Windows XP первая команда Netsh, указанная выше, была описана ниже. Все остальные связанные команды одинаковы.

 

``` syntax
netsh interface ipv6 show prefixpolicy
```

Порядок адресов также определяется алгоритмом, описанным в RFC 3484 по *адресу по умолчанию для протокола IPv6* , опубликованного IETF. Дополнительные сведения см. на веб-сайте [https://www.ietf.org/rfc/rfc3484.txt](https://tools.ietf.org/html/rfc3484). (Этот ресурс может быть доступен только на английском языке.)

В **\_ списке адресов SIO при \_ \_ сортировке** через ioctl сортируются адреса от лучших к наихудшим, а при необходимости заполняется членами **\_ \_ идентификатора области sin6** . Для локальных адресов сайта \_ Сортировка списка адресов SIO \_ \_ либо заполняется идентификатором области, либо удаляет адрес.

При **\_ \_ \_ сортировке списка адресов SIO** по протоколу ioctl игнорируется исходный адрес, привязанный к сокету, и выполняется сортировка только по списку адресов назначения, переданному в качестве параметра.

Функцию [**креатесортедаддресспаирс**](/windows/win32/api/netioapi/nf-netioapi-createsortedaddresspairs) следует использовать вместо **\_ списка адресов SIO \_ \_ Сортировать** ioctl в Windows Vista и более поздних версиях. Функция **креатесортедаддресспаирс** возвращает список пар адресов, содержащих локальный исходный адрес и адрес назначения. Это позволяет приложению использовать правильный исходный адрес для каждого адреса назначения. Приложение также может фильтровать результаты путем поиска определенного исходного адреса. в результатах.

## <a name="requirements"></a>Требования

В файле заголовка *Winsock2. h* задан запрос IOCTL с **\_ \_ \_ сортировкой списка адресов SIO** . В пакете средств разработки программного обеспечения Microsoft Windows (SDK), выпущенном для Windows Vista и более поздних версий, изменилась Организация файлов заголовков, а в файле заголовка *Ws2def. h* задано значение ioctl **\_ \_ \_ Sort List списка адресов SIO** . Обратите внимание, что файл заголовка *Ws2def. h* автоматически включается в *Winsock2. h* и никогда не должен использоваться напрямую.

Запрос **ioctl \_ \_ списка адресов \_ SIO** поддерживается в Windows XP и более поздних версиях.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**креатесортедаддресспаирс**](/windows/win32/api/netioapi/nf-netioapi-createsortedaddresspairs)
</dt> </dl>

 

 
