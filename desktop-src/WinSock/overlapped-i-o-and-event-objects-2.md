---
description: Windows Сокеты 2 поддерживают перекрывающиеся операции ввода-вывода, а все поставщики транспорта поддерживают эту возможность.
ms.assetid: b36ab606-df1a-4254-b048-6d47eb366275
title: Перекрывающиеся операции ввода-вывода и объекты событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bca6ae2ee17036275183518bfd444b9317bcdc05145a9fcb327ad48388618a66
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117741060"
---
# <a name="overlapped-io-and-event-objects"></a>Перекрывающиеся операции ввода-вывода и объекты событий

Windows Сокеты 2 поддерживают перекрывающиеся операции ввода-вывода, а все поставщики транспорта поддерживают эту возможность. перекрывающиеся операции ввода-вывода следуют модели, установленной в Windows и могут выполняться с сокетами, созданными с помощью функции [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket) или сокетов, созданных с помощью функции [**всасоккет**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) с флагом **WSA \_ flag \_ overlapped** , установленным в параметре *dwFlags* .

> [!Note]  
> Создание сокета с атрибутом OVERLAPPED не влияет на то, находится ли сокет в данный момент в блокирующем или неблокирующем режиме. Сокеты, созданные с помощью атрибута OVERLAPPED, можно использовать для выполнения перекрывающихся операций ввода-вывода — это не изменяет режим блокировки сокета. Так как перекрывающиеся операции ввода-вывода не блокируются, режим блокировки сокета не имеет значения для этих операций.

 

Для получения приложения используют функции [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) или [**всареквфром**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) для предоставления буферов, в которые должны быть получены данные. Если один или несколько буферов были отправлены до момента получения данных сетью, эти данные могут быть помещены в буфер пользователя сразу по мере их поступления. Таким образом, он может избежать операции копирования, которая в противном случае возникала бы во время вызова функции [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) или [**реквфром**](/windows/desktop/api/winsock/nf-winsock-recvfrom) . Если данные уже существуют при публикации буферов приема, они немедленно копируются в буферы пользователя.

Если данные поступают, когда приложение не посылает буферы приема, то сеть переносится к привычному синхронному стилю операции. То есть входные данные помещаются в буфер внутренне до тех пор, пока приложение не выдаст вызов Receive и, таким образом, предоставляет буфер, в который можно копировать данные. Исключением является то, что приложение использует [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) для установки размера принимающего буфера равным нулю. В этом случае надежные протоколы разрешают получение данных только при публикации буферов приложений и потере данных на ненадежные протоколы.

На отправляющей стороне приложения используют [**всасенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) или [**всасендто**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) для предоставления указателей на заполненные буферы, а затем не направляют буферы каким бы то ни было, пока сеть не запотребляет содержимое буфера.

Перекрывающиеся вызовы Send и Receive немедленно возвращают. Возвращаемое значение, равное нулю, указывает, что операция ввода-вывода была завершена немедленно и соответствующее указание завершения уже произошло. Это значит, что связанный объект события был сигнальным, или подпрограмма завершения была поставлена в очередь и будет выполняться, когда вызывающий поток получит состояние ожидания с оповещением.

Возвращаемое значение ошибки СОКЕТа \_ , связанное с кодом ошибки, [ \_ \_ ожидающим ввода-вывода WSA](windows-sockets-error-codes-2.md) , указывает на то, что операция перекрытия была успешно инициирована, и что последующее указание будет предоставлено при использовании буферов отправки или при завершении операции получения. Однако для сокетов, являющихся стилями байтового потока, индикатор завершения возникает при исчерпании входящих данных независимо от того, заполнены ли буферы. Любой другой код ошибки указывает на то, что операция перекрытия не была успешно инициирована и не будет предпринята ни одна индикация завершения.

Операции отправки и получения могут быть перекрывающиеся. Функции Receive можно вызывать несколько раз для отправки буферов приема при подготовке входящих данных, а функции отправки могут вызываться несколько раз, чтобы поставить в очередь несколько буферов для отправки. Хотя приложение может полагаться на ряд перекрывающихся буферов отправки, отправляемых в указанном порядке, соответствующие события завершения могут происходить в другом порядке. Аналогично, на принимающей стороне буферы могут быть заполнены в том порядке, в котором они указаны, но события завершения могут происходить в другом порядке.

Во многих случаях перекрывающиеся операции Winsock с использованием [**акцептекс**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**коннектекс**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**всасенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile)и аналогичных функций являются отменяемыми. Однако поведение не определено для постоянного использования сокета, для которого отменены невыполненные операции. Функция [**функции closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) должна вызываться после отмены перекрывающейся операции. Таким образом, для получения наилучших результатов вместо того, чтобы отменять операции ввода-вывода напрямую, необходимо вызвать функцию **функции closesocket** , чтобы закрыть сокет, который в конечном итоге прекратит все ожидающие операции.

Функция отложенного завершения перекрывающихся операций ввода-вывода также доступна для [**всаиоктл**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), которая является улучшенной версией [**иоктлсоккет**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).

 

 
