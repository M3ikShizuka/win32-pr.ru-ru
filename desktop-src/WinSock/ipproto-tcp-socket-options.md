---
description: В следующей таблице описаны \_ параметры сокета TCP иппрото, применяемые к сокетам, созданным для семейств IPv4 и IPv6-адресов (AF \_ INET и AF \_ INET6) с параметром протокола для функции сокета, указанной как TCP (иппрото \_ TCP).
ms.assetid: 2a10498d-0a0b-4a2d-941e-9aa45a1a4428
title: Параметры сокета IPPROTO_TCP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 20d261a639c10faa8c8ef52ba1ae88a0fbc52a16
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/22/2021
ms.locfileid: "105704356"
---
# <a name="ipproto_tcp-socket-options"></a>\_Параметры TCP-сокета иппрото

В следующей таблице описаны параметры сокета **\_ TCP иппрото** , применяемые к сокетам, созданным для семейств IPv4 и IPv6-адресов (AF \_ INET и AF \_ INET6) с параметром *протокола* для функции [**сокета**](/windows/desktop/api/Winsock2/nf-winsock2-socket) , указанной как TCP (иппрото \_ TCP). Дополнительные сведения о получении и настройке параметров сокета см. на страницах справочника по функциям [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) и [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) .

Для перечисления протоколов и обнаружения поддерживаемых свойств для каждого установленного протокола используйте функцию [**всаенумпротоколс**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa), [**всценумпротоколс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols)или [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) .

## <a name="options"></a>Параметры

<table>
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Получить</th>
<th>Присвойте параметру</th>
<th>Тип оптвал</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP_BSDURGENT</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Если <strong>значение — true</strong>, поставщик услуг реализует стиль распространения по ПРОТОКОЛу BSD (по умолчанию) для обработки срочных данных. Этот параметр является обратным параметром TCP_EXPEDITED_1122. Этот параметр может быть установлен для соединения только один раз. Если этот параметр установлен в значение ON, этот параметр не может быть отключен. Этот параметр не обязательно должен быть реализован поставщиками служб. Параметр включен (по умолчанию имеет значение <strong>true</strong>).</td>
</tr>
<tr>
<td>TCP_EXPEDITED_1122</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Если <strong>значение — true</strong>, поставщик услуг реализует срочные данные, как указано в RFC-1222. В противном случае используется стиль программного распространения Berkeley (BSD) (по умолчанию). Этот параметр может быть установлен для соединения только один раз. Если этот параметр установлен в значение ON, этот параметр не может быть отключен. Этот параметр не обязательно должен быть реализован поставщиками служб.</td>
</tr>
<tr>
<td>TCP_FAIL_CONNECT_ON_ICMP_ERROR</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Если <strong>значение — true</strong>, вызов API соединения будет возвращен после получения ошибки ICMP со значением всаехостунреач. Исходный адрес ошибки будет доступен через параметр сокета TCP_ICMP_ERROR_INFO. Если <strong>значение равно false</strong>, сокет работает нормально. Значение по умолчанию — Disabled (значение <strong>false</strong>). Для обеспечения безопасности типов следует использовать функции <a href="/windows/win32/api/ws2tcpip/nf-ws2tcpip-wsagetfailconnectonicmperror">всажетфаилконнектоникмперрор</a> и <a href="/windows/win32/api/ws2tcpip/nf-ws2tcpip-wsasetfailconnectonicmperror">всасетфаилконнектоникмперрор</a> вместо прямого использования параметра сокета.</td>
</tr>
<tr>
<td>TCP_ICMP_ERROR_INFO</td>
<td>да</td>
<td>Нет</td>
<td><a href="/windows/win32/api/ws2ipdef/ns-ws2ipdef-icmp_error_info">ICMP_ERROR_INFO</a></td>
<td>Извлекает сведения об ошибке ICMP, полученной TCP-сокетом во время неудачного вызова соединения. Допустим только для сокета TCP, где TCP_FAIL_CONNECT_ON_ICMP_ERROR ранее было включено, а <strong>Connect</strong> вернула всаехостунреач. Запрос не блокируется. Если запрос выполнен успешно, а возвращенное значение оптлен равно 0, то с момента последнего вызова соединения не было получено ни одной ошибки ICMP. При получении сообщения об ошибке ICMP сведения о ней будут доступны до тех пор, пока не будет вызвано <strong>Подключение</strong> . Сведения возвращаются в виде структуры <a href="/windows/win32/api/ws2ipdef/ns-ws2ipdef-icmp_error_info">ICMP_ERROR_INFO</a> . Для обеспечения безопасности типа следует использовать функцию <a href="/windows/win32/api/ws2tcpip/nf-ws2tcpip-wsageticmperrorinfo">всажетикмперроринфо</a> вместо прямого использования параметра Socket.</td>
</tr>
<tr>
<td>TCP_KEEPCNT</td>
<td>да</td>
<td>да</td>
<td>DWORD</td>
<td>Возвращает или задает число проверок активности протокола TCP, которые будут отправлены до завершения подключения. Недопустимо присвоить TCP_KEEPCNT значение больше 255.</td>
</tr>
<tr>
<td>TCP_MAXRT</td>
<td>да</td>
<td>да</td>
<td>DWORD</td>
<td>Если это значение не отрицательное, оно представляет время ожидания подключения в секундах. Если он равен-1, он представляет запрос на отключение времени ожидания соединения (т. е. подключение будет передано бессрочно). Если время ожидания соединения отключено, время ожидания повторной передачи увеличивается экспоненциально для каждой повторной передачи до максимального значения 60sec, а затем остается там.</td>
</tr>
<tr>
<td>TCP_NODELAY</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Включает или отключает алгоритм Nagle для сокетов TCP. По умолчанию этот параметр отключен (имеет значение FALSE).</td>
</tr>
<tr>
<td>TCP_TIMESTAMPS</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Включает или отключает отметки времени RFC 1323. Обратите внимание, что также существует Глобальная конфигурация для меток времени (по умолчанию — OFF), &quot; отметок времени &quot; в (set/get)-нетткпсеттинг. Установка этого параметра сокета переопределяет этот глобальный параметр конфигурации.</td>
</tr>
<tr>
<td>TCP_FASTOPEN</td>
<td>да</td>
<td>да</td>
<td>DWORD (логическое значение)</td>
<td>Включает или отключает <a href="https://tools.ietf.org/html/rfc7413">функцию RFC 7413</a> TCP Fast Open, которая позволяет начать отправку данных на этапе 3-стороннего подтверждения соединения. Обратите внимание, что чтобы использовать быстрое открытие, следует использовать <a href="/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex"><strong>коннектекс</strong></a> для создания начального соединения и указать данные в параметре <em>лпсендбуффер</em> этой функции для передачи в процессе подтверждения. Некоторые данные в <em>лпсендбуффер</em> будут передаваться по протоколу быстрого открытия.</td>
</tr>
<tr>
<td>TCP_KEEPIDLE</td>
<td>да</td>
<td>да</td>
<td>DWORD</td>
<td>Возвращает или задает время в секундах, в течение которого TCP-подключение будет оставаться бездействующим, прежде чем зонды проверки активности будут отправлены удаленному.
<blockquote>
[!Note]<br />
Этот параметр доступен начиная с Windows 10, версия 1709.
</blockquote>
<br/></td>
</tr>
<tr>
<td>TCP_KEEPINTVL</td>
<td>да</td>
<td>да</td>
<td>DWORD</td>
<td>Возвращает или задает время в секундах, в течение которого TCP-подключение будет ожидать ответа на KeepAlive перед отправкой другой проверки активности.
<blockquote>
[!Note]<br />
Этот параметр доступен начиная с Windows 10, версия 1709.
</blockquote>
<br/></td>
</tr>
</tbody>
</table>

## <a name="windows-support-for-ipproto_tcp-options"></a>Поддержка параметров TCP ИППРОТО в Windows \_

| Параметр | Windows 10 | Windows 7 | Windows Server 2008 | Windows Vista |
|-|-|-|-|-|
| \_БСДУРЖЕНТ TCP | x | x | x | x |
| TCP, \_ срочный \_ 1122 | x | x | x | x |
| \_КИПКНТ TCP | Начиная с Windows 10, версия 1703 | | | |
| \_МАКСРТ TCP | x | x | x | x |
| \_Задержка TCP | x | x | x | x |
| \_метки времени TCP | x | x | x | x |
| \_ФАСТОПЕН TCP | Начиная с Windows 10, версия 1607 | | | |

<br/>

 | Параметр | Windows Server 2003 | Windows XP | Windows 2000 | Windows NT4 | Windows 9x и Me |
|-|-|-|-|-|-|
| \_БСДУРЖЕНТ TCP | x | x | x | x | |
| TCP, \_ срочный \_ 1122 | x | x | x | | |
| \_КИПКНТ TCP | | | | | |
| \_МАКСРТ TCP | | | | | |
| \_Задержка TCP | x | x | x | x | |
| \_метки времени TCP | | | | | |
| \_ФАСТОПЕН TCP | | | | | |

## <a name="remarks"></a>Комментарии

В пакете средств разработки программного обеспечения Microsoft Windows (SDK), выпущенном для Windows Vista и более поздних версий, была изменена организация файлов заголовков, а в файле заголовка *Ws2def. h* , который автоматически включается в заголовочный файл *Winsock2. h* , определен **иппрото уровень \_ TCP** . Параметры сокета **\_ TCP иппрото** , за исключением **протокола TCP \_ бсдуржент**, определены в файле заголовка *Ws2ipdef. h* , который автоматически включается в файл заголовка *Ws2tcpip. h* . Параметр **TCP \_ бсдуржент** по историческим причинам определен в файле заголовка *мсвсокк. h* . Файлы заголовков *Ws2def. h* и *Ws2ipdef. h* никогда не следует использовать напрямую.

## <a name="requirements"></a>Требования

| Требование | Значение |
|-|-|
| Header | <dl> <dt>Ws2def. h (включает Winsock2. h); </dt> <dt>Winsock2. h в Windows Server 2003, Windows XP и windows 2000</dt> </dl> |
