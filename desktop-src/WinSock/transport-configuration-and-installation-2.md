---
description: чтобы транспортный протокол был доступен через сокеты Windows, он должен быть правильно установлен в системе и зарегистрирован с Windows сокетами.
ms.assetid: 0f0b22e4-81b7-43a7-bc2f-7124fa32d925
title: Настройка и установка транспорта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f1ec75810790df0d9373e8f3ee184f2dbd51d9bb5c37d7721097febe23a8aee
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119733244"
---
# <a name="transport-configuration-and-installation"></a>Настройка и установка транспорта

чтобы транспортный протокол был доступен через сокеты Windows, он должен быть правильно установлен в системе и зарегистрирован с Windows сокетами. При установке поставщика транспортной службы путем вызова программы установки поставщика необходимо добавить сведения о конфигурации в базу данных конфигурации, чтобы предоставить Ws2 \_32.dll необходимые сведения о поставщике услуг. Ws2 \_32.dll экспортирует несколько функций установки, [**ВсЦинсталлпровидер**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider) и [**всЦинсталлпровидерандчаинс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains), для программы установки поставщика, чтобы предоставить соответствующие сведения о устанавливаемом поставщике услуг. Эти сведения включают, например, имя и путь к библиотеке DLL поставщика службы и список структур [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , которые может поддерживать этот поставщик. 32.dll Ws2 \_ также предоставляет функцию [**вскдеинсталлпровидер**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider)для программы удаления поставщика, которая удаляет всю необходимую информацию из базы данных конфигурации, поддерживаемой \_32.dllом Ws2. Точное расположение и формат этих сведений о конфигурации являются частными для32.dll Ws2 \_ и могут управляться только описанными выше функциями.

На 64-разрядных платформах существуют аналогичные функции, которые работают с каталогами с 32 и 64-bit. К этим функциям относятся [**WSCInstallProvider64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallprovider64_32), [**WSCInstallProviderAndChains64 \_ 32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscinstallproviderandchains64_32)и [**WSCDeinstallProvider32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscdeinstallprovider32).

Порядок, в котором изначально устанавливаются поставщики транспортной службы, управляет порядком перечисления с помощью [**всценумпротоколс**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols) и [**WSCEnumProtocols32**](/windows/desktop/api/Ws2spi/nf-ws2spi-wscenumprotocols32) в интерфейсе поставщика услуг или через [**всаенумпротоколс**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) в интерфейсе приложения. Что более важно, этот порядок также управляет порядком, в котором протоколы и поставщики услуг рассматриваются, когда клиент запрашивает создание сокета на основе его семейства адресов, типа и идентификатора протокола. Windows Сокеты 2 включают приложение с именем Sporder.exe, которое позволяет интерактивно переупорядочивать каталог установленных протоколов после того, как уже установлены протоколы. Windows Сокеты 2 также включают вспомогательную библиотеку DLL, Sporder.dll, которая экспортирует процедурный интерфейс для переупорядочения протоколов. Этот процедурный интерфейс состоит из одной процедуры, именуемой [**всквритепровидерордер**](/windows/desktop/api/Sporder/nf-sporder-wscwriteproviderorder).

## <a name="installing-layered-protocols-and-protocol-chains"></a>Установка многоуровневых протоколов и цепочек протоколов

Структура [**\_ сведений всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , предоставляемая для каждого устанавливаемого протокола, указывает, является ли протокол базовым протоколом, многоуровневый протоколом или цепочкой протоколов. Значение параметра *протоколчаин. чаинлен* интерпретируется, как показано в следующей таблице.

| Значение | Значение                                           |
|-------|---------------------------------------------------|
| 0     | Многоуровневый протокол.                                 |
| 1     | Базовый протокол (или цепочка с одним компонентом). |
| >1 | Цепочка протоколов.                                   |



 

Установка цепочек протоколов может происходить только после успешной установки всех составляющих компонентов (базовых протоколов и многоуровневых протоколов). Структура [**\_ сведений о всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) для цепочки протоколов использует параметр *протоколчаин* для описания длины цепочки и удостоверения каждого компонента. Отдельные протоколы, составляющие цепочку, перечислены по порядку в массиве Протоколчаин. Чаинентриес с элементом начальном массива, соответствующим первому многоуровневый поставщику. Протоколы идентифицируются по значениям *каталожентрид* , которые назначаются Ws2 \_32.dll в процессе установки протокола, и их можно найти в структуре **\_ сведений о всапротокол** для каждого протокола.

Значения для остальных параметров в структуре протокола [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) должны быть выбраны для отражения атрибутов и идентификаторов, которые лучше всего характеризуют цепочку протоколов в целом. При выборе этих значений разработчики должны учитывать, что обмен данными через цепочки протоколов может происходить только в том случае, если на обеих конечных точках установлены совместимые цепочки протоколов, и эти приложения должны иметь возможность распознать соответствующую структуру **всапротокол \_ info** .

При установке базового протокола нет необходимости делать записи в массиве *протоколчаин. чаинентриес* . Неявно понимается, что единственный компонент этой цепочки уже определен в параметре *каталожентрид* той же структуры [**всапротокол \_ info**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) . Также обратите внимание, что цепочки протоколов не могут включать несколько экземпляров одного многоуровневого протокола.

 

 
