---
description: Ниже описана операция, которая позволяет завершить работу установленного подключения к сокету.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Завершение подключения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: babbd26716c255c83a8ecc17305d9e59676645739a6f90d18ac72b5bcda49241
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119898424"
---
# <a name="connection-shutdown"></a>Завершение подключения

Ниже описана операция, которая позволяет завершить работу установленного подключения к сокету.

## <a name="initiating-shutdown-sequence"></a>Инициализация последовательности завершения работы

Подключение через сокет может быть выполнено одним из нескольких способов. [**Вспшутдовн**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (с *частотой* отправки SD \_ -сообщений или SD \_ ) и [**вспсенддисконнект**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) может использоваться для инициирования корректного завершения подключения. [**Вспклосесоккет**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) можно использовать для инициации корректного или аварийного завершения работы в зависимости от параметров ожидания, вызываемых закрытием сокета. Дополнительные сведения о корректном и аварийном завершении работы и параметрах ожидания см. ниже.

## <a name="indicating-remote-shutdown"></a>, Указывающее на удаленное завершение работы

Поставщики услуг указывают на разрыв подключения, инициированный удаленной стороной с помощью события ДЕМОна по \_ закрытию сети. Корректное завершение работы также указывается с помощью [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) , когда число считанных байтов равно 0 для протоколов потока байтов или с помощью кода возврата ошибки всаедискон для протоколов, ориентированных на сообщения. В любом случае **вспрекв** возвращает код ошибки всаеконнресет, что означает аварийное завершение работы.

## <a name="exchanging-user-data-at-shutdown-time"></a>Обмен данными пользователя в момент завершения работы

Во время разрыва соединения можно также (для протоколов, поддерживающих эту возможность) обмениваться данными пользователей между конечными точками. Конец, инициирующий уничтожение, может вызвать [**вспсенддисконнект**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) , чтобы указать, что больше нет данных для отправки, и инициировать последовательность разрыва соединения. Для некоторых протоколов часть этой последовательности демонтажа — это доставка данных об отключении от инициатора уничтожения. После получения уведомления о том, что удаленная конечная точка вызвала последовательность разрыва (как правило, через \_ Указание закрытия демона), можно вызвать функцию [**вспреквдисконнект**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) для получения данных отключения (если они есть).

Чтобы продемонстрировать, как можно использовать данные для отключения, рассмотрим следующий сценарий. Клиентская часть приложения клиента/сервера отвечает за завершение подключения к сокету. КоинЦидент с завершением он предоставляет (с помощью отключения данных) общее число транзакций, обработанных сервером. Сервер, в свою очередь, реагирует на совокупный общий итог транзакций, обработанных всеми клиентами. Последовательность вызовов и указаний может быть вызвана, как показано в следующей таблице.

| На стороне клиента                                                                                                               | На сервере                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| (1) вызывает [**вспсенддисконнект**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) , чтобы завершить сеанс и указать общую сумму транзакции.            |                                                                                                                                         |
|                                                                                                                           | (2) возвращает значение ДЕМОна \_ Close или [**вспрекв**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) с возвращаемым ЗНАЧЕНИЕМ 0 или всаедискон, что означает выполнение корректного завершения работы. |
|                                                                                                                           | (3) вызывает [**вспреквдисконнект**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) для получения общего числа транзакций клиента.                                         |
|                                                                                                                           | (4) вычисление совокупного общего итога по всем транзакциям.                                                                                |
|                                                                                                                           | (5) вызывает [**вспсенддисконнект**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) для передачи общего итога.                                                   |
| (6) получает \_ уведомление о закрытии демона.                                                                                        | (5) вызывает [ **вспклосесоккет**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))                                                                                 |
| (7) вызывает [**вспреквдисконнект**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) для получения и хранения совокупного общего итога транзакций. |                                                                                                                                         |
|                                                                                                                           | (8) вызывает [ **вспклосесоккет**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))                                                                                  |



 

Шаг (5) должен следовать за шагом (5), но не имеет отношения времени с шагами (6), (7) или (8).

 

 
