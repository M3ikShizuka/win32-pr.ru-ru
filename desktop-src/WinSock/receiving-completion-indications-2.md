---
description: 'Существует несколько параметров, позволяющих принимать указания по завершению, таким образом предоставляя приложения с соответствующими уровнями гибкости. К ним относятся: ожидание (или блокировка) объектов событий, опрос объектов событий и подпрограммы завершения ввода-вывода сокета.'
ms.assetid: 071cf198-6b4c-445e-9bd9-044f57f994a3
title: Получение обработок завершения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cd05d8297af17c26393b5db113fac283b39fcbb3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702888"
---
# <a name="receiving-completion-indications"></a>Получение обработок завершения

Существует несколько параметров, позволяющих принимать указания по завершению, таким образом предоставляя приложения с соответствующими уровнями гибкости. К ним относятся: ожидание (или блокировка) объектов событий, опрос объектов событий и подпрограммы завершения ввода-вывода сокета.

## <a name="blocking-and-waiting-for-completion-indication"></a>Блокировка и ожидание индикации завершения

Приложения могут блокироваться при ожидании установки одного или нескольких объектов событий с помощью функции [**всаваитформултипливентс**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) . В реализациях Windows процесс или поток действительно блокируется. Так как объекты событий Windows Sockets 2 реализуются как события Windows, для этой цели также можно использовать собственную функцию Windows, [**WaitForMultipleObjects**](/windows/win32/api/synchapi/nf-synchapi-waitformultipleobjects) . Это особенно удобно, если поток должен ожидать как сокеты, так и события, не связанные с сокетами.

## <a name="polling-for-completion-indication"></a>Опрос по индикатору завершения

Приложения, которые предпочитает не блокировать блокировку, могут использовать функцию [**всажетоверлаппедресулт**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) для опроса состояния завершения, связанного с конкретным объектом события. Эта функция указывает, завершена ли операция перекрытия, и, если она завершена, упорядочивает функцию [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror) для получения состояния ошибки перекрывающейся операции.

## <a name="using-socket-io-completion-routines"></a>Использование подпрограмм завершения ввода-вывода сокета

Функции, используемые для инициирования перекрывающихся операций ввода-вывода ( [**всасенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**всасендто**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto), [**всарекв**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**всареквфром**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom)), принимают *лпкомплетионраутине* в качестве необязательного входного параметра. Это указатель на функцию для конкретного приложения, которая вызывается после успешного завершения успешно инициированной операции перекрывающегося ввода-вывода (успешно или иным образом). В подпрограммы завершения следуют те же правила, что и для подпрограмм завершения файлового ввода-вывода Windows. Это значит, что подсистема завершения не вызывается до тех пор, пока поток не пойдет в состояние ожидания с предупреждением, например при вызове функции [**всаваитформултипливентс**](/windows/desktop/api/Winsock2/nf-winsock2-wsawaitformultipleevents) с `fAlertable` установленным флагом. Приложение, использующее параметр подпрограммы завершения для определенного перекрывающегося запроса ввода-вывода, может не использовать параметр wait параметра [**всажетоверлаппедресулт**](/windows/desktop/api/Winsock2/nf-winsock2-wsagetoverlappedresult) для этого же перекрывающегося запроса ввода-вывода.

Транспорты позволяют приложению вызывать операции Send и Receive из контекста подпрограммы завершения ввода-вывода сокета и гарантируют, что для конкретного сокета подпрограммы завершения ввода-вывода не будут вложены. Это позволяет полностью выполнять передачу данных с учетом времени в контексте с вытеснением.

## <a name="summary-of-overlapped-completion-indication-mechanisms"></a>Сводка механизмов индикации завершения с перекрытием

Определенное перекрытое указание завершения ввода-вывода, используемое для данной операции перекрытия, определяется тем, предоставляет ли приложение указатель на функцию завершения, является ли ссылка на структуру [**всаоверлаппед**](/windows/desktop/api/Winsock2/ns-winsock2-wsaoverlapped) , а также значение элемента **Хевент** в структуре **всаоверлаппед** (если оно предоставлено). В следующей таблице приведена сводка семантики завершения для перекрывающихся сокетов и показаны различные сочетания *лповерлаппед*, **Хевент** и *лпкомплетионраутине*:

| *лповерлаппед* | хевент         | *лпкомплетионраутине* | Индикатор завершения                                                                                                                                                                                                    |
|----------------|----------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| NULL           | Неприменимо | Не учитывается               | Операция завершается синхронно. Он ведет себя так, как если бы он был ноноверлаппед сокетом.                                                                                                                                      |
| ! ЗАКАНЧИВАЮЩ          | NULL           | NULL                  | Операция завершается перекрытием, но механизм завершения, поддерживаемый Windows Sockets 2, отсутствует. В этом случае можно использовать механизм порта завершения (если поддерживается). В противном случае уведомление о завершении отсутствует. |
| ! ЗАКАНЧИВАЮЩ          | ! ЗАКАНЧИВАЮЩ          | NULL                  | Операция завершает перекрытие, уведомление по сигнальному объекту события.                                                                                                                                                  |
| ! ЗАКАНЧИВАЮЩ          | Не учитывается        | ! ЗАКАНЧИВАЮЩ                 | Операция завершает перекрытие, уведомление по плану завершения.                                                                                                                                           |



 

 

 
