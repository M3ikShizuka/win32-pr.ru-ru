---
description: Управляющий код уведомляет приложение при изменении идеального значения невыполненной работы при отправке для соединения.
ms.assetid: 337883a5-7ceb-40d3-b318-b86dd488b94a
title: Код элемента управления SIO_IDEAL_SEND_BACKLOG_CHANGE
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 4eb07efecd39774c60d47cbcf7245c5831760e06
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103812454"
---
# <a name="sio_ideal_send_backlog_change-control-code"></a>Код элемента управления SIO_IDEAL_SEND_BACKLOG_CHANGE

## <a name="description"></a>Описание

Код **управления \_ \_ \_ \_ изменениями невыполненной работы суперконтроллера** ввода-вывода уведомляет приложение о том, что для соединения было изменено значение невыполненной работы (ISB) отправки.

Чтобы выполнить эту операцию, вызовите функцию [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** со следующими параметрами.

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_IDEAL_SEND_BACKLOG_CHANGE, // dwIoControlCode
  NULL,                         // lpvInBuffer
  0,                            // cbInBuffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_IDEAL_SEND_BACKLOG_CHANGE, // dwIoControlCode
  NULL,                         // lpvInBuffer
  0,                            // cbInBuffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a>Параметры

### <a name="s"></a>s

Дескриптор, идентифицирующий сокет.

### <a name="dwiocontrolcode"></a>двиоконтролкоде

Управляющий код для операции.
Используйте **\_ оптимальное \_ \_ \_ изменение невыполненной работы SIO** для этой операции.

### <a name="lpvinbuffer"></a>лпвинбуффер

Указатель на входной буфер.
Этот параметр не используется для этой операции.

### <a name="cbinbuffer"></a>кбинбуффер

Размер входного буфера в байтах. Этот параметр не используется для этой операции.

### <a name="lpvoutbuffer"></a>лпваутбуффер

Указатель на выходной буфер.
Этот параметр не используется для этой операции.

### <a name="cboutbuffer"></a>кбаутбуффер

Размер выходного буфера в байтах.
Этот параметр должен иметь значение 0.

### <a name="lpcbbytesreturned"></a>лпкббитесретурнед

Указатель на переменную, которая получает размер данных, хранящихся в выходном буфере, в байтах.
Этот возвращаемый параметр указывает на значение **DWORD** , равное нулю, для этой операции, так как выходные данные отсутствуют.

### <a name="lpvoverlapped"></a>лпвоверлаппед

Указатель на структуру [**всаоверлаппед**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .

Если *сокеты были созданы* без атрибута OVERLAPPED, параметр *лповерлаппед* игнорируется.

Если *конструктор* был открыт с атрибутом OVERLAPPED и параметр *Лповерлаппед* не равен **null**, операция выполняется как перекрытый (асинхронная) операция.
В этом случае параметр *лповерлаппед* должен указывать на допустимую структуру [**всаоверлаппед**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .

Для операций с перекрытием функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** возвращает значение немедленно, и соответствующий метод завершения получает сигнал о завершении операции.
В противном случае функция не возвращает значение до тех пор, пока операция не будет завершена или произойдет ошибка.

### <a name="lpcompletionroutine"></a>лпкомплетионраутине

Тип: \_ In_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)

Указатель на подпрограммы завершения, вызываемую при завершении операции (игнорируется для сокетов без перекрытия).

### <a name="lpthreadid"></a>лпсреадид

Указатель на структуру [**всасреадид**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) , которая будет использоваться поставщиком при последующем вызове [**впукуеуеапк**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).
Поставщик должен хранить указанную [**всасреадид**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) структуру (а не указатель на то же значение) до тех пор, пока функция [**впукуеуеапк**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) не вернет значение.

**Примечание**  .  Этот параметр применяется только к функции **вспиоктл** .

### <a name="lperrno"></a>лперрно

Указатель на код ошибки.

**Примечание**  .  Этот параметр применяется только к функции **вспиоктл** .

## <a name="return-value"></a>Возвращаемое значение

Если операция завершается успешно, функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** возвращает ноль.

Если операция завершается ошибкой или находится в состоянии ожидания, функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **Вспиоктл** возвращает **\_ ошибку сокета**.
Чтобы получить расширенные сведения об ошибке, вызовите [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).

| Код ошибки | Значение |
|------------|---------|
| **\_ожидается ввод-вывод WSA \_** | Операция перекрытия успешно инициирована, и ее завершение будет указано позже. |
| **\_Операция WSA \_ прервана** | Перекрывающаяся операция была отменена из-за закрытия сокета или выполнения команды ioctl **\_ flush суперконтроллера** ввода/вывода. |
| **WSAEFAULT** | Параметр *лповерлаппед* или *лпкомплетионраутине* не полностью содержится в допустимой части адресного пространства пользователя. |
| **всаеинпрогресс** | Функция вызывается при выполнении обратного вызова. |
| **всаеинтр** | Операция блокирования была прервана. |
| **всаеинвал** | Параметр *двиоконтролкоде* не является допустимой командой, или указан недопустимый входной параметр, либо команда неприменима к указанному типу сокета. Эта ошибка возвращается, если параметр *кбаутбуффер* не равен нулю. |
| **WSAENETDOWN** | Сбой сетевой подсистемы. |
| **всаенопротупт** | Параметр сокета не поддерживается для указанного протокола. |
| **WSAENOTCONN** | *Сокеты не* подключены. |
| **всаенотсокк** | Дескриптор *s* не является сокетом. |
| **всаеопнотсупп** | Указанная команда IOCTL не поддерживается. Эта ошибка возвращается, если поставщик транспорта не поддерживает запрос IOCTL **\_ \_ \_ невыполненной работы \_ по отправке SIO** . Эта ошибка также возвращается, когда попытка использовать оптимальный запрос IOCTL для **\_ \_ отправки \_ невыполненной работы \_ SIO** на сокете датаграмм. |

## <a name="remarks"></a>Комментарии

В Windows Server 2008, Windows Vista с пакетом обновления 1 (SP1) и более поздних версиях операционной системы поддерживается протокол IOCTL для **\_ оптимальной \_ отправки \_ невыполненной работы \_** .

При отправке данных через TCP-соединение с помощью сокетов Windows важно обеспечить достаточное количество необработанных данных (отправленных, но еще не подтвержденных) в TCP для достижения максимальной пропускной способности.
Оптимальное значение объема данных, необходимых для достижения наилучшей пропускной способности для подключения TCP, называется идеальным размером невыполненной отправки (ISB).
Значение ISB является функцией произведения задержки пропускной способности подключения TCP и полученного окна приема получателя (а также частично перегрузки в сети).

Значение ISB для каждого подключения доступно в реализации протокола TCP в Windows Server 2008, Windows Vista с пакетом обновления 1 (SP1) и более поздних версиях операционной системы.
**\_ Оптимальный запрос \_ на \_ отработку невыполненной работы \_ по отправке SIO** может использоваться приложением для получения уведомления при динамическом изменении значения ISB для соединения.

В Windows Server 2008, Windows Vista с пакетом обновления 1 (SP1) и более поздних версиях операционной системы для ориентированных на поток сокетов, находящихся в подключенном состоянии, поддерживается **\_ \_ \_ \_ изменение невыполненной работы SIO** и [**\_ оптимальный \_ \_ \_ запрос на отработку невыполненной**](sio-ideal-send-backlog-query.md) работы.

Диапазон значений ISB для TCP-соединения теоретически может иметь размер от 0 до 16 мегабайт.

См. страницу справки по запросу IOCTL для [**\_ \_ \_ \_ запроса на отработку**](sio-ideal-send-backlog-query.md) отказа от суперконтроллера ввода-вывода для типичного использования механизма ISB, обеспечивающего лучшую пропускную способность для подключений к продуктам с высокой

**\_ Оптимальный запрос \_ на \_ отработку невыполненной работы \_ по отправке SIO** разрешен только для сокета потока, который находится в подключенном состоянии.
В противном случае функция [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** завершится с ошибкой **всаенотконн**.

**\_ Оптимальный запрос \_ на \_ отработку невыполненной работы \_ по отправке SIO** не использует буферы ввода или вывода, а также пендс или блоки, пока в базовом соединении не произойдет изменение ISB.
После завершения этого запроса IOCTL приложение Winsock может использовать запрос IOCTL с [**\_ идеальными \_ для \_ отправки \_ невыполненной работы**](sio-ideal-send-backlog-query.md) по протоколу SIO для получения нового значения ISB в соединении.

**\_ Оптимальный запрос \_ на \_ отработку невыполненной работы \_ по отправке SIO** не поддерживает режим без блокировки.
Приложению разрешено выдавать этот запрос IOCTL на неблокирующем сокете, но запрос IOCTL просто блокируется или откладывается до тех пор, пока значение ISB не изменится.

Если оба параметра *лповерлаппед* и *лпкомплетионраутине* равны NULL, сокет в этой функции будет рассматриваться как сокет без перекрытия.
Для не перекрывающихся сокетов параметры *лповерлаппед* и *лпкомплетионраутине* игнорируются, за исключением того, что функция может блокироваться, *Если сокеты* находятся в блокирующем режиме.
Если *сокеты* находятся в режиме без блокировки, эта функция по-прежнему будет заблокирована, так как этот КОНКРЕТНЫЙ запрос IOCTL не поддерживает режим без блокировки.

Для перекрывающихся сокетов операции, которые не могут быть выполнены немедленно, будут инициированы, а завершение будет указано позже.

Любой запрос IOCTL может блокироваться неограниченно в зависимости от реализации поставщика услуг.
Если приложение не допускает блокировку в вызове функции [**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) или **вспиоктл** , перекрывающиеся операции ввода-вывода будут рекомендованы для ioctl, которые, скорее всего, блокируются.

**\_ Оптимальный запрос \_ на \_ отработку невыполненной работы \_ по отправке через Суперконтроллер** ввода-вывода предоставляет уведомление и должно блокироваться, пока значение ISB не изменится.
Поэтому он обычно вызывается асинхронно с параметром *лповерлаппед* , для которого задана допустимая структура всаоверлаппед.

**\_ Оптимальный запрос \_ на \_ отработку \_** отказа отправки через Суперконтроллер ввода/вывода может завершиться ошибкой, если операция **всаеинтр** или **WSA \_ \_ прервана** в следующих случаях:

* Подключение TCP корректно отключается в направлении отправки. Это может произойти в результате вызова функции Shutdown с тем, как для параметра установлено значение **SD \_ Send**, вызов функции **Дисконнектекс** или вызов функции **TransmitFile** или **трансмитпаккетс** с параметром *DwFlags* , для которого задано значение **tf \_ Disconnect** или **tf \_ reмногократного использования**.
* Подключение TCP сброшено или прервано.
* Приложение выдает запрос IOCTL для **\_ оптимального \_ \_ \_ изменения невыполненной работы при отправке** запроса на уведомление. В каждый момент времени допускается только 1 1 ожидающих запросов на **\_ \_ \_ \_ изменение невыполненной работы** .
* Запрос отменяется диспетчером ввода-вывода.
* Сокет закрыт.

Две встроенные функции-оболочки для этих IOCTL определены в файле заголовка *Ws2tcpip. h* .
Рекомендуется использовать эти встроенные функции вместо того, чтобы использовать **\_ оптимальное \_ \_ \_ изменение невыполненной работы SIO** и [**\_ \_ \_ невыполненную \_**](sio-ideal-send-backlog-query.md) работу по запросу IOCTL.

Встроенная функция-оболочка для **\_ идеального \_ \_ \_ изменения невыполненной работы по отправке SIO** — функция **идеалсендбакклогнотифи** .

Встроенная функция-оболочка для [**\_ \_ \_ \_ запроса на отработку невыполненной работы суперконтроллера**](sio-ideal-send-backlog-query.md) ввода-вывода с помощью ioctl — это функция **идеалсендбакклогкуери** .

## <a name="see-also"></a>См. также раздел

[**SIO_IDEAL_SEND_BACKLOG_QUERY**](sio-ideal-send-backlog-query.md)

[**фиксатор**](/windows/desktop/api/winsock2/nf-winsock2-socket)

[**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[**всажетоверлаппедресулт**](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[**всаиоктл**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[**всаоверлаппед**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[**всасоккета**](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[**всасоккетв**](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
