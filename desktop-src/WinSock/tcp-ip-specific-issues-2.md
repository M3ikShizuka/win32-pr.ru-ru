---
description: Некоторые методы программирования выполняются с проблемами производительности, связанными с реализацией TCP/IP.
ms.assetid: 2a63e85e-06fd-4b6f-8351-9866099b9d54
title: Проблемы, связанные с TCP/IP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e9a7334471d3e419830eb054399ff1dcb721cd0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105712125"
---
# <a name="tcpip-specific-issues"></a>Проблемы, связанные с TCP/IP

Некоторые методы программирования выполняются с проблемами производительности, связанными с реализацией TCP/IP. Такие проблемы с производительностью не предполагают, что TCP/IP не является эффективным или узким местом производительности. скорее, эти проблемы возникают, когда не понимаются операции TCP/IP.

Следующие проблемы являются типичными сценариями, в которых сочетание операций TCP/IP и параметров разработки сетевых приложений приводит к снижению производительности.

-   Приложения с большим количеством подключений.

    Некоторые приложения создают новое соединение TCP для каждой транзакции. Подключение по протоколу TCP занимает некоторое время, вносит дополнительные RTTs и может замедляться запуском. Кроме того, закрытые подключения подчиняются времени ожидания, при котором используются системные ресурсы.

    Приложения с большим количеством подключений часто используются в основном, так как их легко создать. Тестирование и обработка ошибок очень просты. Обнаружение ошибок в постоянном подключении может занять значительный объем кода и усилий, поэтому иногда он не завершается.

    Исследует эту ситуацию, повторно используя TCP-соединение. Это может привести к сериализации через TCP-подключение, если только транзакции не мультиплексированы по нескольким соединениям. При использовании этого подхода число подключений должно быть ограничено двумя, и требуется формирование кадров уровня приложения и расширенная обработка ошибок.

-   Буферы отправки нулевой длины и блокировки отправляются.

    Отключение буферизации с помощью функции [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) для установки буфера отправки (so \_ сндбуф) в нулевое значение похоже на отключение кэширования диска. При задании для буфера отправки нулевого значения и отправке блокировки отправка приложения имеет 50% шансов на попадание в 200-миллисекунду с отложенным подтверждением.

    Не отключайте буферизацию отправки, если не учитывается влияние на все сетевые среды. Одно исключение. потоковые данные, использующие перекрывающиеся операции ввода-вывода, должны устанавливать буфер отправки в ноль.

-   Отправка и отправка — получение модели программирования.

    Структурирование приложения для выполнения отправки и отправки — повышает вероятность возникновения алгоритма Nagle, что приводит к задержке RTT + 200 мс. Алгоритм Nagle может быть обнаружен, если последняя отправка меньше, чем максимальный размер сегмента TCP (MSS, максимальный объем данных в одной датаграмме). MSS может быть очень большим значением (64 КБ и даже больше в IPv6), поэтому не учитывается как обычно небольшой MSS. Лучшим вариантом является объединение двух отправок в одну функцию send с помощью функции [**всасенд**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) или **memcpy** .

-   Большое количество одновременных подключений.

    Количество одновременных подключений не должно превышать два, за исключением приложений специального назначения. Превышение двух одновременных подключений приведет к нерасходованию ресурсов. Хорошим правилом является наличие до четырех кратковременных подключений или двух постоянных подключений на назначение.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Поведение приложения](application-behavior-2.md)
</dt> <dt>

[Высокопроизводительные приложения Windows Sockets](high-performance-windows-sockets-applications-2.md)
</dt> <dt>

[Алгоритм Nagle](https://msdn.microsoft.com/library/ms817942.aspx)
</dt> </dl>

 

 



