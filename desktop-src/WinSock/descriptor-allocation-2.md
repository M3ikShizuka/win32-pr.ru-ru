---
description: Хотя поставщики услуг Windows Sockets рекомендуется применять в качестве объектов устанавливаемой файловой системы (IFS), архитектура Winsock также поддерживает поставщики услуг, чьи дескрипторы сокетов не являются объектами IFS.
ms.assetid: ed5e10f4-fa17-4a07-9cac-43767915b8e9
title: Распределение дескрипторов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095301798eb850fc4eb63e1939712379b5ead85e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701545"
---
# <a name="descriptor-allocation"></a>Распределение дескрипторов

Хотя поставщики услуг Windows Sockets рекомендуется применять в качестве объектов устанавливаемой файловой системы (IFS), архитектура Winsock также поддерживает поставщики услуг, чьи дескрипторы сокетов не являются объектами IFS. Поставщики с дескрипторами IFS указывают на это с \_ помощью \_ бита атрибута XP1 IFS в [**структуре \_ info всапротокол**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) . (Примечание. XP1 \_ \_Двоичные атрибуты дескрипторов IFS не включены в выпуск 2.0.8 спецификации API, но были добавлены с момента появления ошибки в механизме.) Клиенты Winsock SPI могут воспользоваться преимуществами поставщиков, дескрипторы сокетов которых представляют собой обработчики IFS с помощью этих дескрипторов со стандартными средствами ввода-вывода Windows, такими как [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) и [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).

Каждый раз, когда поставщик IFS создает новый дескриптор сокета, необходимо, чтобы поставщик вызывал [**впумодифифшандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) перед предоставлением нового дескриптора клиенту SPI Windows Sockets. Эта функция принимает идентификатор поставщика и предложенный обработчик IFS от поставщика в качестве входных данных и возвращает (возможно) измененный обработчик. Поставщик IFS должен предоставлять клиенту только измененный обработчик, и все запросы клиента будут ссылаться только на этот измененный обработчик. Измененный маркер является неразличимым от предложенного маркера, который касается операционной системы. Таким образом, в большинстве случаев поставщик услуг будет просто выбирать только измененный маркер во всей своей внутренней обработке. Эта функция изменения позволяет \_32.dll Ws2 значительно упростить процесс идентификации поставщика услуг, связанного с данным сокетом.

Поставщики, не возвращающие дескрипторы IFS, должны получить допустимый дескриптор от \_32.dll Ws2 через вызов [**впукреатесоккесандле**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) . Поставщик Нонифс должен предоставлять клиенту только 2.DLL сокетов Windows, и все запросы клиента будут ссылаться только на эти дескрипторы. Для удобства реализации поставщика услуг одним из входных параметров, предоставляемых поставщиком в **впукреатесоккесандле** , является значение DWORD context. Ws2 \_32.dll связывает это значение контекста с выделенным маркером сокета и позволяет поставщику услуг получить значение контекста в любое время через вызов [**впукуерисоккесандлеконтекст**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) . Обычно это значение контекста используется для хранения указателя на структуру данных, поддерживаемую поставщиком услуг, которая используется для хранения сведений о состоянии сокета.

 

 
