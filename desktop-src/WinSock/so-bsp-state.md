---
description: Возвращает локальный адрес, локальный порт, удаленный адрес, удаленный порт, тип сокета и протокол, используемые сокетом.
ms.assetid: 2628f47e-3e73-4e02-91b8-ba4cb0800864
title: Параметр SO_BSP_STATE Socket (Ws2def. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: d10e391d70dd67190e1aec803036d019261c9000
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127458155"
---
# <a name="so_bsp_state-socket-option"></a>Поэтому \_ \_ параметр сокета состояния BSP

Параметр сокета **\_ \_ состояния BSP** Возвращает локальный адрес, локальный порт, удаленный адрес, удаленный порт, тип сокета и протокол, используемые сокетом.

Чтобы выполнить эту операцию, вызовите функцию [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) со следующими параметрами.

## <a name="socket-option-value"></a>Значение параметра сокета

Константа, представляющая этот параметр сокета, — 0x1009.

## <a name="syntax"></a>Синтаксис


```C++
int getsockopt(
  (SOCKET) s,      // descriptor identifying a socket 
  (int) SOL_SOCKET,   // level
  (int) SO_BSP_STATE, // optname
  (char *) optval,         // output buffer,
  (int) *optlen,       // size of output buffer
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*s* \[ в\]
</dt> <dd>

Дескриптор, идентифицирующий сокет.

</dd> <dt>

*уровень* \[ окне\]
</dt> <dd>

Уровень, на котором определен параметр. Для выполнения этой операции используйте **\_ сокет Sol** .

</dd> <dt>

*optname* \[ окне\]
</dt> <dd>

Параметр сокета, для которого должно быть получено значение. Используйте для этой операции **\_ \_ состояние BSP** .

</dd> <dt>

*оптвал* \[ заполняет\]
</dt> <dd>

Указатель на буфер, в котором возвращается значение запрошенного параметра. Этот параметр должен указывать на буфер, который больше или равен размеру структуры [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) .

</dd> <dt>

*оптлен* \[ в, out\]
</dt> <dd>

Указатель на размер (в байтах) буфера *оптвал* . Этот размер должен быть больше или равен размеру структуры [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) .

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если операция завершается успешно, [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) возвращает ноль.

Если операция завершается неудачно, возвращается значение ошибки СОКЕТа \_ и можно получить конкретный код ошибки, вызвав [**всажетластеррор**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).



| Код ошибки                                                                                                                                              | Значение                                                                                                                                                                                                                                                                                    |
|---------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <dt>**[WSANOTINITIALISED](windows-sockets-error-codes-2.md)**</dt> </dl> | Перед использованием этой функции должен быть выполнен успешный вызов [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) .<br/>                                                                                                                                                                                     |
| <dl> <dt>**[WSAENETDOWN](windows-sockets-error-codes-2.md)**</dt> </dl>             | Сбой сетевой подсистемы.<br/>                                                                                                                                                                                                                                               |
| <dl> <dt>**[WSAEFAULT](windows-sockets-error-codes-2.md)**</dt> </dl>                 | Один из параметров *оптвал* или *оптлен* указывает на память, которая не находится в допустимой части адресного пространства пользователя. Эта ошибка также возвращается, если значение, на которое указывает параметр *оптлен* , меньше размера структуры [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) .<br/> |
| <dl> <dt>**[всаеинпрогресс](windows-sockets-error-codes-2.md)**</dt> </dl>       | выполняется блокировка Windows сокеты 1,1, или поставщик услуг все еще обрабатывает функцию обратного вызова.<br/>                                                                                                                                                            |
| <dl> <dt>**[всаеинвал](windows-sockets-error-codes-2.md)**</dt> </dl>                 | Неизвестный или недопустимый параметр *уровня* .<br/>                                                                                                                                                                                                                                    |
| <dl> <dt>**[всаенопротупт](windows-sockets-error-codes-2.md)**</dt> </dl>       | Параметр неизвестен или не поддерживается указанным семейством протоколов.<br/>                                                                                                                                                                                                          |
| <dl> <dt>**[всаенотсокк](windows-sockets-error-codes-2.md)**</dt> </dl>             | Дескриптор не является сокетом.<br/>                                                                                                                                                                                                                                                 |



 

## <a name="remarks"></a>Remarks

Функция [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) , вызываемая со следующим параметром сокета **\_ \_ состояния BSP** , получает локальный адрес, локальный порт, удаленный адрес, удаленный порт, тип сокета и протокол, используемые сокетом. Так как параметр сокета **\_ \_ состояния BSP** работает с сокетами IPv6 или IPv4 (для семейств адресов **AF \_ INET6** и **AF \_ inet** ).

Если функция [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) выполнена успешно, сведения возвращаются в структуре [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) в буфере, на который указывает параметр *оптвал* . Целое число, на которое указывает *оптлен* , должно первоначально содержать размер этого буфера; При возврате он будет установлен в значение длины в байтах для значения, возвращаемого в параметре *оптвал* .

Члены **исоккеттипе** и **ипротокол** в возвращенной структуре [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) заполняются для дескриптора сокета в параметре *s* .

Если сокет находится в подключенном или связанном состоянии, то элементу **локаладдр** в возвращенной структуре [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) будет присвоена структура [SOCKADDR](sockaddr-2.md) , представляющая локальный адрес и порт. Если сокет находится в подключенном состоянии, то элементу **ремотеаддр** в возвращенной структуре **ксаддр \_ info** будет присвоена структура SOCKADDR, представляющая удаленный адрес и порт.

Если сокет не находится в подключенном или привязанном состоянии, то элемент **локаладдр** в возвращенной структуре [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) возвращается с **пустым** указателем в элементе **лпсоккаддр** , а элемент **исоккаддрленгс** — с нулевым значением. Если сокет не находится в состоянии привязки, то член **ремотеаддр** возвращенной структуры **ксаддр \_ info** возвращается с **пустым** указателем в элементе **лпсоккаддр** , а элемент **исоккаддрленгс** — с нулевым значением.

Если функция [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) завершается ошибкой, параметры *оптвал* и *оптлен* остаются неизменными, а параметр *Оптвал* не указывает на возвращаемую структуру [**ксаддр \_ info**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) .

Обратите внимание, что файл заголовка *Ws2def. h* автоматически включается в *Winsock2. h* и никогда не должен использоваться напрямую.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Только классические приложения Vista\]<br/>                                                           |
| Минимальная версия сервера<br/> | Windows Только для \[ настольных приложений сервера 2008\]<br/>                                                     |
| Заголовок<br/>                   | <dl> <dt>Ws2def. h (включение Winsock2. h)</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[**\_сведения о ксаддр**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info)
</dt> <dt>

[SOCKADDR](sockaddr-2.md)
</dt> </dl>

 

 
