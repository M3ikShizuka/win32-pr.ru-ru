---
description: Локальная связь IPv6 и локальные адреса сайта называются адресами с заданной областью.
ms.assetid: d31882f6-b747-47c7-83cb-a9a03fe11cb8
title: Локальная связь IPv6 и локальные адреса сайтов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb80b8e201adf382b10dd31fe5607de903d6c588
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701511"
---
# <a name="ipv6-link-local-and-site-local-addresses"></a>Локальная связь IPv6 и локальные адреса сайтов

Локальная связь IPv6 и локальные адреса сайта называются адресами с заданной областью. API сокетов Windows (Winsock) поддерживает элемент **\_ \_ идентификатора области sin6** в структуре [**SOCKADDR \_ in6**](sockaddr-2.md) для использования с адресами в области. Для локальных адресов IPv6-канала (префикс FE80::/10) элемент **\_ \_ идентификатора области sin6** в структуре **SOCKADDR \_ in6** является номером интерфейса. Для локальных адресов сайта IPv6 (префикс FEC0::/10) элемент **\_ \_ идентификатора области sin6** в структуре **SOCKADDR \_ in6** является идентификатором сайта.

Ниже приведен пример локального адреса IPv6 для канала в интерфейсе \# 5.

``` syntax
fe80::208:74ff:feda:625c%5
```

Следующая команда доступна в Windows XP с пакетом обновления 1 (SP1) и более поздних версий для запроса и настройки IPv6 на локальном компьютере:

-   [Netsh.exe](netsh-exe.md)

Изменения конфигурации, выполненные с помощью команд Netsh.exe, являются постоянными и не теряются при перезапуске компьютера или протокола IPv6.

До выхода Windows XP с пакетом обновления 1 (SP1) Конфигурация IPv6 и управление использовали несколько старых средств командной строки (Net.exe, Ipv6.exe и Ipsec6.exe) для настройки IPv6 и управления им. При использовании этих старых средств изменения IPv6 не являются постоянными и теряются при перезапуске компьютера или протокола IPv6. Эти старые средства командной строки поддерживаются только в Windows XP.

В Windows XP с пакетом обновления 1 (SP1) Следующая команда выводит список интерфейсов IPv6 на локальном компьютере, включая индекс интерфейса, имя интерфейса и различные другие свойства интерфейса.

**интерфейс netsh interface IPv6 отобразить интерфейс**

В Windows XP с пакетом обновления 1 (SP1) Следующая команда изменит идентификатор сайта, связанный с индексом интерфейса.

**netsh interface IPv6 Set Interface <InterfaceIndex or Name> ИД сайта = значение**

В Windows XP Следующая старая команда также изменит идентификатор сайта, связанный с локальным адресом сайта, на 3.

**IPv6-рту FEC0::/10 3**

Если вы отправляете или подключаетесь к адресу с заданной областью, элемент **\_ \_ идентификатора области sin6** в структуре [**SOCKADDR \_ in6**](sockaddr-2.md) может оставаться неопределенным (ноль), который представляет адрес неоднозначной области. Например, следующий адрес локальной связи неоднозначен:

``` syntax
fe80::10
```

При привязке к адресу в области **sin6 элемент \_ \_ идентификатора области видимости** в структуре [**SOCKADDR \_ in6**](sockaddr-2.md) должен содержать ненулевое значение, указывающее допустимый номер интерфейса для адреса локальной связи или идентификатор сайта для локального адреса сайта.

## <a name="ambiguous-scoped-addresses"></a>Неоднозначные адреса в области

Если вы отправляете или подключаетесь к адресу в области и не указали **элемент \_ \_ идентификатора области sin6** в структуре [**SOCKADDR \_ in6**](sockaddr-2.md) , то адрес в области является неоднозначным. Чтобы устранить эту проблему, протокол IPv6 сначала определяет, привязан ли сокет к исходному адресу. Если это так, привязанный исходный адрес разрешает неоднозначность, предоставляя номер интерфейса или идентификатор сайта.

Если вы отправляете или подключаетесь к адресу в области и не указали **элемент \_ \_ идентификатора области sin6** или не привязываете исходный адрес, протокол IPv6 проверяет таблицу маршрутизации. Например, следующая команда отобразит таблицу маршрутизации IPv6 на локальном компьютере:

**netsh interface IPv6 отобразить маршрут**

``` syntax
No   Manual   256  fe80::/64      13  Local Area Connection
No   Manual   256  fe80::/64      14  Wireless Network Connection
```

Это означает, что адреса локальной связи по умолчанию обрабатываются как ссылки на интерфейс \# 13 и \# 14.

Неоднозначность возникает, если на локальном компьютере имеется несколько сетевых адаптеров. Например, приведенная выше команда **netsh** указывает, что существует два сетевых интерфейса (подключение по локальной сети и беспроводное сетевое подключение). Если в приложении указан адрес локальной ссылки (например, FE80:: 10) без идентификатора области, то не будет ясно, какой адаптер использовать для отправки пакета. При отправке пакета только адрес назначения для адреса локальной связи (FE80::/64) или IPv6 в области действия ссылки (FF00::/8) может пострадать от идентификатора области действия.

## <a name="neighbor-discovery"></a>Обнаружение окружения

Если вы не указали элемент **\_ \_ идентификатора области sin6** в структуре [**SOCKADDR \_ in6**](sockaddr-2.md) , не привязываете исходный адрес и не указали маршрут для адресов локальной связи, протокол IPv6 попытается найти соседа по локальному адресу. Для отправляемого пакета выполняется попытка выполнить один интерфейс. Первый из предустановленного интерфейса считается наиболее предпочтительным интерфейсом. Если при обнаружении соседей не удается разрешить адрес локальной связи в интерфейсе, отправляемый пакет удаляется, а система запоминает, что локальный адрес ссылки на целевой канал недоступен для этого интерфейса. В следующем пакете, который будет отправляться при выполнении всех тех же условий, будет предпринята попытка поиска соседей по другому интерфейсу. Этот процесс проходит через каждый интерфейс на локальном компьютере для каждого нового пакета до тех пор, пока обнаружение соседей не ответит на адрес локальной ссылки или если все возможные интерфейсы были выполнены и не прошли. Каждый раз при попытке разрешить соседу происходит сбой одного интерфейса для этого соседа.

Если адрес назначения для локальной ссылки разрешается, то этот интерфейс используется для отправки текущего пакета. Этот интерфейс также используется для всех последующих пакетов с неоднозначным ограничением, которые отправляются на тот же адрес назначения локальной связи.

Если при обнаружении соседей не удается разрешить конечный адрес локальной ссылки во всех интерфейсах, система пытается отправить пакет на самый предпочтительный интерфейс (первый интерфейс попытался выполнить попытку). Сетевой стек продолжает пытаться разрешить адрес назначения локальной ссылки на наиболее предпочтительном интерфейсе. По истечении некоторого периода времени после сбоя обнаружения соседей на всех интерфейсах сетевой стек снова перезагрузит процесс и попытается разрешить адрес локальной ссылки на все интерфейсы. В настоящее время этот интервал времени снова попытался выполнить обнаружение соседей на всех интерфейсах — 60 секунд. Однако этот интервал времени может измениться в версиях Windows и не должен предполагаться приложением.

> [!Note]  
> Если приложение привязывает один и тот же адрес локальной связи к другому интерфейсу после того, как обнаружение соседа разрешило адрес локальной связи, он не переопределит интерфейс с адресом локальной связи, возвращенным при поиске соседей.

 

Дополнительные сведения об обнаружении соседей для IP версии 6 см. в разделе [RFC4861](https://tools.ietf.org/html/rfc4861) , опубликованный IETF.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Префиксы сайта IPv6](site-prefixes-2.md)
</dt> <dt>

[Ipv6.exe](ipv6-exe-2.md)
</dt> <dt>

[Netsh.exe](netsh-exe.md)
</dt> <dt>

[Использование IPv6](using-ipv6-2.md)
</dt> </dl>

 

 



