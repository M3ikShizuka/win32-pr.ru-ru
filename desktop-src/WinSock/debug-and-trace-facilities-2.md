---
description: Средства отладки и трассировки и сокеты Windows 2.
ms.assetid: eb29fc21-92d6-4471-860a-fd1c531686f6
title: Средства отладки и трассировки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7288c6b4d72a7a375ee16da23a25b0a04a46df91
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692293"
---
# <a name="debug-and-trace-facilities"></a>Средства отладки и трассировки

Разработчикам приложений Windows Sockets 2 необходимо изолировать ошибки в:

-   Приложение.
-   *\_32.dllWs2* или одна из библиотек DLL оболочки совместимости.
-   Поставщик службы.

Windows Sockets 2 устраняет эту потребность с помощью нескольких компонентов и функций:

-   Интегрированная поддержка трассировки Winsock в Windows Vista и более поздних версиях.
-   Специально исправленная отладочная версия *\_32.dllWs2* в Windows Vista.
-   Отдельные простые средства отладки и трассировки для использования в Windows Server 2003 и Windows XP.

## <a name="winsock-tracing-using-event-tracing-for-windows"></a>Трассировка Winsock с помощью трассировки событий для Windows

Интегрированная поддержка трассировки Winsock с помощью трассировки событий Windows (ETW) включена в Windows Vista и более поздние версии. Это предпочтительный метод для трассировки вызовов Winsock в Windows Vista и более поздних версиях. Трассировка Winsock с использованием ETW является облегченной и работает в розничных версиях Windows. Дополнительное программное обеспечение или компоненты не требуются. Эта функция должна быть включена только в Windows Vista и более поздних версиях. Дополнительные сведения см. в разделах, посвященных [трассировке Winsock](winsock-tracing.md) .

## <a name="using-a-debug-version-of-ws2_32dll"></a>Использование отладочной версии Ws2 \_32.dll

Сочетание отладочной версии *\_32.dllWs2* в Windows Vista и трассировке Winsock позволяет отслеживать все вызовы процедур через API Windows Sockets 2 или SPI и, в некоторой степени, управлять ими.

Если версия пакета средств разработки программного обеспечения Microsoft Windows (SDK) для Windows Vista установлена в расположение по умолчанию, отладочные версии *\_32.dllWs2* для различных архитектур находятся в следующей папке:

**C: \\ Program Files \\ Microsoft SDK \\ Windows \\ v 6.0 \\ норедист**

Следует использовать проверенную версию *\_32.dllWs2* , соответствующую версии Windows и пакету обновления, на котором выполняется тестирование. Имейте в виду, что были применены исправления безопасности, обновленные *\_32.dllWs2* в тестовой системе. Windows SDK для Windows Vista и драйверов DVD/CD пакета средств разработки программного обеспечения (SDK) на платформе более ранней версии включают проверенные сборки для различных версий Windows. Следует использовать ту же проверенную версию *Ws2 \_32.dll* в качестве розничной версии, которая использовалась в тестируемой системе. Обратите внимание, что поведение, выполняемое в проверенной сборке, не будет совпадать с запуском в розничной сборке.

**Примечание**  .  Windows SDK для Windows Server 2008 и более поздних версий больше не включает специальные отладочные *версии \_32.dllWs2*. Вместо этого для разработчиков следует использовать трассировку Winsock с помощью ETW, так как эта функция не требует отладочных сборок.

## <a name="winsock-debug-and-trace-facility-on-windows-server-2003-and-windows-xp"></a>Отладка и трассировка Winsock в Windows Server 2003 и Windows XP

Более старые версии Windows до Windows 8 и Windows Server 2012 поддерживают отдельное средство отладки и трассировки, которое входит в состав примера с Windows SDK и пакетом SDK для платформы предыдущих версий. Средство отладки и трассировки следует использовать только в Windows Server 2003 и Windows XP, где трассировка Winsock не поддерживается.

Если Windows SDK для Windows 7 установлена в расположение по умолчанию, эта функция трассировки Winsock устанавливается в следующую папку:

**C: \\ Program Files \\ Microsoft SDK \\ Windows \\ v 7.0 \\ Samples \\ нетдс \\ библиотека Winsock \\ DT \_ DLL**

Файл *DbgSpec.doc* в этой папке содержит документацию по этому примитиву трассировки. Пример кода в \_ папке DLL DT должен быть скомпилирован для использования этого средства. Разработчики могут использовать исходный код для разработки версий библиотеки DLL отладки и трассировки, которые отвечают определенным потребностям.

Обратите внимание, что этот примитив функции трассировки Winsock будет работать только с отладочной версией *Ws2 \_32.dll* установлен. Поэтому необходимо получить установленную версию *Ws2 \_32.dll* , соответствующую версии Windows и пакета обновления, на котором выполняется тестирование.

Ограничение этого примитива \_ трассировки DLL-библиотеки DT состоит в том, что в примере кода используется глобальная блокировка (критический раздел) для каждого вызова функции Winsock. Поэтому этот механизм не полезен при работе с условиями гонки. Пример кода должен быть значительно переписан, чтобы сделать этот механизм трассировки полезным для решения большинства реальных проблем с Winsock (замена глобальных блокировок). Этот пример кода позволяет разработчикам отслеживать вызовы процедур, возвраты процедур, значения параметров и возвращаемые значения.

Разработчики могут использовать этот механизм примитива для трассировки вызовов процедур, возврата процедур, значений параметров и возвращаемых значений. Значения параметров и возвращаемые значения можно изменить при вызове процедуры или возврате процедуры. При необходимости вызов процедуры можно запретить или перенаправить. Благодаря доступу к этому уровню информации и контроля разработчик лучше может изолировать проблему в приложении, *Ws2 \_32.dll* или поставщике услуг.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Трассировка Winsock](winsock-tracing.md)
</dt> </dl>

 

 



