---
description: Клиенты NLA могут записывать сведения о конфигурации сети на уровне всей системы, что позволяет будущим запросам возвращать указанные сведения о конфигурации независимо от того, активна ли сеть.
ms.assetid: 7e92dd8f-d3a1-4e53-885c-ebc9626fd5dc
title: Регистрация экземпляра службы с помощью NLA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ae2e73e638e4bf0152c2c6c5a4f5ab87dda7312
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105692838"
---
# <a name="registering-a-service-instance-with-nla"></a>Регистрация экземпляра службы с помощью NLA

Клиенты NLA могут записывать сведения о конфигурации сети на уровне всей системы, что позволяет будущим запросам возвращать указанные сведения о конфигурации независимо от того, активна ли сеть. Эта возможность позволяет клиентам NLA влиять на согласованное взаимодействие с данными о сети в нескольких приложениях.

## <a name="parameters"></a>Параметры

Чтобы зарегистрировать экземпляр службы в поставщике службы сетевого расположения, используйте функцию [**всасетсервице**](/windows/desktop/api/Winsock2/nf-winsock2-wsasetservicea) . Для правильной регистрации экземпляра службы некоторые параметры функции **всасетсервице** должны быть установлены с соответствующей информацией, как описано в этом разделе. Для краткого справочника функция **всасетсервице** имеет следующий синтаксис:

``` syntax
INT WSASetService(
  LPWSAQUERYSET lpqsRegInfo,
  WSAESETSERVICEOP essOperation,
  DWORD dwControlFlags
);
```

Для параметра *лпксрегинфо* предоставьте структуру [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) из результата запроса NLA SP или соблюдайте требования запроса NLA SP, как указано в [запросе NLA](querying-nla-2.md).

Для параметра *ессоператион* поддерживаются следующие операции:

<dl> <dt>

<span id="RNRSERVICE_REGISTER"></span><span id="rnrservice_register"></span>РНРСЕРВИЦЕ \_ регистр
</dt> <dd>

Сеть, определенная в структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , предоставленной в *лпксрегинфо* , становится постоянной для активного пользователя путем сохранения экземпляра сети в кусте реестра для текущего пользователя, что позволяет выполнять олицетворение.

</dd> <dt>

<span id="RNRSERVICE_DELETE"></span><span id="rnrservice_delete"></span>РНРСЕРВИЦЕ \_ Удаление
</dt> <dd>

Если сеть, определенная в структуре [**всакуерисет**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , предоставленной в *лпксрегинфо* , является постоянной, она будет удалена.

</dd> </dl>

Операция, указанная в параметре *ессоператион* , может быть изменена следующими параметрами, которые можно указать с помощью бинарной или логики:

<dl> <dt>

<span id="NLA_FRIENDLY_NAME"></span><span id="nla_friendly_name"></span>\_понятное \_ имя NLA
</dt> <dd>

При использовании с РНРСЕРВИЦЕ \_ Register поле *лпсзкоммент* сети, определенной в *лпксрегинфо* , проверяется на допустимость и сохраняется в постоянном состоянии. При использовании с РНРСЕРВИЦЕ \_ DELETE и определенная сеть имеет понятное имя, понятное имя удаляется, но сетевая запись остается неизменной.

</dd> <dt>

<span id="NLA_ALLUSERS_NETWORK"></span><span id="nla_allusers_network"></span>\_сеть ALLUSERS (NLA) \_
</dt> <dd>

При использовании с РНРСЕРВИЦЕ \_ Register запись хранится в постоянном расположении на \_ локальном \_ компьютере hKey, делая ее доступной во время запросов для всех пользователей на локальном компьютере. При использовании с РНРСЕРВИЦЕ \_ delete указанная сеть удаляется из \_ ЛОКАЛЬНОГО компьютера hKey \_ . Если указанная сеть отсутствует, возвращается ошибка. Чтобы удалить сеть из куста реестра текущего пользователя, этот флаг указывать не нужно. Этот флаг действителен только в контексте безопасности локального системного администратора.

</dd> </dl>

NLA поддерживает следующие коды ошибок для вызовов функций [**всасетсервице**](/windows/desktop/api/Winsock2/nf-winsock2-wsasetservicea) :

| Ошибка             | Значение                                                                                                                                                                    |
|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| WSANOTINITIALISED | Успешный вызов функции [**сбой WSAStartup**](/windows/desktop/api/winsock/nf-winsock-wsastartup) для инициализации NLA не выполнялся.                                                                  |
| всаеакцесс        | \_Сеть NLA ALLUSERS \_ была указана в *двконтролфлагс* , а не в контексте безопасности локального системного администратора.                                                |
| всаеалреади       | Указанная сеть уже сохранена запрошенным образом, и в *двконтролфлагс* не указаны флаги для указания обновления существующей записи. |
| WSAEAFNOSUPPORT   | Указано семейство протоколов, для которого не поддерживается. В NLA поддерживаются только семейства IP-протоколов.                                                             |
| всаепфносуппорт   | Был указан протокол, для которого не поддерживается. В NLA поддерживается только протокол IP.                                                                              |



 

 

 



