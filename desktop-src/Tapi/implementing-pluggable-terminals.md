---
description: Общие требования к реализации подключаемого терминала перечислены ниже.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Реализация подключаемых терминалов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7a75dd7b085377c8474c9a89d74a297c3ca66c6740c01c7428e7b6f250e16c5f
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117762916"
---
# <a name="implementing-pluggable-terminals"></a>Реализация подключаемых терминалов

Общие требования к реализации подключаемого терминала:

-   Базовый код потоковой передачи терминала должен соответствовать возможностям требуемого MSP.
-   терминал должен использовать фильтры DirectShow для работы с большинством msp (это подразумевается здесь).
-   Для большинства MSP звуковые терминалы должны поддерживать 8-битный моно линейный PCM с + кГц.
-   Терминал должен включить бесплатный потоковый маршалинг, реализовав [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal). Терминал может сделать это, вызвав интерфейс API COM [**кокреатефрисреадедмаршалер**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) и выполнив статистическую обработку **IMarshal** в возвращенном указателе. Деструктор объекта терминала должен вызывать [**IMarshal->выпуск**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).
-   Терминал должен реализовывать или выполнять статистическую обработку любых дополнительных интерфейсов, зависящих от терминала.
-   Реализация терминала должна быть потокобезопасной.
-   Реализация терминала должна \# включать терммгр. h для определения [**иттерминалконтрол**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol). это дополнение к обычным включаемым и библиотекам, необходимым для приложений tapi 3 или tapi 3 в Windows 2000 с пакетом обновления 1 (SP1).

Примечания по реализации интерфейса и метода:

В терминале должен быть реализован [**иттерминал**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (сдвоенный интерфейс — vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).

[**Иттерминал:: Get \_ терминалкласс**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

Терминал должен **вернуть представление идентификатора** GUID, который вы выбрали, чтобы определить тип терминала. Выделение **BSTR** через [**сисаллокстринг**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring). Чтобы преобразовать GUID в **BSTR**, вызовите [**стрингфромклсид**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **сисаллокстринг** и [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).

[**Иттерминал:: Get \_ терминалтипе**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

Как правило, терминал должен возвращать TT \_ dynamic, если приложение реализует терминал. \_Кроме того, возвращается значение TT static, и возврат этого значения может быть уместным, если терминал соответствует устройству, однако это может вызвать путаницу в работе пользователей, поскольку статический терминал не будет присутствовать в статическом перечислении терминала MSP.

[**Иттерминал:: получение \_ состояния**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

Если в реализации терминала произвольно не ограничивается число потоков, к которым может подключиться терминал, то терминал должен всегда возвращать TS \_ нотинусе.

В противном случае реализация терминала произвольно ограничивает количество потоков, к которым может подключаться терминал. В этом случае терминал должен учитывать количество потоков, к которым он подключен. Терминал должен увеличить это внутреннее число при успешном вызове [**иттерминалконтрол:: коннекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) и уменьшить его при успешном вызове [**Иттерминалконтрол::D исконнекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) . В [**иттерминал:: Get \_ State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)должен вернуть TS INUSE, \_ Если этот счетчик равен максимальному числу потоков, которые может одновременно выбрать терминал. в противном случае он должен вернуть TS \_ нотинусе. Обратите внимание, что если предельное значение равно единице, то счетчик может просто быть логическим или \_ значением состояния терминала.

[**Иттерминал:: Get \_ Name**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

Терминал должен вернуть выбранное имя **BSTR** , выделенное через [**сисаллокстринг**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring). Это имя должно быть понятным для пользователя и должно быть локализовано.

[**Иттерминал:: Get \_ mediaType**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

Терминал должен вернуть тип носителя ТАПИМЕДИАТИПЕ \_ Audio или тапимедиатипе \_ Video.

[**Иттерминал:: получить \_ направление**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

Терминал возвращает \_ значение перечисления, указывающее направление терминала. Если терминал является двунаправленным (например, мостом), он должен возвращать значение TD \_ двунаправленный.

Терминал должен реализовывать [**иттерминалконтрол**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (только vtable).

[**Иттерминалконтрол:: Get \_ аддресшандле**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

Терминал, предоставляемый приложением, должен всегда возвращать **значение NULL** в качестве маркера адреса. Это указывает MSP, что этот терминал не был создан на заданном объекте адреса MSP.

[**Иттерминалконтрол:: Коннекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

В этом вызове терминал добавит свои фильтры к заданному графу и подключится друг к другу, если это применимо. Затем терминал должен вернуть ПИН-коды, предоставленные терминалом, для указанного направления потока.

Терминал, который не поддерживает одновременный доступ к нескольким потокам, задаст внутренней переменной значение TS \_ INUSE при успешном завершении этого метода.

Терминал может использовать параметр *двтерминалдиректион* из этого вызова для определения направления потока, к которому он подключен. Это необходимо для двунаправленных терминалов.

> [!Note]  
> Обычно (в базовых классах MSP и во всех известных Mspах) поток MSP не сможет подключиться, если терминал возвращает более одного ПИН-кода из одного вызова [**коннекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) . Это нормально, так как терминал, возвращающий более одного ПИН-кода во время подключения, требует, чтобы MSP имел специальные знания о терминале, чтобы эффективно использовать лишние контакты.

 

[**Иттерминалконтрол:: Комплетеконнекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

Терминал должен просто вернуть S \_ ОК. Терминал также может выполнить инициализацию после подключения, если это необходимо.

[**Иттерминалконтрол::D Исконнекттерминал**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

Терминал должен выполнить все необходимое для отключения терминала от остальной части графа. Обычно это подразумевает удаление всех фильтров терминалов из графа и установка состояния терминала TS \_ нотинусе.

[**Иттерминалконтрол:: Рунрендерфилтер**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

Терминал должен просто вернуть E \_ нотимпл.

[**Иттерминалконтрол:: Стопрендерфилтер**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

Терминал должен просто вернуть E \_ нотимпл.

 

 
