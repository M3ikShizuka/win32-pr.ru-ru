---
description: В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Архитектура MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104423602"
---
# <a name="msp-architecture"></a>Архитектура MSP

В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST. Приложения TAPI находятся в собственном процессе. Приложения TAPI загружают Tapi3.dll и все необходимые MSP в свой собственный процесс, а библиотека DLL TAPI взаимодействует с ТАПИСРВ через частный интерфейс RPC. На следующей схеме показано взаимодействие этих компонентов.

![взаимодействие между таписрв, приложениями TAPI и MSP](images/tsp-msp1.png)

Поставщик службы мультимедиа (MSP) обеспечивает потоковую передачу мультимедиа с помощью абстракций терминалов, потоков и подпотоков.

Терминал — это приемник или источник для потока мультимедиа. Это может быть физический объект, например громкоговоритель или микрофон, или абстракция устройства, например видеоокно. [Объект терминала](terminal-object.md) предоставляет интерфейс [**иттерминал**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) . Класс терминала описывается идентификатором GUID [**класса терминала**](terminal-class.md) . MSP может определять собственные классы терминалов.

Потоки делят носитель вызова, основываясь на типе или типе [**носителя**](tapimediatype--constants.md) , [**направлении**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)потока и адресе назначения носителя. Например, входящий поток аудиопотока от модема — это объект потока, исходящий поток видео с IP-адресом и портом — объект потока, видеопотоки, поступающие из многоадресной группы IP-адресов, также рассматриваются как один объект потока. Объект потока представлен интерфейсом [**итстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .

Подпотоки обеспечивают более точный контроль над носителем. Например, в случае многоадресной IP-рассылки входящий объект видеопотока может представлять несколько людей. Скорее всего, каждому участнику будет назначен отдельный модуль подготовки отчетов. Входящий поток видео можно разделить на несколько подпотоков, по одному для каждого пользователя. Один подпоток соответствует одному пользователю, и его можно настраивать и контролировать отдельно. Объект подпотока представлен интерфейсом [**итсубстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .

Когда приложение вызывает [**итаддресс:: креатекалл**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) для настройки вызова, оно должно указывать тип требуемого носителя. При исходящем вызове он просто сообщает TAPI о создании вызова. Пример:

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

В этом случае приложение создает исходящий вызов аудио-видео.

Переданные типы мультимедиа указывают на носитель, в течение которого приложение заинтересовано в течение времени существования вызова. Например, приложение может указать аудио и видео при создании вызова, но в начале выберите только звуковые терминалы. MSP начнет потоковую передачу аудио, но не будет отклонять локальный или удаленный видеозапрос, сделанный позже во время существования вызова.

Когда приложение вызывает [**итбасиккаллконтрол:: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 вызывает [**ТСПИ \_ линемакекалл**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) в TSP. После установления вызова MSP и TSP могут взаимодействовать по мере необходимости.

Когда вызов отключается, он настраивает MSP и TSP для обмена данными о разрыве вызова. Tapi3.dll будет вызывать [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , если приложение вызывает [**Отключение**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).

 

 
