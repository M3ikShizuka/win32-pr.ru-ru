---
description: В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Архитектура MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a7cf5d95cf568e17b53c575f6c2f8963baa4b698cc69243ee1a23e9306ad6b31
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119002852"
---
# <a name="msp-architecture"></a>Архитектура MSP

В архитектуре TAPI все специалистами выполняются в контексте ТАПИСРВ, который реализуется как процесс службы в SVCHOST. Приложения TAPI находятся в собственном процессе. Приложения TAPI загружают Tapi3.dll и все необходимые MSP в свой собственный процесс, а библиотека DLL TAPI взаимодействует с ТАПИСРВ через частный интерфейс RPC. На следующей схеме показано взаимодействие этих компонентов.

![взаимодействие между таписрв, приложениями TAPI и MSP](images/tsp-msp1.png)

поставщик службы мультимедиа (MSP) обеспечивает потоковую передачу мультимедиа, используя абстракции терминалов, Потоки и подпотоков.

Терминал — это приемник или источник для потока мультимедиа. Это может быть физический объект, например громкоговоритель или микрофон, или абстракция устройства, например видеоокно. [Объект терминала](terminal-object.md) предоставляет интерфейс [**иттерминал**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) . Класс терминала описывается идентификатором GUID [**класса терминала**](terminal-class.md) . MSP может определять собственные классы терминалов.

Потоки разделение носителя вызова на основе типа или типа [**носителя**](tapimediatype--constants.md) , [**направления**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)потока и адреса получателя носителя. Например, входящий поток аудиопотока от модема — это объект потока, исходящий поток видео с IP-адресом и портом — объект потока, видеопотоки, поступающие из многоадресной группы IP-адресов, также рассматриваются как один объект потока. Объект потока представлен интерфейсом [**итстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .

Подпотоки обеспечивают более точный контроль над носителем. Например, в случае многоадресной IP-рассылки входящий объект видеопотока может представлять несколько людей. Скорее всего, каждому участнику будет назначен отдельный модуль подготовки отчетов. Входящий поток видео можно разделить на несколько подпотоков, по одному для каждого пользователя. Один подпоток соответствует одному пользователю, и его можно настраивать и контролировать отдельно. Объект подпотока представлен интерфейсом [**итсубстреамконтрол**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .

Когда приложение вызывает [**итаддресс:: креатекалл**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) для настройки вызова, оно должно указывать тип требуемого носителя. При исходящем вызове он просто сообщает TAPI о создании вызова. Например:

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

В этом случае приложение создает исходящий вызов аудио-видео.

Переданные типы мультимедиа указывают на носитель, в течение которого приложение заинтересовано в течение времени существования вызова. Например, приложение может указать аудио и видео при создании вызова, но в начале выберите только звуковые терминалы. MSP начнет потоковую передачу аудио, но не будет отклонять локальный или удаленный видеозапрос, сделанный позже во время существования вызова.

когда приложение вызывает [**итбасиккаллконтрол:: Подключение**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 вызывает [**тспи \_ линемакекалл**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) в TSP. После установления вызова MSP и TSP могут взаимодействовать по мере необходимости.

Когда вызов отключается, он настраивает MSP и TSP для обмена данными о разрыве вызова. Tapi3.dll будет вызывать [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , если приложение вызывает [**Отключение**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).

 

 
