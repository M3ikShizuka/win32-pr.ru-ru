---
description: На следующем рисунке показана общая архитектура поставщиков услуг телефонии и связанных с ними библиотек динамической компоновки пользовательского интерфейса (библиотеки DLL ПОЛЬЗОВАТЕЛЬСКОГО интерфейса).
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: Архитектура (API телефонии)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683425"
---
# <a name="architecture-telephony-api"></a>Архитектура (API телефонии)

На следующем рисунке показана общая архитектура поставщиков услуг телефонии и связанных с ними библиотек динамической компоновки пользовательского интерфейса (библиотеки DLL ПОЛЬЗОВАТЕЛЬСКОГО интерфейса).

![специалистами и связанные библиотеки DLL пользовательского интерфейса](images/spuidl01.png)

Поставщик услуг состоит из как минимум двух компонентов. Библиотека DLL поставщика услуг (которая указана на рисунке как основная. TSP) выполняется в контексте процесса ТАПИСРВ и выполняет все задачи поставщика услуг, которые не связаны с элементами пользовательского интерфейса, связанными с использованием конкретного приложения устройства (скорее всего, в сочетании с компонентами более низкого уровня, не показанными на рисунке). Но в отличие от предыдущих версий TAPI, в которых код пользовательского интерфейса был интегрирован в поставщик услуг (и выполняется из-за предыдущей архитектуры, в контексте приложения), поставщик услуг должен иметь отдельный компонент, реализующий элементы пользовательского интерфейса.

Библиотека DLL пользовательского интерфейса поставщика услуг должна экспортировать функции, вызываемые TAPI, когда приложение вызывает функции TAPI, генерирующие пользовательский интерфейс: [**туиспи \_ линеконфигдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**туиспи \_ линеконфигдиаложедит**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**туиспи \_ Фонеконфигдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**туиспи \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)и [**TUISPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove). Каждая из этих функций включает в качестве параметра указатель на функцию обратного вызова в TAPI типа [**туиспидллкаллбакк**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), которую библиотека DLL пользовательского интерфейса может использовать для двунаправленной связи (как для отправки, так и для получения данных) с помощью библиотеки DLL поставщика услуг, которая выполняется в процессе таписрв. Если поставщик услуг создает некачественный пользовательский интерфейс, например диалоговое окно "Обмен **данными/разрывом** Unimodem", в сочетании с любой функцией тспи, для которой не ожидается пользовательский интерфейс (например, любая функция, не имеющая параметра *HWND* ), то библиотека DLL пользовательского интерфейса должна экспортировать [**туиспи \_ провидерженерикдиалог**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) и [**туиспи \_ провидерженерикдиалогдата**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).

> [!Note]  
> Первоначальные функции создания пользовательского интерфейса ТСПИ ( [**тспи \_ линеконфигдиалог**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**тспи \_ линеконфигдиаложедит**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**тспи \_ Фонеконфигдиалог**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**тспи \_ провидерконфиг**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI \_ providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)и [**TSPI \_ providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) являются устаревшими и никогда не вызываются TAPI. Поэтому они не должны экспортироваться БИБЛИОТЕКой поставщика услуг. Однако, если поставщик услуг должен быть указан в списке, который можно добавить с помощью панели управления телефонии, служебная программа, предоставляемая с телефонией Windows в версии 1,4 и более ранних версиях, она должна экспортировать **тспи \_ провидеринсталл**; если на панели управления телефонии требуется включить кнопку [**Удалить**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) , то необходимо экспортировать **Тспи \_ Провидерремове**; и если на панели управления телефонии требуется включить кнопку **установки** , то необходимо экспортировать **тспи \_ провидерконфиг**. Панель управления телефонии проверяет наличие этих функций в файле TSP поставщика услуг, чтобы настроить его пользовательский интерфейс, чтобы отразить, какие операции можно выполнить.

 

Библиотека DLL поставщика услуг должна экспортировать функцию [**тспи \_ провидеруиидентифи**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) , которую таписрв процесс использует для получения имени DLL пользовательского интерфейса для загрузки в процессе приложения. Она должна экспортировать функцию [**тспи \_ провидерженерикдиалогдата**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) для получения и реагирования на запросы из библиотеки DLL пользовательского интерфейса для отображения данных, и она должна экспортировать [**тспи \_ провидерфридиалогинстанце**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) для таписрв процесса, чтобы сообщить поставщику услуг, когда следует освободить ассоциацию, установленную для создания неограниченного пользовательского интерфейса в сочетании с функцией, которая не определена как пользовательская функция для представления пользовательского интерфейса. Библиотека DLL поставщика услуг может отсылать данные в библиотеку DLL пользовательского интерфейса с помощью новой строки сообщения ТСПИ [**\_ сенддиалогинстанцедата**](line-senddialoginstancedata.md).

Так как имена функций ТСПИ и ТУИСПИ намеренно определены как разные, при необходимости библиотека DLL поставщика услуг и библиотека DLL пользовательского интерфейса могут иметь один и тот же файл DLL. При правильном сегментации это не обязательно приводит к ненужному использованию памяти в контексте приложения и может упростить процесс установки для поставщиков услуг, которые в настоящее время могут быть реализованы в одной библиотеке DLL. TAPI вызывает только те функции, которые подходят для контекста, в котором используется библиотека DLL.

Поставщик услуг телефонии и библиотека DLL пользовательского интерфейса должны быть спроектированы с учетом требований, поэтому функции пользовательского интерфейса могут вызываться одновременно из нескольких процессов приложения. Кроме того, необходимо учитывать, что приложение и служба TAPI, в рамках которой выполняется поставщик услуг телефонии, могут находиться на разных компьютерах в локальной сети.

 

 
