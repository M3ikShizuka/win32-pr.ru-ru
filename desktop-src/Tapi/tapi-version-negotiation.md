---
description: Со временем могут существовать различные версии для TAPI, приложений и поставщиков услуг для линий или телефонов.
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: Согласование версии TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b7cd6d816c07cb1c6c93d9cc219509f257d9a2695671b5197002171f0f819f17
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119404069"
---
# <a name="tapi-version-negotiation"></a>Согласование версии TAPI

Со временем могут существовать различные версии для TAPI, приложений и поставщиков услуг для линий или телефонов. Новые версии могут определять новые функции, новые поля для структур данных и т. д. Поэтому номера версий указывают, как интерпретировать различные структуры данных.

Для обеспечения оптимального взаимодействия различных версий приложений, версий самой TAPI и версий поставщиков служб у разных поставщиков интерфейс TAPI предоставляет простой, двухэтапный механизм согласования версий для приложений. Приложение, TAPI и поставщик услуг для каждого линейного устройства должны быть согласованы с двумя разными версиями. Первый — номер версии для базовой и дополнительной телефонии, который называется версией API. Другой — для расширений, зависящих от поставщика, если таковые имеются, и называется версией расширения. Формат структур и типов данных, используемых базовыми и дополнительными компонентами TAPI, определяется версией API, а версия расширения определяет формат структур данных, определенных расширениями, определенными для поставщика.

Согласование версий продолжается в два этапа. На первом этапе выполняется согласование номера версии API и выполняется получение идентификатора расширения, связанного с любыми зависящими от поставщика расширениями, поддерживаемыми на устройстве. На втором этапе выполняется согласование версии расширения. Если приложение не использует какие-либо расширения API, оно пропускает второй этап, и расширения не активируются поставщиком услуг. Если приложение должно использовать расширения, но расширения поставщика услуг (идентификатор расширения) не распознаются приложением, приложение должно пропустить согласование для версии расширения. Каждый поставщик имеет свой набор юридических (распознаваемых) версий для каждого набора спецификаций расширения, которые он распространяет.

Функция [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) используется для согласования используемого номера версии API. Он также получает идентификатор расширения, поддерживаемый устройством Line, и возвращает нули, если расширения не поддерживаются. При вызове этой функции приложение предоставляет диапазон версий API, совместимый с. Интерфейс TAPI, в свою очередь, согласовывает с поставщиком услуг линии, чтобы определить, какой диапазон версий API поддерживается. Далее TAPI выбирает номер версии (как правило, хотя и не обязательно) в перекрывающихся диапазонах версий, предоставленных приложением, библиотекой DLL и поставщиком услуг. Этот номер возвращается в приложение вместе с идентификатором расширения, который определяет расширения, доступные для поставщика услуг этой строки.

Если приложение хочет использовать расширения, определенные возвращенным идентификатором расширения, необходимо сначала вызвать [**линенеготиатикстверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) для согласования версии расширения. На аналогичном этапе согласования приложение указывает уже согласованную версию API и поддерживаемый диапазон версий расширения. TAPI передает эту информацию поставщику услуг для строки. Поставщик услуг проверяет версию API и диапазон версий расширений по своему усмотрению и выбирает соответствующий номер версии расширения, если таковой существует.

Когда приложение позже вызывает [**линежетдевкапс**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), оно возвращает набор возможностей устройства для строки, которая соответствует результатам согласования версий. К ним относятся возможности устройств, совместимые с версией API, и возможности, зависящие от устройства линии, совместимые с версией расширения. Приложение должно указать оба этих номера версии при открытии строки. На этом этапе приложение, Библиотека DLL и поставщик служб фиксируются в соответствии с согласованными версиями. Если расширения для конкретных устройств не используются, версия расширения должна быть указана как нуль.

В среде, в которой несколько приложений открывают одно и то же устройство, первое приложение для открытия линейного устройства выбирает версии для всех будущих приложений, которые хотят использовать строку (поставщики услуг не поддерживают несколько версий одновременно). Аналогичным образом приложение, открывающее несколько устройств, может упростить работу с всеми линейными устройствами с одним и тем же номером версии API.

Каждая функция, принимающая *двапиверсион* или аналогичный параметр, должна присвоить этому параметру максимальную версию API, поддерживаемую приложением, или версию API, согласованную с помощью функции [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) или [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) на конкретном устройстве. Используйте следующую таблицу в качестве рекомендации:



| Функция                                                     | Значение                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [**линежетаддресскапс**](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).   |
| [**линежеткаунтри**](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**линежетдевкапс**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).   |
| [**линежетпровидерлист**](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**линежеттранслатекапс**](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**линенеготиатикстверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).   |
| [**линеопен**](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | Используйте версию, возвращенную [**линенеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).   |
| [**линетранслатеаддресс**](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**линетранслатедиалог**](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**фонежетдевкапс**](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion). |
| [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | Использовать наибольшую версию, поддерживаемую приложением.                                     |
| [**фоненеготиатикстверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion). |
| [**фонеопен**](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | Используйте версию, возвращенную [**фоненеготиатеапиверсион**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion). |



 

> [!IMPORTANT]
> При согласовании версии API всегда устанавливайте старшие и младшие номера версий в диапазоне версий, которые может поддерживать ваше приложение. Например, никогда не используйте 0x00000000 в качестве нижней или 0xFFFFFFFF для высокого уровня, так как для этих значений требуется, чтобы приложение поддерживало все версии TAPI, как в прошлом, так и в будущем.

 

 

 



