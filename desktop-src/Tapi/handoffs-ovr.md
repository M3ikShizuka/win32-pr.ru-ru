---
description: Если у приложения есть права владельца для сеанса связи, приложение может передать владение другому приложению.
ms.assetid: d6d188c9-9cbd-45af-93f0-b78850374919
title: хандоффс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 343815e35f1fc331c57c4aa2d9d311697cab7022
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673418"
---
# <a name="handoffs"></a>хандоффс

Если у приложения есть [права](privilege-ovr.md) владельца для сеанса связи, приложение может передать владение другому приложению. Операция передачи обычно используется, чтобы разрешить изменение типа носителя вызова. Приложение с наивысшим приоритетом для нового типа носителя должно принимать и обслуживать вызов. Изменение типа носителя обычно происходит по одной из следующих причин.

**Пользовательская команда:** С помощью пользовательского интерфейса или оконных сообщений приложение узнает, что локальный пользователь хочет изменить тип носителя. Например, пользователь сообщил о новом целевом приложении (которое еще не является владельцем), чтобы получить существующий голосовой вызов для передачи данных. Теперь целевое приложение должно управлять вызовом. В этом случае текущий владелец заметит число владельцев, которые увеличиваются, а затем отменяют свой контроль над вызовом. Кроме того, пользователь может указать текущему владельцу вызова передать его в приложение, которое может обрабатывать новый тип мультимедиа.

**Изменение типа носителя:** Поставщик услуг может обнаружить изменение типа носителя. Например, локальное приложение воспроизводит записанное голосовое сообщение вызывающему. Во время этого сообщения вызывающий объект недостаточным образом решает передать сигнал вызова факса, а локальное приложение может отвечать на запросы, изменяя тип носителя на Fax и, при необходимости, вызывая приложение факса. Другим способом это можно сделать, чтобы приложение мониторинга включило мониторинг типа мультимедиа, а при обнаружении типа носителя, который он заинтересован в вызове, он может запросить владение вызовом. Этот механизм не требуется для каждого приложения, чтобы отслеживать каждый вызов для каждого типа носителя.

**Команда удаленной стороны:** Удаленная сторона может в интерактивном режиме указывать на изменение типов мультимедиа во время существующего вызова, например, если локальное приложение отслеживает входные данные DTMF удаленным вызывающим объектом. В рамках этого мониторинга вызывающий объект указывает, например, что Факс будет отправлен. Другим способом управления локальными приложениями может быть команда, полученная при других подключениях к данным и с помощью сообщений о пользователях ISDN.

Переданный вызов будет иметь один из следующих результатов:

-   Вызов передается другому приложению (успешно).
-   Пользовательское приложение является целевым объектом (ТАРЖЕТСЕЛФ).
-   Сбой передачи (ТАРЖЕТНОТФАУНД).

Если приложение, получающее переданный вызов, уже имеет обработчик вызова, используется этот старый маркер вызова. В противном случае создается новый маркер вызова. В любом случае приложение завершается с правами владельца для вызова. Каждый раз, когда выходное приложение не совпадает с целевым приложением, целевой объект уведомляется о передаче в сообщении о состоянии сеанса, как если бы он получал новый вызов.

Если текущее приложение-владелец сообщило об изменении типов мультимедиа, это достигается путем передачи вызова приложению, используемому для целевого типа носителя. Два типа вызова хандоффс описаны в разделе [хандоффс](#directed-handoffs) and [Media Type хандоффс](#media-type-handoffs).

Не все поставщики служб поддерживают использование этой операции.

**Интерфейс TAPI 2. x:** См. раздел [**линехандофф**](/windows/win32/api/tapi/nf-tapi-linehandoff), где *лпсзфиленаме* задано имя приложения для прямой передачи или *двмедиамоде* задано на один тип носителя для косвенного перенаправления.

**Интерфейс TAPI 3. x:** См. раздел [**итбасиккаллконтрол:: хандоффдирект**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffdirect), [**Итбасиккаллконтрол:: хандоффиндирект**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-handoffindirect).

## <a name="directed-handoffs"></a>Направленный Хандоффс

*Направленная перенаправление* выполняется, когда целевое приложение известно по имени исходному приложению. Такая ситуация возникнет, например, из набора приложений, написанных одним и тем же поставщиком. Обычно пользователь может настроить управление направленным хандоффс. При такой передаче вызов задается указанному приложению, если оно открыло строку, в которой существует вызов. Тип носителя, указанный во время открытия строки приложением, игнорируется. Одним из распространенных примеров является вызов голоса, за которым следует передача факса в одном вызове. Перенаправленные передачи чаще всего используются в приложениях от того же разработчика, которые также связаны другими способами.

Направленное перенаправление также может использоваться в будущих версиях в рамках процесса арбитратинг нескольких приложений, ожидающих входящих вызовов того же типа мультимедиа, с выбором приложения для обработки вызова, основанного на определении протокола канала передачи данных или более высокого уровня, а не на типе носителя. Примером его использования может служить входящий модем с данными, например удаленный перенаправление, доска объявлений, удаленный доступ к сети и удаленный доступ к электронной почте, ожидающие вызовов одновременно.

## <a name="media-type-handoffs"></a>Тип носителя Хандоффс

Передается *тип мультимедиа* , если имеется новый, целевой тип носителя, обычно когда приложение-владелец определяет, что тип носителя, необходимый для вызова, отсутствует или будет изменен.

Процесс передачи, зависящей от носителя, может быть процессом проверки, если для типа носителя задан неизвестный бит. Приложение-владелец отвечает за циклический перебор типов мультимедиа для поиска приложения с наивысшим приоритетом. TAPI выполняет этот цикл только при первом входящем вызове, чтобы найти первого владельца. Это не делает это для операции передачи. В противном случае передается практически такой же, как и для первоначального назначения вызова приложению. Разница заключается в том, что для передачи косвенного (типа носителя) можно задать только один тип носителя.

Так как можно указать только один бит типа носителя, вызов предоставляется приложению с наивысшим приоритетом для этого типа мультимедиа. Однако для передачи можно рассматривать более одного типа носителя. В этом случае переданное приложение должно указывать наивысший приоритет возможных типов мультимедиа в качестве параметра.

Если в приложении указан неизвестный бит при передаче типа носителя и при сбое передачи, это означает, что неизвестное приложение, способное выполнить определение типа носителя, сейчас не выполняется. Переданное приложение должно попытаться передать вызов приложению с наивысшим приоритетом, зарегистрированному для следующего типа носителя.

Принимающее приложение теперь отвечает за вызов. Теперь он проверяет фактический тип носителя вызова. Если приложение может работать с типом носителя вызова, оно должно гарантировать, что это приложение с наивысшим приоритетом, зарегистрированное для этого типа носителя. Если это так, он продолжает вызов и обрабатывает его в обычном режиме. В противном случае он передает вызов другому приложению, зарегистрированному для этого типа мультимедиа.

Однако если проверка этого типа носителя завершается неудачно, приложение снова проверяется, пытаясь выполнить остальные возможности режима мультимедиа. Он должен сначала отключить текущий бит типа мультимедиа, а затем попробовать другую передачу с другим типом.

Этот процесс проверки и переработки продолжится, а оставшиеся типы носителей по одному исключены. Таким образом, одно из приложений может увидеть, что тип носителя, который он обрабатывает, находится в вызове, а Перехождение прошло успешно.

Затем приложение должно задать правильный тип носителя и очистить все остальные биты типа носителя. Это информирует других заинтересованных приложений о правильном типе носителя. Эти другие приложения получают уведомление о событии, сообщающее об изменении типа носителя звонка.

 

 
