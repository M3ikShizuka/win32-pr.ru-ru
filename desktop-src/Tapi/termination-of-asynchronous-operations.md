---
description: Когда приложение вызывает функцию Линеклосе с одной или несколькими необработанными асинхронными операциями, TAPI может направить поставщик услуг на завершение асинхронных операций, связанных с вызовом.
ms.assetid: b26ce074-76dc-4a50-8c17-d3412c336d59
title: Завершение асинхронных операций
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f8ed2acb0f442e5f4f07427f0e224d7a288087d6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105674461"
---
# <a name="termination-of-asynchronous-operations"></a>Завершение асинхронных операций

Когда приложение вызывает функцию [**линеклосе**](/windows/win32/api/tapi/nf-tapi-lineclose) с одной или несколькими необработанными асинхронными операциями, TAPI может направлять поставщик услуг на завершение асинхронных операций, связанных с вызовом, в зависимости от того, является ли приложение единственным владельцем вызова и имеет единственный маркер вызова.

Если приложение является единственным владельцем вызова, TAPI вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) (в зависимости от поставщика) для каждого такого вызова. Поставщик услуг должен проверить наличие ожидающих асинхронных операций, связанных с удаляемым вызовом. Если операция, ожидающая выполнения, существует, поставщик услуг должен принять соответствующее действие, возможно, завершая выполняемую операцию.

Если приложение имеет единственный обработчик вызова (то есть нет других владельцев или мониторов), TAPI вызывает функцию [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) . Поставщик услуг должен считать этот вызов абсолютным указанием того, что ожидающие асинхронные операции должны быть отменены. Поставщик услуг должен обеспечить упорядоченное завершение вызова и должен вызывать функцию обратного вызова [**асинхронного \_ завершения**](/windows/win32/api/tspi/nc-tspi-async_completion) для всех необработанных асинхронных операций, УКАЗЫВАЯ \_ значение ошибки линирр оператионфаилед. Если интерфейс TAPI ранее вызывал [**функцию \_ тспи Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) , он вызывает **тспи \_** линеклосекалл сразу после возврата поставщиком услуг из другого вызова; он не ждет завершения асинхронной операции, связанной с функцией **тспи \_ линедроп** .

Если приложение не является единственным владельцем вызова, TAPI не вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop). Если приложение не имеет единственного маркера для вызова, TAPI не вызывает функцию [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) . Если приложение не является ни единственным владельцем, ни самостоятельным обработчиком вызова, TAPI не отправляет уведомления поставщику услуг, поэтому все ожидающие асинхронные операции остаются без изменений. Это означает, что такие приложения не могут завершать асинхронные операции, запущенные с помощью функции [**линеклосе**](/windows/win32/api/tapi/nf-tapi-lineclose) . Однако, поскольку для каждой асинхронной операции требуется, чтобы вызывающее приложение было владельцем вызова, вероятность того, что приложение не сможет завершить асинхронные операции, очень редки. Если это происходит, то другие владельцы вызовов должны принять ответственность за метод обработки расстановки вызовов.

Если TAPI вызывает [**тспи \_ Линедропонклосе**](./tspi-linedroponclose.md) или [**тспи \_ линедроп**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop), поставщик услуг, в конечном итоге, должен отправить \_ неактивное сообщение Линекаллстате для связанного вызова (если только [**тспи \_ линеклосекалл**](/windows/win32/api/tspi/nf-tspi-tspi_lineclosecall) не вызывался первым), поэтому мониторы в вызове могут быть очищены. Когда последний монитор вызвал функцию [**линедеаллокатекалл**](/windows/win32/api/tapi/nf-tapi-linedeallocatecall) , TAPI вызывает функцию **тспи \_ линеклосекалл** ; любые ожидающие операции должны быть завершены или завершаться и [**асинхронно \_**](/windows/win32/api/tspi/nc-tspi-async_completion) вызываться, как описано выше.

 

 
