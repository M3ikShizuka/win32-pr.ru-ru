---
description: Интерактивная природа телефонии требует, чтобы TAPI был операционной средой в режиме реального времени.
ms.assetid: b8512588-ec28-4fbe-b47f-b900e2dba1f2
title: Синхронная или асинхронная модель
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 354bc8e32cdd1bb2bcefac0fe3e4d77361f3be9e37cd6a1549aa157d4b997f43
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119975524"
---
# <a name="synchronousasynchronous-model"></a>Синхронная или асинхронная модель

Интерактивная природа телефонии требует, чтобы TAPI был операционной средой в режиме реального времени. Многие функции TAPI должны быстро завершить работу и вернуть результаты в приложение в синхронном режиме. Другие функции (например, набор номера) не могут быть выполнены как можно быстрее и поэтому работают асинхронно.

Операции телефонии выполняются синхронно или асинхронно. Эти две модели различаются следующим образом. *Синхронные функции* выполняют весь запрос, прежде чем потоку вызывающего объекта будет разрешено возвращать значение из вызова функции. *Асинхронные функции* возвращают значение до того, как запрос будет выполнен полностью. После последующего завершения асинхронного запроса поставщик услуг сообщает о завершении, вызвав процедуру обратного вызова, изначально предоставленную TAPI в начале последовательности инициализации.

-   В качестве первого параметра асинхронные операции имеют параметр с именем *дврекуестид* определенного типа. [ \_ ИД запроса](./drv-requestid.md) . Такая операция выполняет часть своей обработки в вызове функции и оставшуюся часть ее обработки в независимом потоке выполнения после возвращения вызова функции. Когда функция возвращает значение, возвращается отрицательный результат ошибки или (положительный) *дврекуестид* , переданный в вызове функции. Отрицательный результат ошибки указывает на то, что операция завершена (и завершилась ошибкой). Возвращаемый положительный *дврекуестид* указывает, что операция продолжится в отдельном потоке. В этом случае поставщик услуг в конечном итоге вызывает [**асинхронную процедуру \_ завершения**](/windows/win32/api/tspi/nc-tspi-async_completion) , передавая *дврекуестид* и код результата, чтобы указать результат операции. Код результата равен нулю для успешного выполнения или одного из того же набора (отрицательных) результатов ошибки. В любом случае поставщик услуг не должен возвращать ноль или любое положительное значение, кроме *дврекуестид* , из функции, обозначенной как асинхронная, так как это может привести к непредвиденным результатам. Поставщики услуг всегда должны копировать входные данные из памяти приложения в память поставщика услуг перед возвратом из асинхронной функции.
-   В синхронных операциях не *дврекуестид* в качестве первого параметра. Такая операция выполняет всю обработку в потоке выполнения вызывающего объекта, возвращая окончательный результат при возврате. Результат равен нулю для успешного выполнения или отрицательного кода ошибки. Поставщик услуг не вызывает [**асинхронное \_ Завершение**](/windows/win32/api/tspi/nc-tspi-async_completion) для синхронных операций.

Интересно учитывать время обратного вызова "завершение" относительно момента возврата исходного запроса. Обычный асинхронный запрос будет реализован поставщиком услуг, как в следующем псевдокоде:

``` syntax
Some_request(Request_ID, ...) {
  check parameters for validity
  check device state for validity
  store Request_ID for Completion Interrupt Handler's use
  manipulate device registers to start physical operation
  return Request_ID  // to indicate asynch operation
}
Operation Completion Interrupt Handler: {
  if operation was successful then
    call "completion" callback passing Request_ID and "success"
  else
    call "completion" callback passing Request_ID and "error num"
  endif
}
```

Если операция выполняется очень быстро (или если исходный запрос возвращается очень медленно), то возможно, что обработчик прерываний, выполняемый при завершении физической операции, может быть запущен до возврата исходного запроса приложению или даже к TAPI. Такое поведение разрешено. TAPI гарантирует, что окончательное уведомление о завершении приложения будет доставлено после возврата исходного запроса.

**Интерфейс TAPI 2. x:** Список состояний, которые каждая из функций завершает синхронно или асинхронно отображаются в [справочнике по быстрой функции TAPI](./tapi-quick-function-reference.md).

 

 
