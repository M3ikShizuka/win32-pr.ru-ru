---
title: Вызов Срсетресторепоинт
description: Приложение может создать точку восстановления, прежде чем она приведет к существенному изменению системы, например к установке, удалению или обновлению компонентов.
ms.assetid: 77981e75-8c3f-4ecc-82f4-e88d68df661a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b877c4fe73bcedad363bb4c9cc770a9638550dbd
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103778518"
---
# <a name="calling-srsetrestorepoint"></a>Вызов Срсетресторепоинт

Приложение может создать точку восстановления, прежде чем она приведет к существенному изменению системы, например к установке, удалению или обновлению компонентов.

Установщики должны создать точку восстановления непосредственно перед установкой, вызвав функцию [**срсетресторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) с элементом **двевенттипе** в наборе структуры [**ресторепоинтинфо**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-restorepointinfoa) , чтобы начать \_ \_ изменение системы. Чтобы уведомить восстановление системы о завершении установки, вызовите **срсетресторепоинт** с параметром **ДВЕВЕНТТИПЕ** , чтобы завершить \_ \_ изменение системы.

Если пользователь отменяет установку приложения, установщик может удалить точку восстановления, созданную после начала установки. Удаление точки восстановления является необязательным и может препятствовать восстановлению после непреднамеренного изменения, внесенного установщиком во время отмены. Если установщик предназначен для удаления точки восстановления, он может вызвать функцию [**срремовересторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srremoverestorepoint) или вызвать [**срсетресторепоинт**](/windows/desktop/api/SRRestorePtAPI/nf-srrestoreptapi-srsetrestorepointa) с параметром **двресторепоинттипе** Set в отмененную \_ операцию, **Двевенттипе** установить в конец \_ системного \_ изменения, а **ллсекуенценумбер** задать значение, возвращенное начальным вызовом **SRSetRestorePoint**.

**Windows 8:  **

Новый раздел реестра позволяет разработчикам приложений изменять частоту создания точек восстановления.

Приложения должны создать этот ключ, чтобы использовать его, так как он не будет существовать в системе. Если ключ не существует, по умолчанию будет применено следующее. Если приложение вызывает функцию **срсетресторепоинт** для создания точки восстановления, Windows пропускает создание этой новой точки восстановления, если в течение последних 24 часов были созданы какие-либо точки восстановления. Восстановление системы задает для элемента **иисекуенценумбер** структуры [**статемгрстатус**](/windows/win32/api/srrestoreptapi/ns-srrestoreptapi-statemgrstatus) порядковый номер точки восстановления, созданной ранее в день, и задает для элемента **нстатус** значение **\_ Success Error**. Функция **срсетресторепоинт** возвращает **значение true**.

Разработчики могут создавать приложения, которые создают  значение DWORD **системресторепоинткреатионфрекуенци** в разделе реестра **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**. Значение этого раздела реестра может изменить частоту создания точки восстановления. Значение этого раздела реестра может изменить частоту создания точки восстановления.

Если приложение вызывает **срсетресторепоинт** для создания точки восстановления, а значение раздела реестра равно 0, восстановление системы не пропускает создание новой точки восстановления.

Если приложение вызывает **срсетресторепоинт** для создания точки восстановления, а значение раздела реестра — целое число N, восстановление системы пропускает создание новой точки восстановления, если какие-либо точки восстановления были созданы в течение предыдущих N минут.

**Windows 8:  **

Восстановление системы, работающее в Windows 8, наблюдает за файлами на загрузочном томе, которые относятся только к восстановлению системы. Моментальные снимки загрузочного тома, созданного с помощью восстановления системы, работающего в Windows 8, могут быть удалены, если моментальный снимок впоследствии предоставляется более ранней версией Windows. Обратите внимание, что хотя существует только один системный том, для каждой операционной системы в системе с несколькими операционными системами имеется один загрузочный том.

Разработчики могут создавать приложения, которые создают  значение DWORD **скопеснапшотс** в разделе реестра **HKLM \\ Software \\ Microsoft \\ Windows NT \\ CurrentVersion \\ SystemRestore**. Если этот раздел реестра имеет значение 0, то средство восстановления системы создает моментальные снимки загрузочного тома так же, как в предыдущих версиях Windows. Если это значение будет удалено, восстановление системы, запущенное в Windows 8, возобновляет создание моментальных снимков, которые отслеживают файлы в загрузочном томе, относящиеся только к восстановлению системы.

Пример см. в разделе [Использование восстановления системы](using-system-restore.md).

 

 




