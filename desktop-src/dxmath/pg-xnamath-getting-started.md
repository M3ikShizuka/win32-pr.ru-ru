---
title: Приступая к работе (Директксмас)
description: Библиотека Директксмас реализует оптимальный и переносимый интерфейс для арифметических и линейных операций с векторами с плавающей запятой одиночной точности (двумерные, трехмерные и 4D) или матрицы (3 × 3 и 4 × 4).
ms.assetid: 9972e382-7a0f-88a7-ad44-18521af3520d
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05e599acfc498e28b33acfc5bbbba2bea5669d2a
ms.sourcegitcommit: 3bdf30edb314e0fcd17dc4ddbc70e4ec7d3596e6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/10/2021
ms.locfileid: "104351022"
---
# <a name="getting-started-directxmath"></a>Приступая к работе (Директксмас)

Библиотека Директксмас реализует оптимальный и переносимый интерфейс для арифметических и линейных операций с векторами с плавающей запятой одиночной точности (двумерные, трехмерные и 4D) или матрицы (3 × 3 и 4 × 4). Библиотека имеет ограниченную поддержку для операций целочисленного вектора. Эти операции широко используются в отрисовке и анимации с помощью графических программ. Нет поддержки векторов двойной точности (включая длинные, разомкнутые или байты) и ограниченные операции целочисленного вектора.

Библиотека доступна на различных платформах Windows. Так как библиотека предоставляет функции, недоступные ранее, эта версия заменяет следующие библиотеки:

-   Математическая библиотека Xbox, предоставляемая заголовком Ксбоксмас. h
-   Библиотека D3DX 9, предоставляемая библиотеками DLL D3DX 9
-   D3DX 10 Math Library, предоставляемая через библиотеки DLL D3DX 10
-   Библиотека XNA Math, предоставляемая заголовком кснамас. h в пакете SDK DirectX и Xbox 360 XDK

В этих разделах описаны основы начала работы.

-   [Загрузить](#download)
-   [Требования к системе во время выполнения](#run-time-system-requirements)
-   [Общие сведения о проектировании](#design-overview)
-   [Соглашение матрицы](#matrix-convention)
-   [Базовое использование](#basic-usage)
-   [Рекомендации по использованию типов](#type-usage-guidelines)
-   [Создание векторов](#creating-vectors)
    -   [КОНСТАНТНЫЕ ВЕКТОРЫ](#constant-vectors)
    -   [ВЕКТОРЫ ИЗ ПЕРЕМЕННЫХ](#vectors-from-variables)
    -   [ВЕКТОРЫ ИЗ ВЕКТОРОВ](#vectors-from-vectors)
    -   [ВЕКТОРЫ ИЗ ПАМЯТИ](#vectors-from-memory)
-   [Извлечение компонентов из векторов](#extracting-components-from-vectors)
-   [См. также](#related-topics)

## <a name="download"></a>Скачать

Библиотека Директксмас включена в Windows SDK. Кроме того, его можно скачать из [GitHub/Microsoft/директксмас](https://github.com/Microsoft/DirectXMath). Этот сайт также содержит связанные образцы проектов.

## <a name="run-time-system-requirements"></a>Run-Time требования к системе

Библиотека Директксмас использует специальные инструкции процессора для векторных операций, когда они доступны. Чтобы предотвратить создание программой ошибок "неизвестное исключение инструкции", проверьте поддержку процессора, вызвав [**ксмверификпусуппорт**](/windows/win32/api/directxmath/nf-directxmath-xmverifycpusupport) перед использованием библиотеки директксмас.

Ниже приведены базовые требования к поддержке во время выполнения библиотеки Директксмас.

-   Для компиляции по умолчанию на платформе Windows (x86/x64) требуется поддержка инструкций SSE/SSE2.
-   Для обеспечения соответствия по умолчанию на платформе Windows RT необходима поддержка инструкций ARM-NEON.
-   Для компиляции с [**\_ XM \_ не определены \_ встроенные функции \_ , поэтому**](ovw-xnamath-reference-directives.md) требуется только стандартная поддержка операций с плавающей запятой.

> [!Note]  
> При вызове [**ксмверификпусуппорт**](/windows/win32/api/directxmath/nf-directxmath-xmverifycpusupport)включите <Windows. h> перед включением <директксмас. h>. Это единственная функция библиотеки, которая требует любого содержимого из <Windows. h> поэтому не нужно включать <Windows. h> в каждом модуле, использующем <Директксмас. h>.

 

## <a name="design-overview"></a>Общие сведения о проектировании

Библиотека Директксмас в основном поддерживает язык программирования C++. Библиотека реализуется с помощью встроенных подпрограмм в файлах заголовков, Директксмас \* . inl, директкспаккедвектор. inl и директксколлисион. inl. В этой реализации используются высокопроизводительные встроенные функции компилятора.

Библиотека Директксмас предоставляет следующие сведения:

-   Реализация с использованием встроенных функций SSE/SSE2.
-   Реализация без встроенных функций.
-   Реализация с использованием встроенных функций ARM-NEON.

Так как библиотека доставляется с помощью файлов заголовков, используйте исходный код для настройки и оптимизации собственного приложения.

## <a name="matrix-convention"></a>Соглашение матрицы

Директксмас использует основные матрицы строк, векторы строк и предварительное умножение. Правой или левой определяется используемой версией функции (RH и LH), в противном случае функция работает с координатами левого или правого представления.

Для справки в Direct3D используется историческая система координат, основные матрицы строк, векторы строк и предварительное умножение. Современные Direct3D не имеют строгого требования для левых и правых координат, и обычно HLSL шейдеров по умолчанию используются для использования основных матриц. Дополнительные сведения см. в разделе [HLSL Matrix Order](/windows/desktop/direct3dhlsl/dx-graphics-hlsl-per-component-math) .

## <a name="basic-usage"></a>Основное использование

Для использования функций библиотеки Директксмас включите заголовки Директксмас. h, Директкспаккедвектор. h, Директксколорс. h и/или Директксколлисион. h. Заголовки находятся в пакете средств разработки программного обеспечения Windows для приложений Магазина Windows.

## <a name="type-usage-guidelines"></a>Рекомендации по использованию типов

Типы [**ксмвектор**](xmvector-data-type.md) и [**ксмматрикс**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) — это рабочие Кони для библиотеки директксмас. Каждая операция потребляет или создает данные этих типов. Работа с ними является ключом к использованию библиотеки. Однако, поскольку Директксмас использует наборы инструкций SIMD, эти типы данных подвержены ряду ограничений. Важно понимать эти ограничения, если вы хотите использовать функции Директксмас.

Вы должны рассматривать [**ксмвектор**](xmvector-data-type.md) как прокси-сервер для регистрации оборудования SIMD и [**ксмматрикс**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) в качестве прокси-сервера для логической группировки четырех реестров оборудования SIMD. Эти типы снабжаются заметками, чтобы указать, что для правильной работы требуется 16-байтное выравнивание. Компилятор автоматически поместит их в стек, если они используются в качестве локальной переменной, или поместить их в сегмент данных, если они используются в качестве глобальной переменной. С соответствующими соглашениями они также могут безопасно передаваться в функцию в качестве параметров (см. Дополнительные сведения [о соглашениях о вызовах](pg-xnamath-internals.md) ).

Однако выделения из кучи являются более сложными. Таким образом, необходимо соблюдать осторожность при использовании [**ксмвектор**](xmvector-data-type.md) или [**ксмматрикс**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) в качестве члена класса или структуры для выделения из кучи. В Windows x64 все выделения кучи имеют размер 16 байт, но для Windows x86 они имеют только 8-байтное соответствие. Существуют варианты выделения структур из кучи с выравниванием по 16 байт (см. раздел [правильное выравнивание выделений](pg-xnamath-optimizing.md)). Для программ на C++ можно использовать оператор new/delete/New \[ \] /DELETE \[ \] Overloads (как глобально, так и для конкретных классов), чтобы при необходимости обеспечить оптимальное выравнивание.

> [!Note]  
> В качестве альтернативы реализации выравнивания в классе C++ путем перегрузки New или DELETE можно использовать [идиому Пимпл](https://en.wikipedia.org/wiki/Opaque_pointer). Если вы гарантируете, что класс **Impl** будет полностью согласован по внутреннему [**\_ согласованию \_ malloc**](/cpp/c-runtime-library/reference/aligned-malloc) , можно свободно использовать согласованные типы внутри внутренней реализации. Это хороший вариант, если класс Public является среда выполнения Windows классом ссылки или предназначен для использования с [**std:: Shared \_ ptr<>**](/cpp/standard-library/shared-ptr-class), что в противном случае может привести к нарушению выравнивания.

 

Однако часто бывает проще и более компактно, чтобы не использовать [**ксмвектор**](xmvector-data-type.md) или [**ксмматрикс**](/windows/win32/api/directxmath/ns-directxmath-xmmatrix) непосредственно в классе или структуре. Вместо этого следует использовать [**XMFLOAT3**](/windows/win32/api/directxmath/ns-directxmath-xmfloat3), [**XMFLOAT4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4), [**XMFLOAT4X3**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x3), [**XMFLOAT4X4**](/windows/win32/api/directxmath/ns-directxmath-xmfloat4x4)и т. д. в качестве членов структуры. Кроме того, можно использовать функции [векторной загрузки](ovw-xnamath-reference-functions-load.md) и [векторного хранилища](ovw-xnamath-reference-functions-storage.md) для эффективного перемещения данных в локальные переменные **ксмвектор** или **ксмматрикс** , выполнения вычислений и сохранения результатов. Существуют также функции потоковой передачи ([**XMVector3TransformStream**](/windows/win32/api/directxmath/nf-directxmath-xmvector3transformstream), [**XMVector4TransformStream**](/windows/win32/api/directxmath/nf-directxmath-xmvector4transformstream)и т. д.), которые эффективно работают непосредственно с массивами этих типов данных.

## <a name="creating-vectors"></a>Создание векторов

### <a name="constant-vectors"></a>КОНСТАНТНЫЕ ВЕКТОРЫ

Многие операции используют константы в вычислениях векторного типа, и существует несколько способов загрузить [**ксмвектор**](xmvector-data-type.md) с нужными значениями.

-   При загрузке скалярной константы во все элементы [**ксмвектор**](xmvector-data-type.md)используйте [**ксмвекторрепликате**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicate) или [**ксмвекторрепликатеинт**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicateint).
    ```
    XMVECTOR vFive = XMVectorReplicate( 5.f );
    ```

    

-   При использовании константы Vector с различными фиксированными значениями в качестве [**ксмвектор**](xmvector-data-type.md)используйте структуры [**XMVECTORF32**](xmvectorf32-data-type.md), [**XMVECTORU32**](xmvectoru32-data-type.md), **XMVECTORI32** или [**XMVECTORU8**](xmvectoru8-data-type.md) . На них можно ссылаться непосредственно в любом месте, где бы вы ни передали значение **ксмвектор** .
    ```
    static const XMVECTORF32 vFactors = { 1.0f, 2.0f, 3.0f, 4.0f };
    ```

    

    > [!Note]  
    > Не используйте списки инициализаторов непосредственно с [**ксмвектор**](xmvector-data-type.md) (т. е. ксмвектор v = {1.0 f, 2.0 f, 3.0 f, 4.0 f}). Такой код неэффективен и не является переносимым на всех платформах, поддерживаемых Директксмас.

     

-   Директксмас включает ряд предварительно определенных глобальных констант, которые можно использовать в коде (g \_ ксмоне, g \_ XMOne3, g \_ ксмтво, g \_ ксмонехалф, g \_ ксмхалфпи, g \_ ксмпи и т. д.). Выполните поиск значений **ксмглобалконстант** в заголовке директксмас. h.
-   Существует набор констант Vector для распространенных цветов RGB (красный, зеленый, синий, желтый и т. д.). Дополнительные сведения об этих константах вектора см. в разделе Директксколорс. h и пространство имен DirectX:: Colors.

### <a name="vectors-from-variables"></a>ВЕКТОРЫ ИЗ ПЕРЕМЕННЫХ

-   Если создается вектор из одной скалярной переменной, см. раздел [**ксмвекторрепликате**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicate) and [**ксмвекторрепликатеинт**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicateint).
    ```
    XMVECTOR v = XMVectorReplicate( f  );
    ```

    

-   Если создается вектор из четырех скалярных переменных, см. раздел [**ксмвекторсет**](/windows/win32/api/directxmath/nf-directxmath-xmvectorset) and [**ксмвекторсетинт**](/windows/win32/api/directxmath/nf-directxmath-xmvectorsetint).
    ```
    XMVECTOR v = XMVectorSet( fx, fy, fz, fw );
    ```

    

### <a name="vectors-from-vectors"></a>ВЕКТОРЫ ИЗ ВЕКТОРОВ

-   При создании вектора из другого вектора с заданным для переменной компонентом можно использовать [функции метода доступа Vector](ovw-xnamath-reference-functions-accessors.md).
    ```
    XMVECTOR v2 = XMVectorSetW( v1, fw );
    ```

    

-   При создании вектора из другого вектора с единственным реплицируемым компонентом используйте [**ксмвекторсплаткс**](/windows/win32/api/directxmath/nf-directxmath-xmvectorsplatx), [**ксмвекторсплати**](/windows/win32/api/directxmath/nf-directxmath-xmvectorsplaty), [**ксмвекторсплатз**](/windows/win32/api/directxmath/nf-directxmath-xmvectorsplatz)и [**ксмвекторсплатв**](/windows/win32/api/directxmath/nf-directxmath-xmvectorsplatw).
    ```
    XMVECTOR vz = XMVectorSplatZ( v );
    ```

    

-   Если создать вектор из другого вектора или пары векторов с переупорядоченными компонентами, см. раздел [**ксмвекторсвиззле**](/windows/win32/api/directxmath/nf-directxmath-xmvectorswizzle) and [**ксмвекторпермуте**](/windows/win32/api/directxmath/nf-directxmath-xmvectorpermute).
    ```
    XMVECTOR v2 = XMVectorSwizzle<XM_SWIZZLE_Z, XM_SWIZZLE_Y, XM_SWIZZLE_W, XM_SWIZZLE_X>( v1 );

    XMVECTOR v3 = XMVectorPermute<XM_PERMUTE_0W, XM_PERMUTE_1X, XM_PERMUTE_0X, XM_PERMUTE_1Z>( v1, v2 );
    ```

    

### <a name="vectors-from-memory"></a>ВЕКТОРЫ ИЗ ПАМЯТИ

-   Сведения о загрузке одного значения с плавающей запятой из памяти см. в разделе [**ксмвекторрепликатептр**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicateptr), [**ксмвекторрепликатеинтптр**](/windows/win32/api/directxmath/nf-directxmath-xmvectorreplicateintptr), [**ксмлоадфлоат**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat)и [**ксмлоадинт**](/windows/win32/api/directxmath/nf-directxmath-xmloadint).
-   Распространенные способы загрузки массивов с плавающей запятой: [**XMLoadFloat2**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat2), [**XMLoadFloat3**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat3), [**XMLoadFloat4**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat4), [**XMLoadFloat3x3**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat3x3), [**XMLoadFloat4x3**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat4x3)и [**XMLoadFloat4x4**](/windows/win32/api/directxmath/nf-directxmath-xmloadfloat4x4).
-   Директксмас включает обширный набор типов и связанных нагрузок и магазинов для обработки различных структур данных и распространенных форматов GPU. См. раздел [векторная нагрузка](ovw-xnamath-reference-functions-load.md) и [хранилище векторов](ovw-xnamath-reference-functions-storage.md).

## <a name="extracting-components-from-vectors"></a>Извлечение компонентов из векторов

Обработка SIMD наиболее эффективна, когда данные загружаются в регистры SIMD и полностью обрабатываются перед извлечением результатов. Преобразование между скалярными и векторными формами неэффективно, поэтому рекомендуется делать это только при необходимости. По этой причине функции в библиотеке Директксмас, возвращающие скалярное значение, возвращаются в векторной форме, где скалярный результат реплицируется по результирующему вектору (т. е. [**XMVector2Dot**](/windows/win32/api/directxmath/nf-directxmath-xmvector2dot), [**XMVector3Length**](/windows/win32/api/directxmath/nf-directxmath-xmvector3length)и т. д.). Однако если вам нужны скалярные значения, вот несколько вариантов:

-   При вычислении одного скалярного ответа необходимо использовать [функции метода доступа Vector](ovw-xnamath-reference-functions-accessors.md) :
    ```
    float f = XMVectorGetX( v );
    ```

    

-   Если требуется извлечь несколько компонентов вектора, рассмотрите возможность сохранения вектора в структуре памяти и считывания их обратно. Пример:
    ```
    XMFLOAT4A t;
    XMStoreFloat4A( &t, v );
    // t.x, t.y, t.z, and t.w can be individually accessed now
    ```

    

-   Наиболее эффективная обработка векторной обработки заключается в использовании потоковой передачи из памяти, когда входные данные загружаются из памяти (с помощью [функций векторной загрузки](ovw-xnamath-reference-functions-load.md)), полностью обрабатываются в SIMD-форме, а затем записываются в память (с помощью [функций векторного хранилища](ovw-xnamath-reference-functions-storage.md)).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Директксмас по программированию](ovw-xnamath-progguide.md)
</dt> </dl>

 

 