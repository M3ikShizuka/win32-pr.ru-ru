---
description: Каждый новый поток или волокон получает собственное пространство стека, состоящее из зарезервированных и первоначальных выделенных памяти.
ms.assetid: abb2d5c1-040b-4c36-aae5-3517b6a8c540
title: Размер стека потока
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ff392577d529ab03a3859a0c6b0a94057ff8d8e0dc3c09fef86176d5c8950ef
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120031414"
---
# <a name="thread-stack-size"></a>Размер стека потока

Каждый новый поток или волокон получает собственное пространство стека, состоящее из зарезервированных и первоначальных выделенных памяти. Зарезервированный объем памяти представляет общее выделение стека в виртуальной памяти. Таким образом, зарезервированный размер ограничен диапазоном виртуальных адресов. Изначально зафиксированные страницы не используют физическую память, пока не будет создана ссылка; Однако они удаляют страницы из общего количества фиксаций системы, то есть размера файла подкачки и размера физической памяти. Система фиксирует дополнительные страницы из зарезервированной памяти стека по мере необходимости, пока стек не достигнет зарезервированного размера минус одну страницу (которая используется в качестве охранной страницы для предотвращения переполнения стека), или системе не хватает памяти, чтобы выполнить операцию не удалось.

Лучше всего выбрать как можно меньше размер стека и зафиксировать стек, необходимый для надежной работы потока или волокон. Каждая страница, зарезервированная для стека, не может использоваться для других целей.

Стек освобождается при выходе его потока. Он не освобождается, если поток завершается другим потоком.

Размер по умолчанию для зарезервированного и первоначально зафиксированной памяти стека указывается в заголовке исполняемого файла. Создание потока или волокон завершается сбоем, если недостаточно памяти для резервирования или фиксации запрошенного количества байтов. Размер резервирования стека по умолчанию, используемый компоновщиком, составляет 1 МБ. Чтобы указать другой размер резервирования стека по умолчанию для всех потоков и волокон, используйте инструкцию STACKSIZE в файле определения модуля (DEF). Операционная система округляет указанный размер до ближайшего числа, кратного степени гранулярности распределения системы (обычно 64 КБ). Чтобы получить гранулярность выделения текущей системы, используйте функцию [**жетсистеминфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) .

Чтобы изменить первоначально зафиксированное пространство стека, используйте параметр *двстакксизе* функции [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**креатеремотесреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)или [**креатефибер**](/windows/desktop/api/WinBase/nf-winbase-createfiber) . Это значение округляется до ближайшей страницы. Как правило, резервный размер является резервным размером по умолчанию, указанным в заголовке исполняемого файла. Однако если первоначально зафиксированный размер, заданный параметром *двстакксизе* , больше или равен размеру резерва по умолчанию, то резервный размер равен этому новому размеру фиксации, округленному до ближайшего числа, кратного 1 МБ.

Чтобы изменить зарезервированный размер стека, установите параметр *двкреатионфлагс* для [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) или [**креатеремотесреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) в качестве значения параметра размера стека \_ \_ \_ — \_ \_ резервирование и используйте параметр *двстакксизе* . В этом случае исходный зафиксированный размер является размером по умолчанию, указанным в заголовке исполняемого файла. Для волокон используйте параметр *двстаккресервесизе* объекта [**креатефиберекс**](/windows/desktop/api/WinBase/nf-winbase-createfiberex). Зафиксированный размер указывается в параметре *двстакккоммитсизе* .

Функция [**сетсреадстаккгуаранти**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) устанавливает минимальный размер стека, связанного с вызывающим потоком или волокно, который будет доступен во время любых исключений переполнения стека.

 

 
