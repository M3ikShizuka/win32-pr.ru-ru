---
description: Объект задания позволяет управлять группой процессов как единым целым. Объекты заданий являются намаблеными, защищаемыми объектами, совместно используемые объекты, которые управляют атрибутами связанных с ними процессов.
ms.assetid: 59296384-5e78-44dd-8019-f1df6668928b
title: Объекты заданий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07e6d9758faf2b66f047ca60dbba91601b202b4c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104345472"
---
# <a name="job-objects"></a>Объекты заданий

*Объект задания* позволяет управлять группами процессов как единым целым. Объекты заданий являются намаблеными, защищаемыми объектами, совместно используемые объекты, которые управляют атрибутами связанных с ними процессов. Операции, выполняемые объектом задания, влияют на все связанные с ним процессы. Примеры включают в себя применение ограничений, таких как размер рабочего набора и приоритет процесса или завершение всех процессов, связанных с заданием.

-   [Создание заданий](#creating-jobs)
-   [Управление процессами в заданиях](#managing-processes-in-jobs)
-   [Ограничения заданий и уведомления](#job-limits-and-notifications)
-   [Учет ресурсов для заданий](#resource-accounting-for-jobs)
-   [Управление объектами заданий](#managing-job-objects)
-   [Управление деревом процессов, использующим объекты заданий](#managing-a-process-tree-that-uses-job-objects)

## <a name="creating-jobs"></a>Создание заданий

Чтобы создать объект задания, используйте функцию [**креатежобобжект**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) . При создании задания ни один из процессов не связан с этим заданием.

Чтобы связать процесс с заданием, используйте функцию [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) . После того как процесс связан с заданием, связь не может быть нарушена. Процесс может быть связан с более чем одним заданием в иерархии вложенных заданий. Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).

**Windows 7, Windows server 2008 R2, Windows XP с пакетом обновления 3 (SP3), Windows server 2008, Windows Vista и Windows server 2003:** Процесс может быть связан только с одним заданием. Задания не могут быть вложенными. Возможность вложения заданий была добавлена в Windows 8 и Windows Server 2012.

При вызове функции [**креатежобобжект**](/windows/desktop/api/WinBase/nf-winbase-createjobobjecta) можно указать дескриптор безопасности для объекта задания. Дополнительные сведения см. в разделе [Задание безопасности и прав доступа объекта задания](job-object-security-and-access-rights.md).

## <a name="managing-processes-in-jobs"></a>Управление процессами в заданиях

После того как процесс связан с заданием, по умолчанию все дочерние процессы, создаваемые с помощью [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) , также связываются с заданием. (Дочерние процессы, созданные с помощью [**Win32 \_ Process. Create**](../cimwin32prov/create-method-in-class-win32-process.md) , не связаны с заданием.) Это поведение по умолчанию можно изменить, установив для задания ограничение на объекты задания для расширенного ограничения \_ \_ \_ бреакавай \_ ОК или \_ объект задания \_ ограничение \_ автоматической \_ бреакавай \_ ОК.

-   Если в задании превышено ограничение на количество объектов задания с расширенным ограничением \_ \_ \_ бреакавай \_ ОК, а родительский процесс был создан с помощью \_ \_ флага создания бреакавай из \_ задания, то дочерние процессы родительского процесса не будут связаны с заданием.
-   Если в задании превышено ограничение \_ на \_ число \_ \_ бреакавай ОК для задания \_ , то дочерние процессы любого родительского процесса, связанного с заданием, не будут связаны с этим заданием. Не требуется создавать родительские процессы с \_ флагом Create бреакавай On \_ \_ Job.

Если задание является вложенным, параметры бреакавай родительских заданий в иерархии влияют на то, связаны ли дочерние процессы с другим заданием в иерархии. Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).

Чтобы определить, выполняется ли процесс в задании, используйте функцию [**испроцессинжоб**](/windows/win32/api/jobapi/nf-jobapi-isprocessinjob) .

Чтобы завершить все процессы, связанные в данный момент с объектом задания, используйте функцию [**терминатежобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-terminatejobobject) .

## <a name="job-limits-and-notifications"></a>Ограничения заданий и уведомления

Задание может применять такие ограничения, как размер рабочего набора, приоритет процесса и ограничение времени окончания задания для каждого процесса, связанного с заданием. Если процесс, связанный с заданием, попытается увеличить размер рабочего набора или приоритет процесса по сравнению с ограничением, установленным заданием, функция вызывается удачно, но не обрабатывается автоматически. Задание также может задавать ограничения, которые активируют уведомление, если они превышены, но позволяют продолжить выполнение задания.

Чтобы задать ограничения для задания, используйте функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) . Список возможных ограничений, которые можно задать для задания, см. в следующих разделах:

-   [**\_ \_ сведения о базовом ОГРАНИЧЕНии жобобжект \_**](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_limit_information)
-   [**\_базовые \_ ограничения ПОЛЬЗОВАТЕЛЬСКОГО интерфейса \_ жобобжект**](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_ui_restrictions)
-   [**\_ \_ \_ сведения о контроле скорости ЦП жобобжект \_**](/windows/desktop/api/Winnt/ns-winnt-jobobject_cpu_rate_control_information)
-   [**\_ \_ сведения о расширенном ОГРАНИЧЕНии жобобжект \_**](/windows/desktop/api/WinNT/ns-winnt-jobobject_extended_limit_information)
-   [**\_ \_ сведения о лимите уведомлений жобобжект \_**](/windows/desktop/api/WinNT/ns-winnt-jobobject_notification_limit_information)

Ограничения безопасности должны устанавливаться отдельно для каждого процесса, связанного с объектом задания. Дополнительные сведения см. в разделе [Обработка безопасности и права доступа](process-security-and-access-rights.md).

**Windows XP с пакетом обновления 3 (SP3) и Windows Server 2003:** Функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) можно использовать для установки ограничений безопасности для всех процессов, связанных с объектом Job. Начиная с Windows Vista ограничения безопасности должны устанавливаться отдельно для каждого процесса, связанного с объектом задания.

Если задание является вложенным, родительские задания в иерархии влияют на ограничение, применяемое для задания. Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).

Если у задания есть связанный с ним порт завершения ввода-вывода, он может получать уведомления при превышении определенных пределов заданий. Система отправляет сообщения на порт завершения при превышении предела или возникновении некоторых других событий. Чтобы связать порт завершения с заданием, используйте функцию [**сетинформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-setinformationjobobject) с классом сведений об объекте задания **жобобжектассоЦиатекомплетионпортинформатион** и указателем на структуру [**\_ \_ \_ порта завершения связи жобобжект**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port) . Это лучше сделать, если задание неактивно, чтобы уменьшить вероятность отсутствия уведомлений для процессов, состояние которых изменяется во время сопоставления порта завершения.

Все сообщения отправляются непосредственно из задания, как если бы задание вызывало функцию [**PostQueuedCompletionStatus**](/windows/win32/api/ioapiset/nf-ioapiset-postqueuedcompletionstatus) . Чтобы получить сообщения, поток должен отслеживать порт завершения с помощью функции [**жеткуеуедкомплетионстатус**](/windows/win32/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) . Обратите внимание, что, за исключением ограничений, заданных в классе сведений **жобобжектнотификатионлимитинформатион** , Доставка сообщений на порт завершения не гарантируется. невозможность прибытия сообщения не обязательно означает, что событие не произошло. Уведомления об ограничениях, установленных с помощью **жобобжектнотификатионлимитинформатион** , гарантированно поступают на порт завершения. Список возможных сообщений см. в разделе [**жобобжект- \_ \_ \_ порт завершения связи**](/windows/desktop/api/WinNT/ns-winnt-jobobject_associate_completion_port).

## <a name="resource-accounting-for-jobs"></a>Учет ресурсов для заданий

Объект задания записывает основные данные учета для всех связанных с ней процессов, включая завершенные. Чтобы получить эти сведения об учетных данных, используйте функцию [**куеринформатионжобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-queryinformationjobobject) . Список данных учета, сохраняемых для задания, см. в следующих разделах:

-   [**ЖОБОБЖЕКТ \_ основные \_ \_ сведения о учете**](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_accounting_information)
-   [**\_ \_ \_ \_ учетные данные жобобжект Basic и IO \_**](/windows/desktop/api/WinNT/ns-winnt-jobobject_basic_and_io_accounting_information)

Если объект задания является вложенным, данные учета для каждого дочернего задания суммируются в родительском задании. Дополнительные сведения см. в разделе [вложенные задания](nested-jobs.md).

## <a name="managing-job-objects"></a>Управление объектами заданий

Состояние объекта задания задается сигнальным, когда все его процессы завершаются из-за превышения указанного предела времени завершения задания. Используйте [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject) или [**WaitForSingleObjectEx**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobjectex) для отслеживания объекта задания для этого события.

Чтобы получить маркер для существующего объекта задания, используйте функцию [**опенжобобжект**](/windows/desktop/api/WinBase/nf-winbase-openjobobjecta) и укажите имя, присвоенное объекту при его создании. Можно открыть только именованные объекты задания.

Чтобы закрыть обработчик объекта задания, используйте функцию [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) . Задание уничтожается, когда последний его обработчик был закрыт и все связанные с ним процессы были завершены. Однако если в задании задано \_ \_ ограничение на значение \_ Kill \_ для \_ задания \_ , закрытие последнего дескриптора объекта задания завершает все связанные процессы, а затем удаляет сам объект задания. Если в вложенном задании задано \_ \_ ограничение \_ Kill \_ для объекта задания \_ \_ , заданное флагом закрытия задания, закрытие последнего дескриптора объекта задания завершает все процессы, связанные с заданием, и его дочерними заданиями в иерархии.

## <a name="managing-a-process-tree-that-uses-job-objects"></a>Управление деревом процессов, использующим объекты заданий

Начиная с Windows 8 и Windows Server 2012, приложение может использовать [вложенные задания](nested-jobs.md) для управления деревом процессов, использующим более одного объекта задания. Однако приложение, которое должно работать в Windows 7, Windows Server 2008 R2 или более ранних версиях Windows, не поддерживающих вложенные задания, должно управлять деревом процессов другими способами.

Если средство должно управлять деревом процессов, использующим объекты заданий, и нельзя использовать вложенные задания, то как средство, так и члены дерева процессов должны взаимодействовать. Используйте один из следующих методов.

-   Используйте объект задания ограничение предельного \_ \_ \_ \_ числа автоматически бреакавай \_ ОК. Если средство использует это ограничение, оно не может отслеживать все дерево процессов. Средство может отслеживать только те процессы, которые он добавляет в задание. Если эти процессы создают дочерние процессы, они не связаны с заданием. В этом случае дочерние процессы могут быть связаны с другими объектами заданий.
-   Используйте ограничение \_ объекта задания \_ ограничение \_ бреакавай \_ ОК. Если средство использует это ограничение, оно может отслеживать все дерево процесса, за исключением тех процессов, которые в дереве явным образом прерываются из дерева. Член дерева может создать дочерний процесс в новом объекте задания, вызвав функцию [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) с \_ \_ флагом Create бреакавай FROM \_ задания, а затем вызвав функцию [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject) . В противном случае член должен отреагировать на случаи, в которых **ассигнпроцесстожобобжект** завершается ошибкой.

    Флаг создания \_ бреакавай \_ из \_ задания не оказывает никакого влияния, если средство не отслеживает дерево. Таким образом, это предпочтительный вариант, но он требует предварительного знания отслеживаемых процессов.

-   Запретите бреакавайс любого типа, установив для параметра задания \_ \_ ограничение \_ бреакавай ОК, \_ а объект задания не \_ \_ ограничивает \_ число автоматически \_ бреакавай \_ ОК. В этом случае средство может отслеживать все дерево процессов. Однако если дочерний процесс пытается связать себя или другой дочерний процесс с заданием путем вызова [**ассигнпроцесстожобобжект**](/windows/win32/api/jobapi2/nf-jobapi2-assignprocesstojobobject), вызов завершится ошибкой. Если процесс был разработан для того, чтобы быть связанным с конкретным заданием, этот сбой может препятствовать правильной работе процесса.

 

 
