---
description: Microsoft Windows позволяет управлять доступом к объектам потока. Дополнительные сведения о безопасности см. в разделе Модель Access-Control.
ms.assetid: 72709446-5c59-4fac-8dc8-7912906ecc85
title: Безопасность потоков и права доступа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c5e14b634b9e41f592df4911211c3374a67166e36fc4735f4a90009275b5da1b
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119427714"
---
# <a name="thread-security-and-access-rights"></a>Безопасность потоков и права доступа

Microsoft Windows позволяет управлять доступом к объектам потока. Дополнительные сведения о безопасности см. в разделе [модель управления доступом](../secauthz/access-control-model.md).

При вызове функции [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa), [**параметр CreateProcessAsUser**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessasusera), [**креатепроцессвислогонв**](/windows/desktop/api/WinBase/nf-winbase-createprocesswithlogonw), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread)или [**креатеремотесреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) можно указать [дескриптор безопасности](../secauthz/security-descriptors.md) для потока. Если указано **значение NULL**, то поток получает дескриптор безопасности по умолчанию. Списки ACL в дескрипторе безопасности по умолчанию для потока поступают от основного маркера или токена олицетворения создателя.

Чтобы получить дескриптор безопасности потока, вызовите функцию [**жетсекуритинфо**](/windows/win32/api/aclapi/nf-aclapi-getsecurityinfo) . Чтобы изменить дескриптор безопасности потока, вызовите функцию [**сетсекуритинфо**](/windows/win32/api/aclapi/nf-aclapi-setsecurityinfo) .

Маркер, возвращаемый функцией [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) , имеет **потоковый \_ \_ доступ к** объекту потока. При вызове функции [**жеткуррентсреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getcurrentthread) система возвращает псеудохандле с максимальным доступом, который дескриптор безопасности потока разрешает вызывающему объекту.

Допустимые права доступа для объектов потока включают [стандартные права доступа](../secauthz/standard-access-rights.md) и некоторые зависящие от потока права доступа. В следующей таблице перечислены стандартные права доступа, используемые всеми объектами.

| Значение                           | Значение                                                                                                                                                                                                                                                                                  |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Delete** (0x00010000L)        | Требуется для удаления объекта.                                                                                                                                                                                                                                                           |
| **Чтение \_ Элемент управления** (0x00020000L) | Требуется для чтения сведений в дескрипторе безопасности объекта, не включая сведения из списка SACL. Для чтения или записи списка SACL необходимо запросить право доступа к **\_ системе \_ безопасности системы доступа** . Дополнительные сведения см. в статье [право доступа к SACL](../secauthz/sacl-access-right.md). |
| **Синхронизация** (0x00100000L)   | Право на использование данного объекта для синхронизации. Это позволяет потоку ожидать, пока объект находится в сигнальном состоянии.                                                                                                                                                                |
| **Запись \_ DAC** (0x00040000L)    | Требуется для изменения списка DACL в дескрипторе безопасности объекта.                                                                                                                                                                                                                   |
| **Запись \_ Владелец** (0x00080000L)  | Требуется для изменения владельца в дескрипторе безопасности объекта.                                                                                                                                                                                                                  |



 

В следующей таблице перечислены права доступа, зависящие от конкретного потока.



| Значение                                            | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Синхронизация** (0x00100000L)                    | Разрешает использование обработчика потока в любой из [функций ожидания](../sync/wait-functions.md).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **ПОТОК — \_ все \_ доступ**                          | Все возможные права доступа для объекта потока. **Windows Server 2003 и Windows XP:** значение флага " **поток \_ всех \_ доступа** " увеличилось на Windows Server 2008 и Windows Vista. если приложение, скомпилированное для Windows server 2008 и Windows Vista, выполняется на Windows server 2003 или Windows XP, **флаг \_ \_ доступа потока** содержит неподдерживаемые биты доступа, и функция, указывающая этот флаг, завершается **с \_ ошибкой \_ отказа в доступе**. Чтобы избежать этой проблемы, укажите минимальный набор прав доступа, необходимых для операции. Если **необходимо \_ использовать \_ поток** , задайте для **\_ Win32 \_ WinNT** минимальную операционную систему, для которой предназначено приложение (например, `#define _WIN32_WINNT _WIN32_WINNT_WINXP` ). дополнительные сведения см. [в разделе использование Windows заголовков](../winprog/using-the-windows-headers.md). <br/> |
| **Поток команд \_ ПРЯМОЕ \_ олицетворение** (0x0200)       | Требуется для потока сервера, который олицетворяет клиента.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Поток команд \_ ПОЛУЧИТЬ \_ контекст** (0x0008)                | Требуется для чтения контекста потока с помощью [**GetThreadContext**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getthreadcontext).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Поток команд \_ ОЛИЦЕТВОРЯть** (0x0100)                 | Требуется для непосредственного использования сведений о безопасности потока без их вызова с помощью механизма связи, предоставляющего службы олицетворения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Поток команд \_ \_Сведения о запросе** (0x0040)          | Требуется для чтения определенных данных из объекта потока, например кода выхода (см. [**жетекситкодесреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodethread)).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Поток команд \_ ЗАПРОС \_ ограниченных \_ данных** (0x0800) | Требуется для чтения определенных данных из объектов потока (см. [**жетпроцессидофсреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocessidofthread)). Маркеру, у которого есть право доступа к **\_ \_ информации о запросе потока** , автоматически предоставляется **\_ запрос потока \_ с ограниченными \_ сведениями**.**Windows сервер 2003 и Windows XP:** это право доступа не поддерживается.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Поток команд \_ SET \_ context** (0x0010)                | Требуется для записи контекста потока с помощью [**SetThreadContext**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadcontext).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Поток команд \_ ЗАДАТЬ \_ сведения** (0x0020)            | Требуется для задания определенных данных в объекте потока.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Поток команд \_ Задание \_ ограниченных \_ сведений** (0x0400)   | Требуется для задания определенных данных в объекте потока. Для маркера, имеющего право доступа к **\_ \_ сведениям о наборе потоков** , автоматически предоставляются **\_ \_ ограниченные \_ сведения о наборе потоков**.**Windows сервер 2003 и Windows XP:** это право доступа не поддерживается.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Поток команд \_ ЗАДАТЬ \_ \_ токен потока** (0x0080)          | Требуется для установки токена олицетворения для потока с помощью [**сетсреадтокен**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadtoken).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Поток команд \_ Приостановить \_ возобновление** (0x0002)             | Требуется для приостановки или возобновления потока (см. раздел [**суспендсреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-suspendthread) and [**ресумесреад**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-resumethread)).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Поток команд \_ ЗАВЕРШЕНИЕ** (0x0001)                   | Требуется для завершения потока с помощью [**TerminateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminatethread).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |



 

Вы можете запросить право доступа к **\_ системе \_ безопасности системы доступа** к объекту потока, если вы хотите прочитать или записать список SACL объекта. Дополнительные сведения см. в разделе [списки управления доступом (ACL)](../secauthz/access-control-lists.md) и [права доступа к спискам SACL](../secauthz/sacl-access-right.md).

## <a name="protected-processes"></a>Защищенные процессы

*Защищенные процессы* улучшают поддержку цифровых Rights Management. Система ограничена доступом к защищенным процессам и потокам защищенных процессов.

**Windows Server 2003 и Windows XP:** были добавлены защищенные процессы, начиная с Windows Vista.

Следующие права доступа не допускаются из процесса в потоки защищенного процесса:

**ПОТОК — \_ все \_ доступ**  
**\_прямое \_ ОЛИЦЕТВОРЕНие потока**  
**\_контекст получения \_ контекста**  
**\_олицетворение потока**  
**\_ \_ сведения о запросе потока**  
**\_контекст набора \_ потоков**  
**\_сведения о наборе потоков \_**  
**\_токен набора \_ потоков**  
**\_завершение потока**  


Для предоставления доступа к подмножеству сведений, доступных через **\_ \_ сведения о запросе потока**, был введен **\_ ограниченный запрос на получение \_ \_ сведений о потоке** .

 

 
