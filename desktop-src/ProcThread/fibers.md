---
description: Волокно — это единица выполнения, которая должна быть запланирована приложением вручную.
ms.assetid: 6283f56b-23ae-4840-abd0-2478a50c670c
title: Виде
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ea0383e6d207a77c621f00f358c72bb8873ecb5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103813769"
---
# <a name="fibers"></a>Виде

*Волокно* — это единица выполнения, которая должна быть запланирована приложением вручную. Волокна выполняются в контексте потоков, планирующих их. Каждый поток может запланировать несколько волокон. Как правило, волокна не предоставляют преимуществ по сравнению с хорошо спроектированным многопоточным приложением. Однако использование волокон может упростить перенос приложений, разработанных для планирования собственных потоков.

С точки зрения системы, волокно предполагает идентификацию потока, который его выполняет. Например, если волокно обращается к [локальному хранилищу потока](thread-local-storage.md) (TLS), он обращается к локальному хранилищу потока, в котором он работает. Кроме того, если волокно вызывает функцию [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) , поток, выполняющий его, завершает работу. Однако волокно не имеет всех связанных с ним сведений о состоянии, как это было связано с потоком. Единственной информацией о состоянии, хранящейся для волокон, является его стек, подмножество его регистров и данные волокон, предоставляемые во время создания волокон. Сохраненные регистры — это набор регистров, обычно сохраняемых в вызове функции.

Многоприоритетное выполнение волокон не запланировано. Чтобы запланировать волокно, переключитесь на него с другого волокна. Система по-прежнему планирует выполнение потоков. Когда поток, использующий волокна, заменяется, его текущее работающее волокно заменяется, но остается выбранным. Выбранный волокон выполняется при выполнении потока.

Прежде чем планировать первое волокно, вызовите функцию [**конвертсреадтофибер**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) , чтобы создать область, в которой нужно сохранить сведения о состоянии волокон. Вызывающий поток теперь является выполняемым в настоящее время волокно. Сведения о сохраненном состоянии для этого волокна включают данные волокон, передаваемые в качестве аргумента в **конвертсреадтофибер**.

Функция [**креатефибер**](/windows/desktop/api/WinBase/nf-winbase-createfiber) используется для создания нового волокна из существующего волокна; для вызова требуется размер стека, начальный адрес и данные волокон. Начальный адрес обычно представляет собой определяемую пользователем функцию, называемую функцией волокон, которая принимает один параметр (оптоволоконные данные) и не возвращает значение. Если функция Fiber возвращает, то поток, выполняющий волоконный выход, завершается. Чтобы выполнить любое волокное, созданное с помощью **креатефибер**, вызовите функцию [**свитчтофибер**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) . Вы можете вызвать **свитчтофибер** с адресом волокон, созданным другим потоком. Для этого необходимо, чтобы адрес возвращался в другой поток, когда он называется **креатефибер** , и необходимо использовать правильную синхронизацию.

Волокно может получить данные волокон, вызвав макрос [**жетфибердата**](/windows/win32/api/winnt/nf-winnt-getfiberdata) . Волокно может получить адрес волокон в любое время, вызвав макрос [**жеткуррентфибер**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) .

## <a name="fiber-local-storage"></a>Локальное хранилище Fiber

Волокно может использовать *Локальное хранилище волокон* (ФЛС), чтобы создать уникальную копию переменной для каждого волокна. Если переключение волокон не выполняется, ФЛС действует точно так же, как и [Локальное хранилище потока](thread-local-storage.md). Функции ФЛС ([**флсаллок**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**флсфри**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**ФЛСЖЕТВАЛУЕ**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue)и [**флссетвалуе**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) управляют ФЛС, связанным с текущим потоком. Если поток исполняет волокно, а волокно переключается, ФЛС также переключается.

Чтобы очистить данные, связанные с волокно, вызовите функцию [**делетефибер**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) . Эти данные включают стек, подмножество регистров и данные волокон. Если выполняемый в данный момент волокон вызывает **делетефибер**, его поток вызывает [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) и завершает работу. Однако если выбранное волокно удалено с помощью волоконно-оптического потока в другом потоке, поток с удаленным волоком, скорее всего, завершится аварийно, так как стек волокон был освобожден.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование волокон](using-fibers.md)
</dt> </dl>

 

 
