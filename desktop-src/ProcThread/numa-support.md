---
description: Традиционная модель многопроцессорной поддержки — это симметричный многопроцессорный (SMP). В этой модели каждый процессор имеет равный доступ к памяти и операциям ввода-вывода. По мере добавления процессоров процессорная шина преобразуется в ограничение производительности системы.
ms.assetid: a1263968-2b26-45cc-bdd7-6aa354821a5a
title: Поддержка NUMA
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 559df7d4e13571953f2826188bd80ccbc472b2ca
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673757"
---
# <a name="numa-support"></a>Поддержка NUMA

Традиционная модель многопроцессорной поддержки — это симметричный многопроцессорный (SMP). В этой модели каждый процессор имеет равный доступ к памяти и операциям ввода-вывода. По мере добавления процессоров процессорная шина преобразуется в ограничение производительности системы.

Конструкторы систем используют неоднородный доступ к памяти (NUMA) для увеличения скорости процессора без увеличения нагрузки на процессорную шину. Архитектура является неоднородной, так как каждый процессор близко к некоторым частям памяти и более отдален от других частей памяти. Процессор быстро получает доступ к памяти, к которой он близок, в то время как может потребоваться больше времени для получения доступа к памяти, которая находится дальше.

В системе NUMA процессоры размещаются в небольших системах, именуемых *узлами*. Каждый узел имеет свои собственные процессоры и память и подключается к более крупной системе через шину Interconnect, ориентированную на кэш.

Система пытается повысить производительность, планируя потоки на процессорах, которые находятся в том же узле, что и используемая память. Он пытается удовлетворить запросы на выделение памяти в пределах узла, но при необходимости выделит память с других узлов. Он также предоставляет API, чтобы сделать топологию системы доступной для приложений. Вы можете повысить производительность приложений с помощью функций NUMA, чтобы оптимизировать планирование и использование памяти.

Во – первых, необходимо определить макет узлов в системе. Чтобы получить узел с наибольшим номером в системе, используйте функцию [**жетнумахигхестноденумбер**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumahighestnodenumber) . Обратите внимание, что это число не гарантировано равно общему количеству узлов в системе. Кроме того, не гарантируется, что узлы с последовательными числами близки друг к другу. Чтобы получить список процессоров в системе, используйте функцию [**жетпроцессаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-getprocessaffinitymask) . Вы можете определить узел для каждого процессора в списке с помощью функции [**жетнумапроцессорноде**](/windows/desktop/api/WinBase/nf-winbase-getnumaprocessornode) . Кроме того, чтобы получить список всех процессоров в узле, используйте функцию [**жетнуманодепроцессормаск**](/windows/desktop/api/WinBase/nf-winbase-getnumanodeprocessormask) .

После определения того, какие процессоры принадлежат какому узлу, можно оптимизировать производительность приложения. Чтобы убедиться, что все потоки процесса выполняются на одном узле, используйте функцию [**сетпроцессаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-setprocessaffinitymask) с маской сходства процессов, указывающей процессоры в одном узле. Это повышает эффективность приложений, потоки которых должны иметь доступ к одной и той же памяти. Кроме того, чтобы ограничить количество потоков на каждом узле, используйте функцию [**сетсреадаффинитимаск**](/windows/desktop/api/WinBase/nf-winbase-setthreadaffinitymask) .

Приложения, интенсивно использующие память, должны оптимизировать использование памяти. Чтобы получить объем свободной памяти, доступной для узла, используйте функцию [**жетнумааваилаблемемориноде**](/windows/desktop/api/WinBase/nf-winbase-getnumaavailablememorynode) . Функция [**виртуалаллоцекснума**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocexnuma) позволяет приложению указать предпочитаемый узел для выделения памяти. **Виртуалаллоцекснума** не выделяет физические страницы, поэтому она будет выполнена, независимо от того, доступны ли страницы на этом узле или в других местах системы. Физические страницы выделяются по запросу. Если на предпочитаемом узле не хватает страниц, диспетчер памяти будет использовать страницы из других узлов. Если память выведена из памяти, то тот же процесс используется при возвращении.

### <a name="numa-support-on-systems-with-more-than-64-logical-processors"></a>Поддержка NUMA в системах с более чем 64 логическими процессорами

В системах с более чем 64 логическими процессорами узлы назначаются [группам процессоров](processor-groups.md) в соответствии с емкостью узлов. Емкость узла — это количество процессоров, имеющихся при запуске системы вместе со всеми дополнительными логическими процессорами, которые могут быть добавлены во время работы системы.

Windows **server 2008, Windows Vista, Windows server 2003 и Windows XP:** Группы процессоров не поддерживаются.

Каждый узел должен быть полностью включен в группу. Если емкость узлов относительно мала, система назначает несколько узлов одной группе и выбирает узлы, которые физически близки друг к другу для повышения производительности. Если емкость узла превышает максимальное число процессоров в группе, система разделяет узел на несколько меньших узлов, каждый из которых достаточно мал для размещения в группе.

Идеальный узел NUMA для нового процесса можно запросить с помощью [**\_ атрибута потока процесса \_ \_ предпочтительный \_**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) Расширенный атрибут Node при создании процесса. Как и идеальный для потоков процессор, идеальный узел является указанием планировщика, который назначает новый процесс группе, содержащей запрошенный узел, если это возможно.

Расширенные функции NUMA [**жетнумааваилаблемеморинодикс**](/windows/desktop/api/WinBase/nf-winbase-getnumaavailablememorynodeex), [**жетнуманодепроцессормаскекс**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumanodeprocessormaskex), [**жетнумапроцессорнодикс**](/windows/desktop/api/WinBase/nf-winbase-getnumaprocessornodeex)и [**GetNumaProximityNodeEx**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumaproximitynodeex) отличаются от нерасширенных аналогев тем, что номер узла является значением **UShort** , а не **uchar**, для размещения потенциально большего числа узлов в системе с более чем 64 логическими процессорами. Кроме того, процессор, заданный или извлекаемый расширенными функциями, включает в себя группу процессоров; процессор, заданный или извлекаемый нерасширенными функциями, является относительным для группы. Дополнительные сведения см. в разделах справки по отдельным функциям.

Приложение с поддержкой групп может назначить все свои потоки определенному узлу аналогично описанному выше в этом разделе, используя соответствующие расширенные функции NUMA. Приложение использует [**жетлогикалпроцессоринформатионекс**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getlogicalprocessorinformationex) для получения списка всех процессоров в системе. Обратите внимание, что приложение не может задать маску сходства процессов, если только этот процесс не назначен одной группе, а требуемый узел находится в этой группе. Обычно приложение должно вызвать [**сетсреадграупаффинити**](/windows/win32/api/processtopologyapi/nf-processtopologyapi-setthreadgroupaffinity) , чтобы ограничить его потоки до предполагаемого узла.

## <a name="numa-api"></a>API NUMA

В следующей таблице описывается API NUMA.



| Функция                                                                     | Описание                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**аллокатеусерфисикалпажеснума**](/windows/win32/api/memoryapi/nf-memoryapi-allocateuserphysicalpagesnuma)      | Выделяет страницы физической памяти для сопоставления и несоответствия в любом регионе [расширений](../memory/address-windowing-extensions.md) AWE указанного процесса и указывает узел NUMA для физической памяти. |
| [**креатефилемаппингнума**](/windows/win32/api/memoryapi/nf-memoryapi-createfilemappingnumaw)                      | Создает или открывает именованный или безымянный объект сопоставления файлов для указанного файла и указывает узел NUMA для физической памяти.                                                                                              |
| [**жетлогикалпроцессоринформатион**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getlogicalprocessorinformation)     | Извлекает сведения о логических процессорах и связанном оборудовании.                                                                                                                                                            |
| [**жетлогикалпроцессоринформатионекс**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getlogicalprocessorinformationex) | Извлекает сведения о связях логических процессоров и связанного оборудования.                                                                                                                                       |
| [**жетнумааваилаблемемориноде**](/windows/desktop/api/WinBase/nf-winbase-getnumaavailablememorynode)             | Извлекает объем памяти, доступный в указанном узле.                                                                                                                                                                 |
| [**жетнумааваилаблемеморинодикс**](/windows/desktop/api/WinBase/nf-winbase-getnumaavailablememorynodeex)         | Извлекает объем памяти, доступный в узле, указанном как значение **UShort** .                                                                                                                                             |
| [**жетнумахигхестноденумбер**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumahighestnodenumber)                 | Возвращает узел, в котором в настоящее время имеется наибольший номер.                                                                                                                                                                       |
| [**жетнуманодепроцессормаск**](/windows/desktop/api/WinBase/nf-winbase-getnumanodeprocessormask)                 | Извлекает маску процессора для указанного узла.                                                                                                                                                                            |
| [**жетнуманодепроцессормаскекс**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumanodeprocessormaskex)             | Извлекает маску процессора для узла, указанного как значение типа **UShort** .                                                                                                                                                        |
| [**жетнумапроцессорноде**](/windows/desktop/api/WinBase/nf-winbase-getnumaprocessornode)                         | Возвращает номер узла для указанного процессора.                                                                                                                                                                          |
| [**жетнумапроцессорнодикс**](/windows/desktop/api/WinBase/nf-winbase-getnumaprocessornodeex)                     | Получает номер узла в виде значения **UShort** для указанного процессора.                                                                                                                                                    |
| [**жетнумапроксимитиноде**](/windows/desktop/api/WinBase/nf-winbase-getnumaproximitynode)                         | Возвращает номер узла для указанного идентификатора близости.                                                                                                                                                               |
| [**жетнумапроксимитинодикс**](/windows/win32/api/systemtopologyapi/nf-systemtopologyapi-getnumaproximitynodeex)                     | Получает номер узла в виде значения **UShort** для указанного идентификатора близости.                                                                                                                                         |
| [**мапвиевоффиликснума**](/windows/win32/api/winbase/nf-winbase-mapviewoffileexnuma)                          | Сопоставляет представление сопоставления файлов с адресным пространством вызывающего процесса и указывает узел NUMA для физической памяти.                                                                                                 |
| [**виртуалаллоцекснума**](/windows/win32/api/memoryapi/nf-memoryapi-virtualallocexnuma)                            | Резервирует или фиксирует область памяти в пределах виртуального адресного пространства указанного процесса и указывает узел NUMA для физической памяти.                                                                          |



 

Функцию [**куериворкингсетекс**](/windows/win32/api/psapi/nf-psapi-queryworkingsetex) можно использовать для получения узла NUMA, на котором выделяется страница. Пример см. в разделе [выделение памяти из узла NUMA](../memory/allocating-memory-from-a-numa-node.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Выделение памяти из узла NUMA](../memory/allocating-memory-from-a-numa-node.md)
</dt> <dt>

[Несколько процессоров](multiple-processors.md)
</dt> <dt>

[Группы процессоров](processor-groups.md)
</dt> </dl>

 

 
