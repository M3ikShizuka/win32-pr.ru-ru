---
description: Служба упорядочивания потоков управляет выполнением одного или нескольких клиентских потоков. Это гарантирует, что каждый клиентский поток выполняется один раз в течение указанного периода и относительный порядок.
ms.assetid: 5c37873a-ced4-447e-a6e1-55cfa8ab24b4
title: Служба упорядочивания потоков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 72b3cd12b26124b47d506585425388a4542a70df
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673731"
---
# <a name="thread-ordering-service"></a>Служба упорядочивания потоков

*Служба упорядочивания потоков* управляет выполнением одного или нескольких клиентских потоков. Это гарантирует, что каждый клиентский поток выполняется один раз в течение указанного периода и относительный порядок.

**Windows Server 2003 и Windows XP:** Служба упорядочивания потоков доступна начиная с Windows Vista и Windows Server 2008.

Служба упорядочивания потоков по умолчанию отключена и должна запускаться пользователем. Пока служба упорядочения потоков запущена, она активируется каждые 5 секунд, чтобы проверить, существует ли новый запрос, даже если система бездействует. Это предотвращает выполнение системы в спящем режиме дольше 5 секунд, в результате чего система потребляет больше энергии. Если эффективность работы с энергопотреблением важна для приложения, лучше не использовать службу упорядочения потоков и вместо этого позволить системному планировщику управлять выполнением потоков.

Каждый клиентский поток принадлежит *группе упорядочения потоков*. *Родительский поток* создает одну или несколько групп упорядочивания потоков, вызывая функцию [**аврткреатесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtcreatethreadorderinggroup) . Родительский поток использует эту функцию, чтобы указать период для группы упорядочения потоков и интервал времени ожидания.

Дополнительные клиентские потоки вызывают функцию [**авртжоинсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtjointhreadorderinggroup) , чтобы присоединиться к существующей группе упорядочения потоков. Эти потоки указывают, должны ли они быть предшественником или последовательным для родительского потока в порядке выполнения. Предполагается, что каждый клиентский поток завершает определенный объем обработки в каждый период. Все потоки в группе должны завершить свое выполнение в течение периода плюс интервал времени ожидания.

Потоки группы упорядочения потоков заключают свой код обработки в цикл, который управляется функцией [**авртваитонсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) . Во-первых, предшественники выполняются по одному в том порядке, в котором они присоединились к группе, тогда как родительские и последовательные потоки блокируются при вызове **авртваитонсреадордерингграуп**. При завершении обработки каждого предшественника потока управление выполнением возвращается к началу цикла обработки, а поток вызывает **авртваитонсреадордерингграуп** еще раз, чтобы заблокировать до следующей попытки. После того как все предшественники вызвали эту функцию, служба упорядочения потоков может запланировать родительский поток. Наконец, когда родительский поток завершает свою обработку и вызывает **авртваитонсреадордерингграуп** еще раз, служба упорядочения потоков может запланировать потоки последователей по одному в том порядке, в котором они присоединились к группе. Если все потоки завершили свое выполнение до окончания периода, все потоки ожидают, пока не истечет оставшаяся часть периода.

Если клиент больше не должен выполняться как часть группы упорядочения потоков, он вызывает функцию [**авртлеавесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtleavethreadorderinggroup) , чтобы удалить саму себя из группы. Обратите внимание, что родительский поток не должен удалять себя из группы упорядочения потоков. Если поток не завершает свое выполнение до истечения периода, а также интервала времени ожидания, он удаляется из группы.

Родительский поток вызывает функцию [**авртделетесреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtdeletethreadorderinggroup) для удаления группы упорядочения потоков. Группа упорядочивания потоков также уничтожается, если родительский поток не завершает свое выполнение до истечения периода, а также интервала времени ожидания. При удалении группы упорядочения потоков все вызовы [**авртваитонсреадордерингграуп**](/windows/desktop/api/Avrt/nf-avrt-avrtwaitonthreadorderinggroup) из потоков этой группы завершаются сбоем или истечением времени ожидания.

 

 



