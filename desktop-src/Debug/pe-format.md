---
description: Эта спецификация описывает структуру исполняемых файлов (образов) и объектных файлов в семействе операционных систем Windows. Эти файлы называются переносимыми исполняемыми (PE) и файловыми файлами формата COFF соответственно.
ms.assetid: 3dbfbf7f-6662-45a4-99f1-e0e24c370dee
title: Формат PE
ms.topic: article
ms.date: 03/31/2021
ms.custom: contperf-fy21q1
ms.openlocfilehash: 3cc6fd777bca831ca4424baaa81c5525a24556ec
ms.sourcegitcommit: 3b9424e1dcd951b2a73e47de3c7f4d734de4263b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "106103865"
---
# <a name="pe-format"></a>Формат PE

Эта спецификация описывает структуру исполняемых файлов (образов) и объектных файлов в семействе операционных систем Windows. Эти файлы называются переносимыми исполняемыми (PE) и файловыми файлами формата COFF соответственно.

> [!Note]  
> Этот документ предназначен для помощи в разработке средств и приложений для Windows, но не обязательно должен быть полной спецификацией во всех отношениях. Корпорация Майкрософт оставляет за собой право изменять этот документ без предварительного уведомления.

Эта редакция спецификации переносимого исполняемого файла и формата общих объектных файлов заменяет все предыдущие редакции этой спецификации.

## <a name="general-concepts"></a>Общие понятия

В этом документе указывается структура исполняемых файлов (образов) и файлов объектов в семействе операционных систем Microsoft Windows. Эти файлы называются переносимыми исполняемыми (PE) и файловыми файлами формата COFF соответственно. Имя "переносимый исполняемый файл" означает тот факт, что формат не зависит от архитектуры.

В следующей таблице описаны некоторые основные понятия, которые отображаются в этой спецификации.

| Имя                              | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| сертификат атрибута <br/> | Сертификат, используемый для связи проверяемых инструкций с изображением. С файлом можно связать несколько различных проверяемых инструкций. одним из наиболее полезных является предложение от производителя программного обеспечения, которое указывает, что должен быть дайджест сообщения для этого образа. Дайджест сообщения аналогичен контрольной сумме, за исключением того, что ее чрезвычайно трудно подделать. Поэтому очень сложно изменить файл так, чтобы он имел тот же дайджест сообщений, что и исходный файл. Эту инструкцию можно проверить с помощью схем шифрования с открытым или закрытым ключом. В этом документе содержатся сведения о сертификатах атрибутов, не позволяющих их вставлять в файлы изображений. <br/> |
| Метка даты и времени <br/>       | Штамп, используемый для различных целей в нескольких местах в PE-файле или COFF. В большинстве случаев формат каждой отметки совпадает со стилем, используемым функциями времени в библиотеке времени выполнения C. Сведения об исключениях см. в описании параметра описание для \_ типа отладки образа \_ \_ Воспр в [типе отладки](#debug-type). Если значение метки равно 0 или 0xFFFFFFFF, оно не представляет действительную или значимую метку даты и времени. <br/>                                                                                                                                                                                                                                                                                                                                            |
| указатель файла <br/>          | Расположение элемента в самом файле перед обработкой компоновщиком (в случае файловых файлов) или загрузчик (в случае файлов изображений). Иными словами, это расположение в файле, хранящееся на диске. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| компоновщик <br/>                | Ссылка на компоновщик, предоставляемый с Microsoft Visual Studio. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| объектный файл <br/>           | Файл, предоставленный в качестве входных данных компоновщику. Компоновщик создает файл изображения, который, в свою очередь, используется в качестве входных данных загрузчиком. Термин «объектный файл» не обязательно подразумевает любое подключение к объектно-ориентированному программированию. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| зарезервировано, должно быть равно 0 <br/>   | Описание поля, которое указывает, что значение поля должно быть нулевым для генераторов, и потребители должны игнорировать это поле. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Относительный виртуальный адрес (RVA) <br/>                   | В файле изображения это адрес элемента после его загрузки в память с базовым адресом вычитаемого файла изображения. RVA элемента почти всегда отличается от его позиции в файле на диске (указатель на файл). <br/> В объектном файле RVA является менее значимым, так как расположения в памяти не назначены. В этом случае RVA будет адресом в разделе (описан далее в этой таблице), к которому позже будет применяться перемещение при компоновке. Для простоты компилятор должен просто установить первый RVA в каждом разделе равным нулю. <br/>                                                                                                                                         |
| section <br/>               | Базовая единица кода или данных в PE-файле или COFF. Например, весь код в объектном файле можно объединить в один раздел или (в зависимости от поведения компилятора) Каждая функция может занимать свой собственный раздел. С дополнительными разделами накладные расходы на файл больше, но компоновщик может обеспечить более выборочную компоновку кода. Раздел похож на сегмент в архитектуре Intel 8086. Все необработанные данные в разделе должны быть непрерывно загружены. Кроме того, файл изображения может содержать несколько разделов, таких как. TLS или. reloc, которые имеют особые цели. <br/>                                                                                                                                                                      |
| Виртуальный адрес (ва) <br/>                    | То же, что и RVA, за исключением того, что базовый адрес файла изображения не вычитается. Адрес называется «ва», так как Windows создает отдельное пространство для каждого процесса, независимо от физической памяти. Для почти всех целей должен рассматриваться только адрес. Значение по адресу не так предсказуемо, как RVA, поскольку загрузчик может не загрузить образ в предпочтительном расположении. <br/>                                                                                                                                                                                                                                                                                                                                        |

## <a name="overview"></a>Обзор

В следующем списке описывается исполняемый формат Microsoft PE с базовым заголовком изображения вверху. Раздел из заголовка MS-DOS 2,0, совместимого с, в раздел "неиспользуемые" непосредственно перед заголовком PE является разделом MS-DOS 2,0 и используется только для совместимости с MS-DOS.

-   Заголовок EXE, совместимый с MS-DOS 2,0
-   unused
-   Идентификатор OEM

    Сведения об изготовителе оборудования

    Смещение к заголовку PE

-   Программа-заглушка MS-DOS 2,0 и таблица перемещения

-   unused

-   Заголовок PE (по 8-байтовой границе)

-   Заголовки разделов
-   Страницы изображений:

    сведения о импорте

    Экспорт сведений

    изменения в базовом расположении

    Информация о ресурсах

В следующем списке приведено описание формата объектных модулей Microsoft COFF.

-   Заголовок Microsoft COFF
-   Заголовки разделов
-   Необработанные данные:

    code

    .

    отладочная информация

    перемещения

## <a name="file-headers"></a>Заголовки файлов

- [Заглушка MS-DOS (только образ)](#ms-dos-stub-image-only)
- [Подпись (только изображение)](#signature-image-only)
- [Заголовок COFF-файла (объект и изображение)](#coff-file-header-object-and-image)
  - [Типы компьютеров](#machine-types)
  - [Характеристики](#characteristics)
- [Необязательный заголовок (только изображение)](#optional-header-image-only)
  - [Необязательные поля заголовка "Стандартный" (только изображение)](#optional-header-standard-fields-image-only)
  - [Необязательные Windows-Specific поля заголовка (только изображение)](#optional-header-windows-specific-fields-image-only)
  - [Необязательные каталоги данных заголовков (только изображение)](#optional-header-data-directories-image-only)

Заголовок PE-файла состоит из заглушки Microsoft MS-DOS, подписи PE, заголовка COFF-файла и необязательного заголовка. Заголовок объектного файла COFF состоит из заголовка COFF-файла и необязательного заголовка. В обоих случаях заголовки файлов следуют сразу после заголовков разделов.

### <a name="ms-dos-stub-image-only"></a>Заглушка MS-DOS (только образ)

Заглушка MS-DOS — это допустимое приложение, работающее в среде MS-DOS. Он помещается в начало образа EXE-файла. Компоновщик помещает в него заглушку по умолчанию, которая выводит сообщение «Эта программа не может быть запущена в режиме DOS», когда образ запускается в MS-DOS. Пользователь может указать другую заглушку с помощью параметра компоновщика/stub ПРИЛАГАЕТ.

В расположении 0x3C заглушка имеет смещение файла для подписи PE. Эта информация позволяет Windows правильно выполнить файл образа, даже если у него есть заглушка MS-DOS. Это смещение файла помещается в расположение 0x3C во время компоновки.

### <a name="signature-image-only"></a>Подпись (только изображение)

После того, как заглушка MS-DOS в смещении файла, указанного по смещению 0x3C, представляет собой 4-байтовую сигнатуру, которая идентифицирует файл как файл изображения PE. Эта сигнатура — "PE \\ 0 \\ 0" (буквы "P" и "E", за которыми следуют два байта (null)).

### <a name="coff-file-header-object-and-image"></a>Заголовок COFF-файла (объект и изображение)

В начале объектного файла или непосредственно после подписи файла изображения является стандартным заголовком COFF-файла в следующем формате. Обратите внимание, что загрузчик Windows ограничивает количество разделов до 96.

| Offset         | Размер          | Поле                            | Описание                                                                                                                                                                                                                                                          |
|----------------|---------------|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/> | Компьютер <br/>              | Число, идентифицирующее тип целевого компьютера. Дополнительные сведения см. в разделе [типы компьютеров](#machine-types). <br/>                                                                                                                                        |
| 2 <br/>  | 2 <br/> | нумберофсектионс <br/>     | Количество разделов. Указывает размер таблицы разделов, которая сразу же следует за заголовками. <br/>                                                                                                                                             |
| 4 <br/>  | 4 <br/> | тимедатестамп <br/>        | Младшие 32 бита количества секунд с 00:00 1 января 1970 (значение t времени выполнения C \_ ), которое указывает на момент создания файла. <br/>                                                                                                             |
| 8 <br/>  | 4 <br/> | поинтертосимболтабле <br/> | Смещение файла таблицы символов COFF или нуль, если таблица символов COFF отсутствует. Для образа это значение должно быть равно нулю, так как отладочные данные COFF являются устаревшими. <br/>                                                                           |
| 12 <br/> | 4 <br/> | нумберофсимболс <br/>      | Число записей в таблице символов. Эти данные можно использовать для размещения таблицы строк, которая сразу же следует за таблицей символов. Для образа это значение должно быть равно нулю, так как отладочные данные COFF являются устаревшими. <br/>                        |
| 16 <br/> | 2 <br/> | сизеофоптионалхеадер <br/> | Размер необязательного заголовка, который необходим для исполняемых файлов, но не для объектных файлов. Для объектного файла это значение должно быть равно нулю. Описание формата заголовка см. в разделе [необязательный заголовок (только изображение)](#optional-header-image-only). <br/> |
| 18 <br/> | 2 <br/> | Характеристики <br/>      | Флаги, указывающие атрибуты файла. Конкретные значения флагов см. в разделе [характеристики](#characteristics). <br/>                                                                                                                               |

#### <a name="machine-types"></a>Типы компьютеров

Поле Machine имеет одно из следующих значений, которое указывает тип ЦП. Файл изображения может быть запущен только на указанном компьютере или в системе, которая эмулирует указанный компьютер.

| Константа                                    | Значение              | Описание                                                                             |
|---------------------------------------------|--------------------|-----------------------------------------------------------------------------------------|
| \_неизвестный файл образа \_ компьютера \_ <br/>   | 0x0 <br/>    | Предполагается, что содержимое этого поля применимо к любому типу компьютера <br/> |
| \_AM33 файл образа \_ компьютера \_ <br/>      | 0x1d3 <br/>  | Матсушита AM33 <br/>                                                             |
| Файл образа на \_ \_ машине \_ AMD64 <br/>     | 0x8664 <br/> | X64 <br/>                                                                         |
| \_ARM для файлового \_ компьютера образа \_ <br/>       | 0x1c0 <br/>  | Прямой порядок байтов <br/>                                                           |
| \_ARM64 файл образа \_ компьютера \_ <br/>     | 0xaa64 <br/> | ARM64 с прямым порядком байтов <br/>                                                         |
| \_армнт файл образа \_ компьютера \_ <br/>     | 0x1c4 <br/>  | Бегунок ARM-2 с прямым порядком байтов <br/>                                                   |
| \_ебк файл образа \_ компьютера \_ <br/>       | 0xebc <br/>  | Код байта EFI <br/>                                                               |
| \_Файл образа \_ Machine \_ i386 <br/>      | 0x14c <br/>  | Процессоры Intel 386 или более поздней версии и совместимые процессоры <br/>                     |
| \_Файл образа \_ Machine \_ ia64 <br/>      | 0x200 <br/>  | Семейство процессоров Intel Itanium <br/>                                              |
| \_M32R файл образа \_ компьютера \_ <br/>      | 0x9041 <br/> | Mitsubishi M32R с прямым порядком байтов <br/>                                               |
| \_MIPS16 файл образа \_ компьютера \_ <br/>    | 0x266 <br/>  | MIPS16 <br/>                                                                      |
| \_мипсфпу файл образа \_ компьютера \_ <br/>   | 0x366 <br/>  | MIPS с FPU <br/>                                                               |
| \_MIPSFPU16 файл образа \_ компьютера \_ <br/> | 0x466 <br/>  | MIPS16 с FPU <br/>                                                             |
| \_файл образа \_ машины \_ POWERPC <br/>   | 0x1f0 <br/>  | Power PC с прямым порядком байтов <br/>                                                      |
| \_поверпкфп файл образа \_ компьютера \_ <br/> | 0x1f1 <br/>  | Power PC с поддержкой плавающих точек <br/>                                        |
| \_R4000 файл образа \_ компьютера \_ <br/>     | 0x166 <br/>  | MIPS с прямым порядком байтов <br/>                                                          |
| \_RISCV32 файл образа \_ компьютера \_ <br/>   | 0x5032 <br/> | RISC-V 32-разрядное адресное пространство <br/>                                                 |
| \_RISCV64 файл образа \_ компьютера \_ <br/>   | 0x5064 <br/> | RISC-V 64-разрядное адресное пространство <br/>                                                 |
| \_RISCV128 файл образа \_ компьютера \_ <br/>  | 0x5128 <br/> | RISC-V 128-разрядное адресное пространство <br/>                                                |
| \_SH3 файл образа \_ компьютера \_ <br/>       | 0x1a2 <br/>  | Hitachi SH3 <br/>                                                                 |
| \_SH3DSP файл образа \_ компьютера \_ <br/>    | 0x1a3 <br/>  | Hitachi SH3 DSP <br/>                                                             |
| \_SH4 файл образа \_ компьютера \_ <br/>       | 0x1a6 <br/>  | Hitachi SH4 <br/>                                                                 |
| \_SH5 файл образа \_ компьютера \_ <br/>       | 0x1a8 <br/>  | Hitachi SH5 <br/>                                                                 |
| \_ \_ бегунок файл образа компьютера \_ <br/>     | 0x1c2 <br/>  | Бегунок <br/>                                                                       |
| \_WCEMIPSV2 файл образа \_ компьютера \_ <br/> | 0x169 <br/>  | MIPS с прямым порядком байтов ВЦЕ v2 <br/>                                                   |

#### <a name="characteristics"></a>Характеристики

Поле характеристики содержит флаги, указывающие атрибуты объекта или файла изображения. В настоящее время определены следующие флаги:

| Флаг                                                 | Значение              | Описание                                                                                                                                                                                                                                                                                                                                                        |
|------------------------------------------------------|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_неочищенный файл изображения \_ reloc \_ <br/>            | 0x0001 <br/> | Только образ, Windows CE и Microsoft Windows NT и более поздние версии. Это означает, что файл не содержит базовых перемещений и поэтому должен быть загружен по предпочтительному базовому адресу. Если базовый адрес недоступен, загрузчик сообщает об ошибке. Поведение компоновщика по умолчанию заключается в том, чтобы удалить базовые перемещения из исполняемых файлов (EXE). <br/> |
| \_ \_ образ исполняемого файла образа \_ <br/>           | 0x0002 <br/> | Только изображение. Это означает, что файл изображения является допустимым и может быть запущен. Если этот флаг не установлен, он указывает на ошибку компоновщика. <br/>                                                                                                                                                                                                                          |
| \_строка файла \_ изображения \_ NUMS \_ опущена <br/>        | 0x0004 <br/> | Номера строк COFF удалены. Этот флаг является устаревшим и должен быть равен нулю. <br/>                                                                                                                                                                                                                                                                       |
| удален \_ \_ локальный \_ Симс файла \_ образа <br/>       | 0x0008 <br/> | Записи таблицы символов COFF для локальных символов были удалены. Этот флаг является устаревшим и должен быть равен нулю. <br/>                                                                                                                                                                                                                                             |
| \_файл образа \_ интенсивная \_ \_ Обрезка WS <br/>        | 0x0010 <br/> | Является устаревшей. Агрессивно обрезать рабочий набор. Этот флаг является устаревшим для Windows 2000 и более поздних версий и должен быть равен нулю. <br/>                                                                                                                                                                                                                                          |
| \_файл изображения \_ с \_ поддержкой большого адреса \_ <br/>      | 0x0020 <br/> | Приложение может работать с адресами > 2 ГБ. <br/>                                                                                                                                                                                                                                                                                                            |
|                                                      | 0x0040 <br/> | Этот флаг зарезервирован для использования в будущем. <br/>                                                                                                                                                                                                                                                                                                                  |
| \_ \_ обратный байт файла \_ образа \_ <br/>         | 0x0080 <br/> | Прямой порядок байтов: наименее важный бит (ЛСБ) предшествует наиболее значимому биту в памяти. Этот флаг является устаревшим и должен быть равен нулю. <br/>                                                                                                                                                                                                          |
| Файл образа — \_ \_ 32-разрядный \_ компьютер <br/>              | 0x0100 <br/> | Компьютер основан на архитектуре с 32-разрядным словом. <br/>                                                                                                                                                                                                                                                                                                        |
| \_Отладка файла изображения не \_ \_ обрезается <br/>             | 0x0200 <br/> | Отладочная информация удаляется из файла образа. <br/>                                                                                                                                                                                                                                                                                                  |
| \_файл образа \_ с съемным \_ запуском \_ из \_ переключения <br/> | 0x0400 <br/> | Если образ находится на съемном носителе, необходимо полностью загрузить его и скопировать в файл подкачки. <br/>                                                                                                                                                                                                                                                                        |
| \_файл образа \_ net \_ Run \_ из \_ Swap <br/>        | 0x0800 <br/> | Если образ находится на сетевых носителях, необходимо полностью загрузить его и скопировать в файл подкачки. <br/>                                                                                                                                                                                                                                                                          |
| \_Файловая \_ система образа <br/>                      | 0x1000 <br/> | Файл образа является системным файлом, а не пользовательской программой. <br/>                                                                                                                                                                                                                                                                                                   |
| \_Библиотека файлов \_ изображений <br/>                         | 0x2000 <br/> | Файл изображения является библиотекой динамической компоновки (DLL). Такие файлы считаются исполняемыми файлами почти во всех целях, хотя они не могут быть запущены напрямую. <br/>                                                                                                                                                                                              |
| \_файл образа \_ — \_ \_ только система <br/>            | 0x4000 <br/> | Файл должен выполняться только на однопроцессорном компьютере. <br/>                                                                                                                                                                                                                                                                                                 |
| \_обращений к файлу образа ( \_ байт) \_ \_ <br/>         | 0x8000 <br/> | Обратный порядок байтов. перед ЛСБ в памяти находится перед ним. Этот флаг является устаревшим и должен быть равен нулю. <br/>                                                                                                                                                                                                                                                            |

### <a name="optional-header-image-only"></a>Необязательный заголовок (только изображение)

Каждый файл изображения имеет необязательный заголовок, предоставляющий сведения загрузчику. Этот заголовок необязателен в том смысле, что некоторые файлы (в частности, объектные файлы) их не имеют. Для файлов изображений этот заголовок является обязательным. Объектный файл может иметь необязательный заголовок, но обычно этот заголовок не имеет функции в объектном файле, за исключением увеличения его размера.

Обратите внимание, что размер необязательного заголовка не фиксирован. Поле **сизеофоптионалхеадер** в заголовке COFF должно использоваться для проверки того, что зонд в файле для конкретного каталога данных не выходит за пределы **сизеофоптионалхеадер**. Дополнительные сведения см. в статье [заголовок файла COFF (объект и изображение)](#coff-file-header-object-and-image).

Поле **нумберофрваандсизес** необязательного заголовка также должно использоваться, чтобы не доставлять зонда конкретной записи каталога данных за пределы дополнительного заголовка. Кроме того, важно проверить необязательное магическое число заголовка для совместимости формата.

Необязательное магическое число заголовка определяет, является ли изображение исполняемым файлом формат PE32 или формат PE32 +.

| Магическое число      | Формат PE         |
|-------------------|-------------------|
| 0x10b <br/> | ФОРМАТ PE32 <br/>  |
| 0x20b <br/> | ФОРМАТ PE32 + <br/> |

ФОРМАТ PE32 + Images позволяет использовать 64-битное пространство адресов, ограничивая размер образа 2 гигабайтами. Другие формат PE32 и изменения рассматриваются в соответствующих разделах.

Необязательный заголовок состоит из трех основных частей.

| Offset (формат PE32/формат PE32 +) | Размер (формат PE32/формат PE32 +)    | Часть заголовка                         | Описание                                                                                                                                                                   |
|---------------------|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>       | 28/24 <br/>    | Стандартные поля <br/>         | Поля, определенные для всех реализаций COFF, включая UNIX. <br/>                                                                                          |
| 28/24 <br/>   | 68/88 <br/>    | Поля, относящиеся к Windows <br/> | Дополнительные поля для поддержки конкретных функций Windows (например, подсистем). <br/>                                                                              |
| 96/112 <br/>  | Переменная <br/> | Каталоги данных <br/>        | Пары "адрес-размер" для специальных таблиц, которые находятся в файле изображения и используются операционной системой (например, таблица импорта и таблица экспорта). <br/> |

#### <a name="optional-header-standard-fields-image-only"></a>Необязательные поля заголовка "Стандартный" (только изображение)

Первые восемь полей необязательного заголовка являются стандартными полями, которые определены для каждой реализации COFF. Эти поля содержат общие сведения, полезные при загрузке и запуске исполняемого файла. Они не изменяются для формата формат PE32 +.

| Offset         | Размер          | Поле                               | Описание                                                                                                                                                                                                                                                                                                                                   |
|----------------|---------------|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/> | Волшебная команда <br/>                   | Целое число без знака, определяющее состояние файла изображения. Наиболее распространенным числом является 0x10B, которое идентифицирует его как обычный исполняемый файл. 0x107 идентифицирует его как образ ROM, а 0x20B идентифицирует его как исполняемый файл формат PE32 +. <br/>                                                                                            |
| 2 <br/>  | 1 <br/> | мажорлинкерверсион <br/>      | Основной номер версии компоновщика. <br/>                                                                                                                                                                                                                                                                                                  |
| 3 <br/>  | 1 <br/> | минорлинкерверсион <br/>      | Дополнительный номер версии компоновщика. <br/>                                                                                                                                                                                                                                                                                                  |
| 4 <br/>  | 4 <br/> | сизеофкоде <br/>              | Размер раздела кода (текст) или сумма всех разделов кода, если имеется несколько разделов. <br/>                                                                                                                                                                                                                              |
| 8 <br/>  | 4 <br/> | сизеофинитиализеддата <br/>   | Размер инициализированного раздела данных или сумма всех таких разделов, если имеется несколько разделов данных. <br/>                                                                                                                                                                                                                    |
| 12 <br/> | 4 <br/> | сизеофунинитиализеддата <br/> | Размер неинициализированного раздела данных (BSS) или сумма всех таких разделов, если имеется несколько разделов BSS. <br/>                                                                                                                                                                                                             |
| 16 <br/> | 4 <br/> | аддрессофентрипоинт <br/>     | Адрес точки входа относительно базы изображения при загрузке исполняемого файла в память. Для образов программ это начальный адрес. Для драйверов устройств это адрес функции инициализации. Точка входа является необязательной для библиотек DLL. Если отсутствует точка входа, это поле должно быть равно нулю. <br/> |
| 20 <br/> | 4 <br/> | басеофкоде <br/>              | Адрес, который относится к базовой части образа раздела начала кода при его загрузке в память. <br/>                                                                                                                                                                                                                    |

ФОРМАТ PE32 содержит это дополнительное поле, отсутствующее в формат PE32 +, после Басеофкоде.

| Offset         | Размер          | Поле                  | Описание                                                                                                                |
|----------------|---------------|------------------------|----------------------------------------------------------------------------------------------------------------------------|
| 24 <br/> | 4 <br/> | басеофдата <br/> | Адрес, который является относительным для базовой области изображения раздела начала данных при его загрузке в память. <br/> |

#### <a name="optional-header-windows-specific-fields-image-only"></a>Необязательные Windows-Specific поля заголовка (только изображение)

Следующие 21 поля являются расширением для необязательного формата заголовка COFF. Они содержат дополнительные сведения, необходимые компоновщику и загрузчику в Windows.

| Offset (формат PE32/формат PE32 +) | Размер (формат PE32/формат PE32 +) | Поле                                   | Описание                                                                                                                                                                                                                                                                                                            |
|----------------------|--------------------|-----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 28/24 <br/>    | 4/8 <br/>    | ImageBase <br/>                   | Предпочтительный адрес первого байта изображения, загружаемого в память; значение должно быть кратно 64 КБ. По умолчанию для библиотек DLL используется 0x10000000. Значение по умолчанию для Windows CE exe — 0x00010000. Значение по умолчанию для Windows NT, Windows 2000, Windows XP, Windows 95, Windows 98 и Windows Me — 0x00400000. <br/>       |
| 32/32 <br/>    | 4 <br/>      | SectionAlignment <br/>            | Выравнивание разделов (в байтах) при загрузке в память. Оно должно быть больше или равно FileAlignment. Значением по умолчанию является размер страницы для архитектуры. <br/>                                                                                                                               |
| 36/36 <br/>    | 4 <br/>      | FileAlignment <br/>               | Коэффициент выравнивания (в байтах), используемый для выравнивания необработанных данных разделов в файле образа. Значение должно быть степенью 2 в диапазоне от 512 до 64 K включительно. Значение по умолчанию — 512. Если выравнивание раздела меньше размера страницы архитектуры, то FileAlignment должен соответствовать выравнивание раздела. <br/> |
| 40/40 <br/>    | 2 <br/>      | мажороператингсистемверсион <br/> | Основной номер версии требуемой операционной системы. <br/>                                                                                                                                                                                                                                                 |
| 42/42 <br/>    | 2 <br/>      | минороператингсистемверсион <br/> | Дополнительный номер версии требуемой операционной системы. <br/>                                                                                                                                                                                                                                                 |
| 44/44 <br/>    | 2 <br/>      | мажоримажеверсион <br/>           | Основной номер версии образа. <br/>                                                                                                                                                                                                                                                                     |
| 46/46 <br/>    | 2 <br/>      | миноримажеверсион <br/>           | Дополнительный номер версии образа. <br/>                                                                                                                                                                                                                                                                     |
| 48/48 <br/>    | 2 <br/>      | мажорсубсистемверсион <br/>       | Основной номер версии подсистемы. <br/>                                                                                                                                                                                                                                                                 |
| 50/50 <br/>    | 2 <br/>      | минорсубсистемверсион <br/>       | Дополнительный номер версии подсистемы. <br/>                                                                                                                                                                                                                                                                 |
| 52/52 <br/>    | 4 <br/>      | Win32VersionValue <br/>           | Зарезервировано, должно быть равно нулю. <br/>                                                                                                                                                                                                                                                                                    |
| 56/56 <br/>    | 4 <br/>      | сизеофимаже <br/>                 | Размер (в байтах) изображения, включая все заголовки, по мере загрузки изображения в память. Он должен быть кратен выравнивание раздела. <br/>                                                                                                                                                                      |
| 60/60 <br/>    | 4 <br/>      | сизеофхеадерс <br/>               | Суммарный размер заголовков заглушки MS-DOS, PE и разделов, округленный до кратного FileAlignment. <br/>                                                                                                                                                                                             |
| 64/64 <br/>    | 4 <br/>      | Вычислен <br/>                    | Контрольная сумма файла образа. Алгоритм вычисления контрольной суммы включен в IMAGHELP.DLL. Следующие проверки проверяются во время загрузки: все драйверы, все библиотеки DLL, загруженные во время загрузки, и любая библиотека DLL, которая загружается в критически важный процесс Windows. <br/>                                          |
| 68/68 <br/>    | 2 <br/>      | Subsystem <br/>                   | Подсистема, необходимая для выполнения этого образа. Дополнительные сведения см. в разделе [подсистема Windows](#windows-subsystem). <br/>                                                                                                                                                                                       |
| 70/70 <br/>    | 2 <br/>      | DllCharacteristics <br/>          | Дополнительные сведения см. в разделе [характеристики DLL](#dll-characteristics) далее в этой спецификации. <br/>                                                                                                                                                                                                         |
| 72/72 <br/>    | 4/8 <br/>    | сизеофстаккресерве <br/>          | Размер резервируемого стека. Зафиксирована только Сизеофстакккоммит; Оставшаяся страница становится доступной по одной странице за раз, пока не будет достигнут резервный размер. <br/>                                                                                                                                                    |
| 76/80 <br/>    | 4/8 <br/>    | сизеофстакккоммит <br/>           | Размер фиксируемого стека. <br/>                                                                                                                                                                                                                                                                           |
| 80/88 <br/>    | 4/8 <br/>    | сизеофхеапресерве <br/>           | Размер резервируемого пространства в локальной куче. Зафиксирована только Сизеофхеапкоммит; Оставшаяся страница становится доступной по одной странице за раз, пока не будет достигнут резервный размер. <br/>                                                                                                                                          |
| 84/96 <br/>    | 4/8 <br/>    | сизеофхеапкоммит <br/>            | Размер фиксируемого пространства в локальной куче. <br/>                                                                                                                                                                                                                                                                |
| 88/104 <br/>   | 4 <br/>      | лоадерфлагс <br/>                 | Зарезервировано, должно быть равно нулю. <br/>                                                                                                                                                                                                                                                                                    |
| 92/108 <br/>   | 4 <br/>      | нумберофрваандсизес <br/>         | Число записей каталога данных в оставшейся части необязательного заголовка. Каждая из них описывает расположение и размер. <br/>                                                                                                                                                                                          |

##### <a name="windows-subsystem"></a>Подсистема Windows

Следующие значения, определенные для поля подсистемы необязательного заголовка, определяют, какая подсистема Windows (если есть) требуется для запуска образа.

| Константа                                                  | Значение          | Описание                                                      |
|-----------------------------------------------------------|----------------|------------------------------------------------------------------|
| \_ПОДСИСТЕМА образа \_ неизвестна <br/>                     | 0 <br/>  | Неизвестная подсистема <br/>                                 |
| \_собственная ПОДСИСТЕМА \_ образа <br/>                      | 1 <br/>  | Драйверы устройств и собственные процессы Windows <br/>          |
| \_ \_ графический интерфейс Windows для ПОДсистемы изображения \_ <br/>                | 2 <br/>  | Подсистема графического пользовательского интерфейса Windows <br/> |
| \_ПОДСИСТЕМА образов \_ Windows \_ несекретная <br/>                | 3 <br/>  | Подсистема символов Windows <br/>                      |
| \_ПОДСИСТЕМА образа \_ OS2 \_ несекретная <br/>                    | 5 <br/>  | Подсистема символов ОС/2 <br/>                         |
| \_ПОДСИСТЕМА образа \_ POSIX \_ несекретная <br/>                  | 7 <br/>  | Подсистема символов POSIX <br/>                        |
| \_ \_ собственные окна ПОДсистемы \_ образа <br/>             | 8 <br/>  | Собственный драйвер Win9x <br/>                                  |
| \_ \_ \_ \_ графический интерфейс пользователя Windows CE для подсистемы образа <br/>            | 9 <br/>  | Windows CE <br/>                                           |
| \_приложение EFI подсистемы образа \_ \_ <br/>            | 10 <br/> | Приложение, поддерживающее интерфейс расширяемого микропрограммы (EFI) <br/>   |
| \_ \_ \_ \_ драйвер службы загрузки EFI подсистемы \_ образа <br/> | 11 <br/> | Драйвер EFI со службами загрузки <br/>                     |
| \_ \_ \_ драйвер среды выполнения EFI подсистемы образа \_ <br/>       | 12 <br/> | Драйвер EFI со службами времени выполнения <br/>                 |
| \_ПЗУ образа подсистемы \_ EFI \_ <br/>                    | 13 <br/> | Образ ПЗУ EFI <br/>                                     |
| \_ПОДСИСТЕМА образа \_ Xbox <br/>                        | 14 <br/> | XBOX. <br/>                                                 |
| \_ \_ \_ приложение загрузки Windows для подсистемы образа \_ <br/>  | 16 <br/> | Приложение загрузки Windows. <br/>                            |

##### <a name="dll-characteristics"></a>Характеристики DLL

Следующие значения определены для поля DllCharacteristics необязательного заголовка.

| Константа                                                             | Значение              | Описание                                                                                             |
|----------------------------------------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------|
|                                                                      | 0x0001 <br/> | Зарезервировано, должно быть равно нулю. <br/>                                                                     |
|                                                                      | 0x0002 <br/> | Зарезервировано, должно быть равно нулю. <br/>                                                                     |
|                                                                      | 0x0004 <br/> | Зарезервировано, должно быть равно нулю. <br/>                                                                     |
|                                                                      | 0x0008 <br/> | Зарезервировано, должно быть равно нулю. <br/>                                                                     |
| IMAGE \_ DLLCHARACTERISTICS \_ High \_ энтропия \_ ва <br/>             | 0x0020 <br/> | Образ может работать с большим 64-битным виртуальным адресным пространством с высоким уровнем энтропии. <br/>                               |
| \_DLLCHARACTERISTICS изображения\_ <br/> ДИНАМИЧЕСКИЙ \_ базовый <br/>    | 0x0040 <br/> | Библиотека DLL может быть перемещена во время загрузки. <br/>                                                          |
| \_DLLCHARACTERISTICS изображения\_ <br/> ПРИНУДИТЕЛЬная \_ целостность <br/> | 0x0080 <br/> | Проверки целостности кода применяются принудительно. <br/>                                                         |
| \_DLLCHARACTERISTICS изображения\_ <br/> совместимость с NX \_ <br/>       | 0x0100 <br/> | Образ совместим с NX. <br/>                                                                     |
| ОБРАЗ \_ DLLCHARACTERISTICS \_ без \_ изоляции <br/>                | 0x0200 <br/> | С учетом изоляции, но не изолируйте образ. <br/>                                              |
| IMAGE \_ DLLCHARACTERISTICS \_ без \_ SEH <br/>                      | 0x0400 <br/> | Не использует обработку структурированных исключений (SE). В этом образе нельзя вызвать обработчик SE. <br/> |
| ОБРАЗ \_ DLLCHARACTERISTICS \_ без \_ привязки <br/>                     | 0x0800 <br/> | Не привяжите образ. <br/>                                                                      |
| \_DLLCHARACTERISTICSя \_ APPCONTAINER образа <br/>                  | 0x1000 <br/> | Образ должен выполняться в AppContainer. <br/>                                                      |
| \_ \_ драйвер WDM DLLCHARACTERISTICS для образа \_ <br/>                  | 0x2000 <br/> | Драйвер WDM. <br/>                                                                               |
| IMAGE \_ DLLCHARACTERISTICS \_ Guard \_ CF <br/>                     | 0x4000 <br/> | Изображение поддерживает защиту потока управления. <br/>                                                          |
| IMAGE \_ DLLCHARACTERISTICS \_ Terminal \_ Server с поддержкой сервера терминалов \_ <br/>      | 0x8000 <br/> | С учетом сервера терминалов. <br/>                                                                      |

#### <a name="optional-header-data-directories-image-only"></a>Необязательные каталоги данных заголовков (только изображение)

Каждый каталог данных предоставляет адрес и размер таблицы или строки, которые использует Windows. Эти записи каталога данных загружаются в память, чтобы система могла их использовать во время выполнения. Каталог данных — это 8-байтовое поле, которое имеет следующее объявление:

```cpp
typedef struct _IMAGE_DATA_DIRECTORY {
    DWORD   VirtualAddress;
    DWORD   Size;
} IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;
```

Первое поле, Виртуаладдресс, фактически является RVA таблицы. RVA — это адрес таблицы относительно базового адреса изображения при загрузке таблицы. Второе поле задает размер в байтах. Каталоги данных, которые формируют последнюю часть необязательного заголовка, перечислены в следующей таблице.

Обратите внимание, что количество каталогов не фиксировано. Перед поиском конкретного каталога проверьте поле Нумберофрваандсизес в необязательном заголовке.

Кроме того, не следует считать, что RVA в этой таблице указывает на начало раздела или что разделы, содержащие конкретные таблицы, имеют определенные имена.

| Offset (PE/формат PE32 +)   | Размер          | Поле                               | Описание                                                                                                                                                                          |
|---------------------|---------------|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 96/112 <br/>  | 8 <br/> | Экспорт таблицы <br/>            | Адрес и размер таблицы экспорта. Дополнительные сведения см. в [разделе. едата (только изображение)](#the-edata-section-image-only). <br/>                                                |
| 104/120 <br/> | 8 <br/> | Импорт таблицы <br/>            | Адрес и размер таблицы импорта. Дополнительные сведения см. [в разделе. иДата](#the-idata-section).<br/>                                                                    |
| 112/128 <br/> | 8 <br/> | Таблица ресурсов <br/>          | Адрес и размер таблицы ресурсов. Дополнительные сведения см. [в разделе. rsrc](#the-rsrc-section).<br/>                                                                    |
| 120/136 <br/> | 8 <br/> | Таблица исключений <br/>         | Адрес и размер таблицы исключений. Дополнительные сведения см. [в разделе. pdata](#the-pdata-section). <br/>                                                                |
| 128/144 <br/> | 8 <br/> | Таблица сертификатов <br/>       | Атрибут address и size таблицы сертификатов. Дополнительные сведения см. в описании [атрибута таблица сертификатов (только для изображений)](#the-attribute-certificate-table-image-only). <br/> |
| 136/152 <br/> | 8 <br/> | Базовая таблица перемещений <br/>   | Базовый адрес и размер таблицы перемещения. Дополнительные сведения см. [в разделе. reloc (только изображение)](#the-reloc-section-image-only).<br/>                                   |
| 144/160 <br/> | 8 <br/> | Отладка <br/>                   | Начальный адрес и размер данных отладки. Дополнительные сведения см. [в разделе. Debug](#the-debug-section).<br/>                                                             |
| 152/168 <br/> | 8 <br/> | Архитектура <br/>            | Зарезервировано, должно быть равно 0 <br/>                                                                                                                                                      |
| 160/176 <br/> | 8 <br/> | Глобальный PTR <br/>              | RVA для значения, сохраняемого в глобальном указателе. Элемент size этой структуры должен иметь значение 0. <br/>                                                 |
| 168/184 <br/> | 8 <br/> | Таблица TLS <br/>               | Адрес и размер таблицы локального хранилища потока (TLS). Дополнительные сведения см. [в разделе. TLS](#the-tls-section).<br/>                                                        |
| 176/192 <br/> | 8 <br/> | Загрузить таблицу конфигурации <br/>       | Адрес и размер таблицы конфигурации загрузки. Дополнительные сведения см. [в структуре конфигурации загрузки (только для образа)](#the-load-configuration-structure-image-only).<br/>       |
| 184/200 <br/> | 8 <br/> | Связанный импорт <br/>            | Адрес и размер связанной таблицы импорта. <br/>                                                                                                                                 |
| 192/208 <br/> | 8 <br/> | IAT <br/>                     | Адрес и размер таблицы адресов импорта. Дополнительные сведения см. в разделе [Импорт таблицы адресов](#import-address-table).<br/>                                                 |
| 200/216 <br/> | 8 <br/> | Дескриптор отложенного импорта <br/> | Адрес и размер дескриптора импорта с задержкой. Дополнительные сведения см. в разделе [таблица импорта с отложенной загрузкой (только для изображений)](#delay-load-import-tables-image-only).<br/>                    |
| 208/224 <br/> | 8 <br/> | Заголовок среды выполнения CLR <br/>      | Адрес и размер заголовка среды выполнения среды CLR. Дополнительные сведения см. [в разделе. кормета (только объект)](#the-cormeta-section-object-only).<br/>                                |
| 216/232 <br/> | 8 <br/> | Зарезервировано, должно быть равно нулю <br/>  |                                                                                                                                                                                      |

Запись таблицы сертификатов указывает на таблицу сертификатов атрибутов. Эти сертификаты не загружаются в память в составе образа. Таким образом, первое поле этой записи, которое обычно является RVA, является указателем на файл.

## <a name="section-table-section-headers"></a>Таблица разделов (заголовки разделов)

- [Флаги разделов](#section-flags)
- [Сгруппированные разделы (только объект)](#grouped-sections-object-only)

Каждая строка таблицы разделов фактически является заголовком раздела. Эта таблица сразу следует за необязательным заголовком, если он есть. Это расположение необходимо, так как заголовок файла не содержит прямой указатель на таблицу разделов. Вместо этого расположение таблицы разделов определяется путем вычисления расположения первого байта после заголовков. Обязательно используйте размер необязательного заголовка, как указано в заголовке файла.

Число записей в таблице разделов указывается полем Нумберофсектионс в заголовке файла. Записи в таблице разделов нумеруются, начиная с единицы (1). Записи в разделе "код и память данных" находятся в порядке, выбранном компоновщиком.

В файле изображения VAs для разделов должен быть назначен компоновщиком таким образом, чтобы они находящегося в возрастающем порядке и смежными, и они должны быть кратными значению выравнивание раздела в необязательном заголовке.

Каждый заголовок раздела (запись в таблице разделов) имеет следующий формат, в котором всего 40 байт на запись.



| Offset         | Размер          | Поле                            | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------|---------------|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 8 <br/> | Имя <br/>                 | 8-байтовая строка в кодировке UTF-8, заполненная нулем. Если строка содержит ровно 8 символов, то завершающее значение NULL отсутствует. Для более длинных имен это поле содержит косую черту (/), за которой следует ASCII-представление десятичного числа, которое является смещением в таблице строк. Исполняемые образы не используют таблицу строк и не поддерживают имена разделов длиннее 8 символов. Длинные имена в объектных файлах усекаются, если они выдаются в исполняемый файл. <br/>                                         |
| 8 <br/>  | 4 <br/> | виртуалсизе <br/>          | Общий размер раздела при загрузке в память. Если это значение больше Сизеофравдата, раздел заполняется нулем. Это поле допустимо только для исполняемых образов и должно иметь нулевое значение для объектных файлов. <br/>                                                                                                                                                                                                                                                                                           |
| 12 <br/> | 4 <br/> | виртуаладдресс <br/>       | Для исполняемых образов — адрес первого байта раздела относительно базы изображения при загрузке раздела в память. Для объектных файлов это поле является адресом первого байта до применения перемещения. для простоты компиляторы должны установить это значение равным нулю. В противном случае это произвольное значение, которое вычитается из смещений во время перемещения. <br/>                                                                                                                                         |
| 16 <br/> | 4 <br/> | сизеофравдата <br/>        | Размер раздела (для объектных файлов) или размера инициализированных данных на диске (для файлов изображений). Для исполняемых образов это должно быть кратно FileAlignment из необязательного заголовка. Если это значение меньше Виртуалсизе, оставшаяся часть раздела заполнена нулем. Так как поле Сизеофравдата округляется, а поле Виртуалсизе — нет, Сизеофравдата также может быть больше Виртуалсизе. Если раздел содержит только неинициализированные данные, это поле должно быть равно нулю. <br/> |
| 20 <br/> | 4 <br/> | поинтерторавдата <br/>     | Указатель файла на первую страницу раздела в COFF-файле. Для исполняемых образов это должно быть кратно FileAlignment из необязательного заголовка. Для объектных файлов значение должно быть согласовано по 4-байтовой границе для лучшей производительности. Если раздел содержит только неинициализированные данные, это поле должно быть равно нулю. <br/>                                                                                                                                                                               |
| 24 <br/> | 4 <br/> | поинтерторелокатионс <br/> | Указатель файла на начало записей перемещения для раздела. Это значение равно нулю для исполняемых образов или в случае отсутствия перемещения. <br/>                                                                                                                                                                                                                                                                                                                                                                   |
| 28 <br/> | 4 <br/> | поинтертолиненумберс <br/> | Указатель файла на начало записи номера строки для раздела. При отсутствии номеров строк COFF это значение устанавливается равным нулю. Для образа это значение должно быть равно нулю, так как отладочные данные COFF являются устаревшими. <br/>                                                                                                                                                                                                                                                                                            |
| 32 <br/> | 2 <br/> | нумберофрелокатионс <br/>  | Число записей перемещения для раздела. Для исполняемых образов это значение равно нулю. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 34 <br/> | 2 <br/> | нумберофлиненумберс <br/>  | Число записей номера строки для раздела. Для образа это значение должно быть равно нулю, так как отладочные данные COFF являются устаревшими. <br/>                                                                                                                                                                                                                                                                                                                                                                          |
| 36 <br/> | 4 <br/> | Характеристики <br/>      | Флаги, описывающие характеристики раздела. Дополнительные сведения см. в разделе [Флаги разделов](#section-flags).<br/>                                                                                                                                                                                                                                                                                                                                                                                                |



 

### <a name="section-flags"></a>Флаги разделов

Флаги раздела в поле характеристики заголовка раздела обозначают характеристики раздела.



| Флаг                                              | Значение                  | Описание                                                                                                                                                                 |
|---------------------------------------------------|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                   | 0x00000000 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
|                                                   | 0x00000001 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
|                                                   | 0x00000002 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
|                                                   | 0x00000004 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| ОБРАЗ \_ SCN \_ тип \_ без \_ панели <br/>             | 0x00000008 <br/> | Раздел не должен быть заполнен до следующей границы. Этот флаг устарел и заменяется образом уведомления \_ SCN \_ по \_ 1BYTES. Это допустимо только для объектных файлов. <br/> |
|                                                   | 0x00000010 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| \_код уведомления SCN \_ CNT \_ <br/>                 | 0x00000020 <br/> | Раздел содержит исполняемый код. <br/>                                                                                                                           |
| ОБРАЗ \_ \_ CNT \_ инициализированные \_ данные уведомления SCN <br/>    | 0x00000040 <br/> | Раздел содержит инициализированные данные. <br/>                                                                                                                          |
| ОБРАЗ \_ SCN \_ CNT \_ неинициализированные \_ данные <br/> | 0x00000080 <br/> | Раздел содержит неинициализированные данные. <br/>                                                                                                                        |
| ИЗОБРАЖЕНИЕ уведомления \_ SCN \_ LNK \_ <br/>                | 0x00000100 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| сведения о сообразе \_ SCN \_ LNK \_ <br/>                 | 0x00000200 <br/> | Раздел содержит комментарии или другие сведения. Раздел drectve имеет этот тип. Это допустимо только для объектных файлов. <br/>                                    |
|                                                   | 0x00000400 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| ИЗОБРАЖЕНИЕ уведомления \_ SCN \_ LNK \_ <br/>               | 0x00000800 <br/> | Раздел не станет частью образа. Это допустимо только для объектных файлов. <br/>                                                                             |
| ИЗОБРАЖЕНИЕ \_ SCN \_ LNK ( \_ COMDAT) <br/>               | 0x00001000 <br/> | Раздел содержит данные COMDAT. Дополнительные сведения см. в разделе [COMDAT (только объект)](#comdat-sections-object-only). Это допустимо только для объектных файлов. <br/> |
| ИЗОБРАЖЕНИЕ \_ SCN \_ гпрел <br/>                     | 0x00008000 <br/> | Раздел содержит данные, на которые ссылается глобальный указатель (GP). <br/>                                                                                           |
| Очистка образа уведомления \_ SCN \_ \_ <br/>            | 0x00020000 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| ОБРАЗ \_ уведомления \_ SCN \_ 16-разрядный <br/>                | 0x00020000 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| \_ \_ Блокировка памяти образа \_ SCN <br/>               | 0x00040000 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| \_ \_ \_ ПРЕДВАРИТЕЛЬная Загрузка образа уведомления SCN <br/>              | 0x00080000 <br/> | Зарезервировано для последующего использования. <br/>                                                                                                                                        |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 1BYTES <br/>             | 0x00100000 <br/> | Выровняйте данные на границе 1 байта. Допустимо только для объектных файлов. <br/>                                                                                                   |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 2BYTES <br/>             | 0x00200000 <br/> | Выровняйте данные по 2-байтовой границе. Допустимо только для объектных файлов. <br/>                                                                                                   |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 4BYTES <br/>             | 0x00300000 <br/> | Выровняйте данные по 4-байтовой границе. Допустимо только для объектных файлов. <br/>                                                                                                   |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 8BYTES <br/>             | 0x00400000 <br/> | Выровняйте данные по 8-байтовой границе. Допустимо только для объектных файлов. <br/>                                                                                                  |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 16BYTES <br/>            | 0x00500000 <br/> | Выровняйте данные по 16-байтовой границе. Допустимо только для объектных файлов. <br/>                                                                                                  |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 32BYTES <br/>            | 0x00600000 <br/> | Выровняйте данные на границе 32 байта. Допустимо только для объектных файлов. <br/>                                                                                                  |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 64BYTES <br/>            | 0x00700000 <br/> | Выровняйте данные на границе 64 байта. Допустимо только для объектных файлов. <br/>                                                                                                  |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 128BYTES <br/>           | 0x00800000 <br/> | Выровняйте данные на границе 128 байта. Допустимо только для объектных файлов. <br/>                                                                                                 |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 256BYTES <br/>           | 0x00900000 <br/> | Выровняйте данные на границе 256 байта. Допустимо только для объектных файлов. <br/>                                                                                                 |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 512BYTES <br/>           | 0x00A00000 <br/> | Выровняйте данные на границе 512 байта. Допустимо только для объектных файлов. <br/>                                                                                                 |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 1024BYTES <br/>          | 0x00B00000 <br/> | Выровняйте данные на границе 1024 байта. Допустимо только для объектных файлов. <br/>                                                                                                |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 2048BYTES <br/>          | 0x00C00000 <br/> | Выровняйте данные на границе 2048 байта. Допустимо только для объектных файлов. <br/>                                                                                                |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 4096BYTES <br/>          | 0x00D00000 <br/> | Выровняйте данные на границе 4096 байта. Допустимо только для объектных файлов. <br/>                                                                                                |
| ИЗОБРАЖЕНИЕ \_ уведомления \_ SCN \_ 8192BYTES <br/>          | 0x00E00000 <br/> | Выровняйте данные по границе 8192 байта. Допустимо только для объектных файлов. <br/>                                                                                               |
| ИЗОБРАЖЕНИЕ \_ SCN \_ LNK \_ нрелок \_ овфл <br/>         | 0x01000000 <br/> | Раздел содержит расширенные перемещения. <br/>                                                                                                                      |
| ОБРАЗ \_ уведомления \_ SCN \_ отклоняется <br/>          | 0x02000000 <br/> | При необходимости раздел можно отменять. <br/>                                                                                                                         |
| ОБРАЗЫ \_ уведомления \_ SCN \_ не \_ кэшированы <br/>          | 0x04000000 <br/> | Раздел не может быть кэширован. <br/>                                                                                                                                   |
| нестраничных изображений уведомления \_ SCN \_ \_ \_ <br/>           | 0x08000000 <br/> | Раздел не может быть страничным. <br/>                                                                                                                                    |
| совместное создание образа уведомления \_ SCN \_ \_ <br/>               | 0x10000000 <br/> | Раздел может быть общим в памяти. <br/>                                                                                                                            |
| выполнение образа уведомления \_ SCN \_ \_ <br/>              | 0x20000000 <br/> | Раздел можно выполнить как код. <br/>                                                                                                                            |
| чтение образа уведомления \_ SCN \_ \_ <br/>                 | 0x40000000 <br/> | Раздел можно прочитать. <br/>                                                                                                                                        |
| \_ \_ запись MEM уведомления образа \_ записи <br/>                | 0x80000000 <br/> | Раздел можно записать в. <br/>                                                                                                                                  |



 

ИЗОБРАЖЕНИЕ \_ SCN \_ LNK \_ нрелок \_ овфл указывает, что число повторов для раздела превышает 16 битов, зарезервированных для него в заголовке раздела. Если бит задан, а поле Нумберофрелокатионс в заголовке раздела имеет значение 0xFFFF, фактическое число перемещается в 32-битном поле Виртуаладдресс первого перемещения. Является ошибкой то, что \_ установлен образ SCN \_ LNK \_ нрелок \_ овфл, и в разделе меньше 0xFFFF расположений.

### <a name="grouped-sections-object-only"></a>Сгруппированные разделы (только объект)

"$"? символ (знак доллара) имеет специальную интерпретацию в именах разделов в объектных файлах.

При определении раздела изображения, который будет содержать содержимое раздела объекта, компоновщик отклоняет "$"? и все символы, которые следуют за ним. Таким словами, раздел объекта с именем. **текст $ X** фактически участвует в разделе **. Text** изображения.

Однако символы, следующие за символом "$"? Определите порядок вкладов в раздел Image. Все публикации с одним и тем же именем раздела объекта выделяются на изображении непрерывно, а блоки публикаций сортируются в лексической последовательности по имени объектного раздела. Таким образом, все в объектных файлах с именем раздела **. текст $ X** завершается вместе, после публикации **. Text $ W** и перед публикациями **. Text $ Y** .

Имя раздела в файле изображения никогда не содержит "$"? .

## <a name="other-contents-of-the-file"></a>Другое содержимое файла

- [Данные раздела](#section-data)
- [Перемещения COFF (только объект)](#coff-relocations-object-only)
  - [Индикаторы типов](#type-indicators)
- [Номера строк COFF (не рекомендуется)](#coff-line-numbers-deprecated)
- [Таблица символов COFF](#coff-symbol-table)
  - [Представление имени символа](#symbol-name-representation)
  - [Значения номеров разделов](#section-number-values)
  - [Представление типа](#type-representation)
  - [Класс хранения](#storage-class)
- [Вспомогательные записи символов](#auxiliary-symbol-records)
  - [Вспомогательный формат 1. определения функций](#auxiliary-format-1-function-definitions)
  - [Вспомогательные символы формата 2:. BF и. EF](#auxiliary-format-2-bf-and-ef-symbols)
  - [Вспомогательный формат 3: слабые внешние](#auxiliary-format-3-weak-externals)
  - [Вспомогательный формат 4: файлы](#auxiliary-format-4-files)
  - [Дополнительный формат 5. определения разделов](#auxiliary-format-5-section-definitions)
  - [Разделы COMDAT (только объект)](#comdat-sections-object-only)
  - [Определение токена CLR (только объект)](#clr-token-definition-object-only)
- [Таблица строк COFF](#coff-string-table)
- [Таблица атрибутов сертификата (только для изображений)](#the-attribute-certificate-table-image-only)
  - [Данные сертификата](#certificate-data)
- [Отложенная загрузка таблиц импорта (только для изображений)](#delay-load-import-tables-image-only)
  - [Таблица Delay-Load Directory](#the-delay-load-directory-table)
  - [Атрибуты](#attributes)
  - [имя](#name);
  - [Маркер модуля](#module-handle)
  - [Таблица адресов задержки импорта](#delay-import-address-table)
  - [Таблица имен отложенных импортов](#delay-import-name-table)
  - [Откладывание связанной таблицы адресов импорта и отметок времени](#delay-bound-import-address-table-and-time-stamp)
  - [Таблица адресов импорта отложенной выгрузки](#delay-unload-import-address-table)

Структуры данных, описанные выше, вплоть до и включая необязательный заголовок, расположены по фиксированному смещению от начала файла (или из заголовка PE, если файл является изображением, содержащим заглушку MS-DOS).

Оставшаяся часть объекта COFF или файла изображения содержит блоки данных, которые не обязательно должны быть в определенном смещении файла. Вместо этого расположения определяются указателями в необязательном заголовке или в заголовке раздела.

Исключением является изображение со значением выравнивание раздела меньше размера страницы архитектуры (4 K для Intel x86 и для MIPS и 8 КБ для Itanium). Описание выравнивание раздела см. в разделе [необязательный заголовок (только изображение)](#optional-header-image-only). В этом случае существуют ограничения на смещение файла данных раздела, как описано в разделе 5,1 "данные раздела". Еще одно исключение заключается в том, что сертификат атрибута и сведения об отладке должны размещаться в самом конце файла изображения с таблицей сертификата «атрибут» непосредственно перед разделом «Отладка», поскольку загрузчик не сопоставляет их с памятью. Однако правило сведений о сертификате атрибута и отладочной информации не применяется к объектным файлам.

### <a name="section-data"></a>Данные раздела

Инициализированные данные для раздела состоят из простых блоков байтов. Однако для разделов, содержащих все нули, данные раздела указывать не нужно.

Данные для каждого раздела находятся в смещении файла, которое было задано полем Поинтерторавдата в заголовке раздела. Размер этих данных в файле указывается полем Сизеофравдата. Если значение Сизеофравдата меньше Виртуалсизе, остаток дополняется нулями.

В файле изображения данные раздела должны быть согласованы по границе, как указано в поле FileAlignment в необязательном заголовке. Данные раздела должны отображаться в порядке значений RVA для соответствующих разделов (как и отдельные заголовки разделов в таблице разделов).

Существуют дополнительные ограничения на файлы изображений, если значение выравнивание раздела в необязательном заголовке меньше размера страницы архитектуры. Для таких файлов расположение данных раздела в файле должно совпадать с расположением в памяти при загрузке изображения, чтобы физическое смещение для данных раздела совпадало с RVA.

### <a name="coff-relocations-object-only"></a>Перемещения COFF (только объект)

Объектные файлы содержат перемещения COFF, которые определяют, как следует изменять данные раздела при помещении в файл изображения и последующей загрузке в память.

Файлы изображений не содержат перемещения COFF, так как для всех символов, на которые указывают ссылки, уже были назначены адреса в пространстве с плоским адресом. Изображение содержит сведения о перемещении в виде базовых перемещений в разделе. reloc (если изображение не содержит \_ \_ \_ неочищенный атрибут). Дополнительные сведения см. [в разделе. reloc (только изображение)](#the-reloc-section-image-only).

Для каждого раздела в объектном файле массив записей фиксированной длины содержит перерасположение COFF раздела. Расположение и длина массива указываются в заголовке раздела. Каждый элемент массива имеет следующий формат.



| Offset        | Размер          | Поле                        | Описание                                                                                                                                                                                                                                                                                                                                                     |
|---------------|---------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | виртуаладдресс <br/>   | Адрес элемента, к которому применяется перемещение. Это смещение от начала раздела и значение поля RVA/offset раздела. См. [раздел Таблица (заголовки разделов)](#section-table-section-headers). Например, если первый байт раздела имеет адрес 0x10, третий байт имеет адрес 0x12. <br/> |
| 4 <br/> | 4 <br/> | симболтаблеиндекс <br/> | Отсчитываемый от нуля индекс в таблице символов. Этот символ дает адрес, который будет использоваться для перемещения. Если указанный символ содержит класс хранения раздела, то адрес символа является адресом первого раздела с таким же именем. <br/>                                                                                                 |
| 8 <br/> | 2 <br/> | Тип <br/>             | Значение, указывающее тип перемещения, которое должно быть выполнено. Допустимые типы перемещения зависят от типа компьютера. См. раздел [индикаторы типов](#type-indicators). <br/>                                                                                                                                                                                     |



 

Если символ, на который ссылается поле Симболтаблеиндекс, содержит раздел класс хранения IMAGE \_ Class \_ SYM \_ , то адрес символа является началом раздела. Раздел обычно находится в том же файле, за исключением случаев, когда объектный файл является частью архива (библиотеки). В этом случае раздел можно найти в любом другом файле объекта в архиве, который имеет то же имя архива, что и текущий объектный файл. (Связь с именем архива-Member используется в связи с импортируемыми таблицами, то есть в разделе. иДата.)

#### <a name="type-indicators"></a>Индикаторы типов

Поле Type (тип) записи перемещения указывает, какой вид перемещения следует выполнить. Различные типы перемещения определяются для каждого типа компьютера.

##### <a name="x64-processors"></a>Процессоры x64

Для 64-разрядных и совместимых процессоров определены следующие индикаторы типа перемещения.



| Константа                                | Значение              | Описание                                                                                                                                                   |
|-----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ amd64 \_ Absolute <br/> | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                        |
| IMAGE \_ rel \_ amd64 \_ ADDR64 <br/>   | 0x0001 <br/> | 64-бит ва целевого объекта перемещения. <br/>                                                                                                           |
| IMAGE \_ rel \_ amd64 \_ ADDR32 <br/>   | 0x0002 <br/> | 32-бит ва целевого объекта перемещения. <br/>                                                                                                           |
| IMAGE \_ rel \_ amd64 \_ ADDR32NB <br/> | 0x0003 <br/> | 32-разрядный адрес без базы образа (RVA). <br/>                                                                                                   |
| IMAGE \_ rel \_ amd64 \_ REL32 <br/>    | 0x0004 <br/> | 32-разрядный относительный адрес от байта после перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ amd64 \_ REL32 \_ 1 <br/> | 0x0005 <br/> | 32-разрядный адрес относительно расстояния 1 байта от перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ amd64 \_ REL32 \_ 2 <br/> | 0x0006 <br/> | 32-разрядный адрес относительно расстояния в байтах 2 от перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ amd64 \_ REL32 \_ 3 <br/> | 0x0007 <br/> | 32-разрядный адрес относительно расстояния в 3 байта от перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ amd64 \_ REL32 \_ 4 <br/> | 0x0008 <br/> | 32-разрядный адрес относительно однобайтового расстояния 4 из перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ amd64 \_ REL32 \_ 5 <br/> | 0x0009 <br/> | 32-разрядный адрес относительно расстояния в байтах 5 от перемещения. <br/>                                                                               |
| IMAGE \_ rel \_ AMD64, \_ раздел <br/>  | 0x000A <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                  |
| IMAGE \_ rel \_ amd64 \_ секрел <br/>   | 0x000B <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/> |
| IMAGE \_ rel \_ amd64 \_ SECREL7 <br/>  | 0x000C <br/> | 7-битовое смещение без знака от базового раздела, содержащего целевой объект. <br/>                                                                    |
| \_Маркер Image rel \_ amd64 \_ <br/>    | 0x000D <br/> | Токены CLR. <br/>                                                                                                                                       |
| IMAGE \_ rel \_ amd64 \_ SREL32 <br/>   | 0x000E <br/> | 32-разрядное значение, зависящее от диапазона, порожденное в объект. <br/>                                                                                     |
| \_Пара Image rel \_ amd64 \_ <br/>     | 0x000F <br/> | Пара, которая должна следовать сразу за каждым значением, зависящим от диапазона. <br/>                                                                                   |
| IMAGE \_ rel \_ amd64 \_ SSPAN32 <br/>  | 0x0010 <br/> | 32-разрядное значение, зависящее от диапазона, которое применяется во время компоновки. <br/>                                                                                |



 

##### <a name="arm-processors"></a>Процессоры ARM

Для процессоров ARM определены следующие индикаторы типа перемещения.



| Константа                                | Значение              | Описание                                                                                                                                                                                                                                                            |
|-----------------------------------------|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИЗОБРАЖЕНИЕ \_ rel \_ ARM, \_ абсолютный <br/>   | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                                                                 |
| IMAGE \_ rel \_ ARM \_ ADDR32 <br/>     | 0x0001 <br/> | 32-битная версия целевого объекта. <br/>                                                                                                                                                                                                                               |
| IMAGE \_ rel \_ ARM \_ ADDR32NB <br/>   | 0x0002 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                                                                                                                              |
| IMAGE \_ rel \_ ARM \_ BRANCH24 <br/>   | 0x0003 <br/> | 24-разрядное относительное смещение целевого объекта. <br/>                                                                                                                                                                                                            |
| IMAGE \_ rel \_ ARM \_ BRANCH11 <br/>   | 0x0004 <br/> | Ссылка на вызов подпрограммы. Ссылка состоит из 2 16-разрядных инструкций с 11-битными смещениями. <br/>                                                                                                                                                 |
| IMAGE \_ rel \_ ARM \_ REL32 <br/>      | 0x000A <br/> | 32-разрядный относительный адрес от байта после перемещения. <br/>                                                                                                                                                                                        |
| ИЗОБРАЖЕНИЕ \_ \_ раздела ARM \_ rel <br/>    | 0x000E <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                                                                           |
| IMAGE \_ rel \_ ARM \_ секрел <br/>     | 0x000F <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                                                                          |
| IMAGE \_ rel \_ ARM \_ MOV32 <br/>      | 0x0010 <br/> | 32-битная версия целевого объекта. Это перемещение применяется с помощью инструкции МОВВ для младших 16 бит, за которыми следует МОВТ для старших 16 бит. <br/>                                                                                                              |
| IMAGE \_ rel \_ Thumb \_ MOV32 <br/>    | 0x0011 <br/> | 32-битная версия целевого объекта. Это перемещение применяется с помощью инструкции МОВВ для младших 16 бит, за которыми следует МОВТ для старших 16 бит. <br/>                                                                                                              |
| IMAGE \_ rel \_ Thumb \_ BRANCH20 <br/> | 0x0012 <br/> | Инструкция исправлена с 21-битным относительным смещением до 2-байтного целевого объекта с согласованием. Наименьший значащий бит смещения всегда равен нулю и не сохраняется. Это перемещение соответствует инструкции в виде Thumb-2 32-разрядной условной B. <br/> |
| Не используется <br/>                      | 0x0013 <br/> |                                                                                                                                                                                                                                                                        |
| IMAGE \_ rel \_ Thumb \_ BRANCH24 <br/> | 0x0014 <br/> | Инструкция исправлена с 25-битовым относительным смещением к целевому объекту с согласованием в 2 байта. Наименьший значащий бит смещения равен нулю и не сохраняется. Это перемещение соответствует инструкции Thumb-2 B. <br/>                            |
| IMAGE \_ rel \_ Thumb \_ BLX23 <br/>    | 0x0015 <br/> | Инструкция исправлена с 25-битным относительным смещением до 4-байтного целевого объекта с согласованием. Младшие 2 бита смещения равны нулю и не сохраняются. <br/> Это перемещение соответствует инструкции БЛКС с бегунком 2. <br/>                      |
| \_пара образов rel \_ ARM \_ <br/>       | 0x0016 <br/> | Перемещение допустимо только в том случае, если оно непосредственно следует за ARM \_ рефхи или Thumb \_ рефхи. Его Симболтаблеиндекс содержит смещение, а не индекс в таблице символов. <br/>                                                                                |



 

##### <a name="arm64-processors"></a>Процессоры ARM64

Для процессоров ARM64 определены следующие индикаторы типа перемещения.



| Константа                                       | Значение              | Описание                                                                                                                                                   |
|------------------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ ARM64 \_ Absolute <br/>        | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                        |
| IMAGE \_ rel \_ ARM64 \_ ADDR32 <br/>          | 0x0001 <br/> | 32-битная версия целевого объекта. <br/>                                                                                                                      |
| IMAGE \_ rel \_ ARM64 \_ ADDR32NB <br/>        | 0x0002 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                     |
| IMAGE \_ rel \_ ARM64 \_ BRANCH26 <br/>        | 0x0003 <br/> | 26-битное относительное смещение целевого объекта для инструкций B и BL. <br/>                                                                        |
| IMAGE \_ rel \_ ARM64 \_ пажебасе \_ REL21 <br/> | 0x0004 <br/> | База страницы целевого объекта для инструкции АДРП. <br/>                                                                                                |
| IMAGE \_ rel \_ ARM64 \_ REL21 <br/>           | 0x0005 <br/> | 12-разрядное относительное смещение целевого объекта для инструкции ADR <br/>                                                                               |
| IMAGE \_ rel \_ ARM64 \_ пажеоффсет \_ 12A <br/> | 0x0006 <br/> | 12-разрядное смещение страницы целевого объекта для инструкций ADD/сложение (immediate) с нулевым смещением. <br/>                                                      |
| IMAGE \_ rel \_ ARM64 \_ пажеоффсет \_ 12L <br/> | 0x0007 <br/> | 12-разрядное смещение страницы целевого объекта для инструкции LDR (с непосредственным индексированием без знака). <br/>                                                          |
| IMAGE \_ rel \_ ARM64 \_ секрел <br/>          | 0x0008 <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/> |
| IMAGE \_ rel \_ ARM64 \_ секрел \_ LOW12A <br/>  | 0x0009 <br/> | Бит 0:11 для смещения раздела целевого объекта. инструкции по ДОБАВЛЕНию/ДОБАВЛЕНию (immediate) с нулевым смещением. <br/>                                                  |
| IMAGE \_ rel \_ ARM64 \_ секрел \_ HIGH12A <br/> | 0x000A <br/> | Бит 12:23 для смещения раздела целевого объекта. инструкции по ДОБАВЛЕНию/ДОБАВЛЕНию (immediate) с нулевым смещением. <br/>                                                 |
| IMAGE \_ rel \_ ARM64 \_ секрел \_ LOW12L <br/>  | 0x000B <br/> | Бит 0:11 для смещения раздела целевого объекта, для инструкции LDR (с непосредственным проиндексированным, без знака). <br/>                                                      |
| \_ \_ Маркер ARM64 rel \_ изображения <br/>           | 0x000C <br/> | Токен CLR. <br/>                                                                                                                                        |
| \_Rel образа \_ , \_ раздел ARM64 <br/>         | 0x000D <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                  |
| IMAGE \_ rel \_ ARM64 \_ ADDR64 <br/>          | 0x000E <br/> | 64-бит ва целевого объекта перемещения. <br/>                                                                                                           |
| IMAGE \_ rel \_ ARM64 \_ BRANCH19 <br/>        | 0x000F <br/> | 19-битное смещение для целевого объекта перемещения, для инструкции условной B. <br/>                                                                        |
| IMAGE \_ rel \_ ARM64 \_ BRANCH14 <br/>        | 0x0010 <br/> | 14-битное смещение для целевого объекта перемещения, инструкции ТБЗ и ТБНЗ. <br/>                                                                        |
| IMAGE \_ rel \_ ARM64 \_ REL32 <br/>           | 0x0011 <br/> | 32-разрядный относительный адрес от байта после перемещения. <br/>                                                                               |

##### <a name="hitachi-superh-processors"></a>Процессоры Hitachi Суперх

Для процессоров SH3 и SH4 определены следующие индикаторы типа перемещения. Перемещения, относящиеся к SH5, отмечены как SHM (SH-файлы).



| Константа                                      | Значение              | Описание                                                                                                                                                                                                                |
|-----------------------------------------------|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ SH3 \_ Absolute <br/>         | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                     |
| IMAGE \_ rel \_ SH3 \_ DIRECT16 <br/>         | 0x0001 <br/> | Ссылка на 16-разрядное расположение, содержащее значение ва целевого символа. <br/>                                                                                                                                  |
| IMAGE \_ rel \_ SH3 \_ DIRECT32 <br/>         | 0x0002 <br/> | 32-бит ва целевого символа. <br/>                                                                                                                                                                            |
| IMAGE \_ rel \_ SH3 \_ DIRECT8 <br/>          | 0x0003 <br/> | Ссылка на 8-разрядное расположение, содержащее значение ва целевого символа. <br/>                                                                                                                                   |
| IMAGE \_ rel \_ SH3 \_ DIRECT8 \_ Word <br/>    | 0x0004 <br/> | Ссылка на 8-разрядную инструкцию, которая содержит действующий 16-разрядный адрес целевого символа. <br/>                                                                                                               |
| IMAGE \_ rel \_ SH3 \_ DIRECT8 \_ Long <br/>    | 0x0005 <br/> | Ссылка на 8-разрядную инструкцию, которая содержит действующий 32-разрядный адрес целевого символа. <br/>                                                                                                               |
| IMAGE \_ rel \_ SH3 \_ DIRECT4 <br/>          | 0x0006 <br/> | Ссылка на 8-разрядное расположение, младшие 4 бита которого содержат значение ва целевого символа. <br/>                                                                                                                        |
| IMAGE \_ rel \_ SH3 \_ DIRECT4 \_ Word <br/>    | 0x0007 <br/> | Ссылка на 8-разрядную инструкцию, младшие 4 бита которой содержит действующий 16-битный индекс целевого символа. <br/>                                                                                                    |
| IMAGE \_ rel \_ SH3 \_ DIRECT4 \_ Long <br/>    | 0x0008 <br/> | Ссылка на 8-разрядную инструкцию, младшие 4 бита которой содержит действующий 32-битный индекс целевого символа. <br/>                                                                                                    |
| IMAGE \_ rel \_ SH3 \_ PCREL8 \_ Word <br/>     | 0x0009 <br/> | Ссылка на 8-разрядную инструкцию, которая содержит действующее 16-разрядное относительное смещение целевого символа. <br/>                                                                                                  |
| IMAGE \_ rel \_ SH3 \_ PCREL8 \_ Long <br/>     | 0x000A <br/> | Ссылка на 8-разрядную инструкцию, которая содержит эффективное 32-разрядное относительное смещение целевого символа. <br/>                                                                                                  |
| IMAGE \_ rel \_ SH3 \_ PCREL12 \_ Word <br/>    | 0x000B <br/> | Ссылка на 16-разрядную инструкцию, Нижняя 12 бит которой содержит действующее 16-разрядное относительное смещение целевого символа. <br/>                                                                                     |
| ОБРАЗ \_ rel \_ SH3 \_ стартоф \_ раздел <br/> | 0x000C <br/> | Ссылка на 32-разрядное расположение, которое является адресом раздела, содержащего целевой символ. <br/>                                                                                                                |
| IMAGE \_ rel \_ SH3 \_ sizeof \_ Section <br/>  | 0x000D <br/> | Ссылка на 32-разрядное расположение, равное размеру раздела, содержащего целевой символ. <br/>                                                                                                            |
| \_Rel образа \_ , \_ раздел SH3 <br/>          | 0x000E <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                               |
| IMAGE \_ rel \_ SH3 \_ секрел <br/>           | 0x000F <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                              |
| IMAGE \_ rel \_ SH3 \_ DIRECT32 \_ NetBIOS <br/>     | 0x0010 <br/> | 32-разрядный RVA целевого символа. <br/>                                                                                                                                                                           |
| IMAGE \_ rel \_ SH3 \_ GPREL4 \_ Long <br/>     | 0x0011 <br/> | Относительная GP. <br/>                                                                                                                                                                                                   |
| \_ \_ Маркер SH3 rel \_ изображения <br/>            | 0x0012 <br/> | Токен CLR. <br/>                                                                                                                                                                                                     |
| IMAGE \_ rel \_ SHM \_ пкрелпт <br/>          | 0x0013 <br/> | Смещение от текущей инструкции в лонгвордс. Если бит в режиме не задан, вставьте обратную часть нижнего бита в бит 32, чтобы выбрать PTA или PTB. <br/>                                                          |
| IMAGE \_ rel \_ SHM \_ рефло <br/>            | 0x0014 <br/> | Младшие 16 бит 32-разрядного адреса. <br/>                                                                                                                                                                         |
| IMAGE \_ rel \_ SHM \_ рефхалф <br/>          | 0x0015 <br/> | Старшие 16 бит 32-разрядного адреса. <br/>                                                                                                                                                                        |
| IMAGE \_ rel \_ SHM \_ релло <br/>            | 0x0016 <br/> | Младшие 16 разрядов относительного адреса. <br/>                                                                                                                                                                       |
| IMAGE \_ rel \_ SHM \_ релхалф <br/>          | 0x0017 <br/> | Старшие 16 разрядов относительного адреса. <br/>                                                                                                                                                                      |
| \_rel Image \_ SHM, \_ пара <br/>             | 0x0018 <br/> | Перемещение допустимо только в том случае, если оно непосредственно следует за РЕФХАЛФ, РЕЛХАЛФ или РЕЛЛО перемещения. Поле Симболтаблеиндекс перемещения содержит смещение, а не индекс в таблице символов. <br/> |
| \_rel Image \_ SHM \_ mode <br/>           | 0x8000 <br/> | Перерасположение игнорирует режим раздела. <br/>                                                                                                                                                                           |



 

##### <a name="ibm-powerpc-processors"></a>Процессоры IBM PowerPC

Для процессоров PowerPC определены следующие индикаторы типа перемещения.



| Константа                              | Значение              | Описание                                                                                                                                                                                                                                                                                                                                                                         |
|---------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ PPC \_ Absolute <br/> | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                                                                                                                                                                              |
| IMAGE \_ rel \_ PPC \_ ADDR64 <br/>   | 0x0001 <br/> | 64-битная версия целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                            |
| IMAGE \_ rel \_ PPC \_ ADDR32 <br/>   | 0x0002 <br/> | 32-битная версия целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                            |
| IMAGE \_ rel \_ PPC \_ ADDR24 <br/>   | 0x0003 <br/> | Младшие 24 бита ва целевого объекта. Это допустимо только в том случае, если целевой символ является абсолютным и может быть расширен до исходного значения. <br/>                                                                                                                                                                                                                          |
| IMAGE \_ rel \_ PPC \_ ADDR16 <br/>   | 0x0004 <br/> | Младшие 16 бит ва целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                     |
| IMAGE \_ rel \_ PPC \_ ADDR14 <br/>   | 0x0005 <br/> | Младшие 14 бит ва целевого объекта. Это допустимо только в том случае, если целевой символ является абсолютным и может быть расширен до исходного значения. <br/>                                                                                                                                                                                                                               |
| IMAGE \_ rel \_ PPC \_ REL24 <br/>    | 0x0006 <br/> | 24-разрядное смещение относительно местоположения символа. <br/>                                                                                                                                                                                                                                                                                                                   |
| IMAGE \_ rel \_ PPC \_ REL14 <br/>    | 0x0007 <br/> | 14-разрядное смещение на ПК относительно расположения символа. <br/>                                                                                                                                                                                                                                                                                                                   |
| IMAGE \_ rel \_ PPC \_ ADDR32NB <br/> | 0x000A <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                           |
| IMAGE \_ rel \_ PPC \_ секрел <br/>   | 0x000B <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                                                                                                                                                                                       |
| \_rel образа \_ , \_ раздел PPC <br/>  | 0x000C <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                                                                                                                                                                                        |
| IMAGE \_ rel \_ PPC \_ SECREL16 <br/> | 0x000F <br/> | 16-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                                                                                                                                                                                       |
| IMAGE \_ rel \_ PPC \_ рефхи <br/>    | 0x0010 <br/> | Старшие 16 разрядов целевого 32-бита. Используется для первой инструкции в последовательности из двух инструкций, которая загружает полный адрес. За этим перемещением должно сразу следовать повторное расположение пары, Симболтаблеиндекс содержит 16-разрядное смещение со знаком, которое добавляется к 16 верхним позициям, взятым из расположения, которое было перемещено. <br/> |
| IMAGE \_ rel \_ PPC \_ рефло <br/>    | 0x0011 <br/> | Младшие 16 бит ва целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                     |
| \_rel Image \_ PPC, \_ пара <br/>     | 0x0012 <br/> | Перемещение, допустимое только в том случае, если оно непосредственно следует за РЕФХИ или СЕКРЕЛХИ. Его Симболтаблеиндекс содержит смещение, а не индекс в таблице символов. <br/>                                                                                                                                                                                        |
| IMAGE \_ rel \_ PPC \_ секрелло <br/> | 0x0013 <br/> | Младшие 16 бит 32-битного смещения целевого объекта с начала раздела. <br/>                                                                                                                                                                                                                                                                                   |
| IMAGE \_ rel \_ PPC \_ гпрел <br/>    | 0x0015 <br/> | 16-разрядное смещение со знаком для целевого объекта относительно регистра GP. <br/>                                                                                                                                                                                                                                                                                               |
| \_ \_ маркер PPC rel \_ изображения <br/>    | 0x0016 <br/> | Токен CLR. <br/>                                                                                                                                                                                                                                                                                                                                                          |



 

##### <a name="intel-386-processors"></a>Процессоры Intel 386

Для Intel 386 и совместимых процессоров определены следующие индикаторы перемещения.



| Константа                               | Значение              | Описание                                                                                                                                                   |
|----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ i386 \_ Absolute <br/> | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                        |
| IMAGE \_ rel \_ i386 \_ DIR16 <br/>    | 0x0001 <br/> | Не поддерживается. <br/>                                                                                                                                    |
| IMAGE \_ rel \_ i386 \_ REL16 <br/>    | 0x0002 <br/> | Не поддерживается. <br/>                                                                                                                                    |
| IMAGE \_ rel \_ i386 \_ DIR32 <br/>    | 0x0006 <br/> | 32-битный целевой объект. <br/>                                                                                                                           |
| IMAGE \_ rel \_ i386 \_ DIR32NB <br/>  | 0x0007 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                          |
| IMAGE \_ rel \_ i386 \_ SEG12 <br/>    | 0x0009 <br/> | Не поддерживается. <br/>                                                                                                                                    |
| IMAGE \_ rel \_ , \_ раздел i386 <br/>  | 0x000A <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                  |
| IMAGE \_ rel \_ i386 \_ секрел <br/>   | 0x000B <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/> |
| \_Маркер Image rel \_ i386 \_ <br/>    | 0x000C <br/> | Токен CLR. <br/>                                                                                                                                    |
| IMAGE \_ rel \_ i386 \_ SECREL7 <br/>  | 0x000D <br/> | 7-разрядное смещение от базового раздела, содержащего целевой объект. <br/>                                                                             |
| IMAGE \_ rel \_ i386 \_ REL32 <br/>    | 0x0014 <br/> | 32-разрядное относительное смещение целевого объекта. Это поддерживает относительную ветвь x86 и инструкции по вызову. <br/>                                      |



 

##### <a name="intel-itanium-processor-family-ipf"></a>Семейство процессоров Intel Itanium (IPF)

Для семейства процессоров Intel Itanium и совместимых процессоров определены следующие индикаторы типа перемещения. Обратите внимание, что перемещения в инструкциях используют смещение пакета и номер ячейки для смещения перемещения.



| Константа                                 | Значение              | Описание                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ОБРАЗ \_ rel \_ ia64, \_ абсолютный <br/>   | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                                                                                                                                          |
| IMAGE \_ rel \_ ia64 \_ IMM14 <br/>      | 0x0001 <br/> | За перемещением инструкций может следовать перемещение СЛАГАЕМОЕ, значение которого добавляется к целевому адресу, прежде чем оно будет вставлено в указанную область в пакете IMM14. Цель перемещения должна быть абсолютной, или образ должен быть исправлен. <br/>                                                                                 |
| IMAGE \_ rel \_ ia64 \_ IMM22 <br/>      | 0x0002 <br/> | За перемещением инструкций может следовать перемещение СЛАГАЕМОЕ, значение которого добавляется к целевому адресу, прежде чем оно будет вставлено в указанную область в пакете IMM22. Цель перемещения должна быть абсолютной, или образ должен быть исправлен. <br/>                                                                                 |
| IMAGE \_ rel \_ ia64 \_ IMM64 <br/>      | 0x0003 <br/> | Номер слота этого перемещения должен быть одним (1). После перемещения может следовать перемещение СЛАГАЕМОЕ, значение которого добавляется к целевому адресу, прежде чем оно будет сохранено во всех трех слотах пакета IMM64. <br/>                                                                                                                   |
| IMAGE \_ rel \_ ia64 \_ DIR32 <br/>      | 0x0004 <br/> | 32-битный целевой объект. Это поддерживается только для/LARGEADDRESSAWARE: без образов. <br/>                                                                                                                                                                                                                                                    |
| IMAGE \_ rel \_ ia64 \_ DIR64 <br/>      | 0x0005 <br/> | 64-битный целевой объект. <br/>                                                                                                                                                                                                                                                                                                             |
| IMAGE \_ rel \_ ia64 \_ PCREL21B <br/>   | 0x0006 <br/> | Инструкция исправлена с 25-битным относительным смещением к 16-битному целевому объекту с согласованием. Младшие 4 бита смещения равны нулю и не сохраняются. <br/>                                                                                                                                                                     |
| IMAGE \_ rel \_ ia64 \_ PCREL21M <br/>   | 0x0007 <br/> | Инструкция исправлена с 25-битным относительным смещением к 16-битному целевому объекту с согласованием. Младшие 4 бита смещения, которые равны нулю, не сохраняются. <br/>                                                                                                                                                                 |
| IMAGE \_ rel \_ ia64 \_ PCREL21F <br/>   | 0x0008 <br/> | Лсбс смещения этого перемещения должно содержать номер гнезда, а остальное — адрес пакета. В наборе используется 25-разрядное относительное смещение к 16-разрядному целевому объекту с согласованием. Младшие 4 бита смещения равны нулю и не сохраняются. <br/>                                                                |
| IMAGE \_ rel \_ ia64 \_ GPREL22 <br/>    | 0x0009 <br/> | За перемещением инструкций может следовать перемещение СЛАГАЕМОЕ, значение которого добавляется к целевому адресу, а затем — 22-разрядное смещение относительно параметра GP, которое вычисляется и применяется к пакету GPREL22. <br/>                                                                                                                            |
| IMAGE \_ rel \_ ia64 \_ LTOFF22 <br/>    | 0x000A <br/> | Инструкция исправлена с использованием значения 22-разрядного смещения, относительного параметра GP, к записи таблицы литералов целевого символа. Компоновщик создает эту запись таблицы литералов на основе этого перемещения и СЛАГАЕМОЕ перемещения, которое может следовать за этим. <br/>                                                                                                        |
| IMAGE \_ rel \_ ia64, \_ раздел <br/>    | 0x000B <br/> | 16-битный индекс раздела содержит целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                                                                                                                                                         |
| IMAGE \_ rel \_ ia64 \_ SECREL22 <br/>   | 0x000C <br/> | Инструкция исправлена с использованием 22-разрядного смещения целевого объекта в начале раздела. За этим перемещением может сразу же следовать перемещение СЛАГАЕМОЕ, поле значения которого содержит 32-разрядное смещение без знака от начала раздела. <br/>                                                     |
| IMAGE \_ rel \_ ia64 \_ SECREL64I <br/>  | 0x000D <br/> | Номер слота для этого перемещения должен быть одним (1). Инструкция исправлена с 64-битным смещением целевого объекта от начала его раздела. За этим перемещением можно немедленно выполнить перемещение СЛАГАЕМОЕ, в поле Value которого содержится 32-разрядное смещение без знака от начала раздела. <br/> |
| IMAGE \_ rel \_ ia64 \_ SECREL32 <br/>   | 0x000E <br/> | Адрес данных для фиксирования с 32-битным смещением целевого объекта от начала раздела. <br/>                                                                                                                                                                                                                          |
| IMAGE \_ rel \_ ia64 \_ DIR32NB <br/>    | 0x0010 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                                                                                                                                                                                                            |
| IMAGE \_ rel \_ ia64 \_ SREL14 <br/>     | 0x0011 <br/> | Это применяется к немедленному 14-разрядному моменту со знаком, который содержит разность между двумя перемещаемыми целевыми объектами. Это декларативное поле для компоновщика, которое указывает, что компилятор уже выдал это значение. <br/>                                                                                                              |
| IMAGE \_ rel \_ ia64 \_ SREL22 <br/>     | 0x0012 <br/> | Этот параметр применяется к немедленным подписанным 22-битным данным, который содержит разность между двумя перемещаемыми целевыми объектами. Это декларативное поле для компоновщика, которое указывает, что компилятор уже выдал это значение. <br/>                                                                                                              |
| IMAGE \_ rel \_ ia64 \_ SREL32 <br/>     | 0x0013 <br/> | Это применяется к немедленному 32-разрядному моменту, содержащему разницу между двумя перемещаемыми значениями. Это декларативное поле для компоновщика, которое указывает, что компилятор уже выдал это значение. <br/>                                                                                                               |
| IMAGE \_ rel \_ ia64 \_ UREL32 <br/>     | 0x0014 <br/> | Это применяется к некоторому неподписанному 32-разрядному немедленному значению, содержащему разницу между двумя перемещаемыми значениями. Это декларативное поле для компоновщика, которое указывает, что компилятор уже выдал это значение. <br/>                                                                                                            |
| IMAGE \_ rel \_ ia64 \_ PCREL60X <br/>   | 0x0015 <br/> | 60-разрядная адресная привязка для компьютера, которая всегда остается инструкцией БРАЗИЛЬСКИХ пакета МЛКС. <br/>                                                                                                                                                                                                                                                 |
| IMAGE \_ rel \_ ia64 \_ PCREL60B <br/>   | 0x0016 <br/> | 60-разрядная адресная привязка для компьютера. Если целевое смещение замещается в 25-битовом поле со знаком, преобразуйте весь пакет в пакет МББ с помощью NOP. B в слот 1 и 25-разрядной инструкции BR (с 4 самыми низкими битами и нулем) в слоте 2. <br/>                                                                                          |
| IMAGE \_ rel \_ ia64 \_ PCREL60F <br/>   | 0x0017 <br/> | 60-разрядная адресная привязка для компьютера. Если целевое смещение замещается в 25-битовом поле со знаком, преобразуйте весь пакет в пакет МФБ с помощью NOP. F в слоте 1 и 25-разрядной (4 младших бита все нуль и удалено). Инструкция BR в слоте 2. <br/>                                                                                                   |
| IMAGE \_ rel \_ ia64 \_ PCREL60I <br/>   | 0x0018 <br/> | 60-разрядная адресная привязка для компьютера. Если целевое смещение замещается в 25-битовом поле со знаком, преобразуйте весь пакет в комплект MIB с NOP. I в слоте 1 и 25-разрядной (4 младшие биты все нули и удаленные) в слоте 2. <br/>                                                                                                   |
| IMAGE \_ rel \_ ia64 \_ PCREL60M <br/>   | 0x0019 <br/> | 60-разрядная адресная привязка для компьютера. Если целевое смещение замещается в 25-битовом поле со знаком, преобразуйте весь пакет в пакет ММБ с помощью NOP. M в слоте 1 и 25-разрядной (4 младших бита все нуль и удалено) BR в слоте 2. <br/>                                                                                                   |
| IMAGE \_ rel \_ ia64 \_ IMMGPREL64 <br/> | 0x001a <br/> | Адресная привязка для 64-разрядного элемента GP. <br/>                                                                                                                                                                                                                                                                                                         |
| \_Маркер образа rel \_ ia64 \_ <br/>      | 0x001b <br/> | Токен CLR. <br/>                                                                                                                                                                                                                                                                                                                        |
| IMAGE \_ rel \_ ia64 \_ GPREL32 <br/>    | 0x001c <br/> | Адресная привязка для 32-разрядного элемента GP. <br/>                                                                                                                                                                                                                                                                                                         |
| IMAGE \_ rel \_ ia64 \_ слагаемое <br/>     | 0x001F <br/> | Перемещение допустимо только в том случае, если оно непосредственно следует за одним из следующих расположений: IMM14, IMM22, IMM64, GPREL22, LTOFF22, LTOFF64, SECREL22, SECREL64I или SECREL32. Его значение содержит слагаемое, которые применяются к инструкциям в пакете, а не к данным. <br/>                                                                  |



 

##### <a name="mips-processors"></a>Процессоры MIPS

Для процессоров MIPS определены следующие индикаторы типа перемещения.



| Константа                                | Значение              | Описание                                                                                                                                                                                                                                                                                                                                                                         |
|-----------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИЗОБРАЖЕНИЕ \_ rel \_ MIPS \_ Absolute <br/>  | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                                                                                                                                                                              |
| IMAGE \_ rel \_ MIPS \_ рефхалф <br/>   | 0x0001 <br/> | Старшие 16 разрядов целевого 32-бита. <br/>                                                                                                                                                                                                                                                                                                                             |
| IMAGE \_ rel \_ MIPS \_ рефворд <br/>   | 0x0002 <br/> | 32-битный целевой объект. <br/>                                                                                                                                                                                                                                                                                                                                                 |
| IMAGE \_ rel \_ MIPS \_ жмпаддр <br/>   | 0x0003 <br/> | Младшие 26 бит ва целевого объекта. Это поддерживает инструкции MIPS J и JAL. <br/>                                                                                                                                                                                                                                                                                      |
| IMAGE \_ rel \_ MIPS \_ рефхи <br/>     | 0x0004 <br/> | Старшие 16 разрядов целевого 32-бита. Используется для первой инструкции в последовательности из двух инструкций, которая загружает полный адрес. За этим перемещением должно сразу следовать перемещение пары, в которой Симболтаблеиндекс содержит 16-разрядное смещение со знаком, которое добавляется к 16 верхним позициям, взятым из расположения, которое перемещается. <br/> |
| IMAGE \_ rel \_ MIPS \_ рефло <br/>     | 0x0005 <br/> | Младшие 16 бит ва целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                     |
| IMAGE \_ rel \_ MIPS \_ гпрел <br/>     | 0x0006 <br/> | 16-разрядное смещение со знаком для целевого объекта относительно регистра GP. <br/>                                                                                                                                                                                                                                                                                                 |
| \_литерал rel \_ MIPS \_ Image <br/>   | 0x0007 <br/> | То же, что и IMAGE \_ rel \_ MIPS \_ гпрел. <br/>                                                                                                                                                                                                                                                                                                                                    |
| IMAGE \_ rel \_ MIPS, \_ раздел <br/>   | 0x000A <br/> | 16-битный индекс раздела содержит целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                                                                                                                                                                                             |
| IMAGE \_ rel \_ MIPS \_ секрел <br/>    | 0x000B <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                                                                                                                                                                                       |
| IMAGE \_ rel \_ MIPS \_ секрелло <br/>  | 0x000C <br/> | Младшие 16 бит 32-битного смещения целевого объекта с начала раздела. <br/>                                                                                                                                                                                                                                                                                   |
| IMAGE \_ rel \_ MIPS \_ секрелхи <br/>  | 0x000D <br/> | Старшие 16 бит 32-битного смещения целевого объекта с начала раздела. ОБРАЗ rel MIPS, перемещается по \_ \_ паре, \_ должен следовать за ним. Симболтаблеиндекс перемещения пары содержит 16-разрядное смещение со знаком, которое добавляется к старшим 16 битам, взятым из расположения, которое перемещается. <br/>                            |
| IMAGE \_ rel \_ MIPS \_ JMPADDR16 <br/> | 0x0010 <br/> | Младшие 26 бит ва целевого объекта. Это поддерживает инструкцию JAL MIPS16. <br/>                                                                                                                                                                                                                                                                                           |
| IMAGE \_ rel \_ MIPS \_ рефворднб <br/> | 0x0022 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                                |
| \_пара Image rel \_ MIPS \_ <br/>      | 0x0025 <br/> | Перемещение допустимо только в том случае, если оно непосредственно следует за перемещением РЕФХИ или СЕКРЕЛХИ. Его Симболтаблеиндекс содержит смещение, а не индекс в таблице символов. <br/>                                                                                                                                                                                           |



 

##### <a name="mitsubishi-m32r"></a>Mitsubishi M32R

Для процессоров Mitsubishi M32R определены следующие индикаторы типа перемещения.



| Константа                               | Значение              | Описание                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------------------------|--------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| IMAGE \_ rel \_ M32R \_ Absolute <br/> | 0x0000 <br/> | Перемещение не учитывается. <br/>                                                                                                                                                                                                                                                                                                                                                                        |
| IMAGE \_ rel \_ M32R \_ ADDR32 <br/>   | 0x0001 <br/> | 32-битный целевой объект. <br/>                                                                                                                                                                                                                                                                                                                                                                           |
| IMAGE \_ rel \_ M32R \_ ADDR32NB <br/> | 0x0002 <br/> | 32-разрядный RVA целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                                                          |
| IMAGE \_ rel \_ M32R \_ ADDR24 <br/>   | 0x0003 <br/> | 24-битный целевой объект. <br/>                                                                                                                                                                                                                                                                                                                                                                           |
| IMAGE \_ rel \_ M32R \_ GPREL16 <br/>  | 0x0004 <br/> | 16-разрядное смещение целевого объекта от регистра GP. <br/>                                                                                                                                                                                                                                                                                                                                                  |
| IMAGE \_ rel \_ M32R \_ PCREL24 <br/>  | 0x0005 <br/> | 24-разрядное смещение целевого объекта от счетчика программы (ПК), сдвиг влево на 2 бита и расширенная подпись <br/>                                                                                                                                                                                                                                                                                                |
| IMAGE \_ rel \_ M32R \_ PCREL16 <br/>  | 0x0006 <br/> | 16-разрядное смещение целевого объекта от ПК, сдвиг влево на 2 бита и расширенная подпись <br/>                                                                                                                                                                                                                                                                                                                  |
| IMAGE \_ rel \_ M32R \_ PCREL8 <br/>   | 0x0007 <br/> | 8-разрядное смещение целевого объекта от ПК, сдвиг влево на 2 бита и расширенная подпись <br/>                                                                                                                                                                                                                                                                                                                   |
| IMAGE \_ rel \_ M32R \_ рефхалф <br/>  | 0x0008 <br/> | 16 МСБС целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                                                     |
| IMAGE \_ rel \_ M32R \_ рефхи <br/>    | 0x0009 <br/> | 16 МСБС целевого объекта, настроенного для расширения подписывания ЛСБ. Используется для первой инструкции в последовательности из двух инструкций, которая загружает полный 32-разрядный адрес. За этим перемещением должно сразу следовать перемещение пары, в которой Симболтаблеиндекс содержит 16-разрядное смещение со знаком, которое добавляется к 16 верхним позициям, взятым из расположения, которое перемещается. <br/> |
| IMAGE \_ rel \_ M32R \_ рефло <br/>    | 0x000A <br/> | 16 Лсбс целевого объекта. <br/>                                                                                                                                                                                                                                                                                                                                                                     |
| \_Rel Image \_ M32R, \_ пара <br/>     | 0x000B <br/> | Перемещение должно следовать за перемещением РЕФХИ. Его Симболтаблеиндекс содержит смещение, а не индекс в таблице символов. <br/>                                                                                                                                                                                                                                                             |
| \_Rel образа \_ , \_ раздел M32R <br/>  | 0x000C <br/> | 16-битный индекс раздела, содержащий целевой объект. Используется для поддержки отладочной информации. <br/>                                                                                                                                                                                                                                                                                  |
| IMAGE \_ rel \_ M32R \_ секрел <br/>   | 0x000D <br/> | 32-разрядное смещение целевого объекта от начала его раздела. Используется для поддержки отладочной информации и локального хранилища потока. <br/>                                                                                                                                                                                                                                                 |
| \_ \_ Маркер M32R rel \_ изображения <br/>    | 0x000E <br/> | Токен CLR. <br/>                                                                                                                                                                                                                                                                                                                                                                                    |



 

### <a name="coff-line-numbers-deprecated"></a>Номера строк COFF (не рекомендуется)

Номера строк в формате COFF больше не создаются, и в будущем они не будут использоваться.

Номера строк в формате COFF указывают связь между кодом и номерами строк в исходных файлах. Формат номеров строк COFF в формате Microsoft аналогичен стандарту COFF, но он был расширен и позволяет одному разделу связываться с номерами строк в нескольких исходных файлах.

Номера строк в формате COFF состоят из массива записей фиксированной длины. Расположение (смещение файла) и размер массива указываются в заголовке раздела. Каждая запись номера строки имеет следующий формат.



| Offset        | Размер          | Поле                  | Описание                                                                                                                                                 |
|---------------|---------------|------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | Type ( \* ) <br/>  | Это объединение двух полей: Симболтаблеиндекс и Виртуаладдресс. Используется ли Симболтаблеиндекс или RVA, зависит от значения LineNumber. <br/> |
| 4 <br/> | 2 <br/> | LineNumber <br/> | Если значение не равно нулю, в этом поле указывается номер строки, отсчитываемый от единицы. Если значение равно нулю, поле типа интерпретируется как индекс таблицы символов для функции. <br/>    |



 

Поле Type представляет собой объединение 2 4-байтовых полей: Симболтаблеиндекс и Виртуаладдресс.



| Offset        | Размер          | Поле                        | Описание                                                                                                                                                                             |
|---------------|---------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | симболтаблеиндекс <br/> | Используется, когда номер_строки имеет нулевое значение: индекс для записи таблицы символов для функции. Этот формат используется для указания функции, к которой относится группа записей строкового номера. <br/>      |
| 0 <br/> | 4 <br/> | виртуаладдресс <br/>   | Используется, если параметр linenumber не равен нулю: RVA исполняемого кода, соответствующего указанной исходной строке. В объектном файле он содержит значение ва в разделе. <br/> |



 

Запись номера строки может либо задать для поля LineNumber нулевое значение, либо указать на определение функции в таблице символов, либо в качестве стандартной записи номера строки, указав положительное целое число (номер строки) и соответствующий адрес в коде объекта.

Группа записей номеров строк всегда начинается с первого формата: индекс символа функции. Если это первая запись номера строки в разделе, то она также является именем символа COMDAT для функции, если установлен флаг COMDAT раздела. См. [раздел COMDAT (только объект)](#comdat-sections-object-only). Вспомогательная запись функции в таблице символов имеет указатель на поле LineNumber, которое указывает на эту же запись номера строки.

За записью, идентифицирующей функцию, следует любое число записей строкового номера, которые предоставляют фактические сведения о строках (т. е. записи с параметром lineNumber больше нуля). Эти записи основаны на единицах, относительно начала функции, и представляют каждую строку исходного кода в функции, за исключением первой строки.

Например, в первой записи номера строки для следующего примера будет указана функция Реверсесигн (Симболтаблеиндекс для Реверсесигн и LineNumber задано нулевое значение). Затем записи с значениями LineNumber, равными 1, 2 и 3, соответствуют исходным строкам, как показано ниже:


```C++
// some code precedes ReverseSign function
int ReverseSign(int i)
1: {
2:  return -1 * i;
3: }
```



### <a name="coff-symbol-table"></a>Таблица символов COFF

Таблица символов в этом разделе наследуется из традиционного формата COFF. Он отличается от Microsoft Visual C++ной информации об отладке. Файл может содержать как таблицу символов COFF, так и Visual C++ную информацию об отладке, и эти два значения хранятся отдельно. Некоторые средства корпорации Майкрософт используют таблицу символов для ограниченных, но важных целей, например для обмена данными COMDAT с компоновщиком. Имена разделов и имена файлов, а также код и символы данных перечислены в таблице символов.

Расположение таблицы символов указано в заголовке COFF.

Таблица символов представляет собой массив записей длиной 18 байт. Каждая запись является либо стандартной, либо вспомогательной записью символьной таблицы. Стандартная запись определяет символ или имя и имеет следующий формат.



| Offset         | Размер          | Поле                          | Описание                                                                                                                                                                                                                                 |
|----------------|---------------|--------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 8 <br/> | Name ( \* ) <br/>          | Имя символа, представленное объединением трех структур. Если длина имени не превышает 8 байт, используется массив из 8 байт. Дополнительные сведения см. в разделе [представление имени символа](https://www.bing.com/search?q=Symbol+Name+Representation). <br/> |
| 8 <br/>  | 4 <br/> | Значение <br/>              | Значение, связанное с символом. Интерпретация этого поля зависит от Сектионнумбер и Сторажекласс. Типичное значение — перемещаемый адрес. <br/>                                                         |
| 12 <br/> | 2 <br/> | сектионнумбер <br/>      | Целое число со знаком, определяющее раздел с использованием индекса, отсчитываемый от единицы, в таблице разделов. Некоторые значения имеют специальное значение, как определено в разделе 5.4.2 "значения номеров разделов". <br/>                                         |
| 14 <br/> | 2 <br/> | Тип <br/>               | Число, представляющее тип. Microsoft Tools задайте для этого поля значение 0x20 (функция) или 0x0 (не функция). Дополнительные сведения см. в разделе [тип представления](#type-representation). <br/>                                                |
| 16 <br/> | 1 <br/> | сторажекласс <br/>       | Перечислимое значение, представляющее класс хранения. Дополнительные сведения см. в разделе [класс хранения](#storage-class). <br/>                                                                                                                   |
| 17 <br/> | 1 <br/> | нумберофаукссимболс <br/> | Число вспомогательных записей таблицы символов, которые следуют за этой записью. <br/>                                                                                                                                                           |



 

Ноль или более записей таблицы символов, сразу после каждой стандартной записи таблицы символов. Однако обычно не более одной записи в таблице символов является Стандартная запись таблицы символов (за исключением записей файлов с длинными именами файлов). Каждая дополнительная запись имеет тот же размер, что и Стандартная запись таблицы символов (18 байт), но вместо определения нового символа вспомогательная запись предоставляет дополнительные сведения о последнем определенном символе. Выбор того, какой из нескольких форматов будет использоваться, зависит от поля Сторажекласс. В разделе 5,5 "дополнительные записи символов" показаны определенные форматы для записей вспомогательных таблиц символов.

Средства, считывающие таблицы символов COFF, должны игнорировать вспомогательные записи символов, интерпретация которых неизвестна. Это позволяет расширить формат таблицы символов для добавления новых добавочных записей без нарушения работы существующих средств.

#### <a name="symbol-name-representation"></a>Представление имени символа

Поле «ShortName» в таблице символов состоит из 8 байтов, содержащих само имя, если оно не превышает 8 байт, или поле ShortName дает смещение в таблице строк. Чтобы определить, задано ли само имя или смещение, проверьте первые 4 байта на равенство нулю.

По соглашению имена обрабатываются как строки в кодировке UTF-8, заканчивающиеся нулем.



| Offset        | Размер          | Поле                 | Описание                                                                                                          |
|---------------|---------------|-----------------------|----------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 8 <br/> | ShortName <br/> | Массив из 8 байт. Этот массив дополняется значениями NULL справа, если длина имени меньше 8 байт. <br/> |
| 0 <br/> | 4 <br/> | Нули <br/>    | Поле, для которого заданы все нули, если оно длиннее 8 байт. <br/>                                     |
| 4 <br/> | 4 <br/> | Offset <br/>    | Смещение в таблице строк. <br/>                                                                         |



 

#### <a name="section-number-values"></a>Значения номеров разделов

Как правило, поле «значение раздела» в записи таблицы символов — это Отсчитываемый от единицы индекс в таблице разделов. Однако это поле является целым числом со знаком и может принимать отрицательные значения. Следующие значения, меньше одного, имеют особое значение.



| Константа                          | Значение          | Описание                                                                                                                                                                                                                            |
|-----------------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИЗОБРАЖЕНИЕ \_ SYM не \_ определено <br/> | 0 <br/>  | Записи символов еще не назначен раздел. Нулевое значение указывает, что ссылка на внешний символ определяется в других местах. Ненулевое значение — это общий символ, размер которого определяется значением. <br/> |
| ИЗОБРАЖЕНИЕ \_ SYM \_ абсолютным <br/>  | -1 <br/> | Символ имеет абсолютное значение (не перемещаемое) и не является адресом. <br/>                                                                                                                                                  |
| \_ \_ Отладка SYM образа <br/>     | -2 <br/> | Символ предоставляет общие сведения о типе или отладке, но не соответствует разделу. Средства Майкрософт используют этот параметр вместе с записями файлов (файл класса хранения). <br/>                                            |



 

#### <a name="type-representation"></a>Представление типа

Поле Type записи таблицы символов содержит 2 байта, где каждый байт представляет сведения о типе. ЛСБ представляет простой (базовый) тип данных, а значение, если таковое имеется, представляет сложный тип.



| СТАРШЕГО бита                                                       | лсб                                                        |
|-----------------------------------------------------------|------------------------------------------------------------|
| Сложный тип: нет, указатель, функция, массив. <br/> | Базовый тип: integer, float-Point и т. д. <br/> |



 

Для базового типа определены следующие значения, хотя средства Майкрософт обычно не используют это поле и не устанавливают для ЛСБ значение 0. Вместо этого для обозначения типов используется Visual C++ отладочной информации. Однако для полноты указаны возможные значения COFF.



| Константа                             | Значение          | Описание                                                                            |
|--------------------------------------|----------------|----------------------------------------------------------------------------------------|
| \_тип SYM изображения ( \_ \_ null) <br/>   | 0 <br/>  | Нет сведений о типе или неизвестного базового типа. Средства Майкрософт используют этот параметр <br/> |
| \_тип SYM \_ изображения \_ void <br/>   | 1 <br/>  | Нет допустимого типа; используется с указателями и функциями void <br/>                       |
| IMAGE \_ SYM \_ тип \_ char <br/>   | 2 <br/>  | Символ (байт со знаком) <br/>                                                  |
| \_тип SYM \_ image \_ Short <br/>  | 3 <br/>  | 2-байтовое целое число со знаком <br/>                                                    |
| \_тип SYM \_ изображения \_ int <br/>    | 4 <br/>  | Натуральный целочисленный тип (обычно 4 байта в Windows) <br/>                       |
| \_тип SYM \_ изображения \_ Long <br/>   | 5 <br/>  | 4-байтовое целое число со знаком <br/>                                                    |
| \_тип SYM \_ изображения \_ float <br/>  | 6 <br/>  | 4-байтовое число с плавающей запятой <br/>                                             |
| \_тип SYM \_ изображения \_ Double <br/> | 7 <br/>  | 8-байтовое число с плавающей запятой <br/>                                            |
| \_ \_ Структура типа SYM \_ Image <br/> | 8 <br/>  | Структура. <br/>                                                                |
| \_SYM Image \_ Type \_ Union <br/>  | 9 <br/>  | Объединение <br/>                                                                    |
| \_тип SYM \_ image \_ enum <br/>   | 10 <br/> | Перечислимый тип <br/>                                                         |
| IMAGE \_ SYM \_ Type \_ МО <br/>    | 11 <br/> | Член перечисления (определенное значение) <br/>                                 |
| \_тип SYM \_ image \_ Byte <br/>   | 12 <br/> | Байт; 1-байтовое целое без знака <br/>                                            |
| \_ \_ слово типа SYM \_ Image <br/>   | 13 <br/> | Слово; 2-байтовое целое число без знака <br/>                                            |
| IMAGE \_ SYM, \_ тип \_ uint <br/>   | 14 <br/> | Целое число без знака естественного размера (обычно 4 байта) <br/>                    |
| IMAGE \_ SYM, \_ тип \_ DWORD <br/>  | 15 <br/> | 4-байтовое целое число без знака <br/>                                                 |



 

Наиболее значимый байт указывает, является ли символ указателем на, возвратом функции или массивом базового типа, который указан в ЛСБ. Средства Майкрософт используют это поле только для того, чтобы указать, является ли символ функцией, чтобы только два результирующих значения — 0x0 и 0x20 для поля типа. Однако другие средства могут использовать это поле для передачи дополнительных сведений.

Очень важно правильно указать атрибут функции. Эти сведения необходимы для правильной работы инкрементной компоновки. Для некоторых архитектур эти сведения могут потребоваться в других целях.



| Константа                                | Значение         | Описание                                                          |
|-----------------------------------------|---------------|----------------------------------------------------------------------|
| IMAGE \_ SYM \_ дтипе \_ null <br/>     | 0 <br/> | Нет производного типа; символ представляет собой простую скалярную переменную. <br/> |
| \_указатель SYM изображения \_ дтипе \_ <br/>  | 1 <br/> | Символ является указателем на базовый тип. <br/>                    |
| IMAGE \_ SYM \_ дтипе, \_ функция <br/> | 2 <br/> | Символ — это функция, которая возвращает базовый тип. <br/>       |
| \_SYM Image \_ дтипе \_ Array <br/>    | 3 <br/> | Символ является массивом базового типа. <br/>                     |



 

#### <a name="storage-class"></a>Класс хранения

Поле Сторажекласс таблицы символов указывает, какой вид определения представляет символ. В следующей таблице показаны возможные значения. Обратите внимание, что поле Сторажекласс представляет собой 1-байтное целое число без знака. Поэтому необходимо принять особое значение-1, чтобы посчитать его эквивалентом без знака, 0xFF.

Хотя в традиционном формате COFF используется много значений класса хранения, средства Майкрософт используют Visual C++ формат отладки для большинства символьных данных и обычно используют только четыре значения класса хранения: EXTERNAL (2), STATIC (3), FUNCTION (101) и FILE (103). За исключением второго столбца, приведенного ниже, должно быть принято значение "value", которое означает поле значения записи символов (интерпретация зависит от числа, найденного в качестве класса хранения).



| Константа                                          | Значение                 | Описание/интерпретация поля значения                                                                                                                                                                                                                                                                                              |
|---------------------------------------------------|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_класс Image \_ SYM \_ \_ , конец \_ функции <br/>  | -1 (0xFF) <br/> | Специальный символ, представляющий конец функции, для целей отладки. <br/>                                                                                                                                                                                                                                                  |
| IMAGE \_ SYM, \_ класс \_ null <br/>               | 0 <br/>         | Нет назначенного класса хранения. <br/>                                                                                                                                                                                                                                                                                                     |
| \_класс Image SYM, \_ \_ Автоматический <br/>          | 1 <br/>         | Автоматическая (стековая) переменная. В поле значение задается смещение кадра стека. <br/>                                                                                                                                                                                                                                              |
| \_класс Image \_ SYM \_ External <br/>           | 2 <br/>         | Значение, используемое инструментами Майкрософт для внешних символов. В поле значение указывается размер, если номер раздела — IMAGE \_ SYM \_ undefine (0). Если номер раздела не равен нулю, то в поле значение задается смещение в разделе. <br/>                                                                                 |
| \_класс Image SYM, \_ \_ статический <br/>             | 3 <br/>         | Смещение символа в разделе. Если поле значения равно нулю, то символ представляет имя раздела. <br/>                                                                                                                                                                                                            |
| \_ \_ Регистрация класса SYM \_ Image <br/>           | 4 <br/>         | Переменная регистра. В поле значение указывается номер регистра. <br/>                                                                                                                                                                                                                                                            |
| \_класс Image SYM, \_ \_ внешняя \_ DEF <br/>      | 5 <br/>         | Символ, определяемый извне. <br/>                                                                                                                                                                                                                                                                                           |
| \_ \_ Метка класса Image \_ SYM <br/>              | 6 <br/>         | Метка кода, которая определена в модуле. В поле значение задается смещение символа в разделе. <br/>                                                                                                                                                                                                         |
| IMAGE \_ SYM \_ , \_ неопределенная \_ Метка класса <br/>   | 7 <br/>         | Ссылка на метку кода, которая не определена. <br/>                                                                                                                                                                                                                                                                               |
| IMAGE \_ SYM \_ \_ , член \_ класса \_ STRUCT <br/> | 8 <br/>         | Член структуры. В поле значение указывается n-й элемент. <br/>                                                                                                                                                                                                                                                               |
| IMAGE \_ SYM \_ , \_ аргумент класса <br/>           | 9 <br/>         | Формальный аргумент (параметр) функции. В поле "значение" указывается n-й аргумент. <br/>                                                                                                                                                                                                                                      |
| \_ \_ \_ тег структуры класса Image \_ SYM <br/>        | 10 <br/>        | Запись имени тега структуры. <br/>                                                                                                                                                                                                                                                                                                  |
| IMAGE \_ SYM \_ \_ , член \_ класса \_ Union <br/>  | 11 <br/>        | Член объединения. В поле значение указывается n-й элемент. <br/>                                                                                                                                                                                                                                                                     |
| \_тег SYM \_ для \_ объединения \_ класса Image <br/>         | 12 <br/>        | Запись имени тега Union. <br/>                                                                                                                                                                                                                                                                                                      |
| \_ \_ \_ Определение типа класса Image \_ SYM <br/>   | 13 <br/>        | Запись typedef. <br/>                                                                                                                                                                                                                                                                                                               |
| \_класс Image \_ SYM \_ undefine \_ static <br/>  | 14 <br/>        | Статическое объявление данных. <br/>                                                                                                                                                                                                                                                                                                     |
| \_ \_ \_ тег enum класса SYM \_ Image <br/>          | 15 <br/>        | Запись перечислимого типа TagName. <br/>                                                                                                                                                                                                                                                                                              |
| \_ \_ элемент класса Image \_ SYM \_ в \_ enum <br/>   | 16 <br/>        | Член перечисления. В поле значение указывается n-й элемент. <br/>                                                                                                                                                                                                                                                         |
| \_ \_ \_ параметр регистрации класса SYM \_ Image <br/>    | 17 <br/>        | Параметр Register. <br/>                                                                                                                                                                                                                                                                                                          |
| \_ \_ \_ битовое поле класса Image SYM \_ <br/>         | 18 <br/>        | Ссылка на битовое поле. В поле "значение" указывается n-й бит в битовом поле. <br/>                                                                                                                                                                                                                                                |
| \_ \_ блок класса Image \_ SYM <br/>              | 100 <br/>       | А. BB (начало блока) или. EB (конец блока). Поле значение является перемещаемым адресом местоположения кода. <br/>                                                                                                                                                                                                      |
| IMAGE \_ SYM \_ , \_ функция класса <br/>           | 101 <br/>       | Значение, используемое средствами Майкрософт для записей символов, определяющих экстент функции: Begin Function (. BF), End Function (. EF) и Lines In (. LF). Для записей. LF в поле значение задается количество исходных строк в функции. Для записей. EF в поле значение задается размер кода функции. <br/> |
| \_ \_ \_ конец \_ \_ структуры класса SYM Image <br/>    | 102 <br/>       | Запись конца структуры. <br/>                                                                                                                                                                                                                                                                                                     |
| \_ \_ файл класса Image \_ SYM <br/>               | 103 <br/>       | Значение, которое Microsoft Tools, а также традиционный формат COFF используется для записи символов исходного файла. За символом следуют дополнительные записи, которые применяют имя файла. <br/>                                                                                                                                                       |
| \_ \_ раздел класса Image \_ SYM <br/>            | 104 <br/>       | Определение раздела (в Microsoft Tools вместо него используется статический класс хранения). <br/>                                                                                                                                                                                                                                                  |
| \_класс Image \_ SYM \_ слабый \_ внешний <br/>     | 105 <br/>       | Слабый внешний. Дополнительные сведения см. в разделе [дополнительный формат 3. слабые внешние](#auxiliary-format-3-weak-externals). <br/>                                                                                                                                                                                                           |
| \_ \_ \_ маркер CLR класса Image \_ SYM <br/>         | 107 <br/>       | Символ токена CLR. Имя — это строка ASCII, состоящая из шестнадцатеричного значения маркера. Дополнительные сведения см. в разделе [Определение токена CLR (только объект)](#clr-token-definition-object-only). <br/>                                                                                                                        |



 

### <a name="auxiliary-symbol-records"></a>Вспомогательные записи символов

Дополнительные записи таблицы символов всегда следуют за ними и применяются к определенной записи таблицы стандартных символов. Дополнительная запись может иметь любой формат, распознаваемый инструментами, но для них необходимо выделить 18 байт, чтобы таблица символов поддерживалась как массив обычного размера. В настоящее время средства Майкрософт распознают вспомогательные форматы для следующих типов записей: определения функций, начальный и конечный символы (. BF и. EF), слабые внешние, имена файлов и определения разделов.

Традиционная конструкция COFF также включает форматы вспомогательных записей для массивов и структур. Средства Майкрософт не используют их, а вместо этого размещают символьные данные в Visual C++ формате отладки в разделах отладки.

#### <a name="auxiliary-format-1-function-definitions"></a>Вспомогательный формат 1. определения функций

Запись таблицы символов отмечает начало определения функции, если она содержит все следующие: класс хранения EXTERNAL (2), значение типа, указывающее, что это функция (0x20), и номер раздела больше нуля. Обратите внимание, что запись таблицы символов, имеющая номер раздела undefine (0), не определяет функцию и не имеет вспомогательной записи. Записи символов определения функции следуют вспомогательной записи в формате, описанном ниже.



| Offset         | Размер          | Поле                             | Описание                                                                                                                                                                                                                   |
|----------------|---------------|-----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | тагиндекс <br/>              | Индекс таблицы символов соответствующей записи символа. BF (Begin Function). <br/>                                                                                                                                   |
| 4 <br/>  | 4 <br/> | TotalSize <br/>             | Размер исполняемого кода для самой функции. Если функция находится в отдельном разделе, Сизеофравдата в заголовке раздела больше или равна этому полю в зависимости от соображений выравнивания. <br/> |
| 8 <br/>  | 4 <br/> | поинтертолиненумбер <br/>   | Смещение первой записи строки COFF для функции или нуль, если значение не существует. Дополнительные сведения см. в статье [номера строк COFF (не рекомендуется)](#coff-line-numbers-deprecated). <br/>                          |
| 12 <br/> | 4 <br/> | поинтертонекстфунктион <br/> | Индекс таблицы символов записи для следующей функции. Если функция является последней в таблице символов, для этого поля устанавливается нулевое значение. <br/>                                                                           |
| 16 <br/> | 2 <br/> | Не используется <br/>                |                                                                                                                                                                                                                               |



 

#### <a name="auxiliary-format-2-bf-and-ef-symbols"></a>Вспомогательные символы формата 2:. BF и. EF

Для каждого определения функции в таблице символов три элемента описывают начало, конец и число строк. Каждый из этих символов имеет функцию класса хранения (101):

Запись символа с именем. BF (Функция begin). Поле значения не используется.

Запись символов с именем. LF (строки в функции). В поле значение задается число строк в функции.

Запись символа с именем. EF (конец функции). Поле "значение" имеет тот же номер, что и поле "общий размер" в записи символов определения функции.

За записями символов. BF и. EF (но не с записями LF) следует дополнительная запись в следующем формате:



| Offset         | Размер          | Поле                                         | Описание                                                                                                                                                                   |
|----------------|---------------|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Не используется <br/>                            |                                                                                                                                                                               |
| 4 <br/>  | 2 <br/> | LineNumber <br/>                        | Фактический порядковый номер строки (1, 2, 3 и т. д.) в исходном файле, соответствующий записи. BF или. EF. <br/>                                               |
| 6 <br/>  | 6 <br/> | Не используется <br/>                            |                                                                                                                                                                               |
| 12 <br/> | 4 <br/> | Поинтертонекстфунктион (только BF) <br/> | Индекс таблицы символов для следующей записи символа. BF. Если функция является последней в таблице символов, для этого поля устанавливается нулевое значение. Он не используется для записей. EF. <br/> |
| 16 <br/> | 2 <br/> | Не используется <br/>                            |                                                                                                                                                                               |



 

#### <a name="auxiliary-format-3-weak-externals"></a>Вспомогательный формат 3: слабые внешние

"Слабые внешние" — это механизм для объектных файлов, который обеспечивает гибкость во время компоновки. Модуль может содержать неразрешенный внешний символ (sym1), но также может включать вспомогательную запись, указывающую, что если sym1 отсутствует во время компоновки, то для разрешения ссылок используется другой внешний символ (sym2).

Если определение sym1 связано, то внешняя ссылка на символ разрешается обычным образом. Если определение sym1 не связано, все ссылки на слабый внешний объект sym1 ссылаются на sym2. Внешний символ sym2 должен всегда быть связанным. как правило, он определен в модуле, который содержит слабую ссылку на sym1.

Слабые внешние представления представляются записью таблицы символов с внешним классом хранения, номером раздела UNDEF и нулевым значением. Ниже приведена дополнительная запись с нестрогим внешним символом в следующем формате:



| Offset        | Размер           | Поле                       | Описание                                                                                                                                                                                                                                                                                                                                                |
|---------------|----------------|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/>  | тагиндекс <br/>        | Индекс таблицы символов sym2, символ, который должен быть связан, если sym1 не найден. <br/>                                                                                                                                                                                                                                                                  |
| 4 <br/> | 4 <br/>  | Характеристики <br/> | Значение IMAGE \_ слабый \_ внешний \_ Поиск \_ без библиотеки указывает, что не следует выполнять поиск в библиотеке для sym1. <br/> Значение IMAGE \_ слабый \_ внешний \_ поисковая \_ Библиотека указывает на то, что необходимо выполнить поиск в библиотеке sym1. <br/> Значение IMAGE \_ слабый \_ внешний \_ псевдоним поиска \_ указывает, что sym1 является псевдонимом для sym2. <br/> |
| 8 <br/> | 10 <br/> | Не используется <br/>          |                                                                                                                                                                                                                                                                                                                                                            |



 

Обратите внимание, что поле характеристики не определено в WINNT. Высоты Вместо этого используется поле Общий размер.

#### <a name="auxiliary-format-4-files"></a>Вспомогательный формат 4: файлы

Этот формат следует за записью символьной таблицы с ФАЙЛОМ класса хранения (103). Имя символа должно быть. File, а вспомогательная запись, следующая за ней, — это имя файла исходного кода.



| Offset        | Размер           | Поле                 | Описание                                                                                                                         |
|---------------|----------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 18 <br/> | Имя файла <br/> | Строка ANSI, которая задает имя исходного файла. Это дополняется значениями NULL, если длина меньше максимальной. <br/> |



 

#### <a name="auxiliary-format-5-section-definitions"></a>Дополнительный формат 5. определения разделов

Этот формат соответствует записи таблицы символов, определяющей раздел. Такая запись имеет имя символа, которое является именем раздела (например,. Text или. drectve) и имеет класс хранения STATIC (3). Дополнительная запись предоставляет сведения о разделе, на который он ссылается. Таким же путем дублирует часть информации в заголовке раздела.



| Offset         | Размер          | Поле                           | Описание                                                                                                                                                                                                             |
|----------------|---------------|---------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Длина <br/>              | Размер данных раздела; то же, что и Сизеофравдата в заголовке раздела. <br/>                                                                                                                                  |
| 4 <br/>  | 2 <br/> | нумберофрелокатионс <br/> | Число записей перемещения для раздела. <br/>                                                                                                                                                           |
| 6 <br/>  | 2 <br/> | нумберофлиненумберс <br/> | Число записей номера строки для раздела. <br/>                                                                                                                                                          |
| 8 <br/>  | 4 <br/> | Вычислен <br/>            | Контрольная сумма для данных общего. Он применяется, если \_ \_ \_ в заголовке раздела задан флаг уведомления SCN LNK. Дополнительные сведения см. в разделе [COMDAT (только объект)](#comdat-sections-object-only). <br/> |
| 12 <br/> | 2 <br/> | Число <br/>              | Отсчитываемый от единицы индекс в таблице разделов для связанного раздела. Используется, когда параметр выбора COMDAT имеет значение 5. <br/>                                                                                     |
| 14 <br/> | 1 <br/> | Выбор <br/>           | Номер выбора COMDAT. Это применимо, если раздел является разделом COMDAT. <br/>                                                                                                                         |
| 15 <br/> | 3 <br/> | Не используется <br/>              |                                                                                                                                                                                                                         |



 

#### <a name="comdat-sections-object-only"></a>Разделы COMDAT (только объект)

Поле выбора в определении раздела Вспомогательное формат применяется, если раздел является разделом COMDAT. Раздел COMDAT — это раздел, который может быть определен более чем одним файлом объекта. (Изображение \_ флага \_ \_ В поле "флаги раздела" заголовка раздела задано значение SCN LNK. Поле выбора определяет способ, которым компоновщик разрешает несколько определений разделов COMDAT.

Первый символ, имеющий значение раздела раздела COMDAT, должен быть символом раздела. Этот символ содержит имя раздела, поле значения равно нулю, номер раздела раздела COMDAT, поле типа, равное IMAGE \_ SYM \_ Type \_ null, поле класса, равное Image \_ SYM \_ Class \_ , и одну вспомогательную запись. Второй символ называется "символом COMDAT" и используется компоновщиком в сочетании с полем выбора.

Значения для поля выбора показаны ниже.



| Константа                                        | Значение         | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-------------------------------------------------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ выделить \_ недублирующиеся изображения COMDAT <br/> | 1 <br/> | Если этот символ уже определен, компоновщик выдает ошибку "умножить определенный символ". <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| \_COMDAT изображения \_ выберите \_ любой <br/>          | 2 <br/> | Любой раздел, который определяет один и тот же символ COMDAT, может быть связан; остальные удаляются. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| \_Размер COMDAT \_ для \_ выбранного \_ изображения <br/>   | 3 <br/> | Компоновщик выбирает произвольный раздел из определений для этого символа. Если все определения имеют разные размеры, выдается ошибка "умножить определенный символ". <br/>                                                                                                                                                                                                                                                                                                                                                                                                                     |
| \_COMDAT изображения \_ выберите \_ точное \_ совпадение <br/> | 4 <br/> | Компоновщик выбирает произвольный раздел из определений для этого символа. Если все определения не совпадают в точности, выдается ошибка "умножить определенный символ". <br/>                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ИЗОБРАЖЕНИЕ \_ COMDAT \_ Выбор \_ ассоциативного <br/>  | 5 <br/> | Раздел связан, если связан другой раздел COMDAT. Этот другой раздел указан в поле номер вспомогательной записи символа для определения раздела. Этот параметр полезен для определений, которые содержат компоненты в нескольких разделах (например, код в одном и данных в другом), но все должны быть связаны или отменены как набор. Другой раздел, с которым связан этот раздел, должен быть разделом COMDAT, который может быть другим ассоциативным разделом COMDAT. Цепочка взаимосвязей разделов ассоциативной секции COMDAT не может сформировать цикл. Цепочка взаимосвязей разделов должна в конечном итоге перейти к разделу COMDAT, у которого нет COMDAT с ИЗОБРАЖЕНИЕм \_ \_ выберите \_ ассоциативный набор. <br/> |
| \_Выбор изображения COMDAT \_ выделить \_ самый крупный <br/>      | 6 <br/> | Компоновщик выбирает самое большое определение из всех определений для этого символа. Если этот размер имеет несколько определений, между ними выбирается произвольный вариант. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                |



 

#### <a name="clr-token-definition-object-only"></a>Определение токена CLR (только объект)

Этот вспомогательный символ обычно следует за \_ \_ \_ токеном CLR класса Image SYM \_ . Он используется для связывания токена с пространством имен таблицы символов COFF.



| Offset        | Размер           | Поле                        | Описание                                                                                |
|---------------|----------------|------------------------------|--------------------------------------------------------------------------------------------|
| 0 <br/> | 1 <br/>  | баукстипе <br/>         | Необходимо указать \_ добавочный \_ символ \_ \_ маркера типа символа \_ (1). <br/>                              |
| 1 <br/> | 1 <br/>  | бресервед <br/>        | Зарезервировано, должно быть равно нулю. <br/>                                                        |
| 2 <br/> | 4 <br/>  | симболтаблеиндекс <br/> | Индекс символа COFF, к которому относится это определение токена CLR. <br/> |
| 6 <br/> | 12 <br/> |                              | Зарезервировано, должно быть равно нулю. <br/>                                                        |



 

### <a name="coff-string-table"></a>Таблица строк COFF

Сразу после таблицы символов COFF следует таблица строк COFF. Расположение этой таблицы можно найти, используя адрес таблицы символов в заголовке COFF и добавив число символов, умноженное на размер символа.

В начале таблицы строк COFF содержится 4 байта, которые содержат общий размер (в байтах) оставшейся части таблицы строк. Этот размер включает в себя поле Size, поэтому значение в этом расположении будет равно 4, если строки не были представлены.

После размера строки завершаются нулем, на которые указывают символы в таблице символов COFF.

### <a name="the-attribute-certificate-table-image-only"></a>Таблица атрибутов сертификата (только для изображений)

Сертификаты атрибутов можно связать с изображением, добавив таблицу сертификатов атрибута. Таблица с атрибутом «сертификат» состоит из набора последовательных записей сертификата с куадворд, сопоставленных с учетом. Для достижения этого выравнивания вставляется нулевое заполнение между исходным концом файла и началом таблицы сертификатов атрибута. Каждая запись сертификата атрибута содержит следующие поля.



| Offset       | Размер                         | Поле                       | Описание                                                                                                |
|--------------|------------------------------|-----------------------------|------------------------------------------------------------------------------------------------------------|
| 0<br/> | 4<br/>                 | двленгс<br/>         | Задает длину записи сертификата атрибута. <br/>                                       |
| 4<br/> | 2<br/>                 | вревисион<br/>        | Содержит номер версии сертификата. Дополнительные сведения см. в следующем тексте.<br/>                   |
| 6<br/> | 2<br/>                 | вцертификатетипе<br/> | Указывает тип содержимого в Бцертификате. Дополнительные сведения см. в следующем тексте.<br/>             |
| 8<br/> | Справочные статьи<br/> | бцертификате<br/>     | Содержит сертификат, например подпись Authenticode. Дополнительные сведения см. в следующем тексте.<br/> |



 

Значение виртуального адреса из записи таблицы сертификатов в необязательном каталоге данных заголовков является смещением файла для первой записи сертификата атрибута. Доступ к следующим записям осуществляется путем перемещения Двленгс байт, округленных до 8 байт, с начала текущей записи сертификата атрибута. Это происходит до тех пор, пока сумма округленных значений Двленгс не будет равна значению размера из записи таблицы Certificates в необязательном каталоге данных заголовка. Если сумма округленных значений Двленгс не равна значению размера, то либо таблица сертификата атрибута, либо поле Размер повреждены.

Например, если запись в таблице сертификатов необязательного каталога данных содержит:


```C++
virtual address = 0x5000
size = 0x1000
```



Первый сертификат начинается со смещения 0x5000, начиная с начала файла на диске. Чтобы просмотреть все записи сертификата атрибута, сделайте следующее:

1.  Добавьте значение Двленгс первого атрибута сертификата в начальное смещение.
2.  Округлить значение шага 1 до ближайшего 8-байтового кратного, чтобы найти смещение второй записи сертификата атрибута.
3.  Добавьте значение смещения из шага 2 во второе значение Двленгс записи сертификата атрибута и округляйте до ближайшей 8-байтовой кратности, чтобы определить смещение третьей записи сертификата атрибута.
4.  Повторите шаг 3 для каждого последующего сертификата, пока вычисленное смещение не станет равным 0x6000 (0x5000 Start + 0x1000 общий размер), что означает, что вы проверили всю таблицу.

Кроме того, можно перечислить записи сертификата, вызвав функцию Win32 **имажеенумератецертификатес** в цикле. Ссылку на страницу ссылки на функцию см. в разделе [References](#references).

Элементы таблицы сертификатов атрибутов могут содержать любой тип сертификата, если запись имеет правильное значение Двленгс, уникальное значение Вревисион и уникальное значение Вцертификатетипе. Наиболее распространенным типом записи таблицы сертификатов является \_ Структура сертификата Win, которая описана в винтруст. h и обсуждается в оставшейся части этого раздела.

Параметры для \_ члена Win Certificate **вревисион** (но не ограничиваются):



| Значение             | Имя                                 | Примечания                                                                                                                                                 |
|-------------------|--------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x0100<br/> | \_Версия сертификата \_ Win \_ 1 \_ 0<br/> | Версия 1, устаревшая версия \_ структуры сертификатов Win. Он поддерживается только в целях проверки устаревших подписей Authenticode.<br/> |
| 0x0200<br/> | \_Версия сертификата \_ Win \_ 2 \_ 0<br/> | Версия 2 — это текущая версия \_ структуры сертификата Win. <br/>                                                                       |



 

Параметры для \_ члена Win Certificate **вцертификатетипе** включают (но не ограничиваются) элементы в следующей таблице. Обратите внимание, что некоторые значения в настоящее время не поддерживаются.



| Значение             | Имя                                           | Примечания                                                                                   |
|-------------------|------------------------------------------------|-----------------------------------------------------------------------------------------|
| 0x0001<br/> | \_Тип сертификата \_ Win \_ X509 <br/>              | Бцертификате содержит сертификат X. 509 <br/> Не поддерживается<br/>         |
| 0x0002<br/> | WIN \_ CERT \_ Type \_ \_ Data, подписанные PKCS \_<br/> | Бцертификате содержит \# структуру СИГНЕДДАТА PKCS 7<br/>                         |
| 0x0003<br/> | \_Тип сертификата \_ Win \_ зарезервирован \_ 1<br/>        | Зарезервировано <br/>                                                                    |
| 0x0004<br/> | \_тип сертификата \_ Win \_ \_ \_ подписанный стек TS<br/>  | Подписывание сертификата для стека протокола сервера терминалов <br/> Не поддерживается<br/> |



 

\_Элемент **бцертификате** структуры сертификата Win содержит массив байтов переменной длины с типом содержимого, заданным параметром **вцертификатетипе**. Тип, поддерживаемый Authenticode, — это \_ сертификат Win \_ \_ Data типа PKCS \_ \_ , \# Структура PKCS 7 **сигнеддата** . Дополнительные сведения о формате цифровых подписей Authenticode см. в статье [формат переносимого исполняемого файла Windows Authenticode](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx).

Если содержимое **бцертификате** не заканчивается на границе куадворд, запись сертификата атрибута дополняется нулями от конца **бцертификате** до следующей куадворд границы.

Значение **двленгс** — это длина окончательной \_ структуры сертификата Win, которая вычислена следующим образом:

`dwLength = offsetof(WIN_CERTIFICATE, bCertificate) + (size of the variable-length binary array contained within bCertificate)`

Эта длина должна включать в себя размер любого заполнения, используемого для удовлетворения требования, которым каждая \_ Структура сертификата Win куадворд выровнена:

` dwLength += (8 - (dwLength & 7)) & 7;`

**Размер таблицы сертификатов**, указанный в записи **таблицы Certificates** в [необязательных каталогах данных заголовков (только для изображений)](#optional-header-data-directories-image-only), включает заполнение.

Дополнительные сведения об использовании API ImageHlp для перечисления, добавления и удаления сертификатов из PE-файлов см. в разделе [функции ImageHlp](imagehlp-functions.md).

#### <a name="certificate-data"></a>Данные сертификата

Как упоминалось в предыдущем разделе, сертификаты в таблице атрибута Certificate могут содержать любой тип сертификата. Сертификаты, обеспечивающие целостность PE-файла, могут включать хэш образа PE.

Хэш-код образа PE (или хэш файла) аналогичен контрольной сумме файла в том, что хэш-алгоритм создает дайджест сообщения, связанный с целостностью файла. Однако контрольная сумма создается простым алгоритмом и используется в основном для определения того, поврежден ли блок памяти на диске, а хранящиеся в нем значения повреждаются. Хэш файла аналогичен контрольной сумме в том, что он также обнаруживает повреждение файла. Однако, в отличие от большинства алгоритмов контрольной суммы, очень сложно изменить файл, не изменяя хэш файла из исходного неизмененного значения. Таким образом, хэш файла можно использовать для обнаружения намеренных и даже незначительных изменений в файле, таких как вирусы, хакеры или троянские программы.

При использовании в сертификате дайджест образа должен исключить определенные поля в образе PE, например контрольную сумму и запись таблицы сертификатов в необязательных каталогах данных заголовков. Это связано с тем, что действие добавления сертификата изменяет эти поля и приведет к вычислению другого хэш-значения.

Функция Win32 **имажежетдижестстреам** предоставляет поток данных из целевого PE-файла для хэширования функций. Этот поток данных остается единообразным при добавлении или удалении сертификатов из PE-файла. В зависимости от параметров, передаваемых в **имажежетдижестстреам**, другие данные из образа PE можно опустить при вычислении хэша. Ссылку на страницу ссылки на функцию см. в разделе [References](#references).

### <a name="delay-load-import-tables-image-only"></a>Delay-Load импорт таблиц (только изображение)

Эти таблицы были добавлены в образ для поддержки единого механизма, который позволяет приложениям задержать загрузку библиотеки DLL до первого вызова этой библиотеки DLL. Макет таблиц совпадает с разметкой традиционных таблиц импорта, описанных в разделе 6,4 раздела [иДата](#the-idata-section). Здесь обсуждаются только некоторые сведения.

#### <a name="the-delay-load-directory-table"></a>Таблица Delay-Load Directory

Таблица каталогов с отложенной загрузкой является аналогом таблицы Import Directory. Его можно получить с помощью записи дескриптора отложенного импорта в списке необязательные каталоги данных заголовков (смещение 200). Таблица упорядочивается следующим образом:



| Offset         | Размер          | Поле                                  | Описание                                                                                                                                                                                                                                                                                                                  |
|----------------|---------------|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Атрибуты <br/>                 | Должен равняться нулю. <br/>                                                                                                                                                                                                                                                                                                    |
| 4 <br/>  | 4 <br/> | Имя <br/>                       | RVA имени загружаемой библиотеки DLL. Имя находится в разделе данных, доступном только для чтения. <br/>                                                                                                                                                                                                        |
| 8 <br/>  | 4 <br/> | Маркер модуля <br/>              | RVA для маркера модуля (в разделе данных образа) библиотеки DLL, которая должна быть загружена с задержкой. Он используется для хранения с помощью подпрограммы, предоставляемой для управления загрузкой задержек. <br/>                                                                                                                                   |
| 12 <br/> | 4 <br/> | Таблица адресов задержки импорта <br/> | RVA для таблицы адресов импорта с отложенной загрузкой. Дополнительные сведения см. в разделе [Таблица адресов отложенного импорта (IAT)](#delay-import-address-table). <br/>                                                                                                                                                                       |
| 16 <br/> | 4 <br/> | Таблица имен отложенных импортов <br/>    | RVA для таблицы с отложенной загрузкой имен, которая содержит имена импортов, которые может потребоваться загрузить. Соответствует макету таблицы имен импорта. Дополнительные сведения см. в разделе [Подсказка/имя таблицы](#hintname-table).<br/>                                                                                       |
| 20 <br/> | 4 <br/> | Таблица импорта привязанной задержки <br/>   | RVA связанной таблицы отложенной загрузки, если она существует. <br/>                                                                                                                                                                                                                                                     |
| 24 <br/> | 4 <br/> | Таблица отложенных импортов <br/>  | RVA для таблицы адресов задержки загрузки, если он существует. Это точная копия таблицы адресов отложенного импорта. Если вызывающий объект выгружает библиотеку DLL, эта таблица должна быть скопирована обратно в таблицу адресов с отложенным импортом, чтобы последующие вызовы библиотеки DLL продолжали использовать механизм преобразователей правильно. <br/> |
| 28 <br/> | 4 <br/> | Метка времени <br/>                 | Метка времени библиотеки DLL, к которой привязан этот образ. <br/>                                                                                                                                                                                                                                                     |



 

Таблицы, на которые имеются ссылки в этой структуре данных, упорядочиваются и сортируются так же, как и для традиционных импортов. Дополнительные сведения см. [в разделе. иДата](#the-idata-section).

#### <a name="attributes"></a>Атрибуты

Флаги атрибутов пока не определены. Компоновщик задает для этого поля нулевое значение в изображении. Это поле можно использовать для расширения записи путем указания наличия новых полей или для указания поведения вспомогательных функций задержки или выгрузки.

#### <a name="name"></a>Имя

Имя библиотеки DLL, которая должна быть загружена с задержкой, находится в разделе данных образа, доступном только для чтения. Ссылка на него осуществляется с помощью поля szName.

#### <a name="module-handle"></a>Маркер модуля

Обработчик библиотеки DLL, который должен быть загружен с задержкой, находится в разделе данных изображения. Поле фмод указывает на маркер. Указанный вспомогательный модуль загрузки с отложенной загрузкой использует это расположение для хранения маркера в загруженной библиотеке DLL.

#### <a name="delay-import-address-table"></a>Таблица адресов задержки импорта

Ссылка на таблицу адресов импорта с задержкой (IAT) ссылается на дескриптор отложенного импорта через поле Пиат. Вспомогательный модуль с отложенной загрузкой обновляет эти указатели с реальными точками входа, чтобы преобразовательы больше не в цикле вызова. Доступ к указателям функций осуществляется с помощью выражения `pINT->u1.Function` .

#### <a name="delay-import-name-table"></a>Таблица имен отложенных импортов

Таблица имен отложенных импортов (INT) содержит имена импортов, которые могут потребовать загрузки. Они упорядочиваются таким же образом, как и указатели функций в IAT. Они состоят из тех же структур, что и стандартное ЦЕЛОе число, и доступны с помощью выражения `pINT->u1.AddressOfData->Name[0]` .

#### <a name="delay-bound-import-address-table-and-time-stamp"></a>Откладывание связанной таблицы адресов импорта и отметок времени

Таблица адресов импорта с отложенной загрузкой (Биат) — это необязательная таблица \_ \_ элементов данных преобразователя изображений, которая используется вместе с полем timestamp в таблице каталогов с задержкой загрузки по этапу привязки после обработки.

#### <a name="delay-unload-import-address-table"></a>Таблица адресов импорта отложенной выгрузки

Таблица адресов импорта с отложенной выгрузкой (УИАТ) — это необязательная таблица \_ \_ элементов данных преобразователя изображений, которую код выгрузки использует для выполнения запроса на выгрузку. Он состоит из инициализированных данных в разделе только для чтения, который представляет собой точную копию исходной IAT, которая ссылается на код на преобразователи с отложенной загрузкой. В запросе выгрузки библиотека может быть освобождена, \* фмод очищена и уиат, записанная на IAT, чтобы восстановить все в состояние предварительной загрузки.

## <a name="special-sections"></a>Специальные разделы

- [Раздел. Debug](#the-debug-section)
  - [Каталог отладки (только изображение)](#debug-directory-image-only)
  - [Тип отладки](#debug-type)
  - [. Debug $ F (только объект)](#debugf-object-only)
  - [. Отладка $ S (только объект)](#debugs-object-only)
  - [. Debug $ P (только объект)](#debugp-object-only)
  - [. debug $ T (только объект)](#debugt-object-only)
  - [Поддержка компоновщика для отладочной информации Майкрософт](#linker-support-for-microsoft-debug-information)
- [Раздел. drectve (только объект)](#the-drectve-section-object-only)
- [Раздел. едата (только изображение)](#the-edata-section-image-only)
  - [Экспорт таблицы каталога](#export-directory-table)
  - [Экспорт таблицы адресов](#export-address-table)
  - [Таблица указателей имени экспорта](#export-name-pointer-table)
  - [Экспортировать Порядковую таблицу](#export-ordinal-table)
  - [Экспорт таблицы имен](#export-name-table)
- [Раздел. иДата](#the-idata-section)
  - [Импорт таблицы каталога](#import-directory-table)
  - [Импорт таблицы подстановки](#import-lookup-table)
  - [Указание или таблица имен](#hintname-table)
  - [Импорт таблицы адресов](#delay-import-address-table)
- [Раздел pdata](#the-pdata-section)
- [Раздел. reloc (только изображение)](#the-reloc-section-image-only)
  - [Базовый блок перемещения](#base-relocation-block)
  - [Базовые типы перемещений](#base-relocation-types)
- [Раздел. TLS](#the-tls-section)
  - [Каталог TLS](#the-tls-directory)
  - [Функции обратного вызова TLS](#tls-callback-functions)
- [Структура конфигурации загрузки (только для образа)](#the-load-configuration-structure-image-only)
  - [Загрузить каталог конфигурации](#load-configuration-directory)
  - [Загрузить макет конфигурации](#load-configuration-layout)
- [Раздел. rsrc](#the-rsrc-section)
  - [Таблица каталога ресурсов](#resource-directory-table)
  - [Записи каталога ресурсов](#resource-directory-entries)
  - [Строка каталога ресурсов](#resource-directory-string)
  - [Ввод данных ресурса](#resource-data-entry)
- [Раздел. кормета (только объект)](#the-cormeta-section-object-only)
- [Раздел. сксдата](#the-sxdata-section)

Типичные разделы COFF содержат код или данные, которые обрабатываются компоновщиками и загрузчиками Microsoft Win32 без специальных знаний о содержимом раздела. Содержимое относится только к связанному или выполняемому приложению.

Однако некоторые разделы COFF имеют особое значение при обнаружении в объектных файлах или файлах изображений. Средства и загрузчики распознают эти разделы, так как они имеют специальные флаги, заданные в заголовке раздела, так как специальные расположения в необязательном заголовке изображения указывают на них или потому, что само имя раздела указывает на специальную функцию раздела. (Даже если само имя раздела не указывает на специальную функцию раздела, имя раздела определяется по соглашению, поэтому авторы этой спецификации могут ссылаться на имя раздела во всех случаях).

Зарезервированные разделы и их атрибуты описаны в таблице ниже, за которой следуют подробные описания типов разделов, которые сохраняются в исполняемых файлах, и типы разделов, содержащие метаданные для расширений.



| Имя раздела          | Content                                                                                                                                                                  | Характеристики                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| . BSS <br/>      | Неинициализированные данные (бесплатный формат) <br/>                                                                                                                             | ОБРАЗ уведомления SCN \_ \_ CNT \_ неинициализированный \_ образ данных уведомления \| \_ SCN \_ \_ считывания \| образа \_ SCN \_ \_ запись <br/>                                                                                                                                                                                                                                                                                               |
| . кормета <br/>  | Метаданные среды CLR, указывающие, что объектный файл содержит управляемый код <br/>                                                                                       | сведения о сообразе \_ SCN \_ LNK \_ <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| . Data <br/>     | Инициализированные данные (бесплатный формат) <br/>                                                                                                                               | ОБРАЗ \_ \_ CNT \_ инициализированный \_ образ данных \| SCN \_ \_ mem \_ Reading \| image \_ SCN \_ \_ Write <br/>                                                                                                                                                                                                                                                                                                 |
| . Debug $ F <br/>  | Созданная информация об отладке FPO (только объект, архитектура x86 и теперь устарела) <br/>                                                                       | ОБРАЗ уведомления о \_ \_ \_ инициализированном \_ образе CNT данных уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN чтения \_ \_ <br/>                                                                                                                                                                                                                                                                                           |
| . Debug $ P <br/>  | Предкомпилированные типы отладки (только объект) <br/>                                                                                                                        | ОБРАЗ уведомления о \_ \_ \_ инициализированном \_ образе CNT данных уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN чтения \_ \_ <br/>                                                                                                                                                                                                                                                                                           |
| . Отладка $ S <br/>  | Отладочные символы (только для объектов) <br/>                                                                                                                                  | ОБРАЗ уведомления о \_ \_ \_ инициализированном \_ образе CNT данных уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN чтения \_ \_ <br/>                                                                                                                                                                                                                                                                                           |
| . debug $ T <br/>  | Типы отладки (только объект) <br/>                                                                                                                                    | ОБРАЗ уведомления о \_ \_ \_ инициализированном \_ образе CNT данных уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN чтения \_ \_ <br/>                                                                                                                                                                                                                                                                                           |
| . дрективе <br/> | Параметры компоновщика <br/>                                                                                                                                               | сведения о сообразе \_ SCN \_ LNK \_ <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| . едата <br/>    | Экспорт таблиц <br/>                                                                                                                                                | ОБРАЗ \_ \_ CNT \_ инициализированных \_ данных о \| \_ \_ \_ считывании образа уведомления SCN <br/>                                                                                                                                                                                                                                                                                                                           |
| . иДата <br/>    | Импорт таблиц <br/>                                                                                                                                                | ОБРАЗ \_ \_ CNT \_ инициализированный \_ образ данных \| SCN \_ \_ mem \_ Reading \| image \_ SCN \_ \_ Write <br/>                                                                                                                                                                                                                                                                                                 |
| . IDLSYM <br/>   | Включает в себя зарегистрированный SEH (только изображение) для поддержки атрибутов IDL. Дополнительные сведения см. в разделе «атрибуты IDL» в разделе « [ссылки](#references) » в конце этого раздела. <br/> | сведения о сообразе \_ SCN \_ LNK \_ <br/>                                                                                                                                                                                                                                                                                                                                                                 |
| . pdata <br/>    | Сведения об исключении <br/>                                                                                                                                        | ОБРАЗ \_ \_ CNT \_ инициализированных \_ данных о \| \_ \_ \_ считывании образа уведомления SCN <br/>                                                                                                                                                                                                                                                                                                                           |
| . rdata <br/>    | Инициализированные данные только для чтения <br/>                                                                                                                                   | ОБРАЗ \_ \_ CNT \_ инициализированных \_ данных о \| \_ \_ \_ считывании образа уведомления SCN <br/>                                                                                                                                                                                                                                                                                                                           |
| . reloc <br/>    | Перемещение изображений <br/>                                                                                                                                            | ОБРАЗ уведомления о \_ \_ \_ инициализированном \_ образе CNT данных уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN чтения \_ \_ <br/>                                                                                                                                                                                                                                                                                           |
| . rsrc <br/>     | Каталог ресурсов <br/>                                                                                                                                           | ОБРАЗ \_ \_ CNT \_ инициализированных \_ данных о \| \_ \_ \_ считывании образа уведомления SCN <br/>                                                                                                                                                                                                                                                                                                                           |
| . SBSS <br/>     | GP — относительные неинициализированные данные (бесплатный формат) <br/>                                                                                                                 | ОБРАЗ \_ SCN \_ CNT \_ uninitialed \_ Data \| уведомления \_ SCN \_ \_ считывания \| образа \_ уведомления \_ SCN \_ запись \| образа \_ SCN \_ гпрел \_ \_ . флаг уведомления SCN гпрел должен быть установлен только для архитектур IA64. Этот флаг является недопустимым для других архитектур. Флаг уведомления \_ SCN \_ гпрел предназначен только для объектных файлов; если этот раздел отображается в файле изображения, то \_ флаг уведомления SCN \_ гпрел не должен быть установлен. <br/> |
| . sdata <br/>    | GP — инициализированные данные (бесплатный формат) <br/>                                                                                                                   | ОБРАЗ уведомления SCN \_ \_ CNT \_ инициализированные \_ данные уведомления \| \_ SCN \_ \_ считывания \| образа уведомления \_ SCN запись образа уведомления о \_ \_ \| \_ \_ гпрел \_ \_ . флаг уведомления SCN гпрел должен быть установлен только для архитектур IA64. Этот флаг является недопустимым для других архитектур. Флаг уведомления \_ SCN \_ гпрел предназначен только для объектных файлов; если этот раздел отображается в файле изображения, то \_ флаг уведомления SCN \_ гпрел не должен быть установлен. <br/>   |
| . срдата <br/>   | GP — относительные данные только для чтения (бесплатный формат) <br/>                                                                                                                     | ОБРАЗ \_ SCN \_ CNT \_ инициализированные \_ данные уведомления уведомления \| \_ SCN \_ \_ Чтение \| образа \_ SCN \_ гпрел \_ \_ . флаг уведомления SCN гпрел должен быть установлен только для архитектур IA64. Этот флаг является недопустимым для других архитектур. Флаг уведомления \_ SCN \_ гпрел предназначен только для объектных файлов; если этот раздел отображается в файле изображения, то \_ флаг уведомления SCN \_ гпрел не должен быть установлен. <br/>                             |
| . сксдата <br/>   | Зарегистрированные данные обработчика исключений (бесплатный формат и только x86/Object) <br/>                                                                                          | ИЗОБРАЖЕНИЕ \_ SCN \_ LNK \_ info содержит индекс символа каждого обработчика исключений, на который ссылается код в этом файле объекта. Символ может быть символом UNDEF или, определенным в этом модуле. <br/>                                                                                                                                                                     |
| .text <br/>     | Исполняемый код (бесплатный формат) <br/>                                                                                                                                | ИЗОБРАЖЕНИЕ \_ SCN \_ CNT \_ код \| образа \_ уведомления \_ SCN \_ выполнение \| иимаже \_ уведомления \_ SCN \_ Read <br/>                                                                                                                                                                                                                                                                                                           |
| . TLS <br/>      | Локальное хранилище потока (только объект) <br/>                                                                                                                           | ОБРАЗ \_ \_ CNT \_ инициализированный \_ образ данных \| SCN \_ \_ mem \_ Reading \| image \_ SCN \_ \_ Write <br/>                                                                                                                                                                                                                                                                                                 |
| . TLS $ <br/>     | Локальное хранилище потока (только объект) <br/>                                                                                                                           | ОБРАЗ \_ \_ CNT \_ инициализированный \_ образ данных \| SCN \_ \_ mem \_ Reading \| image \_ SCN \_ \_ Write <br/>                                                                                                                                                                                                                                                                                                 |
| . всдата <br/>   | Зависящие от групповой политики инициализированные данные (бесплатный формат и только для архитектур ARM, SH4 и Thumb) <br/>                                                                    | ОБРАЗ \_ \_ CNT \_ инициализированный \_ образ данных \| SCN \_ \_ mem \_ Reading \| image \_ SCN \_ \_ Write <br/>                                                                                                                                                                                                                                                                                                 |
| . XData <br/>    | Сведения об исключении (бесплатный формат) <br/>                                                                                                                          | ОБРАЗ \_ \_ CNT \_ инициализированных \_ данных о \| \_ \_ \_ считывании образа уведомления SCN <br/>                                                                                                                                                                                                                                                                                                                           |



 

Некоторые из перечисленных здесь разделов помечены как "только объект" или "только изображение", чтобы указать, что их особая семантика уместна только для объектных файлов или файлов изображений соответственно. Раздел, помеченный как «только изображение», может по-прежнему отображаться в объектном файле как способ перехода в файл изображения, но раздел не имеет специального значения для компоновщика только в загрузчике файлов изображений.

### <a name="the-debug-section"></a>Раздел. Debug

Раздел. Debug используется в объектных файлах для хранения отладочной информации, созданной компилятором, и в файлах изображений для хранения всех формируемых отладочных данных. В этом разделе описывается упаковка отладочной информации в файлы объектов и изображений.

В следующем разделе описывается формат каталога отладки, который может находиться в любом месте изображения. В последующих разделах описываются группы в объектных файлах, содержащих отладочную информацию.

Значение по умолчанию для компоновщика заключается в том, что отладочная информация не сопоставлена с адресным пространством изображения. Раздел. Debug существует только в том случае, если отладочная информация сопоставлена в адресном пространстве.

#### <a name="debug-directory-image-only"></a>Каталог отладки (только изображение)

Файлы изображений содержат Необязательный каталог отладки, который указывает, какая форма отладочной информации имеется и где они находятся. Этот каталог состоит из массива записей каталога отладки, расположение и размер которых указаны в необязательном заголовке Image.

Каталог отладки может находиться в разделе с отброшенным. Отладка (если он существует) или в любой другой раздел файла изображения или вообще отсутствовать в разделе.

Каждая запись каталога отладки определяет расположение и размер блока отладочной информации. Указанный RVA может быть равен нулю, если отладочная информация не охватывается заголовком раздела (то есть он находится в файле изображения и не сопоставляется с адресным пространством времени выполнения). Если он сопоставлен, то RVA является его адресом.

Запись каталога отладки имеет следующий формат:



| Offset         | Размер          | Поле                        | Описание                                                                                                                                            |
|----------------|---------------|------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Характеристики <br/>  | Зарезервировано, должно быть равно нулю. <br/>                                                                                                                    |
| 4 <br/>  | 4 <br/> | тимедатестамп <br/>    | Время и Дата создания данных отладки. <br/>                                                                                         |
| 8 <br/>  | 2 <br/> | MajorVersion <br/>     | Основной номер версии формата данных отладки. <br/>                                                                                         |
| 10 <br/> | 2 <br/> | MinorVersion <br/>     | Дополнительный номер версии формата данных отладки. <br/>                                                                                         |
| 12 <br/> | 4 <br/> | Тип <br/>             | Формат отладочной информации. Это поле включает поддержку нескольких отладчиков. Дополнительные сведения см. в разделе [Тип отладки](#debug-type).<br/> |
| 16 <br/> | 4 <br/> | сизеофдата <br/>       | Размер отладочных данных (не включая сам каталог отладки). <br/>                                                                     |
| 20 <br/> | 4 <br/> | аддрессофравдата <br/> | Адрес отладочных данных при загрузке относительно базы образа. <br/>                                                                     |
| 24 <br/> | 4 <br/> | поинтерторавдата <br/> | Указатель файла на данные отладки. <br/>                                                                                                        |



 

#### <a name="debug-type"></a>Тип отладки

Для поля Тип записи каталога отладки определены следующие значения:



| Константа                                        | Значение          | Описание                                                                                                                                                                                                      |
|-------------------------------------------------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_неизвестный \_ Тип отладки изображения \_ <br/>         | 0 <br/>  | Неизвестное значение, которое игнорируется всеми инструментами. <br/>                                                                                                                                                       |
| \_Тип отладки \_ образа \_ COFF <br/>            | 1 <br/>  | Отладочная информация COFF (номера строк, таблица символов и таблица строк). На отладочную информацию этого типа также указывают поля в заголовках файлов. <br/>                                          |
| \_Тип отладки \_ image \_ Информация CodeView <br/>        | 2 <br/>  | Сведения об отладке Visual C++. <br/>                                                                                                                                                                    |
| \_Тип отладки \_ изображения \_ FPO <br/>             | 3 <br/>  | Сведения о пропуске указателя кадра (FPO). Эти сведения сообщают отладчику о том, как интерпретировать нестандартные кадры стека, которые используют регистр EBP для назначения, отличного от в качестве указателя фрейма. <br/> |
| \_ \_ Прочие типы отладки \_ изображений <br/>            | 4 <br/>  | Расположение файла DBG. <br/>                                                                                                                                                                            |
| \_исключение для \_ типа \_ отладки изображения <br/>       | 5 <br/>  | Копия раздела. pData. <br/>                                                                                                                                                                            |
| \_исправление для \_ типа \_ отладки изображения <br/>           | 6 <br/>  | Зарезервировано. <br/>                                                                                                                                                                                            |
| \_Тип отладки \_ изображения \_ ОМАП \_ в \_ src <br/>   | 7 <br/>  | Сопоставление относительного RVA в образе с RVA в исходном изображении. <br/>                                                                                                                                          |
| \_Тип отладки \_ изображения \_ ОМАП \_ из \_ src <br/> | 8 <br/>  | Сопоставление относительного RVA в исходном образе с RVA в изображении. <br/>                                                                                                                                          |
| \_Тип отладки \_ image \_ Borland <br/>         | 9 <br/>  | Зарезервировано для Borland. <br/>                                                                                                                                                                                |
| \_Тип отладки \_ image \_ RESERVED10 <br/>      | 10 <br/> | Зарезервировано. <br/>                                                                                                                                                                                            |
| \_Тип отладки Image, \_ \_ CLSID <br/>           | 11 <br/> | Зарезервировано. <br/>                                                                                                                                                                                            |
| Воспроизведение \_ типа отладки изображений \_ \_ <br/>           | 16 <br/> | Детерминированный определитель PE или воспроизводимость. <br/>                                                                                                                                                                   |
| \_Тип отладки \_ образа \_ ex \_ DLLCHARACTERISTICS | 20 | Биты расширенных характеристик DLL. |



 

Если поле Тип имеет значение \_ Тип отладки изображения \_ \_ FPO, то отладочные необработанные данные представляют собой массив, в котором каждый элемент описывает кадр стека функции. Не для каждой функции в файле изображения должны быть определены сведения о завершении работы, хотя тип отладки — FPO. Предполагается, что эти функции, не имеющие сведений о завершении работы, имеют обычные кадры стека. Формат сведений о FPO выглядит следующим образом:


```C++
#define FRAME_FPO   0               
#define FRAME_TRAP  1
#define FRAME_TSS   2
               
typedef struct _FPO_DATA {
    DWORD       ulOffStart;            // offset 1st byte of function code
    DWORD       cbProcSize;            // # bytes in function
    DWORD       cdwLocals;             // # bytes in locals/4
    WORD        cdwParams;             // # bytes in params/4
    WORD        cbProlog : 8;          // # bytes in prolog
    WORD        cbRegs   : 3;          // # regs saved
    WORD        fHasSEH  : 1;          // TRUE if SEH in func
    WORD        fUseBP   : 1;          // TRUE if EBP has been allocated
    WORD        reserved : 1;          // reserved for future use
    WORD        cbFrame  : 2;          // frame type
} FPO_DATA;
```



Наличие записи типа \_ Отладка \_ типа Image \_ указывает, что PE-файл создан для достижения детерминированности или воспроизводимость. Если входные данные не изменяются, то выходной PE-файл гарантированно будет иметь бит для идентичности, независимо от того, где создается PE. Различные поля отметок даты и времени в PE-файле заполняются частью или всеми битами из вычисленного хэша, который использует содержимое файла PE в качестве входных данных и, следовательно, больше не представляет фактическую дату и время выполнения PE-файла или связанных конкретных данных в PE. Необработанные данные этой записи отладки могут быть пустыми или могут содержать вычисленное хэш-значение, начинающееся с 4-байтового значения, представляющего длину хэш-значения.

Если для поля Тип задано значение \_ Тип отладки \_ image \_ ex \_ DLLCHARACTERISTICS, то необработанные данные отладки содержат дополнительные биты характеристик DLL, дополнительные для тех, которые можно задать в заголовке необязательного изображения. См. раздел [характеристики библиотеки DLL](#dll-characteristics) в разделе [необязательный заголовок Windows-Specific полей (только изображение)](#optional-header-windows-specific-fields-image-only).

##### <a name="extended-dll-characteristics"></a>Расширенные характеристики DLL

Для битов расширенных характеристик DLL определены следующие значения.

| Константа | Значение | Описание |
|-|-|-|
| IMAGE \_ DLLCHARACTERISTICS \_ ex \_ Центральноевропейское время, \_ Совместимость | 0x0001 | Образ совместим с ЦЕНТРАЛЬНОЕВРОПЕЙСКОЕ время. |

#### <a name="debugf-object-only"></a>. Debug $ F (только объект)

Данные в этом разделе были заменены в Visual C++ версии 7,0 и более поздних по более обширному набору данных, который создается подразделу **. debug $ S** .

Объектные файлы могут содержать. отладку разделов $ F, содержимое которых является одной или несколькими \_ записями данных FPO (сведения о пропуске указателя кадра). См. раздел \_ " \_ Тип отладки изображения \_ FPO" в разделе [Тип отладки](#debug-type).

Компоновщик распознает эти записи **. Debug $ F** . Если отладочная информация создается, компоновщик сортирует \_ записи данных FPO по процедуре RVA и создает для них запись каталога отладки.

Компилятор не должен создавать записи FPO для процедур, имеющих стандартный формат кадра.

#### <a name="debugs-object-only"></a>. Отладка $ S (только объект)

В этом разделе содержатся Visual C++ сведения об отладке (символьная информация).

#### <a name="debugp-object-only"></a>. Debug $ P (только объект)

В этом разделе содержатся Visual C++ сведения об отладке (предварительно скомпилированные сведения). Это общие типы для всех объектов, которые были скомпилированы с использованием предкомпилированного заголовка, созданного с помощью этого объекта.

#### <a name="debugt-object-only"></a>. debug $ T (только объект)

В этом разделе содержатся Visual C++ сведения об отладке (сведения о типе).

#### <a name="linker-support-for-microsoft-debug-information"></a>Поддержка компоновщика для отладочной информации Майкрософт

Для поддержки отладочной информации компоновщик:

-   Собирает все соответствующие отладочные данные из разделов **отладки $ F**, **Отладка $ S**, **. Debug $ P** и **. debug $ T** .

-   Обрабатывает эти данные вместе с отладочной информацией, созданной компоновщиком, в PDB-файл и создает запись в каталоге отладки для ссылки на нее.

### <a name="the-drectve-section-object-only"></a>Раздел. drectve (только объект)

Раздел является разделом директивы, если \_ \_ \_ в заголовке раздела задан флаг уведомления SCN LNK info и имя раздела **drectve** . Компоновщик удаляет раздел **. drectve** после обработки информации, поэтому раздел не отображается в связанном файле изображения.

Раздел **. drectve** состоит из строки текста, которая может быть закодирована как ANSI или UTF-8. Если маркер порядка байтов UTF-8 (BOM, префикс из трех байт, состоящий из 0xEF, 0xBB и 0xBF) отсутствует, строка директивы интерпретируется как ANSI. Строка директивы представляет собой ряд параметров компоновщика, разделенных пробелами. Каждый параметр содержит дефис, имя параметра и любой соответствующий атрибут. Если параметр содержит пробелы, параметр должен быть заключен в кавычки. Раздел **. drectve** не должен содержать перемещения или номера строк.

### <a name="the-edata-section-image-only"></a>Раздел. едата (только изображение)

Раздел Экспорт данных с именем. едата содержит сведения о символах, к которым другие изображения могут обращаться через динамическую компоновку. Экспортированные символы обычно находятся в библиотеках DLL, но библиотеки DLL также могут импортировать символы.

Общие сведения о общей структуре раздела Export описаны ниже. Описанные таблицы обычно являются непрерывными в файле в указанном порядке (хотя это не является обязательным). Для экспорта символов в качестве порядковых номеров требуются только таблица экспорта каталога и таблица адресов экспорта. (Порядковый номер — это экспорт, доступ к которому осуществляется непосредственно по индексу таблицы адресов экспорта.) Таблица указателей имени, порядковая таблица и имя экспорта существуют для поддержки использования имен экспорта.



| Имя таблицы                         | Описание                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Экспорт таблицы каталога <br/> | Таблица, сопоставленная только из одной строки (в отличие от каталога отладки). В этой таблице указаны расположения и размеры других таблиц экспорта. <br/>                                                                                                                                                                                                               |
| Экспорт таблицы адресов <br/>   | Массив RVA экспортируемых символов. Это фактические адреса экспортированных функций и данных в исполняемом коде и разделах данных. Другие файлы изображений могут импортировать символ с помощью индекса в эту таблицу (порядковый номер) или, при необходимости, с помощью открытого имени, которое соответствует порядковому номеру, если определено общедоступное имя. <br/> |
| Таблица указателей имен <br/>     | Массив указателей на открытые имена экспорта, отсортированные в возрастающем порядке. <br/>                                                                                                                                                                                                                                                                    |
| Порядковая таблица <br/>          | Массив порядков, соответствующих элементам таблицы указателей имен. Корреспонденция по положению; Таким образом, таблица указателей имени и порядковая таблица должны иметь одинаковое число элементов. Каждый порядковый номер является индексом в таблице адресов экспорта. <br/>                                                                        |
| Экспорт таблицы имен <br/>      | Ряд строк ASCII с завершающим нулем. Элементы таблицы указателя имен указывают на эту область. Эти имена представляют собой открытые имена, с помощью которых символы импортируются и экспортируются. они не обязательно должны совпадать с частными именами, используемыми в файле образа. <br/>                                                           |



 

Когда другой файл изображения импортирует символ по имени, загрузчик Win32 выполняет поиск соответствующей строки в таблице указателей имен. Если найдена совпадающая строка, то соответствующий порядковый номер определяется путем поиска соответствующего элемента в порядковом номерной таблице (то есть элемента в порядковой таблице с тем же индексом, что и указатель строки, найденный в таблице указателей имени). Результирующий порядковый номер — это индекс в таблице адресов экспорта, который предоставляет фактическое расположение нужного символа. К каждому символу экспорта можно обращаться по порядковому номеру.

Если другой файл изображения импортирует символ по порядковому номеру, вам не нужно искать соответствующую строку в таблице указателей имен. Следовательно, прямое использование порядкового номера является более эффективным. Однако имя экспорта проще запомнить и не требует, чтобы пользователь знал индекс таблицы для символа.

#### <a name="export-directory-table"></a>Экспорт таблицы каталога

Сведения о символах экспорта начинаются с таблицы Export Directory, которая описывает оставшуюся часть сведений о символах экспорта. Таблица Export Directory содержит сведения об адресах, которые используются для разрешения импорта в точки входа в этом образе.



| Offset         | Размер          | Поле                                | Описание                                                                                                                                                               |
|----------------|---------------|--------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Экспортировать флаги <br/>             | Зарезервировано, должно быть равно 0. <br/>                                                                                                                                          |
| 4 <br/>  | 4 <br/> | Метка времени и даты <br/>          | Время и Дата создания данных экспорта. <br/>                                                                                                           |
| 8 <br/>  | 2 <br/> | Основная версия <br/>            | Основной номер версии. Основной и дополнительный номера версии могут быть заданы пользователем. <br/>                                                                         |
| 10 <br/> | 2 <br/> | Вспомогательная версия <br/>            | Дополнительный номер версии. <br/>                                                                                                                                     |
| 12 <br/> | 4 <br/> | Имя RVA <br/>                 | Адрес строки ASCII, содержащей имя библиотеки DLL. Этот адрес является относительным для базы образа. <br/>                                                |
| 16 <br/> | 4 <br/> | Базовый порядковый номер <br/>             | Начальный порядковый номер для экспортов в этом изображении. В этом поле указывается начальный порядковый номер для таблицы адресов экспорта. Обычно устанавливается значение 1. <br/> |
| 20 <br/> | 4 <br/> | Записи таблицы адресов <br/>    | Число записей в таблице адресов экспорта. <br/>                                                                                                            |
| 24 <br/> | 4 <br/> | Число указателей имен <br/>  | Число записей в таблице указателей имен. Это также число записей в порядковом номере таблицы. <br/>                                                     |
| 28 <br/> | 4 <br/> | Экспорт RVA таблицы адресов <br/> | Адрес таблицы адресов экспорта относительно базы изображения. <br/>                                                                                          |
| 32 <br/> | 4 <br/> | RVA указателя имени <br/>         | Адрес таблицы указателей имени экспорта относительно базы изображения. Размер таблицы определяется в поле число указателей имен. <br/>                       |
| 36 <br/> | 4 <br/> | RVA в порядковом номере таблицы <br/>        | Адрес порядковой таблицы относительно базы изображения. <br/>                                                                                                 |



 

#### <a name="export-address-table"></a>Экспорт таблицы адресов

Таблица экспорт адреса содержит адрес экспортированных точек входа и экспортированных данных и абсолютных. Порядковый номер используется в качестве индекса в таблице адресов экспорта.

Каждая запись в таблице адресов экспорта является полем, в котором используется один из двух форматов в следующей таблице. Если указанный адрес не входит в раздел Export (как определено адресом и длиной, указанными в необязательном заголовке), то поле является RVA экспорта, который является фактическим адресом в коде или данных. В противном случае поле является RVA-адресом сервера пересылки, который именует символ в другой библиотеке DLL.



| Offset        | Размер          | Поле                     | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------|---------------|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | Экспорт RVA <br/>    | Адрес экспортированного символа при загрузке в память относительно базы образа. Например, адрес экспортированной функции. <br/>                                                                                                                                                                                                                                                                                                       |
| 0 <br/> | 4 <br/> | RVA сервера пересылки <br/> | Указатель на строку ASCII с завершающим нулем в разделе Export. Эта строка должна находиться в диапазоне, заданном в записи каталога экспорта данных таблицы. См. раздел [необязательные каталоги данных заголовков (только изображение)](#optional-header-data-directories-image-only). Эта строка задает имя DLL и имя экспорта (например, "MYDLL. експфунк") или имя DLL и порядковый номер экспорта (например, MYDLL. \# 27 "). <br/> |



 

RVA-адрес сервера пересылки экспортирует определение из какого-либо другого изображения, что может выглядеть так, как будто оно было экспортировано текущим изображением. Таким же символом одновременно импортируется и экспортируется.

Например, в Kernel32.dll в Windows XP экспорт с именем «Хеапаллок» перенаправляется в строку «NTDLL. Ртлаллокатехеап ". Это позволяет приложениям использовать модуль Ntdll.dll, предназначенный для Windows XP, без фактической ссылки на импорт. Таблица импорта приложения относится только к Kernel32.dll. Поэтому приложение не зависит от Windows XP и может выполняться в любой системе Win32.

#### <a name="export-name-pointer-table"></a>Таблица указателей имени экспорта

Таблица указателей имени экспорта представляет собой массив адресов (RVA) в таблице имен экспорта. Указатели — это 32 бит, каждый из которых отсчитывается относительно базы изображения. Указатели упорядочиваются лексно, чтобы разрешить двоичный поиск.

Имя экспорта определяется только в том случае, если таблица указателей имени экспорта содержит указатель на нее.

#### <a name="export-ordinal-table"></a>Экспортировать Порядковую таблицу

Порядковый номер экспорта — это массив 16-разрядных несмещенных индексов в таблице адресов экспорта. Порядковые номера смещены по порядковому номеру базового поля таблицы экспорта каталога. Иными словами, необходимо вычесть порядковый номер базового индекса из порядковых номеров, чтобы получить индексы true в таблице адресов экспорта.

Таблица указатели имени экспорта и порядковый номер экспорта формируют два параллельных массива, разделенных, для разрешения естественного выравнивания полей. Эти две таблицы, по сути, работают как одна таблица, в которой столбец Export Name указателя указывает на общедоступное (экспортированное) имя, а порядковый номер экспорта задает соответствующий порядковый номер для этого открытого имени. Член таблицы с указателем имени экспорта и членом порядкового номера экспорта связываются с одинаковой позицией (индексом) в соответствующих массивах.

Таким образом, когда выполняется поиск в таблице указателей имени экспорта и найдена соответствующая строка в позиции i, алгоритм поиска RVA и смещенного порядкового номера символа имеет вид:

```C++
i = Search_ExportNamePointerTable (name);
ordinal = ExportOrdinalTable [i];

rva = ExportAddressTable [ordinal];
biased_ordinal = ordinal + OrdinalBase;
```

При поиске символа по порядковому номеру (с сдвигом) алгоритм поиска RVA и имени символа:

```C++
ordinal = biased_ordinal - OrdinalBase;
i = Search_ExportOrdinalTable (ordinal);

rva = ExportAddressTable [ordinal];
name = ExportNameTable [i];
```

#### <a name="export-name-table"></a>Экспорт таблицы имен

Таблица Export Name содержит фактические строковые данные, на которые указывала таблица указателей имени экспорта. Строки в этой таблице являются общедоступными именами, которые другие изображения могут использовать для импорта символов. Эти открытые имена экспорта не обязательно должны совпадать с именами частных символов, которые имеют символы в собственном файле изображения и исходном коде, хотя это могут быть.

Каждый экспортированный символ имеет порядковое значение, которое является просто индексом в таблице адресов экспорта. Однако использование имен экспорта является необязательным. Некоторые, все или ни один из экспортированных символов могут иметь имена экспорта. Для экспортированных символов, у которых есть имена экспорта, соответствующие записи в таблице указатель имени экспорта и экспортная таблица должны работать вместе, чтобы связать каждое имя с порядковым номером.

Структура таблицы имен экспорта представляет собой ряд строк ASCII, завершающихся нулем, с переменной длиной.

### <a name="the-idata-section"></a>Раздел. иДата

Все файлы изображений, в которых импортируются символы, включая практически все исполняемые файлы (EXE), имеют раздел. иДата. Типичный файловый макет для данных импорта приведен ниже.

-   Таблица каталога

    Запись каталога со значением NULL

-   Таблица подстановки импорта DLL1

    NULL

-   Таблица подстановки импорта DLL2

    NULL

-   Таблица подстановки импорта DLL3

    NULL

-   Таблица Hint-Name

#### <a name="import-directory-table"></a>Импорт таблицы каталога

Данные импорта начинаются с таблицы Import Directory, которая описывает оставшуюся часть сведений о импорте. Таблица Импорт каталога содержит сведения об адресах, которые используются для разрешения ссылок на точки входа в образе библиотеки DLL. Таблица Import Directory состоит из массива записей каталога импорта, по одной записи для каждой библиотеки DLL, к которой относится изображение. Последняя запись каталога пуста (заполнена значениями NULL), что означает конец таблицы каталога.

Каждая запись каталога импорта имеет следующий формат:



| Offset         | Размер          | Поле                                                 | Описание                                                                                                                                                                                 |
|----------------|---------------|-------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Импорт таблицы относительных значений подстановки (характеристики) <br/> | RVA таблицы поиска импорта. Эта таблица содержит имя или порядковый номер для каждого импорта. (Имя "характеристики" используется в Winnt. h, но больше не описывает это поле.) <br/> |
| 4 <br/>  | 4 <br/> | Метка времени и даты <br/>                           | Отметка, для которой установлено нулевое значение, пока изображение не будет привязано. После привязки образа в этом поле задается метка времени и данных библиотеки DLL. <br/>                                          |
| 8 <br/>  | 4 <br/> | Цепь пересылки <br/>                           | Индекс первой ссылки на пересылку. <br/>                                                                                                                                     |
| 12 <br/> | 4 <br/> | Имя RVA <br/>                                  | Адрес строки ASCII, содержащей имя библиотеки DLL. Этот адрес является относительным для базы образа. <br/>                                                                   |
| 16 <br/> | 4 <br/> | Адрес RVA таблицы импорта (таблица преобразователей) <br/>    | RVA для таблицы адресов импорта. Содержимое этой таблицы идентично содержимому таблицы поиска импорта, пока изображение не будет привязано. <br/>                              |



 

#### <a name="import-lookup-table"></a>Импорт таблицы подстановки

Таблица импорта — это массив из 32-разрядных чисел для формат PE32 или массив 64-разрядных чисел для формат PE32 +. Каждая запись использует формат битового поля, описанный в следующей таблице. В этом формате бит 31 является наиболее значащим битом для формат PE32 и бит 63 — самый важный бит для формат PE32 +. Коллекция этих записей описывает все импорты из заданной библиотеки DLL. Последняя запись устанавливается в ноль (NULL), чтобы обозначить конец таблицы.



| Бит (с)            | Размер           | Битовое поле                       | Описание                                                                                                                                                               |
|-------------------|----------------|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 31/63 <br/> | 1 <br/>  | Флаг Ordinal/Name <br/>   | Если этот бит задан, импортируйте по порядковому номеру. В противном случае импортируйте по имени. Бит маскируется как 0x80000000 для формат PE32, 0x8000000000000000 для формат PE32 +. <br/>                         |
| 15-0 <br/>  | 16 <br/> | Порядковый номер <br/>      | 16-разрядный порядковый номер. Это поле используется только в том случае, если битовое поле флага Ordinal/name равно 1 (импорт по порядковому номеру). Биты 30-15 или 62-15 должны быть равны 0. <br/>                  |
| 30-0 <br/>  | 31 <br/> | Имя и RVA таблицы подсказок <br/> | 31-разрядный RVA записи в таблице подсказки или имени. Это поле используется только в том случае, если битовое поле флага Ordinal или Name равно 0 (импорт по имени). Для формат PE32 + BITS 62-31 должно быть равно нулю. <br/> |



 

#### <a name="hintname-table"></a>Указание или таблица имен

Для всего раздела импорта достаточно одной таблицы подсказок или имен. Каждая запись в таблице подсказок или имен имеет следующий формат:



| Offset         | Размер                 | Поле            | Описание                                                                                                                                                                                       |
|----------------|----------------------|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/>        | Указание <br/> | Индекс в таблице указателей имени экспорта. Сначала предпринимается совпадение с этим значением. В случае сбоя двоичный поиск выполняется в таблице указателей имени экспорта библиотеки DLL. <br/>            |
| 2 <br/>  | Переменная <br/> | Имя <br/> | Строка ASCII, содержащая имя для импорта. Это строка, которая должна быть сопоставлена с общедоступным именем в библиотеке DLL. Эта строка чувствительна к регистру и завершается нулевым байтом. <br/> |
| \* <br/> | 0 или 1 <br/>   | Pad <br/>  | Завершающий байт нулевой области, который появляется после завершающего нуль-байта, если это необходимо, для выровнять следующую запись на четной границе. <br/>                                                        |



 

#### <a name="import-address-table"></a>Импорт таблицы адресов

Структура и содержимое таблицы адресов импорта идентичны параметрам таблицы импорта, пока файл не будет привязан. Во время привязки записи в таблице адресов импорта перезаписываются 32-битным (для формат PE32) или 64-bit (для формат PE32 +) импортируемых символов. Эти адреса являются реальными адресами памяти символов, хотя технически они по-прежнему называются "виртуальными адресами". Загрузчик обычно обрабатывает привязку.

### <a name="the-pdata-section"></a>Раздел pdata

Раздел. pData содержит массив записей таблицы функций, которые используются для обработки исключений. На него указывает запись таблицы исключений в каталоге данных Image. Записи должны быть отсортированы в соответствии с адресами функций (первое поле в каждой структуре), прежде чем они будут выдаваться в окончательный образ. Целевая платформа определяет, какой из трех описанных ниже вариантов формата ввода таблицы функций используется.

Для 32-разрядных изображений MIPS записи в таблице функций имеют следующий формат:



| Offset         | Размер          | Поле                          | Описание                                                                    |
|----------------|---------------|--------------------------------|--------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Начальный адрес <br/>      | Значение ва соответствующей функции. <br/>                              |
| 4 <br/>  | 4 <br/> | Конечный адрес <br/>        | Значение ва конца функции. <br/>                                 |
| 8 <br/>  | 4 <br/> | Обработчик исключений <br/>  | Указатель на обработчик исключений, который должен быть выполнен. <br/>               |
| 12 <br/> | 4 <br/> | Данные обработчика <br/>       | Указатель на дополнительные сведения, передаваемые в обработчик. <br/> |
| 16 <br/> | 4 <br/> | Адрес конца пролога <br/> | Значение ва конца пролога функции. <br/>                        |



 

Для платформ ARM, PowerPC, SH3 и SH4 Windows CE элементы таблицы функций имеют следующий формат:



| Offset        | Размер                | Поле                       | Описание                                                                                                               |
|---------------|---------------------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/>       | Начальный адрес <br/>   | Значение ва соответствующей функции. <br/>                                                                         |
| 4 <br/> | 8 бит <br/>  | Длина пролога <br/>   | Количество инструкций в прологе функции. <br/>                                                          |
| 4 <br/> | 22 бита <br/> | Длина функции <br/> | Количество инструкций в функции. <br/>                                                                   |
| 4 <br/> | 1 бит <br/>   | 32-разрядный флаг <br/>     | Если задано, функция состоит из 32-разрядных инструкций. Если ясно, функция состоит из 16-разрядных инструкций. <br/> |
| 4 <br/> | 1 бит <br/>   | Флаг исключения <br/>  | Если этот параметр задан, для функции существует обработчик исключений. В противном случае обработчик исключений не существует. <br/>                 |



 

Для платформ x64 и Itanium записи таблицы функций имеют следующий формат:



| Offset        | Размер          | Поле                          | Описание                                        |
|---------------|---------------|--------------------------------|----------------------------------------------------|
| 0 <br/> | 4 <br/> | Начальный адрес <br/>      | RVA соответствующей функции. <br/> |
| 4 <br/> | 4 <br/> | Конечный адрес <br/>        | RVA конца функции. <br/>    |
| 8 <br/> | 4 <br/> | Сведения о выкрутке <br/> | RVA данных очистки. <br/>     |



 

### <a name="the-reloc-section-image-only"></a>Раздел. reloc (только изображение)

Базовая таблица перемещений содержит записи для всех базовых перемещений в образе. В поле "Базовая таблица перерасположения" в необязательных каталогах данных заголовков выдается число байтов в базовой таблице перемещений. Дополнительные сведения см. в разделе [необязательные каталоги данных заголовков (только для изображений)](#optional-header-data-directories-image-only). Базовая таблица перемещений разделяется на блоки. Каждый блок представляет базовые перемещения для 4-килобайтной страницы. Каждый блок должен начинаться на 32-разрядной границе.

Загрузчик не требуется для обработки базовых перемещений, разрешаемых компоновщиком, если не удается загрузить образ нагрузки в базу изображений, указанную в заголовке PE.

#### <a name="base-relocation-block"></a>Базовый блок перемещения

Каждый базовый блок перемещения начинается со следующей структуры:



| Offset        | Размер          | Поле                  | Описание                                                                                                                                              |
|---------------|---------------|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | RVA страницы <br/>   | База изображения плюс RVA страницы добавляются в каждое смещение, чтобы создать адрес, по которому необходимо применить базовое перемещение. <br/>                         |
| 4 <br/> | 4 <br/> | Размер блока <br/> | Общее число байтов в базовом блоке перемещения, включая RVA страницы и поля размера блока, а также поля типа/смещения, которые следуют за. <br/> |



 

Затем в поле Размер блока следует любое количество записей типа или смещения. Каждая запись имеет слово (2 байта) и имеет следующую структуру:



| Offset        | Размер                | Поле              | Описание                                                                                                                                                                                                            |
|---------------|---------------------|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 бита <br/>  | Тип <br/>   | Значение, которое указывает тип переприменяемого базового расположения, который хранится в 4-разрядном СЛОВе. Дополнительные сведения см. в разделе [базовые типы перемещений](#base-relocation-types).<br/>                         |
| 0 <br/> | 12 бит <br/> | Offset <br/> | Значение, хранящееся в оставшихся 12 битах слова, смещение от начального адреса, указанного в поле RVA страницы для блока. Это смещение указывает, где следует применять базовое перемещение. <br/> |



 

Чтобы применить перемещение в базовом расположении, вычисляется разница между предпочтительным базовым адресом и базой, в которой на самом деле загружено изображение. Если образ загружается в предпочтительной базе, разница равна нулю, поэтому базовые перемещения не нужно применять.

#### <a name="base-relocation-types"></a>Базовые типы перемещений



| Константа                                       | Значение          | Описание                                                                                                                                                                                                                                                                                                                       |
|------------------------------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \_ \_ абсолютный rel на основе образа \_ <br/>        | 0 <br/>  | Перемещение базового расположения пропускается. Этот тип можно использовать для заполнения блока. <br/>                                                                                                                                                                                                                                                 |
| \_высокое изображение \_ на основе rel \_ <br/>            | 1 <br/>  | При перемещении в базовое расположение добавляются старшие 16 бит разности к 16-битовому полю со смещением. 16-разрядное поле представляет верхнее значение 32-разрядного слова. <br/>                                                                                                                                                               |
| ИЗОБРАЖЕНИЕ \_ \_ на основе rel \_ низкого уровня <br/>             | 2 <br/>  | При перемещении в базовое расположение добавляются младшие 16 разрядов разности к 16-битовому полю со смещением. 16-разрядное поле представляет половину 32-разрядного слова. <br/>                                                                                                                                                                  |
| IMAGE \_ rel \_ на основе \_ хигхлов <br/>         | 3 <br/>  | При перемещении базового расположения применяются все 32 бит разности к 32-разрядному полю со смещением. <br/>                                                                                                                                                                                                                              |
| IMAGE \_ rel \_ на основе \_ хигхадж <br/>         | 4 <br/>  | При перемещении в базовое расположение добавляются старшие 16 бит разности к 16-битовому полю со смещением. 16-разрядное поле представляет верхнее значение 32-разрядного слова. Младшие 16 бит 32-разрядного значения хранятся в 16-разрядном слове, которое следует за этим перемещением в базовом расположении. Это означает, что эта базовая перерасположение занимает два слота. <br/> |
| IMAGE \_ rel \_ на \_ основе \_ жмпаддр MIPS <br/>   | 5 <br/>  | Интерпретация перемещения зависит от типа компьютера. <br/> Если тип машины — MIPS, то базовое перемещение применяется к инструкции перехода MIPS. <br/>                                                                                                                                                    |
| Изображение \_ \_ ARM rel на основе образа \_ \_ MOV32 <br/>      | 5 <br/>  | Такое перемещение имеет смысл только в том случае, если тип машины — ARM или Thumb. При перемещении в базовое расположение используется 32-разрядный адрес символа через последовательную пару инструкций МОВВ/МОВТ. <br/>                                                                                                                                 |
| IMAGE \_ rel \_ на основе \_ рискв \_ HIGH20 <br/>   | 5 <br/>  | Это перемещение имеет смысл только в том случае, если тип машины — RISC-V. Базовое перемещение применяется к старшим 20 бит 32-разрядного абсолютного адреса. <br/>                                                                                                                                                                     |
|                                                | 6 <br/>  | Зарезервировано, должно быть равно нулю. <br/>                                                                                                                                                                                                                                                                                               |
| Изображение \_ rel \_ на основе изображения \_ Thumb \_ MOV32 <br/>    | 7 <br/>  | Такое перемещение имеет смысл, только если компьютер имеет тип Thumb. При перемещении базового расположения в последовательную пару инструкций МОВВ/МОВТ применяется 32-разрядный адрес символа. <br/>                                                                                                                                            |
| IMAGE \_ rel \_ на основе \_ рискв \_ LOW12I <br/>   | 7 <br/>  | Это перемещение имеет смысл только в том случае, если тип машины — RISC-V. Базовое перемещение применяется к младшим 12 битам 32-разрядного абсолютного адреса, сформированного в формате ввода-вывода RISC-V. <br/>                                                                                                                           |
| IMAGE \_ rel \_ на основе \_ рискв \_ LOW12S <br/>   | 8 <br/>  | Это перемещение имеет смысл только в том случае, если тип машины — RISC-V. Базовое перемещение применяется к младшим 12 битам 32-разрядного абсолютного адреса, сформированного в формате инструкции RISC-V S-Type. <br/>                                                                                                                           |
| IMAGE \_ rel \_ на \_ основе \_ JMPADDR16 MIPS <br/> | 9 <br/>  | Перемещение имеет смысл только в том случае, если тип машины — MIPS. Базовое перемещение применяется к инструкции перехода MIPS16. <br/>                                                                                                                                                                                            |
| IMAGE \_ rel \_ на основе \_ DIR64 <br/>           | 10 <br/> | При перемещении базового расположения применяется разность к 64-разрядному полю со смещением. <br/>                                                                                                                                                                                                                                             |



 

### <a name="the-tls-section"></a>Раздел. TLS

Раздел. TLS предоставляет поддержку Direct PE и COFF для статического локального потока данных (TLS). TLS — это специальный класс хранения, поддерживаемый Windows, в котором объект данных не является автоматическим (стеком) переменной, но является локальным для каждого отдельного потока, который выполняет код. Таким же, каждый поток может поддерживать другое значение для переменной, объявленной с помощью TLS.

Обратите внимание, что любой объем данных TLS может поддерживаться с помощью API-интерфейсов TlsAlloc, TlsFree, Тлссетвалуе и Тлсжетвалуе. Реализация PE или COFF является альтернативным подходом к использованию API и обладает преимуществом более простым из точек зрения программиста на языке программирования высокого уровня. Эта реализация позволяет определять и инициализировать данные TLS аналогично обычным статическим переменным в программе. Например, в Visual C++ статическая переменная TLS может быть определена следующим образом без использования API Windows:

`__declspec (thread) int tlsFlag = 1;`

Для поддержки этой конструкции программирования в разделе PE и COFF. TLS указаны следующие сведения: данные инициализации, подпрограммы обратного вызова для инициализации и завершения потока, а также индекс TLS, который описан в следующем обсуждении.

> [!Note]
>
> Статически объявленные объекты данных TLS можно использовать только в статически загруженных файлах изображений. Этот факт делает ненадежным использование статических данных TLS в библиотеке DLL, если только вы не уверены, что библиотека DLL или что-либо статическое связывание с ней, никогда не загружается динамически с помощью функции API LoadLibrary.

 

Исполняемый код обращается к статическому объекту данных TLS, выполнив следующие действия:

1.  Во время компоновки компоновщик задает адрес поля индекса каталога TLS. Это поле указывает на расположение, в котором программа должна получить индекс TLS.

    Библиотека времени выполнения Майкрософт упрощает этот процесс, определяя образ памяти для каталога TLS и присвоив ему специальное имя " \_ \_ TLS \_ used" ("протоколы Intel x86") или " \_ TLS \_ used" (другие платформы). Компоновщик ищет этот образ памяти и использует данные для создания каталога TLS. Другие компиляторы, поддерживающие TLS и работающие с компоновщиком Microsoft, должны использовать тот же метод.

2.  При создании потока загрузчик передает адрес массива TLS потока, помещая в регистр FS адрес блока среды потока (ТЕБ). Указатель на массив TLS находится на смещении 0x2C от начала ТЕБ. Это поведение зависит от технологии Intel x86.

3.  Загрузчик присваивает значение индекса TLS месту, указанному в поле адрес поля индекса.

4.  Исполняемый код получает индекс TLS, а также расположение массива TLS.

5.  В коде используется индекс TLS и расположение массива TLS (умножение индекса на 4 и использование его в качестве смещения массива) для получения адреса области данных TLS для заданной программы и модуля. Каждый поток имеет собственную область данных TLS, но она прозрачна для программы, которой не нужно знать, как распределяются данные для отдельных потоков.

6.  Доступ к отдельному объекту данных TLS осуществляется как с фиксированным смещением в области данных TLS.

Массив TLS — это массив адресов, поддерживаемых системой для каждого потока. Каждый адрес в этом массиве указывает расположение данных TLS для заданного модуля (EXE или DLL) в рамках программы. Индекс TLS указывает, какой элемент массива использовать. Индекс — это число (значимое только для системы), идентифицирующее модуль.

#### <a name="the-tls-directory"></a>Каталог TLS

Каталог TLS имеет следующий формат:



| Offset (формат PE32/формат PE32 +) | Размер (формат PE32/формат PE32 +) | Поле                            | Описание                                                                                                                                                                                                                                                                                                                                         |
|----------------------|--------------------|----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>        | 4/8 <br/>    | Начальные данные — начало ва <br/>    | Начальный адрес шаблона TLS. Шаблон — это блок данных, который используется для инициализации данных TLS. Система копирует все эти данные при каждом создании потока, поэтому они не должны быть повреждены. Обратите внимание, что этот адрес не является RVA; Это адрес, для которого должно быть перемещено базовое расположение в разделе. reloc. <br/> |
| 4/8 <br/>      | 4/8 <br/>    | Конечные данные необработанных данных <br/>      | Адрес последнего байта TLS, за исключением нулевой заливки. Как и в случае с полем необработанных данных Start ва, это a, а не RVA. <br/>                                                                                                                                                                                                       |
| 8/16 <br/>     | 4/8 <br/>    | Адрес индекса <br/>     | Расположение для получения индекса TLS, который назначается загрузчиком. Это расположение находится в обычном разделе данных, поэтому ему может быть предоставлено символьное имя, доступное программе. <br/>                                                                                                                                                    |
| 12/24 <br/>    | 4/8 <br/>    | Адрес обратных вызовов <br/> | Указатель на массив функций обратного вызова TLS. Массив завершается нулем, поэтому если функция обратного вызова не поддерживается, это поле указывает на 4 байта, установленное в 0. Дополнительные сведения о прототипе этих функций см. в разделе [функции обратного вызова TLS](#tls-callback-functions).<br/>                                                      |
| 16/32 <br/>    | 4 <br/>      | Нулевой размер заливки <br/>    | Размер в байтах шаблона за пределами инициализированных данных, разделенных полями "начало и конец необработанных данных". Общий размер шаблона должен быть таким же, как общий размер данных TLS в файле образа. Нулевая Заливка — это объем данных, поступающий после инициализированных ненулевых данных. <br/>                            |
| 20/36 <br/>    | 4 <br/>      | Характеристики <br/>      | Четыре бита \[ 23:20 \] описывают сведения о выравнивании. Возможные значения — это параметры, которые определены как \_ Выравнивание уведомления SCN \_ \_ \* , которые также используются для описания выравнивания раздела в объектных файлах. Остальные 28 бит зарезервированы для будущего использования. <br/>                                                                                                       |



 

#### <a name="tls-callback-functions"></a>Функции обратного вызова TLS

Программа может предоставить одну или несколько функций обратного вызова TLS для поддержки дополнительной инициализации и завершения для объектов данных TLS. Типичным применением такой функции обратного вызова является вызов конструкторов и деструкторов для объектов.

Хотя обычно существует не более одной функции обратного вызова, обратный вызов реализуется как массив, что позволяет добавлять дополнительные функции обратного вызова при необходимости. Если имеется несколько функций обратного вызова, каждая функция вызывается в том порядке, в котором его адрес отображается в массиве. Пустой указатель завершает массив. Вполне допустимо иметь пустой список (обратный вызов не поддерживается). в этом случае массив обратного вызова содержит только один элемент — пустой указатель.

Прототип функции обратного вызова (на который указывает указатель типа \_ callback пимаже TLS \_ ) имеет те же параметры, что и функция точки входа DLL:


```C++
typedef VOID
(NTAPI *PIMAGE_TLS_CALLBACK) (
    PVOID DllHandle,
    DWORD Reason,
    PVOID Reserved
    );
```



Зарезервированный параметр должен иметь значение 0. Параметр Reason может принимать следующие значения:



| Параметр                          | Значение         | Описание                                                                                          |
|----------------------------------|---------------|------------------------------------------------------------------------------------------------------|
| \_Подключение к ПРОЦЕССУ DLL \_ <br/> | 1 <br/> | Начат новый процесс, включая первый поток. <br/>                                   |
| \_подключение потока \_ DLL <br/>  | 2 <br/> | Создан новый поток. Это уведомление отправлено для всех потоков, кроме первого. <br/>      |
| \_Отключение потока \_ DLL <br/>  | 3 <br/> | Поток собирается завершиться. Это уведомление отправлено для всех потоков, кроме первого. <br/> |
| \_отсоединение процесса DLL \_ <br/> | 0 <br/> | Процесс собирается завершиться, включая исходный поток. <br/>                          |



 

### <a name="the-load-configuration-structure-image-only"></a>Структура конфигурации загрузки (только для образа)

Структура конфигурации загрузки ( \_ Каталог загрузки образа \_ \_ ) ранее использовалась в самых ограниченных случаях в самой операционной системе Windows NT для описания различных функций, которые слишком сложны или слишком велики для описания в заголовке файла или необязательном заголовке изображения. Текущие версии Microsoft компоновщика и Windows XP и более поздних версий Windows используют новую версию этой структуры для 32-разрядных систем на базе x86, которые включают в себя зарезервированную технологию SEH. Это предоставляет список надежных обработчиков структурированных исключений, которые операционная система использует во время диспетчеризации исключений. Если адрес обработчика находится в диапазоне адресов изображения и помечен как зарезервированный с учетом SEH (т. е. IMAGE \_ DLLCHARACTERISTICS \_ без \_ SEH в поле DLLCHARACTERISTICS необязательного заголовка, как описано выше), обработчик должен находиться в списке известных безнадежных обработчиков для этого образа. В противном случае операционная система завершит работу приложения. Это помогает предотвратить использование эксплойта "захвата обработчика исключений x86", который использовался в прошлом для получения контроля над операционной системой.

Компоновщик Microsoft автоматически предоставляет стандартную структуру конфигурации загрузки для включения зарезервированных данных SEH. Если пользовательский код уже содержит структуру конфигурации загрузки, он должен включать новые зарезервированные поля SEH. В противном случае компоновщик не может включать зарезервированные данные SEH, а изображение не помечено как содержащее зарезервированный SEH.

#### <a name="load-configuration-directory"></a>Загрузить каталог конфигурации

Запись каталога данных для предварительно зарезервированной структуры конфигурации SEH должна указывать определенный размер структуры конфигурации нагрузки, так как загрузчик операционной системы всегда ожидает, что он является определенным значением. В этом отношении размер фактически является только проверка версии. Для совместимости с Windows XP и более ранними версиями Windows размер должен быть 64 для образов x86.

#### <a name="load-configuration-layout"></a>Загрузить макет конфигурации

Структура конфигурации загрузки имеет следующий макет для 32-разрядных и 64-разрядных файлов PE:



| Offset              | Размер            | Поле                                      | Описание                                                                                                                                                                                                                                                                                 |
|---------------------|-----------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>       | 4 <br/>   | Характеристики <br/>                | Флаги, указывающие атрибуты файла, в настоящее время не используемые. <br/>                                                                                                                                                                                                                   |
| 4 <br/>       | 4 <br/>   | тимедатестамп <br/>                  | Значение даты и метки времени. Значение представлено в секундах, прошедших с полуночи (00:00:00), 1 января 1970, Универсальное координированное время в соответствии с системными часами. Отметка времени может быть распечатана с помощью функции времени выполнения C (CRT). <br/> |
| 8 <br/>       | 2 <br/>   | MajorVersion <br/>                   | Основной номер версии. <br/>                                                                                                                                                                                                                                                           |
| 10 <br/>      | 2 <br/>   | MinorVersion <br/>                   | Дополнительный номер версии. <br/>                                                                                                                                                                                                                                                           |
| 12 <br/>      | 4 <br/>   | глобалфлагсклеар <br/>               | Глобальные флаги загрузчика, которые необходимо очистить для этого процесса, так как загрузчик запускает процесс. <br/>                                                                                                                                                                                             |
| 16 <br/>      | 4 <br/>   | глобалфлагссет <br/>                 | Глобальные флаги загрузчика, которые устанавливаются для этого процесса, когда загрузчик запускает процесс. <br/>                                                                                                                                                                                               |
| 20 <br/>      | 4 <br/>   | критикалсектиондефаулттимеаут <br/>  | Значение времени ожидания по умолчанию, используемое для критических секций этого процесса, которые отброшены. <br/>                                                                                                                                                                                       |
| 24 <br/>      | 4/8 <br/> | декоммитфриблокксрешолд <br/>     | Память, которая должна быть освобождена перед возвращением в систему в байтах. <br/>                                                                                                                                                                                                        |
| 28/32 <br/>   | 4/8 <br/> | декоммиттоталфрисрешолд <br/>     | Общий объем свободной памяти в байтах. <br/>                                                                                                                                                                                                                                          |
| 32/40 <br/>   | 4/8 <br/> | локкпрефикстабле <br/>                | \[x86 только \] список адресов, где используется префикс блокировки, чтобы их можно было заменить на NOP на компьютерах с одним процессором. <br/>                                                                                                                                    |
| 36/48 <br/>   | 4/8 <br/> | максимумаллокатионсизе <br/>          | Максимальный размер выделения в байтах. <br/>                                                                                                                                                                                                                                              |
| 40/56 <br/>   | 4/8 <br/> | виртуалмеморисрешолд <br/>         | Максимальный размер виртуальной памяти в байтах. <br/>                                                                                                                                                                                                                                          |
| 44/64 <br/>   | 4/8 <br/> | процессаффинитимаск <br/>            | Установка этого поля в ненулевое значение эквивалентно вызову Сетпроцессаффинитимаск с этим значением во время запуска процесса (только exe) <br/>                                                                                                                                       |
| 48/72 <br/>   | 4 <br/>   | процесшеапфлагс <br/>               | Обработка флагов кучи, соответствующих первому аргументу функции Хеапкреате. Эти флаги применяются к куче процесса, созданной во время запуска процесса. <br/>                                                                                                              |
| 52/76 <br/>   | 2 <br/>   | CSDVersion <br/>                     | Идентификатор версии пакета обновления. <br/>                                                                                                                                                                                                                                            |
| 54/78 <br/>   | 2 <br/>   | Зарезервировано <br/>                       | Должен равняться нулю. <br/>                                                                                                                                                                                                                                                                   |
| 56/80 <br/>   | 4/8 <br/> | едитлист <br/>                       | Зарезервировано для использования системой. <br/>                                                                                                                                                                                                                                                 |
| 60/88 <br/>   | 4/8 <br/> | секуритикукие <br/>                 | Указатель на файл cookie, который используется реализацией Visual C++ или GS. <br/>                                                                                                                                                                                                          |
| 64/96 <br/>   | 4/8 <br/> | сехандлертабле <br/>                 | \[Архитектура x86 для \] каждого допустимого уникального обработчика SE в изображении имеет только то, что имеет значение по отношению к отсортированной таблице RVA. <br/>                                                                                                                                                                                  |
| 68/104 <br/>  | 4/8 <br/> | сехандлеркаунт <br/>                 | \[x86 \] количество уникальных обработчиков в таблице. <br/>                                                                                                                                                                                                                         |
| 72/112 <br/>  | 4/8 <br/> | гуардкфчеккфунктионпоинтер <br/>    | Элемент ва, где хранится контрольный указатель функции потока управления. <br/>                                                                                                                                                                                                               |
| 76/120 <br/>  | 4/8 <br/> | гуардкфдиспатчфунктионпоинтер <br/> | Объект ва, где хранится указатель функции диспетчера потока управления. <br/>                                                                                                                                                                                                            |
| 80/128 <br/>  | 4/8 <br/> | гуардкффунктионтабле <br/>           | Порядок сортировки отсортированной таблицы по RVA для каждой функции контроля потока управления в изображении. <br/>                                                                                                                                                                                            |
| 84/136 <br/>  | 4/8 <br/> | гуардкффунктионкаунт <br/>           | Число уникальных RVA в таблице выше. <br/>                                                                                                                                                                                                                                    |
| 88/144 <br/>  | 4 <br/>   | гуардфлагс <br/>                     | Флаги, связанные с защитой потока управления. <br/>                                                                                                                                                                                                                                               |
| 92/148 <br/>  | 12 <br/>  | CodeIntegrity <br/>                  | Сведения о целостности кода. <br/>                                                                                                                                                                                                                                                     |
| 104/160 <br/> | 4/8 <br/> | гуардаддресстакениатентритабле <br/> | Адрес, по которому хранится Address Guard в потоке управления для таблицы IAT. <br/>                                                                                                                                                                                                              |
| 108/168 <br/> | 4/8 <br/> | гуардаддресстакениатентрикаунт <br/> | Число уникальных RVA в таблице выше. <br/>                                                                                                                                                                                                                                    |
| 112/176 <br/> | 4/8 <br/> | гуардлонгжумптаржеттабле <br/>       | Адрес, где хранится Целевая таблица с длинным переходом в потоке управления. <br/>                                                                                                                                                                                                               |
| 116/184 <br/> | 4/8 <br/> | гуардлонгжумптаржеткаунт <br/>       | Число уникальных RVA в таблице выше. <br/>                                                                                                                                                                                                                                    |



 

Поле Гуардфлагс содержит сочетание одного или нескольких из следующих флагов и подполей:

-   Модуль выполняет проверку целостности потока управления с помощью поддерживаемой системой поддержки.

    ` #define IMAGE_GUARD_CF_INSTRUMENTED  0x00000100`

-   Модуль выполняет поток управления и записывает проверки целостности.

    ` #define IMAGE_GUARD_CFW_INSTRUMENTED  0x00000200`

-   Модуль содержит допустимые метаданные целевого объекта потока управления.

    `#define IMAGE_GUARD_CF_FUNCTION_TABLE_PRESENT  0x00000400`

-   Модуль не использует файл cookie безопасности/GS.

    ` #define IMAGE_GUARD_SECURITY_COOKIE_UNUSED  0x00000800`

-   Модуль поддерживает нагрузку с задержкой только для чтения.

    `#define IMAGE_GUARD_PROTECT_DELAYLOAD_IAT  0x00001000`

-   У импортируйте таблицу в собственную секцию. Дидат (без каких-либо изменений), которую можно свободно повторно защитить.

    ` #define IMAGE_GUARD_DELAYLOAD_IAT_IN_ITS_OWN_SECTION  0x00002000`

-   Модуль содержит подавленные данные экспорта. Это также определяет, что адрес, поступающий из таблицы IAT, также содержится в конфигурации Load.

    `#define  IMAGE_GUARD_CF_EXPORT_SUPPRESSION_INFO_PRESENT  0x00004000`

-   Модуль включает подавление экспортов.

    `#define IMAGE_GUARD_CF_ENABLE_EXPORT_SUPPRESSION  0x00008000`

-   Модуль содержит сведения о целевом longjmp.

    ` #define IMAGE_GUARD_CF_LONGJUMP_TABLE_PRESENT  0x00010000`

-   Маска для вложенного поля, содержащего шаг элементов таблицы функции Guard в потоке управления (то есть дополнительное количество байтов на запись таблицы).

    ` #define IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_MASK  0xF0000000`

Кроме того, заголовок Windows SDK Winnt. h определяет этот макрос на величину сдвига вправо значения Гуардфлагс для выравнивания по правому краю таблицы функции Guard в потоке управления. шаг:

` #define IMAGE_GUARD_CF_FUNCTION_TABLE_SIZE_SHIFT  28`

### <a name="the-rsrc-section"></a>Раздел. rsrc

Ресурсы индексируются по структуре дерева, отсортированной в двоичном виде. Общая структура может включать 2 \* \* 31 уровня. Однако в соответствии с соглашением Windows использует три уровня:

<dl> Тип  
Имя  
Язык  
</dl>

Ряд таблиц каталога ресурсов связывается со всеми уровнями следующим образом: каждой таблице каталога следует ряд записей каталога, которые предоставляют имя или идентификатор (идентификатор) для этого уровня (тип, имя или уровень языка) и адрес либо описания данных, либо другой таблицы каталога. Если адрес указывает на описание данных, то данные являются листом дерева. Если адрес указывает на другую таблицу каталога, то эта таблица перечисляет записи каталога на следующем уровне вниз.

Тип конечного объекта, имя и идентификатор языка определяются путем, который используется для доступа к листу таблиц каталогов. Первая таблица определяет идентификатор типа, вторая таблица (на которую указывает запись каталога в первой таблице) определяет идентификатор имени, а третья таблица определяет идентификатор языка.

Общая структура раздела. rsrc:



| Данные                                                                   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Таблицы каталога ресурсов (и записи каталога ресурсов) <br/> | Последовательность таблиц, по одной для каждой группы узлов в дереве. Все узлы верхнего уровня (тип) перечислены в первой таблице. Записи в этой таблице указывают на таблицы второго уровня. Каждое дерево второго уровня имеет одинаковый идентификатор типа, но разные идентификаторы имен. Деревья третьего уровня имеют одинаковые идентификаторы типа и имени, но разные идентификаторы языка. <br/> За каждой отдельной таблицей сразу следуют записи каталога, в которых каждая запись имеет имя или числовой идентификатор, а также указатель на описание данных или таблицу на следующем более низком уровне. <br/> |
| Строки каталога ресурсов <br/>                                 | Строки в Юникоде с поддержкой двух байтов, которые служат в качестве строковых данных, на которые указывает запись каталога. <br/>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Описание данных ресурса <br/>                                  | Массив записей, на который указывают таблицы, которые описывают фактический размер и расположение данных ресурса. Эти записи являются листьями в дереве описания ресурсов. <br/>                                                                                                                                                                                                                                                                                                                                                                |
| Данные ресурсов <br/>                                              | Необработанные данные раздела ресурса. Сведения о размере и расположении в поле описания данных ресурса разделяют отдельные области данных ресурсов. <br/>                                                                                                                                                                                                                                                                                                                                                                              |



 

#### <a name="resource-directory-table"></a>Таблица каталога ресурсов

Каждая таблица каталога ресурсов имеет следующий формат. Эта структура данных должна рассматриваться как заголовок таблицы, так как таблица на самом деле состоит из записей каталога (описанных в разделе 6.9.2, «записи каталога ресурсов») и этой структуры:



| Offset         | Размер          | Поле                              | Описание                                                                                                                                                                     |
|----------------|---------------|------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | Характеристики <br/>        | Флаги ресурсов. Это поле зарезервировано для использования в будущем. В настоящее время установлено нулевое значение. <br/>                                                                                 |
| 4 <br/>  | 4 <br/> | Метка времени и даты <br/>        | Время создания данных ресурса компилятором ресурсов. <br/>                                                                                               |
| 8 <br/>  | 2 <br/> | Основная версия <br/>          | Основной номер версии, заданный пользователем. <br/>                                                                                                                          |
| 10 <br/> | 2 <br/> | Вспомогательная версия <br/>          | Дополнительный номер версии, заданный пользователем. <br/>                                                                                                                          |
| 12 <br/> | 2 <br/> | Число записей имени <br/> | Число записей каталога, сразу следующего за таблицей, в которой используются строки для поиска типа, имени или записей языка (в зависимости от уровня таблицы). <br/> |
| 14 <br/> | 2 <br/> | Число записей ИДЕНТИФИКАТОРов <br/>   | Число записей каталога, сразу следующих за записями имен, которые используют числовые идентификаторы для записей типа, имени или языка. <br/>                                    |



 

#### <a name="resource-directory-entries"></a>Записи каталога ресурсов

Записи каталога составляют строки таблицы. Каждая запись каталога ресурсов имеет следующий формат. Указывает, что запись является записью имени или идентификатора, указывается таблицей каталога ресурсов, которая показывает, сколько записей имен и ИДЕНТИФИКАТОРов следует за ним (Помните, что все записи имен предшествуют всем записям ИДЕНТИФИКАТОРов для таблицы). Все записи для таблицы сортируются в возрастающем порядке: имена записываются в виде строки с учетом регистра и записей ИДЕНТИФИКАТОРов по числовому значению. Смещения задаются относительно адреса в подкаталоге \_ \_ ресурсов записи каталога образа \_ . Дополнительные сведения см. в разделе [пиринг в PE. Краткий обзор формата переносимого исполняемого файла Win32](/previous-versions/ms809762(v=msdn.10)#pe-file-resources) .



| Offset        | Размер          | Поле                           | Описание                                                                                                          |
|---------------|---------------|---------------------------------|----------------------------------------------------------------------------------------------------------------------|
| 0 <br/> | 4 <br/> | Смещение имени <br/>         | Смещение строки, которая предоставляет запись типа, имени или идентификатора языка в зависимости от уровня таблицы. <br/>     |
| 0 <br/> | 4 <br/> | Целочисленный идентификатор <br/>          | 32-разрядное целое число, определяющее тип, имя или идентификатор языка. <br/>                                   |
| 4 <br/> | 4 <br/> | Смещение ввода данных <br/>   | Старший бит 0. Адрес записи данных ресурса (конечный). <br/>                                                   |
| 4 <br/> | 4 <br/> | Смещение подкаталога <br/> | Высокий бит 1. Младшие 31 бита — адрес другой таблицы каталога ресурсов (следующий уровень ниже). <br/> |



 

#### <a name="resource-directory-string"></a>Строка каталога ресурсов

Область строк каталога ресурсов состоит из строк Юникода, которые вычисляются по словам. Эти строки хранятся вместе с последней записью каталога ресурсов и перед первой записью данных ресурса. Это снизит влияние этих строк переменной длины на выравнивание записей каталога фиксированного размера. Каждая строка каталога ресурсов имеет следующий формат:



| Offset        | Размер                 | Поле                      | Описание                                                            |
|---------------|----------------------|----------------------------|------------------------------------------------------------------------|
| 0 <br/> | 2 <br/>        | Длина <br/>         | Размер строки, не включая поле Length. <br/> |
| 2 <br/> | Переменная <br/> | Строка в Юникоде <br/> | Символьные данные переменной длины в Юникоде, с выведением по словам. <br/>     |



 

#### <a name="resource-data-entry"></a>Ввод данных ресурса

Каждая запись данных ресурса описывает фактическую единицу необработанных данных в области данных ресурса. Запись данных ресурса имеет следующий формат:



| Offset         | Размер          | Поле                            | Описание                                                                                                                                           |
|----------------|---------------|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/> | RVA данных <br/>             | Адрес единицы данных ресурса в области данных ресурса. <br/>                                                                         |
| 4 <br/>  | 4 <br/> | Размер <br/>                 | Размер (в байтах) данных ресурса, на который указывает поле RVA данных. <br/>                                                        |
| 8 <br/>  | 4 <br/> | codepage <br/>             | Кодовая страница, используемая для декодирования значений кодовых точек в данных ресурсов. Как правило, кодовая страница будет кодовой страницей Юникода. <br/> |
| 12 <br/> | 4 <br/> | Зарезервировано, должно быть равно 0. <br/> |                                                                                                                                                       |



 

### <a name="the-cormeta-section-object-only"></a>Раздел. кормета (только объект)

Метаданные CLR хранятся в этом разделе. Он используется для указания того, что объектный файл содержит управляемый код. Формат метаданных не документирован, но может быть передан интерфейсам CLR для обработки метаданных.

### <a name="the-sxdata-section"></a>Раздел. сксдата

Допустимые обработчики исключений объекта перечислены в разделе **сксдата** этого объекта. Раздел помечен как IMAGE \_ SCN \_ LNK \_ info. Он содержит индекс символов COFF каждого допустимого обработчика, используя 4 байта на индекс.

Кроме того, компилятор помечает объект COFF как зарегистрированный SEH путем порождения абсолютного символа " @feat.00 " с ЛСБ поля значения, установленного в значение 1. Объект COFF без зарегистрированных обработчиков SEH будет иметь @feat.00 символ "", но не раздел **сксдата** .

## <a name="archive-library-file-format"></a>Формат файла архива (библиотеки)

- [Подпись файла архива](#archive-file-signature)
- [Заархивировать заголовки элементов](#archive-member-headers)
- [Первый член компоновщика](#first-linker-member)
- [Второй элемент компоновщика](#second-linker-member)
- [Лонгнамес, элемент](#longnames-member)

Формат архива COFF предоставляет стандартный механизм для хранения коллекций объектных файлов. Эти коллекции обычно называются библиотеками в документации по программированию.

Первые 8 байт архива состоят из подписи файла. Остальная часть архива состоит из ряда членов архива, как показано ниже.

-   Первый и второй члены — "члены компоновщика". Каждый из этих членов имеет собственный формат, как описано в разделе [тип имени импорта](#import-name-type). Как правило, Компоновщик помещает информацию в эти элементы архива. Члены компоновщика содержат каталог архива.

-   Третьим элементом является элемент «лонгнамес». Этот необязательный элемент состоит из ряда строк ASCII, завершающихся нулем, в которых каждая строка является именем другого элемента архива.

-   Остальная часть архива состоит из стандартных (объектно-файловых) членов. Каждый из этих членов содержит содержимое одного объектного файла целиком.

Заголовок элемента архива предшествует каждому элементу. В следующем списке показана общая структура архива.

-   Сигнатура: "! &lt; Дуга &gt; \\ n "
-   Заголовок

    <dl> Первый член-компоновщик  
    </dl>

-   Заголовок

    <dl> второй член-компоновщик  
    </dl>

-   Заголовок

    <dl> Лонгнамес, элемент  
    </dl>

-   Заголовок

    <dl> Содержимое OBJ-файла 1  
    (Формат COFF)  
    </dl>

-   Заголовок

    <dl> Содержимое файла OBJ 2  
    (Формат COFF)  
    </dl>

### <a name="archive-file-signature"></a>Подпись файла архива

Подпись файла архива определяет тип файла. Любая служебная программа (например, компоновщик), которая принимает файл архива в качестве входных данных, может проверить тип файла, прочитав эту подпись. Сигнатура состоит из следующих символов ASCII, в которых каждый символ представлен буквально, за исключением символа новой строки ( \\ n):

`!<arch>\n`

### <a name="archive-member-headers"></a>Заархивировать заголовки элементов

Каждому элементу (компоновщику, лонгнамес или элементу объекта-файла) предшествует заголовок. Заголовок элемента архива имеет следующий формат, в котором каждое поле представляет собой текстовую строку ASCII, выровненную по левому краю и дополненную пробелами до конца поля. В этих полях нет завершающего нуль-символа.

Заголовок каждого члена начинается на первом четном адресе после конца предыдущего элемента архива.



| Offset         | Размер           | Поле                     | Описание                                                                                                                                                                                                 |
|----------------|----------------|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 16 <br/> | Имя <br/>          | Имя элемента архива с добавленной косой чертой (/) для завершения имени. Если первый символ является косой чертой, то имя имеет специальную интерпретацию, как описано в следующей таблице. <br/> |
| 16 <br/> | 12 <br/> | Дата <br/>          | Дата и время создания элемента архива: это десятичное представление ASCII с момента 1/1/1970 продукта, равное количеству секунд. <br/>                                                    |
| 28 <br/> | 6 <br/>  | User ID <br/>       | Десятичное представление идентификатора пользователя в формате ASCII. Это поле не содержит осмысленного значения на платформах Windows, так как средства Майкрософт выдают все пробелы. <br/>                                    |
| 34 <br/> | 6 <br/>  | Идентификатор группы. <br/>      | Десятичное представление идентификатора группы в формате ASCII. Это поле не содержит осмысленного значения на платформах Windows, так как средства Майкрософт выдают все пробелы. <br/>                                   |
| 40 <br/> | 8 <br/>  | Режим <br/>          | Восьмеричное представление файла в формате ASCII. Это \_ значение режима St из функции времени выполнения C \_ встат. <br/>                                                                       |
| 48 <br/> | 10 <br/> | Размер <br/>          | Десятичное представление общего размера элемента архива в формате ASCII, не включая размер заголовка. <br/>                                                                                  |
| 58 <br/> | 2 <br/>  | Конец заголовка <br/> | Два байта в строке C "̃ \\ n" (0X60 0x0A). <br/>                                                                                                                                               |



 

Поле имени имеет один из форматов, приведенных в следующей таблице. Как упоминалось ранее, каждая из этих строк выравнивается по левому краю и дополняется конечными пробелами в поле 16 байт:



| Содержимое поля имени | Описание                                                                                                                                                                                                                                                                                          |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| безымян <br/>      | Имя элемента архива. <br/>                                                                                                                                                                                                                                                          |
| / <br/>          | Член архива является одним из двух членов компоновщика. Оба члена компоновщика имеют это имя. <br/>                                                                                                                                                                                          |
| // <br/>         | Элемент Archive является членом лонгнамес, который состоит из ряда строк ASCII, завершающихся нулем. Член лонгнамес является третьим элементом архива и является необязательным. <br/>                                                                     |
| /n <br/>         | Имя элемента архива находится в смещении n в пределах элемента лонгнамес. Число n представляет собой десятичное представление смещения. Например, "/26" означает, что имя элемента архива находится в расположении 26 байт после начала содержимого элемента лонгнамес. <br/> |



 

### <a name="first-linker-member"></a>Первый член компоновщика

Имя первого члена-компоновщика — "/". Первый член-компоновщик включен для обеспечения обратной совместимости. Он не используется текущими компоновщиками, но его формат должен быть правильным. Этот элемент компоновщика предоставляет каталог имен символов, как и второй член-компоновщик. Для каждого символа информация указывает, где найти элемент архива, содержащий символ.

Первый элемент компоновщика имеет следующий формат. Эти сведения отображаются после заголовка:



| Offset         | Размер               | Поле                         | Описание                                                                                                                                                                                                                                                                                                                                                        |
|----------------|--------------------|-------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/>      | Число символов <br/> | Длинное целое число без знака, содержащее количество индексированных символов. Это число хранится в формате с обратным порядком байтов. Каждый член объекта File обычно определяет один или несколько внешних символов. <br/>                                                                                                                                                                         |
| 4 <br/>  | 4 \* n <br/> | Смещения <br/>           | Массив смещений файлов для заголовков элементов архива, в которых n равно значению поля "число символов". Каждое число в массиве является беззнаковым длинным и хранится в формате с обратным порядком байтов. Для каждого символа, названного в таблице строк, соответствующий элемент в массиве смещений предоставляет расположение элемента архива, содержащего символ. <br/> |
| \* <br/> | \* <br/>     | Таблица строк <br/>      | Ряд строк, заканчивающихся нулем, которые наименают все символы в каталоге. Каждая строка начинается сразу после символа NULL в предыдущей строке. Число строк должно быть равно значению поля "число символов". <br/>                                                                                                       |



 

Элементы в массиве смещений должны быть упорядочены в возрастающем порядке. Этот факт подразумевает, что символы в таблице строк должны быть упорядочены в соответствии с порядком элементов архива. Например, все символы в первом элементе Object-File должны быть перечислены перед символами во втором объектном файле.

### <a name="second-linker-member"></a>Второй элемент компоновщика

Второй элемент компоновщика имеет имя "/", как и первый член-компоновщик. Хотя оба члена-компоновщика предоставляют каталог символов и архивные элементы, которые их содержат, второй элемент-компоновщик используется в предпочтениях к первому из всех текущих компоновщиков. Второй элемент компоновщика включает имена символов в лексической последовательности, что позволяет ускорить поиск по имени.

Второй элемент имеет следующий формат. Эти сведения отображаются после заголовка:



| Offset         | Размер               | Поле                         | Описание                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------|--------------------|-------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 4 <br/>      | Число элементов <br/> | Длинное целое число без знака, содержащее количество элементов архива. <br/>                                                                                                                                                                                                                                                                                                                                |
| 4 <br/>  | 4 \* м <br/> | Смещения <br/>           | Массив смещений файлов для архивации заголовков элементов, упорядоченный в порядке возрастания. Каждое смещение имеет длину без знака. Число m равно значению поля число членов. <br/>                                                                                                                                                                                                        |
| \* <br/> | 4 <br/>      | Число символов <br/> | Длинное целое число без знака, содержащее количество индексируемых символов. Каждый член объекта File обычно определяет один или несколько внешних символов. <br/>                                                                                                                                                                                                                                                        |
| \* <br/> | 2 \* n <br/> | Увеличивают <br/>           | Массив индексов на основе 1 (неподписанный короткий), которые сопоставляют имена символов с смещениями элементов архива. Число n равно значению поля "число символов". Для каждого символа, названного в таблице строк, соответствующий элемент в массиве индексов предоставляет индекс в массиве смещений. Массив смещений, в свою очередь, предоставляет расположение элемента архива, содержащего символ. <br/> |
| \* <br/> | \* <br/>     | Таблица строк <br/>      | Ряд строк, заканчивающихся нулем, которые наименают все символы в каталоге. Каждая строка начинается сразу после нулевого байта в предыдущей строке. Число строк должно быть равно значению поля "число символов". В этой таблице перечислены все имена символов в порядке возрастания лексического порядка. <br/>                                                                             |



 

### <a name="longnames-member"></a>Лонгнамес, элемент

Имя элемента лонгнамес — "//". Элемент лонгнамес представляет собой последовательность строк имен элементов архива. Имя отображается здесь только в том случае, если в поле имени недостаточно места (16 байт). Элемент лонгнамес является необязательным. Она может быть пустой только с заголовком или полностью отсутствовать даже в заголовке.

Строки завершаются нулем. Каждая строка начинается сразу после нулевого байта в предыдущей строке.

## <a name="import-library-format"></a>Формат импорта библиотеки

- [Импорт заголовка](#import-header)
- [Тип импорта](#import-type)

Традиционные библиотеки импорта, то есть библиотеки, которые описывают экспорты из одного изображения для использования другим, обычно следуют разметке, описанной в разделе 7, [Формат файла архива (библиотека)](#archive-library-file-format). Основное различие заключается в том, что элементы библиотеки импорта содержат файлы псевдо-Object, а не реальные, в котором каждый элемент включает вклады раздела, необходимые для построения таблиц импорта, описанных в разделе 6,4, в [разделе иДата](#the-idata-section) компоновщик создает этот архив при сборке приложения экспорта.

Разделы, посвященные импорту, можно вывести из небольшого набора данных. Компоновщик может либо создать полную подробную информацию в библиотеке импорта для каждого элемента во время создания библиотеки, либо записать только каноническую информацию в библиотеку и позволить приложению, которое позже использует его, создавать необходимые данные на лету.

В библиотеке импорта с длинным форматом один элемент содержит следующие сведения:

<dl> Заголовок элемента архива  
Заголовок файла  
Заголовки разделов  
Данные, соответствующие каждому из заголовков разделов  
Таблица символов COFF  
Строки  
  
</dl>

В отличие от этого, короткая библиотека импорта записывается следующим образом:

<dl> Заголовок элемента архива  
Импорт заголовка  
Строка имени импорта, завершающаяся нулем  
Строка имени DLL, заканчивающаяся нулем  
</dl>

Это достаточно для того, чтобы точно восстановить все содержимое элемента во время его использования.

### <a name="import-header"></a>Импорт заголовка

Заголовок import содержит следующие поля и смещения:



| Offset         | Размер                | Поле                       | Описание                                                                                                                  |
|----------------|---------------------|-----------------------------|------------------------------------------------------------------------------------------------------------------------------|
| 0 <br/>  | 2 <br/>       | Sig1 <br/>            | Должно быть \_ \_ \_ неизвестным файл образа компьютера. Дополнительные сведения см. в разделе [типы компьютеров](#machine-types). <br/>                |
| 2 <br/>  | 2 <br/>       | Sig2 <br/>            | Должно быть 0xFFFF. <br/>                                                                                                  |
| 4 <br/>  | 2 <br/>       | Версия <br/>         | Версия структуры. <br/>                                                                                           |
| 6 <br/>  | 2 <br/>       | Компьютер <br/>         | Число, идентифицирующее тип целевого компьютера. Дополнительные сведения см. в разделе [типы компьютеров](#machine-types).<br/> |
| 8 <br/>  | 4 <br/>       | Отметка Time-Date <br/> | Время и Дата создания файла. <br/>                                                                     |
| 12 <br/> | 4 <br/>       | Размер данных <br/>    | Размер строк, следующих за заголовком. <br/>                                                                  |
| 16 <br/> | 2 <br/>       | Порядковый номер/указание <br/>    | Либо порядковый номер, либо указание для импорта, определяемое значением в поле Тип имени. <br/>                   |
| 18 <br/> | 2 бита <br/>  | Тип <br/>            | Тип импорта. Конкретные значения и описания см. в разделе [Тип импорта](#import-type).<br/>                           |
|                | 3 бита <br/>  | Тип имени <br/>       | Тип имени импорта. Дополнительные сведения см. в разделе [тип имени для импорта](#import-name-type). <br/>                           |
|                | 11 бит <br/> | Зарезервировано <br/>        | Зарезервировано, должно быть равно 0. <br/>                                                                                             |



 

За этой структурой следуют две строки, заканчивающиеся нулем, которые описывают имя импортированного символа и библиотеку DLL, из которой он пришел.

### <a name="import-type"></a>Тип импорта

Для поля Type в заголовке импорта определены следующие значения:

| Константа                  | Значение         | Описание                                      |
|---------------------------|---------------|--------------------------------------------------|
| ИМПОРТИРОВАТЬ \_ код <br/>  | 0 <br/> | Исполняемый код. <br/>                     |
| Импорт \_ данных <br/>  | 1 <br/> | Данные. <br/>                                |
| Импорт \_ const <br/> | 2 <br/> | Указывается как CONST в DEF файле. <br/> |

Эти значения используются для определения того, какие вклады разделов должны создаваться средством, использующим библиотеку, если они должны обращаться к этим данным.

### <a name="import-name-type"></a>Тип имени импорта

Имя символа импорта, заканчивающееся символом NULL, следует непосредственно за соответствующим заголовком импорта. Следующие значения определены для поля имя типа в заголовке импорта. Они указывают, как имя используется для создания правильных символов, представляющих импорт:

| Константа | Значение | Описание |
| - | - | - |
| \_порядковый номер импорта | 0 | Импорт по порядковому номеру. Это означает, что значение в поле Ordinal/хинтинга заголовка import является порядковым номером импорта. Если эта константа не указана, поле Ordinal/хинтинга всегда должно интерпретироваться как указание импорта. |
| \_имя импорта | 1 | Имя импорта идентично имени общедоступного символа. |
| \_префикс имени для импорта \_ | 2 | Имя импорта — это имя общедоступного символа, но пропускается начальное значение?, @ или (необязательно) \_ . |
| Импорт \_ имени для \_ расоформления | 3 | Имя импорта — это имя общедоступного символа, но пропускается начальное значение?, @ или при необходимости \_ и усекается в первом @ . |

## <a name="appendix-a-calculating-authenticode-pe-image-hash"></a>Приложение а. вычисление хэша образа среды предустановки Authenticode

- [Что такое хэш образа среды предустановки Authenticode?](#what-is-an-authenticode-pe-image-hash)
- [Что рассматривается в хэш-коде образа Authenticode PE?](#what-is-covered-in-an-authenticode-pe-image-hash)

Предполагается, что для проверки целостности образов используются несколько сертификатов атрибутов. Однако наиболее распространенной является подпись Authenticode. Подпись Authenticode можно использовать для проверки того, что соответствующие разделы файла образа PE не были изменены каким-либо образом из исходной формы файла. Для выполнения этой задачи подписи Authenticode содержат нечто, называемое хэшем образа PE

### <a name="what-is-an-authenticode-pe-image-hash"></a>Что такое хэш образа среды предустановки Authenticode?

Хэш образа Authenticode PE или файловый хэш для коротких файлов аналогичен контрольной сумме файла в том, что он создает небольшое значение, связанное с целостностью файла. Контрольная сумма создается простым алгоритмом и используется в основном для обнаружения сбоев памяти. То есть он используется для определения того, поврежден ли блок памяти на диске, а хранящиеся в нем значения повреждаются. Хэш файла аналогичен контрольной сумме в том, что он также обнаруживает повреждение файла. Однако в отличие от большинства алгоритмов контрольной суммы очень сложно изменить файл так, чтобы он совпадал с тем же хэшем файла, что и его исходная (неизмененная) форма. То есть контрольная сумма предназначена для обнаружения простых ошибок памяти, приводящих к повреждению, но хэш файла можно использовать для обнаружения намеренных и даже незначительных изменений в файле, таких как вирусы, хакеры или троянские программы.

В сигнатуре Authenticode хэш-файл имеет цифровую подпись, используя закрытый ключ, известный только для подписавшего файла. Потребитель программного обеспечения может проверить целостность файла, вычисляя хэш-значение файла и сравнив его со значением подписанного хэша, содержащегося в цифровой подписи Authenticode. Если хэши файлов не совпадают, часть файла, охваченного хэшем образа PE, была изменена.

### <a name="what-is-covered-in-an-authenticode-pe-image-hash"></a>Что рассматривается в хэш-коде образа Authenticode PE?

Невозможно или желательно включить все данные файла изображения в вычисление хэша образа PE. Иногда он просто представляет нежелательные характеристики (например, отладочную информацию нельзя удалить из общедоступных файлов). Иногда это просто невозможно. Например, невозможно включить всю информацию в файл изображения в сигнатуре Authenticode, а затем вставить подпись Authenticode, содержащую этот хэш образа PE, в PE-образ, а затем создать идентичный хэш образа PE, включив все данные файла изображения в вычисление снова, так как файл теперь содержит подпись Authenticode, которая изначально не существовала.

#### <a name="process-for-generating-the-authenticode-pe-image-hash"></a>Процесс создания хэша образа среды предустановки Authenticode

В этом разделе описывается, как вычисляется хэш образа PE и какие части образа PE можно изменить без недействительности подписи Authenticode.

> [!NOTE]
> Хэш образа PE для конкретного файла может быть включен в отдельный файл каталога без включения сертификата атрибута в хэшированный файл. Это уместно, так как становится возможным сделать недействительным хэш образа PE в файле каталога с подписью Authenticode, изменив образ PE, который фактически не содержит сигнатуру Authenticode.

Все данные в разделах образа PE, указанных в таблице разделов, хэшируются целиком, за исключением следующих исключаемых диапазонов:

- **Поле контрольной суммы файла для полей необязательного заголовка, связанных с Windows.** Эта контрольная сумма включает в себя весь файл (включая все сертификаты атрибутов в файле). При любой вероятности контрольная сумма будет отличаться от первоначального значения после вставки подписи Authenticode.

- **Сведения, относящиеся к сертификатам атрибутов**. Области образа PE, связанные с подписью Authenticode, не включаются в вычисление хэша образа PE, так как подписи Authenticode можно добавлять или удалять из образа, не влияя на общую целостность изображения. Это не проблема, так как существуют пользовательские сценарии, которые зависят от повторной подписи PE-образов или добавления метки времени. Authenticode исключает следующие сведения из вычисления хэша:

  - Поле таблицы сертификатов необязательных каталогов данных заголовка.

  - Таблица сертификатов и соответствующие сертификаты, на которые указывает поле таблицы сертификатов, указанное непосредственно выше.

  Чтобы вычислить хэш образа PE, Authenticode упорядочивает разделы, указанные в таблице разделов по диапазону адресов, затем хэширует результирующую последовательность байтов, передавая диапазоны исключения.

- **Сведения, предшествующие концу последнего раздела.** Область за последним разделом (определяемая самым высоким смещением) не хэшируется. Эта область обычно содержит отладочную информацию. Отладочная информация обычно может рассматриваться как советы отладчика. Он не влияет на фактическую целостность исполняемой программы. Можно удалить отладочную информацию из образа после того, как продукт был доставлен и не повлияет на функциональность программы. На самом деле, это иногда делается в качестве меры для экономии дисков. Следует отметить, что отладочная информация, содержащаяся в указанных разделах образа PE, не может быть удалена без проверки подписи Authenticode.

С помощью средств MakeCert и SignTool, предоставляемых в пакете SDK для платформы Windows, можно поэкспериментировать с созданием и проверкой подписей Authenticode. Дополнительные сведения см. в разделе Reference ниже.

## <a name="references"></a>Ссылки

[Файлы для загрузки и средства для Windows (включая Windows SDK)](https://developer.microsoft.com/windows/downloads)

[Создание, просмотр и управление сертификатами](/windows/desktop/SecCrypto/creating-viewing-and-managing-certificates)

[Пошаговое руководство по подписыванию кода в режиме ядра (doc)](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/KMCS_Walkthrough.doc)

[SignTool](/windows/desktop/SecCrypto/signtool)

[Формат переносимого исполняемого файла сигнатуры Windows Authenticode (. docx)](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx)

[Функции ImageHlp](/windows/desktop/Debug/imagehlp-functions)