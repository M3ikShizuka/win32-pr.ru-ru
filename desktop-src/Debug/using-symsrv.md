---
description: Использование SymSrv
ms.assetid: d400f222-c50c-4c7b-8f8a-0c3ed3bba3b9
title: Использование SymSrv
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae79d9fd045ab3ce946c14468e56419d3074858c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262635"
---
# <a name="using-symsrv"></a>Использование SymSrv

SymSrv предоставляет файлы символов из централизованных хранилищ символов. Эти магазины могут содержать любое количество файлов символов, соответствующих любому числу программ или операционных систем. Магазины также могут содержать двоичные файлы, которые особенно полезны при отладке файлов минидампа.

Магазины могут содержать фактические и двоичные файлы символов или просто указатели на файлы символов. Если хранилище содержит указатели, SymSrv будет получать фактические файлы непосредственно из их источников.

SymSrv также может разделять большое хранилище символов на меньшее подмножество, которое подходит для специализированной задачи отладки.

Наконец, SymSrv может получать файлы символов из источника HTTP или HTTPS, используя сведения о входе в систему, предоставляемые операционной системой. SymSrv поддерживает HTTPS-сайты, защищенные SmartCards, сертификатами и обычными именами входа и паролями.

## <a name="setting-the-symbol-path"></a>Задание пути к символам

Как описано в разделе [пути к символам](symbol-paths.md), путь к символам ( \_ \_ \_ переменная среды пути к символам NT) может состоять из нескольких элементов пути, разделенных точкой с запятой. Если один или несколько из этих элементов пути начинаются с текста "SRV \* ", то элемент является сервером символов и будет использовать SymSrv для поиска файлов символов.

> [!Note]  
> Если текст "SRV \* " не указан, но фактический элемент пути является хранилищем сервера символов, обработчик символов будет действовать так, как если \* бы был указан "SRV". Обработчик символов выполняет это определение, выполняя поиск файла с именем "pingme.txt" в корневом каталоге указанного пути.

 

Так же, как пути к символам состоят из элементов пути к символам, разделенных точкой с запятой, серверы символов состоят из элементов хранилища символов, разделенных звездочками. После префикса "SRV" может содержаться до 10 хранилищ символов \* . Магазины, перечисленные слева от списка, называются *нисходящими* хранилищами, а магазины справа называются *вышестоящими* хранилищами.

<dl> SRV \* *SymbolStore*  
SRV \* *SymbolStore1* \* *симболсторен*  
</dl>

Если в путь включено только один элемент хранилища символов, SymSrv будет пытаться использовать любой запрошенный файл непосредственно из этого хранилища.

Если в пути есть два хранилища символов, SymSrv ищет файл символов в крайнем левом хранилище символов. Если файл существует, он используется. Если это не так, SymSrv просматривает хранилище символов непосредственно справа. Если файл находится там, он копируется в левое хранилище и открывается из него.

Если существует более двух магазинов, это поведение будет продолжаться до тех пор, пока файл не будет найден или в списке больше нет хранилищ.

Файл никогда не открывается ни из одного хранилища, но из самого левого хранилища. Если файл находится в другом месте в цепочке, он копируется в каждое хранилище слева от него. Этот процесс копирования называется "каскадным" и предоставляет определенные преимущества, которые будут кларфиед позже в этом документе.

## <a name="types-of-symbol-stores"></a>Типы хранилищ символов

В следующей таблице показаны примеры поддерживаемых типов хранилищ символов.

|                            |                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \\\\\\Общая папка сервера          | Полный UNC-путь к общей папке на удаленном сервере.                                                                                                                                                                                                                                                                                                 |
| c: \\ локалкаче             | Путь к каталогу на клиентском компьютере.                                                                                                                                                                                                                                                                                                             |
| https://InternetSite        | URL веб-сайта, на котором размещены символы. Должно быть крайним правым магазином в списке и не должно быть единственным хранилищем в списке.                                                                                                                                                                                                                          |
| https://SecureInternetSite | URL-адрес защищенного веб-сайта, на котором размещены символы. Это может поддерживать пароли, учетные данные входа в Windows, сертификаты и SmartCards. Должно быть крайним правым магазином в списке и не должно быть единственным хранилищем в списке.                                                                                                                              |
| <blank>              | Если между двумя звездочками нет текста, это означает, что *по умолчанию используется нисходящий магазин*. Расположение задается путем вызова [**симсесомедиректори**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory). Значение по умолчанию — каталог с именем «sym» непосредственно под каталогом программы вызывающего приложения. Иногда это называется *локальным кэшем по умолчанию*. |



 

Так как хранилище символов на основе HTTP не может быть записано в, оно должно быть крайним правым магазином в списке. Если хранилище символов на основе HTTP было расположено в середине или слева от списка магазинов, в него невозможно скопировать найденные файлы, и цепочка будет разорвана. Более того, поскольку обработчик символов не может открыть файл с веб-сайта, хранилище на основе HTTP не должно быть самым левым или храниться только в списке. Если при использовании этого пути к символам отображается SymSrv, будет предпринята попытка восстановить его путем копирования файла в нисходящий банк по умолчанию и открывать его из него независимо от того, указано ли в пути к символам значение по умолчанию подчиненного хранилища.

## <a name="examples"></a>Примеры

Чтобы использовать SymSrv с хранилищем символов в \\ \\ мибуилдс \\ мисимболс, задайте следующий путь к символам:

**Задайте \_ \_ путь к символам NT \_ = SRV \* \\ \\ мибуилдс \\ мисимболс**

Чтобы задать путь к символам, чтобы отладчик скопирует файлы символов из хранилища символов в \\ \\ мибуилдс \\ мисимболс в локальный каталог c: \\ локалсимболс, используйте:

**Задайте \_ \_ путь к символам NT \_ = SRV \* c: \\ локалсимболс \* \\ \\ мибуилдс \\ мисимболс**

Чтобы задать путь к символам, чтобы отладчик скопировал файлы символов из хранилища символов в \\ \\ мибуилдс \\ мисимболс в подчиненное хранилище по умолчанию (обычно c: \\ Debuggers \\ SYM), используйте следующую команду:

**Задайте \_ \_ путь к символам NT \_ = SRV \* \* \\ \\ мибуилдс \\ мисимболс**

Чтобы использовать каскадное хранилище, задайте следующий путь к символам:

**задать \_ \_ путь к символам NT \_ = SRV \* c: \\ локалсимболс \* \\ \\ неарбисервер \\ Store\*https://DistantServer**

В этом примере SymSrv сначала ищет файл в c: \\ локалсимболс. Если он найден, он вернет путь к файлу. В противном случае SymSrv ищет файл в \\ \\ неарбисервер \\ Store. Если он найден, SymSrv копирует файл в c: \\ локалсимболс и возвращает путь к файлу; если он не найден, SymSrv ищет файл в https://DistantServer и, если он найден, SymSrv копирует файл в \\ \\ неарбисервер \\ Store, а затем в c: \\ локалсимболс.

В последнем примере показано, насколько разумным дизайном пути к символам можно воспользоваться для оптимизации загрузки символов. Если у вас есть рабочий сайт с группой отладчиков и все они должны получить символы из удаленных расположений, можно настроить общий сервер с хранилищем символов рядом со всеми отладчиками. Затем настройте каждый отладчик с помощью пути к символам выше. Первый отладчик, требующий определенную версию файла foo. pdb, загрузит его из https://DistantServer в \\ \\ неарбисервер \\ Store, а затем на свой собственный компьютер в c: \\ локалсимболс. Следующий отладчик, которому требуется один и тот же файл, сможет скачать его из \\ \\ хранилища неарбисервер, \\ так как он уже загружен в это расположение с помощью предыдущего отладчика. Это многоуровневое кэширование экономит значительное время и пропускную способность сети.

## <a name="microsoft-symbol-store"></a>Хранилище символов Майкрософт

Корпорация Майкрософт предоставляет доступ к серверу символов Интернета, содержащему файлы символов для многих версий операционной системы Windows. Этот каталог символов не обязательно должен быть полным, но он является обширным. Также представлены другие продукты Майкрософт.

Сервер символов Интернета заполняется различными символами Windows для операционных систем Microsoft Windows, включая исправления, пакеты обновления, пакеты исправлений безопасности и розничные выпуски. Кроме того, на сервере доступны символы для текущих бета-версий и кандидатов на выпуски продуктов Windows, а также множество других продуктов Майкрософт, таких как Microsoft Internet Explorer.

При наличии доступа к Интернету во время отладки можно настроить отладчик для загрузки символов по мере необходимости во время сеанса отладки, вместо того чтобы загружать файлы символов отдельно перед сеансом отладки. Символы загружаются в указанное расположение каталога, а затем отладчик загружает их из него.

URL-адрес для хранилища символов Майкрософт — https://msdl.microsoft.com/download/symbols . В следующем примере показано, как задать путь к символам отладчика (Замените путь подчиненного хранилища для *c: \\ довнстреамсторе*):

``` syntax
srv*c:\DownstreamStore*https://msdl.microsoft.com/download/symbols
```

## <a name="compressed-files"></a>Сжатые файлы

SymSrv совместим с хранилищами символов, которые содержат сжатые файлы, при условии, что это сжатие предустановлено с помощью средства compress.exe, которое было распространено с помощью пакета Windows Server 2003 Resource Kit. Сжатые файлы должны содержать символ подчеркивания в качестве последнего символа в расширениях файлов (например, Module1. PD \_ или Module2. DB \_ ). Дополнительные сведения см. [в разделе Использование SymStore](using-symstore.md).

При каскадном изменении файлы не сжимаются, если целевое хранилище не является крайним левым хранилищем в пути. Если в пути содержится только одно хранилище и он содержит сжатый файл, SymSrv скопирует файл в подчиненное хранилище по умолчанию и откроет его из него, даже если в пути к символам не указано подчиненное хранилище по умолчанию.

**DbgHelp 6,1 и более ранних версий:** Если файлы в главном хранилище сжимаются, необходимо использовать подчиненное хранилище. SymSrv будет распаковать все файлы перед копированием их в подчиненное хранилище.

## <a name="deleting-the-cache"></a>Удаление кэша

Если в качестве кэша используется подчиненное хранилище, можно в любое время удалить этот каталог, чтобы сэкономить место на диске.

Возможно наличие огромного хранилища символов, включающего файлы символов для множества различных программ или версий Windows. При обновлении версии Windows, используемой на целевом компьютере, все кэшированные файлы символов будут соответствовать предыдущей версии. Эти кэшированные файлы не будут использоваться в дальнейшем, поэтому это может быть хорошим временем для удаления кэша.

Средства отладки для Windows поставляются с помощью служебной программы, именуемой agestore.exe, которая выборочно удаляет файлы из дерева каталогов, освобождая последние использованные файлы. Это средство предназначено для удаления неиспользуемых файлов из хранилищ сервера символов. Он позволяет управлять множеством параметров, включая алгоритмы уменьшения и размера каталога.

## <a name="flat-cache-directory"></a>Каталог плоского кэша

Можно объявить подчиненное хранилище по умолчанию в виде неструктурированного каталога, а не стандартной древовидной структуры символов. Для этого вызовите функцию [**симсетоптионс**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsetoptions) с **\_ неструктурированным \_ каталогом симопт** (это также задает параметр **ссрвопт \_ плоского \_ \_ хранилища по умолчанию** в SymSrv). Не забудьте вызвать [**симсесомедиректори**](/windows/desktop/api/Dbghelp/nf-dbghelp-symsethomedirectory) перед этим. в противном случае файлы символов можно записать в каталог программы.

## <a name="pointer-files"></a>Файлы указателей

SymStore может создавать и использовать файлы, указывающие на целевой файл, а не на сам целевой файл. Если хранилище символов содержит такой файл указателя, по умолчанию файл копируется из расположения, указанного в файле указателя, в хранилище. Чтобы настроить хранилище таким путем, чтобы файл указателя копировался вместо файла, на который он указывает, создайте файл с именем wantsptr.txt в корневом каталоге целевого хранилища. Содержимое wantsptr.txt не имеет значения, а только наличие файла.

## <a name="excluding-files-from-symbols-list"></a>Исключение файлов из списка символов

Чтобы исключить файлы из поиска символов, можно указать их имена в symsrv.ini или в реестре. Чтобы указать файлы в symsrv.ini, создайте раздел с именем Renames и выведите список файлов. Имена файлов могут содержать подстановочные знаки, как показано в следующем примере:

``` syntax
[Exclusions]
dbghelp.pdb
symsrv.*
mso*
```

Symsrv.ini должны находиться в том же каталоге, в котором находится symsrv.dll. В большинстве случаев файл не существует, и необходимо создать новый.

Кроме того, можно хранить файлы, исключаемые из реестра. Создайте следующий раздел реестра: **hKey \_ локальный \_ компьютер \\ программное \\ обеспечение \\ \\ исключения Microsoft Symbol Server**. Сохраните каждое имя файла как строковое значение (REG \_ SZ) в этом ключе. Имя строкового значения указывает имя файла, который необходимо исключить. Содержимое строкового значения можно использовать для хранения комментария, описывающего причину исключения файла.

## <a name="installation"></a>Установка

Сервер символов SymSrv (symsrv.dll) включен в пакет средств отладки для Windows. Он должен быть установлен в том же каталоге, что и копия dbghelp.dll, которую вы загружаете. Дополнительные сведения см. [в разделе вызов библиотеки DBGHELP](calling-the-dbghelp-library.md).

 

 



