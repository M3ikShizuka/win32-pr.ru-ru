---
description: Обработчик исключений на основе кадров позволяет решать, что исключение может возникнуть в определенной последовательности кода. Обработчик исключений на основе кадров состоит из следующих элементов.
ms.assetid: 07aac772-f917-48b7-91a9-3b5d4cb43600
title: Обработка исключений на основе кадров
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12b268b5d02de83bca22a1d3311905b05be1f748
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104496383"
---
# <a name="frame-based-exception-handling"></a>Обработка исключений на основе кадров

*Обработчик исключений на основе кадров* позволяет решать, что исключение может возникнуть в определенной последовательности кода. Обработчик исключений на основе кадров состоит из следующих элементов.

-   Защищенный текст кода
-   Критерий фильтра
-   Блок обработчика исключений

Обработчики исключений на основе кадров объявляются в синтаксисе, зависящем от языка. Например, в компиляторе оптимизации Microsoft C/C++ они реализуются с помощью **\_ \_ try** и **\_ \_ except**. Дополнительные сведения см. в разделе [синтаксис обработчика](handler-syntax.md).

*Защищенный текст кода* — это набор из одной или нескольких инструкций, для которых выражение фильтра и блок обработчика исключений обеспечивают защиту обработки исключений. Защищенный текст может быть блоком кода, набором вложенных блоков или целой процедурой или функцией. При использовании оптимизирующих компиляторов Microsoft C/C++ защищенный текст заключен в фигурные скобки ( {} ) после ключевого слова **\_ \_ try** .

*Критерий фильтра* обработчика исключений на основе кадров является выражением, которое вычисляется системой при возникновении исключения в защищенном тексте. Эта оценка приводит к одному из следующих действий в системе.

-   Система останавливает поиск обработчика исключений, восстанавливает состояние компьютера и возобновляет выполнение потока в момент возникновения исключения.
-   Система продолжит поиск обработчика исключений.
-   Система передает управление обработчику исключений, и выполнение потока последовательно выполняется в кадре стека, в котором найден обработчик исключений. Если обработчик не находится в кадре стека, в котором произошло исключение, система очищает стек, освобождая текущий кадр стека и другие кадры стека до тех пор, пока не вернется к кадру стека обработчика исключений. Перед выполнением обработчика исключений обработчики завершения выполняются для всех защищенных частей кода, которые прерываются в результате перемещения управления в обработчик исключений. Дополнительные сведения о обработчиках завершения см. в разделе [обработка завершения](termination-handling.md).

Критерий фильтра может быть простым выражением или вызывать *функцию фильтра* , которая пытается справиться с исключением. Вы можете вызвать функции [**GetExceptionCode**](getexceptioncode.md) и [**жетексцептионинформатион**](getexceptioninformation.md) из критерия фильтра, чтобы получить сведения о фильтруемом исключении. **GetExceptionCode** возвращает код, определяющий тип исключения, а **жетексцептионинформатион** возвращает указатель на структуру [**\_ указателей исключений**](/windows/desktop/api/WinNT/ns-winnt-exception_pointers) , содержащую указатели на структуры записей [**контекста**](/windows/desktop/api/WinNT/ns-winnt-arm64_nt_context) и [**исключения \_**](/windows/desktop/api/WinNT/ns-winnt-exception_record) .

Эти функции нельзя вызывать из функции фильтра, но их возвращаемые значения могут передаваться в качестве параметров функции фильтра. [**GetExceptionCode**](getexceptioncode.md) можно использовать в блоке обработчика исключений, но [**жетексцептионинформатион**](getexceptioninformation.md) не может потому, что информация, на которую он указывает, обычно находится в стеке и уничтожается при передаче управления в обработчик исключений. Однако приложение может скопировать сведения в надежное хранилище, чтобы сделать их доступными для обработчика исключений.

Преимущество функции фильтра заключается в том, что она может обменяться исключением и возвращать значение, которое приводит к тому, что система продолжит выполнение с момента возникновения исключения. В отличие от блока обработчика исключений, выполнение выполняется последовательно из обработчика исключений, а не из точки исключения.

Обработка исключения может быть такой же простой, как сообщение об ошибке и установка флага, который будет рассмотрен позже, выводить предупреждение или сообщение об ошибке или выполнить какое-либо другое ограниченное действие. Если выполнение может быть продолжено, также может потребоваться изменить состояние компьютера, изменив запись контекста. Пример функции фильтра, обрабатывающей исключение ошибки страницы, см. [в разделе Использование функций виртуальной памяти](../memory/using-the-memory-management-functions.md).

Функцию [**UnhandledExceptionFilter**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-unhandledexceptionfilter) можно использовать в качестве функции фильтра в критерии фильтра. Он возвращает \_ обработчик исключений \_ , если процесс не отлаживается. в этом случае возвращается исключение \_ "продолжить \_ Поиск".

 

 
