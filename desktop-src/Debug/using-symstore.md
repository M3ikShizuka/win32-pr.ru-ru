---
description: SymStore (symstore.exe) — это инструмент для создания хранилищ символов. Он включен в пакет средств отладки для Windows.
ms.assetid: fe8a96e9-e780-4e96-98ef-c5128515ee6c
title: Использование SymStore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a87b5c527717d78adb9202fd1eddd54d1f44c02
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104141527"
---
# <a name="using-symstore"></a>Использование SymStore

SymStore (symstore.exe) — это инструмент для создания хранилищ символов. Он включен в пакет [средств отладки для Windows](https://www.microsoft.com/?ref=go) .

SymStore хранит символы в формате, позволяющем отладчику искать символы на основе отметки времени и размера изображения (для файла. dbg или исполняемого), а также сигнатуры и возраста (для PDB-файла). Преимуществом хранилища символов в традиционном формате хранения символов является то, что все символы могут храниться или ссылаться на один и тот же сервер и извлекаться отладчиком без каких-либо предыдущих знаний о том, какой продукт содержит соответствующий символ.

Обратите внимание, что несколько версий PDB-файлов символов (например, общедоступные и частные версии) не могут храниться на одном сервере, так как каждый из них содержит одинаковую подпись и возраст.

## <a name="symstore-transactions"></a>SymStore транзакции

Каждый вызов SymStore записывается как транзакция. Существует два типа транзакций: Добавление и удаление.

При создании хранилища символов в корневом каталоге сервера создается каталог с именем «000admin». Каталог 000admin содержит по одному файлу для каждой транзакции, а также к файлам журналов Server.txt и History.txt. Файл Server.txt содержит список всех транзакций, которые в настоящее время находятся на сервере. Файл History.txt содержит хронологию всех транзакций.

Каждый раз, когда SymStore сохраняет или удаляет файлы символов, создается новый номер транзакции. Затем файл с именем, равным этому номеру транзакции, создается в 000admin. Этот файл содержит список всех файлов или указателей, добавленных в хранилище символов во время этой транзакции. Если транзакция удалена, SymStore прочитает ее файл транзакций, чтобы определить, какие файлы и указатели следует удалить.

Параметры **Add** и **Del** указывают, следует ли выполнять транзакцию добавления или удаления. Включение параметра **/p** с операцией Add указывает на необходимость добавления указателя; Пропуск параметра **/p** указывает, что будет добавлен фактический файл символов.

Хранилище символов также можно создать на двух отдельных этапах. На первом этапе для создания файла индекса используется SymStore с параметром **/x** . На втором этапе используется SymStore с параметром **/y** для создания фактического хранилища файлов или указателей из данных в файле индекса.

Это может быть полезной методикой по ряду причин. Например, это позволяет легко воссоздать хранилище символов, если хранилище каким-либо образом теряется, пока файл индекса еще существует. Или, возможно, компьютер, на котором находятся файлы символов, имеет низкую сетевую связь с компьютером, на котором будет создано хранилище символов. В этом случае можно создать файл индекса на том же компьютере, где находятся файлы символов, переместить файл индекса на второй компьютер, а затем создать хранилище на втором компьютере.

Полный список всех параметров SymStore см. в разделе [параметры Command-Line SymStore](symstore-command-line-options.md).

> [!Note]  
> SymStore не поддерживает одновременные транзакции от нескольких пользователей. Рекомендуется, чтобы один пользователь был назначен администратором хранилища символов и отвечал всем транзакциям **добавления** и **Del** .

 

## <a name="transaction-examples"></a>Примеры транзакций

Ниже приведены два примера SymStore добавления указателей символов для сборки 3790 Windows Server 2003 в \\ \\ SampleDir \\ SymSrv:

``` syntax
symstore add /r /p /f \\BuildServer\BuildShare\3790free\symbols\*.*
   /s \\sampledir\symsrv /t "Windows Server 2003" /v "Build 3790 x86 free"
   /c "Sample add"
symstore add /r /p /f \\BuildServer\BuildShare\3790Chk\symbols\*.* 
   /s \\sampledir\symsrv /t "Windows Server 2003" /v "Build 3790 x86 checked"
   /c "Sample add"
```

В следующем примере SymStore добавляет фактические файлы символов для проекта приложения в \\ \\ ларжеапп \\ выборе \\ ячеек в \\ \\ тестдир \\ SymSrv:

``` syntax
symstore add /r /f \\largeapp\appserver\bins\*.* /s \\testdir\symsrv 
   /t "Large Application" /v "Build 432" /c "Sample add"
```

Ниже приведен пример использования файла индекса. Сначала SymStore создает файл индекса на основе коллекции файлов символов в \\ \\ \\ \\ ячейках ларжеапп выборе \\ . В этом случае файл индекса размещается на третьем компьютере, \\ \\ хубсервер \\ хубшаре. Используйте параметр **/g** , чтобы указать, что префикс файла " \\ \\ ларжеапп \\ выборе" может измениться в будущем:

``` syntax
symstore add /r /p /g \\largeapp\appserver /f 
   \\largeapp\appserver\bins\*.* 
   /x \\hubserver\hubshare\myindex.txt
```

Теперь предположим, что вы перемещаете все файлы символов с компьютера \\ \\ ларжеапп \\ выборе и поместили их на \\ \\ мярчиве \\ выборе. Затем можно создать хранилище символов из файла индекса \\ \\ хубсервер \\ хубшаре \\myindex.txt следующим образом:

``` syntax
symstore add /y \\hubserver\hubshare\myindex.txt 
   /g \\myarchive\appserver /s \\sampledir\symsrv /p 
   /t "Large Application" /v "Build 432" /c "Sample Add from Index"
```

Наконец, ниже приведен пример SymStore удаления файла, добавленного предыдущей транзакцией. Описание процесса определения идентификатора транзакции (в данном случае 0000000096) см. в следующем разделе.

``` syntax
symstore del /i 0000000096 /s \\sampledir\symsrv
```

## <a name="compressed-files"></a>Сжатые файлы

SymStore можно использовать с сжатыми файлами двумя разными способами.

1.  Используйте SymStore с параметром **/p** для хранения указателей на файлы символов. После завершения SymStore необходимо сжать файлы, на которые ссылаются указатели.
2.  Для создания файла индекса используйте SymStore с параметром **/x** . После завершения SymStore необходимо сжать файлы, перечисленные в индексном файле. Затем используйте SymStore с параметром **/y** (и, если требуется, параметр **/p** ) для хранения файлов или указателей на файлы в хранилище символов. (Для выполнения этой операции SymStore не потребуется распаковать файлы.)

Сервер символов будет отвечать за распаковку файлов, когда они понадобятся.

При использовании SymSrv в качестве сервера символов необходимо выполнить сжатие с помощью средства compress.exe, распространяемого вместе с пакетом средств разработки программного обеспечения (SDK) для Microsoft Windows. Сжатые файлы должны содержать символ подчеркивания в качестве последнего символа в расширениях файлов (например, Module1. PD \_ или Module2. DB \_ ). Дополнительные сведения см. [в разделе Использование SymSrv](using-symsrv.md).

## <a name="the-servertxt-and-historytxt-files"></a>Файлы server.txt и history.txt

При добавлении транзакции в нее добавляются несколько элементов данных, server.txt и history.txt для будущего поиска. Ниже приведен пример строки в server.txt и history.txt для добавления транзакции.

``` syntax
0000000096,add,ptr,10/09/99,00:08:32,Windows XP,x86 fre 1.156c-RTM-2,Added from \\mybuilds\symbols,
```

Это строка с разделителями-запятыми. Поля определяются следующим образом.



| Поле      | Описание                                                                         |
|------------|-------------------------------------------------------------------------------------|
| 0000000096 | ИДЕНТИФИКАЦИОНный номер транзакции, созданный SymStore.                                      |
| add        | Тип транзакции. Это поле может быть либо " **Добавить** ", либо " **Del**".                   |
| ptr        | Указывает, были ли добавлены файлы или указатели. Это поле может быть либо **File** , либо **ptr**. |
| 10/09/99   | Дата возникновения транзакции.                                                     |
| 00:08:32   | Время начала транзакции.                                                      |
| Windows XP | Продукт.                                                                            |
| Фре x86    | Версия (необязательно).                                                                 |
| Добавлено из | Комментарий (необязательно)                                                                  |
| Не используется     | (Зарезервировано для последующего использования.)                                                           |



 

Ниже приведены примеры строк из файла транзакций 0000000096. Каждая строка записывает каталог и расположение файла или указателя, добавленного в каталог.

``` syntax
canon800.dbg\35d9fd51b000,\\mybuilds\symbols\sp4\dll\canon800.dbg
canonlbp.dbg\35d9fd521c000,\\mybuilds\symbols\sp4\dll\canonlbp.dbg
certadm.dbg\352bf2f48000,\\mybuilds\symbols\sp4\dll\certadm.dbg
certcli.dbg\352bf2f1b000,\\mybuilds\symbols\sp4\dll\certcli.dbg
certcrpt.dbg\352bf04911000,\\mybuilds\symbols\sp4\dll\certcrpt.dbg
certenc.dbg\352bf2f7f000,\\mybuilds\symbols\sp4\dll\certenc.dbg
```

Если для отмены исходных транзакций **добавления** используется транзакция **Del** , эти строки будут удалены из server.txt, а следующая строка будет добавлена в history.txt:

``` syntax
0000000105,del,0000000096
```

Поля для транзакции Delete определяются следующим образом.



| Поле      | Описание                                                       |
|------------|-------------------------------------------------------------------|
| 0000000105 | ИДЕНТИФИКАЦИОНный номер транзакции, созданный SymStore.                    |
| del        | Тип транзакции. Это поле может быть либо " **Добавить** ", либо " **Del**". |
| 0000000096 | Транзакция, которая была удалена.                                     |



 

## <a name="symbol-storage-format"></a>Формат хранения символов

SymStore использует саму файловую систему в качестве базы данных. Он создает большое дерево каталогов с именами каталогов, основанными на таких вещах, как отметки времени файла символов, подписи, возраст и другие данные.

Например, после добавления нескольких различных файлов ACPI. dbg на сервер каталоги могут выглядеть следующим образом:

``` syntax
Directory of \\mybuilds\symsrv\acpi.dbg
10/06/1999  05:46p      <DIR>          .
10/06/1999  05:46p      <DIR>          ..
10/04/1999  01:54p      <DIR>          37cdb03962040
10/04/1999  01:49p      <DIR>          37cdb04027740
10/04/1999  12:56p      <DIR>          37e3eb1c62060
10/04/1999  12:51p      <DIR>          37e3ebcc27760
10/04/1999  12:45p      <DIR>          37ed151662060
10/04/1999  12:39p      <DIR>          37ed15dd27760
10/04/1999  11:33a      <DIR>          37f03ce962020
10/04/1999  11:21a      <DIR>          37f03cf7277c0
10/06/1999  05:38p      <DIR>          37fa7f00277e0
10/06/1999  05:46p      <DIR>          37fa7f01620a0
```

В этом примере путь поиска для файла символов ACPI. dbg может выглядеть примерно так: \\ \\ мибуилдс \\ SymSrv \\ ACPI. dbg \\ 37cdb03962040.

В каталоге поиска могут находиться три файла:

1.  Если файл был сохранен, в нем будет существовать ACPI. dbg.
2.  Если был сохранен указатель, то файл с именем file. PTR будет существовать и содержать путь к фактическому файлу символов.
3.  Файл с именем ReFS. PTR, содержащий список всех текущих расположений для ACPI. dbg с этой меткой времени и размером образа, которые в данный момент добавляются в хранилище символов.

Отображение списка каталогов \\ \\ мибуилдс \\ SymSrv \\ ACPI. dbg \\ 37cdb03962040 предоставляет следующие преимущества:

``` syntax
10/04/1999  01:54p                  52 file.ptr
10/04/1999  01:54p                  67 refs.ptr
```

Файл File. PTR содержит текстовую строку " \\ \\ мибуилдс \\ SYMBOLS \\ x86 \\ 2128. chk \\ SYMBOLS \\ sys \\ ACPI. dbg". Так как в этом каталоге нет файла с именем ACPI. dbg, отладчик попытается найти файл в \\ \\ мибуилдс \\ SYMBOLS \\ x86 \\ 2128. chk \\ SYMBOLS \\ sys \\ ACPI. dbg.

Содержимое ReFS. PTR используется только SymStore, а не отладчиком. Этот файл содержит записи всех транзакций, выполненных в этом каталоге. Пример строки из ReFS. PTR может быть следующим:

``` syntax
0000000026,ptr,\\mybuilds\symbols\x86\2128.chk\symbols\sys\acpi.dbg
```

Это показывает, что указатель на \\ \\ мибуилдс \\ символы \\ x86 \\ 2128. \\ символы CHK \\ sys \\ ACPI. dbg был добавлен с транзакцией «0000000026».

Некоторые файлы символов остаются постоянными с помощью различных продуктов или сборок или определенного продукта. Одним из примеров этого является файл msvcrt. pdb. При выполнении каталога \\ \\ мибуилдс \\ SymSrv \\ msvcrt. pdb показано, что на сервер символов добавлены только две версии msvcrt. pdb:

``` syntax
Directory of \\mybuilds\symsrv\msvcrt.pdb
10/06/1999  05:37p      <DIR>          .
10/06/1999  05:37p      <DIR>          ..
10/04/1999  11:19a      <DIR>          37a8f40e2
10/06/1999  05:37p      <DIR>          37f2c2272
```

Однако при выполнении каталога \\ \\ мибуилдс \\ SymSrv \\ msvcrt. pdb \\ 37a8f40e2 показывает, что ReFS. PTR содержит несколько указателей.

``` syntax
Directory of \\mybuilds\symsrv\msvcrt.pdb\37a8f40e2
10/05/1999  02:50p              54     file.ptr
10/05/1999  02:50p           2,039     refs.ptr
```

Ниже приведены содержимое файла \\ \\ мибуилдс \\ SymSrv \\ msvcrt. pdb \\ 37a8f40e2 \\ ReFS. PTR:

``` syntax
0000000001,ptr,\\mybuilds\symbols\x86\2137\symbols\dll\msvcrt.pdb
0000000002,ptr,\\mybuilds\symbols\x86\2137.chk\symbols\dll\msvcrt.pdb
0000000003,ptr,\\mybuilds\symbols\x86\2138\symbols\dll\msvcrt.pdb
0000000004,ptr,\\mybuilds\symbols\x86\2138.chk\symbols\dll\msvcrt.pdb
0000000005,ptr,\\mybuilds\symbols\x86\2139\symbols\dll\msvcrt.pdb
0000000006,ptr,\\mybuilds\symbols\x86\2139.chk\symbols\dll\msvcrt.pdb
0000000007,ptr,\\mybuilds\symbols\x86\2140\symbols\dll\msvcrt.pdb
0000000008,ptr,\\mybuilds\symbols\x86\2140.chk\symbols\dll\msvcrt.pdb
0000000009,ptr,\\mybuilds\symbols\x86\2136\symbols\dll\msvcrt.pdb
0000000010,ptr,\\mybuilds\symbols\x86\2136.chk\symbols\dll\msvcrt.pdb
0000000011,ptr,\\mybuilds\symbols\x86\2135\symbols\dll\msvcrt.pdb
0000000012,ptr,\\mybuilds\symbols\x86\2135.chk\symbols\dll\msvcrt.pdb
0000000013,ptr,\\mybuilds\symbols\x86\2134\symbols\dll\msvcrt.pdb
0000000014,ptr,\\mybuilds\symbols\x86\2134.chk\symbols\dll\msvcrt.pdb
0000000015,ptr,\\mybuilds\symbols\x86\2133\symbols\dll\msvcrt.pdb
0000000016,ptr,\\mybuilds\symbols\x86\2133.chk\symbols\dll\msvcrt.pdb
0000000017,ptr,\\mybuilds\symbols\x86\2132\symbols\dll\msvcrt.pdb
0000000018,ptr,\\mybuilds\symbols\x86\2132.chk\symbols\dll\msvcrt.pdb
0000000019,ptr,\\mybuilds\symbols\x86\2131\symbols\dll\msvcrt.pdb
0000000020,ptr,\\mybuilds\symbols\x86\2131.chk\symbols\dll\msvcrt.pdb
0000000021,ptr,\\mybuilds\symbols\x86\2130\symbols\dll\msvcrt.pdb
0000000022,ptr,\\mybuilds\symbols\x86\2130.chk\symbols\dll\msvcrt.pdb
0000000023,ptr,\\mybuilds\symbols\x86\2129\symbols\dll\msvcrt.pdb
0000000024,ptr,\\mybuilds\symbols\x86\2129.chk\symbols\dll\msvcrt.pdb
0000000025,ptr,\\mybuilds\symbols\x86\2128\symbols\dll\msvcrt.pdb
0000000026,ptr,\\mybuilds\symbols\x86\2128.chk\symbols\dll\msvcrt.pdb
0000000027,ptr,\\mybuilds\symbols\x86\2141\symbols\dll\msvcrt.pdb
0000000028,ptr,\\mybuilds\symbols\x86\2141.chk\symbols\dll\msvcrt.pdb
0000000029,ptr,\\mybuilds\symbols\x86\2142\symbols\dll\msvcrt.pdb
0000000030,ptr,\\mybuilds\symbols\x86\2142.chk\symbols\dll\msvcrt.pdb
```

Это показывает, что один и тот же файл msvcrt. pdb использовался для нескольких сборок символов, хранящихся в \\ \\ мибуилдс \\ SymSrv.

Ниже приведен пример каталога, который содержит сочетание дополнений к файлам и указателям.

``` syntax
Directory of E:\symsrv\dbghelp.dbg\38039ff439000
10/12/1999  01:54p         141,232     dbghelp.dbg
10/13/1999  04:57p              49     file.ptr
10/13/1999  04:57p             306     refs.ptr
```

В этом случае ReFS. PTR имеет следующее содержимое:

``` syntax
0000000043,file,e:\binaries\symbols\retail\dll\dbghelp.dbg
0000000044,file,f:\binaries\symbols\retail\dll\dbghelp.dbg
0000000045,file,g:\binaries\symbols\retail\dll\dbghelp.dbg
0000000046,ptr,\\sampledir\bin\symbols\retail\dll\dbghelp.dbg
0000000047,ptr,\\sampledir2\bin\symbols\retail\dll\dbghelp.dbg
```

Таким же транзакция 43, 44 и 45 добавила один и тот же файл на сервер, а транзакции 46 и 47 добавили указатели. Если транзакции 43, 44 и 45 удаляются, файл dbghelp. dbg будет удален из каталога. После этого каталог будет иметь следующее содержимое:

``` syntax
Directory of e:\symsrv\dbghelp.dbg\38039ff439000
10/13/1999  05:01p                   49 file.ptr
10/13/1999  05:01p                 130 refs.ptr
```

Файл File. PTR содержит « \\ \\ sampledir2 \\ bin \\ Symbol \\ Retail \\ DLL \\ dbghelp. dbg», а ReFS. PTR содержит

``` syntax
0000000046,ptr,\\sampledir\bin\symbols\retail\dll\dbghelp.dbg
0000000047,ptr,\\sampledir2\bin\symbols\retail\dll\dbghelp.dbg
```

Когда последняя запись в ReFS. PTR является указателем, файловый файл. PTR будет существовать и содержать путь к связанному файлу. Когда последняя запись в ReFS. PTR является файлом, файл. PTR не будет существовать в этом каталоге. Таким образом, любая операция удаления, которая удаляет последнюю запись в ReFS. PTR, может привести к созданию, удалению или изменению файла. PTR.

 

 



