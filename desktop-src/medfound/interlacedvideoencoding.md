---
description: Кодирование видео с чередованием
ms.assetid: 7695d4e3-4a75-4972-ab02-bc532d6a4dce
title: Кодирование видео с чередованием (Microsoft Media Foundation)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fafacb56f29964e81b040c59cdb75d8ebb35830b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999350"
---
# <a name="interlaced-video-encoding-microsoft-media-foundation"></a>Кодирование видео с чередованием (Microsoft Media Foundation)

Данные видео, предназначенные для использования с компьютерами, обычно *прогрессивны*, то есть каждый кадр кодируется как единое изображение. Некоторые устройства, например телевизоры, не отображают кадры одновременно, но как два изображения. Одно из изображений или полей содержит все четное число строк. Другое поле содержит данные для всех нечетных строк. Видео, закодированное с помощью нескольких полей на кадр, называется чередованием, так как оно отображается путем переключения между четным и нечетным полем.

В прошлом чередующиеся видеоматериалы всегда переходились без чередования перед кодированием с помощью видеокодека Windows Media. Однако начиная с серии Windows Media 9, кодировщик видео поддерживает сжатие содержимого с чередованием без предварительного преобразования его в прогрессивное. Сохранение чередования в закодированном файле важно, если содержимое отображается в виде чередования, например телевизора. Эта функция имеет более высокую важность, так как поддержка распространения содержимого на основе Windows Media для проигрывателей DVD, приставок и других бытовой электроники.

Самый простой способ кодирования и доставки видео с чередованием — разработка приложения с помощью пакета SDK Windows Media Format и сохранение содержимого в ASF-файлах. Чередующиеся сведения о кадрах передаются в кодек с помощью модулей обработки данных, что хорошо подходит для содержимого ASF, но в других контейнерах это немного сложнее. Дополнительные сведения о модулях обработки данных см. [в разделе Использование расширений модулей данных](usingdataunitextensions.md).

Для поддержки чередования кодирование включает в себя два основных шага: получение сведений о кадре кодировщику и предоставление информации в приложении для отрисовки. Эти действия описаны в следующих абзацах.

## <a name="interlaced-video-and-the-encoder"></a>Чередование видео и кодировщика

Первым шагом в кодировании видео с сохраненным чередованием является Настройка кодировщика для кодирования полей с чередованием. Для этого задайте для свойства [мфпкэй \_ Интерлацедкодинженаблед](mfpkey-interlacedcodingenabledproperty.md) значение **true**. Это подготавливает кодировщик для получения образцов с чередованием. Каждый входной образец должен содержать оба поля.

Каждый пример, который обрабатывается с помощью кодировщика после активации чередования кодирования, должен иметь вложенное расширение модуля данных. Предполагается, что примеры без ожидаемого расширения модулей данных будут прогрессивными. Идентификатор GUID, определяющий расширение, — D590DC20-07BC-436C-9CF7-F3BBFBF1A4DC. Значения, передаваемые объектами пакета SDK Windows Media Format, определены в следующей таблице.



| Значение      | Описание                                                                                                                              |
|------------|------------------------------------------------------------------------------------------------------------------------------------------|
| 0x00000020 | Указывает, что образец кодируется в нижнем поле первым. Это значение имеет смысл только в сочетании с чередованием значений. |
| 0x00000040 | Указывает, что образец сначала кодируется в верхнее поле. Это значение имеет смысл только в сочетании с чередованием значений.    |
| 0x00000080 | Указывает, что образец является чередованием. Это единственное значение, которое является значимым для кодека дмос.                                    |



 

Одно из первых двух значений всегда объединяется с 0x80 с помощью побитовой операции **или** до установки в образце. Однако кодировщик проверяет только 0x80 и не учитывает остальную часть расширения. Если расширение определяет пример с чередованием, кодировщик сохраняет пример чередования в сжатом потоке и внедряет в поток флаг индикации, чтобы декодер мог идентифицировать кадры с чередованием. Каждый чередующийся образец помечен, чтобы исходное содержимое, которое является сочетанием прогрессивного и чередования, можно было кодировать в поток вместе.

Объект модуля записи SDK формата Windows Media содержит расширения единиц измерения содержимого в примерах, которые записываются в раздел данных контейнера ASF для использования во время отрисовки.

## <a name="reading-and-rendering-interlaced-video"></a>Чтение и визуализация видео с чередованием

Декодер определяет чередующиеся примеры на основе флага, установленного в потоке кодировщиком. По умолчанию декодер выполняет чередование образцов и обеспечивает последовательные выходные данные. Приложение проигрывателя может настроить декодер для обработки выходных данных с помощью чередования, установив свойство [ \_ \_ дечередования декодера мфпкэй](mfpkey-decoder-deinterlacingproperty.md) .

Сложность воспроизведения видео с чередованием возникает после того, как декодер доставляет образцы. Модуль подготовки отчетов (видеоадаптер или микросхема устройства) не может правильно отобразить видеосодержимое, не зная, какое именно поле. В приложениях, использующих пакет SDK для формата Windows Media, расширение единицы данных типа содержимого извлекается из несжатых образцов и может быть передано на устройство.

При непосредственном использовании объектов кодека ни один из этих данных не является автоматическим. Необходимо реализовать поддержку модулей обработки данных как в объектах буфера, так и в контейнере, который используется для закодированного содержимого. Наиболее распространенные типы контейнеров мультимедиа (например, AVI) не поддерживают метаданные уровня образца. Вы можете реализовать собственную систему для хранения данных в файле и связать ее с отдельными примерами, но только настраиваемый читатель сможет получить его.

> [!Note]  
> Если задать для свойства [мфпкэй \_ Интерлацедкодинженаблед](mfpkey-interlacedcodingenabledproperty.md) **значение true**, а затем не отправлять образцы с присоединенным расширением модуля данных Content-Type, это может привести к сбою кодировщика. Задайте кодировщик для чередования кодирования, только если имеются чередующиеся образцы для доставки.

 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Работа с видео](workingwithvideo.md)
</dt> </dl>

 

 



