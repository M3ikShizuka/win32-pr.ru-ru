---
description: поддерживаются два режима кодирования, определенные Windows кодировщиками мультимедиа и Media Foundation на уровне конвейера.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: создание топологии для Two-Pass Windows кодирования мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 525a98faa424371f2d80739e5c68f199cfc7ed6443c25ab3d15b575afdd003e6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119724884"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a>создание топологии для Two-Pass Windows кодирования мультимедиа

поддерживаются два режима кодирования, определенные Windows кодировщиками мультимедиа и Media Foundation на уровне конвейера. Приложение должно настроить и настроить топологию кодирования так же, как в однопроходной кодировке, но в режиме 2-проходного кодирования приложение должно запускать сеанс кодирования дважды. При первом прохождении кодировщик собирает сведения о содержимом потока. На втором этапе, используя сведения, собранные на первом этапе, создается окончательный выходной файл. Обрабатывая образцы для потока дважды, две проходные кодировки оптимизируют процесс кодирования и создают файлы с кодировкой более высокого качества. В динамических потоках нельзя использовать режимы кодирования с двумя проходами.

Media Foundation поддерживает следующие режимы кодирования с двумя проходами:

-   [Кодирование переменной скорости с неограниченным битом](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [Пиковое кодирование с переменным ограничением скорости](peak-constrained-variable-bit-rate--vbr--encoding.md)

Создание топологии кодирования для двусторонней кодировки аналогично однопроходным режимам. В следующем списке приведены основные различия.

-   Конфигурация кодировщика должна включать свойство [**мфпкэй \_ пассесусед**](mfpkey-passesusedproperty.md) , для которого задано значение 2, а для свойства [**мфпкэй \_ вбренаблед**](mfpkey-vbrenabledproperty.md) — \_ значение true. Это позволит отфильтровать возможности кодировщика в двух-проходных режимах. Если вы используете объекты активации, передайте эти свойства в [**мфкреатевмаенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) или [**мфкреатевмвенкодерактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).
-   Для первого прохода используйте фиктивный приемник мультимедиа в выходном узле, так как образцы, созданные в этом проходе, не добавляются в окончательный файл.
-   Для второго прохода запросите кодировщик на наличие требуемых свойств после кодирования и замените фиктивный узел приемника мультимедиа приемником ASF Media, заданными свойствами.

дополнительные сведения о настройке топологии кодирования см. в разделе [учебник. однопроходный Windows кодирование носителя](tutorial--1-pass-windows-media-encoding.md).

следующая процедура описывает действия по кодированию Windows мультимедийного содержимого в контейнере ASF с помощью режима двухсторонней кодировки.

1.  Создайте источник мультимедиа для указанного с помощью сопоставителя источников.
2.  Перечисление потоков в источнике мультимедиа.
3.  Создайте приемник мультимедиа ASF и добавьте приемники потоков в зависимости от потоков в источнике носителя, который необходимо закодировать.
4.  Создайте приемник мультимедиа.
5.  создайте Windowsные кодировщики мультимедиа для потоков в выходном файле.
6.  Настройте кодировщики с помощью 2-проходных свойств кодировки.
7.  Создайте топологию частичной кодировки, подключив источник, кодировщики и приемник мультимедиа.
8.  Создайте экземпляр сеанса мультимедиа и задайте топологию для сеанса мультимедиа.
9.  Запустите первый проход кодирования, управляя сеансом мультимедиа и получением всех соответствующих событий из сеанса мультимедиа.
10. Закройте и завершите сеанс кодирования.
11. Запросите в кодировщике следующие свойства в зависимости от типа кодировки: 

    | Тип кодировки                                                                                        | Имя свойства                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [Кодирование переменной скорости с неограниченным битом](unconstrained-variable-bit-rate--vbr--encoding.md)       | [**МФПКЭЙ \_ пассесусед**](mfpkey-passesusedproperty.md)<br/> [**МФПКЭЙ \_ вбренаблед**](mfpkey-vbrenabledproperty.md)<br/> [**МФПКЭЙ \_ бавг**](mfpkey-bavgproperty.md)<br/> [**МФПКЭЙ \_ равг**](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [Пиковое кодирование с переменным ограничением скорости](peak-constrained-variable-bit-rate--vbr--encoding.md) | [**МФПКЭЙ \_ пассесусед**](mfpkey-passesusedproperty.md)<br/> [**МФПКЭЙ \_ вбренаблед**](mfpkey-vbrenabledproperty.md)<br/> [**МФПКЭЙ \_ бавг**](mfpkey-bavgproperty.md)<br/> [**МФПКЭЙ \_ равг**](mfpkey-ravgproperty.md)<br/> [**МФПКЭЙ \_ бмакс**](mfpkey-bmaxproperty.md)<br/> [**МФПКЭЙ \_ рмакс**](mfpkey-rmaxproperty.md)<br/> |

    

     

12. Создайте приемник файлов ASF и добавьте необходимые приемники потоков в зависимости от потоков, которые необходимо включить в окончательный выходной файл.
13. Задайте свойства кодировщика, полученные на шаге 11, в приемнике файла.
14. Замените приемник мультимедиа в выходном узле вновь созданным приемником файлов.
15. Создайте экземпляр сеанса мультимедиа и настройте обновленную топологию в сеансе мультимедиа.
16. Выполните второй проход кодирования, управляя сеансом мультимедиа и получением всех соответствующих событий из сеанса мультимедиа.
17. Дождитесь события [миндофпресентатион](meendofpresentation.md) из сеанса мультимедиа и обработчика событий получите значения свойств кодировки из кодировщика и задайте их в приемнике файла. дополнительные сведения см. в разделе "обновление свойств кодировки в приемнике файлов" раздела [учебник. однопроходный Windows кодирование носителя](tutorial--1-pass-windows-media-encoding.md).
18. Закройте и завершите сеанс кодирования.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Компоненты ASF уровня конвейера](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




