---
description: Приемник ASF-файлов — это реализация Имфмедиасинк, предоставляемая Media Foundation, которую приложение может использовать для архивации данных ASF Media в файл. Сведения об объектной модели приемников ASF Media и общем использовании см. в статье приемники мультимедиа ASF.
ms.assetid: 991f3345-a6b4-45c2-a89d-3c13c70b6bbc
title: Создание приемника файлов ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c43625bcbc581b4967d4db99cef71a0fc779f070
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104143192"
---
# <a name="creating-the-asf-file-sink"></a>Создание приемника файлов ASF

Приемник ASF-файлов — это реализация [**имфмедиасинк**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) , предоставляемая Media Foundation, которую приложение может использовать для архивации данных ASF Media в файл. Сведения об объектной модели приемников ASF Media и общем использовании см. в статье [приемники мультимедиа ASF](asf-media-sinks.md).

Существует два способа создания экземпляра приемника файлов ASF. Можно вызвать [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) или [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).

При вызове [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink)необходимо указать поток байтов для выходного файла, в который приемник будет записывать содержимое ASF во время сеанса кодирования. Указанный поток байтов должен иметь возможности поиска и записи, в противном случае вызов **мфкреатеасфмедиасинк** завершается с \_ кодом ошибки E Fail. Этот вызов создает внутрипроцессный объект приемника файла и возвращает указатель на интерфейс [**имфмедиасинк**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) приемника файла.

При вызове [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate)необходимо указать URL-адрес выходного файла, в который приемник файла будет записывать данные мультимедиа. В этом случае приемник файла внутренне создает поток байтов. Функция возвращает указатель на интерфейс [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) приемника файла. Кому

Рассмотрите возможность использования [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) вместо [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), если топология кодирования разработана следующим образом:

-   Топология кодирования предназначена для защищенного пути к носителю (PMP), а приемник файла используется вне процесса.
-   Выходной узел топологии создается с помощью возвращенного указателя на объект активации приемника файла, и ваше приложение отслеживает потоки в приемнике файлов по номерам потоков.
    > [!Note]  
    > Вы можете активировать приемник файлов, вызвав [**имфактивате:: активатеобжект**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject). Однако не нужно активировать объект неявно. Сеанс мультимедиа отслеживает объект активации и автоматически активирует приемник файла во время сеанса кодирования.

     

-   Сведения о потоке настраиваются в объекте Контентинфо. Дисукссед в следующем подразделе.

После создания приемника файлов ASF его необходимо настроить перед сборкой топологии. Для создания выходного файла приемнику файла необходимо иметь следующие сведения.

-   Основные сведения о потоке
-   Сведения о режиме кодирования
-   Метаданные

Приемник файла реализует [объект ASF контентинфо](asf-contentinfo-object.md) и предоставляет интерфейс [**имфасфконтентинфо**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) , чтобы приложение может использовать его для установки информации, связанной с потоками и кодировкой. В зависимости от вызываемой функции для создания приемника файла существует два способа получения ссылки на интерфейс **имфасфконтентинфо** .

-   При вызове функции [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) приложение должно запросить интерфейс [**имфасфконтентинфо**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) , вызвав **имфмедиасинк:: QueryInterface** в возвращенном приемнике файла.
-   Если вы решили вызвать [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), эта функция предполагает, что у вас есть полностью настроенный объект контентинфо перед вызовом. Для этого необходимо создать пустой объект Контентинфо, вызвав [**мфкреатеасфконтентинфо**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) , а затем настроить его со всеми необходимыми сведениями. Передайте настроенный объект Контентинфо в **мфкреатеасфмедиасинкактивате** , чтобы получить указатель на объект активации приемника. Невозможно активировать приемник файла с помощью возвращенного объекта активации, а затем изменить все данные потока или кодировки.

Сведения о настройке потоков приемника и конкретных свойств см. в следующих разделах:

-   [Добавление потоковой информации в приемник файлов ASF](adding-stream-information-to-the-asf-file-sink.md)
-   [Задание свойств в приемнике файла](setting-properties-in-the-file-sink.md)
-   [Добавление метаданных в приемник файлов](adding-metadata-to-the-file-sink.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Приемники мультимедиа ASF](asf-media-sinks.md)
</dt> <dt>

[Компоненты ASF уровня конвейера](pipeline-layer-asf-components.md)
</dt> <dt>

[Поддержка ASF в Media Foundation](asf-support-in-media-foundation.md)
</dt> </dl>

 

 



