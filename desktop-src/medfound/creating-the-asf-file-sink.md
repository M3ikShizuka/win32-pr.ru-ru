---
description: Узнайте, как создать приемник файлов ASF, который приложение может использовать для архивации данных ASF Media в файл.
ms.assetid: 991f3345-a6b4-45c2-a89d-3c13c70b6bbc
title: Создание приемника файлов ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6fcd9ea19f0200dfd330f421fd5dac2cd100b702
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112409927"
---
# <a name="creating-the-asf-file-sink"></a><span data-ttu-id="e37db-103">Создание приемника файлов ASF</span><span class="sxs-lookup"><span data-stu-id="e37db-103">Creating the ASF File Sink</span></span>

<span data-ttu-id="e37db-104">Приемник ASF-файлов — это реализация [**имфмедиасинк**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) , предоставляемая Media Foundation, которую приложение может использовать для архивации данных ASF Media в файл.</span><span class="sxs-lookup"><span data-stu-id="e37db-104">The ASF file sink is an implementation of [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) provided by Media Foundation that an application can use to archive ASF media data to a file.</span></span> <span data-ttu-id="e37db-105">Сведения об объектной модели приемников ASF Media и общем использовании см. в статье [приемники мультимедиа ASF](asf-media-sinks.md).</span><span class="sxs-lookup"><span data-stu-id="e37db-105">For information about ASF Media Sinks' object model and general usage, see [ASF Media Sinks](asf-media-sinks.md).</span></span>

<span data-ttu-id="e37db-106">Существует два способа создания экземпляра приемника файлов ASF.</span><span class="sxs-lookup"><span data-stu-id="e37db-106">There are two ways of creating an instance of the ASF file sink.</span></span> <span data-ttu-id="e37db-107">Можно вызвать [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) или [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span><span class="sxs-lookup"><span data-stu-id="e37db-107">You can call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) or [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate).</span></span>

<span data-ttu-id="e37db-108">При вызове [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink)необходимо указать поток байтов для выходного файла, в который приемник будет записывать содержимое ASF во время сеанса кодирования.</span><span class="sxs-lookup"><span data-stu-id="e37db-108">If you call [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), you must specify a byte stream, for the output file, into which the sink will write the ASF content during an encoding session.</span></span> <span data-ttu-id="e37db-109">Указанный поток байтов должен иметь возможности поиска и записи, в противном случае вызов **мфкреатеасфмедиасинк** завершается с \_ кодом ошибки E Fail.</span><span class="sxs-lookup"><span data-stu-id="e37db-109">The specified byte stream must have seekable and writable capabilities otherwise the **MFCreateASFMediaSink** call fails with the E\_FAIL error code.</span></span> <span data-ttu-id="e37db-110">Этот вызов создает внутрипроцессный объект приемника файла и возвращает указатель на интерфейс [**имфмедиасинк**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) приемника файла.</span><span class="sxs-lookup"><span data-stu-id="e37db-110">This call creates an in-process file sink object and returns a pointer to the [**IMFMediaSink**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasink) interface of the file sink.</span></span>

<span data-ttu-id="e37db-111">При вызове [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate)необходимо указать URL-адрес выходного файла, в который приемник файла будет записывать данные мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="e37db-111">If you call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), you must specify the URL of the output file into which the file sink will write media data.</span></span> <span data-ttu-id="e37db-112">В этом случае приемник файла внутренне создает поток байтов.</span><span class="sxs-lookup"><span data-stu-id="e37db-112">In this case, the file sink internally creates the byte stream.</span></span> <span data-ttu-id="e37db-113">Функция возвращает указатель на интерфейс [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) приемника файла.</span><span class="sxs-lookup"><span data-stu-id="e37db-113">The function returns a pointer to the [**IMFActivate**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) interface of the file sink.</span></span> <span data-ttu-id="e37db-114">Кому</span><span class="sxs-lookup"><span data-stu-id="e37db-114">To</span></span>

<span data-ttu-id="e37db-115">Рассмотрите возможность использования [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) вместо [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), если топология кодирования разработана следующим образом:</span><span class="sxs-lookup"><span data-stu-id="e37db-115">Consider [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate) instead of [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink), when your encoding topology is designed as follows:</span></span>

-   <span data-ttu-id="e37db-116">Топология кодирования предназначена для защищенного пути к носителю (PMP), а приемник файла используется вне процесса.</span><span class="sxs-lookup"><span data-stu-id="e37db-116">The encoding topology is for the protected media path (PMP) and the file sink is used out-of-process.</span></span>
-   <span data-ttu-id="e37db-117">Выходной узел топологии создается с помощью возвращенного указателя на объект активации приемника файла, и ваше приложение отслеживает потоки в приемнике файлов по номерам потоков.</span><span class="sxs-lookup"><span data-stu-id="e37db-117">The output node of the topology is created by using the returned pointer to the activate object of the file sink and your application is keeping track of the streams in the file sink by stream numbers.</span></span>
    > [!Note]  
    > <span data-ttu-id="e37db-118">Вы можете активировать приемник файлов, вызвав [**имфактивате:: активатеобжект**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span><span class="sxs-lookup"><span data-stu-id="e37db-118">You can activate the file sink by calling [**IMFActivate::ActivateObject**](/windows/desktop/api/mfobjects/nf-mfobjects-imfactivate-activateobject).</span></span> <span data-ttu-id="e37db-119">Однако не нужно активировать объект неявно.</span><span class="sxs-lookup"><span data-stu-id="e37db-119">However you do not need to activate the object explictly.</span></span> <span data-ttu-id="e37db-120">Сеанс мультимедиа отслеживает объект активации и автоматически активирует приемник файла во время сеанса кодирования.</span><span class="sxs-lookup"><span data-stu-id="e37db-120">The Media Session keeps track of the activation object and activates the file sink automatically during the encoding session.</span></span>

     

-   <span data-ttu-id="e37db-121">Сведения о потоке настраиваются в объекте Контентинфо.</span><span class="sxs-lookup"><span data-stu-id="e37db-121">The stream information is configured in the ContentInfo object.</span></span> <span data-ttu-id="e37db-122">Дисукссед в следующем подразделе.</span><span class="sxs-lookup"><span data-stu-id="e37db-122">Disucssed in the next sub-section.</span></span>

<span data-ttu-id="e37db-123">После создания приемника файлов ASF его необходимо настроить перед сборкой топологии.</span><span class="sxs-lookup"><span data-stu-id="e37db-123">After creating the ASF file sink it must be configured before building the topology.</span></span> <span data-ttu-id="e37db-124">Для создания выходного файла приемнику файла необходимо иметь следующие сведения.</span><span class="sxs-lookup"><span data-stu-id="e37db-124">The file sink needs to know the following information in order to generate the output file.</span></span>

-   <span data-ttu-id="e37db-125">Основные сведения о потоке</span><span class="sxs-lookup"><span data-stu-id="e37db-125">Basic stream information</span></span>
-   <span data-ttu-id="e37db-126">Сведения о режиме кодирования</span><span class="sxs-lookup"><span data-stu-id="e37db-126">Encoding mode information</span></span>
-   <span data-ttu-id="e37db-127">Метаданные</span><span class="sxs-lookup"><span data-stu-id="e37db-127">Metadata</span></span>

<span data-ttu-id="e37db-128">Приемник файла реализует [объект ASF контентинфо](asf-contentinfo-object.md) и предоставляет интерфейс [**имфасфконтентинфо**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) , чтобы приложение может использовать его для установки информации, связанной с потоками и кодировкой.</span><span class="sxs-lookup"><span data-stu-id="e37db-128">The file sink implements the [ASF ContentInfo Object](asf-contentinfo-object.md) and exposes the [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface so that an application can use it to set information related to the streams and encoding.</span></span> <span data-ttu-id="e37db-129">В зависимости от вызываемой функции для создания приемника файла существует два способа получения ссылки на интерфейс **имфасфконтентинфо** .</span><span class="sxs-lookup"><span data-stu-id="e37db-129">Depending on the function you called to create the file sink, there are two ways of getting a reference to the **IMFASFContentInfo** interface.</span></span>

-   <span data-ttu-id="e37db-130">При вызове функции [**мфкреатеасфмедиасинк**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) приложение должно запросить интерфейс [**имфасфконтентинфо**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) , вызвав **имфмедиасинк:: QueryInterface** в возвращенном приемнике файла.</span><span class="sxs-lookup"><span data-stu-id="e37db-130">If you call the [**MFCreateASFMediaSink**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasink) function, the application must query for [**IMFASFContentInfo**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfcontentinfo) interface by calling **IMFMediaSink::QueryInterface** on the returned file sink.</span></span>
-   <span data-ttu-id="e37db-131">Если вы решили вызвать [**мфкреатеасфмедиасинкактивате**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), эта функция предполагает, что у вас есть полностью настроенный объект контентинфо перед вызовом.</span><span class="sxs-lookup"><span data-stu-id="e37db-131">If you choose to call [**MFCreateASFMediaSinkActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfmediasinkactivate), this function expects that you have a fully-configured ContentInfo object prior to the call.</span></span> <span data-ttu-id="e37db-132">Для этого необходимо создать пустой объект Контентинфо, вызвав [**мфкреатеасфконтентинфо**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) , а затем настроить его со всеми необходимыми сведениями.</span><span class="sxs-lookup"><span data-stu-id="e37db-132">To do this, you need to create an empty ContentInfo object by calling [**MFCreateASFContentInfo**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfcontentinfo) and then configure it with all the required information.</span></span> <span data-ttu-id="e37db-133">Передайте настроенный объект Контентинфо в **мфкреатеасфмедиасинкактивате** , чтобы получить указатель на объект активации приемника.</span><span class="sxs-lookup"><span data-stu-id="e37db-133">Pass the configured ContentInfo object to the **MFCreateASFMediaSinkActivate** to receive a pointer to the sink activate object.</span></span> <span data-ttu-id="e37db-134">Невозможно активировать приемник файла с помощью возвращенного объекта активации, а затем изменить все данные потока или кодировки.</span><span class="sxs-lookup"><span data-stu-id="e37db-134">You cannot activate the file sink by using the returned activation object and then change any stream or encoding information.</span></span>

<span data-ttu-id="e37db-135">Сведения о настройке потоков приемника и конкретных свойств см. в следующих разделах:</span><span class="sxs-lookup"><span data-stu-id="e37db-135">For information about configuring sink streams and specific properties, see the following topics:</span></span>

-   [<span data-ttu-id="e37db-136">Добавление потоковой информации в приемник файлов ASF</span><span class="sxs-lookup"><span data-stu-id="e37db-136">Adding Stream Information to the ASF File Sink</span></span>](adding-stream-information-to-the-asf-file-sink.md)
-   [<span data-ttu-id="e37db-137">Задание свойств в приемнике файла</span><span class="sxs-lookup"><span data-stu-id="e37db-137">Setting Properties in the File Sink</span></span>](setting-properties-in-the-file-sink.md)
-   [<span data-ttu-id="e37db-138">Добавление метаданных в приемник файлов</span><span class="sxs-lookup"><span data-stu-id="e37db-138">Adding Metadata to the File Sink</span></span>](adding-metadata-to-the-file-sink.md)

## <a name="related-topics"></a><span data-ttu-id="e37db-139">Связанные темы</span><span class="sxs-lookup"><span data-stu-id="e37db-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e37db-140">Приемники мультимедиа ASF</span><span class="sxs-lookup"><span data-stu-id="e37db-140">ASF Media Sinks</span></span>](asf-media-sinks.md)
</dt> <dt>

[<span data-ttu-id="e37db-141">Компоненты ASF уровня конвейера</span><span class="sxs-lookup"><span data-stu-id="e37db-141">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> <dt>

[<span data-ttu-id="e37db-142">Поддержка ASF в Media Foundation</span><span class="sxs-lookup"><span data-stu-id="e37db-142">ASF Support in Media Foundation</span></span>](asf-support-in-media-foundation.md)
</dt> </dl>

 

 



