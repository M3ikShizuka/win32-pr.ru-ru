---
description: Пользовательские Миксерс
ms.assetid: a0af318d-9ac2-43f9-8934-f28c472256a6
title: Пользовательские Миксерс
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 587206f7bc34d1fad4a64a12aeff9ab8ad21e18a84c92c8f2302776fdc126a68
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119605994"
---
# <a name="custom-mixers"></a>Пользовательские Миксерс

В этом разделе описывается написание пользовательского микшера для расширенного обработчика видео (Евр). пользовательское микшер можно использовать с Media Foundation приемника мультимедиа евр или DirectShow фильтре евр. Дополнительные сведения о миксерс и выступающих см. в разделе [Улучшенный модуль подготовки видео](enhanced-video-renderer.md).

Микшер — это Media Foundation преобразование (MFT) с одним или несколькими входными данными (потоком ссылок и подпотоками) и одним выходом. Входной поток получает образцы из вышестоящего потока. Поток вывода предоставляет примеры для выступающего. Евр отвечает за вызов [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) в микшере, и выступающий отвечает за вызов [**Имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).

Как минимум, микшер Евр должен реализовывать следующие интерфейсы:



| Интерфейс                                                                | Описание                                                                                      |
|--------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
| [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform)                                     | Предоставляет базовые функциональные возможности MFT.                                                                 |
| [**имфтопологисервицелукупклиент**](/windows/desktop/api/evr/nn-evr-imftopologyservicelookupclient) | Позволяет микшеру получать интерфейсы из Евр.                                                |
| [**имфвидеодевицеид**](/windows/desktop/api/evr/nn-evr-imfvideodeviceid)                             | Позволяет микшеру получать интерфейсы из Евр.                                                |
| [**имфаттрибутес**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes)                                   | Используется для предоставления Евр атрибуту [**MF \_ SA с \_ \_ поддержкой D3D**](mf-sa-d3d-aware-attribute.md) . |



 

Кроме того, MFT может реализовывать любой из следующих интерфейсов:



| Интерфейс                                                | Описание                                                                                                                                          |
|----------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**иевртрустедвидеоплугин**](/windows/desktop/api/evr/nn-evr-ievrtrustedvideoplugin) | Требуется для воспроизведения защищенного содержимого.                                                                                                                  |
| [**имфжетсервице**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice)                   | Предоставляет приложениям такие интерфейсы, как [**имфвидеомиксербитмап**](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap) и [**имфвидеопроцессор**](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor) . |
| [**имфкуалитядвисе**](/windows/desktop/api/mfidl/nn-mfidl-imfqualityadvise)             | Позволяет диспетчеру качества настроить качество видео.                                                                                             |
| [**имфвидеомиксербитмап**](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap)       | Позволяет приложению смешивать статический точечный рисунок на видео.                                                                                       |
| [**имфвидеопоситионмаппер**](/windows/desktop/api/evr/nn-evr-imfvideopositionmapper) | Карты координаты выходного видеокадра для координат на входном видеокадре.                                                                  |
| [**имфвидеопроцессор**](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor)           | Предоставляет приложению некоторые функции обработки видео ДКСВА.                                                                                      |



 

Форматирование согласования с микшером работает следующим образом:

1.  Евр задает тип носителя в ссылочном потоке.
2.  Евр вызывает [**имфвидеопресентер::P роцессмессаже**](/windows/desktop/api/evr/nf-evr-imfvideopresenter-processmessage) в выступающих с сообщением **мфвп \_ Message \_ инвалидатемедиатипе** .

3.  Выступающий задает тип носителя для выходного потока микшера.
4.  Евр задает тип носителя для подпотоков.

Если тип носителя в ссылочном потоке изменяется, другие типы мультимедиа для микшера больше не действительны. После этого метод микшера [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) будет завершаться сбоем и возвращать **\_ \_ \_ \_ изменение потока преобразования MF E**. В данный момент выступающий не должен ничего делать. Евр запустит процесс согласования формата еще раз.

Когда входной поток достигает конца потока, ЕВР вызывает [**имфтрансформ::P роцессмессаже**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) на микшере с [**\_ \_ уведомлением об \_ окончании \_ \_ потока в MFT**](mft-message-notify-end-of-stream.md).

Микшер отправляет следующие события в Евр с помощью интерфейса [**ИМЕДИАЕВЕНТСИНК**](/windows/win32/api/strmif/nn-strmif-imediaeventsink) Евр. этот интерфейс описан в документации по DirectShow SDK.



| Событие                                            | Описание                            |
|--------------------------------------------------|----------------------------------------|
| [**\_требуется образец \_ EC**](../directshow/ec-sample-needed.md) | Для микшера требуется новый входной пример. |



 

Евр может вызвать [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) в микшере перед запуском потоковой передачи. Микшер не должен завершать эти вызовы. Вместо этого он должен заполнить поверхность вывода черными пикселами. Микшер должен продолжать выдавать образцы вывода цветов, пока не получит сообщение [**MFT Отправка сообщения \_ \_ о \_ начале \_ потоковой передачи**](mft-message-notify-begin-streaming.md) или вызывается метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) . Если микшер получает сообщение [**\_ \_ о \_ завершении \_ потоковой передачи сообщения MFT**](mft-message-notify-end-streaming.md) , он должен переключиться обратно в режим заливки цвета.

## <a name="implementing-imfvideodeviceid"></a>Реализация Имфвидеодевицеид

Интерфейс [**имфвидеодевицеид**](/windows/desktop/api/evr/nn-evr-imfvideodeviceid) содержит один метод [**GetDeviceID**](/windows/desktop/api/evr/nf-evr-imfvideodeviceid-getdeviceid), который возвращает GUID устройства. GUID устройства гарантирует, что выступающий и микшер используют совместимые технологии. Если идентификаторы GUID устройства не совпадают, инициализация Евр не выполняется.

Стандартный микшер и настоящее устройство используют Direct3D 9 с идентификатором GUID устройства, равным IID \_ IDirect3DDevice9. Если вы планируете использовать пользовательский выступающий со стандартным микшером, то GUID устройства выступающего должен быть IID \_ IDirect3DDevice9. При замене обоих компонентов можно определить новый GUID устройства.

## <a name="implementing-imftopologyservicelookupclient"></a>Реализация Имфтопологисервицелукупклиент

Микшер должен реализовывать интерфейс [**имфтопологисервицелукупклиент**](/windows/desktop/api/evr/nn-evr-imftopologyservicelookupclient) . Перед началом потоковой передачи Евр вызывает [**имфтопологисервицелукупклиент:: инитсервицепоинтерс**](/windows/desktop/api/evr/nf-evr-imftopologyservicelookupclient-initservicepointers) и передает указатель на интерфейс [**имфтопологисервицелукуп**](/windows/desktop/api/evr/nn-evr-imftopologyservicelookup) Евр. Микшер использует этот указатель для получения указателей интерфейса из Евр.

Как минимум, микшер должен запрашивать следующий интерфейс:

-   [**имедиаевентсинк**](/windows/win32/api/strmif/nn-strmif-imediaeventsink)

Когда Евр вызывает [**имфтопологисервицелукупклиент:: релеасесервицепоинтерс**](/windows/desktop/api/evr/nf-evr-imftopologyservicelookupclient-releaseservicepointers), микшер должен освободить все указатели, полученные из вызова [**инитсервицепоинтерс**](/windows/desktop/api/evr/nf-evr-imftopologyservicelookupclient-initservicepointers).

## <a name="mixer-attributes"></a>Mixer Атрибута

Микшер должен поддерживать следующие атрибуты.



| attribute                                                                        | Описание                                                                                                                                                                                                                                           |
|----------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**С \_ \_ поддержкой D3D \_ SA**](mf-sa-d3d-aware-attribute.md)                          | Указывает, поддерживает ли микшер ускорение видео DirectX (ДКСВА).                                                                                                                                                                               |
| [**\_ \_ \_ число выборок, требуемых для SA MF \_**](mf-sa-required-sample-count-attribute.md) | Количество видеороликов, которые Евр должны выделить для каждого потока микшера. Этот атрибут применяется к отдельным потокам; Используйте хранилище атрибутов, возвращенное [**имфтрансформ:: жетинпутстреаматтрибутес**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreamattributes). |



 

## <a name="setting-the-mixer-on-the-evr"></a>установка Mixer в евр

Чтобы задать пользовательское микшер в евр, вызовите [**имфвидеорендерер:: инитиализерендерер**](/windows/desktop/api/evr/nf-evr-imfvideorenderer-initializerenderer). этот метод реализуется как DirectShow фильтром евр, так и приемником носителей евр.

**Объект активации Евр**. При использовании объекта активации Евр можно предоставить пользовательский микшер, задав один из следующих атрибутов в объекте активации Евр:



| attribute                                                                                                 | Описание                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
| [**MF \_ Активация \_ настраиваемого \_ \_ видеомикшера \_ активировать**](mf-activate-custom-video-mixer-activate-attribute.md) | Указатель на объект активации для микшера. Объект активации должен реализовывать интерфейс [**имфактивате**](/windows/desktop/api/mfobjects/nn-mfobjects-imfactivate) . |
| [**MF \_ Активация \_ пользовательского \_ \_ идентификатора CLSID микшера видео \_**](mf-activate-custom-video-mixer-clsid-attribute.md)       | Идентификатор CLSID микшера.                                                                                                                   |



 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Улучшенный модуль подготовки видео](enhanced-video-renderer.md)
</dt> </dl>

 

 
