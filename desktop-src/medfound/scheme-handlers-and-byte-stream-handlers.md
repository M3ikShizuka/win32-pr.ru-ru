---
description: В этом разделе описаны внутренние сведения о том, как сопоставитель источников создает источник мультимедиа.
ms.assetid: b0113527-f22c-4519-b1cf-fea54bff4090
title: Обработчики схем и обработчики Byte-Stream
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2f5cbb2ee0af93e456e86b6eab16ff44705f5380
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122881772"
---
# <a name="scheme-handlers-and-byte-stream-handlers"></a>Обработчики схем и обработчики Byte-Stream

В этом разделе описаны внутренние сведения о том, как сопоставитель источников создает источник мультимедиа. Прочтите этот раздел, если вы реализуете пользовательский источник мультимедиа для Media Foundation и хотите, чтобы источник мультимедиа был доступен приложениям через сопоставитель источников.

Сопоставитель источников может создать источник мультимедиа на основе URL-адреса или потока байтов (то есть [**имфбитестреам**](/windows/desktop/api/mfobjects/nn-mfobjects-imfbytestream) указателя). Для этого он использует вспомогательные объекты, называемые *обработчиками*. Для URL-адресов сопоставитель источников использует *обработчики схем*. Для байтовых потоков используется *обработчики потока байтов*.

Обработчик схемы принимает в качестве входных данных URL-адрес и создает источник мультимедиа или поток байтов. Если он создает поток байтов, сопоставитель источника передает его в обработчик потока байтов, который создает источник мультимедиа. Этот процесс показан на следующем рисунке.

![Схема, показывающая процесс разрешения источника](images/f2ade1a8-6f2a-4e40-8cda-2ccf576880c6.gif)

## <a name="scheme-handlers"></a>Обработчики схем

Обработчики схем используются, когда приложение вызывает [**имфсаурцересолвер:: креатеобжектфромурл**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-createobjectfromurl) или его асинхронный эквивалент, [**бегинкреатеобжектфромурл**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl).

Сопоставитель источников ищет обработчики схем в реестре. Обработчики схем перечисляются по схеме URL-адресов в следующих разделах:

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows Media Foundation
            SchemeHandlers
               <scheme>
                  {00000000-0000-0000-0000-000000000000} = REG_SZ
```

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows Media Foundation
            SchemeHandlers
               <scheme>
                  {00000000-0000-0000-0000-000000000000} = REG_SZ
```

где *&lt; схема &gt;* — это схема URL-адресов, которую обработчик предназначен для анализа. Схема включает символ ":" в конце; Например, "http:".

Чтобы зарегистрировать новый обработчик схемы, добавьте запись, имя которой является идентификатором CLSID обработчика схемы, в канонической строковой форме: `{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}` . Значением записи является строка (REG \_ SZ), содержащая краткое описание обработчика, например "мой обработчик схемы". Важной частью записи является CLSID. Сопоставитель источника создает обработчик, вызывая **CoCreateInstance** с этим идентификатором CLSID.

Обработчики схем предоставляют интерфейс [**имфсчемехандлер**](/windows/desktop/api/mfidl/nn-mfidl-imfschemehandler) . Если сопоставитель источника обнаруживает обработчик схемы, соответствующий схеме URL-адреса, сопоставитель источника вызывает [**имфсчемехандлер:: бегинкреатеобжект**](/windows/desktop/api/mfidl/nf-mfidl-imfschemehandler-begincreateobject), передавая исходный URL-адрес. Обработчик схемы откроет URL-адрес и попытается проанализировать содержимое. На этом этапе обработчик схемы имеет два варианта:

-   Создайте источник мультимедиа.
-   Создание потока байтов.

При создании источника мультимедиа сопоставитель источника Возвращает источник мультимедиа для приложения. Если он создает поток байтов, сопоставитель источника пытается найти соответствующий обработчик потока байтов, как описано в следующем разделе.

## <a name="byte-stream-handlers"></a>Обработчики Byte-Stream

Обработчики потока байтов используются, когда приложение вызывает [**имфсаурцересолвер:: креатеобжектфромбитестреам**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-createobjectfrombytestream) или его асинхронный эквивалент, [**бегинкреатеобжектфромбитестреам**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream). Они также используются, когда обработчик схемы возвращает поток байтов, как описано выше.

Как и в случае с обработчиками схем, в реестре перечислены обработчики потока байтов. Они перечислены либо по расширению имени файла, либо по типу MIME (или к обоим), в следующих разделах:

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows Media Foundation
            ByteStreamHandlers
               <ExtensionOrMimeType>
                  {00000000-0000-0000-0000-000000000000} = REG_SZ
```

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows Media Foundation
            ByteStreamHandlers
               <ExtensionOrMimeType>
                  {00000000-0000-0000-0000-000000000000} = REG_SZ
```

где *&lt; екстенсионормиметипе &gt;* — это расширение имени файла или тип MIME. Расширения файлов включают в себя начальный символ "."; Например, ". wmv".

Расширение имени файла является частью URL-адреса, предоставленного приложением. Тип MIME может быть доступен через атрибут [**\_ \_ \_ типа содержимого MF BYTESTREAM**](mf-bytestream-content-type-attribute.md) в байтовом потоке.

Чтобы зарегистрировать новый обработчик потока байтов, добавьте запись, имя которой является идентификатором CLSID обработчика, в канонической форме строки. Значение записи — это строка (REG \_ SZ), содержащая краткое описание обработчика, например «мой обработчик Byte-Stream». Сопоставитель источников вызывает **CoCreateInstance** для создания обработчика из идентификатора CLSID. Один и тот же обработчик можно зарегистрировать в нескольких расширениях или типах MIME.

Обработчики потока байтов предоставляют интерфейс [**имфбитестреамхандлер**](/windows/desktop/api/mfidl/nn-mfidl-imfbytestreamhandler) . Если сопоставитель источника находит соответствующий обработчик потока байтов, он вызывает [**имфбитестреамхандлер:: бегинкреатеобжект**](/windows/desktop/api/mfidl/nf-mfidl-imfbytestreamhandler-begincreateobject). Входные данные для этого метода являются указателем на байтовый поток, а также исходным URL-адресом, если он доступен. Обработчик потока байтов считывает данные из потока байтов до тех пор, пока не проанализирует достаточно данных для создания источника мультимедиа.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Сопоставитель источников](source-resolver.md)
</dt> </dl>

 

 



