---
description: Каждый файл ASF содержит один или несколько потоков. Объект профиля ASF представляет коллекцию потоков ASF. Для кодирования ASF необходимо создать и настроить потоки, которые необходимо закодировать.
ms.assetid: cc89e8bc-58ff-48e2-9668-0dcd6cfd25e1
title: Создание и настройка потоков ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8eabce588022dd66947f34e4dcd9db61f26448b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105656099"
---
# <a name="creating-and-configuring-asf-streams"></a>Создание и настройка потоков ASF

Каждый файл ASF содержит один или несколько потоков. Объект [профиля ASF](asf-profile.md) представляет коллекцию потоков ASF. Для кодирования ASF необходимо создать и настроить потоки, которые необходимо закодировать.

Приложение может выполнять следующие задачи с помощью объекта профиля ASF:

-   Добавление или удаление потока.
-   Получение параметров конфигурации потока.
-   Настройка расширений полезных данных.
-   Добавление, удаление или изменение объекта взаимного исключения ASF.

В этом разделе содержатся следующие подразделы.

-   [Создание нового потока](#creating-a-new-stream)
-   [Назначение номеров потоков](#assigning-stream-numbers)
-   [Настройка значений сегментов с утечкой](#setting-leaky-bucket-values)
-   [Расширения полезных данных](#payload-extensions)
-   [Добавление потока в профиль](#adding-a-stream-to-the-profile)
-   [См. также](#related-topics)

## <a name="creating-a-new-stream"></a>Создание нового потока

Объект профиля ASF должен содержать параметры конфигурации по крайней мере для одного потока ASF. Каждый поток представлен объектом *конфигурации потока* , который предоставляет интерфейс [**имфасфстреамконфиг**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfstreamconfig) . Сведения в объекте конфигурации потока соответствуют объекту свойств потока и объектам расширенных свойств потока в заголовке файла ASF. (См. раздел [Структура файлов ASF](asf-file-structure.md).)

Чтобы добавить поток в профиль ASF, выполните следующие действия.

1.  Создайте объект конфигурации пустого потока потока.
2.  Настройте поток в соответствии с требованиями приложения.
3.  Добавьте поток в профиль.

Чтобы создать поток для профиля, вызовите метод [**имфасфпрофиле:: креатестреам**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-createstream) , чтобы создать пустой объект конфигурации потока и получить указатель в параметре *ппистреам* . **Креатестреам** должен иметь тип создаваемого потока. Наиболее распространенными типами потоков, используемых в файлах ASF, являются потоки аудио и видео. В Media Foundation типы потоков обозначаются объектом типа мультимедиа, предоставляющим интерфейс [**имфмедиатипе**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediatype) . Основной тип носителя определяет категорию потока цифрового мультимедиа, например аудио или видео. Подтип определяет формат основного типа. Начальный тип носителя, заданный **креатестреам** , можно изменить с помощью объекта конфигурации Steam. Чтобы получить тип мультимедиа для потока, вызовите метод [**имфасфстреамконфиг:: жетмедиатипе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-getmediatype) или, чтобы получить основной тип вызова [**Имфасфстреамконфиг:: жетстреамтипе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-getstreamtype). Исходный тип носителя для потока можно заменить новым настроенным типом мультимедиа путем вызова [**имфасфстреамконфиг:: сетмедиатипе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-setmediatype).

Значение, если приложение создает профиль из допустимого дескриптора представления путем вызова [**мфкреатеасфпрофилефромпресентатиондескриптор**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreateasfprofilefrompresentationdescriptor). Функция автоматически задает объекты конфигурации потока для каждого потока и задает их в профиле. Типы потоковых мультимедиа задаются на основе дескрипторов потоков, связанных с идентификатором представления.

## <a name="assigning-stream-numbers"></a>Назначение номеров потоков

Потокам всех типов должен быть присвоен номер потока. Номера потоков не должны быть последовательными, но должны находиться в диапазоне от 1 до 127. Чтобы назначить номера потоков, вызовите метод [**имфасфстреамконфиг:: сетстреамнумбер**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-setstreamnumber). Чтобы получить вызов номера потока, [**имфасфстреамконфиг:: жетстреамнумбер**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-getstreamnumber).

> [!Note]  
> Номер потока отличается от индекса потока, который используется при получении потоков в профиле с помощью [**имфасфпрофиле::-Stream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream). Индекс потока — это число, присвоенное потоку объектом Profile. Индексы потоков находятся в диапазоне от 0 до числа потоков, полученных с помощью [**имфасфпрофиле:: жетстреамкаунт**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstreamcount). Вы также можете получить поток из профиля по номеру потока, вызвав [**имфасфпрофиле:: жетстреамбинумбер**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstreambynumber).

 

## <a name="setting-leaky-bucket-values"></a>Настройка значений сегментов с утечкой

Каждый объект конфигурации потока, представляющий поток, должен иметь связанные параметры сегмента утечки, скорость потока и значения окна буфера.

Эти значения доступны для приложения с помощью атрибута [**MF \_ асфстреамконфиг \_ LEAKYBUCKET1**](mf-asfstreamconfig-leakybucket1-attribute.md) и атрибута [**MF \_ асфстреамконфиг \_ LEAKYBUCKET2**](mf-asfstreamconfig-leakybucket2-attribute.md) . Для кодировки файлов фактические значения зависят от типа кодировки и определяются кодировщиком. Если у вас уже есть настроенный кодировщик и для кодировщика задан тип выходных данных, приложение должно запросить у кодировщика параметры сегмента утечки и задать значения в этих атрибутах.

Если вы используете компоненты уровня конвейера и настраиваете потоки для приемника мультимедиа ASF, скорее всего, у вас нет настроенного кодировщика. В этом случае необходимо запросить согласования типов кодировщика после носителя и задать обновленное значение в свойстве [**мфпкэй \_ асфстреамсинк \_ исправлена \_ леакибуккет**](mfpkey-asfstreamsink-corrected-leakybucket-property.md) хранилища свойств приемника ASF Media. Хранилище свойств кодирования извлекается с помощью объекта Контентинфо, связанного с профилем. Обновленные значения автоматически отражаются в значениях атрибута контейнера утечки потока. Общие сведения о сегментах утечки и о том, как получить значение сегмента утечки из кодировщика, см. в разделе [модель буфера для сегмента утечки](the-leaky-bucket-buffer-model.md).

## <a name="payload-extensions"></a>Расширения полезных данных

Данные мультимедиа для потоков добавляются в объект данных ASF в качестве [образцов мультимедиа](media-samples.md) [мультиплексора ASF](asf-multiplexer.md). Эти примеры носителей могут содержать данные расширения полезных данных: данные кода времени SMPTE, неквадратные пропорции, длительность выборки и, если в примере он содержится, кадр контрольного ключа. Список поддерживаемых типов расширений полезных данных см. в разделе [идентификаторы GUID расширения полезных данных ASF](asf-payload-extension-guids.md).

Поток должен быть настроен для приема расширения полезных данных, чтобы во время создания примера мультиплексор мог добавить дополнительные данные в каждый выбор для этого потока.

Чтобы получить общее число расширений полезной нагрузки, установленных в потоке, вызовите [**имфасфстреамконфиг:: жетпайлоадекстенсионкаунт**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-getpayloadextensioncount) , а затем перечислите список, вызвав [**Имфасфстреамконфиг:: жетпайлоадекстенсион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-getpayloadextension). Чтобы добавить расширение полезных данных для потока, вызовите метод [**имфасфстреамконфиг:: аддпайлоадекстенсион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-addpayloadextension). Это приведет к добавлению дополнительных данных в отдельные примеры носителей, созданные для потока.

Чтобы удалить существующие расширения полезных данных, связанные с потоком, вызовите [**имфасфстреамконфиг:: ремовеаллпайлоадекстенсионс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfstreamconfig-removeallpayloadextensions).

## <a name="adding-a-stream-to-the-profile"></a>Добавление потока в профиль

После настройки потока вызовите [**имфасфпрофиле:: сетстреам**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-setstream) , чтобы добавить поток в профиль.

Чтобы удалить существующий поток в профиле, вызовите метод [**имфасфпрофиле:: ремовестреам**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-removestream).

Настроенный профиль должен быть установлен для объекта Контентинфо путем вызова [**имфасфконтентинфо:: сетпрофиле**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfcontentinfo-setprofile). При внесении изменений в существующий поток необходимо снова добавить его в профиль и задать профиль для объекта Контентинфо.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Профиль ASF](asf-profile.md)
</dt> <dt>

[Поддержка ASF в Media Foundation](asf-support-in-media-foundation.md)
</dt> <dt>

[Компоненты ASF Вмконтаинер](wmcontainer-asf-components.md)
</dt> </dl>

 

 



