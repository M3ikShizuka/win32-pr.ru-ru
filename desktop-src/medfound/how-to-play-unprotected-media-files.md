---
description: В этом руководстве показано, как воспроизвести файлы мультимедиа с помощью объекта сеанса мультимедиа.
ms.assetid: cdd67082-8153-4f48-abc5-278be82ae082
title: Воспроизведение мультимедийных файлов с помощью Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 163dba2f9f67139ce7477470889e13a54e2c8b5d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "104554665"
---
# <a name="how-to-play-media-files-with-media-foundation"></a>Воспроизведение мультимедийных файлов с помощью Media Foundation

В этом руководстве показано, как воспроизвести файлы мультимедиа с помощью объекта [сеанса мультимедиа](media-session.md) .

## <a name="prerequisites"></a>Предварительные условия

Прежде чем читать этот раздел, необходимо ознакомиться со следующими концепциями Media Foundation:

-   [Сеанс мультимедиа](media-session.md)
-   [Сопоставитель источников](source-resolver.md)
-   [Топологии](topologies.md)
-   [Генераторы событий мультимедиа](media-event-generators.md)
-   [Дескрипторы представления](presentation-descriptors.md)

> [!Note]  
> В этом разделе не описывается воспроизведение файлов, защищенных с помощью управления цифровыми правами (DRM). Сведения о DRM в Microsoft Media Foundation см. в разделе [Воспроизведение защищенных файлов мультимедиа](how-to-play-protected-media-files.md).

 

## <a name="overview"></a>Обзор

Для воспроизведения файла мультимедиа с помощью сеанса мультимедиа используются следующие объекты:

-   *Источник мультимедиа* — это объект, который анализирует файл мультимедиа или другой источник данных мультимедиа. Источник мультимедиа создает объекты *потока* для каждого звукового или видеопотока в файле. *Декодеры* преобразуют закодированные данные мультимедиа в несжатые видео и аудио.
-   *Сопоставитель источников* создает источник мультимедиа по URL-адресу.
-   [Расширенный обработчик видео](enhanced-video-renderer.md) (Евр) визуализирует видео на экране.
-   [Потоковая прорисовка звука](streaming-audio-renderer.md) (САР) визуализирует звук на динамике или другом устройстве вывода звука.
-   *Топология* определяет поток данных из источника мультимедиа в Евр и САР.
-   *Сеанс мультимедиа* управляет потоком данных и отправляет события состояния в приложение. Этот процесс представлен на схеме ниже.

![Диаграмма, показывающая воспроизведение с помощью сеанса мультимедиа](images/session-playback.gif)

Ниже приведена общая структура действий, необходимых для воспроизведения файла мультимедиа с помощью сеанса мультимедиа.

1.  Вызовите функцию [**мфстартуп**](/windows/desktop/api/mfapi/nf-mfapi-mfstartup) для инициализации платформы Media Foundation.
2.  Вызовите [**мфкреатемедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatemediasession) , чтобы создать новый экземпляр сеанса мультимедиа.
3.  Используйте сопоставитель источников для создания источника мультимедиа. Дополнительные сведения см. [в разделе Использование сопоставителя источников](using-the-source-resolver.md).
4.  Создайте топологию, соединяющую источник мультимедиа с ЕВР и САР. На этом шаге приложение создает *частичную* топологию, в которую не входят декодеры. Дополнительные сведения см. в разделе [Создание топологий воспроизведения](creating-playback-topologies.md).
5.  Вызовите [**имфмедиасессион:: сеттопологи**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-settopology) , чтобы задать топологию для сеанса мультимедиа.
6.  Используйте интерфейс [**имфмедиаевентженератор**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) для получения событий из сеанса мультимедиа.
7.  Вызовите [**имфмедиасессион:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-start) , чтобы начать воспроизведение. После начала воспроизведения его можно приостановить, вызвав метод [**имфмедиасессион::P Аусе**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-pause), или остановите его, вызвав [**Имфмедиасессион:: Остановите**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-stop).
8.  При выходе из приложения ресурсы выпуска:

    1.  Вызовите метод [**имфмедиасессион:: Close**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-close) , чтобы закрыть сеанс мультимедиа. Этот метод является асинхронным. По завершении сеанс мультимедиа отправляет событие [месессионклосед](mesessionclosed.md) . Затем можно выполнить оставшиеся действия.
    2.  Вызовите [**имфмедиасаурце:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown) , чтобы завершить работу источника мультимедиа.
    3.  Вызовите [**имфмедиасессион:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasession-shutdown) , чтобы завершить сеанс мультимедиа.
    4.  Вызовите [**мфшутдовн**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown) , чтобы завершить работу платформы Media Foundation.

В следующих разделах показан полный пример кода:

-   [Шаг 1. объявление класса Кплайер](step-1--declare-the-cplayer-class.md)
-   [Шаг 2. Создание объекта Кплайер](step-2--create-the-cplayer-object.md)
-   [Шаг 3. Открытие файла мультимедиа](step-3--open-a-media-file.md)
-   [Шаг 4. Создание сеанса мультимедиа](step-4--create-the-media-session.md)
-   [Шаг 5. Работа с событиями сеанса мультимедиа](step-5--handle-media-session-events.md)
-   [Шаг 6. Управление воспроизведением](step-6--control-playback.md)
-   [Шаг 7. Завершение сеанса мультимедиа](step-7--shut-down-the-media-session.md)
-   [Пример воспроизведения сеанса мультимедиа](media-session-playback-example.md)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сеанс мультимедиа](media-session.md)
</dt> <dt>

[Воспроизведение звука/видео](audio-video-playback.md)
</dt> </dl>

 

 



