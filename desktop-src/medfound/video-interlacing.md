---
description: Чередование видео
ms.assetid: 2911ae57-1703-4a9d-bd33-94af1e0f8804
title: Чередование видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec10f49ef21f3701f85467a3f4a1c4b08d69df72
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105701793"
---
# <a name="video-interlacing"></a>Чередование видео

В этом разделе описывается, как источники и декодеры мультимедиа должны работать с чередованием видеоматериалов.

Чтобы правильно декодировать и визуализировать видео с чередованием, необходимы следующие сведения:

-   Прогрессивная или чересстрочная развертка. Видеопоток может содержать прогрессивные кадры, чередующиеся кадры или их сочетание.

-   Поле превосходство. Поле превосходство описывает поле, отображаемое первым, верхнее поле или нижнее поле.

-   Повторите первое поле. Этот флаг используется в выпадающих до 3:2, если кадр является прогрессивным, но поток находится в режиме чередования. В этом контексте первое поле может быть полем верхнего или нижнего уровня.

-   Поля с чередованием или одно поле. Пример может содержать одно поле или два поля с чередованием. Если образец содержит одно поле, высота выборки составляет половину высоты рамки, так как этот пример содержит только половину строк сканирования для кадра. Рекомендуется использовать поля с чередованием, если только характеристики исходного содержимого не зависят от других характеристик.

Любая из этих характеристик может изменяться от одного образца к другому. Однако компоненты видео должны знать что-то о общем содержимом перед началом потоковой передачи. Например, если видео является чередованием, расширенному обработчику видео (Евр) требуется зарезервировать видеопамять для устранения неразрывной развертки. Если видео является полностью прогрессивным кадром, с другой стороны, ЕВР может оптимизировать конвейер отрисовки. Добавление шага дечередования в конвейер увеличивает задержку визуализации.

Сведения о чересстрочную развертке хранятся в двух местах:

-   Общие сведения о чересстрочную развертке в потоке помещаются в тип мультимедиа. Дополнительные сведения о типах носителей см. в разделе [типы носителей](media-types.md).

-   Сведения, которые могут изменяться при каждом примере, помещаются в пример как атрибут. Дополнительные сведения о примерах см. в разделе [примеры носителей](media-samples.md).

## <a name="interlace-information-in-the-media-type"></a>Развертка информации в типе мультимедиа

Атрибут [**\_ \_ \_ режима чересстрочная развертки MF**](mf-mt-interlace-mode-attribute.md) для типа носителя описывает, как осуществляется чередование потока в целом. Значение этого атрибута является членом перечисления [**мфвидеоинтерлацемоде**](/windows/desktop/api/mfobjects/ne-mfobjects-mfvideointerlacemode) . Тип мультимедиа всегда должен иметь этот атрибут.

-   Если поток содержит только прогрессивные кадры без чередующихся кадров, используйте Мфвидеоинтерлаце \_ прогрессивный.
-   Если поток содержит только чередующиеся кадры, а каждый образец содержит два поля с чередованием, используйте Мфвидеоинтерлаце \_ фиелдинтерлеаведупперфирст или мфвидеоинтерлаце \_ фиелдинтерлеаведловерфирст.
-   Если поток содержит только чередующиеся кадры, а каждый пример содержит одно поле, используйте Мфвидеоинтерлаце \_ фиелдсинглеуппер или мфвидеоинтерлаце \_ фиелдсинглеловер. Если поля переходят между верхним и нижним, то не имеет значения, какое из этих двух значений используется. Если формат содержит только верхние поля или просто более низкие поля, задайте значение, соответствующее содержимому.
-   Если поток содержит сочетание чередующихся и последовательных кадров или если поле превосходство, задайте для типа носителя значение Мфвидеоинтерлаце \_ миксединтерлацеорпрогрессиве. Используйте примеры атрибутов для описания каждого кадра.

В следующей таблице приведена сводка по этому атрибуту.



| \_ \_ режим чересстрочную РАЗВЕРТКи MF \_                       | Чередующиеся? | Примеры                                  | Первое поле    |
|-----------------------------------------------|-------------|------------------------------------------|----------------|
| Мфвидеоинтерлаце \_ прогрессивный                 | Нет          | Прогрессивная рамка                        | Неприменимо |
| Мфвидеоинтерлаце \_ фиелдинтерлеаведупперфирст  | Да         | Поля с чередованием                       | Верхняя первая    |
| Мфвидеоинтерлаце \_ фиелдинтерлеаведловерфирст  | Да         | Поля с чередованием                       | Нижняя первая    |
| Мфвидеоинтерлаце \_ фиелдсинглеуппер            | Да         | Одно поле                             | Верхняя первая    |
| Мфвидеоинтерлаце \_ фиелдсинглеловер            | Да         | Одно поле                             | Нижняя первая    |
| Мфвидеоинтерлаце \_ миксединтерлацеорпрогрессиве | Может варьироваться    | Поля с чередованием или прогрессивные кадры | Может варьироваться       |



 

Поля с чередованием и отдельные поля не могут быть смешанными. Переключение с одного на другой требует изменения типа носителя.

## <a name="interlace-flags-on-samples"></a>Чередование флагов для выборок

Сведения, которые могут изменяться от одного образца к другому, указываются с помощью примеров атрибутов. Чтобы получить или задать эти атрибуты, используйте интерфейс [**имфсампле**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .

Все атрибуты чередования, перечисленные в этом разделе, имеют логические значения. Фактически каждый из этих атрибутов может иметь три значения: **true**, **false** или not set. Если атрибут не задан, значение берется из типа мультимедиа. Если задан атрибут, значение переопределяет тип мультимедиа. Недопустимые сочетания флагов и типов мультимедиа.



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>attribute</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="mfsampleextension-interlaced-attribute.md">MFSampleExtension_Interlaced</a></td>
<td><strong>Значение true</strong>показывает, что кадр является чередованием. Если <strong>значение равно false</strong>, кадр является прогрессивным.<br/> Установите этот атрибут для каждого образца, если тип носителя — MFVideoInterlace_MixedInterlaceOrProgressive.<br/></td>
</tr>
<tr class="even">
<td><a href="mfsampleextension-bottomfieldfirst-attribute.md">MFSampleExtension_BottomFieldFirst</a></td>
<td>Значение этого флага зависит от того, содержат ли образцы поля с чередованием или отдельные поля.<br/>
<ul>
<li>Поля с чередованием: Если <strong>значение равно true</strong>, то нижнее поле является первым. Если <strong>значение равно false</strong>, то верхнее поле является первым.<br/></li>
<li>Одиночные поля: Если <strong>значение true</strong>, образец содержит меньшее поле. Если <strong>значение равно false</strong>, образец содержит верхнее поле.<br/></li>
</ul>
Установите этот атрибут для каждого образца развертки, если тип носителя — MFVideoInterlace_FieldSingleUpper, MFVideoInterlace_FieldSingleLower или MFVideoInterlace_MixedInterlaceOrProgressive.<br/></td>
</tr>
<tr class="odd">
<td><a href="mfsampleextension-repeatfirstfield-attribute.md">MFSampleExtension_RepeatFirstField</a></td>
<td>Если <strong>значение равно true</strong>, первое поле повторяется. Если значение равно <strong>false</strong> или не задано, первое поле не повторяется.</td>
</tr>
<tr class="even">
<td><a href="mfsampleextension-singlefield-attribute.md">MFSampleExtension_SingleField</a></td>
<td>Если <strong>значение — true</strong>, пример содержит одно поле. Если <strong>значение равно false</strong>, пример содержит поля с чередованием.</td>
</tr>
</tbody>
</table>



 

В следующей таблице показано, какие флаги являются обязательными, необязательными или запрещенными в зависимости от типа носителя.



| Тип носителя         | Флаг чередования                      | Флаг Боттомфиелдфирст                    | Флаг Репеатфирстфиелд | Флаг Синглефиелд                     |
|--------------------|--------------------------------------|------------------------------------------|-----------------------|--------------------------------------|
| прогрессивный        | Используемых Если задано, аргумент должен иметь **значение false**. | Не задавайте.                              | Не задавайте.           | Не задавайте.                          |
| Поля с чередованием | Используемых Если задано, то параметр должен иметь **значение true**.  | Используемых Если параметр задан, должен соответствовать тип носителя. | Не задавайте.           | Используемых Если задано, аргумент должен иметь **значение false**. |
| Отдельные поля      | Используемых Если задано, то параметр должен иметь **значение true**.  | Обязательный.                                | Не задавайте.           | Задайте значение **true**.                     |
| Смешанный              | Обязательный.                            | Обязательный.                                | Обязательный.             | Используемых Если задано, аргумент должен иметь **значение false**. |



 

В случаях, когда атрибут является необязательным, тип мультимедиа уже определяет информацию. Допускается установить для атрибута значение match, но не обязательно.

Например, если тип носителя — Мфвидеоинтерлаце \_ прогрессивно, это означает, что все кадры в потоке прогрессивны. Таким образом, можно задать для атрибута **мфсампликстенсион \_ чередование** **значение false** или оставить атрибут неопределенным.

## <a name="recommendations"></a>Рекомендации

Этот раздел содержит рекомендации по различным типам содержимого.

1. Видео — это все прогрессивные кадры.

-   Задайте для типа носителя Мфвидеоинтерлаце \_ прогрессивный.

-   Не устанавливайте атрибут **мфсампликстенсион \_ чересстрочная развертки** или задайте для него **значение false** в каждом кадре.

-   Не устанавливайте атрибуты **мфсампликстенсион \_ боттомфиелдфирст**, **мфсампликстенсион \_ репеатфирстфиелд** или **мфсампликстенсион \_ SingleField** .

2. Видео — это все поля с чередованием с одним и тем же полем превосходство. Примеры содержат поля с чередованием.

-   Задайте тип носителя Мфвидеоинтерлаце \_ фиелдинтерлеаведупперфирст или мфвидеоинтерлаце \_ фиелдинтерлеаведловерфирст.

-   Не устанавливайте атрибут **мфсампликстенсион \_ чересстрочная развертки** или задайте для него **значение true** в каждом кадре.

-   Не устанавливайте атрибут **мфсампликстенсион \_ боттомфиелдфирст** или задайте значение для каждого кадра в соответствии с типом носителя.

-   Не устанавливайте атрибут **мфсампликстенсион \_ репеатфирстфиелд** или задайте для него **значение false** в каждом кадре.

-   Не устанавливайте атрибут **мфсампликстенсион \_ синглефиелд** или задайте для него **значение false** в каждом кадре.

3. Видео содержит сочетание чередующихся и последовательных кадров с повторяющимися полями и различным полем превосходство (например, DVD Video).

-   Задайте для типа носителя значение Мфвидеоинтерлаце \_ миксединтерлацеорпрогрессиве.

-   На каждом кадре задайте атрибуты **мфсампликстенсион \_ чередования**, **мфсампликстенсион \_ боттомфиелдфирст** и **мфсампликстенсион \_ репеатфирстфиелд** .

-   Не устанавливайте атрибут **мфсампликстенсион \_ синглефиелд** или задайте для него **значение false** в каждом кадре.

4. Видео чередуются, а примеры содержат отдельные поля.

-   Задайте тип носителя Мфвидеоинтерлаце \_ фиелдсинглеуппер или мфвидеоинтерлаце \_ фиелдсинглеловер.

-   На каждом кадре задайте атрибут **мфсампликстенсион \_ боттомфиелдфирст** .

-   Не устанавливайте атрибут **мфсампликстенсион \_ чересстрочная развертки** или задайте для него **значение true** в каждом кадре.

-   Не устанавливайте атрибут **мфсампликстенсион \_ репеатфирстфиелд** или задайте для него **значение false** в каждом кадре.

-   Не устанавливайте атрибут **мфсампликстенсион \_ синглефиелд** или задайте для него **значение true** в каждом кадре.

Большинство видеоматериалов попадает в одну из этих категорий.

## <a name="mpeg-2-mappings"></a>Сопоставления MPEG-2

Для содержимого MPEG-2 Используйте следующие сопоставления для преобразования флагов MPEG-2 в Media Foundation образцы атрибутов.

**\_Структура рисунка**



| Значение         | Пример атрибута                                                                                                        |
|---------------|-------------------------------------------------------------------------------------------------------------------------|
| frame         | **Мфсампликстенсион \_ Синглефиелд**  =  **false**                                                                          |
| верхнее \_ поле    | **Мфсампликстенсион \_ Синглефиелд**  =  **true**<br/> **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **false**<br/> |
| нижнее \_ поле | **Мфсампликстенсион \_ Синглефиелд**  =  **true**<br/> **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **true**<br/>  |



 

**Прогрессивная \_ рамка**



| Значение | Пример атрибута                              |
|-------|-----------------------------------------------|
| 0     | **Мфсампликстенсион \_ С чередованием**,  =  **Истина**  |
| 1     | **Мфсампликстенсион \_ С чередованием**  =   |



 

**Сначала верхнее \_ поле \_**



| Значение | Пример атрибута                                    |
|-------|-----------------------------------------------------|
| 0     | **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **true**  |
| 1     | **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **false** |



 

**повторить \_ первое \_ поле**



| Значение | Пример атрибута                                    |
|-------|-----------------------------------------------------|
| 0     | **Мфсампликстенсион \_ Репеатфирстфиелд**  =  **false** |
| 1     | **Мфсампликстенсион \_ Репеатфирстфиелд**  =  **true**  |



 

## <a name="single-field-samples"></a>Примеры Single-Field

Если тип носителя — Мфвидеоинтерлаце \_ фиелдсинглеуппер или мфвидеоинтерлаце \_ фиелдсинглеловер, это означает, что каждый пример содержит одно поле. Однако тип носителя описывает весь кадр. Таким образом, каждый буфер содержит только половину числа строк полей, указанных в типе носителя. Например, если тип носителя описывает видео как 720 × 480, каждое поле содержит 240 строк сканирования, поэтому каждый буфер содержит только 240 строки пикселей. При написании компонента, который принимает типы мультимедиа с образцами с одним полем, этот факт следует принять во внимание при доступе к данным в буфере.

То же правило применяется к геометрической апертуре (атрибуту «[ \_ \_ \_ Апертура по геометру](mf-mt-geometric-aperture-attribute.md) ») и по минимальному отображаемому апертуру (атрибуту[ \_ \_ \_ \_ апертуры MF-монитора](mf-mt-minimum-display-aperture-attribute.md) ). Эти регионы задаются в терминах всего кадра, а не отдельных полей.

## <a name="directshow-mappings"></a>Сопоставления DirectShow

В DirectShow сведения о чересстрочную развертке для отдельных примеров содержатся в элементе **двтипеспеЦификфлагс** структуры **\_ \_ свойств SAMPLE2** . В следующей таблице показаны эквивалентные атрибуты для Media Foundation.



| Флаг образца DirectShow              | Пример атрибута Media Foundation                                                                                                                                                  |
|-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| видеофлаг AM — \_ \_ \_ кадр с чередованием \_ | **Мфсампликстенсион \_ Синглефиелд**  =  **false**.                                                                                                                                    |
| \_Флаг видео \_ \_ FIELD1             | **Мфсампликстенсион \_ С чередованием**  =  .<br/> **Мфсампликстенсион \_ Синглефиелд**  =  **значение true**.<br/> **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **false**.<br/> |
| \_FIELD2, \_ флажок AM Video \_             | **Мфсампликстенсион \_ С чередованием**  =  .<br/> **Мфсампликстенсион \_ Синглефиелд**  =  **значение true**.<br/> **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **значение true**.<br/>  |
| \_ \_ наплетение флага видео \_              | **Мфсампликстенсион \_ С чередованием**  =  **значение false**. (Этот флаг указывает, что драйвер не должен размечать два поля.)                                                        |
| \_FIELD1FIRST, \_ флажок AM Video \_        | **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **false**. Если содержимое с чередованием и \_ \_ \_ флаг FIELD1FIRST не установлен, установите для этого атрибута **значение true**.        |
| \_ \_ \_ поле повторения отметки видео \_      | **Мфсампликстенсион \_ Репеатфирстфиелд**  =  **значение true**. Если \_ \_ \_ отсутствует флаг поля повторения для флага видео \_ , установите для этого атрибута **значение false**.                                    |



 

Если образец DirectShow не содержит флаги выборки, используйте значение **двинтерлацефлагс** из структуры **VIDEOINFOHEADER2** :



| Флаг чередования DirectShow    | Пример атрибута Media Foundation                    |
|------------------------------|------------------------------------------------------|
| АМИНТЕРЛАЦЕ с \_ чередованием    | **Мфсампликстенсион \_ С чередованием**  =  .        |
| АМИНТЕРЛАЦЕ \_ 1FieldPerSample | **Мфсампликстенсион \_ Синглефиелд**  =  **значение true**.       |
| АМИНТЕРЛАЦЕ \_ Field1First     | **Мфсампликстенсион \_ Боттомфиелдфирст**  =  **false**. |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Типы видеоклипов](video-media-types.md)
</dt> <dt>

[Типы носителей](media-types.md)
</dt> </dl>

 

 




