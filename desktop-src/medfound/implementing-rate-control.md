---
description: В этом разделе описывается, как пользовательские объекты конвейера могут поддерживать скорость воспроизведения переменных, включая обратную воспроизведение. Сведения об использовании управления скоростью из приложения см. в разделе Rate Control.
ms.assetid: 077678db-ca5a-423b-9430-93497113d639
title: Реализация управления скоростью
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5fd78cbbb95316a0d4ed12a50c9d3aa8954fe8a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104081174"
---
# <a name="implementing-rate-control"></a>Реализация управления скоростью

В этом разделе описывается, как пользовательские объекты конвейера могут поддерживать скорость воспроизведения переменных, включая обратную воспроизведение. Сведения об использовании управления скоростью из приложения см. в разделе [Rate Control](rate-control.md).

В этом разделе содержатся следующие подразделы.

-   [Источники мультимедиа](#media-sources)
-   [Преобразования Media Foundation](#media-foundation-transforms)
    -   [Обратная воспроизведение](#reverse-playback)
-   [Приемники носителей](#media-sinks)
-   [См. также](#related-topics)

При создании объекта конвейера Microsoft Media Foundation (источника мультимедиа, преобразования или приемника мультимедиа) может потребоваться поддержка переменного воспроизведения. Для этого реализуйте следующие интерфейсы:

1.  Реализуйте интерфейс [**имфжетсервице**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) .
2.  Поддержка службы **\_ \_ управления \_ скоростью MF** . (См. раздел [интерфейсы служб](service-interfaces.md).)
3.  Реализуйте интерфейс [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , который получает скорости воспроизведения, поддерживаемые объектом.
4.  Реализуйте интерфейс [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) , который получает или задает скорость воспроизведения.

## <a name="media-sources"></a>Источники мультимедиа

Если источник мультимедиа поддерживает управление скоростью, он должен реализовывать как [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , так и [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol). В противном случае сеанс мультимедиа сообщает, что минимальная и максимальная скорости воспроизведения — 1,0, независимо от других компонентов в конвейере.

Скорость воспроизведения не влияет на время показа образцов, поэтому источник мультимедиа не должен изменять отметки времени. Вместо этого часы презентации выполняются с более высокой или более низкой скоростью. Для обратных воспроизведений источник предоставляет образцы в обратный порядок с уменьшением меток времени.

Параметр *ФСИН* метода [**Имфратеконтрол:: сетрате**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate) указывает, должен ли источник мультимедиа *затонкие* содержимое. Тонкая применяется в основном к потокам видео. В тонком режиме источник удаляет разностные кадры и доставляет только ключевые кадры. При очень высоких скоростях воспроизведения источник может пропускать некоторые ключевые кадры (например, доставлять каждый другой ключевой кадр).

Источнику не нужно удалять образцы звука в тонком режиме. Однако при очень высоких скоростях воспроизведения источник может не иметь возможности чтения данных Fast наугх для заполнения образцов запросов конвейера. В этом случае источнику может потребоваться удалить некоторые звуковые данные. Если да, то он должен попытаться доставить звуковые примеры, которые закрываются в видеороликах (предполагая, что источник имеет оба типа потока).

Когда поток переходит между тонким и нетонким режимом, он отправляет событие [местреамсинмоде](mestreamthinmode.md) .

Когда источник мультимедиа завершает вызов [**сетрате**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate), он отправляет событие [месаурцератечанжед](mesourceratechanged.md) .

При обратном воспроизведении:

-   Источник мультимедиа предоставляет образцы в обратный порядок, не настраивая метки времени.
-   Метки времени в потоке должны быть монотонно уменьшаться.
-   Начало содержимого считается концом потока. После того как каждый поток мультимедиа доставляет первый пример в потоке (то есть время презентации = 0), он отправляет событие [миндофстреам](meendofstream.md) .

## <a name="media-foundation-transforms"></a>Преобразования Media Foundation

Как правило, преобразование Media Foundation (MFT) не требует явной поддержки управления скоростью, если только MFT не реализует нетонкое обратное воспроизведение.

Если таблица MFT не реализует интерфейс [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , то сеанс мультимедиа предполагает следующее:

-   MFT поддерживает скорость воспроизведения произвольный для прямого воспроизведения, как тонкого, так и нетонкого.
-   MFT поддерживает тонкое воспроизведение, но не поддерживает нетонкие обратные воспроизведения.

Если одно из этих условий не равно true, в MFT должна быть реализована [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) и [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).

### <a name="reverse-playback"></a>Обратная воспроизведение

Сеанс мультимедиа может воспроизводиться в обратную, даже если один или несколько преобразований в конвейере не поддерживают обратную воспроизведение явным образом.

Если таблица MFT не предоставляет интерфейс [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , сеанс мультимедиа использует *тонкое* воспроизведение для воспроизведения, как показано ниже.

-   Сеанс мультимедиа отправляет ключевые кадры в MFT обычным способом, вызывая [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).

-   Сеанс мультимедиа удаляет разностные кадры и заменяет их событиями [местреамтикк](mestreamtick.md) .

-   В каждом примере сеанс мультимедиа очищает таблицу MFT, чтобы избежать ошибок, вызванных тем, что отметки времени сокращаются.

Пример считается ключевым кадром, если для атрибута [мфсампликстенсион \_ клеанпоинт](mfsampleextension-cleanpoint-attribute.md) задано значение **true**, и считается разностным кадром, если этот атрибут имеет **значение false** или не задан.

Если MFT реализует [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport), сеанс мультимедиа использует этот интерфейс, чтобы определить, поддерживает ли MFT нетонкое воспроизведение. Если MFT поддерживает нетонкое воспроизведение обратного воспроизведения, сеанс мультимедиа предоставляет все образцы в обратном порядке без удаления образцов или очистки MFT.

Если MFT поддерживает нетонкое воспроизведение, оно должно реализовывать интерфейс [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) . Сеанс мультимедиа будет использовать этот интерфейс для уведомления MFT о том, что происходит обратная воспроизведение. На этом этапе необходимо подготовить MFT для уменьшения временных меток, а также для того, чтобы разностные кадры приступили в обратный порядок. Декодеру обычно потребуется буферизация образцов, пока он не получит всю группу изображений (GOP), декодировать весь GOP и вывести раскодированные кадры в правильном (обратном) порядке.

## <a name="media-sinks"></a>Приемники носителей

Если приемник мультимедиа не имеет *интенсивности*, сеанс работы с мультимедиа предполагает, что приемник мультимедиа может выполнять любые скорости воспроизведения. Приемнику мультимедиа не требуется реализовывать [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport). (Приемник мультимедиа с нескоростью, который не имеет интенсивности, возвращает МЕДИАСИНК \_ Флаг с неинтенсивностью от метода [**имфмедиасинк::**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) -Methods.)

В противном случае приемник мультимедиа должен реализовать [**имфратесуппорт**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , если он может обменять скорости воспроизведения, кроме 1,0.

Приемники носителей не должны реализовывать [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol). При изменении частоты воспроизведения часы представления вызывают метод [**имфклоккстатесинк:: онклокксетрате**](/windows/desktop/api/mfidl/nf-mfidl-imfclockstatesink-onclocksetrate) приемника мультимедиа.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Управление скоростью](rate-control.md)
</dt> <dt>

[Поиск, быстрая переадресация и обратная игра](seeking--fast-forward--and-reverse-play.md)
</dt> </dl>

 

 



