---
description: Настройка объекта разделителя ASF
ms.assetid: 8e2ba659-e1f6-42be-afd6-21fc841dc8d3
title: Настройка объекта разделителя ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7068f2c869f6c73447b3341baee7221cdf8efbacec47ecdfa3a584bfb456f199
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119606154"
---
# <a name="configuring-the-asf-splitter-object"></a>Настройка объекта разделителя ASF

Объект- *Разделитель* ASF — это объект слоя вмконтаинер, который анализирует объект данных ASF в файле ASF. После того как разделитель создан и инициализирован для анализа объекта данных ASF файла мультимедиа, разделитель должен быть настроен для создания образцов для конкретных потоков. Вызовите метод [**имфасфсплиттер:: селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) , чтобы выбрать необходимые потоки.

При необходимости приложение также может настроить его для создания примеров в обратный порядок или создать образцы для защищенного содержимого. Чтобы задать эти параметры, вызовите метод [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) и передайте требуемое побитовое сочетание поддерживаемых флагов. Перед вызовом этого метода клиент должен успешно завершить вызов [**имфасфсплиттер:: Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) ; в противном случае **сетфлагс** завершается с ошибкой **MF \_ E \_ не \_ инициализирован** код ошибки. Дополнительные сведения об инициализации разделителя см. [в разделе Создание объекта РАЗДЕЛИТЕЛЯ ASF](creating-the-asf-splitter-object.md).

Чтобы проверить, установлен ли этот флаг в данный момент в разделителе, вызовите [**имфасфсплиттер::-flags**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getflags).

## <a name="selecting-streams-for-parsing"></a>выбор Потоки для синтаксического анализа

В процессе инициализации с помощью вызова [**имфасфсплиттер:: Initialize**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-initialize) разделитель определяет количество потоков и идентификаторов потоков в файле ASF. По умолчанию разделитель не выбирает потоки. Приложение должно выбрать потоки, вызвав [**имфасфсплиттер:: селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams). Этот метод принимает массив номеров потоков. Чтобы получить номер потока для потока, вызовите [**имфасфпрофиле::-Stream**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getstream) в профиле ASF или вызовите [**Имфстреамдескриптор:: жетстреамидентифиер**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getstreamidentifier) в дескрипторе потока. (Как профиль ASF, так и дескриптор потока можно получить из объекта Контентинфо.) Если клиент передает номер потока, который не распознается разделителем, он завершается ошибкой **MF \_ E \_ инвалидстреамнумбер** .

При вызове [**селектстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-selectstreams) очищается предыдущий выбор. Любой поток, не указанный в массиве, не выбран. Чтобы получить список потоков, выбранных в данный момент, вызовите метод [**имфасфсплиттер:: жетселектедстреамс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-getselectedstreams). Этот метод принимает указатель на массив, который метод заполняет номерами потоков. Если размер массива меньше числа выбранных потоков, метод завершается с ошибкой **MF \_ E \_ буффертусмалл** . В этом случае метод возвращает число выбранных потоков в параметре *пвнумстреамс* . Затем это число можно использовать для выделения массива правильного размера и повторного вызова метода.

Пример кода см. в разделе «Выбор потока для синтаксического анализа» раздела [учебник. чтение файла ASF](tutorial--reading-an-asf-file.md).

## <a name="reverse-playback-setting"></a>Параметр отмены воспроизведения

В процессе инициализации разделителя определяется, поддерживает ли содержимое ASF обратную воспроизведение. Если это так, разделитель можно настроить для создания выборок в обратный порядок, установив флаг **мфасф \_ разделителя \_** . Если содержимое не поддерживает обратную воспроизведение, [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags) возвращает **MF \_ E \_ инвалидрекуест**, но для разделителя задан флаг.

Если разделитель настроен для синтаксического анализа в обратном направлении, разделитель всегда начинает анализ в конце буфера, содержащего объект данных ASF. Таким образом, для отмены синтаксического анализа смещение данных и длина анализируемых данных должны быть заданы соответствующим образом. Сведения о задании правильных значений см. [в разделе Создание образцов потоков из существующего объекта данных ASF](generating-stream-samples-from-an-existing-asf-data-object.md).

## <a name="protected-content-setting"></a>Параметр защищенного содержимого

Разделитель можно настроить для работы с содержимым шифрования на уровне пакетов, установив **мфасф \_ разделитель \_ WMDRM** через [**имфасфсплиттер:: сетфлагс**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfsplitter-setflags). это указывает разделителю предоставлять образцы содержимого, защищенного Windows Media Digital Rights Management (DRM). Если этот флаг установлен, образцы, формируемые разделителем, содержат сведения, необходимые для расшифровки данных мультимедиа и воссоздания этих кадров, например атрибут [**мфсампликстенсион \_ паккеткроссоффсетс**](mfsampleextension-packetcrossoffsets-attribute.md) . Этот атрибут представляет собой большой двоичный объект, содержащий массив **DWORD** s. Каждый **DWORD** предоставляет границы полезных данных для кадра относительно начала кадра. Если этот атрибут отсутствует, кадр содержится в одной полезной нагрузке. Как правило, образцы, формируемые разделителем, содержат несколько буферов мультимедиа, поэтому приложение может скопировать все буферы в один непрерывный буфер путем вызова [**имфсампле:: конверттоконтигуаусбуффер**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-converttocontiguousbuffer). Результирующий буфер содержит кадр, а значение атрибута содержит смещения в этом буфере.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Разделитель ASF](asf-splitter.md)
</dt> </dl>

 

 



