---
description: Расширенные сведения о цвете
ms.assetid: 05ca73c6-d105-47bc-96bc-b784f669febe
title: Расширенные сведения о цвете
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29ba43180a0f1e5253540088c1638f59d52380c9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103808081"
---
# <a name="extended-color-information"></a>Расширенные сведения о цвете

Если вы ничего не знакомы с цветом RGB, то вам известно, что (255, 255, 255) — это 8-битное Triplet RGB для *белого* цвета. Но каков фактический *Цвет* , определяемый этим Triplet?

Ответ может быть удивительно: без какой бы то ни было дополнительной информации, Triplet не определяет какой – то какой цвет. Значение любого значения RGB зависит от *цветового пространства*. Если цветовое пространство неизвестно, то строго говоря, этот цвет не известен.

Цветовое пространство определяет, как числовое представление данного значения цвета должно быть воспроизведено как физическое освещение. Если видео кодируется в одном цветовом пространстве, но отображается в другом, это приводит к искаженным цветам, если видео не будет исправлено цветом. Чтобы обеспечить точную точность цвета, важно понять цветовое пространство исходного видео. Ранее конвейер видео в Windows не содержал сведений о предполагаемом цветовом пространстве. Начиная с Windows Vista, DirectShow и Media Foundation поддерживают расширенные сведения о цвете в типе мультимедиа. Эти сведения также доступны для ускорения DirectX Video (ДКСВА).

Стандартным способом описания цветового пространства является использование пространства цвета ЦИЕ XYZ, определенного Международной комиссией по освещения (ЦИЕ). Нецелесообразно использовать значения ЦИЕ XYZ непосредственно в видео, но при преобразовании между цветовыми пространствами можно использовать цветовое пространство ЦИЕ XYZ в качестве промежуточного представления.

Чтобы правильно воспроизвести цвета, необходимы следующие сведения:

-   Первичные цвета. Первичные цвета определяют, как значения ЦИЕ XYZ тристимулус представлены как компоненты RGB. Фактически цветовые первичные цвета определяют «значение» заданного значения RGB.
-   Функция перемещения. Функция перемещения — это функция, которая преобразует линейные значения RGB в значения нелинейной Р'Г'Би. Эта функция также называется *гамма-коррекцией*.
-   Матрица перемещения. Матрица перемещения определяет, как Р'Г'Б "преобразуется в И'пбпр.
-   Выборка чрома. Большинство видеороликов YUV передается с меньшим разрешением в компонентах чрома, чем яркости. Выборка чрома обозначается объектом FOURCC формата видео. Например, YUY2 имеет формат 4:2:2, что означает, что выборки чрома вычисляются горизонтально с коэффициентом 2.
-   Чрома заблокировано. После выборки чрома расположение примеров чрома, относящихся к примерам яркости, определяет способ интерполяции отсутствующих примеров.
-   Номинальный диапазон. Номинальный диапазон определяет способ масштабирования значений И'пбпр до И'кбкр.

## <a name="color-space-in-media-types"></a>Цветовое пространство в типах носителей

DirectShow, Media Foundation и DirectX Video Acceleration (ДКСВА) имеют разные способы представления видеоформатов. К счастью, можно легко преобразовать сведения о цветовых пространствах из одного в другой, так как соответствующие перечисления одинаковы.

-   ДКСВА 1,0: сведения о пространстве цветов задаются в структуре [**дксва \_ екстендедформат**](/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_extendedformat) .
-   ДКСВА 2,0: сведения о пространстве цветов задаются в структуре структуры [**DXVA2 \_ екстендедформат**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_extendedformat) . Эта структура идентична структуре ДКСВА 1,0, и значение полей одинаково.
-   DirectShow: сведения о пространстве цветов задаются в структуре [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) . Информация хранится в верхних 24 битах поля **двконтролфлагс** . Если имеются сведения о цветном пространстве, установите флаг **амконтрол \_ колоринфо \_ Present** в **двконтролфлагс**. Если этот флаг установлен, поле **двконтролфлагс** должно интерпретироваться как структура [**дксва \_ екстендедформат**](/windows-hardware/drivers/ddi/dxva/ns-dxva-_dxva_extendedformat) , за исключением того, что младшие 8 разрядов структуры зарезервированы для флагов **амконтрол \_ xxx** .
-   Драйверы видеозаписи. сведения о цветовых пространствах задаются в структуре [**KS \_ VIDEOINFOHEADER2**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-tagks_videoinfoheader2) . Эта структура идентична структуре [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2) , а значение полей одинаково.
-   Media Foundation: сведения о цветовых пространствах хранятся в виде атрибутов в типе мультимедиа:

    

    | Сведения о цвете  | attribute                                                                                                                                                   |
    |--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | Первичные цвета    | [**\_ \_ \_ первичные цвета видео MF MT**](mf-mt-video-primaries-attribute.md)                                                                                         |
    | Функция перемещения  | [**\_ \_ функция перемещения MF \_ MT**](mf-mt-transfer-function-attribute.md)                                                                                     |
    | Матрица перемещения    | [**\_ \_ Матрица MF MT YUV \_**](mf-mt-yuv-matrix-attribute.md)                                                                                                   |
    | Подвыборка чрома | [**подтип MF \_ MT \_**](mf-mt-subtype-attribute.md)<br/> (Задается объектом FOURCC, который хранится в первом **DWORD** подтипа GUID.)<br/> |
    | Чрома заблокировано      | [**MF \_ Book \_ \_ чрома \_ заблокировано**](mf-mt-video-chroma-siting-attribute.md)                                                                                |
    | Номинальный диапазон      | [**\_ \_ \_ Номинальный диапазон видео MF MT \_**](mf-mt-video-nominal-range-attribute.md)                                                                                |

    

     

## <a name="color-space-conversion"></a>Преобразование цветового пространства

Преобразование из одного И'кбкр пространства в другое требует выполнения следующих шагов.

1.  Обратная дискретизация: преобразование представления И'кбкр в представление И'пбпр с использованием исходного номинального диапазона.
2.  Ресамплинг. Преобразуйте значения чрома 4:4:4 в значениях чрома, выполнив интерполяцию значений, равных.
3.  Преобразование YUV в RGB: преобразование из И'пбпр в нелинейный Р'Г'Б с использованием матрицы перемещения источника.
4.  Обратная функция перемещения: преобразование нелинейного Р'Г'Б в линейное значение RGB с использованием обратной функции перемещения.
5.  Преобразование цветового пространства RGB: используйте первичные цвета для преобразования исходного пространства RGB в целевое пространство RGB.
6.  Функция перемещения: преобразование линейного RGB в нелинейный Р'Г'Б с помощью целевой функции перемещения.

7.  Преобразование RGB в YUV: преобразование Р'Г'Б в И'пбпр с использованием целевой матрицы перемещения.
8.  Понижение разрешения: преобразование 4:4:4 в 4:2:2, 4:2:0 или 4:1:1 путем фильтрации значений чрома.
9.  Дискретизация: Convert И'пбпр to И'кбкр, используя номинальный целевой диапазон.

Шаги 1 – 4 происходят в исходном цветовом пространстве, и шаги 6 – 9 происходят в целевом пространстве. В реальной реализации промежуточные шаги могут быть приблизительными, а смежные шаги можно объединять. Обычно существует компромисс между точностью и вычислительной ценой.

Например, для преобразования из RT. 601 в RT. 709 необходимо выполнить следующие этапы.

-   Обратный дискретизация: И'кбкр (601) в И'пбпр (601)
-   Ресамплинг: И'пбпр (601)
-   YUV в RGB: И'пбпр (601) в Р'Г'Б "(601)
-   Обратная функция перемещения: Р'Г'Б (601) в RGB (601)
-   Преобразование цветового пространства RGB: RGB (601) в RGB (709)
-   Функция перемещения: RGB (709) в Р'Г'Б "(709)
-   RGB в YUV: Р'Г'Б "(709) в И'пбпр (709)
-   Понижение разрешения: И'пбпр (709)

-   Дискретизация: И'пбпр (709) в И'кбкр (709)

## <a name="using-extended-color-information"></a>Использование расширенных сведений о цвете

Чтобы сохранить цветовую точность в конвейере, сведения о цветовом пространстве должны быть представлены в источнике или декодере и передавались по конвейеру в приемник.

### <a name="video-capture-devices"></a>Устройства видеозаписи

При записи видео в большинстве аналоговых устройств записи используется четко определенное цветовое пространство. Драйверы записи должны иметь формат с блоком формата **KS \_ VIDEOINFOHEADER2** , который содержит сведения о цвете. Для обеспечения обратной совместимости драйвер должен принимать форматы, которые не содержат сведений о цвете. Это позволит драйверу работать с компонентами, которые не принимают расширенные сведения о цвете.

### <a name="file-based-sources"></a>Файловые источники

При анализе видеофайла источник мультимедиа (или фильтр синтаксического анализатора в DirectShow) может предоставить некоторую информацию о цвете. Например, Навигатор DVD может определить цветовое пространство на основе содержимого DVD-диска. Другие сведения о цвете могут быть доступны для декодера. Например, простейший видеопоток MPEG-2 предоставляет сведения о цвете в \_ \_ поле расширения представления последовательности. Если сведения о цвете не описаны явно в источнике, они могут быть неявно определены типом содержимого. Например, изображения NTSC и PAL видеороликов используют разные цветовые пространства. Наконец, декодер может использовать любые сведения о цвете, которые он получает от типа носителя источника.

### <a name="other-components"></a>Другие компоненты

Другим компонентам может потребоваться использовать сведения о цветовых пространствах в типе мультимедиа:

-   Для использования преобразователей цветового пространства программного обеспечения следует использовать сведения о цветовом пространстве при выборе алгоритма преобразования.
-   Видео миксерс, например микшер расширенного модуля подготовки видео (Евр), должны использовать сведения о цвете при смешении видеопотоков из различных типов содержимого.
-   API-интерфейсы обработки видео ДКСВА и ДДИС позволяют вызывающей стороне указывать сведения о цветовых пространствах. GPU должен использовать эти сведения при выполнении хардвардного смешения видео.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Типы видеоклипов](video-media-types.md)
</dt> <dt>

[Ускорение видео DirectX 2,0](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
