---
description: использование взаимного исключения для ASF Потоки
ms.assetid: fdd31eac-1dd6-45f0-90fb-d5a74c85db2e
title: использование взаимного исключения для ASF Потоки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 40c7fd104659064952803c16f572ee1e55dee0508144474e89ee7c0f362315c9
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119034571"
---
# <a name="using-mutual-exclusion-for-asf-streams"></a>использование взаимного исключения для ASF Потоки

Содержимое ASF может содержать несколько взаимоисключающих потоков. Эти потоки не могут быть прочитаны одновременно, но только один из них читается за раз. Например, файл может содержать набор потоков, включающих то же содержимое, которое закодировано с разной скоростью. Используемый поток определяется пропускной способностью, доступной для приложения, которое осуществляет потоковую передачу содержимого. Объект взаимного исключения ASF, который является частью объекта Header, хранит сведения о группе взаимоисключающих потоков.

В Media Foundation для каждого объекта взаимного исключения ASF существует *взаимоисключающий* объект, предоставляющий интерфейс [**имфасфмутуалексклусион**](/windows/desktop/api/wmcontainer/nn-wmcontainer-imfasfmutualexclusion) . Объект профиля содержит ссылку на все объекты взаимного исключения.

Объект взаимного исключения хранит сведения о группе взаимоисключающих потоков в качестве записей. Объект взаимного исключения может иметь несколько записей, которые можно использовать для создания сложных сценариев. Каждая запись содержит один или несколько потоков, которые не могут сосуществовать в другой записи, обслуживаемой взаимоисключающим объектом, в зависимости от типа взаимного исключения, например скорости потока.

Распространенным примером сложного взаимного исключения является файл, содержащий три звуковых потока одного и того же содержимого с различными скоростями в каждом из трех языков. За раз следует воспроизводить только один из девяти потоков, но существуют два типа, по которым они являются взаимоисключающими: язык и скорость.

В этом примере для девяти потоков назначаются следующие номера потоков:

<dl> 1-Language 1, скорость разрядов 1  
2 — язык 1, скорость разрядов 2  
3 — язык 1, скорость разрядов 3  
4 — язык 2, скорость по разрядности 1  
5 — язык 2, скорость передачи 2  
6 — язык 2, скорость передачи 3  
7 — язык 3, скорость разрядов 1  
8-язык 3, скорость разрядов 2  
9-язык 3, скорость разрядов 3  
</dl>

Этот сценарий можно реализовать с помощью следующих четырех взаимоисключающих объектов:

-   Первый объект взаимоисключающего исключения включает потоки 1, 2 и 3, взаимоисключающие с интенсивностью битов. Каждый поток имеет собственную запись.
-   Второй объект взаимного исключения включает потоки 4, 5 и 6, взаимоисключающие с поразрядной скоростью. Каждый поток имеет собственную запись.
-   Третий взаимно исключенный объект включает 7, 8 и 9, взаимоисключающий с интенсивностью битов. Каждый поток имеет собственную запись.
-   Четвертый объект взаимного исключения содержит три записи, первый из которых включает потоки 1, 2 и 3; второй, включая потоки 4, 5 и 6; а треть, включая потоки 7, 8 и 9. Эти записи являются взаимоисключающими по отношению к языку.

При воспроизведении файла, созданного таким способом, приложение потоковой передачи сначала выбирает язык, поскольку вероятность его изменения ниже, а затем выбирается скорость.

## <a name="mutual-exclusion-object-creation-and-configuration"></a>Создание и настройка взаимоисключающих объектов

В следующем списке приведено описание процесса настройки взаимоисключающего объекта.

1.  Создайте объект взаимного исключения.
2.  Задает тип взаимного исключения.
3.  Настройте объект взаимного исключения, добавив записи и связанные потоки.
4.  Добавьте объект взаимного исключения в профиль.

Создание и настройка взаимоисключающего объекта

1.  Вызовите метод [**имфасфпрофиле:: креатемутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-createmutualexclusion) , чтобы создать пустой объект взаимного исключения.
2.  Вызовите метод [**имфасфмутуалексклусион:: сеттипе**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-settype) , чтобы задать критерий взаимоисключающего потока.

    Потоки могут быть взаимоисключающими по отношению к языку, скорости разрядности, презентации и настраиваемым критериям. Тип представлен как GUID. Список этих констант см. в разделе [идентификаторы GUID типа взаимного исключения ASF](asf-mutual-exclusion-type-guids.md).

3.  Вызовите [**имфасфмутуалексклусион:: аддрекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-addrecord) , чтобы добавить запись в объект взаимного исключения.

    Этот метод добавляет пустую запись и присваивает ей индекс записи, начинающийся с нуля.

4.  Вызовите метод [**имфасфмутуалексклусион:: аддстреамфоррекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-addstreamforrecord) , чтобы добавить номер потока в запись, указанную в индексе записи.

    Каждая запись включает один или несколько потоков. Каждый поток в записи является взаимоисключающим для всех потоков в каждой другой записи. Чтобы получить количество потоков в записи, вызовите [**имфасфмутуалексклусион:: жетстреамсфоррекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-getstreamsforrecord) , указав индекс записи.

    Чтобы удалить поток из записи, вызовите [**имфасфмутуалексклусион:: ремовестреамфромрекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-removestreamfromrecord) и укажите индекс записи и номер потока.

5.  Вызовите метод [**имфасфпрофиле:: аддмутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-addmutualexclusion) , чтобы добавить в профиль настроенный объект взаимного исключения.

## <a name="enumerating-mutual-exclusion-objects-in-a-profile"></a>Перечисление взаимоисключающих объектов в профиле

Если [**имфасфпрофиле:: аддмутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-addmutualexclusion) выполняется, он присваивает индекс указанному объекту, начиная с нуля.

Чтобы перечислить взаимоисключающие объекты, связанные с профилем, вызовите [**имфасфпрофиле:: жетмутуалексклусионкаунт**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getmutualexclusioncount) и пройдите по списку, вызвав [**Имфасфпрофиле:: жетмутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-getmutualexclusion). Взаимно исключаемые индексы являются последовательными и находятся в диапазоне от 0 до значения, меньшего, чем число потоков, извлекаемых функцией **жетмутуалексклусионкаунт**.

Объект взаимного исключения удаляется из профиля путем вызова [**имфасфпрофиле:: ремовемутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-removemutualexclusion). Профиль переназначит взаимоисключающие индексы, чтобы они были последовательными, начиная с нуля. Это перезаписывает ранее сохраненные индексы, которые больше не являются допустимыми после вызова этого метода. Это освобождает связанные записи взаимоисключающих потоков.

## <a name="removing-records-in-a-mutual-exclusion-object"></a>Удаление записей в взаимоисключающем объекте

Чтобы удалить запись из взаимоисключающего объекта, вызовите метод [**имфасфмутуалексклусион:: ремоверекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-removerecord). В случае успешности этого метода объект взаимного исключения индексирует оставшиеся записи, чтобы они были последовательными, начиная с нуля. Приложение должно перечислить записи, чтобы обеспечить правильный индекс для каждой записи. Для этого вызовите [**имфасфмутуалексклусион:: жетрекордкаунт**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-getrecordcount) и передавайте цикл по записям, вызвав [**Имфасфмутуалексклусион:: жетстреамсфоррекорд**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-getstreamsforrecord).

Удаление записи с самым высоким индексом не влияет на другие индексы.

## <a name="modifying-a-mutual-exclusion-object"></a>Изменение взаимоисключающего объекта

Чтобы изменить конфигурацию взаимоисключающего объекта в профиле, приложение должно заменить существующий объект взаимного исключения другим объектом, содержащим новые параметры.

Изменение конфигурации объекта взаимного исключения в профиле

1.  Перечислите взаимоисключающие объекты в профиле, чтобы получить объект, который необходимо изменить.
2.  Вызовите [**имфасфмутуалексклусион:: Clone**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfmutualexclusion-clone) , чтобы клонировать объект взаимного исключения.

3.  При необходимости настройте клонированный объект.
4.  Вызовите метод [**имфасфпрофиле:: ремовемутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-removemutualexclusion) , чтобы удалить старый объект взаимного исключения из профиля.

5.  Вызовите [**имфасфпрофиле:: аддмутуалексклусион**](/windows/desktop/api/wmcontainer/nf-wmcontainer-imfasfprofile-addmutualexclusion) , чтобы добавить обновленный объект взаимного исключения в профиль.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Профиль ASF](asf-profile.md)
</dt> </dl>

 

 



