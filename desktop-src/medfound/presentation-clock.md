---
description: Часы представления
ms.assetid: cb8bb62a-ef80-4de0-9a44-3bb77edc9dd5
title: Часы представления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f61ad02537a2591c681db78721376651f7854ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155335"
---
# <a name="presentation-clock"></a>Часы представления

*Часы представления* — это объект, который создает время для представления. Время, сообщаемое часами представления, называется *временем презентации*. Все потоки в презентации синхронизируются со временем презентации. Часы представления предоставляют следующие интерфейсы.



| Интерфейс                                            | Описание                                         |
|------------------------------------------------------|-----------------------------------------------------|
| [**имфпресентатионклокк**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationclock) | Основной интерфейс для использования часов представления. |
| [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol)             | Управляет частотой часов.                            |
| [**имфтимер**](/windows/desktop/api/mfidl/nn-mfidl-imftimer)                         | Предоставляет обратный вызов таймера.                          |
| [**имфшутдовн**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)                   | Закрывает часы презентации.                  |



 

Приемники носителей используют время презентации, чтобы запланировать время подготовки к просмотру образцов. Каждый раз, когда приемник мультимедиа получает новый пример, он получает отметку времени из образца и отображает образец в указанное время или как можно ближе к этому времени. Так как все приемники мультимедиа в топологии используют одни и те же часы представления, синхронизируются несколько потоков (например, аудио-и видеофайлы). Источники мультимедиа и преобразования не используют часы презентации, так как они не запланируют, когда следует доставлять образцы. Вместо этого они создают образцы каждый раз, когда конвейер запрашивает новый пример.

Если вы используете сеанс мультимедиа для воспроизведения, сеанс мультимедиа обрабатывает все сведения о создании часов представления, выборе источника времени и уведомлении приемников мультимедиа. Приложение может использовать часы презентации для получения текущего времени презентации во время воспроизведения, но в противном случае не будет вызывать никаких методов для часов презентации.

## <a name="clock-time-and-clock-states"></a>Время и состояния часов

Чтобы получить последнее время в часах презентации, вызовите метод [**имфпресентатионклокк:: OnTime**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime). Время часы всегда находятся в единицах 100-наносекундных, поэтому одна секунда — 10 000 000 (10 ^ 7) тактов. Это соответствует частоте 10 МГц.

Часы презентации имеют три состояния: "работает", "приостановлено" и "остановлено".

-   Чтобы запустить часы, вызовите [**имфпресентатионклокк:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-start). Метод **Start** задает время начала работы с часами. Во время выполнения часов часы увеличиваются с момента начала по текущей ставке часов.
-   Чтобы приостановить часы, вызовите [**имфпресентатионклокк::P Аусе**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-pause). Пока часы приостановлены, время не изменяется [**, а функция while Возвращает время**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) приостановки часов.
-   Чтобы прерывать часы, вызовите [**имфпресентатионклокк:: останавливаться**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-stop). Когда часы остановлены, время не изменяется, а функция- [**время**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-gettime) возвращает ноль.

По умолчанию тактовая частота увеличивается на 1,0, что означает 1 такт на 100 наносекунд. Чтобы изменить скорость, с которой увеличивается время, запросите часы представления для интерфейса [**имфратеконтрол**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) и вызовите [**Имфратеконтрол:: сетрате**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate).

Объекты могут получать уведомления об изменениях состояния (включая изменения скорости) из часов презентации. Чтобы получать уведомления, реализуйте интерфейс [**имфклоккстатесинк**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) и вызовите [**Имфпресентатионклокк:: аддклоккстатесинк**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-addclockstatesink) в часах презентации. Перед завершением работы вызовите метод [**имфпресентатионклокк:: ремовеклоккстатесинк**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-removeclockstatesink) , чтобы отменить регистрацию объекта. Приемники носителей используют этот механизм для получения уведомлений из часов.

## <a name="presentation-times"></a>Время презентации

Приемник мультимедиа пытается запланировать каждый пример, чтобы образец отображался в нужное время, или как можно ближе к правильному времени. Применяются следующие определения:

-   *Время презентации.* Время, когда должен быть визуализирован образец. Время указывается в единицах 100 наносекунд.
-   *Время мультимедиа.* Время относительно начала содержимого. Например, если видеофайл имеет длину не более 10 секунд, то точка, половина пути к файлу, имеет время хранения в 5 секунд.
-   *Метка времени.* Время, отмеченное на примере носителя. Чтобы получить метку времени, вызовите [**имфсампле:: жетсамплетиме**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-getsampletime). Когда источник мультимедиа создает пример, он устанавливает отметку времени, равную времени носителя. Сеанс мультимедиа преобразует метку времени в время презентации.

По умолчанию время и время презентации мультимедиа одинаковы, например, если кадр видео появляется в виде 5 секунд в исходном файле, время мультимедиа и время презентации — 5 секунд. При использовании [источника Sequencer](sequencer-source.md)модель времени несколько сложнее, чтобы обеспечить плавные переходы между сегментами. Дополнительные сведения о модели времени источника Sequencer см. в разделе [время показа последовательностей](sequence-presentation-times.md).

Источник мультимедиа всегда задает отметку времени, равную времени носителя. Если время презентации не соответствует времени носителя, то сеанс мультимедиа преобразует метки времени на примерах носителя. К моменту, когда приемник получает образец, метка времени образца преобразуется в время презентации. Приемник планирует выборку в соответствии с текущим временем часов представления. (Приемники без учета частоты являются исключением, так как они игнорируют часы представления.)

Если приложение выполняет поиск в новой позиции, сеанс мультимедиа перезапускает часы представления в указанное время поиска. Например, если приложение выполняет поиск по 5-секундной позиции в файле, сеанс мультимедиа запускает часы через 5 секунд. Источник мультимедиа может доставлять образцы с немного более ранней меткой времени, если время поиска не попадает на границу ключевого кадра. Это необходимо, чтобы декодеры могли декодировать все кадры. Сеанс мультимедиа удаляет или обрезает выборки перед достижением приемников мультимедиа, чтобы соответствовать запрошенному времени поиска. Например, если время поиска составляет 5 секунд, первый образец звука может начаться через 4,5 секунд. Сеанс мультимедиа обрезает первые 0,5 секунд с первого декодированного аудио образца.

## <a name="creating-the-presentation-clock"></a>Создание часов представления

Чтобы создать часы представления, вызовите [**мфкреатепресентатионклокк**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationclock). Чтобы завершить работу часов, выполните запрос к интерфейсу [**имфшутдовн**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) и вызовите [**Имфшутдовн:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown). Вызывающий объект **мфкреатепресентатионклокк** отвечает за вызов **завершения работы**. в большинстве случаев это сеанс мультимедиа, а не приложение.

## <a name="presentation-time-sources"></a>Источники времени презентации

Несмотря на свое имя, часы презентации фактически не реализуют часы. Вместо этого он получает значения часов из другого объекта, который называется *источником времени презентации*. Источником времени может быть любой объект, создающий точные такты времени и предоставляющий интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) . Данный процесс показан на следующем рисунке.

![Схема, показывающая связь между часами представления и источником времени презентации](images/dedc255c-eb6d-49fc-8892-7b6076ed4488.gif)

При первом создании часов презентации он не имеет источника времени. Чтобы задать источник времени, вызовите [**имфпресентатионклокк:: сеттимесаурце**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationclock-settimesource) с указателем на интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) источника времени. Источник времени поддерживает те же состояния, что и часы представления (запуск, приостановка и остановка), и должен реализовывать интерфейс [**имфклоккстатесинк**](/windows/desktop/api/mfidl/nn-mfidl-imfclockstatesink) . Часы представления используют этот интерфейс для уведомления источника времени об изменении состояния. Таким образом, источник времени предоставляет такты часов, но часы представления инициируют изменения состояния в часах.

Некоторые приемники мультимедиа имеют доступ к точным часам и, таким образом, предоставляют интерфейс [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource) . В частности, модуль подготовки звука может использовать частоту звуковой карты в виде часов. В воспроизведении звука полезно, чтобы модуль подготовки звука действовал в качестве источника времени, чтобы видео было синхронизировано с частотой воспроизведения звука. Обычно это дает лучшие результаты, чем попытка сопоставить звук с внешними часами.

Media Foundation также предоставляет источник времени презентации на основе системных часов. Чтобы создать этот объект, вызовите [**мфкреатесистемтимесаурце**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatesystemtimesource). Системный источник времени можно использовать, когда приемники носителей не предоставляют источник времени.

В общем случае приемник мультимедиа должен использовать предоставленные ему часы презентации независимо от источника времени, используемого часами представления. Это правило применяется, даже если приемник мультимедиа реализует [**имфпресентатионтимесаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationtimesource). Если часы презентации используют другой источник времени, приемник мультимедиа должен следовать за этим источником времени, а не со своими собственными внутренними часами.

Существует две ситуации, когда приемник мультимедиа не будет следовать часам презентации:

-   Некоторые приемники мультимедиа не имеют *интенсивности*. Если приемник мультимедиа не зависит от скорости, он использует примеры как можно быстрее, не планируя их в соответствии с часами презентации. Обычно приемники, не имеющие интенсивности, записывают данные в файл, поэтому желательно выполнить операцию как можно быстрее. Приемник с независимыми частотами возвращает \_ в метод [**имфмедиасинк::**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) медиасинк флаг безчастотной скорости. Если все приемники в топологии не имеют скорости, сеанс передачи данных по мере возможности отправляет данные через конвейер.

-   Некоторые приемники мультимедиа не могут соответствовать тарифам с источником времени, отличным от самих. Если это так, приемник возвращает МЕДИАСИНК \_ не может \_ соответствовать \_ флагу часов в [](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) методе "Methods". Конвейер может по-прежнему использовать другой источник времени, но результаты будут менее оптимальными. Приемник, скорее всего, будет относиться к сбоям и вызывать сбои во время воспроизведения.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Media Foundation API платформы](media-foundation-platform-apis.md)
</dt> </dl>

 

 



