---
description: Компоненты сетевого источника
ms.assetid: a4e20ecb-c145-4823-ae59-f6fc88593d86
title: Компоненты сетевого источника
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e937a97cf743740d9cebf84ad477c52cdee5083
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104571041"
---
# <a name="network-source-features"></a>Компоненты сетевого источника

Сетевой источник предоставляет базовую реализацию для потоковой передачи файлов мультимедиа и предоставляет интерфейс [**имфмедиасаурце**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) . Конкретная реализация сетевого источника зависит от протокола, используемого для открытия источника, такого как RTSP или HTTP. Сетевые источники, зависящие от протокола, расширяют базовую функциональность сети. Сведения о поддерживаемых схемах и протоколах см. в разделе [Поддерживаемые протоколы](supported-protocols.md).

Источник сети:

-   Реализует такие функции, как кэширование, обнаружение прокси-сервера и автоматическое повторное подключение.
-   Преобразует независимые от протокола вызовы из сопоставителя источников в вызовы, относящиеся к протоколу.
-   Взаимодействует с уровнем сокета и операционной системой. Анализирует описание SDP и использует его в качестве данных конфигурации, а также считывает потоковые данные с базового уровня сокетов. При получении сетевой источник отвечает за Переупорядочение и запрос повторной передачи пакетов.

## <a name="network-source-creation"></a>Создание источника сети

Создание источника мультимедиа для источника из сети не отличается от источника носителя для локального файла. Приложение передает URL-адрес источника в методы [сопоставителя источника](source-resolver.md) , такие как [**Имфсаурцересолвер:: креатеобжектфромурл**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-createobjectfromurl) или [**имфсаурцересолвер:: БЕГИНКРЕАТЕОБЖЕКТФРОМУРЛ**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) , и задает \_ флаг MF Resolve \_ MEDIASOURCE. Дополнительные сведения об использовании этого флага см. [в разделе Использование сопоставителя источников](using-the-source-resolver.md).

В зависимости от схемы, предоставляемой приложением, сопоставитель источников загружает соответствующий объект обработчика схемы, который предоставляет интерфейс [**имфсчемехандлер**](/windows/desktop/api/mfidl/nn-mfidl-imfschemehandler) . Приложение также может напрямую использовать обработчик схемы для создания сетевого источника путем вызова [**имфсчемехандлер:: бегинкреатеобжект**](/windows/desktop/api/mfidl/nf-mfidl-imfschemehandler-begincreateobject).

Дополнительные сведения см. в разделе [обработчики схем и обработчики Byte-Stream](scheme-handlers-and-byte-stream-handlers.md).

Media Foundation не поддерживает байтовые потоки для сетевых источников. Объект байтового потока поддерживается только в сценарии загруженного содержимого. Все данные передаются как можно быстрее, чтобы их можно было сохранить в виде файла на локальном компьютере. веб-серверы предоставляют Скачанные данные. После начала загрузки обмен данными между клиентом и сервером отсутствует. В этом случае используется протокол HTTP download.

Если приложение запрашивает у сопоставителя источника создание объекта байтового потока для схем "http:", "MMS:" или "RTSP:", вызов завершается с \_ \_ ошибкой неподдерживаемой схемы MF E \_ .

> [!Note]  
> В Windows 7 сетевой источник поддерживает файлы станции Windows Media (. NSC). Эти файлы используются для многоадресной потоковой передачи содержимого мультимедиа по сети. Создание сетевого источника для указанного. NSC файл, приложение должно использовать сопоставитель источника.

 

Если приложение использует обработчик схемы, то асинхронный вызов игнорирует параметр *dwFlags* и возвращает указатель на источник сети при завершении.

На следующем рисунке показан поток данных для потоковой передачи мультимедиа с использованием сетевого источника.

![Блок-схема, показывающая пути от приложения к серверу потоковой передачи с циклом между источником сети и сеансом мультимедиа](images/3f9186ea-53ed-4a31-a097-92f39fa08624.gif)

## <a name="network-source-configuration"></a>Конфигурация источника сети

В этом разделе описываются функции, поддерживаемые сетевым источником и связанными параметрами конфигурации. Приложение может настроить сетевой источник при создании объекта источника сети. Эти параметры хранятся в объекте **ипропертисторе** , который приложение должно передать в параметр *ппропс* методов сопоставителя источника или [**имфсчемехандлер:: бегинкреатеобжект**](/windows/desktop/api/mfidl/nf-mfidl-imfschemehandler-begincreateobject).

### <a name="auto-reconnect"></a>Автоматическое повторное подключение

Функция автоматического повторного подключения сетевого источника позволяет клиенту автоматически подключаться к серверу мультимедиа при сбое TCP-соединения с сервером или если клиент не получает пакеты. При сбое подключения источник сети пытается повторно подключиться к серверу мультимедиа с использованием той же конфигурации, которая использовалась в предыдущем соединении. Процесс повторного подключения является асинхронным. Сетевой источник создает событие [мереконнектстарт](mereconnectstart.md) , когда оно начинает повторное подключение, и событие [мереконнектенд](mereconnectend.md) при успешном или неудачном завершении подключения.

Если количество повторных попыток подключения превышает максимальное значение, указанное в свойстве [**мфнетсаурце \_ аутореконнектлимит**](mfnetsource-autoreconnectlimit-property.md) , операция повторного подключения отменяется. Число попыток повторного подключения хранится в свойстве [**мфнетсаурце \_ аутореконнектпрогресс**](mfnetsource-autoreconnectprogress-property.md) .

Автоматическое повторное подключение обеспечивает плавное воспроизведение содержимого мультимедиа даже при сбое TCP-подключения к серверу мультимедиа. Для плавного воспроизведения клиент должен иметь достаточно данных (по крайней мере 1 – 2 минуты) в кэше для продолжения воспроизведения до повторного подключения. В свойстве [**мфнетсаурце \_ максбуффертимемс**](mfnetsource-maxbuffertimems-property.md) можно задать максимальный объем данных, которые могут быть помещены в буфер сетевого источника.

### <a name="fast-streaming"></a>Быстрая потоковая передача

Клиент источника сети запрашивает сервер для потоковой передачи данных в начале содержимого с более высокой скоростью, чем указано в скорости потока содержимого. Если на сервере включен *Быстрый запуск* , сервер отправляет поток ускорения по скорости потока, чтобы клиент мог буферизовать достаточное количество данных быстрее, чем в режиме реального времени. Это повышает удобство работы пользователей за счет минимизации задержек начальной буферизации, которые могут быть вызваны различными факторами, такими как низкая скорость клиентского компьютера, сеть и доступная пропускная способность.

Чтобы указать объем данных для ускоренной потоковой передачи, которые клиент может запрашивать, задайте свойство [**мфнетсаурце \_ акцелератедстреамингдуратион**](mfnetsource-acceleratedstreamingduration-property.md) . Если сетевой источник использует UDP в качестве транспортного протокола, укажите максимальный объем данных для быстрой потоковой передачи, задав вместо этого свойство [**мфнетсаурце \_ максудпакцелератедстреамингдуратион**](mfnetsource-maxudpacceleratedstreamingduration-property.md) .

Ускоренная потоковая передача на клиенте также возможна с помощью функции *быстрого кэширования* — потоковая передача содержимого по запросу выполняется быстрее, чем в режиме реального времени, и кэширование данных в локальном кэше клиента. Чтобы использовать этот тип быстрой потоковой передачи, на сетевом источнике должен быть включен быстрый кэш, который должен поддерживаться сервером. Когда клиент запрашивает содержимое с сервера, сетевой источник сначала проверяет, уже находится ли содержимое в кэше клиента. Если содержимое находится в локальном кэше клиента и срок его действия не истек, он готовится к просмотру. Если содержимое не находится в локальном кэше или уже истек, содержимое передается в поток и кэшируется, а сетевой источник воспроизводит его из локального кэша. В последующих запросах для списков воспроизведения только отсутствующие записи кэшируются, а затем воспроизводятся. Если запись списка воспроизведения уже находится в локальном кэше клиента, она воспроизводится и не кэшируется снова.

По умолчанию быстрый кэш включен на клиентском сетевом источнике. Однако следующие факторы также определяют, используется ли эта функция:

-   Клиент должен иметь лишнюю пропускную способность для скачивания и кэширования содержимого быстрее, чем обычная скорость.
-   На клиенте должно быть достаточно места на диске. Если на клиенте имеется менее 100 МБ свободного дискового пространства после кэширования запрошенного содержимого по запросу, он не кэшируется, но передается в потоковом режиме и подготавливается к просмотру одновременно.

Функция быстрого кэширования управляется свойством [**мфнетсаурце \_ качинаблед**](mfnetsource-cacheenabled-property.md) .

### <a name="buffer-management"></a>Управление буферами

Сетевой источник обеспечивает эффективное управление буферами, которое отслеживает состояние буфера на клиенте. По умолчанию источник сети помещает в буфер данные за 5 секунд при запуске. Это значение можно настроить, задав свойство [**мфнетсаурце \_ буфферингтиме**](mfnetsource-bufferingtime-property.md) . Исходя из значения этого свойства, источник сети вычислит размер буфера, достаточный для обеспечения плавного и непрерывного воспроизведения мультимедийного содержимого. Если это свойство имеет значение 0, управление буфером отключено. Когда объем содержимого в буфере мал, источник сети начинает буферизацию и вызывает событие [мебуфферингстартед](mebufferingstarted.md) , чтобы указать, что буферизация началась. После получения этого события конвейер прекращает подготовку к просмотру. Когда буферизация завершена, источник сети создает событие [мебуфферингстоппед](mebufferingstopped.md) , и клиент может снова начать подготовку к просмотру.

Клиент начинает подготовку к просмотру содержимого после того, как он накапливает объем данных, указываемый размером буфера первого образца. Если это значение меньше, чем размер вычисляемого буфера, воспроизведение начинается немедленно. Такое поведение очень похоже на функцию быстрого запуска.

Свойство [**мфнетсаурце \_ максбуффертимемс**](mfnetsource-maxbuffertimems-property.md) хранит максимальный объем данных, которые могут быть помещены в буфер.

### <a name="bandwidth-selection"></a>Выбор пропускной способности

Когда клиент подключается к серверу мультимедиа, в рамках настройки подключения сетевой источник выполняет *статистическое измерение пар "пакет-член* " для оценки пропускной способности исходной связи между клиентом и сервером. В зависимости от результата этого измерения Клиент может выбрать потоки аудио и видео, которые помещаются в пределах предполагаемой пропускной способности. Это обеспечивает плавное воспроизведение содержимого потоковой передачи мультимедиа.

На этапе быстрого запуска выполняется *динамическое измерение пары пакетов* . В этом процессе клиент получает большие объемы данных, которые могут быть несколькими пакетами или выборками.

Результат измерения с динамическим связыванием пакетов более точен, чем оценка пропускной способности канала, возвращенная статическим измерением пары пакетов, поскольку процесс статического связывания пакетов отправляет один пакет фиксированного размера, что может привести к неточным результатам для сетей с высокой пропускной способностью.

Приложение может получить предполагаемую пропускную способность с помощью свойства [**мфнетсаурце \_ ппбандвидс**](mfnetsource-ppbandwidth-property.md) .

Условия сети могут динамически изменяться, что вызывает сбои при воспроизведении сетевого источника. Источник сети может изменить исходный выбор клиента в зависимости от скорости приема и состояния буфера. Например, клиент может переключиться на более низкую скорость во время перегрузки сети и переключиться на более высокую скорость, когда сетевой трафик увеличился и клиент накапливает достаточное количество буферизованного содержимого.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сетевые подключения в Media Foundation](networking-in-media-foundation.md)
</dt> </dl>

 

 



