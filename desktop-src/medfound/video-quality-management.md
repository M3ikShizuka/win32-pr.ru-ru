---
description: Управление качеством видео
ms.assetid: 3617adf2-ed7b-4788-abce-58bc22a14511
title: Управление качеством видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 233ccd54cfcb98742abef9a91241e903c07ba549
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991412"
---
# <a name="video-quality-management"></a>Управление качеством видео

В этом разделе описываются некоторые улучшения конвейера видео в Windows 7 для Microsoft Media Foundation и Microsoft DirectShow.

В идеальном мире видео никогда не будет выгружаться, независимо от разрешения видео или загрузки ЦП или GPU. Безусловно, в реальности конвейер видео должен иметь возможность работать с ограниченными аппаратными ресурсами, и он должен адаптивно адаптировать воспроизведение в среде системы. Цели управления качеством видео:

-   Уменьшение количества сбоев (пропущенных или последних кадров).
-   Сократите использование памяти, особенно в GPU.
-   Сократите энергопотребление, особенно на ноутбуках с питанием от аккумулятора.
-   Получите лучшее качество изображения, учитывая ограничения ресурсов.
-   Синхронизация видео с аудио.

Некоторые из этих целей не связаны, особенно в низкоуровневых системах. Как правило, существует компромисс между скоростью и качеством. Сбой является более нежелательным, чем умеренное уменьшение качества визуального элемента. Относительная важность потребления энергии зависит от среды. на ноутбуке, работающем на питании от аккумулятора, очень важно.

В Windows 7 Усовершенствованный модуль подготовки отчетов (Евр) обеспечивает улучшенную поддержку управления качеством видео. Как конвейер Media Foundation, так и конвейер DirectShow были обновлены, чтобы воспользоваться преимуществами этих возможностей. Используется существования такого двухаспектногой подход:

-   Перед началом воспроизведения конвейер может выполнять статическую оптимизацию на основе параметров управления питанием пользователя и сведений об оборудовании.
-   После начала воспроизведения конвейер может применять динамическую оптимизацию на основе производительности во время выполнения.

## <a name="quality-management-in-media-foundation"></a>Управление качеством в Media Foundation

Чтобы включить статическую оптимизацию, перед разрешением топологии необходимо установить атрибут [ \_ статических средств \_ \_ \_ оптимизации воспроизведения топологии MF](mf-topology-static-playback-optimizations.md) в частичной топологии. Загрузчик топологии запрашивает этот атрибут в методе [**имфтополоадер:: Load**](/windows/desktop/api/mfidl/nf-mfidl-imftopoloader-load) .

При включении статических оптимизаций необходимо задать два других атрибута в топологии:



| attribute                                                                                                                                      | Описание                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
| <span id="MF_TOPOLOGY_PLAYBACK_MAX_DIMS"></span><span id="mf_topology_playback_max_dims"></span>\_ \_ Максимальное число воспроизведений для воспроизведения топологии MF \_ \_<br/>   | Указывает максимальный размер окна воспроизведения видео.<br/> |
| <span id="MF_TOPOLOGY_PLAYBACK_FRAMERATE"></span><span id="mf_topology_playback_framerate"></span>\_ \_ Частота воспроизведения в топологии MF \_<br/> | Указывает частоту обновления монитора.<br/>                      |



 

Эти два атрибута помогают конвейеру рассчитать наиболее эффективный параметр для управления качеством.

Динамическая оптимизация выполняется диспетчером качества. Для включения диспетчера качества ничего делать не нужно. Он включается автоматически. Диспетчер качества существовал в Windows Vista; в Windows 7 Евр может лучше реагировать на сообщения от диспетчера качества.

## <a name="quality-management-in-directshow"></a>Управление качеством в DirectShow

DirectShow поддерживает статическую и динамическую оптимизацию для воспроизведения DVD-дисков. Чтобы включить эти оптимизации в приложении воспроизведения DVD, установите следующие флаги в параметре *dwFlags* метода **Идвдграфбуилдер:: рендердвдвидеоволуме** :



| Flag                  | Описание                    |
|-----------------------|--------------------------------|
| \_Диаграмма на DVD-дисках \_ \_ | Включает статическую оптимизацию.  |
| \_ \_ Евр \_ качество обслуживания DVD     | Включает динамическую оптимизацию. |



 

Другие приложения DirectShow могут включить динамическую оптимизацию, вызвав метод [**иеврфилтерконфижекс:: сетконфигпрефс**](/windows/desktop/api/evr/nf-evr-ievrfilterconfigex-setconfigprefs) непосредственно в фильтре Евр. Укажите флаг **еврфилтерконфигпрефс \_ енаблекос** .

> [!Note]  
> Статическая оптимизация в DirectShow ограничена воспроизведением DVD.

 

## <a name="quality-management-in-the-evr"></a>Управление качеством в Евр

Евр поддерживает некоторые новые флаги конфигурации для управления качеством. Если включить оптимизацию управления качеством, описанную выше, не нужно задавать эти флаги напрямую. Однако они задокументированы для приложений, которым требуется более детальный контроль над Евр.

Установите следующие флаги в микшере евр, вызвав метод [**IMFVideoMixerControl2:: сетмиксингпрефс**](/windows/desktop/api/evr/nf-evr-imfvideomixercontrol2-setmixingprefs) :



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Флаги</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><strong>MFVideoMixPrefs_ForceHalfInterlace</strong></li>
<li><strong>MFVideoMixPrefs_AllowDropToHalfInterlace</strong></li>
</ul></td>
<td>Пропустите второе поле каждого кадра с чередованием.</td>
</tr>
<tr class="even">
<td><ul>
<li><strong>MFVideoMixPrefs_AllowDropToBob</strong></li>
<li><strong>MFVideoMixPrefs_ForceBob</strong></li>
</ul></td>
<td>Используйте несамостоятельную разчересстрочную развертку Боба, даже если драйвер поддерживает режим с чередованием более высокого качества.</td>
</tr>
</tbody>
</table>



 

Установите следующие флаги для выступающего евр, вызвав метод [**имфвидеодисплайконтрол:: сетрендерингпрефс**](/windows/desktop/api/evr/nf-evr-imfvideodisplaycontrol-setrenderingprefs) :



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Флаги</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><strong>MFVideoRenderPrefs_ForceOutputThrottling</strong></li>
<li><strong>MFVideoRenderPrefs_AllowOutputThrottling</strong></li>
</ul></td>
<td>Регулирование выходных данных для соответствия пропускной способности GPU.</td>
</tr>
<tr class="even">
<td><ul>
<li><strong>MFVideoRenderPrefs_ForceBatching</strong></li>
<li><strong>MFVideoRenderPrefs_AllowBatching</strong></li>
</ul></td>
<td>Вызовы пакетной службы Direct3D представлены в виде вызовов. Такая оптимизация позволяет системе переходить в состояние простоя чаще, что может снизить энергопотребление.</td>
</tr>
<tr class="odd">
<td><ul>
<li>MFVideoRenderPrefs_ForceScaling</li>
<li>MFVideoRenderPrefs_AllowScaling</li>
</ul></td>
<td>Смешивание видео с помощью прямоугольника, размер которого меньше, чем прямоугольник вывода. Масштабировать результат до правильного размера выходных данных.</td>
</tr>
</tbody>
</table>



 

Кроме того, приемник мультимедиа Евр поддерживает атрибуты конфигурации, соответствующие каждому из этих флагов:

-   [Еврконфиг \_ алловбатчинг](evrconfig-allowbatching.md)
-   [Еврконфиг \_ алловдроптобоб](evrconfig-allowdroptobob.md)
-   [Еврконфиг \_ алловдроптохалфинтерлаце](evrconfig-allowdroptohalfinterlace.md)
-   [Еврконфиг \_ алловскалинг](evrconfig-allowscaling.md)
-   [Еврконфиг \_ алловдроптосроттле](evrconfig-allowdroptothrottle.md)
-   [Еврконфиг \_ форцебатчинг](evrconfig-forcebatching.md)
-   [Еврконфиг \_ форцебоб](evrconfig-forcebob.md)
-   [Еврконфиг \_ форцехалфинтерлаце](evrconfig-forcehalfinterlace.md)
-   [Еврконфиг \_ форцескалинг](evrconfig-forcescaling.md)
-   [Еврконфиг \_ форцесроттле](evrconfig-forcethrottle.md)

Перед началом воспроизведения эти атрибуты можно задать непосредственно в приемнике носителей Евр в качестве альтернативы вызову методов [**IMFVideoMixerControl2**](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol2) и [**имфвидеодисплайконтрол**](/windows/desktop/api/evr/nn-evr-imfvideodisplaycontrol) . Чтобы задать эти атрибуты, выполните запрос к приемнику Евр мультимедиа для [**имфаттрибутес**](/windows/desktop/api/mfobjects/nn-mfobjects-imfattributes).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сеанс мультимедиа](media-session.md)
</dt> </dl>

 

 




