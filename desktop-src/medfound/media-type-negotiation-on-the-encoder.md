---
description: Согласование типов мультимедиа в кодировщике
ms.assetid: c8ae543e-68f7-4c74-9cb7-2a200bd51820
title: Согласование типов мультимедиа в кодировщике
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 20ac5dd5a107633feba4ce2a74da7e9aea7e9f71d51be1b5cad5b85ab4adda35
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119941514"
---
# <a name="media-type-negotiation-on-the-encoder"></a>Согласование типов мультимедиа в кодировщике

В Microsoft Media Foundation кодировщики реализуются как [Media Foundation преобразования](media-foundation-transforms.md) (МФТС) с одним входом и одним выходом. Перед сеансом кодирования кодировщику необходимо выяснить характеристики потока, который он получает в качестве входных данных, и формат потока, который он будет выдавать в качестве выходных данных. Перед передачей данных через кодировщик необходимо задать типы входных и выходных носителей и связанные характеристики. Необходимо указать форматы входных и выходных данных, указав соответствующие [идентификаторы GUID типа носителя](media-type-guids.md) и задав характеристики выходного потока, установив соответствующие [атрибуты типа мультимедиа](media-type-attributes.md) для выходного типа носителя. В новом экземпляре кодировщика не заданы типы носителей.

Тип входного носителя — это несжатый формат, например видеозапись PCM или видео в формате RGB. Типы форматов, используемые кодировщиком, ограничиваются теми, которые описаны структурами **видеоинфохеадер** и **вавеформатекс** . дополнительные сведения об этих структурах см. в документации по Windows SDK. Media Foundation предоставляет вспомогательные функции для создания типов мультимедиа из структур форматов. Например, функция [**мфинитмедиатипефромвидеоинфохеадер**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromvideoinfoheader) инициализирует тип видео из структуры **видеоинфохеадер** , а функция [**мфинитмедиатипефромвавеформатекс**](/windows/desktop/api/mfapi/nf-mfapi-mfinitmediatypefromwaveformatex) инициализирует тип видео из структуры **WAVEFORMATEX** или **WAVEFORMATEXTENSIBLE** . Дополнительные сведения см. в разделе [преобразования типов мультимедиа](media-type-conversions.md). Необходимо задать тип входного носителя в кодировщике, вызвав [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype).

Тип выходного носителя — это формат сжатия, используемый в окончательном исходном потоке или файле. Тип доступного выходного носителя можно задать только после задания типа входного носителя. Поддерживаемые типы выходных данных можно получить, вызвав [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) в цикле до тех пор, пока кодировщик не возвратит значение **MF \_ E больше \_ \_ \_ типов**. Увеличьте индекс типа с каждой итерацией. При обнаружении соответствующего типа носителя задайте тип выходного носителя, вызвав [**имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).

Выбор типа выходного носителя зависит от типа кодировки и требований к кодировке. Например, для звуковых потоков, CBR в кодировке, необходимо найти тип мультимедиа, который соответствует вашим входным данным и имеет битовую скорость, максимально близкую к целевому значению.

Если вы хотите использовать режим кодирования, отличный от CBR, необходимо установить режим, а затем перечислить типы выходных данных для этого режима, так как кодировщик изменяет Поддерживаемые типы вывода в зависимости от набора режимов. Свойства, управляющие режимом кодирования, — это [**мфпкэй \_ Вбренаблед**](mfpkey-vbrenabledproperty.md) и [**мфпкэй \_ пассесусед**](mfpkey-passesusedproperty.md). Например, при перечислении типов выходных данных для кодирования с использованием качества VBR тип мультимедиа зависит от значения качества, которое вы решили использовать. Дополнительные сведения об установке этих свойств см. в разделе [Свойства кодировки](configuring-the-encoder.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Создание экземпляра MFT для кодировщика](instantiating-the-encoder-mft.md)
</dt> <dt>

[Windows Кодировщики мультимедиа](windows-media-encoders.md)
</dt> </dl>

 

 



