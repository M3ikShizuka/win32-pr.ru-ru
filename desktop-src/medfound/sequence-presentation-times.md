---
description: В этом разделе описывается, как источник Sequencer обрабатывает время презентации во время воспроизведения.
ms.assetid: 0d095e25-5ccf-4319-8767-07b417ed7ee8
title: Время представления последовательности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d17f5b0ff4bd6f0cfee2b1b461d6fbd11bdbf0fb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104543807"
---
# <a name="sequence-presentation-times"></a>Время представления последовательности

В этом разделе описывается, как [источник Sequencer](sequencer-source.md) обрабатывает время презентации во время воспроизведения.

## <a name="overview"></a>Обзор

Источник Sequencer поддерживает два разных режима: последовательности воспроизведения и изменения последовательностей.

В последовательности редактирования приложение задает длительность каждого сегмента заранее перед началом воспроизведения. В последовательности списков воспроизведения приложение не указывает длительность заранее. (На самом деле, длительность может быть неизвестной.)

В обоих случаях можно указать время начала и окончания носителя сегмента. Эти значения указывают позицию начала и конца сегмента в исходном файле. Например, предположим, что исходный файл имеет длину в 90 секунд. Если вы хотите обрезать первые 10 секунд, а последние 10 секунд, укажите следующие значения:

-   Начало носителя: 10 секунд
-   Окончание носителя: 80 с

Чтобы указать время запуска носителя, установите атрибут [MF \_ топоноде \_ медиастарт](mf-toponode-mediastart-attribute.md) на исходном узле. Чтобы указать время завершения носителя, установите атрибут [MF \_ топоноде \_ медиастоп](mf-toponode-mediastop-attribute.md) на исходном узле.

Чтобы создать последовательность редактирования, задайте атрибут [ \_ \_ глобального \_ времени сеанса MF](mf-session-global-time-attribute.md) при создании сеанса мультимедиа. В противном случае сеансу мультимедиа требуются последовательности списков воспроизведения. В последовательности редактирования Каждая топология сегмента должна иметь атрибут [MF \_ Topology \_ прожектстарт](mf-topology-projectstart-attribute.md) и атрибут [ \_ \_ прожектстоп Topology](mf-topology-projectstop-attribute.md) .

## <a name="playlist-sequences"></a>Последовательности списков воспроизведения

В последовательности воспроизведения часы представления начинаются с нуля и по границам сегментов. Собственные источники предоставляют образцы с отметками времени, равными времени носителя. Конвейер преобразует отметки времени в правильное время презентации следующим образом:

-   Новая метка времени = медиа время + смещение — начало носителя

Значение *offset* — это время презентации, с которой закончился предыдущий сегмент. Для первого сегмента смещение равно нулю. Ниже приведены два примера того, как рассчитываются эти преобразования штампа времени:

-   Пример 1. Предположим, что первый сегмент (S1) находится в течение 10 секунд, а второй сегмент (S2) имеет нулевое время начала воспроизведения. Собственный источник использует время носителя для штампов времени, поэтому Первая выборка из S2 имеет отметку времени, равную нулю. Смещение составляет 10 секунд (длительность S1), поэтому скорректированная отметка времени имеет следующие значения: 0 + 10 – 0 = 10 секунд.
-   Пример 2. Предположим, что сегмент S1 имеет длину 10 секунд, а S2 — время начала работы с носителем 5 секунд. Первый пример из S2 имеет отметку времени 5 секунд (время мультимедиа). Смещение составляет 10 секунд, поэтому скорректированная отметка времени: 5 + 10 − 5 = 10 секунд.

Все компоненты конвейера, нисходящие от исходных узлов, получают образцы с скорректированными штампами времени. Исходные узлы в топологии могут иметь разные значения времени начала носителя, поэтому эти изменения рассчитываются отдельно для каждой ветви топологии.

Когда презентация переходит к следующему сегменту, часы презентации не останавливаются и не сбрасываются, а время презентации увеличивается монотонно. Прежде чем начать новый сегмент, сеанс мультимедиа отправляет приложению событие [месессионнотифипресентатионтиме](mesessionnotifypresentationtime.md) . Событие указывает начальное время сегмента относительно часов представления и значение смещения. При запуске нового сегмента конвейер вызывает [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) в источнике Sequencer со значением VT \_ Empty. Источник Sequencer отправляет событие [месаурцестартед](mesourcestarted.md) без времени начала.

Для поиска приложение указывает идентификатор сегмента и смещение времени в пределах сегмента. После поиска время проведения презентации начинается с смещения *сегмента* . Ниже приведен пример того, как работает этот процесс.

-   Пример 3. приложение выполняет поиск сегмента S3 с смещением сегмента в 10 секунд. Время презентации начинается с 10 секунд (смещение сегмента). Смещение не включает продолжительность сегментов S1 и S2. Источник Sequencer отправляет событие [месаурцестартед](mesourcestarted.md) с временем начала, равным смещению сегмента, 10 секунд.

После поиска, если воспроизведение переходит к следующему сегменту, переход работает так же, как в предыдущих примерах, за исключением того, что смещение не включает пропущенные сегменты.

Ниже приведены некоторые дополнительные сведения, которые влияют на отметку времени в примерах.

-   Декодерам могут потребоваться данные за пределами времени окончания. Конвейер извлекает столько данных из источника, сколько требуется декодеру, а затем обрезает образцы выходных данных декодера.
-   Преобразования могут буферизовать данные в буфере. Например, может потребоваться звуковой эффекты. Когда сегмент заканчивается, отметка времени в последней выборки из преобразования предшествует концу сегмента, поскольку преобразование удерживает некоторые данные. При запуске следующего сегмента отметка времени в первом примере немного раньше, чем начало сегмента. В метках времени нет зазора, поэтому данные, которые достигают приемника мультимедиа, непрерывны. По окончании последнего сегмента конвейер прекращает преобразование, поэтому данные не теряются.
-   Для получения предыдущего ключевого кадра источнику может потребоваться несколько времени до начала работы с носителем. Таким образом, после корректировки первый пример может иметь отрицательное время презентации.

## <a name="editing-sequences"></a>Изменение последовательностей

В последовательности редактирования приложение указывает границы сегмента заранее, установив атрибуты [**\_ топологии MF \_ прожектстарт**](mf-topology-projectstart-attribute.md) и [**MF \_ Topology \_ прожектстоп**](mf-topology-projectstop-attribute.md) . Конвейер вычисляет корректировки для меток времени почти так же, как для последовательности воспроизведения:

-   Для смещения используется значение [**MF \_ TOPOLOGY \_ прожектстарт**](mf-topology-projectstart-attribute.md), вместо того чтобы использовать наблюдаемый конец сегмента.

-   Для поиска смещение использует значение, равное значению [**\_ \_ прожектстарт топологии MF**](mf-topology-projectstart-attribute.md) и смещению сегмента.

Поэтому время презентации в последовательности редактирования всегда отсчитывается относительно начала презентации, даже если приложение выполняет поиск в другом сегменте.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сеанс мультимедиа](media-session.md)
</dt> <dt>

[Источник Sequencer](sequencer-source.md)
</dt> </dl>

 

 



