---
description: Расширенный обработчик видео (Евр) — это компонент, отображающий видео на мониторе пользователей.
ms.assetid: 1c985558-d25d-4f51-978a-58c05943dab9
title: Улучшенный модуль подготовки видео
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1ab0881da0827e6cc757a0ea855bcb51864dd98e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342492"
---
# <a name="enhanced-video-renderer"></a>Улучшенный модуль подготовки видео

Расширенный обработчик видео (Евр) — это компонент, отображающий видео на мониторе пользователя. Существуют две версии Евр:

-   Приемник мультимедиа Евр для приложений Media Foundation.
-   Фильтр Евр для приложений DirectShow.

Обе версии используют одни и те же внутренние объекты для отрисовки видео и совместно используют многие из одних и тех же интерфейсов.

Евр может сочетать до 16 потоков видео. Первый входной поток называется *ссылочным потоком*. Ссылочный поток всегда отображается первым в z-порядке. Любые дополнительные потоки называются *подпотоками* и смешиваются поверх потока ссылок. Приложение может изменить z-порядок для подпотоков, но ни один из подпотоков не может быть первым в z-порядке.

Графический драйвер определяет поддерживаемые форматы видео, но обычно они ограничены следующими элементами:

-   Ссылочный поток: прогрессивное или чередование YUV без альфа-составляющей для каждого пикселя (например, NV12 или YUY2); или прогрессивный RGB.
-   Подпотоки: прогрессивное YUV с поддержкой отдельных пикселей, например АЙУВ или AI44.

Доступные форматы подпотока могут зависеть от формата потока ссылок. Дополнительные сведения см. в разделе [Евр Media Type переговоры](evr-media-type-negotiation.md).

На внутреннем уровне Евр использует объект, называемый *микшером* , для совмещения кадров из входных потоков на одной поверхности для отрисовки. Микшер также выполняет дечередование и исправление цветов. Выходные данные микшера — это окончательный составной кадр видеоматериала. Второй объект, называемый *выступающим* , визуализирует видеокадр на экране. Выступающий планирует, когда кадры подготавливаются к просмотру и управляют устройством Direct3D. Приложение может предоставить пользовательскую реализацию либо микшера, либо выступающего.

Частота выходных кадров заблокирована в ссылочном потоке. Когда подпотоки получают новые кадры, микшер удерживает их. Когда ссылочный поток получает новый кадр, микшер комбинирует этот кадр с кадрами подпотока. (Если для потока ссылок используется чередование, для полного кадра ссылок может потребоваться несколько примеров мультимедиа.) Подпоток может получить более одного кадра, пока микшер ожидает ссылочного фрейма. В этом случае микшер просто удаляет предыдущий кадр подпотока.

Поскольку выступающий создает устройство Direct3D, оно также отвечает за предоставление общего доступа к устройству другим объектам конвейера, которым требуется доступ к службам DirectX Video Acceleration (ДКСВА). В частности, микшер Евр использует службы обработки видео ДКСВА для дечередования и смешивания видео. По отношению к Евр программные декодеры могут использовать ДКСВА для ускорения декодирования видео. Выступающий использует устройство Direct3D с помощью [Диспетчер устройств Direct3D](direct3d-device-manager.md). На следующей диаграмме показана внутренняя архитектура Евр. (Программный декодер, затененный серым цветом, не является частью Евр.)

![Схема архитектуры, показывающая Евр.](images/5d4a1fd9-25ff-4cc5-a486-0d22f34bbfd7.gif)

## <a name="evr-interfaces"></a>Интерфейсы Евр

Евр поддерживает следующие интерфейсы. Некоторые из этих интерфейсов реализуются микшером или выступающим. Для каждого интерфейса справочный раздел описывает, как получить указатель на интерфейс.

| Интерфейс                                                    | Описание                                                                                       |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| [**иеврфилтерконфиг**](/windows/desktop/api/evr/nn-evr-ievrfilterconfig)                 | Задает количество входных ПИН-кодов в фильтре Евр (только DirectShow).                                |
| [**иеврфилтерконфижекс**](/windows/desktop/api/evr/nn-evr-ievrfilterconfigex)             | Настраивает фильтр Евр (только DirectShow).                                                      |
| [**иевртрустедвидеоплугин**](/windows/desktop/api/evr/nn-evr-ievrtrustedvideoplugin)     | Включает подключаемый модуль Евр для отображения защищенного видео.                                                 |
| [**имфдесиредсампле**](/windows/desktop/api/evr/nn-evr-imfdesiredsample)                 | Позволяет выступающему Евр запрашивать конкретный кадр из микшера.                             |
| [**имфкуалитядвисе**](/windows/desktop/api/mfidl/nn-mfidl-imfqualityadvise)                 | Позволяет менеджеру по качеству настраивать качество видео Евр.                                      |
| [**имфтопологисервицелукуп**](/windows/desktop/api/evr/nn-evr-imftopologyservicelookup) | Включает пользовательский микшер или выступающий для получения указателей интерфейса из Евр.                       |
| [**имфвидеодевицеид**](/windows/desktop/api/evr/nn-evr-imfvideodeviceid)                 | Возвращает идентификатор устройства для микшера Евр или Presenter.                                       |
| [**имфвидеодисплайконтрол**](/windows/desktop/api/evr/nn-evr-imfvideodisplaycontrol)     | Управляет отображением видео в Евр.                                                              |
| [**имфвидеомиксербитмап**](/windows/desktop/api/evr9/nn-evr9-imfvideomixerbitmap)           | Альфа — смешение статического растрового изображения с видео.                                                |
| [**имфвидеомиксерконтрол**](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol)         | Управляет тем, как Расширенный модуль подготовки видео (Евр) смешивает видеопотоки.                            |
| [**IMFVideoMixerControl2**](/windows/desktop/api/evr/nn-evr-imfvideomixercontrol2)       | Управляет параметрами для устранения нечередующихся видео.                                                     |
| [**имфвидеопоситионмаппер**](/windows/desktop/api/evr/nn-evr-imfvideopositionmapper)     | Сопоставляет расположение входного видеопотока с соответствующей позицией в выходном видеопотоке. |
| [**имфвидеопресентер**](/windows/desktop/api/evr/nn-evr-imfvideopresenter)               | Предоставляется средством отображения Евр.                                                                     |
| [**имфвидеопроцессор**](/windows/desktop/api/evr9/nn-evr9-imfvideoprocessor)               | Управляет обработкой видео, включая корректировку, фильтры шума и подробные фильтры.               |
| [**имфвидеорендерер**](/windows/desktop/api/evr/nn-evr-imfvideorenderer)                 | Задает микшер или выступающий на Евр.                                                             |
| [**имфвидеосамплеаллокатор**](/windows/desktop/api/mfidl/nn-mfidl-imfvideosampleallocator)   | Выделяет образцы видео.                                                                          |



 

## <a name="in-this-section"></a>в этом разделе



| Раздел                                                                    | Описание                                                                           |
|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [Использование фильтра Евр DirectShow](using-the-directshow-evr-filter.md)   | Использование Евр в приложении DirectShow.                                       |
| [Использование приемника мультимедиа Евр](using-the-evr-media-sink.md)                 | Как использовать Евр в приложении Media Foundation.                                 |
| [Использование элементов управления отображением видео](using-the-video-display-controls.md) | Как управлять способом отображения видео в окне приложения Евр. |
| [Использование элементов управления "микшер видео"](using-the-video-mixer-controls.md)     | Как управлять способом, которым работает микшер Евр.                               |
| [Согласование типа носителя Евр](evr-media-type-negotiation.md)             | Описывает, как Евр определяет, какие видеоформаты он может принимать в качестве входных данных.          |
| [Пользовательские Миксерс](custom-mixers.md)                                       | Как написать пользовательское микшер для Евр.                                              |
| [Написание выступающего Евр](how-to-write-an-evr-presenter.md)       | Как написать пользовательский объект Presenter для Евр.                                          |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Воспроизведение звука/видео](audio-video-playback.md)
</dt> </dl>

 

 



