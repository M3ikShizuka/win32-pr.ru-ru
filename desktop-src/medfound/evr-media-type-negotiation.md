---
description: Согласование типа носителя Евр
ms.assetid: 3a12b80d-7aac-437d-b515-aab37c1e81b2
title: Согласование типа носителя Евр
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6255a32f876a48d0c6193c0a9b470d20ee178ee0ae6fe4c0504b110a353075b7
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118974493"
---
# <a name="evr-media-type-negotiation"></a>Согласование типа носителя Евр

В этом разделе описывается проверка типов мультимедиа в расширенном обработчике видео (Евр).

-   для DirectShow фильтра евр согласование типов происходит при соединении пин-кодов фильтра.

-   Для приемника мультимедиа Евр типы носителей задаются через интерфейс [**имфмедиатипехандлер**](/windows/desktop/api/mfidl/nn-mfidl-imfmediatypehandler) в приемниках потоков. Обычно загрузчик топологии согласовывает типы носителей, хотя приложение также может задавать типы мультимедиа напрямую.

Евр не сообщает о каких либо предпочтительных типах носителей. Клиент должен протестировать типы мультимедиа до тех пор, пока не найдет допустимый тип. Тип носителя для потока ссылок должен быть задан, прежде чем типы можно будет задать для любого из подпотоков.

Для потока ссылок Евр микшер возвращает список совместимых форматов для визуализации видео DirectX (ДКСВА). В Евр Presenter этот список используется для выбора формата для цепочки подкачки Direct3D. Если не удается найти совместимый формат целевого объекта прорисовки, ЕВР отклоняет тип носителя.

Для вложенных потоков микшер Евр запрашивает, поддерживает ли устройство ДКСВА этот формат подпотока в сочетании с форматом целевого объекта прорисовки, выбранным для потока ссылок. В результате доступные форматы подпотока могут изменяться в зависимости от потока ссылок.

Более подробно этот процесс приведен ниже. Эти сведения не важны для большинства приложений, но они могут оказаться полезными при написании пользовательского микшера или Presenter.

Для потока ссылок согласование происходит следующим образом.

1.  Евр вызывает [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) в микшере.

2.  Микшер преобразует тип носителя в описание ДКСВА 2,0 с помощью структуры [**DXVA2 \_ видеодеск**](/windows/desktop/api/dxva2api/ns-dxva2api-dxva2_videodesc) .

3.  Микшер вызывает [**идиректксвидеопроцессорсервице:: жетвидеопроцессордевицегуидс**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoprocessorservice-getvideoprocessordeviceguids) , чтобы получить список идентификаторов GUID обработчика видео.

4.  Для каждого идентификатора GUID обработчика видео микшер вызывает [**идиректксвидеопроцессорсервице:: жетвидеопроцессоррендертаржетс**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoprocessorservice-getvideoprocessorrendertargets) , чтобы получить Поддерживаемые форматы целевого объекта прорисовки.

5.  Евр вызывает [**имфвидеопресентер::P роцессмессаже**](/windows/desktop/api/evr/nf-evr-imfvideopresenter-processmessage) в выступающих с \_ сообщением мфвп Message \_ инвалидатемедиатипе. Это сообщение приводит к тому, что в выступающем поле выбирается новый формат.

6.  Выступающий вызывает [**имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) , чтобы получить список доступных выходных форматов из микшера. Микшер создает этот список из форматов, полученных на шаге 4.

7.  Выступающий выбирает формат и вызывает [**имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) в микшере.

Для подпотоков процесс является более простым:

1.  Евр вызывает [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) в микшере.

2.  Микшер вызывает [**идиректксвидеопроцессорсервице:: жетвидеопроцессорсубстреамформатс**](/windows/desktop/api/dxva2api/nf-dxva2api-idirectxvideoprocessorservice-getvideoprocessorsubstreamformats) , чтобы получить список доступных форматов подпотока.

3.  Если в этом списке содержится предложенный формат, ЕВР принимает входной тип.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Улучшенный модуль подготовки видео](enhanced-video-renderer.md)
</dt> </dl>

 

 



