---
description: О МФТС
ms.assetid: ca9cef70-b897-4fd5-9a13-8bf1c2b84b00
title: О МФТС
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09adce4bc93c110cf98e4fd8ed427ffcd009c3c1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897522"
---
# <a name="about-mfts"></a>О МФТС

Media Foundation преобразования (МФТС) предоставляют универсальную модель для обработки данных мультимедиа. МФТС используются для декодеров, кодировщиков и обработчиков цифровых сигналов (DSP). Вкратце, все, что располагается в конвейере мультимедиа между источником мультимедиа и приемником мультимедиа, является MFT.

Для большинства приложений сведения об обработке данных MFT скрыты на более высоких уровнях архитектуры Media Foundation. Многие Media Foundation приложения никогда не выполняют прямой вызов к MFT. Однако, конечно, можно разместить MFT непосредственно в приложении.

МФТС — это эволюция модели преобразования, впервые представленной в DirectX Media Objects (дмос). На самом деле, сравнительно легко создать преобразование, которое поддерживает обе модели. По сравнению с дмос, требуемые поведения МФТС более четко указаны, что упрощает написание правильной реализации. Кроме того, МФТС может поддерживать обработку видео с аппаратным ускорением.

В этом разделе приводится краткий обзор модели обработки MFT, в которой основное внимание уделяется общему проектированию, а не к конкретным вызовам методов. Более подробное пошаговое описание см. в разделе [Базовая модель обработки MFT](basic-mft-processing-model.md).

## <a name="streams"></a>Потоки

Файловая Таблица MFT содержит входные потоки и выходные потоки. Входные потоки получают данные, а выходные потоки создают данные. Например, декодер имеет один входной поток, который получает закодированные данные, и один выходной поток, который создает декодированные данные.

Потоки в таблице MFT не представляются как отдельные COM-объекты. Вместо этого каждый поток имеет назначенный идентификатор потока, а методы в интерфейсе [**имфтрансформ**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) принимают идентификаторы потоков в качестве входных параметров.

Некоторые МФТС имеют фиксированное число потоков. Например, декодеры и кодировщики обычно имеют ровно один вход и один выход. Другие МФТС имеют динамическое число потоков. Если MFT поддерживает динамические потоки, клиент может добавлять новые входные потоки. Клиент не может добавлять выходные потоки, но MFT может добавлять или удалять выходные потоки во время обработки. Например, мультиплексоры обычно позволяют клиенту добавлять входные потоки и иметь один выход для мультиплексированного потока. Демультиплексоры являются обратными, с одним входом, но с динамическим числом выходных потоков, в зависимости от содержимого входного потока. На следующем рисунке показано различие между мультиплексором и демультиплексором.

![Схема, показывающая кодировщик/декодер (1 вход, 1 выход), мультиплексор (2 входа, 1 выход) и демультиплексор (1 вход, 2 выхода)](images/f2b95bd5-f862-4d66-9d75-550a90f6cc97.gif)

## <a name="media-types"></a>Типы носителей

При первом создании таблицы MFT ни один из потоков не имеет установленного формата. Прежде чем MFT сможет обработать данные, клиент должен задать форматы для потоков. Например, при использовании декодера входной формат является форматом сжатия, используемым в исходном файле исходного кода, а формат выходных данных — несжатым форматом, например с аудио-или видеороликом PCM. Форматы потоков описаны с помощью [типов мультимедиа](media-types.md).

В зависимости от внутреннего состояния MFT оно может предоставить список возможных типов носителей для каждого потока. Этот список можно использовать в качестве подсказки при задании типов мультимедиа. Установка типа мультимедиа в одном потоке может изменить список возможных типов для другого потока. Например, декодер обычно не может предоставлять типы вывода, пока клиент не установит входной тип. Тип входных данных содержит сведения, необходимые декодеру для возврата списка возможных типов вывода.

Чтобы задать тип мультимедиа в потоке, вызовите метод [**имфтрансформ:: сетинпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) или [**Имфтрансформ:: сетаутпуттипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype). Чтобы получить список возможных типов носителей для потока, вызовите метод [**имфтрансформ:: жетинпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) или [**Имфтрансформ:: жетаутпутаваилаблетипе**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).

## <a name="processing-data"></a>Обработка данных

После того как клиент установит типы носителей в потоках, Таблица MFT готова к обработке данных. Чтобы сделать это, клиент переводится между вводом входных данных в MFT и получением выходных данных из MFT:

-   Чтобы предоставить входные данные в MFT, вызовите [**имфтрансформ::P роцессинпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).
-   Чтобы извлечь выходные данные из MFT, вызовите [**имфтрансформ::P роцессаутпут**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).

Метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) принимает указатель на пример носителя, выделенный клиентом. Пример носителя содержит один или несколько буферов, а каждый буфер содержит входные данные для обработки MFT.

Метод [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) поддерживает две различные модели распределения: Таблица MFT выделяет выходные буферы, или клиент выделяет буферы вывода. Некоторые МФТС поддерживают обе модели распределения, но не требуется для поддержки обоих файлов MFT. Например, для MFT может потребоваться, чтобы клиент выделил буферы вывода. Метод [**имфтрансформ:: жетаутпутстреаминфо**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) возвращает сведения о потоке вывода, включая модель выделения, поддерживаемую MFT.

МФТС предназначены для последовательного буферизации как можно меньшего объема данных, чтобы свести к минимуму задержки в конвейере. Таким образом, в любой момент времени MFT может сообщить одно из следующих условий:

-   Для MFT требуются дополнительные входные данные. В этом состоянии MFT не может создавать выходные данные, пока клиент не вызовет метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) по крайней мере один раз.
-   MFT не будет принимать никаких входных данных, пока клиент не вызовет [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) по крайней мере один раз.

Например, предположим, что вы используете видеодекодер для декодирования видеопотока, содержащего сочетание ключевых кадров и разностных кадров. Первоначально MFT требует ввода некоторых входных данных, прежде чем он сможет декодировать все кадры. Клиент вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) для доставки первого кадра. Предположим, что первый кадр является разностным (показан на следующей схеме как "P" для прогнозируемого кадра). Декодер удерживает этот фрейм, но не может вывести выходные данные, пока не получит следующий ключевой кадр.

![Схема, показывающая таблицу MFT, для которой требуются входные данные, указывающие на прогнозируемый кадр](images/f5a88ac6-24da-40e5-b356-649aa6f811c3.gif)

Клиент по-прежнему вызывает метод [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) и в конечном итоге достигает следующего ключевого кадра (показан на следующей схеме как i для внутреннего фрейма). Теперь у декодера достаточно кадров, чтобы начать декодирование. На этом этапе он останавливает прием входных данных, и клиент должен вызвать [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) , чтобы получить раскодированные кадры.

![Схема, показывающая таблицу MFT, которая не принимает входные данные, указывает на один внутренний кадр и три прогнозируемых кадра](images/ae014a1a-9d03-4cfa-a04d-4a63bdc83f73.gif)

Самый простой подход для клиента — это просто альтернативные вызовы [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) и [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput). Более сложный алгоритм описывается в разделе [Базовая модель обработки MFT](basic-mft-processing-model.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Преобразования Media Foundation](media-foundation-transforms.md)
</dt> </dl>

 

 



