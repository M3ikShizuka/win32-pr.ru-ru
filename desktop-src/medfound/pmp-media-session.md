---
description: Сеанс PMP мультимедиа
ms.assetid: CF3A427D-31D2-45FF-BE87-F192B758204E
title: Сеанс PMP мультимедиа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 683bc6d3dcc78bfb18daedabab614c95c33492fb7e17d48cbe7f6f08bdc766ab
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118239224"
---
# <a name="pmp-media-session"></a>Сеанс PMP мультимедиа

Приложение может создать [сеанс мультимедиа](media-session.md) в отдельном процессе, называемом процессом [защищенного пути к носителю](protected-media-path.md) (PMP). Основной целью процесса PMP является обеспечение воспроизведения защищенного содержимого с помощью управления цифровыми правами (DRM). По умолчанию процесс PMP создается в защищенной среде (PE). В PE можно загружать только надежные подписанные компоненты. Дополнительное преимущество процесса PMP заключается в том, что он изолирует процесс приложения от конвейера мультимедиа. Дополнительные сведения о процессе PMP см. в разделе [путь к защищенному носителю](protected-media-path.md).

Чтобы создать сеанс мультимедиа внутри процесса PMP, вызовите функцию [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) . При необходимости можно передать флаг **\_ незащищенного \_ процесса мфпмпсессион** . Если этот флаг установлен, процесс PMP создается в незащищенном процессе, а не в PE-процессе. Незащищенный процесс не может использоваться для воспроизведения DRM, но предоставляет преимущества изоляции процессов.

Функция [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) возвращает указатель на прокси-объект для сеанса мультимедиа. Приложение взаимодействует с сеансом мультимедиа через прокси-сервер.

![Иллюстрация сеанса мультимедиа внутри процесса PMP](images/pmp01.png)

По умолчанию, когда приложение создает топологию, источник мультимедиа создается внутри процесса приложения. В процессе PMP создается прокси-сервер для источника носителя. Источник мультимедиа может создавать объекты внутри процесса PMP с помощью интерфейса [**имфпмфост**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) . Например, для поддержки DRM источник мультимедиа создает объект, называемый *входным центром доверия* (ITA). Значение ITA должно быть создано внутри процесса PMP. (Дополнительные сведения о ИТАС см. в разделе [путь к защищенному носителю](protected-media-path.md).) Чтобы использовать интерфейс [**имфпмфост**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) , выполните следующие действия.

1.  Источник мультимедиа должен реализовывать интерфейс [**имфпмпклиент**](/windows/desktop/api/mfidl/nn-mfidl-imfpmpclient) .
2.  Во время разрешения топологии прокси-сервер сеанса мультимедиа вызывает метод [**имфпмпклиент:: сетпмфост**](/windows/desktop/api/mfidl/nf-mfidl-imfpmpclient-setpmphost) в источнике мультимедиа.
3.  Источник мультимедиа вызывает [**имфпмфост:: креатеобжектбиклсид**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) , чтобы создать объект внутри процесса PMP. Объект должен иметь зарегистрированный идентификатор CLSID. Кроме того, для загрузки в PE объект должен быть доверенным и подписанным цифровой подписью. дополнительные сведения о подписывания кода для компонентов защищенного носителя см. в техническом документе [подпись для компонентов защищенного носителя в Windows Vista](/windows-hardware/test/hlk/) .

На следующем рисунке показан источник мультимедиа, созданный в процессе приложения.

![Иллюстрация источника мультимедиа в процессе приложения.](images/pmp02.png)

Другой вариант — создать источник мультимедиа в сеансе PMP.

1.  При создании сеанса мультимедиа задайте атрибут [**\_ \_ \_ \_ режим удаленного источника MF Session**](mf-session-remote-source-mode-attribute.md) . Атрибуты конфигурации указываются в параметре *пконфигуратион* функции [**мфкреатепмпмедиасессион**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepmpmediasession) .
2.  Вызовите [**мфжетсервице**](/windows/desktop/api/mfidl/nf-mfidl-mfgetservice) в сеансе мультимедиа, чтобы получить указатель на интерфейс [**имфпмфост**](/windows/desktop/api/mfidl/nn-mfidl-imfpmphost) . Идентификатор службы — **MF \_ PMP \_ Service**.
3.  Вызовите [**имфпмфост:: креатеобжектбиклсид**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphost-createobjectbyclsid) с идентификатором класса **CLSID \_ мфсаурцересолвер** , чтобы создать сопоставитель источника в процессе PMP. Метод возвращает указатель на прокси-сервер для сопоставителя источника.
4.  Вызовите [**имфсаурцересолвер:: бегинкреатеобжектфромурл**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfromurl) или [**Имфсаурцересолвер:: бегинкреатеобжектфромбитестреам**](/windows/desktop/api/mfidl/nf-mfidl-imfsourceresolver-begincreateobjectfrombytestream) , чтобы создать источник мультимедиа.
    > [!Note]  
    > В этом случае необходимо использовать асинхронные версии этих методов, так как синхронные версии не поддерживают удаленное взаимодействие.

     

На следующем рисунке показан источник мультимедиа, созданный в процессе PMP.

![Иллюстрация источника мультимедиа в процессе PMP.](images/pmp03.png)

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Воспроизведение защищенных файлов мультимедиа](how-to-play-protected-media-files.md)
</dt> <dt>

[Сеанс мультимедиа](media-session.md)
</dt> <dt>

[Путь к защищенному носителю](protected-media-path.md)
</dt> </dl>

 

 
