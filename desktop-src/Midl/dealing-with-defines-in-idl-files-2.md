---
title: Работа с определениями в IDL-файлах
description: На этой странице описывается, почему символы, определенные с помощью \ define, исчезают H-файлы, созданные компилятором MIDL, и что можно делать с ним. Это описание относится ко всем файлам, обрабатываемым MIDL, таким как файлы \. idl, \. ACF, \. h.
ms.assetid: 148dabda-96cc-4f7c-abc7-4bf78ac166ea
keywords:
- MIDL компилятора MIDL, работа с определениями
- Определяет MIDL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22c8a63423943d72326b16d53272f63d6efbe7d614661990560b00989be04cf1
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119979706"
---
# <a name="dealing-with-defines-in-idl-files"></a>Работа с \# определениями в IDL-файлах

На этой странице описывается, почему символы, определенные с помощью инструкции **\# define** , исчезают из H-файлов, СОЗДАННЫХ компилятором MIDL, и что может быть сделано. Это пояснение относится ко всем файлам, обрабатываемым MIDL, таким как \* IDL-, \* ACF, \* h-файлы.

**\# Неопределенность определения** символов является результатом того, что MIDL делегирует предварительную обработку входных файлов препроцессору. По умолчанию препроцессор является препроцессором C/C++ из среды сборки. После предварительной обработки входной поток MIDL получает только \# директивы препроцессора Line. В частности, препроцессор выполняет откат всех определений макросов во входных файлах, поэтому MIDL не может обнаружить их присутствие. Следовательно, когда MIDL реплицирует определения типов из входного файла в созданный H файл, определения \# не реплицируются. Поэтому не используйте \# определения непосредственно в IDL-файлах, если они будут использоваться позже из созданного H-файла.

Рекомендуется использовать следующие четыре решения:

-   Используйте спецификацию объявления [**const**](const.md) .
-   Используйте отдельные файлы заголовков, которые импортируются или включаются в IDL-файл, а затем в исходный код C.
-   Используйте константы перечисления в IDL-файле.
-   Используйте [**\_ цитату cpp**](cpp-quote.md) для воспроизведения **\# определения** в создаваемом файле заголовка.

Константы манифеста можно воспроизвести с помощью **синтаксиса объявления константы IDL**. Обратите внимание, что [**константа**](const.md) в объявлении константы IDL отличается от семантики **const** C/C++ и просто вводит именованную константу для компиляции IDL. Например:

``` syntax
const short ARRSIZE = 10
```

В этом примере указывается, что **аррсизе** является константой со значением 10. Именованные константы можно использовать в деклараторах массивов IDL и в других местах, где программист C будет использовать определение манифеста. Кроме того, этот синтаксис приводит к тому, что в файле заголовка создается следующая строка:

``` syntax
#define ARRSIZE 10
```

Еще один способ обрабатывал **\#** операторы определения — упаковать их в отдельный файл заголовка либо в файл, посвященный **\#** определению инструкций, либо в файл, содержащий только определения типов. Файл, содержащий только директивы препроцессора, может быть безопасно добавлен и файлом IDL, и файлами C-source. Хотя директивы не будут доступны в файле заголовка, созданном компилятором MIDL, программа C-source может включать в себя отдельный файл заголовка. Аналогичным образом файл заголовка с **\#** инструкциями define и определениями регулярных типов можно импортировать из IDL-файла. Этот подход инкапсулирует **\#** инструкции define и typedef, используя их в H-файле таким образом, что **\#** символы определения не используются непосредственно в ИМПОРТИРУЕМом IDL-файле. Импорт файла заголовка или IDL в другой IDL предотвращает репликацию инструкций typedef в H-файл, созданный с помощью MIDL (что отличается от **\#** инструкций include). Такой подход позволяет безопасно ссылаться на исходный файл заголовка из кода C в созданном H-файле без проблем с повторяющимися определениями.

Использование констант перечисления в IDL-файле также эффективно. Эти константы можно использовать в константных выражениях в IDL, например в деклараторах массивов. Константы перечисления не удаляются на ранних этапах компиляции MIDL с помощью препроцессора компилятора C-Compiler, поэтому константы перечисления доступны в файле заголовка, созданном компилятором MIDL. Рассмотрим следующий оператор.

``` syntax
typedef enum midlworkaround { MAXSTRINGCOUNT = 300 };
```

Эта инструкция не будет удалена во время компиляции MIDL с помощью препроцессора C, а typedef будет реплицирован в созданный H файл. Константа МАКССТРИНГКАУНТ доступна для программ C-source, которые включают файл заголовка, созданный компилятором MIDL.

И, наконец [**, \_ директива**](cpp-quote.md) языка MIDL для записи произвольной строки может быть использована в созданном H файле. Например, чтобы получить константу манифеста, которая ранее использовалась на этой странице с помощью **cpp- \_ цитаты**, можно использовать следующую инструкцию:

``` syntax
cpp_quote ("#define ARRSIZE 10")
```

Эта инструкция приводит к формированию следующей строки в файле заголовка:

``` syntax
#define ARRSIZE 10
```

 

 




