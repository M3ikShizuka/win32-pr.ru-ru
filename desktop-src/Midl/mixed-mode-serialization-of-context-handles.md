---
title: Сериализация дескрипторов контекста в смешанном режиме
description: В Microsoft Windows XP один интерфейс может содержать как сериализованные, так и несериализованные дескрипторы контекста, которые называются сериализацией в смешанном режиме.
ms.assetid: b52c1d6f-cdc5-4597-a36e-bb957e4aab01
keywords:
- Справочник по языку MIDL MIDL, сериализация дескрипторов контекста в смешанном режиме
- контекстно обрабатывает MIDL
- MIDL сериализации в смешанном режиме
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0922b53bfc7ba2e30ad8df0764e3cf9a36f0f723
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103888312"
---
# <a name="mixed-mode-serialization-of-context-handles"></a>Сериализация дескрипторов контекста в смешанном режиме

Начиная с Windows XP, один интерфейс может размещать как сериализованные, так и несериализованные дескрипторы контекста, позволяя одному методу интерфейса обращаться к дескриптору контекста исключительно (сериализовано), а другие методы — к этому дескриптору контекста в общем режиме (не сериализованном). Дополнительные сведения об дескрипторах контекста см. в следующих атрибутах:

-   [**Контекстный \_ маркер**](context-handle.md)
-   [**\_сериализация обработчика контекста \_**](context-handle-serialize.md)
-   [**несериализуемый контекстный \_ обработчик \_**](context-handle-noserialize.md)

Функции доступа к сериализованным и общим режимам сравнимы с механизмами блокировки чтения и записи; методы, использующие сериализованный контекстный маркер, являются эксклюзивными пользователями (модулями записи), тогда как методы, использующие несериализованный контекст контекста, являются общими пользователями (читателями). Методы, которые удаляют или изменяют состояние обработчика контекста, должны быть сериализованы. Методы, которые не изменяют состояние маркера контекста, например методы, которые просто считывают из обработчика контекста, могут быть несериализуемыми. Использование обработчика контекста в смешанном режиме может значительно повысить масштабируемость сервера, особенно если несколько потоков выполняют одновременные вызовы к одному и тому же контекстному обработчику.

RPC не применяет "блокировку записи" для методов, использующих дескриптор контекста в общем режиме. Это означает, что приложения должны гарантировать, что дескрипторы контекста общего режима не изменяются. Изменение обработчика контекста, используемого в общем режиме, может привести к незаметному повреждению содержимого контекстного контекста, что не позволяет выполнять отладку.

Изменение логики сериализации контекстного маркера влияет только на сервер. Кроме того, изменение логики сериализации контекстного маркера не влияет на формат сети, поэтому изменения в логике сериализации на сервере не влияют на возможность взаимодействия существующих клиентов с сервером.

Использовать только несериализованные дескрипторы контекста не рекомендуется. Серверы, использующие несериализованные дескрипторы, должны переключиться на сериализованный доступ для метода, который закрывает дескриптор контекста.

Дескрипторы контекста, которые являются \[ выходными, \] обычно используются методами создания и не нуждаются в сериализации. Таким образом, любой атрибут сериализации, применяемый к \[ \] дескрипторам контекста, таким [**как \_ дескриптор \_ сериализации**](context-handle-serialize.md) или [**\_ \_ дескриптор контекста**](context-handle-noserialize.md), не обрабатывается RPC.

> [!Note]  
> Методы создания неявно сериализованы.

 

## <a name="examples"></a>Примеры

В следующих двух примерах показано, как включить сериализацию дескрипторов в смешанном режиме.

В первом примере показано, как это сделать в IDL-файле:

``` syntax
typedef [context_handle] void *TestContextHandleExclusive;
typedef [context_handle] TestContextHandleExclusive TestContextHandleShared;

void
UseShared(...
          [in] TestContextHandleShared *Ctx,
          ...);

void
UseExclusive(...
             [in, out] TestContextHandleExclusive *Ctx,
             ...);
```

Во втором примере показано, как включить сериализацию дескрипторов контекста в смешанном режиме в файле ACF:

``` syntax
typedef [context_handle_serialize] TestContextHandleExclusive;

typedef [context_handle_noserialize] TestContextHandleShared;
```

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Контекстный \_ маркер**](context-handle.md)
</dt> <dt>

[**\_сериализация обработчика контекста \_**](context-handle-serialize.md)
</dt> <dt>

[**несериализуемый контекстный \_ обработчик \_**](context-handle-noserialize.md)
</dt> </dl>

 

 




