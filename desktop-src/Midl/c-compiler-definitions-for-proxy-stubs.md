---
title: Определения для прокси-сервера и заглушек C-компилятора
description: Файл заголовка RPCProxy. h содержит следующие определения макросов, каждый из которых удобен при создании распределенного приложения COM. Эти макросы вызываются с параметром препроцессора/D (или-D) во время компиляции C.
ms.assetid: 697f0b63-76ae-410d-8bbf-bb95295ffba9
keywords:
- MIDL компилятора MIDL, C-Compiler, определения прокси-сервера или заглушек
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b272b8b540420930366864c45e993172f5c00e67
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122882056"
---
# <a name="c-compiler-definitions-for-proxystubs"></a>Определения для прокси-сервера и заглушек C-компилятора

Файл заголовка RPCProxy. h содержит следующие определения макросов, каждый из которых удобен при создании распределенного приложения COM. Эти макросы вызываются с параметром препроцессора [**/d**](-d.md) (или-D) во время компиляции C.



| MACRO                                                                                                                                                                                           | Описание                                                                                                                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ЗАРЕГИСТРИРОВАТЬ \_ прокси- \_ библиотеку DLL                                                                                                                                                                            | Создает функции **DllMain**, **DllRegisterServer** и **DllUnregisterServer** для автоматической регистрации библиотеки DLL прокси-сервера.                                                                                       |
| ПРОКСИ \_ CLSID = &lt; CLSID&gt;                                                                                                                                                                      | Указывает идентификатор класса для сервера. Если этот макрос не определен, то CLSID по умолчанию — это первый идентификатор интерфейса, который компилятор MIDL обнаруживает в спецификации IDL для прокси-сервера/заглушки. |
| Прокси-сервер \_ CLSID \_ — это = {0x *8hexdigits*, 0x *4hexdigits*, 0x *4hexdigits*, {0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits*, 0x *2hexdigits,*}} | Указывает значение идентификатора класса сервера в двоичном шестнадцатеричном формате.                                                                                                                                           |



 

Определив макрос **Register \_ Proxy \_ DLL** при компиляции DLLDATA. c, Библиотека DLL для маршалирования прокси-сервера и заглушки автоматически включит определения по умолчанию для функций **DllMain**, **DllRegisterServer** и **DllUnregisterServer** . Эти функции можно использовать для самостоятельной регистрации библиотеки DLL прокси-сервера в системном реестре.

Этот код регистрации по умолчанию использует идентификатор GUID первого интерфейса, обнаруженного в качестве идентификатора CLSID для регистрации всего сервера DLL прокси или заглушки. COM позже использует этот идентификатор CLSID для нахождение и загрузки скомпилированного прокси-сервера/заглушки для упаковки любого из интерфейсов, регистрируемых сервером для работы. Когда приложение выполняет вызов метода интерфейса, который пересекает границы потока, процесса или компьютера, COM использует запись реестра идентификатор интерфейса для нахождение записи реестра CLSID для сервера маршалинга прокси или заглушки. Затем он использует этот идентификатор CLSID для загрузки сервера (если он еще не загружен), чтобы вызов интерфейса мог быть маршалирован.

Используйте макрос CLSID CLSID **прокси- \_** сервера, = &lt; &gt; если хотите явно указать идентификатор CLSID прокси-сервера или заглушки, а не использовать CLSID по умолчанию. Например, если вы создаете стандартную библиотеку DLL для маршалирования в качестве собственного внутрипроцессного COM-сервера или необходимо определить собственную функцию **DllMain** для обработки \_ присоединения к процессу DLL \_ .

Используйте **прокси-сервер \_ CLSID \_ — это** макрос вместо **\_ CLSID прокси-сервера** , чтобы определить значение идентификатора CLSID в двоичном шестнадцатеричном формате, используемом в макросе **define \_ GUID** .

Также обратите внимание, что при выполнении функции **DllRegisterServer** по умолчанию она регистрирует сервер с помощью ThreadingModel = Both.

В следующем примере файла makefile используется **\_ прокси- \_ Библиотека Register** и **прокси-сервер \_ CLSID**=.

``` syntax
example.h example.tlb example_p.c example_i.c dlldata.c : example.idl
    midl example.idl
dlldata.obj : dlldata.c
    CL /c /DWIN32 /DREGISTER_PROXY_DLL dlldata.c
example.obj : example_p.c
    CL /c /DWIN32 /DREGISTER_PROXY_DLL \
    /DPROXY_CLSID=7a98c250-6808-11cf-b73b-00aa00b677a7
example_p.c
iids.obj : example_i.c
PROXYSTUBOBJS = dlldata.obj example.obj iids.obj
PROXYSTUBLIBS = kernel32.lib rpcns4.lib rpcrt4.lib uuid.lib
proxy.dll : $(PROXYSTUBOBJX) example.def
    link /dll /out:proxy.dll /def:example.def
        $(PROXYSTUBOBJS) $(PROXYSTUBLIBS)
    regsvr32 /s proxy.dll
```

Дополнительные сведения о параметре препроцессора [**/d**](-d.md) см. в документации по компилятору C.

 

 




