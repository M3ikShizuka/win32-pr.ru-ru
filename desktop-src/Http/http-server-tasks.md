---
title: Задачи сервера HTTP
description: Обычно задачи сервера HTTP выполняются в определенном порядке. то есть необходимо завершить одну задачу и выходные данные, полученные перед началом следующей задачи.
ms.assetid: 08f8e7e9-23b9-403f-b00c-8912919d65b1
keywords:
- Задачи сервера HTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22455dbda21aca32b26f586eed6e51cef7509af2
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103780120"
---
# <a name="http-server-tasks"></a>Задачи сервера HTTP

Обычно задачи сервера HTTP выполняются в определенном порядке. то есть необходимо завершить одну задачу и выходные данные, полученные перед началом следующей задачи.

Страница задачи создается для представления образца кода о конкретных задачах, выполняемых приложением сервера HTTP. Страница задачи ссылается на файл расширения C образца HTTP-сервера. При установке PSDK на диске C: на \\ локальном компьютере образец приложения Complete Server устанавливается на языке C: \\ Program Files \\ Microsoft SDK \\ Samples \\ нетдс \\ HTTP \\ Server.

В следующем списке указаны задачи HTTP-сервера.

-   [Инициализация службы HTTP](#initialize-the-http-service)
-   [Зарегистрируйте URL-адреса для прослушивания](#register-the-urls-to-listen-on)
-   [Вызов подпрограммы для получения запроса](#call-the-routine-to-receive-a-request)
-   [Получение запроса](#receive-the-request)
-   [Обработку HTTP-запроса](#handle-the-http-request)
-   [Отправка HTTP-ответа](#send-the-http-response)
-   [Отправить ответ HTTP POST](#send-the-http-post-response)
-   [Очистка API HTTP-сервера](#clean-up-the-http-server-api)

## <a name="initialize-the-http-service"></a>Инициализация службы HTTP

Служба HTTP инициализируется с помощью функции [**хттпинитиализе**](/windows/desktop/api/Http/nf-http-httpinitialize) , а обработчик запросов создается с помощью [**хттпкреатехттфандле**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle). Сервер должен быть инициализирован, прежде чем можно будет вызывать другие функции сервера. Очередь запросов должна быть создана до того, как служба сможет зарегистрировать URL-адреса для прослушивания входящих HTTP-запросов.

Дополнительные сведения и пример кода см. в разделе [инициализация службы HTTP](http-server-sample-application.md).

## <a name="register-the-urls-to-listen-on"></a>Зарегистрируйте URL-адреса для прослушивания

Для HTTP-API сервера, который должен прослушивать входящие запросы, определенные URL-адреса регистрируются в API путем вызова функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) . Входящие запросы, соответствующие этим URL-адресам, направляются в очередь запросов, указанную в этом вызове.

Дополнительные сведения и пример кода см. в разделе [Регистрация URL-адресов для прослушивания](http-server-sample-application.md).

## <a name="call-the-routine-to-receive-a-request"></a>Вызов подпрограммы для получения запроса

Функция Дорецеиверекуест выделяет буфер запроса, инициализирует идентификатор запроса и запускает цикл для получения запросов.

Дополнительные сведения и пример кода см. в разделе [вызов подпрограммы для получения запроса](http-server-sample-application.md).

## <a name="receive-the-request"></a>Получение запроса

API сервера HTTP предоставляет структуру запросов для хранения проанализированного входящего запроса. Эта структура выделяется приложением и инициализируется при получении входящего запроса. Приложение вызывает функцию [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) для получения запроса. Если буфер запроса слишком мал для получения запроса, приложение может увеличить размер буфера и вызвать **хттпрецеивехттпрекуест** еще раз, чтобы получить весь запрос.

Дополнительные сведения и пример кода см. в разделе [Получение запроса](http-server-sample-application.md).

## <a name="handle-the-http-request"></a>Обработку HTTP-запроса

Пример приложения демонстрирует обработку команд HTTP GET и POST Request. Приложение отправляет ошибку 503 (**не \_ реализовано**), если в запросе есть команды, которые не обрабатываются приложением.

Обратите внимание, что URL-адрес, используемый для обработки запросов, — это обработанный URL-адрес, содержащийся в элементе **кукедурл** структуры [**HTTP- \_ запроса \_ v1**](/windows/desktop/api/Http/ns-http-http_request_v1) . Не обработайте необработанный URL-адрес в члене **правурл** , который предназначен исключительно для отслеживания и статистических целей.

Дополнительные сведения и пример кода см. в разделе об [обработке HTTP-запроса](http-server-sample-application.md).

## <a name="send-the-http-response"></a>Отправка HTTP-ответа

Структура ответа выделяется и инициализируется кодом состояния и фразой причины в \_ макросе инициализации HTTP- \_ ответа. Известный заголовок HTTP добавляется в структуру ответа в \_ \_ макросе Add известных заголовков, а тело сущности добавляется в ответ из блока данных из памяти. Для отправки ответа вызывается функция [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) . В этом примере приложение отправляет запрос GET с простым ответом 200 ОК.

Дополнительные сведения и пример кода см. в разделе [Отправка HTTP-ответа](http-server-sample-application.md).

## <a name="send-the-http-post-response"></a>Отправить ответ HTTP POST

Запрос POST требует больше обработки, чем запрос GET. Тело объекта запроса получается путем вызова функции [**хттпрецеиверекуестентитибоди**](/windows/desktop/api/Http/nf-http-httpreceiverequestentitybody) . Приложение отправляет ответ и тело сущности ответа в отдельных вызовах API-сервера HTTP. Заголовки ответа отправляются с помощью [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse). Тело сущности отправляется в блоке данных из маркера файла с помощью функции [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) .

Дополнительные сведения и пример кода см. в разделе [отправка ответа HTTP POST](http-server-sample-application.md).

## <a name="clean-up-the-http-server-api"></a>Очистка API HTTP-сервера

Операции очистки для API-сервера HTTP включают:

-   Удаляются все зарегистрированные URL-адреса.
-   Закрытие маркера в очереди запросов.
-   Завершение ресурсов, созданных API-сервером HTTP.

Приложение вызывает функцию [**хттпремовеурл**](/windows/desktop/api/Http/nf-http-httpremoveurl) для отмены регистрации URL-адресов, зарегистрированных в начальной функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) . Приложение также вызывает [**хттптерминате**](/windows/desktop/api/Http/nf-http-httpterminate) для каждого вызова [**хттпинитиализе**](/windows/desktop/api/Http/nf-http-httpinitialize) с соответствующими настройками флагов. Этот вызов прерывает все ресурсы, созданные вызовом метода **хттпинитиализе**.

Дополнительные сведения и пример кода см. в разделе [Очистка API HTTP-сервера](http-server-sample-application.md).

 

 




