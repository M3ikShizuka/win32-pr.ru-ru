---
title: Общие сведения об API сервера HTTP
description: В этом разделе описывается типичная последовательность операций, использующих API-сервер HTTP.
ms.assetid: 1245fd98-8370-4f1b-8c86-de9be5e678bd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5c99af3e4914c5496c2adea10b3ac658f75f3018
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "105681602"
---
# <a name="http-server-api-overview"></a>Общие сведения об API сервера HTTP

В следующем списке приведена типичная последовательность операций, использующих API-сервер HTTP.

-   Инициализируйте API HTTP-сервера с помощью функции [**хттпинитиализе**](/windows/desktop/api/Http/nf-http-httpinitialize) .
-   Создайте очередь запросов с помощью функции [**хттпкреатехттфандле**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle) .
-   Зарегистрируйте один или несколько URL-адресов с помощью функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) .
-   Получение входящих запросов, направленных на зарегистрированные URL-адреса, с помощью функции [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) и отправка HTTP-ответов для этих запросов с помощью функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) .
-   Используемых При отправке ответа отправьте дополнительный текст сущности с помощью функции [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) .
-   Выполните операции очистки с помощью функций [**хттпремовеурл**](/windows/desktop/api/Http/nf-http-httpremoveurl), [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) и [**хттптерминате**](/windows/desktop/api/Http/nf-http-httpterminate) .

В операциях, использующих URL-адреса, обратите внимание, что это обработанный URL-адрес, содержащийся в члене **кукедурл** структуры [**HTTP- \_ запроса \_ v1**](/windows/desktop/api/Http/ns-http-http_request_v1) , который следует использовать. Не обработайте необработанный URL-адрес в члене **правурл** , который предназначен исключительно для отслеживания и статистических целей.

Каждое приложение создает собственную очередь запросов. Приложение получает маркер очереди запросов из [**хттпкреатехттфандле**](/windows/desktop/api/Http/nf-http-httpcreatehttphandle). Он передает этот обработчик функции [**хттпаддурл**](/windows/desktop/api/Http/nf-http-httpaddurl) , чтобы добавить URL-адрес в очередь запросов. Приложение получает уведомление о входящем запросе и получает его из очереди запросов, вызывая функцию [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) с маркером очереди запросов. Эту функцию можно использовать для получения заголовков запроса либо как заголовков, так и тела сущности. [**Хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) также возвращает идентификатор запроса (RequestId) для полученного запроса, уникального для данного обработчика запроса.

> [!Note]  
> Ответственность за проверку всех соответствующих заголовков запросов, в том числе заголовков согласования содержимого, если они используются, и неудачных запросов, соответствующих содержимому заголовка, зависит от приложения. API сервера HTTP гарантирует, что каждая строка заголовка правильно завершается и не содержит недопустимых символов.

 

Используйте функцию [**хттпрецеиверекуестентитибоди**](/windows/desktop/api/Http/nf-http-httpreceiverequestentitybody) с маркером очереди запросов для получения последующих частей тела объекта запроса, если таковые имеются.

> [!Note]  
> API сервера HTTP декодирует фрагментированные сообщения на стороне получения, но не выполняет фрагментированную кодировку на стороне отправителя. Если для отправляющей стороны требуется Фрагментирование, приложение должно его реализовать. Дополнительные сведения о фрагментированном кодировании см. в [документе RFC 2616](https://www.ietf.org/rfc/rfc2616.txt).

 

Используйте функцию [**хттпрецеивеклиентцертификате**](/windows/desktop/api/Http/nf-http-httpreceiveclientcertificate) с приложениями, которые обслуживают URL-адреса с помощью схемы безопасности ("**HTTPS**"), чтобы дополнительно получить сведения о сертификате клиента.

Ответы отправляются с помощью функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) . Эта функция использует идентификатор запроса из соответствующего запроса для отправки ответа. Ответ можно отправить в нескольких вызовах API с течением времени, вызвав функцию [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) с идентификатором запроса из первоначально полученного запроса.

> [!Note]  
> По умолчанию [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) использует "Microsoft-HTTPAPI/1.0" в качестве заголовка "Server:". Если приложение указывает заголовок сервера в ответе, это значение помещается в первой части заголовка сервера, за которым следует пробел, а затем — Microsoft-HTTPAPI/1.0.

 

В общем случае API сервера HTTP скрывает сведения об управлении подключениями, их установке и уничтожении из приложений. Однако приложение может дополнительно обнаружить завершение соединения, вызвав [**хттпваитфордисконнект**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect).

Приложения должны выполнить очистку, выполнив следующие действия.

-   Если приложение не прослушивает URL-адрес или не отвечает на него, URL-адрес удаляется с помощью функции [**хттпремовеурл**](/windows/desktop/api/Http/nf-http-httpremoveurl) .
-   Когда приложение завершит использование очереди запросов, закройте обработчик запросов с помощью функции [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .
-   После завершения работы приложения с помощью API сервера HTTP вызовите функцию [**хттптерминате**](/windows/desktop/api/Http/nf-http-httpterminate) .

 

 