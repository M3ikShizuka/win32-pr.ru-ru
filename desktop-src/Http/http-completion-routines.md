---
title: Процедуры завершения HTTP
description: Приложения имеют несколько параметров для получения обработок завершения и предоставления некоторой гибкости для разработчиков.
ms.assetid: c48a64d2-b6c8-4694-8600-f84751954bad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dd80259d806d81153a649ad606e40c10986090442e3cab5e04bd864367441871
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119981674"
---
# <a name="http-completion-routines"></a>Процедуры завершения HTTP

Приложения имеют несколько параметров для получения обработок завершения и предоставления некоторой гибкости для разработчиков. Параметры заблокируются при ожидании завершения вызова API или использования подпрограмм завершения для асинхронных операций. Преимущество использования асинхронных операций заключается в увеличении скорости реагирования приложения.

## <a name="blocked-io"></a>Заблокированные операции ввода-вывода

Приложения могут блокироваться при ожидании завершения вызова API путем присвоения структуре [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) **значения NULL**. Это действительно блокирует все операции в потоке. Например, при вызове [**хттпваитфордисконнект**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect)вызов блокируется до тех пор, пока соединение не будет разорвано.

## <a name="asynchronous-io"></a>Асинхронный ввод-вывод

Приложения, которые предпочитают не блокировать блокировку, могут использовать [**перекрывающиеся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуры для получения результатов выполнения. Приложение предоставляет указатель на структуру **OVERLAPPED** , которая используется с объектом события или портом завершения. При использовании порта завершения ввода-вывода в качестве файла используется обработчик HTTP, который будет находиться в асинхронной операции файлового ввода-вывода. В следующей таблице перечислены параметры завершения, доступные для приложений.



| Перекрывающаяся структура | Объект события   | Порт завершения | Completion                                                                                                   |
|----------------------|----------------|-----------------|--------------------------------------------------------------------------------------------------------------|
| **NULL**             | Н/Д | Не учитывается         | Операция завершается синхронно.                                                                           |
| Не **равно NULL**         | Не **равно NULL**   | **NULL**        | Операция завершается асинхронно. Перекрывающиеся уведомления выполняются с помощью сигнализации объекта события.       |
| Не **равно NULL**         | Не учитывается        | Не **равно NULL**    | Операция завершается асинхронно. Перекрывающиеся уведомления выполняются путем планирования процедуры завершения. |



 

## <a name="returning-the-number-of-bytes-read"></a>Возвращение числа считанных байтов

Некоторые функции, использующие [**перекрывающиеся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуры для асинхронного завершения, возвращают параметр *Пбитесрецеивед* (или *пбитессент* или *пбитесреад*), который указывает число байтов, передаваемых синхронно. Для асинхронных вызовов этот параметр должен иметь значение **null**. Для синхронных вызовов параметр *пбитесрецеивед* является необязательным и может иметь **значение NULL** или не иметь **значение NULL**.

Если объект события используется для асинхронного завершения, вызывается функция [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) для определения числа считанных байтов. Если используется порт завершения (параметр *hFile* связан с портом завершения ввода-вывода), приложение вызывает функцию [**жеткуеуедкомплетионстатус**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) для определения числа считанных байтов. Если асинхронные операции не завершены, приложения могут вызывать функцию [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) для получения расширенных сведений об ошибке.

В следующей таблице перечислены действия по завершению синхронного и асинхронного завершения в таких функциях, как [**хттпрецеивехттпрекуест**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) , использующих параметр *пбитесрецеивед* .



| пбитесрецеивед\* | поверлаппед  | Описание                                                                             |
|------------------|--------------|-----------------------------------------------------------------------------------------|
| **NULL**         | **NULL**     | Приложение не получает сведения о количестве возвращенных байт.           |
| **NULL**         | Не **равно NULL** | Асинхронная операция, *пбитесрецеивед* не имеет смысла.                                |
| Не **равно NULL**     | **NULL**     | Синхронная операция, число байтов, возвращенных в *пбитесрецеивед*.                    |
| Не **равно NULL**     | Не **равно NULL** | Асинхронная операция, *пбитесрецеивед* игнорируется, даже если это **значение не равно NULL**.\*\* |



 

> [!Note]  
> \*Этот параметр также может быть *пбитессент* или *пбитесреад*.

 

> [!Note]  
> \*\*Рекомендуется, чтобы приложения передавали **значение NULL** в *пбитесрецеивед* для асинхронных операций и получали число байтов, полученных из [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) или [**жеткуеуедкомплетионстатус**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).

 

## <a name="return-codes"></a>Коды возврата

API сервера HTTP возвращает три класса кодов для асинхронных вызовов функций.

-   БЕЗ \_ ошибок
-   \_Ожидание ввода-вывода при ошибке \_
-   Любой другой [код системной ошибки](/windows/desktop/Debug/system-error-codes).

Если при \_ \_ асинхронном вызове функции не возвращаются сообщения об ошибках ввода-вывода или нет \_ ошибок, то пользователи должны предполагать, что для события или процедуры завершения выдается сигнал. Вызов функции [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) для события или функции [**жеткуеуедкомплетионстатус**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) для порта завершения возвращает состояние завершения. Кроме того, если \_ ошибка не возвращается, приложения могут выполнять последующей обработку в том же потоке, который выполнил вызов API.

Если API сервера HTTP возвращает любые данные, отличные от ошибок \_ ввода-вывода с ошибками \_ или без \_ ошибок, из вызова асинхронной функции, подпрограмма завершения не получает сигнал, а ошибка возвращается непосредственно API.

 

 