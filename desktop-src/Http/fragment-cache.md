---
title: Кэш фрагментов
description: API сервера HTTP предоставляет пользователям возможность хранить фрагменты данных в кэше для быстрого формирования HTTP-ответов.
ms.assetid: 0f9a768e-723c-4c7b-a746-6b817441409c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a3979fb03c4f8898644329fd27eafb7007adbcc9
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986264"
---
# <a name="fragment-cache"></a>Кэш фрагментов

API сервера HTTP предоставляет пользователям возможность хранить фрагменты данных в кэше для быстрого формирования HTTP-ответов.

Фрагменты можно добавить в кэш, вызвав функцию [**хттпаддфрагменттокаче**](/windows/desktop/api/Http/nf-http-httpaddfragmenttocache) . Фрагмент определяется по URL-адресу, содержащемуся в параметре *пурлпрефикс* . Вызов этой функции с URL-адресом существующего фрагмента перезаписывает существующий фрагмент.

Фрагмент может быть удален или перезаписан владельцем очереди запросов, которая изначально добавила фрагмент. Функция [**хттпфлушреспонсекаче**](/windows/desktop/api/Http/nf-http-httpflushresponsecache) , вызываемая с помощью UrlPrefix, удаляет все фрагменты внутри этого префикса, а также иерархические потомки этого UrlPrefix. Функция [**хттпреадфрагментфромкаче**](/windows/desktop/api/Http/nf-http-httpreadfragmentfromcache) считывает весь фрагмент или указанный диапазон байтов внутри фрагмента.

> [!Note]  
> Добавление фрагмента в кэш не гарантирует, что он будет доступен для будущих вызовов для отправки ответа. Записи кэша фрагмента могут стать недоступными в любое время. Вызов, использующий недоступный фрагмент, завершается ошибкой. Приложения, использующие кэш фрагментов, должны быть готовы к обработке этого сбоя.

 

## <a name="sending-a-response-with-a-fragment"></a>Отправка ответа с помощью фрагмента

Фрагменты можно использовать для формирования всех или частей тела объекта ответов HTTP. Вы можете отправить ответ и тело сущности в одном вызове функции [**хттпсендхттпреспонсе**](/windows/desktop/api/Http/nf-http-httpsendhttpresponse) , указав массив структур [**\_ \_ фрагментов данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) в структуре [**HTTP- \_ ответа**](http-response.md) .

[**\_ \_ Фрагмент данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) может указывать блок памяти, обработчик для уже открытого файла или записи кэша фрагмента. Они соответствуют типам **\_ \_ фрагментов данных HTTP** : **хттпдатачункфроммемори**, **хттпдатачункфромфилехандле** и **хттпдатачункфромфрагменткаче** соответственно. Полные ответы в кэше HTTP также могут использоваться в качестве фрагментов в структуре [**HTTP- \_ ответа**](http-response.md) , хотя это не рекомендуется.

Структура [**\_ ответа HTTP**](http-response.md) содержит указатель на массив структур [**\_ \_ фрагментов данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) , который состоит из текста сущности ответа. Структура **\_ ответа HTTP** также содержит счетчик сопоставления, который указывает измерение массива структур **\_ \_ фрагментов данных HTTP** . Значение Хттпдатачункфромфрагменткаче в структуре **\_ \_ фрагментов данных HTTP** указывает тип кэша фрагмента для фрагмента данных. Структура **\_ \_ фрагмента данных HTTP** также указывает имя фрагмента.

Ответ, содержащий кэшированный фрагмент, завершается с ошибкой \_ , \_ не \_ найденной, если какие-либо из записей кэша фрагментов недоступны. Так как записи кэша фрагментов не гарантированно доступны, приложения должны быть готовы к обработке этого случая. Одним из способов решения этой ситуации является попытка повторного добавления записи кэша фрагмента и повторная отправка ответа. При возникновении повторяющихся сбоев приложение может использовать блоки данных, хранящиеся в буферах памяти, а не записи кэша фрагментов.

Записи кэша фрагмента также можно указать в функции [**хттпсендреспонсинтитибоди**](/windows/desktop/api/Http/nf-http-httpsendresponseentitybody) . Фрагмент добавляется в тело сущности в структуре [**\_ \_ фрагмента данных HTTP**](/windows/desktop/api/Http/ns-http-http_data_chunk) , как описано выше. Опять же, отправка может завершиться неудачей, если любая из указанных записей кэша фрагментов недоступна.

 

 




