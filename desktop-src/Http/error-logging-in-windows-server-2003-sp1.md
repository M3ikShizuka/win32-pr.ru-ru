---
title: регистрация ошибок в Windows Server 2003 с пакетом обновления 1 (SP1)
description: регистрация ошибок в Windows Server 2003 с пакетом обновления 1 (SP1)
ms.assetid: 8c7fcc66-5446-4e25-8e6d-1a9260c55e36
keywords:
- регистрация ошибок в Windows Server 2003 с пакетом обновления 1 (SP1)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a71d5a84dfba8ecb9a78ed38d3ad112f0820e6b578bce77e189e5047a25f458b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119014812"
---
# <a name="error-logging-in-windows-server-2003-sp1"></a>регистрация ошибок в Windows Server 2003 с пакетом обновления 1 (SP1)

## <a name="addition-of-w3c-style-headers"></a>Добавление заголовков в стиле W3C

начиная с Windows server 2003 с пакетом обновления 1 (sp1), журнал ошибок API сервера HTTP включает заголовки стилей W3C, позволяющие анализировать файлы журналов с помощью стандартных средств синтаксического анализа журналов. В приведенном ниже шаблоне перечислены все поля, которые можно зафиксировать в файле журнала ошибок HTTP.

``` syntax
#Software: <Name of the HTTP Server>
#Version: 1.0 <Log format version>
#Date: <Log file creation date and time>
#Fields: <date time s-computername c-ip c-port s-ip s-port cs-version
         cs-method cs-uri cs(User-Agent) cs(Cookie) cs(referrer) 
         cs-host sc-status sc-bytes cs-bytes time-taken s-siteid  
         s- reason s-queuename <header names of fields logged>

```

## <a name="logging-additional-fields"></a>Ведение журнала дополнительных полей

Журнал ошибок HTTP был расширен и содержит девять дополнительных полей для записи данных о возникших сбоях. Новые поля ошибок перечислены ниже:

-   Имя компьютера сервера \[ S-ComputerName\]
-   Агент пользователя \[ CS ( \_ Агент пользователя)\]
-   Файл cookie \[ CS (cookie)\]
-   Источник ссылки \[ CS (Источник ссылки)\]
-   Имя узла \[ CS-Host\]
-   Количество байт, полученных сервером \[ sc-bytes\]
-   Байт получено и обработано сервером \[ CS-bytes\]
-   Время, затраченное на обработку \[ времени запроса\]
-   Queue-Name (зарезервировано для IIS) \[ S-QUEUENAME\]

## <a name="selecting-fileds-to-log-in-the-http-error-log-file"></a>Выбор пункта "архивированные" для записи в файл журнала ошибок HTTP

Добавлен раздел реестра **еррорлоггингфиелдс** для управления полями, зарегистрированными в журнале ошибок HTTP. Эти значения реестра находятся в разделе параметров HTTP, \\ расположенном по адресу:

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
      Services
         HTTP
            Parameters
```

Значение реестра **еррорлоггингфиелдс** — это значение типа DWORD, которое содержит битовые значения для каждого поля, которое можно зафиксировать в журнале. Чтобы включить ведение журнала определенного поля, установите соответствующее значение бита равным 1 и перезапустите службу HTTP. Чтобы отключить ведение журнала, установите значение бита равным 0. Чтобы настроить несколько полей, используйте побитовую операцию или для отдельных значений. Например, чтобы включить поля журнала файлов cookie и источника ссылок, значение должно быть 0x00020000 \| 0x00040000 = 0x00060000. Если раздел реестра **еррорлоггингфиелдс** отсутствует, записываются поля по умолчанию. Значение **еррорлоггингфиелдс** для записи в журнал полей по умолчанию — 0x7c884c7. Чтобы включить ведение журнала для всех полей, показанных в таблице ниже, установите значение 0x7dff4e7.

Поля журнала ошибок перечислены в следующей таблице.



| Поле журнала            | Регистрируется по умолчанию | Битовое значение  |
|----------------------|-------------------|------------|
| Дата                 | Да               | 0x00000001 |
| Время                 | Да               | 0x00000002 |
| Имя компьютера сервера | Нет                | 0x00000020 |
| IP-адрес клиента    | Да               | 0x00000004 |
| Порт клиента          | Да               | 0x00400000 |
| IP-адрес сервера    | Да               | 0x00000040 |
| Порт сервера          | Да               | 0x00008000 |
| Версия протокола     | Да               | 0x00080000 |
| Метод               | Да               | 0x00000080 |
| URI                  | Да               | 0x00800000 |
| Агент пользователя           | Нет                | 0x00010000 |
| Куки-файл               | Нет                | 0x00020000 |
| ссылок             | Нет                | 0x00040000 |
| Узел                 | Нет                | 0x00100000 |
| Состояние протокола      | Да               | 0x00000400 |
| SC-Bytes             | Нет                | 0x00001000 |
| CS-Bytes             | Нет                | 0x00002000 |
| Затраченное время           | Нет                | 0x00004000 |
| Идентификатор               | Да               | 0x01000000 |
| Фраза причины        | Да               | 0x02000000 |
| Имя очереди           | Нет                | 0x04000000 |
| Идентификатор потока            | Нет                | 0x???????? |



 

## <a name="time-and-date-rollover"></a>Смена времени и даты

По умолчанию создается новый файл журнала ошибок HTTP (с условной сменой файла), когда текущий файл журнала достигает указанного размера. начиная с Windows Server 2003 с пакетом обновления 1 (SP1), новые файлы журнала ошибок можно создавать на основе даты и времени. Смена времени и даты контролируется двумя новыми значениями реестра: **еррорлоггингролловертипе** и **еррорлоггинглокалтимеролловер**. Чтобы включить смену времени и даты, эти значения реестра необходимо добавить в реестр. После добавления этих ключей в реестр служба HTTP должна быть перезапущена. Разделы реестра для продолжения файла журнала создаются в следующем разделе:

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Services
            HTTP
               Parameters
```

Раздел реестра **еррорлоггингролловертипе** указывает тип требуемой смены и по умолчанию имеет значение смена на основе размера. Смена также может выполняться ежедневно, еженедельно, ежемесячно или ежечасно. Когда операция переключения на файл данных основана на времени, значение **еррорлоггинглокалтимеролловер** , равное 0, указывает, что время переключения выражается в формате GMT, а значение 1 указывает на то, что время переключения выражается в местном времени. Ключ **еррорлоггингролловертипе** может принимать значение от 0 до 4, как указано в следующей таблице.



| Значение типа продолжения | Описание                                                                                                                             |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| 0                   | Смена на основе размера. Происходит откат файлов журналов, когда размер файла достигает размера, определенного в разделе реестра **еррорлогфилетрункатесизе** . |
| 1                   | Операция переключения на файл журнала выполняется ежедневно.                                                                                                         |
| 2                   | Операция переключения на файл журнала выполняется еженедельно.                                                                                                        |
| 3                   | Операция переключения на файл журнала выполняется ежемесячно.                                                                                                       |
| 4                   | Операция переключения на файл журнала выполняется каждый час.                                                                                                        |



 

Соглашения об именовании для файлов, в которых хранятся журналы ошибок, отличаются в зависимости от размера, даты и смены времени. В следующей таблице перечислены соглашения об именовании для файлов журнала HTTP.



| Тип толловер | Имя файла журнала  | Описание                                                                                                                         |
|---------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------|
| Размер          | Хттперрн. LOG   | Файл журнала перезапускается при достижении определенного размера. n — это номер файла, который увеличивается при изменении файла журнала. |
| Ежедневно         | Хтииммдд. log   | Файл журнала ежедневно перезапускается.                                                                                                     |
| Еженедельно        | Хтииммвв. log   | Файл журнала перезапускается еженедельно, где WW — неделя месяца.                                                                 |
| Ежемесячно       | Хтиимм. log     | Файл журнала перезапускается каждый месяц.                                                                                               |
| Каждый час        | Хтииммддхх. log | Файл журнала перезапускается каждый час, где ЧЧ — это час дня, выраженный в 0-24 часе.                                   |



 

 

 




