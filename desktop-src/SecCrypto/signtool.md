---
title: SignTool
description: Средство SignTool — это программа командной строки, которая выполняет цифровую подпись файлов, проверяет подписи в файлах и файлы меток времени.
ms.assetid: aa59cb35-5fba-4ce8-97ea-fc767c83f88e
ms.topic: article
ms.date: 10/12/2020
ms.openlocfilehash: 884d4c132a2877a51cef7610dd32e8ef6b9c4bc3
ms.sourcegitcommit: 25e1fa2b3641ae13b79e0afdf9cb7a168d99e009
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "104414057"
---
# <a name="signtool"></a>SignTool

Средство SignTool — это программа командной строки, которая выполняет цифровую подпись файлов, проверяет подписи в файлах и файлы меток времени. Сведения о том, почему файлы подписи важны, см. [в статье Введение в подписывание кода](cryptography-tools.md). Средство устанавливается в \\ папку bin пути установки пакета средств разработки программного обеспечения (SDK) для Microsoft Windows.

Средство SignTool доступно в составе Windows SDK, которое можно скачать из <https://developer.microsoft.com/windows/downloads/windows-10-sdk/> .

> [!Note]  
> Для Windows 10 SDK, Windows 10 ХЛК, Windows 10 WDK и Windows 10 ADK **builds 20236 и более поздних версий** теперь потребуется указать алгоритм дайджеста. Команда подписывания средства SignTool требует, `file digest algorithm` `timestamp digest algorithm` чтобы параметр/FD был указан во время подписывания и метки времени, соответственно. Предупреждение (код ошибки 0, изначально) будет выдаваться, если/fd не задан во время подписывания и если/ТД не указан во время метки времени. В более поздних версиях средства SignTool предупреждение станет ошибкой. В отрасли рекомендуется использовать SHA256, поскольку он более безопасный, чем SHA1.  


## <a name="syntax"></a>Синтаксис  
  
```console  
signtool [command] [options] [file_name | ...]  
```  

## <a name="parameters"></a>Параметры  
  
|Аргумент|Описание|  
|----|----|  
|`command`|Одна из четырех команд (`catdb`, `sign`, `Timestamp` или `Verify`), указывающая операцию, которую требуется выполнить с файлом. Описание каждой из команд дано в следующей таблице.|  
|`options`|Параметр, изменяющий команду. Кроме глобальных параметров `/q` и `/v` каждая команда поддерживает уникальный набор параметров.|  
|`file_name`|Путь к подписываемому файлу.| 


Средство SignTool поддерживает следующие команды.

|Get-Help|Описание|  
|----|----|  
|`Catdb`|Добавляет файл каталога в базу данных каталогов или удаляет его из этой базы данных. Базы данных каталогов используются для автоматического поиска файлов каталогов и определяются идентификаторами GUID. Список параметров, поддерживаемых командой `catdb`, см. в разделе [Параметры команды "catdb"](/dotnet/framework/tools/signtool-exe#catdb-command-options).|  
|`Sign`|Присваивает цифровые подписи файлам. Цифровые подписи обеспечивают защиту файлов от несанкционированного доступа и позволяют пользователям проверять, кем подписан файл, на основе сертификата подписи. Список параметров, поддерживаемых командой `sign`, см. в разделе [Параметры команды "sign"](/dotnet/framework/tools/signtool-exe#sign-command-options).|  
|`Timestamp`|Присваивает отметки времени для файлов. Список параметров, поддерживаемых командой `TimeStamp`, см. в разделе [Параметры команды "TimeStamp"](/dotnet/framework/tools/signtool-exe#timestamp-command-options).|  
|`Verify`|Проверяет цифровую подпись файлов, определяя, был ли сертификат подписи выдан доверенным центром сертификации, был ли сертификат подписи отозван, и, если требуется, действителен ли сертификат подписи для конкретной политики. Список параметров, поддерживаемых командой `Verify`, см. в разделе [Параметры команды "Verify"](/dotnet/framework/tools/signtool-exe#verify-command-options).|

 Следующие параметры доступны для всех команд программы Sign Tool.  
  
|Глобальный параметр|Описание|  
|----|----|  
|**/q**|Не отображает выходные данные, если команда выполнена успешно, и отображает минимальные выходные данные, если команда завершилась ошибкой.|  
|**/v**|Отображает подробные выходные данные независимо от того, выполнена ли команда успешно или с ошибкой, и отображает предупреждения.|  
|**/debug**|Отображает отладочную информацию.|  

 
## <a name="catdb-command-options"></a>Параметры команды catdb  

 В следующей таблице перечислены параметры, которые могут использоваться с командой `Catdb`.

| Параметр "catdb" | Описание |
|----|----| 
| **/d** | Указывает, что база данных каталога по умолчанию будет обновлена. Если не используется ни параметр **/d** , ни **/G** , средство SignTool обновляет базу данных системных компонентов и драйверов. |
| **/G** *GUID* | Указывает, что база данных каталога, определяемая идентификатором GUID, будет обновлена.|
| **/r** | Удаляет указанный каталог из базы данных каталога. Если этот параметр не указан, средство SignTool добавит указанный каталог в базу данных каталога.|
| **/u** | Указывает, что для добавленных файлов каталога автоматически создается уникальное имя. Пир необходимости, файлы каталогов переименовываются, чтобы предотвратить конфликты имен с существующими файлами каталогов. Если этот параметр не указан, средство SignTool перезаписывает существующий каталог, имя которого совпадает с именем добавляемого каталога.|

> [!Note]  
> Базы данных каталога используются для автоматического поиска файлов каталога.


## <a name="sign-command-options"></a>Параметры команды "Sign"  

 В следующей таблице перечислены параметры, которые могут использоваться с командой `sign`.  
  
|Параметр команды "sign"|Описание|  
|----|----| 
|`/a`|Автоматически выбирает лучший сертификат подписи. Программа Sign Tool найдет все действительные сертификаты, которые удовлетворяют всем указанным условиям, и выберет тот, который действителен в течение наиболее длительного периода времени. Если этот параметр не указан, программа Sign Tool находит и использует только один допустимый сертификат подписи.|  
|`/ac`  *file*|Добавляет дополнительный сертификат из файла *file* в блок подписи.|  
|`/as`|Добавляет эту подпись. Если основная подпись отсутствует, данная подпись становится основной.|  
|`/c`  *CertTemplateName*|Указывает имя шаблона сертификата (расширение Microsoft) для сертификата подписи.|  
|`/csp`  *CSPName*|Указывается поставщик служб шифрования (CSP), содержащий контейнер закрытого ключа.|  
|`/d`  *Desc*|Задает описание подписанного содержимого.|  
|`/dg`  *Путь*|Формирует дайджест для подписи и неподписанные файлы PKCS7. Выходные данные дайджеста и PKCS7 имеют следующие файлы: *пас\филенаме.Диг* и *Path\FileName.p7u*. Чтобы вывести дополнительный XML-файл, см. раздел <strong>/дксмл</strong>.|  
|`/di`  *Путь*|Создает подпись путем приема со знакомого дайджеста в неподписанный файл PKCS7. Входное хэш-значение и неподписанные файлы PKCS7 должны быть: *пас\филенаме.Диг.сигнед* и *Path\FileName.p7u*.|  
|`/dlib`  *КОМПОНОВКИ*|Указывает DLL-библиотеку, реализующую <code>AuthenticodeDigestSign</code> функцию для подписи дайджеста. Этот параметр аналогичен использованию средства <strong>SignTool</strong> отдельно с коммутаторами <strong>/ДГ</strong>, <strong>/ДС</strong>и <strong>/ди</strong> , за исключением того, что этот параметр вызывает все три как одну атомарную операцию.|  
|`/dmdf`  *Файлов*|При использовании с параметром <strong>/ДГ</strong> передает содержимое файла в <code>AuthenticodeDigestSign</code> функцию без изменения.|  
|`/ds`  |Подписывает только дайджест. Входной файл должен быть дайджестом, созданным с помощью параметра <strong>/ДГ</strong> . Выходной файл будет иметь значение: *File. подпись*.|  
|`/du`  *URL*|Задает URL-адрес для расширенного описания подписанного содержимого.|  
|`/dxml`  |При использовании с параметром <strong>/ДГ</strong> создает XML-файл. Выходной файл будет: *Path\FileName.dig.xml*.|  
|`/f`  *SignCertFile*|Задает сертификат подписи в файле. Если формат файла — Personal Information Exchange (PFX), и он защищен паролем, задайте пароль с помощью параметра `/p`. Если файл не содержит закрытых ключей, с помощью параметров `/csp` и `/kc` задайте CSP и имя контейнера закрытого ключа.|  
|`/fd`*алгоритм*|Задает алгоритм хэш-кода файла, который будет использоваться при создании подписей файлов. </br> **Примечание.** Если во время подписывания не указан параметр <strong>/FD</strong> , создается предупреждение. Алгоритмом по умолчанию является SHA1, но рекомендуется использовать SHA256.|
|`/fd`  *certHash*|Указание строки certHash является действием по умолчанию для алгоритма, используемого в сертификате для подписи. </br> **Примечание.** Доступно только в комплектах Windows 10, 20236 и более поздних версиях.|  
|`/i`  *IssuerName*|Задает имя поставщика сертификата подписи. Это значение может быть подстрокой полного имени поставщика.|  
|`/kc`  *PrivKeyContainerName*|Задает имя контейнера закрытого ключа.|  
|`/n`  *SubjectName*|Задает имя субъекта сертификата подписи. Это значение может быть подстрокой полного имени субъекта.|  
|`/nph`|Если поддерживается, отключает хэши страниц для исполняемых файлов. Значение по умолчанию определяется переменной среды SIGNTOOL_PAGE_HASHES и версией файла "wintrust.dll". Этот параметр игнорируется для файлов, отличных от PE-файлов.|  
|`/p`  *Password*|Задает пароль, который используется при открытии PFX-файла. (PFX-файл указывается с помощью параметра `/f`.)|  
|`/p7` *Путь*|Указывает, что для каждого заданного файла содержимого создается файл PKCS #7. Файлы PKCS #7 имеют имена вида *путь*\\*имя_файла*.p7.|  
|`/p7ce` *Value*|Задает параметры для подписанного содержимого PKCS #7. Задайте значение *Value* как "Embedded", чтобы внедрить подписанное содержимое в файл PKCS #7, или как "DetachedSignedData", чтобы создать подписанную часть данных отсоединенного файла PKCS #7. Если параметр `/p7ce` не используется, подписанное содержимое встраивается по умолчанию.|  
|`/p7co` *\<OID>*|Задает идентификатор объекта (OID), определяющий подписанное содержимое PKCS #7.|  
|`/ph`|Если поддерживается, генерирует хэши страниц для исполняемых файлов.|  
|`/r`  *RootSubjectName*|Задает имя субъекта корневого сертификата, к которому должна быть протянута цепочка сертификата подписи. Это значение может быть подстрокой полного имени субъекта корневого сертификата.|  
|`/s`  *StoreName*|Указывает хранилище, которое открывается при поиске сертификата. Если этот дополнительный параметр не указан, открывается хранилище `My`.|  
|`/sha1`  *Hash*|Задает хэш SHA1 сертификата подписи. Хэш SHA1 обычно указывается, когда несколько сертификатов удовлетворяют критериям, заданным остальными ключами.|  
|`/sm`|Указывает, что вместо пользовательского хранилища используется хранилище на компьютере.|  
|`/t`  *URL*|Задает URL-адрес сервера отметок времени. Если этот параметр (или параметр `/tr`) отсутствует, подписанному файлу не присваивается отметка времени. Если присвоение отметки времени не удалось, выдается предупреждение. Данный параметр невозможно использовать одновременно с параметром `/tr`.|  
|`/td`  *alg*|Используется с параметром `/tr`, чтобы запросить алгоритм дайджеста, используемый сервером отметок времени RFC 3161. </br> **Примечание.** Если при отметке времени не указан параметр <strong>/ТД</strong> , создается предупреждение. Алгоритмом по умолчанию является SHA1, но рекомендуется использовать SHA256. <br/> Параметр <strong>/ТД</strong> должен быть объявлен после параметра <strong>/tr</strong> , а не до. Если параметр <strong>/ТД</strong> объявлен перед параметром <strong>/tr</strong> , то возвращаемая отметка времени возвращается из алгоритма SHA1 вместо предполагаемого алгоритма SHA256. |
|`/tr`  *URL*|Задает URL-адрес сервера отметок времени RFC 3161. Если этот параметр (или параметр `/t`) отсутствует, подписанному файлу не присваивается отметка времени. Если присвоение отметки времени не удалось, выдается предупреждение. Данный параметр невозможно использовать одновременно с параметром `/t`.|  
|`/u`  *Usage*|Задает расширенное использование ключа (EKU), которое должно быть представлено в сертификате подписи. Значение использования может быть задано идентификатором объекта или строкой. По умолчанию используется подписывание кода (1.3.6.1.5.5.7.3.3).|  
|`/uw`|Задает использование "Windows System Component Verification" (1.3.6.1.4.1.311.10.3.6).|  
  
 Примеры использования см. в разделе [Использование средства SignTool для подписания файла](using-signtool-to-sign-a-file.md).  
  

## <a name="timestamp-command-options"></a>Параметры команды TimeStamp  

 В следующей таблице перечислены параметры, которые могут использоваться с командой `TimeStamp`.  
  
|Параметр "TimeStamp"|Описание|  
|----|----|  
|`/p7`|Присваивает файлам PKCS #7 отметки времени.|  
|`/t`  *URL*|Задает URL-адрес сервера отметок времени. Файл, получающий отметку времени, должен быть заранее подписан. Необходимо использовать параметр `/t` или `/tr`.|  
|`/td`  *alg*|Используется с параметром `/tr`, чтобы запросить алгоритм дайджеста, используемый сервером отметок времени RFC 3161. </br> **Примечание.** Если при отметке времени не указан параметр <strong>/ТД</strong> , создается предупреждение. Алгоритмом по умолчанию является SHA1, но рекомендуется использовать SHA256. <br/> Параметр <strong>/ТД</strong> должен быть объявлен после параметра <strong>/tr</strong> , а не до. Если параметр <strong>/ТД</strong> объявлен перед параметром <strong>/tr</strong> , то возвращаемая отметка времени возвращается из алгоритма SHA1 вместо предполагаемого алгоритма SHA256. |
|`/tp` *index*|Присваивает подписи метку времени в *index*.|  
|`/tr`  *URL*|Задает URL-адрес сервера отметок времени RFC 3161. Файл, получающий отметку времени, должен быть заранее подписан. Необходимо использовать параметр `/tr` или `/t`.|  


## <a name="verify-command-options"></a>Параметры команды "проверить"  

|Параметр "Verify"|Описание|
|----|----|
| **/a** | Указывает, что все методы могут использоваться для проверки файла. Сначала выполняется поиск в базах данных каталогов, чтобы определить, подписан ли файл в каталоге. Если файл не подписан ни в одном каталоге, средство SignTool пытается проверить внедренную подпись файла. Этот параметр рекомендуется использовать при проверке файлов, которые могут быть подписаны или не подписаны в каталоге. Примеры файлов, которые могут быть не подписаны, содержат файлы или драйверы Windows. |
| **/AD** | Выполняет поиск каталога, используя базу данных каталогов по умолчанию. |
| **/all** | Проверяет все подписи в файле с несколькими сигнатурами. |
| **/ас** | Выполняет поиск каталога, используя базу данных каталога системных компонентов (драйверов). |
| **/АГ** *катдбгуид* | Находит каталог в базе данных каталога, определяемый **идентификатором GUID**. |
| **/c** *катфиле* | Задает файл каталога по имени. |
| **/d** | Печать описания и URL-адреса описания.<br/> **Windows Vista и более ранние версии:** Этот флаг не поддерживается.<br/> |
| **/ДС** *индекс* | Проверяет подпись в определенной позиции. |
| **/хаш**{**SHA1** \| **SHA256**} | Задает необязательный алгоритм хэширования, который должен использоваться при поиске файла в каталоге. |
| **/кп** | Выполняет проверку с помощью политики подписывания драйвера режима ядра x64. |
| **/мс** | Использует несколько семантик проверки. Это поведение по умолчанию для вызова [**WinVerifyTrust**](/windows/desktop/api/Wintrust/nf-wintrust-winverifytrust) . |
| **/O** *версия* | Проверяет файл в соответствии с версией операционной системы. Параметр Version имеет вид:<br/> *PlatformID ***:*** вермажор ***.*** Верминор ***.*** BuildNumber*<br/> Рекомендуется использовать параметр */o* . Если */o* не указан, средство SignTool может возвращать непредвиденные результаты. Например, если не включить параметр */o* , то системные каталоги, которые правильно проверяются в более старой ОС, могут неправильно проверяться в более новой ОС. |
| **/p7** | Проверьте \# файлы PKCS 7. Для проверки PKCS 7 существующие политики не используются \# . Подпись проверяется, и для сертификата подписи строится цепочка. |
| **/па** | Указывает, что используется политика проверки подлинности по умолчанию. Если параметр **/ПА** не указан, средство SignTool использует политику проверки драйверов Windows. Этот параметр нельзя использовать с параметрами **catdb** . |
| **/ПГ** *полицигуид* | Задает политику проверки по **идентификатору GUID**. **Идентификатор GUID** соответствует параметру actionID политики проверки. Этот параметр нельзя использовать с параметрами **catdb** . |
| **/pH создает** | Печать и проверка хэш-значений страниц.<br/> **Windows Vista и более ранние версии:** Этот флаг не поддерживается.<br/>  |
| **/R** *рутсубжектнаме* | Задает имя субъекта корневого сертификата, к которому должна быть протянута цепочка сертификата подписи. Это значение может быть подстрокой полного имени субъекта корневого сертификата. |
| **/тв** | Указывает, что предупреждение создается, если подпись не имеет отметки времени.|


Команда SignTool **Verify** определяет, был ли сертификат подписи выдан доверенным центром сертификации, был ли отозван сертификат для подписи и, при необходимости, является ли сертификат подписи допустимым для конкретной политики.  

Команда SignTool **Verify** выводит состояние **встроенной** подписи, если не указан параметр для поиска каталога (/a,/AD,/АС,/АГ,/c).


## <a name="return-value"></a>Возвращаемое значение  

 Программа Sign Tool при прерывании возвращает один из следующих кодов выхода.  
  
|Код выхода|Описание|  
|----|----| 
|0|Выполнение прошло успешно.|  
|1|Сбой выполнения.|  
|2|Выполнение завершено с предупреждениями.|


## <a name="examples"></a>Примеры  

 Следующая команда добавляет файл каталога "MyCatalogFileName.cat" в базу данных системных компонентов и драйверов. Параметр `/u` создает уникальное имя, если это необходимо для предотвращения замены существующего файла каталога с именем `MyCatalogFileName.cat`.  
  
```console  
signtool catdb /v /u MyCatalogFileName.cat  
```  
  
 При выполнении следующей команды файл подписывается автоматически с помощью наиболее подходящего сертификата.  
  
```console  
signtool sign /a /fd SHA256 MyFile.exe 
```  
  
 При выполнении следующей команды файл подписывается цифровой подписью с помощью сертификата, хранящегося в защищенном паролем PFX-файле.  
  
```console  
signtool sign /f MyCert.pfx /p MyPassword /fd SHA256 MyFile.exe 
```  
  
 При выполнении следующей команды файл подписывается цифровой подписью, и ему присваивается отметка времени. Сертификат, используемый для подписания файла, хранится в PFX-файле.  
  
```console  
signtool sign /f MyCert.pfx /t http://timestamp.digicert.com /fd SHA256 MyFile.exe 
```  
  
 При выполнении следующей команды файл подписывается с помощью сертификата, расположенного в хранилище `My`, с именем субъекта `My Company Certificate`.  
  
```console  
signtool sign /n "My Company Certificate" /fd SHA256 MyFile.exe 
```  
  
 При выполнении следующей команды подписывается элемент управления ActiveX и предоставляется информация, отображаемая в Internet Explorer, когда пользователю предлагается установить элемент управления.  
  
```console  
Signtool sign /f MyCert.pfx /d: "MyControl" /du http://www.example.com/MyControl/info.html /fd SHA256 MyControl.exe 
```  
  
 При выполнении следующей команды файлу, у которого уже имеется цифровая подпись, присваивается отметка времени.  
  
```console  
signtool timestamp /t http://timestamp.digicert.com MyFile.exe
```  

Следующая команда помечает файл с помощью сервера меток времени RFC 3161.  
  
```console  
signtool timestamp /tr http://timestamp.digicert.com /td SHA256 MyFile.exe
```  
  
 Следующая команда проверяет наличие подписи у файла.  
  
```console  
signtool verify MyFile.exe  
```  
  
 Следующая команда проверяет системный файл, который может быть подписан в каталоге.  
  
```console  
signtool verify /a SystemFile.dll  
```  
  
 Следующая команда проверяет системный файл, подписанный в каталоге с именем `MyCatalog.cat`.  
  
```console  
signtool verify /c MyCatalog.cat SystemFile.dll  
```  
