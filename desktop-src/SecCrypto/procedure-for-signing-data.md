---
description: Показывает связь между параметрами функции, указывающими на структуры или массивы, и их инициализированные данные.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Процедура для подписи данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba289928ab39c690e1c44bdbf65c77c18b7edab3
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127170895"
---
# <a name="procedure-for-signing-data"></a>Процедура для подписи данных

Одна функция, [**криптсигнмессаже**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), выполняет все задачи, перечисленные при [создании подписанного сообщения](creating-a-signed-message.md). Тем не менее, все еще необходимо инициализировать структуры и другие данные. На следующем рисунке показана связь между параметрами функции, которые указывают на структуры или массивы и их инициализированные данные. На рисунке показаны только параметры функции и члены структуры, производные от других структур или функций. Остальные параметры являются простыми инициализациями.

![Схема инициализации для вызова криптсигнмессаже](images/crypsign.png)

**Подписывание данных с помощью Криптсигнмессаже**

1.  Получение указателя на данные, которые должны быть подписаны.
2.  Присвойте указатель на данные нулевому индексу массива "данные для подписи".
3.  Получение маркера для поставщика служб шифрования.
4.  Откройте [*хранилище сертификатов*](../secgloss/c-gly.md) , содержащее сертификат подписи.
5.  Получите адрес для сертификата подписи.
6.  Назначьте адрес сертификата нулевому индексу массива *мсгцерт* .
7.  Назначьте адреса других сертификатов, которые будут включаться в сообщение, в массив *мсгцерт* .
8.  Инициализируйте [**структуру \_ \_ идентификатора алгоритма шифрования**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) , инициализируя элемент **псзобжид** для требуемого хэш-алгоритма и других элементов соответствующим образом.
9.  Инициализируйте [**структуру \_ \_ сообщения об \_ отшифровании**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) с помощью знака «абзац», инициализируя член **псигнингцерт** по адресу сертификата подписывания, члену массива **мсгцерт** и адресу сертификатов подписавших и других, **HashAlgorithm** члену адрес структуры [**\_ \_ идентификатора алгоритма шифрования**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) и другим элементам в соответствии с соответствующими правами.
10. Вызовите функцию [**криптсигнмессаже**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) , передав в качестве значения параметра *псигнпара* структуру знаков для [**подписи шифрования, адрес массива "данные \_ \_ \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) для подписи" для параметра *ргпбтобесигнед* , адрес для выходного параметра *пбсигнедблоб* и другие необходимые параметры.

 

 
