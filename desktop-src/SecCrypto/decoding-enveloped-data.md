---
description: Общие задачи, необходимые для декодирования сообщения, упакованного в оболочку.
ms.assetid: cb71ea3a-0edd-4d46-8088-a395fab89d2b
title: Декодирование упакованных данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc1a0ba12e967f5a0cd56347c0839ce9fca40f02
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104570336"
---
# <a name="decoding-enveloped-data"></a>Декодирование упакованных данных

Общие задачи, необходимые для декодирования сообщения с оболочкой, показаны на следующем рисунке и описаны в приведенном ниже списке.

![декодирование упакованных данных](images/decemsg.png)

Последовательность событий декодирования запечатанных данных с помощью управления ключами транспортных ключей, как показано на предыдущем рисунке, выглядит следующим образом:

-   Извлекается указатель на сообщение с [*цифровым конвертом*](../secgloss/d-gly.md) .
-   Открыто [*хранилище сертификатов*](../secgloss/c-gly.md) .
-   В сообщении извлекается идентификатор получателя (My ID).
-   Идентификатор получателя используется для получения сертификата.
-   Получен [*закрытый ключ*](../secgloss/p-gly.md) , связанный с этим сертификатом.
-   Закрытый ключ используется для расшифровки [*симметричного*](../secgloss/s-gly.md) ключа ([*сеанса*](../secgloss/s-gly.md)).
-   Алгоритм шифрования извлекается из сообщения.
-   При использовании закрытого ключа и алгоритма шифрования данные расшифровываются.

В следующей процедуре используются функции обработки сообщений низкого уровня для выполнения только что перечисленных задач.

**Декодирование сообщения, упакованного в оболочку**

1.  Получение указателя на закодированный BLOB-объект.
2.  Вызовите [**криптмсгопентодекоде**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), передав необходимые аргументы.
3.  Вызовите [**криптмсгупдате**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) один раз, передав маркер, полученный на шаге 2, и указатель на данные, которые необходимо декодировать. Это приводит к тому, что в зависимости от типа сообщений в сообщении будут выполняться соответствующие действия.
4.  Вызовите [**криптмсгжетпарам**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), передав маркер, полученный на шаге 2, и КМСГ \_ типа \_ param, чтобы убедиться, что сообщение имеет тип данных, упакованный в оболочку.
5.  Снова вызовите [**криптмсгжетпарам**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), передав \_ \_ параметр типа внутреннего содержимого КМСГ, \_ \_ чтобы получить тип данных [*внутреннего содержимого*](../secgloss/i-gly.md).
6.  Если тип данных внутреннего содержимого — **Data**, приступите к расшифровке и декодированию содержимого. В противном случае выполните процедуру декодирования, подходящую для типа данных Content.
7.  При условии, что тип внутреннего содержимого — "Data", инициализируйте [**КМСГ \_ CTRL \_ расшифровать \_ абзац**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_ctrl_decrypt_para) данных и вызовите [**криптмсгконтрол**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), передав КМСГ \_ CTRL \_ расшифровывает и адрес структуры. Содержимое будет расшифровано.
8.  Вызовите [**криптмсгжетпарам**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), передав \_ параметр содержимого КМСГ, \_ чтобы получить указатель на Раскодированный BLOB-объект данных содержимого (строка в **байтах** ).
9.  Вызовите [**криптмсгклосе**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) , чтобы закрыть сообщение.

Результатом этой процедуры является декодирование и расшифровка сообщения, а также получение указателя на большой двоичный объект данных содержимого.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Пример программы на языке C. кодирование подписанного сообщения с подписью](example-c-program-encoding-an-enveloped-signed-message.md)
</dt> </dl>

 

 
