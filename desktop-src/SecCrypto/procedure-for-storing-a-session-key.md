---
description: Описывает процедуру, используемую для хранения ключа сеанса.
ms.assetid: 9ab7f747-9c69-40b5-af78-163f3ba315bf
title: Сохранение ключа сеанса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e3b17de657ddba47dd77f68c1ee7a2adfdf93e7f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105683498"
---
# <a name="storing-a-session-key"></a>Сохранение ключа сеанса

> [!Note]  
> В этом разделе предполагается, что пользователи обладают набором [*пар открытого и закрытого ключей*](../secgloss/p-gly.md). Инструкции и пример создания пар ключей можно найти в [примере программы на языке C: создание контейнера ключей и создание ключей](example-c-program-creating-a-key-container-and-generating-keys.md).

 

**Сохранение ключа сеанса**

1.  Создайте [*большой двоичный объект простого ключа*](../secgloss/k-gly.md) с помощью функции [**криптекспорткэй**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptexportkey) . Это приведет к переносу ключа сеанса из CSP в пространство памяти приложения. Укажите, что для подписи ключевого BLOB-объекта используется открытый ключ Exchange.
2.  Сохраните большой двоичный объект подписанного ключа на диск. Предполагается, что все диски являются небезопасными.
3.  При необходимости Прочитайте ключ большого двоичного объекта с диска.
4.  Импортируйте большой двоичный объект ключа обратно в CSP с помощью функции [**криптимпорткэй**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptimportkey) .

Пример создания [*ключа сеанса*](../secgloss/s-gly.md) и экспорта этого ключа в [*простой ключевой BLOB-объект*](../secgloss/s-gly.md) , который можно записать в файл на диске, см. в разделе [Пример программы C: экспорт ключа сеанса](example-c-program-exporting-a-session-key.md).

Эта процедура обеспечивает только минимальную безопасность. Если сохраненный ключ сеанса будет использоваться для шифрования данных позднее, то предыдущая процедура не обеспечит адекватной безопасности.

Чтобы обеспечить более высокий уровень безопасности, подпишите большой двоичный объект ключа с помощью закрытого ключа Exchange, прежде чем он будет сохранен на диске. После последующего считывания большого двоичного объекта ключа с диска его подпись может быть проверена, чтобы гарантировать, что большой двоичный объект ключа не будет поврежден.

Если большой двоичный объект ключа не подписан, любой пользователь, имеющий доступ к диску или другому носителю, на котором хранится ключ, может создать новый ключ сеанса.

Новый ключ сеанса можно зашифровать с помощью [*ключа обмена*](../secgloss/e-gly.md) [*открытым ключом*](../secgloss/p-gly.md) исходного пользователя. Этот новый ключ можно заменить на исходный. Если пользователь не знает, что использовал замененный ключ сеанса для шифрования файлов и сообщений, человек, создавший заменяющий ключ, может легко расшифровывать их.

Цифровые подписи подробно обсуждаются в разделе [хэши и Цифровые подписи](hashes-and-digital-signatures.md).

 

 
