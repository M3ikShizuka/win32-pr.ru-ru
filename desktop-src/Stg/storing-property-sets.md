---
title: Хранение наборов свойств
description: Приложения могут предоставлять некоторые данные о состоянии своих документов, чтобы другие приложения могли разыскать и считывать эти данные.
ms.assetid: 2e0b5f6c-da1d-47f2-a50d-1ac7f2f0c45d
keywords:
- Хранение наборов свойств структурированного хранилища
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 60710b84b52fcc709f8ba3ad1e930d6f5a50a4cd
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103887832"
---
# <a name="storing-property-sets"></a>Хранение наборов свойств

Приложения могут предоставлять некоторые данные о состоянии своих документов, чтобы другие приложения могли разыскать и считывать эти данные. В качестве примера можно привести набор свойств, описывающих автора, заголовок и ключевые слова документа, созданного с помощью текстового процессора, или список шрифтов, используемых в документе. Это средство не ограничено документами. его также можно использовать для внедренных объектов. Как правило, доступ к наборам свойств должен осуществляться через интерфейсы [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) и [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) , но в этом разделе описан ранее рекомендуемый способ.

> [!Note]  
> При хранении набора свойств, который является внутренним для приложения, вы можете не использовать следующие рекомендации. Чтобы предоставить свойству значение другие приложения, следуйте приведенным ниже рекомендациям.

 

**Сохранение набора свойств в составном файле**

1.  Создайте экземпляр [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) или [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) на том же уровне структуры хранения, что и его потоки данных. Подпишитесь на имя экземпляра **IStorage** или **IStream** с помощью " \\ 005". Имена потоков и хранилищ, начинающиеся с 0x05, зарезервированы для общих наборов свойств, которые могут совместно использоваться приложениями. Кроме того, потоки, начинающиеся с этого значения, имеют ограничение в 256 КБ. Имена можно выбрать либо из опубликованных имен, либо из форматов, либо путем присвоения свойству значения FMTID и наследования имени из FMTID в соответствии с соглашениями, описанными в разделе [соглашения об именовании объектов хранилища](storage-object-naming-conventions.md).
2.  Набор свойств может храниться в одном экземпляре [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) или в экземпляре [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) , содержащем несколько потоков и хранилищ. В случае экземпляра **IStorage** вложенный поток с именем Content является основным потоком, содержащим значения свойств, где некоторые значения могут быть именами других потоков или экземпляров хранилища в хранилище для этого набора свойств.
3.  Укажите идентификатор CLSID класса объекта, который может отображать или предоставлять программный доступ к значениям свойств. Если такого класса нет, то для идентификатора CLSID должен быть задан идентификатор формата набора свойств. Для набора свойств, использующего экземпляр [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) , либо установите идентификатор CLSID экземпляра **IStorage** так, чтобы он совпадал со значением, хранящимся в потоке содержимого, или на **CLSID \_ null**; значение в только что созданном экземпляре **IStorage** .
4.  Можно указать отображаемые имена, которые формируют содержимое словаря.

Некоторые приложения могут считывать только реализации наборов свойств, хранимых в виде экземпляров [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) . Приложения должны быть написаны так, что набор свойств может храниться в экземпляре [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) или **IStream** , если только определение набора свойств не указывает иное. Например, определение набора свойств сводных данных указывает, что оно может храниться только в именованном экземпляре **IStream** . В случаях, когда выполняется поиск набора свойств и неизвестно, является ли он хранилищем или потоком, сначала найдите экземпляр **IStream** с именем набора свойств. Если это не удается, найдите экземпляр **IStorage** .

Чтобы лучше понять хранение наборов свойств в реализации [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) , предположим, что существует класс приложений, изменяющий информацию о животных. Во-первых, \_ для этого набора приложений ОПРЕДЕЛЕН CLSID (CLSID анималапп), чтобы они могли указать, что они понимают наборы свойств, содержащие сведения о животном (**FMTID \_ анималинфо**), а также другие, которые содержат медицинские сведения (**FMTID \_ медикалинфо**).

``` syntax
IStorage (File): "C:\OLE\REVO.DOC" 
  IStorage: "\005AnimalInfo", CLSID = CLSID_AnimalApp 
    IStream: "Contents" 
      WORD wByteOrder, WORD wFmtVersion, DWORD dwOSVer, 
      CLSID CLSID_AnimalApp, DWORD cSections... 
      ... 
      FMTID = FMTID_AnimalInfo 
      Property: Type = PID_ANIMALTYPE, Type = VT_LPWSTR, 
              Value = L"Dog" 
      Property: Type = PID_ANIMALNAME, Type = VT_LPWSTR, 
              Value = L"Revo" 
      Property: Type = PID_MEDICALHISTORY, Type = VT_STREAMED_OBJECT, 
              Value = "MedicalInfo" 
      ... 
    IStream: "MedicalInfo" 
      WORD wByteOrder, WORD wFmtVersion, DWORD dwOSVer, 
      CLSID CLSID_AnimalApp, DWORD cSections... 
      ... 
      FMTID = CLSID_MedicalInfo 
      Property: Type = PID_VETNAME, Type = VT_LPWSTR, 
              Value = L"Dr. Woof" 
      Property: Type = PID_LASTEXAM, Type = VT_DATE, Value = ...
```

Имейте в виду, что идентификаторы CLSID интерфейса [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) и обоих наборов свойств — это **CLSID \_ анималапп**. Это определяет любое приложение, которое может отображать и (или) предоставлять программный доступ к этим наборам свойств. Любое приложение может считывать данные в наборах свойств (точки, находящиеся за набором свойств), но только приложения, идентифицируемые с помощью идентификатора класса CLSID \_ анималапп, могут понимать смысл данных в наборах свойств.

 

 




