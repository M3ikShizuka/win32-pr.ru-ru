---
title: Константы СТГМ (Обжбасе. h)
description: Флаги, указывающие условия создания и удаления объекта и режимов доступа для объекта.
ms.assetid: 15a35da9-332a-46e1-9190-500c95e26f59
topic_type:
- apiref
api_name:
- STGM_READ
- STGM_WRITE
- STGM_READWRITE
- STGM_SHARE_DENY_NONE
- STGM_SHARE_DENY_READ
- STGM_SHARE_DENY_WRITE
- STGM_SHARE_EXCLUSIVE
- STGM_PRIORITY
- STGM_CREATE
- STGM_CONVERT
- STGM_FAILIFTHERE
- STGM_DIRECT
- STGM_TRANSACTED
- STGM_NOSCRATCH
- STGM_NOSNAPSHOT
- STGM_SIMPLE
- STGM_DIRECT_SWMR
- STGM_DELETEONRELEASE
api_location:
- ObjBase.h
api_type:
- HeaderDef
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: cd283c2dfeddc48b6bd12f8317ec352cb62e4973
ms.sourcegitcommit: a1494c819bc5200050696e66057f1020f5b142cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2020
ms.locfileid: "104489372"
---
# <a name="stgm-constants"></a>Константы СТГМ

Константы СТГМ — это флаги, указывающие условия создания и удаления объекта и режимов доступа для объекта. Константы СТГМ включены в интерфейсы [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage), [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)и [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) , а также в функции [**стгкреатедокфиле**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile), [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex), [**стгкреатедокфилеонилоккбитес**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfileonilockbytes), [**стгопенстораже**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage)и [**StgOpenStorageEx**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) .

Эти элементы часто объединяются с помощью оператора **или**. Они обрабатываются в группах, как показано в следующей таблице. Недопустимо использовать более одного элемента из одной группы.

Используйте флаг из группы создания при создании объекта, например с помощью [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex) или [**IStorage:: креатестреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstream).

Дополнительные сведения о транзакциях см. в разделе "Примечания".



| Группа                      | Флаг                         | Значение       |
|----------------------------|------------------------------|-------------|
| Access                     | **СТГМ \_ чтение**               | 0x00000000 |
|                            | **СТГМ \_ запись**              | 0x00000001L |
|                            | **СТГМ \_ ReadWrite**          | 0x00000002L |
| Совместное использование                    | **СТГМ \_ Share \_ Deny \_ None**  | 0x00000040L |
|                            | **СТГМ \_ общего ресурса \_ блокировки \_ чтения**  | 0x00000030L |
|                            | **СТГМ \_ \_ запретить \_ запись в общую папку** | 0x00000020L |
|                            | **СТГМ \_ \_ монопольный доступ**   | 0x00000010L |
|                            | **\_приоритет стгм**           | 0x00040000L |
| Создание                   | **\_Создание стгм**             | 0x00001000L |
|                            | **\_Преобразование стгм**            | 0x00020000L |
|                            | **СТГМ \_ фаилифсере**        | 0x00000000 |
| Транзакционная операция             | **СТГМ \_ Direct**             | 0x00000000 |
|                            | **СТГМ \_ транзакционная**         | 0x00010000L |
| Производительность транзакций | **СТГМ \_**          | 0x00100000L |
|                            | **\_моментальный снимок стгм**         | 0x00200000L |
| Прямые СВМР и простые     | **СТГМ \_ Simple**             | 0x08000000L |
|                            | **СТГМ \_ Direct \_ свмр**       | 0x00400000L |
| Удалить в выпуске          | **СТГМ \_ делетеонрелеасе**    | 0x04000000L |



 

<dl> <dt>

<span id="STGM_READ"></span><span id="stgm_read"></span>**СТГМ \_ чтение**
</dt> <dd> <dl> <dt>

0x00000000
</dt> <dt>



Указывает, что объект доступен только для чтения, что означает невозможность внесения изменений. Например, если объект потока открыт с помощью **стгм \_ Read**, можно вызвать метод [**ISequentialStream:: Read**](/windows/desktop/api/Objidl/nf-objidl-isequentialstream-read) , но метод [**ISequentialStream:: Write**](/windows/desktop/api/Objidl/nf-objidl-isequentialstream-write) может не быть. Аналогичным образом, если объект хранилища, Открытый с помощью **стгм \_ Read**, может вызываться метод [**IStorage:: опенстреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-openstream) и [**IStorage:: опенстораже**](/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage) , но методы [**IStorage:: креатестреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstream) и [**IStorage:: креатестораже**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstorage) могут не поддерживаться.


</dt> </dl> </dd> <dt>

<span id="STGM_WRITE"></span><span id="stgm_write"></span>**СТГМ \_ запись**
</dt> <dd> <dl> <dt>

0x00000001L
</dt> <dt>



Позволяет сохранять изменения в объекте, но не разрешает доступ к его данным. Предоставленные реализации интерфейсов [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) и [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) не поддерживают этот режим только для записи.


</dt> </dl> </dd> <dt>

<span id="STGM_READWRITE"></span><span id="stgm_readwrite"></span>**СТГМ \_ ReadWrite**
</dt> <dd> <dl> <dt>

0x00000002L
</dt> <dt>



Обеспечивает доступ и изменение данных объекта. Например, если объект потока создается или открывается в этом режиме, можно вызвать методы [**IStream:: Read**](/windows/desktop/api/Objidl/nn-objidl-istream) и **IStream:: Write**. Имейте в виду, что эта константа не является простой двоичной **или** операцией **Стгм \_ Write** и **стгм \_ Read** Elements.


</dt> </dl> </dd> <dt>

<span id="STGM_SHARE_DENY_NONE"></span><span id="stgm_share_deny_none"></span>**СТГМ \_ Share \_ Deny \_ None**
</dt> <dd> <dl> <dt>

0x00000040L
</dt> <dt>



Указывает, что последующие открытия объекта не запрещают доступ на чтение или запись. Если не указан флаг из группы доступа, то используется этот флаг.


</dt> </dl> </dd> <dt>

<span id="STGM_SHARE_DENY_READ"></span><span id="stgm_share_deny_read"></span>**СТГМ \_ общего ресурса \_ блокировки \_ чтения**
</dt> <dd> <dl> <dt>

0x00000030L
</dt> <dt>



Предотвращает последующее открытие объекта в режиме **\_ чтения стгм** . Обычно он используется в объекте корневого хранилища.


</dt> </dl> </dd> <dt>

<span id="STGM_SHARE_DENY_WRITE"></span><span id="stgm_share_deny_write"></span>**СТГМ \_ \_ запретить \_ запись в общую папку**
</dt> <dd> <dl> <dt>

0x00000020L
</dt> <dt>



Предотвращает последующее открытие объекта для доступа к **стгм \_ Write** или **стгм \_ ReadWrite** . В режиме транзакций совместное использование общей **папки \_ стгм \_ Deny \_ Write** или **стгм \_ может \_** значительно повысить производительность, так как для них не требуются моментальные снимки. Дополнительные сведения о транзакциях см. в разделе "Примечания".


</dt> </dl> </dd> <dt>

<span id="STGM_SHARE_EXCLUSIVE"></span><span id="stgm_share_exclusive"></span>**СТГМ \_ \_ монопольный доступ**
</dt> <dd> <dl> <dt>

0x00000010L
</dt> <dt>



Предотвращает последующее открытие объекта в любом режиме другими пользователями. Следует иметь в виду, что это значение не является простой побитовой операцией **или** операции **стгм \_ Share \_ Deny \_ Read** и **стгм \_ Share \_ Deny \_ Write** . В режиме транзакций совместное использование общей **папки \_ стгм \_ Deny \_ Write** или **стгм \_ может \_** значительно повысить производительность, так как для них не требуются моментальные снимки. Дополнительные сведения о транзакциях см. в разделе "Примечания".


</dt> </dl> </dd> <dt>

<span id="STGM_PRIORITY"></span><span id="stgm_priority"></span>**\_приоритет стгм**
</dt> <dd> <dl> <dt>

0x00040000L
</dt> <dt>



Открывает объект хранилища с монопольным доступом к последней зафиксированной версии. Таким же другим пользователям не удастся зафиксировать изменения в объекте, пока он открыт в режиме приоритета. Вы получаете выигрыш в производительности операций копирования, но не можете предотвратить внесение изменений другими пользователями. Ограничьте время открытия объектов в режиме приоритета. Необходимо указать **стгм \_ Direct** и **стгм \_ Read** в режиме приоритета, а также нельзя указать **стгм \_ делетеонрелеасе**. **Стгм \_ ДЕЛЕТЕОНРЕЛЕАСЕ** допустим только при создании корневого объекта, например с помощью [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex). Он недействителен при открытии существующего корневого объекта, например с помощью [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex). Он также недействителен при создании или открытии подэлемента, например при использовании [**IStorage:: опенстораже**](/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage).


</dt> </dl> </dd> <dt>

<span id="STGM_CREATE"></span><span id="stgm_create"></span>**\_Создание стгм**
</dt> <dd> <dl> <dt>

0x00001000L
</dt> <dt>



Указывает, что существующий объект или поток хранения следует удалить до того, как новый объект заменит его. Новый объект создается, если этот флаг указан только в том случае, если существующий объект был успешно удален.

Этот флаг используется при попытке создать:

-   Объект хранилища на диске, но существует файл с таким именем.
-   Объект в объекте хранилища, но существует объект с указанным именем.
-   Объект массива байтов, но он существует с указанным именем.

Этот флаг нельзя использовать с операциями открытия, такими как [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) или [**IStorage:: опенстреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-openstream).


</dt> </dl> </dd> <dt>

<span id="STGM_CONVERT"></span><span id="stgm_convert"></span>**\_Преобразование стгм**
</dt> <dd> <dl> <dt>

0x00020000L
</dt> <dt>



Создает новый объект, сохраняя существующие данные в потоке с именем "содержимое". В случае объекта хранилища или массива байтов старые данные форматируются в поток независимо от того, содержит ли существующий файл или массив байтов объект многослойного хранилища. Этот флаг можно использовать только при создании корневого объекта хранилища. Его нельзя использовать в объекте хранилища; Например, в [**IStorage:: креатестреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstream). Также нельзя использовать этот флаг и одновременно флаг **стгм \_ делетеонрелеасе** .


</dt> </dl> </dd> <dt>

<span id="STGM_FAILIFTHERE"></span><span id="stgm_failifthere"></span>**СТГМ \_ фаилифсере**
</dt> <dd> <dl> <dt>

0x00000000
</dt> <dt>



Приводит к сбою операции Create, если существующий объект с указанным именем существует. В этом случае возвращается **STG \_ E \_ филеалреадексистс** . Это режим создания по умолчанию. то есть если ни один другой флаг CREATE не указан, подразумевается **стгм \_ фаилифсере** .


</dt> </dl> </dd> <dt>

<span id="STGM_DIRECT"></span><span id="stgm_direct"></span>**СТГМ \_ Direct**
</dt> <dd> <dl> <dt>

0x00000000
</dt> <dt>



Указывает, что в режиме Direct каждое изменение в элементе хранения или потока записывается, как это происходит. Это значение по умолчанию, если не указаны ни **стгм \_ Direct** , ни **стгм \_** .


</dt> </dl> </dd> <dt>

<span id="STGM_TRANSACTED"></span><span id="stgm_transacted"></span>**СТГМ \_ транзакционная**
</dt> <dd> <dl> <dt>

0x00010000L
</dt> <dt>



Указывает, что в режиме транзакций изменения буферизуются и записываются только при вызове явной операции фиксации. Чтобы игнорировать изменения, вызовите метод [**revert**](/windows/desktop/api/Objidl/nf-objidl-istream-revert) в интерфейсе [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream), [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)или [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) . Реализация составного файла COM класса **IStorage** не поддерживает транзакционные потоки. Это означает, что потоки можно открывать только в режиме Direct, и вы не можете отменить изменения для них, однако поддерживаются Транзакционные хранилища. Реализации [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) составного файла, автономной и файловой системы NTFS также не поддерживают транзакционные, простые наборы свойств, поскольку эти наборы свойств хранятся в потоках. Однако поддерживаются действия непростых наборов свойств, которые можно создать, указав **\_ непростой флаг пропсетфлаг** в параметре *грффлагс* параметра [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).


</dt> </dl> </dd> <dt>

<span id="STGM_NOSCRATCH"></span><span id="stgm_noscratch"></span>**СТГМ \_**
</dt> <dd> <dl> <dt>

0x00100000L
</dt> <dt>



Указывает, что в режиме транзакций временный файл рабочей области обычно используется для сохранения изменений до вызова метода **commit** . Указание **СТГМ \_ "без нуля** " позволяет использовать неиспользуемую часть исходного файла в качестве рабочего пространства вместо создания нового файла для этой цели. Это не влияет на данные в исходном файле, и в некоторых случаях это может привести к повышению производительности. Нельзя указывать этот флаг без указания **стгм в \_ транзакционном** режиме, и этот флаг можно использовать только в корневом открытом режиме. Дополнительные сведения о режиме "Вспомогательная" см. в разделе "Примечания".


</dt> </dl> </dd> <dt>

<span id="STGM_NOSNAPSHOT"></span><span id="stgm_nosnapshot"></span>**\_моментальный снимок стгм**
</dt> <dd> <dl> <dt>

0x00200000L
</dt> <dt>



Этот флаг используется при открытии объекта хранилища с **СТГМ \_ транзакционной** и без **стгм \_ \_ монопольного доступа** или **стгм \_ общий доступ \_ \_ для записи**. В этом случае при указании параметра **СТГМ \_ snapshot** реализация, предоставляемая системой, не создает копию файла моментального снимка. Вместо этого изменения в файле записываются в конец файла. Неиспользуемое пространство не освобождается, если только не выполняется консолидация во время фиксации, а в файле имеется только один текущий модуль записи. Когда файл открывается в режиме без моментального снимка, невозможно выполнить другую операцию, не указывая параметр **СТГМ \_ snapshot**. Этот флаг может использоваться только в корневой операции открытия. Дополнительные сведения о режиме snapshot см. в разделе "Примечания".


</dt> </dl> </dd> <dt>

<span id="STGM_SIMPLE"></span><span id="stgm_simple"></span>**СТГМ \_ Simple**
</dt> <dd> <dl> <dt>

0x08000000L
</dt> <dt>



Обеспечивает более быструю реализацию составного файла в ограниченном, но часто используемом случае. Дополнительные сведения см. в разделе "Замечания".


</dt> </dl> </dd> <dt>

<span id="STGM_DIRECT_SWMR"></span><span id="stgm_direct_swmr"></span>**СТГМ \_ Direct \_ свмр**
</dt> <dd> <dl> <dt>

0x00400000L
</dt> <dt>



Поддерживает прямой режим для операций с файлами с одним модулем записи и чтения. Дополнительные сведения см. в разделе "Замечания".


</dt> </dl> </dd> <dt>

<span id="STGM_DELETEONRELEASE"></span><span id="stgm_deleteonrelease"></span>**СТГМ \_ делетеонрелеасе**
</dt> <dd> <dl> <dt>

0x04000000L
</dt> <dt>



Указывает, что базовый файл должен быть автоматически уничтожен при освобождении объекта корневого хранилища. Эта функция наиболее полезна для создания временных файлов. Этот флаг можно использовать только при создании корневого объекта, например с помощью [**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex). Это недопустимо при открытии корневого объекта, например с [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex), или при создании или открытии подэлемента, например при использовании [**IStorage:: креатестреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstream). Также недопустимо использовать этот флаг и \_ флаг стгм Convert одновременно.


</dt> </dl> </dd> </dl>

## <a name="remarks"></a>Комментарии

Эти флаги можно объединить, но можно выбрать только один флаг из каждой группы связанных флагов. Обычно один флаг из каждой группы доступа и общего доступа должен быть указан для всех функций и методов, использующих эти константы. Флаги из других групп являются необязательными.

### <a name="transacted-mode"></a>Режим транзакций

Если указан флаг **стгм \_ Direct**, в группах доступа и совместного доступа можно указать только одно из следующих сочетаний флагов.

``` syntax
    STGM_READ      | STGM_SHARE_DENY_WRITE
```

``` syntax
    STGM_READWRITE | STGM_SHARE_EXCLUSIVE
```

``` syntax
    STGM_READ      | STGM_PRIORITY
```

Имейте в виду, что режим Direct подразумевает отсутствие **\_ транзакции стгм**. То есть если не указаны ни **стгм \_ Direct** , ни стгм, то предполагается, что используется значение **стгм \_ Direct** . **\_**

При указании флага **\_ транзакций стгм** объекты создаются или открываются в режиме транзакций. В этом режиме изменения объекта не сохраняются до тех пор, пока они не будут зафиксированы. Например, изменения в объекте хранилища транзакций не сохраняются до тех пор, пока не будет вызван метод [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit) . Изменения такого объекта хранилища будут потеряны, если объект хранилища освобожден (окончательный выпуск) перед вызовом метода **commit** или если вызывается метод [**IStorage:: revert**](/windows/desktop/api/Objidl/nf-objidl-istorage-revert) .

При создании или открытии объекта в режиме транзакций реализация должна хранить как исходные данные, так и обновления этих данных, чтобы при необходимости можно было отменить изменения. Обычно это выполняется путем записи изменений во вспомогательную область до их фиксации или создания копии, называемой моментальным снимком, из последних зафиксированных данных.

При открытии объекта корневого хранилища в режиме транзакций расположение и поведение вспомогательных данных и копий моментальных снимков можно контролировать для оптимизации производительности с помощью флагов **стгм \_** и **стгм \_ snapshot** . (Объект корневого хранилища получен из, например функции [**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex) ; объект хранилища, полученный из метода [**IStorage:: опенстораже**](/windows/desktop/api/Objidl/nf-objidl-istorage-openstorage) , является объектом подхранилища.) Как правило, данные и моментальные снимки хранятся во временных файлах, отделенных от хранилища.

Воздействие этих флагов зависит от числа читателей и/или модулей записи, обращающихся к корневому хранилищу.

В случае с однозаписывающим режимом объект хранилища в режиме транзакций открывается для доступа на запись и не может быть другим доступом к файлу. Это значит, что файл открыт с использованием **СТГМ \_ транзакций**, доступа **стгм \_ Write** или **стгм \_ ReadWrite** и совместного использования **стгм \_ общего ресурса \_**. В этом случае изменения объекта хранилища записываются во вспомогательную область. Когда эти изменения фиксируются, они копируются в исходное хранилище. Таким образом, если в объект хранилища фактически не вносятся никакие изменения, ненужная перенаправление данных не выполняется.

В случае с несколькими модулями записи объект хранилища транзакций открывается для доступа на запись, но используется совместно в таких асвай, как и для других модулей записи. Это значит, что объект хранилища открыт с помощью **СТГМ \_ транзакций**, доступа к **стгм \_ Write** или **стгм \_ ReadWrite** и совместного использования **стгм \_ Share \_ \_ Reread**. Если вместо этого используется совместное использование **стгм \_ Share \_ Deny \_ None** , то используется вариант "множественный модуль записи, несколько модулей чтения". В таких случаях во время операции открытия будет создан моментальный снимок исходных данных. Таким образом, даже если в хранилище не вносятся какие-либо изменения и (или) они не открываются одновременно с другим модулем записи, при открытии все еще необходимо передавать данные. В результате можно получить лучшую производительность с открытым временем, открыв объект хранилища в **стгм \_ Share \_ запретить \_ запись** или **стгм \_ Общий \_ монопольный** режим. Дополнительные сведения о том, как изменения фиксируются при наличии нескольких модулей записи, см. в разделе [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit).

В варианте "один модуль записи, несколько читающих" объект хранилища транзакций открывается для доступа на запись, но совместно используется читателями. Это значит, что объект хранилища открывается модулем записи с **СТГМ \_ транзакционной**, доступом к **стгм \_ ReadWrite** или **стгм \_ Write**, а также совместное использование **стгм \_ Share \_ Deny \_ Write**. Хранилище открывается модулями чтения с **СТГМ \_ транзакций**, доступом **стгм \_ Read** и совместной работы **стгм \_ Share \_ Deny \_ None**. В этом случае модуль записи использует вспомогательную область для хранения незафиксированных изменений. Как и в приведенных выше случаях, средство чтения приводит к снижению производительности при создании копии моментального снимка данных.

Обычно вспомогательная область является временным файлом, отделенным от исходных данных. При фиксации изменений в исходном файле данные должны быть переданы из временного файла. Чтобы избежать этой пересылки данных, **можно \_ указать флаг стгм**. Если этот флаг указан, для вспомогательной области используются части файлового файла хранилища, а не отдельный временный файл. В результате фиксация изменений может выполняться быстро, так как требуется небольшое перемещение данных. Недостаток заключается в том, что размер файла хранилища может быть больше, чем в противном случае, поскольку он должен быть достаточно большим для исходных данных и вспомогательной области. Чтобы консолидировать данные и удалить ненужную область, повторно откройте корневое хранилище в режиме транзакций, но без установки флага **стгм. \_** Затем вызовите метод [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit) с установленным флагом **\_ консолидации стгк** .

Область моментального снимка, как и вспомогательная область, также обычно является временным файлом, и это тоже может повлиять на флаг СТГМ. При указании флага Стгм не создается отдельный временный файл моментального снимка. **\_** Вместо этого исходные данные никогда не изменяются, даже если имеется один или несколько модулей записи для каждого объекта. После фиксации изменений они добавляются в файл, но исходные данные остаются без изменений. Этот режим повышает эффективность, поскольку сокращает время выполнения, устраняя необходимость создания моментального снимка во время операции открытия. Однако использование этого режима может привести к созданию очень большого файла хранилища, поскольку данные в файле никогда не могут быть перезаписаны. Это ограничение не ограничивает размер файлов, открытых в режиме "без моментальных снимков".

### <a name="direct-single-writer-multiple-reader-mode"></a>Прямой однозаписывающий, Multiple-Readerный режим

Как уже говорилось, возможно наличие одного модуля записи и нескольких модулей чтения объекта хранилища, если этот объект открыт в режиме транзакций. Кроме того, можно выполнить одномодульный режим с одним модулем чтения в прямом режиме, указав флаг **стгм \_ Direct \_ свмр** .

В режиме **стгм \_ Direct \_ свмр** один вызывающий элемент может открыть объект для доступа на чтение и запись, тогда как другие вызывающие объекты одновременно открывают файл для доступа только для чтения. Использование этого флага в сочетании с флагом **\_ транзакций стгм** не допускается. В этом режиме модуль записи открывает объект со следующими флагами:

**Стгм \_ Direct \_ свмр** \| **стгм \_ ReadWrite** \| **стгм \_ Share \_ дениврите**

Каждый из читателей открывает объект со следующими флагами:

**Стгм \_ Direct \_ свмр** \| **стгм \_ Read** \| **стгм \_ Share \_ Deny \_ None**

В этом режиме для изменения объекта хранилища модуль записи должен получить монопольный доступ к объекту. Это возможно, когда все читатели закрыли его. Для получения этого эксклюзивного доступа модуль записи использует интерфейс [**идиректвритерлокк**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) .

### <a name="simple-mode"></a>Простой режим

Простой режим (**стгм \_ Simple**) удобен для приложений, выполняющих полную операцию сохранения. Он эффективен, но имеет следующие ограничения.

-   Для подхранилищ не существует поддержки.
-   Объект хранилища и полученные из него объекты потока не могут быть упакованы.
-   Каждый поток имеет минимальный размер. Если при освобождении потока в поток записывается меньшее количество байтов, размер потока увеличивается до минимального. Например, минимальный размер для конкретной реализации [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) — 4 КБ. Создается поток, и в него записывается 1 КБ. В окончательном выпуске этого **IStream** размер потока будет автоматически расширен до 4 КБ. Затем, открыв поток и вызвав метод [**IStream:: stat**](/windows/desktop/api/Objidl/nf-objidl-istream-stat) , вы увидите размер 4 КБ.
-   Реализация не поддерживает все методы [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) и [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) . Дополнительные сведения см. в статьях [реализация составного файла IStorage](istorage-compound-file-implementation.md)и [реализация составного файла IStream](istream-compound-file-implementation.md).

[Маршалирование](/windows/desktop/Midl/marshaling-ole-data-types) — это процесс упаковки, распаковки и отправки параметров метода интерфейса через границы потока или процесса в рамках удаленного вызова процедур (RPC). Дополнительные сведения см. в разделе [сведения о маршалировании](../com/marshaling-details.md) и [маршалирование интерфейса](../com/interface-marshaling.md).

Когда объект хранилища получается операцией Create в простом режиме:

-   Элементы потока можно создавать, но нельзя открывать.
-   При создании элемента потока путем вызова метода [**IStorage:: креатестреам**](/windows/desktop/api/Objidl/nf-objidl-istorage-createstream)невозможно создать другой поток, пока не будет освобожден объект потока.
-   После записи всех потоков вызовите метод [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit) , чтобы сбросить изменения.

Когда объект хранилища получается операцией открытия в простом режиме:

-   В каждый момент времени можно открыть только один элемент потока.
-   Изменить размер потока путем вызова метода [**IStream:: SetSize**](/windows/desktop/api/Objidl/nf-objidl-istream-setsize) или путем поиска или записи после конца потока невозможно. Однако, поскольку все потоки имеют минимальный размер, можно использовать поток вплоть до такого размера, даже если в него были записаны меньше данных. Чтобы определить размер потока, используйте метод [**IStream:: stat**](/windows/desktop/api/Objidl/nf-objidl-istream-stat) .

Имейте в виду, что если элемент хранения изменяется объектом хранилища, который не находится в простом режиме, невозможно снова открыть этот элемент хранилища в простом режиме.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional \[только классические приложения\]<br/>                           |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                 |
| Заголовок<br/>                   | <dl> <dt>Обжбасе. h</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**ISequentialStream:: Read**](/windows/desktop/api/Objidl/nf-objidl-isequentialstream-read)
</dt> <dt>

[**Метод IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)
</dt> <dt>

[**стгкреатедокфиле**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfile)
</dt> <dt>

[**стгкреатедокфилеонилоккбитес**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatedocfileonilockbytes)
</dt> <dt>

[**стгкреатесторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgcreatestorageex)
</dt> <dt>

[**стгопенстораже**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorage)
</dt> <dt>

[**стгопенсторажеекс**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageex)
</dt> <dt>

[**стгопенсторажеонилоккбитес**](/windows/desktop/api/coml2api/nf-coml2api-stgopenstorageonilockbytes)
</dt> </dl>

 

