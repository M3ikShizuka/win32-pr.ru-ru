---
title: Различия между реализацией изолированного и составного файла
description: Изолированная реализация интерфейсов набора свойств и реализации составного файла в некоторых случаях различаются.
ms.assetid: 650d4759-a58a-47a4-922d-5757e356cf56
keywords:
- Ипропертистораже Стрктд STG, реализации
- Ипропертистораже Стрктд STG, реализации, различия
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cc30141d654665555fb8c98586365f213f0c1d3ac991ab838e23fe7b9c093240
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117962299"
---
# <a name="differences-between-stand-alone-and-compound-file-implementations"></a>Различия между реализацией изолированного и составного файла

Изолированная реализация интерфейсов набора свойств и реализации составного файла в некоторых случаях различаются. В реализации составных файлов в потоке, хранилище, хранилище наборов свойств и объектах хранилища свойств различные интерфейсы координируются друг с другом, так как они совместно используют общую реализацию. В изолированной реализации реализации интерфейса отличаются.

В результате реализация составного файла обрабатывает проблемы параллелизма и синхронизирует объект набора свойств с объектом хранилища или потока. В изолированной реализации клиент отвечает за обработку проблем параллелизма и синхронизации между объектом хранилища или потока и набором свойств. Клиент может удовлетворить эти требования, выполнив два простых правила. Во-первых, никогда не следует манипулировать набором свойств с помощью потока или интерфейсов хранилища, пока на нем открыт объект хранилища свойств. Во-вторых, всегда вызывайте **commit** для объекта хранилища свойств перед вызовом **CopyTo**, **мовилементто** или **commit** в объекте хранилища предка. В частности, для следующих элементов требуется вмешательство клиента:

-   В реализации составных файлов один механизм обеспечивает защиту параллелизма для объекта хранилища и связанных с ним объектов свойств. Однако в изолированной реализации реализация объекта хранилища отделена от реализации набора свойств, и каждый из них предоставляет собственные механизмы параллелизма. Таким способом, в изолированной реализации клиент отвечает за поддержку защиты параллелизма между двумя реализациями посредством механизма взаимного исключения.
-   В реализации составного файла изменения в наборах свойств буферизуются в кэше, заданном свойством. Затем, когда метод [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit) вызывается для объекта хранилища, реализация составных файлов автоматически сбрасывает изменения набора свойств из буфера набора свойств до фиксации объекта хранилища. Таким образом, изменения, внесенные в набор свойств, становятся видимыми в процессе фиксации транзакции.

    В изолированной реализации клиент должен явным образом очистить буфер набора свойств, вызвав [**ипропертистораже:: Commit**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-commit) перед вызовом метода [**IStorage:: Commit**](/windows/desktop/api/Objidl/nf-objidl-istorage-commit) в хранилище. Кроме того, клиент может использовать новое ПРОПСЕТФЛАГ \_ значение без буферизации в изолированной реализации для записи непосредственно в набор свойств вместо кэширования изменений во внутреннем буфере набора свойств. Если используется ПРОПСЕТФЛАГ без \_ буферизации, обязанности клиента выполняются автоматически. Реализация составного файла не поддерживает значение ПРОПСЕТФЛАГ без \_ буферизации. Дополнительные сведения см. в разделе [**константы пропсетфлаг**](propsetflag-constants.md).

-   Как и в случае с транзакционными хранилищами, реализация составного файла обновляет набор свойств путем очистки его внутреннего буфера перед выполнением вызова метода [**IStorage:: CopyTo**](/windows/desktop/api/Objidl/nf-objidl-istorage-copyto) или [**IStorage:: мовилементто**](/windows/desktop/api/Objidl/nf-objidl-istorage-moveelementto). Поэтому изменения в наборе свойств отражаются в скопированном или перемещенном элементе Storage.

    В изолированной реализации клиент должен явным образом очистить буфер набора свойств путем вызова [**ипропертистораже:: Commit**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-commit) перед вызовом [**IStorage:: CopyTo**](/windows/desktop/api/Objidl/nf-objidl-istorage-copyto) или [**IStorage:: мовилементто**](/windows/desktop/api/Objidl/nf-objidl-istorage-moveelementto). Кроме того, клиент может использовать новое ПРОПСЕТФЛАГ \_ значение без буферизации для записи непосредственно в набор свойств вместо кэширования изменений в буфере набора свойств. Дополнительные сведения см. в разделе [**константы пропсетфлаг**](propsetflag-constants.md).

 

 




