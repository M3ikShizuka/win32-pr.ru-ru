---
title: Сериализация набора свойств
description: Существует две версии формата сериализации набора свойств.
ms.assetid: 10544118-5e80-47e2-b75b-c1a43be15b2e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9412fd2a83ab7c71b97888d4ae7911a96fdc4cfe5a9ebbceb5d985b3a5e2b418
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118886479"
---
# <a name="property-set-serialization"></a>Сериализация набора свойств

Существует две версии формата сериализации набора свойств. Исходная спецификация описывает версию 0 формата. Дополнительные сведения см. в разделе [Формат версии](format-version.md) . Версия 1 расширяет исходную версию. Все наборы свойств версии 0 допустимы как наборы свойств версии 1. В поле **версия формата** в заголовке сериализованного набора свойств указывается версия.

Следующие элементы указывают различия между свойствами версий 0 и 1, заданных в форматах сериализации.

-   Поддержка новых значений **VarType** . Дополнительные сведения о значениях **VarType** и способах их использования см. в разделе [типы данных и структуры IDispatch]( /previous-versions/ms221600(v=vs.100)) и структура [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .

    Следующие значения **VarType** не поддерживаются в наборах свойств версии 0, но поддерживаются в версии 1:

    VT_I1

    VT_VECTOR \| VT_I1

    VT_INT

    VT_UINT

    VT_DECIMAL

    Кроме того, SafeArray можно сериализовать в наборе свойств. Наличие массива SafeArray обозначается VT_ARRAY битом вместе, с помощью операции **или** , с элементами массива в элементе **VT** структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) . Например, массив SafeArray с 4-байтовыми целыми числами со знаком имеет тип VT_ARRAY \| VT_I4.

    Следующие типы элементов допустимы для SafeArray в сериализованном наборе свойств:

    | <!--tabular list: col headers unnecessary-->  ||||
    |-------------|----------|-------------|-----------|
    | VT_I1       | VT_UI1   | VT_I2       | VT_UI2    |
    | VT_I4       | VT_UI4   | VT_INT      | VT_UINT   |
    | VT_R4       | VT_R8    | VT_CY       | VT_DATE   |
    | VT_BSTR     | VT_BOOL.  | VT_DECIMAL  | VT_ERROR  |
    | VT_VARIANT  |          |             |           |
    |             |          |             |           |

    Если указан тип данных VT_VARIANT, он указывает, что массив SafeArray содержит структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) . Типы этих элементов должны быть из предыдущего списка, за исключением того, что они не могут содержать вложенные типы VT_VARIANT.
    
    Обратите внимание, что реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) должны иметь возможность корректного восстановления, возвращая ошибку при обнаружении нового типа. Например, типы VARENUM.

-   Имена свойств с учетом регистра. Имена свойств, например указанные в методе [**ипропертистораже:: вритепропертинамес**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames) , не учитывают регистр в наборах свойств версии 0. В наборах свойств версии 1 имена свойств могут быть чувствительны к регистру в зависимости от значения нового свойства поведения.

    Свойство Behavior имеет значение [ID свойства 0x80000003](/windows/desktop/Stg/reserved-property-identifiers) с типом VT_UI4. Если задан наименьший бит этого значения, в именах наборов свойств учитывается регистр. Установите флаг PROPSETFLAG_CASE_SENSITIVE в параметре *грффлагс* метода [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , чтобы указать набор свойств с учетом регистра.

-   Длинные имена свойств. Имена свойств для наборов свойств версии 0 должны быть меньше или равными 256 символам, включая признак конца строки, для наборов свойств в кодовой странице Юникода. Если не находится на кодовой странице Юникода, они должны быть менее 256 байт. С другой стороны, наборы свойств версии 1 могут иметь имена свойств неограниченной длины, хотя они по-прежнему ограничены общим ограничением размера набора свойств 256 килобайт (КБ).

Рекомендуется, чтобы реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) по умолчанию создали и поддерживали наборы свойств версии 0. Если вызывающий объект в дальнейшем запрашивает функцию, относящуюся к формату версии 1, то только после этого должна быть обновлена версия набора свойств. Например, если записывается свойство типа VT_ARRAY или если записывается длинное имя свойства, то реализация должна обновить формат набора свойств до версии 1. Одно исключение из этой рекомендации возникает, если значение перечисления PROPSETFLAG_CASE_SENSITIVE указано в вызове метода [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create). В этом случае набор свойств должен быть создан как набор свойств версии 1.

 

 