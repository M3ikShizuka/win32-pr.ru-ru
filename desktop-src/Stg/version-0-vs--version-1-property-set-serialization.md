---
title: Сериализация набора свойств
description: Существует две версии формата сериализации набора свойств.
ms.assetid: 10544118-5e80-47e2-b75b-c1a43be15b2e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49c635728e169cdddb20437323a49a18496b3459
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104260932"
---
# <a name="property-set-serialization"></a>Сериализация набора свойств

Существует две версии формата сериализации набора свойств. Исходная спецификация описывает версию 0 формата. Дополнительные сведения см. в разделе [Формат версии](format-version.md) . Версия 1 расширяет исходную версию. Все наборы свойств версии 0 допустимы как наборы свойств версии 1. В поле **версия формата** в заголовке сериализованного набора свойств указывается версия.

Следующие элементы указывают различия между свойствами версий 0 и 1, заданных в форматах сериализации.

-   Поддержка новых значений **VarType** . Дополнительные сведения о значениях **VarType** и способах их использования см. в разделе [типы данных и структуры IDispatch]( /previous-versions/ms221600(v=vs.100)) и структура [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .

    Следующие значения **VarType** не поддерживаются в наборах свойств версии 0, но поддерживаются в версии 1:

    VT \_ I1

    VT \_ вектор \| VT \_ I1

    VT \_ int

    VT \_ uint

    VT \_ Decimal

    Кроме того, SafeArray можно сериализовать в наборе свойств. Наличие массива SafeArray указывается в \_ сочетании с массивом VT, используя операцию **or** с элементами массива в элементе **VT** структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) . Например, массив SafeArray с 4-байтовыми целыми числами со знаком имеет тип VT, \_ \| VT \_ .

    Следующие типы элементов допустимы для SafeArray в сериализованном наборе свойств:



|             |          |             |           |
|-------------|----------|-------------|-----------|
| VT \_ I1      | VT \_ UI1  | VT \_ I2      | VT \_ UI2   |
| VT \_ I4      | VT \_ UI4  | VT \_ int     | VT \_ uint  |
| VT \_ R4      | VT \_ R8   | VT \_ CY      | \_Дата VT  |
| VT \_ BSTR    | Логическое значение VT \_ | VT \_ Decimal | \_Ошибка VT |
| \_вариант VT |          |             |           |



 

Если \_ указан тип данных VT Variant, он указывает, что массив SafeArray содержит структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) . Типы этих элементов должны быть из предыдущего списка, за исключением того, что они не могут содержать вложенные \_ типы Variant VT.

Обратите внимание, что реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) должны иметь возможность корректного восстановления, возвращая ошибку при обнаружении нового типа. Например, типы VARENUM.

-   Имена свойств с учетом регистра. Имена свойств, например указанные в методе [**ипропертистораже:: вритепропертинамес**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames) , не учитывают регистр в наборах свойств версии 0. В наборах свойств версии 1 имена свойств могут быть чувствительны к регистру в зависимости от значения нового свойства поведения.

    Свойство Behavior имеет значение [ID свойства 0x80000003](/windows/desktop/Stg/reserved-property-identifiers) с типом VT \_ UI4. Если задан наименьший бит этого значения, в именах наборов свойств учитывается регистр. Установите \_ \_ флаг с учетом регистра пропсетфлаг в параметре *грффлагс* метода [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , чтобы указать набор свойств с учетом регистра.

-   Длинные имена свойств. Имена свойств для наборов свойств версии 0 должны быть меньше или равными 256 символам, включая признак конца строки, для наборов свойств в кодовой странице Юникода. Если не находится на кодовой странице Юникода, они должны быть менее 256 байт. С другой стороны, наборы свойств версии 1 могут иметь имена свойств неограниченной длины, хотя они по-прежнему ограничены общим ограничением размера набора свойств 256 килобайт (КБ).

Рекомендуется, чтобы реализации [**ипропертистораже**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) по умолчанию создали и поддерживали наборы свойств версии 0. Если вызывающий объект в дальнейшем запрашивает функцию, относящуюся к формату версии 1, то только после этого должна быть обновлена версия набора свойств. Например, если \_ записывается свойство типа массива VT или записывается длинное имя свойства, то реализация должна обновить формат набора свойств до версии 1. Одно исключение из этой рекомендации возникает, если \_ значение перечисления, чувствительное к регистру пропсетфлаг, \_ указано в вызове [**IPropertySetStorage:: Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create). В этом случае набор свойств должен быть создан как набор свойств версии 1.

 

 