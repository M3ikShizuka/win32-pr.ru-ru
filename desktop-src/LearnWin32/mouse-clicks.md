---
title: Реагирование на щелчки мыши
description: Реагирование на щелчки мыши
ms.assetid: FED1CA3B-94C6-4780-B82D-C10171F36D98
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 947b50726e79fbf29c4f013d4ac0a449c009c1817b74b1a8063e63a68c4dd6c5
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119897214"
---
# <a name="responding-to-mouse-clicks"></a>Реагирование на щелчки мыши

Если пользователь нажимает кнопку мыши, когда курсор находится над клиентской областью окна, окно получает одно из следующих сообщений.



| Сообщение                                        | Значение                   |
|------------------------------------------------|---------------------------|
| [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown) | Левая кнопка вниз          |
| [**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup)     | Кнопка "влево"            |
| [**WM \_ мбуттондовн**](/windows/desktop/inputdev/wm-mbuttondown) | Средняя кнопка вниз        |
| [**WM \_ мбуттонуп**](/windows/desktop/inputdev/wm-mbuttonup)     | Средняя кнопка вверх          |
| [**WM \_ рбуттондовн**](/windows/desktop/inputdev/wm-rbuttondown) | Правая кнопка вниз         |
| [**WM \_ рбуттонуп**](/windows/desktop/inputdev/wm-rbuttonup)     | Кнопка "вправо"           |
| [**WM \_ ксбуттондовн**](/windows/desktop/inputdev/wm-xbuttondown) | XBUTTON1 или XBUTTON2 Down |
| [**WM \_ ксбуттонуп**](/windows/desktop/inputdev/wm-xbuttonup)     | XBUTTON1 или XBUTTON2   |



 

Вспомним, что клиентская область — это часть окна, исключающая фрейм. Дополнительные сведения о клиентских областях см [. в разделе что такое окно?](what-is-a-window-.md)

### <a name="mouse-coordinates"></a>Координаты мыши

Во всех этих сообщениях параметр *lParam* содержит координаты x и y указателя мыши. Младшие 16 бит *lParam* содержат координату x, а следующие 16 бит содержат координату y. Используйте макросы [**Get \_ X \_ lParam**](/windows/desktop/api/windowsx/nf-windowsx-get_x_lparam) и [**Get \_ Y \_ lParam**](/windows/desktop/api/windowsx/nf-windowsx-get_y_lparam) для распаковки координат из *lParam*.


```C++
int xPos = GET_X_LPARAM(lParam); 
int yPos = GET_Y_LPARAM(lParam);
```



Эти макросы определены в файле заголовка Виндовскс. h.

в 64-разрядном Windows параметр *lParam* имеет значение 64-bit. Верхние 32 бит *lParam* не используются. В документации MSDN упоминается "слово с низким приоритетом" и "слово" с высоким приоритетом *".* В 64-разрядном случае это означает младшее и высокое количество слов с более низкими 32 битами. Эти макросы извлекают правильные значения, поэтому при их использовании вы будете уверены в безопасности.

Координаты мыши задаются в пикселях, а не в аппаратно-независимых пикселях (DIP) и измеряются относительно клиентской области окна. Координаты являются значениями со знаком. Позиции выше и слева от клиентской области имеют отрицательные координаты, что важно при отслеживании положения мыши за пределами окна. Мы увидим, как это сделать в более позднем разделе, [записывая перемещение мыши за пределы окна](mouse-movement.md).

### <a name="additional-flags"></a>Дополнительные флаги

Параметр *wParam* содержит побитовое **или** для флагов, указывающих состояние других кнопок мыши, а также клавиши Shift и CTRL.



| Флаг             | Значение                          |
|------------------|----------------------------------|
| **MK, \_ элемент управления**  | Нажата клавиша CTRL.            |
| **MK \_ лбуттон**  | Левая кнопка мыши не работает.   |
| **MK \_ мбуттон**  | Средняя кнопка мыши не работает. |
| **MK \_ рбуттон**  | Нажата правая кнопка мыши.  |
| **MK \_ SHIFT**    | Нажата клавиша SHIFT.           |
| **MK \_ XBUTTON1** | Кнопка XBUTTON1 не работает.     |
| **MK \_ XBUTTON2** | Кнопка XBUTTON2 не работает.     |



 

Отсутствие флага означает, что соответствующая кнопка или клавиша не была нажата. Например, чтобы проверить, не нажата ли клавиша CTRL, сделайте следующее:


```C++
if (wParam & MK_CONTROL) { ...
```



Если необходимо найти состояние других клавиш, помимо клавиш CTRL и SHIFT, используйте функцию [**жеткэйстате**](/windows/desktop/api/winuser/nf-winuser-getkeystate) , описанную в разделе [Ввод с клавиатуры](keyboard-input.md).

Сообщения окон [**WM \_ Ксбуттондовн**](/windows/desktop/inputdev/wm-xbuttondown) и [**WM \_ ксбуттонуп**](/windows/desktop/inputdev/wm-xbuttonup) применяются как к XBUTTON1, так и к XBUTTON2. Параметр *wParam* указывает, какая кнопка была нажата.


```C++
UINT button = GET_XBUTTON_WPARAM(wParam);  
if (button == XBUTTON1)
{
    // XBUTTON1 was clicked.
}
else if (button == XBUTTON2)
{
    // XBUTTON2 was clicked.
}
```



## <a name="double-clicks"></a>Двойные щелчки

По умолчанию окно не получает уведомлений о двойном щелчке. Чтобы получить двойные щелчки, установите флаг **CS \_ дблклкс** в структуре [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) при регистрации класса окна.


```C++
    WNDCLASS wc = { };
    wc.style = CS_DBLCLKS;

    /* Set other structure members. */

    RegisterClass(&wc);

```



Если установить флаг **CS \_ дблклкс** как показано, окно будет получать уведомления двойным щелчком. Двойной щелчок обозначается сообщением окна с «ДБЛКЛК» в имени. Например, двойной щелчок левой кнопкой мыши выдает следующую последовательность сообщений:

<dl>

[**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown)  
[**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup)  
[**WM \_ лбуттондблклк**](/windows/desktop/inputdev/wm-lbuttondblclk)  
[**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup)  
</dl>

По сути, второе сообщение [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown) , которое обычно создается, превращается в [**сообщение \_ лбуттондблклк WM**](/windows/desktop/inputdev/wm-lbuttondblclk) . Эквивалентные сообщения определяются для кнопок "справа", "по середине" и "КСБУТТОН".

Пока не будет получено сообщение двойного щелчка, невозможно определить, что первый щелчок мыши является началом двойного щелчка. Поэтому действие двойного щелчка должно продолжить действие, которое начинается с первого щелчка мыши. например, в оболочке Windows один щелчок выбирает папку, а двойной щелчок открывает папку.

## <a name="non-client-mouse-messages"></a>Сообщения, не являющиеся клиентскими мышью

Отдельный набор сообщений определяется для событий мыши, которые происходят в неклиентской области окна. Эти сообщения имеют имена "NC" в имени. Например, [**WM \_ нклбуттондовн**](/windows/desktop/inputdev/wm-nclbuttondown) является неклиентским эквивалентом [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown). Обычное приложение не будет перехватывать эти сообщения, так как функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) обрабатывает эти сообщения правильно. Однако они могут быть полезны для некоторых расширенных функций. Например, эти сообщения можно использовать для реализации пользовательского поведения в заголовке окна. Если вы обработаете эти сообщения, их обычно следует передавать в **дефвиндовпрок** . В противном случае приложение будет прерывать стандартные функциональные возможности, такие как перетаскивание или свертывание окна.

## <a name="next"></a>Следующая

[Перемещение мыши](mouse-movement.md)

 

 