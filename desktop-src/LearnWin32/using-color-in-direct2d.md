---
title: Использование цвета в Direct2D
description: Использование цвета в Direct2D
ms.assetid: 74b1f12c-b1de-4df1-85ba-0cf7a0009499
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bb195a4ad0bdd9ff32f1123a8a57ff2ce0aadbde
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337060"
---
# <a name="using-color-in-direct2d"></a>Использование цвета в Direct2D

Direct2D использует цветовую модель RGB, в которой цвета формируются путем объединения различных значений красного, зеленого и синего. Четвертый компонент, альфа, измеряет прозрачность пикселя. В Direct2D каждый из этих компонентов представляет собой значение с плавающей запятой с диапазоном \[ 0,0 1,0 \] . Для трех цветовых компонентов значение измеряет интенсивность цвета. Для альфа-компонента 0,0 означает абсолютно прозрачное, а 1,0 означает абсолютно непрозрачность. В следующей таблице показаны цвета, являющиеся результатом различных сочетаний интенсивности 100%.



| Красный | Зеленый | Синий | Color   |
|-----|-------|------|---------|
| 0   | 0     | 0    | Черный   |
| 1   | 0     | 0    | Красный     |
| 0   | 1     | 0    | Зеленый   |
| 0   | 0     | 1    | Синий    |
| 0   | 1     | 1    | Цвет    |
| 1   | 0     | 1    | Пурпурный |
| 1   | 1     | 0    | Желтый  |
| 1   | 1     | 1    | Белый   |



 

![изображение, показывающее цвета RGB.](images/graphics13.png)

Значения цвета в диапазоне от 0 до 1 приводят к различным оттенкам этих чистых цветов. Direct2D использует структуру [**D2D1 \_ Color \_ F**](/windows/desktop/Direct2D/d2d1-color-f) для представления цветов. Например, следующий код задает пурпурный.


```C++
    // Initialize a magenta color.

    D2D1_COLOR_F clr;
    clr.r = 1;
    clr.g = 0;
    clr.b = 1;
    clr.a = 1;  // Opaque.
```



Можно также указать цвет с помощью класса [**D2D1:: колорф**](/windows/desktop/api/d2d1helper/nl-d2d1helper-colorf) , который является производным от структуры [**D2D1 \_ Color \_ F**](/windows/desktop/Direct2D/d2d1-color-f) .


```C++
    // Equivalent to the previous example.

    D2D1::ColorF clr(1, 0, 1, 1);
```



## <a name="alpha-blending"></a>Альфа-смешение

Альфа-смешение создает полупрозрачные области, накладывая цвет переднего плана на цвет фона, используя следующую формулу.

<dl> Color = AF * CF + (1-AF) * CB  
</dl>

где *CB* — цвет фона, *CF* — цвет переднего плана, а *AF* — альфа-значение цвета переднего плана. Эта формула применяется попарно к каждому компоненту цвета. Например, предположим, что цвет переднего плана — **(r = 1,0, G = 0,4, B = 0,0)**, **альфа = 0,6**, а цвет фона — **(R = 0,0, G = 0,5, B = 1,0)**. Полученный цвет альфа-смешения:

R = (1,0 * 0,6 + 0 * 0,4) =. 6   
G = (0,4 * 0,6 + 0,5 * 0,4) =. 44  
B = (0 * 0,6 + 1,0 * 0,4) =. 40  

На следующем рисунке показан результат этой операции смешения.

![изображение, которое показывает альфа-смешение.](images/graphics15.png)

## <a name="pixel-formats"></a>Форматы пикселей

Структура [**\_ цвета \_ F D2D1**](/windows/desktop/Direct2D/d2d1-color-f) не описывает, как пиксель представлен в памяти. В большинстве случаев это не имеет значения. Direct2D обрабатывает все внутренние сведения о преобразовании данных о цвете в пиксели. Но может потребоваться знать формат пикселей, если вы работаете непосредственно с растровым изображением в памяти, или если вы объединяете Direct2D с Direct3D или GDI.

Перечисление [**\_ формата DXGI**](/windows/desktop/api/dxgiformat/ne-dxgiformat-dxgi_format) определяет список форматов пикселей. Список достаточно длинный, но только некоторые из них имеют отношение к Direct2D. (Другие используются Direct3D).



| Формат пикселей                                                                                                                           | Описание                                                                                                                                                                                                                                                       |
|----------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="DXGI_FORMAT_B8G8R8A8_UNORM"></span><span id="dxgi_format_b8g8r8a8_unorm"></span>**\_Формат DXGI \_ B8G8R8A8 \_ UNORM**<br/> | Это наиболее распространенный формат пикселей. Все компоненты пикселей (красный, зеленый, синий и альфа) являются 8-битовыми целыми числами без знака. Компоненты располагаются в *BGRA* порядке в памяти. (См. рисунок ниже.)<br/>                                          |
| <span id="DXGI_FORMAT_R8G8B8A8_UNORM"></span><span id="dxgi_format_r8g8b8a8_unorm"></span>**\_Формат DXGI \_ R8G8B8A8 \_ UNORM**<br/> | Компоненты пикселей — это 8-разрядные целые числа без знака в порядке *RGBA* . Иными словами, красные и синие компоненты меняются местами относительно **\_ формата DXGI \_ B8G8R8A8 \_ UNORM**. Этот формат поддерживается только для аппаратных устройств.<br/>                             |
| <span id="DXGI_FORMAT_A8_UNORM"></span><span id="dxgi_format_a8_unorm"></span>**\_Формат DXGI \_ a8 \_ UNORM**<br/>                   | Этот формат содержит 8-разрядный компонент Alpha без компонентов RGB. Это полезно для создания масок непрозрачности. Дополнительные сведения об использовании масок непрозрачности в Direct2D см. в разделе [Общие сведения о совместимых целевых объектах рендеринга A8](/windows/desktop/Direct2D/compatible-a8-rendertargets).<br/> |



 

На следующем рисунке показан макет BGRA пикселей.

![Диаграмма, на которой показан макет BGRA пикселей.](images/graphics14.png)

Чтобы получить формат пикселей целевого объекта прорисовки, вызовите метод [**ID2D1RenderTarget:: жетпикселформат**](/windows/desktop/api/d2d1/nf-d2d1-id2d1rendertarget-getpixelformat). Формат пикселей может не соответствовать разрешению экрана. Например, для отображения можно задать 16-разрядный цвет, даже если для целевого объекта прорисовки используется 32-разрядный цвет.

### <a name="alpha-mode"></a>Альфа-режим

Цель рендеринга также имеет альфа-режим, который определяет, как обрабатываются альфа-значения.



| Альфа-режим                           | Описание                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **\_Пропуск режима альфа-канала D2D1 \_ \_**        | Альфа-смешение не выполняется. Альфа-значения игнорируются.                                                                                                                                                                                                                                                                          |
| **\_Прямой режим альфа-канала D2D1 \_ \_**      | Прямая альфа-версия. Цветовые компоненты пикселя представляют цветовую палитру до альфа-смешения.                                                                                                                                                                                                                           |
| **Предварительное \_ \_ умножение режима альфа-канала D2D1 \_** | Предварительно умноженное альфа-канал. Цветовые компоненты пикселя представляют интенсивность цвета, умноженную на альфа-значение. Этот формат более эффективен для отрисовки, чем прямой альфа-канал, так как термин (AF CF) в формуле Alpha — смешение предварительно вычислен. Однако этот формат не подходит для хранения в файле изображения. |



 

Ниже приведен пример разницы между прямым альфа-каналом и предварительно умноженным альфа-каналом. Предположим, что желаемый цвет имеет чистый красный (интенсивность 100%) с 50% альфа. В качестве типа Direct2D этот цвет будет представлен как (1, 0, 0, 0,5). С помощью прямого альфа-канала и при условии, что компоненты с 8 битами цвета, красный компонент пикселя имеет значение 0xFF. При использовании предварительно умноженного альфа-канала красный компонент масштабируется на 50% в равную 0x80.

Тип данных [**D2D1 \_ Color \_ F**](/windows/desktop/Direct2D/d2d1-color-f) всегда представляет цвета, используя прямую альфа-канал. При необходимости Direct2D преобразует пиксели в предварительно умноженный формат альфа-канала.

Если вы уверены, что программа не будет выполнять альфа-смешение, создайте целевой объект отрисовки в **\_ режиме альфа- \_ канала \_ D2D1** без альфа-режима. Этот режим может повысить производительность, так как Direct2D может пропустить альфа-вычисления. Дополнительные сведения см. [в статье повышение производительности приложений Direct2D](/windows/desktop/Direct2D/improving-direct2d-performance).

## <a name="next"></a>Следующая

[Применение преобразований в Direct2D](applying-transforms-in-direct2d.md)

 

