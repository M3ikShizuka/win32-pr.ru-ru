---
title: 'Приложение: операции с матрицами'
description: В этом разделе представлен математический Обзор преобразований матрицы для двухмерной графики.
ms.assetid: 8cc01f45-dd84-4f3e-a5f2-26edc5cbdfa1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 12d02976446824bba07829173bb326338a55732b39c640c93319630a209096b7
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118389334"
---
# <a name="appendix-matrix-transforms"></a>Приложение. преобразования матрицы

В этом разделе представлен математический Обзор преобразований матрицы для двухмерной графики. Однако для использования преобразований в Direct2D вам не нужно знать математические вычисления. Прочтите этот раздел, если вы заинтересованы в математических вычислениях. в противном случае вы можете пропустить этот раздел.

-   [Общие сведения о матрицах](#introduction-to-matrices)
    -   [Операции с матрицей](#matrix-operations)
-   [Аффинных преобразований](#affine-transforms)
    -   [Преобразование перевода](#translation-transform)
    -   [Преобразование масштабирования](#scaling-transform)
    -   [Поворот вокруг источника](#rotation-around-the-origin)
    -   [Поворот вокруг произвольной точки](#rotation-around-an-arbitrary-point)
    -   [Преобразование отклонений](#skew-transform)
-   [Представление преобразований в Direct2D](#representing-transforms-in-direct2d)
-   [Вперед](#next)

## <a name="introduction-to-matrices"></a>Общие сведения о матрицах

Матрица представляет собой прямоугольный массив вещественных чисел. *Порядок* матрицы — это количество строк и столбцов. Например, если матрица содержит 3 строки и 2 столбца, то порядком будет 3 × 2. Матрицы обычно отображаются с элементами матрицы, заключенными в квадратные скобки:

![3 x 2 матрица.](images/matrix01.png)

Нотация: матрица обозначена заглавной буквой. Элементы обозначены строчными буквами. Индексы указывают номер строки и столбца элемента. Например,*ИЖ* — это элемент в столбце и'с Row и ж'с матрицы a.

На следующей диаграмме показана матрица i × j с отдельными элементами в каждой ячейке матрицы.

![Матрица с столбцами i строками и j.](images/matrix15.png)

### <a name="matrix-operations"></a>Операции с матрицей

В этом разделе описываются основные операции, определенные для матриц.

*Добавление*. Сумма A + B двух матриц получена путем добавления соответствующих элементов A и B:

<dl> А + b = \[ a *ИЖ* \]  +  \[ B *ИЖ* \]  =  \[ *ИЖ* + b *ИЖ*\]
</dl>

*Скалярное умножение*. Эта операция умножает матрицу на вещественное число. Учитывая вещественное число *,* скалярный продукт «ка» получается путем умножения каждого элемента a на *k*.

<dl> ка = k \[ *ИЖ* \]  =  \[ k × a *ИЖ*\]
</dl>

*Умножение матрицы*. Учитывая две матрицы A и B с Order (m × n) и (n × p), продукт C = A × B является матрицей с заказом (m × p), который определяется следующим образом:

![Показывает формулу для умножения матрицы.](images/matrix02.png)

или эквивалентно:

<dl> c *ИЖ* = a *1 x* B1 *j* + a *i* 2 x B2 *j* +... + a *в* + b *NJ*  
</dl>

То есть, чтобы вычислить каждый элемент c *ИЖ*, выполните следующие действия.

1.  Возьмите строку и'с столбца A и ж'с в B.
2.  Перемножьте каждую пару элементов в строке и столбце: первая запись строки по первому столбцу, вторая запись строки со второй записью столбца и т. д.
3.  Суммировать результат.

Ниже приведен пример умножения матрицы (2 × 2) на матрицу (2 × 3).

![умножение матрицы.](images/matrix03.png)

Умножение матриц не коммутативной. То есть × B ≠ B × A. Кроме того, из определения следует, что не все пары матриц можно умножить. Число столбцов в левой матрице должно равняться числу строк в правой матрице. В противном случае оператор × не определен.

*Обозначить матрицу*. Матрица идентификации, обозначенная I, представляет собой квадратную матрицу, определенную следующим образом:

<dl> I *ИЖ* = 1, если *i*  =  *j*, или 0 в противном случае.  
</dl>

Иными словами, матрица идентификаторов содержит 1 для каждого элемента, где номер строки равен номеру столбца, и ноль для всех остальных элементов. Например, ниже показана матрица идентификации 3 × 3.

![матрица идентификаторов.](images/matrix04.png)

Следующий екуалитиес удерживается для любой матрицы M.

<dl> M x I = M  
I x M = M  
</dl>

## <a name="affine-transforms"></a>Аффинных преобразований

*Аффинное преобразование* — это математическая операция, которая сопоставляет одно пространство координат с другим. Иными словами, он сопоставляет один набор точек с другим набором точек. Аффинное преобразование имеет некоторые функции, которые делают их полезными в компьютерных графиках.

-   Аффинное преобразование сохраняет *коллинеарность*. Если три или более точек попадают в строку, они по-прежнему формируют строку после преобразования. Прямые линии остаются прямыми.
-   Композиция двух аффинных преобразований является аффинное преобразованием.

Аффинное преобразование для 2-мерная пространства имеет следующую форму.

![Показывает аффинное преобразование для 2-мерная пространства.](images/matrix05.png)

Если применить определение умножения матрицы, заданное ранее, можно увидеть, что произведение двух аффинных преобразований является еще одним аффинное преобразованием. Для преобразования двухмерной точки с помощью аффинных преобразований точка представляется как матрица размером 1 × 3.

<dl> P = \| x y 1 \|  
</dl>

Первые два элемента содержат координаты x и y точки. 1 помещается в третий элемент, чтобы сделать математическим работу правильно. Чтобы применить преобразование, умножьте эти матрицы следующим образом.

<dl> P ' = P × M  
</dl>

Это расширяется до следующего.

![аффинное преобразование.](images/matrix06.png)

where

<dl> x "= AX + CY + e  
y &quot;= BX + DY + f  
</dl>

Чтобы получить преобразованную точку, Возьмите первые два элемента матрицы P '.

<dl> p = (x &quot;, y") = (AX + CY + e, BX + DY + f)  
</dl>

> [!Note]  
> Матрица размером 1 × *n* называется *вектором строк*. Direct2D и Direct3D используют векторы строк для представления точек в двухмерном или трехмерном пространстве. Эквивалентный результат можно получить, используя вектор столбца (*n* × 1) и переполнив матрицу преобразования. В большинстве графических текстов используется форма «вектор столбцов». В этом разделе представлена форма вектора строк для обеспечения согласованности с Direct2D и Direct3D.

 

Следующие несколько разделов являются производными от базовых преобразований.

### <a name="translation-transform"></a>Преобразование перевода

Матрица преобразования перевода имеет следующую форму.

![Преобразование перевода.](images/matrix07.png)

Подключение точки *P* к этому уравнению дает следующее:

<dl> P ' = (*x*  +  *DX*, *y*  +  *dy*)
</dl>

соответствует точке (x, y), переведенной в *DX* на оси x и *dy* на оси y.

![Диаграмма, на которой показан перевод двух точек.](images/graphics22.png)

### <a name="scaling-transform"></a>Преобразование масштабирования

Матрица преобразования масштабирования имеет следующую форму.

![преобразование масштабирования.](images/matrix09.png)

Подключение точки *P* к этому уравнению дает следующее:

<dl> P ' = (*x* ∙ *DX*, *y* -∙ *dy*)
</dl>

соответствует точке (x, y), масштабированной по *DX* и *dy*.

![Диаграмма, показывающая масштабирование двух точек.](images/graphics23.png)

### <a name="rotation-around-the-origin"></a>Поворот вокруг источника

Матрица для поворота точки вокруг начала координат имеет следующую форму.

![Показывает формулу для преобразования поворота.](images/matrix11.png)

Преобразованная точка:

<dl> P ' = (*x* Косθ – исинθ, *x* синθ + *y* косθ)
</dl>

Средство. Чтобы отобразить, что P представляет поворот, рассмотрим следующую диаграмму.

![Схема, показывающая поворот вокруг источника.](images/graphics24.png)

Исходные данные:

<dl> <dt>

<span id="P____x_y_"></span><span id="p____x_y_"></span><span id="P____X_Y_"></span>P = (x, y)
</dt> <dd>

Исходная точка для преобразования.

</dd> <dt>

φ
</dt> <dd>

Угол, сформированный строкой (0, 0), до P.

</dd> <dt>

Θ
</dt> <dd>

Угол поворота (x, y) источника.

</dd> <dt>

<span id="P_____x__y__"></span><span id="p_____x__y__"></span><span id="P_____X__Y__"></span>P ' = (x ', y ')
</dt> <dd>

Преобразованная точка.

</dd> <dt>

<span id="R"></span><span id="r"></span>Cерверный
</dt> <dd>

Длина строки (0, 0) в P. Также радиус круга поворота.

</dd> </dl>

> [!Note]  
> Эта диаграмма использует стандартную систему координат, используемую в геометрии, где на оси y настраивается положительная ось. Direct2D использует Windowsную систему координат, в которой положительные точки оси y выключаются.

 

Угол между осью x и линией (0, 0) по P ' — Φ + Θ. Следующие удостоверения содержат:

<dl> x = R Косφ  
y = Синφ R  
x "= R cos (Φ + Θ)  
y "= R Sin (Φ + Θ)  
</dl>

Теперь разрешите для x "и y" с точки зрения Θ. По формулам сложения:

<dl> x "= R (Косφкосθ – Синφсинθ) = Ркосφкосθ — Рсинφсинθ  
y "= R (Синφкосθ + Косφсинθ) = Рсинφкосθ + Ркосφсинθ  
</dl>

Подставив, мы получаем:

<dl> x "= Кскосθ — Исинθ  
y "= Кссинθ + Икосθ  
</dl>

соответствует преобразованной точке P, показанной ранее.

### <a name="rotation-around-an-arbitrary-point"></a>Поворот вокруг произвольной точки

Для поворота вокруг точки (x, y), отличной от исходной, используется следующая матрица.

![преобразование поворота.](images/matrix13.png)

Эту матрицу можно получить, отменив точку (x, y) на начало.

![Диаграмма, показывающая поворот вокруг точки.](images/graphics25.png)

Let (x1, y1) является точкой, полученной в результате поворота точки (x0, y0) вокруг точки (x, y). Можно наследовать x1 следующим образом.

<dl> x1 = (x0 – x) Косθ – (Y0 – y) Синθ + x  
x1 = x0cosΘ – y0sinΘ + \[ (1 – косθ) + исинθ \]  
</dl>

Теперь подсоедините это уравнение к матрице преобразования, используя формулу x1 = ax0 + CY0 + e из предыдущих версий. Используйте ту же процедуру, чтобы получить значение Y1.

### <a name="skew-transform"></a>Преобразование отклонений

Преобразование «наклон» определяется четырьмя параметрами:

-   Θ: величина наклона вдоль оси x, измеряемая как угол от оси y.
-   Φ: величина наклона вдоль оси y, измеряемая как угол от оси x.
-   (*px*, *корректировка*): координаты x и y точки, относительно которой выполняется отклонение.

Преобразование «наклон» использует следующую матрицу.

![Преобразование отклонений.](images/matrix14.png)

Преобразованная точка:

<dl> P ' = (*x*  +  *y* танθ – *Копировать* танθ, *y*  +  *x* танφ) — *Копировать* танφ
</dl>

или аналогичным образом:

<dl> P ' = (*x* + (*y* – *Копировать*) танθ, *y* + (*x* – *px*) танφ)
</dl>

Чтобы увидеть, как работает преобразование, рассмотрите каждый компонент по отдельности. Параметр Θ перемещает каждую точку в направлении x на величину, равную Танθ. На следующей диаграмме показана связь между Θ и наклоном по оси x.

![Схема, на которой показана асимметрия вдоль оси x.](images/graphics26.png)

Вот та же разница, примененная к прямоугольнику:

![Схема, показывающая асимметрию вдоль оси x при применении к прямоугольнику.](images/graphics27.png)

Параметр Φ имеет тот же результат, но вдоль оси y:

![Схема, на которой показана асимметрия вдоль оси y.](images/graphics28.png)

На следующей схеме показано отклонение по оси y, применяемое к прямоугольнику.

![Схема, показывающая асимметрию вдоль оси y при применении к прямоугольнику.](images/graphics29.png)

Наконец, параметры *px* и *корректировки* сдвигаются центральную точку наклона вдоль осей x и y.

## <a name="representing-transforms-in-direct2d"></a>Представление преобразований в Direct2D

Все преобразования Direct2D являются аффинноеи преобразованиями. Direct2D не поддерживает преобразования, не являющиеся аффинных. Преобразования представлены структурой [**\_ матрицы D2D1 Matrix \_ 3X2 \_ F**](/windows/desktop/Direct2D/d2d1-matrix-3x2-f) . Эта структура определяет матрицу размером 3 × 2. Так как третий столбец аффинных преобразований всегда один и тот же ( \[ 0, 0, 1 \] ), а Direct2D не поддерживает преобразования, не являющиеся аффинных, нет необходимости указывать всю матрицу 3 × 3. На внутреннем уровне Direct2D использует матрицы 3 × 3 для вычислений преобразований.

Элементы [**\_ матрицы D2D1 \_ 3X2 \_ F**](/windows/desktop/Direct2D/d2d1-matrix-3x2-f) именуются в соответствии с их позицией индекса: **\_ 11** элемент — это Element (1, 1), **\_ 12** элементов — элемент (1, 2) и т. д. Хотя члены структуры можно инициализировать напрямую, рекомендуется использовать класс [**D2D1:: Matrix3x2F**](/windows/desktop/api/d2d1helper/nl-d2d1helper-matrix3x2f) . Этот класс наследует **D2D1 \_ Matrix \_ 3X2 \_ F** и предоставляет вспомогательные методы для создания любых базовых аффинных преобразований. Класс также определяет [**оператор \* ()**](/windows/desktop/api/d2d1helper/nf-d2d1helper-matrix3x2f-operator-mult) для составления двух или более преобразований, как описано в разделе [применение преобразований в Direct2D](applying-transforms-in-direct2d.md).

## <a name="next"></a>Следующая

[Модуль 4. Ввод данных пользователем](module-4--user-input.md)

 

 