---
title: Отрисовка целевых объектов, устройств и ресурсов
description: Отрисовка целевых объектов, устройств и ресурсов
ms.assetid: cf48c2ce-16ad-4e61-8900-501c7c27da23
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eeddd84e12c52e0fd0ae82dab8b5e8741a2e0891
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104337201"
---
# <a name="render-targets-devices-and-resources"></a>Отрисовка целевых объектов, устройств и ресурсов

*Цель рендеринга* — это просто расположение, в котором программа будет рисовать. Как правило, целью рендеринга является окно (в частности, клиентская область окна). Он также может быть точечным рисунком в памяти, который не отображается. Целевой объект прорисовки представлен интерфейсом [**ID2D1RenderTarget**](/windows/desktop/api/d2d1/nn-d2d1-id2d1rendertarget) .

*Устройство* — это абстракция, представляющая все фактически рисуемые Пиксели. Аппаратное устройство использует GPU для повышения производительности, в то время как программное устройство использует процессор. Приложение не создает устройство. Вместо этого устройство создается неявно, когда приложение создает целевой объект отрисовки. Каждый целевой объект прорисовки связан с конкретным устройством, оборудованием или программным обеспечением.

![Схема, показывающая отношение между целевым объектом отрисовки и устройством.](images/graphics09.png)

*Ресурс* — это объект, используемый программой для рисования. Ниже приведены некоторые примеры ресурсов, определенных в Direct2D.

-   **Кисть**. Определяет, как рисуются линии и регионы. К типам кистей относятся кисти с сплошным цветом и градиентные кисти.
-   **Стиль обводки**. Управляет внешним видом линии, например штриховой или сплошной.
-   **Геометрия**. Представляет коллекцию линий и кривых.
-   **Сетка**. Фигура, образованная из треугольников. Данные сетки могут быть использованы непосредственно графическим процессором, в отличие от данных geometry, которые необходимо преобразовать перед отрисовкой.

Целевые объекты рендеринга также считаются типами ресурсов.

Некоторые ресурсы имеют преимущество аппаратного ускорения. Ресурс этого типа всегда связан с конкретным устройством (GPU) или программным обеспечением (ЦП). Этот тип ресурса называется аппаратно *-зависимым*. Примерами ресурсов, зависящих от устройства, являются кисти и сетки. Если устройство становится недоступным, ресурс необходимо создать заново для нового устройства.

Другие ресурсы хранятся в памяти ЦП независимо от используемого устройства. Эти ресурсы не *зависят от устройства*, так как они не связаны с конкретным устройством. При изменении устройства не требуется повторно создавать ресурсы, независимые от устройства. Стили и геометрические штрихи являются независимыми от устройства ресурсами.

В документации MSDN по каждому ресурсу указывается, зависит ли ресурс от устройства или от устройства. Каждый тип ресурса представлен интерфейсом, производным от [**ID2D1Resource**](/windows/desktop/api/d2d1/nn-d2d1-id2d1resource). Например, кисти представлены интерфейсом [**ID2D1Brush**](/windows/desktop/api/d2d1/nn-d2d1-id2d1brush) .

## <a name="the-direct2d-factory-object"></a>Объект фабрики Direct2D

Первым шагом при использовании Direct2D является создание экземпляра объекта фабрики Direct2D. В компьютерных программах *фабрика* — это объект, который создает другие объекты. Фабрика Direct2D создает следующие типы объектов:

-   Целевые объекты отрисовки.
-   Независимые от устройства ресурсы, такие как стили и геометрические штрихи.

Ресурсы, зависящие от устройства, такие как кисти и точечные рисунки, создаются целевым объектом прорисовки.

![Схема, на которой показана фабрика Direct2D.](images/graphics10.png)

Чтобы создать объект фабрики Direct2D, вызовите функцию [**D2D1CreateFactory**](/windows/desktop/api/d2d1/nf-d2d1-d2d1createfactory) .


```C++
ID2D1Factory *pFactory = NULL;

HRESULT hr = D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED, &pFactory);
```



Первый параметр — это флаг, указывающий параметры создания. **\_ \_ Однопотоковый флаг \_ типа \_ фабрики D2D1** означает, что вы не будете вызывать Direct2D из нескольких потоков. Для поддержки вызовов из нескольких потоков укажите **\_ Тип фабрики D2D1 с \_ \_ несколькими \_ потоками**. Если программа использует один поток для вызова Direct2D, то однопотоковый вариант является более эффективным.

Второй параметр функции [**D2D1CreateFactory**](/windows/desktop/api/d2d1/nf-d2d1-d2d1createfactory) получает указатель на интерфейс [**ID2D1Factory**](/windows/desktop/api/d2d1/nn-d2d1-id2d1factory) .

Перед первым сообщением [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) необходимо создать объект фабрики Direct2D. Для создания фабрики лучше всего создать обработчик сообщений [**WM \_ CREATE**](/windows/desktop/winmsg/wm-create) .


```C++
    case WM_CREATE:
        if (FAILED(D2D1CreateFactory(
                D2D1_FACTORY_TYPE_SINGLE_THREADED, &pFactory)))
        {
            return -1;  // Fail CreateWindowEx.
        }
        return 0;
```



## <a name="creating-direct2d-resources"></a>Создание ресурсов Direct2D

Программа Circle использует следующие ресурсы, зависящие от устройства:

-   Целевой объект отрисовки, связанный с окном приложения.
-   Кисть с сплошным цветом для рисования окружности.

Каждый из этих ресурсов представлен интерфейсом COM:

-   Интерфейс [**ID2D1HwndRenderTarget**](/windows/desktop/api/d2d1/nn-d2d1-id2d1hwndrendertarget) представляет целевой объект отрисовки.
-   Интерфейс [**ID2D1SolidColorBrush**](/windows/desktop/api/d2d1/nn-d2d1-id2d1solidcolorbrush) представляет кисть.

Программа Circle сохраняет указатели на эти интерфейсы как переменные члена `MainWindow` класса:


```C++
ID2D1HwndRenderTarget   *pRenderTarget;
ID2D1SolidColorBrush    *pBrush;
```



Следующий код создает эти два ресурса.


```C++
HRESULT MainWindow::CreateGraphicsResources()
{
    HRESULT hr = S_OK;
    if (pRenderTarget == NULL)
    {
        RECT rc;
        GetClientRect(m_hwnd, &rc);

        D2D1_SIZE_U size = D2D1::SizeU(rc.right, rc.bottom);

        hr = pFactory->CreateHwndRenderTarget(
            D2D1::RenderTargetProperties(),
            D2D1::HwndRenderTargetProperties(m_hwnd, size),
            &pRenderTarget);

        if (SUCCEEDED(hr))
        {
            const D2D1_COLOR_F color = D2D1::ColorF(1.0f, 1.0f, 0);
            hr = pRenderTarget->CreateSolidColorBrush(color, &pBrush);

            if (SUCCEEDED(hr))
            {
                CalculateLayout();
            }
        }
    }
    return hr;
}
```



Чтобы создать целевой объект отрисовки для окна, вызовите метод [**ID2D1Factory:: креатехвндрендертаржет**](/previous-versions/windows/desktop/legacy/dd371275(v=vs.85)) в фабрике Direct2D.

-   Первый параметр задает параметры, которые являются общими для любого типа целевого объекта прорисовки. Здесь мы передаем параметры по умолчанию, вызывая вспомогательную функцию [**D2D1:: рендертаржетпропертиес**](/windows/desktop/api/d2d1helper/nf-d2d1helper-rendertargetproperties).
-   Второй параметр задает маркер окна и размер целевого объекта отрисовки в пикселях.
-   Третий параметр получает указатель [**ID2D1HwndRenderTarget**](/windows/desktop/api/d2d1/nn-d2d1-id2d1hwndrendertarget) .

Чтобы создать кисть с сплошным цветом, вызовите метод [**ID2D1RenderTarget:: креатесолидколорбруш**](/windows/win32/api/d2d1/nf-d2d1-id2d1rendertarget-createsolidcolorbrush(constd2d1_color_f__id2d1solidcolorbrush)) для целевого объекта прорисовки. Цвет задается как значение [**D2D1 \_ Color \_ F**](/windows/desktop/Direct2D/d2d1-color-f) . Дополнительные сведения о цветах в Direct2D см. в разделе [Использование цвета в Direct2D](using-color-in-direct2d.md).

Кроме того, обратите внимание, что если целевой объект прорисовки уже существует, `CreateGraphicsResources` метод возвращает значение **S \_ ОК** без выполнения каких-либо действий. Причина этого проекта станет очевидной в следующем разделе.

## <a name="next"></a>Следующая

[Рисование с использованием Direct2D](drawing-with-direct2d.md)

 

 