---
title: Федерация
description: Федерация позволяет делегирование полномочий авторизации другим участникам компании Interprise.
ms.assetid: 574496df-95dc-45f7-8c42-e646aec12e69
keywords:
- Веб-службы федерации для Windows
- ввсапи
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b9a902eb9469ad75e8c3c5a283284a009af11bb59b42470c91c39b1f16f83c61
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119703663"
---
# <a name="federation"></a>Федерация

Федерация позволяет делегирование полномочий авторизации другим участникам компании Interprise. Например, рассмотрим следующую бизнес-проблему: Компания "автоматическое производство" компании Contoso Ltd хочет предоставить полномочным сотрудникам клиента Fabrikam Inc безопасный доступ к веб-службе заказа частей contoso. Одно решение для обеспечения безопасности в этом сценарии заключается в том, чтобы компания Contoso настроила механизм доверия с компанией Fabrikam для делегирования решения об авторизации доступа в Fabrikam. Этот процесс может работать следующим образом.

-   Fabrikam, когда она станет партнером Contoso, настраивает соглашение о доверии с contoso. Цель этого шага — согласиться с типом маркера безопасности и содержимым, которое будет представлять авторизацию Fabrikam и будет приемлемым для contoso. Например, может быть принято решение о том, что доверенный сертификат X. 509 с именем субъекта "CN = Fabrikam Inc поставщика STS" должен подписать маркер SAML для этого SAML, чтобы он принимался веб-службой contoso. Кроме того, может быть принято решение о том, что утверждение безопасности в выданном токене SAML должно быть либо " https://schemas.contoso.com/claims/lookup " (для авторизации поиска части), либо " https://schemas.contoso.com/claims/order " (для авторизации с сортировкой деталей части).
-   Когда сотрудник Fabrikam использует приложение для упорядочения внутренних частей, он сначала связывается со службой маркеров безопасности (STS) в Fabrikam. этот сотрудник проходит проверку подлинности с помощью внутреннего механизма безопасности компании Fabrikam (скажем, Windows имя пользователя или пароль домена), проверяется его авторизация для частей заказа, а также выдается короткий токен SAML, содержащий соответствующие утверждения и подписанный сертификатом X. 509, который был выбран выше. Затем приложение упорядочивает компоненты и обращается к службе Contoso, которая предоставляет выданный токен SAML для проверки подлинности и выполнения задачи упорядочения.

Здесь компания Fabrikam STS выступает в качестве выдающего субъекта, а служба частей Contoso выступает в качестве проверяющей стороны. ![Схема, показывающая выдающий субъект и проверяющую сторону в Федерации.](images/stsmodel.png)

## <a name="federation-features"></a>Функции Федерации

Ниже перечислены поддерживаемые функции безопасности для сторон или ролей, участвующих в сценарии Федерации.

-   На стороне клиента: чтобы получить маркер безопасности от STS, можно использовать функцию [**всрекуестсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) . Кроме того, можно использовать библиотеку поставщика маркеров безопасности на стороне клиента, например CardSpace или LiveID, а затем использовать их выходные данные для локального создания маркера безопасности с помощью [**вскреатексмлсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken). В любом случае, когда у клиента есть маркер безопасности, он может создать канал для службы, указав [**\_ \_ \_ \_ \_ привязку безопасности сообщения токена WS XML**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding) для представления маркера, а также привязку безопасности транспорта, например [**, \_ \_ \_ \_ привязку безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) для защиты канала.
-   На стороне сервера. в сценарии Федерации со службой маркеров безопасности, которая выдает токены SAML, сервер может использовать [**\_ \_ \_ \_ привязку безопасности сообщений SAML**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding), а также привязку безопасности транспорта, например, [**\_ \_ \_ \_ привязку безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding) для защиты канала.
-   STS-Side: Обратите внимание, что STS является приложением веб-службы и может указывать требования безопасности для тех, которые запрашивают маркер безопасности из него, используя структуру [**описания безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) во время создания прослушивателя точно так же, как любая другая безопасная веб-служба. Затем он может анализировать полезные данные сообщений о входящих запросах для проверки запросов маркера и отправки выданных маркеров в виде полезных данных ответного сообщения. В настоящее время не предоставляются никакие функции, помогающие выполнить синтаксический анализ и выполнение шагов.

Обратите внимание, что клиент может обрабатывать выданный маркер безопасности в универсальном виде в виде маркера безопасности XML без знания типа токена или обработки конкретного типа токена. Однако для понимания и обработки сервер должен понимать конкретный тип маркера безопасности. В шагах запроса и ответа маркера безопасности используются конструкции, определенные в спецификации WS-Trust.

## <a name="more-complex-federation-scenarios"></a>Более сложные сценарии Федерации

Сценарий федерации может содержать несколько службы маркеров безопасности, образующих цепочку Федерации. Рассмотрим следующий пример.

-   Клиент выполняет проверку подлинности в STS LiveID с помощью имени пользователя и пароля LiveID и получает маркер безопасности T1.
-   Клиент проходит проверку подлинности в STS1 с помощью T1 и получает маркер безопасности T2.
-   Клиент проходит проверку подлинности в STS2 с помощью T2 и получает маркер безопасности T3.
-   Клиент выполняет проверку подлинности целевой службы с помощью T3.

В этом случае LiveID STS, STS1, STS2 и S формируют цепочку Федерации. Службы маркеров безопасности в цепочке Федерации может выполнять различные роли в общем сценарии приложения. Примерами таких функциональных ролей STS являются поставщик удостоверений, принимающий решения авторизации, анонимизер и Resource Manager.

## <a name="sts-request-parameters-and-metadata-exchange"></a>Параметры запроса STS и Exchange метаданных

Чтобы клиент смог выполнить успешный вызов [**всрекуестсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken) , ему необходимо получить сведения о параметрах этого вызова (например, требуемый тип токена и типы утверждений), требования к [**описанию безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) канала запроса к службе STS и [адресу конечной точки](endpoint-address.md) STS. Клиентское приложение может использовать любой из следующих методов для определения этой информации:

-   Жестко закодировать сведения в приложении как часть решений во время разработки.
-   Прочтите эти сведения из файла конфигурации уровня приложения, настроенного с помощью программы развертывания локального приложения.
-   Динамически обнаруживать эти сведения во время выполнения с помощью функции [импорта метаданных](metadata-import.md) с использованием структуры [**\_ \_ \_ \_ \_ \_ ограничения привязки безопасности сообщений токена WS**](/windows/desktop/api/WebServices/ns-webservices-ws_issued_token_message_security_binding_constraint) .

Чтобы проиллюстрировать использование динамического обмена метаданными с Федерацию, рассмотрим приведенный выше пример 3 STS. Клиент сначала выполняет динамическое обмен метаданными с S для получения сведений о T3 (т. е. о том, что нужно запросить из STS2), а также об динамическом адресе обмена STS2 (т. е. где найти STS2). Затем эти сведения будут использоваться для динамического обмена метаданными с STS2, чтобы получить сведения о T2 и STS1 и т. д.

Таким образом, операции динамического обмена метаданными выполняются в порядке 4, 3, 2, 1 для создания цепочки Федерации, а шаги запроса и представления маркера выполняются в порядке 1, 2, 3, 4 для очистки цепочки Федерации.

> [!Note]  
> Windows 7 и Windows Server 2008 R2: ввсапи поддерживает только [Ws-Trust](https://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) и [ws-SecureConversation](https://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) в соответствии с определением [упрощенного WS-Security профиля (лвссп)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e). Дополнительные сведения о реализации Майкрософт см. в разделе [синтаксис сообщения](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) в лвссп.

 

 

 