---
title: Общие сведения о безопасности
description: инфраструктура безопасности в API Windows веб-служб (ввсапи) обеспечивает целостность сообщений, конфиденциальность, обнаружение воспроизведения и проверку подлинности сервера с помощью защиты транспорта.
ms.assetid: 2681bffc-ba07-4822-b265-2bf7f95297d4
keywords:
- Обзор безопасности веб-службы для Windows
- ввсапи
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 741e98ef023c0bae146b5fde582484f2dd133df6
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127346051"
---
# <a name="security-overview"></a>Общие сведения о безопасности

платформа безопасности в API Windows веб-служб (ввсапи) предоставляет:

-   Целостность сообщений, конфиденциальность, обнаружение воспроизведения и проверка подлинности сервера с помощью защиты транспорта.
-   Проверка подлинности клиента, такая как проверка маркера безопасности, доверие сертификатов и проверка отзыва, и т. д. Использование безопасности сообщений SOAP или безопасность транспорта.

## <a name="the-security-programming-model"></a>Модель программирования безопасности

Безопасность связана с [каналами связи](channel-layer-overview.md). Защита канала состоит из следующих шагов.

-   Создание и инициализация одной или нескольких [**привязок безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_binding) , соответствующих требованиям безопасности приложения.
-   Создайте [**Описание безопасности**](/windows/desktop/api/WebServices/ns-webservices-ws_security_description) , содержащее эти привязки безопасности.
-   Создайте [**канал**](/windows/desktop/api/WebServices/nf-webservices-wscreatechannel) или [**прокси-сервер службы**](/windows/desktop/api/WebServices/nf-webservices-wscreateserviceproxy) (на стороне клиента) или создайте [**прослушиватель**](/windows/desktop/api/WebServices/nf-webservices-wscreatelistener) или [**узел службы**](/windows/desktop/api/WebServices/nf-webservices-wscreateservicehost) (на стороне сервера), передав это описание безопасности.
-   Выполните стандартные действия по программированию каналов: открытые, примите, Send, Receive, закройте и т. д.

Сообщения, отправленные и полученные по каналу, защищаются автоматически средой выполнения в соответствии с предоставленным описанием безопасности. При необходимости эти действия можно настроить, указав одну или несколько [параметров безопасности для всего канала](security-channel-settings.md) в описании безопасности или в [параметрах безопасности уровня привязки](security-binding-settings.md) в привязке безопасности.

Любая необходимая авторизация идентификаторов отправителей должна выполняться приложением с использованием [результатов обработки безопасности](security-processing-results.md) , присоединенных к каждому полученному сообщению. Шаги авторизации не указываются в описании безопасности и не выполняются автоматически средой выполнения.

Ошибки в описании безопасности, такие как Неподдерживаемые привязки, неприменимые свойства или поля, отсутствие обязательных свойств и полей, а также недопустимые значения свойств или полей, приведут к сбою создания канала или прослушивателя.

## <a name="selecting-security-bindings"></a>Выбор привязок безопасности

При проектировании безопасности приложения основным решением является выбор привязок безопасности, которые будут включаться в описание безопасности. Ниже приведены некоторые рекомендации по выбору привязок безопасности, подходящих для сценария безопасности приложения. полезный эвристический подход состоит в том, чтобы сначала понять, какие типы учетных данных безопасности (например, [**сертификаты X. 509**](/windows/desktop/api/WebServices/ns-webservices-ws_cert_credential), [**Windows имя пользователя или пароль домена**](/windows/desktop/api/WebServices/ns-webservices-ws_windows_integrated_auth_credential), [**определенные приложением имя пользователя и пароли**](/windows/desktop/api/WebServices/ns-webservices-ws_username_credential)) будут доступны приложению, а затем выбрать привязку безопасности, которая может использовать этот тип учетных данных.

-   Безопасность транспорта, где безопасность применяется на транспортном уровне потока (ниже границ сообщений SOAP), является первым вариантом, который следует учитывать.
    -   В сценариях с Интернетом и в сценариях интрасети, где на сервере можно развернуть сертификат X. 509, приложение может использовать [**\_ \_ \_ \_ привязку безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding). Этот параметр показан в следующем примере. Клиент: [хттпклиентвиссслексампле](httpclientwithsslexample.md) Server: [хттпсервервиссслексампле](httpserverwithsslexample.md).

        Если требуется проверка подлинности клиента по заголовку HTTP, для предоставления этой функции можно добавить [**\_ \_ \_ \_ \_ привязку безопасности HTTP-заголовка**](/windows/desktop/api/WebServices/ns-webservices-ws_http_header_auth_security_binding) .

    -   для сценариев в интрасети, в Windows которых подходят встроенные протоколы проверки подлинности, такие как Kerberos, NTLM и SPNEGO, приложение может использовать [**\_ \_ \_ \_ \_ привязку безопасности транспорта WS TCP SSPI**](/windows/desktop/api/WebServices/ns-webservices-ws_tcp_sspi_transport_security_binding). В следующем примере показан этот параметр: Client: [рекуестреплиткпклиентвисвиндовстранспортсекуритексампле](requestreplytcpclientwithwindowstransportsecurityexample.md) Server: [рекуестреплиткпсервервисвиндовстранспортсекуритексампле](requestreplytcpserverwithwindowstransportsecurityexample.md).

        Клиент по именованным каналам: [рекуестреплинамедпипесклиентвисвиндовстранспортсекуритексампле](requestreplynamedpipesclientwithwindowstransportsecurityexample.md)

        Сервер с именованными каналами: [рекуестреплинамедпипессервервисвиндовстранспортсекуритексампле](requestreplynamedpipesserverwithwindowstransportsecurityexample.md)

    -   в сценариях с локальным компьютером, где используются Windows встроенные протоколы проверки подлинности, такие как Kerberos, NTLM и SPNEGO, приложение может использовать привязку транспорта [**ws \_ TCP \_ sspi \_ \_ \_**](/windows/desktop/api/WebServices/ns-webservices-ws_tcp_sspi_transport_security_binding) или [**\_ \_ \_ \_ \_ привязку безопасности транспорта ws помощью канала namedpipe sspi**](/windows/desktop/api/WebServices/ns-webservices-ws_namedpipe_sspi_transport_security_binding). [**\_ \_ \_ Привязка канала WS помощью канала NamedPipe**](/windows/desktop/api/WebServices/ne-webservices-ws_channel_binding) является предпочтительной в таких сценариях, так как гарантирует, что трафик не будет выходить из компьютера (это **свойство \_ \_ \_ привязки канала WS помощью канала NamedPipe**).

-   Безопасность в смешанном режиме, где безопасность транспорта защищает подключение, а заголовок WS-Security в сообщении SOAP обеспечивает проверку подлинности клиента, — это следующий вариант, который следует учитывать. Следующие привязки используются в сочетании с одной из привязок безопасности транспорта, описанных в предыдущем разделе.
    -   Когда клиент проходит проверку подлинности с помощью пары "имя пользователя-пароль" на уровне приложения, приложение может использовать [**\_ \_ \_ \_ привязку безопасности сообщений имени пользователя WS**](/windows/desktop/api/WebServices/ns-webservices-ws_username_message_security_binding) для предоставления данных проверки подлинности. В следующих примерах показано использование этой привязки совместно с [**\_ \_ \_ \_ привязкой безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding).
        -   Клиент: [хттпклиентвисусернамеоверсслексампле](httpclientwithusernameoversslexample.md)
        -   Сервер: [хттпсервервисусернамеоверсслексампле](httpserverwithusernameoversslexample.md)
    -   При проверке подлинности клиента с помощью билета Kerberos приложение может использовать [**\_ \_ \_ \_ \_ привязку безопасности сообщений WS Kerberos апрек**](/windows/desktop/api/WebServices/ns-webservices-ws_kerberos_apreq_message_security_binding) для предоставления данных проверки подлинности.
    -   При использовании [контекста безопасности](security-context.md)клиент сначала устанавливает контекст безопасности с сервером, а затем использует этот контекст для проверки подлинности сообщений. Чтобы включить эту функцию, описание безопасности должно содержать [**\_ \_ \_ \_ \_ привязку безопасности сообщений контекста безопасности WS**](/windows/desktop/api/WebServices/ns-webservices-ws_security_context_message_security_binding). После установки контексты безопасности могут передаваться с помощью упрощенных маркеров, что позволяет избежать отправки потенциально больших и вычислительно ресурсоемких учетных данных клиента с каждым сообщением.
    -   В сценарии [федеративной безопасности](federation.md) клиент сначала получает маркер безопасности, выданный службой маркеров безопасности (STS), а затем выводит выданный маркер службе. На стороне клиента: чтобы получить маркер безопасности от STS, приложение может использовать [**всрекуестсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wsrequestsecuritytoken). Кроме того, приложение может использовать библиотеку поставщика маркеров безопасности на стороне клиента, например CardSpace или LiveID, а затем использовать их выходные данные для локального создания маркера безопасности с помощью [**вскреатексмлсекурититокен**](/windows/desktop/api/WebServices/nf-webservices-wscreatexmlsecuritytoken). В любом случае, после того, как маркер безопасности будет доступен клиенту, он может быть представлен службе с помощью описания безопасности, содержащего [**\_ \_ \_ \_ \_ привязку безопасности сообщений токена WS XML**](/windows/desktop/api/WebServices/ns-webservices-ws_xml_token_message_security_binding). На стороне сервера. Если маркер безопасности, выданный STS, является маркером SAML, то сервер может использовать описание безопасности с [**\_ \_ \_ \_ привязкой безопасности сообщений SAML WS**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding).
        > [!Note]  
        > Windows 7 и Windows Server 2008 R2: ввсапи поддерживает только [Ws-Trust](http://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf) и [ws-SecureConversation](http://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf) в соответствии с определением [упрощенного WS-Security профиля (лвссп)](/openspecs/windows_protocols/ms-lwssp/376af2f8-f4fe-4577-bfd5-370ac12cac2e). Дополнительные сведения о реализации Майкрософт см. в разделе [синтаксис сообщения](/openspecs/windows_protocols/ms-lwssp/d4f0f509-e14a-47b5-81e8-ade06a51d1ed) в лвссп.

         
-   Последний вариант — использовать привязки проверки подлинности без использования привязки защиты, например [**\_ \_ \_ \_ привязки безопасности транспорта WS SSL**](/windows/desktop/api/WebServices/ns-webservices-ws_ssl_transport_security_binding). Это приведет к тому, что учетные данные передаются в виде открытого текста и могут повлиять на безопасность. Использование этого параметра следует тщательно оценить, чтобы убедиться в отсутствии уязвимостей. Примером потенциального использования является обмен сообщениями между внутренними серверами через защищенную частную сеть. Этот параметр поддерживается в следующих конфигурациях.

    -   [**Служба WS \_ \_ \_ \_ \_ Привязка безопасности для проверки подлинности HTTP-заголовка**](/windows/desktop/api/WebServices/ns-webservices-ws_http_header_auth_security_binding) поддерживает этот параметр во всех конфигурациях.
    -   [**Служба WS \_ \_ \_ \_ Привязка безопасности сообщений username**](/windows/desktop/api/WebServices/ns-webservices-ws_username_message_security_binding) поддерживает этот параметр на сервере при использовании протокола HTTP в качестве транспорта.
    -   [**Служба WS \_ \_ \_ \_ \_ Привязка безопасности сообщений Kerberos апрек**](/windows/desktop/api/WebServices/ns-webservices-ws_kerberos_apreq_message_security_binding) поддерживает этот параметр на сервере при использовании протокола HTTP в качестве транспорта.
    -   [**Служба WS \_ \_Контекст безопасности \_ . \_ \_ Привязка безопасности сообщений**](/windows/desktop/api/WebServices/ns-webservices-ws_security_context_message_security_binding) поддерживает этот параметр на сервере при использовании протокола HTTP в качестве транспорта.
    -   [**Служба WS \_ \_ \_ \_ Привязка безопасности сообщений SAML**](/windows/desktop/api/WebServices/ns-webservices-ws_saml_message_security_binding) поддерживает этот параметр на сервере при использовании протокола HTTP в качестве транспорта.

    Для включения этого параметра необходимо явно задать [**для \_ \_ уровня защиты WS**](/windows/desktop/api/WebServices/ne-webservices-ws_protection_level) значение, отличное от **\_ знаков WS \_ уровня защиты \_ Sign \_ и \_ Encrypt**.

## <a name="channels-and-security"></a>Каналы и безопасность

Как отмечалось выше, безопасность ограничивается каналами. Более того, операции с каналами согласованно сопоставляются с действиями безопасности во всех привязках безопасности.

-   Создание канала. набор привязок безопасности, указанных в описании безопасности, проверяется и остается фиксированным для канала. Также определяется форма стека каналов, включая все каналы, которые будут использоваться для согласования на основе WS-Trust.
-   Канал открыт. все учетные данные, передаваемые в составе привязок безопасности, загружаются, а также устанавливаются сеансы безопасности. Как правило, Открытый канал содержит состояние безопасности "Live". При открытии канала клиента также указывается адрес конечной точки сервера, по которому будет выполняться проверка подлинности сервера средой выполнения.
-   Между открытием и закрытием канала: сообщения могут быть безопасно отправлены и получены на этом этапе.
-   Отправка сообщения: маркеры контекста безопасности получаются или обновляются по мере необходимости, а безопасность применяется к передаваемым сообщениям в соответствии с описанием безопасности. Ошибки, возникающие при применении безопасности, возвращаются приложению как ошибки отправки.
-   Получение сообщения: безопасность проверяется для каждого полученного сообщения в соответствии с описанием безопасности. Любые ошибки проверки безопасности сообщений возвращаются в приложение как ошибки получения. Эти ошибки на сообщения не влияют на состояние канала или последующие приемы. Приложение может отменить неудачное получение и перезапустить получение другого сообщения.
-   Прерывание канала. канал может быть прерван в любой момент, чтобы остановить все операции ввода-вывода в канале. При прерывании канал переходит в состояние сбоя и больше не позволяет отправлять или получать сообщения. Однако канал может по-прежнему сохранить состояние безопасности "Live", поэтому последующее закрытие канала будет необходимо для освобождения всех состояний.
-   Закрытие канала: состояние безопасности, созданное при открытии, удалено, и сеансы будут разорваны. Маркеры контекста безопасности отменены. Стек каналов остается, но не содержит состояние безопасности "Live" или загруженные учетные данные.
-   Бесплатный канал. стек каналов, созданный на основе Create, а также все ресурсы безопасности, освобождаются.

## <a name="security-apis"></a>API-интерфейсы обеспечения безопасности

Документация по API для обеспечения безопасности сгруппирована в следующие разделы.

-   [Описание безопасности](security-description.md)
    -   [Параметры канала безопасности](security-channel-settings.md)
    -   [Привязки безопасности](security-bindings.md)
        -   [Учетная запись для безопасного доступа](security-credentials.md)
        -   [Настройки привязки безопасности](security-binding-settings.md)
-   [Федерация](federation.md)
-   [Контекст безопасности](security-context.md)
-   [Удостоверение конечной точки](endpoint-identity.md)
-   [Результаты обработки безопасности](security-processing-results.md)

## <a name="security"></a>Безопасность

При использовании API безопасности ВВСАПИ приложения сталкиваются с несколькими угрозами безопасности:

<dl> <dt>

<span id="Accidental_misconfiguration"></span><span id="accidental_misconfiguration"></span><span id="ACCIDENTAL_MISCONFIGURATION"></span>Случайная ненастройка
</dt> <dd>

ВВСАПИ поддерживает ряд параметров конфигурации, связанных с безопасностью. См. пример [**\_ \_ \_ \_ идентификатора свойства привязки безопасности WS**](/windows/desktop/api/WebServices/ne-webservices-ws_security_binding_property_id). Некоторые из этих параметров, такие как **\_ свойство привязки безопасности WS, позволяют приложению использовать \_ \_ \_ \_ анонимные \_ Клиенты** для снижения уровня безопасности по умолчанию, предоставляемого различными привязками безопасности. Использование таких параметров должно быть тщательно оценено, чтобы убедиться в том, что результирующие направления атак отсутствуют.

Кроме того, как описано выше, ВВСАПИ позволяет приложению намеренно отключить определенные шаги, необходимые для полной защиты обмена сообщениями, например Разрешить отключение шифрования, даже если передаются учетные данные безопасности. Это разрешено для включения определенных сценариев и не должно использоваться для общего взаимодействия. [**\_ \_ Уровень защиты WS**](/windows/desktop/api/WebServices/ne-webservices-ws_protection_level) необходимо отнизить, чтобы включить эти сценарии, и приложения не должны изменять это значение, если это не требуется абсолютно, так как это приведет к отключению многих проверок, предназначенных для обеспечения безопасной конфигурации.

</dd> <dt>

<span id="Storing_confidential_information_in_memory"></span><span id="storing_confidential_information_in_memory"></span><span id="STORING_CONFIDENTIAL_INFORMATION_IN_MEMORY"></span>Хранение конфиденциальной информации в памяти
</dt> <dd>

Конфиденциальные сведения, такие как пароли, которые хранятся в памяти, уязвимы для извлечения привилегированным злоумышленником с помощью, например, файла подкачки. ВВСАПИ создает копию предоставленных учетных данных и шифрует эту копию, освобождая исходные данные без защиты. Это обязанность приложения для защиты исходного экземпляра. Кроме того, зашифрованная копия коротко расшифровывается при использовании, открывая окно для его извлечения.

</dd> <dt>

<span id="Denial_of_service"></span><span id="denial_of_service"></span><span id="DENIAL_OF_SERVICE"></span>Отказ в обслуживании
</dt> <dd>

Обработка безопасности может потреблять значительные ресурсы. Каждая дополнительная привязка безопасности увеличивает эти затраты. ВВСАПИ прерывает обработку безопасности, как только будет обнаружен сбой проверки безопасности, но некоторые проверки, такие как принятие решений об авторизации, могут не выполняться до тех пор, пока не будет выполнена значительная работа.

При обработке сообщения на сервере состояние безопасности хранится в куче сообщений. Приложение может ограничить потребление памяти во время обработки системы безопасности, уменьшая размер этой кучи в \_ \_ \_ свойствах кучи свойства сообщения \_ . Кроме того, некоторые привязки безопасности, такие как \_ \_ Привязка безопасности сообщений контекста безопасности WS, \_ \_ \_ могут привести к тому, что сервер выделит ресурсы от имени клиента. Ограничения для этих ресурсов можно настроить с помощью следующих значений [**\_ \_ \_ \_ идентификатора свойства привязки безопасности WS**](/windows/desktop/api/WebServices/ne-webservices-ws_security_binding_property_id) :

-   \_ \_ Безопасность свойства привязки безопасности WS \_ \_ \_ \_ Максимальное число \_ ожидающих контекстов \_
-   \_ \_ \_ \_ \_ \_ Максимальное число активных контекстов безопасности \_ для свойства \_ привязки безопасности WS
-   \_ \_ \_ \_ \_ \_ интервал обновления контекста безопасности свойства привязки \_ безопасности WS
-   \_ \_ \_ \_ \_ \_ интервал переключения контекста безопасности для свойства привязки \_ безопасности WS

Установка этих ограничений на низкие значения приводит к уменьшению максимального потребления памяти, но может привести к отклонению легальных клиентов при достижении квоты.

</dd> </dl>

 

 