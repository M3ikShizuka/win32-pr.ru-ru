---
title: Создание клиента
description: Создание клиента для веб-служб значительно упрощено в ВВСАПИ с помощью API модели службы и WsUtil.exe средства.
ms.assetid: 09f489e8-958d-4bc5-a232-aa59bd75333a
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 606a68f574a9ad79d15f3ddd48247f93a5414250
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "104411384"
---
# <a name="creating-a-client"></a>Создание клиента

Создание клиента для веб-служб значительно упрощено в ВВСАПИ с помощью API [модели службы](service-model-layer-overview.md) и [WsUtil.exe](wsutil-compiler-tool.md) средства. Модель службы предоставляет API, позволяющий клиенту отправлять и получать [сообщения](message.md) по [каналу](channel.md) в виде вызовов методов C. Средство Всутил создает заголовки и вспомогательные методы для реализации клиента. Эти заголовки содержат типы и прототипы функций для функций C, представляющих службы, предоставляемые целевой веб-службой. Вспомогательные методы используются для создания прокси службы, который содержит сведения о привязке и [адрес конечной точки](endpoint-address.md) для службы.

## <a name="using-wsutil-to-generate-headers-and-helpers"></a>Использование Всутил для создания заголовков и вспомогательных функций

Для создания заголовков и вспомогательных функций Всутил открывает и считывает файлы метаданных для целевой службы — WSDL и XSD-файлы, а затем преобразует их в заголовки. Поэтому необходимо заранее получить файлы метаданных целевой службы, например, с помощью SvcUtil, части Windows Communication Foundation. По соображениям безопасности крайне важно, чтобы копии этих файлов были надежными. (Дополнительные сведения см. в разделе "безопасность" в разделе [средства компилятора всутил](wsutil-compiler-tool.md) .)

Чтобы запустить Всутил, используйте следующий синтаксис командной строки, если файлы WSDL и XSD для службы находятся в собственном каталоге: `WsUtil.exe *.wsdl *.xsd` . Кроме того, можно указать файлы по полному имени.

Для каждого файла метаданных Всутил обычно создает два файла: заголовок и файл C. Добавьте эти файлы в проект кода и используйте \# инструкции include, чтобы включить их в код для клиента. (XSD-файлы представляют типы, а WSDL-файлы представляют операции.)

## <a name="creating-the-service-proxy"></a>Создание прокси-сервера службы

Заголовок, формируемый Всутил, содержит вспомогательную подпрограммы для создания прокси службы с требуемой привязкой. Эта подпрограммы включена в раздел "подпрограммы поддержки политик" созданного файла заголовка. Например, созданный заголовок для службы калькулятора, показанный в примере [хттпкалкулаторклиентексампле](httpcalculatorclientexample.md) , будет содержать следующий прототип функции.


```
HRESULT BasicHttpBinding_ICalculator_CreateServiceProxy(
    __in_opt WS_HTTP_BINDING_TEMPLATE* templateValue,
    __in_ecount_opt(proxyPropertyCount) const WS_PROXY_PROPERTY* proxyProperties,
    __in const ULONG proxyPropertyCount,
    __deref_out_opt WS_SERVICE_PROXY** _serviceProxy,
    __in_opt WS_ERROR* error);
```



Включите этот вспомогательный метод в код и передайте ему обработчик [ \_ \_ прокси-службы WS](ws-service-proxy.md) для получения маркера созданному прокси-серверу службы. В простейшем сценарии, в котором функции передаются только обработчик прокси-службы и объект ошибки, вызов выглядит следующим образом.


```C++
hr = BasicHttpBinding_ICalculator_CreateServiceProxy(
            NULL,
            NULL,
            0,
            &serviceProxy,
            error);
```



Чтобы создать часть адреса прокси-сервера службы, вызовите [**всопенсервицепрокси**](/windows/desktop/api/WebServices/nf-webservices-wsopenserviceproxy) с помощью маркера прокси-сервера службы и указателя на [**\_ \_ адрес конечной точки WS**](/windows/desktop/api/WebServices/ns-webservices-ws_endpoint_address) , содержащий адрес конечной точки службы, к которой нужно подключиться.

## <a name="implementing-the-client-with-function-prototypes"></a>Реализация клиента с прототипами функций

Заголовки, созданные из файлов WSDL службы, также содержат прототипы функций C, представляющие службы, доступные в веб-службе, и конкретные требуемые привязки. Например, заголовок, созданный для службы калькулятора, показанный в Хттпкалкулаторсервицеексампле, будет содержать следующий прототип для операции умножения этой службы.

``` syntax
HRESULT BasicHttpBinding_ICalculator_Multiply(
    __in WS_SERVICE_PROXY* _serviceProxy,
    __in double n1,
    __in double n2,
    __out double* MultiplyResult,
    __in WS_HEAP* _heap,
    __in_ecount_opt(_callPropertyCount) const WS_CALL_PROPERTY* _callProperties,
    __in const ULONG _callPropertyCount,
    __in_opt const WS_ASYNC_CONTEXT* _asyncContext,
    __in_opt WS_ERROR* _error);
```

Вы можете скопировать прототипы и использовать их в качестве шаблонов для кодирования вызовов функций в клиенте, каждый из которых передает этот обработчик прокси-серверу службы. По завершении работы с прокси-сервером службы вызовите [**всклосесервицепрокси**](/windows/desktop/api/WebServices/nf-webservices-wscloseserviceproxy).

 

 




