---
title: Трассировка
description: Трассировка использует трассировку событий для Windows (ETW).
ms.assetid: b008bae2-9423-4e72-ae03-9cd50f73d812
keywords:
- Трассировка веб-служб для Windows
- ввсапи
- WWS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 82c660884667cefae8067376075a30cbc41f70d4
ms.sourcegitcommit: a716ca2a6a22a400f02c6b31699cf4da83ee3619
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2020
ms.locfileid: "104414177"
---
# <a name="tracing"></a>Трассировка

Трассировка использует трассировку событий для Windows (ETW). Чтобы воспользоваться средствами трассировки, доступными в Windows Server 2008 R2, установите Microsoft Windows SDK на сайте [загрузки MSDN](https://www.microsoft.com/download/details.aspx?id=8279) .


Поддерживаются три уровня трассировки:

-   Verbose (все доступные трассировки).
-   INFO (информационные трассировки).
-   Ошибка (трассировки ошибок).

Отслеживаются следующие события:

-   Любые ошибки (уровень = ошибка, уровень = сведения или уровень = подробный).
-   Вход и выход из API (Level = info или Level = verbose).
-   Начало и завершение любых операций ввода-вывода (уровень = info или Level = verbose)
-   Обмен сообщениями SOAP (Level = Verbose, доступный в Windows 2003 с пакетом обновления 1 (SP1) и более поздних версиях)

## <a name="generating-and-viewing-wwsapi-traces"></a>Создание и Просмотр трассировок ВВСАПИ

ВВСАПИ использует события на основе манифеста в Windows Vista и более поздних версиях. В результате трассировка имеет некоторые отличия, основанные на версии операционной системы. Создание трассировок трассировки событий Windows можно выполнить с помощью встроенных средств ETW на всех поддерживаемых платформах. Однако для просмотра трассировки ETW в удобном формате требуются пользовательские средства в Windows XP SP2 и Windows 2003 с пакетом обновления 1 (SP1). Существует несколько различных способов сбора и просмотра трассировок событий ETW ВВСАПИ в зависимости от версии операционной системы.

## <a name="enabling-and-viewing-wwsapi-traces-in-event-viewer-works-on-windows-vista-and-above"></a>Включение и Просмотр трассировок ВВСАПИ в Просмотр событий (работает в Windows Vista и более поздних версиях)

-   Запустите eventvwr. msc из командной строки или из меню выполнения.
-   Щелкните ссылку Просмотр на панели действия справа и включите параметр Показать журналы аналитики и отладки.
-   Перейдите к журналу приложений и служб \\ Microsoft \\ Windows веб \\ Services в левой области.
-   Щелкните правой кнопкой мыши поставщик трассировки и выберите Включить журнал.
-   Выполните сценарий.
-   При обновлении страницы "Просмотр событий" следует начать просмотр записей трассировки ВВСАПИ.

## <a name="enabling-and-viewing-wwsapi-traces-using-wstracebat-script-works-on-xpsp2-and-above"></a>Включение и Просмотр трассировок ВВСАПИ с помощью скрипта Wstrace.bat (работает в XPSP2 и более поздних версиях)

Пакетный файл wstrace.bat предоставляет удобный способ:

-   Создание журнала трассировки
-   Удаление журнала трассировки
-   Включение и отключение трассировки
-   Обновление уровня трассировки (info, Error/verbose)
-   Преобразование журналов трассировки в CSV-файлы

Пакетный файл использует logman.exe для всех команд, за исключением преобразования журналов в CSV-файл, для которого требуется настраиваемое средство (wstracedump.exe).

## <a name="using-tracing-commands"></a>Использование команд трассировки

Следующая команда создает журнал, в котором используются сведения, ошибка или уровень детализации. Для этой команды требуются повышенные привилегии.

**wstrace.bat \[ подробные сведения \| об ошибке создания сведений \|\]**

Следующая команда удаляет журнал. Для этой команды требуются повышенные привилегии.

**wstrace.bat удалить**

Следующая команда включает трассировку. Сначала необходимо создать журнал.

**wstrace.bat на**

Уровень трассировки (info, Error или verbose) можно изменить следующим образом:

**wstrace.bat \[ подробные сведения \| об ошибке обновления \|\]**

Чтобы выгрузить выходные данные трассировки, используйте следующую команду:

**> дампаwstrace.bat temp.csv**

События будут записываться в файл CSV до нажатия клавиши CTRL-C или отключения трассировки.

## <a name="tracing-file-format"></a>Формат файла трассировки

Файлы CSV, созданные wstrace.bat, представляют собой простые текстовые файлы с разделителями-запятыми. Эти файлы могут быть открыты в Excel, блокноте и т. д.

Ниже приведены столбцы файла.

-   TimeStamp — метка времени, когда событие было записано
-   ProcessID — идентификатор ULONG процесса, записывающего событие
-   ThreadID-ULONG идентификатор потока, записывающего событие
-   Перечислимое по событиям значение типа события может быть ("API Enter" \| "API ожидание" \| "API екситсинксукцесс" \| "API екситсинкфаилуре" \| "API Екситасинксукцесс" \| "API екситасинкфаилуре" \| "IO Started" \| "ввод-вывод завершен" \| "произошел сбой ввода-вывода" " \| Ошибка" \| "получено сообщение начало" \| \| \| \| \| "получено сообщение" "получено сообщение останавливается" "Отправка сообщения" "Отправка сообщения" "
-   Operation — имя вызываемой операции. Обычно это сопоставляется с вызываемым API.
-   Ошибка-необязательный номер ошибки HRESULT
-   Сведения — необязательные сведения о событии

## <a name="collecting-wwsapi-etw-trace-file-using-etw-tools-works-on-xpsp2-and-above"></a>Сбор файла трассировки событий Windows ВВСАПИ с помощью средств ETW (работает в XPSP2 и более поздних версиях)

Включение трассировки ETW для ВВСАПИ

**Программа Logman Start встраце-BS 64-ft 1-RT-p Microsoft-Windows-WebService \[ Флаги \[ Level \] \] \[ -o <EtlLogFileName> \] -ETS**

для создания и запуска сеанса трассировки событий Windows. Logman.exe — это встроенное средство ETW, доступное на всех поддерживаемых платформах. Обратите внимание, что необходимо использовать веб \_ службы Microsoft Windows в \_ качестве имени поставщика в XPsp2 и W2K3. Вы можете запустить поставщики запросов logman, чтобы просмотреть список зарегистрированных поставщиков. \_ \_ Если он не зарегистрирован, то должен быть указан поставщик Microsoft-Windows-WebService (или Microsoft Windows WebService). Поставщик обычно регистрируется во время установки. Однако его также можно зарегистрировать вручную, запустив wevtutil.exe IM <ManifestFileName> (в Windows Vista и более поздних версиях) или mofcomp.exe <MofFileName> (в XPsp2 и W2K3).

Флаги можно использовать для фильтрации трассировок по их типу. Это может быть или значение следующих типов трассировки. Если не указано, включаются все виды трассировки.

-   0x1 — трассировка входа/выхода API.
-   0x2 — трассировки ошибок.
-   0x4 — трассировки операций ввода-вывода.
-   0x8 — трассировки сообщений SOAP.
-   0x10 — двоичные трассировки сообщений.

Level можно использовать для фильтрации трассировок по их уровню. Это должно быть одно из следующих значений. Если не указано, включаются все уровни трассировки.

-   0x1 — неустранимые трассировки.
-   0x2 — трассировки ошибок.
-   0x3 — трассировка предупреждений.
-   0x4 — информационные трассировки.
-   0x5 — подробные трассировки.

Етллогфиленаме — путь к создаваемому файлу журнала событий ETW (используйте расширение ETL). Если не указано, ETW выберет случайное имя, которое можно будет запросить позже. Этот файл не должен находиться в каталоге профиля пользователя. Файл журнала событий ETW (ETL-файл) имеет двоичный формат. Его можно использовать в приложениях ETW, но не в удобочитаемом формате. На следующем шаге описывается, как просмотреть его содержимое.

Выполнение сценария

Сбор данных о файле журнала событий ETW.

**Logman остановкой встраце-ETS**

для завершения сеанса трассировки ETW. Это происходит, когда ETW прекращает запись событий в журнал. Файл журнала событий ETW (указанный в параметре Етллогфиленаме) готов к использованию. Его можно просмотреть локально (инструкции приведены ниже) или отправить в группу продуктов для изучения.

Сквозной пример с использованием средств ETW:

**Logman Start встраце-BS 64-ft 1-RT-p Microsoft-Windows-WebService-o митраце. ETL-ETS**

**echo. Выполните сценарий.**

**Logman остановкой встраце-ETS**

**Tracerpt митраце. ETL-o mytrace.xml**

**wstrace.htm**

**echo. Используйте mytrace.xml и встраце. XSL на открытой странице..**

## <a name="viewing-wwsapi-etw-trace-file-traces-using-wstracedumpexe-tool-works-on-windows-xp-and-above"></a>Просмотр трассировки файлов трассировки событий Windows ВВСАПИ с помощью средства wstracedump.exe (работает в Windows XP и более поздних версиях)

Wstracedump.exe — это настраиваемое средство для потребителей ETW, которое обрабатывает события в файле трассировки событий Windows ВВСАПИ и создает понятные для человека выходные данные. Он может создавать выходные данные со всех поддерживаемых платформ. Дополнительные сведения см. в описании использования (wstracedump.exe-?).

## <a name="viewing-wwsapi-etw-trace-file-traces-using-etw-tools-works-on-windows-vista-and-above"></a>Просмотр трассировки файлов трассировки событий Windows ВВСАПИ с помощью средств ETW (работает в Windows Vista и более поздних версиях)

Tracerpt.exe — это средство для просмотра содержимого файла журнала событий ETW, которое доступно на всех поддерживаемых платформах. Его можно использовать для создания файлов дампа CSV, EVTX или XML из файла журнала событий ETW. Однако созданный выходной файл имеет доступную для чтения трассировку только в Windows Vista и более поздних версиях. Эти инструкции описывают, как создать XML-файл дампа и использовать его вместе с XSL-файлом для отображения трассировок в удобном формате (XSL-файл очень тривиальный и может быть изменен в случае необходимости в различных форматах).

-   Выполнить

    **Tracerpt <EtlLogFileName> -o <OutputXMLFileName>**

    для создания дампа XML из двоичного ETL-файла (tracerpt.exe по умолчанию создает выходной файл в формате XML. Запустить Tracerpt-? Для просмотра других доступных форматов).

-   На этом этапе данные трассировки можно просмотреть в XML-файле. Кроме того, можно открыть файл wstrace.htm и использовать XML-файл дампа и файл встраце. XSL для просмотра трассировок в формате лучше. Обратите внимание, что файлы должны находиться на локальном компьютере, чтобы иметь возможность использовать этот HTML-файл в IE.

## <a name="security"></a>Безопасность

При включении трассировки администраторам следует учитывать, что она потребляет дополнительное дисковое пространство и вычислительную мощность. Вредоносный клиент или приложение могут вычерпать системные ресурсы, если только параметры трассировки не настроены с разумными ограничениями. При использовании функции трассировки сообщений сообщения, хранящие конфиденциальные данные, такие как учетные данные, персональные данные и т. д., могут быть сохранены на диске или просмотрены любым пользователем, имеющим доступ к средству просмотра системных событий. Для устранения этой проблемы трассировка может быть включена пользователями системы или администратора в Windows 2003 и более поздних версиях. Трассировка сообщений отключена в Windows XP, в которой любой пользователь может включить трассировку.

С трассировкой используется следующее перечисление:

-   [**\_API трассировки \_ WS**](/windows/desktop/api/WebServices/ne-webservices-ws_trace_api)

 

 




