---
description: Фильтр соответствия шаблону уведомляет драйвер о принятии кадров с конкретным шаблоном в указанном смещении.
ms.assetid: 8ee354f6-385d-49fa-baef-f70f6b3bd6a1
title: Написание фильтра ПАТТЕРНМАТЧ
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 95f92623c1fd0e1c47339b182a086975d9458f45
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673572"
---
# <a name="writing-the-patternmatch-filter"></a>Написание фильтра ПАТТЕРНМАТЧ

Фильтр соответствия шаблону уведомляет драйвер о принятии кадров с конкретным шаблоном в указанном смещении. Можно указать не более четырех подробных совпадений шаблонов, которые можно объединить в логические операторы AND или OR для оценки драйвера сетевой монитор.

Для реализации совпадений шаблонов используйте следующие структуры сетевой монитор.

-   [**ВЫРАЖЕНИЕ**](expression.md)
-   [**андексп**](andexp.md)
-   [**паттернматч**](patternmatch.md)

Чтобы вычислить оператор **или** , объедините два-четыре шаблона в структуру [**андексп**](andexp.md) (PatternMatch1 \| \| PatternMatch2 \| \| PatternMatch3). Чтобы вычислить оператор AND, объедините одну-четыре структуры **андексп** и структуру [**выражения**](expression.md) (AndExp1 && AndExp2).

## <a name="pattern-match-definitions"></a>Определения соответствия шаблону

Одно соответствие шаблона определяется структурой [**паттернматч**](patternmatch.md) . Отдельное соответствие может использоваться одним из двух способов.

Как правило, драйвер берет на себя смещение (которое может быть СМЕЩЕНо \_ \_ относительно \_ \_ кадра, смещение относительно \_ \_ \_ \_ эффективного \_ протокола, смещение относительно \_ \_ \_ \_ IPX или смещение \_ \_ относительно \_ \_ IP-адреса) и начать подсчет. Драйвер будет подсчитывать из него байты смещения, а затем сопоставлять найденные данные с первой длиной байтов в **паттернтоматч**. Если они совпадают и \_ флаг соответствия шаблону \_ \_ не установлен, то этот шаблон передается. Если они отличаются и \_ \_ Флаги соответствия шаблону \_ не заданы, шаблон передается. В противном случае этот шаблон завершается ошибкой.

Или сделайте так:

Если \_ установлен флаг соответствия шаблону \_ \_ порт \_ указан, а для базиса задано смещение \_ \_ относительно \_ \_ IPX или смещения \_ \_ относительно \_ \_ IP, сравнение является более сложным. Во-первых, драйвер гарантирует, что в нем используется протокол offset, а затем драйвер проверяет, соответствует ли указанный порт порту в кадре. Наконец, драйвер гарантирует, что элемент **паттернтоматч** будет соответствовать, как и раньше, за исключением смещения от конца IP-адреса или IPX. Обратите внимание, что если базис не является одним из этих двух, то \_ флаг соответствия шаблону порта, указанный в параметре, \_ \_ \_ будет проигнорирован, и шаблон будет оцениваться так, как показано выше.

Для вычисления одного соответствия шаблону структура [**выражения**](expression.md) должна иметь один элемент **андексп** , содержащий одно соответствие шаблона.

Создание фильтра соответствия шаблону включает создание структур [**паттернматч**](patternmatch.md) и логическое объединение их с структурами [**Expression**](expression.md) и [**андексп**](andexp.md) .

**Написание фильтра ПАТТЕРНМАТЧ**

1.  В структуре [**андексп**](andexp.md) заполните массив совпадениями шаблона.
2.  Заполните структуру [**выражения**](expression.md) массивом элементов **андексп** .
3.  Не превышать всего четыре совпадения шаблона для фильтра записи.
4.  В структуре [**паттернматч**](patternmatch.md) выберите тип флага.
5.  Выберите базис для смещения.
6.  Перечисление значения порта.
7.  Определите значение смещения.
8.  Определите длину шаблона.
9.  Перечисление значения шаблона.

## <a name="patternmatch-examples"></a>Примеры ПАТТЕРНМАТЧ

Этот кадр представляет стандартное смещение.

![Стандартный смещенный кадр](images/offs-pat.png)

Фрагмент кода реализуется следующим образом:

``` syntax
Basis  ->   IP
Offset ->   4 (bytes)
Length ->   2 (bytes)
PatternToMatch[ ] = {x00, x00}
```

В этом кадре показано смещение, заданное портом (по протоколу IPX).

![заданный портом кадр смещения](images/stan-pat.png)

Пример кода реализуется следующим образом:

``` syntax
Port   ->   544
Basis  ->   IPX
Offset ->   2 (bytes)
Length ->   2 (bytes)
PatternToMatch[ ] = {x00, x00}
```

 

 



