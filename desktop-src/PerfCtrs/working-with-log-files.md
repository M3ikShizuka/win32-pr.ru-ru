---
description: Чтобы открыть файл журнала для чтения, вызовите Пдхопенкуери и укажите путь к файлу журнала.
ms.assetid: 1d8f8662-df1f-4f84-8b65-c152f79cc5c6
title: Работа с файлами журналов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 82281694b72a2c28bb0e65ee4db16bd9ba33b8ed9c6e5e74dbf6c6cbf559507a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119143747"
---
# <a name="working-with-log-files"></a>Работа с файлами журналов

Чтобы открыть файл журнала для чтения, вызовите [**пдхопенкуери**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) и укажите путь к файлу журнала. Чтобы открыть файл журнала для записи, необходимо вызвать [**пдхопенлог**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga). Чтобы закрыть файл журнала, вызовите либо [**пдхклосекуери**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) , либо [**пдхклоселог**](/windows/desktop/api/Pdh/nf-pdh-pdhcloselog) в зависимости от того, какая функция использовалась для открытия файла журнала.

## <a name="reading-from-a-log-file"></a>Чтение из файла журнала

Чтение данных о производительности из файла журнала аналогично чтению данных из источника в режиме реального времени — вы открываете запрос, добавляете к запросу счетчики и вызываете [**пдхколлекткуеридата**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata) для получения образца из файла журнала. **Пдхколлекткуеридата** возвращает PDH \_ больше \_ \_ данных при достижении конца файла журнала.

Каждый пример в файле журнала содержит метку времени, когда она была первоначально собрана и записана в файл журнала. Чтобы получить метку времени для первой и последней выборки в файле журнала, вызовите функцию [**пдхжетдатасаурцетимеранже**](/windows/desktop/api/Pdh/nf-pdh-pdhgetdatasourcetimerangea) . Если требуется ограничить выборки, считанные из журнала, на конкретный диапазон времени, см. раздел [Настройка диапазона времени для запроса](setting-a-time-range-for-a-query.md).

Если неизвестно, какие объекты производительности и счетчики существуют в файле журнала, можно вызвать [**пдхенумобжектс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectsa) , чтобы определить список объектов. При наличии объекта можно вызвать либо [**пдхенумобжектитемс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa) , либо [**пдхекспандвилдкардпас**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) , чтобы получить список экземпляров объекта и счетчиков, содержащихся в файле журнала.

При вызове [**пдхенумобжектитемс**](/windows/desktop/api/Pdh/nf-pdh-pdhenumobjectitemsa)используйте списки экземпляров и счетчиков, чтобы создать путь для каждого возможного сочетания экземпляра и счетчика. При вызове [**пдхаддкаунтер**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) для добавления счетчика в запрос функция завершится ошибкой, если файл журнала не содержит данное сочетание.

При использовании [**пдхекспандвилдкардпас**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha)можно создать путь, содержащий подстановочный знак для имени экземпляра и счетчика, например \\ Object ( \* ) \\ \* . Функция возвращает \_ Недопустимый \_ путь PDH, если объект не содержит экземпляр. В этом случае вызовите **пдхекспандвилдкардпас** , используя подстановочный знак только для счетчика, например \\ Object \\ \* .

Более новые операционные системы могут считывать файлы журналов, созданные в более старых операционных системах. однако файлы журналов, созданные в Windows Vista и более поздних операционных системах, не могут быть прочитаны в более ранних операционных системах.

Пример, считывающий данные из файла журнала, см. в разделе [Чтение данных о производительности из файла журнала](reading-performance-data-from-a-log-file.md).

## <a name="reading-from-multiple-log-files"></a>Чтение из нескольких файлов журнала

Если необходимо создать запрос, считывающий данные из нескольких файлов журнала, вызовите [**пдхбиндинпутдатасаурце**](/windows/desktop/api/Pdh/nf-pdh-pdhbindinputdatasourcea) , чтобы привязать файлы журнала друг к другу. Затем необходимо использовать функции PDH, заканчивающиеся на H, например [**пдхопенкуерих**](/windows/desktop/api/Pdh/nf-pdh-pdhopenqueryh).

## <a name="writing-to-a-log-file"></a>Запись в файл журнала

Перед записью в файл журнала вызовите [**пдхопенкуери**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) , чтобы создать запрос и указать источник данных о производительности: данные в реальном времени или файл журнала. Затем добавьте счетчики, которые необходимо запросить.

Чтобы открыть файл назначения, вызовите [**пдхопенлог**](/windows/desktop/api/Pdh/nf-pdh-pdhopenloga). Укажите запрос при открытии файла журнала. Чтобы получить данные о производительности и записать их в файл журнала, вызовите [**пдхупдателог**](/windows/desktop/api/Pdh/nf-pdh-pdhupdateloga).

Если данные счетчика записываются в файл журнала с разделителями-запятыми (.csv) или с разделителями-табуляциями (. TSV), а путь содержит экземпляр с подстановочными знаками, путь разворачивается и в файл журнала включаются только те экземпляры, которые существуют на момент расширения пути. однако для двоичного файла (blg) или SQL файлов журнала подстановочный знак не разворачивается, чтобы файл журнала содержал экземпляры, создаваемые во время ведения журнала.

Пример, в котором данные записываются в файл журнала, см. [в разделе запись данных о производительности в файл журнала](writing-performance-data-to-a-log-file.md).

## <a name="compressing-a-log-file"></a>Сжатие файла журнала

Для сжатия файла журнала можно использовать функцию [**пдхкомпутекаунтерстатистикс**](/windows/desktop/api/Pdh/nf-pdh-pdhcomputecounterstatistics) . Например, прочитайте десять записей из файла журнала, вызовите **пдхкомпутекаунтерстатистикс** , чтобы вычислить среднее значение, а затем записать среднее значение в выходной файл журнала.

В следующем разделе приводятся дополнительные сведения об использовании файла журнала.

-   [Получение размера файла журнала](getting-the-size-of-a-log-file.md)

 

 



