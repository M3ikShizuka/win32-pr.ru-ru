---
description: Хотя поставщикам рекомендуется использовать уникальные имена экземпляров, не все поставщики.
ms.assetid: 3c8fcb8d-2ea4-4b24-b649-7bd375c1133d
title: Обработка повторяющихся имен экземпляров
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: 220e5d7d0181a79c1d1415486cc946d484e11952
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663231"
---
# <a name="handling-duplicate-instance-names"></a>Обработка повторяющихся имен экземпляров

Хотя поставщики настоятельно рекомендуется использовать уникальные имена экземпляров, не все поставщики поддерживают. В соглашении для отображения повторяющихся имен экземпляров можно добавить `#` символ и серийный номер к имени экземпляра, за исключением первого вхождения имени. Например, если в образце есть три экземпляра `svchost` , то эти три имени отображаются как `svchost` , `svchost#1` и `svchost#2` .

К сожалению, это соглашение не позволяет полностью решить проблему. Серийные номера назначаются на основе порядка, в котором конкретное имя экземпляра отображается в образце, и этот порядок может быть непоследовательным в образце для выборки. Например, пример A может видеть `svchost` (pid 100), `svchost#1` (PID 200) и `svchost#2` (PID 300). Затем, если процесс svchost с PID 100 завершает работу, в следующем примере будут отображаться `svchost` (pid 200) и `svchost#1` (PID 300). Базовая логика сопоставления будет пытаться сопоставить пример `svchost#1` статистики A (от pid 200) с `svchost#1` статистикой образца б (с PID 300), что приведет к недопустимым результатам для примера б. ошибки возникают, когда новый неуникальный экземпляр отображается в выборке или когда неуникальный экземпляр останавливается в выборке (если только добавленный или удаленный экземпляр не был последним).

## <a name="process-counterset"></a>Набор счетчиков процессов

Эта проблема особенно связана с набором `Process` счетчиков, поскольку в нем используется только имя EXE-файла процесса в качестве имени экземпляра, несмотря на то, что имя исполняемого файла не является уникальным. Поведение по умолчанию для набора `Process` счетчиков в Windows не может быть изменено из-за проблем совместимости.

Можно изменить поведение `Process` и `Thread` каунтерсетс, чтобы использовать уникальные имена экземпляров, задав `ProcessNameFormat` `ThreadNameFormat` значения реестра или в разделе `HKLM\System\CurrentControlSet\Services\Perfproc\Performance` реестра.

> [!CAUTION]
> Включение уникальных имен экземпляров для `Process` CounterSet может привести к неправильному выполнению некоторых программ, так как для многих программ требуется неуникальный шаблон именования. Например, программа, которая ищет экземпляр с указанным хорошо известным именем EXE-файла, больше не сможет найти этот экземпляр после включения уникальных имен экземпляров.

Тип реестра для этих значений — `REG_DWORD` . Установка значения `2` добавляет идентификатор процесса (PID) в имя экземпляра процесса, а идентификатор потока (TID) — в имя экземпляра потока. Чтобы отключить эту функцию, установите значение 1 или удалите значение.
