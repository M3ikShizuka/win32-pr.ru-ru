---
description: Счетчики производительности, относящиеся к вашему приложению, могут помочь в настройке производительности при разработке и отладке приложения.
ms.assetid: 016386f6-4675-409e-8446-599e4ff96109
title: Добавление счетчиков производительности
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8660af9406de4dedec3ecbd76169a23b342aa7d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105663255"
---
# <a name="adding-performance-counters"></a>Добавление счетчиков производительности

> [!IMPORTANT]
> Из-за существенных ограничений производительности и надежности метод предоставления данных счетчиков производительности, описанных в этом разделе, может быть изменен или недоступен в будущем. Вместо этого корпорация Майкрософт рекомендует использовать метод, описанный в разделе [предоставление данных счетчиков с помощью версии 2,0](providing-counter-data-using-version-2-0.md) для создания счетчиков производительности, а также миграция существующих счетчиков производительности для использования этого метода.

Счетчики производительности, относящиеся к вашему приложению, могут помочь в настройке производительности при разработке и отладке приложения. После завершения работы и установки приложения на целевых системах счетчики могут помочь системным администраторам настроить параметры приложения.

## <a name="adding-a-performance-object-and-its-counters"></a>Добавление объекта производительности и его счетчиков

1. Разработка типов объектов и счетчиков для приложения. Дополнительные сведения см. в разделе [проектирование объектов и счетчиков](object-and-counter-design.md).
2. Создайте файл инициализации (. ini), содержащий имена и описания объектов производительности и счетчиков, которые вы предоставляете. Дополнительные сведения см. в разделе [Добавление имен и описаний счетчиков в реестр](adding-counter-names-and-descriptions-to-the-registry.md).
3. Создайте файл заголовка (. h), содержащий относительные смещения, при которых объекты счетчика и счетчики будут установлены в реестре. Дополнительные сведения см. в разделе [Добавление имен и описаний счетчиков в реестр](adding-counter-names-and-descriptions-to-the-registry.md).
4. Настройте необходимые записи наблюдения за производительностью в реестре. Это включает следующие шаги.
    1. Создайте раздел реестра в разделе **служб** для приложения. Если такого узла нет, создайте его в следующем разделе реестра: `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services` . Дополнительные сведения см. [в разделе Создание ключа производительности приложения](creating-the-applications-performance-key.md).
    2. Используйте служебную программу **lodctr** с ini-и h-файлами для установки данных в реестре. Эта служебная программа выполняется, только если в ключе **служб** для приложения существует ключ производительности. Дополнительные сведения см. в разделе [Добавление имен и описаний счетчиков в реестр](adding-counter-names-and-descriptions-to-the-registry.md).
5. Создайте библиотеку DLL производительности, содержащую набор экспортированных функций, которые предоставляют потребителю запрашиваемые данные счетчика. Дополнительные сведения см. [в разделе Создание библиотеки DLL расширения производительности](creating-a-performance-extension-dll.md).
6. Измените файл установки приложения, чтобы автоматизировать добавление сведений в реестр (как описано в шаге 4), и скопируйте библиотеку DLL производительности в каталог приложения при установке.

Дополнительные сведения о дополнительных записях реестра см. в разделе [Создание других записей](creating-other-registry-entries.md)реестра.
