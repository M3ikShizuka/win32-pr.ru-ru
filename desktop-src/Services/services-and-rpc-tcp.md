---
description: начиная с Windows Vista диспетчер управления службами (SCM) поддерживает удаленные вызовы процедур по протоколу управления передачей (rpc/TCP) и именованным каналам (rpc/NP).
ms.assetid: c51732f6-c22f-4726-afaa-13a8948ac44f
title: Службы и RPC/TCP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49d4ddfe95e114a972c600c9bef44864aa99fbe4ec412312d03e08fa7d7fe15b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118888561"
---
# <a name="services-and-rpctcp"></a>Службы и RPC/TCP

начиная с Windows Vista диспетчер управления службами (SCM) поддерживает удаленные вызовы процедур по протоколу управления передачей (rpc/TCP) и именованным каналам (rpc/NP). Функции SCM на стороне клиента используют RPC/TCP по умолчанию.

RPC/TCP подходит для большинства приложений, использующих функции SCM удаленно, таких как средства удаленного администрирования или мониторинга. Однако для обеспечения совместимости и производительности некоторым приложениям может потребоваться отключить RPC/TCP, задав значения реестра, описанные в этом разделе.

Когда служба вызывает удаленную функцию SCM, клиентский модуль SCM сначала пытается использовать RPC/TCP для связи со службой SCM на стороне сервера. если сервер работает под управлением версии Windows, поддерживающей rpc/tcp и разрешающей трафик rpc/tcp, подключение rpc/ткпп будет выполняться. если сервер работает под управлением версии Windows, которая не поддерживает rpc/tcp, или поддерживает rpc/tcp, но работает за брандмауэром, который разрешает только именованный канал, истекает время ожидания подключения rpc/tcp, и SCM повторяет подключение к rpc/NP. В конечном итоге это будет выполнено, но может занять некоторое время (обычно более 20 секунд), в результате чего функция [**OpenSCManager**](/windows/desktop/api/Winsvc/nf-winsvc-openscmanagera) будет заблокирована.

Протокол TCP не содержит учетные данные пользователя, указанные с помощью команды **net use** . Таким образом, если RPC/TCP включен и **sc.exe** используется для попытки доступа к указанной службе, команда может завершиться ошибкой с отказом в доступе. Отключение RPC/TCP на стороне клиента приводит к тому, что команда **sc.exe** использует именованный канал, который содержит учетные данные пользователя, поэтому команда будет выполнена. Сведения о sc.exe см. [в разделе Управление службой с помощью SC](controlling-a-service-using-sc.md).

> [!Note]  
> Служба не должна предоставлять явные учетные данные команде **net use** , так как эти учетные данные могут быть случайно предоставлены за пределами границ службы. Вместо этого служба должна использовать [олицетворение клиента](/windows/desktop/SecAuthZ/client-impersonation) для олицетворения пользователя.

 

### <a name="rpctcp-registry-values"></a>Значения реестра RPC/TCP

Управление RPC/TCP осуществляется с помощью значений реестра **скмапиконнектионпарам**, **дисаблерпковерткп** и **дисаблеремотескмендпоинтс** , которые находятся в ключе управления **" \_ Локальная \_ машина**" в папке hKey \\  \\ **CurrentControlSet** \\  . Все эти значения имеют \_ тип данных reg DWORD. В следующих процедурах показано, как использовать эти значения реестра для управления RPC/TCP.

В следующей процедуре описывается, как отключить RPC/TCP на стороне клиента.

**Отключение RPC/TCP на стороне клиента**

1.  Объедините значение реестра **скмапиконнектионпарам** со значением маски 0x80000000.
2.  Перезапустите приложение, вызывающее функцию [**OpenSCManager**](/windows/desktop/api/Winsvc/nf-winsvc-openscmanagera) .

В следующей процедуре описывается, как отключить TCP на стороне сервера.

**Отключение протокола TCP на стороне сервера**

1.  Присвойте параметру реестра **дисаблерпковерткп** значение 1.
2.  Перезапустите сервер.

В следующей процедуре описывается, как отключить RPC/TCP и RPC/NP на сервере (например, чтобы уменьшить поверхность атаки).

**Отключение RPC/TCP и RPC/NP на сервере**

1.  Присвойте параметру реестра **дисаблеремотескмендпоинтс** значение 1.
2.  Перезапустите сервер.

Значение реестра **скмапиконнектионпарам** можно также использовать для указания интервала времени ожидания RPC/TCP в миллисекундах. Например, значение 30 000 указывает интервал времени ожидания 30 секунд. Значение по умолчанию — 21 000 (21 секунда).

 

 
