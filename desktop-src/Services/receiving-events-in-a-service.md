---
description: Служба, которая является консольным приложением, может зарегистрировать обработчик управления консолью для получения уведомлений при выходе пользователя из системы.
ms.assetid: 86ace8b8-c1cb-4646-bc92-86bd578a82c5
title: Получение событий в службе
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: efe2312989208d5b6587067e64f10401c32229c2b19a7b4846163444576e63ca
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119003712"
---
# <a name="receiving-events-in-a-service"></a>Получение событий в службе

Служба, которая является консольным приложением, может зарегистрировать [обработчик управления консолью](/windows/console/console-control-handlers) для получения уведомлений при выходе пользователя из системы. Однако при входе интерактивного пользователя в систему не отправляется событие консоли. Сведения о получении уведомления при входе пользователя в систему см. [в разделе Создание пакета уведомлений Winlogon](/windows/desktop/SecAuthN/creating-a-winlogon-notification-package).

Система передает события изменения на все службы. Эти события могут быть получены службой в оконной процедуре или в обработчике управления службой. Чтобы указать, какие события должна получить служба, используйте функцию [**регистердевиценотификатион**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) .

Не забудьте как можно быстрее обрабатывать события самонастраивающийся устройства. В противном случае система может перестать отвечать на запросы. Если обработчик событий выполняет операцию, которая может блокировать выполнение (например, ввод-вывод), лучше запустить другой поток для асинхронного выполнения операции.

Когда служба вызывает [**регистердевиценотификатион**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa), служба также указывает либо обработчик окна, либо обработчик состояния службы. Если служба задает обработчик окна, то процедура окна получает события уведомления. Если служба указывает дескриптор состояния службы, ее обработчик управления службами получает события уведомления. Дополнительные сведения см. в разделе [**хандлерекс**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex).

Дескрипторы уведомлений устройства, возвращаемые функцией [**регистердевиценотификатион**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) , должны быть закрыты путем вызова функции [**унрегистердевиценотификатион**](/windows/desktop/api/winuser/nf-winuser-unregisterdevicenotification) , когда они больше не нужны.

 

 
