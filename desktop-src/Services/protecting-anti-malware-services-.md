---
description: Узнайте о защите служб защиты от вредоносных программ (AM) и о том, как можно включить эту функцию в службу защиты от вредоносных программ.
ms.assetid: 88875a0d-9027-43f2-8411-34f9ff428fe5
title: Защита служб защиты от вредоносных программ
ms.topic: article
ms.date: 08/02/2018
ms.openlocfilehash: 5e7783eb307381d368900332b5e761ad62785913
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104081479"
---
# <a name="protecting-anti-malware-services"></a>Защита служб защиты от вредоносных программ

В Windows 8.1 появилась новая концепция защищенных служб для защиты служб защиты от вредоносных программ, которая часто является целью атак вредоносных программ.

Узнайте о защите служб защиты от вредоносных программ (AM) и о том, как можно включить эту функцию в службу защиты от вредоносных программ.

Эти сведения относятся к следующим операционным системам и их последователям:

-   Windows 8.1
-   Windows Server 2012 R2

Ссылки и материалы, описанные здесь, перечислены в конце этого раздела.

## <a name="introduction"></a>Введение

Большинство решений для защиты от вредоносных программ включает в себя службу пользовательского режима, которая выполняет специализированные операции по обнаружению и удалению вредоносных программ из системы. Эта служба пользовательского режима также часто отвечает за загрузку последних определений и сигнатур вирусов. Эта служба пользовательского режима станет частой целью вредоносных программ, так как это единственная точка отказа от отключения защиты в системе. Для защиты от атак в службе пользовательского режима поставщики антивредоносного по должны добавить к их программному обеспечению множество функций и эвристику. Однако такие методы не полностью надежны и, как правило, подвержены ошибкам, так как они должны определять функциональные возможности, выполняемые Windows в своей службе, и выборочно включать эти функции.

В Windows 8.1 появилась новая концепция защищенной службы, позволяющая запускать службы пользовательского режима защиты от вредоносных программ в качестве защищенной службы. После запуска службы в качестве защищенной система Windows использует целостность кода, чтобы разрешить загрузку только доверенного кода в защищенную службу. Windows также защищает эти процессы от внедрения кода и других атак из процессов администрирования.

В этом документе описывается, как поставщик антивредоносной программы с драйвером раннего запуска от вредоносных программ (ELAM) может принять участие в этой функции и запустить службу защиты от вредоносных программ как защищенную службу.

## <a name="system-protected-process"></a>Защищенный системный процесс

Начиная с Windows 8.1, в ядре была реализована новая модель безопасности для повышения защиты от атак злоумышленников на критически важные для системы компоненты. Эта новая модель безопасности расширяет инфраструктуру защищенных процессов предыдущих версий Windows, используемых для конкретных сценариев, таких как воспроизведение содержимого DRM, в модель общего назначения, которая может использоваться сторонними поставщиками защиты от вредоносных программ. Инфраструктура защищенных процессов допускает только надежный подписанный код для загрузки и имеет встроенную защиту от атак путем внедрения кода.

Дополнительные сведения о защищенных процессах см. [в разделе защищенные процессы в Windows Vista](https://download.microsoft.com/download/a/f/7/af7777e5-7dcd-4800-8a0a-b18336565f5b/process_vista.doc) .

Новая модель безопасности использует немного другой вариант инфраструктуры процесса защиты, именуемый системным защищенным процессом, который более подходит для этой функции, так как это позволяет отдельно защитить содержимое DRM. Каждый защищенный системный процесс имеет связанный уровень или атрибут, указывающий политику подписи подписанного кода, которая может загружаться в процессе. После того как службы защиты от вредоносных программ переведены в режим защищенной службы, в этот процесс могут быть загружены только подписанный на Windows код или код, подписанный с помощью сертификатов поставщика защиты от вредоносных программ. Аналогичным образом, другие уровни защищенных процессов используют разные политики кода, реализованные Windows.

## <a name="requirements"></a>Требования

Чтобы служба пользовательского режима защиты от вредоносных программ выполнялась в качестве защищенной службы, у поставщика антивредоносной программы должен быть установлен драйвер ELAM на компьютере Windows. Помимо существующих требований к сертификации драйвера ELAM драйвер должен иметь раздел внедренного ресурса, содержащий сведения о сертификатах, используемых для подписания двоичных файлов службы пользовательского режима.

> [!IMPORTANT]
> В Windows 8.1 цепочка сертификации должна быть известен как известная корневая папка, определенная с помощью проверки драйверов, либо должен быть добавлен корневой сертификат.

 

В процессе загрузки этот раздел ресурсов будет извлечен из драйвера ELAM для проверки сведений о сертификате и регистрации службы защиты от вредоносных программ. Службу защиты от вредоносных программ можно также зарегистрировать во время процесса установки антивредоносного по, вызвав специальный API, как описано далее в этом документе.

После того как раздел ресурсов успешно извлечен из драйвера ELAM и зарегистрирована служба пользовательского режима, служба может запуститься в качестве защищенной службы. Когда служба запускается как защищенная, другие незащищенные процессы в системе не смогут внедрять потоки, и им не будет разрешено записывать в виртуальную память защищенного процесса.

Кроме того, любые библиотеки DLL, не относящиеся к Windows, которые загружаются в защищенный процесс, должны быть подписаны соответствующим сертификатом.

Дополнительные сведения о драйверах ELAM см. в разделе [ранний запуск антивредоносной программы](/windows/desktop/w8cookbook/secured-boot) .

### <a name="anti-malware-service-signing-requirements"></a>Требования к подписывания службы защиты от вредоносных программ

Служба пользовательского режима, которую необходимо запустить как защищенную, должна быть подписана с помощью действительных сертификатов. EXE-файл службы должен быть подписан в виде хэша страницы, а все DLL-библиотеки, не относящиеся к Windows, которые загружаются в службу, должны также подписываться теми же сертификатами. Хэш этих сертификатов должен быть добавлен в файл ресурсов, который будет связан с драйвером ELAM.

> [!Note]  
> Необходимо использовать хэши файлов и страниц SHA256, хотя сертификаты могут по-прежнему иметь значение SHA1.

 

### <a name="primary-signature-recommended"></a>Основная подпись (рекомендуется)

Рекомендуется, чтобы поставщики антивредоносного по использовали существующий сертификат Authenticode для подписи своих двоичных файлов службы защиты от вредоносных программ и хэш-код этого сертификата Authenticode в разделе ресурсов, чтобы указать сертификат, используемый для подписи двоичных файлов службы. При обновлении этого сертификата необходимо освободить более новую версию драйвера ELAM с обновленными хэшами сертификатов.

### <a name="secondary-signature-optional"></a>Вторичная подпись (необязательно)

Поставщики антивредоносных программ имеют возможность настроить частный ЦС и использовать сертификаты из этого ЦС для подписания двоичных файлов службы защиты от вредоносных программ как вторичной подписи. Основное преимущество использования частного ЦС заключается в том, что он позволяет поставщикам создавать сертификаты со специализированным свойством EKU, которое можно использовать для различения нескольких продуктов одного поставщика. Это также сокращает необходимость обновления драйвера ELAM из-за истечения срока действия сертификата, так как сертификаты частного ЦС обычно имеют более длинные даты окончания срока действия.

Обратите внимание, что если двоичные файлы службы подписаны частными сертификатами ЦС, двоичные файлы должны также иметь двойную подпись с существующими сертификатами Authenticode. Если двоичные файлы не подписаны хорошо известным доверенным центром сертификации (например, VeriSign), пользователь компьютера не имеет уверенности в двоичных файлах, так как не может доверять частному центру сертификации. Двойное подписывание двоичных файлов с помощью существующего сертификата Authenticode также позволяет запускать двоичные файлы в операционных системах нижнего уровня.

Дополнительные сведения о настройке и установке центра сертификации см. в статье о настройке центра [сертификатов](/previous-versions/windows/desktop/ms755466(v=vs.85)) и [установке](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj125375(v=ws.11))ЦС.

> [!Note]  
> Для обеспечения совместимости с Windows Vista или Windows XP (или Windows 7 без исправления SHA2) можно использовать параметр "/АС" при подписывании двоичных файлов с [SignTool.exe](/windows/desktop/SecCrypto/signtool) с помощью хэшей файлов и страниц SHA256. При этом подпись будет добавлена в файл в качестве дополнительной подписи. SHA1. Сначала подпишите файл, так как Windows XP, Windows Vista и Windows 7 увидят только первую подпись.

 

### <a name="dll-signing-requirements"></a>Требования к подписывания библиотек DLL

Как упоминалось ранее, все библиотеки DLL, не относящиеся к Windows, которые загружаются в защищенную службу, должны быть подписаны тем же сертификатом, который использовался для подписания службы защиты от вредоносных программ.

### <a name="catalog-signing"></a>Подписывание каталога

Поставщики борьбы с вредоносными программами могут включать пакеты, разработанные другими компаниями, без обновления двоичных сигнатур. Это можно сделать, включив в каталог двоичные файлы, подписанные с помощью сертификата Authenticode. для этого необходимо выполнить следующие действия.

1. Создание каталога с помощью [макекат](/windows/desktop/SecCrypto/makecat)
2. Добавление всех двоичных файлов без соответствующей подписи в каталог
3. Подпишите каталог с помощью сертификата Authenticode, как и любой другой двоичный файл.
4. Используйте функцию [добавления каталога](/windows/desktop/api/Mscat/nf-mscat-cryptcatadminaddcatalog) , чтобы включить каталог в приложение.

Если целостность кода распространяется на пакеты без соответствующей сигнатуры, она будет искать каталог с утвержденной подписью. Этот каталог будет найден при условии, что эти шаги выполнены и устанавливаются вместе с приложением.


## <a name="resource-file-info"></a>Сведения о файле ресурсов

Файл ресурсов должен быть создан и связан с драйвером ELAM. Хэш сертификата вместе с другими сведениями о сертификате необходимо добавить в файл ресурсов.

Раздел ресурсов должен быть в следующем макете, чтобы система успешно извлека ресурсы из двоичного образа и проверяла сведения о внедренном сертификате.

``` syntax
MicrosoftElamCertificateInfo  MSElamCertInfoID
{
      3, // count of entries
      L”CertHash1\0”,
      Algorithm,
      L”EKU1\0”,
      L”CertHash2\0”,
      Algorithm,
      L”\0”, //No EKU for cert hash 2
      L”CertHash3\0”,
      Algorithm,
      L”EKU3a;EKU3b;EKU3c\0”,  //multiple EKU entries supported (max: 3)
}
```

Дополнительные сведения о файле ресурсов, определяемом пользователем, см. в разделе [определяемый пользователем ресурс](/windows/desktop/menurc/user-defined-resource).

### <a name="certhash"></a>CertHash

Хэш сертификата, который используется для подписи службы защиты от вредоносных программ. Для получения хэша можно использовать средство CertMgr.exe, которое поставляется в Windows SDK.

``` syntax
certmgr.exe –v <path to the signed file>
```

Пример:

![хэш сертификата службы с защитой от вредоносных программ (certhash)](images/cert-hash-example.png)

### <a name="algorithm"></a>Алгоритм

Значение алгоритма представляет собой алгоритм сертификата. Поддерживаются следующие значения алгоритма:

<dl> 0x8004 — SHA1  
0x800c – SHA256  
0X800d — SHA384  
0x800e — SHA512  
</dl>

Не забудьте включить значение алгоритма (как показано выше), а не фактическое имя алгоритма. Например, если сертификат основан на алгоритме SHA256, включите 0x800c в раздел Resource.

### <a name="eku"></a>EKU

Объект EKU представляет одно свойство расширенного использования ключа (EKU) сертификата. Это необязательный параметр. \\ Если с сертификатом не связано ни одного EKU, необходимо указать "0". Если существует несколько продуктов и служб от одного поставщика антивредоносного по, работающего в одной системе, поставщик антивредоносного по может использовать свойство EKU сертификата частного ЦС, чтобы отличать одну службу от другой. Например, если в системе запущены две службы из одного поставщика антивредоносного по и они подписаны одним и тем же центром сертификации, то служба, которая должна быть запущена как защищенная, может быть подписана с помощью сертификата, выданного центром сертификации, который содержит специальное EKU. Это EKU необходимо добавить в раздел ресурсов. Затем EKU регистрируется системой и связывается с хэшем сертификата для проверки и запуска службы в качестве защищенной.

Обратите внимание, что цепочка сертификатов должна включать EKU для подписывания кода (1.3.6.1.5.5.7.3.3), но это EKU не должно включаться в раздел ресурсов драйвера ELAM.

> [!Note]  
> Если сведения о EKU содержатся в сведениях о сертификате для драйвера ELAM, то при подписывании двоичных файлов необходимо использовать одно и то же EKU.

 

### <a name="count"></a>Count

Если двоичный файл службы защиты от вредоносных программ подписан с помощью сертификата Authenticode, а также сертификата частного ЦС, в раздел ресурсов необходимо добавить только сведения о сертификате частного ЦС.

## <a name="launching-anti-malware-services-as-protected"></a>Запуск служб защиты от вредоносных программ в качестве защищенных

### <a name="registering-the-service"></a>Регистрация службы

Служба защиты от вредоносных программ должна быть зарегистрирована в системе, прежде чем ее можно будет запустить как защищенную. Во время установки программного обеспечения для защиты от вредоносных программ установщик может установить драйвер ELAM и перезагрузить систему для автоматической регистрации службы. Система зарегистрирует службу во время загрузки, извлекая сведения о сертификате из упомянутого выше файла ресурсов, связанного с драйвером ELAM.

На этапе установки настоятельно рекомендуется перезапустить систему для того, чтобы драйвер ELAM загружался и проверял состояние системы. Однако в случаях, когда следует избегать перезагрузки, Windows также предоставляет механизм для установщика защиты от вредоносных программ, который регистрирует службу как защищенную с помощью API.

### <a name="registering-the-service-without-rebooting-the-system"></a>Регистрация службы без перезагрузки системы

Во время установки установщик по борьбе с вредоносными программами может вызвать API [**инсталлеламцертификатеинфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-installelamcertificateinfo) и предоставить обработчик для файла драйвера ELAM. Система открывает драйвер ELAM, вызывает внутренние подпрограммы, чтобы убедиться, что драйвер ELAM правильно подписан, и извлекает сведения о сертификате из раздела ресурсов, связанного с драйвером ELAM. Синтаксис функции см. в разделе [**инсталлеламцертификатеинфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-installelamcertificateinfo).

Пример кода:


```C++
HANDLE FileHandle = NULL;

FileHandle = CreateFile(<Insert Elam driver file name>,
                        FILE_READ_DATA,
                        FILE_SHARE_READ,
                        NULL,
                        OPEN_EXISTING,
                        FILE_ATTRIBUTE_NORMAL,
                        NULL
                        );

if (InstallElamCertificateInfo(FileHandle) == FALSE)
{
    Result = GetLastError();
    goto exitFunc;
}
```



### <a name="starting-the-service-as-protected"></a>Запуск службы как защищенной

Установщик может выполнить следующие действия, чтобы создать, настроить и запустить службу как защищенную:

1.  Вызовите API [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) , чтобы создать объект службы и добавить его в базу данных диспетчера управления СЛУЖБАМИ (SCM).
2.  Вызовите API [**сетсервицеобжектсекурити**](/windows/desktop/api/winsvc/nf-winsvc-setserviceobjectsecurity) , чтобы задать дескриптор безопасности объекта службы, созданного на шаге 1.
3.  Вызовите API [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) , чтобы пометить службу как защищенную, указав новое значение **\_ \_ \_ защищенного перечисления для настройки службы** , которое было добавлено в винсвк. h (начиная с Windows 8.1).

    Пример кода:

    ```C++
    SERVICE_LAUNCH_PROTECTED_INFO Info;
    SC_HANDLE hService;

    Info.dwLaunchProtected = SERVICE_LAUNCH_PROTECTED_ANTIMALWARE_LIGHT;

    hService = CreateService (/* ... */);

    if (ChangeServiceConfig2(hService,
                             SERVICE_CONFIG_LAUNCH_PROTECTED,
                             &Info) == FALSE)
    {
        Result = GetLastError();
    }
    ```

    

4.  Вызовите API [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) , чтобы запустить службу. При запуске службы как защищенной служба SCM проверяет наличие подсистемы целостности кода (CI), чтобы проверить сведения о сертификате. После проверки сведений о сертификате CI службы SCM запускают службу как защищенную.
    1.  Обратите внимание, что этот шаг завершается ошибкой, если вы не зарегистрировали службу путем вызова API [**инсталлеламцертификатеинфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-installelamcertificateinfo) .
    2.  Если служба настроена на автоматический запуск на этапе запуска системы, этот шаг можно избежать и просто перезагрузить систему. Во время перезагрузки система автоматически регистрирует службу (если драйвер ELAM запускается успешно) и запускает службу в защищенном режиме.

### <a name="launching-a-child-process-as-protected"></a>Запуск дочернего процесса в качестве защищенного

Новая модель безопасности также позволяет службам защиты от вредоносных программ запускать дочерние процессы в качестве защищенных. Эти дочерние процессы будут выполняться на том же уровне защиты, что и родительская служба, а их двоичные файлы должны быть подписаны тем же сертификатом, который был зарегистрирован через раздел ресурсов ELAM.

Чтобы служба защиты от вредоносных программ запускала дочерний процесс как защищенный, был предоставлен новый ключ расширенного ключа атрибута, **\_ \_ \_ \_ уровень защиты атрибута** обрабатывающего потока, и его необходимо использовать с API [**упдатепроксреадаттрибуте**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute) . Указатель на значение атрибута **\_ уровня \_ защиты** должен быть передан в API **упдатепроксреадаттрибуте** .

Примечания.

-   Чтобы использовать этот новый атрибут, служба также должна указать в параметре "флаг создания [**процесса" в вызове**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) функции " **создать \_ защищенный \_ процесс** ".
-   Необходимо, чтобы двоичные файлы службы были подписаны с помощью параметра/АК, чтобы включить перекрестные сертификаты, чтобы связать его с известным центром сертификации. Самозаверяющий сертификат без надлежащей цепочки для известного корневого ЦС не будет работать.

Пример кода:


```C++
DWORD ProtectionLevel = PROTECTION_LEVEL_SAME;
SIZE_T AttributeListSize;

STARTUPINFOEXW StartupInfoEx = { 0 };

StartupInfoEx.StartupInfo.cb = sizeof(StartupInfoEx);

if (InitializeProcThreadAttributeList(NULL,
                                      1,
                                      0,
                                      &AttributeListSize) == FALSE)
{
    Result = GetLastError();
    goto exitFunc;
}

StartupInfoEx.lpAttributeList = (LPPROC_THREAD_ATTRIBUTE_LIST) HeapAlloc(
    GetProcessHeap(),
    0,
    AttributeListSize
    );

if (InitializeProcThreadAttributeList(StartupInfoEx.lpAttributeList,
                                      1,
                                      0,
                                      &AttributeListSize) == FALSE)
{
    Result = GetLastError();
    goto exitFunc;
}

if (UpdateProcThreadAttribute(StartupInfoEx.lpAttributeList,
                              0,
                              PROC_THREAD_ATTRIBUTE_PROTECTION_LEVEL,
                              &ProtectionLevel,
                              sizeof(ProtectionLevel),
                              NULL,
                              NULL) == FALSE)
{
    Result = GetLastError();
    goto exitFunc;
}

PROCESS_INFORMATION ProcessInformation = { 0 };

if (CreateProcessW(ApplicationName,
                   CommandLine,
                   ProcessAttributes,
                   ThreadAttributes,
                   InheritHandles,
                   EXTENDED_STARTUPINFO_PRESENT | CREATE_PROTECTED_PROCESS,
                   Environment,
                   CurrentDirectory,
                   (LPSTARTUPINFOW)&StartupInfoEx,
                   &ProcessInformation) == FALSE)
{
    Result = GetLastError();
    goto exitFunc;
}
```



## <a name="updates-and-servicing"></a>Обновления и обслуживание

После запуска службы защиты от вредоносных программ в качестве защищенных другие незащищенные процессы (и даже администраторы) не могут прекращать работу службы. В случае обновления двоичных файлов службы Служба защиты от вредоносных программ должна получить обратный вызов от установщика, чтобы его можно было обслуживать самостоятельно. После остановки службы установщик защиты от вредоносных программ может выполнить обновления, а затем выполнить описанные выше действия в разделе [Регистрация службы](https://www.bing.com/search?q=Registering+the+service) и [Запуск службы в качестве защищенных](#starting-the-service-as-protected) разделов для регистрации сертификата и запуска службы в качестве защищенной.

Обратите внимание, что служба должна гарантировать, что только доверенные вызывающие объекты могут прекращать работу службы. Разрешение ненадежных вызывающих объектов делает это не позволяет защитить службу.

### <a name="unregistering-the-service"></a>Отмена регистрации службы

При удалении защищенной службы она должна пометить себя как незащищенную, вызвав API [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) . Обратите внимание, что поскольку система не позволяет любому незащищенному процессу изменять конфигурацию защищенной службы, вызов [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) должен выполняться самой защищенной службой. После того как служба будет перенастроена для запуска от имени без защиты, программа удаления может просто предпринять соответствующие действия для удаления программного обеспечения для защиты от вредоносных программ из системы.

## <a name="debugging-an-anti-malware-protected-service"></a>Отладка защищенной службы защиты от вредоносных программ

В рамках модели безопасности защищенного процесса другие незащищенные процессы не могут внедрять потоки или записывать в виртуальную память защищенного процесса. Однако отладчик ядра (KD) разрешен для отладки любых процессов, защищенных от вредоносных программ. KD также можно использовать для проверки того, работает ли служба защиты от вредоносных программ как защищенная.

``` syntax
dt –r1 nt!_EPROCESS <Process Address>
+0x67a Protection       : _PS_PROTECTION
      +0x000 Level            : 0x31 '1'
      +0x000 Type             : 0y0001
      +0x000 Signer           : 0y0011
```

Если значение члена *типа* — 0y0001, служба работает как защищенная.

Кроме того, в службе защиты от вредоносных программ разрешены только следующие команды SC:

-   `sc config start=Auto`
-   `sc qc`
-   `sc start`
-   `sc interrogate`
-   `sc sdshow`

Если отладчик присоединен, используйте следующий флаг в реестре для прерывания работы отладчика при загрузке двоичных файлов без знака (или несоответствующих подписанных) в защищенную службу защиты от вредоносных программ.

``` syntax
Key:   HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CI
Value: DebugFlags      REG_DWORD
```

Установите значение **00000400** для прерывания в отладчике при сбое проверки подписи.

> [!Note]  
> Ограничения защищенных процессов:
>
> 1.  Процессы, имеющие пользовательский интерфейс или графический интерфейс пользователя, не могут быть защищены из-за способа, которым ядро блокирует процесс в памяти и не допускает записи в него.
> 2.  До Windows 10, версия 1703 (авторское обновление), защищенные процессы не могут использовать протоколы связи TLS или SSL из-за ограничений совместного использования сертификатов между локальным центром безопасности (LSA) и защищенным процессом.

 

## <a name="resources"></a>Ресурсы

См. также:

-   [Ранний запуск антивредоносного ПО](/windows/desktop/w8cookbook/secured-boot)
-   [Защищенные процессы в Windows Vista](/previous-versions/windows/hardware/download/dn550976(v=vs.85))
-   [Настройка центра сертификации](/previous-versions/windows/desktop/ms755466(v=vs.85))
-   [Установка центра сертификации](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj125375(v=ws.11))
-   [Определяемый пользователем ресурс](/windows/desktop/menurc/user-defined-resource)

В этой статье содержатся ссылки на эти функции Windows API:

-   [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a)
-   [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa)
-   [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea)
-   [**инитиализепроксреадаттрибутелист**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-initializeprocthreadattributelist)
-   [**инсталлеламцертификатеинфо**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-installelamcertificateinfo)
-   [**сетсервицеобжектсекурити**](/windows/desktop/api/winsvc/nf-winsvc-setserviceobjectsecurity)
-   [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea)
-   [**упдатепроксреадаттрибуте**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute)

 

 
