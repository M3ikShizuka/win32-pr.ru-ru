---
description: Описывает процессы для реализации обработчиков событий устройств в реестре.
ms.assetid: 84B12B5C-C179-4124-A1FC-B90D120336BF
title: Регистрация обработчика для события устройства
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 66a13abe8917d93ac6a4801e0c11cb7223da25e362923df229180b8c8e6211ac
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117859603"
---
# <a name="how-to-register-a-handler-for-a-device-event"></a>Регистрация обработчика для события устройства

Обработчики определяют программную часть автоматического запуска. Они определяют значок программного обеспечения и понятное имя, а также компонент модели COM для создания экземпляра и способ инициализации компонента в ответ на событие. Каждый обработчик для определенного события регистрируется как значение под соответствующим ключом **EventHandler** . При обнаружении этого события пользователю предлагается выбрать обработчик из списка всех обработчиков, зарегистрированных для этого события.

## <a name="instructions"></a>Инструкции


Обработчики и связанные с ними значения определяются в разделе \\ **обработчиков** аутоплайхандлерс. Подразделы различаются в зависимости от того, может ли система считывать содержимое устройства напрямую или же устройство предоставляет содержимое системы через собственный интерфейс.

В следующем примере показаны подразделы и значения, используемые для устройства, например цифровая видеокамера или проигрыватель .mp3, который обеспечивает содержимое системы через собственный интерфейс. Пример обработчика называется **myHandler**.

```
HKEY_LOCAL_MACHINE or HKEY_CURRENT_USER
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  AutoplayHandlers
                     Handlers
                        MyHandler
                           Action [REG_SZ] = Play music
                           CLSID [REG_SZ] = {a51f2ed3-634e-4a97-9d55-efcf08e7b32f}
                           DefaultIcon [REG_EXPAND_SZ] = %ProgramFiles%\Windows Media Player\wmplayer.exe,0
                           InitCmdLine [REG_SZ] = /Play
                           ProgID [REG_SZ] = WMP.PlayMusicFiles
                           Provider [REG_SZ] = Windows Media Player
```

> [!Note]  
> Хотя в примере показаны как идентификатор ProgID, так и значение идентификатора класса (CLSID), на практике эти значения являются взаимоисключающими, чтобы присутствовал только один или другой. Значение ProgID является предпочтительным. В зависимости от того, какой из них используется, он должен указывать на COM-компонент, реализующий интерфейс [**ихвевенсандлер**](/windows/desktop/api/Shobjidl/nn-shobjidl-ihweventhandler) .

 

Значение действия можно ввести как литеральное значение, например "воспроизвести музыку", как показано в этом примере, или как имя файла со строкой ресурса. Можно также ввести значение поставщика в виде литерального значения или имени файла с помощью строки ресурса. Автозапуск объединяет значение действия и значение поставщика со словом «using», чтобы создать дружественный заголовок, отображаемый в пользовательском интерфейсе. в этом примере полученный заголовок — «воспроизводить музыку с помощью проигрыватель Windows Media».

Значение Дефаултикон указывает на ICO-файл или ресурс в двоичном файле. Если числовое значение, следующее за именем двоичного файла, равно нулю или больше, то это значение индекса значка в этом двоичном файле. Если это отрицательное значение, то это идентификатор ресурса значка. Рекомендуется использовать отрицательные значения индекса. В случае ICO-файла значение не требуется. Рекомендуется использовать переменные среды в пути.

Значение Иниткмдлине передается без изменений с помощью метода [**ихвевенсандлер:: Initialize**](/windows/desktop/api/Shobjidl/nf-shobjidl-ihweventhandler-initialize) перед вызовом других методов.

В следующем примере показаны подразделы и значения, используемые для устройства, которое можно прочитать напрямую, например дисковод компакт-дисков или другой съемный диск. Опять же, пример обработчика называется **myHandler**.

```
HKEY_LOCAL_MACHINE or HKEY_CURRENT_USER
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  AutoplayHandlers
                     Handlers
                        MyHandler
                           Action [REG_SZ] = @%systemroot%\System32\wiaacmgr.exe,-276
                           DefaultIcon [REG_EXPAND_SZ] = %systemroot%\System32\wiaacmgr.exe,-2
                           InvokeProgID [REG_SZ] = WIA.AutoPlayDropHandler
                           InvokeVerb [REG_SZ] = open
                           Provider [REG_SZ] = @%systemroot%\System32\wiaacmgr.exe,-101
```

В этом примере значения действия и поставщика отображаются в виде имени файла со строкой ресурса, а не литеральными значениями, но строки, на которые они ссылаются, используются одинаковым образом. Они объединяются со словом «using», чтобы сформировать понятный заголовок, как описано выше.

Значения Инвокепрогид и Инвокеверб заменяют идентификаторы CLSID, Иниткмдлине и ProgID. Значения Инвокепрогид и Инвокеверб соответствуют именам ключей, которые находятся в **\_ \_ корневом каталоге классов hKey**, как показано в следующей записи реестра. Этот набор примеров ключей соответствует конкретному примеру обработчика, описанному выше.

```
HKEY_CLASSES_ROOT
   WIA.AutoplayDropHandler
      shell
         open
            DropTarget
               Clsid = {F1ABE2B5-C073-4dba-B6EB-FD7A5111DD8F}
```

Функция [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) использует CLSID для реализации соответствующего приложения.

Определив обработчик в любом из этих двух способов, необходимо зарегистрировать его для определенного события. Это можно сделать, указав имя обработчика в качестве значения для ключа этого события в разделе **евенсандлерс**. В следующем примере показано, как зарегистрировать **myHandler** в качестве обработчика для события женерикволумеарривал. Ему не назначено значение данных.

```
HKEY_LOCAL_MACHINE or HKEY_CURRENT_USER
   SOFTWARE
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  AutoplayHandlers
                     EventHandlers
                        GenericVolumeArrival
                           MyHandler [REG_SZ]
```

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**ихвевенсандлер**](/windows/desktop/api/Shobjidl/nn-shobjidl-ihweventhandler)
</dt> <dt>

[**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance)
</dt> </dl>

 

 
