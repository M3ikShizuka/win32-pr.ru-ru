---
description: Объект данных является центральным для всех операций передачи данных оболочки.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Объект данных оболочки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 812e5c18f5a2120fbf22682c6e768dc005128630
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262911"
---
# <a name="shell-data-object"></a>Объект данных оболочки

Объект данных является центральным для всех операций передачи данных оболочки. В основном это контейнер для хранения передаваемых данных. Однако целевой объект также может взаимодействовать с объектом данных, чтобы упростить некоторые специализированные типы передачи данных оболочки, такие как оптимизированные перемещения. В этом разделе приводятся общие сведения о работе объектов данных оболочки, их создании в источнике и о том, как они обрабатываются целевым объектом. Подробное описание использования объектов данных для перемещения различных типов данных оболочки см. в разделе [Обработка сценариев передача данных оболочки](datascenarios.md).

-   [Как работают объекты данных](#how-data-objects-work)
    -   [Форматы буфера обмена](#clipboard-formats)
    -   [Структура ФОРМАТЕТК](#formatetc-structure)
    -   [Структура СТГМЕДИУМ](#stgmedium-structure)
-   [Как источник создает объект данных](#how-a-source-creates-a-data-object)
    -   [Добавление объекта глобальной памяти в объект данных](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [Реализация интерфейса IDataObject](#implementing-idataobject)
    -   [Реализация Идропсаурце](#implementing-idropsource)
-   [Обработка объектом данных целевым объектом](#how-a-target-handles-a-data-object)
    -   [Извлечение данных оболочки из объекта данных](#extracting-shell-data-from-a-data-object)
    -   [Реализация интерфейс IDropTarget](#implementing-idroptarget)
-   [Использование вспомогательного объекта перетаскивания](#using-the-drag-and-drop-helper-object)
    -   [Использование интерфейса Идрагсаурцехелпер](#using-the-idragsourcehelper-interface)
    -   [Использование интерфейса Идроптаржеселпер](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a>Как работают объекты данных

Объекты данных являются объектами модели COM, созданными источником данных для перемещения данных в целевой объект. Обычно они содержат более одного элемента данных. Для этого используется две причины.

-   Хотя практически любой тип данных можно передать с помощью объекта данных, источник, как правило, не знает, какой тип данных может принимать целевой объект. Например, данные могут быть частью форматированного текстового документа. Хотя целевой объект может обрабатывать сложные сведения о форматировании, он может также принимать только текст в формате ANSI. По этой причине объекты данных часто содержат одни и те же данные в нескольких разных форматах. Затем целевой объект может извлекать данные в формате, который может быть обработано.
-   Объекты данных также могут содержать вспомогательные элементы данных, не являющиеся версиями исходных данных. Этот тип элементов данных обычно предоставляет дополнительные сведения о операции обмена данными. Например, оболочка использует вспомогательные элементы данных, чтобы указать, следует ли копировать или перемещать файл.

### <a name="clipboard-formats"></a>Форматы буфера обмена

Каждый элемент данных в объекте данных имеет связанный формат, обычно называемый *форматом буфера обмена*. Существует ряд стандартных форматов буфера обмена, объявленных в файле WinUser. h, которые соответствуют часто используемым типам данных. Форматы буфера обмена — это целые числа, но обычно они называются их эквивалентными именами, которые имеют форму CF \_ *xxx*. Например, формат буфера обмена для текста ANSI — текст CF \_ .

Приложения могут расширять диапазон доступных форматов буфера обмена, определяя закрытые форматы. Чтобы определить частный формат, приложение вызывает [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) со строкой, определяющей формат. Целое число без знака, возвращаемое функцией, является допустимым значением формата, которое может использоваться так же, как стандартный формат буфера обмена. Однако исходный и целевой объекты должны зарегистрировать формат, чтобы его можно было использовать. За одним исключением —[CF \_ HDROP](clipboard.md)— форматы буфера обмена, используемые для перемещения данных оболочки, определяются как частные форматы. Они должны быть зарегистрированы исходным и целевым объектом, прежде чем их можно будет использовать. Описание доступных форматов буфера обмена оболочки см. в разделе форматы буфера обмена оболочки.

Хотя существуют некоторые исключения, объекты данных обычно содержат только один элемент данных для каждого поддерживаемого формата буфера обмена. Эта корреляция "один к одному" между форматом и данными позволяет использовать значение формата в качестве идентификатора для связанного элемента данных. Фактически, при обсуждении содержимого объекта данных конкретный элемент данных обычно называется "форматом" и на него ссылается имя формата. Например, такие фразы, как «извлечение \_ текстового формата CF...» обычно используются при обсуждении текстового элемента данных ANSI объекта данных.

Когда целевой объект перетаскивания получает указатель на объект данных, цель перетаскивания перечисляет доступные форматы, чтобы определить, какие типы данных доступны. Затем он запрашивает один или несколько доступных форматов и извлекает данные. Конкретный способ, которым целевой объект извлекает данные оболочки из объекта данных, зависит от формата. Это подробно описано в разделе [Обработка объектом данных целевым](#how-a-target-handles-a-data-object)объектом.

При простой передаче данных в буфер обмена данные помещаются в глобальный объект памяти. Адрес этого объекта помещается в буфер обмена вместе с его форматом. Формат буфера обмена сообщает целевому объекту, какой тип данных будет найден по соответствующему адресу. Хотя простые передачи в буфере обмена просты в реализации:

-   Объекты данных предоставляют гораздо более гибкий способ передачи данных.
-   Объекты данных лучше подходят для передачи больших объемов данных.
-   Объекты данных должны использоваться для перемещения данных с помощью операции перетаскивания.

По этим причинам все передачи данных в оболочке используют объекты данных. При использовании объектов данных форматы буфера обмена не используются напрямую. Вместо этого элементы данных определяются обобщением формата буфера обмена, структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) .

### <a name="formatetc-structure"></a>Структура ФОРМАТЕТК

Структура [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) является расширенной версией формата буфера обмена. Структура **форматетк** , используемая для передачи данных оболочки, имеет следующие характеристики.

-   Элемент данных по-прежнему определяется форматом буфера обмена в элементе **кфформат** .
-   Передаваемые данные не ограничиваются глобальными объектами памяти. Элемент **тимед** используется для указания механизма обмена данными, содержащегося в связанной структуре [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) . Для него задано одно из значений [**тимед \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) .
-   Оболочка использует элемент **Линдекс** с его форматом [кфстр \_ филеконтентс](clipboard.md) , чтобы разрешить объекту данных содержать более одного элемента данных в каждом формате. Обсуждение того, как использовать этот формат, см. в разделе *Использование формата кфстр \_ Филеконтентс для извлечения данных из* раздела [Обработка передача данных сценариев оболочки](datascenarios.md).
-   Для члена **дваспект** обычно задается \_ содержимое дваспект. Однако в Шлобж. h есть три значения, которые можно использовать для обмена данными в оболочке. 

    |                     |                                                                                                   |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | \_копирование дваспект      | Используется для указания того, что формат представляет копию данных.                                   |
    | Ссылка на ДВАСПЕКТ \_      | Используется для указания того, что формат представляет ярлык данных.                               |
    | ДВАСПЕКТ ( \_ SHORTNAME) | Используется с \_ форматом CF HDROP для запроса пути к файлу с именами, сокращенными до формата 8,3. |

    

     

-   Элемент **ПТД** не используется для передачи данных оболочки и обычно имеет значение **null**.

### <a name="stgmedium-structure"></a>Структура СТГМЕДИУМ

Структура [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) предоставляет доступ к передаваемым данным. Для данных оболочки поддерживаются три механизма обмена данными:

-   Глобальный объект памяти.
-   Интерфейс [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .
-   Интерфейс [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .

Элемент **тимед** структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) — это значение [**тимед \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) , идентифицирующее механизм обмена данными. Второй элемент — это указатель, используемый целевым объектом для извлечения данных. Указатель может быть одним из множества типов, в зависимости от значения **тимед** . Три значения **тимед** , используемые для передачи данных оболочки, приведены в следующей таблице вместе с соответствующим именем **стгмедиум** элемента.



| Значение тимед     | Имя участника | Описание                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ТИМЕД \_ хглобал  | **хглобал** | Указатель на объект глобальной памяти. Этот тип указателя обычно используется для передачи небольших объемов данных. Например, оболочка использует объекты глобальной памяти для обмена короткими текстовыми строками, такими как имена файлов или URL-адреса.                                                                                    |
| ТИМЕД \_ ISTREAM  | **пстм**    | Указатель на интерфейс [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) . Этот тип указателя предпочтителен для большинства операций передачи данных оболочки, так как он требует относительно мало памяти по сравнению с ТИМЕД \_ хглобал. Кроме того, \_ механизму обмена данными тимед ISTREAM не требуется, чтобы источник хранят свои данные каким бы то ни было определенным образом. |
| ТИМЕД \_ ISTORAGE | **пстг**    | Указатель на интерфейс [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) . Целевой объект вызывает методы интерфейса для извлечения данных. Как и в ТИМЕД \_ ISTREAM, этот тип указателя требует относительно мало памяти. Однако поскольку ТИМЕД \_ ISTORAGE менее гибок, чем тимед \_ ISTREAM, он не так часто используется.                  |



 

## <a name="how-a-source-creates-a-data-object"></a>Как источник создает объект данных

Когда пользователь инициирует передаваемые данные оболочки, источник отвечает за создание объекта данных и его загрузку с данными. Следующая процедура обобщает процесс:

1.  Вызовите [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) , чтобы получить допустимое значение формата буфера обмена для каждого формата оболочки, который будет включаться в объект данных. Помните, [что \_ HDROP CF](clipboard.md) уже является допустимым форматом буфера обмена и не требует регистрации.
2.  Для каждого формата, который должен быть передан, следует либо поместить связанные данные в глобальный объект памяти, либо создать объект, предоставляющий доступ к этим данным через интерфейс [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) или [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) . Интерфейсы **IStream** и **IStorage** создаются с помощью стандартных методов COM. Обсуждение способов управления объектами глобальной памяти см. в разделе [Добавление объекта глобальной памяти в объект данных](#how-to-add-a-global-memory-object-to-a-data-object).
3.  Создайте структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) и [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) для каждого формата.
4.  Создайте экземпляр объекта данных.
5.  Загрузите данные в объект данных, вызвав метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) для каждого поддерживаемого формата и передав структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) и [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) формата.
6.  При передаче данных из буфера обмена вызовите [**олесетклипбоард**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) , чтобы поместить указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных в буфер обмена. Для перемещения с помощью перетаскивания инициируйте *цикл перетаскивания* путем вызова [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop). Указатель **IDataObject** будет передан в цель перетаскивания при удалении данных, завершая цикл перетаскивания.

Теперь объект данных готов к передаче в цель. Для передачи данных из буфера обмена объект просто удерживается, пока целевой объект не запросит его, вызвав [**олежетклипбоард**](/windows/win32/api/ole2/nf-ole2-olegetclipboard). Для передачи данных при перетаскивании объект данных отвечает за создание значка для представления данных и их перемещение по мере того, как пользователь перемещает курсор. Пока объект находится в цикле перетаскивания, источник получает сведения о состоянии через свой интерфейс [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) . Дополнительные сведения см. в статье [Реализация идропсаурце](#implementing-idropsource).

Источник не получает уведомления, если объект данных извлекается из буфера обмена целевым объектом. При удалении объекта в целевой объект с помощью операции перетаскивания функция [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) , которая была вызвана для инициации цикла перетаскивания, вернет.

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a>Добавление объекта глобальной памяти в объект данных

Многие форматы данных оболочки представлены в виде объекта глобальной памяти. Используйте следующую процедуру, чтобы создать формат, содержащий объект глобальной памяти, и загрузить его в объект данных:

1.  Создайте структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) . Задайте для элемента **кфформат** соответствующее значение формата буфера обмена, а для элемента **тимед** — тимед \_ хглобал.
2.  Создайте структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) . Задайте для элемента **тимед** значение тимед \_ хглобал.
3.  Создайте объект глобальной памяти, вызвав [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) для размещения блока памяти подходящего размера.
4.  Назначьте блок данных для передачи в адрес, возвращенный [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).
5.  Назначьте адрес объекта глобальной памяти элементу **хглобал** структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .
6.  Загрузите формат в объект данных, вызвав [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) и передав структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) и [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , созданные на предыдущих шагах.

Следующий пример функции создает объект глобальной памяти, содержащий значение **DWORD** , и загружает его в объект данных. Параметр **пдтобж** — это указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных, **CF** — это значение формата буфера обмена, а **DW** — это значение данных.


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a>Реализация интерфейса IDataObject

[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) является основным интерфейсом объекта данных. Он должен быть реализован всеми объектами данных. Он используется как источником, так и целевым объектом для различных целей, в том числе:

-   Загрузка данных в объект данных.
-   Извлечение данных из объекта данных.
-   Определение типов данных, которые находятся в объекте данных.
-   Предоставление обратной связи с объектом данных в результате передаваемых данных.

[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) поддерживает ряд методов. В этом разделе описывается, как реализовать три наиболее важных метода для объектов данных оболочки, [SetData](#setdata-method), [енумформатетк](#enumformatetc-method)и [GetData](#getdata-method). Обсуждение других методов см. в справочнике по **IDataObject** .

### <a name="setdata-method"></a>SetData - метод

Основная функция метода [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) заключается в том, чтобы разрешить источнику загрузку данных в объект данных. Для каждого включаемого формата источник создает структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) , которая определяет формат и структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) для хранения указателя на данные. Затем источник вызывает метод **IDataObject:: SetData** объекта и передается в структурах **форматетк** и **стгмедиум** формата. Метод должен сохранять эти сведения, чтобы они были доступны, когда целевой объект вызывает метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) для извлечения данных из объекта.

Однако при передаче файлов оболочка часто помещает данные для каждого файла в отдельный формат [ \_ филеконтентс кфстр](clipboard.md) . Чтобы отличить различные файлы, элементу **Линдекс** в структуре [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) каждого файла присваивается значение индекса, идентифицирующее конкретный файл. Реализация [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) должна поддерживать хранение нескольких \_ форматов кфстр филеконтентс, которые отличаются только их членами **Линдекс** .

Пока курсор находится над целевым окном, цель может использовать [вспомогательный объект перетаскивания](#using-the-drag-and-drop-helper-object) для указания изображения перетаскивания. Вспомогательный объект перетаскивания вызывает метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) для загрузки закрытых форматов в объект данных, используемый для поддержки между процессами. Для поддержки вспомогательного объекта, поддерживающего перетаскивание, реализация **IDataObject:: SetData** должна иметь возможность принимать и сохранять произвольные закрытые форматы.

После удаления данных некоторые типы передачи данных оболочки должны вызывать функцию [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) , чтобы предоставить объекту данных сведения о результате операции удаления. Например, при перемещении файлов с оптимизированной операцией перемещения целевой объект обычно удаляет исходные файлы, но это не является обязательным. Цель информирует объект данных о том, удалили ли они файлы путем вызова функции **IDataObject:: SetData** с форматом [ \_ логикалперформеддропеффект кфстр](clipboard.md) . Существует несколько других [форматов буфера обмена оболочки](clipboard.md) , которые также используются целевым объектом для передачи данных в объект данных. Реализация **IDataObject:: SetData** должна иметь возможность распознать эти форматы и ответить соответствующим образом. Дополнительные сведения см. в статье [Обработка сценариев передача данных оболочки](datascenarios.md).

### <a name="enumformatetc-method"></a>Метод Енумформатетк

Когда цель получает объект данных, она обычно вызывает [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) , чтобы определить, какие форматы содержит объект. Метод создает объект перечисления OLE и возвращает указатель на интерфейс [**иенумформатетк**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) объекта. Затем целевой объект использует интерфейс для перечисления доступных форматов.

Объект перечисления всегда должен перечислять доступные форматы в порядке их качества, начиная с наилучшего. Относительное качество форматов определяется источником перетаскивания. Как правило, форматы самого высокого качества содержат самые широкие и наиболее полные данные. Например, 24-разрядное изображение, как правило, будет считаться более высоким качеством, чем серая версия этого изображения. Причина перечисления форматов в порядке их качества заключается в том, что целевые объекты обычно перечисляются до тех пор, пока они не получат поддерживаемый формат, а затем используют этот формат для извлечения данных. Для этой процедуры, чтобы получить наилучший доступный формат, который может поддерживаться целью, необходимо перечислить форматы в порядке их качества.

Объект перечисления для данных оболочки реализуется во многом так же, как и для других типов обмена данными, с одним заметным исключением. Поскольку объекты данных обычно содержат только один элемент данных в каждом формате, они обычно перечисляют каждый формат, который передается в [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata). Однако, как обсуждалось в разделе [метод SetData](#setdata-method) , объекты данных оболочки могут содержать несколько форматов [кфстр \_ филеконтентс](clipboard.md) .

Так как для интерфейса [**IDataObject:: енумформатетк**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) можно разрешить целевому объекту определять, какие типы данных присутствуют, нет необходимости перечислять более одного формата [ \_ филеконтентс кфстр](clipboard.md) . Если целевому объекту необходимо узнать, сколько из этих форматов содержит объект данных, целевой объект может получить эту информацию из соответствующего \_ формата кфстр филедескриптор. Более подробное описание реализации интерфейса **IDataObject:: енумформатетк** см. в справочной документации по методу.

### <a name="getdata-method"></a>Метод GetData

Цель вызывает метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) для извлечения определенного формата данных. Целевой объект определяет формат, передавая соответствующую структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) . **IDataObject:: GetData** возвращает структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) формата.

Целевой объект может задать для элемента **тимед** структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) конкретное значение тимед \_ *xxx* , чтобы указать, какой механизм переноса данных будет использоваться для извлечения данных. Однако целевой объект также может сделать более общий запрос и позволить объекту данных принять решение. Чтобы задать для объекта данных механизм обмена данными, целевой объект устанавливает все \_ поддерживаемые им значения тимед *xxx* . [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) выбирает один из этих механизмов обмена данными и возвращает соответствующую структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) . Например, **тимед** обычно имеет значение тимед \_ хглобал \| тимед \_ ISTREAM \| тимед \_ ISTORAGE, чтобы запросить любой из трех механизмов обмена данными оболочки.

> [!Note]  
> Поскольку может существовать несколько форматов [кфстр \_ филеконтентс](clipboard.md) , члены **Кфформат** и **тимед** структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) недостаточно, чтобы указать, какая [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) структура [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) должна возвращать. Для \_ формата ФИЛЕКОНТЕНТС Кфстр **IDataObject:: GetData** должен также изучить элемент **Линдекс** структуры **форматетк** , чтобы получить правильную структуру **стгмедиум** .

 

Формат [кфстр \_ индраглуп](clipboard.md) помещается в объекты данных, чтобы разрешить целевым объектам проверять состояние цикла перетаскивания, избегая интенсивного отображения данных объекта. Данные формата — это значение **типа DWORD** , равное ненулевому значению, если объект данных находится в пределах цикла перетаскивания. Значение данных формата задается равным нулю, если данные были удалены. Если целевой объект запрашивает этот формат и не был загружен источником, метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) должен реагировать так, как если бы источник загрузил формат со значением, равным нулю.

Пока курсор находится над целевым окном, цель может использовать [вспомогательный объект перетаскивания](#using-the-drag-and-drop-helper-object) для указания изображения перетаскивания. Вспомогательный объект перетаскивания вызывает метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) для загрузки закрытых форматов в объект данных, используемый для поддержки между процессами. Позже он вызывает метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) , чтобы получить их. Для поддержки вспомогательного объекта перетаскивания реализация объекта данных оболочки должна иметь возможность возвращать произвольные закрытые форматы при их запросе.

### <a name="implementing-idropsource"></a>Реализация Идропсаурце

Источник должен создать объект, предоставляющий интерфейс [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) . Этот интерфейс позволяет источнику обновить *изображение перетаскивания* , указывающее текущую позицию курсора, и предоставить отзыв системе о том, как завершить операцию перетаскивания. **Идропсаурце** имеет два метода: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) и [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).

### <a name="givefeedback-method"></a>GiveFeedback - метод

В цикле перетаскивания источник перетаскивания отвечает за отслеживание положения курсора и отображение соответствующего изображения перетаскивания. Однако в некоторых случаях может потребоваться изменить внешний вид изображения перетаскивания, если оно находится над окном назначения перетаскивания.

Когда курсор попадает в целевое окно или покидает его, а перемещается в целевое окно, система периодически вызывает интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) целевого объекта. Целевой объект реагирует на значение [**дропеффект**](../com/dropeffect-constants.md) , которое перенаправляется в источник с помощью метода [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) . При необходимости источник может изменить внешний вид курсора на основе значения **дропеффект** . Дополнительные сведения см. в справочниках по **GiveFeedback** и [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .

### <a name="querycontinuedrag-method"></a>QueryContinueDrag - метод

Этот метод вызывается при изменении состояния кнопки мыши или клавиатуры, когда объект данных находится в цикле перетаскивания. Он уведомляет источник о нажатии клавиши ESC и предоставляет текущее состояние клавиш с модификатором клавиатуры, таких как CTRL или SHIFT. Возвращаемое значение метода [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) указывает одно из трех действий:

-   \_ОК. Продолжить операцию перетаскивания
-   \_Удаление DRAGDROP \_ . Удалите данные. Затем система вызывает метод [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) целевого объекта.
-   DRAGDROP \_ S \_ Отмена. Завершите цикл перетаскивания без удаления данных. Это значение обычно возвращается при нажатии клавиши ESCAPE.

Дополнительные сведения см. в справочниках по [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) и [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .

## <a name="how-a-target-handles-a-data-object"></a>Обработка объектом данных целевым объектом

Цель получает объект данных, когда он либо получает объект данных из буфера обмена, либо отбрасывается пользователем в целевое окно. Затем целевой объект может извлекать данные из объекта данных. При необходимости цель также может уведомлять объект данных о результате операции. Прежде чем передавать данные оболочки, цель перетаскивания должна подготовиться для выполнения операции:

1.  Цель должна вызвать [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) , чтобы получить допустимое значение формата буфера обмена для всех форматов оболочки, отличных от [CF \_ HDROP](clipboard.md), которые могут быть добавлены в объект данных. CF \_ HDROP уже является допустимым форматом буфера обмена и не требует регистрации.
2.  Для поддержки операции перетаскивания целевой объект должен реализовывать интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) и регистрировать целевое окно. Чтобы зарегистрировать целевое окно, целевой объект вызывает [**регистердрагдроп**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) и передает маркер окна и указатель интерфейса **интерфейс IDropTarget** .

Для перемещений из буфера обмена целевой объект не получает уведомления о том, что в буфере обмена помещены объекты данных. Как правило, приложение уведомляет о том, что объект находится в буфере обмена с помощью действия пользователя, например нажатием кнопки Вставить на панели инструментов приложения. Затем целевой объект получает указатель [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных из буфера обмена путем вызова [**олежетклипбоард**](/windows/win32/api/ole2/nf-ole2-olegetclipboard). Для передачи данных с помощью перетаскивания система использует интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) целевого объекта для предоставления целевой информации о ходе передачи данных:

-   Система вызывает [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) , когда курсор попадает в целевое окно.
-   Система периодически вызывает [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) по мере прохождения курсора в целевом окне, чтобы предоставить целевой объект текущей позиции курсора.
-   Система вызывает [**интерфейс IDropTarget::D раглеаве**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) , когда курсор покидает целевое окно.
-   Система вызывает [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) , когда пользователь удаляет объект данных в целевом окне.

Обсуждение реализации этих методов см. в разделе [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).

При удалении данных [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) предоставляет целевой объект с указателем на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных. Затем целевой объект использует этот интерфейс для извлечения данных из объекта данных.

### <a name="extracting-shell-data-from-a-data-object"></a>Извлечение данных оболочки из объекта данных

После удаления или извлечения объекта данных из буфера обмена целевой объект может извлекать необходимые данные. Первым шагом процесса извлечения обычно является перечисление форматов, содержащихся в объекте данных:

-   Вызовите [**IDataObject:: енумформатетк**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc). Объект данных создает стандартный объект перечисления OLE и возвращает указатель на его интерфейс [**иенумформатетк**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) .
-   Используйте методы [**иенумформатетк**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) для перечисления форматов, содержащихся в объекте данных. Эта операция обычно получает одну структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) для каждого формата, который содержит объект. Однако объект перечисления обычно возвращает только одну структуру **форматетк** для формата [кфстр \_ филеконтентс](clipboard.md) , независимо от того, сколько таких форматов содержится в объекте данных.
-   Выберите один или несколько форматов для извлечения и сохраните их структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) .

Чтобы получить определенный формат, передайте связанную структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) в [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata). Этот метод возвращает структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , которая предоставляет доступ к данным. Чтобы указать определенный механизм обмена данными, установите значение **тимед** структуры **форматетк** в соответствующее значение тимед \_ *xxx* . Чтобы задать для объекта данных способ выбора механизма обмена данными, целевой объект устанавливает значения ТИМЕД \_ *xxx* для каждого механизма обмена данными, который может быть обработано целевым объектом. Объект данных выбирает один из этих механизмов обмена данными и возвращает соответствующую структуру **стгмедиум** .

Для большинства форматов целевой объект может получить данные, передав структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) , полученную при перечислении доступных форматов. Единственным исключением из этого правила является [кфстр \_ филеконтентс](clipboard.md). Поскольку объект данных может содержать несколько экземпляров этого формата, структура **форматетк** , возвращаемая перечислителем, может не соответствовать конкретному формату, который необходимо извлечь. Помимо указания членов **кфформат** и **тимед** , необходимо также задать для элемента **Линдекс** значение индекса файла. Дополнительные сведения см. в разделе *Использование формата кфстр \_ Филеконтентс для извлечения данных из файла* , посвященного [обработке сценариев передача данных оболочки](datascenarios.md) .

Процесс извлечения данных зависит от типа указателя, содержащегося в возвращаемой структуре [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) . Если структура содержит указатель на интерфейс [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) или [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) , используйте методы интерфейса для извлечения данных. Процесс извлечения данных из глобального объекта памяти обсуждается в следующем разделе.

### <a name="extracting-a-global-memory-object-from-a-data-object"></a>Извлечение объекта глобальной памяти из объекта данных

Многие форматы данных оболочки представлены в виде объекта глобальной памяти. Следующая процедура используется для извлечения формата, содержащего объект глобальной памяти из объекта данных, и назначения его данных локальной переменной:

1.  Создайте структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) . Задайте для элемента **кфформат** соответствующее значение формата буфера обмена, а для элемента **тимед** — тимед \_ хглобал.
2.  Создайте пустую структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .
3.  Вызовите [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)и передайте указатели на структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) и [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .

    Когда функция [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) возвращает значение, структура [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) будет содержать указатель на глобальный объект памяти, содержащий данные.

4.  Назначьте данные локальной переменной, вызвав [**глобаллокк**](/windows/win32/api/winbase/nf-winbase-globallock) и передав элемент **хглобал** структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .
5.  Вызовите [**глобалунлокк**](/windows/win32/api/winbase/nf-winbase-globalunlock) , чтобы снять блокировку объекта глобальной памяти.
6.  Вызовите [**релеасестгмедиум**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) , чтобы освободить глобальный объект памяти.

> [!Note]  
> Для освобождения объекта глобальной памяти, а не [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree), необходимо использовать [**релеасестгмедиум**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) .

 

В следующем примере показано извлечение значения **DWORD** , хранящегося в виде объекта глобальной памяти, из объекта данных. Параметр **пдтобж** является указателем на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных, **CF** — это формат буфера обмена, который определяет нужные данные, а **пдваут** используется для возвращения значения данных.


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a>Реализация интерфейс IDropTarget

Система использует интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) для связи с целевым объектом, пока курсор находится над целевым окном. Ответы целевого объекта перенаправляются в источник через его интерфейс [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) . В зависимости от ответа источник может изменить значок, представляющий данные. Если цель перетаскивания должна указать значок данных, это можно сделать, создав [вспомогательный объект перетаскивания](#using-the-drag-and-drop-helper-object).

С помощью обычных операций перетаскивания целевой объект сообщает объекту данных о результате операции, устанавливая для параметра *Пдвеффект* [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) соответствующее значение [**дропеффект**](../com/dropeffect-constants.md) . Для объектов данных оболочки целевому объекту может также потребоваться вызов интерфейса [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata). Обсуждение того, как целевые объекты должны отвечать на различные сценарии обмена данными, см. в разделе [Обработка сценариев передача данных оболочки](datascenarios.md).

В следующих разделах кратко описано, как реализовать методы [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)и [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) . Дополнительные сведения см. в справочной документации.

### <a name="dragenter-method"></a>Метод DragEnter

Система вызывает метод [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) , когда курсор попадает в целевое окно. Его параметры предоставляют целевому объекту расположение курсора, состояние клавиш с модификатором клавиатуры, например клавишу CTRL, и указатель на интерфейс [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных. Цель несет ответственность за использование этого интерфейса, чтобы определить, может ли он принимать любой из форматов, содержащихся в объекте данных. Если это возможно, значение *пдвеффект* остается неизменным. Если он не может принимать какие бы то ни было данные из объекта данных, он устанавливает для параметра *пдвеффект* значение дропеффект \_ None. Система передает значение этого параметра интерфейсу [**идропсаурце**](/windows/win32/api/oleidl/nn-oleidl-idropsource) объекта данных, чтобы позволить ему отображать соответствующее изображение перетаскивания.

Целевые объекты не должны использовать метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) для отображения данных оболочки перед их удалением. Полная визуализация данных объекта для каждого такого экземпляра может привести к зависанию курсора перетаскивания. Чтобы избежать этой проблемы, некоторые объекты оболочки содержат формат [кфстр \_ индраглуп](clipboard.md) . Извлекая этот формат, целевые объекты могут проверить состояние цикла перетаскивания и избежать интенсивного отображения данных объекта в памяти. Значение данных формата — **DWORD** , для которого задано ненулевое значение, если объект данных находится в пределах цикла перетаскивания. Значение данных формата задается равным нулю, если данные были удалены.

Если целевой объект может принимать данные из объекта данных, необходимо проверить **грфкэйстате** , чтобы определить, были ли нажаты клавиши CTRL для изменения нормального поведения при перетаскивании. Например, операция по умолчанию обычно является перемещением, но нажатие клавиши CTRL обычно означает операцию копирования.

Пока курсор находится над целевым окном, цель может использовать [вспомогательный объект перетаскивания](#using-the-drag-and-drop-helper-object) для замены изображения перетаскивания объекта данных своим собственным. Если это так, [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) должен вызвать [**Идроптаржеселпер::D ражентер**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) , чтобы передать сведения, содержащиеся в параметрах *DragEnter* , в вспомогательный объект перетаскивания.

### <a name="dragover-method"></a>Метод DragOver

Когда курсор перемещается в целевое окно, система периодически вызывает метод [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) . Его параметры предоставляют целевому объекту расположение курсора и состояние клавиш с модификатором клавиатуры, например клавишу CTRL. **Интерфейс IDropTarget::D раговер** имеет почти те же обязанности, что и [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), и реализации обычно очень похожи.

Если цель использует вспомогательный объект перетаскивания, [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) должен вызывать [**Идроптаржеселпер::D раговер**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) для пересылки сведений, содержащихся в параметрах *DragOver* , в вспомогательный объект перетаскивания.

### <a name="drop-method"></a>Drop, метод

Система вызывает метод [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) , чтобы уведомить целевой объект о том, что пользователь удалил данные, обычно отпустив кнопку мыши. **Интерфейс IDropTarget::D верхнем** имеет те же параметры, что и [**интерфейс IDropTarget::D ражентер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter). Целевой объект обычно отвечает путем извлечения одного или нескольких форматов из объекта данных. По завершении целевой объект должен присвоить параметру *пдвеффект* значение [**дропеффект**](../com/dropeffect-constants.md) , указывающее результат операции. Для некоторых типов передачи данных оболочки целевой объект должен также вызывать метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) , чтобы передать формат с дополнительной информацией о результате операции в объект данных. Подробное обсуждение см. в разделе [Обработка сценариев передача данных оболочки](datascenarios.md).

Если цель использует вспомогательный объект для перетаскивания, [**интерфейс IDropTarget::D верхнем**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) должен вызывать [**идроптаржеселпер::D верхнем**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) для пересылки сведений, содержащихся в параметрах идроптаржеселпер [**::D раговер**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) , в вспомогательный объект перетаскивания.

## <a name="using-the-drag-and-drop-helper-object"></a>Использование вспомогательного объекта перетаскивания

Вспомогательный объект перетаскивания (CLSID \_ DragDropHelper) экспортируется оболочкой, чтобы разрешить целевым объектам указывать изображение перетаскивания, пока оно находится над целевым окном. Чтобы использовать вспомогательный объект для перетаскивания, создайте объект внутрипроцессного сервера, вызвав [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) с идентификатором класса (CLSID) CLSID \_ DragDropHelper. Вспомогательный объект перетаскивания предоставляет два интерфейса, которые используются следующим образом:

-   Интерфейс [**идрагсаурцехелпер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) позволяет цели перетаскивания указать значок, который будет представлять объект данных.
-   Интерфейс [**идроптаржеселпер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) позволяет цели перетаскивания уведомлять объект вспомогательной операции перетаскивания к положению курсора, а также отображать или скрывать значок данных.

### <a name="using-the-idragsourcehelper-interface"></a>Использование интерфейса Идрагсаурцехелпер

Интерфейс [**идрагсаурцехелпер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) предоставляется вспомогательным объектом перетаскивания, чтобы предоставить целевому объекту перетаскивания изображение, которое будет отображаться, пока курсор находится над целевым окном. **Идрагсаурцехелпер** предоставляет два альтернативных способа указания точечного рисунка для использования в качестве изображения перетаскивания:

-   Объекты перетаскивания, которые содержат окно, могут зарегистрировать \_ для него сообщение окна di жетдрагимаже, инициализируя вспомогательный объект перетаскивания с помощью [**идрагсаурцехелпер:: инитиализефромвиндов**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow). Когда целевой объект получает сообщение DI \_ жетдрагимаже, обработчик помещает сведения об точечном рисунке изображения в структуру [**шдрагимаже**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) , которая передается как значение *lParam* сообщения.
-   Цели перетаскивания без окон указывают точечный рисунок при инициализации вспомогательного объекта перетаскивания с помощью [**идрагсаурцехелпер:: инитиализефромбитмап**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).

### <a name="using-the-idroptargethelper-interface"></a>Использование интерфейса Идроптаржеселпер

Этот интерфейс позволяет целевому объекту перетаскивания уведомлять объект вспомогательной операции перетаскивания, когда курсор переходит или выходит из целевого объекта. Пока курсор находится над целевым окном, [**идроптаржеселпер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) позволяет целевому объекту предоставить вспомогательной стороне перетаскивания сведения, получаемые целевым объектом через его интерфейс [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .

Четыре метода [**идроптаржеселпер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) —[**Идроптаржеселпер::D ражентер**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**идроптаржеселпер::D Раглеаве**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**идроптаржеселпер::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)и [**IDropTargetHelper::D верхнем**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)— связаны с методом [**интерфейс IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) с тем же именем. Чтобы использовать вспомогательный объект для перетаскивания, каждый из методов **интерфейс IDropTarget** должен вызывать соответствующий метод **идроптаржеселпер** для пересылки информации в вспомогательный объект перетаскивания. Пятый метод **идроптаржеселпер** , [**Идроптаржеселпер:: Показать**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), уведомляет вспомогательный объект перетаскивания, чтобы показать или скрыть изображение перетаскивания. Этот метод используется при перетаскивании на целевое окно в режиме низкого цветового изображения с глубиной цвета. Она позволяет целевому объекту скрывать изображение перетаскивания во время рисования окна.

 

 
