---
description: Флаги, управляющие поведением вызывающей функции. Используется Шкреатесреад и Шкреатесреадвисхандле. В этих функциях эти значения определяются как типы \_ флагов ШКТ.
title: Флаги КТФ (Shlwapi. h)
ms.topic: reference
ms.date: 05/31/2018
ms.assetid: 66cda866-7a39-4c5a-a795-a4c5c64cbab7
api_name:
- CTF_INSIST
- CTF_THREAD_REF
- CTF_PROCESS_REF
- CTF_COINIT_STA
- CTF_COINIT
- CTF_FREELIBANDEXIT
- CTF_REF_COUNTED
- CTF_WAIT_ALLOWCOM
- CTF_UNUSED
- CTF_INHERITWOW64
- CTF_WAIT_NO_REENTRANCY
- CTF_KEYBOARD_LOCALE
- CTF_OLEINITIALIZE
- CTF_COINIT_MTA
- CTF_NOADDREFLIB
api_type:
- HeaderDef
api_location:
- Shlwapi.h
topic_type:
- APIRef
- kbSyntax
ms.openlocfilehash: db0f33daecc4abcbfbc9972d0607f4817bc7ecff
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104984320"
---
# <a name="ctf-flags"></a>Флаги КТФ

Флаги, управляющие поведением вызывающей функции. Используется [**шкреатесреад**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) и [**шкреатесреадвисхандле**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadwithhandle). В этих функциях эти значения определяются как типы \_ флагов ШКТ.



| Константа/значение                                                                                                                                                                                                                                             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="CTF_INSIST"></span><span id="ctf_insist"></span><dl> <dt>**КТФ \_ Настаивает**</dt> <dt>0x00000001</dt> </dl>                                       | 0x00000001. Если попытка создать поток с помощью функции [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) завершается ошибкой, установка этого флага приведет к тому, что функция, на которую указывает *пфнсреадпрок* , будет вызываться синхронно из вызывающего потока. Этот флаг можно использовать, только если *пфнкаллбакк* имеет **значение NULL**.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_THREAD_REF"></span><span id="ctf_thread_ref"></span><dl> <dt>**КТФ \_ \_Ссылка**</dt> на <dt>0x00000002</dt> . </dl>                          | 0x00000002. Держите ссылку на поток создания на время вызова функции, на которую указывает *пфнсреадпрок*. Эта ссылка должна быть задана с помощью [**шсетсреадреф**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span id="CTF_PROCESS_REF"></span><span id="ctf_process_ref"></span><dl> <dt>**КТФ \_ \_Ссылка на процесс**</dt> <dt>0x00000004</dt> </dl>                       | 0x00000004. Держите ссылку на процесс проводника Windows на время вызова функции, на которую указывает *пфнсреадпрок*. Этот флаг полезен для [обработчиков расширений оболочки](handlers.md), которые могут потребовать преждевременного закрытия процесса проводника Windows. Это действие полезно при выполнении таких задач, как работа в фоновом потоке или копирование файлов. Дополнительные сведения см. в разделе [**шжетинстанцеексплорер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetinstanceexplorer).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_COINIT_STA"></span><span id="ctf_coinit_sta"></span><dl> <dt>**КТФ \_ 0x00000008 \_ STA**</dt> <dt></dt> </dl>                          | 0x00000008. Инициализируйте COM как единый потоковый апартамент (STA) для созданного потока перед вызовом необязательной функции, на которую указывает *пфнкаллбакк* , или функции, на которую указывает *пфнсреадпрок*. Этот флаг полезен, когда необходимо инициализировать COM для потока. COM также будет автоматически инициализирован.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="CTF_COINIT"></span><span id="ctf_coinit"></span><dl> <dt>**КТФ \_**</dt> <dt>0x00000008</dt> </dl>                                       | Эквивалентно КТФ \_ коinit \_ STA.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span id="CTF_FREELIBANDEXIT"></span><span id="ctf_freelibandexit"></span><dl> <dt>**КТФ \_ ФРИЛИБАНДЕКСИТ**</dt> <dt>0x00000010</dt> </dl>               | 0x00000010. **Internet Explorer 6 или более поздней версии.** Для библиотеки DLL, содержащей функцию *пфнсреадпрок* , будет вызвана [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) , чтобы предотвратить ее выгрузку. После возврата *пфнсреадпрок* библиотека DLL будет освобождена с помощью [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), тем самым уменьшая число ссылок на библиотеку DLL. Передайте этот флаг, чтобы избежать преждевременной выгрузки библиотеки DLL. Например, с помощью [**кофриунуседлибрариес**](/windows/win32/api/combaseapi/nf-combaseapi-cofreeunusedlibraries). Обратите внимание, что при передаче этого флага функция *пфнсреадпрок* должна находиться в библиотеке DLL. Этот флаг является неявным в Windows Vista и более поздних версиях.<br/>                                                                                                                                                                                                                                                                   |
| <span id="CTF_REF_COUNTED"></span><span id="ctf_ref_counted"></span><dl> <dt>**КТФ \_ Номер \_ 0x00000020 подсчета ссылок**</dt> <dt></dt> </dl>                       | 0x00000020. **Internet Explorer 6 или более поздней версии.** Ссылка на поток будет создана автоматически для созданного потока и задана с помощью [**шсетсреадреф**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref). После того как *пфнсреадпрок* возвращает, ссылка на поток освобождается и сообщения отправляются до тех пор, пока число ссылок в ссылке на поток не станет равным нулю, то есть пока потоки, зависящие от созданного потока, не освободят свои ссылки.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_WAIT_ALLOWCOM"></span><span id="ctf_wait_allowcom"></span><dl> <dt>**КТФ \_ WAIT \_ алловком**</dt> <dt>0x00000040</dt> </dl>                 | 0x00000040. **Internet Explorer 6 или более поздней версии.** Вызывающий поток ожидает и переносит сообщения COM и [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) . Если синхронная процедура пытается отправить сообщение Windows с помощью **SendMessage** в окно, размещенное в вызывающем потоке, сообщение будет успешно доставлено. Если синхронная процедура пытается использовать COM для взаимодействия с объектом STA, размещенным в вызывающем потоке, вызов функции будет успешно достигнуть предполагаемого объекта. Вызывающий поток открыт для повторного входа в хрупкости. Хотя вызывающий поток может обрабатывать вызовы **SendMessage** и com в синхронной процедуре, если другие потоки используют **SendMessage** или COM для обмена данными с объектами, размещенными в вызывающем потоке, то они могут быть неожиданными сообщениями или вызовами функций, которые обрабатываются при завершении синхронной процедуры.<br/> |
| <span id="CTF_UNUSED"></span><span id="ctf_unused"></span><dl> <dt>**КТФ \_ Неиспользуемые**</dt> <dt>0x00000080</dt> </dl>                                       | 0x00000080. **Internet Explorer 7 или более поздней версии.** Не используется.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_INHERITWOW64"></span><span id="ctf_inheritwow64"></span><dl> <dt>**КТФ \_ INHERITWOW64**</dt> <dt>0x00000100</dt> </dl>                     | 0x00000100. **Internet Explorer 7 или более поздней версии.** Новый поток наследует состояние отключения Windows-on-Windows 64-bit (WOW64) для перенаправителя файловой системы.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_WAIT_NO_REENTRANCY"></span><span id="ctf_wait_no_reentrancy"></span><dl> <dt>**КТФ \_ Не дожидаться повторного \_ \_ входа**</dt> <dt>0x00000200</dt> </dl> | 0x00000200. **Windows Vista или более поздней версии.** Вызывающий поток блокирует все остальные процессы, ожидая выполнения синхронной процедуры в новом потоке. Если синхронная процедура пытается отправить сообщение Windows с помощью [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) в окно, размещенное в вызывающем потоке, это приводит к взаимоблокировке синхронной процедуры. Если синхронная процедура пытается использовать COM для взаимодействия с объектом STA, размещенным в вызывающем потоке, это также приводит к взаимоблокировке синхронной процедуры. Вызывающий поток защищен от всех проблем, связанных с повторным входом, путем указания этого флага.<br/>                                                                                                                                                                                                                                                                |
| <span id="CTF_KEYBOARD_LOCALE"></span><span id="ctf_keyboard_locale"></span><dl> <dt>**КТФ \_ \_Языковой стандарт клавиатуры**</dt> <dt>0x00000400</dt> </dl>           | 0x00000400. **Windows 7 или более поздней версии.** Используйте языковой стандарт клавиатуры из исходного потока в новом порожденном потоке.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_OLEINITIALIZE"></span><span id="ctf_oleinitialize"></span><dl> <dt>**КТФ \_ ОЛЕИНИТИАЛИЗЕ**</dt> <dt>0x00000800</dt> </dl>                  | 0x00000800. **Windows 7 или более поздней версии.** Инициализируйте COM с помощью модели однопотокового подразделения (STA) для созданного потока.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_COINIT_MTA"></span><span id="ctf_coinit_mta"></span><dl> <dt>**КТФ \_ 0x00001000 \_ агента передачи сообщений**</dt> <dt></dt> </dl>                          | 0x00001000. **Windows 7 и более поздние версии**. Инициализируйте COM-объект с моделью многопотокового подразделения (MTA) для созданного потока.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_NOADDREFLIB"></span><span id="ctf_noaddreflib"></span><dl> <dt>**КТФ \_ НОАДДРЕФЛИБ**</dt> <dt>0x00002000</dt> </dl>                        | 0x00002000. **Windows 7 или более поздней версии.** Этот флаг по сути является противоположностью КТФ \_ фрилибандексит. Это позволяет избежать [](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) / вызовов [**фрилибраряндекситсреад**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) LoadLibrary, которые могут привести к состязанию за блокировку загрузчика. Используйте КТФ \_ ноаддрефлиб, только если новый поток гарантирует, что код исходной процедуры потока останется загруженным. Это значение не должно использоваться в контексте COM-объектов, так как объекты COM должны гарантировать загрузку библиотеки DLL (обычно COM выгружает библиотеки DLL).<br/>                                                                                                                                                                                                                                                                                                                    |



## <a name="remarks"></a>Примечания

Если \_ флаг ожидания КТФ не \_ указан, вызывающий поток будет ждать и отправит сообщения [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) . Если синхронная процедура пытается отправить сообщение Windows с помощью **SendMessage** в окно, размещенное в вызывающем потоке, сообщение получит в предполагаемое окно. Если синхронная процедура пытается использовать COM для взаимодействия с объектом STA, размещенным в вызывающем потоке, синхронная процедура будет взаимоблокировка. Вызывающий поток открыт для повторного входа в хрупкости. Хотя вызывающий поток может обрабатывать вызовы **SendMessage** в синхронной процедуре, если другие потоки используют **SendMessage** для обмена данными с окном, размещенным в вызывающем потоке, эти сообщения могут быть неожиданными. Это может привести к их обработке во время выполнения синхронной процедуры.

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 2000 Professional, Windows XP, \[ только классические приложения Windows 7\]<br/>    |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                                 |
| Заголовок<br/>                   | <dl> <dt>Shlwapi. h</dt> </dl> |



 

 
