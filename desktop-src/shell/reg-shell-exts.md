---
description: Прежде чем оболочку сможет его использовать, необходимо зарегистрировать объект обработчика расширения оболочки. В этом разделе описывается, как зарегистрировать обработчик расширения оболочки.
ms.assetid: e4b98c18-746b-4909-8821-f25de9d15373
title: Регистрация обработчиков расширений оболочки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8ca50bfaff984884b74ecc8572d4af9d96c55d0c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104985761"
---
# <a name="registering-shell-extension-handlers"></a>Регистрация обработчиков расширений оболочки

Прежде чем оболочку сможет его использовать, необходимо зарегистрировать объект обработчика расширения оболочки. В этом разделе описывается, как зарегистрировать обработчик расширения оболочки.

Каждый раз при создании или изменении обработчика расширений оболочки важно уведомлять систему, что вы внесли изменения. Для этого вызовите [**шчанженотифи**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shchangenotify), указав событие **\_ ассокчанжед шкне** . Если не вызвать **шчанженотифи**, изменение может быть не распознано, пока система не будет перезагружена.

Существуют некоторые дополнительные факторы, которые относятся к системам Windows 2000. Дополнительные сведения см. в разделе [Регистрация обработчиков расширения оболочки в системах Windows 2000](#registering-shell-extension-handlers) .

Как и для всех COM-объектов, необходимо создать идентификатор GUID для обработчика с помощью такого средства, как Guidgen.exe, которое предоставляется вместе с пакетом средств разработки программного обеспечения (SDK) для Windows. Создайте подраздел в разделе **\_ классы hKey \_ root** \\ **CLSID** , имя которого является строковым форматом этого GUID. Так как обработчики расширений оболочки являются внутрипроцессного серверами, необходимо также создать подраздел **InprocServer32** в этом подразделе GUID со значением (по умолчанию), равным пути к DLL-файлу обработчика. Используйте модель потоков подразделений. Пример показан далее:

```
HKEY_CLASSES_ROOT
   CLSID
      {00021500-0000-0000-C000-000000000046}
         InprocServer32
            (Default) = %windir%\System32\Example.dll
            ThreadingModel = Apartment
```

Каждый раз, когда оболочка принимает действие, которое может задействовать обработчик расширения оболочки, он проверяет соответствующий подраздел реестра. Подключ, по которому обработчик расширений регистрирует элементы управления при его вызове. Например, при отображении оболочкой контекстного меню для элемента [типа файла](fa-file-types.md)обычно вызывается обработчик контекстного меню. В этом случае обработчик должен быть зарегистрирован в подразделе **ProgID** типа файла.

В этом разделе обсуждаются следующие темы:

-   [Имена обработчиков](#handler-names)
-   [Предопределенные объекты оболочки](#predefined-shell-objects)
-   [Пример регистрации обработчика расширений](#example-of-an-extension-handler-registration)
    -   [Регистрация обработчиков расширений оболочки](#registering-shell-extension-handlers)
-   [См. также](#related-topics)

## <a name="handler-names"></a>Имена обработчиков

Чтобы включить обработчик расширений оболочки, создайте подраздел с именем подраздела обработчика (см. ниже) в подразделе **шеллекс** (для типов файлов) **или в имени** типа объекта оболочки (для [предопределенных \_ \_ объектов оболочки](handlers.md)).

Например, если вы хотите зарегистрировать обработчик расширения контекстного меню для MyProgram. 1, начните с создания следующего подраздела:

```
HKEY_CLASSES_ROOT
   MyProgram.1
      ShellEx
         ContextMenuHandlers
```

Для следующих обработчиков создайте подраздел под подразделом "имя подраздела обработчика" с именем в виде строкового версии идентификатора класса (CLSID) расширения оболочки. Несколько расширений можно зарегистрировать в имени подраздела обработчика, создав несколько подразделов.



| Обработчик                 | Интерфейс          | Имя подраздела обработчика       |
|-------------------------|--------------------|---------------------------|
| Обработчик поставщика столбцов | иколумнпровидер    | **колумнхандлерс**        |
| Обработчик контекстного меню   | IContextMenu       | **контекстменухандлерс**   |
| Обработчик копихук        | икопихук          | **копихукхандлерс**      |
| Обработчик действия перетаскивания   | IContextMenu       | **драгдрофандлерс**      |
| Обработчик страницы свойств  | ишеллпропшитекст | **пропертишисандлерс** |



 

Для следующих обработчиков значение по умолчанию ключа "имя подраздела обработчика" является строковой версией CLSID расширения оболочки. Для этих обработчиков можно зарегистрировать только одно расширение.



| Обработчик                 | Интерфейс            | Имя подраздела обработчика                        |
|-------------------------|----------------------|--------------------------------------------|
| Обработчик данных            | IDataObject          | **DataHandler**                            |
| Удалить обработчик            | Интерфейс IDropTarget          | **дрофандлер**                            |
| Обработчик значков            | Иекстрактикона/W      | **иконхандлер**                            |
| Обработчик изображений эскиза | исумбнаилпровидер   | **{E357FCCD-A995-4576-B01F-234630154E96}** |
| Обработчик подсказок         | икуеринфо           | **{00021500-0000-0000-C000-000000000046}** |
| Ссылка на оболочку (ANSI)       | ишелллинка          | **{000214EE-0000-0000-C000-000000000046}** |
| Ссылка на оболочку (Юникод)    | ишелллинкв          | **{000214F9-0000-0000-C000-000000000046}** |
| Структурированное хранилище      | Метод IStorage             | **{0000000B-0000-0000-C000-000000000046}** |
| Метаданные                | IPropertySetStorage  | **пропертихандлер**                        |
| Закрепить в меню "Пуск"       | истартменупиннедлист | **{a2a9545d-a0c2-42b4-9708-a0b2badd77c8}** |
| Закрепление на панели задач          |                      | **{90AA3A4E-1CBA-4233-B8BB-535773D48449}** |



 

Подразделы, указанные для добавления **закрепления в меню "Пуск** " и " **закрепить на панели задач** " в контекстном меню элемента, необходимы только для типов файлов, включающих запись " [ярлык](./links.md) ".

## <a name="predefined-shell-objects"></a>Предопределенные объекты оболочки

Оболочка определяет дополнительные объекты в **\_ \_ корне классов hKey** , которые могут быть расширены так же, как и типы файлов. Например, чтобы добавить обработчик страницы свойств для всех файлов, можно выполнить регистрацию в подразделе **пропертишисандлерс** .

```
HKEY_CLASSES_ROOT
   *
      shellex
         PropertySheetHandlers
```

В следующей таблице приведены различные подразделы **\_ \_ корня классов hKey** , в которых можно регистрировать обработчики расширений. Обратите внимание, что многие обработчики расширений не могут быть зарегистрированы во всех перечисленных подразделах. Дополнительные сведения см. в документации по конкретному обработчику.



| Подраздел                    | Описание                                                          | Возможные обработчики                                |
|---------------------------|----------------------------------------------------------------------|--------------------------------------------------|
| **\** _                    | Все файлы                                                            | Контекстное меню, страница свойств, команды (см. ниже) |
| _ *Аллфилесистемобжектс**  | Все файлы и папки с файлами                                           | Контекстное меню, страница свойств, команды             |
| **Папка**                | Все папки                                                          | Контекстное меню, страница свойств, команды             |
| **Каталог**             | Папки с файлами                                                         | Контекстное меню, страница свойств, команды             |
| **\\Фон каталога** | Фон папки файлов                                               | Только контекстное меню                               |
| **десктопбаккграунд**     | Фон рабочего стола (Windows 7 и более поздние версии)                            | Контекстное меню, команды                             |
| **Накопитель**                 | Все диски в MyComputer, например "C: \\ "                             | Контекстное меню, страница свойств, команды             |
| **Network**               | Вся сеть (в разделе Мое сетевое окружение)                             | Контекстное меню, страница свойств, команды             |
| **\\Тип сети\\\#**     | Все объекты типа \# (см. ниже)                                   | Контекстное меню, страница свойств, команды             |
| **нетшаре**              | Все общие сетевые папки                                                   | Контекстное меню, страница свойств, команды             |
| **нетсервер**             | Все сетевые серверы                                                  | Контекстное меню, страница свойств, команды             |
| *\_имя поставщика \_ сети* | Все объекты, предоставляемые поставщиком сетевых услуг "*\_ \_ имя поставщика* сети" | Контекстное меню, страница свойств, команды             |
| **принтеры;**              | Все принтеры                                                         | Контекстное меню, страница свойств                    |
| **аудиокд**               | Звуковой компакт-диск в дисководе компакт-дисков                                                 | Только глаголы                                       |
| **ОПТИЧЕСКИ**                   | DVD-дисковод (Windows 2000)                                             | Контекстное меню, страница свойств, команды             |



 

### <a name="notes"></a>Примечания

-   Доступ к контекстному меню фонового доступа к папке осуществляется путем щелчка правой кнопкой мыши в папке файла, но не для содержимого папки.
-   "Глаголы" — это специальные команды, зарегистрированные в команде оболочки **\_ \_ корневого** \\ *подраздела* для классов hKey \\  \\ .
-   Для  \\ **типа** сети \\ **\#** " \# " — это код типа поставщика сети в десятичном формате. Код типа поставщика сети — это старшее слово типа сети. Список сетевых типов указан в файле заголовка Виннетвк. h ( \_ значения вннк NET \_ \* ). Например, вннк \_ net " \_ 0x00330000", поэтому соответствующий подраздел типа будет содержать **\_ классы hKey \_ root** \\ **Network** \\ **Type** \\ **51**.
-   "*\_ \_ имя поставщика сети*" — это имя поставщика сети, указанное в [**внетжетпровидернаме**](/windows/win32/api/winnetwk/nf-winnetwk-wnetgetprovidernamea), а пробелы преобразуются в символы подчеркивания. Например, если установлен поставщик сетевых сетей Microsoft, его имя поставщика — «Microsoft Windows Network», а соответствующее *\_ \_ имя поставщика сети* — **Microsoft \_ Windows \_ Network**.

## <a name="example-of-an-extension-handler-registration"></a>Пример регистрации обработчика расширений

Чтобы включить определенный обработчик, создайте подраздел в подразделе типа обработчика расширений с именем обработчика. Оболочка не использует имя обработчика, но должно отличаться от всех других имен в подразделе этого типа. Задайте значение по умолчанию для подраздела Name в виде строки идентификатора GUID обработчика.

В следующем примере показаны записи реестра, которые позволяют использовать контекстное меню и обработчики расширений страниц свойств с использованием типа файла example. МИП.

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   CLSID
      {00000000-1111-2222-3333-444444444444}
         InProcServer32
            (Default) = C:\MyDir\MyCommand.dll
            ThreadingModel = Apartment
      {11111111-2222-3333-4444-555555555555}
         InProcServer32
            (Default) = C:\MyDir\MyPropSheet.dll
            ThreadingModel = Apartment
   MyProgram.1
      (Default) = MyProgram Application
      Shellex
         ContextMenuHandler
            MyCommand
               (Default) = {00000000-1111-2222-3333-444444444444}
         PropertySheetHandlers
            MyPropSheet
               (Default) = {11111111-2222-3333-4444-555555555555}
```

### <a name="registering-shell-extension-handlers"></a>Регистрация обработчиков расширений оболочки

Процедура регистрации, описанная в этом разделе, должна соблюдаться для всех систем Windows. Однако в более поздних системах может потребоваться дополнительный шаг. Поскольку эти более поздние версии Windows предназначены для использования в управляемой среде, доступ к реестру может быть ограничен административно, что требует немного другого подхода к установке, чем описано в предыдущем разделе.

> [!Note]  
> Обычно программы установки не записываются непосредственно в реестр. Вместо этого следует выполнить установку с помощью пакетов установщик Windows. Эти средства гарантируют, что программное обеспечение работает правильно и предоставляет доступ к таким возможностям, как регистрация на уровне пользователя.

 

Обработчики расширений оболочки выполняются в процессе оболочки. Поскольку это системный процесс, администратор системы может ограничить обработчики расширений оболочки до тех, которые включены в список утвержденных, задав для ключа **обозревателя** значение 1, как показано ниже:

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Explorer
                     EnforceShellExtensionSecurity = 1
```

Чтобы поместить обработчик расширения оболочки в список утвержденных, создайте значение **reg \_ SZ** , имя которого является СТРОКОВЫМ форматом идентификатора GUID обработчика в **утвержденном** подразделе.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Shell Extensions
                  Approved
```

Например, в следующем примере обработчики *микомманд* и *мипропшит* добавляются в список утвержденных.

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Shell Extensions
                  Approved
                     {00000000-1111-2222-3333-444444444444} = MyCommand
                     {11111111-2222-3333-4444-555555555555} = MyPropSheet
```

Оболочка не использует значение, присвоенное идентификатору GUID, но оно должно быть настроено для упрощения проверки реестра.

Приложение установки может добавлять значения в **подразделы только в том случае** , если пользователь, устанавливающий приложение, имеет достаточные привилегии. Если попытка добавления обработчика расширения завершается неудачно, необходимо сообщить пользователю, что для полной установки приложения требуются права администратора. Если обработчик важен для приложения, следует завершить установку и уведомить пользователя о необходимости обратиться к администратору.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Инициализация обработчиков расширений оболочки](int-shell-exts.md)
</dt> </dl>

 

 
