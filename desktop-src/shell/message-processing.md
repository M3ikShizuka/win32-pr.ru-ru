---
description: Функция обратного вызова Кплапплет обрабатывает все сообщения, отправленные в элемент панели управления, Windows. Сообщения, отправляемые в функцию, задаются в определенном порядке. Для одного и того же маркера элемент .cpl требует, чтобы сообщения обрабатывались особым образом.
ms.assetid: 70302698-f9d5-4de4-a662-4815002eea52
title: Обработка сообщений в панели управления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e697c603b69790d17c4d6771666a1111fa6f968eb97a30256696921f133530d6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118719955"
---
# <a name="control-panel-message-processing"></a>Обработка сообщений в панели управления

Функция обратного вызова [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) обрабатывает все сообщения, отправленные в элемент панели управления, Windows. Сообщения, отправляемые в функцию, задаются в определенном порядке. Для одного и того же маркера элемент .cpl требует, чтобы сообщения обрабатывались особым образом.

во первых, функция [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) получает сообщение CPL \_ INIT, когда Windows сначала загружает элемент панели управления. Функция должна выполнять любую инициализацию, например выделение памяти, и возвращать ненулевое значение. если **кплапплет** не может завершить инициализацию, он должен вернуть ноль, перенаправить Windows, чтобы завершить обмен данными и освободить библиотеку DLL.

затем, если сообщение cpl \_ INIT прошло удачно, Windows отправляет \_ сообщение CPL nocount. Затем функция должна возвращать количество элементов панели управления, поддерживаемое файлом .dll.

Затем функция [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) получает одно \_ сообщение с запросом CPL и одно \_ сообщение CPL Невинкуире для каждого элемента панели управления, поддерживаемого файлом .dll. Функция заполняет структуру [**кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) сведениями об элементе, например его имя, значок и описательную строку. Большинство приложений должны обрабатывать сообщение с \_ запросом CPL и игнорировать сообщение CPL \_ невинкуире. сообщение с \_ запросом CPL предоставляет сведения в форме, которая Windows может кэшироваться, что приводит к значительному повышению производительности. Сообщение CPL \_ невинкуире используется только в том случае, если необходимо изменить значок элемента или отобразить строки в зависимости от состояния компьютера. элементы панели управления, использующие CPL \_ невинкуире, не могут быть найдены в меню " **пуск** " в Windows Vista, так как они основаны на кэшировании.

Функция [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) далее получает \_ сообщение CPL дблклк в качестве уведомления о том, что пользователь выбрал значок, представляющий элемент панели управления. Функция может получить это сообщение любое количество раз. Сообщение содержит идентификатор элемента и указатель **лпдата** , возвращенный в структуре [**кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в вызове [**CPL \_**](cpl-inquire.md) Call или [**CPL \_ невинкуире**](cpl-newinquire.md). Функция должна отображать соответствующее диалоговое окно и обрабатывать последующие входные данные пользователя.

Помимо CPL \_ дблклк, сообщение CPL \_ стартвпармс может быть отправлено, если элемент панели управления вызывается с входными параметрами, например из командной строки или из другой программы. Сообщение содержит идентификатор элемента вместе с дополнительной строкой параметра.

Перед завершением управления приложением [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) получает \_ сообщение об ошибке CPL по одному разу для каждого элемента панели управления, поддерживаемого файлом .dll. Сообщение содержит идентификатор для элемента панели управления и указатель **лпдата** , возвращенный в структуре [**кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в вызове [**CPL \_ запрос**](cpl-inquire.md) или [**CPL \_ невинкуире**](cpl-newinquire.md). Функция должна освободить память, выделенную для указанного диалогового окна.

После последнего \_ сообщения об ошибке CPL [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) получает сообщение о \_ выходе CPL. Функция должна освободить всю оставшуюся выделенную память и отменить регистрацию всех закрытых классов окна, которые могли быть зарегистрированы. сразу после того, как функция возвращает из этого сообщения, Windows освобождает элемент панели управления, вызывая функцию [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Элементы панели управления](control-panel-applications.md)
</dt> <dt>

[Руководство по работе пользователей](user-experience-guidelines.md)
</dt> <dt>

[Регистрация элементов панели управления](registering-control-panel-items.md)
</dt> <dt>

[Использование Кплапплет](using-cplapplet.md)
</dt> <dt>

[Исполнение элементов панели управления](executing-control-panel-items.md)
</dt> <dt>

[Расширение элементов панели управления "система"](extending-system-control-panel-items.md)
</dt> <dt>

[Назначение категорий панели управления](assigning-control-panel-categories.md)
</dt> <dt>

[Создание ссылок на задачи с возможностью поиска для элемента панели управления](creating-searchable-task-links.md)
</dt> <dt>

[доступ к панели управления в режиме Сейф в разделе Windows Vista](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
