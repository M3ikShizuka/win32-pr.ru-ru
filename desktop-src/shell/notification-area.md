---
description: Область уведомлений — это часть панели задач, которая предоставляет временный источник уведомлений и состояния.
ms.assetid: D37E2BF7-1887-4780-81AD-85B2117321E4
title: Уведомления и область уведомлений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d07fcbbbcbb779d4b71dfc89069523a53059ebca9395c662ffe49048e6a3bf1b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117677962"
---
# <a name="notifications-and-the-notification-area"></a>Уведомления и область уведомлений

Область уведомлений — это часть панели задач, которая предоставляет временный источник уведомлений и состояния. Его также можно использовать для вывода значков для компонентов системы и программ, не имеющих присутствия на рабочем столе, таких как уровень аккумулятора, регулятор громкости и состояние сети. Область уведомлений называлась журналом панели задач или областью состояния.

Этот раздел состоит из следующих подразделов.

-   [Рекомендации по уведомлениям и областям уведомлений](#notification-and-notification-area-guidelines)
-   [Создание и отображение уведомления](#notifications-and-the-notification-area)
    -   [Добавить значок уведомления](#add-a-notification-icon)
    -   [Определение версии НОТИФИКОНДАТА](#define-the-notifyicondata-version)
    -   [Определение вида и содержимого уведомлений](#define-the-notification-look-and-contents)
    -   [Проверка состояния пользователя](#check-the-user-status)
    -   [Отображение уведомления](#display-the-notification)
    -   [Удаление значка](#removing-an-icon)
-   [Пример пакета SDK](#sdk-sample)
-   [Связанные темы](#related-topics)

## <a name="notification-and-notification-area-guidelines"></a>Рекомендации по уведомлениям и областям уведомлений

рекомендации по использованию уведомлений и области уведомлений см. в разделах [уведомления](../uxguide/mess-notif.md) и [область уведомлений](../uxguide/winenv-notification.md) Windows рекомендации по взаимодействию с пользователем. Целью является предоставление пользователю преимуществ посредством соответствующего использования уведомлений, не заботясь об этом.

Область уведомлений не предназначена для критической информации, которая должна выполняться немедленно. Он также не предназначен для быстрого доступа к программе или командам. начиная с Windows 7, большая часть этой функциональности лучше всего выполняется с помощью кнопки панели задач приложения.

Windows 7 позволяет пользователю подавлять все уведомления из приложения, если они выбраны, поэтому продуманное проектирование уведомлений и использование приведет к наклону пользователя для того, чтобы приложение продолжало отображать их. Уведомления являются прерываниями; Убедитесь, что они стоят.

в Windows 7 введено понятие "тихий срок". Время молчания определяется как первый час после того, как новый пользователь войдет в свою учетную запись в первый раз или в первый раз после обновления операционной системы или чистой установки. Это время не позволяет пользователю исследовать и изучать новую среду, не отвлекая уведомления. В течение этого времени большинство уведомлений не следует отправлять или показывать. Исключения включают отзыв о том, что пользователь может видеть в ответ на действие пользователя, например, когда он подключается к USB-устройству или печатает документ. Особенности API, связанные со временем молчания, обсуждаются далее в этом разделе.

## <a name="creating-and-displaying-a-notification"></a>Создание и отображение уведомления

Остальные подразделы этого раздела описывают основную процедуру, которую необходимо выполнить для вывода уведомления от приложения к пользователю.

1.  [Добавить значок уведомления](#add-a-notification-icon)
2.  [Определение версии НОТИФИКОНДАТА](#define-the-notifyicondata-version)
3.  [Определение вида и содержимого уведомлений](#define-the-notification-look-and-contents)
4.  [Проверка состояния пользователя](#check-the-user-status)
5.  [Отображение уведомления](#display-the-notification)
6.  [Удаление значка](#removing-an-icon)

### <a name="add-a-notification-icon"></a>Добавить значок уведомления

Для вывода уведомления в области уведомлений должен быть значок. в некоторых случаях, например в Microsoft Communicator или на уровне аккумулятора, этот значок уже существует. Однако во многих других случаях значок добавляется в область уведомлений только в том случае, если он необходим для отображения уведомления. В любом случае это достигается с помощью функции [**Shell \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) . **Оболочка \_ NotifyIcon** позволяет добавлять, изменять и удалять значки в области уведомлений.

![область уведомлений, содержащая три значка](images/taskbar/notificationareaicons.png)

когда значок добавляется в область уведомлений на Windows 7, он добавляется в раздел overflow области уведомлений по умолчанию. Эта область содержит значки области уведомлений, которые активны, но не отображаются в области уведомлений. Только пользователь может переместить значок из переполнения в область уведомлений, хотя в некоторых обстоятельствах система может временно переместить значок в область уведомлений в виде короткой предварительной версии (в течение одной минуты).

> [!Note]  
> Пользователь должен иметь конечное мнение о том, какие значки должны отображаться в области уведомлений. Перед установкой значка, не являющегося временным, в области уведомлений необходимо запросить разрешение у пользователя. Кроме того, следует указать параметр (как правило, хотя контекстное меню), чтобы удалить значок из области уведомлений.

 

Структура [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) , отправленная в вызове [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) , содержит сведения, указывающие как значок области уведомлений, так и само уведомление. Ниже перечислены элементы, относящиеся к самому значку области уведомлений, которые можно задать с помощью **нотификондата**.

-   Ресурс, из которого берется значок.
-   Уникальный идентификатор значка.
-   Стиль подсказки для значка.
-   Состояние значка (скрыто, Shared или Both) в области уведомлений.
-   Маркер окна приложения, связанный со значком.
-   Идентификатор сообщения обратного вызова, который позволяет значку передавать события, происходящие в ограничивающем прямоугольнике значка, и всплывающее уведомление с соответствующим окном приложения. Ограничивающий прямоугольник значка можно получить с помощью [**оболочки \_ нотификонжетрект**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicongetrect).

Каждый значок в области уведомлений может быть идентифицирован двумя способами:

-   Идентификатор GUID, с которым объявляется значок в реестре. это предпочтительный метод для Windows 7 и более поздних версий.
-   Маркер окна, связанный со значком области уведомлений, а также идентификатор значка, определяемый приложением. этот метод используется в Windows Vista и более ранних версий.

Значки в области уведомлений могут содержать подсказку. Подсказка может быть либо стандартной подсказкой (предпочтительной), либо отображаемым приложением пользовательским интерфейсом всплывающего окна. Хотя подсказка не является обязательной, ее рекомендуется использовать.

Для значков области уведомлений необходимо учитывать высокое разрешение DPI. Приложение должно предоставить как значок 16x16 пикселей, так и значок 32x32 в файле ресурсов, а затем использовать [**лоадиконметрик**](/windows/win32/api/commctrl/nf-commctrl-loadiconmetric) , чтобы убедиться, что нужный значок загружен и правильно масштабируется.

Приложение, ответственное за значок области уведомлений, должно отреагировать на этот значок щелчком мыши. Когда пользователь щелкает правой кнопкой мыши значок, он должен открыть обычное контекстное меню. Однако результат одного щелчка левой кнопкой мыши будет зависеть от функции значка. Он должен показать, что пользователь будет видеть в форме, которая лучше всего подходит для этого содержимого — всплывающее окно, диалоговое окно или само окно программы. Например, он может отображать текст состояния для значка состояния или ползунок для регулятора громкости.

Расположение всплывающего окна или диалогового окна, которое появляется в результате щелчка, должно располагаться рядом с координатой щелчка в области уведомлений. Чтобы определить его расположение, используйте [**калкулатепопупвиндовпоситион**](/windows/win32/api/winuser/nf-winuser-calculatepopupwindowposition) .

Значок можно добавить в область уведомлений без отображения уведомления, определив только элементы, относящиеся к значку [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) (см. выше), и вызов [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) , как показано ниже:


```
NOTIFYICONDATA nid = {};
// Do NOT set the NIF_INFO flag.
...                    
Shell_NotifyIcon(NIM_ADD, &nid);
```



Можно также добавить значок в область уведомлений и отобразить уведомление в одном вызове [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona). Для этого выполните инструкции, приведенные в этом разделе.

### <a name="define-the-notifyicondata-version"></a>Определение версии НОТИФИКОНДАТА

по мере выполнения Windows структура [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) расширяется, чтобы включать больше элементов для определения дополнительных функциональных возможностей. Константы используются для объявления версии **нотификондата** , используемой с значком области уведомлений, для обеспечения обратной совместимости. если нет особой причины для этого, настоятельно рекомендуется использовать \_ версию NOTIFYICON версии \_ 4, появившуюся в Windows Vista. Эта версия предоставляет все доступные функциональные возможности, в том числе предпочтительную возможность определять значок области уведомлений, хотя зарегистрированный GUID, старший механизм обратного вызова и улучшенный доступ.

Задайте версию, выполнив следующие вызовы:


```
NOTIFYICONDATA nid = {};
... 
nid.uVersion = NOTIFYICON_VERSION_4;
// Add the icon
Shell_NotifyIcon(NIM_ADD, &nid);
// Set the version
Shell_NotifyIcon(NIM_SETVERSION, &nid);
```



Обратите внимание, что этот вызов [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) не отображает уведомление.

### <a name="define-the-notification-look-and-contents"></a>Определение вида и содержимого уведомлений

Уведомление — это специальный тип элемента управления всплывающей подсказки. Он содержит заголовок, текст текста и значок. Как и окно, у него есть кнопка **Закрыть** в правом верхнем углу. Он также содержит кнопку **Параметры** , которая открывает элемент значки области уведомлений на панели управления, что позволяет пользователю отображать или скрывать значок или отображать только уведомления без значка.

![снимок экрана с всплывающим уведомлением о низком питании от аккумулятора](images/taskbar/notificationballoon.png)

Структура [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) , отправленная в вызове [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) , содержит сведения, указывающие как значок области уведомлений, так и сам всплывающий элемент уведомления. Ниже перечислены элементы, относящиеся к уведомлению, которые можно задать с помощью **нотификондата**.

-   Значок, отображаемый в подсказке уведомления, которая указывается типом уведомления. Можно указать размер значка, а также настраиваемые значки.
-   Заголовок уведомления. Этот заголовок должен содержать не более 48 символов на английском языке (для поддержки локализации). Заголовок — это первая строка уведомления, которая задается с помощью размера, цвета и веса шрифта.
-   Текст для использования в тексте уведомления. Этот текст должен содержать не более 200 символов на английском языке (для поддержки локализации).
-   Следует ли отменять уведомление, если оно не может быть отображено немедленно.
-   Время ожидания уведомления. этот параметр не учитывается в Windows Vista и более поздних системах в пользу параметра времени ожидания доступности на уровне системы.
-   Указывает, должно ли уведомление учитывать время молчания, задается с помощью флага [**\_ \_ \_ времени нииф "тихий**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) ".

> [!Note]  
> Интерфейсы [**иусернотификатион**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iusernotification) и [**IUserNotification2**](/windows/desktop/api/Shobjidl/nn-shobjidl-iusernotification2) являются оболочками модели COM для [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona). Однако в настоящее время они не предоставляют полный \_ \_ набор функциональных возможностей NotifyIcon версии 4, доступных через **интерпретатор команд \_ NotifyIcon** напрямую, включая использование идентификатора GUID для указания значка области уведомлений.

 

### <a name="check-the-user-status"></a>Проверка состояния пользователя

Система использует функцию [**шкуерюсернотификатионстате**](/windows/desktop/api/Shellapi/nf-shellapi-shqueryusernotificationstate) для проверки того, находится ли пользователь в тихом режиме, от компьютера или в состоянии непрерывного состояния, такого как режим презентации. Будет ли система отображать уведомление, зависит от этого состояния.

> [!Note]  
> Если приложение использует пользовательский метод уведомления, не использующий [**оболочки \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona), [**иусернотификатион**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iusernotification)или [**IUserNotification2**](/windows/desktop/api/Shobjidl/nn-shobjidl-iusernotification2), он должен всегда явно вызывать [**шкуерюсернотификатионстате**](/windows/desktop/api/Shellapi/nf-shellapi-shqueryusernotificationstate) , чтобы определить, должен ли он отображать пользовательский интерфейс уведомления в это время.

 

Уведомления, отправленные при отсутствии пользователя, помещаются в очередь для отображения, но из-за того, что пользователь не может получить сведения о том, когда будет возвращено это уведомление, можно будет повторно отправить уведомление позже.

Уведомления, отправленные во время молчания, отбрасываются не отображаются. Рекомендации по проектированию запрашивают, что все уведомления должны быть проигнорированы. Они не должны требовать немедленного вмешательства пользователя. Поэтому уведомления не настолько важны, что оно должно переопределять время без вывода сообщений.

### <a name="display-the-notification"></a>Отображение уведомления

После того как вы настроили версию [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) и определили уведомление в структуре **нотификондата** , вызовите [**оболочку \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) для вывода значка.

-   Если значок области уведомлений отсутствует, вызовите [**оболочку \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) , чтобы добавить значок. Сделайте это как для временных, так и для невременных значков.
    ```
    NOTIFYICONDATA nid = {};
    ...                    
    Shell_NotifyIcon(NIM_ADD, &nid);
    ```

    

-   Если значок области уведомлений уже существует, вызовите [**оболочку \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona) , чтобы изменить значок.
    ```
    NOTIFYICONDATA nid = {};
    ...                    
    Shell_NotifyIcon(NIM_MODIFY, &nid);
    ```

    

В следующем коде показан пример установки [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) данных и их отправки через [**оболочку \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona). обратите внимание, что этот пример определяет значок уведомления с помощью идентификатора GUID (предпочтительно в Windows 7).


```
// Declare NOTIFYICONDATA details. 
    // Error handling is omitted here for brevity. Do not omit it in your code.
    
    NOTIFYICONDATA nid = {};
    nid.cbSize = sizeof(nid);
    nid.hWnd = hWnd;
    nid.uFlags = NIF_ICON | NIF_TIP | NIF_GUID;
    
    // Note: This is an example GUID only and should not be used.
    // Normally, you should use a GUID-generating tool to provide the value to
    // assign to guidItem.
    static const GUID myGUID = 
    {0x23977b55, 0x10e0, 0x4041, {0xb8, 0x62, 0xb1, 0x95, 0x41, 0x96, 0x36, 0x69}};
    nid.guidItem = myGUID;
    
    nid.guidItem = guid;
    
    // This text will be shown as the icon's tooltip.
    StringCchCopy(nid.szTip, ARRAYSIZE(nid.szTip), L"Test application");
    
    // Load the icon for high DPI.
    LoadIconMetric(hInst, MAKEINTRESOURCE(IDI_SMALL), LIM_SMALL, &(nid.hIcon));
    
    // Show the notification.
    Shell_NotifyIcon(NIM_ADD, &nid) ? S_OK : E_FAIL;
```



### <a name="removing-an-icon"></a>Удаление значка

Чтобы удалить значок, например, если вы временно добавили значок для рассылки уведомления, вызовите [**оболочку \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona), как показано ниже. В этом вызове требуется только минимальная структура [**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa) , идентифицирующая значок.


```
NOTIFYICONDATA nid = {};
...                    
Shell_NotifyIcon(NIM_DELETE, &nid);
```



> [!Note]  
> При удалении приложения его значок области уведомлений по-прежнему может отображаться для пользователя в виде параметра на странице значков области уведомлений на панели управления до семи дней. Однако любые сделанные изменения не будут действовать.

 

## <a name="sdk-sample"></a>Пример пакета SDK

полный пример использования окна " [**\_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona)" см. в примере примера [нотификатионикон](samples-notificationicon.md) в пакете SDK для Windows Software Development Kit.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**Значок \_ NotifyIcon**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicona)
</dt> <dt>

[**Оболочка \_ нотификонжетрект**](/windows/desktop/api/Shellapi/nf-shellapi-shell_notifyicongetrect)
</dt> <dt>

[**нотификондата**](/windows/desktop/api/Shellapi/ns-shellapi-notifyicondataa)
</dt> <dt>

[**шкуерюсернотификатионстате**](/windows/desktop/api/Shellapi/nf-shellapi-shqueryusernotificationstate)
</dt> <dt>

[**иусернотификатион**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iusernotification)
</dt> <dt>

[**IUserNotification2**](/windows/desktop/api/Shobjidl/nn-shobjidl-iusernotification2)
</dt> <dt>

[Панель задач](taskbar.md)
</dt> <dt>

[Расширения панели задач](taskbar-extensions.md)
</dt> </dl>

 

 
