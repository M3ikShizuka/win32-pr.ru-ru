---
description: Существует множество ситуаций, в которых может потребоваться временно или постоянно отключить автозапуск.
ms.assetid: 5e65a3d8-04b9-46ba-b4e5-a976e1923bfd
title: Включение и отключение автозапуска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cbd14a1dfd3aadb94f3586dec783ea6d394f717f500b5ac103c65fcb813baf14
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120090784"
---
# <a name="enabling-and-disabling-autorun"></a>Включение и отключение автозапуска

Существует множество ситуаций, в которых может потребоваться временно или постоянно отключить автозапуск. Например, функция автозапуска может мешать работе работающего приложения и должна быть отключена в течение длительного времени. Система предоставляет несколько способов отключения функции AutoRun.

-   [Подавление автозапуска программным способом](#suppressing-autorun-programmatically)
-   [Отключение автозапуска с помощью реестра](#using-the-registry-to-disable-autorun)
-   [автозапуск для других типов служба хранилищаных носителей](#autorun-for-other-types-of-storage-media)

## <a name="suppressing-autorun-programmatically"></a>Подавление автозапуска программным способом

Существует множество ситуаций, в которых может потребоваться подавлять Автозапуск программным способом. Ниже приведены два примера:

-   Приложение содержит программу установки, которая требует, чтобы пользователь вставил другой диск, который может содержать файл autorun. INF.
-   Во время работы приложения пользователю может потребоваться вставить другой диск, который может содержать файл autorun. INF.

В любом случае, как правило, не требуется запускать другое приложение во время выполнения исходной операции.

Пользователи могут вручную отключить автозапуск, удерживая клавишу SHIFT при вставке компакт-диска. Однако обычно предпочтительнее выполнять эту операцию программно, а не в зависимости от пользователя.

в системах с оболочкой [версии 4,70](versions.md) и более поздних Windows отправляет сообщение "куериканцелаутоплай" в передний план. Приложение может ответить на это сообщение, чтобы отключить автозапуск. Этот подход используется системными служебными программами, такими как [Открытие](../dlgbox/open-and-save-as-dialog-boxes.md) общего диалогового окна для отключения автозапуска.

В следующих фрагментах кода показано, как настроить и обработано это сообщение. Приложение должно работать в окне переднего плана. сначала зарегистрируйте "куериканцелаутоплай" в качестве Windows сообщения:


```C++
uMessage = RegisterWindowMessage(TEXT("QueryCancelAutoPlay"));
```



Для получения этого сообщения окно приложения должно быть на переднем плане. Обработчик сообщений должен возвращать **значение true** , чтобы отменить автозапуск, и **false** , чтобы включить его. В следующем фрагменте кода показано, как использовать это сообщение для отключения функции AutoRun.


```C++
UINT g_uQueryCancelAutoPlay = 0;

LRESULT WndProc(HWND hwnd, UINT uMsg,  WPARAM wParam, LPARAM lParam) 
{ 
    switch (uMsg) 
    { 
    ... 
    default: 
        if (!g_uQueryCancelAutoPlay)
        { 
            g_uQueryCancelAutoPlay = RegisterWindowMessage(TEXT("QueryCancelAutoPlay"));
        } 
        if (uMsg && uMsg == g_uQueryCancelAutoPlay)
        { 
            return TRUE;       // Cancel AutoRun
        }
    }
}
```



Если приложение использует диалоговое окно и должно реагировать на сообщение "Куериканцелаутоплай", оно не может просто возвращать **значение true** или **false**. Вместо этого вызовите [**SetWindowLong**](/windows/win32/api/winuser/nf-winuser-setwindowlonga) с параметром *ниндекс* , установленным в значение **DWL \_ мсгресулт**. Задайте для параметра *Двневлонг* **значение true** , чтобы отменить автозапуск, и **false** , чтобы включить ее. Например, следующий пример процедуры диалогового окна отменяет Автозапуск при получении сообщения "Куериканцелаутоплай".


```C++
UINT g_uQueryCancelAutoPlay = 0;

BOOL DialogProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam) 
{ 
    switch (uMsg) 
    { 
    ...
    default: 
        if (!g_uQueryCancelAutoPlay)
        {
            g_uQueryCancelAutoPlay = RegisterWindowMessage(TEXT("QueryCancelAutoPlay"));
        } 
        if (uMsg == g_uQueryCancelAutoPlay) 
        {
            SetWindowLong(hDlg, DWL_MSGRESULT, TRUE);          
            return 1;               
        }
    } 
```



## <a name="using-the-registry-to-disable-autorun"></a>Отключение автозапуска с помощью реестра

Существует два значения реестра, которые можно использовать для постоянного отключения AutoRun: Нодривеауторун и Нодриветипеауторун. Первое значение отключает автозапуск для указанных букв диска, а второй отключает автозапуск для класса дисков. Если одно из этих значений имеет значение отключить автозапуск для конкретного устройства, оно будет отключено. дополнительные сведения об отключении функций автозапуска см. в статье базы знаний [как отключить функцию автозапуска в Windows](https://support.microsoft.com/kb/967715) . В этой статье перечислены различные обновления, которые необходимо установить, чтобы правильно отключить функцию автозапуска.

> [!Note]  
> Значения Нодривеауторун и Нодриветипеауторун должны быть изменены только системными администраторами для изменения значения всей системы в целях тестирования или администрирования. Приложения не должны изменять эти значения, так как не существует способа надежного восстановления их исходных значений.

 

Значение Нодривеауторун отключает автозапуск для указанных букв диска. Это \_ значение реестра типа DWORD, которое находится в следующем разделе:

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Explorer
```

Первый бит значения соответствует диску A:, второму — B: и т. д. Чтобы отключить функцию AutoRun для одного или нескольких букв диска, установите соответствующие биты. Например, чтобы отключить диски A: и C:, задайте для Нодривеауторун значение `0x00000005` .

Значение Нодриветипеауторун отключает автозапуск для класса дисков. Это \_ двоичное значение в формате DWORD или 4-байтового типа \_ данных reg, которое находится в том же ключе.

```
HKEY_CURRENT_USER
   Software
      Microsoft
         Windows
            CurrentVersion
               Policies
                  Explorer
```

Установив биты первого байта этого значения, можно исключить другие диски из работы с функцией автозапуска.

В следующей таблице приводятся константы битов и битовой маски, которые можно задать в первом байте Нодриветипеауторун, чтобы отключить автозапуск для определенного типа диска. чтобы изменения вступили в силу, необходимо перезапустить обозреватель Windows Explorer.



| Разрядное число | Константа битовой маски      | Описание                                             |
|------------|-----------------------|---------------------------------------------------------|
| 0x04       | **ДИСК \_ ПЕРЕмещается** | Диск можно удалить с диска (например, с дискеты). |
| 0x08       | **ДИСК \_ фиксирован**      | Невозможно удалить диск из накопителя (жесткий диск).        |
| 0x10       | **ДИСК \_ удаленно**     | Сетевой диск.                                          |
| 0x20       | **ДИСКОВОД \_ CDROM**      | Дисковод компакт-дисков.                                           |
| 0x40       | **ДИСК \_ Ramdisk**    | ЭЛЕКТРОННЫЙ диск.                                               |



 

## <a name="autorun-for-other-types-of-storage-media"></a>автозапуск для других типов служба хранилищаных носителей

Автозапуск в основном предназначен для общедоступного распространения приложений на компакт-дисках и DVD-ДИСКах, и его использование не рекомендуется для других носителей. Однако часто бывает полезно включить автоматический запуск на съемных носителях других типов. Эта функция обычно используется для упрощения отладки файлов AutoRun. INF. Автозапуск работает только на съемных устройствах хранения при соблюдении следующих условий.

-   Устройство должно иметь драйверы, совместимые с автозапуском. Чтобы обеспечить совместимость с автозагрузкаю, драйвер должен уведомить систему о том, что диск вставлен, отправив сообщение [**WM \_ девицечанже**](../devio/wm-devicechange.md) .
-   Корневой каталог вставленного носителя должен содержать файл autorun. INF.
-   На устройстве не должно быть отключено Автозагрузка с помощью [реестра](#using-the-registry-to-disable-autorun).
-   Приложение переднего плана не [подавляет](#suppressing-autorun-programmatically) автозапуск.

> [!Note]  
> Эта функция не должна использоваться для распространения приложений на съемные носители. Поскольку реализация автозапуска на съемных носителях обеспечивает простой способ распространения компьютерных вирусов, пользователи должны быть подозрительными на общедоступной распределенной гибкой дискете, содержащей файл autorun. INF.

 

Обычно Автозапуск запускается автоматически, но его также можно запустить вручную. Если устройство соответствует указанным выше критериям, в контекстном меню буквы диска будет указана команда **автозапуска** . Чтобы запустить автоматический запуск вручную, щелкните правой кнопкой мыши значок диска и выберите **Автозапуск** в контекстном меню или дважды щелкните значок диска. Если драйверы не совместимы с автозапуском, в контекстном меню не будет элемента **автозапуска** , и запуск автозапуска невозможен.

Драйверы, совместимые с автозапуском, предоставляются с помощью некоторых съемных дисков, а также некоторых других типов съемных носителей, например адаптеров CompactFlash. автозапуск также работает с сетевыми дисками, которые сопоставлены с буквой диска с помощью проводника Windows Explorer или подключены к [консоли управления (MMC)](/previous-versions/windows/desktop/mmc/microsoft-management-console-start-page). Как и в случае с подключенным оборудованием, подключенный сетевой диск должен иметь файл autorun. INF в корневом каталоге и не должен быть отключен в [реестре](#using-the-registry-to-disable-autorun).

 

 
