---
description: В этом разделе описывается, как приложения могут предоставлять сведения о себе, необходимые для реализации определенных сценариев.
ms.assetid: F88AA3E6-6F7B-442d-935A-7D2CB4958E6B
title: Регистрация приложения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0b9647809f46c2147ab6ed464f0e8de1d7ef0df
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127363193"
---
# <a name="application-registration"></a>Регистрация приложения

В этом разделе описывается, как приложения могут предоставлять сведения о себе, необходимые для реализации определенных сценариев. Сюда входят сведения, необходимые для размещения приложения, команды, поддерживаемые приложением, а также типы файлов, которые может выполнять приложение.

Этот раздел организован следующим образом:

-   [Поиск исполняемого файла приложения](#finding-an-application-executable)
-   [Регистрация приложений](#registering-applications)
    -   [Использование подраздела путей к приложению](#using-the-app-paths-subkey)
    -   [Использование подраздела приложений](#using-the-applications-subkey)
-   [Регистрация команд и других сведений о сопоставлении файлов](#registering-verbs-and-other-file-association-information)
-   [Регистрация воспринимаемого типа](#registering-a-perceived-type)
-   [Связанные темы](#related-topics)

> [!Note]  
> Приложения также можно зарегистрировать в окне Настройка доступа к программам и параметров по умолчанию (SPAD) и задать приложения панели управления программы по умолчанию (SYDP). Сведения о регистрации приложений в SPAD и SYDP см. в разделе [рекомендации по сопоставлению файлов и программам по умолчанию](appguide-fa-defpro.md), [настройке доступа к программам и по умолчанию для компьютеров (SPAD)](cpl-setprogramaccess.md).

 

## <a name="finding-an-application-executable"></a>Поиск исполняемого файла приложения

При вызове функции [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) с именем исполняемого файла в его параметре *лпфиле* существует несколько мест, где функция ищет файл. Мы рекомендуем зарегистрировать приложение в подразделе реестра **app paths** . Это позволяет избежать необходимости изменять переменную среды системного пути в приложениях.

Файл ищется в следующих расположениях:

-   текущий рабочий каталог.
-   **Windows** только каталог (подкаталоги не ищутся).
-   каталог **Windows \\ System32** .
-   Каталоги, перечисленные в переменной среды PATH.
-   рекомендуется: **HKEY по \_ локального \_ компьютера** \\ **программное обеспечение** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **пути к приложению**

## <a name="registering-applications"></a>Регистрация приложений

Подразделы реестра " **пути приложений** " и " **приложения** " используются для регистрации и управления поведением системы от имени приложений. Подраздел **app paths** является предпочтительным расположением.

### <a name="using-the-app-paths-subkey"></a>Использование подраздела путей к приложению

в Windows 7 и более поздних версиях настоятельно рекомендуется устанавливать приложения для каждого пользователя, а не для каждого компьютера. приложение, установленное для каждого пользователя, может быть зарегистрировано в разделе **HKEY \_ текущее \_ пользовательское** \\ **программное обеспечение** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **пути к приложению**. приложение, установленное для всех пользователей компьютера, может быть зарегистрировано в разделе "программное обеспечение **\_ локального \_ компьютера**" \\ **по** \\  \\  \\  \\ **пути к приложению** Microsoft Windows CurrentVersion.

Записи, найденные в разделе **пути к приложениям** , используются в основном для следующих целей:

-   Для преобразования имени исполняемого файла приложения в полный путь к этому файлу.
-   Значение, чтобы предварительно доложить данные в переменную среды PATH для каждого приложения, отдельно для каждого процесса.

Если имя подраздела **путей к приложению** совпадает с именем файла, оболочка выполняет два действия:

-   Запись (по умолчанию) используется в качестве полного пути к файлу.
-   Запись пути для этого подраздела предваряется переменной среды PATH этого процесса. Если это не требуется, можно опустить значение пути.

Возможны следующие проблемы, которые следует учитывать:

-   Оболочка ограничивает длину командной строки МАКСИМАЛЬным числом символов, равным \_ \* 2. Если имеется много файлов, перечисленных в качестве записей реестра, или их пути слишком длинные, имена файлов, приведенные ниже в списке, могут быть потеряны, так как Командная строка усекается.
-   Некоторые приложения не принимают несколько имен файлов в командной строке.
-   Некоторые приложения, принимающие несколько имен файлов, не распознают формат, в котором они предоставляются оболочкой. Оболочка предоставляет список параметров в виде строки в кавычках, но некоторым приложениям могут потребоваться строки без кавычек.
-   Не все элементы, которые можно перетаскивать, являются частью файловой системы; Например, «принтеры». Эти элементы не имеют стандартного пути Win32, поэтому нет способа предоставить осмысленное значение *лппараметерс* для [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa).

Использование записи Дроптаржет позволяет избежать этих потенциальных проблем, предоставляя доступ ко всем форматам буфера обмена, включая [кфстр \_ шеллидлист](clipboard.md) (для длинных списков файлов) и [кфстр \_ филеконтентс](clipboard.md) (для объектов, не являющихся объектами файловой системы).

**Для регистрации и управления поведением приложений с помощью подраздела путей приложений**:

1.  Добавьте подраздел с тем же именем, что и у исполняемого файла, в подраздел **пути к приложению** , как показано в следующей записи реестра.

    ```
    HKEY_LOCAL_MACHINE or HKEY_CURRENT_USER
       SOFTWARE
          Microsoft
             Windows
                CurrentVersion
                   App Paths
                      file.exe
                         (Default)
                         DontUseDesktopChangeRouter
                         DropTarget
                         Path
                         UseUrl
    ```

2.  Сведения о записях подраздела **пути приложения** см. в следующей таблице. 

    
| Запись реестра | Сведения | 
|----------------|---------|
| (по умолчанию) | Полный путь к приложению. Имя приложения, указанное в записи (по умолчанию), может быть указано в или без расширения .exe. При необходимости функция <a href="/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa"><strong>ShellExecuteEx</strong></a> добавляет расширение при поиске подраздела <strong>пути к приложению</strong> . Запись относится к типу <strong>REG_SZ</strong> . | 
| донтуседесктопчанжераутер | является обязательным для приложений отладчика, чтобы избежать взаимоблокировок диалогового окна файлов при отладке процесса Windows Explorer. Однако установка записи Донтуседесктопчанжераутер значительно менее эффективно обрабатывает уведомления об изменениях. Запись относится к типу <strong>REG_DWORD</strong> , а значение — 0x1. | 
| DropTarget | — Это идентификатор класса (CLSID). Запись Дроптаржет содержит идентификатор CLSID объекта (обычно это локальный сервер, а не внутрипроцессный сервер), который реализует <a href="/windows/desktop/api/oleidl/nn-oleidl-idroptarget"><strong>интерфейс IDropTarget</strong></a>. По умолчанию, когда цель перетаскивания является исполняемым файлом и не указано значение Дроптаржет, оболочка преобразует список удаленных файлов в параметр командной строки и передает его в <a href="/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa"><strong>ShellExecuteEx</strong></a> через <em>лппараметерс</em>. | 
| Путь | Предоставляет строку (в виде разделенного точкой с запятой списка каталогов) для добавления к переменной среды PATH при запуске приложения путем вызова <a href="/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa"><strong>ShellExecuteEx</strong></a>. Это полный путь к .exe. Это <strong>REG_SZ</strong>. в <strong>Windows 7 и более поздних версиях</strong>тип может быть <strong>REG_EXPAND_SZ</strong>и обычно <strong>REG_EXPAND_SZ</strong> % ProgramFiles%.    <blockquote>    [!Note]<br />    Помимо записей (по умолчанию), пути и Дроптаржет, распознаваемых оболочкой, приложение может также добавлять пользовательские значения в подраздел <strong>пути приложения</strong> в исполняемом файле. Мы рекомендуем разработчикам приложений использовать подраздел <strong>пути к приложению</strong> , чтобы указать специфический для приложения путь вместо добавления к глобальному системному пути.    </blockquote><br /> | 
| SupportedProtocols | Создает строку, содержащую схемы протокола URL для данного ключа. Это может содержать несколько значений реестра для указания поддерживаемых схем. Эта строка соответствует формату <strong>scheme1: scheme2</strong>. Если этот список не пуст, в строку будет добавлен <strong>файл:</strong> . Этот протокол неявно поддерживается, если определен <em>суппортедпротоколс</em> . <br /> | 
| UseUrl | Указывает, что приложение может принять URL-адрес (вместо имени файла) в командной строке. Эта запись должна быть задана приложениями, которые могут открывать документы непосредственно из Интернета, например веб-браузеры и проигрыватели мультимедиа. <br /> Когда функция <a href="/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa"><strong>ShellExecuteEx</strong></a> запускает приложение, а значение усеурл = 1 не задано, <strong>ShellExecuteEx</strong> скачивает документ в локальный файл и вызывает обработчик для локальной копии.<br /> Например, если в приложении есть этот набор записей и пользователь щелкнул правой кнопкой мыши файл, хранящийся на веб-сервере, команда Открыть станет доступной. В противном случае пользователю потребуется загрузить файл и открыть локальную копию. <br /> Запись Усеурл имеет тип <strong>REG_DWORD</strong> , а значение — 0x1.<br /> в Windows Vista и более ранних версиях эта запись указывала на то, что URL-адрес должен быть передан в приложение вместе с локальным именем файла при вызове через ShellExecuteEx. в Windows 7 это означает, что приложение может понять, какой url-адрес http или https был передан ему, без необходимости указывать имя файла кэша. Этот раздел реестра связан с ключом <em>суппортедпротоколс</em> .<br /> | 


    

     

### <a name="using-the-applications-subkey"></a>Использование подраздела приложений

С помощью записей реестра, перечисленных в разделе **\_ \_ корневые приложения для классов hKey** \\  \\ *ApplicationName.exe* , приложения могут предоставлять сведения, относящиеся к приложению, приведенные в следующей таблице.



| Запись реестра                   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| \\команда оболочки                      | Предоставляет метод Verb для вызова приложения из Опенвис. Если определение глагола не указано, система предполагает, что приложение поддерживает [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa), и передает имя файла в командной строке. эта функция применяется ко всем методам команд, включая дроптаржет, ExecuteCommand и платформа динамических данных Exchange (DDE).                                                                                                                                                                                                                                                                                                                            |
| дефаултикон                      | Позволяет приложению указать конкретный значок для представления приложения вместо первого значка, хранящегося в файле .exe.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| фриендляппнаме                  | Предоставляет способ получения локализуемого имени, отображаемого для приложения, а не только сведений о версии, которые могут быть не подлежат локализации. [**Ассокстр**](/windows/desktop/api/Shlwapi/ne-shlwapi-assocstr) запроса на сопоставление считывает это значение записи реестра и возвращается к использованию имени филедескриптион в сведениях о версии. Если это имя отсутствует, запрос ассоциации по умолчанию имеет отображаемое имя файла. Приложения должны использовать **ассокстр \_ фриендляппнаме** для получения этих сведений, чтобы получить правильное поведение.                                                                                                                                                                        |
| суппортедтипес                   | Список типов файлов, поддерживаемых приложением. Это позволит включить приложение в список каскадного меню диалогового окна **Открыть с помощью** .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| нупенвис                       | Указывает, что для открытия этого типа файлов не указано ни одно приложение. Имейте в виду, что если подключ Опенвиспрогидс был задан для приложения по типу файла, а сам подраздел ProgID не имеет записи Нупенвис, это приложение появится в списке рекомендуемых или доступных приложений, даже если в нем указана запись Нупенвис. Дополнительные сведения см. в разделе как [включить приложение в диалоговое окно "Открыть с помощью](how-to-include-an-application-on-the-open-with-dialog-box.md) " и [как исключить приложение из диалогового окна "Открыть с помощью"](how-to-exclude-an-application-from-the-open-with-dialog-box-for-unassociated-file-types.md).<br/> |
| ишостапп                        | Указывает, что процесс является ведущим процессом, например Rundll32.exe или Dllhost.exe, и не должен учитываться при закреплении в меню **запуска** или включении в список наиболее часто используемых (часто используемые). При запуске с ярлыком, содержащим список аргументов, не равный null, или явные [идентификаторы модели пользователя приложения (аппусермоделидс)](appids.md), процесс можно закрепить (как это сочетание клавиш). Такие сочетания клавиш являются кандидатами для включения в список наиболее часто используемых.                                                                                                                                                                                                                                                  |
| OnStartPage                      | Указывает, что исполняемый файл и ярлыки приложения следует исключить из меню **Пуск** , а также закреплять или включать в список наиболее часто используемых программ. Эта запись обычно используется для исключения системных средств, установщиков и программ-установщиков и файлов readme.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| усиксекутаблефортаскбарграупикон | Заставляет панель задач использовать значок этого исполняемого файла по умолчанию, если для этого приложения нет ярлыка также прикрепляемые, а вместо значка окна, которое было впервые обнаружено.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| таскбарграупикон                 | Задает значок, используемый для переопределения значка панели задач. Обычно для панели задач используется значок окна. Установка записи Таскбарграупикон приводит к тому, что система использует значок из .exe приложения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |



 

### <a name="examples"></a>Примеры

Ниже приведены некоторые примеры регистраций приложений с **помощью \_ \_ корневых** \\ **приложений** \\ *ApplicationName.exe* подраздел "классы hKey". Все значения записей реестра имеют тип **reg \_ SZ** , за исключением **дефаултикон** , который имеет тип **\_ раскрытия reg Expand \_ SZ** .

```
HKEY_CLASSES_ROOT
   Applications
      wordpad.exe
         FriendlyAppName = @%SystemRoot%\System32\shell32.dll,-22069
```

```
HKEY_CLASSES_ROOT
   Applications
      wmplayer.exe
         SupportedTypes
            .3gp2
```

```
HKEY_CLASSES_ROOT
   Applications
      wmplayer.exe
         DefaultIcon
            (Default) = %SystemRoot%\system32\wmploc.dll,-730
```

```
HKEY_CLASSES_ROOT
   Applications
      WScript.exe
         NoOpenWith
```

```
HKEY_CLASSES_ROOT
   Applications
      photoviewer.dll
         shell
            open
               DropTarget
                  Clsid = {FFE2A43C-56B9-4bf5-9A79-CC6D4285608A}
```

```
HKEY_CLASSES_ROOT
   Applications
      mspaint.exe
         SupportedTypes
            .bmp
            .dib
            .rle
            .jpg
            .jpeg
            .jpe
            .jfif
            .gif
            .emf
            .wmf
            .tif
            .tiff
            .png
            .ico
```

## <a name="registering-verbs-and-other-file-association-information"></a>Регистрация команд и других сведений о сопоставлении файлов

Подразделы, зарегистрированные в разделе **\_ классы hKey \_ root** \\ **системфилеассоЦиатионс** , позволяют оболочке определять поведение по умолчанию атрибутов для типов файлов и включать общие сопоставления файлов. Когда пользователь изменяет приложение по умолчанию для типа файлов, идентификатор ProgID нового приложения по умолчанию имеет приоритет в предоставлении команд и других сведений о сопоставлении. Этот приоритет обусловлен тем, что он является первой записью в массиве ассоциаций. Если программа по умолчанию изменена, сведения в предыдущем ProgID больше не будут доступны.

Чтобы заранее решить последствия изменения программ по умолчанию, можно использовать **\_ классы hKey \_ root** \\ **системфилеассоЦиатионс** для регистрации команд и других сведений о сопоставлении. Из-за их расположения после идентификатора ProgID в массиве ассоциаций эти регистрации имеют более низкий приоритет. Эти СистемфилеассоЦиатионсрегистратионс стабильны, даже если пользователи меняют программы по умолчанию и предоставляют расположение для регистрации вторичных команд, которые всегда будут доступны для конкретного типа файлов. Пример реестра см. в подразделе [Регистрация наблюдаемого типа](#registering-a-perceived-type) далее в этой статье.

В следующем примере реестра показано, что происходит, когда пользователь запускает элемент **программы по умолчанию** на панели управления, чтобы изменить значение по умолчанию для .mp3 файлов на App2ProgID. После изменения значения по умолчанию Verb1 больше не доступно, а Verb2 становится значением по умолчанию.

```
HKEY_CLASSES_ROOT
   .mp3
      (Default) = App1ProgID
```

```
HKEY_CLASSES_ROOT
   App1ProgID
      shell
         Verb1
```

```
HKEY_CLASSES_ROOT
   App2ProgID
      shell
         Verb2
```

## <a name="registering-a-perceived-type"></a>Регистрация воспринимаемого типа

Значения реестра для наблюдаемых типов определяются как подразделы подраздела реестра **hKey \_ \_ root** \\ **системфилеассоЦиатионс** . Например, **текст** распознанного типа регистрируется следующим образом:

```
HKEY_CLASSES_ROOT
   SystemFileAssociations
      text
         shell
            edit
               command
                  (Default) = "%SystemRoot%\system32\NOTEPAD.EXE" "%1"
            open
               command
                  (Default) = "%SystemRoot%\system32\NOTEPAD.EXE" "%1"
```

Распознанный тип файла обозначается путем включения значения PerceivedType в подраздел типа файла. Для значения PerceivedType задается имя воспринимаемого типа, зарегистрированного в подразделе реестра **hKey \_ \_ root** \\ **системфилеассоЦиатионс** , как показано в предыдущем примере реестра. Например, чтобы объявить cpp Files как воспринимаемый тип "текст", добавьте следующую запись реестра:

```
HKEY_CLASSES_ROOT
   .cpp
      PerceivedType = text
```

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Типы файлов](fa-file-types.md)
</dt> <dt>

[Как работают сопоставления файлов](fa-how-work.md)
</dt> <dt>

[Представление содержимого по типу или виду файла](prophand-content-view.md)
</dt> <dt>

[Средство проверки типов файлов](file-type-verifier.md)
</dt> <dt>

[Обработчики типов файлов](fa-file-extensions.md)
</dt> <dt>

[Программные идентификаторы](fa-progids.md)
</dt> <dt>

[Наблюдаемые типы](fa-perceivedtypes.md)
</dt> <dt>

[Массивы ассоциаций](fa-associationarray.md)
</dt> </dl>

