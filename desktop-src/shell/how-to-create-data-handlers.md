---
description: Расширение буфера обмена с помощью пользовательских обработчиков формата данных.
title: Создание обработчиков данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 33ecc08769068d975c1fa16ef1385f362c67e43c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997710"
---
# <a name="how-to-create-data-handlers"></a>Создание обработчиков данных

Когда файл копируется в буфер обмена или перетаскивается и удаляется, оболочка создает объект данных, поддерживающий разнообразные стандартные [форматы буфера обмена](dragdrop.md). Для файлов определенного типа можно расширить доступные форматы буфера обмена, реализовав и зарегистрировав *обработчик данных*. При передаче файла типа файла оболочка делегирует вызовы интерфейса [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) объекта данных обработчику данных, если используется один из пользовательских форматов.

Общие процедуры для реализации и регистрации обработчика расширений оболочки обсуждаются в разделе [Создание обработчиков расширений оболочки](handlers.md). В этом документе рассматриваются аспекты реализации, характерные для обработчиков данных.

-   [Реализация обработчиков данных](#step-1-implementing-data-handlers)
-   [Регистрация обработчиков данных](#step-2-registering-data-handlers)
-   [См. также](#related-topics)

## <a name="instructions"></a>Инструкции

### <a name="step-1-implementing-data-handlers"></a>Шаг 1. Реализация обработчиков данных

Как и все обработчики расширений оболочки, обработчики данных — это объекты модели COM, реализованные в виде библиотек DLL. Они экспортируют два интерфейса в дополнение к [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) и [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject).

Оболочка инициализирует обработчик с помощью своего интерфейса [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) . Он использует этот интерфейс для запроса идентификатора класса (CLSID) обработчика и предоставляет ему имя файла. Общее описание способов реализации обработчиков расширений оболочки, включая интерфейс **IPersistFile** , см. в разделе [Создание обработчиков расширений оболочки](handlers.md).

После инициализации обработчика данных оболочка делегирует вызовы из объекта данных интерфейсу [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) обработчика, если используется один из пользовательских форматов.

### <a name="step-2-registering-data-handlers"></a>Шаг 2. Регистрация обработчиков данных

Обработчики данных регистрируются в подразделе *ProgID* типа файла, как показано ниже **: \_ классы hKey \_ root** \\ *ProgID* \\ **шеллекс** данных \\ **дескриптора**

Создайте подключ с именем для обработчика в разделе " **дескриптор** данных" и задайте значение по умолчанию для подраздела этого обработчика в виде строки GUID идентификатора CLSID обработчика. Общие сведения о регистрации обработчиков расширений оболочки см. в статье [Создание обработчиков расширений](handlers.md)оболочки.

В следующем примере показаны записи реестра, которые включают обработчик данных для типа файла example. МИП.

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   CLSID
      {00000000-1111-2222-3333-444444444444}
         InProcServer32
            (Default) = C:\MyDir\MyCommand.dll
            ThreadingModel = Apartment
   MyProgram.1
      (Default) = MyProgram Application
      Shellex
         DataHandler
            (Default) = {00000000-1111-2222-3333-444444444444}
```

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание обработчиков расширений оболочки](handlers.md)
</dt> <dt>

[**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject)
</dt> </dl>

 

 
