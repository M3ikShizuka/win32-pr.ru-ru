---
description: Щелчок объекта правой кнопкой мыши обычно приводит к отображению контекстного меню. Это меню содержит список команд, которые пользователь может выбрать для выполнения различных действий с объектом. В этом разделе представлены общие сведения о контекстных меню для объектов файловой системы.
ms.assetid: d951d1e8-0f88-49c4-8373-e6db0e18cd72
title: Расширение контекстных меню
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 895550ff050d559b3523676ddaa2a58099398a97
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104569080"
---
# <a name="extending-shortcut-menus"></a>Расширение контекстных меню

Щелчок объекта правой кнопкой мыши обычно приводит к отображению *контекстного меню*. Это меню содержит список команд, которые пользователь может выбрать для выполнения различных действий с объектом. В этом разделе представлены общие сведения о контекстных меню для объектов файловой системы.

-   [Контекстные меню для объектов файловой системы](#shortcut-menus-for-file-system-objects)
-   [Команды контекстного меню](#shortcut-menu-verbs)
    -   [Канонические команды](#canonical-verbs)
    -   [Расширенные глаголы](#extended-verbs)
-   [Расширение контекстного меню для типа файла](#extending-the-shortcut-menu-for-a-file-type)
-   [Расширение контекстного меню для предопределенных объектов оболочки](#extending-the-shortcut-menu-for-predefined-shell-objects)
-   [Регистрация приложения для управления произвольными типами файлов](#registering-an-application-to-handle-arbitrary-file-types)
-   [Расширение нового подменю](#extending-the-new-submenu)

Дополнительные сведения можно найти здесь:

-   [Определение расширенных команд](how-to-define-extended-verbs.md)
-   [Связывание команд с командами DDE](how-to-associate-verbs-with-dde-commands.md)

## <a name="shortcut-menus-for-file-system-objects"></a>Контекстные меню для объектов файловой системы

Когда пользователь щелкает правой кнопкой мыши объект, например файл, который отображается в проводнике Windows или на рабочем столе, отображается контекстное меню со списком команд. Затем пользователь может выполнить действие с файлом, например открыть или удалить его, выбрав соответствующую команду.

Так как контекстные меню часто используются для управления файлами, оболочка предоставляет набор команд по умолчанию, таких как вырезание и копирование, которые отображаются в контекстном меню для любого файла. Обратите внимание, что хотя команда Открыть с помощью является командой по умолчанию, она не отображается для некоторых стандартных типов файлов, таких как. wav. На следующем рисунке примера каталога Мои документы, который также использовался в качестве примера при [настройке значков](icon.md), отображается контекстное меню по умолчанию, отображаемое при щелчке правой кнопкой мыши MyDocs4.xyz.

![снимок экрана контекстного меню по умолчанию для объектов файловой системы](images/context1.jpg)

Причина, по которой MyDocs4.xyz отображает контекстное меню по умолчанию, заключается в том, что она не является членом зарегистрированного [типа файла](fa-file-types.md). С другой стороны, txt — это зарегистрированный тип файла. Если щелкнуть правой кнопкой мыши один из TXT-файлов, в его верхней части появится контекстное меню с двумя дополнительными командами: **Открыть** и **напечатать**.

![снимок экрана с пользовательским контекстным меню для объектов файловой системы](images/context2.jpg)

После регистрации типа файла можно расширить его контекстное меню с помощью дополнительных команд. Они отображаются над командами по умолчанию при щелчке правой кнопкой мыши любого файла этого типа. Хотя большинство команд, добавленных таким способом, являются общими, например **Печать** или **Открытие**, вы можете добавить любую команду, которую может получить пользователь.

Все, что требуется для расширения контекстного меню для типа файла, — создание записи реестра для каждой команды. Более сложный подход заключается в реализации *обработчика контекстного меню*, который позволяет расширять контекстное меню для типа файла по отдельности для каждого файла. Дополнительные сведения см. в разделе [Создание обработчиков контекстного меню](context-menu-handlers.md).

## <a name="shortcut-menu-verbs"></a>Команды контекстного меню

Каждая команда контекстного меню определяется в реестре *командой.* Эти команды аналогичны тем, которые используются [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) при запуске приложений программным способом. Дополнительные сведения об использовании **ShellExecuteEx** см. в обсуждении в разделе [Запуск приложений](launch.md).

Глагол — это простая текстовая строка, которая используется оболочкой для обнаружения связанной команды. Каждая команда соответствует *строке команды* , используемой для запуска команды в окне консоли или в файле пакета (bat). Например, команда **Open** обычно запускает программу, чтобы открыть файл. Ее Командная строка обычно выглядит примерно так:

``` syntax
"My Program.exe" "%1"
```

"%1" — это стандартный заполнитель для параметра командной строки, предоставленного с именем файла. Например, он может указать конкретную страницу для отображения в представлении с вкладками.

> [!Note]  
> Если любой из элементов командной строки содержит или может содержать пробелы, его необходимо заключить в кавычки. В противном случае, если элемент содержит пробел, он будет проанализирован неправильно. Например, "My Program.exe" запустит приложение должным образом. Если используется Program.exe, система попытается запустить "My" с "Program.exe" в качестве первого аргумента командной строки. Следует всегда использовать кавычки с аргументами, такими как "%1", которые разворачиваются оболочкой, так как нельзя уверенно, что строка не будет содержать пробелов.

 

С командами также может быть связана *отображаемая строка* , которая отображается в контекстном меню вместо самой строки команды. Например, отображаемая строка для **Опенас** открыта с помощью. Как и обычные строки меню, включая амперсанд (&) в отображаемой строке, позволяет выбрать команду с клавиатуры.

### <a name="canonical-verbs"></a>Канонические команды

Как правило, приложения отвечают за предоставление локализованных отображаемых строк для глаголов, которые они определяют. Однако для обеспечения степени независимости от языка система определяет стандартный набор часто используемых глаголов, называемых *каноническими глаголами*. Каноническая команда может использоваться с любым языком, а система автоматически создает правильно локализованную отображаемую строку. Например, отображаемая строка **открытия** команды будет открыта в английской системе и öффнен в системе на немецком языке.

Канонические команды включают:



| Значение      | Описание                                                                                 |
|------------|---------------------------------------------------------------------------------------------|
| open       | Открывает файл или папку.                                                                   |
| опеннев    | Открывает файл или папку в новом окне.                                                   |
| print      | Выводит файл.                                                                            |
| обзор    | Открывает проводник Windows с выбранной папкой.                                            |
| поиск       | Открывает диалоговое окно **Поиск Windows** с набором папок в качестве расположения поиска по умолчанию. |
| опенас     | Открывает диалоговое окно **Открыть с помощью** .                                                         |
| properties | Открывает страницу свойств объекта.                                                          |



 

Команда принтто также является канонической, но никогда не отображается. Он позволяет пользователю распечатать файл, перетащив его на объект принтера.

### <a name="extended-verbs"></a>Расширенные глаголы

Когда пользователь щелкает правой кнопкой мыши объект, контекстное меню содержит все обычные команды. Однако могут существовать команды, которые должны поддерживаться, но не отображаться в каждом контекстном меню. Например, можно использовать команды, которые обычно не используются или предназначены для опытных пользователей. По этой причине можно также определить одну или несколько *расширенных команд*. Эти глаголы также являются символьными строками и похожи на обычные команды. Они отличаются от обычных глаголов способом их регистрации. Чтобы получить доступ к командам, связанным с расширенными командами, пользователь должен щелкнуть правой кнопкой мыши объект, удерживая нажатой клавишу SHIFT. Расширенные команды будут отображаться вместе с обычными командами.

## <a name="extending-the-shortcut-menu-for-a-file-type"></a>Расширение контекстного меню для типа файла

Самый простой способ расширить контекстное меню для типа файла — с помощью реестра. Для этого добавьте подраздел **Shell** под ключом для идентификатора ProgID приложения, связанного с [типом файла](fa-file-types.md). При необходимости можно определить *глагол по умолчанию* для типа файла, сделав его значением по умолчанию для подраздела **Shell** .

Команда по умолчанию отображается в контекстном меню первой. Его целью является предоставление оболочки с глаголом, который может использоваться при вызове [**ShellExecuteEx**](/windows/desktop/api/Shellapi/nf-shellapi-shellexecuteexa) , но не задано ни одной команды. Оболочка не обязательно выбирает команду по умолчанию, когда **ShellExecuteEx** используется таким образом. Для оболочек [версии 5,0](versions.md) и более поздних, которые находятся в системах Windows 2000 и более поздних версий, оболочка использует первую доступную команду из следующего списка. Если они отсутствуют, операция завершается ошибкой.

-   Команда открытия
-   Команда по умолчанию
-   Первая команда в реестре
-   Команда опенвис

Для версий оболочки, предшествовавших [версии 5,0](versions.md), опустите третий элемент.

Под подразделом **Shell** создайте один подраздел для каждой добавляемой команды. Каждый из этих подразделов будет иметь значение **reg \_ SZ** , заданное для отображаемой строки команды. Можно опустить отображаемую строку для канонических команд, так как система автоматически отображает правильно локализованную строку. Если не указать отображаемую строку для неканонических команд, будет отображена строка команды. Для каждого подраздела команды создайте подраздел **команды** со значением по умолчанию, равным строке команды.

На следующем рисунке показано контекстное меню для типа файла МИП, используемого в [типах файлов](fa-file-types.md) и [настраиваемых значков](icon.md). Теперь у него есть команды Open, доит, Print и принтто в контекстном меню с доит в качестве глагола по умолчанию. Контекстное меню выглядит следующим образом.

![снимок экрана настраиваемого контекстного меню](images/context3.jpg)

Для расширения контекстного меню, показанного на предыдущем рисунке, используются следующие записи реестра:

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      Shell
         (Default) = doit
         open
            command
               (Default) = C:\MyDir\MyProgram.exe "%1"
         doit
            (Default) = &Do It
            command
               (Default) = C:\MyDir\MyProgram.exe /d "%1"
         print
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1"
         printto
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1" "%2" %3 %4
```

Хотя команда " **Открыть с помощью** " находится выше первого разделителя, она автоматически создается системой и не требует записи реестра. Система автоматически создает отображаемые имена для канонических команд Open и Print. Так как доит не является канонической командой, ей назначается отображаемое имя "&сделать", которое можно выбрать, нажав клавишу D. Команда принтто не отображается в контекстном меню, но позволяет пользователю печатать файлы путем их перетаскивания на значок принтера. В этом примере %1 представляет имя файла и %2 имя принтера.

Команды можно подавлять с помощью параметров политики, добавив значение Суппрессионполици в ключ команды. Присвойте параметру Суппрессионполици значение ID политики. Если политика включена, команда и связанная с ней запись контекстного меню подавляются. Возможные значения идентификатора политики см. в описании перечисления [**ограничений**](/windows/desktop/api/shlobj_core/ne-shlobj_core-restrictions) .

## <a name="extending-the-shortcut-menu-for-predefined-shell-objects"></a>Расширение контекстного меню для предопределенных объектов оболочки

У многих предопределенных объектов оболочки есть контекстные меню, которые можно расширять. Зарегистрируйте команду практически так же, как при регистрации типов файлов, но используйте имя предопределенного объекта в качестве имени типа файла.

Список предопределенных объектов можно найти в разделе *предопределенные объекты оболочки* [Создание обработчиков расширений оболочки](handlers.md). Эти предопределенные объекты оболочки, контекстные меню которых можно расширить путем добавления команд в реестр, помечаются в таблице словом "глагол".

## <a name="registering-an-application-to-handle-arbitrary-file-types"></a>Регистрация приложения для управления произвольными типами файлов

В предыдущих разделах этого документа обсуждалось, как определить пункты контекстного меню для конкретного типа файлов. Помимо прочего, определение контекстного меню позволяет указать, как связанное приложение открывает элемент типа файла. Однако, как описано в разделе [типы файлов](fa-file-types.md), приложения также могут зарегистрировать отдельную процедуру по умолчанию, которая будет использоваться, когда пользователь пытается использовать приложение для открытия типа файла, который не был связан с приложением. Этот раздел описан здесь, поскольку процедура по умолчанию регистрируется практически так же, как и элементы контекстного меню.

Процедура по умолчанию служит двум основным целям. Одним из них является указание способа вызова приложения для открытия произвольного типа файла. Например, можно использовать флаг командной строки, чтобы указать, что открывается неизвестный тип файла. Другой целью является определение различных характеристик типа файла, например пунктов контекстного меню и значка. Если пользователь связывает приложение с дополнительным типом файлов, этот тип будет иметь эти характеристики. Если дополнительный тип файла был ранее связан с другим приложением, эти характеристики заменят оригиналы.

Чтобы зарегистрировать процедуру по умолчанию, поместите те же разделы реестра, которые были созданы для ProgID приложения, в подраздел приложения **\_ \_ корневые приложения классов hKey** \\ . Можно также включить значение Фриендляппнаме, чтобы предоставить системе понятное имя приложения. Понятное имя приложения также может быть извлечено из исполняемого файла, но только в том случае, если значение Фриендляппнаме отсутствует. В следующем фрагменте реестра показан пример процедуры по умолчанию для MyProgram.exe, которая определяет понятное имя и несколько пунктов контекстного меню. Командные строки включают флаг/a, чтобы уведомить приложение о том, что он открывает произвольный тип файла. При включении подраздела **дефаултикон** следует использовать универсальный значок.

```
HKEY_CLASSES_ROOT
   Applications
      MyProgram.exe
         FriendlyAppName = Friendly Name
         shell
            open
               command
                  (Default) = C:\MyDir\MyProgram.exe /a "%1"
            print
               command
                  (Default) = C:\MyDir\MyProgram.exe /a /p "%1"
            printto
               command
                  (Default) = C:\MyDir\MyProgram.exe /a /p "%1" "%2" %3 %4
```

## <a name="extending-the-new-submenu"></a>Расширение нового подменю

Когда пользователь открывает меню **файл** в проводнике Windows, первая команда является **новой**. При выборе этой команды отображается подменю. По умолчанию он содержит две команды, **папку** и **ярлык**, которые позволяют пользователям создавать вложенные папки и ярлыки. Это подменю можно расширить, включив команды создания файлов для любого типа файлов.

Чтобы добавить команду создания файла в подменю **создать** , файлам приложения должен быть назначен [Тип файла](fa-file-types.md) . Включите подраздел **шеллнев** в ключ для расширения имени файла. Если выбрана команда **создать** меню **файл** , оболочка добавит ее в подменю **создать** . Отображаемая строка команды будет представлять собой описательную строку, назначенную ProgID программы.

Назначьте одно или несколько значений данных подразделу **шеллнев** , чтобы указать метод создания файла. Доступные значения:



| Значение    | Описание                                                                                                                                                   |
|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Команда  | Выполняет приложение. Это значение **reg \_ SZ** , указывающее путь к выполняемому приложению. Например, можно задать запуск мастера. |
| Данные     | Создает файл, содержащий указанные данные. Данные — это **\_ двоичное значение reg** с данными файла. Данные пропускаются, если указано либо Нуллфиле, либо FileName.  |
| FileName | Создает файл, который является копией указанного файла. FileName — это значение **reg \_ SZ** , которое задает полный путь к копируемому файлу.                 |
| нуллфиле | Создает пустой файл. Нуллфиле не присваивается значение. Если указан параметр Нуллфиле, значения данных и имен файлов не учитываются.                                  |



 

На следующем рисунке показано **новое** подменю для типа файла МИП, используемого в качестве примера в [типах файлов](fa-file-types.md) и [настройки значков](icon.md). Теперь у него есть команда **MyProgram Application**. Когда пользователь выбирает **приложение MyProgram** из подменю " **создать** ", оболочка создает файл с именем "New MyProgram Application. МИП" и передает его в MyProgram.exe.

![снимок экрана пользовательского меню "создать"](images/context5.png)

Запись реестра теперь выглядит следующим образом:

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
      MyProgram.1
         ShellNew
            NullFile
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = C:\MyDir\MyProgram.exe,2
      Shell
         (Default) = doit
         open
            command
               (Default) = C:\MyDir\MyProgram.exe "%1"
         doit
            (Default) = &Do It
            command
               (Default) = C:\MyDir\MyProgram.exe /d "%1"
         print
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1"
         printto
            command
               (Default) = C:\MyDir\MyProgram.exe /p "%1" "%2" %3 %4
```

 

 



