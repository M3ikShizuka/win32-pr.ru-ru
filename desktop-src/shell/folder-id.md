---
description: Прежде чем можно будет использовать объект пространства имен, необходимо получить способ его распознавания.
ms.assetid: 54225481-a147-4d29-a642-24c9b59fc3ac
title: Получение идентификатора папки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb2e62454bf27f2c203f59aecb325cefe6537d2a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997734"
---
# <a name="getting-a-folders-id"></a>Получение идентификатора папки

Прежде чем можно будет использовать объект пространства имен, необходимо получить способ его распознавания. Это означает получение либо указателя на список идентификаторов элементов (ПИДЛ), либо, в случае с объектами файловой системы, его путь. В этом разделе обсуждаются два простых способа получения идентификаторов объектов.

Для более эффективного подхода, который будет работать с любой папкой, используйте интерфейс [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) . Дополнительные сведения см. [в разделе Получение сведений о содержимом папки](folder-info.md) .

-   [Диалоговое окно OpenFiles](#the-openfiles-dialog-box)
-   [Диалоговое окно "Шбровсефорфолдер"](#the-shbrowseforfolder-dialog-box)
-   [Специальные папки и Ксидлс](#special-folders-and-csidls)
-   [Простой пример использования Ксидлс и Шбровсефорфолдер](#a-simple-example-of-how-to-use-csidls-and-shbrowseforfolder)

## <a name="the-openfiles-dialog-box"></a>Диалоговое окно OpenFiles

Чтобы разрешить пользователю переходить по пространству имен и выбрать папку, приложение может использовать интерфейс [**ифиледиалог**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifiledialog) . Вызов этого интерфейса с помощью флага **\_ пиккфолдерс Фос** открывает диалоговое окно Общие [файлы](../dlgbox/open-and-save-as-dialog-boxes.md) в режиме "Выбор папок".

Для Windows Vista и более поздних версий это рекомендуемый способ выбора папок.

## <a name="the-shbrowseforfolder-dialog-box"></a>Диалоговое окно "Шбровсефорфолдер"

Чтобы разрешить пользователю переходить по пространству имен и выбрать папку, приложение может просто вызвать [**шбровсефорфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbrowseforfoldera). При вызове этой функции открывается диалоговое окно с пользовательским интерфейсом, который похож на общие диалоговые окна [Open или SaveAs](../dlgbox/open-and-save-as-dialog-boxes.md) .

Когда пользователь выбирает папку, [**шбровсефорфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbrowseforfoldera) ВОЗВРАЩАЕТ полный Пидл папки и ее отображаемое имя. Если папка находится в файловой системе, приложение может преобразовать ПИДЛ в путь, вызвав [**шжетпасфромидлист**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetpathfromidlista). Приложение также может ограничить диапазон папок, которые пользователь может выбрать из, указав корневую папку. Отобразятся только те папки, которые находятся ниже корневого каталога в пространстве имен. На следующем рисунке показано диалоговое окно **шбровсефорфолдер** , в котором корневая папка имеет значение Program Files.

![снимок экрана — диалоговое окно "Выбор папки"](images/shell1.png)

Ниже приведен простой пример использования [**шбровсефорфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbrowseforfoldera) .

## <a name="special-folders-and-csidls"></a>Специальные папки и Ксидлс

Некоторые часто используемые папки обозначены системой как *Специальные* . Эти папки имеют четко определенную цель, и большинство из них есть на всех системах. Даже если они отсутствуют изначально, их имена и расположения по-прежнему определяются, поэтому их можно добавить позже. Коллекция специальных папок включает все стандартные виртуальные папки системы, такие как принтеры, мои документы и сетевое окружение. Он также включает ряд стандартных папок файловой системы, таких как Program Files и System.

Несмотря на то что папки являются стандартными компонентами всех систем, их имена и расположения в пространстве имен могут различаться. Например, системный каталог — C: \\ WinNT \\ system32 в некоторых системах и C: \\ Windows \\ system32 на других компьютерах. В прошлом переменные среды предоставили способ определения имени и расположения специальной папки в любой конкретной системе. Теперь оболочка предоставляет более надежный и гибкий способ обнаружения специальных папок, [**ксидлс**](csidl.md). Обычно их следует использовать вместо переменных среды.

Ксидлс обеспечивают единообразный способ идентификации и обнаружения специальных папок, независимо от их имени или расположения в определенной системе. В отличие от переменных среды, Ксидлс можно использовать с виртуальными папками, а также с папками файловой системы. Каждой особой папке назначается уникальный код CSID. Например, папка "Program Files" имеет код CSID **\_ программных \_ файлов CSid**, а виртуальная папка сетевого окружения имеет CSid-код CSID **\_ сети**.

CSID используется в сочетании с одной из нескольких функций оболочки для получения ПИДЛ специальной папки или пути к особой папке файловой системы. Если папка не существует в системе, приложение может принудительно создать его, объединив его маркер CSID с параметром **CSid \_ \_ CREATE**. Код CSID можно передать следующим функциям:

-   [**Шжетфолдерлокатион**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderlocation), который извлекает Пидл специальной папки.
-   [**Шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha), который извлекает путь к специальной папке файловой системы.

Обратите внимание, что эти две функции появились в оболочке версии 5,0 и заменяют функции [**шжетспеЦиалфолдерлокатион**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetspecialfolderlocation) и [**шжетспеЦиалфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetspecialfolderpatha) .

## <a name="a-simple-example-of-how-to-use-csidls-and-shbrowseforfolder"></a>Простой пример использования Ксидлс и Шбровсефорфолдер

В следующем примере функции Пидлбровсе показано, как использовать Ксидлс для получения ПИДЛ папки и использовать [**шбровсефорфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbrowseforfoldera) для выбора пользователем папки. Он возвращает ПИДЛ и отображаемое имя выбранной папки.


```
LPITEMIDLIST PidlBrowse(HWND hwnd, int nCSIDL, LPSTR pszDisplayName)
{
    LPITEMIDLIST pidlRoot = NULL;
    LPITEMIDLIST pidlSelected = NULL;
    BROWSEINFO bi = {0};

    if(nCSIDL)
    {
        SHGetFolderLocation(hwnd, nCSIDL, NULL, NULL, &pidlRoot);
    }

    else
    {
        pidlRoot = NULL;
    }

    bi.hwndOwner = hwnd;
    bi.pidlRoot = pidlRoot;
    bi.pszDisplayName = pszDisplayName;
    bi.lpszTitle = "Choose a folder";
    bi.ulFlags = 0;
    bi.lpfn = NULL;
    bi.lParam = 0;

    pidlSelected = SHBrowseForFolder(&bi);

    if(pidlRoot)
    {
        CoTaskMemFree(pidlRoot);
    }

    return pidlSelected;
}
```



Вызывающее приложение передает в обработчик окна, который необходим для [**шбровсефорфолдер**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shbrowseforfoldera). Параметр *нксидл* — это необязательный CSid, который используется для указания корневой папки. Будут отображены только папки, расположенные под корневой папкой в иерархии. Иллюстрация, показанная ранее, была создана путем вызова этой функции с *нксидл* , для которой заданы **\_ программные \_ файлы CSid**. Вызывающее приложение также передает строковый буфер *pszDisplayName* для хранения отображаемого имени выбранной папки, когда пидлбровсе возвращает. Вызывающее приложение отвечает за освобождение IDList, возвращенного **шбровсефорфолдер** с помощью [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).

 

 
