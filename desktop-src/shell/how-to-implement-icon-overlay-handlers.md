---
description: Обработчики наложения значков являются внутрипроцессного COM-объектами, реализованными в виде библиотек DLL.
ms.assetid: ADF27BFD-CC96-43F9-9EBB-DEBE0DEA7B92
title: Реализация обработчиков наложения значков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e22c1057f65c50b31c6627846ec77103827a0283
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985428"
---
# <a name="how-to-implement-icon-overlay-handlers"></a>Реализация обработчиков наложения значков

Обработчики наложения значков являются внутрипроцессного COM-объектами, реализованными в виде библиотек DLL. В дополнение к [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**ишелликоноверлайидентифиер**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelliconoverlayidentifier), они экспортируют один интерфейс. Этот интерфейс имеет три метода: [**ишелликоноверлайидентифиер:: жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo), [**Ишелликоноверлайидентифиер:: предшествовал**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority)и [**ишелликоноверлайидентифиер:: IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof).

## <a name="instructions"></a>Инструкции

### <a name="step-1-implementing-getoverlayinfo"></a>Шаг 1. Реализация Жетоверлайинфо

Метод [**жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) сначала вызывается во время инициализации. Метод возвращает полный путь к файлу, содержащему изображение наложения значка, и его Отсчитываемый от нуля индекс в файле. Затем оболочка добавляет образ в список образов системы. Наложения значков могут содержаться в любом из стандартных типов файлов, включая exe, DLL и ICO.

После завершения инициализации оболочка вызывает [**жетоверлайинфо**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getoverlayinfo) , когда требуется отобразить наложение значка обработчика. Метод должен возвращать то же имя файла и индекс, который выполнялся во время инициализации. Хотя оболочка использует образ, кэшированный в списке системных образов, а не загружает образ из файла, наложение значков по-прежнему определяется по имени файла и индексу.

### <a name="step-2-implementing-getpriority"></a>Шаг 2. Реализация Предшествовалного

Метод [**WebMethod**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) вызывается только во время инициализации. Он назначает значение приоритета для наложения значка обработчика. Значение может варьироваться от нуля до 100, где 100 — самый низкий приоритет. Назначение этого значения приоритета заключается в том, чтобы помочь оболочке разрешить конфликт, возникающий, если для одного объекта задано несколько наложений значков. Оболочка сначала использует внутренний набор правил для определения наложения значков с наивысшим приоритетом. Если эти правила не разрешают конфликт, значения, назначенные для наложения значков, **определяют приоритет** .

Значение приоритета, установленное методом [**предшествовал**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-getpriority) , не является надежным способом разрешения конфликтов между обработчиками наложения несвязанных значков. Обработчику не существует способа определить, какие значения приоритета используются другими обработчиками. Обычно значение должно быть равно нулю. Однако значение приоритета полезно при реализации двух или более обработчиков наложения значков, которые могут запрашивать значки наложения значков для одного и того же объекта. Устанавливая соответствующие значения приоритета, можно указать, какие из запрошенных наложения значков будут отображаться.

### <a name="step-3-implementing-ismemberof"></a>Шаг 3. Реализация IsMemberOf

Оболочка вызывает метод [**IsMemberOf**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelliconoverlayidentifier-ismemberof) , чтобы определить, должен ли он отображать наложение значка обработчика для определенного объекта. Оболочка задает объект, передав его имя в метод. Если обработчик хочет отобразить наложение значка, **IsMemberOf** возвращает S \_ ОК. В противном случае возвращается \_ значение false.

Обработчики наложения значков обычно предназначены для работы с определенной группой файлов. Типичный пример — это [Тип файла](fa-file-types.md), идентифицируемый по определенному расширению имени файла. Обработчик наложения значков может запрашивать наложение значка для всех файлов типа файлов. Некоторые обработчики запрашивают наложение значка, только если файл типа файла находится в определенном состоянии. Однако обработчики наложения значков свободны для запроса наложения значков для любого объекта, который они выбирают.

 

 
