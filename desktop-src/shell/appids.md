---
description: Идентификаторы моделей пользователей приложений (Аппусермоделидс) широко используются панелью задач в Windows 7 и более поздних системах для связывания процессов, файлов и окон с определенным приложением.
ms.assetid: ebce2d99-6f20-4545-9f12-d79cd8d0828f
title: Идентификаторы модели пользователя приложения (Аппусермоделидс)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 46b79f0bdd7fb5e6c4d5c41caa3cd6be3f4fb57e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104540578"
---
# <a name="application-user-model-ids-appusermodelids"></a>Идентификаторы модели пользователя приложения (Аппусермоделидс)

Идентификаторы моделей пользователей приложений (Аппусермоделидс) широко используются панелью задач в Windows 7 и более поздних системах для связывания процессов, файлов и окон с определенным приложением. В некоторых случаях достаточно полагаться на внутренний AppUserModelID, назначенный процессу системы. Однако приложение, владеющее несколькими процессами или приложением, которое выполняется в хост-процессе, может потребовать явно идентифицировать себя, чтобы он мог сгруппировать неразрозненные окна в одной кнопке панели задач и управлять содержимым списка переходов этого приложения.

-   [Определяемые приложением и System-Defined Аппусермоделидс](#application-defined-and-system-defined-appusermodelids)
-   [Как сформировать AppUserModelID Application-Defined](#how-to-form-an-application-defined-appusermodelid)
-   [Назначение AppUserModelID](#where-to-assign-an-appusermodelid)
-   [Регистрация приложения в качестве хост-процесса](#registering-an-application-as-a-host-process)
-   [Списки исключений для закрепления панели задач и последних или часто встречающихся списков](#exclusion-lists-for-taskbar-pinning-and-recentfrequent-lists)
-   [См. также](#related-topics)

## <a name="application-defined-and-system-defined-appusermodelids"></a>Application-Defined и System-Defined Аппусермоделидс

Некоторые приложения не объявляют явный AppUserModelID. Они необязательны. В этом случае система использует ряд эвристических правил для назначения внутреннего AppUserModelID. Однако существует выигрыш в производительности, позволяющий избежать этих вычислений, и явный AppUserModelID является единственным способом гарантировать точное взаимодействие с пользователем. Поэтому настоятельно рекомендуется задать явный идентификатор. Приложения не могут извлечь назначенный системой AppUserModelID.

Если приложение использует явный AppUserModelID, оно также должно назначать один и тот же AppUserModelID всем работающим окнам, процессам, ярлыкам и сопоставлениям файлов. Он также должен использовать этот AppUserModelID при настройке списка переходов с помощью [**икустомдестинатионлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icustomdestinationlist)и во всех вызовах [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs).

> [!Note]  
> Если у приложений нет явного AppUserModelID, они должны вызывать методы [**иаппликатиондестинатионс**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationdestinations), [**иаппликатиондокументлистс**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationdocumentlists)и [**икустомдестинатионлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icustomdestinationlist) , а также [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs) в приложении. Если эти методы вызываются из другого процесса, такого как установщик или программа удаления, система не может создать правильный AppUserModelID, и эти вызовы не будут действовать.

 

Следующие элементы описывают типичные сценарии, для которых требуется явный AppUserModelID. Они также указывают на случаи, когда следует использовать несколько явных Аппусермоделидс.

-   Один исполняемый файл с пользовательским ИНТЕРФЕЙСом с несколькими режимами, которые отображаются для пользователя как отдельные приложения, должен назначить разные Аппусермоделидс для каждого режима. Например, часть приложения, которую пользователи видят как независимый интерфейс, которую они могут закрепить и запускать на панели задач отдельно от остальной части приложения, должны иметь свой собственный AppUserModelID, отделяющий от основного интерфейса.
-   Несколько сочетаний клавиш с разными аргументами, которые ведут к тому, что пользователь видит как одно приложение, должны использовать один AppUserModelID для всех сочетаний клавиш. Например, Windows Internet Explorer имеет разные сочетания клавиш для различных режимов (например, запуск без надстроек), но все они должны отображаться для пользователя в виде одного экземпляра Internet Explorer.
-   Исполняемый файл, который выступает в качестве хост-процесса и запускает целевое содержимое как приложение, должно быть [зарегистрировано как ведущее приложение](#registering-an-application-as-a-host-process), после чего оно может назначить разные аппусермоделидс для каждого наблюдаемого интерфейса, который он размещает. Кроме того, ведущий процесс может позволить размещенной программе задать ее Аппусермоделидс. В любом случае ведущий процесс должен сохранить запись источника Аппусермоделидс, либо самого себя, либо размещенного приложения. В этом случае основное взаимодействие с основным пользователем хост-процесса без целевого содержимого отсутствует. Примерами являются удаленные приложения Windows, интегрированные локально (шина), среда выполнения Java, RunDLL32.exe или DLLHost.exe.

    В случае существующих размещенных приложений система пытается обнаружить отдельные интерфейсы, но новые приложения должны использовать явные Аппусермоделидс, чтобы обеспечить требуемый пользовательский интерфейс.

-   Совместное или сцепленные процессы, входящие в состав одного приложения, должны иметь один и тот же AppUserModelID, примененный к каждому процессу. К примерам относятся игры с процессом запуска (цепочки) и проигрыватель Microsoft Windows Media, который имеет первый запуск или процесс установки, выполняющийся в одном процессе, и основное приложение, выполняющееся в другом процессе (совместное выполнение).
-   Расширение пространства имен оболочки, которое выступает в качестве отдельного приложения для более чем для обзора и управления содержимым в проводнике Windows, должно назначить AppUserModelID в свойствах папки. Примером является панель управления.
-   В среде виртуализации, такой как платформа развертывания, среда виртуализации должна назначить разные Аппусермоделидс для каждого управляемого приложения. В таких случаях средство запуска приложений использует промежуточный процесс для настройки среды, а затем передает операцию другому процессу для запуска приложения. Обратите внимание, что это приводит к тому, что система не сможет привязать выполняющийся целевой процесс к ярлыку, так как ярлык указывает на промежуточный процесс.

    Если какое бы то ни было приложение имеет несколько окон, ярлыков или процессов, к каждой из них также следует применить этот AppUserModelID в среде виртуализации.

    Примером такой ситуации является платформа ClickOnce, которая правильно назначает Аппусермоделидс от имени управляемых им приложений. Как и во всех таких средах, приложения, развернутые и управляемые с помощью ClickOnce, не должны назначать явные Аппусермоделидс, так как это приведет к конфликту с Аппусермоделидс, назначенным ClickOnce, и привести к непредвиденным результатам.

## <a name="how-to-form-an-application-defined-appusermodelid"></a>Как сформировать AppUserModelID Application-Defined

Приложение должно предоставить свой AppUserModelID в следующей форме. Оно может содержать не более 128 символов и не может включать пробелы. Каждый раздел должен быть в стиле Pascal.

`CompanyName.ProductName.SubProduct.VersionInformation`

`CompanyName` и `ProductName` всегда следует использовать, в то время `SubProduct` как `VersionInformation` части и являются необязательными и зависят от требований приложения. `SubProduct` позволяет основному приложению, состоящему из нескольких подприложений, создать отдельную кнопку панели задач для каждого Подприложения и связанных с ним окон. `VersionInformation` позволяет двум версиям приложения сосуществовать в виде дискретных сущностей. Если приложение не предназначено для использования таким образом, `VersionInformation` следует опустить, чтобы обновленная версия могла использовать тот же AppUserModelID, что и заменяющая версия.

## <a name="where-to-assign-an-appusermodelid"></a>Назначение AppUserModelID

Если приложение использует один или несколько явных Аппусермоделидс, оно должно применять эти Аппусермоделидс в следующих местах и ситуациях:

-   В свойстве [System.AppUserModel.ID](../properties/props-system-appusermodel-id.md) файла ярлыка приложения. Ярлык (как [**ишелллинк**](/windows/desktop/api/Shobjidl_core/nn-shobjidl_core-ishelllinka), CLSID \_ шелллинк или LNK-файл) поддерживает свойства с помощью [**ипропертисторе**](/windows/win32/api/propsys/nn-propsys-ipropertystore) и других механизмов настройки свойств, используемых во всей оболочке. Это позволяет панели задач задать правильный ярлык для ПИН-кода и убедиться, что Windows, принадлежащие процессу, соответствующим образом связаны с этой кнопкой.
    > [!Note]  
    > Свойство [System.AppUserModel.ID](../properties/props-system-appusermodel-id.md) должно применяться к ярлыку при создании этого ярлыка. При использовании Microsoft установщик Windows (MSI) для установки приложения Таблица [мсишорткутпроперти](../msi/msishortcutproperty-table.md) позволяет применить AppUserModelID к ярлыку при его создании во время установки.

     

-   Как свойство любого приложения, работающего под Windows. Это можно задать одним из двух способов:

    1.  Если разным окнам, принадлежащим одному процессу, требуются разные Аппусермоделидс для управления группированием панели задач, используйте [**шжетпропертисторефорвиндов**](/windows/win32/api/shellapi/nf-shellapi-shgetpropertystoreforwindow)) для получения хранилища свойств окна и установки AppUserModelID в качестве свойства окна.
    2.  Если все окна в процессе используют один и тот же AppUserModelID, настройте AppUserModelID для процесса, несмотря на [**сеткуррентпроцессексплиЦитаппусермоделид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-setcurrentprocessexplicitappusermodelid). Приложение должно вызвать **сеткуррентпроцессексплиЦитаппусермоделид** , чтобы установить его AppUserModelID во время первоначального запуска приложения, прежде чем приложение пойдет из пользовательского интерфейса, внесет любые манипуляции со своими списками переходов или вынуждает (или приводить к тому, что система делает систему) любой вызов [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs).

    AppUserModelID на уровне окна переопределяет AppUserModelID на уровне процесса.

    Когда приложение устанавливает явный AppUserModelID на уровне окна, приложение может предоставить сведения о команде повторного запуска для соответствующей кнопки панели задач. Для предоставления этих сведений используются следующие свойства.

    -   [System. Аппусермодел. Релаунчкомманд](../properties/props-system-appusermodel-relaunchcommand.md)
    -   [System. Аппусермодел. Релаунчдисплайнамересаурце](../properties/props-system-appusermodel-relaunchdisplaynameresource.md)
    -   [System. Аппусермодел. Релаунчиконресаурце](../properties/props-system-appusermodel-relaunchiconresource.md)

    > [!Note]  
    > Если для запуска приложения существует ярлык, приложение должно применить AppUserModelID в качестве свойства ярлыка вместо того, чтобы использовать свойства перезапуска. В этом случае Командная строка, значок и текст ярлыка используются для предоставления тех же сведений, что и свойства перезапуска.

     

    Явный AppUserModelID на уровне окна также может использовать свойство [System. аппусермодел. превентпиннинг](../properties/props-system-appusermodel-preventpinning.md) , чтобы указать, что оно не должно быть доступно для закрепления или перезапуска.

-   При вызове для настройки или обновления ([**икустомдестинатионлист**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-icustomdestinationlist)), получения ([**иаппликатиондокументлистс**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationdocumentlists)) или очистки ([**иаппликатиондестинатионс**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationdestinations)) списка переходов приложения.
-   В регистрации сопоставления файлов (с помощью [идентификатора ProgID](fa-progids.md)), если приложение использует автоматически созданные **последние** или **часто** используемые списки назначения. На эти сведения о сопоставлении ссылается [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs). Эти сведения также используются при добавлении [**интерфейса IShellItem**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellitem) назначений в пользовательские списки переходов через [**Икустомдестинатионлист:: аппендкатегори**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icustomdestinationlist-appendcategory).
-   При любом вызове приложение напрямую выполняет [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs). Если приложение зависит от общего диалогового окна файла, чтобы вызывать **шаддторецентдокс** от его имени, эти вызовы могут вывести явный AppUserModelID, только если AppUserModelID установлен для всего процесса. Если приложение устанавливает Аппусермоделидс в своих окнах, а не в процессе, приложение должно выполнить все вызовы **шаддторецентдокс** , с явным пределами, а также предотвратить создание в общем диалоговом окне своих собственных вызовов. Это необходимо сделать при каждом открытии элемента, чтобы гарантировать точность **последних** или **частых** разделов списка переходов приложения.

Ниже описаны распространенные сценарии и способы применения явных Аппусермоделидс в этих сценариях.

-   Если один процесс содержит несколько приложений, используйте [**шжетпропертисторефорвиндов**](/windows/win32/api/shellapi/nf-shellapi-shgetpropertystoreforwindow) для получения хранилища свойств окна и задайте AppUserModelID в качестве свойства окна.
-   Если приложение использует несколько процессов, примените AppUserModelID к каждому процессу. Использование одного и того же AppUserModelID для каждого процесса зависит от того, должен ли каждый процесс отображаться как часть основного приложения или как отдельные сущности.
-   Чтобы отделить определенные окна от набора в одном процессе, используйте хранилище свойств окна, чтобы применить один AppUserModelID к тем окнам, которые нужно разделить, а затем примените к процессу другой AppUserModelID. Любое окно этого процесса, которое не было явно помечено AppUserModelID на уровне окна, наследует AppUserModelID процесса.
-   Если тип файла связан с приложением, назначьте AppUserModelID в регистрации [ProgID](fa-progids.md) типа файла. Если один исполняемый файл запускается в разных режимах, которые отображаются для пользователя как отдельные приложения, для каждого режима требуется отдельный AppUserModelID. В этом случае необходимо иметь несколько регистраций ProgID для типа файлов, каждый из которых имеет другой AppUserModelID.
-   Если имеется несколько расположений ярлыков, из которых пользователь может запустить приложение (в меню **Пуск** , на рабочем столе или в другой части), получите хранилище свойств ярлыка, чтобы применить один AppUserModelID ко всем ярлыкам в качестве свойств ярлыков.
-   При явном вызове [**шаддторецентдокс**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shaddtorecentdocs) приложением используйте AppUserModelID в вызове. Если для открытия или сохранения файлов используется общее диалоговое окно файла, **шаддторецентдокс** вызывается диалоговым окном от имени приложения. Этот вызов может вывести явный AppUserModelID из процесса. Однако если явный AppUserModelID применяется как свойство окна, то обычное диалоговое окно файла не может определить правильный AppUserModelID. В этом случае само приложение должно явным образом вызвать **шаддторецентдокс** и предоставить ему правильный AppUserModelID. Кроме того, приложение должно препятствовать вызову общего файла диалога **шаддторецентдокс** от его имени, УСТАНОВИВ \_ флаг Фос донтаддторецент в методе **Options** [**ифилеопендиалог**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ifileopendialog) или [**ифилесаведиалог**](/windows/desktop/api/Shobjidl_core/nn-shobjidl_core-ifilesavedialog).

## <a name="registering-an-application-as-a-host-process"></a>Регистрация приложения в качестве хост-процесса

Приложение может установить запись реестра Ишостапп, чтобы процесс исполняемого файла считался ведущим процессом на панели задач. Это влияет на его группирование и записи списка переходов по умолчанию.

В следующем примере показана обязательная запись реестра. Обратите внимание, что записи не присваивается значение; его присутствие является обязательным. Это \_ значение reg со значением NULL.

```
HKEY_CLASSES_ROOT
   Applications
      example.exe
         IsHostApp
```

Если сам процесс или файл ярлыка, используемый для запуска процесса, имеют явный AppUserModelID, список ведущих процессов игнорируется, и приложение рассматривается как нормальное приложение на панели задач. Работающие окна приложения группируются в одну кнопку на панели задач, и приложение может быть закреплено на панели задач.

Если известен только имя исполняемого файла выполняемого процесса без явного AppUserModelID, и этот исполняемый файл находится в списке хост-процесса, то каждый экземпляр процесса рассматривается как отдельная сущность для группирования панели задач. Кнопка панели задач, связанная с любым конкретным экземпляром процесса, не отображает параметр закрепить/открепить или значок запуска для нового экземпляра процесса. Этот процесс также не может быть включен в список наиболее часто используемых программных приложений меню " **Пуск** ". Однако если процесс был запущен с помощью ярлыка, содержащего аргументы запуска (обычно целевое содержимое для размещения в качестве приложения), система может определить удостоверение, и приложение может быть закреплено и перезапущено.

## <a name="exclusion-lists-for-taskbar-pinning-and-recentfrequent-lists"></a>Списки исключений для закрепления панели задач и последних или часто встречающихся списков

Приложения, процессы и Windows могут сделать себя недоступными для закрепления на панели задач или для включения в список наиболее часто используемых программ в меню " **Пуск** ". Это можно сделать тремя способами:

1.  Добавьте запись OnStartPage в регистрацию приложения, как показано ниже:

    ```
    HKEY_CLASSES_ROOT
       Applications
          Example.exe
             NoStartPage
    ```

    Данные, связанные с записью "OnStartPage", игнорируются. Требуется только присутствие записи. Таким образом, идеальный тип для OnStartPage — REG \_ None.

    Обратите внимание, что любое использование явного AppUserModelID переопределяет запись OnStartPage. Если явный AppUserModelID применяется к ярлыку, процессу или окну, он становится также прикрепляемые и доступен для списка наиболее часто используемых в меню " **Пуск** ".

2.  Задайте свойство [System. аппусермодел. превентпиннинг](../properties/props-system-appusermodel-preventpinning.md) в окнах и сочетаниях клавиш. Это свойство должно быть установлено в окне перед свойством [ \_ \_ идентификатора PKEY аппусермодел](../properties/props-system-appusermodel-id.md) .
3.  Добавьте явный AppUserModelID в качестве значения в следующем подразделе реестра, как показано ниже.

    ```
    HKEY_LOCAL_MACHINE
       Software
          Microsoft
             Windows
                CurrentVersion
                   Explorer
                      FileAssociation
                         NoStartPageAppUserModelIDs
                            AppUserModelID1
                            AppUserModelID2
                            AppUserModelID3
    ```

    Каждая запись является значением REG \_ null с именем AppUserModelID. Любой AppUserModelID, найденный в этом списке, не также прикрепляемые и не может быть включен в список часто используемых меню " **Пуск** ".

Имейте в виду, что определенные исполняемые файлы, а также ярлыки, содержащие определенные строки в их именах, автоматически исключаются из закрепления и включения в список часто используемых программ.

> [!Note]  
> Это автоматическое исключение можно переопределить, применив явный AppUserModelID.

 

Если любая из следующих строк, независимо от регистра, включается в имя ярлыка, программа не также прикрепляемые и не отображается в списке наиболее часто используемых (неприменимо к Windows 10):

-   Документация
-   Справка
-   Установка
-   Подробнее
-   Чтение
-   Сначала прочитать
-   Readme
-   Удалить
-   Настройка
-   Поддержка
-   What's New

Следующий список программ не также прикрепляемые и исключен из списка наиболее часто используемых.

-   Applaunch.exe
-   Control.exe
-   Dfsvc.exe
-   Dllhost.exe
-   Guestmodemsg.exe
-   Hh.exe
-   Install.exe
-   Isuninst.exe
-   Lnkstub.exe
-   Mmc.exe
-   Mshta.exe
-   Msiexec.exe
-   Msoobe.exe
-   Rundll32.exe
-   Setup.exe
-   St5unst.exe
-   Unwise.exe
-   Unwise32.exe
-   Werfault.exe
-   Winhlp32.exe
-   Wlrmdr.exe
-   Wuapp.exe

Приведенные выше списки хранятся в следующих значениях реестра.

> [!Note]  
> Эти списки не должны изменяться приложениями. Используйте один из перечисленных выше методов списка исключений для того же интерфейса.

 

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            CurrentVersion
               Explorer
                  FileAssociation
                     AddRemoveApps
                     HostApps
```

## <a name="related-topics"></a>См. также

<dl> <dt>

[**сеткуррентпроцессексплиЦитаппусермоделид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-setcurrentprocessexplicitappusermodelid)
</dt> <dt>

[**жеткуррентпроцессексплиЦитаппусермоделид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-getcurrentprocessexplicitappusermodelid)
</dt> <dt>

[Расширения панели задач](taskbar-extensions.md)
</dt> <dt>

[**Икустомдестинатионлист:: Сетаппид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icustomdestinationlist-setappid)
</dt> <dt>

[**Иаппликатиондокументлистс:: Сетаппид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-iapplicationdocumentlists-setappid)
</dt> <dt>

[**Иаппликатиондестинатионс:: Сетаппид**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-iapplicationdestinations-setappid)
</dt> <dt>

[**шжетпропертисторефорвиндов**](/windows/win32/api/shellapi/nf-shellapi-shgetpropertystoreforwindow)
</dt> </dl>

 

 
