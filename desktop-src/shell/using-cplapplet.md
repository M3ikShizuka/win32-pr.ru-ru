---
description: До Windows Vista вы создали элемент панели управления, создав DLL-файл и наименую его с расширением. cpl.
ms.assetid: 258dae28-c054-4392-b0e9-99493f23c814
title: Использование Кплапплет
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b1e59b29dd7c082822ed63d425dd4967a542b5d1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985400"
---
# <a name="using-cplapplet"></a>Использование Кплапплет

До Windows Vista вы создали элемент панели управления, создав DLL-файл и наименую его с расширением. cpl. Этот файл экспортировал функцию [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) . Эта схема по-прежнему поддерживается в Windows Vista и более поздних версиях и рассматривается в этом разделе. Однако рекомендации для новых элементов панели управления рекомендуют более простой подход с помощью элемента панели управления, созданного как exe-файл, который использует макет потока задач.

Когда панель управления загружает файл DLL (или. cpl), она вызывает функцию [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) для получения таких сведений, как количество элементов панели управления, содержащихся в файлах, а также сведения о каждом элементе. Панель управления также вызывает функцию при инициализации, открытии или закрытии окна элемента.

Когда Windows впервые загружает элемент панели управления, он получает адрес функции [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) и затем использует этот адрес для вызова функции и передачи сообщений. Он может отправить следующие сообщения.



| Сообщение                                     | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**CPL \_ дблклк**](cpl-dblclk.md)           | Отправляется уведомление [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) о том, что пользователь выбрал значок, связанный с заданным элементом панели управления. **Кплапплет** должен отобразить диалоговое окно для указанного элемента и выполнить все определяемые пользователем задачи. Параметр  *lParam1* кплапплет — это целое число, представляющее отсчитываемый от нуля индекс элемента панели управления. Параметр *lParam2* — это указатель **лпдата** , возвращаемый в структуре [**Кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в сообщении [**CPL \_**](cpl-inquire.md) или [**CPL \_ невинкуире**](cpl-newinquire.md) . Возвращаемое значение игнорируется.                                                                |
| [**\_выход CPL**](cpl-exit.md)               | Посылается после последнего \_ сообщения об ошибке CPL и сразу перед тем, как Windows использует функцию [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) для высвобождения библиотеки DLL, содержащей элемент панели управления. [**Кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) должен освободить оставшийся объем памяти и подготовиться к закрытию. Возвращаемое значение игнорируется.                                                                                                                                                                                                                                                                                                                                                                                                |
| [**CPL — \_ Счетчик**](cpl-getcount.md)       | Отправляется после \_ сообщения CPL init для запроса [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на возврат числа, которое указывает, сколько поддерживаемых им подпрограмм.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [**\_Инициализация CPL**](cpl-init.md)               | Отправляется сразу после загрузки библиотеки DLL, содержащей элемент панели управления. В сообщении запрашиваются [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) для выполнения процедур инициализации, включая выделение памяти.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| [**\_запрос CPL**](cpl-inquire.md)         | Отправляется после сообщения CPL- \_ Count в запрос [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на предоставление сведений об указанной подпрограмме. Значение *lParam1* — это целое число, представляющее отсчитываемый от нуля индекс подпрограммы, сведения о которой запрашиваются. Параметр *lParam2* объекта **кплапплет** указывает на структуру [**кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) . Возвращаемое значение игнорируется.                                                                                                                                                                                                                                                                                                    |
| [**CPL \_ невинкуире**](cpl-newinquire.md)   | Отправляется после сообщения CPL- \_ Count в запрос [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) на предоставление сведений об указанном элементе панели управления. Значение *lParam1* — это целое число, представляющее отсчитываемый от нуля индекс подпрограммы, сведения о которой запрашиваются. Параметр *lParam2* является указателем на структуру [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) . CPL \_ невинкуире обычно следует игнорировать. Приложение должно обрабатывать только управляющие \_ запросы CPL в windows 95, Microsoft Windows NT 4,0 и более поздних системах, так как при \_ использовании CPL невинкуире используется отрицательная производительность панели управления. Это обусловлено тем, что возвращаемые строки и значки не могут быть кэшированы. Возвращаемое значение игнорируется. |
| [**CPL — \_ Выбор**](cpl-select.md)           | Является устаревшей. Текущие версии Windows не отправляют это сообщение.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [**CPL \_ стартвпармс**](cpl-startwparms.md) | Отправляется уведомление [**кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) о том, что пользователь выбрал значок, связанный с заданным диалоговым окном. **Кплапплет** должен отобразить соответствующее диалоговое окно и выполнить все определяемые пользователем задачи. Это сообщение похоже на CPL \_ дблклк, но может быть несколько дополнительных сведений. Параметр *lParam1* — это номер элемента панели управления, а *lParam2* — **LPCTSTR** любые дополнительные направления, которые могут потребоваться. Возвращает **значение true** , если сообщение обрабатывается; в противном случае — **значение false**. Это сообщение допустимо для Shell32.dll [версии 5,00](versions.md) и более поздних версий.                                                                                         |
| [**\_Отключить CPL**](cpl-stop.md)               | Отправляется один раз для каждого элемента панели управления в файле. cpl перед тем, как Windows выгружает расширение панели управления. [**Кплапплет**](/windows/win32/api/cpl/nc-cpl-applet_proc) должен освободить память, связанную с номером товара, указанным в *lParam1*. Параметр *lParam2* — это **лпдата** указатель, возвращаемый в структуре [**Кплинфо**](/windows/win32/api/cpl/ns-cpl-cplinfo) или [**невкплинфо**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) в [**сообщении \_ CPL**](cpl-inquire.md) или [**CPL \_ невинкуире**](cpl-newinquire.md) . Возвращаемое значение игнорируется.                                                                                                                                                                                                       |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Элементы панели управления](control-panel-applications.md)
</dt> <dt>

[Руководство по работе пользователей](user-experience-guidelines.md)
</dt> <dt>

[Регистрация элементов панели управления](registering-control-panel-items.md)
</dt> <dt>

[Обработка сообщений в панели управления](message-processing.md)
</dt> <dt>

[Исполнение элементов панели управления](executing-control-panel-items.md)
</dt> <dt>

[Расширение элементов панели управления "система"](extending-system-control-panel-items.md)
</dt> <dt>

[Назначение категорий панели управления](assigning-control-panel-categories.md)
</dt> <dt>

[Создание ссылок на задачи с возможностью поиска для элемента панели управления](creating-searchable-task-links.md)
</dt> <dt>

[Доступ к панели управления в защищенном режиме в Windows Vista](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
