---
description: Здесь показано, как зарегистрировать корневой поставщик синхронизации и интегрировать поставщик облачного хранилища в корневой уровень области навигации.
ms.assetid: BB177EDC-8C88-4540-B2F8-994C1C8BA91C
title: Интеграция поставщика облачного хранилища
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 21fdc5abfbf9881bfe23b00a924fce989aec7c95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104557780"
---
# <a name="integrate-a-cloud-storage-provider"></a>Интеграция поставщика облачного хранилища

Если у вас есть поставщик облачного хранилища, необходимо выполнить несколько действий, чтобы обеспечить единообразное и предпочтительное взаимодействие с пользователем. Эти две вещи регистрируются в качестве корневого поставщика синхронизации и интегрируют приложение в корневой уровень области навигации.

> [!IMPORTANT]
> Интеграция поставщика облачного хранилища поддерживается только начиная с Windows 10.

 

Первое, что нужно зарегистрировать как корневой поставщик синхронизации. Это позволяет оболочке Windows узнать о вашем приложении и о том, что приложение будет отвечать за синхронизацию файлов в корне синхронизации. Это также позволит другим приложениям определить, что вы синхронизируете эти файлы, чтобы они могли отвечать соответствующим образом. Другие приложения могут использовать [**StorageFile. Provider**](/uwp/api/Windows.Storage.StorageFile?view=winrt-19041) для получения [**DisplayName**](/uwp/api/Windows.Storage.StorageProvider?view=winrt-19041) и [**идентификатора**](/uwp/api/Windows.Storage.StorageProvider?view=winrt-19041) приложения.

Чтобы зарегистрироваться в качестве корневого поставщика синхронизации, необходимо создать несколько записей реестра. Перед предоставлением списка пар "ключ-значение" ниже приведены некоторые заполнители, которые следует заменить собственными данными приложения.

-   *\[ идентификатор \] поставщика хранилища*: имя поставщика облачного хранилища. Это имя должно быть одинаковым, независимо от версии приложения. Примером этого является OneDrive.
-   *\[ Идентификатор безопасности \] Windows*— уникальный идентификатор безопасности Windows, идентифицирующий пользователя. Если приложение поддерживает несколько установок для нескольких пользователей на одном компьютере, этот элемент является обязательным.
-   *\[ Идентификатор \] учетной записи*: идентификатор поставщика услуг для текущей учетной записи пользователя. Для некоторых поставщиков требуется возможность предоставления пользователю нескольких корней синхронизации. Одним из примеров является работа и личная учетная запись. *Идентификатор учетной записи* позволяет зарегистрировать несколько учетных записей для одного пользователя. Если поставщик поддерживает несколько корней синхронизации для каждого пользователя, этот элемент является обязательным.

Эти заполнители комбинируются вместе, образуя идентификатор корня синхронизации. Необходимо поместить **!** символ между заполнителями при создании идентификатора корня синхронизации. Ниже приведены пары "ключ-значение", которые необходимо создать.

-   **HKLM \\ Программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ Explorer \\ \\** с _\[ идентификатором \] поставщика хранилища_ синкрутманажер *_!_* _\[ Идентификатор безопасности \] Windows_*_!_* _\[ Идентификатор \] учетной записи_*_\\ дисплайнамересаурце_* : указывает на ресурс, в котором оболочка Windows или другие приложения могут получить понятное имя для корня синхронизации.
-   **HKLM \\ Программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ Explorer \\ \\** с _\[ идентификатором \] поставщика хранилища_ синкрутманажер *_!_* _\[ Идентификатор безопасности \] Windows_*_!_* _\[ Идентификатор \] учетной записи_*_\\ иконресаурце_* : указывает на ресурс, в котором оболочка Windows или другие приложения могут получить значок для корня синхронизации.
-   **HKLM \\ Программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ Explorer \\ \\** с _\[ идентификатором \] поставщика хранилища_ синкрутманажер *_!_* _\[ Идентификатор безопасности \] Windows_*_!_* _\[ Идентификатор \] учетной записи_*_\\ \\ усерсинкрутс_*_\[ Windows SID \]_ : расположение на диске, где находится корень синхронизации.

Кроме регистрации в качестве корневого поставщика синхронизации, пользователи также должны иметь простой доступ к предоставленным данным. Пространство имен проводника предназначено для предоставления метода для такого простого доступа. Создание расширения пространства имен для поставщика и его включение в окно проводника позволит пользователям взаимодействовать с корневым уровнем служб так же, как они используются с другими элементами проводника. В этом разделе объясняется, как расширить пространство имен проводника, чтобы поставщик отображался на корневом уровне в области навигации.

Область навигации окна проводника — это часть окна, отображаемая в левой части экрана. На изображении ниже можно увидеть структуру пространства имен для этого пользователя. Корневой уровень в области навигации включает объекты для **OneDrive**, **этого компьютера** и **сети**. После выполнения этих действий расширение будет добавлено на тот же уровень.

![Панель навигации](images/navigationpane.png)

Чтобы добавить расширение в область навигации, перед редактированием реестра необходимо выполнить следующие действия.

-   Папка файловой системы, содержащая данные, отображаемые для пользователя.

-   Имя облачной службы, которая будет отображаться в области навигации. Это также может быть имя экземпляра, если служба поддерживает несколько учетных записей.

-   Понятный значок для приложения.

-   Идентификатор CLSID для приложения. Один из способов создания идентификатора CLSID для приложения заключается в использовании Uuidgen.exe. Дополнительные сведения о CLSID см. в разделе [ключ CLSID](../com/clsid-key-hklm.md) .

Следующие шаги позволяют изменить реестр, чтобы получить необходимые сведения в пространстве имен проводника. Конкретные действия выполняются в три вещи.

-   Создайте ключи в реестре для идентификатора CLSID, который содержит значения имени и значка для расширения, а также другие сведения, определяющие его поведение.

-   Настройте расширение для интеграции в область навигации в правильном расположении и с соответствующей видимостью.

-   Настройте расширение так, чтобы оно имело ожидаемое поведение для элемента в области навигации.

В этих инструкциях специально используется команда **reg.exe** , однако вы можете использовать любое средство редактирования реестра по своему усмотрению. Вы даже можете интегрировать эти шаги в установщик, который программно обновляет реестр.

## <a name="instructions"></a>Инструкции

### <a name="step-1-add-your-clsid-and-name-your-extension"></a>Шаг 1. Добавление идентификатора CLSID и имени расширения

Добавьте имя расширения в реестр в разделе HKEY \_ текущий \_ пользователь. Вы также добавите уникальный идентификатор для этого расширения. Можно добавить несколько расширений на одного пользователя, но в этом случае для каждого модуля потребуется уникальное имя и идентификатор. Это имя и идентификатор должны быть согласованы на протяжении всех остальных шагов. В этом примере имя — *миклаудсторажеапп*.

> [!IMPORTANT]
> Указанный идентификатор (0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3) в этих шагах просто используется в качестве примера. Его необходимо изменить на уникальный идентификатор CLSID.

 

**REG Add HKCU \\ Software \\ Classes \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3}/ве/t REG \_ SZ/d "миклаудсторажеапп"/f**

### <a name="step-2-set-the-image-for-your-icon"></a>Шаг 2. Настройка изображения для значка

Укажите путь к значку, который должен отображаться в области навигации. В приведенном ниже примере *1043* ссылается на идентификатор ресурса для значка в указанной библиотеке DLL.

> [!IMPORTANT]
> Необходимо обновить путь к образу. Он должен указывать на универсальный путь, по которому приложение установило образ.

 

**REG Add HKCU \\ Software \\ Classes \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ дефаултикон/ве/t REG \_ expand \_ SZ/d%% SystemRoot%% \\ system32 \\imageres.dll,-1043/f**

### <a name="step-3-add-your-extension-to-the-navigation-pane-and-make-it-visible"></a>Шаг 3. Добавьте расширение в область навигации и сделайте его видимым

Если задать для этого параметра значение 0x1, это означает, что расширение должно быть закреплено. Это гарантирует, что по умолчанию он будет отображаться для пользователей. Конфигурация по умолчанию для пользователя заключается в том, что в области навигации будут отображаться только закрепленные элементы. Пользователь может изменить этот параметр, щелкнув правой кнопкой мыши в области навигации и выбрав пункт " **отобразить все папки**". Если вы не хотите закрепить расширение, это значение можно задать равным 0x0. Это не приведет к удалению расширения, но по умолчанию он не будет отображаться пользователю.

**REG Add HKCU \\ Software \\ Classes \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3}/v System. испиннедтонамеспацетри/t REG \_ DWORD/d 0x1/f**

### <a name="step-4-set-the-location-for-your-extension-in-the-navigation-pane"></a>Шаг 4. Задание расположения расширения в области навигации

Это крайне важно для того, чтобы убедиться в том, что область навигации обеспечивает единообразное взаимодействие с пользователем.

**REG Add HKCU \\ классы программного обеспечения \\ \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3}/V сортордериндекс/t REG \_ DWORD/d 0x42/f**

### <a name="step-5-provide-the-dll-that-hosts-your-extension"></a>Шаг 5. Укажите библиотеку DLL, в которой размещено расширение.

Используйте shell32.dll для эмуляции папок Windows по умолчанию. Измените это только в том случае, если у вас есть конкретная причина для этого и вы знакомы с расширениями пространства имен.

**REG Add HKCU \\ классы программного обеспечения \\ \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ InprocServer32/ве/t REG \_ expand \_ SZ/d%% systemroot%% \\ system32 \\shell32.dll/f**

### <a name="step-6-define-the-instance-object"></a>Шаг 6. определение объекта экземпляра

Укажите, что расширение пространства имен должно работать, как и другие структуры файловых папок в проводнике. Дополнительные сведения об объектах экземпляров оболочки см. [в разделе Создание расширений оболочки с помощью объектов экземпляра оболочки](/previous-versions/ms997573(v=msdn.10)).

**REG Add HKCU \\ классы программного обеспечения \\ \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ экземпляр/v CLSID/T REG \_ SZ/d {0E5AAE11-A475-4c5b-AB00-C66DE400274E}/f**

### <a name="step-7-provide-the-file-system-attributes-of-the-target-folder"></a>Шаг 7. Указание атрибутов файловой системы целевой папки

Это необходимо, чтобы обеспечить единообразное и ожидаемое взаимодействие пользователей с обозревателем. Эта команда устанавливает **атрибут \_ File \_ Attribute** и **\_ Attribute file \_ ReadOnly**, оба из которых являются [**константами атрибутов файла**](../fileio/file-attribute-constants.md).

**REG Add HKCU \\ классы программного обеспечения \\ \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ instance \\ инитпропертибаг/v Attributes/t REG \_ DWORD/d 0x11/f**

### <a name="step-8-set-the-path-for-the-sync-root"></a>Шаг 8. Задание пути для корня синхронизации

Задайте путь к корню синхронизации.

**REG Add HKCU \\ Software \\ Classes \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ экземпляр \\ инитпропертибаг/v TargetFolderPath/t REG \_ expand \_ SZ/d%% UserProfile%% \\ миклаудсторажеапп/f**

### <a name="step-9-set-appropriate-shell-flags"></a>Шаг 9. Установка соответствующих флагов оболочки

Установите некоторые флаги, необходимые для закрепления расширения пространства имен в дереве проводника.

**REG Add HKCU \\ Software \\ Classes \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ ShellFolder/v фолдервалуефлагс/t REG \_ DWORD/d 0x28/f**

### <a name="step-10-set-the-appropriate-flags-to-control-your-shell-behavior"></a>Шаг 10. Установка соответствующих флагов для управления поведением оболочки

Установите соответствующие флаги [**сфгао**](sfgao.md) . Соответствующие флаги: СФГАО \_ Канкопи, сфгао \_ КАНЛИНК, сфгао \_ Storage, СФГАО \_ хаспропшит, сфгао \_ СТОРАЖЕАНЦЕСТОР, сфгао \_ филесисанцестор, SFGAO \_ Папка, SFGAO \_ FILESYSTEM и SFGAO \_ HASSUBFOLDER.

**REG Add HKCU \\ классы программного обеспечения \\ \\ CLSID \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3} \\ SHELLFOLDER/V Attributes/t REG \_ DWORD/d 0xF080004D/f**

### <a name="step-11-register-your-extension-in-the-namespace-root"></a>Шаг 11. Регистрация расширения в корне пространства имен

Настройте расширение пространства имен как дочерний для папки рабочего стола.

**REG Add HKCU \\ Software \\ \\ \\ \\ \\ пространство имен рабочего стола Microsoft Windows CurrentVersion Explorer \\ \\ {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3}/ве/t REG \_ SZ/d миклаудсторажеапп/f**

### <a name="step-12-hide-your-extension-from-the-desktop"></a>Шаг 12. Скрытие расширения с рабочего стола

Важно, чтобы расширение было доступно только в области навигации проводника. Расширение пространства имен не работает как обычная клавиша. Поэтому не следует использовать этот метод для создания ярлыка на рабочем столе.

**REG Add HKCU \\ Software \\ Microsoft \\ Windows \\ CurrentVersion \\ Explorer \\ хидедесктопиконс \\ невстартпанел/v {0672A6D1-A6E0-40FE-AB16-F25BADC6D9E3}/t REG \_ DWORD/d 0x1/f**

 

 
