---
description: 'В этом разделе объясняется, как зарегистрировать программу в реестре Windows как один из следующих типов клиентов: браузер, электронная почта, воспроизведение мультимедиа, Обмен мгновенными сообщениями или виртуальная машина для Java.'
title: Регистрация программ с помощью клиентских типов
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 33fcb63c-3db2-44df-acfe-8c88e2e634e4
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: 71dd4e3192dc75821fd0a3e8c0d4742e1a8d571a
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "103914244"
---
# <a name="registering-programs-with-client-types"></a>Регистрация программ с помощью клиентских типов

В этом разделе объясняется, как зарегистрировать программу в реестре Windows как один из следующих типов клиентов: браузер, электронная почта, воспроизведение мультимедиа, Обмен мгновенными сообщениями или виртуальная машина для Java.

> [!Note]  
> Эти сведения относятся к следующим операционным системам:
> 
> -   Windows 2000 с пакетом обновления 3 (SP3)
> -   Windows 2000 с пакетом обновления 4 (SP4)
> -   Пакет обновления 1 (SP1) для Windows XP
> -   Пакет обновления 2 (SP2) для Windows XP
> -   Пакет обновления 3 (SP3) для Windows XP
> -   Windows Server 2003
> -   Windows Vista
> -   Пакет обновления 1 (SP1) для Windows Vista
> -   Windows 8

 

Этот раздел включает следующие подразделы:

-   [Общие элементы регистрации для всех типов клиентов](#common-registration-elements-for-all-client-types)
    -   [Выбор канонического имени](#selecting-a-canonical-name)
    -   [Регистрация отображаемого имени программы](#registering-a-programs-display-name)
    -   [Регистрация значка программы](#registering-a-programs-icon)
    -   [Регистрация команды Open](#registering-an-open-verb)
    -   [Регистрация сведений об установке](#registering-installation-information)
-   [Элементы регистрации для конкретных типов клиентов](#registration-elements-for-specific-client-types)
    -   [Регистрация в меню "Пуск"](#start-menu-registration)
    -   [Регистрация почтового клиента](#mail-client-registration)
-   [Полные примеры регистраций](#complete-sample-registrations)
    -   [Пример браузера](#a-sample-browser)
    -   [Пример почтового браузера](#a-sample-mail-browser)
    -   [Пример проигрывателя мультимедиа](#a-sample-media-player)
    -   [Пример программы мгновенных сообщений](#a-sample-instant-messenger-program)
    -   [Пример виртуальной машины для Java](#a-sample-virtual-machine-for-java)
-   [См. также](#related-topics)

Этот раздел расширяет существующую документацию о регистрации программы в качестве конкретного типа клиента. Ссылки на эту документацию см. в разделе "связанные разделы".

## <a name="common-registration-elements-for-all-client-types"></a>Общие элементы регистрации для всех типов клиентов

При регистрации программы в качестве типа клиента большая часть записей реестра одинакова независимо от типа клиента. Некоторые записи реестра, однако, относятся к типу клиента, и они указаны в разделе [элементы регистрации для конкретных типов клиентов](#registration-elements-for-specific-client-types) .

В этом разделе рассматриваются следующие темы:

-   [Выбор канонического имени](#selecting-a-canonical-name)
-   [Регистрация отображаемого имени программы](#registering-a-programs-display-name)
-   [Регистрация значка программы](#registering-a-programs-icon)
-   [Регистрация команды Open](#registering-an-open-verb)
-   [Регистрация сведений об установке](#registering-installation-information)

> [!Note]  
> Имена подразделов, заданные курсивом в этом разделе, являются заполнителями для имен пользовательских подразделов или набора возможных значений. Полные примеры с именами примеров на месте приведены в разделе [полный пример регистраций](#complete-sample-registrations) .

 

Все сведения о регистрации типа клиента хранятся в следующем подразделе:

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
```

*Клиенттипенаме* является одним из следующих имен подразделов:

-   Стартменуинтернет (для браузеров)
-   Почта (для электронной почты)
-   Носитель (для воспроизведения мультимедиа)
-   IM (для обмена мгновенными сообщениями)
-   Жававм (для виртуальной машины для Java)

В этой статье вы запишете ссылки на вымышленную компьютерную программу с именем "освещенное представление", Litware Inc., с исполняемым файлом с именем Litview.exe. Эта гипотетическая программа используется в качестве службы мгновенных сообщений, браузера или другого типа клиентской программы по мере необходимости для наглядных целей.

### <a name="selecting-a-canonical-name"></a>Выбор канонического имени

Поставщик должен выбрать *каноническое имя* для программы. Каноническое имя никогда не отображается для пользователя, поэтому его локализация не требуется. Его единственная задача — предоставить уникальную строку, которую можно использовать для распознавания программы. Обычно это то же самое, что и имя программы на английском языке, но это просто соглашение.

Для клиентских типов, отличных от браузеров, каноническое имя может быть любой строкой. Выберите уникальное имя, которое, скорее всего, не будет использоваться другим поставщиком.

Для клиентов браузера каноническое имя должно быть именем, включая расширение, связанного исполняемого файла. Например, "Litview.exe".

Ниже приведены некоторые примеры канонических имен.

-   Iexplore.exe (браузер)
-   Почта Windows (электронная почта)
-   Проигрыватель Windows Media (мультимедиа)
-   Windows Messenger (мгновенный обмен сообщениями)

Зарегистрируйте каноническое имя, создав подраздел, как показано здесь. Имя подраздела представляет собой каноническое имя. Все сведения, относящиеся к регистрации этой программы, будут находиться в этом подразделе.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
```

### <a name="registering-a-programs-display-name"></a>Регистрация отображаемого имени программы

Следующим шагом в регистрации является указание отображаемого имени программы. Он указывается как значение под каноническим ключом имени, как показано здесь. Обратите внимание, что *каноникалнаме* и *клиенттипенаме* не являются реальными именами ключей, а только заполнители для истинных имен, например, *представление освещенности*.

> [!Note]  
> Начиная с Windows 8, имя, используемое для регистрации в [параметре "задать доступ к программе" и "параметры по умолчанию" (SPAD)](cpl-setprogramaccess.md) и [программы по умолчанию](default-programs.md) , должно совпадать для того, чтобы изменения SPAD активировали регистрации программ по умолчанию.

 

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               LocalizedString = @FilePath,-StringID
```

Значение **локализедстринг** является \_ строкой reg SZ и состоит из знака "at" (@), полного пути к DLL-или EXE-файлу, запятой, знака "минус" и десятичного целого числа. Десятичное целое число — это идентификатор строкового ресурса, содержащийся в DLL-или exe-файле, значение которого будет отображаться для пользователя в качестве имени этого клиента. Обратите внимание, что путь к файлу не требует кавычек, даже если он содержит пробелы.

Регистрация строки отображаемого имени таким образом позволяет использовать одну и ту же регистрацию для нескольких языков. При установке каждого языка предоставляется отдельный файл ресурсов с отображаемым именем, хранящимся по тому же ИДЕНТИФИКАТОРу ресурса.

В следующем примере показана регистрация для вымышленной программы обмена мгновенными сообщениями. Так как это программа обмена мгновенными сообщениями, подраздел *каноникалнаме* (в данном случае — « *освещено»*) хранится в подразделе **IM** .

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         IM
            Lit View
               (Default) = Lit View
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
```

Обратите внимание на использование записи (по умолчанию) в качестве дополнительного объявления отображаемого имени клиента. Если **локализедстринг** отсутствует, вместо него используется значение (по умолчанию). Это работает со всеми типами клиентов (интернет-браузерами, обозревателями электронной почты, мгновенными сообщениями и проигрывателями мультимедиа). Чтобы обеспечить обратную совместимость с [макетом реестра клиента Internet Explorer](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa753633(v=vs.85)), программы электронной почты должны установить значение (по умолчанию) для подраздела *каноникалнаме* на отображаемое имя клиента в текущем установленном языке.

### <a name="registering-a-programs-icon"></a>Регистрация значка программы

> [!Note]  
> Этот раздел не относится к Windows 2000.

 

По умолчанию верхний раздел меню **Пуск** Windows XP и Windows Vista содержит значки " **Интернет** " и " **Электронная почта** ". Эти значки отсутствуют в Windows 7 и более поздних версиях. Для клиентов браузера и электронной почты, когда для типа клиента по умолчанию назначена программа, для этих записей меню « **Пуск** » отображается значок зарегистрированной программы.

Регистрация значка программы является обязательной для клиентов браузера и электронной почты. Регистрация значка для типа клиента "воспроизведение мультимедиа", "обмен мгновенными сообщениями" или "виртуальная машина для клиентов Java" не является обязательной, а зарегистрированные значки для этих типов клиентов в настоящее время не используются Windows и не отображаются в верхней части меню " **Пуск** " Windows XP или Windows Vista.

Чтобы зарегистрировать значок для клиентской программы, добавьте подраздел **дефаултикон** со значением по умолчанию, как показано здесь.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               DefaultIcon
                  (Default) = FilePath,IconIndex
```

Значение **FilePath** — это полный путь к файлу, содержащему значок. Этот путь не требует кавычек, даже если он содержит пробелы.

Значение **икониндекс** интерпретируется следующим образом:

-   Если **икониндекс** является положительным числом, то это число используется в качестве индекса массива значков, отходящихся от *нуля* , хранящихся в файле. Например, если **икониндекс** имеет значение 1, второй значок загружается из файла.
-   Если **икониндекс** является отрицательным числом, абсолютное значение **икониндекс** используется в качестве идентификатора ресурса (а не индекса) для значка. Например, если **икониндекс** имеет значение-3, в файле загружается значок, идентификатор ресурса которого равен 3.

В следующем примере показана регистрация гипотетических браузеров представлений освещенности. В качестве значения по умолчанию используется второй значок, хранящийся в файле Litview.exe.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         StartMenuInternet
            LITVIEW.EXE
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\Litview.exe,1
```

### <a name="registering-an-open-verb"></a>Регистрация команды Open

> [!Note]  
> Этот раздел не относится к Windows 2000. Следующий шаг необходим только для клиентов браузера и электронной почты.

 

Предположим, что пользователь выбрал вашу программу в качестве программы Интернета или электронной почты по умолчанию. Этот пользователь щелкает значок **Интернета** или **электронной почты** в меню **Пуск** Windows XP или Windows Vista, чтобы открыть программу. В этот момент выполняется Командная строка, зарегистрированная, как показано ниже.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               shell
                  open
                     command
                        (Default) = command line
```

Командная строка должна указывать полный абсолютный путь к файлу, за которым следуют дополнительные параметры командной строки. Если тип записи — \_ \_ SZ, то в пути можно использовать переменные среды. Используйте кавычки, чтобы гарантировать неправильное интерпретацию пробелов в командной строке. Командная строка должна выполнять программу с соответствующими значениями по умолчанию. Обычно браузеры по умолчанию используют домашнюю страницу пользователя. Обычно программы электронной почты открывают **папку "Входящие"** пользователя.

В следующем примере показана регистрация `open` команды для гипотетических браузеров представлений освещенности. В нем не указаны параметры командной строки.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         StartMenuInternet
            LITVIEW.EXE
               shell
                  open
                     command
                        (Default) = "C:\Program Files\LitwareInc\Litview.exe"
```

Обратите внимание, что в этом значении символы кавычек размещаются вокруг пути, так как они содержат пробелы. Пропуск этих кавычек может привести к неправильной интерпретации командной строки.

### <a name="registering-installation-information"></a>Регистрация сведений об установке

> [!Note]  
> Этот раздел не относится к Windows Server 2003.

 

-   [Команда переустановки](#the-reinstall-command)
-   [Команда «скрыть значки»](#the-hide-icons-command)
-   [Команда "отобразить значки"](#the-show-icons-command)
-   [Конфигурация программы группы](#group-program-configuration)
-   [Пример регистрации в браузере](#browser-registration-example)

Компонент, по которому пользователь выбирает программы по умолчанию для каждого компьютера, именуется и доступен, как показано в следующей таблице. (В Windows Vista появилась новая функция, **устанавливающая программы по умолчанию**, с помощью которых пользователь может устанавливать параметры по умолчанию для каждого пользователя.)



<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Операционная система</th>
<th>Заголовок</th>
<th>Расположение доступа</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Windows 7</td>
<td>Настройка доступа к программе и параметров по умолчанию для компьютера</td>
<td><ul>
<li>Меню " <strong>Пуск</strong> " <strong>программы по умолчанию</strong></li>
<li><strong>Программы по умолчанию</strong> Элемент панели управления</li>
</ul></td>
</tr>
<tr class="even">
<td>Windows Vista</td>
<td>Настройка доступа к программе и параметров по умолчанию для компьютера</td>
<td><ul>
<li>Меню " <strong>Пуск</strong> " <strong>программы по умолчанию</strong></li>
<li><strong>Программы по умолчанию</strong> Элемент панели управления</li>
</ul></td>
</tr>
<tr class="odd">
<td>Windows XP с пакетом обновления 2 (SP2)</td>
<td>Настройка доступа к программам и параметров по умолчанию</td>
<td><ul>
<li>Меню " <strong>Пуск</strong> "</li>
<li><strong>Установка и удаление программ</strong> Элемент панели управления</li>
</ul></td>
</tr>
<tr class="even">
<td>Windows XP с пакетом обновления 1 (SP1)</td>
<td>Настройка программ</td>
<td><ul>
<li><strong>Установка и удаление программ</strong> Элемент панели управления</li>
</ul></td>
</tr>
</tbody>
</table>



 

Для простоты в этом разделе используется название функции в Windows 7. Все версии этой функции часто называются SPAD.

> [!Note]  
> Если вы используете Windows 2000 или Windows XP, необходимо установить по меньшей мере Windows 2000 SP3 или Windows XP с пакетом обновления 1 (SP1), чтобы увидеть страницу « **Настройка доступа к программам и значений по умолчанию** ». В Windows Vista и более поздних версиях для доступа к странице **Настройка доступа к программам и параметров по умолчанию** требуются права администратора. По этой причине разработчикам рекомендуется зарегистрироваться для установки элемента панели управления [программы по умолчанию](default-programs.md) , чтобы любой пользователь мог управлять параметрами приложения по умолчанию.

 

В следующем дереве реестра показаны разнообразные сведения, которые должны быть зарегистрированы в ключе **инсталлинфо** программы, чтобы программа отображалась на странице **Настройка доступа к программам и параметров компьютера по умолчанию** в качестве параметра для своего типа клиента. Каждое из этих значений подробно описано в следующих разделах.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               InstallInfo
                  HideIconsCommand = command line
                  ReinstallCommand = command line
                  ShowIconsCommand = command line
                  IconsVisible = 1
```

Командная строка должна указывать полный абсолютный путь к файлу, за которым следуют дополнительные параметры командной строки. Используйте кавычки, чтобы гарантировать неправильное интерпретацию пробелов в командной строке.

### <a name="the-reinstall-command"></a>Команда переустановки

Командная строка REINSTALL, объявленная в значении Реинсталлкомманд, выполняется, когда пользователь использует страницу **Настройка доступа к программам и параметров по умолчанию** , чтобы выбрать программу в качестве типа клиента по умолчанию. В Windows Vista и более поздних версиях для доступа к этой странице требуется уровень привилегий администратора. В Windows 8, если приложение зарегистрировано с использованием того же имени, что и для **параметра задать доступ к программе и параметры по** умолчанию для компьютера и **программы по умолчанию**, то для текущего пользователя будут применены значения по умолчанию, указанные в списке **программы по умолчанию** для данного приложения, а также выполняется команда REINSTALL.

Программа, запускаемая с помощью командной строки переустановки, должна связать приложение с полным набором типов [файлов](fa-intro.md) и [протоколов](/previous-versions//aa767743(v=vs.85)) , которые может выполнять приложение. Все приложения должны устанавливать функции обработчика в команде REINSTALL. Приложения могут использовать команду REINSTALL для регистрации возможностей, а также при необходимости устанавливать состояние по умолчанию. Если приложение решило реализовать как возможности, так и состояние обработчика по умолчанию в команде REINSTALL, оно также должно возобновить все отображаемые ссылки или ярлыки. Видимые точки входа большинство приложений выбираются в списке в [команде скрыть значки](#the-hide-icons-command).

> [!Note]  
> Настоятельно рекомендуется, чтобы приложения реализовали возможности обработки в команде REINSTALL.

 

После завершения переустановки программа, запускаемая командной строкой переустановки, должна выйти из программы. Он не должен запускать соответствующую программу; Он должен просто регистрировать значения по умолчанию. Например, команда переустановки браузера не должна открывать домашнюю страницу пользователя.

> [!Note]  
> Для клиентов браузера и электронной почты в Windows XP и Windows Vista в верхней части меню "Пуск" для приложений, которые устанавливают возможность обработки и состояния по умолчанию, необходимо зарегистрироваться для получения соответствующего значка. Дополнительные сведения см. в разделе [Регистрация меню "Пуск](#start-menu-registration) ".

 

### <a name="the-hide-icons-command"></a>Команда «скрыть значки»

Командная строка, объявленная в значении Хидеиконскомманд, выполняется, когда пользователь очищает поле **Разрешить доступ к этой программе** на странице **Настройка доступа к программам и параметров компьютера по умолчанию** . Эта командная строка должна скрывать все точки доступа программы, которые видны в пользовательском интерфейсе. Конкретные рекомендации предназначены для удаления ярлыков и значков из следующих расположений:

-   Значки рабочего стола
-   Ссылки меню "Пуск", включая группу **автозагрузки**
-   Ссылки на панели быстрого запуска
-   Область "Уведомления"
-   Контекстные меню
-   Полоса задач для папки

Эта командная строка также должна препятствовать автоматическому вызову программы, например указанным в разделе **Run** реестра. Поставщикам рекомендуется реализовать эти рекомендации в обратном вызове функции скрытия доступа приложения.

При скрытии значков не требуется повторная регистрация (возможность приложения) типов файлов. Кроме того, не нужно освобождать состояние приложения по умолчанию для типов файлов и протоколов. Это может привести к неправильному взаимодействиям с пользователем при обнаружении этих типов в пользовательском интерфейсе.

После успешного скрытия значков необходимо изменить значение реестра Иконсвисибле на 0, как показано ниже.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               InstallInfo
                  IconsVisible = 0
```

Запись Иконсвисибле имеет тип **reg \_ DWORD**.

### <a name="an-alternate-hide-icons-method-in-spad"></a>Альтернативный метод скрытия значков в SPAD

Для некоторых устаревших приложений полная реализация скрытия доступа может оказаться непрактичной. Альтернативным методом, который достигает того же результата, является удаление приложения. В разделе ниже показан пример поведения и примеры кода для реализации этой альтернативы. В общем случае независимые поставщики программного обеспечения не должны использовать эту альтернативу, так как она будет:

-   Полностью удалите приложение из системы.
-   Удалить ранее выбранные значения по умолчанию.
-   Не устанавливайте параметр UI, чтобы переустановить приложение.
-   Сделать функцию "включить доступ" более недоступной, так как удаление полностью удаляет приложение из SPAD.

Рекомендуемый пользовательский интерфейс выглядит следующим образом:

-   Когда пользователь снимает флажок **включить доступ к этой программе** в SPAD, отображается следующий пользовательский интерфейс.

    ![диалоговое окно "Скрытие доступа к программе"](images/hideaccessvista.png)

-   Когда пользователь нажмет **кнопку ОК**, запускается элемент Панель управления **программы и компоненты** , позволяющий пользователю удалить приложение.
-   Пользователи Windows XP должны быть представлены в этом диалоговом окне.

    ![эквивалентное диалоговое окно Windows XP](images/hideaccessxp.png)

-   После нажатия **кнопки ОК** пользователем Windows XP запускается элемент панели управления **Установка и удаление программ** , позволяющий пользователю удалить приложение.

Следующий код предоставляет многократно используемую реализацию функции скрытия доступа, как описано выше. Его можно использовать в Windows XP, Windows Vista и Windows 7.


```
#include <windows.h>
#include <shlwapi.h>
#include <strsafe.h>

PCWSTR c_pszMessage1 = L"To hide access to this program, you need to uninstall it by ";
PCWSTR c_pszMessage2 = L"using\n%s in Control Panel.\n\nWould you like to start %s?";
PCWSTR c_pszApplicationName  = L"Sample App";

int _tmain(int argc, WCHAR* argv[])
{
    OSVERSIONINFO version;
    version.dwOSVersionInfoSize = sizeof(version);

    if (GetVersionEx(&version))
    {
        PCWSTR pszCPLName = NULL;

        if (version.dwMajorVersion >= 6)
        {
            // Windows Vista and later
            pszCPLName = L"Programs and Features";
        }
        else if (version.dwMajorVersion == 5 &&
                 version.dwMinorVersion == 1)
        {
            // Windows XP
            pszCPLName = L"Add/Remove Programs";
        }

        if (pszCPLName != NULL)
        {
            WCHAR szMessage[256], szScratch[256];
            if (SUCCEEDED(StringCchPrintf(szScratch, 
                                          ARRAYSIZE(szScratch), 
                                          c_pszMessage2, 
                                          pszCPLName, 
                                          pszCPLName)))
            {
                if (SUCCEEDED(StringCchCopy(szMessage, 
                                            ARRAYSIZE(szMessage), 
                                            c_pszMessage1)))
                {
                    if (SUCCEEDED(StringCchCat(szMessage, 
                                               ARRAYSIZE(szMessage), 
                                               szScratch)))
                    {
                        if (IDOK == MessageBox(NULL, 
                                               szMessage, 
                                               c_pszApplicationName, 
                                               MB_OKCANCEL))
                        {
                            ShellExecute(NULL, 
                                         NULL, 
                                         L"appwiz.cpl", 
                                         NULL, 
                                         NULL, 
                                         SW_SHOWNORMAL);
                        }
                    }
                }
            }
        }
    }
    return 0;
}
```



### <a name="the-show-icons-command"></a>Команда "отобразить значки"

Командная строка, объявленная в записи Шовиконскомманд, выполняется, когда пользователь устанавливает флажок **включить доступ к этой программе** на странице **Настройка доступа к программам и параметров компьютера по умолчанию** . Эта командная строка может восстановить точки доступа программы, включая те, что находятся в меню " **Пуск** ", на рабочем столе и в группе **автозагрузки** , а также в обычных автоматических вызовах, таких как указанные в разделе " **Запуск** реестра". Видимые точки доступа, представляющие интерес для большинства приложений, перечислены в [команде скрыть значки](#the-hide-icons-command). Приложение не должно изменять значения по умолчанию для каждого пользователя; Это изменение должно выполняться пользователем с помощью **программ по умолчанию**.

После успешного отображения значков необходимо изменить значение реестра Иконсвисибле на 1, как показано ниже.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               InstallInfo
                  IconsVisible = 1
```

Обратите внимание, что если вы использовали запись Хидеиконскомманд для запроса удаления приложения, запись Шовиконскомманд не используется. Он должен быть удален из реестра с остальными сведениями о приложении в процессе удаления.

### <a name="group-program-configuration"></a>Конфигурация программы группы

> [!Note]  
> Этот раздел не относится к Windows 2000.

 

В процессе подготовки системы изготовитель оборудования может установить конфигурацию, которая скрывает точки доступа для браузера, электронной почты, воспроизведения мультимедиа, обмена мгновенными сообщениями или виртуальной машины для клиентских программ Java и задает собственные программы по умолчанию. Изготовители оборудования могут разрешить пользователям сбрасывать свои компьютеры в любое время до этой конфигурации по умолчанию, задав следующие значения реестра.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            CanonicalName
               InstallInfo
                  OEMShowIcons = 1
                  OEMDefault = 1
```

Если эти ключи установлены, пользователи могут восстановить конфигурацию изготовителя оборудования, выбрав параметр **Изготовитель компьютера** на странице **Настройка доступа к программам и параметров компьютера по умолчанию** . Если эти ключи не заданы, параметр **Изготовитель компьютера** не отображается.

Запись **оемшовиконс** , если она есть, устанавливает значок отображения состояния для указанного клиента, который применяется, если пользователь выбирает **изготовителя компьютера**. Значение 1 приводит к отображению значков, а значение 0 приводит к тому, что значки не отображаются. Если **оемшовиконс** отсутствует, выбор параметра " **Изготовитель компьютера** " не влияет на значок "отобразить параметр". **Оемшовиконс** имеет тип **reg \_ DWORD**.

Запись **оемдефаулт** , если она имеется и имеет значение 1, устанавливает OEM-предпочтение для клиента по умолчанию указанного типа. Только один клиент определенного типа может быть помечен как OEM по умолчанию. Если более чем одна регистрация клиента содержит запись **оемдефаулт** , то все они игнорируются, а текущий клиент по умолчанию будет использоваться в качестве клиента. Если запись **оемдефаулт** отсутствует или имеет значение 0, то этот конкретный клиент не используется в качестве клиента по умолчанию, если пользователь выбрал **изготовителя компьютера**. **Оемдефаулт** имеет тип **reg \_ DWORD**.

Помимо возможности сброса компьютеров к конфигурации по умолчанию, установленной поставщиком вычислительной техники, пользователи имеют три других варианта настройки:

-   Задайте для компьютера конфигурацию Microsoft Windows. В этом случае страница « **Настройка доступа к программам и параметров по умолчанию** » обеспечивает доступ ко всем программам Майкрософт и сторонних разработчиков на компьютере, зарегистрированном в соответствующих категориях продуктов. Для каждой категории выбран параметр программы Microsoft Windows по умолчанию.
-   Задайте для компьютера конфигурацию, не связанную с Майкрософт. Эта конфигурация скрывает точки доступа (например, меню " **Пуск** ") к Windows Internet Explorer, проигрывателю Windows Media, Windows Messenger и Microsoft Outlook Express. Он обеспечивает доступ к программному обеспечению, не являющемуся Майкрософт, на компьютере в этих категориях. Кроме того, если в категории имеется программа, не относящаяся к корпорации Майкрософт, она задается в качестве по умолчанию для этой категории. Если в категории доступно более одной программы, отличной от Майкрософт, пользователю предлагается выбрать, какую программу не следует использовать по умолчанию.
-   Установите пользовательскую конфигурацию. Пользователи могут выбирать собственные параметры для включения или удаления доступа, совместного применения программ Майкрософт и сторонних разработчиков по мере их появлении. Пользователи устанавливают параметры по умолчанию для отдельных категорий.

В любое время пользователи могут изменять любые из этих параметров.

### <a name="browser-registration-example"></a>Пример регистрации в браузере

В следующем примере показана полная регистрация **инсталлинфо** для вымышленного обозревателя представления освещенности. В этом случае параметры командной строки позволяют файлу Litview.exe выполнять любые действия, необходимые для каждого значения.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         StartMenuInternet
            LITVIEW.EXE
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\Litview.exe" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\Litview.exe" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\Litview.exe" /showicons
                  IconsVisible = 1
```

Обратите внимание, что кавычки размещаются вокруг путей, так как они содержат внедренные пробелы.

## <a name="registration-elements-for-specific-client-types"></a>Элементы регистрации для конкретных типов клиентов

Следующие сведения также можно найти в ресурсах, перечисленных в разделе связанные разделы в конце этого раздела.

-   [Регистрация в меню "Пуск"](#start-menu-registration)
-   [Регистрация почтового клиента](#mail-client-registration)

### <a name="start-menu-registration"></a>Регистрация в меню "Пуск"

В Windows XP приложения, как правило, зарегистрированы по умолчанию на уровне компьютера (на **\_ локальном \_ компьютере**), а не в области пользователя (**hKey \_ текущий \_ пользователь**). С появлением контроля учетных записей (UAC) в Windows Vista приложения, которые заявляют **Интернет** и слоты **электронной почты** в меню " **Пуск** ", должны реализовать команду переустановки в правильном контексте выполнения.

> [!Note]  
> Ссылка на **электронную почту** меню "Пуск" была удалена в Windows 7. Однако регистрация, обсуждаемая в этом разделе, по-прежнему должна быть выполнена, так как назначает клиент MAPI по умолчанию.

 

Ограниченный пользователь в Windows XP, Windows Vista или Windows 7 не может получить доступ к SPAD. По этой причине разработчикам рекомендуется зарегистрироваться для установки элемента панели управления " **программы по умолчанию** ", чтобы любой пользователь мог управлять параметрами по умолчанию приложения для каждого пользователя.

Выбор, сделанный в SPAD, должен влиять только на параметры компьютера.

Задайте значение реестра следующим образом.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         ClientTypeName
            (Default) = CanonicalName
```

> [!Note]
> 
> **Приведенные ниже сведения относятся только к Windows XP.**
> 
> Если регистрация по умолчанию на уровне компьютера в разделе HKEY " \_ локальный \_ компьютер" прошла успешно, приложение должно удалить значение, присвоенное записи по умолчанию в следующем подразделе:
> 
> ```
> HKEY_CURRENT_USER
>    SOFTWARE
>       Clients
>          ClientTypeName
> ```
> 
> Если при регистрации по умолчанию на уровне компьютера в разделе HKEY \_ локальный \_ компьютер происходит сбой, как правило, потому, что пользователь не имеет разрешения на запись в подразделе, приложение должно установить следующее значение:
> 
> ```
> HKEY_CURRENT_USER
>    SOFTWARE
>       Clients
>          ClientTypeName
>             (Default) = CanonicalName
> ```
> 
> Он регистрирует каноническое имя только для текущего пользователя, а не для всех пользователей.

 

После обновления разделов реестра программа должна выполнить широковещательную рассылку сообщения [**WM \_ сеттингчанже**](../winmsg/wm-settingchange.md) с параметром **wParam** = 0 и **lParam** , указывающим на строку "Software Clients клиенттипенаме, заканчивающуюся нулем" \\ \\ , чтобы уведомить операционную систему об изменении клиента по умолчанию.

### <a name="mail-client-registration"></a>Регистрация почтового клиента

Для почтового клиента программе необходимо зарегистрировать параметры в **\_ \_ корневом разделе "классы hKey**", \\  чтобы использовать URL-адреса, использующие `mailto` протокол. Задайте значения и ключи, отражающие эти параметры в следующем разделе.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         Mail
            CanonicalName
               Protocols
                  mailto
```

Эта иерархия реестра заменяет существующую `mailto` иерархию реестра, найденную в разделе **\_ классы hKey \_ root** \\ **mailto**. Иерархия остается неизменной, изменилось только расположение. Формат этой иерархии описан на сайте MSDN в разделе [Обзор асинхронных подключаемых протоколов и учебников](/previous-versions//aa767913(v=vs.85)). Обычно `mailto` протокол регистрируется в программе, а не в асинхронном протоколе. в этом случае применяется документация по [регистрации приложения в схеме универсального кода ресурса (URI)](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa767914(v=vs.85)) .

В следующем примере показан `mailto` раздел регистрации `mailto` обработчика, зарегистрированного в программе.

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         Mail
            CanonicalName
               Protocols
                  mailto
                     (Default) = URL:MailTo Protocol
                     EditFlags = 02 00 00 00
                     URL Protocol
                     DefaultIcon
                        (Default) = %FilePath%,IconIndex
                     shell
                        open
                           command
                              (Default) = command line
```

Значение реестра Едитфлагс описано в разделе « [типы файлов](fa-file-types.md) » раздела «Определение атрибутов типа файла».

## <a name="complete-sample-registrations"></a>Полные примеры регистраций

Ниже приведены примеры, в которых показаны полные требования к регистрации для различных типов клиентов.

-   [Пример браузера](#a-sample-browser)
-   [Пример почтового браузера](#a-sample-mail-browser)
-   [Пример проигрывателя мультимедиа](#a-sample-media-player)
-   [Пример программы мгновенных сообщений](#a-sample-instant-messenger-program)
-   [Пример виртуальной машины для Java](#a-sample-virtual-machine-for-java)

### <a name="a-sample-browser"></a>Пример браузера

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         StartMenuInternet
            LITVIEW.EXE
               (Default) = Lit View
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /showicons
                  IconsVisible = 1
                  shell
                     open
                        command
                           (Default) = "C:\Program Files\LitwareInc\LITVIEW.EXE" /homepage
```

### <a name="a-sample-mail-browser"></a>Пример почтового браузера

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         Mail
            Lit View
               (Default) = Lit View
               DLLPath = @C:\Program Files\LItwareInc\LitwareMAPI.dll
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /showicons
                  IconsVisible = 1
               shell
                  open
                     command
                        (Default) = "C:\Program Files\LitwareInc\LITVIEW.EXE" /inbox
               protocols
                  mailto
                     (Default) = URL:MailTo Protocol
                     EditFlags = 02 00 00 00
                     URL Protocol
                     DefaultIcon
                        (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
                     shell
                        open
                           command
                              (Default) = "C:\Program Files\LitwareInc\LITVIEW.EXE" /mailto:%1
```

### <a name="a-sample-media-player"></a>Пример проигрывателя мультимедиа

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         Media
            Lit View
               (Default) = Lit View
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /showicons
                  IconsVisible = 1
```

### <a name="a-sample-instant-messenger-program"></a>Пример программы мгновенных сообщений

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         IM
            Lit View
               (Default) = Lit View
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /showicons
                  IconsVisible = 1
```

### <a name="a-sample-virtual-machine-for-java"></a>Пример виртуальной машины для Java

```
HKEY_LOCAL_MACHINE
   Software
      Clients
         JavaVM
            Lit View
               (Default) = Lit View
               LocalizedString = @C:\Program Files\LitwareInc\ResourceDLL.dll,-123
               DefaultIcon
                  (Default) = C:\Program Files\LitwareInc\LITVIEW.EXE,1
               InstallInfo
                  ReinstallCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /reinstall
                  HideIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /hideicons
                  ShowIconsCommand = "C:\Program Files\LitwareInc\LITVIEW.EXE" /showicons
                  IconsVisible = 1
```

*Примеры компаний, организаций, продуктов, доменных имен, адресов электронной почты, эмблем, людей, мест и событий являются вымышленными. Нет связи с реальными компаниями, организациями, продуктами, именами доменов, адресами электронной почты, логотипами, лицами, местами и событиями.*

## <a name="related-topics"></a>См. также

<dl> <dt>

[Программы по умолчанию](default-programs.md)
</dt> <dt>

[Как зарегистрировать Интернет браузер или почтовый клиент в меню "Пуск" Windows](start-menu-reg.md)
</dt> <dt>

[Макет реестра клиента Internet Explorer (см. раздел "определения разделов реестра клиента")](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa753633(v=vs.85))
</dt> <dt>

[Обзор асинхронного подключаемого протокола и учебники](/previous-versions//aa767913(v=vs.85))
</dt> <dt>

[Регистрация приложения в схеме URI](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/aa767914(v=vs.85))
</dt> </dl>

 

 
