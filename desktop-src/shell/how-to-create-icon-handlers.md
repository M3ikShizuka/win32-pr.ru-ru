---
description: Описывает создание обработчика для настраиваемых назначений значков.
ms.assetid: 23ed3a21-cf62-4440-b983-fae23aa56890
title: Создание обработчиков значков
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c620b6f6a4c05f8996a26c8365e4f4201ee0b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104985460"
---
# <a name="how-to-create-icon-handlers"></a>Создание обработчиков значков

С [типом файла](fa-file-types.md) часто связан пользовательский значок, позволяющий легко распознать его члены в проводнике Windows. Самый простой способ назначить пользовательский значок для типа файла — зарегистрировать файл значка. Однако значок, зарегистрированный таким образом, будет одинаковым для всех элементов типа файла. При назначении значков членам типа файлов можно обеспечить гораздо большую гибкость, реализуя *обработчик значков*.

Обработчик значков — это тип обработчика расширений оболочки, который позволяет динамически назначать значки элементам типа файлов. Каждый раз, когда отображается файл типа, оболочка запрашивает у обработчика соответствующий значок. Например, обработчик значков может назначать разные значки для разных элементов типа файлов или изменять значок в зависимости от текущего состояния файла.

Общие процедуры для реализации и регистрации обработчика расширений оболочки обсуждаются в разделе [Создание обработчиков расширений оболочки](handlers.md). В этом документе рассматриваются такие аспекты реализации, которые относятся к обработчикам значков.

-   [Реализация обработчиков значков](#step-1-implementing-icon-handlers)
-   [Реализация интерфейса Иекстрактикон](#step-2-implementing-the-iextracticon-interface)
-   [Регистрация обработчиков значков](#step-3-registering-icon-handlers)
-   [См. также](#related-topics)

## <a name="instructions"></a>Инструкции

### <a name="step-1-implementing-icon-handlers"></a>Шаг 1. Реализация обработчиков значков

Как и все обработчики расширений оболочки, Обработчики значков — это объекты модели COM, реализованные в виде библиотек DLL. Помимо [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) и [**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona), они должны экспортировать два интерфейса.

Оболочка инициализирует обработчик с помощью своего интерфейса [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) . Он использует этот интерфейс для запроса идентификатора класса (CLSID) обработчика и предоставляет ему имя файла. Остальная часть операции выполняется через интерфейс [**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) . Общее описание способов реализации обработчиков расширений оболочки, включая интерфейс **IPersistFile** , см. в разделе [Создание обработчиков расширений оболочки](handlers.md). В оставшейся части этого документа описывается, как реализовать интерфейс **иекстрактикон** .

### <a name="step-2-implementing-the-iextracticon-interface"></a>Шаг 2. Реализация интерфейса Иекстрактикон

После инициализации интерфейса оболочка использует интерфейс [**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) обработчика для запроса соответствующего значка. Интерфейс имеет два метода: [**иекстрактикон:: жетиконлокатион**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) и [**Иекстрактикон:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).

Значки определяются по их расположению в файловой системе. Для запроса этой информации вызывается метод [**иекстрактикон:: жетиконлокатион**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) . Присвойте параметру *сзиконфиле* имя файла. Если в файле несколько значков, установите *пииндекс* в качестве индекса значка. Присвойте подходящие значения двум переменным флагов. Если вы не хотите указывать имя файла или не хотите, чтобы оболочка извлека этот значок, установите флаг **Джил \_ нотфиленаме** в параметре *пвфлагс* . Вам не нужно присваивать значение *сзиконфиле*, но обработчик должен предоставить дескрипторы значков, когда оболочка вызовет [**Иекстрактикон:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).

Если вы возвращаете имя файла, оболочка обычно пытается загрузить значок из своего кэша. Чтобы предотвратить загрузку кэшированного значка, установите флаг **Джил \_ донткаче** в параметре *пвфлагс* . Если кэшированный значок не загружен, оболочка вызывает [**иекстрактикон:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) для запроса маркера значка.

Если файл и индекс были указаны с помощью [**иекстрактикон:: жетиконлокатион**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), они передаются в [**Иекстрактикон:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) в параметрах *псзфиле* и *никониндекс* соответственно. Если указано имя файла, обработчик может вернуть \_ значение false, чтобы оболочка извлека этот значок. В противном случае обработчик должен извлекать или иным образом создавать крупные и мелкие значки и назначать их дескрипторы ХИКОН параметрам *фиконларже* и *фиконсмалл* . Оболочка добавляет значки в свой кэш для ускорения последующих вызовов обработчика.

### <a name="step-3-registering-icon-handlers"></a>Шаг 3. Регистрация обработчиков значков

При [статической регистрации значка](icon.md) для [типа файла](fa-file-types.md)создается подраздел **дефаултикон** с идентификатором ProgID для типа файла. Его значение по умолчанию — файл, содержащий значок. Чтобы зарегистрировать обработчик значков, необходимо по-прежнему иметь подраздел **дефаултикон** , но его значение по умолчанию должно быть равно "%1". Добавьте подраздел **иконхандлер** в подраздел **шеллекс** подраздела ProgID и присвойте его значению по умолчанию СТРОКОВОМУ формату GUID CLSID обработчика. Общие сведения о регистрации обработчиков расширений оболочки см. в статье [Создание обработчиков расширений](handlers.md)оболочки.

В следующем примере запись реестра изменяется в соответствии с [настройками значков](icon.md) , поэтому тип файла. МИП теперь использует обработчик контекстного меню вместо статически определенного значка.

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = %1
      Shellex
         IconHandler
            (Default) = {The handler's CLSID GUID}
```

## <a name="related-topics"></a>См. также

<dl> <dt>

[Создание обработчиков расширений оболочки](handlers.md)
</dt> <dt>

[**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[**иекстрактикон**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona)
</dt> </dl>

 

 
