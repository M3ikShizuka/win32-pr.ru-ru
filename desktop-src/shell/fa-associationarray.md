---
description: Массив ассоциаций — это упорядоченный список расположений в реестре, который используется для хранения сведений о типе элемента, включая обработчики, глаголы и другие атрибуты, такие как значок и отображаемое имя типа.
title: Массивы ассоциаций
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 9ECD19CA-833E-4565-A0EF-FB16BF7B3F44
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: 75d42a8758e5c6380414c7b93979b4f93cafd013
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104144608"
---
# <a name="association-arrays"></a>Массивы ассоциаций

Массив ассоциаций — это упорядоченный список расположений в реестре, который используется для хранения сведений о типе элемента, включая обработчики, глаголы и другие атрибуты, такие как значок и отображаемое имя типа. Оболочка использует массивы ассоциаций для запроса предопределенного набора расположений реестра, которые могут содержать сведения об элементе оболочки.

Этот раздел организован следующим образом:

-   [Сведения о массивах ассоциаций](#about-association-arrays)
-   [Запрос массивов ассоциаций](#querying-association-arrays)
-   [Работа с массивами ассоциаций для конкретного источника данных оболочки](#working-with-association-arrays-for-a-particular-shell-data-source)
    -   [Массивы ассоциаций источников данных оболочки](#shell-data-source-association-arrays)
-   [Дополнительные ресурсы](#additional-resources)
-   [См. также](#related-topics)

## <a name="about-association-arrays"></a>Сведения о массивах ассоциаций

Массив ассоциаций — это упорядоченный список расположений реестра, содержащих сведения о типе элемента, включая обработчики, команды и другие атрибуты, такие как значок и отображаемое имя типа. Эти сведения о типе элемента могут быть зарегистрированы на различных уровнях квалификации. Например, можно зарегистрировать команду, которая будет отображаться только для определенного типа файлов (например, JPG) или для всех элементов с одинаковой системой. Kind (например, System. Kind = Picture) или для всех элементов.

Оболочка использует массивы ассоциаций для запроса предопределенного набора расположений реестра, которые потенциально могут содержать сведения об элементе. Интерфейсы API массива взаимосвязей можно использовать для извлечения из подраздела реестра одного значения, которое содержит запрашиваемую информацию, с этим значением, которое поступает из первой записи в массиве, который его предоставляет. Например, значение значка по умолчанию извлекается таким образом. Массив ассоциаций можно также использовать для получения набора значений, которые хранятся в подразделах реестра. Например, список команд строится на основе этих команд, зарегистрированных во всех подразделах.

После того как оболочка запрашивает для сведений об элементе оболочки предопределенный набор расположений реестра, он помещает их в массив в порядке от наиболее конкретного расположения к наиболее общему.

Поскольку массивы ассоциаций являются упорядоченными списками, они предоставляют разработчикам приложений механизм для добавления в реестр сведений, которые будут возвращаться для определенного типа элемента. Аналогичным образом, массивы ассоциаций позволяют разработчикам приложений добавлять сведения в реестр для определенной группы элементов, когда эти элементы регистрируются в более общем расположении. Эта логика информирует ваше решение о наиболее подходящем расположении в реестре для хранения сведений об элементах оболочки.

В системе Windows по умолчанию JPG-файл имеет следующий массив ассоциаций:

-   **HKey \_ \_Корневые** \\ **жпгфиле** классов
-   **HKey \_ \_Корневые классы** \\ **системфилеассоЦиатионс** \\ **. jpg**
-   **HKey \_ \_Корневой** \\ **образ** классов
-   **HKey \_ \_корневой класс классов** \\ * *\** _
-   _ *\_ Классы hKey \_ root **\\** аллфилесистемобжектс**

Сведения о регистрации массивов ассоциаций см. в разделе [Регистрация приложения](app-registration.md).

## <a name="querying-association-arrays"></a>Запрос массивов ассоциаций

Существуют API-интерфейсы оболочки для получения сведений из диапазона подразделов реестра, от самого конкретного подраздела реестра до надмножество данных во всех подразделах реестра.

Чаще всего массив ассоциаций используется для запроса одного значения, которое оболочка возвращает из наиболее конкретного элемента в массиве, имеющего запрашиваемую информацию. В следующем примере кода показано, как это сделать.


```
IQueryAssociations *pqa;

// pShellItem is assumed to be an existing IShellItem object.
hr = pShellItem->BindToHandler(NULL, BHID_AssociationArray, IID_PPV_ARGS(&pqa));
if (SUCCEEDED(hr))
{
    wchar_t szValue[256];
    DWORD cbValue = sizeof(szValue);      // Count of bytes in the array

    hr = pqa->GetData(0, ASSOCDATA_VALUE, L"InfoTip", szValue, &cbValue);
    if (SUCCEEDED(hr))
    {
        // The "InfoTip" value is used to compute the infotip string from
        // properties of an item.
    }
    pqa->Release();
}
```



Следующие API можно использовать для запроса массива ассоциаций или для создания объекта [**икуеряссоЦиатионс**](/windows/win32/api/shlwapi/nn-shlwapi-iqueryassociations) Array, к которому можно выполнить запрос:

-   [**Ассоккреате**](/windows/desktop/api/Shlwapi/nf-shlwapi-assoccreate) (до Windows Vista)
-   [**ассоккреатефорклассес**](/windows/desktop/api/Shellapi/nf-shellapi-assoccreateforclasses)
-   [**ассоккуеристринг**](/windows/desktop/api/Shlwapi/nf-shlwapi-assocquerystringa)

## <a name="working-with-association-arrays-for-a-particular-shell-data-source"></a>Работа с массивами ассоциаций для конкретного источника данных оболочки

Каждый источник данных оболочки определяет массив ассоциаций для своих элементов. Определение массива ассоциаций обычно является функцией типа Item. Разработчики источников данных оболочки должны определять и документировать массивы взаимосвязей, чтобы позволить приложениям расширять поведение этих типов, например для регистрации команд или другой информации. Приложения могут расширять поведение элементов на основе добавления данных в подразделы массива взаимосвязей, например добавление глаголов для элементов.

Источник данных файловой системы создает массив ассоциаций для файлов на основе следующих подразделов реестра и специальных идентификаторов ProgID:

-   Если файл имеет зарегистрированный ProgID, используется **\_ \_ корневой** \\ *идентификатор ProgID* для классов hKey. В противном случае используется **\_ \_ корень классов hKey** \\ **Unknown** .
-   Расширение имени файла регистрируется в подразделе " **\_ классы hKey \_ root** \\ **системфилеассоЦиатионс** \\ *. fileExtension* ".
-   В следующей таблице показаны специальные идентификаторы ProgID. 

    | Специальный идентификатор progID                                    | Описание                   |
    |---------------------------------------------------|-------------------------------|
    | **HKey \_ \_корневой класс классов** \\ * *\** _                   | Все файлы (не папки)       |
    | _ *\_ Классы hKey \_ root **\\** аллфилесистемобжектс** | Файлы и папки файловой системы |
    | **HKey \_ \_Корневой** \\ **Каталог** классов            | Папки файловой системы           |
    | **HKey \_ \_Корневая** \\ **Папка** классов               | Контейнеры оболочки              |

    

     

### <a name="shell-data-source-association-arrays"></a>Массивы ассоциаций источников данных оболочки

В следующем списке представлены некоторые массивы ассоциаций хранилища данных оболочки, которые можно использовать в целях, описанных в этом разделе.

-   **HKey \_ \_корневой класс классов** \\ * *\** _
-   _ *\_ Классы hKey \_ root **\\** аллфилесистемобжектс**
-   **HKey \_ \_Корневые классы** \\ **Kind.Docумент**
-   **HKey \_ \_Корневые** \\ **результаты** классов
-   **HKey \_ \_Корневые классы** \\ **системфилеассоЦиатионс** \\ **. docx**
-   **HKey \_ \_Корневые классы** \\ **Word.Docумент. 12**

Массивы ассоциаций источников данных оболочки, которые можно использовать для Дбфолдер (хранилище данных оболочки, представляющее элементы в результатах поиска и представлениях, основанных на запросах), приведены ниже.

-   Диски
-   Сеть
-   регитемс
-   Примеры:
    -   ContentView
    -   Команды

Другие распространенные массивы взаимосвязей включают папки и принтеры.

## <a name="additional-resources"></a>Дополнительные ресурсы

-   Сведения о создании хранилища данных оболочки см. в разделе [реализация базовых интерфейсов объекта папки](nse-implement.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Регистрация приложения](app-registration.md)
</dt> <dt>

[Типы файлов](fa-file-types.md)
</dt> <dt>

[Как работают сопоставления файлов](fa-how-work.md)
</dt> <dt>

[Представление содержимого по типу или виду файла](prophand-content-view.md)
</dt> <dt>

[Средство проверки типов файлов](file-type-verifier.md)
</dt> <dt>

[Обработчики типов файлов](fa-file-extensions.md)
</dt> <dt>

[Программные идентификаторы](fa-progids.md)
</dt> <dt>

[Наблюдаемые типы](fa-perceivedtypes.md)
</dt> </dl>

 

 
