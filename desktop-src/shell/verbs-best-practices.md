---
description: Рекомендации по работе с обработчиками контекстного меню и несколькими глаголами при реализации пользовательского формата файлов в оболочке Windows.
title: Рекомендации по работе с обработчиками контекстного меню и несколькими командами
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 4D352ECB-6214-4f6e-A3E5-F79E154D090A
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: 14ec2e8915aa1df47ca21c6436ec963be3f590f5
ms.sourcegitcommit: 91530c19d26ba4c57a6af1f37b57f211f580464e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112396449"
---
# <a name="best-practices-for-shortcut-menu-handlers-and-multiple-verbs"></a>Рекомендации по работе с обработчиками контекстного меню и несколькими командами

Этот раздел организован следующим образом:

-   [Рекомендации](#best-practices-for-shortcut-menu-handlers-and-multiple-verbs)
    -   [Рекомендации по реализации команд](#best-practices-for-verb-implementations)
-   [Рекомендации по использованию нескольких команд выбора](#best-practices-for-multiple-selection-verbs)
    -   [Разнородных выбора](#heterogenous-selections)
-   [Связанные темы](#related-topics)

## <a name="best-practices"></a>Рекомендации

Статическая команда — это простейшие глаголы для реализации и обеспечения широких функциональных возможностей. Мы настоятельно рекомендуем реализовать глагол с помощью одного из статических методов глагола.

### <a name="best-practices-for-verb-implementations"></a>Рекомендации по реализации команд

В следующем списке представлены рекомендации по реализации команд.

-   Всегда выберете простейший метод глагола, соответствующий вашим потребностям.
-   По возможности используйте статический метод глагола.
-   Не выполняйте ресурсоемких операций или операции ввода-вывода в потоке пользовательского интерфейса. [**Ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) и [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) должны быть очень консервативными в выполняемой ими работе. [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) должен быть выполнен в другом процессе или необходимо создать новый поток, чтобы предотвратить блокировку вызывающего объекта.
-   Добавьте в префикс команды с именем независимого поставщика программного обеспечения (ISV) следующим образом: `ISVName.verb` . Использование неквалифицированных имен может привести к конфликтам с несколькими независимыми поставщиками программного обеспечения, которые выбрали одно и то же имя команды.
-   Всегда используйте идентификатор ProgID для конкретного приложения. Поскольку некоторые типы элементов не используют это сопоставление, существует потребность в уникальных именах поставщиков.
-   Расположите пользовательский интерфейс относительно вызывающего метода, но не выполняется в потоке вызывающего.
-   Не допускайте возвращаемое **значение \_ ОК** для канонических глаголов, передаваемых методу [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) . Это вызывает сбой при вызове реальной реализации глагола и возвращает код ошибки для канонических команд. Если канонические команды не поддерживаются, возвращается ошибка при обнаружении ненулевого значения HIWORD (Лпверб).
-   Избегайте использования **rundll32.exe** в качестве узла для команды.
-   При реализации [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) необходимо возвращать количество глаголов, добавленных в меню с помощью значения **HRESULT** , используя макрос ресултфромшорт.
-   Если вы зарегистрировались в одной из следующих записей разделов реестра, соблюдайте осторожность и обязательно Зарегистрируйте обработчик для наиболее конкретного типа, чтобы уменьшить возможные непредвиденные последствия.
    -   **\_корневой узел классов hKey \_\\\***
    -   **\_ \_ Корневой АЛЛФИЛЕСИСТЕМОБЖЕКТС классов hKey \\**
    -   **\_ \_ Корневая папка классов \\ hKey**
    -   **\_ \_ Корневой каталог классов hKey \\**
-   Установите ключ **майчанжедефаултмену** , только если предполагается, что в контекстном меню может потребоваться изменить команду по умолчанию. Если обработчик не изменяет команду по умолчанию, этот ключ устанавливать не следует, так как это приводит к тому, что система загружает библиотеку DLL без необходимости.
-   Сократите работу, которую вы выполняете в [**ишеллекстинит:: Initialize**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize). Для обработчиков контекстного меню запишите объект данных, переданный в **ишеллекстинит:: Initialize**, а затем обработайте его в [**IContextMenu:: куериконтекстмену**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu)или [**IContextMenu:: инвокекомманд**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand).

## <a name="best-practices-for-multiple-selection-verbs"></a>Рекомендации по использованию нескольких команд выбора

Поскольку количество элементов в сценарии с множественным выбором может быть большим, важно учитывать влияние реализации команд на производительность. Например, когда пользователь ищет " \* " над областью, включающей большое количество элементов, а затем нажимает кнопку **выбрать все** и щелкаете правой кнопкой мыши, команда представляет выделенный фрагмент, в котором могут содержаться тысячи элементов. В результате глаголы должны учитывать только первый элемент в выделенном фрагменте и общее число элементов. Первый элемент определяется как элемент в верхней части представления или элемент, который пользователь впервые щелкнул правой кнопкой мыши.

В Windows 7 и более поздних версиях число элементов, передаваемых в команду, ограничено 16 при запросе контекстного меню. Затем команда создается повторно и повторно инициализируется с полным выделением при вызове этой команды.

В некоторых случаях целесообразно учитывать небольшое количество фиксированных элементов. Например, для команды "diff" следует учитывать только первые два элемента. Как правило, не нужно проверять каждый элемент в выделенном фрагменте, чтобы определить, является ли он определенным типом, или запросить каждый элемент в выделенном фрагменте для его свойств. Взгляните на первый элемент и решите, подходит ли он для добавления команды.

### <a name="heterogenous-selections"></a>Разнородных выбора

Оптимистичные глаголы автоматически добавляются в вариант множественного выбора, предполагая, что непроверенные элементы могут обрабатываться командой. С другой стороны, пессимистические команды не добавляются, если выделенный фрагмент содержит непроверенные элементы и добавляется только в тех случаях, когда количество элементов невелико.

Команды стиля проигрывателя должны быть оптимистичными и автоматически пропускать необработанные элементы. Если сбой работы с элементами может привести к потере или путанице данных, команда должна предупредить пользователей об элементах, которые не могут быть обработаны. Например, команда Backup должна указывать, что не удалось создать резервную копию некоторых элементов.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Выбор статической или динамической команды для контекстного меню](shortcut-choose-method.md)
</dt> <dt>

[Создание обработчиков контекстного меню](context-menu-handlers.md)
</dt> <dt>

[Настройка контекстного меню с помощью динамических команд](shortcut-menu-using-dynamic-verbs.md)
</dt> <dt>

[Контекстное меню (контекст) и обработчики контекстного меню](context-menu.md)
</dt> <dt>

[Команды и сопоставления файлов](fa-verbs.md)
</dt> <dt>

[Справочник по контекстному меню](context-menu-reference.md)
</dt> </dl>

 

 



