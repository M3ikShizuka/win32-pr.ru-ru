---
description: Форматы буфера обмена оболочки используются для указания типа данных оболочки, передаваемых через буфер обмена.
ms.assetid: fb8ce5d3-3215-4e05-a916-4d4a803464d2
title: Форматы буфера обмена оболочки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fccd73f5b364c247454d874f5b9bb7586e3187150ebce28620cc6dc01f8298d
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119351394"
---
# <a name="shell-clipboard-formats"></a>Форматы буфера обмена оболочки

Форматы буфера обмена оболочки используются для указания типа данных оболочки, передаваемых через буфер обмена. Большинство форматов буфера обмена оболочки указывают тип данных, например список имен файлов или указатели на списки идентификаторов элементов (PIDL). Однако некоторые форматы используются для обмена данными между источником и целевым объектом. Они могут ускорить процесс передачи данных за счет поддержки операций оболочки, например [оптимизированного перемещения](datascenarios.md) и [delete_on_paste](datascenarios.md). Данные оболочки всегда содержатся в [объекте данных](dataobject.md) , который использует структуру [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) как более общий способ для характеризующих данные. Для элемента **кфформат** структуры задается формат буфера обмена для конкретного элемента данных. Другие члены предоставляют дополнительные сведения, например механизм передачи данных. Данные содержатся в сопутствующей структуре [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .

> [!Note]  
> Стандартные идентификаторы формата буфера обмена имеют форму CF_ *xxx*. Распространенным примером является CF_TEXT, который используется для передачи текстовых данных в формате ANSI. Эти идентификаторы имеют предопределенные значения и могут использоваться непосредственно с структурами [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) . За исключением [CF_HDROP](#cf_hdrop), идентификаторы формата оболочки не являются стандартными. За исключением Драгвиндов, они имеют форму CFSTR_ *xxx*. Чтобы отличить эти значения от стандартных форматов, они часто называются просто *форматами*. Однако, в отличие от предопределенных форматов, они должны быть зарегистрированы как исходной, так и целевой средой, прежде чем их можно будет использовать для перемещения данных. Чтобы зарегистрировать формат оболочки, включите файл заголовка Шлобж. h и передайте идентификатор формата CFSTR_ *xxx* в [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata). Эта функция возвращает допустимое значение формата буфера обмена, которое затем может использоваться в качестве элемента **кфформат** структуры **форматетк** .

 

Форматы буфера обмена оболочки организованы в три группы в зависимости от того, как они используются.

-   [Форматы для передачи объектов файловой системы](#formats-for-transferring-file-system-objects)
    -   [CF_HDROP](#cf_hdrop)
    -   [CFSTR_FILECONTENTS](#cfstr_filecontents)
    -   [CFSTR_FILEDESCRIPTOR](#cfstr_filedescriptor)
    -   [CFSTR_FILENAME](#cfstr_filename)
    -   [CFSTR_FILENAMEMAP](#cfstr_filenamemap)
    -   [CFSTR_MOUNTEDVOLUME](#cfstr_mountedvolume)
    -   [CFSTR_SHELLIDLIST](#cfstr_shellidlist)
    -   [CFSTR_SHELLIDLISTOFFSET](#cfstr_shellidlistoffset)
-   [Форматы для передачи виртуальных объектов](#formats-for-transferring-virtual-objects)
    -   [CFSTR_NETRESOURCES](#cfstr_netresources)
    -   [CFSTR_PRINTERGROUP](#cfstr_printergroup)
    -   [CFSTR_INETURL](#cfstr_ineturl)
    -   [CFSTR_SHELLURL (не рекомендуется)](#cfstr_shellurl-deprecated)
-   [Форматы обмена данными между исходным и целевым элементами](#formats-for-communication-between-source-and-target)
    -   [CFSTR_INDRAGLOOP](#cfstr_indragloop)
    -   [CFSTR_LOGICALPERFORMEDDROPEFFECT](#cfstr_logicalperformeddropeffect)
    -   [CFSTR_PASTESUCCEEDED](#cfstr_pastesucceeded)
    -   [CFSTR_PERFORMEDDROPEFFECT](#cfstr_performeddropeffect)
    -   [CFSTR_PREFERREDDROPEFFECT](#cfstr_preferreddropeffect)
    -   [CFSTR_TARGETCLSID](#cfstr_targetclsid)
    -   [CFSTR_UNTRUSTEDDRAGDROP](#cfstr_untrusteddragdrop)
    -   [драгвиндов](#dragwindow)

## <a name="formats-for-transferring-file-system-objects"></a>Форматы для передачи объектов файловой системы

Эти форматы используются для перемещения одного или нескольких файлов или других объектов оболочки.

-   [CF_HDROP](#cf_hdrop)
-   [CFSTR_FILECONTENTS](#cfstr_filecontents)
-   [CFSTR_FILEDESCRIPTOR](#cfstr_filedescriptor)
-   [CFSTR_FILENAME](#cfstr_filename)
-   [CFSTR_FILENAMEMAP](#cfstr_filenamemap)
-   [CFSTR_MOUNTEDVOLUME](#cfstr_mountedvolume)
-   [CFSTR_SHELLIDLIST](#cfstr_shellidlist)
-   [CFSTR_SHELLIDLISTOFFSET](#cfstr_shellidlistoffset)

### <a name="cf_hdrop"></a>CF_HDROP

Этот формат буфера обмена используется при передаче расположений группы существующих файлов. В отличие от других форматов оболочки он предопределен, поэтому нет необходимости вызывать [регистерклипбоардформат](/windows/win32/api/winuser/nf-winuser-registerclipboardformata). Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на структуру [**дропфилес**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) в качестве элемента **хглобал** .

Элемент **защищенных файлах** структуры [**дропфилес**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) содержит смещение в массиве символов, заканчивающемся **двойным нулем,** который содержит имена файлов. При извлечении формата CF_HDROP из объекта данных можно использовать [**драгкуерифиле**](/windows/desktop/api/Shellapi/nf-shellapi-dragqueryfilea) для извлечения отдельных имен файлов из объекта глобальной памяти. При создании формата CF_HDROP для размещения объекта данных необходимо создать массив имен файлов.

Массив имен файлов состоит из ряда строк, каждый из которых содержит полный путь к файлу, включая завершающий **нуль** -символ. К конечной строке добавляется дополнительный символ **null** для завершения массива. Например, если \\ передаются файлы c:temp1.txt и c: \\temp2.txt, массив символов выглядит следующим образом:


```CMD
c:\temp1.txt'\0'c:\temp2.txt'\0''\0'
```

> [!Note]  
> В этом примере " \\ 0" используется для представления символа **null** , а не литеральных символов, которые должны быть добавлены.


Если объект был скопирован в буфер обмена в ходе операции перетаскивания, элемент **PT** структуры [**дропфилес**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) содержит координаты точки, в которой объект был удален. Для извлечения координат курсора можно использовать [**драгкуерипоинт**](/windows/desktop/api/Shellapi/nf-shellapi-dragquerypoint) .

Если этот формат представлен в объекте данных, то цикл перетаскивания OLE имитирует [**WM_DROPFILES**](wm-dropfiles.md) функциональности с целями перетаскивания, отличными от OLE. это важно, если приложение является источником операции перетаскивания в системе Windows 3,1.

### <a name="cfstr_filecontents"></a>CFSTR_FILECONTENTS

Этот идентификатор формата используется с форматом [CFSTR_FILEDESCRIPTOR](#cfstr_filedescriptor) для перемещения данных, как если бы он был файлом, независимо от того, как он фактически хранится. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , представляющей содержимое одного файла. Файл обычно представляется в виде объекта потока, что позволяет избежать необходимости размещения содержимого файла в памяти. В этом случае элемент **тимед** структуры **стгмедиум** имеет значение TYMED_ISTREAM, а файл представляется интерфейсом [**ISTREAM**](/windows/win32/api/objidl/nn-objidl-istream) . Этот файл также может быть объектом хранилища или глобальной памяти (TYMED_ISTORAGE или TYMED_HGLOBAL). Связанный формат CFSTR_FILEDESCRIPTOR содержит структуру [**филедескриптор**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) для каждого файла, который указывает имя и атрибуты файла.

Целевой объект обрабатывает данные, связанные с форматом CFSTR_FILECONTENTS, как если бы он был файлом. Когда целевой объект вызывает интерфейс [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) для извлечения данных, он указывает определенный файл, устанавливая для **элемента Линдекс** структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) Отсчитываемый от нуля индекс структуры [**филедескриптор**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) файла в соответствующем [CFSTR_FILEDESCRIPTOR](#cfstr_filedescriptor) формате. Затем целевой объект использует возвращаемый указатель интерфейса или глобальный маркер памяти для извлечения данных.

### <a name="cfstr_filedescriptor"></a>CFSTR_FILEDESCRIPTOR

Этот идентификатор формата используется с форматом [CFSTR_FILECONTENTS](#cfstr_filecontents) для перемещения данных в виде группы файлов. Эти два формата являются предпочтительным способом перемещения объектов оболочки, которые не хранятся в виде файлов в файловой системе. Например, эти форматы можно использовать для перемещения группы сообщений электронной почты в виде отдельных файлов, несмотря на то, что каждый адрес электронной почты на самом деле хранится в виде блока данных в базе данных. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на структуру [**филеграупдескриптор**](/windows/win32/api/shlobj_core/ns-shlobj_core-filegroupdescriptora) , за которой следует массив, содержащий одну структуру [**филедескриптор**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) для каждого файла в группе. Для каждой структуры **филедескриптор** существует отдельный формат CFSTR_FILECONTENTS, который содержит содержимое файла. Чтобы определить формат CFSTR_FILECONTENTS определенного файла, задайте в качестве значения **Линдекс** структуры [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) Отсчитываемый от нуля индекс структуры **филедескриптор** файла.

Формат CFSTR_FILEDESCRIPTOR обычно используется для перемещения данных, как если бы они были группой файлов, независимо от того, как они хранятся на самом деле. С точки зрения целевого объекта каждый формат CFSTR_FILECONTENTS представляет отдельный файл и обрабатывается соответствующим образом. Однако источник может хранить данные любым способом, который он выбрал. Хотя формат CSFTR_FILECONTENTS может соответствовать одному файлу, он также может, например, представлять данные, извлеченные источником из базы данных или текстового документа.

### <a name="cfstr_filename"></a>CFSTR_FILENAME

Этот идентификатор формата используется для перемещения одного файла. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на одну строку, завершающуюся **нулем**, содержащую полный путь к файлу. этот формат был заменен [CF_HDROP](#cf_hdrop), но он поддерживается для обеспечения обратной совместимости с приложениями Windows 3,1.

### <a name="cfstr_filenamemap"></a>CFSTR_FILENAMEMAP

Этот идентификатор формата используется при переименовании группы файлов в [CF_HDROPном](#cf_hdrop) формате, а также при передаче. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на массив символов, заканчивающийся **двойным нулем.** Этот массив содержит новое имя для каждого файла в том же порядке, в котором эти файлы перечислены в соответствующем CF_HDROPм формате. Формат массива символов такой же, как и используемый CF_HDROP для перечисления передаваемых файлов.

### <a name="cfstr_mountedvolume"></a>CFSTR_MOUNTEDVOLUME

Этот идентификатор формата используется для перемещения пути на подключенном томе. Он похож на [CF_HDROP](#cf_hdrop), но он содержит только один путь и может обрабатывать более длинные строки пути, которые могут потребоваться для представления пути при подключении тома к папке. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на одну строку, завершающуюся **нулем**, содержащую полный путь к файлу. Строка пути должна заканчиваться \\ символом "", за которым следует завершающее **значение NULL**.

до Windows 2000 тома могут быть подключены только к буквам диска. для Windows 2000 и более поздних систем с диском в формате NTFS можно также подключать тома к пустым папкам. Эта функция позволяет подключить том, не занимая букву диска. Подключенный том может использовать любой поддерживаемый в настоящее время формат, включая FAT, FAT32, NTFS и CDFS.

Можно добавить страницы в страницу свойств диска, реализовав [обработчик страницы свойств](propsheet-handlers.md). Если том подключен к букве диска, оболочка передает сведения о пути обработчику в формате [CF_HDROP](#cf_hdrop) . при использовании Windows 2000 и более поздних версий формат CF_HDROP используется при подключении тома к букве диска, как и в предыдущих системах. Однако если том подключен к папке, вместо CF_HDROP используется [CFSTR_MOUNTEDVOLUME](#cfstr_mountedvolume) идентификатор формата.

Если для подключения томов будут использоваться только буквы диска, будет использоваться только [CF_HDROP](#cf_hdrop) , а существующие обработчики страниц свойств будут работать так же, как и в предыдущих системах. Однако, если требуется, чтобы обработчик отображал страницу для томов, которые подключены к папкам, а также к буквам дисков, обработчик должен иметь возможность понимать как форматы CSFTR_MOUNTEDVOLUME, так и CF_HDROP.

### <a name="cfstr_shellidlist"></a>CFSTR_SHELLIDLIST

Этот идентификатор формата используется при передаче расположений одного или нескольких существующих объектов пространства имен. Он используется во многом так же, как [CF_HDROP](#cf_hdrop), но он содержит PIDL вместо путей файловой системы. Использование PIDL позволяет использовать формат CFSTR_SHELLIDLIST для управления виртуальными объектами, а также объектами файловой системы. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на структуру [**Цида**](/windows/win32/api/shlobj_core/ns-shlobj_core-cida) .

Элемент **аоффсет** структуры [**Цида**](/windows/win32/api/shlobj_core/ns-shlobj_core-cida) представляет собой массив, содержащий смещение до начала структуры [**ИТЕМИДЛИСТ**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) для каждого переданного Пидл. Чтобы извлечь определенный ПИДЛ, сначала определите его индекс. Затем добавьте значение **аоффсет** , соответствующее этому индексу, в адрес структуры **Цида** .

Первый элемент **аоффсет** содержит смещение к полному Пидл родительской папки. Если этот ПИДЛ пуст, то родительской папкой является Рабочий стол. Каждый из оставшихся элементов массива содержит смещение для одного из PIDL, который необходимо передать. Все эти PIDL относятся к ПИДЛ родительской папки.

Для получения PIDL из структуры [**Цида**](/windows/win32/api/shlobj_core/ns-shlobj_core-cida) можно использовать следующие два макроса. Первый получает указатель на структуру и получает ПИДЛ родительской папки. Второй принимает указатель на структуру и получает один из других PIDL, идентифицируемый индексом, начинающимся с нуля.


```C++
#define GetPIDLFolder(pida) (LPCITEMIDLIST)(((LPBYTE)pida)+(pida)->aoffset[0])

#define GetPIDLItem(pida, i) (LPCITEMIDLIST)(((LPBYTE)pida)+(pida)->aoffset[i+1])
```

> [!Note]  
> Значение, возвращаемое этими макросами, является указателем на структуру [**ИТЕМИДЛИСТ**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) Пидл. Так как эти структуры имеют разную длину, необходимо определить конец структуры, проходя по каждой из структур [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) структуры **итемидлист** , пока не достигают двухбайтовый **значения NULL** , обозначающие конец.

### <a name="cfstr_shellidlistoffset"></a>CFSTR_SHELLIDLISTOFFSET

Этот идентификатор формата используется с такими форматами, как [CF_HDROP](#cf_hdrop), [CFSTR_SHELLIDLIST](#cfstr_shellidlist)и [CFSTR_FILECONTENTS](#cfstr_filecontents) для указания расположения группы объектов после перемещения. Данные состоят из структуры [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей объект глобальной памяти. Элемент **хглобал** структуры указывает на массив структур [**точек**](/previous-versions//dd162805(v=vs.85)) . Первая структура задает экранные координаты (в пикселях) верхнего левого угла прямоугольника, охватывающего группу. Оставшаяся часть структур задает расположение отдельных объектов относительно положения группы. Они должны быть в том же порядке, который использовался для перечисления объектов в связанном формате.

## <a name="formats-for-transferring-virtual-objects"></a>Форматы для передачи виртуальных объектов

Формат CFSTR_SHELLIDLIST можно использовать для перемещения файловой системы и виртуальных объектов. Однако существует также несколько специализированных форматов для передачи определенных типов виртуальных объектов.

-   [CFSTR_NETRESOURCES](#cfstr_netresources)
-   [CFSTR_PRINTERGROUP](#cfstr_printergroup)
-   [CFSTR_INETURL](#cfstr_ineturl)
-   [CFSTR_SHELLURL (не рекомендуется)](#cfstr_shellurl-deprecated)

### <a name="cfstr_netresources"></a>CFSTR_NETRESOURCES

Этот идентификатор формата используется при передаче сетевых ресурсов, таких как домен или сервер. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на структуру [**нресаррай**](/windows/desktop/api/shlobj_core/ns-shlobj_core-nresarray) . Элемент **Nr** этой структуры указывает структуру [**Нетресаурце**](/windows/win32/api/rrascfg/nn-rrascfg-ieapproviderconfig) , член **лпремотенаме** которой содержит строку, завершающуюся **нулем,** обозначающую сетевой ресурс. цель перетаскивания может затем использовать данные с любой из функций API [Windows network (внет)](../wnet/windows-networking-wnet-.md) , таких как [**внетаддконнектион**](/windows/win32/api/winnetwk/nf-winnetwk-wnetaddconnectiona), для выполнения сетевых операций с объектом.

### <a name="cfstr_printergroup"></a>CFSTR_PRINTERGROUP

Этот идентификатор формата используется при передаче понятных имен принтеров. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на строку в том же формате, что и при использовании с [CF_HDROP](#cf_hdrop). Однако элемент **защищенных файлах** структуры [**дропфилес**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropfiles) содержит одно или несколько понятных имен принтеров вместо путей к файлам.

### <a name="cfstr_ineturl"></a>CFSTR_INETURL

Этот идентификатор формата заменяет [CFSTR_SHELLURL (не рекомендуется)](#cfstr_shellurl-deprecated). Если приложение должно управлять URL-адресами буфера обмена, используйте CFSTR_INETURL вместо CFSTR_SHELLURL (не рекомендуется). Этот формат обеспечивает лучшее представление одного URL-адреса в буфере обмена. Если Юникод не определен, приложение получает версию CF_TEXT/CFSTR_SHELLURL URL-адреса. Если определен Юникод, приложение получает CF_UNICODE версию URL-адреса.

### <a name="cfstr_shellurl-deprecated"></a>CFSTR_SHELLURL (не рекомендуется)

> [!Note]  
> Этот идентификатор формата устарел; Вместо этого используйте CFSTR_INETURL.

 

## <a name="formats-for-communication-between-source-and-target"></a>Форматы обмена данными между исходным и целевым элементами

Эти идентификаторы формата позволяют обмениваться данными между источником и целевым объектом. Эти форматы сопровождают данные и предоставляют приложениям более высокий уровень контроля над операциями перемещения, копирования и перетаскивания, включая объекты оболочки.

-   [CFSTR_INDRAGLOOP](#cfstr_indragloop)
-   [CFSTR_LOGICALPERFORMEDDROPEFFECT](#cfstr_logicalperformeddropeffect)
-   [CFSTR_PASTESUCCEEDED](#cfstr_pastesucceeded)
-   [CFSTR_PERFORMEDDROPEFFECT](#cfstr_performeddropeffect)
-   [CFSTR_PREFERREDDROPEFFECT](#cfstr_preferreddropeffect)
-   [CFSTR_TARGETCLSID](#cfstr_targetclsid)
-   [CFSTR_UNTRUSTEDDRAGDROP](#cfstr_untrusteddragdrop)
-   [драгвиндов](#dragwindow)

### <a name="cfstr_indragloop"></a>CFSTR_INDRAGLOOP

Этот идентификатор формата используется объектом данных для указания того, находится ли он в цикле перетаскивания. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на значение **типа DWORD** . Если значение **DWORD** не равно нулю, то объект данных находится в цикле перетаскивания. Если значение равно нулю, то объект данных не находится внутри цикла перетаскивания.

Некоторые цели перетаскивания могут вызывать [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) и пытаться извлечь данные, пока объект все еще находится внутри цикла перетаскивания. Полная отрисовка объекта для каждого такого экземпляра может вызвать зависание курсора перетаскивания. Если объект данных поддерживает [CFSTR_INDRAGLOOP](#cfstr_indragloop), целевой объект может использовать этот формат, чтобы проверить состояние цикла перетаскивания и избежать интенсивного отображения объекта в памяти, пока он не будет фактически удален. Форматы, интенсивно использующие память для визуализации, по-прежнему должны включаться в перечислитель [**форматетк**](/windows/win32/api/objidl/ns-objidl-formatetc) и в вызовах интерфейса [**IDataObject:: куерижетдата**](/windows/win32/api/objidl/nf-objidl-idataobject-querygetdata). Если объект данных не устанавливает CFSTR_INDRAGLOOP, он должен действовать так, как если бы значение было равно нулю.

### <a name="cfstr_logicalperformeddropeffect"></a>CFSTR_LOGICALPERFORMEDDROPEFFECT

[Версия 5,0.](versions.md) Этот идентификатор формата позволяет удаленному источнику вызывать метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) объекта данных, чтобы определить результат передаваемых данных оболочки. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на DWORD, содержащий значение [**дропеффект**](../com/dropeffect-constants.md) .

Идентификатор формата [CFSTR_PERFORMEDDROPEFFECT](#cfstr_performeddropeffect) предназначен для того, чтобы цель указывала объекту данных на фактическую операцию. Однако оболочка использует [оптимизированные перемещения](datascenarios.md) для объектов файловой системы везде, где это возможно. В этом случае оболочка обычно устанавливает CFSTR_PERFORMEDDROPEFFECT значение DROPEFFECT_NONE, чтобы указать объекту данных, что исходные данные были удалены. Поэтому источник не может использовать значение CFSTR_PERFORMEDDROPEFFECT, чтобы определить, какая операция выполнена. Хотя для большинства источников эти сведения не требуются, существуют некоторые исключения. Например, несмотря на то, что оптимизированные перемещения устраняют необходимость в источнике для удаления каких-либо данных, источнику может потребоваться обновить связанную базу данных, чтобы указать, что файлы были перемещены или скопированы.

Если источнику необходимо выяснить, какая операция выполнялась, он может вызвать метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) объекта данных и запросить формат CFSTR_LOGICALPERFORMEDDROPEFFECT. Этот формат по сути отражает то, что происходит с точки зрения пользователя после завершения операции. Если создается новый файл и исходный файл удаляется, пользователь видит операцию перемещения, а значение данных формата — DROPEFFECT_MOVE. Если исходный файл все еще присутствует, пользователь увидит операцию копирования, и значение данных формата будет равно DROPEFFECT_COPY. Если была создана ссылка, значение данных формата будет DROPEFFECT_LINK.

### <a name="cfstr_pastesucceeded"></a>CFSTR_PASTESUCCEEDED

Этот идентификатор формата используется целевым объектом для информирования объекта данных с помощью метода [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) , что операция удаления из операции вставки завершилась. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на **DWORD** , содержащий значение [**дропеффект**](../com/dropeffect-constants.md) . Этот формат используется для уведомления объекта данных о том, что он должен выполнить операцию вырезания и удалить исходные данные, если это необходимо. Дополнительные сведения см. [в разделе операции удаления при вставке](datascenarios.md).

### <a name="cfstr_performeddropeffect"></a>CFSTR_PERFORMEDDROPEFFECT

Этот идентификатор формата используется целевым объектом для информирования объекта данных через его метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) результата передачи данных. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает **DWORD** , для которого задано соответствующее значение [**дропеффект**](../com/dropeffect-constants.md) , обычно DROPEFFECT_MOVE или DROPEFFECT_COPY.

Этот формат обычно используется, когда результат операции может быть либо перемещением, либо копированием, например, в [оптимизированной операции перемещения](datascenarios.md) или удаления. Он обеспечивает надежный способ сообщить объекту данных о том, что именно произошло. Оно было введено, поскольку значение *пдвеффект* , возвращенное [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) , не было уверенно указывать, какая операция была выполнена. Формат [CFSTR_PERFORMEDDROPEFFECT](#cfstr_performeddropeffect) является надежным способом указать, что было выполнено неоптимизированное перемещение.

### <a name="cfstr_preferreddropeffect"></a>CFSTR_PREFERREDDROPEFFECT

Этот идентификатор формата используется источником для указания, следует ли перемещать или копировать предпочтительный метод передачи данных. Цель перетаскивания запрашивает этот формат, вызывая метод [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) объекта данных. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на значение **типа DWORD** . Это значение задается равным DROPEFFECT_MOVE, если операция перемещения является предпочтительной, или DROPEFFECT_COPY, если операция копирования является предпочтительной.

Эта функция используется, когда источник может поддерживать операцию перемещения или копирования. Для передачи предпочтений в целевой объект используется формат [CFSTR_PREFERREDDROPEFFECT](#cfstr_preferreddropeffect) . Поскольку целевой объект не обязан учитывать запрос, целевой объект должен вызвать метод [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) источника с [CFSTR_PERFORMEDDROPEFFECT](#cfstr_performeddropeffect) форматом, чтобы сообщить объекту данных, какая операция выполнялась фактически.

При использовании операции [удаления при вставке](datascenarios.md) используется формат CFSTR_PREFERREDDROPFORMAT, указывающий целевому объекту, что источник выполнил операцию вырезания или копирования. С помощью операции перетаскивания можно указать действие оболочки с помощью CFSTR_PREFERREDDROPFORMAT. Если этот формат отсутствует, оболочка выполняет действие по умолчанию на основе контекста. Например, если пользователь перетаскивает файл из одного тома и перемещает его на другой том, действие оболочки по умолчанию — копирование файла. Включив в объект данных формат CFSTR_PREFERREDDROPFORMAT, можно переопределить действие по умолчанию и явно указать оболочке копировать, переместить или связать файл. Если пользователь перетаскивайте с помощью правой кнопки, CFSTR_PREFERREDDROPFORMAT задает команду по умолчанию в контекстном меню [перетаскивания](context-menu-handlers.md) . Пользователь по-прежнему может выбрать другие команды в меню.

Перед браузером Microsoft Internet Explorer 4,0 приложение указало, что оно передает типы файлов ярлыков, задавая FD_LINKUI в элементе **dwFlags** структуры [**филедескриптор**](/windows/win32/api/shlobj_core/ns-shlobj_core-filedescriptora) . Целевым объектам пришлось бы использовать потенциально длительный вызов функции [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) , чтобы выяснить, установлен ли флаг FD_LINKUI. Теперь предпочтительным способом указать, что передаются ярлыки, является использование формата CFSTR_PREFERREDDROPEFFECT, для которого задано значение DROPEFFECT_LINK. Однако для обеспечения обратной совместимости со старыми системами источники должны по-прежнему устанавливать флаг FD_LINKUI.

### <a name="cfstr_targetclsid"></a>CFSTR_TARGETCLSID

Этот идентификатор формата используется целевым объектом для предоставления ему идентификатора CLSID источника. Данные представляют собой структуру [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащую объект глобальной памяти. Элемент **хглобал** структуры указывает на идентификатор GUID CLSID целевого объекта перетаскивания.

Этот формат используется в основном для разрешения удаления объектов путем их перетаскивания в корзину. При удалении объекта в корзине метод интерфейса [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) вызывается с CFSTR_TARGETCLSID ФОРМАТом CLSID в корзине (CLSID_RecycleBin). Затем источник может удалить исходный объект.

### <a name="cfstr_untrusteddragdrop"></a>CFSTR_UNTRUSTEDDRAGDROP

этот идентификатор формата используется Windows Internet Explorer и оболочкой Windows для предоставления механизма блокировки или запроса операций перетаскивания, исходящих из Internet Explorer вместе с флагом [**URLACTION_SHELL_ENHANCED_DRAGDROP_SECURITY**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537178(v=vs.85)) .

**CFSTR_UNTRUSTEDDRAGDROP** добавляется источником операции перетаскивания, чтобы указать, что объект данных может содержать ненадежные данные. Данные представлены структурой [**стгмедиум**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) , содержащей глобальный объект памяти. Элемент **хглобал** структуры указывает **DWORD** , установленный в соответствующий флаг [**действия URL-адреса**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537178(v=vs.85)) , для проверки политики с помощью [**иинтернетсекуритиманажер::P роцессурлактион**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537136(v=vs.85)) , используя флаг [**PUAF_ENFORCERESTRICTED**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537171(v=vs.85)) .

### <a name="dragwindow"></a>драгвиндов

Этот формат используется в операции перетаскивания для обнаружения изображения перетаскивания объекта (окна), чтобы визуальные сведения можно было обновлять динамически. Когда объект перетаскивается на целевой объект перетаскивания, приложение обновляет свою структуру [**дропдескриптион**](/windows/desktop/api/shlobj_core/ns-shlobj_core-dropdescription) в ответ на метод [**интерфейс IDropTarget::D раговер**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) или [**идропсаурце:: GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) . **Дропдескриптион** обновляется новым значением [**дропимажетипе**](/windows/desktop/api/shlobj_core/ne-shlobj_core-dropimagetype) , указывающим на оформление, которое должно быть применено к визуальному элементу окна перетаскивания; Например, указывает, что файл копируется, а не перемещен, или что объект не может быть удален в это расположение. Однако пока объект не получит [**DDWM_UPDATEWINDOW**](ddwm-updatewindow.md) сообщение, визуальные элементы не будут обновлены. Этот формат предоставляет **HWND** окна, перетащив получателя, в отправителя сообщения **DDWM_UPDATEWINDOW** .

Данные буфера обмена имеют тип [**TYMED_HGLOBAL**](/windows/win32/api/objidl/ne-objidl-tymed). Это представление **HWND** в виде **DWORD** . Данные можно передать в функцию **улонгтохандле** , определенную в басетсд. h, чтобы предоставить 64-разрядный **HWND** для использования в 64-разрядной Windows.

Этот формат не требует включения Шлобж. h.

 

 
