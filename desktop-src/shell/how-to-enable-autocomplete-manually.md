---
description: Чтобы получить более подробный контроль над поведением автозаполнения или добавить пользовательский источник строк автозаполнения, необходимо самостоятельно управлять объектом автозаполнения.
ms.assetid: E1A7B1B0-2879-452E-9EBB-73F02B932200
title: Включение автозаполнения вручную
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c7df686e4c5a4a6e96b1faf82e4926dffc73398b360e3e6235d6a61451eae189
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117859711"
---
# <a name="how-to-enable-autocomplete-manually"></a>Включение автозаполнения вручную

Чтобы получить более подробный контроль над поведением автозаполнения или добавить пользовательский источник строк автозаполнения, необходимо самостоятельно управлять объектом автозаполнения. Автозаполнение можно включить вручную следующими способами.

## <a name="instructions"></a>Инструкции

### <a name="creating-a-simple-autocomplete-object"></a>Создание простого автозаполнения объекта

В следующих шагах показано, как создать и инициализировать простой объект автозаполнения. Простой объект автозаполнения завершает строки из одного источника. В этом примере была намеренно опущена проверка ошибок.

1.  Создайте объект автозаполнения.

    ```C++
    IAutoComplete *pac;

    HRESULT hr = CoCreateInstance(CLSID_AutoComplete, 
                                    NULL, 
                                  CLSCTX_INPROC_SERVER,
                                  IID_PPV_ARGS(&pac));
    ```

    

2.  Создайте источник автозаполнения. Можно использовать [предопределенный источник автозаполнения](ac-ovw.md) или написать собственный пользовательский источник.

    В следующем коде используется один из стандартных источников автозаполнения.

    ```C++
    IUnknown *punkSource;

    hr = CoCreateInstance(CLSID_ACListISF, 
                          NULL, 
                          CLSCTX_INPROC_SERVER,
                          IID_PPV_ARGS(&punkSource));
    ```

    

    В следующем коде используется источник настраиваемого автозаполнения. Вы можете написать собственный источник автозаполнения, реализовав объект, который предоставляет интерфейс [**иенумстринг**](/windows/win32/api/objidlbase/nn-objidlbase-ienumstring) . Объект также может дополнительно реализовать интерфейсы [**иаклист**](/windows/win32/api/shlobj_core/nn-shlobj_core-iaclist) и [**IACList2**](/windows/win32/api/shlobj_core/nn-shlobj_core-iaclist2) .

    ```C++
    CCustomAutoCompleteSource *pcacs = new CCustomAutoCompleteSource();

    hr = pcacs->QueryInterface(IID_PPV_ARGS(&punkSource));
    if(SUCCEEDED(hr))
    {
        // ...
    }

    pcacs->Release();
    ```

    

3.  Задайте параметры источника автозаполнения (необязательно).

    Поведение источника автозаполнения можно настроить, задав его параметры, если источник предоставляет интерфейс [**IACList2**](/windows/win32/api/shlobj_core/nn-shlobj_core-iaclist2) . При использовании предопределенных источников автозаполнения только CLSID \_ аклистисф экспортирует **IACList2**. Полный список параметров и их значений см. в разделе [**IACList2:: сетоптионс**](/windows/win32/api/shlobj_core/nf-shlobj_core-iaclist2-setoptions).

    ```C++
    IACList2 *pal2;

    hr = punkSource->QueryInterface(IID_PPV_ARGS(&pal2));
    if (SUCCEEDED(hr))
    {
        hr = pal2->SetOptions(ACLO_FILESYSONLY);
        pal2->Release();
    }
    ```

    

4.  Инициализируйте объект автозаполнения.

    В этом примере **хвндедит** является маркером окна редактирования элемента управления, для которого необходимо включить Автозаполнение. Описание последних двух неиспользуемых параметров см. в разделе [**иаутокомплете:: init**](/windows/desktop/api/Shldisp/nf-shldisp-iautocomplete-init) .

    ```C++
    hr = pac->Init(hwndEdit, punkSource, NULL, NULL);
    ```

    

5.  Задайте параметры объекта автозаполнения (необязательно).

    Поведение объекта автозаполнения можно настроить, задав его параметры. Полный список параметров и их значений см. в документации по [**IACList2:: сетоптионс**](/windows/win32/api/shlobj_core/nf-shlobj_core-iaclist2-setoptions).

    ```C++
    IAutoComplete2 *pac2;

    hr = pac->QueryInterface(IID_PPV_ARGS(&pac2));

    if (SUCCEEDED(hr))
    {
        hr = pac2->SetOptions(ACO_AUTOSUGGEST);
        pac2->Release();
    }
    ```

    

6.  Освободите объекты.

    > [!Note]  
    > Объект автозаполнения остается прикрепленным к элементу управления "поле ввода" даже после его освобождения. Если вам нужно получить доступ к этим объектам позднее — если вы хотите изменить параметры автозаполнения позже, например, не требуется освобождать их на этом этапе.

     

    ```C++
    punkSource->Release();
    pac->Release();
    ```

    

### <a name="creating-a-compound-autocomplete-object"></a>Создание составного объекта автозаполнения

Составной объект автозаполнения соответствует строкам из нескольких источников. например, в Windows адресной строке Internet Explorer используется составной объект автозаполнения, так как пользователь может начать вводить имя файла или URL-адрес. Большинство действий, связанных с созданием составного объекта автозаполнения, аналогичны шагам в разделе "Создание простого автозаполнения объекта". Эти действия обозначены как таковые.

1.  Создайте объект автозаполнения. Это аналогично шагу 1 выше.

2.  Создайте диспетчер объектов составного источника автозаполнения.

    Объект составного источника автозаполнения позволяет объединять несколько источников автозаполнения в один источник автозаполнения.

    ```C++
    IObjMgr *pom;

    hr = CoCreateInstance(CLSID_ACLMulti, 
                          NULL, 
                          CLSCTX_INPROC_SERVER,
                          IID_PPV_ARGS(&pom));
    ```

    

3.  Создание и Настройка параметров для каждого источника автозаполнения. Повторите шаги 2 и 3 для каждого источника.

4.  Присоедините каждый источник автозаполнения к диспетчеру исходных объектов.

    ```C++
    hr = pom->Append(punkSource1);
    hr = pom->Append(punkSource2);
    ```

    

5.  Инициализируйте объект автозаполнения.

    Это аналогично шагу 4 выше, за исключением того, что вместо передачи простого источника автозаполнения в [**иаутокомплете:: init**](/windows/desktop/api/Shldisp/nf-shldisp-iautocomplete-init)передается диспетчер объектов составного источника.

    ```C++
    hr = pac->Init(hwndEdit, pom, NULL, NULL);
    ```

    

6.  Задайте параметры объекта автозаполнения. Это аналогично шагу 5 выше.

7.  Освободите объекты.

    Как и в случае с простым вариантом, объекты можно освободить сразу после их использования, но можно также изменить параметры позже.

    ```C++
    pac->Release();
    pom->Release();

    // Release each individual source.
    punkSource1->Release(); 
    punkSource2->Release();
    ```

    

 

 
