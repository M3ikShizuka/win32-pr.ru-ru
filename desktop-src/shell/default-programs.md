---
description: Используйте программы по умолчанию, чтобы задать пользовательский интерфейс по умолчанию.
ms.assetid: 78cd05a4-df33-42b5-91b9-826ebce04a1d
title: Программы по умолчанию
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5f8cd741794189e47888f4daa1d4585b2d8942cf
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127363168"
---
# <a name="default-programs"></a>Программы по умолчанию

Используйте **программы по умолчанию** , чтобы задать пользовательский интерфейс по умолчанию. Пользователи могут получить доступ к **программам по умолчанию** из панели управления или непосредственно из меню " **Пуск** ". [установка средства доступа к программам и параметров по умолчанию (SPAD)](cpl-setprogramaccess.md) . основные параметры по умолчанию для пользователей в Windows XP теперь являются частью **программ по умолчанию**.

> [!IMPORTANT]
> Этот раздел не относится к Windows 10. Способ изменения связей файлов по умолчанию в Windows 10. дополнительные сведения см. в разделе об **изменениях Windows 10 обработки приложений по умолчанию** в [этой записи](https://blogs.windows.com/windowsexperience/2015/05/20/announcing-windows-10-insider-preview-build-10122-for-pcs/).

 

Когда пользователь устанавливает параметры программы по умолчанию при помощи **программ по умолчанию**, параметр по умолчанию применяется только к этому пользователю, а не к другим пользователям, которые могут использовать тот же компьютер. **программы по умолчанию** предоставляют набор api-интерфейсов (не рекомендуется в Windows 8), которые позволяют независимым поставщикам программного обеспечения включать свои программы или приложения в систему по умолчанию. Набор API также помогает поставщикам программного обеспечения лучше управлять своим состоянием по умолчанию.

Этот раздел организован следующим образом:

-   [Общие сведения о программах по умолчанию и связанном наборе API](#introduction-to-default-programs-and-its-related-api-set)
-   [Регистрация приложения для использования с программами по умолчанию](#registering-an-application-for-use-with-default-programs)
    -   [Идентификаторы ProgID](#progids)
    -   [Описание подраздела и значения регистрации](#registration-subkey-and-value-descriptions)
    -   [регистередаппликатионс](#registeredapplications)
    -   [Пример полной регистрации](#full-registration-example)
-   [Становится браузером по умолчанию](#becoming-the-default-browser)
-   [Пользовательский интерфейс программ по умолчанию](#default-programs-ui)
-   [Рекомендации по использованию программ по умолчанию](#best-practices-for-using-default-programs)
    -   [Во время установки](#during-installation)
    -   [После установки](#after-installation)
-   [Дополнительные ресурсы](#additional-resources)
-   [Связанные темы](#related-topics)

## <a name="introduction-to-default-programs-and-its-related-api-set"></a>Общие сведения о программах по умолчанию и связанном наборе API

**Программы по умолчанию** в основном предназначены для приложений, использующих стандартные типы файлов, такие как .mp3 или .jpg файлы или стандартные протоколы, такие как HTTP или mailto. Приложения, использующие собственные собственные протоколы и сопоставления файлов, обычно не используют функциональные возможности **программ по умолчанию** .

После регистрации приложения для работы с **программами по умолчанию** доступны следующие параметры и функциональные возможности с помощью набора API:

-   Восстановить все зарегистрированные значения по умолчанию для приложения. Нерекомендуемый для Windows 8.
-   Восстановление одного зарегистрированного значения по умолчанию для приложения. Нерекомендуемый для Windows 8.
-   Запрос владельца конкретного значения по умолчанию в одном вызове вместо поиска в реестре. Можно запросить значение по умолчанию для канонического глагола сопоставления файлов, протокола или меню **запуска** .
-   Запуск пользовательского интерфейса для конкретного приложения, в котором пользователь может задать индивидуальные значения по умолчанию.
-   Удалите все связи для каждого пользователя.

**Программы по умолчанию** также предоставляют пользовательский интерфейс, позволяющий зарегистрировать приложение, чтобы предоставить пользователю дополнительные сведения. Например, приложение с цифровой подписью может включать URL-адрес домашней страницы изготовителя.

использование соответствующего набора API может помочь в правильной работе приложения в функции контроля учетных записей (UAC), представленной в Windows Vista. Под контролем учетных записей администратор выводит систему в качестве обычного пользователя, поэтому администратор не может обычно выполнять запись в поддерево " **\_ локальный \_ компьютер" hKey** . Это ограничение является функцией безопасности, которая не позволяет процессу выступать в качестве администратора без ведома администратора.

Установка программы пользователем обычно выполняется в виде процесса с повышенными правами. Однако попытки приложения изменить поведение связи по умолчанию на уровне компьютера после установки не будут успешными. Вместо этого значения по умолчанию должны быть зарегистрированы на уровне отдельных пользователей, что не позволяет нескольким пользователям перезаписывать значения по умолчанию для других пользователей.

Иерархическая структура реестра для сопоставлений файлов и протоколов обеспечивает приоритет для параметров по умолчанию на уровне компьютера для каждого пользователя. Некоторые приложения включают в себя точки кода, которые временно расширяют свои права при утверждении значений по умолчанию, зарегистрированных на **\_ локальном \_ компьютере hKey**. Эти приложения могут столкнуться с непредвиденными результатами, если другое приложение уже зарегистрировано как значение по умолчанию для каждого пользователя. Использование **программ по умолчанию** предотвращает эту неоднозначность и гарантирует ожидаемые результаты на уровне отдельных пользователей.

## <a name="registering-an-application-for-use-with-default-programs"></a>Регистрация приложения для использования с программами по умолчанию

В этом разделе показаны подразделы и значения реестра, необходимые для регистрации приложения в **программах по умолчанию**. Он включает полный пример.

В этом разделе рассматриваются следующие вопросы.

-   [Идентификаторы ProgID](#progids)
-   [Описание подраздела и значения регистрации](#registration-subkey-and-value-descriptions)
-   [регистередаппликатионс](#registeredapplications)
-   [Пример полной регистрации](#full-registration-example)

**Программы по умолчанию** требуют, чтобы каждое приложение регистрировало явные сопоставления файлов, сопоставления MIME и протоколы, для которых приложение должно быть указано как возможное по умолчанию. Вы регистрируете связи с помощью следующих элементов реестра, которые подробно описаны далее в разделе [подраздел регистрации и описание значения](#registration-subkey-and-value-descriptions).

```
HKEY_LOCAL_MACHINE
   %ApplicationCapabilityPath%
      ApplicationDescription
      ApplicationName
      Hidden
      FileAssociations
         .file-extension1
         .file-extension2
         ...
         .file-extensionX
      MIMEAssociations
         MIME
      Startmenu
         StartmenuInternet
         Mail
      UrlAssociations
         url-scheme
   SOFTWARE
      RegisteredApplications
         Unique Application Name = %ApplicationCapabilityPath%
```

В следующем примере показаны записи реестра для вымышленного браузера Contoso, который называется WebBrowser:

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Contoso
         WebBrowser
            Capabilities
               ApplicationDescription = This award-winning Contoso browser is better than ever. Search the Internet and find exactly what you want in just seconds. Use integrated tabs and new phishing detectors to enhance your Internet experience.
               FileAssociations
                  .htm = ContosoHTML
                  .html = ContosoHTML
                  .shtml = ContosoHTML
                  .xht = ContosoHTML
                  .xhtml = ContosoHTML
               Startmenu
                  StartmenuInternet = Contoso.exe
               UrlAssociations
                  http = Contoso.Url.Http
                  https = Contoso.Url.Https
                  ftp = Contoso.Url.ftp
   SOFTWARE
      RegisteredApplications
         Contoso.WebBrowser.1.06 = SOFTWARE\Contoso\WebBrowser\Capabilities
```

### <a name="progids"></a>Идентификаторы ProgID

Приложение должно предоставить конкретный [идентификатор ProgID](fa-progids.md). Не забудьте включить все сведения, которые обычно записываются в общий подраздел по умолчанию для расширения. Например, вымышленный проигрыватель мультимедиа Litware содержит классы программного обеспечения файла **hKey \_ локального \_ компьютера** для конкретного приложения \\  \\  \\ **LitwarePlayer11.AssocFile.MP3** подраздела. Этот подраздел включает все сведения в универсальном подразделе по умолчанию **hKey Software \_ \_ Machine** \\  \\ **Classes** \\ **.mp3** и дополнительные сведения, которые требуется зарегистрировать в приложении. Это гарантирует, что если пользователь восстановит связь .mp3 с проигрывателем Litware, сведения о проигрывателе Litware не будут изменены и не будут перезаписаны другим приложением. (Перезапись может произойти, если подразделом по умолчанию является единственным источником этой информации.)

При сопоставлении ProgID с расширением или протоколом имени файла приложение может сопоставлять "один к одному" или "один ко многим". В примере Contoso Контосохтмл указывает на один идентификатор ProgID, предоставляющий сведения о ShellExecute для расширений .htm, .html, shtml, ксхт и XHTML. Поскольку для каждого протокола существует другой идентификатор ProgID, при использовании протоколов каждый протокол включает свою собственную строку выполнения.

Если тип MIME можно просмотреть в браузере, ProgID для типа MIME должен содержать подраздел **CLSID** , который использует идентификатор класса (CLSID) соответствующего приложения. Этот идентификатор CLSID используется в уточняющем запросе к идентификатору CLSID в базе данных MIME, который хранится в списке класс программного обеспечения для **\_ локального \_ компьютера hKey** \\  \\  \\  \\  \\ **тип содержимого** базы данных MIME. Если тип MIME не предназначен для просмотра в браузере, этот шаг можно опустить.

### <a name="registration-subkey-and-value-descriptions"></a>Описание подраздела и значения регистрации

В этом разделе описаны отдельные подразделы и значения реестра, используемые при регистрации приложения с **программами по умолчанию**, как показано выше.

### <a name="capabilities"></a>Возможности

Подраздел **возможностей** содержит все сведения о **программах по умолчанию** для конкретного приложения. Заполнитель% Аппликатионкапабилитипас% относится к пути реестра из раздела **hKey \_ текущий \_ пользователь** или **hKey \_ локальный \_ компьютер** к подразделу **возможностей** приложения. Этот подраздел содержит важные значения, показанные в следующей таблице.



| Значение                  | Тип                       | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ApplicationDescription | REG \_ SZ или REG \_ expand \_ SZ | **Обязательно**. Чтобы разрешить пользователю принимать информированное назначение по умолчанию, приложение должно предоставить строку, описывающую возможности приложения. Несмотря на то, что предыдущий пример Contoso присваивает описание непосредственно значению Аппликатиондескриптион, приложения обычно предоставляют описание как ресурс, внедренный в файл .dll для упрощения локализации. Если Аппликатиондескриптион не указан, приложение не отображается в списках пользовательского интерфейса потенциальных программ по умолчанию.                                                            |
| ApplicationName        | REG \_ SZ или REG \_ expand \_ SZ | **Необязательный элемент.** Имя, по которому программа отображается в пользовательском интерфейсе программы по умолчанию. Если эти данные не предоставляются приложением, имя исполняемой программы, связанной с первым зарегистрированным ProgID для приложения, используется в пользовательском интерфейсе. Имя ApplicationName должно всегда совпадать с именем, зарегистрированным в [регистередаппликатионс](#registeredapplications). Вы можете использовать ApplicationName, если хотите, чтобы различные типы приложений, например браузер и почтовый клиент, указывали на один и тот же исполняемый файл, когда они отображаются с разными именами.<br/> |
| Скрытый                 | REG \_ DWORD                 | **Необязательный элемент.** Установите значение 1, чтобы отключить приложение из списка программ диалогового окна **Настройка программ по умолчанию** . Если это значение равно 0 или отсутствует, приложение отображается в списке в обычном режиме.                                                                                                                                                                                                                                                                                                                                                              |



 

### <a name="fileassociations"></a>филеассоЦиатионс

Подраздел **филеассоЦиатионс** содержит определенные сопоставления файлов, затребованные приложением. Эти утверждения хранятся в виде значений с одним значением для каждого расширения. Ассоциации указывают на ProgID конкретного приложения вместо универсального ProgID. Однако все ассоциации не обязательно должны указывать на один и тот же идентификатор ProgID.

### <a name="mimeassociations"></a>мимеассоЦиатионс

Подраздел **мимеассоЦиатионс** содержит определенные типы MIME, затребованные приложением. Эти утверждения хранятся в виде значений с одним значением для каждого типа MIME. Имя значения для каждого типа MIME должно точно совпадать с именем MIME, хранящимся в базе данных MIME. Этому значению также необходимо назначить идентификатор ProgID для конкретного приложения, который содержит соответствующий идентификатор CLSID приложения.

### <a name="startmenu"></a>Связывается

Подраздел **связывается** связан с назначенными пользователем записями **Интернета** и **электронной почты** в меню " **Пуск** ". Приложение должно быть зарегистрировано отдельно в качестве средства для этих записей. Дополнительные сведения см. в разделе [Регистрация программ с помощью типов клиентов](reg-middleware-apps.md).

> [!Note]  
> начиная с Windows 7, в меню " **пуск** " больше нет записей **интернета** и **электронной почты** . данные реестра, связанные с записью **электронной почты** , по-прежнему используются для клиента MAPI по умолчанию, но данные реестра, связанные с записью в **интернете** , не используются Windows.

 

Связав регистрацию меню " **Пуск** " приложения с регистрацией **программ по умолчанию** , приложение отображается как потенциальное значение по умолчанию в пользовательском интерфейсе " **сопоставление наборов** ". Если пользователь выбрал приложение в качестве значения по умолчанию и затем восстановит все значения по умолчанию для всех приложений позже, приложение будет восстановлено до своего расположения в меню " **Пуск** " для этого пользователя. Дополнительные сведения и иллюстрация см. в разделе [Пользовательский интерфейс программ по умолчанию](#default-programs-ui) далее в этом разделе.

Подраздел **связывается** содержит две записи: Стартменуинтернет и Mail, которые соответствуют каноническим положениям **Интернета** и **электронной почты** в меню " **Пуск** ". Приложению назначается значение стартменуинтернет или mail, равное имени зарегистрированного подраздела приложения в разделе **hKey \_ Local \_ Machine** \\ **Software** \\ **Clients** \\ **стартменуинтернет** или **hKey Software \_ \_ Machine** Client \\ **по** \\  \\ **mail** (как описано в разделе [Регистрация программ с типами клиентов](reg-middleware-apps.md)).

В случае канонического расположения **сообщения электронной почты** в меню " **Пуск** " оно представляет собой клиент MAPI по умолчанию и, таким образом, ПРЕДПОЛАГАЕТ возможность передачи вызовов MAPI. в Windows 7, в то время как в меню " **пуск** " больше не существует принятого **по электронной почте** места, этот подраздел будет использоваться для клиента MAPI по умолчанию. Приложение, которое запросит значение по умолчанию для почты, должно быть зарегистрировано как обработчик MAPI в следующем подразделе:

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Clients
         Mail
            CanonicalName
```

Если почтовый клиент не поддерживает MAPI, но по-прежнему хочет конкурировать за каноническое расположение **электронной почты** в меню " **Пуск** ", он может зарегистрировать командную строку в следующем подразделе:

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Clients
         Mail
            CanonicalName
               shell
                  open
                     command
```

Кроме того, в разделе **hKey \_ Local \_ Machine** \\ **Software** \\ **Clients** \\ **mail** \\ *каноникалнаме* добавьте значение по умолчанию с именем приложения.

Эти записи позволяют запускать приложение из расположения **электронной почты** в меню " **Пуск** ". Обратите внимание, что вызовы MAPI по-прежнему выполняются в приложении и либо переходят к предыдущему обработчику MAPI, либо завершаются ошибкой, если не задан обработчик MAPI. Дополнительные сведения см. в разделе [Регистрация программ с помощью типов клиентов](reg-middleware-apps.md).

### <a name="urlassociations"></a>урлассоЦиатионс

Подраздел **урлассоЦиатионс** содержит конкретные протоколы URL-адресов, затребованные приложением. Эти утверждения хранятся в виде значений, по одному значению для каждого протокола. Каждый протокол должен указывать на ProgID, зависящий от приложения, а не на универсальный идентификатор ProgID. Как упоминалось в примере Contoso, можно использовать другой идентификатор ProgID для каждого протокола, чтобы каждый из них имел собственную строку выполнения.

### <a name="registeredapplications"></a>регистередаппликатионс

Полный подраздел для **регистередаппликатионс** :

**HKey \_ \_** \\ **Программное обеспечение** локального компьютера \\ **регистередаппликатионс**

Этот подраздел содержит операционную систему, в которой в реестре содержатся сведения о **программах по умолчанию** для приложения. Расположение хранится в виде значения, имя которого должно совпадать с именем приложения.

### <a name="full-registration-example"></a>Пример полной регистрации

В этом примере показаны подразделы и значения, используемые при регистрации вымышленного проигрывателя Litware мультимедиа. Пример включает записи ProgID для того, чтобы продемонстрировать, как все они объединяются.

В следующем подразделе показан идентификатор ProgID для конкретного приложения для .mp3 типа MIME:

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Classes
         LitwarePlayer11.MIME.MP3
            CLSID
               (Default) = {CD3AFA76-B84F-48F0-9393-7EDC34128127}
```

Далее следует зависящий от приложения идентификатор ProgID, связывающий программу Litware с расширением имени файла .mp3.

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Classes
         LitwarePlayer11.AssocFile.MP3
            (Default) = MP3 Format Sound
            DefaultIcon
               (Default) = %ProgramFiles%\Litware\litware.dll, 0
            shell
               open
                  command
                     (Default) = %ProgramFiles%\Litware\litware.exe
```

Следующие записи показывают Объединенный ProgID для .mpeg типа MIME и расширения имени файла.

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Classes
         LitwarePlayer11.AssocFile.MPG
            (Default) = Movie Clip
            CLSID
               (Default) = {D92B76F4-CFA0-4b93-866B-7730FEB4CD7B}
            DefaultIcon
               (Default) = %ProgramFiles%\Litware\litware.dll, 0
            shell
               open
                  command
                     (Default) = %ProgramFiles%\Litware\litware.exe
```

Следующие записи регистрируют программу Litware в **программах по умолчанию** и используют ранее зарегистрированные идентификаторы ProgID.

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      Litware
         LitwarePlayer
            Capabilities
               ApplicationDescription = The new Litware Media Player breaks new ground in exciting fictional programs.
               FileAssociations
                  .mp3 = LitwarePlayer11.AssocFile.MP3
                  .mpeg = LitwarePlayer11.AssocFile.MPG
               MimeAssociations
                  audio/mp3 = LitwarePlayer11.MIME.MP3
                  audio/mpeg = LitwarePlayer11.AssocFile.MPG
```

Наконец, в этом примере регистрируется расположение регистрации программ Litware **по умолчанию** .

```
HKEY_LOCAL_MACHINE
   SOFTWARE
      RegisteredApplications
         Litware Player = Software\Litware\LitwarePlayer\Capabilities
```

## <a name="becoming-the-default-browser"></a>Становится браузером по умолчанию

Регистрация в браузере должна соответствовать рекомендациям, описанным в этом разделе. после установки браузера Windows может предоставить пользователю системное уведомление, в котором пользователь может выбрать браузер в качестве системы по умолчанию. Это уведомление отображается при соблюдении следующих условий:

-   установщик браузера вызывает [**шчанженотифи**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shchangenotify) с флагом **шкне \_ ассокчанжед** , чтобы сообщить Windows о том, что были зарегистрированы новые обработчики протокола.
-   Windows обнаруживает, что одно или несколько новых приложений зарегистрированы для поддержки протоколов http://и https://, и пользователь еще не уведомлен. Иными словами, ни один из следующих элементов не отображается для пользователя: Системное уведомление, содержащее приложение, всплывающее окно Опенвис с приложением или страница панели управления Настройка пользовательских значений по умолчанию (суд) для приложения.

В следующем примере показан рекомендуемый код регистрации, который установщик браузера должен запустить после записи разделов реестра.

[**Шчанженотифи**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shchangenotify) сначала уведомляет систему о том, что доступны новые варианты связи. Вызов **шчанженотифи** необходим для обеспечения правильной работы системных параметров по умолчанию.

Затем инструкция [**Sleep**](/windows/win32/api/synchapi/nf-synchapi-sleep) позволяет системным процессам обрабатывать уведомления.


```C++
void NotifySystemOfNewRegistration()
{
    SHChangeNotify(SHCNE_ASSOCCHANGED, SHCNF_DWORD | SHCNF_FLUSH, nullptr, nullptr);
    Sleep(1000);
}
```



Если пользователь отменяет или игнорирует полученное уведомление или всплывающее окно без выбора нового браузера по умолчанию, браузер по умолчанию остается неизменным. Обратите внимание, что пользователь также может изменить браузер по умолчанию в любое время с помощью других механизмов, включая установку параметров пользователя по умолчанию на панели управления.

## <a name="default-programs-ui"></a>Пользовательский интерфейс программ по умолчанию

На иллюстрациях в этом разделе показан пользовательский интерфейс для **программ по умолчанию** , видимый пользователю.

На следующем рисунке показано окно основные **программы по умолчанию** в панели управления.

![снимок экрана со страницей записи программ по умолчанию](images/defaultprogramsmain.png)

Когда пользователь выбирает параметр **задать программы по умолчанию** , появляется следующее окно. Пользователи могут использовать эту страницу для назначения программы по умолчанию для всех типов файлов и протоколов, для которых программа является возможной по умолчанию. Как показано на следующем рисунке, все [зарегистрированные](#registering-an-application-for-use-with-default-programs) программы и значок программы отображаются в окне **программы** слева.

![снимок экрана со страницей "Установка программ по умолчанию"](images/setyourdefaultprograms.png)

Когда пользователь выбирает программу из списка, отображаются значок программы и поставщик. Если URL-адрес внедрен в сертификат программы с цифровой подписью, программа также может отобразить URL-адрес. Программы, не имеющие цифровой подписи, не могут отображать URL-адрес.

Также отображается описательный текст, который предоставляется программой во время регистрации. Этот текст является обязательным. Под полем Описание можно определить, сколько значений по умолчанию в настоящий момент назначено программе в полном количестве, зарегистрированном для работы.

Чтобы назначить или восстановить программу по умолчанию для всех файлов и протоколов, для которых она зарегистрирована, пользователь нажимает кнопку **установить эту программу в качестве параметра по умолчанию** .

Чтобы назначить программе отдельные типы файлов и протоколы, пользователь нажимает кнопку **выбрать значения по умолчанию для этой программы** , которая отображает **набор ассоциаций для окна программы** , как показано на следующем рисунке.

> [!Note]  
> Мы рекомендуем вызывать **связи Set для программы** с помощью [**ИаппликатионассоЦиатионрегистратионуи:: лаунчадванцедассоЦиатионуи**](/windows/desktop/api/Shobjidl/nf-shobjidl-iapplicationassociationregistrationui-launchadvancedassociationui).

 

![снимок экрана со страницей "Задание сопоставлений" для программы](images/setassociationsforaprogram.png)

## <a name="best-practices-for-using-default-programs"></a>Рекомендации по использованию программ по умолчанию

В этом разделе приводятся рекомендации по использованию **программ по умолчанию** при регистрации приложений. Он также предлагает предложения по проектированию для создания приложения, предоставляющего пользователям оптимальную функциональность **программ по умолчанию** .

### <a name="during-installation"></a>Во время установки

в дополнение к обычным процедурам установки в Windows XP, приложение на базе Windows Vista или более поздней версии должно зарегистрироваться в компоненте **программы по умолчанию** , чтобы воспользоваться преимуществами его функциональных возможностей.

Выполните следующую последовательность действий во время установки. шаги 1-3 соответствуют действиям, которые использовались в Windows XP; шаг 4 был впервые добавлен в Windows Vista.

1.  Установите необходимые двоичные файлы.
2.  Запись идентификаторов ProgID на \_ локальный \_ компьютер hKey. Обратите внимание, что приложения должны создавать идентификаторы ProgID для конкретных приложений для своих взаимосвязей.
3.  Зарегистрируйте приложение в **программах по умолчанию** , как описано выше в статьи [Регистрация приложения для использования с программами по умолчанию](#registering-an-application-for-use-with-default-programs).

### <a name="after-installation"></a>После установки

В этом разделе описывается, как запрос приложения должен сначала предоставить каждому пользователю параметры по умолчанию. В нем также обсуждается, как приложение может отслеживать состояние по умолчанию для возможных связей и протоколов.

### <a name="first-run-experiences"></a>Интерфейсы первого запуска

При первом запуске приложения пользователем рекомендуется, чтобы в приложении отображался пользовательский интерфейс, который обычно включает следующие два варианта:

-   Примите параметры приложения по умолчанию. Этот параметр установлен по умолчанию.
-   Настройка параметров приложения по умолчанию.

до Windows 8, если пользователь принимает параметры по умолчанию, приложение вызывает [**иаппликатионассоЦиатионрегистратион:: сетаппасдефаулталл**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-iapplicationassociationregistration-setappasdefaultall), которое преобразует все ассоциации уровня компьютера, объявленные во время установки, в параметры для каждого пользователя.

Если пользователь решает настроить параметры, приложение вызывает [**иаппликатионассоЦиатионрегистратионуи:: лаунчадванцедассоЦиатионуи**](/windows/desktop/api/Shobjidl/nf-shobjidl-iapplicationassociationregistrationui-launchadvancedassociationui) , чтобы отобразить пользовательский интерфейс сопоставления файлов. На следующем рисунке показано это окно для вымышленного проигрывателя Litware мультимедиа.

![снимок экрана "Задание сопоставлений для страницы программы для Litware"](images/setassociationsforaprogramforlitware.png)

В окне Сопоставление файлов отображаются значения по умолчанию, зарегистрированные приложением, а также текущее значение по умолчанию для других расширений и протоколов. После того как пользователь закончит настройку значений по умолчанию, они нажимайте кнопку **сохранить** для фиксации изменений. Если пользователь нажимает кнопку **Отмена**, окно закрывается без сохранения изменений.

Этот пользовательский интерфейс следует использовать для приложений вместо создания собственных. Это позволит сохранить ресурсы, которые ранее были необходимы для разработки пользовательского интерфейса сопоставления файлов. Также гарантируется, что связи будут сохранены правильно.

### <a name="set-an-application-to-check-whether-it-is-the-default"></a>Настройка приложения для проверки того, является ли оно значением по умолчанию

> [!Note]  
> Это больше не поддерживается в Windows 8.

 

Обычно приложения проверяют, заданы ли они по умолчанию при запуске. Настройте приложения для выполнения этой проверки, вызвав [**иаппликатионассоЦиатионрегистратион:: куеряпписдефаулт**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-iapplicationassociationregistration-queryappisdefault) или [**ИаппликатионассоЦиатионрегистратион:: QueryAppIsDefaultAll**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-iapplicationassociationregistration-queryappisdefaultall).

Если приложение определяет, что оно не является значением по умолчанию, оно может представлять пользовательский интерфейс, запрашивающий пользователя, следует ли принять текущую ситуацию или сделать приложение используемым по умолчанию. Всегда включайте в этот пользовательский интерфейс флажок, который выбирается по умолчанию и предоставляет возможность не запрашивать снова.

> [!Note]  
> Вариант по умолчанию должен быть управляемым пользователем. Приложение не должно восстанавливаться по умолчанию без запроса пользователя.

 

На следующем рисунке показан пример диалогового окна.

![снимок экрана с примером диалогового окна](images/notthedefaultui.png)

## <a name="additional-resources"></a>Дополнительные ресурсы

-   [**иаппликатионассоЦиатионрегистратион**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-iapplicationassociationregistration)
-   [**иаппликатионассоЦиатионрегистратионуи**](/windows/desktop/api/Shobjidl/nn-shobjidl-iapplicationassociationregistrationui)

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Рекомендации по сопоставлению файлов](fa-best-practices.md)
</dt> <dt>

[Пример сценария сопоставления файлов](fa-sample-scenarios.md)
</dt> <dt>

[рекомендации по управлению приложениями по умолчанию в Windows Vista и более поздних версий](vista-managing-defaults.md)
</dt> <dt>

[Настройка доступа к программе и параметров по умолчанию для компьютера (SPAD)](cpl-setprogramaccess.md)
</dt> </dl>

 

 
