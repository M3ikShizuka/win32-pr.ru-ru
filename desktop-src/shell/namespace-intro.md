---
description: Сведения о пространстве имен оболочки и его объектах источника данных. это пространство имен предлагает варианты расширения в пользовательском интерфейсе оболочки Windows.
ms.assetid: 539c4455-e1c7-45a0-b3c3-781f2b7a1617
title: Введение в пространство имен оболочки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c758f95934e70abdb525547fda3940cd75ebc9b455fbca2cfdbd38ff962c3b0b
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118219904"
---
# <a name="introduction-to-the-shell-namespace"></a>Введение в пространство имен оболочки

*Пространство имен* Shell организует файловую систему и другие объекты, управляемые оболочкой, в одну иерархию, структурированную по дереву. По сути, это более обширная и более широкая версия файловой системы.

-   [Введение](#introduction)
-   [Определение объектов пространства имен](#identifying-namespace-objects)
    -   [Идентификаторы элементов](#item-ids)
    -   [Списки ИДЕНТИФИКАТОРов элементов](#item-id-lists)
    -   [PIDL](#pidls)
    -   [Выделение PIDL](#allocating-pidls)

## <a name="introduction"></a>Введение

Одной из основных обязанностей оболочки является управление и предоставление доступа к широкому спектру объектов, составляющих систему. Самыми многочисленными и знакомыми этими объектами являются папки и файлы, расположенные на дисках компьютера. Однако оболочка управляет несколькими нефайловой системой или *виртуальными* объектами. Некоторые примеры:

-   Сетевые принтеры
-   Другие компьютеры, подключенные к сети
-   Приложения панели управления
-   Корзина

Некоторые виртуальные объекты вообще не используют физическое хранилище. Объект Printer, например, содержит коллекцию ссылок на сетевые принтеры. Другие виртуальные объекты, например корзина, могут содержать данные, хранящиеся на диске, но должны обрабатываться иначе, чем обычные файлы. Например, виртуальный объект может использоваться для представления данных, хранящихся в базе данных. с точки зрения пространства имен различные элементы в базе данных могут отображаться в Windows Explorer в виде отдельных объектов, даже если они хранятся в одном файле на диске.

Виртуальные объекты могут даже находиться на удаленных компьютерах. Например, чтобы упростить роуминг, файлы документов пользователя могут храниться на сервере. Чтобы предоставить пользователям доступ к своим файлам с нескольких настольных ПК, папка «Мои документы» на настольном компьютере, которую они используют в данный момент, будет указывать на сервер, а не на жесткий диск настольного ПК. Его путь будет содержать сопоставленный сетевой диск или UNC-путь.

Как и в файловой системе, пространство имен включает два основных типа объектов: папки и файлы. Объекты папки — это *узлы* дерева; они представляют собой контейнеры для файловых объектов и других папок. Объекты файлов — это *листья* дерева; Это обычные файлы или виртуальные объекты, например ссылки на принтеры. Папки, которые не являются частью файловой системы, иногда называют *виртуальными папками*.

Как и папки файловой системы, коллекция виртуальных папок обычно отличается от системы к системе. Существует три класса виртуальных папок:

-   Стандартные виртуальные папки, например корзина, которые находятся во всех системах.
-   Необязательные виртуальные папки со стандартными именами и функциональностью, но могут отсутствовать во всех системах.
-   Нестандартные папки, установленные пользователем.

В отличие от папок файловой системы, пользователи не могут самостоятельно создавать новые виртуальные папки. Они могут устанавливать только те, которые были созданы разработчиками сторонних разработчиков. Таким образом, количество виртуальных папок, как правило, намного меньше числа папок файловой системы. Обсуждение реализации виртуальных папок см. в разделе [расширения пространств имен](nse-works.md).

визуальное представление структуры пространства имен можно увидеть на панели обозревателя обозревателя Windows. например, на следующем снимке экрана Windows Explorer отображается относительно простое пространство имен.

![представление пространства имен оболочки](images/prog1.png)

В качестве конечного корня иерархии пространства имен используется рабочий стол. Непосредственно под корнем находится несколько виртуальных папок, таких как Мой компьютер и корзина.

Файловые системы различных дисков могут рассматриваться как подмножества более крупной иерархии пространства имен. Корни этих файловых систем являются вложенными папками папки Мой компьютер. Мой компьютер также включает корни всех подключенных сетевых дисков. Другие узлы в дереве, например "Мои документы", являются виртуальными папками.

## <a name="identifying-namespace-objects"></a>Определение объектов пространства имен

Прежде чем использовать объект пространства имен, необходимо сначала идентифицировать его. Объект в файловой системе может иметь такое же имя, как MyFile.htm. Поскольку могут существовать другие файлы с таким именем в другом расположении в системе, для уникальной идентификации файла или папки требуется полный путь, например "C: \\ MyDocs \\MyFile.htm". Этот путь представляет собой упорядоченный список всех папок в пути из корневой файловой системы C: \\ , заканчивая файлом.

В контексте пространства имен пути по-прежнему весьма полезны для идентификации объектов, расположенных в части файловой системы пространства имен. Однако их нельзя использовать для виртуальных объектов. Вместо этого оболочка предоставляет альтернативные средства идентификации, которые можно использовать с любым объектом пространства имен.

### <a name="item-ids"></a>Идентификаторы элементов

В папке каждый объект имеет *идентификатор элемента*, который является функциональным аналогом имени файла или папки. Идентификатор элемента фактически является структурой [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) :


```
typedef struct _SHITEMID { 
    USHORT cb; 
    BYTE   abID[1]; 
} SHITEMID, * LPSHITEMID; 
```



Элемент **Абид** является идентификатором объекта. Длина **Абид** не определена, а ее значение определяется папкой, содержащей объект. Поскольку нет стандартного определения того, как значения **Абид** назначаются папками, они имеют смысл только для связанного объекта Folder. Приложения должны просто обрабатывать их как маркер, идентифицирующий объект в определенной папке. Так как длина **Абид** варьируется, член **CB** содержит размер структуры [**шитемид**](/windows/desktop/api/Shtypes/ns-shtypes-shitemid) в байтах.

Поскольку идентификаторы элементов не полезны для показа, папка, содержащая объект, обычно назначает ему отображаемое имя. это имя, которое используется обозревателем Windows Explorer при отображении содержимого папки. Дополнительные сведения о том, как обрабатываются отображаемые имена, см. в разделе [Получение сведений из папки](folder-info.md).

### <a name="item-id-lists"></a>Списки ИДЕНТИФИКАТОРов элементов

Идентификатор элемента редко используется самим собой. Как правило, он является частью списка ИДЕНТИФИКАТОРов элементов, который служит той же цели, что и путь файловой системы. Однако вместо символьной строки, используемой для путей, список ИДЕНТИФИКАТОРов элементов является структурой [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) . Эта структура представляет собой упорядоченную последовательность из одного или нескольких идентификаторов элементов, заканчивающаяся двухбайтовым **значением NULL**. Идентификатор каждого элемента в списке ИДЕНТИФИКАТОРов элементов соответствует объекту пространства имен. Их порядок определяет путь в пространстве имен, во многом подобно пути файловой системы.

На следующем рисунке показано схематическое представление структуры [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) , которое соответствует C: \\ MyDocs \\MyFile.htm. Отображаемое имя каждого идентификатора элемента отображается над ним. Различные ширины элементов **Абид** являются произвольными. Они иллюстрируют тот факт, что размер этого элемента может быть разным.

![Схематическое изображение Пидл](images/shell2.png)

### <a name="pidls"></a>PIDL

Для API оболочки объекты пространства имен обычно обозначаются указателем на структуру [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) или указателем на список идентификаторов элементов (Пидл). Для удобства термин ПИДЛ обычно будет ссылаться на саму структуру, а не на ее указатель.

ПИДЛ, показанный на предыдущем рисунке, называется *полным* или *абсолютным* Пидл. Полный ПИДЛ начинается с рабочего стола и содержит идентификаторы элементов всех промежуточных папок в пути. Он заканчивается ИДЕНТИФИКАТОРом элемента объекта, за которым следует завершающее двухбайтовый **значение NULL**. Полный ПИДЛ аналогичен полному пути и уникально идентифицирует объект в пространстве имен оболочки.

Полные PIDL используются редко. Многие функции и методы предполагают *относительную Пидл*. Корень относительных ПИДЛ является папкой, а не настольной. Как и в случае с относительными путями, последовательность идентификаторов элементов, составляющих структуру, определяет путь в пространстве имен между двумя объектами. Хотя они не уникально идентифицируют объект, они обычно меньше, чем полный ПИДЛ и достаточно для многих целей.

Наиболее часто используемые относительные PIDL, *одноуровневые PIDL*, относятся к родительской папке объекта. Они содержат только идентификатор элемента объекта и завершающее **значение NULL**. Многоуровневые PIDL также используются во многих целях. Они содержат два или более идентификатора элементов и обычно определяют путь от родительской папки к объекту через ряд из одной или нескольких вложенных папок. Обратите внимание, что одноуровневое ПИДЛ по-прежнему может быть полным ПИДЛ. В частности, объекты настольных компьютеров являются дочерними элементами рабочего стола, поэтому их полные PIDL содержат только один идентификатор элемента.

Как описано в разделе [Получение идентификатора папки](folder-id.md), API оболочки предоставляет несколько способов извлечения Пидл объекта. После этого вы обычно используете его для определения объекта при вызове других функций и методов API оболочки. В этом контексте внутреннее содержимое ПИДЛ является непрозрачным и несущественным. В рамках этого обсуждения PIDL в качестве маркеров, представляющих определенные объекты пространства имен, и сосредоточьтесь на том, как их использовать для выполнения стандартных задач.

### <a name="allocating-pidls"></a>Выделение PIDL

Несмотря на то, что PIDL имеет некоторую сходство с путями, их использование требует немного другого подхода. Основное различие заключается в том, как выделить и освободить память для них.

Как и строка, используемая для пути, память должна выделяться для ПИДЛ. Если приложение создает ПИДЛ, оно должно выделить достаточно памяти для структуры [**итемидлист**](/windows/desktop/api/Shtypes/ns-shtypes-itemidlist) . В большинстве случаев, описанных здесь, оболочка создает ПИДЛ и обрабатывает выделение памяти. Независимо от того, что выделило ПИДЛ, приложение обычно отвечает за отмену выделения ПИДЛ, когда оно больше не требуется.

Используйте функцию [**CoTaskMemAlloc**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemalloc) для выделения Пидл, а функцию [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree) — для ее освобождения.

 

 
