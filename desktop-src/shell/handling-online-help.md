---
description: Справка в Интернете может находиться в различных формах, от подробной концептуальной информации до быстрых определений. В этом разделе содержатся следующие подразделы.
title: Обработка справки в Интернете
ms.topic: article
ms.date: 05/31/2018
ms.assetid: 2a3f6034-6ba6-4204-a2e1-59995fbf40fe
api_name: ''
api_type: ''
api_location: ''
topic_type:
- kbArticle
ms.openlocfilehash: caf576d723b27e1c81bb715ea04743740930b5bb257f03eb3ca0a9ab697affd1
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118223686"
---
# <a name="handling-online-help"></a>Обработка справки в Интернете

Справка в Интернете может находиться в различных формах, от подробной концептуальной информации до быстрых определений. В этом разделе содержатся следующие подразделы.

-   [Сведения о справке](#about-help)
    -   [Запросы справки](#help-requests)
    -   [справка по отображению справки и Windows](#help-display-and-windows-help)
-   [Использование справки](#using-help)
    -   [Предоставление справки в диалоговом окне](#providing-help-in-a-dialog-box)
    -   [Настройка внешнего вида дополнительного окна справки](#setting-the-appearance-of-a-secondary-help-window)

## <a name="about-help"></a>Сведения о справке

Важный элемент ориентированного на пользователя приложения можно легко получить в интерактивной справке. Windows предоставляет функции и сообщения, которые при использовании в сочетании с приложением справки Windows упрощают реализацию интерактивной справки в приложении. в этом обзоре обсуждаются элементы Windows, которые поддерживают справку в интернете. в нем описывается использование этих элементов для предоставления пользователям средств для запроса справки, а также объясняется, как использовать Windows справочное приложение для отображения справки.

### <a name="help-requests"></a>Запросы справки

большинство приложений на основе Windows предоставляют справочную информацию в различных формах, начиная от концептуальной справки, которая объясняет назначение функций приложения всплывающей справке, которая предоставляет быстрые определения отдельных элементов в пользовательском интерфейсе приложения. Функции и сообщения используются для предоставления пользователям различных способов запроса доступа к этой информации. В следующих разделах описываются эти запросы на помощь.

### <a name="help-menu"></a>Меню "Справка"

Большинство приложений предоставляют пользователям доступ к справочной информации, включая меню **справки** в главном окне. Когда пользователь выбирает элемент из меню **справки** , соответствующая процедура окна получает сообщение [**\_ командной строки WM**](../menurc/wm-command.md) , идентифицирующее выбранный элемент. Приложение отвечает, отображая соответствующую справочную информацию, например список разделов справки, индекс или введение в приложение.

### <a name="help-from-the-keyboard"></a>Справка с клавиатуры

Windows предоставляет пользователю доступ к справочной информации с клавиатуры, уведомляя приложение каждый раз, когда пользователь нажимает клавишу F1. Система отправляет [**\_ справочное сообщение WM**](wm-help.md) в окно с фокусом клавиатуры при нажатии пользователем клавиши. Если окно является дочерним окном (например, элементом управления в диалоговом окне), функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) передает сообщение родительскому окну. Если меню активно при нажатии клавиши F1, система отправляет сообщение в окно, связанное с меню. Приложение отвечает, отображая справочные сведения, связанные с окном, элементом управления или меню, имеющим фокус или активным. Например, если пользователь выбирает элемент управления в диалоговом окне и нажимает клавишу F1, приложение отображает справочные сведения для этого элемента управления.

Параметр *lParam* [**\_ справки WM**](wm-help.md) — это указатель на структуру [**HELPINFO**](/windows/win32/api/winuser/ns-winuser-helpinfo) , содержащую подробные сведения об элементе, для которого запрашивается справка. Эти сведения используются для определения отображаемого раздела справки. Структура **HELPINFO** также включает координаты курсора мыши во время нажатия пользователем клавиши. Эти сведения можно использовать для предоставления справки в зависимости от положения курсора мыши.

### <a name="help-from-the-mouse"></a>Помощь от мыши

Windows предоставляет пользователю доступ к справочной информации от мыши, уведомляя приложение каждый раз, когда пользователь нажимает правую кнопку мыши или щелкает окно, элемент управления или меню после нажатия кнопки вопроса (?). Приложение отвечает, отображая справочную информацию, связанную с данным окном, элементом управления или меню.

Система отправляет сообщение [**WM \_ CONTEXTMENU**](../menurc/wm-contextmenu.md) , когда пользователь нажимает правую кнопку мыши. Окно, которое было выбрано, получает сообщение. Если окно является дочерним окном, например элементом управления, функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) передает сообщение родительскому окну. Сообщение **WM \_ CONTEXTMENU** указывает координаты курсора мыши. Координата x находится в младшем слове параметра *lParam* , а координата y — в слове высокого порядка. Если пользователь щелкнул элемент управления, параметр *wParam* является маркером элемента управления, получившего щелчок.

Система отправляет сообщение [**\_ справки WM**](wm-help.md) , когда пользователь щелкает элемент в окне после нажатия кнопки вопроса (?), которая отображается в строке заголовка окна. Можно добавить кнопку вопроса в строку заголовка, указав стиль **WS \_ ex \_ Контексселп** в функции [**CreateWindowEx**](/windows/win32/api/winuser/nf-winuser-createwindowexa) при создании окна. Параметр *lParam* **\_ справки WM** является указателем на структуру [**HELPINFO**](/windows/win32/api/winuser/ns-winuser-helpinfo) , которая содержит подробные сведения об элементе, для которого запрашивается справка, включая координаты курсора мыши во время нажатия пользователем кнопки мыши.

Кнопка вопроса рекомендуется для использования только в диалоговых окнах. В прошлом приложения предоставили пользователю доступ к справочной информации о диалоговом окне, выполнив в диалоговом окне кнопку « **Справка** ». Этот метод больше не рекомендуется. Вместо нее используйте кнопку "вопрос".

### <a name="help-display-and-windows-help"></a>справка по отображению справки и Windows

Когда приложение получает запрос на получение справки, оно должно отобразить соответствующую справочную информацию. так как приложение справки Windows предоставляет единообразный пользовательский интерфейс, рекомендуется, чтобы приложения использовали Windows справку, а не другие методы. чтобы направить Windows справку по отображению справочной информации, приложение использует функцию [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) , указывая такие сведения, как отображаемые сведения, и форму окна, в котором она отображается. В следующих разделах объясняется, как использовать **WinHelp** для отображения справочных сведений.

### <a name="help-files"></a>файлы справки

Для просмотра справочных сведений необходимо указать файл справки при вызове функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) . файл справки должен иметь формат файла справки Windows (. hlp) и один или несколько разделов. Каждый раздел представляет собой отдельную единицу информации, например концептуальное описание, набор инструкций, рисунок, Определение глоссария и т. д. темы должны быть однозначно идентифицированы, чтобы Windows могли найти их при запросе. на внутреннем уровне Windows справку использует идентификаторы разделов для назначений разделов, но в приложениях чаще всего используются идентификаторы контекста (уникальные целочисленные значения) для указания разделов для вывода. Автор файла справки должен явным образом сопоставлять идентификаторы контекста с идентификаторами разделов в \[ разделе Map \] файла проекта, который используется для построения файла справки.

Если указан файл справки, но путь не указан, [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) ищет файл справки в каталоге справки или в каталоге, указанном переменной среды PATH. Кроме того, **WinHelp** может найти файл справки, имя которого указано в следующем расположении реестра:

```
HKEY_LOCAL_MACHINE
   Software
      Microsoft
         Windows
            Help
```

Чтобы воспользоваться преимуществами реестра, необходимо создать имя значения, имя которого совпадает с именем файла справки. Значение, присваиваемое этому имени, должно быть каталогом, в котором находится файл справки.

Если [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) не удается найти указанный файл справки, отображается диалоговое окно, позволяющее пользователю указать расположение файла справки. Так как **WinHelp** сохраняет сведения о расположении в реестре, он больше не будет спрашивать о расположении того же файла справки.

Дополнительные сведения о создании и сборке файла справки см. в документации, поставляемой со средствами разработки.

### <a name="starting-windows-help"></a>запуск Windows справки

в следующем примере функция [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) используется для запуска приложения Windows help и открытия файла справки в его содержимом.


```
HWND hwnd;     // main window handle 
BOOL bResult   // for checking Boolean function result 

bResult = WinHelp(hWnd, "WINNT.HLP", HELP_CONTENTS, 0L);
```



Следующий пример открывает файл справки пользователя, ищет в файле раздел, связанный со строкой ключевого слова, а затем выводит раздел.


```
HWND hwnd;     // main window handle 
BOOL bResult   // for checking Boolean function result 

bResult = WinHelp(hWnd, "WINNT.HLP", HELP_KEY, (DWORD) "finding topics");
```



### <a name="help-topics-dialog-box"></a>Диалоговое окно "разделы справки"

Диалоговое окно **разделы справки** можно вызвать путем вызова функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) с помощью команды **Help \_ Finder** . Диалоговое окно **разделы справки** позволяет пользователю выбирать разделы для отображения путем просмотра заголовков разделов, ключевых слов, связанных с разделами, или слов и фраз, найденных в разделах. Приложения обычно отображают это диалоговое окно, когда пользователь выбирает команду, например разделы справки, из меню Справка. Приложение может также отображать это диалоговое окно, если пользователь нажимает клавишу, когда ни один из окон, элементов управления или меню в приложении не имеет фокуса или является активным.

В прошлом приложения использовали справку и команды **\_ указателя справки** с функцией [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) для вывода раздела содержимого и индекса ключевого слова файла справки. **\_** Эти команды больше не рекомендуются. Вместо этого используйте команду **Help \_ Finder** .

### <a name="information-topics"></a>Информационные разделы

Вы можете отобразить конкретный раздел, вызвав функцию [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) с \_ командой контекста Help и указав идентификатор контекста для раздела. Приложения обычно используют контекст справки \_ в ответ на запросы пользователей на разделы, содержащие концептуальную информацию или практическую справку, а не сведения о конкретном элементе управления или меню. В таких случаях пользователь может продолжить просмотр файла справки для получения связанных сведений перед возвратом в приложение.

\_команда контекста справки вызывает обычный экземпляр Windows справку, позволяя пользователю найти другие разделы в файле справки. Обычно в нем отображается главное окно справки, которое содержит строку заголовка, системное меню, кнопки сворачивания и развертывания, главное меню, необязательную панель навигации, границу изменения размера и клиентскую область. Текст выбранного раздела отображается в клиентской области, и пользователь может перемещаться по файлу справки с помощью активных ссылок или кнопок навигации в главном окне. обычный экземпляр Windows справки также можно использовать для вывода справки в одном или нескольких вторичных окнах, а не в главном окне.

### <a name="pop-up-topics"></a>Разделы, посвященные всплывающим окнам

Можно отобразить всплывающую подсказку, содержащую сведения о конкретном элементе управления или меню, вызвав функцию [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) с помощью \_ команды Help WM \_ Help или Help \_ CONTEXTMENU. Эти команды отображают раздел во всплывающем окне рядом с соответствующим элементом управления или меню. Чтобы позволить пользователю немедленно возвращаться к работе в приложении, всплывающее окно уничтожается сразу же после нажатия пользователем клавиши или нажатия левой кнопки мыши.

\_ \_ При обработке [**\_ справочных сообщений WM**](wm-help.md) для управления окнами используется команда help WM Help. Так как большинство элементов управления передают сообщение **\_ справки WM** функции [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) , соответствующая процедура диалогового окна (или процедура родительского окна) обрабатывает это сообщение. Вместо того чтобы предоставлять определенный идентификатор контекста, процедура диалогового окна должна передать массив пар идентификаторов элементов управления и контекстов в [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) вместе с управляющим маркером, указанным в элементе **хитемхандле** структуры [**HELPINFO**](/windows/win32/api/winuser/ns-winuser-helpinfo) , передаваемой с помощью **\_ справочного сообщения WM** . Функция определяет идентификатор элемента управления, для которого было создано сообщение **\_ справки WM** , и использует соответствующий идентификатор контекста для вывода соответствующего раздела.

При \_ обработке сообщений [**WM \_ CONTEXTMENU**](../menurc/wm-contextmenu.md) используется команда help CONTEXTMENU. Так как большинство элементов управления передают сообщение **WM \_ CONTEXTMENU** функции [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) , соответствующая процедура диалогового окна (или процедура родительского окна) обрабатывает это сообщение. Процедура задает массив пар идентификаторов элементов управления и контекстов. Он также задает маркер в параметре *wParam* при вызове [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) , чтобы функция могла выбрать соответствующий идентификатор контекста из массива и отобразить соответствующий раздел. В отличие от \_ команды справки WM Help \_ , \_ при помощи CONTEXTMENU сначала отображается  команда в меню. Если пользователь выберет команду, выводится раздел **WinHelp** . В противном случае запрос отменяется.

Можно также отображать всплывающие разделы с помощью \_ команды Help контекстпопуп и указания идентификатора контекста раздела. эта команда аналогична \_ команде контекста справки, но вызывает всплывающий экземпляр Windows справку, используемой справкой \_ WM help \_ и help \_ CONTEXTMENU. Приложения могут использовать эту команду в ответ на [**сообщения \_ справки WM**](wm-help.md) для вывода справки для меню и для окон, не являющихся элементами управления в диалоговом окне. Чтобы наиболее эффективно использовать эту команду, приложение должно назначить идентификаторы контекста этим меню и окнам.

Идентификатор контекста можно назначить любому окну или меню в приложении. При создании [**сообщения \_ справки WM**](wm-help.md) система включает идентификатор контекста в структуру [**HELPINFO**](/windows/win32/api/winuser/ns-winuser-helpinfo) , которая передается родительскому окну в **\_ справочном сообщении WM** . Родительское окно может затем передать идентификатор контекста в [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) для вывода запрошенного раздела справки.

Используйте функцию [**сетвиндовконтексселпид**](/windows/desktop/api/Winuser/nf-winuser-setwindowcontexthelpid) , чтобы назначить идентификатор контекста для окна или элемента управления, а функцию [**сетменуконтексселпид**](/windows/desktop/api/Winuser/nf-winuser-setmenucontexthelpid) — для назначения контекстного идентификатора меню. Идентификатор контекста для окна или меню можно получить с помощью функции [**жетвиндовконтексселпид**](/windows/desktop/api/Winuser/nf-winuser-getwindowcontexthelpid) или [**жетменуконтексселпид**](/windows/desktop/api/Winuser/nf-winuser-getmenucontexthelpid) .

### <a name="keyword-searches"></a>Поиск по ключевым словам

Вы можете разрешить пользователю находить и просматривать разделы, назначив ключевые слова для разделов в файле справки. Ключевое слово — это просто строка, связанная с одной или несколькими разделами. Windows Help собирает все ключевые слова в файле справки, помещает их в таблицу и отображает их в списке Индекс диалогового окна **разделы справки** . когда пользователь выбирает ключевое слово, Windows справку отображает соответствующий раздел справки или, если имеется несколько разделов, связанных с ключевым словом, отображает список разделов, которые пользователь может выбрать.

В приложении можно использовать \_ команду справки, Help \_ ПАРТИАЛКЭЙ или Help \_ многоключевые с функцией [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) для поиска и вывода разделов справки на основе полных или частичных ключевых слов. Вы указываете команду, строку ключевого слова, файл справки и маркер для окна владельца. Во всех случаях, если найдено одно совпадение, **WinHelp** отображает соответствующий раздел. Если найдено несколько совпадений, функция отображает диалоговое окно найденные разделы, а пользователь может выбрать раздел для просмотра. Если совпадений не найдено, **WinHelp** либо отображает список индексов (для \_ клавиши Help и Help \_ партиалкэй), либо выводит сообщение об ошибке (для Help \_ многоключевые).

Приложение может искать несколько ключевых слов в одном вызове [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) , разделяя ключевые слова точкой с запятой. (поиск нескольких ключевых слов не поддерживается для файлов справки, созданных для Windows версии 3. *x*). Он также может искать ключевые слова в нескольких файлах справки, если файл справки с указанным файлом содержимого (. cnt) содержит команды index или: Link. С помощью \_ команды справки **WinHelp** ищет ключевые слова во всех файлах, указанных в этих командах. С помощью \_ команд Help многоключевые и Help \_ партиалкэй функция выполняет поиск по всем файлам, кроме тех, которые указаны командами: Link.

по умолчанию Windows Help распознает только таблицу ключевых слов, обозначенную символом K сноски в файле источника справки. можно направить Windows справку, чтобы создать дополнительные таблицы с ключевыми словами, добавив в исходный файл справки символ сноски, отличный от K, с определением ключевого слова. (Однако символ сноски зарезервирован.) При сборке файла справки необходимо определить все дополнительные таблицы ключевых слов с помощью инструкций МНОГОКЛЮЧЕВЫЕ в \[ \] разделе Options файла проекта.

приложение может использовать \_ команду HELP сетиндекс с функцией [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) , чтобы направить Windows справку, чтобы отобразить в списке индексов таблицу ключевых слов, отличную от K. чтобы направить Windows справку по поиску ключевого слова в альтернативной таблице ключевых слов, приложение может использовать \_ команду Help многоключевые. Вы указываете ключевое слово и таблицу ключевых слов в структуре [**мултикэйхелп**](/windows/win32/api/winuser/ns-winuser-multikeyhelpa) , которая передается в **WinHelp**.

Когда [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) отображает раздел, он отображает его в окне, указанном в тексте ">" для раздела, в окне, заданном командой: Base в файле содержимого, или в главном окне. Если главное окно уже открыто для другого файла справки при вызове **WinHelp**, функция скрывает главное окно при поиске. В этом случае отмена диалоговых окон « **найденные разделы** » и « **разделы справки** » приводит к закрытию главного окна.

### <a name="secondary-help-windows"></a>Вспомогательные окна справки

главное окно приложения справки Windows называется основным окном. Windows Справка также может отображать разделы справки во вторичном окне. В отличие от основного окна справки, дополнительное окно не содержит строку меню. Можно включить панель навигации во вторичное окно, а также добавить кнопки на панель. можно также выбрать, чтобы Windows автоматически регулировать высоту дополнительного окна в соответствии с разделом.

Необходимо определить вторичные окна в \[ разделе Windows \] файла проекта справки, указав имя и, при необходимости, начальный размер и расположение каждого окна. можно направлять Windows справочное приложение, чтобы отобразить раздел во вторичном окне, добавив угловую скобку (>) и имя, определенное для дополнительного окна, в имя файла справки. Результирующая строка затем передается функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) .

Приложение может изменить размер и расположение основного или дополнительного окна, указав адрес структуры [**хелпвининфо**](/windows/win32/api/winuser/ns-winuser-helpwininfoa) и \_ команду Help сетвинпос в вызове [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa). **Хелпвининфо** указывает имя окна, а также его новый размер и расположение.

### <a name="training-card-help"></a>Справка по учебной карточке

С помощью справки по учебной карточке приложение может отобразить последовательность инструкций, которые помогут пользователю выполнить шаги задачи. Учебная карточка обычно состоит из текста, поясняющего конкретный шаг и кнопки, которые связаны с макросами Ткард, что позволяет пользователю сообщить приложению, что делать дальше. Карточки обучения могут отображаться только во вторичных окнах и не должны содержать ссылки на другие разделы в файле справки.

приложение инициирует экземпляр карточки обучения Windows справку путем вызова функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) и указания \_ команды Help ткард в сочетании с другой командой, такой как \_ контекст справки. затем, когда пользователь нажимает кнопку на карточке обучения, щелкает активную точку, назначенную макросу ткард, или закрывает карточку обучения, Windows Help уведомляет приложение, отправляя ему сообщение [**WM \_ ткард**](wm-tcard.md) . Параметр *wParam* идентифицирует кнопку или действие пользователя, а параметр *lParam* содержит дополнительные данные, значение которых зависит от значения параметра *wParam*.

### <a name="canceling-help"></a>Отмена справки

Windows Для справки требуется, чтобы приложение явно отменило справку, чтобы освободить ресурсы, используемые для наблюдения за приложением и файлами справки. Приложение может сделать это в любое время, вызвав функцию [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) и УКАЗАВ \_ команду Help Quit. обратите внимание, что это не относится к всплывающему экземпляру Windows справки. Приложение не должно пытаться закрыть всплывающий экземпляр.

Если приложение выполнило какие-либо вызовы [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa), оно должно отменить вызов, прежде чем закрыть его главное окно (например, в ответ на сообщение WM \_ destroy в главной процедуре окна). Приложение должно вызывать **WinHelp** только один раз для отмены справки, независимо от количества открытых файлов справки. Windows Справка продолжает работать до тех пор, пока все приложения и библиотеки DLL не отменили справку.

чтобы закрыть экземпляр карточки обучения Windows справку, необходимо указать \_ команды help ткард и help \_ QUIT при вызове [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa). приложению не нужно отменять экземпляр карточки обучения Windows справку, если пользователь отменяет его. Windows Справка уведомляет приложение, когда пользователь отменяет экземпляр карточки обучения, отправляя сообщение [**WM \_ ткард**](wm-tcard.md) с параметром *wParam* , установленным в значение идклосе.

## <a name="using-help"></a>Использование справки

В этом разделе показано, как предоставить контекстную справку для диалогового окна и как задать внешний вид дополнительного окна справки.

-   [Предоставление справки в диалоговом окне](#providing-help-in-a-dialog-box)
-   [Настройка внешнего вида дополнительного окна справки](#setting-the-appearance-of-a-secondary-help-window)

### <a name="providing-help-in-a-dialog-box"></a>Предоставление справки в диалоговом окне

Чтобы обеспечить контекстную справку в диалоговом окне, необходимо создать массив, состоящий из пар значений **DWORD** . Первое значение в каждой паре — это идентификатор элемента управления в диалоговом окне, а второй — идентификатор контекста раздела справки для элемента управления. Массив должен содержать одну пару идентификаторов для каждого элемента управления в диалоговом окне.

Процедура диалогового окна должна обрабатывать сообщения [**WM \_ Help**](wm-help.md) и [**WM \_ CONTEXTMENU**](../menurc/wm-contextmenu.md) . Процедура диалогового окна получает **\_ справку WM** при нажатии клавиши и **WM \_ CONTEXTMENU** , когда пользователь нажимает правую кнопку мыши.

Параметр *lParam* [**\_ справки WM**](wm-help.md) содержит адрес структуры [**HELPINFO**](/windows/win32/api/winuser/ns-winuser-helpinfo) . Элемент **хитемхандле** этой структуры определяет элемент управления, для которого пользователь запросил справку. Этот обработчик необходимо передать функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) вместе с \_ командой help WM \_ Help, именем файла справки и указателем на массив идентификаторов. Функция **WinHelp** ищет в массиве идентификатор элемента управления указанного элемента управления, а затем извлекает соответствующий идентификатор контекста справки. затем функция передает идентификатор контекста справки для Windows справки, которая находит соответствующий раздел и отображает его во всплывающем окне. Если элемент управления имеет идентификатор-1, система выполняет поиск следующего элемента управления, который является остановкой табуляции, а затем использует его идентификатор для поиска идентификатора контекста справки. Поэтому важно поместить статический текст перед элементами управления в файл ресурсов.

При вызове функции [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) обработка [**WM \_ CONTEXTMENU**](../menurc/wm-contextmenu.md) похожа на обработку [**\_ справки WM**](wm-help.md) с этими двумя исключениями:

-   Параметр *wParam* передается из [**WM \_ CONTEXTMENU**](../menurc/wm-contextmenu.md), который является маркером для элемента управления, отправившего сообщение.
-   Вместо справки **\_ WM \_** Help следует указать команду **Help \_ CONTEXTMENU** .

команда **help \_ CONTEXTMENU** вызывает Windows отображения меню перед отображением раздела справки. Меню определяется системой. Он позволяет пользователю отображать справку для элемента управления или диалоговое окно **разделы справки** .

В следующем примере показано, как реализовать контекстно-зависимую справку в диалоговом окне.


```
LRESULT CALLBACK EditDlgProc(HWND hwndDlg, UINT uMsg, 
                             WPARAM wParam, LPARAM lParam) 
{ 
    // Create an array of control identifiers and context identifiers. 
    static DWORD aIds[ ] = 
    { 
        ID_SAVE,   IDH_SAVE, 
        ID_DELETE, IDH_DELETE, 
        ID_COPY,   IDH_COPY, 
        ID_PASTE,  IDH_PASTE, 
        0,0 
    }; 

    switch (uMsg) 
    { 
        case WM_HELP: 
            WinHelp(((LPHELPINFO)lParam)->hItemHandle, "helpfile.hlp", 
                    HELP_WM_HELP, (DWORD)(LPSTR)aIds); 
            break; 

        case WM_CONTEXTMENU: 
            WinHelp((HWND)wParam, "helpfile.hlp", HELP_CONTEXTMENU, 
                    (DWORD)(LPVOID)aIds); 
            break; 
        
        // Process other messages here. 
    } 
    return FALSE; 
}
```



### <a name="setting-the-appearance-of-a-secondary-help-window"></a>Настройка внешнего вида дополнительного окна справки

Приложение может задать размер, расположение и состояние дополнительного окна справки, передав в \_ функцию [**WinHelp**](/windows/desktop/api/Winuser/nf-winuser-winhelpa) команду Help сетвинпос и адрес структуры [**хелпвининфо**](/windows/win32/api/winuser/ns-winuser-helpwininfoa) . Члены **хелпвининфо** задают имя изменяемого окна, а также новый размер окна, его расположение и состояние отображения.

В следующем примере задается внешний вид дополнительного окна с именем «ВНД \_ Menu». Имя должно быть определено в \[ разделе Windows \] файла проекта справки.


```
BOOL DoWindowSize(VOID) 
{ 
    HANDLE hhwi; 
    LPHELPWININFO lphwi; 
    WORD wSize; 
    char *szWndName = "wnd_menu"; 
    size_t NameLength;      // Does not include the terminating null character
    HRESULT hr
    BOOL retval;

    hr = StringCbLengthA(szWndName, STRSAFE_MAX_CCH, &NameLength);
    
    if (SUCCEEDED(hr))
    {
        // Add 1 to account for the name string's terminating null character.
        NameLength++;
        
        // The HELPWININFO structure contains a minimal TCHAR array of size [2] 
        // that is used for the window name. Since sizeof(HELPWININFO) 
        // includes those two TCHARS, they must be subtracted from the 
        // total when adding the actual string length to calculate the  
        // size of the structure. 
        wSize = sizeof(HELPWININFO) - 2 + NameLength; 
    }
    else
        // Something's amiss with the string.
        return FALSE;
        
    hhwi  = GlobalAlloc(GHND, wSize); 
    lphwi = (LPHELPWININFO)GlobalLock(hhwi); 

    lphwi->wStructSize = wSize; 
    lphwi->x    = 256;      // horizontal position 
    lphwi->y    = 256;      // vertical position 
    lphwi->dx   = 767;      // width 
    lphwi->dy   = 512;      // height 
    lphwi->wMax = SW_SHOW;  // show the window 
    
    // secondary window
    hr = StringCbCopyA(lphwi->rgchMember, sizeof(lphwi->rgchMember), szWndName);
    
    if (SUCCEEDED(hr))
    {
        WinHelp(hwnd, "myhelp.hlp", HELP_SETWINPOS, (DWORD)lphwi); 
     
        GlobalUnlock(hhwi); 
        GlobalFree(hhwi); 

        return TRUE; 
    }
    else
        // There was a problem copying the window name.
        return FALSE;
}
```



 

 
