---
title: Пользовательские сценарии службы RAS
description: Разработчики могут создать пользовательский сценарий DLL, который находится на клиентском компьютере удаленного доступа. Эта библиотека DLL может взаимодействовать с сервером в процессе установления соединения.
ms.assetid: c27b8b02-6018-4441-a355-1fb890b9001c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 66ac0bd83b8d7c48ee8b0468d89a70d19a5e5e6555b9a8bc8ac86d66c8cd666e
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119673284"
---
# <a name="ras-custom-scripting"></a>Пользовательские сценарии службы RAS

Разработчики могут создать пользовательский сценарий DLL, который находится на клиентском компьютере удаленного доступа. Эта библиотека DLL может взаимодействовать с сервером в процессе установления соединения.

**Windows NT:** Пользовательские скрипты недоступны.

## <a name="setting-up-the-dll"></a>Настройка библиотеки DLL

Чтобы настроить библиотеку DLL, создайте значение с именем **кустомскриптдллпас** в следующем разделе реестра:

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Services
            Rasman
               Parameters
```

Это значение должно иметь тип **reg \_ expand \_ SZ**. Значение должно содержать путь к DLL-библиотеке пользовательского скрипта. Для каждого клиентского компьютера службы удаленного доступа поддерживается только одна библиотека DLL пользовательского сценария.

## <a name="interaction-between-the-server-ras-and-the-custom-scripting-dll"></a>Взаимодействие между сервером, службой RAS и библиотекой Custom-Scripting DLL

Библиотека DLL пользовательского скрипта должна экспортировать одну точку входа: [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn). Служба RAS вызывает эту функцию во время \_ интерактивного состояния процесса подключения раскс. \_Интерактивное состояние раскс — это приостановленное состояние, которое позволяет пользователю взаимодействовать с пользовательским интерфейсом, представленным библиотекой DLL пользовательского скрипта. Дополнительные сведения о состояниях подключения см. в разделе [**расконнстате**](/previous-versions/windows/desktop/legacy/aa376727(v=vs.85)) .

Служба RAS перейдет в качестве параметров функции [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) :

-   Маркер порта на клиентском компьютере, используемый для соединения.
-   Строки, которые указывают телефонную книгу и запись для подключения.
-   Служба RAS также передает в окно обработчик, чтобы разрешить библиотеке DLL предоставлять пользовательский интерфейс.
-   Набор указателей функций, которые библиотека DLL может использовать для взаимодействия с сервером.

Дополнительные сведения об этих параметрах см. в разделе [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) .

Служба RAS передает указатель на структуру [**раскустомскриптекстенсионс**](/previous-versions/windows/desktop/legacy/aa376738(v=vs.85)) в качестве последнего параметра в [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn). Эта структура содержит указатель на функцию типа [**пфнрассеткоммсеттингс**](/windows/desktop/api/Ras/nc-ras-pfnrassetcommsettings). Библиотека DLL пользовательского скрипта вызывает эту функцию для изменения параметров связи порта, используемого соединением.

Служба RAS устраняет взаимодействие между сервером и библиотекой DLL пользовательских сценариев. Как правило, сервер инициирует диалоговое окно. Например, сервер может запросить имя пользователя и пароль пользователя.

при использовании пользовательского сценария для установления соединения сервер не должен работать Windows NT 4,0 или Windows 2000.

## <a name="custom-scripting-user-interface-must-support-idcancel"></a>Пользовательский интерфейс сценариев должен поддерживать ИДКАНЦЕЛ

Если пользовательский номеронабиратель отображает пользовательский интерфейс, Пользовательский интерфейс должен поддерживать \_ Командные сообщения WM, где ловорд (*wParam*) равняется идканцел.

## <a name="configuring-the-connection"></a>Настройка подключения

точку входа [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) можно вызвать из [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) или в Windows XP из команды [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala).

Чтобы вызвать [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) из [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga), установите параметр расео \_ CustomScript в записи телефонной книги для подключения. Описание параметров записи телефонной книги см. в разделе **двфоптионс** элемента [**расентри**](/previous-versions/windows/desktop/legacy/aa377274(v=vs.85)) . Используйте функции [**расжетентрипропертиес**](/windows/desktop/api/Ras/nf-ras-rasgetentrypropertiesa) и [**рассетентрипропертиес**](/windows/desktop/api/Ras/nf-ras-rassetentrypropertiesa) для установки этого параметра программным способом.

**Windows XP:** Чтобы вызвать [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) из [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala), в вызове **rasdial** должна быть указана структура [**расдиалекстенсионс**](/previous-versions/windows/desktop/legacy/aa377029(v=vs.85)) , а в этой структуре должен быть указан \_ флаг рдеопт усекустомскриптинг. Кроме того, запись телефонной книги для подключения должна указывать \_ параметр расео CustomScript, как описано в предыдущем абзаце.

## <a name="invoking-the-custom-scripting-dll"></a>Вызов библиотеки DLL пользовательских скриптов

Если пользователь активирует подключение для записи телефонной книги, в которой \_ установлен расео CustomScript, служба RAS вызывает библиотеку DLL пользовательского сценария. В этом сценарии служба RAS вызывает библиотеку DLL пользовательского скрипта из [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga).

Для программного вызова библиотеки DLL пользовательского сценария установите соединение с помощью функции [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) . в Windows XP функция [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala) также вызывает библиотеку DLL пользовательского сценария.

 

 