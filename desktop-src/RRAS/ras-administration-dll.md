---
title: О библиотеках DLL администрирования RAS
description: Библиотека DLL администрирования RAS экспортирует функции, которые сервер удаленного доступа вызывает каждый раз, когда пользователь пытается подключиться или отключиться.
ms.assetid: c15c6e2d-3bb6-4583-9ac3-19528feb863f
keywords:
- Администрирование RAS, Библиотека DLL администрирования RAS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1cb170e8cfa331ab9591aa509772c6f6a743fa49
ms.sourcegitcommit: cba7f424a292fd7f3a8518947b9466439b455419
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2019
ms.locfileid: "104532915"
---
# <a name="about-ras-administration-dlls"></a>О библиотеках DLL администрирования RAS

Библиотека DLL администрирования RAS экспортирует функции, которые сервер удаленного доступа вызывает каждый раз, когда пользователь пытается подключиться или отключиться. Ниже приведены некоторые из возможных вариантов использования библиотеки DLL администрирования RAS.

-   Решите, следует ли разрешить пользователю подключаться к серверу. Библиотека DLL администрирования может обеспечить проверку безопасности в дополнение к стандартной проверке подлинности пользователя службы удаленного доступа.
-   Запишите время, когда каждый пользователь подключается к серверу и отключается от него. Это может быть полезно для выставления счетов или проведения аудита.
-   Назначьте IP-адрес каждому пользователю. Это полезно для обеспечения безопасности, так как эта функция используется для отображения подключения пользователя к определенному компьютеру.

Расположение библиотеки DLL администрирования RAS указывается в реестре; см. [раздел Установка реестра библиотеки DLL администрирования RAS](ras-administration-dll-registry-setup.md).

Служба RAS поддерживает несколько библиотек администрирования. Реестр поддерживает несколько расположений DLL. Служба RAS вызывает функции в библиотеках DLL в том порядке, в котором библиотеки DLL перечислены в реестре. см. [раздел Установка реестра библиотеки DLL администрирования RAS](ras-administration-dll-registry-setup.md).

**Сервер Windows 2000:** Служба RAS не поддерживает несколько библиотек DLL.

Библиотека DLL администрирования RAS должна реализовывать и экспортировать все следующие функции:

[**мпрадминакцептневлинк**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewlink)

[**мпрадмининитиализедлл**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmininitializedll)

[**мпрадминлинкхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminlinkhangupnotification)

[**мпрадминтерминатедлл**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminterminatedll)

Кроме того, Библиотека DLL администрирования RAS должна реализовывать и экспортировать либо

[**Мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) и

[**мпрадминконнектионхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification)

или

[**MprAdminAcceptNewConnection2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection2) и

[**MprAdminConnectionHangupNotification2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification2)

Если все необходимые функции не реализованы, служба удаленного доступа не сможет запуститься.

**Сервер Windows 2000:** Библиотека DLL администрирования должна реализовывать функции [**мпрадминжетипаддрессфорусер**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmingetipaddressforuser) и [**мпрадминрелеасеипаддресс**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminreleaseipaddress) . Если библиотека DLL реализует одну из этих функций, она также должна реализовывать и другую.

Служба RAS вызывает функцию [**мпрадмининитиализедлл**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmininitializedll) при первой загрузке службы маршрутизации и удаленного доступа. Функция **мпрадмининитиализедлл** предоставляет библиотеке DLL администрирования возможность выполнить необходимую инициализацию. Аналогичным образом служба RAS вызывает службу [**мпрадминтерминатедлл**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminterminatedll) , когда служба маршрутизации и удаленного доступа завершает работу. Эта функция позволяет библиотеке DLL администрирования выполнять необходимую очистку перед выходом.

Функции [**мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) и [**мпрадминконнектионхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification) позволяют библиотеке DLL выполнять аудит подключений пользователей к серверу. Сервер RAS вызывает функцию **мпрадминакцептневконнектион** каждый раз, когда пользователь пытается подключиться. Эта функция позволяет запретить пользователю подключаться. Функция **мпрадминакцептневконнектион** также может создавать записи журнала для выставления счетов или аудита. Когда пользователь отключается, сервер удаленного доступа вызывает функцию **мпрадминконнектионхангупнотификатион** , которая может регистрировать время отключения пользователя.

Функции [**MprAdminAcceptNewConnection2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection2) и [**MprAdminConnectionHangupNotification2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification2) похожи на **мпрадминакцептневконнектион** и [**мпрадминконнектионхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification). Однако когда служба RAS вызывает функции **MprAdminAcceptNewConnection2** и **MprAdminConnectionHangupNotification2** , служба RAS передает дополнительный параметр типа [**RAS \_ Connection \_ 2**](/windows/desktop/api/Mprapi/ns-mprapi-ras_connection_2).

Служба RAS поддерживает несколько библиотек администрирования. Пользователю с удаленным доступом разрешено подключаться, только если реализация функции [**мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) или [**MprAdminAcceptNewConnection2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection2) в каждой из библиотек DLL принимает соединение. Иными словами, каждая библиотека DLL должна принять подключение, чтобы пользователю было разрешено подключаться.

При подключении к серверу удаленного доступа может использоваться одно подключение RAS для использования нескольких ссылок. Функции [**мпрадминакцептневлинк**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewlink) и [**мпрадминлинкхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminlinkhangupnotification) позволяют библиотеке DLL администрирования управлять отдельными связями в соединении. Служба RAS вызывает **мпрадминакцептневлинк** всякий раз, когда для соединения устанавливается новая связь. Так как все соединения содержат по крайней мере одну ссылку, служба RAS всегда вызывает **мпрадминакцептневлинк** сразу после [**мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) или [**MprAdminAcceptNewConnection2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection2) , при условии, что [**мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) или [**MprAdminAcceptNewConnection2**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection2) приняли соединение. Служба RAS вызывает **мпрадминлинкхангупнотификатион** каждый раз при завершении работы ссылки для подключения.

Поскольку RAS поддерживает несколько библиотек администрирования, пользователю с удаленным доступом разрешено подключаться только в том случае, если в каждой из библиотек DLL принимается соединение с помощью функции [**мпрадминакцептневлинк**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewlink) . Иными словами, каждая библиотека DLL должна принять ссылку, чтобы установить ссылку.

После того как сервер удаленного доступа пройдет проверку подлинности пользователя, он вызывает функцию [**мпрадминжетипаддрессфорусер**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmingetipaddressforuser) для получения IP-адреса для удаленного клиента. Эта функция предоставляет альтернативную схему для сопоставления IP-адреса с пользователем удаленного доступа. Если **мпрадминжетипаддрессфорусер** не реализован, сервер удаленного доступа связывает удаленного пользователя с IP-адресом, выбранным из статического пула IP-адресов или выбранного сервером DHCP. Функция **мпрадминжетипаддрессфорусер** позволяет библиотеке DLL переопределить этот IP-адрес по умолчанию и указать конкретный IP-адрес для каждого пользователя. Функция **мпрадминжетипаддрессфорусер** может установить флаг, который заставляет службу RAS вызывать функцию [**мпрадминрелеасеипаддресс**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminreleaseipaddress) при отключении пользователя. После этого библиотека DLL может использовать **мпрадминрелеасеипаддресс** для обновления сопоставления пользователя и IP-адреса.

Служба RAS поддерживает несколько библиотек администрирования, но вызывает функции [**мпрадминжетипаддрессфорусер**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmingetipaddressforuser) и [**мпрадминрелеасеипаддресс**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminreleaseipaddress) только в первой библиотеке DLL, которая реализует и экспортирует их. Служба RAS игнорирует реализации этих функций в других библиотеках DLL. Служба RAS проверяет наличие библиотек DLL для этих функций в том порядке, в котором они перечислены в [реестре](ras-administration-dll-registry-setup.md).

Служба RAS сериализует вызовы в библиотеку DLL администрирования. Вызов одной из функций библиотеки DLL для данного клиента RAS не приводит к прерыванию вызова этой функции для другого клиента RAS. Служба RAS не вызывает функцию для другого клиента, пока не завершится первоначальный вызов. Более того, сериализация распространяется на определенные группы функций. Функции IP-адреса сериализуются как группа. вызов либо [**мпрадминжетипаддрессфорусер**](/windows/desktop/api/Mprapi/nf-mprapi-mpradmingetipaddressforuser) , либо [**мпрадминрелеасеипаддресс**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminreleaseipaddress) блокирует вызовы обеих функций до тех пор, пока не будет возвращен начальный вызов. [**Мпрадминакцептневконнектион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminacceptnewconnection) и [**мпрадминконнектионхангупнотификатион**](/windows/desktop/api/Mprapi/nf-mprapi-mpradminconnectionhangupnotification) также сериализуются как группа.

Служба RAS выполняет функции, которые назначают IP-адреса в одном процессе; функции для уведомлений соединения и отключения выполняются в другом процессе. Следовательно, Библиотека DLL не зависит от общих данных между этими двумя наборами функций.

Не вызывайте ни функции [администрирования RAS](ras-administration-functions.md) , ни [функции администрирования пользователей RAS](ras-user-administration-functions.md) внутри функции вызова. Вызовы этих функций не будут возвращаться при вызове из функции вызова.

Сервер RAS регистрирует ошибку в журнале системных событий, если возникает ошибка при попытке загрузить библиотеку DLL администрирования RAS или вызов одной из функций библиотеки DLL. Это может произойти, например, если в библиотеке DLL указано неправильное имя экспортируемой функции или если она не включала имя функции в DEF-файл. Запись в журнале событий указывает причину сбоя.

**Windows 2000/NT:** Несколько библиотек DLL администрирования не поддерживаются.

 

 




