---
title: Запись драйвера для захвата кадров PPP
description: в этом документе объясняется, как разработать драйвер, который может записывать кадры PPP в Windows Vista перед их сжатием и шифрованием в пути отправки или после распаковки или расшифровки в пути получения.
ms.assetid: 1b3fe1b8-2b11-4aed-98e1-464b8c0821ec
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b769a07811980b20ab076f60cc1e4fd7d9aa227b8eecfa44e71089bc949d0de5
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117789692"
---
# <a name="writing-a-driver-to-capture-ppp-frames"></a>Запись драйвера для захвата кадров PPP

При отправке кадров протокол PPP (PPP) через туннель PPTP с включенным шифрованием или через туннель протокола второго уровня (L2TP), использующий протокол IPSec для шифрования, стандартная служебная программа записи кадров PPP может записывать только кадры PPP, имеющие поле удостоверения зашифрованного протокола. в этом документе объясняется, как разработать драйвер, который может записывать кадры PPP в Windows Vista перед их сжатием и шифрованием в пути отправки или после распаковки или расшифровки в пути получения.

1.  Напишите драйвер протокола NDIS. Дополнительные сведения см. в разделе [драйверы протокола ndis 6,0](https://msdn.microsoft.com/library/ms795570.aspx) или [драйверы протокола ndis (NDIS 5,1)](https://msdn.microsoft.com/library/ms801145.aspx).
2.  Установите драйвер с удостоверением "MS \_ Netmon". Подробные инструкции по установке драйвера с указанным удостоверением оборудования см. в [разделе "модели INF](https://msdn.microsoft.com/library/ms794357.aspx)".
    > [!Note]  
    > каждый компьютер Windows Vista допускает установку только одной сущности драйвера с \_ удостоверением "ms netmon". Чтобы установить другой драйвер с этим удостоверением, необходимо удалить первый драйвер. Драйвер, установленный без использования удостоверения оборудования "MS \_ Netmon", не может выполнить привязку, необходимую для записи кадров PPP.

     

3.  Драйвер протокола должен указать "ндисванбх" в качестве интерфейса привязки для захвата кадров PPP. Подробные инструкции см. в разделе [Указание интерфейсов привязки](https://msdn.microsoft.com/library/aa937923.aspx).
4.  Реализация [протоколбиндадаптер](https://msdn.microsoft.com/library/ms797311.aspx) в драйвере должна поддерживать "ндисмедиумван" как часть среднего массива, чтобы он мог открыть ребро мини-порта ндисванбх с помощью функции [ндисопенадаптер](https://msdn.microsoft.com/library/ms804862.aspx) .
5.  Если функция [протоколопенадаптеркомплете](https://msdn.microsoft.com/library/ms797287.aspx) вызывается со статусом состояние \_ NDIS \_ успешно, драйвер протокола должен установить идентификатор объекта OID для [ \_ \_ текущего \_ \_ фильтра пакетов](https://msdn.microsoft.com/library/bb314089.aspx) с [ \_ \_ \_ неизбирательными](https://msdn.microsoft.com/library/bb314089.aspx) флагами NDIS и [ \_ типом пакета NDIS для \_ \_ \_ локальной](https://msdn.microsoft.com/library/bb314089.aspx) привязки. После этого драйвер протокола получит расшифрованные кадры PPP из уровня кадрирования PPP в своей функции [протоколрецеиве](https://msdn.microsoft.com/library/ms797274.aspx) .

> [!Note]  
> эта информация относится только к драйверам на компьютере Windows Vista.

 

 

 




