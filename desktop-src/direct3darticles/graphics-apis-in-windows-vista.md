---
title: Графические API в Windows
description: В этой статье обсуждаются графические функции и API-интерфейсы Windows.
ms.assetid: 54cd5027-cdcf-fc4a-40a9-beacfaa08681
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7543ee7c5e3cdbfb022cc9299dd5ddd3cdd36981
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413512"
---
# <a name="graphics-apis-in-windows"></a>Графические API в Windows

В Windows Vista реализована поддержка совершенно новой модели видеодрайверов, которая представляет собой основную редакцию в архитектуре видеодрайверов с момента появления WDM (WDM) для Windows 98. Эта переработанная модель отражает развитие видеооборудования из мира 2D-растровых операций и приложений GDI для трехмерных игр с графическим оборудованием с фиксированными функциями и, наконец, с помощью современных программируемых графических процессоров (GPU), поддерживающих широкий спектр высокопроизводительных графических приложений. Windows 7 и Windows 8 построены на графической инфраструктуре Windows Vista, предоставляя дополнительные графические функции и интерфейсы API. В этой статье обсуждаются графические функции и API-интерфейсы Windows.

-   [Фон](#background)
-   [Direct3D 9](#direct3d-9)
-   [9Ex Direct3D](#direct3d-9ex)
-   [Direct3D 10](#direct3d-10)
-   [Direct3D 10,1](#direct3d-101)
-   [Direct3D 11](#direct3d-11)
-   [Direct3D 11,1](#direct3d-111)
-   [OpenGL](#opengl)
-   [Совместимость приложений, GDI и более ранние версии Direct3D](#application-compatibility-gdi-and-older-versions-of-direct3d)
-   [Рекомендации](#recommendations)

## <a name="background"></a>Историческая справка

Основной API для программирования графики, начиная с ранних дней Windows, был интерфейсом графического устройства (GDI). Этот API был разработан для работы с множеством двумерных устройств вывода, и он образован в основе интерфейса пользователя Windows. DirectDraw и Direct3D были представлены в качестве альтернативных API-интерфейсов для поддержки полноэкранных игр и трехмерной отрисовки как расширений существующего оборудования. Взаимодействие с GDI было сложным. Эффективное сочетание традиционных элементов GDI с элементами Direct3D было ограничено этой структурой. Версия Windows XP WDM, известная как XPDM, отражает параллельную природу GDI и Direct3D (см. рис. 1).

**Рис. 1. Графические API в Windows XP**

![драйверы](images/graphics-apis-in-windows-xp.gif)

В течение многих лет возможности трехмерных видеоадаптеров значительно увеличились до того места, где эта функция выделяется подавляющим большинством аппаратных средств. Новая модель драйверов (WDDM), переводит GPU и Direct3D в Forefront, позволяя создавать совершенно новые возможности, трехмерные настольные системы, которые легко смешиваются с возможностями современных программируемых графических процессоров. При использовании WDDM видеооборудование полностью зависит от Direct3D, а все остальные графические интерфейсы взаимодействуют с видеооборудованием с помощью новой модели драйверов, ориентированной на Direct3D (см. рис. 2).

**Рис. 2. Графические API в Windows Vista**

![драйвер](images/graphics-apis-in-windows-vista.gif)

Дополнительные сведения о WDDM см. в разделе [руководство по проектированию модели драйвера Windows Vista (WDDM)](/windows-hardware/drivers/display/windows-vista-display-driver-model-design-guide) на сайте MSDN.

## <a name="direct3d-9"></a>Direct3D 9

Версия 9 DirectX впервые была выпущена для Windows в 2002 с последующими обновлениями в 2003 и 2004. Этот API представляет собой десятилетие эволюции технологий DirectX, знакомство с более мощными моделями программирования шейдеров для Direct3D и сроком погашения, основанный на тысячах поставок. Direct3D 9 является основным графическим интерфейсом в Windows Vista. Он остается идеальным интерфейсом API, который используется для написания трехмерных игр и приложений, которые должны выполняться в широком спектре существующих выпусков оборудования и Windows. Сведения о новой модели драйверов скрыты от приложений, использующих интерфейсы Direct3D 9, но в фоновом режиме операционная система использует все преимущества новых возможностей для обеспечения истинной многозадачности GPU, более эффективного управления ресурсами и надежности производительности.

Для обеспечения полной совместимости с предыдущими версиями Windows некоторые особенности старой модели драйверов должны быть эмулироваться даже с новой моделью видеодрайверов Windows Vista. Например, когда полноэкранное приложение теряет фокус, оно должно считать, что оно потеряло все ресурсы в видеопамяти (видеопамять) и перезагружало их, созданные как неуправляемые ресурсы, несмотря на то, что новая модель драйверов обрабатывает ресурсы прозрачно, не удаляя их из контекста устройства. Даже понятие типа ресурса управляемого и по умолчанию относится к старой модели драйвера. Еще один пример — ожидание сбоя при выделении ресурсов неуправляемого (пула по умолчанию) сверх объема доступной видеопамяти, даже несмотря на то, что новая модель драйверов может предоставлять почти неограниченное количество виртуальных видеопамятьй. Из-за этих требований приложения Direct3D, работающие в Windows Vista, все равно будут принимать эти ошибки. Поэтому они ограничены возможностью использования базовых интерфейсов Direct3D 9 для полного использования некоторых функций новой модели драйверов.

В то время как новые системы, поставляемые с Windows Vista, включают видеоадаптеры с драйверами WDDM, а новые драйверы для ряда популярных видеоадаптеров включены в комплект поставки Windows Vista для обновления и выпуска более старых версий драйверов XPDM. В системах, использующих старую модель драйвера, необходимо использовать Direct3D 9 и более старые интерфейсы, и работа графической системы очень похожа на Windows XP (рис. 1). WDDM требуется, чтобы приложения использовали Direct3D 9Ex, Direct3D 10 и более поздние версии.

## <a name="direct3d-9ex"></a>9Ex Direct3D

Интерфейс Direct3D 9Ex предоставляет доступ к небольшому расширению стандартного API Direct3D 9, предоставляющему виртуальное выделение ресурсов, новую семантику потерянных устройств и другие новые функции, доступные при работе в Windows Vista. Создавая этот расширенный объект, API Direct3D 9 использует новую семантику и, следовательно, требует, чтобы приложение использовало другую логику (и, следовательно, разные пути кода) для создания ресурсов, управления и обработки ошибок для новых типов условий. Этот API доступен только в Windows Vista и требует наличия драйверов WDDM. Так как Direct3D 9Ex использует отдельный путь к API и коду драйвера, чем Direct3D 9, для поддержки этого API требуются дополнительные тестовые случаи для приложения.

Основная причина создания нового API Direct3D 9Ex — обеспечить полный доступ к новым возможностям WDDM, сохраняя совместимость с существующими приложениями Direct3D. В новых приложениях для работы с 3D Desktop и многими приложениями для Windows Vista используется эта версия Direct3D 9, но они не работают при работе на старых драйверах XPDM. Поскольку API Direct3D 9Ex никогда не будет отображаться в более старых версиях Windows из-за отсутствия поддержки WDDM, стандартные интерфейсы Direct3D 9 охватывают более широкий набор систем. Для высокопроизводительных приложений, которые могут использовать преимущества следующего поколения видеооборудования, совершенно новая версия 10 Direct3D предоставляет множество новых возможностей, не предоставляемых Direct3D 9Ex. В результате для игр и большинства других приложений рекомендуется использовать API Direct3D 9 или Direct3D 10.

> [!Note]  
> Пакет SDK для DirectX не предоставляет образцы, заголовки или библиотеки для интерфейса Direct3D 9Ex. Библиотека MSDN и Windows SDK (прежнее название — Platform SDK) содержат доступную документацию, заголовки и библиотеки.

 

Дополнительные сведения о Direct3D 9Ex см. в статье [DirectX для Windows Vista](/previous-versions//ms681824(v=vs.85)) на MDSN.

## <a name="direct3d-10"></a>Direct3D 10

Чтобы полностью реализовать потенциал новой модели драйверов Windows Vista и оборудования следующего поколения, был создан совершенно новая версия API Direct3D. Хотя WDDM устраняет некоторые ограничения на производительность в существующей графической системе, Direct3D 10 становится еще больше за счет удаления узких мест проектирования в существующем API Direct3D и значительно упрощает задачу программирования GPU.

Новый API полностью исключает все аспекты, кроме фиксированных функций, заменяя их программируемыми конструкциями и значительно оптимизируя внутреннюю реализацию. Сотни битов возможностей в предыдущих версиях Direct3D были полностью устранены и заменены четко определенным набором функций, которые имеют лишь несколько необязательных сценариев использования для определенных форматов ресурсов. Создание и проверка ресурсов с интенсивным использованием ЦП теперь имеют явную семантику в новом API. Это обеспечивает гораздо более предсказуемое поведение производительности и значительно сокращает затраты на рисование. Ресурсы можно перенастроить в несколько форм, чтобы обеспечить эффективное использование на различных этапах, а набор функций накладывает гораздо меньше ограничений на сценарии использования для форматов. Существуют также новые форматы текстур с нормальным форматом блочных карт.

В новом API константы шейдера и состояние устройства являются явными ресурсами, что позволяет значительно повысить эффективность кэширования на оборудовании и значительно упростить проверку драйверов. Программируемая модель шейдеров объединена в шейдеры вершин и пикселей и стала более выразительным с помощью четко определенной вычислительной модели и набора операторов. Кроме того, для использования примитивов после этапа шейдера вершин был добавлен новый этап шейдера геометрии. Результаты работы графического процессора на стадиях шейдера вершин и геометрии конвейера можно передать в видеопамять для повторного использования, что позволяет выполнять очень сложные многопроходные операции GPU с минимальным взаимодействием ЦП.

Все эти улучшения позволяют использовать технологию графики следующего поколения и расширять возможности приложений для их отключения от загрузки GPU. Разгрузка обеспечивает более сложные выборки символов на основе GPU, ускоренные преобразования, создание теневых томов и объемы, частицы и физические системы, которые полностью основаны на GPU, являются более сложными материалами, объединенными в эффективные пакеты больших объемов, процедурная детализация, отслеживание смещения лучей в реальном времени, однопроходное создание карт Куба и многие другие методы, в то же время освобождая ресурсы ЦП для более сложных приложений.

Чтобы обеспечить этот уровень инноваций в Direct3D 10, старое оборудование не может быть выражено как частичная реализация нового интерфейса. Видеоадаптер либо может поддерживать все новые функции, либо не является платой с поддержкой Direct3D 10. Таким образом, несмотря на то, что Direct3D 9 может использовать оборудование DirectX7 с множеством отсутствующих битов и ограничений на использование, Direct3D 10 работает только с новым поколением видеоадаптеров. Чтобы приложение поддерживало старое видео оборудование, оно также должно поддерживать интерфейсы Direct3D 9. Будущие версии Direct3D будут создавать версии 10, расширяя ее до новых версий API, обеспечивая при этом более широкие возможности Direct3D 10.

Дополнительные сведения о Direct3D 10 см. в разделе [Direct3D 10](/windows/desktop/direct3d10/d3d10-graphics).

## <a name="direct3d-101"></a>Direct3D 10,1

Пакет обновления 1 (SP1) для Windows Vista расширяет API Direct3D 10 с помощью Direct3D 10,1, который добавляет дополнительные интерфейсы и дополнительную модель шейдера для поддержки новых аппаратных функций видеоадаптеров, поддерживающих Direct3D 10,1. Все оборудование, способное поддерживать Direct3D 10,1, также полностью поддерживает все функции Direct3D 10, а разработчики игр могут использовать дополнительные функции Direct3D 10,1, если они доступны.

> [!Note]  
> Direct3D 10,1 — это графический API, используемый Windows 7 Desktop.

 

> [!Note]  
> Windows 7 и обновление Windows Vista ([KB 971644](https://support.microsoft.com/kb/971644)) добавляют поддержку для DXGI 1,1, 10level9 уровня функций и устройства WARP10 к существующему API-интерфейсу Direct3D 10,1.

 

## <a name="direct3d-11"></a>Direct3D 11

Windows 7 поддерживает новую версию Direct3D, Direct3D 11, основанную на проектировании API Direct3D 10,1. К новым возможностям API относятся Многопотоковая визуализация и создание ресурсов, шейдер вычислений, поддержка уровней функций 10level9 и устройства WARP10 Software Rendering, а также новые функции оборудования класса Direct3D 11, такие как тесселяция, с использованием поверхности & шейдеров доменов, BC6H и BC7 форматов сжатия текстур, модели шейдеров 5,0 и динамической компоновки шейдеров. Новый API может использовать существующие видеокарты классов Direct3D 10 и 10,1, некоторые карты Direct3D 9 через уровни функций 10level9 с ограниченной поддержкой функций и последние видеокарты класса Direct3D 11 нового поколения.

В дополнение к API Direct3D 11 в Windows 7 входит DXGI 1,1, Direct2D, DirectWrite и поддержка драйверов WDDM 1,1.

> [!Note]  
> Direct3D 11 и связанные интерфейсы API также доступны в качестве обновления для Windows Vista (см. [статью KB 971644](https://support.microsoft.com/kb/971644)).

 

## <a name="direct3d-111"></a>Direct3D 11,1

Windows 8 расширяет [API Direct3D 11](#direct3d-11) с помощью Direct3D 11,1. Direct3D 11,1 поддерживает все существующее оборудование, поддерживающее [уровни функций](/windows/desktop/direct3d11/overviews-direct3d-11-devices-downlevel-intro) 11, 10 \_ x и 9 \_ x, а также новый \_ уровень возможностей 11 1.

В дополнение к [API Direct3D 11,1](/windows/desktop/direct3d11/direct3d-11-1-features), Windows 8 включает в себя [1,2 DXGI](/windows/desktop/direct3ddxgi/dxgi-1-2-improvements), [Direct2D для устройств](/windows/desktop/Direct2D/devices-and-device-contexts)и поддержку драйверов WDDM 1,2.

> [!Note]  
> Если вы хотите, чтобы приложения из Магазина Windows могли программировать трехмерную графику с помощью DirectX, можно использовать API Direct3D 11,1. Дополнительные сведения о программировании трехмерной графики с помощью DirectX см. в статье [Введение в трехмерную графику с помощью DirectX](/previous-versions/windows/apps/hh465137(v=win.10)).

 

**Обновление платформы для Windows 7:** Для [API Direct3D 11,1](/windows/desktop/direct3d11/direct3d-11-1-features) в Windows 7 или windows Server 2008 R2 доступна частичная поддержка с установленным [обновлением платформы для Windows 7](https://support.microsoft.com/kb/2670838) . Дополнительные сведения об обновлении платформы для Windows 7 см. в [статье обновление платформы для Windows 7](platform-update-for-windows-7.md).

## <a name="opengl"></a>OpenGL

Windows Vista, Windows 7 и Windows 8 обеспечивают ту же поддержку, что и Windows XP для OpenGL, что позволяет производителям видеоадаптеров предоставлять устанавливаемый драйвер клиента (ICD) для OpenGL, обеспечивающий поддержку аппаратного ускорения. Обратите внимание, что более новые версии таких Икдс необходимы для полной поддержки Windows Vista, Windows 7 или Windows 8. Если программа ICD не установлена, в большинстве случаев система вернется к программному уровню OpenGL v 1.1.

## <a name="application-compatibility-gdi-and-older-versions-of-direct3d"></a>Совместимость приложений, GDI и более ранние версии Direct3D

Графические системы Windows Vista, Windows 7 и Windows 8 разработаны для поддержки широкого спектра сценариев использования оборудования и ресурсов, позволяющих использовать новые технологии, продолжая поддерживать существующие системы. Существующие графические интерфейсы, такие как GDI, GDI+ и более ранние версии Direct3D, продолжают работать в Windows Vista и Windows 7, но при этом по возможности пересопоставляются. Это означает, что большинство существующих приложений Windows продолжат работать.

Windows Vista, Windows 7 и Windows 8 продолжают поддерживать те же интерфейсы Direct3D и DirectDraw, что и Windows XP, обратно в версию 3 DirectX (за исключением сохраненного режима Direct3D's, который был удален). Как и в Windows XP Professional x64 Edition, 64-разрядные машинные приложения в более новых версиях Windows ограничены интерфейсами Direct3D9, DirectDraw7 или более новыми. Высокопроизводительные приложения должны использовать Direct3D 9 или более поздней версии, чтобы обеспечить наиболее близкое соответствие возможностей оборудования.

## <a name="recommendations"></a>Рекомендации

При выборе API для графического приложения учитывайте следующие рекомендации.

-   Используйте Direct3D 9, если приложение должно поддерживать Windows XP или более раннюю версию Windows.
-   Используйте Direct3D 9, если требуется поддержка Windows Vista или Windows 7, работающих с драйверами XPDM. Для систем Windows Vista или Windows 7, в которых отсутствует Direct3D 10 или более производительное видеооборудование, можно выбрать использование существующего кода Windows XP Direct3D 9 или использовать уровни функций 10level9 через API Direct3D 10,1 или Direct3D 11.
-   Используйте Direct3D 11, чтобы воспользоваться преимуществами нового поколения видеооборудования в Windows Vista, Windows 7 и Windows 8. Приложения для Магазина Windows должны использовать Direct3D 11 или более поздней версии.

 

 