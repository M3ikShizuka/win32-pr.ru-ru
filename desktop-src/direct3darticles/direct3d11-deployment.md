---
title: Развертывание Direct3D 11 для разработчиков игр
description: В этой статье описывается, как при необходимости развернуть компоненты Direct3D 11 в системе.
ms.assetid: 1fd43638-0d67-4a94-3be6-8789095f491e
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 28a65cb51a360fbe732566e3560719d02a087e0a46e45b07f41413e6faa0f66a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119627794"
---
# <a name="direct3d-11-deployment-for-game-developers"></a>Развертывание Direct3D 11 для разработчиков игр

В этой статье описывается, как при необходимости развернуть компоненты Direct3D 11 в системе.

-   [Обзор](#overview)
-   [Direct3D 11,3](#direct3d-113)
-   [Direct3D 11,2](#direct3d-112)
-   [Direct3D 11,1](#direct3d-111)
-   [D3D11InstallHelper.dll](#d3d11installhelperdll)
-   [D3D11Install.exe](#d3d11installexe)
-   [Интеграция в программы установки](#integrating-into-installation-programs)
    -   [Интеграция с InstallShield](#integrating-into-installshield)
    -   [Интеграция в пакет MSI](#integrating-into-an-msi-package)
-   [Советы отладки](#debugging-tips)
-   [Параметры организации](#corporate-settings)
-   [Связанные статьи](#related-articles)

## <a name="overview"></a>Обзор

API Direct3D 11 расширяет существующий API Direct3D 10,1 с поддержкой многопоточной отрисовки и создания ресурсов, шейдера вычислений, тесселяции оборудования, BC6H/BC7 и сжатия текстур, а также HLSL модели шейдеров 5,0 с помощью динамической компоновки шейдеров. помимо компонента Direct3D 11, в среду выполнения DirectX 11 включены некоторые дополнительные графические компоненты: Direct3D 11, DXGI 1,1, 10level9 feature levels, WARP10 software rendering device, Direct2D, DirectWrite и обновленный Direct3D 10,1 с поддержкой 10level9 и WARP10. сведения об этих и других Windows графических компонентах см. [в разделе интерфейсы api графики в Windows](graphics-apis-in-windows-vista.md).

все эти новые графические компоненты встроены в операционные системы Windows 7 и Windows Server 2008 R2. API-интерфейс Direct3D 11 и связанные компоненты также можно установить на Windows Vista с помощью обновления системы из Центр обновления Windows; см. статью базы знаний [KB 971644](https://support.microsoft.com/kb/971644). для этого обновления требуется Windows Vista и пакет обновления 2 (sp2). конечные пользователи с включенным автоматическим обновлением, скорее всего, уже установили компоненты Direct3D 11, как и все пользователи Windows 7.

Пример D3D11InstallHelper предназначен для упрощения обнаружения API Direct3D 11, автоматической установки обновления системы, если это применимо к компьютеру конечного пользователя, и предоставления соответствующих сообщений пользователю при ручной процедуре, если требуется более новый пакет обновления.

> [!Note]  
> компилятор HLSL (D3DCompile \*.dll) и библиотека служебной программы D3DX для Direct3D 11 (D3DX11 \*.dll) не встроены в какую-либо версию Windows операционной системы, но их можно развернуть как часть установщика приложения с помощью существующей технологии директсетуп; дополнительные сведения об использовании директсетуп см. в статье [установка DirectX для разработчиков игр](/windows/desktop/DxTechArts/directx-setup-for-game-developers). "Effects 11" доступен в виде библиотеки поддержки общего источника, которая [влияет на обновление Direct3D 11](https://github.com/Microsoft/FX11), и может быть включена непосредственно в приложение (во многом подобно библиотеке служебной программы дксут). Поэтому у него нет дополнительных требований к повторному распространению во время выполнения.

## <a name="direct3d-113"></a>Direct3D 11,3

Windows 10 поставляется с API-интерфейсом Direct3D 11,3, встроенным в. Список новых функций в API Direct3D 11,3 см. в разделе [функции direct3d 11,3](/windows/desktop/direct3d11/direct3d-11-3-features) .

## <a name="direct3d-112"></a>Direct3D 11,2

Windows 8.1 и Windows Server 2012 R2 поставляются с API-интерфейсом Direct3D 11,2, встроенным в. Список новых функций в API Direct3D 11,2 см. в разделе [функции direct3d 11,2](/windows/desktop/direct3d11/direct3d-11-2-features) .

## <a name="direct3d-111"></a>Direct3D 11,1

Windows 8 и Windows Server 2012 поставляются с [API-интерфейсом Direct3D 11,1](/windows/desktop/direct3d11/direct3d-11-1-features) , встроенным в. частичная поддержка API-интерфейса Direct3D 11,1 доступна на Windows 7 или Windows Server 2008 R2 с [обновлением платформы для Windows 7](https://support.microsoft.com/kb/2670838) . дополнительные сведения об обновлении платформы для Windows 7 см. в разделе [обновление платформы для Windows 7](platform-update-for-windows-7.md).

## <a name="d3d11installhelperdll"></a>D3D11InstallHelper.dll

D3D11InstallHelper.dll размещает основные функциональные возможности для обнаружения компонентов Direct3D 11 и выполнения обновления системы через службу Центр обновления Windows, если это применимо. Библиотека DLL не отображает сообщения или диалоговые окна непосредственно.

Библиотека DLL состоит из следующих точек входа:

<dl> <dt>

<span id="CheckDirect3D11Status"></span><span id="checkdirect3d11status"></span><span id="CHECKDIRECT3D11STATUS"></span>CheckDirect3D11Status
</dt> <dd>

Эта функция выполняет необходимые проверки и возвращает состояние Direct3D 11 на этом компьютере. Эта функция не требует прав администратора.

-   Состояние D3D11IH \_ состояние \_ установлено указывает на то, что Direct3D 11 уже установлен на компьютере и готов к использованию.
-   \_состояние D3D11IH \_ не \_ поддерживается указывает, что эта версия Windows не поддерживает Direct3D 11 или связанные технологии.
-   состояние D3D11IH \_ \_ требуется \_ последняя версия \_ SP указывает, что пользователь должен установить последний пакет обновления Windows Vista.
-   Наконец, состояние D3D11IH \_ \_ требуется \_ Обновление означает, что в системе не установлен Direct3D 11, но обновление системы применяется к этой версии Windows.

</dd> <dt>

<span id="DoUpdateForDirect3D11"></span><span id="doupdatefordirect3d11"></span><span id="DOUPDATEFORDIRECT3D11"></span>DoUpdateForDirect3D11
</dt> <dd>

эта функция использует Центр обновления Windows API для выполнения обновления системы для установки Direct3D 11 в этой системе, если это применимо. обратите внимание, что этой функции требуется сетевое подключение, чтобы Центр обновления Windows успешно, а также права администратора. Он принимает необязательную функцию обратного вызова Progress и указатель контекста пользователя и возвращает окончательный код результата по завершении.

-   \_ \_ Полученный результат D3D11IH указывает на то, что обновление системы было применено и готово к использованию, в то время как D3D11IH \_ result \_ Success \_ reboot указывает, что обновление системы требует перезагрузки компьютера до его завершения. Обратите внимание, что эта функция не запланирует перезагрузку системы.
-   D3D11IH \_ result \_ не \_ поддерживается указывает, что обновление системы не применяется к этой версии Windows. Этот результат не должен возникать, если эта функция вызывается только после получения \_ состояния D3D11IH \_ требуется \_ состояние обновления от CheckDirect3D11Status.
-   результат D3D11IH- \_ обновления результата \_ \_ не \_ найден, указывает на то, что пакет обновления системы не найден на Центр обновления Windows серверах.
-   если Центр обновления Windows скачивание или установка завершается сбоем, то \_ в \_ результате загрузки обновления результатов D3D11IH \_ не удалось загрузиться, \_ или D3D11IH \_ \_ \_ не удалось установить обновление результатов \_ .
-   если в Центр обновления Windows API возвращается ошибка сетевого подключения, \_ \_ \_ \_ возвращается результат ошибки службы WU, указывающий на то, что проблема может быть временной или связанной с конфигурацией сети или параметрами брандмауэра. Повторная попытка обновить функцию может быть выполнена.

</dd> </dl>

дополнительные сведения об api Центр обновления Windows см. в разделе [api агента Центр обновления Windows](/windows/desktop/Wua_Sdk/portal-client).

## <a name="d3d11installexe"></a>D3D11Install.exe

> [!Note]  
> Для выполнения D3D11Install.exe требуется D3D11InstallHelper.dll.

D3D11Install.exe — это средство для использования D3D11InstallHelper.dll в качестве автономного установщика с сообщениями пользовательского интерфейса и пользователя, а также выступает в качестве примера для правильного использования библиотеки DLL. Этот процесс завершается с 0, если Direct3D 11 уже установлен, если обновление системы применяется успешно без перезагрузки системы, если требуется установка пакета обновления или если Direct3D 11 не поддерживается этим компьютером. Значение 1 возвращается, если обновление системы установлено успешно и для завершения требуется перезагрузка системы. Для других условий возникновения ошибок возвращается значение 2. обратите внимание, что для запуска этого исполняемого файла требуются права администратора и манифест, который запрашивает повышение прав при запуске в Windows Vista или Windows 7 с включенным контролем учетных записей. D3D11Install.exe можно использовать в качестве автономного средства для развертывания обновления Direct3D 11. также его можно использовать непосредственно установщиками.

Он поддерживает следующие параметры командной строки:

<dl> <dt>

<span id="_quiet__"></span><span id="_QUIET__"></span>/quiet 
</dt> <dd>

Не отображает сообщения, приглашения, диалоговые окна и сообщения об ошибках.

</dd> <dt>

<span id="_passive__"></span><span id="_PASSIVE__"></span>/passive 
</dt> <dd>

Не отображает сообщения, приглашения или сообщения об ошибках, но отображается диалоговое окно Ход выполнения.

</dd> <dt>

<span id="_minimal__"></span><span id="_MINIMAL__"></span>/минимал 
</dt> <dd>

Показывает только минимальные запросы.

</dd> <dt>

<span id="_y__"></span><span id="_Y__"></span>/y 
</dt> <dd>

Подавляет запрос на подтверждение установки обновления (при необходимости и применимо) для стандартной и минимальной установки.

</dd> <dt>

<span id="_langid_decimal__"></span><span id="_LANGID_DECIMAL__"></span>/лангид Decimal 
</dt> <dd>

Указывает, какой код языка следует использовать при отображении сообщений конечных пользователей и ресурсов диалоговых окон. Значение по умолчанию — 1024, в котором используется параметр языка по умолчанию системы.

</dd> <dt>

<span id="_wu__"></span><span id="_WU__"></span>/ву 
</dt> <dd>

принудительное использование Центр обновления Windows, а не системного по умолчанию, которое может быть Windows Server Update Services (WSUS), работающем на управляемом сервере или другой нестандартной конфигурации.

</dd> </dl>

## <a name="integrating-into-installation-programs"></a>Интеграция в программы установки

чтобы обеспечить поддержку простой установки, необходимо выполнить [техническое требование 3,1 для игр на Windows](/windows/desktop/DxTechArts/games-for-windows-technical-requirements-1-1-0006), чтобы все запросы конечных пользователей преддавались на ранних этапах процесса установки, а также чтобы убедиться в отсутствии нескольких запросов на повышение прав, связанных с UAC. Для достижения этой цели существует три основных варианта.

1.  Самый простой способ — выполнить D3D11Install.exe с параметром командной строки **/минимал**. Это необходимо сделать на ранних этапах работы установщика Q&A, а установка должна использовать возвращаемое значение 1, чтобы указать, что необходимо запланировать перезапуск в конце установки. Для запуска программы требуются права администратора.
2.  Используйте D3D11InstallHelper.dll напрямую, чтобы определить необходимость обновления, предоставив всем пользовательским сообщениям, необходимым для состояния D3D11IH состояния, \_ \_ требуется \_ Последняя версия \_ SP, где разрешение требует ручных действий пользователя. Результат состояния D3D11IH " \_ \_ не поддерживается" \_ может использоваться для управления установкой связанных с Direct3D 11 ресурсов или как условие ошибки для приложений Direct3D 11, но в противном случае оно не обязательно должно быть полезным сообщением конечного пользователя. Для состояния D3D11IH состояние \_ \_ требуется \_ обновление. установщик может напрямую использовать точку входа DLL DoUpdateForDirect3D11 для выполнения обновления и обработки различных результирующих сообщений конечного пользователя. Примеры стандартных сообщений можно найти, изучив диалоговое окно D3D11Install.exe и ресурсы таблицы строк. Для точки входа обновления требуются права администратора.
3.  Гибридный подход заключается в проверке состояния с D3D11InstallHelper.dll, а в случае с кодом состояния D3D11IH для \_ состояния " \_ требуется \_ Последняя версия \_ SP или D3D11IH" \_ \_ требуется \_ обновление, D3D11Install.exe можно выполнить с параметрами **/минимал** и **/y** , чтобы отобразить диалоговое окно или выполнить обновление по мере необходимости. Эти действия должны выполняться на ранних этапах процесса установки, как правило, сразу после&Q, а для запуска исполняемого файла требуются права администратора.

### <a name="integrating-into-installshield"></a>Интеграция с InstallShield

Обработка развертывания Direct3D 11 из Инсталлскрипт InstallShield легко выполняется с помощью примера D3D11InstallHelper. Шаги, необходимые для интеграции с InstallShield с помощью Инсталлскрипт, приведены ниже (при использовании метода 3, описанного в предыдущем разделе):

1.  Откройте проект Инсталлскрипт в редакторе InstallShield.
2.  Добавьте D3D11InstallHelper.dll и D3D11Install.exe в проект в **файлах поддержки**.

    **Добавление файлов в Project InstallShield**

    1.  На вкладке **конструктор установки** щелкните **файлы поддержки и объявления** в разделе **поведение и логика** в области навигации слева.
    2.  Щелкните **независимый от языка**, затем щелкните правой кнопкой мыши в окне **файлы** и выберите команду **Вставить файлы**. Перейдите к добавлению D3D11InstallHelper.dll и D3D11Install.exe. По умолчанию эти файлы находятся в папке: корневые \\ примеры SDK \\ C++ \\ Прочие \\ bin \\ x86

3.  В обозревателе Инсталлскрипт щелкните файл Инсталлскрипт (обычно Setup. RUL), который будет вызывать библиотеку DLL или исполняемый файл, расположенный в разделе **поведение и логика** в области навигации слева.
4.  Вставьте следующий Инсталлскрипт в файл, расположенный ближе к началу:

    ``` syntax
#define D3D11IH_STATUS_INSTALLED       0
#define D3D11IH_STATUS_NOT_SUPPORTED   1
#define D3D11IH_STATUS_REQUIRES_UPDATE 2
#define D3D11IH_STATUS_NEED_LATEST_SP  3
#define D3D11IH_STATUS_ERROR           -1
    prototype NUMBER D3D11InstallHelper.CheckDirect3D11StatusIS();

#define D3D11IH_RESULT_SUCCESS                0
#define D3D11IH_RESULT_SUCCESS_REBOOT         1
#define D3D11IH_RESULT_NOT_SUPPORTED          2
#define D3D11IH_RESULT_UPDATE_NOT_FOUND       3
#define D3D11IH_RESULT_UPDATE_DOWNLOAD_FAILED 4
#define D3D11IH_RESULT_UPDATE_INSTALL_FAILED  5
#define D3D11IH_RESULT_WU_SERVICE_ERROR       6
#define D3D11IH_RESULT_ERROR                  -1
    prototype NUMBER D3D11InstallHelper.DoUpdateForDirect3D11IS(BOOL);
    ```

5.  Вставьте следующий Инсталлскрипт в файл в функции **онфирстуибефоре** непосредственно перед возвращаемым 0:

    ``` syntax
    Dlg_D3D11:
        UseDLL( SUPPORTDIR ^ "D3D11InstallHelper.DLL" );
        nResult = D3D11InstallHelper.CheckDirect3D11StatusIS();   
        UnUseDLL( SUPPORTDIR ^ "D3D11InstallHelper.DLL" );
        
        if ( nResult = D3D11IH_STATUS_REQUIRES_UPDATE
             || nResult = D3D11IH_STATUS_NEED_LATEST_SP) then
            nResult = LaunchAppAndWait(
    SUPPORTDIR^"D3D11Install.exe",
    "/minimal /y", WAIT);
            if ( nResult < 0 ) then
                MessageBox("Unable to launch D3D11Install.exe",
     SEVERE);
            elseif ( nResult == 1 ) then
                BATCH_INSTALL = 1;
            endif;          
        endif;
    ```

### <a name="integrating-into-an-msi-package"></a>Интеграция в пакет MSI

Ниже приведено общее описание действий, необходимых для интеграции развертывания Direct3D 11 с помощью настраиваемых действий MSI (с помощью метода 3, описанного выше в этом разделе):

1.  Добавьте в таблицу свойств MSI свойство с именем **RelativePathToD3D11IH** , содержащее относительный путь к D3D11Install.exe и D3D11InstallHelper.dll во время установки (обычно это происходит в образе носителя). Это также задает для свойства MSI D3D11IH \_ состояние, возвращенное CheckDirect3D11Status (строковое свойство равно символу перечисления или "ошибка").
2.  После действия Костфинализе вызовите функцию D3D11InstallHelper.dll **SetD3D11InstallMSIProperties** в качестве немедленного настраиваемого действия, чтобы задать соответствующие свойства MSI для других настраиваемых действий.
3.  После установки активируйте отложенное настраиваемое действие после действия Инсталлфилес, которое вызывает функцию D3D11InstallHelper.dll **DoD3D11InstallUsingMSI**. Пользовательское действие должно установить флаг msidbCustomActionTypeNoImpersonate для запуска в контексте с повышенными привилегиями.
4.  После действия функции InstallFinalize вызовите функцию D3D11InstallHelper.dll **FinishD3D11InstallUsingMSI** в качестве немедленного настраиваемого действия для выполнения кода результата запроса на перезагрузку, если это необходимо.

Эта процедура подробно описана в следующих инструкциях, в которых описывается процесс, который можно выполнить с помощью редактора MSI, например [редактора Orca](/windows/desktop/Msi/orca-exe). Некоторые редакторы MSI содержат мастера, упрощающие некоторые из этих действий по настройке.

**Настройка пакета MSI для интеграции с D3D11InstallHelper.dll**

1.  Откройте пакет MSI в Orca.
2.  Добавьте строку, показанную в следующей таблице, в двоичную таблицу в пакете MSI.

    | Имя    | Данные                                         |
    |---------|----------------------------------------------|
    | D3D11IH | Путь к файлу DLL \\D3D11InstallHelper.dll |

    

     

    > [!Note]  
    > Этот файл будет внедрен в пакет MSI, поэтому этот шаг необходимо выполнять каждый раз при повторной компиляции D3D11InstallHelper.dll.

     

3.  Добавьте строки, показанные в следующей таблице, в таблицу CustomAction в пакете MSI. 

    | Действие              | Тип                                                                                                                                                                   | Источник  | Назначение                       |
    |---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|------------------------------|
    | Direct3D11SetProps  | Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе = 65                                                                        | D3D11IH | SetD3D11InstallMSIProperties |
    | Direct3D11DoInstall | Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе + msidbCustomActionTypeInScript + msidbCustomActionTypeNoImpersonate = 3137 | D3D11IH | DoD3D11InstallUsingMSI       |
    | Direct3D11Finish    | Мсидбкустомактионтипедлл + Мсидбкустомактионтипебинаридата + Мсидбкустомактионтипеконтинуе = 65                                                                        | D3D11IH | FinishD3D11InstallUsingMSI   |

    

     

4.  Добавьте значения, показанные для действия, условия и последовательности в следующей таблице, в таблицу Инсталлексекутесекуенце в пакете MSI. 

    | Действие              | Условие     | Последовательность | Примечания                                                                                                                                                          |
    |---------------------|---------------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | Direct3D11SetProps  |               | 1016     | Порядковый номер помещает действие в ближайшее время после Костфинализе.                                                                                                 |
    | Direct3D11DoInstall | НЕ установлено | 4004     | Это пользовательское действие выполняется только во время новой установки для всех пользователей. Порядковый номер помещает действие после Инсталлфилес и после отката. |
    | Direct3D11Finish    |               | 6615     | Порядковый номер помещает действие в ближайшее время после функции InstallFinalize.                                                                                              |

    

     

5.  Добавьте строку, показанную в следующей таблице, в таблицу **свойств** в пакете MSI. 

    | Свойство              | Значение                                                                        |
    |-----------------------|------------------------------------------------------------------------------|
    | RelativePathToD3D11IH | относительный путь к файлу, содержащий D3D11Install.exe и D3D11InstallHelper.dll |

    

     

    > [!Note]  
    > Расположение, указанное в пути, указывается относительно расположения, указанного в пути установки, например Redist \\ .

     

6.  Сохраните пакет MSI. более подробные сведения о пакетах MSI и установщик Windows см. в разделе [установщик Windows](/windows/desktop/Msi/windows-installer-portal).

## <a name="debugging-tips"></a>Советы по отладке

и D3D11InstallHelper.dll, и D3D11Install.exe могут быть построены с конфигурацией отладки в Visual Studio, и эти версии будут печатать сообщения в механизм вывода отладки "стандартный Windows".

## <a name="corporate-settings"></a>Параметры организации

пример D3D11InstallHelper предназначен для стандартного развертывания с помощью Центр обновления Windows, который является наиболее распространенным сценарием для установки игр потребителями. однако многие разработчики игр, работающие с издателями и в studios разработки, делают это в корпоративных параметрах, имеющих локально управляемый сервер, предоставляющий обновления программного обеспечения с помощью технологии Windows Server Update Services (WSUS). В среде этого типа Локальный ИТ-администратор имеет возможность управления тем, какие обновления становятся доступными для компьютеров в корпоративной сети, а Стандартная пользовательская версия обновления KB 971644 недоступна.

Существует три основных решения для развертывания DirectX 11 в корпоративном или корпоративном параметре:

-   в некоторых конфигурациях можно напрямую проверить Центр обновления Windows, а не использовать локально управляемый WSUS-сервер. По этой причине D3D11InstallHelper поддерживает параметр командной строки **/Ву** . Однако не все корпоративные сети разрешают подключения к общедоступным серверам Майкрософт.
-   Локальный ИТ-администратор может утвердить KB 971512, поддерживаемое корпоративным обновлением из WSUS, которое включает в себя API Direct3D 11. Это единственный вариант, позволяющий стандартному пользователю получить обновление Direct3D 11 в полностью заблокированной среде.
-   Кроме того, [KB 971512](https://support.microsoft.com/kb/971512/) можно установить вручную.

Очень редко компьютер-любителей может получать обновления только с локально управляемого WSUS-сервера, и только разработчики в крупных организациях, скорее всего, будут находиться в таких средах.

## <a name="related-articles"></a>Похожие статьи

[Брандмауэр Windows для разработчиков игр](/windows/desktop/DxTechArts/games-and-firewalls)

[Windows Обозреватель игр для разработчиков игр](/windows/desktop/DxTechArts/windows-game-explorer-integration)