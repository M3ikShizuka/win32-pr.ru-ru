---
description: Изменения в системной палитре для устройства отображения могут иметь значительные и иногда нежелательные эффекты на цветах, используемых в Windows на рабочем столе.
ms.assetid: 9c470b6f-c0d3-462e-9649-1f39b06bd543
title: Сообщения палитры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a82c5ae2727e9f687f5f7fb628279b7832e896991f703225beec075a6630133
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119558444"
---
# <a name="palette-messages"></a>Сообщения палитры

Изменения в системной палитре для устройства отображения могут иметь значительные и иногда нежелательные эффекты на цветах, используемых в Windows на рабочем столе. Чтобы уменьшить влияние этих изменений, система предоставляет набор сообщений, которые помогают приложениям управлять своими логическими палитрами, одновременно обеспечивая максимально близкое цветовое значение в активном окне к нужным цветам.

Система отправляет сообщение [**WM \_ куериневпалетте**](wm-querynewpalette.md) в окно верхнего уровня или перекрытие перед активацией окна. Это сообщение дает приложению возможность выбрать и реализовать ее логическую палитру, чтобы она получала лучшее возможное сопоставление цветов для логической палитры. Когда приложение получает сообщение, оно должно использовать функции [**селектпалетте**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette), [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject)и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) для выбора и реализации логической палитры. Это направляет систему на обновление цветов в системной палитре таким образом, чтобы ее цвета соответствовали максимальному числу цветов в логической палитре.

Когда приложение вызывает изменения в системной палитре в результате реализации логической палитры, система отправляет сообщение [**WM \_ палеттечанжед**](wm-palettechanged.md) всем окнам верхнего уровня и перекрывающихся окон. Это сообщение предоставляет приложениям возможность обновлять цвета в клиентских областях окна, заменяя цвета, которые были изменены, цветами, более точно соответствующими нужным цветам. Приложение, получающее сообщение **WM \_ палеттечанжед** , должно использовать [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) для сброса логических палитр, связанных со всеми неактивными окнами, а затем обновлять цвета в клиентской области для каждого неактивного окна с помощью функции [**упдатеколорс**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) . Этот метод не гарантирует наибольшее число точных совпадений цветов. Однако это гарантирует, что цвета в логической палитре сопоставлены с разумными цветами в системной палитре.

> [!Note]  
> Чтобы избежать создания бесконечного цикла, приложение никогда не должно понимать палитру для окна, чей Handle соответствует маркеру, переданному в параметре *wParam* сообщения [**WM \_ палеттечанжед**](wm-palettechanged.md) .

 

Функция [**упдатеколорс**](/windows/desktop/api/Wingdi/nf-wingdi-updatecolors) обычно обновляет клиентскую область неактивного окна быстрее, чем перерисовка области. Однако, поскольку **упдатеколорс** выполняет преобразование цветов на основе цвета каждого пикселя до изменения системной палитры, каждый вызов этой функции приводит к утрате некоторой точности цвета. Это означает, что **упдатеколорс** нельзя использовать для обновления цветов, когда окно станет активным. В таких случаях приложение должно перерисовывать клиентскую область.

Система может отправить сообщение [**WM \_ куериневпалетте**](wm-querynewpalette.md) при внесении изменений в логическую палитру. Кроме того, система может отправить сообщение [**WM \_ палеттеисчангинг**](wm-paletteischanging.md) всем окнам верхнего уровня и перекрывающихся окон при изменении системной палитры.

 

 



