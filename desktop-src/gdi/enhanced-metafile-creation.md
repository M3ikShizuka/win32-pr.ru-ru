---
description: Для создания расширенного метафайла используется функция Креатинхметафиле, предоставляя соответствующие аргументы.
ms.assetid: b012e50e-a7f5-4687-9833-38dacc113d77
title: Расширенное создание метафайлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c89a4a05a18ecce4bc1b1fe3689e4f7a8dc64c833db4eac937da4f9a290dd3ec
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119831994"
---
# <a name="enhanced-metafile-creation"></a>Расширенное создание метафайлов

Для создания расширенного метафайла используется функция [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) , предоставляя соответствующие аргументы. Система использует эти аргументы для сохранения размеров изображения, определяет, должен ли метафайл храниться на диске или в памяти и т. д.

Чтобы поддерживать размеры изображений на выходных устройствах, [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) требует разрешения эталонного устройства. Это устройство, на котором впервые появилось изображение, а *ссылочный контроллер домена* — это *контекст устройства* , связанный с *устройством-ссылкой* . При вызове функции **креатинхметафиле** необходимо указать маркер, идентифицирующий этот контроллер домена. Этот обработчик можно получить, вызвав функцию [**GetDC**](/windows/desktop/api/Winuser/nf-winuser-getdc) или [**креатедк**](/windows/desktop/api/Wingdi/nf-wingdi-createdca) . Можно также указать **значение NULL** в качестве маркера для использования текущего устройства дисплея для эталонного устройства.

Большинство приложений постоянно хранят изображения и, следовательно, создают расширенный метафайл, хранящийся на диске. Однако в некоторых случаях это не требуется. Например, приложение для обработки текстов, которое предоставляет возможности рисования диаграмм, может хранить определенную пользователем диаграмму в памяти в виде расширенного метафайла, а затем копировать в файл документа пользователя расширенные метафайлы из памяти. Приложение, которое требует постоянного сохранения на диске метафайла, должно указывать имя файла при вызове [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea). Если имя файла не указано, система автоматически рассчитает метафайл как временный файл и сохранит его в памяти.

В метафайл, содержащий сведения о снимке и авторе, можно добавить необязательное текстовое описание. Приложение может отображать эти строки в диалоговом окне открытия файла, чтобы предоставить пользователю сведения о содержимом метафайлов, которые помогут выбрать соответствующий файл. Если приложение содержит текстовое описание, оно должно предоставить указатель на строку при вызове [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea).

Когда [**креатинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-createenhmetafilea) завершается, возвращается маркер, который идентифицирует специальный контекст устройства Metafile. Контекст устройства метафайла уникален в том, что он связан с файлом, а не с устройством вывода. Когда система обрабатывает функцию GDI, которая получила маркер для контекста устройства метафайла, она преобразует функцию GDI в запись расширенного метафайла и добавляет запись в конец расширенного метафайла.

После завершения изображения и добавления последней записи к расширенному метафайлу приложение может закрыть файл, вызвав функцию [**клосинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-closeenhmetafile) . Эта функция закрывает и удаляет специальный контекст устройства метафайла и возвращает маркер, идентифицирующий расширенный метафайл.

Чтобы удалить метафайл с расширенным форматом или расширенный формат метафайлов, вызовите функцию [**делетинхметафиле**](/windows/desktop/api/Wingdi/nf-wingdi-deleteenhmetafile) .

 

 



