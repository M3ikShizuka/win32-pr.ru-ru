---
description: Система поддерживает системную палитру для каждого устройства, использующего палитры.
ms.assetid: 4c93ce8c-6b3a-4016-bb47-786c25b93374
title: Системная палитра
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e540bd4068989a3c457568c2451dbc91f77755065f3bc70af03f9577fcebee9
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117698136"
---
# <a name="system-palette"></a>Системная палитра

Система поддерживает *системную палитру* для каждого устройства, использующего палитры. Системная палитра содержит цветовые значения для всех цветов, которые в настоящее время могут быть отображены или выведены устройством. В отличие от просмотра содержимого системной палитры, приложения не могут напрямую получить доступ к системной палитре. Вместо этого система имеет полный контроль над системной палитрой и разрешает доступ только с помощью логических палитр.

Приложение может просматривать содержимое системной палитры с помощью функции [**жетсистемпалеттинтриес**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) . Эта функция получает содержимое одной или нескольких записей вплоть до общего числа записей в системной палитре. Итог всегда равен числу, возвращенному для значения СИЗЕПАЛЕТТЕ функцией [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) , и совпадает с максимальным размером для любой указанной логической палитры.

Хотя приложения не могут изменять цвета в системной палитре напрямую, они могут вызвать изменения при реализации логических палитр. Чтобы реализовать палитру, система проверяет каждый запрошенный цвет и пытается найти в системной палитре запись, содержащую точное совпадение. Если система находит соответствующий цвет, она сопоставляет индекс логической палитры с соответствующим индексом системной палитры. Если система не находит точное совпадение, то перед сопоставлением индексов копирует запрошенный цвет в неиспользуемую запись системной палитры. Если все записи палитры системы используются, система сопоставляет индекс логической палитры с записью системной палитры, цвет которой наиболее полно соответствует запрошенному цвету. После установки этого сопоставления приложения не могут его переопределить. Например, приложения не могут использовать индексы системной палитры для указания цветов. разрешены только индексы логической палитры.

Приложения могут изменять способ сопоставления индексов, устанавливая для элемента **пефлагс** структуры [**палеттинтри**](/previous-versions//dd162769(v=vs.85)) значения, выбранные при создании логической палитры. Например, \_ флаг "НЕсвернутый компьютер" направляет систему на немедленное копирование запрошенного цвета в неиспользуемую запись системной палитры независимо от того, содержит ли эта запись в системной палитре этот цвет. Кроме того, при явном \_ флаге ПК система сопоставляет логический индекс палитры с явно заданным индексом системной палитры. (Приложение предоставляет индекс системной палитры в младшем слове структуры **палеттинтри** .)

Палитры можно реализовать в виде палитры фона или переднего плана, указав **true** или **false** соответственно для параметра *бфорцебаккграунд* в функции [**селектпалетте**](/windows/desktop/api/Wingdi/nf-wingdi-selectpalette) . В системе может быть только одна цветовая палитра. Если окно является активным в данный момент окном или потомком текущего активного окна, он может реализовать палитру переднего плана. В противном случае палитра будет реализована как палитра фона независимо от значения параметра *бфорцебаккграунд* . Критическое свойство палитры переднего плана состоит в том, что при реализации она может перезаписывать все записи (за исключением статических записей) в системной палитре. Система выполняет эту задачу, помечая все записи, не являющиеся статическими в системной палитре, как неиспользуемые перед реализацией палитры переднего плана, тем самым исключая все используемые записи. В системной палитре не выполняется предварительная обработка для реализации палитры фона. В палитре переднего плана устанавливаются все возможные нестатические цвета. Фоновые палитры могут устанавливать только те, которые остаются открытыми и имеют приоритет по принципу «первым пришел». Как правило, приложения используют фоновые палитры для дочерних окон, которые реализуют собственные отдельные палитры. Это помогает снизить количество изменений, происходящих в системной палитре.

Неиспользуемая запись системной палитры — это любая запись, которая не является зарезервированной и не содержит статического цвета. Зарезервированные записи явным образом помечаются \_ зарезервированным ЗНАЧЕНИЕМ ПК. Эти записи создаются, когда приложение реализует логическую палитру для анимации палитры. Статические записи цветов создаются системой и соответствуют цветам в палитре по умолчанию. Функцию [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) можно использовать для получения значения нумресервед, которое указывает количество записей системной палитры, зарезервированных для статических цветов.

Так как системная палитра содержит ограниченное число записей, выбор и реализация логической палитры для конкретного устройства может повлиять на цвета, связанные с другими логическими палитрами для того же устройства. Эти изменения цвета особенно различны при возникновении на экране. Приложение может обеспечить использование разумных цветов для выбранной в данный момент логической палитры путем сброса палитры перед каждым использованием. Приложение сбрасывает палитру, вызывая функции [**унреализеобжект**](/windows/desktop/api/Wingdi/nf-wingdi-unrealizeobject) и [**реализепалетте**](/windows/desktop/api/Wingdi/nf-wingdi-realizepalette) . Использование этих функций приводит к тому, что система переназначит цвета логической палитры в разумные цвета в системной палитре.

 

 
