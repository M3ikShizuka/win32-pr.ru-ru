---
description: Общее диалоговое окно Шрифт упрощает процесс создания и выбора шрифтов.
ms.assetid: 7183be25-a8e4-47a0-a34a-63eadf6ca10d
title: Создание и выбор шрифта
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37b4a70a1a49fc318ca69998d97e15fca838668d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104997391"
---
# <a name="font-creation-and-selection"></a>Создание и выбор шрифта

Общее диалоговое окно **Шрифт** упрощает процесс создания и выбора шрифтов. При инициализации структуры [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) и вызове функции [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) приложение может поддерживать тот же интерфейс выбора шрифта, который ранее требовал много строк пользовательского кода. (Дополнительные сведения о диалоговом окне **Шрифт** Common см. в разделе [Библиотека общих диалоговых окон](../dlgbox/common-dialog-box-library.md).)

## <a name="selection-by-the-user"></a>Выбор пользователем

Большинство операций создания и выбора шрифтов затрагивают пользователя. Например, приложения обработки текста позволяют пользователю выбирать уникальные шрифты для заголовков, сносок и основного текста. После того как пользователь выберет шрифт с помощью диалогового окна **Шрифт** и нажмет кнопку **ОК** , функция [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta) инициализирует элементы структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) атрибутами запрошенного шрифта. Чтобы использовать этот шрифт для операций вывода текста, приложение должно сначала создать логический шрифт, а затем выбрать этот шрифт в контексте устройства. *Логический шрифт* — это предоставляемое приложением описание идеального шрифта. Разработчик может создать логический шрифт, вызвав функции [**CreateFont**](/windows/desktop/api/Wingdi/nf-wingdi-createfonta) или [**CreateFontIndirect**](/windows/desktop/api/Wingdi/nf-wingdi-createfontindirecta) . В этом случае приложение вызовет [**CreateFontIndirect**](/windows/win32/api/wingdi/nf-wingdi-createfontindirecta) и предоставляет указатель на структуру [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) , инициализированную [**CHOOSEFONT**](/windows/win32/api/commdlg/ns-commdlg-choosefonta). Как правило, вызов **CreateFontIndirect** более эффективен, так как [**CreateFont**](/windows/win32/api/wingdi/nf-wingdi-createfonta) требует несколько параметров, а **CreateFontIndirect** требует только одного указателя на **LOGFONT**.

Прежде чем приложение сможет начать рисование текста с помощью логического шрифта, оно должно найти ближайшее соответствие из шрифтов, хранящихся внутри устройства, и шрифтов, ресурсы которых были загружены в операционную систему. Шрифты, хранящиеся на устройстве или в операционной системе, называются *физическими шрифтами*. Процесс поиска физического шрифта, который наиболее полно соответствует заданному логическому шрифту, называется сопоставлением шрифтов. Этот процесс происходит, когда приложение вызывает функцию [**SelectObject**](/windows/desktop/api/Wingdi/nf-wingdi-selectobject) и предоставляет маркер, идентифицирующий логический шрифт. Сопоставление шрифтов выполняется с помощью внутреннего алгоритма, который сравнивает атрибуты запрошенного логического шрифта с атрибутами доступных физических шрифтов. Когда алгоритм сопоставления шрифтов завершает Поиск и определяет ближайшее возможное совпадение, функция [**SelectObject**](/windows/win32/api/wingdi/nf-wingdi-selectobject) возвращает значение, и приложение может начать рисование текста с помощью нового шрифта.

Функция [**сетмапперфлагс**](/windows/desktop/api/Wingdi/nf-wingdi-setmapperflags) указывает, будет ли алгоритм сопоставления шрифтов искать только физические шрифты с пропорциями, соответствующими физическому устройству. Пропорции устройства — это отношение, сформированное по ширине и высоте пикселя на этом устройстве.

Системный шрифт (также называемый оболочкой или шрифтом по умолчанию) — это шрифт, используемый для текста в заголовках, меню и диалоговых окнах.

## <a name="special-font-selection-considerations"></a>Специальные рекомендации по выбору шрифтов

Хотя большинство операций выбора шрифтов затрагивает пользователя, существуют некоторые экземпляры, в которых это не так. Например, разработчику может потребоваться использовать уникальный шрифт в приложении для рисования текста в окне управления. Чтобы выбрать подходящий шрифт, приложение должно иметь возможность определить доступные шрифты, создать логический шрифт, который описывает один из этих доступных шрифтов, а затем выбрать этот шрифт в соответствующем контексте устройства.

Приложение может перечислить доступные шрифты с помощью функций [**енумфонтс**](/windows/desktop/api/Wingdi/nf-wingdi-enumfontsa) или [**EnumFontFamilies**](/windows/desktop/api/Wingdi/nf-wingdi-enumfontfamiliesa) . Рекомендуется использовать [**EnumFontFamilies**](/windows/win32/api/wingdi/nf-wingdi-enumfontfamiliesa) , так как он перечисляет все стили, связанные с именем семейства. Это может быть полезно для шрифтов с множеством или необычными стилями и для шрифтов, пересекающих международные границы.

Когда приложение перечислит доступные шрифты и подходящее совпадение, оно должно использовать значения, возвращенные функцией перечисления шрифтов для инициализации элементов структуры [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) . Затем он может вызвать функцию [**CreateFontIndirect**](/windows/desktop/api/Wingdi/nf-wingdi-createfontindirecta) , передав ей указатель на инициализированную структуру [**LOGFONT**](/windows/win32/api/wingdi/ns-wingdi-logfonta) . Если функция [**CreateFontIndirect**](/windows/win32/api/wingdi/nf-wingdi-createfontindirecta) выполнена успешно, приложение может выбрать логический шрифт, вызвав функцию [**SelectObject**](/windows/desktop/api/Wingdi/nf-wingdi-selectobject) . При инициализации элементов структуры **LOGFONT** не забудьте указать определенную кодировку в элементе **лфчарсет** . Этот элемент важен в процессе сопоставления шрифтов, и результаты будут непоследовательными, если этот элемент не инициализирован правильно. Если указать имя гарнитуры в элементе **лффаценаме** структуры **LOGFONT** , убедитесь, что значение **лфчарсет** совпадает с кодировкой шрифта, указанного в **лффаценаме**. Например, если вы хотите выбрать шрифт, например MS Минчо, **лфчарсет** должен иметь предварительно заданное значение символов shiftjis \_ CharSet.

Шрифты для многих восточноазиатских языков имеют два названия гарнитуры: имя на английском языке и локализованное имя. [**CreateFont**](/windows/desktop/api/Wingdi/nf-wingdi-createfonta), [**CreateFontIndirect**](/windows/desktop/api/Wingdi/nf-wingdi-createfontindirecta)и [**креатефонтиндиректекс**](/windows/desktop/api/Wingdi/nf-wingdi-createfontindirectexa) используют локализованное название гарнитуры для языкового стандарта системы, совпадающего с языком, но они принимают название гарнитуры английского языка для всех других языковых стандартов системы. Лучший способ — попробовать одно имя, а в случае сбоя — попробовать другое. Обратите внимание, что [**енумфонтс**](/windows/win32/api/wingdi/nf-wingdi-enumfontsa), [**EnumFontFamilies**](/windows/win32/api/wingdi/nf-wingdi-enumfontfamiliesa)и [**EnumFontFamiliesEx**](/windows/desktop/api/Wingdi/nf-wingdi-enumfontfamiliesexa) возвращают название гарнитуры на английском языке, если язык системы не соответствует языку шрифта. Начиная с Windows 2000, это больше не является проблемой, поскольку средство сопоставления шрифтов для [**CreateFont**](/windows/win32/api/wingdi/nf-wingdi-createfonta), [**CreateFontIndirect**](/windows/win32/api/wingdi/nf-wingdi-createfontindirecta)и [**креатефонтиндиректекс**](/windows/win32/api/wingdi/nf-wingdi-createfontindirectexa) распознает любое имя гарнитуры независимо от языкового стандарта.

 

 
