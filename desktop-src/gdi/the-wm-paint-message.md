---
description: Как правило, приложение рисует в окне в ответ на \_ сообщение WM Paint.
ms.assetid: b2317ce9-e775-450e-91f5-00f735f256a3
title: Сообщение WM_PAINT
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 138913771621699abb27d4f5648e732b21a607ff5466ec4766726ab278d46fed
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119965184"
---
# <a name="the-wm_paint-message"></a>Сообщение WM \_ Paint

Как правило, приложение рисует в окне в ответ на сообщение [**WM \_ Paint**](wm-paint.md) . Система отправляет это сообщение в процедуру окна, когда изменения в окне изменили содержимое клиентской области. Система отправляет сообщение, только если в очереди сообщений приложения нет других сообщений.

При получении сообщения [**WM \_ Paint**](wm-paint.md) приложение может вызвать [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) , чтобы получить контекст отображаемого устройства для клиентской области и использовать его в вызовах функций GDI для выполнения любых операций рисования, необходимых для обновления клиентской области. После завершения операций рисования приложение вызывает функцию [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint) , чтобы освободить контекст устройства отображения.

Перед тем как [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) Возвращает контекст устройства вывода, система подготавливает контекст устройства для указанного окна. Сначала он задает область отсечения для контекста устройства, которая будет равна пересечению части окна, требующей обновления, и части, видимой пользователю. Перерисовывается только те части окна, которые были изменены. Попытки рисования за пределами этого региона обрезаются и не отображаются на экране.

Система может также отправить сообщения [**WM \_ Нкпаинт**](wm-ncpaint.md) и [**WM \_ ерасебкгнд**](../winmsg/wm-erasebkgnd.md) в процедуру окна до возврата [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) . Эти сообщения направляют приложение для рисования области неклиентской и фонового фона окна. *Неклиентская область* — это часть окна, находящегося за пределами клиентской области. Область включает такие функции, как заголовок окна, меню окно (также называемое **системным** меню) и полосы прокрутки. Большинство приложений используют функцию окна по умолчанию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca), чтобы нарисовать эту область и, следовательно, передать ей сообщение **WM \_ нкпаинт** в эту функцию. *Фон окна* — это цвет или шаблон, который заполняется окном до начала выполнения других операций рисования. Фон охватывает все изображения, ранее находились в окне или на экране под окном. Если окно принадлежит классу окна, имеющему кисть фона класса, функция **дефвиндовпрок** автоматически рисует фон окна.

[**Бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) заполняет структуру [**PAINTSTRUCT**](/windows/win32/api/winuser/ns-winuser-paintstruct) данными, например измерениями обновляемой части окна, и флагом, указывающим, нарисован ли фон окна. Приложение может использовать эти сведения для оптимизации рисования. Например, он может использовать измерения области обновления, заданные элементом **члене rcpaint структуры** , чтобы ограничить рисование только теми частями окна, которые требуют обновления. Если приложение имеет очень простой вывод, оно может игнорировать регион обновления и рисовать во всем окне, полагаться на то, что система будет отклонять (обрезать) все ненужные выходные данные. Так как рисунки, выходящие за пределы вырезанной области, отображаются на экране, отображается только прорисовка, находящаяся в области обновления.

[**Бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint) задает для области обновления окна **значение NULL**. Это очищает область, предотвращая создание последующих сообщений [**WM \_ Paint**](wm-paint.md) . Если приложение обрабатывает сообщение **WM \_ Paint** , но не вызывает **бегинпаинт** или иным образом очищает регион обновления, приложение по---получит сообщения **WM \_ Paint** , пока регион не пуст. Во всех случаях приложение должно очистить область обновления перед возвратом из сообщения **WM \_ Paint** .

После завершения рисования приложение должно вызвать [**ендпаинт**](/windows/desktop/api/Winuser/nf-winuser-endpaint). В большинстве окон **ендпаинт** освобождает контекст устройства вывода, делая его доступным для других окон. **Ендпаинт** также показывает курсор, если он ранее был скрыт [**бегинпаинт**](/windows/desktop/api/Winuser/nf-winuser-beginpaint). **Бегинпаинт** скрывает курсор, чтобы избежать повреждения операций рисования.

-   [Регион обновления](the-update-region.md)
-   [Идет непроверка и проверка региона обновления](invalidating-and-validating-the-update-region.md)
-   [Получение региона обновления](retrieving-the-update-region.md)
-   [Исключение региона обновления](excluding-the-update-region.md)
-   [Синхронное и асинхронное Рисование](synchronous-and-asynchronous-drawing.md)

 

 
