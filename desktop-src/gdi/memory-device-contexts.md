---
description: Чтобы позволить приложениям размещать выходные данные в памяти, а не отправлять их на реальное устройство, используйте специальный контекст устройства для операций точечного рисунка, который называется контекстом устройства памяти.
ms.assetid: 0a682dc4-31a4-43c8-b0b1-ab01986b1dac
title: Контексты устройств памяти
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 63469823e38eb98da5d43ede006e6b1e64af874d300127db6cd4cc7743672d29
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118760062"
---
# <a name="memory-device-contexts"></a>Контексты устройств памяти

Чтобы позволить приложениям размещать выходные данные в памяти, а не отправлять их на реальное устройство, используйте специальный контекст устройства для операций точечного рисунка, который называется *контекстом устройства памяти*. Контроллер домена памяти позволяет системе обрабатывать часть памяти как виртуальное устройство. Это массив битов в памяти, который приложение может временно использовать для хранения цветовых данных для точечных рисунков, созданных на обычной поверхности рисования. Так как точечный рисунок совместим с устройством, контроллер памяти также иногда называют *совместимым контекстом устройства*.

Контроллер домена памяти хранит растровые изображения для конкретного устройства. Приложение может создать контроллер домена памяти, вызвав функцию [**креатекомпатибледк**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) .

Исходным точечным рисунком в памяти DC является просто заполнитель. Его размеры — один пиксель на один пиксель. Прежде чем приложение сможет начать рисование, необходимо выбрать точечный рисунок с соответствующей шириной и высотой в контроллере домена, вызвав функцию [**SelectObject**](/windows/desktop/api/Wingdi/nf-wingdi-selectobject) . Чтобы создать точечный рисунок соответствующих измерений, используйте функцию [**креатебитмап**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmap), [**креатебитмапиндирект**](/windows/desktop/api/Wingdi/nf-wingdi-createbitmapindirect)или [**креатекомпатиблебитмап**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatiblebitmap) . После выбора растрового изображения в КОНТРОЛЛЕРе памяти система заменяет одноразрядный массив массивом, достаточно большим для хранения сведений о цвете для указанного прямоугольника пикселей.

Когда приложение передает маркер, возвращенный функцией [**креатекомпатибледк**](/windows/desktop/api/Wingdi/nf-wingdi-createcompatibledc) , в одну из функций рисования, запрошенные выходные данные не отображаются на поверхности рисования устройства. Вместо этого система сохраняет сведения о цвете для результирующей линии, кривой, текста или области в массиве битов. Приложение может копировать изображение, сохраненное в памяти, обратно на поверхность рисования путем вызова функции [**BitBlt**](/windows/desktop/api/Wingdi/nf-wingdi-bitblt) , ОПРЕДЕЛЯЮЩЕЙ контроллер домена памяти в качестве контекста исходного устройства, а также окна или экрана контроллера домена в качестве контекста целевого устройства.

При отображении DIB или DDB, созданного на основе DIB на устройстве палитры, можно увеличить скорость рисования изображения, разложив логическую палитру в соответствии с макетом системной палитры. Для этого вызовите [**жетдевицекапс**](/windows/desktop/api/Wingdi/nf-wingdi-getdevicecaps) со значением нумресервед, чтобы получить количество зарезервированных цветов в системе. Затем вызовите [**жетсистемпалеттинтриес**](/windows/desktop/api/Wingdi/nf-wingdi-getsystempaletteentries) и заполните первую и последнюю нумресервед/2 записи логической палитры соответствующими системными цветами. Например, если НУМРЕСЕРВЕД имеет значение 20, необходимо заполнить первые и последние 10 записей логической палитры системными цветами. Затем заполните оставшиеся 256-НУМРЕСЕРВЕД цвета логической палитры (в нашем примере — остальные 236 цвета) с цветами из DIB и установите флаг "СВЕРНУТЬ ПК" \_ на каждом из этих цветов.

Дополнительные сведения о цветах и палитрах см. в разделе [цвета](colors.md). Дополнительные сведения о растровых изображениях и операциях точечных рисунков см. в разделе [точечные рисунки](bitmaps.md).

 

 



