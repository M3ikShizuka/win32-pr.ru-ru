---
title: Поддержка нескольких прыжков в WinRM
description: Windows Удаленное управление (WinRM) поддерживает делегирование учетных данных пользователя на нескольких удаленных компьютерах.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 76be3054fc9c0d624c206cf5a26d7788e763dfc81f1b2069f6abff8736be2388
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120121764"
---
# <a name="multi-hop-support-in-winrm"></a>Поддержка нескольких прыжков в WinRM

Windows Удаленное управление (WinRM) поддерживает делегирование учетных данных пользователя на нескольких удаленных компьютерах. Функция поддержки нескольких прыжков теперь может использовать поставщик службы безопасности учетных данных (CredSSP) для проверки подлинности. CredSSP позволяет приложению делегировать учетные данные пользователя с клиентского компьютера на целевой сервер.

Проверка подлинности CredSSP предназначена для сред, где нельзя использовать делегирование Kerberos. Добавлена поддержка CredSSP, позволяющая пользователю подключаться к удаленному серверу и иметь возможность доступа к компьютеру второго прыжка, например к общей папке.

Дополнительные сведения о CredSSP см. в статье [KB 951608](https://support.microsoft.com/kb/951608).

> [!Note]  
> Клиенты и серверы WinRM будут поддерживать проверку подлинности CredSSP только с явными учетными данными.

 

## <a name="multi-hop-support-configuration-setup-and-details"></a>Настройка конфигурации поддержки нескольких прыжков и сведения

Существует несколько механизмов настройки параметров WinRM. В следующей процедуре используются служебная программа **WinRM** и редактор групповая политика (**gpedit. msc**). Кроме того, CredSSP можно включить для WinRM с помощью Windows PowerShell. подробные сведения о конфигурации и примеры использования см. в статьях командлеты [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)и [Disable-Windows PowerShell WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) .

Делегирование CredSSP должно быть включено в параметрах клиента и в параметрах службы на удаленном компьютере. Кроме того, для использования CredSSP необходимо настроить [*прослушиватель*](windows-remote-management-glossary.md) HTTP или HTTPS на сервере.

**Настройка поддержки нескольких прыжков с помощью проверки подлинности CredSSP для WinRM**

1.  В параметрах конфигурации клиента необходимо включить CredSSP. Этот флаг можно включить вручную или с помощью параметра групповая политика. Значение по умолчанию — **False**. параметр **разрешить политику проверки подлинности CredSSP** расположен по следующему пути: конфигурация компьютера \\ административный шаблон \\ Windows компоненты \\ служба удаленного управления Windows (winrm) \\ winrm Client.

    Следующая команда демонстрирует использование служебной программы WinRM для включения CredSSP на клиенте WinRM:

    **WinRM set winrm/config/Client/auth @ {CredSSP = "true"}**

2.  В параметрах конфигурации службы WinRM необходимо включить CredSSP. Этот флаг можно включить вручную или с помощью параметра групповая политика. Значение по умолчанию — **False**. политика **разрешить проверку подлинности CredSSP** находится по следующему пути: конфигурация компьютера \\ административный шаблон \\ Windows компоненты \\ служба удаленного управления Windows (winrm) \\ winrm Service.

    Следующая команда демонстрирует использование служебной программы WinRM для включения CredSSP в службе WinRM:

    **WinRM set winrm/config/Service/auth @ {CredSSP = "true"}**

3.  Параметр политики разрешить делегирование новых учетных данных (**алловфрешкредентиалс**) должен быть включен на клиенте WinRM, а имя субъекта-службы (SPN) с префиксом WSMan должно быть добавлено в политику. Имя участника-службы представляет целевой компьютер, которому могут быть делегированы учетные данные пользователя. Имя субъекта-службы можно задать для одного или нескольких компьютеров. В следующей таблице приведены примеры допустимых форматов для имен участников-служб.

    

    | SPN                                       | Описание                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | WSMAN/myComputer. myDomain. com<br/>  | Сервер WinRM, работающий на myComputer.myDomain.com.<br/>                         |
    | WSMAN/ \* . mydomain.com<br/>          | Все серверы WinRM, работающие в myDomain.com.<br/>                               |
    | WSMAN/ \* . fabrikam.mydomain.com<br/> | Все серверы WinRM, работающие в, на всех компьютерах в. fabrikam.myDomain.com.<br/> |

    

     

    дополнительные сведения о настройке групповых политик см. в разделе [установка и настройка для служба удаленного управления Windows](installation-and-configuration-for-windows-remote-management.md).

    Дополнительные сведения о политике **алловфрешкредентиалс** см. в описании политики, предоставляемой редактором групповая политика и [KB 951608](https://support.microsoft.com/kb/951608). Политика **алловфрешкредентиалс** находится по следующему пути: конфигурация компьютера \\ Административные шаблоны \\ \\ Делегирование системных учетных данных.

4.  На сервере должен быть настроен [*прослушиватель*](windows-remote-management-glossary.md) HTTPS или HTTP. Отпечаток сертификата, используемый для настройки *прослушивателя* HTTPS, также используется для настройки параметра CertificateThumbprint в параметрах службы WinRM.

    Следующая команда демонстрирует использование служебной программы WinRM для настройки [*прослушивателя*](windows-remote-management-glossary.md)HTTPS.

    **winrm quickconfig-Transport: HTTPS**

Если проверка подлинности Kerberos между клиентом и сервером невозможна, пользователь должен настроить один из следующих параметров для поддержки нескольких прыжков:

-   Для повышения безопасности пользователь должен добавить атрибут **CertificateThumbprint** в параметр службы WinRM. Если служба WinRM настроена с атрибутом **CertificateThumbprint** , служба пытается нахождение соответствующего сертификата в хранилище локального компьютера и использует этот сертификат для проверки подлинности CredSSP. Если служба WinRM использует сертификат из хранилища локального компьютера для проверки подлинности сервера, учетной записи сетевой службы должен быть разрешен доступ к закрытому ключу сертификата.

    > [!Note]  
    > Если параметр службы не настроен, сервер WinRM использует самозаверяющий сертификат, созданный в памяти для шифрования сообщений, отправляемых клиенту. Однако этот сертификат не используется для проверки подлинности.

     

-   Если ни проверка подлинности Kerberos, ни отпечатки сертификатов не доступны, пользователь может включить проверку подлинности NTLM. Если используется проверка подлинности NTLM, то должна быть включена политика разрешить новые учетные данные с проверкой подлинности сервера только в NTLM (**алловфрешкредентиалсвхеннтлмонли**), а в политику должно быть добавлено имя субъекта-службы с префиксом WSMan. Этот параметр менее безопасен, чем проверка подлинности Kerberos и отпечатки сертификата, так как учетные данные отправляются на сервер без проверки подлинности.

    Дополнительные сведения о политике **алловфрешкредентиалсвхеннтлмонли** см. в описании политики, предоставляемой редактором групповая политика и [KB 951608](https://support.microsoft.com/kb/951608). Политика **алловфрешкредентиалсвхеннтлмонли** находится по следующему пути: конфигурация компьютера \\ Административные шаблоны \\ \\ Делегирование системных учетных данных.

## <a name="using-credssp-authentication-with-explicit-credentials"></a>Использование проверки подлинности CredSSP с явными учетными данными

Пользователь может указать явные учетные данные по протоколам HTTP и HTTPS. Следующая команда демонстрирует использование служебной программы WinRM для выполнения удаленной операции с использованием проверки подлинности CredSSP с явными учетными данными по протоколу HTTPS:

**WinRM OPERATION — Remote: https://myMachine -authentication: CredSSP-имяпользователя: myUsername-Password: myPassword**

 

