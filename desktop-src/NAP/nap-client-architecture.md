---
title: Архитектура клиента NAP
description: клиент NAP — это компьютер под управлением Windows XP с пакетом обновления 3 (sp3), Windows Vista или Windows Server 2008, включающий платформу NAP.
ms.assetid: 163c33c9-b18b-49f9-a2a1-fd90a1dc0826
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: be876cf7f0cf53c1c3c5885d94c43f45c1f79759d80490a0647d5e7d7678fba9
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120037622"
---
# <a name="nap-client-architecture"></a>Архитектура клиента NAP

> [!Note]  
> Платформа защиты доступа к сети недоступна начиная с Windows 10

 

клиент NAP — это компьютер под управлением Windows XP с пакетом обновления 3 (sp3), Windows Vista или Windows Server 2008, включающий платформу NAP.

На этом рисунке показана архитектура платформы NAP на клиенте NAP.

![Архитектура платформы NAP на клиенте NAP](images/nap-client-side-arch.png)

Архитектура клиента NAP состоит из следующих компонентов:

-   Уровень компонентов клиента принудительного применения (EC)

    Каждый NAP EC определяется для доступа к сети другого типа. Например, существует Конфигурация NAP для конфигурации DHCP и NAP EC для удаленного доступа к VPN-подключениям. NAP EC можно сопоставить с конкретным типом точки NAP. Например, DHCP-сервер NAP предназначен для работы с точкой NAP на основе DHCP. Некоторые поставщики услуг защиты доступа к сети (NAP) предоставляются вместе с платформой NAP и сторонними поставщиками программного обеспечения или корпорацией Майкрософт.

-   Уровень компонентов агента работоспособности системы (SHA)

    Компонент SHA обслуживает и сообщает один или несколько элементов работоспособности системы. Например, для подписей антивирусных программ и SHA для обновлений операционной системы может существовать SHA. SHA может быть сопоставлен с сервером обновлений, который представляет собой компьютер, содержащий ресурсы обновления работоспособности, к которым клиенты NAP могут получать доступ для исправления несоответствующих состояний. Например, SHA для проверки подписей антивирусных программ соответствует серверу, содержащему последний файл сигнатур антивирусной программы. SHA не обязательно должен иметь соответствующий сервер обновлений. Например, SHA может просто проверить параметры локальной системы, чтобы обеспечить включение брандмауэра на основе узла. Windows Vista и Windows XP с пакетом обновления 3 включают агент работоспособности Безопасность Windows (Health monitoring Agent), отслеживающий параметры центра Безопасность Windows. Сторонние поставщики программного обеспечения или Майкрософт могут предоставлять дополнительные SHA для платформы NAP.

-   Агент NAP

    Поддерживает текущие сведения о состоянии работоспособности клиента NAP и упрощает взаимодействие между уровнями NAP EC и SHA. Агент NAP предоставляется с платформой NAP.

-   API агента работоспособности системы

    Предоставляет набор функций, которые позволяют SHA регистрироваться в агенте NAP, чтобы указать состояние работоспособности системы, отвечать на запросы о состоянии работоспособности системы от агента NAP, а агенту NAP передать сведения об исправлении работоспособности системы в SHA. API SHA позволяет поставщикам создавать и устанавливать дополнительные SHA. API SHA поставляется с платформой NAP. См. следующие интерфейсы NAP: [**INapSystemHealthAgentBinding2**](inapsystemhealthagentbinding2.md), [**инапсистемхеалсаженткаллбакк**](inapsystemhealthagentcallback.md)и [**инапсистемхеалсажентрекуест**](inapsystemhealthagentrequest.md).

Чтобы указать состояние работоспособности конкретного SHA, SHA создает состояние работоспособности ([**SoH**](/windows/win32/api/naptypes/ns-naptypes-soh)) и передает его агенту NAP. SoH может содержать один или несколько элементов работоспособности системы. Например, SHA для антивирусной программы может создать состояние работоспособности, содержащее состояние антивирусного программного обеспечения, запущенного на компьютере, его версию и Последнее полученное обновление сигнатур Антивируса. Каждый раз, когда агент SHA обновляет состояние, он создает новое состояние работоспособности и передает его агенту NAP. Чтобы указать общее состояние работоспособности клиента NAP, агент NAP использует системное уведомление о работоспособности (Ссох), которое включает сведения о версии для клиента NAP и набор SoH для установленного SHA.

В следующих разделах подробно описаны компоненты клиентской архитектуры NAP.

## <a name="nap-enforcement-client"></a>Клиент принудительной защиты доступа к сети

Клиент принудительного применения NAP (EC) запрашивает определенный уровень доступа к сети, передает состояние работоспособности компьютера точке NAP, предоставляющей доступ к сети. Точки NAP — это компьютеры или устройства доступа к сети, которые используют NAP или могут использоваться с NAP для требования оценки состояния работоспособности клиента NAP и предоставления ограниченного доступа к сети или связи. Если работоспособность компьютера не соответствует требованиям, NAP EC указывает ограниченное состояние клиента NAP на другие компоненты архитектуры клиента NAP.

для платформы nap, предоставляемой в Windows XP с пакетом обновления 3 (SP3), Windows Vista и Windows Server 2008, используется защита доступа к сети (nap):

-   IPsec NAP EC для обмена данными с защитой IPsec.
-   Параметр EAPHost NAP для подключений с проверкой подлинности 802.1 X.
-   VPN-подключение NAP для удаленного доступа к VPN-подключениям.
-   DHCP-сервер NAP для конфигурации IPv4-адресов на основе DHCP.
-   Шлюз служб терминалов NAP для подключений шлюза служб терминалов.

для Windows XP с пакетом обновления 3 (SP3) существует отдельная проверка подлинности NAP для беспроводных и беспроводных подключений 802.1 x.

### <a name="ipsec-nap-ec"></a>IPsec NAP EC

IPsec NAP EC — это компонент, который получает ссох от агента NAP и отправляет его в центр регистрации работоспособности (HRA), на компьютер с Windows Server 2008 и службы IIS (IIS), который получает сертификаты работоспособности от центра сертификации (цс) для соответствующих компьютеров. IPsec NAP EC называется проверяющей стороной IPsec EC в оснастке конфигурации клиента NAP. IPsec в отношении NAP EC также взаимодействует со следующими данными:

-   Хранилище сертификатов для хранения сертификата работоспособности.
-   компоненты IPsec в Windows, чтобы убедиться, что сертификат работоспособности используется для связи, защищенной IPsec.
-   брандмауэр на основе узла (например, Windows firewall), чтобы трафик, защищенный IPsec, был разрешен брандмауэром.

### <a name="eaphost-nap-ec"></a>EAPHost NAP EC

Параметр EAPHost NAP EC — это компонент, который получает Ссох от агента NAP и отправляет его как сообщение протокола PEAP-length-value (TLV) для подключений с проверкой подлинности 802.1 X. В оснастке "Конфигурация клиента NAP" в качестве карантина для протокола EAPHost используется протокол "EAP: EC".

### <a name="vpn-nap-ec"></a>VPN-NAP EC

VPN EC в службе диспетчера подключений удаленного доступа, которая получает Ссох от агента NAP и отправляет ее в виде сообщения PEAP-TLV для подключений VPN удаленного доступа. В оснастке настройки клиента NAP в качестве карантина для удаленного доступа используется VPN-подключение EC.

### <a name="dhcp-nap-ec"></a>DHCP NAP EC

NAP в службе DHCP-клиента использует функции DHCP, которые используют стандартные отраслевые сообщения DHCP для обмена сообщениями о работоспособности системы и ограниченные сведения о доступе к сети. Протокол IPsec EC в оснастке конфигурации клиента NAP называется карантином протокола DHCP EC. DHCP-служба NAP EC получает Ссох из агента NAP. Служба DHCP Client выполняет фрагменты Ссох, если это необходимо, и помещает каждый фрагмент в параметр DHCP, зависящий от поставщика (Майкрософт), который отправляется в сообщениях DHCPDiscover, DHCPRequest или DHCPInform. Сообщения Дхкпдеклине и Дхкпрелеасе не содержат Ссох.

## <a name="system-health-agent"></a>Агент работоспособности системы

Агент работоспособности системы (SHA) выполняет обновления работоспособности системы и публикует свое состояние в виде SoH для агента NAP. SoH содержит сведения, которые сервер политики работоспособности NAP может использовать для проверки того, что клиентский компьютер находится в требуемом состоянии работоспособности. SHA сопоставляется с средством проверки работоспособности системы (SHV) на серверной стороне архитектуры платформы NAP. Соответствующий SHV может возвращать ответ о состоянии работоспособности (SoHR) клиенту NAP, который передается агентом защиты доступа к сети (NAP) и агента NAP, в SHA, уведомляя его о том, что делать, если SHA не находится в требуемом состоянии работоспособности. Например, SoHR, отправленный антивирусным средством SHV, может сообщить соответствующему антивирусному Агенту SHA запрос к серверу сигнатур антивирусного по для получения последней версии файла сигнатур антивирусного по. SoHR также может включать имя или IP-адрес сервера подписи антивируса для запроса.

SHA может использовать локально установленный клиент политики для помощи в функциях управления работоспособностью системы в сочетании с сервером политики. Например, агент SHA обновления программного обеспечения может использовать локально установленное программное обеспечение клиента (клиент политики) для проверки версий и установки и обновления с сервером обновлений программного обеспечения (сервером политики).

## <a name="nap-agent"></a>Агент NAP

Агент NAP предоставляет следующие службы:

-   Собирает SoH из каждого SHA и кэширует их. Кэш SoH обновляется всякий раз, когда агент SHA предоставляет новое или обновленное состояние работоспособности.
-   Сохраняет Ссох и передает его в службу защиты доступа к сети по требованию.
-   Передает уведомления SHA при изменении ограниченного состояния.
-   Поддерживает ограниченное системой состояние системы и собирает сведения о состоянии каждого SHA.
-   Передает Сохрс соответствующему SHA.

 

 




