---
title: Архитектура защиты доступа к сети на стороне сервера
description: Архитектура защиты доступа к сети на стороне сервера
ms.assetid: b05c52d5-1f90-41d4-a540-d20e70e54bcb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6dac585d3c455a1a40f2037b71c0e33cd2bd4847
ms.sourcegitcommit: 3e70ae762629e244028b437420ed50b5850db4e3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "104133530"
---
# <a name="nap-server-side-architecture"></a>Архитектура защиты доступа к сети на стороне сервера

> [!Note]  
> Платформа защиты доступа к сети недоступна начиная с Windows 10

 

Архитектура серверной платформы NAP использует компьютеры под управлением Windows Server 2008. На следующем рисунке показана архитектура поддержки на стороне сервера для платформы NAP, состоящая из точек принудительного применения NAP на основе Windows и сервера политики работоспособности NAP.

![архитектура поддержки платформы NAP на стороне сервера](images/nap-server-side-arch.png)

Точка принудительного применения NAP на основе Windows имеет уровень компонентов сервера защиты доступа к сети (ES). Каждый NAP-протокол определен для доступа к сети или по другому типу связи. Например, существует NAP для удаленного доступа к VPN-подключениям и NAP ES для настройки DHCP. NAP, как правило, соответствует конкретному типу клиента, поддерживающего NAP. Например, DHCP-сервер NAP предназначен для работы с клиентом принудительной защиты доступа к сети на основе DHCP (EC). Сторонние поставщики программного обеспечения или корпорация Майкрософт могут предоставить дополнительную поддержку NAP для платформы NAP. NAP ES получает уведомление системы о работоспособности (Ссох) из соответствующего NAP EC и отправляет его на сервер политики работоспособности NAP в качестве специального атрибута вендора (VSA) для [RADIUS-Access-Request сообщения](https://www.ietf.org/rfc/rfc2865.txt?number=2865) .

Как показано на рисунке архитектуры на стороне сервера, сервер политики работоспособности NAP содержит следующие компоненты:

-   Служба сервера политики сети (NPS)

    Получает сообщение Access-Request RADIUS, извлекает Ссох и передает его компоненту сервера администрирования NAP. Служба NPS поставляется с Windows Server 2008.

-   Сервер администрирования NAP

    Упрощает обмен данными между службой NPS и средствами проверки работоспособности системы (SHV). Компонент сервера администрирования NAP предоставляется с платформой NAP.

-   Уровень компонентов SHV

    Каждый SHV определен для одного или нескольких типов сведений о работоспособности системы и может быть сопоставлен с SHA. Например, можно использовать средство SHV для антивирусной программы. SHV может соответствовать одному или нескольким серверам требований работоспособности. Например, SHV для проверки подписей антивирусных программ соответствует серверу, содержащему последний файл сигнатур. SHV не обязательно должны иметь соответствующий сервер требований к работоспособности. SHV может просто указать, что клиенты с поддержкой защиты доступа к сети должны проверить параметры локальной системы, чтобы обеспечить включение брандмауэра на основе узла. Windows Server 2008 включает в себя средство проверки работоспособности системы безопасности Windows (ИМЕЮЩЕЙСЯ). Дополнительные средства SHV предоставляются сторонними поставщиками программного обеспечения или корпорацией Майкрософт в качестве дополнительных компонентов платформы NAP.

-   API SHV

    Предоставляет набор вызовов функций, которые позволяют SHV регистрироваться в компоненте сервера администрирования NAP, получать уведомления о работоспособности (SoH) от компонента сервера администрирования NAP и отправлять уведомление о состоянии работоспособности (Сохрс) компоненту сервера администрирования NAP. API SHV поставляется с платформой NAP. См. следующие интерфейсы NAP: [**инапсистемхеалсвалидатор**](inapsystemhealthvalidator.md) и [**инапсистемхеалсвалидатионрекуест**](inapsystemhealthvalidationrequest.md).

Как было сказано выше, более распространенная конфигурация для серверной инфраструктуры NAP состоит из точек NAP, обеспечивающих сетевой доступ или взаимодействие определенного типа, а также отдельных серверов политики работоспособности NPS, обеспечивающих проверку работоспособности системы и исправление. Службу NPS можно установить в качестве сервера политики работоспособности NAP для отдельных точек NAP на основе Windows. Однако в этой конфигурации каждая точка NAP должна быть настроена отдельно с помощью политики сетевого доступа и работоспособности. Рекомендуемая конфигурация — использовать отдельные серверы политики работоспособности NAP.

Общая архитектура NAP состоит из следующих наборов компонентов:

-   Три клиентских компонента NAP (уровень SHA, агент NAP и уровень NAP EC).
-   Четыре серверных компонента защиты доступа к сети (уровень SHV, сервер администрирования NAP, служба NPS и уровень NAP ES в точках принудительной защиты доступа к сети на основе Windows).
-   Требования к работоспособности, которые представляют собой компьютеры, которые могут предоставлять текущие требования к работоспособности системы для серверов политики работоспособности NAP.
-   Серверы исправления, которые представляют собой компьютеры, содержащие ресурсы обновления работоспособности, к которым могут обращаться клиенты NAP, чтобы исправлять состояние несоответствия.

На следующем рисунке показаны связи между компонентами платформы NAP.

![отношения между компонентами платформы NAP](images/nap-components.png)

Обратите внимание на соответствие следующих наборов компонентов:

-   NAP ECs и NAP ESs обычно соответствуют друг другу.

    Например, DHCP-сервер NAP на клиенте NAP сопоставляется с DHCP-протоколом NAP на DHCP-сервере.

-   Можно сопоставить серверы SHA и сервера обновлений.

    Например, антивирусный SHA на клиенте соответствует серверу исправления антивирусных подписей.

-   Серверы SHV и требования к работоспособности могут быть сопоставлены.

    Например, антивирусное средство SHV на сервере политики работоспособности NAP может быть сопоставлено с сервером требований к работоспособности антивирусного по.

Сторонние поставщики программного обеспечения могут расширить платформу защиты доступа к сети следующими способами.

-   Создайте новый метод, с помощью которого оценивается работоспособность клиента NAP.

    Сторонние поставщики программного обеспечения должны создать SHA для клиента NAP, SHV для сервера политики работоспособности NAP и, если необходимо, требования к работоспособности и серверы обновлений. Если требования к работоспособности или серверы обновлений уже существуют, например сервер распространения подписей вирусов, необходимо создать только соответствующие компоненты SHA и SHV. В некоторых случаях требования к работоспособности или серверы обновлений не требуются.

-   Создайте новый метод для обеспечения требований к работоспособности для сетевого доступа или обмена данными.

    Сторонние поставщики программного обеспечения должны создать NAP на клиенте NAP. Если в методе применения используется служба Windows, сторонние поставщики программного обеспечения должны создать соответствующий NAP-сервер, который взаимодействует с сервером политики работоспособности NAP с помощью протокола RADIUS или с помощью службы NPS, установленной на точке NAP, в качестве прокси-сервера RADIUS.

В следующих разделах подробно описаны компоненты серверной архитектуры NAP.

## <a name="nap-enforcement-server"></a>Сервер принудительной защиты доступа к сети

Серверы принудительной защиты доступа к сети (NAP) обеспечивают некоторый уровень сетевого доступа или обмена данными, могут передавать состояние работоспособности клиента NAP серверу политики работоспособности сети для оценки, и, в зависимости от ответа, может обеспечить ограниченный доступ к сети.

В Windows Server 2008 включена защита доступа к сети (NAP):

-   IPsec NAP ES для обмена данными с защитой IPsec.

    Для подключений, защищенных с помощью IPsec, центр регистрации работоспособности (HRA), компьютер под управлением Windows Server 2008 и службы IIS (IIS), который получает сертификаты работоспособности от центра сертификации (ЦС) для соответствующих компьютеров, передает сведения о состоянии работоспособности клиента NAP серверу политики работоспособности NAP.

-   DHCP-сервер NAP для настройки IP-адресов на основе DHCP.

    DHCP-сервер защиты доступа к сети — это функция в службе DHCP-сервера, которая использует сообщения DHCP со стандартными отраслевыми средствами для взаимодействия с DHCP NAP в клиенте NAP. Принудительное применение DHCP для ограниченного доступа к сети осуществляется с помощью параметров DHCP.

-   Шлюз служб терминалов (TS) для подключений на основе сервера шлюза TS.

Для подключений VPN удаленного доступа и 802.1 X с проверкой подлинности в службе NPS используются сообщения PEAP-TLV между клиентами NAP и сервером политики работоспособности NAP. Принудительное применение VPN осуществляется с помощью фильтров IP-пакетов, которые применяются к VPN-подключению. принудительное применение 802.1 x осуществляется на устройстве доступа к сети 802.1 X путем применения фильтров IP-пакетов к подключению или путем назначения подключения идентификатора виртуальной ЛС, соответствующего сети с ограниченным доступом.

## <a name="nap-administration-server"></a>Сервер администрирования NAP

Компонент сервера администрирования NAP предоставляет следующие службы:

-   Получает Ссохс от NAP ES через службу NPS.
-   Распространяет SoH в Ссохс на соответствующие средства проверки работоспособности системы (SHV).
-   Собирает Сохрс из SHV и передает их в службу NPS для оценки.

## <a name="nps-service"></a>Служба NPS

RADIUS — это широко развернутый протокол, обеспечивающий централизованную проверку подлинности, авторизацию и учет доступа к сети, которые описаны в статье запросы на комментарии (RFC) 2865 и 2866. Изначально разрабатывался для удаленного доступа по коммутируемому телефону, RADIUS теперь поддерживается точками беспроводного доступа, проверкой подлинности коммутаторов Ethernet, VPN-серверами, серверами доступа к телефонной линии (DSL) и другими серверами доступа к сети.

Сервер политики сети является реализацией сервера RADIUS и прокси в Windows Server 2008. NPS заменяет службу проверки подлинности в Интернете (IAS) в Windows Server 2003. Для платформы NAP служба NPS включает серверный компонент администрирования NAP, поддержку API SHV и устанавливаемые SHV, а также параметры для настройки политик работоспособности.

На основе Сохрс из SHV и настроенных политик работоспособности служба NPS создает системную инструкцию отклика о работоспособности (SSoHR), которая указывает, соответствует ли клиент NAP или не соответствует требованиям, а также включает набор Сохрс из SHV.

## <a name="system-health-validator-shv"></a>Средство проверки работоспособности системы (SHV)

SHV получает состояние работоспособности с сервера администрирования NAP и сравнивает сведения о состоянии работоспособности системы с требуемым состоянием работоспособности системы. Например, если состояние работоспособности определяется антивирусным агентом SHA и содержит номер версии последнего файла сигнатуры вирусов, соответствующий Антивирус SHV может проверить наличие последнего номера версии для проверки SoH клиента NAP на сервере требования к работоспособности антивирусной программы.

SHV возвращает SoHR на сервер администрирования NAP. SoHR может содержать сведения о том, как соответствующий SHA на клиенте NAP может соответствовать текущим требованиям к работоспособности системы. Например, SoHR, отправленный антивирусным средством SHV, может сообщить антивирусному Агенту SHA на клиенте NAP о необходимости запрашивать последнюю версию файла сигнатуры антивирусного по по имени или IP-адресу.

 

 




