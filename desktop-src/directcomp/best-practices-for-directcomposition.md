---
title: Рекомендации по DirectComposition
description: В этом разделе описываются рекомендации по использованию Microsoft DirectComposition.
ms.assetid: D3A1ECD4-9358-44B9-8A84-7D901219D5CD
keywords:
- рекомендации по DirectComposition
- Рекомендуемые методики для DirectComposition
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2f0d19b82b188105c7914e89282c08b12dd4bdc4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103793573"
---
# <a name="best-practices-for-directcomposition"></a>Рекомендации по DirectComposition

> [!NOTE]
> Для приложений в Windows 10 рекомендуется использовать интерфейсы API Windows. UI. компоновки вместо DirectComposition. Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).

В этом разделе описываются рекомендации по использованию Microsoft DirectComposition.

-   [Рекомендации](#best-practices-for-directcomposition)
-   [Вопросы безопасности](#security-considerations)
-   [См. также](#related-topics)

## <a name="best-practices"></a>Рекомендации

В следующей таблице представлены рекомендации, Рекомендуемые для работы с визуальными элементами Microsoft DirectComposition.



| Практика                                                                                                                                                                                                                                                        | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| После создания устройства DirectComposition вызовите метод [**идкомпоситиондевице:: чеккдевицестате**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) в ответ на каждое сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) , чтобы убедиться, что устройство остается действительным.<br/> | Если устройство Microsoft DirectX Graphics Framework (DXGI) теряется, устройство DirectComposition, связанное с устройством DXGI, также теряется. При обнаружении потерянного устройства DirectComposition отправляет сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) всем окнам. Вызов [**чеккдевицестате**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-checkdevicestate) в ответ на каждое сообщение **WM \_ Paint** позволяет определить, является ли объект устройства DirectComposition допустимым и, если нет, предпринять шаги по восстановлению содержимого. <br/> Дополнительные сведения см. в разделе [объект устройства](basic-concepts.md).<br/> |
| Создайте только число визуальных элементов, необходимых для композиции или анимации, и уничтожайте визуальные элементы сразу после того, как DirectComposition завершит их использование.<br/>                                                                                            | DirectComposition использует графический процессор (GPU), ресурс, который приложение использует совместно с другими приложениями и операционной системой. Такой подход гарантирует, что все приложения и операционная система получат достаточно ресурсов GPU.<br/> Дополнительные сведения см. в разделе [визуальные элементы](basic-concepts.md).<br/>                                                                                                                                                                                                                                                                     |
| Не отменяйте отображение визуальных элементов, задав для параметра Opacity значение 0%; Вместо этого следует удалить визуальные элементы из визуального дерева.<br/>                                                                                                                                                          | Для установки значения Opacity в 0% требуются дополнительные системные ресурсы, чем их удаление из визуального дерева.<br/> Дополнительные сведения см. в разделе [прозрачность](effects.md) и [визуальное дерево](basic-concepts.md).<br/>                                                                                                                                                                                                                                                                                                                                                                                      |
| Не следует скрывать визуальный элемент, применяя пустой (нулевой размер) прямоугольник клипа к визуальному элементу. Вместо этого удалите визуальный элемент из визуального дерева. <br/>                                                                                                                 | Удаление визуального элемента из визуального дерева приводит к лучшей производительности, чем применение пустого прямоугольника обрезки.<br/> Дополнительные сведения см. в разделе [Обрезка](clipping.md).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Не применяйте прямоугольник клипа к визуальному элементу, если прямоугольник обрезки не нужен, например, в виде прямоугольника обрезки, включающего все содержимое растрового изображения.<br/>                                                                                       | Ненужные прямоугольники обрезки негативируют производительность системы.<br/> Дополнительные сведения см. в разделе [Обрезка](clipping.md).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Если требуется большой точечный рисунок с одним цветом, создайте уменьшенную поверхность, а затем примените преобразование масштабирования вместо создания поверхности полного размера. <br/>                                                                                                | Применение преобразования масштабирования к меньшей поверхности использует меньше системных ресурсов, чем поверхность полного размера.<br/> Дополнительные сведения см. в разделе [растровые объекты](bitmap-surfaces.md) и [преобразования](transforms.md).<br/>                                                                                                                                                                                                                                                                                                                                                                                     |
| Избегайте применения трехмерных преобразований к нескольким уровням визуального дерева, например к родительскому элементу и его потомкам. <br/>                                                                                                                                        | Применение трехмерных преобразований к нескольким уровням визуального дерева может привести к непредвиденным результатам, так как трехмерные преобразования не умножаются в дереве. Например, поворот на 90 градусов вокруг оси y в дочернем элементе и поворот на 90 градусов вокруг оси y в родительском элементе приводит к повороту обоих визуальных элементов на Nothing.<br/> Дополнительные сведения см. в статье [Эффекты](effects.md).<br/>                                                                                                                                                                                                     |



 

## <a name="security-considerations"></a>Вопросы безопасности

В следующих статьях приводятся рекомендации по написанию безопасного кода C++.

-   [Рекомендации по обеспечению безопасности для C++](/cpp/security/security-best-practices-for-cpp?view=vs-2019)
-   [Шаблоны & рекомендации по обеспечению безопасности для приложений](/previous-versions/msp-n-p/ff650760(v=pandp.10))

## <a name="related-topics"></a>См. также

<dl> <dt>

[Как использовать DirectComposition](how-to-use-directcomposition.md)
</dt> </dl>

 

