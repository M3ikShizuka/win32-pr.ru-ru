---
title: Эффекты (DirectComposition)
description: В этом разделе обсуждаются основы Microsoft DirectComposition Effects и описываются типы эффектов, поддерживаемых DirectComposition.
ms.assetid: 805B17D2-2F6B-4C25-8C6D-41FFA5DFC774
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c9c5119367a35725a85efe20b8ba4d0f9f9887ff91b4d9618e2215bedfbfef67
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117905058"
---
# <a name="effects-directcomposition"></a>Эффекты (DirectComposition)

> [!NOTE]
> для приложений на Windows 10 рекомендуется использовать интерфейсы api Windows. UI. компоновки вместо DirectComposition. Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).

В этом разделе обсуждаются основы Microsoft DirectComposition Effects и описываются типы эффектов, поддерживаемых DirectComposition.

Этот раздел состоит из следующих подразделов.

-   [Что такое DirectCompositionный результат?](#what-is-a-directcomposition-effect)
-   [Непрозрачность](#opacity)
-   [эффекты преобразования трехмерной перспективы](#3d-perspective-transform-effects)
    -   [Трехмерное пространство координат DirectComposition](#the-directcomposition-3d-coordinate-space)
    -   [эффект преобразования трехмерного вращения](#3d-rotation-transform-effect)
    -   [эффект преобразования трехмерного масштабирования](#3d-scaling-transform-effect)
    -   [эффект преобразования 3D-преобразования](#3d-translation-transform-effect)
    -   [эффект трехмерного преобразования матрицы](#3d-matrix-transform-effect)
    -   [Группа эффектов трехмерного преобразования](#3d-transform-effect-group)
-   [Объекты эффектов](#effect-objects)
-   [Связанные темы](#related-topics)

## <a name="what-is-a-directcomposition-effect"></a>Что такое DirectCompositionный результат?

DirectCompositionный *результат* — это операция точечного рисунка, которая применяется во время растрирования визуального элемента, чтобы изменить внешний вид визуального элемента каким-либо образом.

DirectComposition создает действие, создавая визуальное поддерево и выполнив его в одно растровое изображение перед применением этого действия. Например, чтобы создать эффект трехмерного преобразования перспективы, DirectComposition создает изображение визуального поддерева, а затем текстуры изображения на трехмерную плоскость, которая преобразуется в соответствии с результирующей матрицей трехмерного преобразования.

DirectComposition поддерживает следующие типы эффектов.



| Тип результата                                                   | Описание                                                                |
|---------------------------------------------------------------|----------------------------------------------------------------------------|
| [Непрозрачность](#opacity)                                           | Задает прозрачность для всего визуального элемента.                                      |
| [Трехмерное преобразование перспективы](#3d-perspective-transform-effects) | Применяет трехмерный (трехмерный) эффект преобразования перспективы к визуальному элементу. |



 

> [!Note]  
> DirectComposition не выполняет специальной обработки при применении эффектов к трехмерному стерео содержимому. Это означает, что при применении к нему эффектов трехмерное содержимое может искажаться.

 

## <a name="opacity"></a>Непрозрачность

Эффекты непрозрачности позволяют задать коэффициент непрозрачности, применяемый ко всему визуальному элементу при визуализации визуального элемента. Он отличается от альфа-маски тем, что тот же коэффициент непрозрачности применяется ко всем пикселям в визуальном элементе. Непрозрачность указывается как значение в диапазоне от 0 (полностью прозрачное) до 1 (полностью непрозрачный).

Коэффициент непрозрачности применяется от родительского к дочерним визуальным элементам, но видимые эффекты вложенных параметров непрозрачности не указываются в значении свойства отдельных дочерних визуальных элементов. Например, если у корневого визуального элемента есть непрозрачность 50% (0,5) и один из его дочерних элементов имеет уровень непрозрачности 20% (0,2), то непрозрачность для этого дочернего элемента отображается как 10% (0,1), но значение свойства Opacity дочернего элемента по-прежнему будет равно 0,2.

## <a name="3d-perspective-transform-effects"></a>эффекты преобразования трехмерной перспективы

В этом разделе описывается пространство координат, используемое DirectComposition для выполнения эффектов преобразования трехмерной перспективы. Здесь также описываются типы эффектов преобразования трехмерной перспективы, которые поддерживает DirectComposition.

-   [Трехмерное пространство координат DirectComposition](#the-directcomposition-3d-coordinate-space)
-   [эффект преобразования трехмерного вращения](#3d-rotation-transform-effect)
-   [эффект преобразования трехмерного масштабирования](#3d-scaling-transform-effect)
-   [эффект преобразования 3D-преобразования](#3d-translation-transform-effect)
-   [эффект трехмерного преобразования матрицы](#3d-matrix-transform-effect)
-   [Группа эффектов трехмерного преобразования](#3d-transform-effect-group)

> [!Note]  
> В DirectComposition Применение объемных эффектов к нескольким уровням в визуальном дереве не работает так же, как и с полнофункциональным трехмерным механизмом, таким как Microsoft Direct3D. Например, рассмотрим родительский визуальный элемент с одним дочерним визуальным элементом. Если дочерний визуальный элемент поворачивается вперед в z-направлении (вокруг оси y) на 90 градусов, то граница дочернего визуального элемента получит средство просмотра, поэтому мы ожидаем, что визуальный элемент не будет виден (поскольку точечный рисунок не имеет реальной глубины). Если родительский визуальный элемент затем поворачивается назад в отрицательном z-направлении (вокруг оси y) на 90 градусов, мы можем ожидать, что дочерний визуальный элемент станет полностью видимым (так как преобразования будут инвертировать друг друга). Однако в DirectComposition это не так. Дочерний визуальный элемент не будет виден, так как он был выровнен в родительском точечном рисунке.

 

### <a name="the-directcomposition-3d-coordinate-space"></a>Трехмерное пространство координат DirectComposition

Пространство координат DirectComposition для эффектов трехмерного преобразования находит источник (0, 0, 0) в левом верхнем углу поверхности точечного рисунка, а положительные значения оси x — вправо, положительные значения оси y — сверху вниз, а положительные значения оси z — от источника к средству просмотра. На этом рисунке показано DirectComposition трехмерное пространство координат.

![трехмерное пространство координат директкомпостион](images/3d-coordinate-space.png)

### <a name="3d-rotation-transform-effect"></a>эффект преобразования трехмерного вращения

Эффект преобразования 3D-вращения поворачивает визуальный элемент в трех измерениях на указанный угол вокруг вектора оси вращения \[ x, y, z, \] расположенного в указанной центральной точке (x, y, z). Угол указывается в градусах. Вектором оси вращения по умолчанию является \[ 0, 0,-1 \] , а центральная точка по умолчанию — (0, 0, 0).

Используйте метод [**идкомпоситиондевице:: CreateRotateTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createrotatetransform3d) для создания объекта преобразования 3D-вращения. Метод получает интерфейс [**IDCompositionRotateTransform3D**](/windows/win32/api/dcomp/nn-dcomp-idcompositionrotatetransform3d) , который можно использовать для задания свойств объекта.

### <a name="3d-scaling-transform-effect"></a>эффект преобразования трехмерного масштабирования

Эффект трехмерного преобразования масштабирования делает визуальный элемент больше или меньше. Он масштабирует визуальный элемент в \[ направлении x, y, z \] относительно центральной точки (x, y, z). Центральная точка по умолчанию — (0, 0, 0).

Используйте метод [**идкомпоситиондевице:: CreateScaleTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createscaletransform3d) для создания объекта преобразования трехмерного масштабирования. Метод получает интерфейс [**IDCompositionScaleTransform3D**](/windows/win32/api/dcomp/nn-dcomp-idcompositionscaletransform3d) , который можно использовать для задания свойств объекта.

### <a name="3d-translation-transform-effect"></a>эффект преобразования 3D-преобразования

Эффект преобразования 3D-преобразования изменяет расположение визуального элемента в \[ направлении x, y, z \] .

Используйте метод [**идкомпоситиондевице:: CreateTranslateTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtranslatetransform3d) для создания объекта преобразования 3D-преобразования. Метод получает интерфейс [**IDCompositionTranslateTransform3D**](/windows/win32/api/dcomp/nn-dcomp-idcompositiontranslatetransform3d) , который можно использовать для задания свойств объекта.

### <a name="3d-matrix-transform-effect"></a>эффект трехмерного преобразования матрицы

Интерфейс [**IDCompositionMatrixTransform3D**](/windows/win32/api/dcomp/nn-dcomp-idcompositionmatrixtransform) позволяет определить собственную матрицу преобразования 4 на 4 и применить ее к визуальному элементу. Этот интерфейс полезен, если необходимо применить эффект преобразования трехмерной перспективы, который недоступен через другие интерфейсы эффектов трехмерного преобразования DirectComposition. Вы определяете матрицу, заполняя структуру [**D3DMATRIX**](/windows/desktop/direct3d10/d3d10-d3dmatrix) и передавая ее в метод [**IDCompositionMatrixTransform3D:: сетматрикс**](/windows/win32/api/dcomp/nf-dcomp-idcompositionmatrixtransform-setmatrix) . Кроме того, каждый элемент матрицы можно задать с помощью метода [**IDCompositionMatrixTransform3D:: сетматрикселемент**](/previous-versions/windows/desktop/legacy/hh437429(v=vs.85)) .

### <a name="3d-transform-effect-group"></a>Группа эффектов трехмерного преобразования

[**Идкомпоситиондевице:: CreateTransform3DGroup**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtransform3dgroup) создает коллекцию эффектов трехмерного преобразования, которые можно применить к визуальному элементу как к группе. Массив может включать любое количество объектов Transform и может включать преобразования матрицы, вращения, масштабирования и преобразования. Коллекция объектов трехмерного преобразования приводит к преобразованию, значение которого является умножением матрицы отдельных матриц преобразования в коллекции.

Порядок отдельных преобразований в группе важен. Например, если сначала повернуть, затем масштабировать, а затем преобразовать, вы получите другой результат, чем при первом переводе, при повороте, а затем при масштабировании. DirectComposition учитывает порядок, в котором вы указываете трехмерные преобразования в трехмерной группе преобразования так же, как и для двумерных преобразований. Кроме того, преобразования «Трехмерная перспектива» приводят к преобразованию визуального дерева после применения всех трехмерных преобразований в текущем визуальном элементе. Это делается для того, чтобы сцена выглядела как можно более близкая к объемной.

## <a name="effect-objects"></a>Объекты эффектов

Чтобы применить эффекты к визуальному элементу, сначала необходимо создать и задать свойства объекта Effect, представляющего тип результата, который требуется создать на визуальном элементе. Затем необходимо применить объект Effect к свойству Effect визуального элемента.

Чтобы создать объект Effect, используйте один из следующих методов интерфейса [**идкомпоситиондевице**](/windows/win32/api/dcomp/nn-dcomp-idcompositiondevice) , чтобы создать объект Effect для требуемого типа результата. Следующие методы создают объекты эффектов:

-   [**CreateMatrixTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-creatematrixtransform3d)
-   [**CreateRotateTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createrotatetransform3d)
-   [**CreateScaleTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createscaletransform3d)
-   [**CreateTranslateTransform3D**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createtranslatetransform3d)

Каждый из вышеперечисленных методов Извлекает интерфейс, который можно использовать для задания свойств созданного объекта Effect. Используйте методы интерфейса, чтобы задать свойства нужным образом, чтобы получить нужный визуальный результат.

Большинство свойств объекта Effect можно анимировать. Чтобы анимировать определенное свойство, создайте объект анимации и примените его к свойству, которое необходимо анимировать. в противном случае задайте для свойства статическое значение, которое дает нужный результат. Дополнительные сведения о свойствах анимации см. в разделе [анимация](animation.md).

Чтобы применить объект Effect к визуальному элементу, вызовите метод [**идкомпоситионвисуал:: сетеффект**](/windows/win32/api/dcomp/nf-dcomp-idcompositionvisual-seteffect) . При применении к визуальному элементу результат применяется ко всему визуальному поддереву, корню которого является этот визуальный элемент. Например, если установить непрозрачность визуального элемента на 50 процентов, прозрачность всех дочерних визуальных элементов в визуальном поддереве будет уменьшена на 50 процентов. Один и тот же объект Effect можно применить к одному или нескольким визуальным объектам. Если изменить свойства объекта Effect после применения его к визуальным объектам, все визуальные элементы будут внесены заново для отражения изменений.

С помощью объекта группы эффектов можно одновременно применить несколько эффектов к визуальному элементу. Сначала вызовите [**идкомпоситиондевице:: креатиффектграуп**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createeffectgroup) , чтобы создать объект группы эффектов, а затем добавьте эффекты в группу с помощью интерфейса [**идкомпоситионеффектграуп**](/windows/win32/api/dcomp/nn-dcomp-idcompositioneffectgroup) объекта.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Основные понятия DirectComposition](directcomposition-concepts.md)
</dt> </dl>

 

 