---
title: Анимация (DirectComposition)
description: В этом разделе обсуждаются основы анимации Microsoft DirectComposition.
ms.assetid: 65DA3971-97C0-4B59-BC67-287AAEAAE340
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 75b1f021d5a11fac70f47d5fe87f9389d2ad3e3108d224835fb295a8c3216354
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119119144"
---
# <a name="animation-directcomposition"></a>Анимация (DirectComposition)

> [!NOTE]
> для приложений на Windows 10 рекомендуется использовать интерфейсы api Windows. UI. компоновки вместо DirectComposition. Дополнительные сведения см. в разделе [модернизировать The классическое приложение с использованием визуального слоя](/windows/uwp/composition/visual-layer-in-desktop-apps).

В этом разделе обсуждаются основы анимации Microsoft DirectComposition. Занятие содержит следующие разделы:

-   [Что такое анимация?](#what-is-an-animation)
-   [Свойства, которые могут быть анимированы](#properties-that-can-be-animated)
-   [Функции анимации](#animation-functions)
-   [Сегменты анимации](#animation-segments)
    -   [Сегмент в кубических](#cubic-segment)
    -   [Сегмент синусоидальной](#sinusoidal-segment)
    -   [Повторить сегмент](#repeat-segment)
    -   [Конечный сегмент](#end-segment)
-   [совместимость с диспетчером анимации Windows](#compatibility-with-windows-animation-manager)
-   [Связанные темы](#related-topics)

## <a name="what-is-an-animation"></a>Что такое анимация?

*Анимация* — это оптическая иллюзия, которая быстро делает добавочные изменения визуального элемента в течение определенного периода времени, перерисуя визуальный элемент после каждого изменения. Поскольку перерисовки происходят быстро, мозг воспринимается в виде одной изменяющейся сцены, как в фильме или видео о действии в реальном времени.

В следующей таблице описаны некоторые типичные способы использования анимации.

| Анимация                 | Описание                                                                                                                                                                                                                                          |
|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Прокрутка                 | Используйте анимацию, чтобы добавить такие функции, как физическое имитация импульса, в элемент управления "прокручиваемый список".                                                                                                                                                           |
| Переходы сцены         | Используйте анимацию для создания переходов по монтажным кадрам, обеспечивающих непрерывность задач в рабочем процессе. Переходы по монтажным кадрам предоставляют контекст, который показывает пользователя, где они были, где они были, и где они должны идти дальше. |
| Взаимодействие между окнами | Анимация элементов пользовательского интерфейса различных приложений таким образом, что дает возможность восприятия между ними, что позволяет пользователю завершать задачи, связанные с переключением из одного приложения в другое.                                         |



 

## <a name="properties-that-can-be-animated"></a>Свойства, которые могут быть анимированы

В DirectComposition вы выполняете анимацию визуального элемента, применяя анимацию к отдельным свойствам объектов, определяющих визуальный элемент. Например, если требуется переместить визуальный элемент по горизонтали на экран, то анимация будет применена к свойству Оффсеткс визуального элемента. Аналогичным образом, если вы хотите выполнить простой анимированный 2D-поворот визуального элемента, можно применить анимацию к свойству Angle объекта 2D-преобразования, а затем применить объект 2D-преобразования к свойству Transform визуального элемента.

DirectComposition позволяет применять анимацию к любому свойству объекта, которое принимает скалярное значение. Можно применять одновременную анимацию к нескольким свойствам и нескольким объектам.

DirectComposition запускает анимацию в отдельном потоке. Можно запустить анимацию или набор анимаций, а затем выполнить другие действия над потоками приложения или даже перевести потоки в спящий режим, в то время как механизм композиции выполняет анимацию с соответствующей частотой кадров.

## <a name="animation-functions"></a>Функции анимации

DirectComposition анимирует свойство объекта на основе определяемой пользователем функции анимации. *Функция анимации* — это конструкция, которая указывает, как изменяется значение свойства объекта за определенный период времени. Например, можно определить функцию анимации, которая изменяет значение свойства с 1 на 360 в течение 4 секунд. Затем, если применить функцию анимации к свойству Angle объекта преобразования 2D-вращения, а затем применить объект Transform к свойству Transform визуального элемента, функция анимации будет вращать визуальный элемент в полном круге в течение 4 секунд.

Функция анимации представлена *объектом анимации* , созданным путем вызова метода [**Идкомпоситиондевице:: креатеаниматион**](/windows/win32/api/dcomp/nf-dcomp-idcompositiondevice-createanimation) . Вы создаете функцию анимации с помощью методов интерфейса [**идкомпоситионаниматион**](/windows/desktop/api/DcompAnimation/nn-dcompanimation-idcompositionanimation) объекта анимации, чтобы добавлять *сегменты анимации* по одной за раз в массив, определяющий функцию анимации. При добавлении сегмента задается смещение, начинающееся с нуля, которое отмечает время начала сегмента относительно начала функции анимации. Сегменты анимации должны добавляться в порядке возрастания времени начала. Попытка добавить сегмент анимации, время начала которого меньше или равно предыдущему сегменту, завершится ошибкой. Функция анимации может иметь указанное время окончания, указывающее, когда должна завершаться функция.

Если не указано иное, функция анимации запускается, когда диспетчер окон рабочего стола (DWM) получает команду для выполнения анимации. Каждый сегмент выполняется до тех пор, пока не будет достигнуто время начала следующего сегмента. Все ненепрерывные изменения, происходящие в значении анимированного свойства между сегментами, считаются дискретными изменениями.

Функция анимации применяется к свойству путем присвоения свойству значения [**идкомпоситионаниматион**](/windows/desktop/api/DcompAnimation/nn-dcompanimation-idcompositionanimation) указателя объекта анимации, представляющего функцию анимации. Один и тот же объект анимации может применяться к нескольким свойствам одного и того же объекта, а также к свойствам других объектов, созданных тем же устройством.

## <a name="animation-segments"></a>Сегменты анимации

Сегменты анимации являются фундаментальными определениями времени функции анимации. Это примитивы, из которых строятся более сложные и более высокие функции анимации. Сегмент анимации создается на основе ряда параметров, описывающих функцию, и времени начала сегмента относительно начала функции анимации. Для каждого сегмента, время (*t*) выполняется вдоль горизонтальной оси и начинается с *t* = 0.

### <a name="cubic-segment"></a>Сегмент в кубических

Время для сегмента в кубических задается с помощью полинома в кубических отрезков. Для заданного входного значения времени (*t*) выходное значение присваивается следующим уравнением:

*x*(*t*) = *в*³ + *BT*² + *CT*  +  *d*

На следующей диаграмме показана функция анимации, которая содержит два сегмента в кубических кривых. Первый сегмент переводит значение от 0 до 16 в течение 4 секунд, а второй изменяет значение линейно с 16 на 0 в течение следующих 4 секунд. Первый переход выполняется по этому полиному в кубических:

*x*(*t*) = *t*³-6 *t*² + 12 *t*

второй переход выполняется по этому пути:

*x*(*t*) =-4 *t* + 16

![Схема функции анимации с двумя сегментами третьего порядка](images/cubicsegment.png)

Сегмент третьего порядка добавляется в функцию анимации с помощью метода [**идкомпоситионаниматион:: аддкубик**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-addcubic) .

### <a name="sinusoidal-segment"></a>Сегмент синусоидальной

Время сегмента синусоидальной определяется следующим уравнением:

*x*(*t* *) =*  +  *амплитуда* \* -sin (*t* \* *Частота* \* 2 \* Pi + 1 \* )

Вы добавляете сегмент синусоидальной в функцию анимации с помощью метода [**идкомпоситионаниматион:: аддсинусоидал**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-addsinusoidal) .

### <a name="repeat-segment"></a>Повторить сегмент

Повторяющийся сегмент повторяет указанную предыдущую часть функции анимации. Повторяющийся сегмент заставляет указанную часть функции анимации пройти бессрочно до тех пор, пока не встретится следующий сегмент или не достигнет указанного конца анимации. Предыдущая часть анимации состоит из других сегментов, включая другие повторяющиеся сегменты. Сегмент Repeat нельзя использовать в качестве первого сегмента в функции анимации.

На следующей схеме показана функция анимации, состоящая из двух сегментов третьего порядка в 4 секунды, за которыми следует сегмент повторения, продолжительность которого составляет 12 секунд. Сегмент Repeat начинает 8 секунд в анимацию и повторяет предыдущие 6 секунд анимации два раза, пока конечный сегмент не достигнет 20 секунд.

![Схема функции анимации, которая содержит два сегмента в кубических и один повторяющийся сегмент](images/repeatsegment.png)

Чтобы добавить повторяющийся сегмент в функцию анимации, используйте метод [**идкомпоситионаниматион:: аддрепеат**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-addrepeat) .

### <a name="end-segment"></a>Конечный сегмент

После создания функции анимации из сегментов можно добавить конечный сегмент, чтобы функция анимации закончится в определенное время. Если не добавить конечный сегмент, последний сегмент функции анимации будет выполняться неограниченное время.

Чтобы добавить конечный сегмент, вызовите метод [**идкомпоситионаниматион:: end**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-end) , указав смещение от начала функции анимации, которое указывает на конечную точку функции. Смещение должно быть больше начального смещения предыдущего сегмента. Кроме того, конечный сегмент нельзя использовать в качестве первого примитива в функции анимации.

При вызове [**End**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-end)вы также указываете конечное значение анимируемого свойства. В момент достижения конечной точки функции анимации в свойстве задается указанное итоговое значение.

После добавления конечного сегмента к функции анимации нельзя добавить другие сегменты. Это значит, что все вызовы методов для объекта анимации завершаются ошибкой, за исключением [**идкомпоситионаниматион:: Reset**](/windows/desktop/api/DcompAnimation/nf-dcompanimation-idcompositionanimation-reset). Вызов **Reset** возвращает объект анимации, чтобы очистить состояние, в котором функция анимации не содержит сегментов, после чего можно снова добавить сегменты.

## <a name="compatibility-with-windows-animation-manager"></a>совместимость с диспетчером анимации Windows

Windows диспетчер анимации (Windowsная анимация) выводит примитивы анимации в формате, совместимом с API DirectComposition. это означает, что DirectComposition может создавать анимации на основе примитивов анимации, созданных Windows анимацией.

дополнительные сведения см. в разделе [Windows animation Manager](/windows/desktop/UIAnimation/-main-portal), метод [**IUIAnimationVariable2:: скачок**](/windows/desktop/api/uianimation/nf-uianimation-iuianimationvariable2-getcurve) и [управление анимацией DirectComposition с помощью Windows animation Manager версии 2](https://github.com/microsoft/Windows-classic-samples/tree/master/Samples/DirectCompositionWindowsAnimationManager).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Основные понятия DirectComposition](directcomposition-concepts.md)
</dt> </dl>

 

 
