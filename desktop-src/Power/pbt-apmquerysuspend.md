---
description: Запрашивает разрешение на приостановку работы компьютера. Приложение, предоставляющее такое разрешение, должно предварительно выполнить все необходимые действия для приостановки работы.
ms.assetid: 83cb0fdc-437e-4d03-87f0-6a416281c0d5
title: Событие PBT_APMQUERYSUSPEND (WinUser. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: 277e4faf7617037b917dedab3193e421a381166a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103909691"
---
# <a name="pbt_apmquerysuspend-event"></a>\_Событие ПБТ апмкуерисуспенд

\[ПБТ \_ апмкуерисуспенд доступен для использования в операционных системах, указанных в разделе требования. Поддержка этого события была удалена в Windows Vista. Вместо этого используйте [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) .\]

Запрашивает разрешение на приостановку работы компьютера. Приложение, предоставляющее такое разрешение, должно предварительно выполнить все необходимые действия для приостановки работы.

Окно получает это событие через сообщение [**WM \_ поверброадкаст**](wm-powerbroadcast.md) . Параметры *wParam* и *lParam* задаются, как описано ниже.


```C++
LRESULT 
CALLBACK 
WindowProc( HWND   hwnd,    // handle to window
            UINT   uMsg,    // WM_POWERBROADCAST
            WPARAM wParam,  // PBT_APMQUERYSUSPEND
            LPARAM lParam); // action flags
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*HWND* 
</dt> <dd>

Маркер для окна.

</dd> <dt>*uiacp*</dt> <dd> 

| Значение                                                                                                                                                                                                                                                                   | Значение                        |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
| <span id="WM_POWERBROADCAST"></span><span id="wm_powerbroadcast"></span><dl> <dt>**[**WM \_ ПОВЕРБРОАДКАСТ**](wm-powerbroadcast.md)**</dt> <dt>536 (0x218)</dt> </dl> | Идентификатор сообщения.<br/> |



 

</dd> <dt>*wParam*</dt> <dd> 

| Значение                                                                                                                                                                                                                                        | Значение                      |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
| <span id="PBT_APMQUERYSUSPEND"></span><span id="pbt_apmquerysuspend"></span><dl> <dt>**ПБТ \_ АПМКУЕРИСУСПЕНД**</dt> <dt>0 (0x0)</dt> </dl> | Идентификатор события.<br/> |



 

</dd> <dt>

*lParam* 
</dt> <dd>

Флаги действия. Если бит 0 равен 1, приложение может запросить у пользователя инструкции по подготовке к приостановке; в противном случае приложение должно подготовиться без взаимодействия с пользователем. Все остальные битовые значения зарезервированы.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Для предоставления запроса на приостановку возвращается **значение true** . Чтобы отклонить запрос, возвратите **широковещательный \_ запрос \_ Deny**.

## <a name="remarks"></a>Комментарии

Приложение должно обрабатывать это событие как можно быстрее. Приложение может запросить у пользователя инструкции по подготовке к приостановке только в том случае, если установлен бит 0 в параметре *flags* . Однако если это сообщение выдается из-за того, что пользователь закрывает крышку ноутбука, запрос пользователя будет невозможен. Приложения должны учитывать, что пользователь должен иметь определенное поведение при закрытии крышки ноутбука или нажатии кнопки питания и допускать успешность перехода.

Система позволяет приложению приблизительно 20 секунд удалить сообщение [**WM \_ поверброадкаст**](wm-powerbroadcast.md) , которое ОТПРАВЛЯЕТ \_ событие апмкуерисуспенд ПБТ из очереди сообщений приложения. Если приложение не удаляет сообщение из очереди менее 20 секунд, система предполагает, что приложение находится в состоянии, не отвечающем на запросы, и что приложение соглашается с запросом о спящем режиме. Операции с приложениями, которые не обрабатывают очереди сообщений, могут быть прерваны. После того как сообщение будет удалено из очереди сообщений, приложению может потребоваться столько времени, сколько необходимо для выполнения необходимых операций перед входом в спящий режим. В настоящее время необходимо выполнить любые операции, которые могут занять больше 20 секунд, так как система допускает выполнение операций только через 20 секунд во время обработки [ПБТ \_ апмсуспенд](pbt-apmsuspend.md) .

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Только для \[ классических приложений Windows XP\]<br/>                                                              |
| Минимальная версия сервера<br/> | \[Только для настольных приложений Windows Server 2003\]<br/>                                                     |
| Окончание поддержки клиента<br/>    | Windows XP<br/>                                                                                    |
| Поддержка конца сервера<br/>    | Windows Server 2003<br/>                                                                           |
| Header<br/>                   | <dl> <dt>WinUser. h (включение Windows. h)</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[События пробуждения системы](system-wake-up-events.md)
</dt> <dt>

[События управления питанием](power-management-events.md)
</dt> <dt>

[ПБТ \_ апмсуспенд](pbt-apmsuspend.md)
</dt> <dt>

[**WM \_ поверброадкаст**](wm-powerbroadcast.md)
</dt> </dl>

 

 




