---
description: При непосредственной манипуляции используются окна просмотра, содержимое и контакты для описания интерактивных элементов пользовательского интерфейса.
ms.assetid: 1564F6F2-844F-4392-9EB5-AA46059D514C
title: Окна просмотра и содержимое
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: a103df916e5880380064250d05806169ff4187e6a8be0b22d2dd72d92343f38f
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118787123"
---
# <a name="viewports-and-content"></a>Окна просмотра и содержимое

При [непосредственной манипуляции](direct-manipulation-portal.md) используются *окна просмотра*, *содержимое* и *Контакты* для описания интерактивных элементов пользовательского интерфейса.

- [Настройка окна просмотра](#configuring-a-viewport)
- [Точки привязки и границы](#snap-points-and-boundaries)
- [Сценарии смещения точек привязки и RTL](#snap-point-offset-and-rtl-scenarios)
- [Расширения функциональности](#behaviors)
- [Система координат](#coordinate-system)
- [Преобразования](#transforms)
- [Состояние окна просмотра](#viewport-state)
- [Связанные темы](#related-topics)

Окно *просмотра* — это область внутри окна, которая может принимать и обрабатывать ввод данных при взаимодействии с пользователем. Окно просмотра представляет область содержимого, которая может быть видна конечному пользователю в определенное время (также называемую клипом содержимого). Окно просмотра имеет несколько функций:

- Он управляет состоянием взаимодействия (например, когда содержимое готово к управлению, когда содержимое находится в процессе обработки, когда содержимое находится в анимации инерции) и сопоставляет входные преобразования с выходными преобразованиями.
- Он содержит содержимое, которое перемещается в ответ на взаимодействие с пользователем. это может быть элемент HTML div (прокрутка), список с поддержкой панорамы (Windows 8 начальный экран) или всплывающее меню для элемента управления select.

Окно просмотра создается путем вызова [**креатевиевпорт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-createviewport). В одном окне можно создать несколько окон просмотра для создания разнообразных ИНТЕРФЕЙСов.

*Содержимое* представляет элемент, который преобразуется в ответ на взаимодействие. Иными словами, содержимое перемещается или масштабируется по мере движения пользователем или сжатия. Существует два типа содержимого:

- *Первичное содержимое* — это единственный встроенный элемент в окне просмотра, реагирующий на входные манипуляции и инерцию. Основное содержимое создается одновременно с окном просмотра и не может быть добавлено или удалено из окна просмотра. Поведение основного содержимого можно настроить с помощью точек привязки (рассматривается позже).
- *Вторичное содержимое* перемещается относительно движения основного содержимого. Дополнительное содержимое создается отдельно от окна просмотра и может быть добавлено или удалено из окна просмотра. Все вторичные преобразования содержимого рассчитываются на основе преобразования основного содержимого. Для изменения способа вычисления преобразования на основе назначения элемента, идентифицируемого его идентификатором CLSID во время создания, можно применить определенные правила.

На схеме, показанной до и после панорамы, для сдвига основного содержимого использовался один контакт. Несмотря на то, что пользователь не взаимодействует с индикатором панорамирования (дополнительное содержимое), вторичное содержимое перемещается, как основное содержимое — сдвигаемых. Это обеспечивает визуальные подсказки о том, как у пользователя есть сдвигаемых.

![Диаграмма, показывающая до и после сдвига](images/dm-art-2.png)

## <a name="configuring-a-viewport"></a>Настройка окна просмотра

После создания окна просмотра. Настройте его поведение с помощью *конфигурации взаимодействия*. Конфигурация взаимодействия определяет, какие манипуляции, такие как панорамирование, поддерживаются.

*Панорамирование* изменяет расположение содержимого на горизонтальной или вертикальной оси или в обоих случаях как пользовательское панорамирование. При настройке перевода по обеим осям содержимое перемещается в любом направлении.

Чтобы ограничить движение содержимого, настройте *границы* как обычно на горизонтальной, так и вертикальной оси. Если взаимодействие с пользователем выполняется преимущественно на одной оси (представленной синими регионами на следующей схеме), Pan становится перемещаемым и содержимое перемещается только по *оси с* границей. Если у пользователя есть сдвигаемых, и в настоящее время он работает и выполняет вторую операцию сдвига, а содержимое находится в инерции, новое панорамирование по-новому остается под границей.

![Схема, показывающая содержимое в окне просмотра в области с заданной границей](images/dm-art-3.png)

Пример. окно просмотра настроено для горизонтального и вертикального панорамирования. В первом кадре контакт переходит в недоступное окно. Во втором инициируется вертикальное панорамирование, и контакт блокируется по вертикальной границе. Наконец, после того, как панорамный сдвиг установлен, для перемещения содержимого используется только вертикальный компонент в диагональном панораме.

Если пользователь пройдет по диагонали так, чтобы они не находятся в регионах обнаружения салазок (белые регионы), Pan не *помещается, а содержимое* будет свободно перемещаться по обеим осям.

![Диаграмма, показывающая содержимое, перемещенное в неграницную панораму](images/dm-art-4.png)

При *масштабировании* изменяется коэффициент масштабирования содержимого по мере сжатия или растяжения пользователя. Точка, вокруг которой масштабируется содержимое (называется центром масштабирования), находится в центре контактов. Если задать горизонтальное или вертикальное выравнивание, центр масштабирования изменится для сохранения выравнивания.

![Диаграмма, показывающая масштаб содержимого с указанным выравниванием](images/dm-art-5.png)

Это поведение можно переопределить, указав центр Unlock, который задает центр масштабирования в центре контактов.

![Схема, показывающая масштаб содержимого с разблокированным центром масштабирования](images/dm-art-6.png)

*Инерция* — это постепенное замедление манипуляции, сдвига и увеличение масштаба после того, как все контакты были удалены (в случае касания) или после ввода с клавиатуры или с помощью мыши (например, при щелчке полосы прокрутки или нажатии клавиш со стрелками). Когда пользователь манипулирует содержимым, манипуляции не прекращаются немедленно после того, как контакт ликвидируется. Вместо этого содержимое сохраняется в текущем направлении и скорости, постепенно замедлится до завершения.

## <a name="snap-points-and-boundaries"></a>Точки привязки и границы

Анимация инерции выполняется после завершения манипуляции в результате движения пальцем экрана (в случае касания) или в результате действий клавиатуры или мыши (например, клавиш со стрелками, перемещения страницы вверх/вниз, прокрутки колесика мыши и т. д.).

Анимация инерции определяется двумя фрагментами данных:

- Точка RESTful анимации — конечная конечная позиция конкретного компонента преобразования.
- Длительность анимации, кривая, скорость — определяются типом точки RESTful.

На анимацию инерции влияют точки привязки и границы. Границы определяют максимальную и минимальную точки для содержимого. Если содержимое достигает границы во время инерции, будет применена анимация границы. Точки привязки определяются в основном содержимом, чтобы изменить точку RESTful и изменить саму кривую анимации инерции.

Вы определяете точки привязки с помощью [**сетснапинтервал**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnapinterval) , когда содержимое регулярно заполняется или [**сетснаппоинтс**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnappoints) , когда содержимое неравномерно размещается в пространстве. Ниже приведен пример точек привязки.

![Диаграмма, показывающая, как точки привязки, заданные в содержимом, влияют на панорамирование](images/dm-snappoint-states-3.png)

На схеме имеется часть содержимого с рядом блоков вложенного содержимого — новостных элементов в приложении или элементах типа "читатель" в виде сетки. Целью является привязка левого края элемента к левому краю окна просмотра после завершения инерции.

Существует две группы типов точек привязки:

- *Необязательный и* обязательный: необязательная точка привязки привязывает анимацию инерции только в том случае, если точка RESTful находится ближе к точке привязки. Обязательная точка привязки всегда привязывает анимацию инерции к указанной точке привязки.
- *Сравнение одиночного и множественного*: с помощью нескольких типов точек привязки содержимое перемещается за последние несколько точек привязки, прежде чем переходить к остальной точке привязки ближе к естественной точке RESTful. Один тип точки привязки выбирает следующую ближайшую точку привязки в качестве точки остальной для анимации инерции.

На следующей схеме показано, как типы точек привязки изменяют положение анимации инерции в оставшейся части.

![Диаграмма, показывающая взаимодействие инерции и точек привязки](images/dm-snappoint-states-1.png)

На этой диаграмме начальная точка инерции помечена как Start и естественная конечная позиция инерции в отсутствии точек привязки как End. Вертикальные линии помечают различные точки привязки. В этой таблице описывается, как каждый тип точки привязки влияет на конечное положение анимации.

| Тип точки         | Описание                                                                                |
|--------------------|--------------------------------------------------------------------------------------------|
| Обязательное одно   | Выбрана точка привязки P1, так как это первая точка привязки в направлении инерции     |
| Несколько обязательных | Выбрана точка привязки P2, так как она находится ближе к конечной точке в направлении инерции |
| Необязательное единственное    | Выбрана точка привязки P1, так как это первая точка привязки, обнаруженная во время инерции      |
| Несколько необязательных  | Выбрана точка привязки P2, так как находится ближе к естественной конечной точке                           |

## <a name="snap-point-offset-and-rtl-scenarios"></a>Сценарии смещения точек привязки и RTL

![Схема, демонстрирующая использование точки привязки RTL](images/dm-snappoint-states-2.png)

Вы применяете смещение точки привязки и систему координат с помощью API [**сетснапкурдинате**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnapcoordinate) , который смещает все точки привязки или интервалы привязки с помощью заданной системы координат или координаты.

Система координат очень полезна в сценариях RTL, где необходимо описать точки привязки от левого края содержимого в обратном направлении. На предыдущей схеме [**сетснапкурдинате**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnapcoordinate) используется с флагом **директманипулатион \_ Motion \_ TRANSLATEX** и **директманипулатион \_ координаты \_ отражения** , который автоматически смещает точки привязки от левого края содержимого и предоставляет их в порядке справа налево: S1 находится в 0px, S2 — в 50px (и т. д.). Любое смещение, заданное с помощью **сетснапкурдинате** , будет автоматически смещено от этого левого края содержимого, включая правильный масштабный коэффициент.

Почти всегда будет использоваться [**сетснапкурдинате**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnapcoordinate) с набором параметров *Origin* , чтобы не задавать точки привязки за пределами области содержимого.

Например, если окно просмотра — 200x200, а содержимое — 1000x200, а интерфейс — RTL, то окно просмотра будет иметь его левый конец в x = 800 при первом представлении окна просмотра. Вызовите [**сетснапкурдинате**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationprimarycontent-setsnapcoordinate) с, `SetSnapCoordinate(DIRECTMANIPULATION_MOTION_TRANSLATEX, DIRECTMANIPULATION_COORDINATE_MIRRORED, 1000.0)` чтобы указать, что точки привязки должны рассчитываться справа налево, начиная с правого края содержимого.

## <a name="behaviors"></a>Расширения функциональности

*Поведение* — это объект, который можно присоединить к области просмотра, чтобы изменить [порядок обработки](direct-manipulation-portal.md) выходного преобразования основного или дополнительного содержимого окна просмотра. Объект поведения может влиять на один или несколько аспектов манипуляции, таких как обработка входных данных или применение анимации инерции. Например, поведение прокрутки влияет на анимацию инерции путем выполнения анимации с прокруткой к одному концу основного содержимого. Поведение конфигурации между слайдами влияет на обработку ввода прямого манипуляции, которая обнаруживает, когда выполняется действие между слайдами.

Объект поведения создается путем вызова [**креатебехавиор**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager2-createbehavior), добавленного в окно просмотра, а затем его поведение настраивается асинхронно. Удаление поведения из окна просмотра приведет к удалению его эффектов.

## <a name="coordinate-system"></a>Система координат

Существует три основные системы координат, используемые [непосредственно в управлении](direct-manipulation-portal.md):

- Клиентская система координат — описывает прямоугольник окна клиента. Единицы находятся в пикселях.
- Система координат окна просмотра — описывает прямоугольник области внутри клиента, который может обрабатывать входные данные. Единицы измерения определяются приложением (с помощью [**сетвиевпортрект**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setviewportrect)).
- Система координат содержимого — описывает прямоугольник или размер основного содержимого. Единицы измерения определяются приложением (с помощью [**сетконтентрект**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationcontent-setcontentrect)).

Для всех трех систем координаты определяются относительно их соответствующего верхнего левого источника, и они становятся положительными. Эти системы координат показаны на следующей схеме. Только раздел содержимого в пределах прямоугольника окна просмотра может просматриваться и обрабатываться конечным пользователем.

![Диаграмма, показывающая взаимодействие содержимого, клиента и окна просмотра](images/dm-art-7.png)

## <a name="transforms"></a>Преобразования

[Непосредственная манипуляция](direct-manipulation-portal.md) поддерживает несколько различных преобразований, которые вносят вклад в общие отображаемые выходные данные.

- *Преобразование содержимого* — начальное преобразование, вычисленное путем [непосредственной манипуляции](direct-manipulation-portal.md) на основе манипуляций или инерции. Он фиксирует эффекты точек привязки, закрепления, по умолчанию оверпан (манипуляции), переbounce (инерции) по умолчанию и анимации Зумторект.
- *Выходное преобразование* — окончательный визуальный элемент или преобразование "выход". Это сочетание как содержимого, так и преобразований синхронизации.
- *Преобразование синхронизации* — вычисляются при вызове [**синкконтенттрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationcontent-synccontenttransform). Она помогает [напрямую управлять](direct-manipulation-portal.md) применением нового преобразования содержимого, предоставленного приложением, а также сохранением существующего преобразования выходных данных.
- *Отображаемое преобразование* — применяется приложением в процессе последующей обработки. Дополнительные сведения см. в разделе [**синкдисплайтрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-syncdisplaytransform) .

Так как выходное преобразование предназначено для визуального смещения поверхности на экране, [прямое управление](direct-manipulation-portal.md) выполняет необходимое округление для компонентов преобразования выходных данных, чтобы текст и другое содержимое всегда отображались и были совмещены в пределах целой точки. Механизм округления зависит от нескольких факторов, включая скорость движения и присутствие удаленный рабочий стол. Механизм округления для дополнительного содержимого соответствует основному содержимому, при этом учитывается разница в движении между ними. Клиенты [**жетаутпуттрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationcontent-getoutputtransform) не должны зависеть от точного механизма округления выходного преобразования, так как на него влияют различные факторы.

> [!Note]
>
> Это означает, что компоненты преобразования содержимого не могут быть целыми и могут содержать смещения в виде вложенных точек. Клиенты, использующие [прямую манипуляцию](direct-manipulation-portal.md) , должны использовать [**жетаутпуттрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationcontent-getoutputtransform) для расчета правильного визуального преобразования, применяемого к содержимому при использовании режима ручного обновления. При использовании режима автоматического обновления с помощью встроенного компоновщика Непосредственная манипуляция автоматически применяет это преобразование от имени клиента. Это преобразование создается путем непосредственной манипуляции, чтобы обеспечить визуальную привлекательность результатов при создании визуальных выходных данных.

## <a name="viewport-state"></a>Состояние окна просмотра

По мере обработки входных данных окно просмотра управляет состоянием взаимодействия и сопоставлением входных данных с преобразованиями выходных данных. Проверьте состояние взаимодействия окна просмотра, [**вызвав метод**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-getstatus)"вызов метода".

![Схема, показывающая состояния взаимодействия директманипулатион](images/dm-states-diagram.png)

- Сборка — окно просмотра создается и пока не может обрабатывать входные данные. Для обработки входных данных вызовите метод [**идиректманипулатионвиевпорт:: enable**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-enable). Если параметр **Enable** не вызван, окно просмотра переходит в состояние отключено.

    > [!Note]  
    > Это начальное состояние взаимодействия.

- Включено — окно просмотра готово к обработке входных данных. Когда отключается контакт ([**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) вызывается) и обнаруживается манипуляция, окно просмотра переходит в режим «выполняется».

- Выполняется — окно просмотра в настоящее время обрабатывает входные данные и обновляет содержимое. Когда контакт ликвидируется, окно просмотра переходит в режим инерции, если он настроен.

- Инерция — содержимое перемещается в анимацию инерции. После завершения инерции окно просмотра будет переведено в состояние готовности. Если в окне просмотра было задано автоматическое отключение, оно переходит от инерции к готовому, а затем к отключению.

- Готово — окно просмотра готово к обработке входных данных. Когда отключается контакт ([**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) вызывается) и обнаруживается манипуляция, окно просмотра переходит в режим «выполняется».

- Suspended — окно просмотра может быть приостановлено, если его входные данные были перевышены до родителя в цепочке [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) . Это более подробно рассматривается в [нескольких окнах просмотра: Проверка нажатия и иерархия просмотра](directmanipulation-multiple-vieports.md).

- Disabled — окно просмотра не будет обрабатывать ввод или выполнять обратные вызовы. Окно просмотра можно отключить из различных состояний, вызвав [**идиректманипулатионвиевпорт::D**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-disable). Если в окне просмотра было задано автоматическое отключение, оно будет автоматически переведено в состояние отключено после обработки манипуляции. Чтобы повторно включить отключенное окно просмотра, вызовите метод [**идиректманипулатионвиевпорт:: enable**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-enable).

## <a name="related-topics"></a>Связанные темы

[Несколько окон просмотра: проверка попадания и иерархия окна просмотра](directmanipulation-multiple-vieports.md), [**активатеконфигуратион**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-activateconfiguration), [**жетаутпуттрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationcontent-getoutputtransform), [**синкдисплайтрансформ**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-syncdisplaytransform)
