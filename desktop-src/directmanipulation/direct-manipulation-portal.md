---
description: Интерфейсы API прямого управления позволяют создавать удобные возможности панорамирования, масштабирования и перетаскивания. Для этого он обрабатывает сенсорный ввод в области или объекте, создает преобразования вывода и применяет преобразования к элементам пользовательского интерфейса.
ms.assetid: 26358bc5-71e9-40f0-9243-9bddd961a0e5
title: Непосредственная манипуляция
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 6db2a50893914dfb25050768f88cb289a1ecf3ea
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "104139863"
---
# <a name="direct-manipulation"></a>Непосредственная манипуляция

Интерфейсы API прямого управления позволяют создавать удобные возможности панорамирования, масштабирования и перетаскивания. Для этого он обрабатывает сенсорный ввод в области или объекте, создает преобразования вывода и применяет преобразования к элементам пользовательского интерфейса. Прямую манипуляцию можно использовать для оптимизации скорости реагирования и сокращения задержки при обработке входных данных вне потока, необязательного тестирования нажатия входных данных вне потока, а также прогнозирования ввода-вывода.

Любое приложение, использующее прямую манипуляцию с сенсорным взаимодействием, отображает жидкие эффекты анимации Windows 8 и реакции на взаимодействие, которые соответствуют [рекомендациям по распространению взаимодействия с пользователем](/windows/uwp/design/input/).

## <a name="developer-audience"></a>Аудитория разработчиков

API прямого управления предназначен для опытных разработчиков, знающих C/C++, имеющих полное представление об [объектной модели компонентов (com)](../com/component-object-model--com--portal.md)и знакомство с концепциями программирования Windows.

## <a name="run-time-requirements"></a>Требования к среде выполнения

Прямая манипуляция появилась в Windows 8. Она включена как в 32-разрядных, так и в 64-разрядных версиях.

## <a name="why-use-directmanipulation"></a>Зачем использовать Директманипулатион

### <a name="handles-interactions-in-a-straightforward-and-consistent-manner"></a>Обрабатывает взаимодействия простым и согласованным способом

Непосредственная манипуляция заключается в предварительном объявлении поведения и взаимодействии для региона или объекта. Например, веб-страница часто настраивается для панорамы и масштабирования. Во время выполнения входные данные затем связываются с этим регионом или объектом через простой вызов API. С этого момента прямая манипуляция выполняет всю тяжелую работу по обработке входных данных, применению ограничений и индивидуальности и созданию преобразований вывода.

### <a name="build-responsive-touch-applications"></a>Создание сенсорных приложений для реагирования

Чтобы оптимизировать скорость реагирования и сократить задержку, обработка прямого манипулирования выполняется в отдельном независимом потоке от потока пользовательского интерфейса. В результате преобразования выходных данных могут выполняться параллельно с действием в потоке пользовательского интерфейса. Действие потока пользовательского интерфейса может включать логику приложения, отрисовку, макет и все остальное, которые используют циклы процессора.

### <a name="implementation-flexibility"></a>Гибкость реализации

Интерфейсы, входящие в прямую манипуляцию, обеспечивают комплексную поддержку для обработки ввода, распознавания взаимодействия, уведомлений о отзывах и обновлений пользовательского интерфейса. Интерфейсы также включают в себя системные службы, такие как [DirectComposition](../directcomp/directcomposition-portal.md).

## <a name="basic-concepts"></a>Основные понятия

Самая базовая реализация прямого управления состоит из *окна просмотра*, *содержимого* и *взаимодействий*. *Окно просмотра* — это регион, который способен получать и обрабатывать ввод данных при взаимодействии с пользователем. Это также область содержимого, видимая для конечного пользователя. *Содержимое* — это фактический объект, который пользователи могут видеть, а также перемещает или масштабирует в ответ на взаимодействие с пользователем. *Взаимодействие* с основным пользователем (также известные как *манипуляции*), поддерживаемое непосредственной обработкой, — это панорамирование и изменение масштаба. Эти взаимодействия применяют преобразование преобразования или масштабирования к содержимому в окне просмотра, соответственно. Несколько окон просмотра (каждый с собственным содержимым) можно настроить в одном окне, чтобы создать богатый интерфейс.

На этом рисунке показана базовая реализация прямого управления до и после панорамирования.

![Базовая реализация прямого управления до и после панорамирования.](images/dm-art-1.png)

Во время инициализации непосредственной манипуляции создается экземпляр объекта **дкомпдиректманипулатионкомпоситор** , который связывается с непосредственной манипуляцией. Этот объект является оболочкой для [DirectComposition](../directcomp/directcomposition-portal.md), который является компоновщиком системы. Объект отвечает за применение преобразований вывода и выполнение визуальных обновлений.

Контакт представляет точку касания, определяемую **поинтерид** , указанной в сообщении [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) . При получении **сообщения \_ поинтердовн WM** приложение вызывает [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact). Приложение уведомляет напрямую Манипулатионабаут контакты, которые должны быть обработаны, и окна просмотра, которые должны реагировать на эти контакты. Ввод с клавиатуры и мыши имеет специальные значения **поинтерид** , поэтому они могут обрабатываться соответствующим образом путем непосредственной манипуляции.

В нашем базовом случае, когда [**сетконтакт**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) вызывается несколько вещей, происходит следующее:

- Когда пользователь выполняет сдвиг, в приложение отправляется сообщение [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) , уведомляющее о том, что контакт был использован непосредственно в процессе манипуляции.
- Когда пользователь перемещает перемещения, окно просмотра запускает события обновления, которые используются оболочкой [DirectComposition](../directcomp/directcomposition-portal.md) для создания визуальных обновлений на экране. Для панорамирования пользователя в окне просмотра, содержимое будет выглядеть плавно под контактом.
- Когда пользователь отрывает контакт, он видит, что содержимое продолжает перемещаться по мере перехода в анимацию инерции, постепенно замедление, пока не достигнет своего окончательного размещения.

## <a name="processing-keyboard-and-mouse-input"></a>Обработка ввода с клавиатуры и мыши

Непосредственная манипуляция позволяет пересылать сообщения клавиатуры и мыши вручную из потока пользовательского интерфейса приложения через API [**ProcessInput**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-processinput) , так что они могут обрабатываться соответствующим образом путем непосредственной манипуляции.

## <a name="directmanipulation-and-the-hwnd"></a>Директманипулатион и HWND

Непосредственная манипуляция связана с Win32 HWND для получения и обработки сообщений ввода указателя для этого окна. При использовании прямой манипуляции выходные значения делают асинхронные обратные вызовы [com](../com/component-object-model--com--portal.md) -объектам, реализованным в приложении напрямую манипуляции. Эти обратные вызовы сообщают приложению о преобразовании, которое было применено к объектам. Непосредственная манипуляция активируется для указанного HWND путем вызова функции [**Activate**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-activate).

## <a name="supporting-documentation"></a>Вспомогательная документация

- [Окна просмотра и содержимое](directmanipulation-viewports-and-content.md)
- [Использование нескольких окон просмотра в Директманипулатион](directmanipulation-multiple-vieports.md)
- [Обработка входных данных с помощью Директманипулатион](directmanipulation-processing-input-with-directmanipulation.md)
- [Механизм композиции](directmanipulation-composition-engine.md)
- [Ссылка на прямую манипуляцию](direct-manipulation-reference.md)

- [Сборка 2013: вкл-022: Сделайте классическое приложение удобным с помощью сенсорного ввода, мыши и пера](https://channel9.msdn.com/Events/Build/2013/4-022)
- [Пример обработки сенсорного ввода с помощью прямой манипуляции](https://github.com/microsoft/Windows-classic-samples/tree/1d363ff4bd17d8e20415b92e2ee989d615cc0d91/Samples/TouchInputDirectManipulation)
