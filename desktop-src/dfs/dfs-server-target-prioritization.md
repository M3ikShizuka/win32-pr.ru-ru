---
title: Приоритетность целевого сервера DFS
description: Приоритетность целевого сервера DFS — это функция, доступная в Microsoft Windows Server 2003 с пакетом обновления 1 (SP1) и более поздних операционных системах.
ms.assetid: 0aacebf7-49cc-4287-a5c4-0d25a416d227
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e784a540a67f624ca5b8075009cd862c6063427
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262757"
---
# <a name="dfs-server-target-prioritization"></a>Приоритетность целевого сервера DFS

Приоритетность целевого сервера DFS — это функция, доступная в Microsoft Windows Server 2003 с пакетом обновления 1 (SP1) и более поздних операционных системах. Эта функция позволяет серверам DFS использовать преимущества доступных Active Directory сведения о стоимости сайта для определения приоритетов целевых объектов в ссылках клиентов.

До Windows Server 2003 с пакетом обновления 1 (SP1) целевые объекты были сгруппированы в два набора: одну группу, содержащую все целевые объекты на одном сайте с клиентом. и другая группа для всех остальных целевых объектов. Эти целевые объекты, использующие тот же сайт, что и клиент, называются "внутри сайта", и если стоимость сайта включена, им назначается определенное значение стоимости, соответствующее общему сайту, с меньшими затратами на сайт выше.

Благодаря доступности данных о затратах на сайт, целевые объекты сервера можно назначать приоритету для более эффективных стратегий отработки отказа сервера DFS. В прошлом этот детализированный уровень детализации был недоступен, и администраторам пришлось прибегнуть к искусственным средствам (например, фиктивным сайтам в AD) для поддержки даже простых требований, таких как обозначение конкретных серверов в качестве резервного или дополнительного сервера в случае сбоя основного сервера DFS. Теперь с дополнительными сведениями, предоставляемыми по стоимости сайта, можно реализовать многоуровневые стратегии отработки отказа.

В следующем обсуждении предполагается, что стоимость сайта включена.

## <a name="target-prioritization"></a>Целевое определение приоритетов

Приоритет целевого объекта — это конкретное упорядочение с точки зрения администрирования, классификация и ранжирование серверов внутри сайта с точки зрения явных предпочтений на основе стоимости сайта с клиента DFS. Глобальный приоритет не зависит от стоимости сайта. Обратите внимание, что классы глобальных приоритетов не обязательно указывают наиболее оптимальные целевые объекты с точки зрения клиента DFS, но отражают важность или отсутствие важности конкретных целевых объектов с точки зрения администратора сайта.

Приоритет целевого сервера делится на две категории значений: приоритетный класс и ранг приоритета. Классы приоритета делятся на два уровня: локальные и глобальные. В этих классах существует грубое упорядочивание целевых объектов на основе стоимости сайта, сгруппированной как высокий, нормальный и низкий приоритет. Результатом является пять классов приоритета в порядке от самого высокого до самого низкого приоритета следующим образом:

- Глобальный высокий приоритет
- Сайт-стоимость с высоким приоритетом
- Сайт-затраты на нормальный приоритет
- Сайт-стоимость с низким приоритетом
- Глобальный низкий приоритет

Классы стоимости сайта можно рассматривать как подразделы "глобальный приоритет". Ранг приоритета — это простое целочисленное ранжирование на основе порядковых значений: 0, 1, 2 и @ @, где 0 — наибольшее значение, а все последующие значения, указывающие на уменьшение ранга.

Глобальные высокие и низкие приоритеты не учитывают значения стоимости сайта. Целевые объекты с глобально высоким приоритетом получают приоритет над всеми другими целевыми объектами, а целевые объекты с глобальным низким приоритетом получают наименьший уровень предпочтения.

При упорядочении ссылки полный процесс выполняет следующие действия.

1. Определяются наборы глобальных высоких и младших целевых объектов, а также оставшиеся "глобальные обычные" целевые объекты.
2. Если задан параметр "сайт", все целевые объекты, находящиеся за пределами сайта клиента, будут удалены. Параметр "сайт" не применяется к глобальным высоким и низким приоритетам.
3. В каждом из этих трех наборов целевые объекты упорядочиваются с помощью механизма "AD — затраты на сайт", используя как локальные, так и полные ресурсы. Результатом являются наборы целевых объектов равной стоимости сайта.
4. В наборах "глобальных обычных" целевых объектов равных затратах на сайт целевым объектам назначается класс приоритета с высоким, нормальным и низким приоритетным рангом.
5. В наборах целевых объектов с равными затратами и приоритетами сайтов целевые объекты теперь упорядочиваются по рангу приоритета, а 0 — с наибольшим рангом.
6. В наборах целевых объектов равной стоимости сайта, приоритетного класса и ранга приоритета целевые объекты случайным образом перемещаются в случайном порядке для балансировки нагрузки.

В графическом виде набор целевых объектов упорядочивается, как показано ниже:

- целевые объекты глобального приоритета класса 
- целевые объекты класса с высоким приоритетом стоимости сайта с ценой сайта = 0
- Обычная с ценой сайта = 0
- низкая с ценой сайта = 0
- целевые объекты класса с высоким приоритетом стоимости сайта с ценой сайта = 1
- Обычная с ценой сайта = 1
- низкая с ценой сайта = 1
- И многое другое
- целевые объекты глобального класса с низким приоритетом

В каждом из этих наборов целевые объекты сортируются в соответствии с рангом приоритета. Наибольший ранг равен нулю, при этом каждое последующее целочисленное значение (1, 2 и т. д.) указывает на более низкий ранг.

Приоритет целевого объекта задается для определенного целевого объекта ссылки (или корня) в пространстве имен DFS. Приоритет целевого объекта для одной ссылки не влияет на порядок других ссылок, если этот целевой путь используется несколько раз. Например, если две ссылки имеют \\ \\ share1 сервера в \\ качестве целевого объекта, приоритет \\ \\ share1 сервера устанавливается \\ отдельно для обеих ссылок.

Приоритет по умолчанию для всех связей — это обычная приоритетная стоимость сайта с рангом 0. Приоритет целевого объекта не влияет на порядок ссылок, если он не используется, и все существующие ссылки упорядочиваются по мере их получения.

Ссылочный ответ от сервера DFS состоит из наборов целей, упорядоченных, как указано выше, с каждым неглобальным набором целей, содержащим цели тех же затрат на сайт, класс приоритета и ранг приоритета. Целевые объекты в каждом наборе упорядочиваются случайным образом. Клиенты DFS, получающие ссылку, начинаются с первого целевого объекта первого набора и пропускают список до тех пор, пока не будет найден доступная цель для данного корня или ссылки DFS.

Конкретная реализация этого компонента API представлена в следующих справочных разделах:

[**DFS_INFO_6**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_6) 
 [**DFS_INFO_104**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_104) 
 [**DFS_INFO_106**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_106) 
 [**DFS_TARGET_PRIORITY**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_target_priority) 
 [**DFS_TARGET_PRIORITY_CLASS**](/windows/win32/api/lmdfs/ne-lmdfs-dfs_target_priority_class~r1)
