---
title: Использование шейдеров в Direct3D 9
description: Использование шейдеров в Direct3D 9
ms.assetid: 8d8f5124-fbf3-4af5-8399-43ba28aa6eb9
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 6455b47d24c1c83683ce8b85c48990bb32e221ae
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104997047"
---
# <a name="using-shaders-in-direct3d-9"></a>Использование шейдеров в Direct3D 9

-   [Компиляция шейдера для определенного оборудования](#compiling-a-shader-for-specific-hardware)
-   [Инициализация констант шейдера](#initializing-shader-constants)
-   [Привязка параметра шейдера к определенному регистру](#binding-a-shader-parameter-to-a-particular-register)
-   [Визуализация программируемого шейдера](#rendering-a-programmable-shader)
-   [Отладка шейдеров](#debugging-shaders)
-   [См. также](#related-topics)

## <a name="compiling-a-shader-for-specific-hardware"></a>Компиляция шейдера для определенного оборудования

Шейдеры впервые были добавлены в Microsoft DirectX в DirectX 8,0. В этот момент было определено несколько виртуальных машин шейдеров, каждое из которых примерно соответствует конкретному графическому процессору, созданному ведущими поставщиками трехмерной графики. Для каждого из этих виртуальных машин шейдеров был разработан язык сборки. Программы, написанные на моделях шейдеров (имена VS 1 \_ \_ и PS \_ 1 \_ 1-PS \_ 1 \_ 4) относительно короткие и обычно пишутся разработчиками непосредственно на соответствующем языке ассемблера. Приложение передает этот код на языке ассемблера в библиотеку D3DX с помощью [**D3DXAssembleShader**](/windows/desktop/direct3d9/d3dxassembleshader) и возвращает обратное двоичное представление шейдера, который, в свою очередь, передается с помощью [**креатевертексшадер**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader) или [**креатепикселшадер**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader). Дополнительные сведения см. в разделе пакет средств разработки программного обеспечения (SDK).

Ситуация в Direct3D 9 аналогична. Приложение передает Шейдер HLSL в D3DX с помощью [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader) и возвращает двоичное представление скомпилированного шейдера, которое, в свою очередь, передается в Microsoft Direct3D с помощью [**креатепикселшадер**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createpixelshader) или [**креатевертексшадер**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-createvertexshader). Среда выполнения не знает ничего о HLSL, а только в двоичные модели шейдера сборки. Это замечательно, так как это означает, что компилятор HLSL можно обновить независимо от среды выполнения Direct3D. Шейдеры можно также компилировать в автономном режиме с помощью [fxc](/windows/desktop/direct3dtools/fxc).

Помимо разработки компилятора HLSL, Direct3D 9 также представил модели шейдеров на уровне сборки, чтобы предоставить функциональные возможности новейшего поколения графического оборудования. Разработчики приложений могут работать в сборке для этих новых моделей (VS \_ 2 \_ 0, VS \_ 3 \_ 0, PS \_ 2 \_ 0, PS \_ 3 \_ 0), но мы планируем, чтобы большинство разработчиков переместились на HLSL для разработки шейдеров.

Разумеется, возможность написания программы HLSL для выражения определенного алгоритма затенения не позволяет автоматически запускать его на любом конкретном оборудовании. Приложение вызывает D3DX для компиляции шейдера в двоичный код сборки с помощью [**D3DXCompileShader**](/windows/desktop/direct3d9/d3dxcompileshader). Одним из ограничений этой точки входа является параметр, определяющий, какие модели уровня сборки (или цели компиляции) компилятор HLSL должен использовать для выражения окончательного кода шейдера. Если приложение выполняет компиляцию шейдера HLSL во время выполнения (в отличие от времени компиляции или вне сети), приложение может проверить возможности устройства Direct3D и выбрать цель компиляции для сопоставления. Если алгоритм, выраженный в шейдере HLSL, слишком сложен для выполнения в выбранном целевом объекте компиляции, произойдет сбой компиляции. Это означает, что хотя HLSL является огромным преимуществом для разработки шейдеров, он не позволяет разработчикам из реалииных игр в целевую аудиторию с графическими устройствами с различной функциональностью. Разработчику игр по-прежнему приходится управлять многоуровневый подход к визуальным элементам. Это означает написание лучших шейдеров для более производительных графических карт и написание более базовых версий для старых карточек. Тем не менее, с хорошо написанными HLSLами эта нагрузка может быть значительно облегчилоа.

Вместо того, чтобы компилировать HLSL шейдеры с помощью D3DX на компьютере клиента во время загрузки приложения или при первом использовании, многие разработчики выбирают компиляцию своего шейдера из HLSL в двоичный код сборки до того, как они будут даже поставляться. Это оставляет свой исходный код HLSL от любопытныхных глаз, а также гарантирует, что все построители шейдеров, которые их приложение запускали, будут проделаны в рамках внутреннего процесса контроля качества. Для автономного компилирования шейдеров используется удобная программа [fxc](/windows/desktop/direct3dtools/fxc). Это средство имеет ряд параметров, которые можно использовать для компиляции кода для указанного целевого объекта компиляции. Изучите собранные выходные данные во время разработки, если вы хотите оптимизировать шейдеры или просто узнаете о возможностях виртуального шейдера на более детальном уровне. Ниже приведены эти параметры.

## <a name="initializing-shader-constants"></a>Инициализация констант шейдера

Константы шейдеров содержатся в таблице констант. Доступ к этому интерфейсу можно получить с помощью интерфейса [**ID3DXConstantTable**](/windows/desktop/direct3d9/id3dxconstanttable) . Глобальные переменные шейдеров можно инициализировать в коде шейдера. Они инициализируются во время выполнения путем вызова [**SetDefaults**](/windows/desktop/direct3d9/id3dxconstanttable--setdefaults).

## <a name="binding-a-shader-parameter-to-a-particular-register"></a>Привязка параметра шейдера к определенному регистру

Компилятор будет автоматически назначать регистры глобальным переменным. Компилятор будет назначать окружение для образца Register S0, Спаркленоисе на выборку регистра S1, а k \_ s — константе Register C0 (при условии, что никакие другие регистры выборки или постоянного регистра уже назначены) для следующих трех глобальных переменных:


```
sampler Environment;
sampler SparkleNoise;
float4 k_s;
```



Можно также привязать переменные к конкретному регистру. Чтобы принудительно назначить компилятору определенный регистр, используйте следующий синтаксис:


```
register(RegisterName)
```



где RegisterName — имя конкретного регистра. В следующих примерах демонстрируется конкретный синтаксис назначения регистров, в котором среда выборки будет привязана к регистру образцов S1, Спаркленоисе будет привязан к образцу реестра S0, а k \_ s будет привязан к константе Register C12:


```
sampler Environment : register(s1);
sampler SparkleNoise : register(s0);
float4 k_s : register(c12);
```



## <a name="rendering-a-programmable-shader"></a>Визуализация программируемого шейдера

Шейдер визуализируется путем установки текущего шейдера на устройстве, инициализации констант шейдера, указания устройства, откуда поступают различные входные данные, и, наконец, отрисовки примитивов. Каждое из них можно реализовать, вызвав следующие методы соответственно:

-   [**сетвертексшадер**](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexshader)
-   [**сетвертексшадерконстантф**](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setvertexshaderconstantf)
-   [**сетстреамсаурце**](/windows/desktop/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-setstreamsource)
-   [**дравпримитиве**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9-drawprimitive)

## <a name="debugging-shaders"></a>Отладка шейдеров

Расширение DirectX для Microsoft Visual Studio .NET предоставляет полностью интегрированный отладчик HLSL в интегрированной среде разработки (IDE) Visual Studio .NET. Чтобы подготовиться к отладке шейдера, необходимо установить нужные инструменты на компьютере (см. раздел [Отладка шейдеров в Visual Studio (Direct3D 9)](dx-graphics-hlsl-debug-visual-studio.md)).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Руководство по программированию для HLSL](dx-graphics-hlsl-pguide.md)
</dt> </dl>

 

 