---
title: Flow Ограничения управления
description: Инструкции управления потоком шейдера пикселей имеют ограничения, влияющие на то, сколько уровней вложенности можно включать в инструкции. Кроме того, существуют некоторые ограничения для реализации управления потоком на уровне точек с помощью инструкций градиента.
ms.assetid: 17a902cd-16a4-4065-9249-01f9b1f40506
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 34891e29a1bb27aead629db2cc7473c7d4329af5
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127573734"
---
# <a name="flow-control-limitations"></a>Flow Ограничения управления

Инструкции управления потоком шейдера пикселей имеют ограничения, влияющие на то, сколько уровней вложенности можно включать в инструкции. Кроме того, существуют некоторые ограничения для реализации управления потоком на уровне точек с помощью инструкций градиента.

> [!Note]  
> При использовании \* \_ \_ \_ профилей шейдера с 4 уровнями \_ 9 \_ x HLSL вы неявно используете профили [шейдера 2. x](dx-graphics-hlsl-sm2.md) для поддержки аппаратного обеспечения с поддержкой Direct3D 9. Профили Shader модели 2. x поддерживают более ограниченное поведение управления потоком, чем профили [шейдера 4. x](dx-graphics-hlsl-sm4.md) и более поздних версий.

 

-   [Счетчик глубины инструкций шейдера пикселей](#pixel-shader-instruction-depth-counts)
-   [взаимодействие элемента управления Flow Per-Pixel с градиентами экрана](#interaction-of-per-pixel-flow-control-with-screen-gradients)

## <a name="pixel-shader-instruction-depth-counts"></a>Счетчик глубины инструкций шейдера пикселей

PS \_ 2 \_ 0 не поддерживает управление потоком. Ниже перечислены ограничения для других версий шейдера Pixel Shader.

### <a name="instruction-depth-count-for-ps_2_x"></a>Счетчик глубины инструкций для PS \_ 2 \_ x

Каждая инструкция учитывает один или несколько ограничений глубины вложения. В следующей таблице перечислены значения глубины, которые каждая инструкция добавляет или вычитает из существующей глубины.



| Инструкция                              | Статическое вложение                       | Динамическое вложение                                                           | Вложенность цикла/торгового представителя | вложение вызова |
|------------------------------------------|--------------------------------------|---------------------------------------------------------------------------|------------------|--------------|
| [If bool-PS](if-bool---ps.md)         | 1                                    | 0                                                                         | 0                | 0            |
| [Если \_ comp-PS](if-comp---ps.md)        | 0                                    | 1                                                                         | 0                | 0            |
| [Если пред-PS](if-pred---ps.md)         | 0                                    | 1                                                                         | 0                | 0            |
| [else-PS](else---ps.md)               | 0                                    | 0                                                                         | 0                | 0            |
| [endif-PS](endif---ps.md)             | -1 ([Если bool-PS](if-bool---ps.md)) | -1 ([Если "пред-PS](if-pred---ps.md) " или " [ \_ comp-PS](if-comp---ps.md)") | 0                | 0            |
| [Представитель-PS](rep---ps.md)                 | 0                                    | 0                                                                         | 1                | 0            |
| [ендреп-PS](endrep---ps.md)           | 0                                    | 0                                                                         | -1               | 0            |
| [Break-PS](break---ps.md)             | 0                                    | 0                                                                         | 0                | 0            |
| [Останов \_ comp-PS](break-comp---ps.md)  | 0                                    | 1,-1                                                                     | 0                | 0            |
| [бреакп-PS](break-p---ps.md)          | 0                                    | 0                                                                         | 0                | 0            |
| [Call-PS](call---ps.md)               | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз bool-PS](callnz-bool---ps.md) | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз, пред-PS](callnz-pred---ps.md) | 0                                    | 1                                                                         | 0                | 1            |
| [RET-PS](ret---ps.md)                 | 0                                    | -1 ([каллнз-PS](callnz-pred---ps.md))                              | 0                | -1           |
| [сетп \_ comp-PS](setp-comp---ps.md)    | 0                                    | 0                                                                         | 0                | 0            |



 

### <a name="nesting-depth"></a>Глубина вложения

Глубина вложения определяет количество инструкций, которые могут быть вызваны внутри друг друга. Каждый тип инструкции имеет один или несколько ограничений вложения, как указано в следующей таблице.



| Тип инструкции | Максимум                                                                                   |
|------------------|-------------------------------------------------------------------------------------------|
| Статическое вложение   | 24, если (D3DCAPS9. D3DPSHADERCAPS2 \_ 0. статикфловконтролдепс > 0); 0 в противном случае            |
| Динамическое вложение  | от 0 до 24 см. в разделе D3DCAPS9. D3DPSHADERCAPS2 \_ 0. динамикфловконтролдепс                          |
| вложение представителя      | от 0 до 4 см. в разделе D3DCAPS9. D3DPSHADERCAPS2 \_ 0. статикфловконтролдепс                            |
| вложение вызова     | от 0 до 4 см. в разделе D3DCAPS9. D3DPSHADERCAPS2 \_ 0. статикфловконтролдепс (не зависит от лимита представителя) |



 

### <a name="instruction-depth-count-for-ps_2_sw"></a>Счетчик глубины инструкций для PS \_ 2 \_ SW

Каждая инструкция учитывает один или несколько ограничений глубины вложения. В этой таблице показано количество элементов, добавляемых или вычитаемых каждой инструкцией из существующей глубины.



| Инструкция                              | Статическое вложение                       | Динамическое вложение                                                           | Вложенность цикла/торгового представителя | вложение вызова |
|------------------------------------------|--------------------------------------|---------------------------------------------------------------------------|------------------|--------------|
| [If bool-PS](if-bool---ps.md)         | 1                                    | 0                                                                         | 0                | 0            |
| [Если пред-PS](if-pred---ps.md)         | 0                                    | 1                                                                         | 0                | 0            |
| [Если \_ comp-PS](if-comp---ps.md)        | 0                                    | 1                                                                         | 0                | 0            |
| [else-PS](else---ps.md)               | 0                                    | 0                                                                         | 0                | 0            |
| [endif-PS](endif---ps.md)             | -1 ([Если bool-PS](if-bool---ps.md)) | -1 ([Если "пред-PS](if-pred---ps.md) " или " [ \_ comp-PS](if-comp---ps.md)") | 0                | 0            |
| [Представитель-PS](rep---ps.md)                 | 0                                    | 0                                                                         | 1                | 0            |
| [ендреп-PS](endrep---ps.md)           | 0                                    | 0                                                                         | -1               | 0            |
| [Loop-PS](loop---ps.md)               | Недоступно                                  | Недоступно                                                                       | Недоступно              | Недоступно          |
| [ендлуп-PS](endloop---ps.md)         | Недоступно                                  | Недоступно                                                                       | Недоступно              | Недоступно          |
| [Break-PS](break---ps.md)             | 0                                    | 0                                                                         | 0                | 0            |
| [Останов \_ comp-PS](break-comp---ps.md)  | 0                                    | 1,-1                                                                     | 0                | 0            |
| [бреакп-PS](break-p---ps.md)          | 0                                    | 0                                                                         | 0                | 0            |
| [Call-PS](call---ps.md)               | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз bool-PS](callnz-bool---ps.md) | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз, пред-PS](callnz-pred---ps.md) | 0                                    | 1                                                                         | 0                | 1            |
| [RET-PS](ret---ps.md)                 | 0                                    | -1 ([каллнз-PS](callnz-pred---ps.md))                              | 0                | -1           |
| [сетп \_ comp-PS](setp-comp---ps.md)    | 0                                    | 0                                                                         | 0                | 0            |



 

### <a name="nesting-depth"></a>Глубина вложения

Глубина вложения определяет количество инструкций, которые могут быть вызваны внутри друг друга. Каждый тип инструкции имеет один или несколько ограничений вложения, как указано в следующей таблице.



| Тип инструкции | Максимум |
|------------------|---------|
| Статическое вложение   | 24      |
| Динамическое вложение  | 24      |
| вложение представителя      | 4       |
| вложение вызова     | 4       |



 

### <a name="instruction-depth-count-for-ps_3_0"></a>Счетчик глубины инструкций для PS \_ 3 \_ 0

Каждая инструкция учитывает один или несколько ограничений глубины вложения. В этой таблице показано количество элементов, добавляемых или вычитаемых каждой инструкцией из существующей глубины.



| Инструкция                              | Статическое вложение                       | Динамическое вложение                                                           | Вложенность цикла/торгового представителя | вложение вызова |
|------------------------------------------|--------------------------------------|---------------------------------------------------------------------------|------------------|--------------|
| [If bool-PS](if-bool---ps.md)         | 1                                    | 0                                                                         | 0                | 0            |
| [Если пред-PS](if-pred---ps.md)         | 0                                    | 1                                                                         | 0                | 0            |
| [Если \_ comp-PS](if-comp---ps.md)        | 0                                    | 1                                                                         | 0                | 0            |
| [else-PS](else---ps.md)               | 0                                    | 0                                                                         | 0                | 0            |
| [endif-PS](endif---ps.md)             | -1 ([Если bool-PS](if-bool---ps.md)) | -1 ([Если "пред-PS](if-pred---ps.md) " или " [ \_ comp-PS](if-comp---ps.md)") | 0                | 0            |
| [Представитель-PS](rep---ps.md)                 | 0                                    | 0                                                                         | 1                | 0            |
| [ендреп-PS](endrep---ps.md)           | 0                                    | 0                                                                         | -1               | 0            |
| [Loop-PS](loop---ps.md)               | 0                                    | 0                                                                         | 1                | 0            |
| [ендлуп-PS](endloop---ps.md)         | 0                                    | 0                                                                         | -1               | 0            |
| [Break-PS](break---ps.md)             | 0                                    | 0                                                                         | 0                | 0            |
| [Останов \_ comp-PS](break-comp---ps.md)  | 0                                    | 1,-1                                                                     | 0                | 0            |
| [бреакп-PS](break-p---ps.md)          | 0                                    | 0                                                                         | 0                | 0            |
| [Call-PS](call---ps.md)               | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз bool-PS](callnz-bool---ps.md) | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз, пред-PS](callnz-pred---ps.md) | 0                                    | 1                                                                         | 0                | 1            |
| [RET-PS](ret---ps.md)                 | 0                                    | -1 ([каллнз-PS](callnz-pred---ps.md))                              | 0                | -1           |
| [сетп \_ comp-PS](setp-comp---ps.md)    | 0                                    | 0                                                                         | 0                | 0            |



 

### <a name="nesting-depth"></a>Глубина вложения

Глубина вложения определяет количество инструкций, которые могут быть вызваны внутри друг друга. Каждый тип инструкции имеет один или несколько ограничений вложения, как указано в следующей таблице.



| Тип инструкции | Максимум |
|------------------|---------|
| Статическое вложение   | 24      |
| Динамическое вложение  | 24      |
| Вложенность цикла/торгового представителя | 4       |
| вложение вызова     | 4       |



 

### <a name="instruction-depth-count-for-ps_3_sw"></a>Счетчик глубины инструкций для PS \_ 3 \_ SW

Каждая инструкция учитывает один или несколько ограничений глубины вложения. В этой таблице показано количество элементов, добавляемых или вычитаемых каждой инструкцией из существующей глубины.



| Инструкция                              | Статическое вложение                       | Динамическое вложение                                                           | Вложенность цикла/торгового представителя | вложение вызова |
|------------------------------------------|--------------------------------------|---------------------------------------------------------------------------|------------------|--------------|
| [If bool-PS](if-bool---ps.md)         | 1                                    | 0                                                                         | 0                | 0            |
| [Если пред-PS](if-pred---ps.md)         | 0                                    | 1                                                                         | 0                | 0            |
| [Если \_ comp-PS](if-comp---ps.md)        | 0                                    | 1                                                                         | 0                | 0            |
| [else-PS](else---ps.md)               | 0                                    | 0                                                                         | 0                | 0            |
| [endif-PS](endif---ps.md)             | -1 ([Если bool-PS](if-bool---ps.md)) | -1 ([Если "пред-PS](if-pred---ps.md) " или " [ \_ comp-PS](if-comp---ps.md)") | 0                | 0            |
| [Представитель-PS](rep---ps.md)                 | 0                                    | 0                                                                         | 1                | 0            |
| [ендреп-PS](endrep---ps.md)           | 0                                    | 0                                                                         | -1               | 0            |
| [Loop-PS](loop---ps.md)               | 0                                    | 0                                                                         | 1                | 0            |
| [ендлуп-PS](endloop---ps.md)         | 0                                    | 0                                                                         | -1               | 0            |
| [Break-PS](break---ps.md)             | 0                                    | 0                                                                         | 0                | 0            |
| [Останов \_ comp-PS](break-comp---ps.md)  | 0                                    | 1,-1                                                                     | 0                | 0            |
| [бреакп-PS](break-p---ps.md)          | 0                                    | 0                                                                         | 0                | 0            |
| [Call-PS](call---ps.md)               | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз bool-PS](callnz-bool---ps.md) | 0                                    | 0                                                                         | 0                | 1            |
| [каллнз, пред-PS](callnz-pred---ps.md) | 0                                    | 1                                                                         | 0                | 1            |
| [RET-PS](ret---ps.md)                 | 0                                    | -1 ([каллнз-PS](callnz-pred---ps.md))                              | 0                | -1           |
| [сетп \_ comp-PS](setp-comp---ps.md)    | 0                                    | 0                                                                         | 0                | 0            |



 

### <a name="nesting-depth"></a>Глубина вложения

Глубина вложения определяет количество инструкций, которые могут быть вызваны внутри друг друга. Каждый тип инструкции имеет один или несколько ограничений вложения, как указано в следующей таблице.



| Тип инструкции | Максимум |
|------------------|---------|
| Статическое вложение   | 24      |
| Динамическое вложение  | 24      |
| Вложенность цикла/торгового представителя | 4       |
| вложение вызова     | 4       |



 

## <a name="interaction-of-per-pixel-flow-control-with-screen-gradients"></a>взаимодействие элемента управления Flow Per-Pixel с градиентами экрана

Набор инструкций шейдера пикселей включает несколько инструкций, которые создают или используют градиенты количества в отношении пространства экрана x и y. Чаще всего градиенты используются для вычисления расчетов уровня детализации для выборки текстур, а в случае анизотропной фильтрации — выборки на оси анизотроп. Как правило, аппаратные реализации запускают шейдер пикселей на нескольких пикселях одновременно (например, в сетке 2x2), поэтому градиенты количеств, вычисленные в шейдере, могут быть приблизительно приблизительными в виде разностей значений в одной и той же точке выполнения в смежных пикселях.

Когда управление потоком представлено в шейдере, результат вычисления градиента в заданном пути перехода является неоднозначным, если смежные Пиксели могут выполнять отдельные пути управления потоком. Поэтому считается недопустимым использование любой операции шейдера пикселей, запрашивающей вычисление градиента в расположении, находящегося внутри конструкции управления потоком, которая может меняться в пикселях для растрирования данного примитива.

Все инструкции шейдера пикселей разделены на те операции, которые разрешены и в те, которые не разрешены внутри управления потоком:

-   Сценарий а. операции, которые не разрешены внутри управления потоком, которые могут различаться в пикселах примитива. К ним относятся операции, перечисленные в следующей таблице. 

    | Инструкция                                                                                                      | разрешено в элементе управления Flow, если:                       |
    |------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
    | [текслд-PS \_ 2 \_ 0 и выше](texld---ps-2-0.md), [текслдб-PS](texldb---ps.md) и [текслдп-PS](texldp---ps.md) | Для координаты текстуры используется временный регистр. |
    | [ДСКС-PS](dsx---ps.md) и [ДСИ-PS](dsy---ps.md)                                                            | Для операнда используется временный регистр.            |

    

     

-   Сценарий б. операции, которые могут находиться где угодно. К ним относятся операции, перечисленные в следующей таблице. 

    | Инструкция                                                                                                      | Может находиться в любом месте, если:                                                                                             |
    |------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
    | [текслд-PS \_ 2 \_ 0 и выше](texld---ps-2-0.md), [текслдб-PS](texldb---ps.md) и [текслдп-PS](texldp---ps.md) | Количество, доступное только для чтения, используется для координаты текстуры (может варьироваться на пиксель, например в виде интерполяции текстурных координат). |
    | [ДСКС-PS](dsx---ps.md) и [ДСИ-PS](dsy---ps.md)                                                            | Для входного операнда используется количество, доступное только для чтения (может варьироваться на пиксель, например в виде интерполяции текстурных координат).      |
    | [текслдл-PS](texldl---ps.md)                                                                                   | Пользователь предоставляет уровень детализации в качестве аргумента, поэтому градиенты отсутствуют, и, следовательно, нет проблем с управлением потоком.       |
    | [текслдд-PS](texldd---ps.md)                                                                                   | Пользователь предоставляет градиенты в качестве входных аргументов, поэтому нет проблем с управлением потоком.                                 |

    

     

Эти ограничения строго применяются в проверке шейдера. В сценариях с условием ветви, похожего на то, что оно будет согласовано в примитиве, даже если операнд в выражении условия является количеством, вычисленным шейдером, но по-прежнему относится к сценарию а и не разрешено. Аналогично, в сценариях, где градиенты запрашиваются по определенному построителю шейдеров, с помощью динамического управления потоком, но при этом отображается, что x не изменяется ни в одной из ветвей, но и не разрешается.

Затенения включается в эти ограничения на управление потоком, поэтому реализации остаются свободными для упрощения обмена данными о реализации ветвей ветвления с помощью предикатов.

Пользователь может использовать инструкции из сценариев A и B вместе. Например, предположим, что пользователю требуется пример анизотропной текстуры по заданному текстурной координате шейдера. Однако загрузка текстуры необходима только для пикселов, отвечающих определенному условию для каждого пикселя. Чтобы удовлетворить эти требования, пользователь может вычислить координаты текстуры для всех пикселей за пределами многопиксельного управления потоком, немедленно вычисляя градиенты с помощью инструкций [ДСКС-PS](dsx---ps.md) и [ДСИ-PS](dsy---ps.md) . Затем в блоке на уровне [bool-PS](if-bool---ps.md) / [endif-PS](endif---ps.md) пользователь может использовать [текслдд-PS](texldd---ps.md) (текстурную загрузку с предоставленными пользователем градиентами), передавая предварительно вычисленные градиенты. Другим способом описать этот шаблон использования является то, что хотя всем пикселям примитива приходится вычислять координаты текстуры и участвовать в вычислении градиента, только пикселы, необходимые для выборки текстуры, фактически сделали это.

Независимо от этих правил, накладные расходы остаются на пользователе, чтобы убедиться, что перед вычислением любого градиента (или при выполнении примера текстуры, который неявно вычисляет градиент), регистр, содержащий исходные данные, должен быть инициализирован для всех путей выполнения заранее. Инициализация временных регистров не проверяется и не применяется в целом.

## <a name="related-topics"></a>Связанные разделы

<dl> <dt>

[Инструкции шейдера пикселей](dx9-graphics-reference-asm-ps-instructions.md)
</dt> </dl>

 

 




