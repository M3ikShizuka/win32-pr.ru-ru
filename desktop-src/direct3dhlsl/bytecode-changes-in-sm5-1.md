---
title: Изменения байтового кода в SM 5.1
description: SM 5.1 изменяет объявление регистров ресурсов и ссылки в инструкциях.
ms.assetid: ABECF705-67B8-4419-8D18-74B43B9DC3AF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e93d7d8533bac3750e743166a9d64b687fc06f0fbf21931d44e7d83d462cf15a
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118794562"
---
# <a name="bytecode-changes-in-sm51"></a>Изменения байтового кода в SM 5.1

SM 5.1 изменяет объявление регистров ресурсов и ссылки в инструкциях.

SM 5.1 перемещается к объявлению регистра "переменная", аналогично тому, как это делается для групповых регистров общей памяти, как показано в следующем примере:

``` syntax
Texture2D<float4> tex0          : register(t5,  space0);
Texture2D<float4> tex1[][5][3]  : register(t10, space0);
Texture2D<float4> tex2[8]       : register(t0,  space1);
SamplerState samp0              : register(s5, space0);

float4 main(float4 coord : COORD) : SV_TARGET
{
    float4 r = coord;
    r += tex0.Sample(samp0, r.xy);
    r += tex2[r.x].Sample(samp0, r.xy);
    r += tex1[r.x][r.y][r.z].Sample(samp0, r.xy);
    return r;
}
```

Дизассемблированный код в этом примере выглядит следующим образом:

``` syntax
// Resource Bindings:
//
// Name                                 Type  Format         Dim Space Slot  Elements
// ------------------------------ ---------- ------- ----------- ----- ---- ---------
// samp0                             sampler      NA          NA     0    5         1
// tex0                              texture  float4          2d     0    5         1
// tex1[0][5][3]                     texture  float4          2d     0   10 unbounded
// tex2[8]                           texture  float4          2d     1    0         8
//
//
//
// Input signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// COORD                    0   xyzw        0     NONE   float   xyzw
//
//
// Output signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// SV_TARGET                0   xyzw        0   TARGET   float   xyzw
//
ps_5_1
dcl_globalFlags refactoringAllowed
dcl_sampler s0[5:5], mode_default, space=0
dcl_resource_texture2d (float,float,float,float) t0[5:5], space=0
dcl_resource_texture2d (float,float,float,float) t1[10:*], space=0
dcl_resource_texture2d (float,float,float,float) t2[0:7], space=1
dcl_input_ps linear v0.xyzw
dcl_output o0.xyzw
dcl_temps 2
sample r0.xyzw, v0.xyxx, t0[0].xyzw, s0[5]
add r0.xyzw, r0.xyzw, v0.xyzw
ftou r1.x, r0.x
sample r1.xyzw, r0.xyxx, t2[r1.x + 0].xyzw, s0[5]
add r0.xyzw, r0.xyzw, r1.xyzw
ftou r1.xyz, r0.zyxz
imul null, r1.yz, r1.zzyz, l(0, 15, 3, 0)
iadd r1.y, r1.z, r1.y
iadd r1.x, r1.x, r1.y
sample r1.xyzw, r0.xyxx, t1[r1.x + 10].xyzw, s0[5]
add o0.xyzw, r0.xyzw, r1.xyzw
ret
// Approximately 12 instruction slots used
```

Каждый диапазон ресурсов шейдера теперь имеет идентификатор (имя) в байт-коде шейдера. Например, массив текстуры Tex1 превращается в "1" в байтовой кодировке шейдера. Присвоение уникальных идентификаторов каждому диапазону ресурсов позволяет выполнить два действия:

-   Однозначно определяет, какой диапазон ресурсов (см. дкл \_ Resource \_ Texture2D) индексируется в инструкции (см. пример инструкции).
-   Присоедините к объявлению набор атрибутов, например тип элемента, размер шага, режим растровой операции и т. д.

Обратите внимание, что идентификатор диапазона не связан с объявлением HLSL нижней границы.

Порядок привязок ресурсов отражения и инструкций по объявлению шейдеров одинаков для помощи в определении соответствия между переменными HLSL и идентификаторами байт-кода.

Каждая инструкция объявления в SM 5.1 использует трехмерный операнд для определения: идентификатор диапазона, Нижняя и верхняя границы. Для указания пространства регистра создается дополнительный токен. Также могут выдаваться другие токены для передачи дополнительных свойств диапазона, например кбуффер или инструкция объявления буфера, выдает размер кбуффер или структуры. Точные сведения о кодировке можно найти в d3d12TokenizedProgramFormat. h и D3D10ShaderBinary:: Кшадеркодепарсер.

Инструкции SM 5.1 не будут выдавать дополнительные сведения о операндах ресурсов в рамках инструкции (как в SM 5.0). Теперь эти сведения перемещаются в инструкции по объявлению. В SM 5.0 приведены инструкции по индексированию ресурсов, необходимых атрибутам ресурсов, которые должны быть описаны в маркерах расширенного кода операции, поскольку индексирование замаскировано к объявлению. В SM 5.1 Каждый идентификатор (например, "'t 1") однозначно связан с одним объявлением, описывающим необходимые сведения о ресурсах. Поэтому маркеры расширенного кода операций, используемые в инструкциях для описания сведений о ресурсах, больше не создаются.

В инструкциях без объявления операнд ресурса для образцов, СРВС и Уавс является 2D-операндом. Первый индекс представляет собой литеральную константу, указывающую идентификатор диапазона. Второй индекс представляет линейное значение индекса. Значение высчитывается относительно начала соответствующего пространства регистра (не относительно начала логического диапазона) для лучшего сопоставления с корневой подписью и для уменьшения количества погрузок компилятора драйвера на настройку индекса.

Операнд ресурса для КБВС — это трехмерный операнд: литеральный идентификатор диапазона, индекс кбуффер, смещение в конкретном экземпляре кбуффер.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Функции HLSL Shader Model 5,1 для Direct3D 12](hlsl-shader-model-5-1-features-for-direct3d-12.md)
</dt> <dt>

[Модель шейдера 5,1](shader-model-5-1.md)
</dt> </dl>

 

 




