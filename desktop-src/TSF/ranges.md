---
title: Диапазоны
description: Диапазоны
ms.assetid: 7488e29e-3409-4db3-98b4-f3438ad7c94e
keywords:
- Платформа текстовых служб (TSF), диапазоны
- TSF (платформа текстовых служб), диапазоны
- текстовые службы, диапазоны
- Приложения с поддержкой TSF, диапазоны
- ranges
- Платформа текстовых служб (TSF), привязки
- TSF (платформа текстовых служб), привязки
- текстовые службы, привязки
- Приложения с поддержкой TSF, привязки
- Привязки
- Платформа текстовых служб (TSF), клоны
- TSF (платформа текстовых служб), клоны
- текстовые службы, клоны
- Приложения с поддержкой TSF, клоны
- клонов
- Платформа текстовых служб (TSF), резервные копии
- TSF (платформа текстовых служб), резервные копии
- службы текстового ввода, резервные копии
- Приложения с поддержкой TSF, резервные копии
- backups
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8c6430f28731f95c0ad9c1beb04b31f0600b8c5
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "103986816"
---
# <a name="ranges"></a>Диапазоны

## <a name="anchors"></a>Привязки

Диапазон отделяется двумя *привязками*, начальной привязкой и конечной привязкой. В мнимой области существует привязка между двумя символами. Начальная привязка относится к тексту, расположенному после привязки, а конечная привязка относится к тексту, предшествующему привязке. Начальная и конечная привязки могут находиться в одном и том же месте. В этом случае диапазон имеет нулевую длину.

Например, начните со следующего текста:


```C++
This is text.
```



Теперь примените к этому тексту диапазон, содержащий как начальную, так и конечную привязки в позиции 0. Он визуально представляется следующим образом:


```C++
<anchor></anchor>This is text.
```



Привязки не занимают пробелов внутри самого текста. Это диапазон нулевой длины, и его текст пуст.

Теперь сдвигаются конечную точку привязки + 3 позиции. Он визуально представляется следующим образом:


```C++
<anchor>Thi</anchor>s is text.
```



Начальная привязка располагается непосредственно перед символом в позиции 0, а конечная привязка размещается сразу после символа в позиции 3, так как конечная привязка перемещена в правый 3 места. Теперь диапазон текста — «эт».

Кроме того, нельзя выполнить начальную привязку, чтобы следовать конечной точке, а конечная привязка не может предшествовать начальной точке привязки.

## <a name="anchor-gravity"></a>Сила притяжения привязки

Каждая привязка имеет параметр " *сила притяжения* ", который определяет, как привязка реагирует при вставке текста в текстовый поток в позиции привязки. При вставке в позицию привязки в позиции привязки необходимо выполнить корректировку. Сила притяжения определяет, как выполняется корректировка положения привязки.

Пример:


```C++
It is <anchor></anchor>cold today.
```



Если слово «очень» вставляется в позиции диапазона, начальная привязка может располагаться до или после вставленного слова:


```C++
It is <anchor>very </anchor>cold today.
```



\- - или -


```C++
It is very <anchor></anchor>cold today.
```



Сила притяжения привязок определяет способ изменения положения привязки при вставке в позицию. Сила притяжения может быть либо *обратно* , либо *вперед*.

Если у привязки есть обратная сила притяжения, то при вставке привязка перемещается в обратном направлении относительно точки вставки, чтобы вставленный текст находился после привязки:


```C++
It is <anchor>very </anchor>cold today.
```



Если у привязки есть прямая сила притяжения, привязка перемещается вперед (относительно точки вставки) к вставке, чтобы вставленный текст предшествовал привязке:


```C++
It is very <anchor></anchor>cold today.
```



## <a name="clones-and-backups"></a>Клоны и резервные копии

Существует два способа создания "копии" объекта диапазона. Первый — создать *клон* диапазона с помощью [Итфранже:: Clone](/windows/desktop/api/Msctf/nf-msctf-itfrange-clone). Второй — создать *резервную копию* диапазона с помощью [ITfContext:: креатеранжебаккуп](/windows/desktop/api/Msctf/nf-msctf-itfcontext-createrangebackup).

Клон — это копия диапазона, в который не входят статические данные. Привязки диапазона копируются, но клон по-прежнему охватывает диапазон текста внутри контекста. Клон — это объект Range во всех отношениях. Это означает, что текст и свойства клонированного диапазона являются динамическими и будут изменяться при изменении текста и/или свойств диапазона, охватываемого клоном.

В резервной копии хранится текст и свойства диапазона во время создания резервной копии в виде статических данных. Резервная копия также создает точную копию исходного диапазона, чтобы можно было контролировать изменения размера и расположения исходного диапазона. Это означает, что текст и свойства для диапазона резервного копирования являются статическими и не изменяются при изменении текста и/или свойств диапазона, охватываемого резервной копией.

Например, следующий диапазон (Пранже) в контексте:


```C++
"This is some <pRange>text</pRange>."
```



Теперь создайте клон и резервную копию этого диапазона:


```C++
ITfRange *pClone;
ITfRangeBackup *pBackup;

pRange->Clone(&pClone);
pContext->CreateRangeBackup(ec, pRange, &pBackup);
```



Теперь объекты содержат следующее:


```C++
pRange  = "text"
pClone  = "text"
pBackup = "text"
```



Теперь измените текст Пранже:


```C++
WCHAR wsz[] = L"other words";
pRange->SetText(ec, 0, wsz, lstrlenW(wsz));
```



Теперь объекты содержат следующее:


```C++
Context = "This is some other words."
pRange  = "other words"
pClone  = "other words"
pBackup = "text"
```



Установка текста привела к изменению текста в контексте. Это также привело к изменению конечной привязки Пранже и Пклоне. Пклоне теперь содержит "другие слова", так как текст изменился в диапазоне, и эти изменения будут записаны по всем диапазонам. При изменении текста, охваченного Пранже и Пклоне, текст Пклоне также изменился.

Текст в Пбаккуп не изменился с исходного Пранже, поскольку данные (текст и свойства) в резервной копии не связаны с контекстом и хранятся отдельно. Клон, содержащийся в резервной копии, фактически изменяется, но данные являются статическими.

При восстановлении резервной копии можно полностью применить резервную копию к клону в резервной копии или к другому диапазону. Чтобы применить резервную копию к клону в резервной копии, передайте **значение NULL** в [итфранжебаккуп:: Restore](/windows/desktop/api/Msctf/nf-msctf-itfrangebackup-restore) , как показано в следующем примере кода:


```C++
pBackup->Restore(ec, NULL);
```



Теперь объекты содержат следующее:


```C++
Context = "This is some text."
pRange  = "text"
pClone  = "text"
pBackup = "text"
```



Чтобы восстановить резервную копию в другой диапазон, передайте указатель на объект Range при вызове **итфранжебаккуп:: Restore**. Заархивированный текст и свойства будут применены к новому диапазону. Например, при использовании приведенного выше примера для вызова **RESTORE** пранже будет изменен, чтобы продемонстрировать это:


```C++
LONG lShifted;
pRange->ShiftEnd(ec, -2, &lShifted, NULL);
```



Теперь объекты содержат следующее:


```C++
Context = "This is some other words."
pRange  = "other wor"
pClone  = "other words"
pBackup = "text"
```



Когда конечная привязка Пранже была смещена влево на две позиции, конечная привязка Пклоне не изменилась.

Теперь восстановите резервную копию с помощью Пранже, как показано в следующем примере кода:


```C++
pBackup->Restore(ec, pRange);
```



Теперь объекты содержат следующее:


```C++
Context = "This is some textds."
pRange  = "text"
pClone  = "textds"
pBackup = "text"
```



Текст, покрываемый Пранже, был заменен на "Text", часть текста, покрываемая Пклоне, изменилась, а Пбаккуп изменяется в соответствии с Пранже.

 

 




