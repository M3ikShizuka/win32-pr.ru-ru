---
title: Регистрация службы текстового ввода
description: В дополнение к стандартным записям реестра серверной модели COM, служба текстового ввода должна зарегистрироваться в среде текстовых служб (TSF), чтобы она могла быть доступна для использования с приложением.
ms.assetid: 95676067-ab5c-470b-a4be-117ab6810d48
keywords:
- Платформа текстовых служб (TSF), регистрация
- TSF (платформа текстовых служб), регистрация
- текстовые службы, регистрация
- Платформа текстовых служб (TSF), языковые профили
- TSF (платформа текстовых служб), профили языка
- текстовые службы, языковые профили
- Платформа текстовых служб (TSF), категории
- TSF (платформа текстовых служб), категории
- текстовые службы, категории
- Регистрация текстовых служб
- регистрация профилей языка
- регистрация категорий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 45dc1b91ad1a3b1fde9a2e49b92950ce2db4876f
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104487976"
---
# <a name="text-service-registration"></a>Регистрация службы текстового ввода

В дополнение к стандартным записям реестра серверной модели COM, служба текстового ввода должна зарегистрироваться в среде текстовых служб (TSF), чтобы она могла быть доступна для использования с приложением. TSF предоставляет интерфейс [итфинпутпроцессорпрофилес](/windows/desktop/api/msctf/nn-msctf-itfinputprocessorprofiles) и [итфкатегоримгр](/windows/desktop/api/msctf/nn-msctf-itfcategorymgr) для упрощения процесса регистрации.

Поставщики текстовых служб также должны предоставлять цифровые подписи в двоичные исполняемые файлы. См. статью [Введение в подписывание кода](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537361(v=vs.85)).

## <a name="registering-the-text-service"></a>Регистрация службы текста

Служба текстового ввода регистрируется в TSF, вызывая [итфинпутпроцессорпрофилес:: Register](/windows/desktop/api/msctf/nf-msctf-itfinputprocessorprofiles-register) с идентификатором класса текстовой службы. Экземпляр интерфейса **итфинпутпроцессорпрофилес** получается путем вызова **CoCreateInstance** с CLSID \_ tf \_ инпутпроцессорпрофилес.

В следующем примере показано, как создать объект **итфинпутпроцессорпрофилес** и зарегистрировать текстовую службу.


```C++
BOOL RegisterTextService(CLSID clsidTextService)
{
    HRESULT hr;
    ITfInputProcessorProfiles *pInputProcessProfiles;

    hr = CoCreateInstance(  CLSID_TF_InputProcessorProfiles, 
                            NULL, 
                            CLSCTX_INPROC_SERVER,
                            IID_ITfInputProcessorProfiles, 
                            (LPVOID*)&pInputProcessProfiles);

    if (hr != S_OK)
    {
        return FALSE;
    }

    hr = pInputProcessProfiles->Register(clsidTextService);

    pInputProcessProfiles->Release();
    
    return (S_OK == hr);
}
```



[Итфинпутпроцессорпрофилес:: Отмена регистрации](/windows/desktop/api/msctf/nf-msctf-itfinputprocessorprofiles-unregister)

## <a name="registering-language-profiles"></a>Регистрация профилей языка

Служба текстового ввода доступна только в том случае, если фокус находится в приложении и на языковой панели выбран нужный язык. Для упрощения этой процедуры TSF требует, чтобы служба текстового ввода зарегистрировалась для всех поддерживаемых языков. Служба текстового интерфейса регистрирует свои языковые профили, вызывая [итфинпутпроцессорпрофилес:: аддлангуажепрофиле](/windows/desktop/api/msctf/nf-msctf-itfinputprocessorprofiles-addlanguageprofile) с идентификатором класса службы текста, идентификатором языка профиля и **идентификатором GUID** , определенным в текстовой службе, который определяет языковой профиль.

Можно удалить языковой профиль, вызвав [итфинпутпроцессорпрофилес:: ремовелангуажепрофиле](/windows/desktop/api/msctf/nf-msctf-itfinputprocessorprofiles-removelanguageprofile). **Итфинпутпроцессорпрофилес:: Unregister** удаляет все языковые профили для службы текстового ввода. При удалении текстовой службы необходимо удалить отдельные языковые профили.

## <a name="registering-categories"></a>Регистрация категорий

Служба текстового ввода также должна зарегистрировать категорию, к которой применяется служба текстовой службы. Например, если служба текстового интерфейса предоставляет сведения об атрибутах, она должна зарегистрировать себя в качестве поставщика атрибута просмотра, вызвав [итфкатегоримгр:: регистеркатегори](/windows/desktop/api/Msctf/nf-msctf-itfcategorymgr-registercategory) с идентификатором класса текстового сервиса для первого параметра, GUID \_ тфкат \_ дисплайаттрибутепровидер для второго параметра и идентификатор класса службы текстового ввода для третьего параметра. Возможные категории перечислены в разделе [стандартные значения категорий](predefined-category-values.md).

Удалите ранее зарегистрированные категории, вызвав [итфкатегоримгр:: унрегистеркатегори](/windows/desktop/api/Msctf/nf-msctf-itfcategorymgr-unregistercategory). Итфинпутпроцессорпрофилес:: Unregister удаляет все категории для службы текстового ввода. При удалении текстовой службы необходимо удалить отдельные категории.

 

 