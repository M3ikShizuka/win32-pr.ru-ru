---
title: 64-разрядные замечания
description: Благодаря повышению уровня доступности 64-разрядных ОС Windows пользователи предполагают входные методы, такие как международные клавиатуры на различных языках или редакторы методов ввода (IME) на восточноазиатских языках, для правильной работы с 32-и 64-разрядными приложениями.
ms.assetid: 6a99ad45-202c-4fbb-9707-341bc9fde21e
keywords:
- Платформа текстовых служб (TSF), 64-разрядная версия Windows
- TSF (платформа текстовых служб), 64-разрядная версия Windows
- текстовые службы, 64-разрядная версия Windows
- 64-разрядная версия Windows
- Платформа текстовых служб (TSF), редактор методов ввода (IME)
- TSF (платформа текстовых служб), редактор методов ввода (IME)
- текстовые службы, редактор методов ввода (IME)
- редактор метода ввода (IME)
- IME (редактор метода ввода)
- Платформа текстовых служб (TSF), международные клавиатуры
- TSF (платформа текстовых служб), международные клавиатуры
- текстовые службы, международные клавиатуры
- международные клавиатуры
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 045ec699c7a433f15b92467e3072d30acbf01936
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413127"
---
# <a name="64-bit-considerations"></a>64-разрядные замечания

Благодаря повышению уровня доступности 64-разрядных ОС Windows пользователи предполагают входные методы, такие как международные клавиатуры на различных языках или редакторы методов ввода (IME) на восточноазиатских языках, для правильной работы с 32-и 64-разрядными приложениями. При разработке компонентов метода ввода или текстовых служб для Microsoft Windows важно учитывать 64-разрядную платформу Windows в качестве потенциальной целевой платформы для вашего продукта.

Так как редакторы IME и текстовые службы (основанные на платформе текстовых служб) обычно реализуются как библиотеки динамической компоновки (DLL), важно отметить, что библиотеки DLL создаются специально для использования в 32-или 64-разрядных средах. Библиотека DLL, созданная для использования в 32-разрядных средах, не может использоваться в 64-разрядных приложениях и наоборот.

> [!Note]  
> Подсистема WOW64 не снижает опасность этого ограничения для данной версии DLL. Сведения о WOW64 см. в разделе [выполнение 32-разрядных приложений](/windows/desktop/WinProg64/running-32-bit-applications).

 

В этом разделе обсуждаются важные вопросы проектирования по разработке редакторов IME и текстовых служб для использования в 64-разрядных Windows.

## <a name="64-bit-considerations-for-imes"></a>64-разрядная информация по редакторам IME

В этом разделе описаны особые соображения, связанные с созданием редакторов IME для использования с 64-разрядными Windows. Дополнительные сведения о редакторах IME см. в разделе [Редактор метода ввода](/previous-versions/windows/desktop/dnacc/input-method-editor-and-text-services-framework-accessibility).

## <a name="building-32-bit-and-64-bit-versions-of-an-ime"></a>Создание 32-разрядных и 64-разрядных версий IME

Из-за ранее упомянутой 32-разрядной или 64-разрядной проблемы совместимости с библиотеками DLL необходимо предпринять некоторые меры предосторожности, чтобы обеспечить прозрачность работы IME с любым приложением (32-разрядным или 64-разрядным), работающим в 64-разрядной версии Windows. Рекомендуемое решение для того, чтобы редактор IME работал прозрачно с 32-разрядными и 64-разрядными приложениями на 64-разрядной платформе, — это создание и установка параллельных 32-разрядных и 64-разрядных версий библиотеки DLL IME. Как правило, разработчики создают параллельные библиотеки DLL из одного источника, настраивая параметры целевой платформы в своей среде сборки. Дополнительные сведения о 32-разрядных и 64-разрядных приложениях с одним разрядами см. в разделе [Подготовка к 64-bit Windows](/windows/desktop/WinProg64/getting-ready-for-64-bit-windows).

## <a name="side-by-side-installation-of-64-bit-and-32-bit-input-method-editors"></a>Параллельная установка 64-разрядных и 32-разрядных редакторов методов ввода

Разработчикам редакторов IME и текстовых служб следует помнить о 64-разрядных вопросах, описанных в этом разделе. К счастью, конечным пользователям этих служб не нужно беспокоиться о конкретных реализациях. Функция 64-разрядной версии Windows — это возможность скрыть от конечных пользователей необходимость в версиях DLL IME, относящихся к 64-и 32-bit. Если обе версии IME правильно установлены в параллельном режиме, 64-разрядная система Windows распознает наличие как 64-разрядных, так и 32-разрядных версий IME и представляет эти поразрядные редакторы IME для конечного пользователя как единый *логический* редактор IME. Когда пользователь должен использовать IME, 64-разрядная версия Windows прозрачно выбирает версию IME (32-bit или 64-bit), соответствующую заданным обстоятельствам.

Для параллельной установки 64-разрядного и 32-разрядного редактора IME для правильной работы (то есть для представления двух библиотек DLL, зависящих от платформы, в качестве одного логического редактора IME) должны выполняться следующие условия.

-   Разработчики должны создавать версии, относящиеся к платформе (одна для 32-разрядных Windows, а другая — для 64-разрядной версии Windows) библиотеки DLL IME.
-   32-разрядная и 64-разрядные библиотеки DLL должны иметь одно и то же имя файла.
-   Необходимо соблюдать требования к каталогу установки. Дополнительные сведения см. в разделе Требования к каталогу установки.

Параллельная установка 32-разрядных и 64-разрядных DLL IME совместно используют один и тот же раздел реестра для хранения данных конфигурации (включая имя файла DLL):


```C++
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts
```



Для создания этого раздела реестра используется функция [**имминсталлиме**](/windows/desktop/api/imm/nf-imm-imminstallimea) . Программа установки и установки IME должна вызывать эту функцию для регистрации IME в качестве поддерживаемой раскладки клавиатуры. Функция **имминсталлиме** должна вызываться только один раз: из 32-разрядной или 64-разрядной версии библиотеки DLL IME.

## <a name="mismatched-ime-dlls"></a>Несоответствие DLL-библиотек IME

Установка только 32-разрядной версии IME в 64-bit Windows не рекомендуется и не поддерживается. Если 64-разрядное приложение пытается загрузить 32-разрядный редактор IME, редактор IME не будет автоматически работать, когда приложение попытается загрузить соответствующую раскладку клавиатуры.

> [!IMPORTANT]
>
> Не отображается диалоговое окно или сообщение предупреждения при возникновении 64-разрядного приложения/32-разрядного конфликта IME.

 

64-разрядное замечание для текстовых служб

В этом разделе описаны особые соображения, связанные с созданием текстовых служб для использования в 64-разрядных средах. Дополнительные сведения о текстовых службах и платформе текстовых служб см. в разделе [Платформа текстовых служб](text-services-framework.md).

## <a name="building-32-bit-and-64-bit-text-services"></a>Создание 32-разрядных и 64-разрядных текстовых служб

Текстовая служба реализуется как объект модели COM, предоставляемый в библиотеке DLL. Следовательно, 32-разрядные или 64-разрядные конфликты DLL могут возникать при использовании текстовых служб, установленных в 64-разрядных Windows. Как и редакторы IME, рекомендуемое решение для обеспечения прозрачного функционирования службы текста с 32-и 64-разрядными приложениями на 64-разрядной платформе заключается в создании и установке параллельных 32-разрядных и 64-разрядных версий библиотеки DLL службы текстового ввода.

## <a name="side-by-side-installation-of-64-bit-and-32-bit-text-services"></a>Параллельная установка 64-разрядных и 32-разрядных текстовых служб

Для 32-разрядной и 64-разрядной версии службы текстового ввода, которая должна быть установлена параллельно и представлена пользователю как единая логическая служба текстового ввода, должны выполняться следующие условия.

-   Обе версии службы текстового ввода задают один и тот же идентификатор класса (CLSID) при регистрации в подсистеме COM.
-   Обе версии службы текстового ввода регистрируются независимо друг от друга. Дополнительные сведения см. в разделе [Регистрация приложений COM](/windows/desktop/com/registering-com-applications).

Если 32-разрядная текстовая служба зарегистрирована в 64-разрядной версии Windows, операция регистрации прозрачно перенаправляется в следующий раздел реестра:


```C++
HKEY_CLASS_ROOT\Wow6432Node\CLSID
```



[Перенаправитель реестра](/windows/desktop/WinProg64/registry-redirector)


```C++
HKEY_LOCAL_MACHINE\Software\Microsoft\CTF\TIP
```



[](/windows/desktop/api/Msctf/nn-msctf-itfinputprocessorprofiles)[Регистрация службы текстового ввода](text-service-registration.md) итфинпутпроцессорпрофилес

64-разрядная и 32-разрядная версия службы текстового ввода может использоваться одновременно. В случаях, когда обеим версиям службы текстового сервиса требуется работать с любыми общими объектами, координация для доступа к общим объектам должна разрабатываться в текстовой службе. Каждая служба текстового ввода отвечает за управление любыми общими объектами, которые используются или необходимы.

## <a name="installing-only-32-bit-text-services-on-64-bit-windows"></a>Установка только 32-разрядных текстовых служб в 64-разрядной версии Windows

Установка только 32-разрядной версии службы текстового ввода на 64-разрядной платформе Windows не рекомендуется и не поддерживается. Из-за сопоставления регистрации, которое выполняется на 64-разрядных платформах Windows, 64-разрядное приложение может перечислить службы 32-bit Text Service через интерфейс **итфинпутпроцессорпрофилес** . Однако если 64-разрядное приложение пытается загрузить 32-разрядную текстовую службу, загрузка завершается неудачно.

> [!IMPORTANT]
>
> При возникновении ошибки с конфликтом в 64-разрядном приложении или 32-разрядной службе текстового ввода не отображается предупреждение или диалоговое окно предупреждения.

 

Другие вопросы

## <a name="installation-directory-requirements"></a>Требования к каталогу установки

В этом разделе описываются требования к установке двоичных файлов IME и текстового файла. Если эти требования не соблюдаются, то Ваша текстовая служба или редактор IME могут работать неправильно.

**Библиотеки DLL IME**

На 64-разрядных платформах Windows установите 32-разрядные и 64-разрядные библиотеки DLL IME в следующих каталогах:

-   Установите 32-разрядные библиотеки DLL IME в системном каталоге SysWOW64. чтобы получить этот путь к каталогу, вызовите [**GetSystemWow64Directory**](/windows/desktop/api/wow64apiset/nf-wow64apiset-getsystemwow64directorya)или [**шжетфолдерпас**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetfolderpatha) с **CSid \_ SYSTEMX86** . Кроме того, если вы используете [установщик Windows](/windows/desktop/Msi/about-windows-installer), используйте свойство [**системфолдер**](/windows/desktop/Msi/systemfolder) .
-   Установите 64-разрядные DLL IME в системном каталоге System32. Вызовите [**GetSystemDirectory**](/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsystemdirectorya)или **шжетфолдерпас** с [CSid \_ System](/windows/desktop/shell/csidl) , чтобы получить путь к каталогу. Для установщик Windows используйте свойство [**System64Folder**](/windows/desktop/Msi/system64folder) .

**DLL-библиотеки текстовых служб и связанные двоичные файлы**

На 64-разрядных платформах Windows установите 32-и 64-bit текстовые библиотеки DLL, а также любые другие двоичные файлы, связанные с текстовой службой или IME, в следующих каталогах:

-   Установите 32-разрядные библиотеки текстовых файлов и другие 32-разрядные двоичные файлы в подкаталог в каталоге Program Files (x86). Вызовите **шжетфолдерпас** с **CSid \_ Program \_ FILESX86** , чтобы получить путь к каталогу. Для установщик Windows используйте свойство [**ProgramFilesFolder**](/windows/desktop/Msi/programfilesfolder) .
-   Установите 64-разрядные библиотеки текстовых файлов и другие 64-разрядные двоичные файлы в подкаталог в каталоге Program Files; Вызовите **шжетфолдерпас** с **\_ программными \_ файлами CSid** , чтобы получить путь к каталогу. Для установщик Windows используйте свойство [**ProgramFiles64Folder**](/windows/desktop/Msi/programfiles64folder) .

Если вы не используете пакет установщик Windows для установки текстового редактора IME или Text, настоятельно рекомендуется, что вы используете приложение для установки 64-разрядной версии. Перенаправитель файловой системы WOW64 может привести к тому, что 32-разрядные установщики помещают файлы в неправильные каталоги (например, перенаправление файловой системы WOW64 может привести к тому, что файлы, предназначенные для каталога System32, будут установлены в каталог SysWOW64). Если необходимо использовать 32-разрядный установщик, отключите перенаправление файлов WOW64 во время процесса установки, чтобы служба перенаправления файлов не вызывала непреднамеренного перенаправления во время процесса установки. Сведения о перенаправлении файловой системы WOW64 см. в разделе [перенаправитель файловой системы](/windows/desktop/WinProg64/file-system-redirector). Сведения о том, как отключить или включить перенаправление файловой системы WOW64, см. в разделе [**Wow64EnableWow64FsRedirection**](/windows/desktop/api/winbase/nf-winbase-wow64enablewow64fsredirection).

> [!TIP]
>
> Избегайте жестко запрограммированных путей установки. Дополнительные сведения см. [в разделе Поиск каталогов с помощью интерфейса программирования приложений, не Hard-Coded путей](/previous-versions//ms675638(v=vs.85)) .

 

> [!IMPORTANT]
>
> Не устанавливайте файлы IME или Text Service в специальный каталог% WINDIR% \\ IME (по умолчанию, c: \\ Windows \\ IME). Этот каталог содержит системные файлы, поддерживающие текстовые службы и редакторы IME; Он не должен содержать какие-либо сторонние файлы IME или текстовые службы, а перенаправление файловой системы WOW64 для этого каталога не поддерживается.

 

## <a name="dual-ctfmonexe-processes-run-on-64-bit-windows-platforms"></a>Два Ctfmon.exeных процесса работают на 64-разрядных платформах Windows

ctfmon.exe процесс управляет платформой текстовых служб на рабочем столе, а также предоставляет пользовательский интерфейс языковой панели. В 64-разрядной версии Windows одновременно выполняется 32-разрядная и 64-разрядная версия ctfmon.exe процесса. 64-разрядный процесс ctfmon.exe управляет 64-разрядными текстовыми службами, и, аналогичным образом, 32-разрядный ctfmon.exe процесс управляет 32-разрядными текстовыми службами.

## <a name="display-behavior-for-different-versions-of-the-language-bar-ui"></a>Поведение при отображении для разных версий пользовательского интерфейса языковой панели

В 64-разрядной системе Windows отображается только пользовательский интерфейс языковой панели, связанный с 64-разрядной версией службы текстового ввода. В случаях, когда 32-разрядное приложение использует 32-разрядную версию службы текстового ввода, 64-bit Windows автоматически вставляет пользовательский интерфейс языковой панели для эквивалентной функции 64-bit Text Service. Это гарантирует, что для появления 32-разрядных текстовых служб не требуется никаких специальных операций в 64-разрядной версии языковой панели.

## <a name="control-panel-considerations-on-64-bit-windows"></a>Рекомендации по панели управления в 64-разрядной версии Windows

64-bit Windows предоставляет доступ к 32-и 64-разрядным версиям текстовых служб и редакторов IME с помощью панели управления. Чтобы получить доступ к параметрам панели управления для конкретных версий текстовых служб или редакторов IME, просмотрите следующие расположения.

-   **Доступ к панели управления для 32-разрядных текстовых служб и редакторов IME:** Пуск-> параметры — > панель управления — > View x86 значки панели управления
-   **Доступ к панели управления для 64-разрядных текстовых служб и редакторов IME:** Параметры Пуск->-> панель управления — > язык и региональные стандарты

Могут возникнуть обстоятельства, в которых некоторые параметры могут быть доступны только через 32-разрядную панель управления. В этих случаях следует убедиться, что пользователи службы текстового ввода или IME знают об этом, предоставляя соответствующую документацию или предлагая подсказки пользовательского интерфейса в интерфейсе 64-разрядных параметров.

 

 