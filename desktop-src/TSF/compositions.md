---
title: Композиции
description: Композиция — это временное состояние ввода, которое позволяет текстовой службе указать как для приложения, так и для пользователя, что входной текст все еще находится в состоянии изменения.
ms.assetid: 3d9da4f2-ceb9-4abc-8979-d3756d948a57
keywords:
- Платформа текстовых служб (TSF), композиции
- TSF (платформа текстовых служб), композиции
- текстовые службы, композиции
- Приложения с поддержкой TSF, композиции
- compositions
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b03f3e991f76ee7c6dca3830267796576c7b842
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104413436"
---
# <a name="compositions"></a>Композиции

Композиция — это временное состояние ввода, которое позволяет текстовой службе указать как для приложения, так и для пользователя, что входной текст все еще находится в состоянии изменения. Приложение может и должно получать сведения об атрибутах композиции и использовать эти сведения для отображения состояния композиции пользователю.

Один из примеров использования композиции — во время речевого ввода. В то время как пользователь говорит, служба речевого текста создает композицию. Эта композиция будет оставаться неизменной до тех пор, пока не завершится весь речевой ввод. По завершении сеанса служба речевого текста прерывает композицию.

Приложение использует присутствие и отсутствие композиции, чтобы определить способ отображения текста и то, что, если таковая имеется, должна выполняться обработка текста. Например, если пользователь использует обработчик речи для ввода текста, приложение не должно выполнять проверку орфографии или грамматики для текста композиции. Текст считается неполным до завершения композиции.

## <a name="text-services"></a>Текстовые службы

Служба текстового ввода создает композицию путем вызова [итфконтексткомпоситион:: старткомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextcomposition-startcomposition). При необходимости в текстовой службе можно реализовать объект [итфкомпоситионсинк](/windows/desktop/api/msctf/nn-msctf-itfcompositionsink) , который получает уведомления о событиях композиции. Старткомпоситион возвращает объект [итфкомпоситион](/windows/desktop/api/msctf/nn-msctf-itfcomposition) , который служба текстового ввода хранит ссылку и использует для изменения и завершения композиции. Служба текстового ввода завершает композицию путем вызова [итфкомпоситион:: ендкомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcomposition-endcomposition).

Если служба текстового ввода будет создавать композиции, она также должна поддерживать атрибуты дисплея, чтобы позволить приложению отображать текст, который является частью композиции, иначе, чем стандартный текст. Дополнительные сведения см. в разделе [предоставление атрибутов вывода](providing-display-attributes.md).

## <a name="applications"></a>Приложения

Приложение может отслеживать создание, изменение и завершение композиций путем установки приемника [итфконтекстовнеркомпоситионсинк](/windows/desktop/api/msctf/nn-msctf-itfcontextownercompositionsink) . При запуске композиции вызывается [итфконтекстовнеркомпоситионсинк:: онстарткомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onstartcomposition) . Аналогично, при изменении или завершении композиции будут вызываться [итфконтекстовнеркомпоситионсинк:: онупдатекомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onupdatecomposition) и [Итфконтекстовнеркомпоситионсинк:: OnEndComposition](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionsink-onendcomposition) , соответственно.

Ниже приведена типичная процедура обновления документа с помощью композиции.

1.  [ITextStoreACP:: инсерттекстатселектион](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-inserttextatselection) или [Итекстстореанчор:: инсерттекстатселектион](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-inserttextatselection) обычно используются для вставки исходного текста в композицию.
2.  Композиция начинается с вызова [итфконтексткомпоситион:: старткомпоситион](/windows/desktop/api/Msctf/nf-msctf-itfcontextcomposition-startcomposition)с использованием диапазона текста, возвращаемого **инсерттекстатселектион**.
3.  Когда он получает новые входные данные, такие как речь или ввод с клавиатуры, приложение обновляет композицию с помощью [ITextStoreACP:: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreacp-settext) или [Итекстстореанчор:: SetText](/windows/desktop/api/Textstor/nf-textstor-itextstoreanchor-settext).
4.  Когда приложение определяет, что время окончания компоновки завершено, вызывается метод [итфкомпоситион:: ендкомпоситион](/windows/desktop/api/Msctf/nf-msctf-itfcomposition-endcomposition).

Приложение должно использовать атрибуты экрана, предоставляемые службой текстового ввода, для изменения отображаемого текста в любое время, а не только в том случае, если композиция активна. Дополнительные сведения см. [в разделе Использование атрибутов вывода](using-display-attributes.md).

При необходимости приложение может завершить композицию путем вызова [итфконтекстовнеркомпоситионсервицес:: терминатекомпоситион](/windows/desktop/api/msctf/nf-msctf-itfcontextownercompositionservices-terminatecomposition).

 

 