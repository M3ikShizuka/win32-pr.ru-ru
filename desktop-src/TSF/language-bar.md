---
title: Языковая панель (текстовые службы)
description: Языковая панель
ms.assetid: 82b92567-fdc1-488c-b395-4cb95257955c
keywords:
- Платформа текстовых служб (TSF), языковая панель
- TSF (платформа текстовых служб), языковая панель
- текстовые службы, языковая панель
- Языковая панель
- Платформа текстовых служб (TSF), кнопки
- TSF (платформа текстовых служб), кнопки
- текстовые службы, кнопки
- Платформа текстовых служб (TSF), меню
- TSF (платформа текстовых служб), меню
- текстовые службы, меню
- стили кнопок
- кнопки меню
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e3c4359c6753f5d96613435f9501036f1d5f317
ms.sourcegitcommit: 8ebcf6cd36f67f8bcf78e76ae8923d65b8995c8a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2021
ms.locfileid: "111524448"
---
# <a name="language-bar-text-services"></a>Языковая панель (текстовые службы)

## <a name="implementing-the-language-bar-object"></a>Реализация объекта языковой панели

Для поддержки добавления элемента на языковую панель служба текстового интерфейса должна реализовать объект, который поддерживает интерфейс [итфсаурце](/windows/desktop/api/msctf/nn-msctf-itfsource) и один из элементов управления [итфлангбаритем](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritem) . При установке элемента языковая панель устанавливает приемник [итфлангбаритемсинк](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemsink) , вызывая [Итфсаурце:: AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) элемента с идентификатором IID \_ итфлангбаритемсинк. Элемент использует интерфейс **итфлангбаритемсинк** для уведомления языковой панели изменений, например, когда элемент скрыт, показан, включен или отключен.

Можно установить четыре типа элементов языковой панели, и каждый из необходимых интерфейсов создается из **итфлангбаритем**. Ниже перечислены возможные элементы управления **итфлангбаритем** .



|   Элемент            |    Описание                                                                                                                                                                               |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Кнопка        | Кнопка языковой панели выступает в качестве кнопки, переключателя или меню на языковой панели. Объект должен поддерживать интерфейс Итфлангбаритембуттон.                   |
| Появится       | Всплывающее окно языковой панели выступает в качестве всплывающего уведомления на языковой панели. Объект должен поддерживать интерфейс Итфлангбаритембаллун.                                       |
| Bitmap        | Точечный рисунок языковой панели выступает в качестве статического элемента на языковой панели, которая отображает точечный рисунок. Объект должен поддерживать интерфейс Итфлангбаритембитмап.                       |
| Кнопка точечного рисунка | Кнопка точечного рисунка языковой панели функционирует как элемент кнопки на языковой панели, которая отображает текст и точечный рисунок. Объект должен поддерживать интерфейс Итфлангбаритембитмапбуттон. |



 

## <a name="button-styles"></a>Стили кнопок

Элемент Button может работать как любой из следующих элементов. Функция элемента Button определяется флагами, заданными в элементе **двстиле** структуры [tf \_ Лангбаритеминфо](/windows/desktop/api/ctfutb/ns-ctfutb-tf_langbariteminfo) в методе [итфлангбаритем::-info](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritem-getinfo) .



|    Элемент           |    Описание                                                                                                                                                                                                                                                                                                                                                                                  |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Кнопка        | Кнопка работает как стандартная Командная кнопка. Этот стиль кнопки определяется \_ \_ стилем кнопки TF ЛБИ Style \_ БТН \_ . Итфлангбаритембуттон:: OnClick вызывается при щелчке элемента. Итфлангбаритембуттон:: Инитмену и Итфлангбаритембуттон:: Онменуселект не используются.                                                                                                   |
| Выключатель | Кнопка выступает в качестве элемента управления "переключатель", который может поддерживать выбранное состояние, аналогично флажку. Этот стиль кнопки определяется \_ \_ \_ \_ стилем переключателя TF ЛБИ Style БТН. Итфлангбаритембуттон:: OnClick вызывается при щелчке элемента. Итфлангбаритембуттон:: Инитмену и Итфлангбаритембуттон:: Онменуселект не используются.                                                  |
| Меню          | Кнопка выступает в качестве раскрывающегося меню. Этот стиль кнопки определяется \_ \_ стилем меню TF ЛБИ Style \_ БТН \_ . Итфлангбаритембуттон:: Инитмену вызывается при нажатии кнопки. Когда пользователь выбирает элемент в меню, языковая панель вызывает Итфлангбаритембуттон:: Онменуселект с идентификатором выбранного пункта меню. Итфлангбаритембуттон:: OnClick не используется. |



 

## <a name="implementing-a-menu-button"></a>Реализация кнопки меню

Когда пользователь нажимает кнопку меню, языковая панель вызывает [итфлангбаритембуттон:: инитмену](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu). Элемент добавляет элементы в меню с помощью интерфейса [итфмену](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu) , переданного в инитмену.

Чтобы добавить подменю в меню, вызовите [итфмену:: аддменуитем](/windows/desktop/api/Ctfutb/nf-ctfutb-itfmenu-addmenuitem) с \_ \_ подменю TF лбменуф. Когда это будет сделано, новый объект **итфмену** , представляющий подменю, возвращается в параметре *ппмену* объекта аддменуитем. Этот новый объект меню используется для добавления элементов в подменю.

Когда пользователь выбирает элемент в меню, языковая панель вызывает [итфлангбаритембуттон:: онменуселект](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) с идентификатором выбранного пункта меню.

## <a name="adding-items-to-the-language-bar"></a>Добавление элементов на языковую панель

Текстовая служба должна добавлять свои элементы на языковую панель при вызове метода [итфтекстинпутпроцессор:: Activate](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-activate) и удалять их при вызове [итфтекстинпутпроцессор::D еактивате](/windows/desktop/api/msctf/nf-msctf-itftextinputprocessor-deactivate) .

Чтобы добавить элемент на языковую панель, служба текстового интерфейса получает интерфейс [итфлангбаритеммгр](/windows/desktop/api/ctfutb/nn-ctfutb-itflangbaritemmgr) , вызывая ITfThreadMgr:: QUERYINTERFACE с IID \_ итфлангбаритеммгр. Затем служба Text вызывает [итфлангбаритеммгр:: AddItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-additem) с указателем на объект элемента языковой панели.

Служба текстового ввода должна удалить элемент при деактивации. В текстовой службе используется тот же интерфейс **итфлангбаритеммгр** , который используется для добавления элементов или получения другого экземпляра интерфейса. Затем служба текста вызывает [итфлангбаритеммгр:: RemoveItem](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-removeitem) с указателем интерфейса удаляемого элемента.

## <a name="extending-system-language-bar-items"></a>Расширение системных элементов языковой панели

TSF предоставляет возможность добавлять пункты меню в существующие меню языковой панели. Это позволяет текстовой службе добавлять элементы в меню другой службы текстового ввода, не добавляя на панель инструментов отдельную кнопку. Это также позволяет объединить пункты меню в логические группы. Например, служба текстового ввода, предоставляющая дополнительные функции для стандартной службы речевого текста, может добавлять элементы в меню службы речевого текста, а не добавлять собственные кнопки меню верхнего уровня.

Служба текстового ввода предоставляет расширение меню языковой панели, реализуя объект, поддерживающий интерфейс [итфсистемлангбаритемсинк](/windows/desktop/api/ctfutb/nn-ctfutb-itfsystemlangbaritemsink) . Этот интерфейс работает точно так же, как интерфейс [итфлангбаритембуттон](/windows/desktop/api/Ctfutb/nn-ctfutb-itflangbaritembutton) для кнопки меню. При отображении меню служба текстового ввода вызывает [итфсистемлангбаритемсинк:: инитмену](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu). Расширение добавляет элементы в меню с помощью интерфейса [итфмену](/windows/desktop/api/ctfutb/nn-ctfutb-itfmenu) , переданного в **инитмену**. Когда пользователь выбирает элемент, добавленный расширением, служба текстового ввода вызывает [итфсистемлангбаритемсинк:: онменуселект](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-onmenuselect) с идентификатором выбранного пункта меню.

Чтобы установить расширение меню языковой панели, служба Text выполняет следующие действия.

1.  Получите интерфейс **итфлангбаритем** для элемента, который необходимо расширить, вызвав [итфлангбаритеммгр::-Item](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem) с **идентификатором GUID** для расширяемого элемента.
2.  Получите интерфейс **итфсаурце** для элемента, который необходимо расширить, вызвав итфлангбаритем:: QUERYINTERFACE с IID \_ итфсаурце.
3.  Вызовите [итфсаурце:: AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) с IID \_ итфсистемлангбаритемсинк и указателем на объект **итфсистемлангбаритемсинк** . Если происходит сбой Итфсаурце:: AdviseSink, служба текстового ввода не поддерживает расширения меню.

[Итфсаурце:: унадвисесинк](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink)**Итфсаурце:: AdviseSink**

## <a name="supporting-language-bar-menu-extensions"></a>Поддержка расширений меню языковой панели

Служба текстового ввода может включать другие текстовые службы для добавления элементов в меню языковой панели, как показано выше. Служба текстового ввода, которая должна опубликовать свой GUID, чтобы элемент можно было получить путем вызова [итфлангбаритеммгр::](/windows/desktop/api/ctfutb/nf-ctfutb-itflangbaritemmgr-getitem)GetText.

Для поддержки расширений меню текстовая служба должна поддерживать интерфейс [итфсаурце](/windows/desktop/api/msctf/nn-msctf-itfsource) . Следующие шаги включают поддержку одного или нескольких расширений меню.

1.  При вызове [итфсаурце:: AdviseSink](/windows/desktop/api/msctf/nf-msctf-itfsource-advisesink) с IID \_ итфсистемлангбаритемсинк служба текстового интерфейса должна хранить интерфейс **итфсистемлангбаритемсинк** и возвращать значение файла cookie, которое определяет расширение.
2.  При вызове [итфлангбаритембуттон:: инитмену](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-initmenu) текстовая служба вызывает метод [Итфсистемлангбаритемсинк:: инитмену](/windows/desktop/api/ctfutb/nf-ctfutb-itfsystemlangbaritemsink-initmenu) расширения. Служба текстового ввода должна реализовать способ идентификации элементов меню, добавленных расширением, в отличие от элементов, добавленных самой службой текстового ввода.
3.  При вызове [итфлангбаритембуттон:: онменуселект](/windows/desktop/api/Ctfutb/nf-ctfutb-itflangbaritembutton-onmenuselect) с идентификатором пункта меню, который принадлежит к расширению, Текстовая служба вызывает метод **Итфсистемлангбаритемсинк:: онменуселект** расширения.
4.  При вызове [итфсаурце:: унадвисесинк](/windows/desktop/api/msctf/nf-msctf-itfsource-unadvisesink) с соответствующим файлом cookie служба текстового ввода удаляет расширение меню.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Как настроить платформу текстовых служб](how-to-set-up-tsf.md)
</dt> <dt>

[Языковая панель (приложения)](language-bar-app.md)
</dt> </dl>

 

 
