---
description: 'Существует три способа завершения работы приложения на локальном или удаленном компьютере: завершение работы системшут системы и перезагрузка итшут приложения, завершение работы и перезагрузка системы и перезапуск всех приложений, зарегистрированных для перезапуска'
ms.assetid: acadf58f-3f68-4fa1-bdcf-8f85c8479263
title: Завершение работы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e436dd9e3b115112e63b0440b4d51de4c7f9f619
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664359"
---
# <a name="shutting-down"></a>Завершение работы

Существует три способа завершения работы приложения на локальном или удаленном компьютере:

-   Завершение работы системы
-   Завершите работу системы и перезапустите ее
-   Завершите работу приложения, выключите и перезапустите систему и перезапустите все приложения, которые были зарегистрированы для перезапуска.

Чтобы завершить работу системы, используйте функцию [**ExitWindowsEx**](/windows/desktop/api/Winuser/nf-winuser-exitwindowsex) с \_ флагом завершения работы евкс. Пример см. в разделе [Завершение работы системы](how-to-shut-down-the-system.md). Чтобы завершить работу и перезагрузить систему, используйте \_ флаг перезагрузки евкс. Чтобы перезапустить все приложения, которые были зарегистрированы для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) , используйте \_ флаг ЕКСВ рестартаппс.

Функции [**инитиатешутдовн**](/windows/desktop/api/Winreg/nf-winreg-initiateshutdowna), [**инитиатесистемшутдовн**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdowna)и [**инитиатесистемшутдовнекс**](/windows/desktop/api/Winreg/nf-winreg-initiatesystemshutdownexa) запускают таймер и отображают диалоговое окно, предлагающее пользователю выйти из системы. При отображении этого диалогового окна функция [**абортсистемшутдовн**](/windows/desktop/api/Winreg/nf-winreg-abortsystemshutdowna) может прерывать таймер и предотвращать завершение работы компьютера. Однако если срок действия таймера истекает, компьютер завершает работу. Эти функции также могут перезапустить компьютер после завершения операции отключения. Дополнительные сведения см. [в разделе Отображение диалогового окна "завершение работы"](displaying-the-shutdown-dialog-box.md).

## <a name="shutdown-notifications"></a>Уведомления о завершении работы

Приложения с окном и очередью сообщений получают уведомления о завершении работы через сообщения [**WM \_ Куерендсессион**](wm-queryendsession.md) и [**WM \_ ENDSESSION**](wm-endsession.md) . Эти приложения должны возвращать **значение true** , чтобы указать, что они могут быть завершены. Приложения не должны блокировать завершение работы системы, если это не является абсолютно необходимым. Приложения должны выполнять необходимую очистку при обработке **WM \_ ENDSESSION**. Приложения с несохраненными данными могут сохранить данные во временном расположении и восстановить их при следующем запуске приложения. Рекомендуется часто сохранять данные и состояние приложений. Например, автоматическое сохранение данных между операциями сохранения, инициированными пользователем, для уменьшения объема данных, сохраняемых при завершении работы.

Консольные приложения получают уведомления о завершении работы в своих подпрограммых обработчиков. Чтобы зарегистрировать обработчик консоли, используйте функцию [**SetConsoleCtrlHandler**](/windows/console/setconsolectrlhandler) .

Приложения службы получают уведомления о завершении работы в своих подпрограммых обработчиков. Чтобы зарегистрировать обработчик управления службой, используйте функцию [**регистерсервицектрлхандлерекс**](/windows/win32/api/winsvc/nf-winsvc-registerservicectrlhandlerexa) .

## <a name="blocking-shutdown"></a>Блокировка завершения работы

Если приложение должно блокировать потенциальное завершение работы системы, оно может вызвать функцию [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) . Вызывающий объект предоставляет строку причины, которая будет отображаться пользователю. Строка причины должна быть короткой и ясной, предоставляя пользователю сведения, необходимые для принятия решения о необходимости продолжения работы системы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Завершение работы системы](how-to-shut-down-the-system.md)
</dt> </dl>

 

 
