---
description: Сообщение WM \_ ENDSESSION отправляется в приложение после того, как система обработает результаты \_ сообщения WM куерендсессион. Сообщение WM \_ ENDSESSION информирует приложение о том, завершается ли сеанс.
ms.assetid: 9bf04f24-da1e-4680-a47b-28e9c500635e
title: Сообщение WM_ENDSESSION (WinUser. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: fa62f356d881182dd6e6fd9e0558332bcc1b3fc2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662620"
---
# <a name="wm_endsession-message"></a>\_Сообщение ENDSESSION WM

Сообщение **WM \_ ENDSESSION** отправляется в приложение после того, как система обработает результаты сообщения [**WM \_ куерендсессион**](wm-queryendsession.md) . Сообщение **WM \_ ENDSESSION** информирует приложение о том, завершается ли сеанс.

Окно получает это сообщение через функцию [**WindowProc**](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85)) .


```C++
LRESULT CALLBACK WindowProc( 
  HWND hwnd,      // handle to window 
  UINT uMsg,      // message identifier 
  WPARAM wParam,  // end-session option 
  LPARAM lParam   // logoff option
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*HWND* 
</dt> <dd>

Маркер окна.

</dd> <dt>

*Uiacp* 
</dt> <dd>

Идентификатор **WM \_ ENDSESSION** .

</dd> <dt>

*wParam* 
</dt> <dd>

Если сеанс завершается, этот параметр имеет **значение true**. сеанс может завершиться в любое время после того, как все приложения возвращали это сообщение. В противном случае — **false**.

</dd> <dt>

*lParam* 
</dt> <dd>

Этот параметр может принимать одно или несколько следующих значений. Если этот параметр равен 0, система завершает работу или перезапускается (невозможно определить, какое событие происходит).



| Значение                                                                                                                                                                                                                                           | Значение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ENDSESSION_CLOSEAPP"></span><span id="endsession_closeapp"></span><dl> <dt>**ENDSESSION \_ КЛОСЕАПП**</dt> <dt>0x1</dt> </dl>        | Если параметр *wParam* имеет **значение true**, приложение должно завершить работу. Любые данные должны сохраняться автоматически без запроса пользователя (Дополнительные сведения см. в разделе Примечания). Диспетчер перезапуска отправляет это сообщение, когда приложение использует файл, который необходимо заменить, когда он должен обслуживать систему или когда ресурсы системы исчерпаны. Приложение будет перезапущено, если оно было зарегистрировано для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) . Дополнительные сведения см. в разделе [рекомендации для приложений](../rstmgr/guidelines-for-applications.md). <br/> Если параметр *wParam* имеет **значение false**, приложение не должно завершать работу.<br/> |
| <span id="ENDSESSION_CRITICAL"></span><span id="endsession_critical"></span><dl> <dt>**ENDSESSION \_ КРИТическая**</dt> <dt>0x40000000</dt> </dl> | Приложение принудительно завершает работу.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| <span id="ENDSESSION_LOGOFF"></span><span id="endsession_logoff"></span><dl> <dt>**ENDSESSION \_ Выход из системы**</dt> <dt>0x80000000</dt> </dl>       | Пользователь записывается в систему. Дополнительные сведения см. в разделе выход [из системы](logging-off.md).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |



 

Обратите внимание, что этот параметр является битовой маской. Чтобы проверить это значение, используйте операцию побитового выполнения. не проверяйте на равенство.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если приложение обрабатывает это сообщение, оно должно вернуть ноль.

## <a name="remarks"></a>Комментарии

Приложения с несохраненными данными могут сохранить данные во временном расположении и восстановить их при следующем запуске приложения. Рекомендуется часто сохранять данные и состояние приложений. Например, автоматическое сохранение данных между операциями сохранения, инициированными пользователем, для уменьшения объема данных, сохраняемых при завершении работы.

При завершении сеанса приложению не требуется вызывать функцию [**дестройвиндов**](/windows/win32/api/winuser/nf-winuser-destroywindow) или [**посткуитмессаже**](/windows/win32/api/winuser/nf-winuser-postquitmessage) .

## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | \[Приложения UWP для классических приложений Windows XP \|\]<br/>                                                       |
| Минимальная версия сервера<br/> | \[Приложения UWP для классических приложений Windows Server 2003 \|\]<br/>                                              |
| Header<br/>                   | <dl> <dt>WinUser. h (включение Windows. h)</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Выход из системы](logging-off.md)
</dt> <dt>

[Завершение работы](shutting-down.md)
</dt> <dt>

[**дестройвиндов**](/windows/win32/api/winuser/nf-winuser-destroywindow)
</dt> <dt>

[**посткуитмессаже**](/windows/win32/api/winuser/nf-winuser-postquitmessage)
</dt> <dt>

[**сетпроцессшутдовнпараметерс**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters)
</dt> <dt>

[**WM \_ куерендсессион**](wm-queryendsession.md)
</dt> </dl>

 

 
