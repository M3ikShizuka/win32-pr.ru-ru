---
description: Сообщение WM \_ куерендсессион отправляется, когда пользователь выбирает завершение сеанса или когда приложение вызывает одну из функций завершения работы системы.
ms.assetid: 7ad73444-f1f6-4b73-8450-0580b146a5a6
title: Сообщение WM_QUERYENDSESSION (WinUser. h)
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: f6807a861ffb0670013a1d1f5b98a2f202e5d7470a6c306b3ed29c42baad6e6f
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119664214"
---
# <a name="wm_queryendsession-message"></a>\_Сообщение КУЕРЕНДСЕССИОН WM

Сообщение **WM \_ куерендсессион** отправляется, когда пользователь выбирает завершение сеанса или когда приложение вызывает одну из функций завершения работы системы. Если какое-либо приложение возвращает ноль, сеанс не завершается. Система перестает отправлять сообщения **WM \_ куерендсессион** , как только одно приложение возвращает ноль.

После обработки этого сообщения система отправляет сообщение [**WM \_ ENDSESSION**](wm-endsession.md) с параметром *wParam* , равным результатам сообщения **\_ куерендсессион WM** .

Окно получает это сообщение через функцию [**WindowProc**](/previous-versions/windows/desktop/legacy/ms633573(v=vs.85)) .


```C++
LRESULT CALLBACK WindowProc( 
  HWND hwnd,      // handle to window 
  UINT uMsg,      // message identifier 
  WPARAM wParam,  // not used 
  LPARAM lParam   // logoff option
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*HWND* 
</dt> <dd>

Маркер окна.

</dd> <dt>

*Uiacp* 
</dt> <dd>

Идентификатор **WM \_ куерендсессион** .

</dd> <dt>

*wParam* 
</dt> <dd>

Этот параметр зарезервирован для использования в будущем.

</dd> <dt>

*lParam* 
</dt> <dd>

Этот параметр может принимать одно или несколько следующих значений. Если этот параметр равен 0, система завершает работу или перезапускается (невозможно определить, какое событие происходит).



| Значение                                                                                                                                                                                                                                           | Значение                                                                                                                                                                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="ENDSESSION_CLOSEAPP"></span><span id="endsession_closeapp"></span><dl> <dt>**ENDSESSION \_ КЛОСЕАПП**</dt> <dt>0x00000001</dt> </dl> | Приложение использует файл, который должен быть заменен, система обслуживается, или исчерпаны системные ресурсы. Дополнительные сведения см. в разделе [рекомендации для приложений](../rstmgr/guidelines-for-applications.md).<br/> |
| <span id="ENDSESSION_CRITICAL"></span><span id="endsession_critical"></span><dl> <dt>**ENDSESSION \_ КРИТическая**</dt> <dt>0x40000000</dt> </dl> | Приложение принудительно завершает работу.<br/>                                                                                                                                                                              |
| <span id="ENDSESSION_LOGOFF"></span><span id="endsession_logoff"></span><dl> <dt>**ENDSESSION \_ Выход из системы**</dt> <dt>0x80000000</dt> </dl>       | Пользователь записывается в систему. Дополнительные сведения см. в разделе выход [из системы](logging-off.md).<br/>                                                                                                                                   |



 

Обратите внимание, что этот параметр является битовой маской. Чтобы проверить это значение, используйте операцию побитового выполнения. не проверяйте на равенство.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Приложения должны учитывать намерения пользователя и возвращать **значение true**. По умолчанию функция [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) возвращает **значение true** для этого сообщения.

Если завершение работы приведет к повреждению записываемой системы или носителя, приложение может вернуть **значение false**. Однако рекомендуется учитывать действия пользователя.

## <a name="remarks"></a>Remarks

Когда приложение возвращает **значение true** для этого сообщения, оно получает сообщение [**WM \_ ENDSESSION**](wm-endsession.md) , независимо от того, как другие приложения реагируют на сообщение **\_ куерендсессион WM** . Каждое приложение должно возвращать **значение true** или **false** сразу после получения этого сообщения и откладывать все операции очистки до получения сообщения **WM \_ ENDSESSION** .

Приложения могут отображать пользовательский интерфейс, предлагающий пользователю получить сведения при завершении работы, но не рекомендуется. Через пять секунд система отображает сведения о приложениях, препятствующих завершению работы, и позволяет пользователю их завершить. например, Windows XP отображает диалоговое окно, а Windows Vista отображает полный экран с дополнительной информацией о приложениях, блокирующих завершение работы. Если приложение должно блокировать или откладывать завершение работы системы, используйте функцию [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) . дополнительные сведения см. в статье [об изменениях завершения работы для Windows Vista](shutdown-changes-for-windows-vista.md).

Консольные приложения могут использовать функцию [**SetConsoleCtrlHandler**](/windows/console/setconsolectrlhandler) для получения уведомлений о завершении работы.

Приложения служб могут использовать функцию [**регистерсервицектрлхандлерекс**](/windows/win32/api/winsvc/nf-winsvc-registerservicectrlhandlerexa) для получения уведомлений о завершении работы в подпрограмме обработчика.

## <a name="examples"></a>Примеры

Пример см. в разделе [выход из системы](logging-off.md).

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|----------------------------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows \[Приложения UWP для классических приложений XP \|\]<br/>                                                       |
| Минимальная версия сервера<br/> | Windows \[Приложения UWP для классических приложений сервера 2003 \|\]<br/>                                              |
| Заголовок<br/>                   | <dl> <dt>WinUser. h (включает Windows. h)</dt> </dl> |



## <a name="see-also"></a>См. также

<dl> <dt>

[Выход из системы](logging-off.md)
</dt> <dt>

[Завершение работы](shutting-down.md)
</dt> <dt>

[**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca)
</dt> <dt>

[**екситвиндовс**](/windows/desktop/api/Winuser/nf-winuser-exitwindows)
</dt> <dt>

[**сетпроцессшутдовнпараметерс**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters)
</dt> <dt>

[**WM \_ ENDSESSION**](wm-endsession.md)
</dt> </dl>

 

 
