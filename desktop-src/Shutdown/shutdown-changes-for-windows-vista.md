---
description: В следующей таблице перечислены различия между завершением работы в Windows Vista и Windows XP.
ms.assetid: da7985d2-85c8-47e1-a172-c9e92f450e24
title: Изменения завершения работы Windows Vista
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e04bb20099349ce378384cf01c39e53ca03a896
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104080841"
---
# <a name="shutdown-changes-for-windows-vista"></a>Изменения завершения работы Windows Vista

В следующей таблице перечислены различия между завершением работы в Windows Vista и Windows XP.



| Функция                 | Windows XP                                                                                                                                                                                                                                                                                                                                                                                | Windows Vista                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Блокировка завершения работы       | Приложения могут задержать реагирование на [**WM \_ куерендсессион**](wm-queryendsession.md) в течение 5 секунд, а система позволяет пользователю завершить работу приложения. Приложения, возвращающие **значение true** в ответ на **\_ куерендсессион WM** , могут отреагировать на [**\_ ENDSESSION WM**](wm-endsession.md) в течение 5 секунд, после чего система разрешает пользователю завершить работу приложения. | Приложения могут отреагировать на запросы [**WM \_ куерендсессион**](wm-queryendsession.md) в течение 5 секунд, после чего система разрешает пользователю продолжить или отменить завершение работы. Приложения, возвращающие **значение true** в ответ на **\_ куерендсессион WM** , могут задержать ответ на [**\_ ENDSESSION WM**](wm-endsession.md) в течение 5 секунд, после чего система разрешает пользователю продолжить или отменить завершение работы.                                                                                                      |
| Отмена завершения работы      | Если приложение возвращает **значение false** в ответ на [**WM \_ куерендсессион**](wm-queryendsession.md), в большинстве случаев завершение работы отменяется. Однако пользовательский интерфейс не отображается, поэтому пользователь может не знать, что завершение работы отменено.                                                                                                                                                      | Если приложение возвращает **значение false** в ответ на [**WM \_ куерендсессион**](wm-queryendsession.md), оно по-прежнему отображается в пользовательском интерфейсе завершения работы. Обратите внимание, что система не позволяет консольным приложениям или приложениям без видимого окна отменить завершение работы. Эти приложения автоматически завершаются, если они не отвечают на **WM \_ Куерендсессион** или [**WM \_ ENDSESSION**](wm-endsession.md) в течение 5 секунд или если они возвращают **значение false** в ответ на **\_ куерендсессион WM**. |
| Пользовательский интерфейс завершения работы | Система отображает диалоговое окно для каждого приложения, блокирующего завершение работы. Если пользователь настроил кнопку **End Now (Готово** ), приложение будет завершено. Если пользователь нажмет кнопку **Отмена** , завершение работы отменяется и приложение продолжит работу.                                                                                                                                    | Система отображает полный экран пользовательского интерфейса, который определяет все приложения, блокирующие завершение работы, и их причины (если они зарегистрировали причину с помощью [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate)).                                                                                                                                                                                                                                                                    |



 

## <a name="best-practices"></a>Рекомендации

-   Приложения не должны блокировать завершение работы. Реагирование на [**WM \_ куерендсессион**](wm-queryendsession.md) как можно быстрее и откладывать действия очистки до обработки сообщения [**WM \_ ENDSESSION**](wm-endsession.md) .
-   Приложения, которые должны блокировать завершение работы, должны использовать новую функцию [**шутдовнблоккреасонкреате**](/windows/desktop/api/Winuser/nf-winuser-shutdownblockreasoncreate) для регистрации строки, объясняющей причину для пользователя. Пользователь может решить, следует ли продолжить или отменить завершение работы.
-   Приложения не могут полагаться на возможность блокировать завершение работы.

 

 



