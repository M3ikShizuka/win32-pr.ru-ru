---
title: Сведения о полях со списком
description: В этом разделе обсуждаются различные виды полей со списками.
ms.assetid: 76410a87-aa0e-4da9-9e78-c80ac485e3cd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 344596a3c0aa772568956344aaddcc053b534993
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104551610"
---
# <a name="about-combo-boxes"></a>Сведения о полях со списком

Поле со списком объединяет поле ввода или статический текст и список.

В этом разделе содержатся следующие подразделы.

-   [Типы и стили поля со списком](#combo-box-types-and-styles)
-   [Список полей со списком](#combo-box-list)
    -   [Текущий выбор](#current-selection)
    -   [Раскрывающиеся списки](#drop-down-lists)
    -   [Вывод списка содержимого](#list-contents)
-   [Изменить поля выбора элемента управления](#edit-control-selection-fields)
-   [Поля со списком, рисуемые владельцем](#owner-drawn-combo-boxes)
-   [Поля со списком для подклассов](#subclassed-combo-boxes)

## <a name="combo-box-types-and-styles"></a>Типы и стили поля со списком

Поле со списком состоит из списка и поля выбора. В списке представлены параметры, которые пользователь может выбирать, а в поле выбора отображается текущее выделение. Если поле выбора является элементом управления редактирования, пользователь может ввести сведения, недоступные в списке. в противном случае пользователь может выбрать только элементы из списка.

Библиотека Common Controls включает три основных стиля поля со списком, как показано в следующей таблице.



| Тип поля со списком             | Константа стиля                                                 | Описание                                                                                  |
|----------------------------|----------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| Простота                     | [**\_простой CBS**](combo-box-styles.md)             | Отображает список в любое время и отображает выбранный элемент в элементе управления "поле ввода".              |
| Drop-down                  | [**\_раскрывающийся список CBS**](combo-box-styles.md)         | Отображает список при нажатии на значок и отображает выбранный элемент в элементе управления "поле ввода".  |
| Раскрывающийся список (раскрывающийся список) | [**DROPDOWNLIST для CBS \_**](combo-box-styles.md) | Отображает список при нажатии на значок и отображает выбранный элемент в статическом элементе управления. |



 

На следующем снимке экрана показаны три типа полей со списком, которые могут отображаться в Windows Vista. На первом снимке экрана пользователь выбрал элемент в простом поле со списком. Пользователь также может ввести новое значение в поле ввода этого элемента управления. Размер списка в редакторе ресурсов Microsoft Visual Studio и достаточно большой для размещения двух элементов.

![снимок экрана, показывающий элемент, выбранный в простом поле со списком](images/simplecombo.png)

На втором снимке экрана пользователь ввел новый текст в поле редактирования раскрывающегося списка. Пользователь также может выбрать существующий элемент. Список раскрывается в соответствии с максимально возможным количеством элементов.

![снимок экрана с текстом, введенным в раскрывающееся поле со списком](images/dropdown.png)

На третьем снимке экрана пользователь открыл поле со списком раскрывающегося списка. Список раскрывается в соответствии с максимально возможным количеством элементов. Пользователь не может ввести новый текст.

![снимок экрана, показывающий элемент, выбранный в раскрывающемся списке с раскрывающимся списком](images/droplist.png)

Также существует ряд стилей полей со списком, определяющих конкретные свойства. Стили полей со списками определяют определенные свойства поля со списком. Стили можно объединять; Однако некоторые стили применяются только к определенным типам полей со списками. Сведения о таблице стилей полей со списками см. в разделе [стили полей со](combo-box-styles.md)списками.

> [!Note]  
> Чтобы использовать стили оформления с полями со списком, приложение должно включать манифест и вызывать [**иниткоммонконтролс**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrols) в начале программы. Сведения о визуальных стилях см. в разделе [стили визуальных](themes-overview.md)элементов. Дополнительные сведения о манифестах см. в разделе [Включение визуальных стилей](cookbook-overview.md).

 

## <a name="combo-box-list"></a>Список полей со списком

Список — это часть поля со списком, в которой отображаются элементы, которые может выбрать пользователь. Как правило, приложение инициализирует содержимое списка при создании поля со списком. Выбранный пользователем элемент списка является *текущим выбором*. Невозможно выбрать несколько элементов. В простых и раскрывающихся списках поля пользователь может ввести в поле выбора вместо выбора элемента списка. В таких случаях текущий выбор отсутствует, и приложение обязано добавить элемент в список и сделать его текущим выбором, если это необходимо.

В этом разделе рассматриваются следующие темы:

-   [Текущий выбор](#current-selection)
-   [Раскрывающиеся списки](#drop-down-lists)
-   [Вывод списка содержимого](#list-contents)

### <a name="current-selection"></a>Текущий выбор

Текущий выделенный фрагмент является элементом списка, выбранным пользователем. выбранный текст появится в поле выбора поля со списком. Однако в случае простого поля со списком или раскрывающегося поля со списком текущий выделенный фрагмент представляет собой только одну форму возможных входных данных пользователя в поле со списком. Пользователь также может ввести текст в поле выбора.

Текущий выбор определяется индексом (от нуля) выбранного элемента списка. Приложение может установить и получить его в любое время. Родительское окно или процедура диалогового окна получает уведомление, когда пользователь изменяет текущее выделение для поля со списком. Родительское окно или диалоговое окно не уведомляется, когда приложение изменяет выбор.

При создании поля со списком текущий выбор отсутствует. Это также справедливо для простого или раскрывающегося поля со списком, если пользователь изменил содержимое поля выбора. Чтобы задать текущее выделение, приложение отправляет сообщение [**\_ сеткурсел CB**](cb-setcursel.md) в поле со списком. Приложение может также использовать сообщение [**\_ селектстринг CB**](cb-selectstring.md) , чтобы установить текущий выбор для элемента списка, строка которого начинается с указанной строки. Чтобы определить текущее выделение, приложение отправляет в поле со списком сообщение с [**\_ нерекурсивной**](cb-getcursel.md) назначением CB. Если текущего выбора нет, это сообщение возвращает значение CB \_ Err.

Когда пользователь изменяет текущий выбор в поле со списком, родительское окно или процедура диалогового окна получает сообщение [**\_ команды WM**](/windows/desktop/menurc/wm-command) с кодом уведомления [КБН \_ селчанже](cbn-selchange.md) в верхнем слове параметра *wParam* . Этот код уведомления не отправляется, если текущий выбор задается с помощью сообщения [**\_ сеткурсел CB**](cb-setcursel.md) .

Раскрывающееся поле со списком или раскрывающийся список отправляет код уведомления [КБН \_ крупный план](cbn-closeup.md) в родительское окно или процедуру диалогового окна при закрытии раскрывающегося списка. Если пользователь изменил текущее выделение, поле со списком также отправляет код уведомления [КБН \_ селчанже](cbn-selchange.md) при закрытии раскрывающегося списка. Для выполнения определенного процесса каждый раз, когда пользователь выбирает элемент списка, можно обработать \_ код уведомления КБН селчанже или КБН \_ крупный план. Как правило, вы ждете \_ код уведомления КБН крупный план перед обработкой изменения в текущем выделенном фрагменте. Это может быть особенно важно, если требуется значительный объем обработки.

Приложение также может обрабатывать коды уведомлений [КБН \_ Селендок](cbn-selendok.md) и [КБН \_ селендканцел](cbn-selendcancel.md) . Система отправляет КБН \_ селендок, когда пользователь выбирает элемент списка или выбирает элемент, а затем закрывает список. Это означает, что пользователь завершил работу и должен обработать выделение. КБН \_ селендканцел отправляется, когда пользователь выбирает элемент, а затем выбирает другой элемент управления, нажимает клавишу ESC, когда раскрывающийся список открыт, или закрывает диалоговое окно. Это означает, что выбор пользователя следует игнорировать. КБН \_ селендок отправляется перед каждым сообщением [КБН \_ селчанже](cbn-selchange.md) .

В простом поле со списком система отправляет код уведомления [КБН \_ дблклк](cbn-dblclk.md) , когда пользователь дважды щелкает элемент списка. В раскрывающемся поле со списком или раскрывающемся списке один щелчок скрывает список, поэтому невозможно дважды щелкнуть элемент.

### <a name="drop-down-lists"></a>Раскрывающиеся списки

Некоторые уведомления и сообщения применяются только к полям со списком, содержащим раскрывающиеся списки. Если раскрывающийся список открыт или закрыт, то родительское окно поля со списком получает уведомление в виде [**\_ командного сообщения WM**](/windows/desktop/menurc/wm-command) . Если список открывается, то в [ \_ раскрывающемся](cbn-dropdown.md)списке *wParam* используется слово КБН с высоким приоритетом. Если список закрывается, это [КБН \_ крупный план](cbn-closeup.md).

Приложение может открыть список раскрывающихся полей со списком или раскрывающийся список с помощью сообщения [**\_ шовдропдовн CB**](cb-showdropdown.md) . Он может определить, открыт ли список с помощью сообщения [**\_ жетдроппедстате CB**](cb-getdroppedstate.md) , и может определить координаты раскрывающегося списка с помощью сообщения [**\_ жетдроппедконтролрект CB**](cb-getdroppedcontrolrect.md) . Приложение также может увеличить ширину раскрывающегося списка с помощью сообщения [**\_ сетдроппедвидс CB**](cb-setdroppedwidth.md) .

### <a name="list-contents"></a>Вывод списка содержимого

Когда приложение создает поле со списком, оно обычно инициализирует поле со списком, добавляя один или несколько элементов в список. Позже приложение может добавлять или удалять элементы списка, повторно инициализировать список или получать из него сведения об элементе.

Приложение добавляет элементы списка в поле со списком, отправляя ему [**сообщение \_ ADDSTRING CB**](cb-addstring.md) . Указанный элемент добавляется в конец списка или в отсортированном поле со списком в соответствующей позиции сортировки на основе строки элемента. В поле со списком без сортировки приложение может использовать сообщение [**\_ инсертстринг CB**](cb-insertstring.md) для вставки элемента в определенной позиции. После добавления элемент списка определяется его позицией.

С помощью сообщения [**CB \_ FINDSTRING**](cb-findstring.md) или [**CB \_ финдстринжексакт**](cb-findstringexact.md) приложение может определить позицию элемента списка. **CB \_ FINDSTRING** находит элемент, строка которого начинается с указанной строки. **CB \_ ФИНДСТРИНЖЕКСАКТ** находит элемент, строка которого точно соответствует строке. Ни одно из сообщений не учитывает регистр.

Приложение может удалить элемент списка с помощью сообщения [**\_ делетестринг CB**](cb-deletestring.md) . Если приложению необходимо повторно инициализировать список полей со списком, оно может сначала очистить все содержимое с помощью сообщения [**\_ ресетконтент CB**](cb-resetcontent.md) . При добавлении нескольких элементов в список после того, как поле со списком уже отображается, приложение может снять флаг перерисовки, чтобы раскрасить поле со списком после добавления каждого элемента. Дополнительные сведения о перерисовки см. в описании сообщения [**WM \_ сетредрав**](/windows/desktop/gdi/wm-setredraw) .

Чтобы получить строку, связанную с элементом списка, приложение может использовать сообщение [**\_ жетлбтекст CB**](cb-getlbtext.md) . Строка элемента копируется в буфер, указанный приложением. Чтобы убедиться, что буфер достаточно велик для получения строки, приложение может сначала использовать сообщение [**\_ жетлбтекстлен CB**](cb-getlbtextlen.md) для определения длины строки. Чтобы получить количество элементов списка в поле со списком, приложение может использовать сообщение [**CB \_ NOCOUNT**](cb-getcount.md) .

## <a name="edit-control-selection-fields"></a>Изменить поля выбора элемента управления

Приложение может извлекать или задавать содержимое поля выбора, а также определять или устанавливать выбор редактирования. Приложение также может ограничить объем текста, который пользователь может ввести в поле выбора. При изменении содержимого поля выбора система отправляет сообщения уведомления в родительское окно или процедуру диалогового окна.

Чтобы получить содержимое поля выбора, приложение может отправить сообщение [**WM \_ gettext**](/windows/desktop/winmsg/wm-gettext) в поле со списком. Чтобы задать содержимое поля выбора простого или раскрывающегося списка, приложение может отправить сообщение [**WM \_ SETTEXT**](/windows/desktop/winmsg/wm-settext) в поле со списком.

Область редактирования — это диапазон выделенного текста (при наличии) в поле выбора простого или раскрывающегося списка. Приложение может определить позиции начального и конечного символов текущего выделения с помощью сообщения [**CB \_ жетедитсел**](cb-geteditsel.md) . Он также может выбирать символы в области редактирования с помощью сообщения [**\_ сетедитсел CB**](cb-seteditsel.md) .

Изначально объем текста, который пользователь может ввести в поле выбора, ограничен размером поля выбора. Однако если поле со списком имеет стиль [**CBS \_ аутохскролл**](combo-box-styles.md) , текст может быть продолжен за пределами поля выбора. Приложение может использовать сообщение [**\_ лимиттекст CB**](cb-limittext.md) , чтобы ограничить объем текста, который пользователь может ввести в поле выбора, независимо от того, имеет ли элемент управления стиль **\_ аутохскролл CBS** .

Когда пользователь редактирует содержимое поля выбора, родительское окно или процедура диалогового окна получает сообщения уведомления. Сначала будет отправлен код уведомления [КБН \_ едитупдате](cbn-editupdate.md) , указывающий, что текст в поле выбора был изменен. После отображения измененного текста система отправляет [КБН \_ едитчанже](cbn-editchange.md). При изменении содержимого поля выбора в результате выбора элемента списка эти сообщения не отправляются.

## <a name="owner-drawn-combo-boxes"></a>Owner-Drawn поля со списком

Приложение может создать поле со списком, рисуемое владельцем, чтобы принимать ответственность за рисование элементов списка. Родительское окно поля со списком, рисуемого владельцем (его владелец), получает сообщения [**WM \_ DRAWITEM**](wm-drawitem.md) , когда часть поля со списком должна быть окрашена. Поле со списком, рисуемое владельцем, может выводить список сведений, отличных от текстовых строк, или в дополнение к. Поля со списком, рисуемые владельцем, могут иметь любой тип. Однако элемент управления "поле ввода" в простом или раскрывающемся списке может отображать только текст, а владелец заполняет поле выбора в раскрывающемся списке.

Владелец поля со списком, рисуемого владельцем, должен обработать сообщение [**WM \_ DRAWITEM**](wm-drawitem.md) . Это сообщение отправляется каждый раз, когда необходимо перерисовать часть поля со списком. Владельцу может потребоваться обработка других сообщений в зависимости от стилей, заданных для поля со списком.

Приложение может создать поле со списком, рисуемое владельцем, указав стиль [**CBS \_ Овнердравфиксед**](combo-box-styles.md) или [**CBS \_ овнердраввариабле**](combo-box-styles.md) . Если все элементы списка в поле со списком имеют одинаковую высоту, например строки или значки, приложение может использовать стиль **\_ овнердравфиксед CBS** . Если элементы списка имеют переменную высоту, например точечные рисунки разного размера, приложение может использовать стиль **CBS \_ овнердраввариабле** .

Владелец поля со списком, рисуемого владельцем, может обработать сообщение [**WM \_ меасуреитем**](wm-measureitem.md) , чтобы указать размеры элементов списка в поле со списком. Если приложение создает поле со списком с помощью стиля [**CBS \_ овнердравфиксед**](combo-box-styles.md) , система отправляет сообщение **WM \_ меасуреитем** только один раз. Измерения, заданные владельцем, используются для всех элементов списка. Если используется [**стиль \_ овнердраввариабле CBS**](combo-box-styles.md) , система отправляет сообщение **WM \_ меасуреитем** для каждого элемента списка, добавленного в поле со списком. Владелец может определить или задать высоту элемента списка в любое время с помощью сообщений [**CB \_ GETITEMHEIGHT**](cb-getitemheight.md) и [**CB \_ сетитемхеигхт**](cb-setitemheight.md) соответственно.

Если сведения, отображаемые в поле со списком, рисуемом владельцем, содержат текст, приложение может отследить текст для каждого элемента списка, указав стиль [**CBS \_ хасстрингс**](combo-box-styles.md) . Поля со списком, имеющие стиль [**\_ сортировки CBS**](combo-box-styles.md) , сортируются на основе этого текста. Если поле со списком отсортировано, а не имеет стиль **CBS \_ хасстрингс** , владелец должен обработать сообщение [**WM \_ компареитем**](wm-compareitem.md) .

В поле со списком, рисуемом владельцем, владелец должен отследить элементы списка, содержащие сведения, кроме текста. Один из удобных способов сделать это — сохранить данные об элементе в виде данных элемента. Чтобы освободить объекты данных, связанные с элементами в поле со списком, владелец может обработать сообщение [**WM \_ DELETEITEM**](wm-deleteitem.md) .

## <a name="subclassed-combo-boxes"></a>Поля со списком для подклассов

Подклассы — это процедура, которая позволяет приложению перехватывать и обрабатывать сообщения, отправленные или отправляемые в окно. С помощью подклассов приложение может заменить свою обработку определенными сообщениями, продолжая обработку большинства сообщений в процедуру окна, определенную классом.

Когда операционная система создает окно, она сохраняет сведения о нем во внутренней структуре данных, которая включает указатель на процедуру окна. Чтобы создать подкласс окна, приложение вызывает функцию [**сеткласслонг**](/windows/desktop/api/winuser/nf-winuser-setclasslonga) , чтобы заменить указатель на эту процедуру указателем на процедуру-подкласс, определяемую приложением. После этого все сообщения в окне отправляются в процедуру подкласс. Затем эта процедура использует функцию [**каллвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-callwindowproca) для передачи необработанных сообщений в исходную процедуру окна. Описание обработки сообщений, выполняемой процедурой окна класса COMBOBOX, см. в разделе [поведение поля со списком по умолчанию](combo-box-features.md).

Если поле со списком находится за пределами диалогового окна, приложение не может обработать клавиши TAB, ENTER и ESC, если только не использует процедуру подкласса. Когда простое или раскрывающееся поле со списком получает фокус ввода, оно немедленно устанавливает фокус на его дочерний элемент управления Edit. Поэтому приложение должно подделать подкласс для элемента управления "поле ввода" для перехвата ввода с клавиатуры для простого или раскрывающегося поля со списком. Пример см. в разделе [подклассировать поле со списком](using-combo-boxes.md).

Если процедура подкласса обрабатывает сообщение [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) , для подготовки к рисованию необходимо использовать функцию [**бегинпаинт**](/windows/desktop/api/winuser/nf-winuser-beginpaint) . Перед вызовом функции [**ендпаинт**](/windows/desktop/api/winuser/nf-winuser-endpaint) он передает в качестве параметра *wParam* в оконной процедуре маркер контекста устройства (DC). Если **ендпаинт** вызывается первым, то процедура окна класса не зарисовывается, так как **ендпаинт** проверяет все окно.

Метод, связанный с подклассом, является подклассом. Суперкласс похож на любой другой класс, за исключением того, что его оконная процедура не вызывает [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для обработки необработанных сообщений. Вместо этого он передает необработанные сообщения в процедуру окна для класса родительского окна. Следуйте рекомендациям в [оконных процедурах](/windows/desktop/winmsg/window-procedures) , чтобы избежать проблем, которые могут возникнуть при использовании подкласса и класса.

 

 