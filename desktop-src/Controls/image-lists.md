---
title: О списках изображений
description: Список изображений — это набор изображений одного размера, на каждый из которых можно ссылаться по индексу.
ms.assetid: vs|controls|~\controls\imagelist\imagelist.htm
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f059e89b04d16088fff1d937bd29cb23a427d4c2
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104339337"
---
# <a name="about-image-lists"></a>О списках изображений

Список изображений — это набор изображений одного размера, на каждый из которых можно ссылаться по индексу. Списки изображений используются для эффективного управления большими наборами значков или точечных рисунков. Все изображения в списке изображений содержатся в одном расширенном точечном рисунке в формате экранного устройства. Список изображений может также включать монохромное растровое изображение, содержащее маски, которые используются для прозрачного рисования изображений (стиль значка).

Microsoft Win32 API предоставляет функции и макросы со списками изображений, которые позволяют создавать и удалять списки изображений, добавлять и удалить изображения, заменять и объединять изображения, рисовать изображения и перетаскивать изображения. Чтобы использовать функции списка изображений, включите файл заголовка Common Control в файлы исходного кода и свяжите его с библиотекой экспорта Common Control. Кроме того, перед вызовом любой функции списка изображений используйте функцию [**иниткоммонконтролс**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrols) или [**InitCommonControlsEx**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrolsex) , чтобы гарантировать загрузку библиотеки DLL Common Control.

В этом разделе рассматриваются следующие вопросы.

-   [Типы](#types)
-   [Создание и уничтожение списков изображений](#creating-and-destroying-image-lists)
-   [Добавление и удаление образов](#adding-and-removing-images)
-   [Замена и слияние изображений](#replacing-and-merging-images)
-   [Рисование изображений](#drawing-images)
-   [Перетаскивание изображений](#dragging-images)
-   [Сведения об образе](#image-information)
-   [Наложение изображений](#image-overlays)
-   [32-битовые значки со сглаженными значками](#32-bit-antialiased-icons)

## <a name="types"></a>Типы

Существует два типа списков изображений: немаскированные и маскированные. Немаскированный список изображений состоит из цветового растрового изображения, содержащего одно или несколько изображений. Список с маскированными изображениями состоит из двух точечных рисунков одинакового размера. Первый — это цвет битовой карты, который содержит изображения, а второй — монохромное растровое изображение, содержащее ряд масок — по одному для каждого изображения в первом растровом изображении.

При прорисовке немаскированного изображения оно просто копируется в контекст целевого устройства; то есть он рисуется поверх существующего цвета фона контекста устройства. При прорисовке маскированного изображения биты изображения объединяются с битами маски, обычно создавая прозрачные области в битовой карте, где отображается цвет фона целевого контекста устройства. Существует несколько стилей отображения, которые можно указать при рисовании маскированного изображения. Например, можно указать, что изображение должно отменяться, чтобы указать выбранный объект.

## <a name="creating-and-destroying-image-lists"></a>Создание и уничтожение списков изображений

Чтобы создать список изображений, вызовите функцию [**ImageList \_ CREATE**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) . Параметры включают тип создаваемого списка изображений, размеры каждого изображения и количество изображений, которые нужно добавить в список. Для немаскированного списка изображений функция создает один точечный рисунок, достаточно большой для хранения указанного количества изображений заданных измерений. Затем он создает совместимый с экраном контекст устройства и выделяет в нем точечный рисунок. Для маскированного списка изображений функция создает два точечных рисунка и два совместимых с экраном контекста устройств. Он выбирает точечный рисунок изображения в один контекст устройства, а растровое изображение маски — в другой. Библиотека DLL общего управления содержит исполняемый код для функций списка изображений.

В поле [**ImageList \_ Create (создать**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create)) указывается начальное число изображений, которые будут находиться в списке изображений, а также количество образов, по которым может увеличиваться список. Таким образом, если вы попытаетесь добавить больше изображений, чем вы указали изначально, список изображений автоматически увеличится, чтобы разместить новые образы.

Если элемент [**ImageList \_ создается**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) , он ВОЗВРАЩАЕТ маркер типа химажелист. Этот обработчик используется в других функциях списка изображений для доступа к списку изображений и управления образами. Можно добавлять и удалять изображения, копировать изображения из одного списка изображений в другой и объединять изображения из двух разных списков изображений. Если список изображений больше не нужен, его можно уничтожить, указав его маркер в вызове функции [**\_ уничтожения ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_destroy) .

## <a name="adding-and-removing-images"></a>Добавление и удаление образов

В список изображений можно добавлять растровые изображения, значки или курсоры. Растровые изображения добавляются путем указания дескрипторов двух растровых изображений в вызове функции [**\_ Add ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_add) . Первое растровое изображение содержит одно или несколько изображений, добавляемых к точечному рисунку изображения, а второе — маски, которые нужно добавить к битовой карте маски. Для немаскированных списков изображений второй маркер точечного рисунка игнорируется. для него можно задать **значение NULL**.

Функция [**ImageList \_ аддмаскед**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_addmasked) также добавляет растровые изображения в список изображений с маскированием. Эта функция аналогична [**\_ Add ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_add), но не указана битовая карта маски. Вместо этого укажите цвет, который система объединяет с растровым изображением изображения для автоматического создания масок. Каждый пиксел указанного цвета в растровом изображении изменяется на черный, а соответствующий бит в маске устанавливается в значение 1. В результате все пикселы в изображении, соответствующие заданному цвету, становятся прозрачными при прорисовке изображения.

Макрос [**ImageList \_ аддикон**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_addicon) добавляет в список изображений значок или курсор. Если список изображений замаскирован, **ImageList \_ аддикон** добавляет маску, которая предоставляется со значком или курсором к битовой карте маски. Если список изображений не замаскирован, маска для значка или курсора не используется при прорисовке изображения.

Вы можете создать значок на основе изображения и маски в списке изображений с помощью функции [**ImageList \_**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_geticon) . Функция возвращает маркер в новый значок.

[**ImageList \_ Add**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_add), [**ImageList \_ аддмаскед**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_addmasked)и [**ImageList \_ аддикон**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_addicon) назначение индекса каждому изображению при его добавлении в список изображений. Индексы отсчитываются от нуля; Это значит, что первое изображение в списке имеет нулевой индекс, а второй имеет индекс и т. д. После добавления одного изображения функции возвращают индекс изображения. Если в каждый момент времени добавляется более одного образа, функции возвращают индекс первого изображения.

Функция [**\_ Remove ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_remove) удаляет изображение из списка изображений.

## <a name="replacing-and-merging-images"></a>Замена и слияние изображений

Функции [**\_ реплацеикон**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_replaceicon) [**\_ Replace**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_replace) и ImageList заменяют изображение в списке изображений новым изображением. **ImageList \_ Замена** заменяет изображение растровым изображением и маской, а **ImageList \_ реплацеикон** заменяет изображение значком или курсором.

Функция [**ImageList \_ Merge**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_merge) выполняет слияние двух изображений, сохраняя новый образ в новом списке изображений. Новый образ создается путем рисования второго изображения прозрачно на первом. Маска для нового изображения является результатом выполнения логической операции **or** над битами масок для двух существующих изображений.

## <a name="drawing-images"></a>Рисование изображений

Чтобы нарисовать изображение, используйте функцию [**ImageList \_ Draw**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_draw) или [**ImageList \_ дравекс**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_drawex) . Вы указываете маркер для списка изображений, индекс изображения для рисования, маркер для контекста устройства назначения, расположение в контексте устройства и один или несколько стилей рисования.

Если задан прозрачный стиль **ку \_** , [**ImageList \_ Draw**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_draw) или [**ImageList \_ дравекс**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_drawex) использует двухэтапный процесс для рисования маскированного изображения. Во-первых, он выполняет логическую операцию **и** над битами изображения и битами маски. Затем выполняется логическая операция **XOR** с результатами первой операции и фоновыми битами контекста целевого устройства. Этот процесс создает прозрачные области в полученном изображении. то есть каждый белый бит в маске приводит к прозрачности соответствующего бита в полученном изображении.

Прежде чем вырисовать маскированное изображение на фоне сплошного цвета, следует использовать функцию [**ImageList \_ сетбкколор**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setbkcolor) , чтобы задать цвет фона для списка изображений в том же цвете, что и назначение. Установка цвета устраняет необходимость создавать прозрачные области в изображении и позволяет [**\_ Дравекс**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_drawex) изображений [**ImageList \_**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_draw) или ImageList просто копировать изображение в контекст целевого устройства, что приводит к значительному увеличению производительности. Чтобы нарисовать изображение, укажите стиль **" \_ Стандартный" ку** в вызове **ImageList \_ Draw** или **ImageList \_ дравекс**.

Цвет фона для маскированного списка изображений можно задать в любое время, чтобы он правильно выстроился на любом сплошном фоне. Если задать для цвета фона значение "CLR \_ None", изображения по умолчанию прозрачно отрисовываются. Чтобы получить цвет фона списка изображений, используйте функцию [**ImageList \_ жетбкколор**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_getbkcolor) .

В стилях **ку \_ BLEND25** и **ку \_ BLEND50** изображение поменяется на цвет выделения системы. Эти стили полезны, если для представления объекта, который пользователь может выбрать, используется маскированное изображение. Например, можно использовать стиль **ку \_ BLEND50** для рисования изображения при его выборе пользователем.

Немаскированное изображение копируется в контекст целевого устройства с помощью операции растровой СРККОПИ. Цвета изображения отображаются одинаково независимо от цвета фона контекста устройства. Стили рисования, заданные в [**ImageList \_ Draw**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_draw) или [**ImageList \_ дравекс**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_drawex) , также не влияют на внешний вид немаскированного изображения.

## <a name="dragging-images"></a>Перетаскивание изображений

API-интерфейс Win32 включает функции для перетаскивания изображения на экране. Перетаскивая функции перемещают изображение плавно, в цвете и без мигания курсора. Можно перетащить как маскированные, так и немаскированные изображения.

Функция [**ImageList \_ бегиндраг**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_begindrag) начинает операцию перетаскивания. Параметры включают в себя маркер для списка изображений, индекс изображения для перетаскивания и расположение активной точки в изображении. Активная точка — это один пиксель, который функции перетаскивания распознаются как точное расположение изображения на экране. Как правило, приложение задает активную точку, чтобы она совпадала с активной назначением курсора мыши. Функция [**\_ драгмове ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_dragmove) перемещает изображение в новое место.

Функция [**ImageList \_ DragEnter**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_dragenter) задает начальное расположение изображения перетаскивания в окне и рисует изображение в позиции. Параметры включают в себя маркер окна, в котором рисуется изображение, и координаты начальной точки в окне. Координаты задаются относительно левого верхнего угла окна, а не клиентской области. Это справедливо и для всех функций перетаскивания изображений, которые принимают координаты в качестве параметров. Это означает, что при указании координат необходимо компенсировать ширину элементов окна, таких как граница, строка заголовка и строка меню. Если при вызове **ImageList \_ DragEnter** указать **нулевой** указатель, то функции перетаскивания нарисуют изображение в контексте устройства, связанном с окном рабочего стола, а координаты зависят от левого верхнего угла экрана.

Функция [**ImageList \_ сетдрагкурсоримаже**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setdragcursorimage) создает новое изображение перетаскивания, комбинируя заданный рисунок (обычно это изображение курсора мыши) с текущим изображением перетаскивания. Поскольку функции перетаскивания используют новый образ во время операции перетаскивания, следует использовать функцию [**шовкурсор**](/windows/desktop/api/winuser/nf-winuser-showcursor) , чтобы скрыть фактический курсор мыши после вызова **ImageList \_ сетдрагкурсоримаже**. В противном случае система может иметь два курсора мыши в течение операции перетаскивания.

Когда приложение вызывает [**ImageList \_ бегиндраг**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_begindrag), система создает временный внутренний список изображений, а затем копирует указанное изображение перетаскивания во внутренний список. Вы можете получить маркер для временного списка изображений перетаскивания с помощью функции [**ImageList \_ жетдрагимаже**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_getdragimage) . Функция также получает текущую точку перетаскивания и смещение изображения перетаскивания относительно позиции перетаскивания.

## <a name="image-information"></a>Сведения об образе

Существует ряд функций, которые извлекают сведения из списка изображений. Функция [**ImageList \_ жетимажеинфо**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_getimageinfo) заполняет структуру [**имажеинфо**](/windows/desktop/api) информацией об одном изображении, включая маркеры точечных рисунков изображения и маски, число цветовых плоскостей и бит на пиксель, а также ограничивающий прямоугольник изображения в точечном рисунке изображения. Эти сведения можно использовать для непосредственного управления точечными рисунками изображения. Функция [**ImageList \_ жетимажекаунт**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_getimagecount) извлекает количество изображений в списке изображений.

## <a name="image-overlays"></a>Наложение изображений

Каждый список изображений содержит список индексов для использования в качестве наложений. Наложение — это изображение, которое прозрачно рисуется на другом изображении. Все изображения, находящиеся в списке изображений, можно использовать в качестве наложения. Для каждого списка изображений можно указать до четырех наложений. Это ограничение было увеличено до 15 в версии 4,71.

Вы добавляете индекс изображения в список наложений с помощью функции [**\_ сетоверлайимаже ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) , задавая маркер для списка изображений, индекс существующего изображения и нужный индекс оверлея. Это, по сути, сообщает списку изображений, что "изображение с индексом *x* можно использовать в качестве наложенного, и я хочу ссылаться на оверлей как наложение индекса *y*". Индексы оверлея основаны на единицах, а не на отсчете от нуля, поскольку индекс оверлея, равный нулю, означает, что перекрытие не используется.

Наложение задается при рисовании изображения с помощью функции [**ImageList \_ Draw**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_draw) или [**ImageList \_ дравекс**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_drawex) . Наложение задается путем выполнения логической операции **or** между нужными флагами рисования и результатом макроса [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) . Макрос **индекстуверлаймаск** принимает индекс оверлея и форматирует его для включения с флагами для этих функций. Изображение будет вырисовано с заданным наложением. В следующем примере показано, как наложение добавляется и задается при рисовании изображения.


```
ImageList_SetOverlayImage(himl, 0, 3);
ImageList_Draw(himl, 1, hdc, 0, 0, ILD_MASK | INDEXTOOVERLAYMASK(3));
```



Это приведет к изображению 1, а затем наложением изображения с изображением 0. Поскольку 3 — индекс оверлея, указанный в вызове [**\_ сетоверлайимаже ImageList**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) , 3 помещается в макрос [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) .

## <a name="32-bit-antialiased-icons"></a>32-битовые значки со сглаженными значками

Сглаживание — это способ размытия или размытия острых краев. Это обеспечивает более естественный вид изображений. Списки изображений в Windows Vista и Windows 7 поддерживают использование 32-разрядных значков и точечных рисунков. Цветовые значения используют 24 бита, а 8 бит используются в качестве альфа-канала на значках. Чтобы создать список изображений, который может работать с изображением размером 32 бит/с (бит на пиксель), вызовите функцию [**ImageList \_ CREATE**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) , передав \_ флаг ILC COLOR32.

Для правильного создания 32-разрядных значков необходимо создать несколько изображений для каждого значка, как показано на следующем рисунке.

![Иллюстрация, отображающая три размера значков для каждой из трех глубин цвета](images/theme2.png)

-   Первые три изображения находятся в 16-цветном режиме для использования в защищенном режиме.
-   Следующие три значка используются в режиме 256-цвета.
-   Последние три значка имеют альфа-канал и могут использоваться только в операционных системах, использующих не более 24 разрядов или более высоких цветов.
-   Порядок изображений в формате значка имеет значение. Если порядок неверен, старые версии Windows работают плохо при извлечении значков. Неправильное извлечение значков может привести к повреждению памяти и неправильному отображению.
-   В предыдущих версиях Windows превышено ограничение ресурсов в 10 значков.

> [!Note]  
> Для создания файлов значков и точечных рисунков, содержащих альфа-канал, можно использовать сторонние инструменты. При использовании [**лоадимаже**](/windows/desktop/api/winuser/nf-winuser-loadimagea) для загрузки точечного рисунка 32 в формате Alpha, содержащего альфа-канал, необходимо указать \_ флаг LR креатедибсектион.

 

 

 