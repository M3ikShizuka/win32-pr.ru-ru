---
title: Сведения об элементах управления ToolBar
description: Панель инструментов — это элемент управления, содержащий одну или несколько кнопок.
ms.assetid: b5a00a81-8d23-4844-8b0a-776e7cceced8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6f615da972f14bb88c4915504c089dd6b40d9aca
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127166015"
---
# <a name="about-toolbar-controls"></a>Сведения об элементах управления ToolBar

Панель инструментов — это элемент управления, содержащий одну или несколько кнопок. Каждая кнопка при щелчке пользователем отправляет сообщение командной строки родительскому окну. Как правило, кнопки на панели инструментов соответствуют элементам меню приложения, что предоставляет пользователю дополнительный и более прямой способ доступа к командам приложения.

На следующем снимке экрана показано окно, содержащее простую панель инструментов для файловых операций. Приложение включило стили оформления. Кнопка сохранить — «горячий», так как курсор наводится на него при попытке выполнить снимок экрана. Реальный внешний вид элемента управления зависит от операционной системы и темы, выбранной пользователем.

![снимок экрана окна с панелью инструментов с тремя кнопками; одна кнопка является активной](images/tb-withstyles.png)

На следующем снимке экрана показан тот же элемент управления в приложении, которое было скомпилировано без включенных стилей оформления.

![снимок экрана окна без стилей оформления: ни одна из кнопок не выглядит активно](images/tb-wostyles.png)

В следующих разделах рассматриваются возможности, которые следует учитывать при планировании панели инструментов. Конкретные сведения о реализации и примеры кода см. в разделе [Использование элементов управления ToolBar](using-toolbar-controls.md).

-   [Указание размера и расположения панели инструментов](#specifying-toolbar-size-and-position)
-   [Прозрачные панели инструментов](#transparent-toolbars)
-   [Панели инструментов в стиле списка](#list-style-toolbars)
-   [Определение изображений для кнопок](#defining-button-images)
    -   [Определение изображений на кнопке с помощью точечных рисунков](#defining-button-images-by-using-bitmaps)
    -   [Определение изображений для кнопок с помощью списков изображений](#defining-button-images-by-using-image-lists)
-   [Определение текста для кнопок](#defining-text-for-buttons)
-   [Добавление кнопок панели инструментов](#adding-toolbar-buttons)
    -   [Стили кнопок панели инструментов](#toolbar-button-styles)
    -   [Состояния кнопок панели инструментов](#toolbar-button-states)
    -   [Идентификатор команды](#command-identifier)
    -   [Размер и расположение кнопки](#button-size-and-position)
-   [Включение настройки](#enabling-customization)
-   [Включение оперативного отслеживания](#enabling-hot-tracking)

## <a name="specifying-toolbar-size-and-position"></a>Указание размера и расположения панели инструментов

При создании панели инструментов с помощью [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex)функция позволяет задать высоту и ширину панели инструментов в пикселях.

> [!Note]  
> Использовать [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex) не рекомендуется, так как он не поддерживает новые возможности панелей инструментов, включая списки изображений. Дополнительные сведения о создании панелей инструментов см. [в разделе Использование элементов управления ToolBar](using-toolbar-controls.md).

 

Функция [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) не имеет параметров для указания размера панели инструментов. Процедура окна панели инструментов автоматически задает размер и расположение окна панели инструментов. Высота основана на высоте кнопок на панели инструментов. Ширина совпадает с шириной клиентской области родительского окна. Чтобы изменить параметры автоматического размера, отправьте [**ТБ \_ сетбуттонсизе**](tb-setbuttonsize.md) -сообщения. Стандартные стили управления [**CCS \_**](common-control-styles.md) и [**CCS \_ снизу**](common-control-styles.md) определяют, располагается ли панель инструментов вдоль верхней или нижней части клиентской области. По умолчанию панель инструментов имеет **\_ верхний стиль CCS** .

Кроме того, окно панели инструментов автоматически корректирует размер панели инструментов при получении сообщения об [**\_ изменении размера WM**](/windows/desktop/winmsg/wm-size) или [**ТБ \_**](tb-autosize.md) . Приложение должно отправлять любое из этих сообщений при изменении размера родительского окна или после отправки сообщения, которое требует настройки размера панели инструментов, например, [**\_ сетбуттонсизеного**](tb-setbuttonsize.md) сообщения размером ТБ.

Поведение панели инструментов по умолчанию для изменения размера и позиционирования можно отключить, установив стандартные стили управления [**CCS \_ Норесизе**](common-control-styles.md) и [**CCS \_ нопаренталигн**](common-control-styles.md) . Элементы управления "панель инструментов", размещенные элементами управления главной панели, должны устанавливать эти стили, так как размеры элементов управления главной панели и их расположение.

## <a name="transparent-toolbars"></a>Прозрачные панели инструментов

Элементы управления ToolBar поддерживают прозрачный внешний вид, который позволяет отображать клиентскую область на панели инструментов. Существует два вида прозрачных панелей инструментов с плоскими кнопками и трехмерными кнопками. если требуется, чтобы приложение соответствовало интерфейсу Windows, используйте панель инструментов плоского прозрачного стиля.

На следующем снимке экрана показаны два вида прозрачных панелей инструментов, не использующих стили оформления.

![снимок экрана двух окон с различными стилями панелей инструментов, но обе панели инструментов являются прозрачными](images/toolbartrans.jpg)

на следующем снимке экрана показана прозрачная панель инструментов, которая может отображаться в Windows Vista с включенными стилями оформления. Цвет фона диалогового окна был изменен, чтобы сделать прозрачность более очевидной.

![снимок экрана окна в Windows Vista с прозрачной панелью инструментов](images/tb-transparent.png)

Чтобы создать прозрачную панель инструментов, необходимо только добавить [**тбстиле \_ Flat**](toolbar-control-and-button-styles.md) или [**тбстиле, \_ прозрачный**](toolbar-control-and-button-styles.md) для параметра стиля окна [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa). Если не требуется, чтобы линия отображалась в нижней части панели инструментов, не используйте стиль окна [**\_ границы WS**](/windows/desktop/winmsg/window-styles) .

> [!Note]  
> При использовании стилей оформления панели инструментов по умолчанию могут быть плоскими.

 

## <a name="list-style-toolbars"></a>Панели инструментов в стиле списка

Кнопки панели инструментов позволяют отображать как текст, так и точечные рисунки. Кнопки на панели инструментов, созданной с помощью стиля [**\_ списка тбстиле**](toolbar-control-and-button-styles.md) , размещают текст справа от точечного рисунка, а не под ним.

На следующем снимке экрана показана панель инструментов со стилем списка.

![снимок экрана панели инструментов с текстом справа от каждого значка](images/tb-liststyle.png)

Вы можете использовать стиль панели инструментов [**\_ список тбстиле**](toolbar-control-and-button-styles.md) в сочетании с [**\_ плоским**](toolbar-control-and-button-styles.md) стилем тбстиле, чтобы создать панель инструментов с плоскими кнопками.

## <a name="defining-button-images"></a>Определение изображений для кнопок

Существует два способа задания изображений для кнопок — по точечным рисункам или по спискам изображений. Приложение должно выбрать используемый метод. Они не могут использовать оба метода с одним и тем же элементом управления ToolBar. Обратите внимание, что функция [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex) использует метод Bitmap. Приложения, которые хотят использовать метод списка изображений, должны использовать функцию [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) для создания элемента управления ToolBar.

### <a name="defining-button-images-by-using-bitmaps"></a>Определение изображений на кнопке с помощью точечных рисунков

Каждая кнопка на панели инструментов может включать растровый рисунок. Панель инструментов использует внутренний список для хранения сведений, необходимых для рисования изображений. При вызове функции [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex) вы указываете монохромный или цветной точечный рисунок, содержащий начальные изображения, а панель инструментов добавляет эти сведения во внутренний список изображений. Дополнительные образы можно добавить позже с помощью сообщения [**\_ аддбитмап ТБ**](tb-addbitmap.md) .

Каждый образ содержит индекс, начинающийся с нуля. Первое изображение, добавленное во внутренний список, имеет индекс 0, второе изображение имеет индекс 1 и т. д. [**ТБ \_ АДДБИТМАП**](tb-addbitmap.md) добавляет изображения в конец списка и возвращает индекс первого нового добавленного изображения. Чтобы связать изображение с кнопкой, необходимо отправить сообщение [**\_ Аддбуттонс в ТБ**](tb-addbuttons.md) и указать индекс изображения после добавления растровых изображений во внутренний список изображений.

Windows предполагает, что все растровые изображения панели инструментов имеют одинаковый размер. Размер указывается при создании панели инструментов с помощью [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex). Если для создания панели инструментов используется функция [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) , то размер изображений устанавливается равным значениям по умолчанию 16 на 15 пикселей. Можно использовать сообщение [**\_ Сетбитмапсизе размером ТБ**](tb-setbitmapsize.md) для изменения размеров растровых изображений, но это необходимо сделать перед добавлением изображений во внутренний список.

### <a name="defining-button-images-by-using-image-lists"></a>Определение изображений для кнопок с помощью списков изображений

Изображения кнопок также можно хранить в наборе [списков изображений](image-lists.md). Список изображений — это набор изображений одного размера, на каждый из которых можно ссылаться по индексу. Списки изображений используются для управления большими наборами значков или точечных рисунков. Для отображения кнопок в различных состояниях можно использовать до трех различных списков изображений, как показано в следующей таблице.



|  Состояние        |  Описание                                                                                                                                                                                            |
|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Норм.   | Кнопки в состоянии по умолчанию.                                                                                                                                                              |
| Горячий      | Кнопки, нажимаемые под указателем или нажатой. Активные элементы поддерживаются только в элементах управления "панель инструментов" с [**\_ неструктурированным**](toolbar-control-and-button-styles.md) стилем тбстиле. |
| Выключено | Отключенные кнопки.                                                                                                                                                                   |



 

После уничтожения панели инструментов приложения должны освобождать все созданные им списки образов.

## <a name="defining-text-for-buttons"></a>Определение текста для кнопок

Каждая кнопка может отображать строку в дополнение к изображению или вместо него. Панель инструментов поддерживает внутренний список, содержащий все строки, доступные кнопкам панели инструментов. Вы добавляете строки во внутренний список с помощью сообщения [**\_ ADDSTRING ТБ**](tb-addstring.md) , указывая адрес буфера, содержащего добавляемые строки. Каждая строка должна завершаться нулем, а последняя строка должна завершаться двумя символами NULL.

Каждая строка содержит индекс, начинающийся с нуля. Первая строка, добавленная во внутренний список строк, имеет индекс 0, вторая строка имеет индекс 1 и т. д. [**ТБ \_ ADDSTRING**](tb-addstring.md) добавляет строки в конец списка и возвращает индекс первой новой строки. Чтобы связать строку с кнопкой, используется индекс строки.

Использование [**ТБ \_ ADDSTRING**](tb-addstring.md) — не единственный способ добавления строк на панель инструментов. Строку можно отобразить в кнопке, передав указатель строки в члене **истринг** структуры [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) , которая передается в [**ТБ \_ аддбуттонс**](tb-addbuttons.md). Кроме того, можно использовать [**ТБ \_ сетбуттонинфо**](tb-setbuttoninfo.md) для назначения текста кнопке панели инструментов.

## <a name="adding-toolbar-buttons"></a>Добавление кнопок панели инструментов

Если для создания панели инструментов используется функция [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex) , можно добавить кнопки на панель инструментов, заполнив массив структур [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) и указав адрес массива в вызове функции. Однако функция [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) не имеет параметра для передачи структуры **тббуттон** . **CreateWindowEx** создает пустую панель инструментов, заполняемую при отправке сообщения [**\_ аддбуттонс ТБ**](tb-addbuttons.md) , указывая адрес структуры **тббуттон** .

После создания панели инструментов можно добавить кнопки, отправив в [**ТБ \_ Инсертбуттон**](tb-insertbutton.md) или [**ТБ \_ аддбуттонс**](tb-addbuttons.md) сообщение. Каждая кнопка описывается структурой [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) , определяющей атрибуты кнопки, включая индексы ее строки и точечного рисунка, а также ее стиль, состояние, идентификатор команды и определяемое приложением 32-разрядное значение.

> [!Note]  
> Если для создания панели инструментов используется функция [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) , перед добавлением каких-либо кнопок необходимо отправить сообщение [**\_ буттонструктсизе ТБ**](tb-buttonstructsize.md) . Сообщение передает размер структуры [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) на панель инструментов.

 

### <a name="toolbar-button-styles"></a>Стили кнопок панели инструментов

Стиль кнопки определяет, как отображается кнопка и как она реагирует на вводимые пользователем данные. Например, стиль [**\_ кнопки бтнс**](toolbar-control-and-button-styles.md) создает кнопку на панели инструментов, которая ведет себя как стандартная кнопка "Отправить". Кнопка с стилем [**\_ проверки бтнс**](toolbar-control-and-button-styles.md) похожа на стандартную кнопку Push, за исключением того, что она переключает между нажатым и ненажатым состоянием при каждом нажатии пользователем.

Вы можете создавать группы кнопок панели инструментов, которые действуют как переключатели, используя [**\_ группу Бтнс**](toolbar-control-and-button-styles.md) или [**бтнс \_ чеккграуп**](toolbar-control-and-button-styles.md) Style. Это приводит к нажатию кнопки, пока пользователь не выберет другую кнопку в группе. Группа определяется как непрерывная коллекция кнопок, все с **бтнс \_ группой** или **бтнс \_ чеккграуп** Style.

Стиль [**бтнс \_ Sep**](toolbar-control-and-button-styles.md) создает небольшой зазор между кнопками или выводит «вдавленное» между кнопками на плоских панелях инструментов. Кнопка с стилем **бтнс \_ Sep** не получает входные данные пользователя.

В версии 5,80 стандартных элементов управления появились некоторые новые стили кнопок панели инструментов и переименованы некоторые из старых стилей. Все флаги стиля кнопки теперь начинаются с БТНС \_ XXX вместо тбстиле \_ xxx. Список и описание стилей кнопок см. в разделе [стили элементов управления и кнопок панели инструментов](toolbar-control-and-button-styles.md).

### <a name="toolbar-button-states"></a>Состояния кнопок панели инструментов

Каждая кнопка на панели инструментов имеет состояние. Панель инструментов обновляет состояние кнопки в соответствии с действиями пользователя, например нажатием кнопки. Состояние указывает, находится ли кнопка в данный момент нажата или не нажата, включена или отключена, скрыта или видима. Несмотря на то, что приложение задает начальное состояние кнопки при добавлении кнопки на панель инструментов, оно может изменить и получить состояние, отправив на панель инструментов сообщения в [**терабайтах \_**](tb-getstate.md) [**\_ SETSTATE и ТБ**](tb-setstate.md) . Список состояний кнопок панели инструментов см. в разделе [состояния панелей инструментов](toolbar-button-states.md).

### <a name="command-identifier"></a>Идентификатор команды

Каждой кнопке назначен определенный приложением идентификатор команды. Идентификаторы кнопок обычно определяются в файле заголовка приложения. Например, кнопка Вставить может быть определена следующим образом:


```
#define ID_PASTE 100
```



Когда пользователь нажимает кнопку, панель инструментов отправляет родительскому окну [**\_ команду WM**](/windows/desktop/menurc/wm-command) или сообщение [**WM \_ Notify**](wm-notify.md) , которая содержит идентификатор команды. Родительское окно проверяет идентификатор команды и выполняет команду, связанную с кнопкой. Сведения о том, когда элементы управления отправляют **\_ Командные сообщения WM** и когда отправляют **\_ уведомления WM**, см. в разделе "Примечания" документации [**WM \_ Notify**](wm-notify.md) .

### <a name="button-size-and-position"></a>Размер и расположение кнопки

Панель инструментов отслеживает свои кнопки путем назначения каждой кнопки индекса позиции. Индекс отсчитывается от нуля; Это значит, что крайняя левая кнопка имеет индекс 0, кнопка Next справа имеет индекс 1 и т. д. Приложение должно указывать индекс кнопки при отправке сообщений для получения сведений о кнопке или задании атрибутов кнопки.

Панель инструментов обновляет индексы позиций по мере вставки и удаления кнопок. Приложение может получить индекс текущей позиции кнопки с помощью сообщения [**\_ коммандтоиндекс ТБ**](tb-commandtoindex.md) . В сообщении указывается идентификатор команды для кнопки, а в окне панели инструментов используется идентификатор для нахождение кнопки и возврата индекса позиции.

Все кнопки на панели инструментов имеют одинаковый размер. Функция [**креатетулбарекс**](/windows/desktop/api/Commctrl/nf-commctrl-createtoolbarex) требует задать начальный размер кнопок при создании панели инструментов. При использовании функции [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) начальным размером присваивается размер по умолчанию в 24 – 22 пикселях. Можно использовать сообщение [**\_ Сетбуттонсизе размером ТБ**](tb-setbuttonsize.md) , чтобы изменить размер кнопки, но это необходимо сделать перед добавлением кнопок на панель инструментов. Сообщение [**\_ Жетитемрект размером ТБ**](tb-getitemrect.md) получает текущие размеры кнопок.

При добавлении строки, которая длиннее любой строки в данный момент на панели инструментов, панель инструментов автоматически сбрасывает ширину своих кнопок. Ширина задается для размещения самой длинной строки на панели инструментов.

## <a name="enabling-customization"></a>Включение настройки

На панели инструментов есть встроенные функции настройки, которые можно сделать доступными для пользователя, предоставив панели инструментов [**\_ Настраиваемый**](common-control-styles.md) стиль Common Control (CCS). Функции настройки позволяют пользователю перетащить кнопку на новую позицию или удалить ее, перетащив с панели инструментов. Кроме того, пользователь может дважды щелкнуть панель инструментов, чтобы открыть диалоговое окно Настройка панели инструментов, которое позволяет пользователю добавить, удалить и переупорядочить кнопки панели инструментов. Чтобы открыть диалоговое окно, используйте сообщение [**\_ CUSTOMIZE (ТБ**](tb-customize.md) ) для настройки. Приложение определяет, доступны ли функции настройки пользователю, и определяет область, в которой пользователь может настраивать панель инструментов.

В рамках процесса настройки приложениям часто приходится сохранять и восстанавливать состояние панели инструментов. Например, многие приложения сохраняют состояние панели инструментов до того, как пользователь начнет настраивать панель инструментов в случае, когда пользователь позже захочет восстановить исходное состояние панели инструментов. Элемент управления ToolBar не сохраняет запись о состоянии преднастройки автоматически. Приложение должно сохранить состояние панели инструментов, чтобы восстановить ее. Дополнительные сведения см. [в разделе Использование элементов управления ToolBar](using-toolbar-controls.md).

## <a name="enabling-hot-tracking"></a>Включение оперативного отслеживания

«Горячее» отслеживание означает, что при перемещении указателя над элементом внешний вид кнопки изменяется. При включении стилей оформления панели инструментов по умолчанию поддерживают функцию оперативного отслеживания. В противном случае, только элементы управления панели инструментов, созданные с помощью [**\_ плоского стиля тбстиле**](toolbar-control-and-button-styles.md) , поддерживают горячее отслеживание. Можно использовать другие стили окна в сочетании с **тбстиле \_ Flat** для создания панелей инструментов, обеспечивающих возможность оперативного отслеживания, но имеющих разный вид на плоской панели инструментов. Дополнительные сведения см. [в разделе Использование элементов управления ToolBar](using-toolbar-controls.md).

 

 