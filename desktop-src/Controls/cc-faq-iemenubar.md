---
title: Создание строки меню Интернет Explorer-Style
description: На первый взгляд, строка меню в Microsoft Internet Explorer 5 и более поздних версий похожа на стандартное меню. Однако при начале использования он выглядит совершенно иначе.
ms.assetid: e0fe25f2-3d49-4c5a-a3f9-2f468f2cfef2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b262bc55407d263c97d4bd7e3938a9794d3a58f5
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103891124"
---
# <a name="how-to-create-an-internet-explorer-style-menu-bar"></a>Создание строки меню Интернет Explorer-Style

На первый взгляд, строка меню в Microsoft Internet Explorer 5 и более поздних версий похожа на стандартное меню. Однако при начале использования он выглядит совершенно иначе.

На следующем снимке экрана показана панель меню Windows Internet Explorer с выбранным меню Сервис.

![снимок экрана, на котором показана строка меню Windows Internet Explorer с выбранным меню "Сервис"](images/howto8.jpg)

Панель меню на самом деле представляет собой элемент управления ToolBar, похожий на стандартное меню. Вместо пунктов меню верхнего уровня в строке меню имеется ряд кнопок только с текстом, которые отображают раскрывающееся меню при щелчке. Однако в качестве специального типа панели инструментов в строке меню есть некоторые возможности стандартных меню.

-   Его можно настроить с помощью стандартных методов панели инструментов, позволяя пользователю перемещать, удалять или добавлять элементы.
-   Он может иметь возможность оперативного отслеживания, чтобы пользователи могли понять, когда они находятся на элементе верхнего уровня, и не щелкать их первыми.

Строку меню можно включить в элемент управления главной панели, предоставив следующие возможности:

-   Он может иметь захват, позволяющий пользователю перемещать или изменять размер полосы.
-   Она может совместно использовать полосу в элементе управления главной панели с другими полосами, такими как стандартная панель инструментов на предыдущем рисунке.
-   Он может отображать Шеврон, когда он охватывает смежную полосу, предоставляя пользователю доступ к скрытым элементам.
-   Он может иметь заданное приложением фоновое растровое изображение.

В этом разделе описывается, как реализовать строку меню. Так как строка меню является специализированной реализацией элемента управления ToolBar, фокус будет отображаться на разделах, относящихся к строкам меню. Обсуждение того, как внедрить панель инструментов в элемент управления главной панели, см. [в разделе Создание панели инструментов Explorer-Style Internet](cc-faq-ietoolbar.md) и [Управление главной](rebar-controls.md)панелью.

-   [Создание панели инструментов в строке меню](#making-a-toolbar-into-a-menu-bar)
-   [Обработка навигации с помощью Hot-Tracking меню отключена](#handling-navigation-with-menu-hot-tracking-disabled)
    -   [Навигация по мыши](#mouse-navigation)
    -   [Навигация с помощью клавиатуры](#keyboard-navigation)
    -   [Смешанная Навигация](#mixed-navigation)
-   [Обработка навигации с включенным Hot-Tracking меню](#handling-navigation-with-menu-hot-tracking-enabled)
    -   [Обработка сообщений для горячего отслеживания меню](#message-processing-for-menu-hot-tracking)
    -   [Навигация по мыши](#mouse-navigation)
    -   [Навигация с помощью клавиатуры](#keyboard-navigation)

## <a name="making-a-toolbar-into-a-menu-bar"></a>Создание панели инструментов в строке меню

Чтобы сделать панель инструментов в строке меню, выполните следующие действия.

-   Создайте плоскую панель инструментов, включив [**тбстиле \_ Flat**](toolbar-control-and-button-styles.md) с другими флагами стиля окна. **\_ Неструктурированный стиль тбстиле** также обеспечивает горячее отслеживание. В этом стиле строка меню похожа на стандартное меню, пока пользователь не активирует кнопку. После этого кнопка будет выделена на панели инструментов и Депресс при ее нажатии, как и стандартная кнопка. Так как включено отслеживание "горячего" отслеживания, все, что необходимо для активации кнопки, — это курсор, наведя на него указатель мыши. Если курсор переместится на другую кнопку, он будет активирован, а старая кнопка деактивируется.
-   Создайте кнопки в стиле списка, включив [**\_ список тбстиле**](toolbar-control-and-button-styles.md) с другими флагами стиля окна. Этот стиль создает более тонкую кнопку, которая больше похожа на стандартный элемент меню верхнего уровня.
-   Сделайте кнопки только текстом, установив для элемента **ибитмап** структуры [**тббуттон**](/windows/desktop/api/Commctrl/ns-commctrl-tbbutton) кнопки значение \_ Имаженоне, а для элемента **истринг** — текст кнопки.
-   Присвойте каждой кнопке стиль [**\_ раскрывающегося списка бтнс**](toolbar-control-and-button-styles.md) . При нажатии кнопки элемент управления ToolBar отправляет приложению уведомление [ \_ раскрывающегося списка ТБН](tbn-dropdown.md) , предлагающее отобразить меню кнопки.
-   Включить строку меню в полосу главной панели. Включите как захваты, так и шевроны, как описано в разделе [Создание веб Explorer-Style панели инструментов](cc-faq-ietoolbar.md).
-   Реализуйте [обработчик \_ раскрывающегося списка ТБН](tbn-dropdown.md) , чтобы отобразить *раскрывающееся меню* кнопки при ее нажатии. Раскрывающееся меню — это тип всплывающего меню. Она создается с помощью функции [**метод TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) , а ее левый верхний угол выстраивается в левом нижнем углу кнопки.
-   Реализуйте навигацию с помощью клавиатуры, чтобы строка меню стала полностью доступной без мыши.
-   Реализуйте горячее отслеживание в меню. При использовании стандартных меню после отображения меню пункта меню верхнего уровня при перемещении курсора на другой элемент верхнего уровня автоматически отображается его меню и сворачивается меню предыдущего элемента. Элемент управления Toolbar (панель инструментов) будет зафиксировать курсор и изменить изображение кнопки, но автоматически отобразит новое меню. Приложение должно сделать это явным образом.

Большинство этих элементов просты в реализации и обсуждаются в других местах. Общие сведения об использовании панелей инструментов и элементов управления главной панели см. [в статье Создание веб-Explorer-Style панели инструментов](cc-faq-ietoolbar.md), о панелях инструментов и [элементах управления главной](rebar-controls.md) [панелью](toolbar-controls-overview.md). Сведения о том, как управлять всплывающими меню, см. в разделе [меню](/windows/desktop/menurc/menus) . В оставшейся части этого раздела обсуждаются последние два элемента: Навигация по клавишам и «горячее» отслеживание.

## <a name="handling-navigation-with-menu-hot-tracking-disabled"></a>Обработка навигации с помощью Hot-Tracking меню отключена

Пользователи могут перемещаться по строке меню с помощью мыши, клавиатуры или сочетания обеих клавиш. Чтобы реализовать навигацию в строке меню, приложение должно выполнять обработку уведомлений на панели инструментов и отслеживать работу мыши и клавиатуры. Эту задачу можно разделить на две отдельные части: с помощью и без "горячего" отслеживания меню. В этом разделе описывается, как управлять навигацией, когда меню не отображается и не включена поддержка горячего отслеживания меню.

### <a name="mouse-navigation"></a>Навигация по мыши

Если меню "горячее" Отслеживание отключено, можно рассматривать строку меню как обычную панель инструментов. Если пользователь выполняет переход с помощью мыши, все ваше приложение должно работать с [ \_ раскрывающимся](tbn-dropdown.md) уведомлением ТБН. При получении этого уведомления откройте соответствующее раскрывающееся меню и включите горячее отслеживание меню. После этого вы войдете в меню "горячее отслеживание" региме, которое обсуждалось в разделе [Обработка навигации с включенным Hot-Tracking меню](#handling-navigation-with-menu-hot-tracking-enabled).

Как обсуждалось при [смешанной навигации](#mixed-navigation), необходимо также обрабатывать уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы контролировать активную кнопку. Это уведомление не имеет значения, если пользователь работает только с мышью, но он необходим, если навигация с помощью мыши и клавиатуры является смешанной.

### <a name="keyboard-navigation"></a>Навигация с помощью клавиатуры

Как отмечалось в предыдущем разделе, пользователь может выполнить ряд операций навигации с клавиатурой, если отключено горячее отслеживание меню. Элементы управления ToolBar поддерживают навигацию с помощью клавиатуры только в том случае, если они имеют фокус. Кроме того, они не обрабатывают все нажатия клавиш, необходимые для строк меню. Самым простым решением для работы с клавиатурой является обработка соответствующих событий нажатия клавиши явным образом.

Если отключено горячее отслеживание в меню, приложение должно решить эти события нажатия, как указано ниже.

-   Клавиша F10. Активируйте первую кнопку с [**\_ сесотитем ТБ**](tb-sethotitem.md).
-   Клавиши Стрелка влево и стрелка вправо. Активируйте смежную кнопку с [**ТБ \_ сесотитем**](tb-sethotitem.md). Если пользователь пытается перейти к концу строки меню, активируйте первую кнопку на противоположном конце.
-   Клавиша ESCAPE. Деактивация активной кнопки с [**\_ сесотитем ТБ**](tb-sethotitem.md). Строка меню должна возвращаться в то состояние, в котором оно было до активации первой кнопки.
-   Сочетание клавиш ALT +*Клавиша* . Используйте сообщение [**\_ мапакцелератор ТБ**](tb-mapaccelerator.md) , чтобы определить, к какой кнопке соответствует символ *ключа* . Отобразить раскрывающееся меню кнопки и включить горячее отслеживание меню.
-   Клавиша СТРЕЛКА ВНИЗ. Если кнопка активна, но меню не отображается, отобразите меню кнопки и включите функцию горячего отслеживания меню.
-   Клавиша ВВОД. Деактивация активной кнопки с [**\_ сесотитем ТБ**](tb-sethotitem.md). Строка меню должна возвращаться в то состояние, в котором оно было до активации первой кнопки.

### <a name="mixed-navigation"></a>Смешанная Навигация

Обработчики навигации с клавиатурой, описанные в предыдущем разделе, в основном выполняют две задачи: отслеживание активной кнопки и отображение соответствующего меню при выборе кнопки. Эти обработчики достаточно, пока пользователь переходит только с клавиатуры. Однако пользователи часто сочетают навигацию с помощью клавиатуры и мыши. Например, они могут активировать первую кнопку с помощью клавиши F10, использовать мышь для активации другой кнопки, а затем открыть ее меню с помощью клавиши со стрелкой вниз. Если вы отслеживаете только нажатия клавиш, чтобы следить за активным ключом, отобразится неправильное меню. Также необходимо выполнить обработку уведомления [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы точно контролировать активную кнопку.

## <a name="handling-navigation-with-menu-hot-tracking-enabled"></a>Обработка навигации с включенным Hot-Tracking меню

Если включено горячее отслеживание в меню, приложение должно изменить способ реагирования на навигацию пользователя. Для репликации поведения стандартных меню необходимо явно реализовать следующие функции.

С навигацией с помощью мыши:

-   Если пользователь перемещает курсор на другую кнопку, это меню немедленно появляется, а предыдущее меню исчезает.
-   Горячая трассировка меню остается активной до тех пор, пока пользователь не выберет команду или не щелкнет точку, которая не является частью области меню. Любое действие отключает горячее отслеживание меню до нажатия другой кнопки.
-   Если курсор перемещается из меню, текущее раскрывающееся меню остается до тех пор, пока курсор не будет перемещен обратно или пользователь щелкнет точку за пределами, область, выделенная в меню. Если курсор возвращается к другой кнопке, чем отображаемая в данный момент, то старое меню сворачивается и отображается новое меню.

С навигацией с помощью клавиатуры:

-   Клавиша со стрелкой вправо перемещает фокус вправо. Если у элемента есть подменю, отобразите подменю. Если элемент не имеет подменю, сверните меню и все подменю, активируйте кнопку Далее с [**ТБ в \_ сесотитем**](tb-sethotitem.md)и выведите меню для соседней кнопки. Если последняя кнопка активна при получении этого сообщения, отобразите меню для первой кнопки.
-   Клавиша со стрелкой влево перемещает фокус влево. Если элемент является подменю, сверните его и переместит фокус на его родительское меню. Если элемент не является подменю, сверните меню, активируйте кнопку Далее с [**ТБ \_ сесотитем**](tb-sethotitem.md)и выведите меню для этой кнопки.

<!-- -->

-   При нажатии клавиши ESCAPE отображается один шаг.
    -   Если подменю отображается, оно сворачивается и фокус перемещается в родительское меню.
    -   Если меню кнопки отображается, оно сворачивается и отключается горячее отслеживание меню. Кнопка элемента остается активной.
    -   Если меню не отображаются, но активна кнопка, кнопка становится неактивной, а «горячее» отслеживание отключено.
-   Клавиши Стрелка вверх и стрелка вниз используются только для навигации в определенном меню.
-   Клавиша ВВОД запускает команду, связанную с пунктом меню. Если у пункта меню есть подменю, клавиша ВВОД отображает его.

Как и в случае с отключенным режимом «горячее отслеживание», приложение должно иметь возможность обрабатывать мышь, клавиатуру и смешанную навигацию. Однако тот факт, что отображается меню, означает, что обмен сообщениями должен обрабатываться несколько иначе.

### <a name="message-processing-for-menu-hot-tracking"></a>Обработка сообщений для Hot-Tracking меню

Для горячего отслеживания меню требуется, чтобы меню отображалось в любое время, помимо короткого интервала, необходимого для переключения на новое меню. Однако раскрывающееся меню, отображаемое [**метод TrackPopupMenu**](/windows/desktop/api/winuser/nf-winuser-trackpopupmenu) , является модальным. Приложение будет по-прежнему отправлять некоторые сообщения, включая [**\_ команду WM**](/windows/desktop/menurc/wm-command), [ТБН \_ хотитемчанже](tbn-hotitemchange.md)и обычные сообщения, связанные с меню, такие как [**WM \_ менуселект**](/windows/desktop/menurc/wm-menuselect). Однако он не будет напрямую отправлять сообщения с клавиатурой или мышью с низким уровнем. Для обработки сообщений, таких как [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), необходимо установить обработчик сообщений для перехвата сообщений, направляемых в меню.

При отображении раскрывающегося меню задайте обработчик сообщений, вызвав функцию [**сетвиндовшукекс**](/windows/desktop/api/winuser/nf-winuser-setwindowshookexa) с параметром *идхук* , который имеет значение \_ мсгфилтер. Все сообщения, предназначенные для меню, будут переданы в [процедуру подключения](/previous-versions/windows/desktop/legacy/ms644987(v=vs.85)). Например, в следующем фрагменте кода задается обработчик сообщений, который будет выполнять перехват сообщений, передаваемых в раскрывающееся меню. `MsgHook` имя процедуры-обработчика, а `hhookMsg` — это обработчик процедуры.


```
hhookMsg = SetWindowsHookEx(WH_MSGFILTER, MsgHook, HINST_THISDLL, 0);
```



Сообщения меню идентифицируются путем установки параметра *нкоде* для процедуры-обработчика в \_ меню мсгф. Параметр *lParam* будет указывать на структуру [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) с сообщением. Сведения о том, какие сообщения необходимо обработать, и о том, как они обсуждаются в оставшейся части этого раздела.

Приложение должно передать все сообщения в следующий обработчик сообщений, вызвав функцию [**каллнекссукекс**](/windows/desktop/api/winuser/nf-winuser-callnexthookex) . Также необходимо отправить сообщения мыши непосредственно в элемент управления ToolBar, дополнив преобразование всех координат точек в клиентское пространство панели инструментов. Прямая отправка сообщений гарантирует, что элемент управления ToolBar получит соответствующие сообщения мыши. Например, панель инструментов должна получить сообщения [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) для горячей замены своих кнопок.

При активации новой кнопки приложение должно свернуть старое раскрывающееся меню с сообщением [**WM \_ канцелмоде**](/windows/desktop/winmsg/wm-cancelmode) и отобразить новое меню. Он также должен сворачивать раскрывающееся меню, когда фокус переводится из строки меню с помощью клавиш перемещения или щелчка вне области меню. Всякий раз при свертывании меню необходимо освободить его обработчик сообщений с помощью функции [**унхуквиндовшукекс**](/windows/desktop/api/winuser/nf-winuser-unhookwindowshookex) . Если необходимо отобразить другое раскрывающееся меню, создайте новый обработчик сообщений. При запуске команды меню будет свернуто автоматически, но необходимо явно освободить обработчик сообщений.

В следующем примере кода освобождается обработчик сообщений, который был задан в предыдущем примере.


```
UnhookWindowsHookEx(hhookMsg);
```



### <a name="mouse-navigation"></a>Навигация по мыши

Когда на обычной панели инструментов отображаются кнопки "горячая" Отслеживание, она выделяет активную кнопку и отправляет в приложение уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) при каждом активировании новой кнопки. Приложение отвечает за отображение соответствующего раскрывающегося меню. Оно должно:

-   Обработайте уведомление [ТБН \_ хотитемчанже](tbn-hotitemchange.md) , чтобы вести отслеживание активной кнопки. Когда активная кнопка изменится, сверните старое меню и создайте новое.
-   Обрабатывает уведомление [в \_ раскрывающемся списке ТБН](tbn-dropdown.md) , которое отправляется при нажатии кнопки. Затем следует свернуть меню и отключить горячее отслеживание меню. Кнопка остается активной.
-   Обрабатывайте сообщения [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown), [**WM \_ рбуттондовн**](/windows/desktop/inputdev/wm-rbuttondown)и [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) в процедуре обработчика сообщений, чтобы отследить расположение мыши. Если щелкнуть мышью за пределами области меню, свернуть текущее раскрывающееся меню, отключить горячее отслеживание меню и вернуть строку меню в состояние ее предактивации.
-   При запуске команды меню отключите функцию «горячее отслеживание». Меню будет свернуто автоматически, но необходимо явным образом освободить обработчик сообщений.

Также необходимо работать с сообщениями, связанными с меню, например с сообщением [**WM \_ инитменупопуп**](/windows/desktop/menurc/wm-initmenupopup) , которое отправляется, когда элементу меню нужно отобразить подменю. Обсуждение того, как обработано такие сообщения, см. в разделе [меню](/windows/desktop/menurc/menus).

### <a name="keyboard-navigation"></a>Навигация с помощью клавиатуры

Приложение должно обрабатывать сообщения клавиатуры в процедуре обработчика сообщений и действовать на тех, которые влияют на горячее отслеживание меню. Необходимо обработать следующие ключевые клавиши:

-   Клавиша ESCAPE. При нажатии клавиши ESCAPE отображается на один уровень вверх. Если подменю отображается, оно должно быть свернуто. Если основное меню кнопки отображается, сверните его и отключите функцию горячего отслеживания меню. Кнопка остается активной.
-   Клавиша СТРЕЛКА ВПРАВО. Если у элемента есть подменю, отобразите его. Если элемент не имеет подменю, сверните меню и все подменю, активируйте кнопку Далее с [**ТБ \_ сесотитем**](tb-sethotitem.md)и отобразите его меню. Если последняя кнопка была активна при получении уведомления, отобразите меню для первой кнопки.
-   Клавиша СТРЕЛКА ВЛЕВО. Если элемент находится в подменю, сверните его и переместите фокус на его родительское меню. Если элемент не является подменю, сверните меню, активируйте смежную кнопку с [**ТБ \_ сесотитем**](tb-sethotitem.md)и отобразите его меню. Если первая кнопка была активна при получении уведомления, отобразите меню последней кнопки.
-   Клавиши со стрелками вверх и вниз. Эти ключи используются для навигации в меню, но не влияют непосредственно на горячее отслеживание меню.
-   Сочетание клавиш ALT +*Клавиша* . Используйте сообщение [**\_ мапакцелератор ТБ**](tb-mapaccelerator.md) , чтобы определить, к какой кнопке соответствует символ *ключа* . Если она соответствует другой кнопке, а не активной в данный момент, сверните текущее раскрывающееся меню, активируйте кнопку New с [**ТБ \_ сесотитем**](tb-sethotitem.md)и выведите меню для соседней кнопки. Если *символ клавиши* соответствует отображаемой в данный момент кнопке, сверните раскрывающееся меню и отключите горячее отслеживание в меню. Кнопка должна оставаться активной.

 

 