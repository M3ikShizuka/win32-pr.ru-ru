---
title: Сведения об элементах управления Tree-View
description: Элемент управления "представление в виде дерева" — это окно, в котором отображается иерархический список элементов, например заголовки в документе, записи в индексе или файлы и каталоги на диске.
ms.assetid: 10cc7949-dd77-412d-bad1-db8d8a049582
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: df70a2d3c2f841b022930a07ee2f140ee5bfc8e3
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "103987942"
---
# <a name="about-tree-view-controls"></a>Сведения об элементах управления Tree-View

Элемент управления "представление в виде дерева" — это окно, в котором отображается иерархический список элементов, например заголовки в документе, записи в индексе или файлы и каталоги на диске. Каждый элемент состоит из метки и необязательного изображения точечного рисунка, и каждый элемент может иметь список связанных с ним подэлементов. Щелкнув элемент, пользователь может развернуть или свернуть связанный список подэлементов.

На следующем рисунке показан простой элемент управления представлением дерева с корневым узлом, развернутым узлом и свернутым узлом. Элемент управления использует одно растровое изображение для выбранного элемента и другое растровое изображение для других элементов.

![снимок экрана, отображающий пять узлов в иерархии; выбран текст одного узла, но узлы не связаны друг с другом по строкам.](images/tv-simple.png)

После создания элемента управления "дерево-представление" вы добавляете, удаляете, упорядочивайте или иным образом управляете элементами, отправляя сообщения в элемент управления. Каждое сообщение имеет один или несколько соответствующих макросов, которые можно использовать вместо отправки сообщения явным образом.

В этом разделе рассматриваются следующие темы.

-   [Стили представления в виде дерева](#tree-view-styles)
-   [Родительские и дочерние элементы](#parent-and-child-items)
-   [Метки элементов](#item-labels)
-   [Редактирование меток в виде дерева](#tree-view-label-editing)
-   [Позиция элемента представления в виде дерева](#tree-view-item-position)
-   [Общие сведения о состояниях элементов представления в виде дерева](#tree-view-item-states-overview)
-   [Выбор элементов](#item-selection)
-   [Сведения об элементе](#item-information)
-   [Древовидное представление списков изображений](#tree-view-image-lists)
-   [Операции перетаскивания](#drag-and-drop-operations)
-   [Сообщения с уведомлениями элемента управления представления в виде дерева](#tree-view-control-notification-messages)
-   [Обработка сообщений управления Tree-View по умолчанию](#default-tree-view-control-message-processing)
-   [См. также](#related-topics)

## <a name="tree-view-styles"></a>Стили Tree-View

Стили представления в виде дерева определяют аспекты внешнего вида элемента управления представления в виде дерева. Начальные стили задаются при создании элемента управления "дерево-представление". Стили можно извлечь и изменить после создания элемента управления "дерево-представление" с помощью функций [**жетвиндовлонг**](/windows/desktop/api/winuser/nf-winuser-getwindowlonga) и [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga) .

Стиль [**\_ хаслинес телевизоров**](tree-view-control-window-styles.md) улучшает графическое представление иерархии элемента управления иерархического представления, рисуя линии, связывающие дочерние элементы с родительским элементом, как показано на следующей иллюстрации.

![снимок экрана с предыдущим расположением, но со строками, соединяющимися с узлами; Первая строка в порядке убывания от корневого узла](images/tv-haslines.png)

Сам по себе этот стиль не рисует линии в корне иерархии. Для этого необходимо объединить стили [**\_ Хаслинес**](tree-view-control-window-styles.md) и [**телевизоры \_ линесатрут**](tree-view-control-window-styles.md) . Результат показан на следующем рисунке.

![снимок экрана с предыдущим расположением, но с дополнительной горизонтальной линией, ведущей к корневому узлу](images/tv-rootlines.png)

Пользователь может развернуть или свернуть список дочерних элементов родительского элемента, дважды щелкнув родительский элемент. Элемент управления представлением в виде дерева, имеющий стиль [**\_ хасбуттонс телевизоров**](tree-view-control-window-styles.md) , добавляет кнопку слева от каждого родительского элемента. Пользователь может нажать эту кнопку один раз вместо двойного щелчка родительского элемента, чтобы развернуть или свернуть дочерний элемент. **Телевизоры \_ ХАСБУТТОНС** не добавляет кнопки к элементам в корне иерархии. Для этого необходимо объединить [**телевизоры \_ хаслинес**](tree-view-control-window-styles.md), [**телевизоры \_ линесатрут**](tree-view-control-window-styles.md)и **телевизоры \_ хасбуттонс**. Это сочетание стилей показано на следующем рисунке.

![снимок экрана, отображающий предыдущее расположение, но с кнопками "развернуть/свернуть" на каждой вершине двух линий](images/tv-hasbuttons.png)

Стиль [**\_ флажков телевизоры**](tree-view-control-window-styles.md) создает флажки рядом с каждым элементом. Если вы хотите использовать стиль CheckBox, необходимо задать стиль **"телевизоры \_ "** (с [**SetWindowLong**](/windows/desktop/api/winuser/nf-winuser-setwindowlonga)) после создания элемента управления "дерево-представление" и перед заполнением дерева. В противном случае флажки в зависимости от временных проблем могут оказаться неустановленными. На следующем рисунке показан стиль CheckBox.

![снимок экрана, отображающий предыдущее расположение, но с флажком рядом с каждым узлом; выбраны два флажка](images/tv-haschecks.png)

Стиль " [**телевизоры \_ фуллровселект**](tree-view-control-window-styles.md) " приводит к выделению выделения для расширения всей ширины элемента управления, а не только для самого элемента. Этот стиль показан на следующем рисунке.

![снимок экрана с исходным расположением пяти узлов без линий, но выделение выделения расширяет всю ширину элемента управления](images/tv-fullrow.png)

Стиль [**\_ Едитлабелс для телевизоров**](tree-view-control-window-styles.md) позволяет пользователю изменять метки элементов древовидного представления. Дополнительные сведения об изменении меток см. в разделе [Редактирование меток в виде дерева](#tree-view-label-editing).

Дополнительные сведения об этих и других стилях см. в разделе [стили окна управления в виде дерева](tree-view-control-window-styles.md).

## <a name="parent-and-child-items"></a>Родительские и дочерние элементы

Любой элемент в элементе управления "дерево" может содержать список вложенных элементов, называемых *дочерними элементами*. Элемент с одним или несколькими дочерними элементами называется *родительским элементом*. Дочерний элемент отображается под родительским элементом и помещается с отступом, чтобы показать, что он является подчиненным для родительского элемента. Элемент, не имеющий родителя, отображается в верхней части иерархии и называется *корневым элементом*.

Чтобы добавить элемент в элемент управления представлением в виде дерева, отправьте сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) в элемент управления. Сообщение возвращает маркер типа ХТРИИТЕМ, который однозначно определяет элемент. При добавлении элемента необходимо указать этот маркер для родительского элемента нового элемента. Если  \_ вместо родительского маркера элемента в структуре [**твинсертструкт**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) указано значение null или Тви root, этот элемент добавляется в качестве корневого элемента.

В любой момент времени состояние списка дочерних элементов родительского элемента может быть либо развернутым, либо свернутым. Когда состояние разворачивается, дочерние элементы отображаются под родительским элементом. Когда он свернут, дочерние элементы не отображаются. Список автоматически переключается между развернутым и свернутым состояниями, когда пользователь дважды щелкает родительский элемент, или, если у родителя есть стиль [**\_ хасбуттонс**](tree-view-control-window-styles.md) , когда пользователь нажимает кнопку, связанную с родительским элементом. Приложение может развернуть или свернуть дочерние элементы с помощью сообщения [**TVM \_ expand**](tvm-expand.md) .

Элемент управления представлением в виде дерева отправляет родительскому окну сообщение уведомления [ТВН \_ итемекспандинг](tvn-itemexpanding.md) , когда список дочерних элементов родительского элемента будет развернут или свернут. Уведомление дает приложению возможность предотвратить изменение или задать любые атрибуты родительского элемента, зависящие от состояния списка дочерних элементов. После изменения состояния списка элемент управления представлением дерева отправляет родительскому окну сообщение уведомления [ТВН \_ итемекспандед](tvn-itemexpanded.md) .

Когда список дочерних элементов разворачивается, он располагается с отступом относительно родительского элемента. Можно задать величину отступов с помощью сообщения [**TVM \_ сетиндент**](tvm-setindent.md) или получить текущую сумму с помощью сообщения [**TVM \_ Indent**](tvm-getindent.md) .

Элемент управления "представление в виде дерева" использует память, выделенную из кучи процесса, который создает элемент управления "дерево-представление". Максимальное число элементов в представлении в виде дерева зависит от объема памяти, доступной в куче.

## <a name="item-labels"></a>Метки элементов

Обычно текст метки элемента задается при добавлении элемента к элементу управления "дерево-представление". Сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) содержит структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) , определяющую свойства элемента, включая строку, содержащую текст метки.

Элемент управления "дерево-представление" выделяет память для хранения каждого элемента; текст меток элементов занимает значительную часть этой памяти. Если приложение сохраняет копию строк в элементе управления "дерево-представление", можно уменьшить требования к памяти элемента управления, указав \_ значение LPSTR тексткаллбакк в элементе **псзтекст** [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) вместо передачи фактических строк в представление в виде дерева. Использование LPSTR \_ тексткаллбакк приводит к тому, что элемент управления "представление дерева" получает текст метки элемента из родительского окна каждый раз, когда необходимо перерисовать элемент. Чтобы получить текст, элемент управления "представление дерева" отправляет сообщение уведомления [ТВН \_ жетдиспинфо](tvn-getdispinfo.md) , которое включает адрес структуры [**нмтвдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) . Родительское окно должно заполнить соответствующие члены включаемой структуры.

## <a name="tree-view-label-editing"></a>Изменение меток Tree-View

Пользователь может непосредственно изменять метки элементов в элементе управления "дерево", имеющем стиль [**\_ едитлабелс**](tree-view-control-window-styles.md) . Пользователь начинает редактирование, щелкая метку элемента, который находится в фокусе. Приложение начинает редактирование с помощью сообщения [**TVM \_ едитлабел**](tvm-editlabel.md) . Элемент управления просмотром дерева уведомляет родительское окно при начале редактирования, а также при его отмене или завершении. По завершении редактирования родительское окно отвечает за обновление метки элемента, если это уместно.

Когда начинается редактирование метки, элемент управления "представление дерева" отправляет свое родительское окно сообщение уведомления [ТВН \_ бегинлабеледит](tvn-beginlabeledit.md) . Обрабатывая это уведомление, приложение может разрешить редактирование некоторых меток и запретить редактирование других. Возврат нуля позволяет изменять и возвращать ненулевой запрет.

Когда изменение метки отменено или завершено, элемент управления "представление дерева" отправляет свое родительское окно сообщение уведомления [ТВН \_ ендлабеледит](tvn-endlabeledit.md) . Параметр *lParam* является адресом структуры [**нмтвдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmtvdispinfoa) . Параметр *Item* представляет собой структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) , определяющую элемент и включающую редактируемый текст. Родительское окно отвечает за обновление метки элемента, если требуется разместить новую метку. Элемент **псзтекст** объекта **твитем** равен нулю, если редактирование отменено.

Во время редактирования метки, как правило, в ответ на сообщение уведомления [ТВН \_ бегинлабеледит](tvn-beginlabeledit.md) , можно получить маркер элемента управления редактирования, используемого для редактирования меток, с помощью сообщения [**TVM \_ жетедитконтрол**](tvm-geteditcontrol.md) . Вы можете отправить сообщение с элементом управления [**Edit \_ сетлимиттекст**](em-setlimittext.md) , чтобы ограничить объем текста, который пользователь может ввести или создать подкласс элемента управления "поле ввода" для перехвата и удаления недопустимых символов. Однако обратите внимание, что элемент управления "поле ввода" отображается только *после*   \_ отправки ТВН бегинлабеледит.

## <a name="tree-view-item-position"></a>Позиция Tree-View элемента

Начальная позиция элемента задается при добавлении элемента в элемент управления "дерево" с помощью сообщения [**\_ INSERTITEM TVM**](tvm-insertitem.md) . Сообщение содержит структуру [**твинсертструкт**](/windows/win32/api/commctrl/ns-commctrl-tvinsertstructa) , указывающую маркер родительского элемента, и маркер элемента, после которого вставляется новый элемент. Второй маркер должен обозначать либо дочерний элемент данного родителя, либо одно из следующих значений: Тви \_ First, Тви \_ Last или Тви \_ Sort.

Если указан параметр Тви \_ First или Тви \_ Last, элемент управления "представление дерева" помещает новый элемент в начало или в конец данного списка дочерних элементов родительского элемента. Если указан параметр Тви \_ Sort, элемент управления "представление дерева" вставляет новый элемент в список дочерних элементов в алфавитном порядке в зависимости от текста меток элемента.

Вы можете вставить список дочерних элементов родительского элемента в алфавитном порядке, используя сообщение [**TVM \_ сортчилдрен**](tvm-sortchildren.md) . Сообщение содержит параметр, указывающий, сортируются ли все уровни дочерних элементов в порядке убывания из заданного родительского элемента в алфавитном порядке.

Сообщение [**TVM \_ сортчилдренкб**](tvm-sortchildrencb.md) позволяет сортировать дочерние элементы на основе заданных критериев. При использовании этого сообщения вы указываете функцию обратного вызова, определяемую приложением, которую элемент управления "дерево" может вызывать каждый раз, когда необходимо выбрать относительный порядок двух дочерних элементов. Функция обратного вызова получает 2 32-разрядные значения, определяемые приложением, для сравниваемых элементов и третье 32-разрядное значение, указанное при отправке **TVM \_ сортчилдренкб**.

## <a name="tree-view-item-states-overview"></a>Общие сведения о состояниях элементов Tree-View

Каждый элемент в элементе управления иерархического представления имеет текущее состояние. Сведения о состоянии для каждого элемента включают набор битовых флагов, а также индексы списка изображений, которые указывают изображение состояния элемента и изображение оверлея. Битовые флаги указывают, что элемент выбран, отключен, развернут и т. д. В большинстве случаев элемент управления "представление в виде дерева" автоматически задает состояние элемента для отражения действий пользователя, таких как выборка элемента. Тем не менее можно также задать состояние элемента с помощью сообщения [**TVM \_ сетитем**](tvm-setitem.md) , а также получить текущее состояние элемента с помощью сообщения о [**\_ дозаписи TVM**](tvm-getitem.md) . Полный список состояний элементов см. в разделе [дерево-представление элементов управления](tree-view-control-item-states.md).

Текущее состояние элемента задается элементом **State** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) . Элемент управления "представление дерева" может изменить состояние элемента в соответствии с действиями пользователя, например выбрать элемент или установить фокус на элемент. Кроме того, приложение может изменить состояние элемента, чтобы отключить или скрыть элемент или указать изображение оверлея или изображение состояния.

При указании или изменении состояния элемента элемент **статемаск** элемента [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) указывает, какие биты состояния задаются, а элемент **State** содержит новые значения для этих битов.

Чтобы задать изображение оверлея элемента, **статемаск** должно включать значение [**ТВИС \_ оверлаймаск**](tree-view-control-item-states.md) , а **State** должно включать Отсчитываемый от единицы индекс перекрытия изображения, смещенный влево 8 бит, с помощью макроса [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) . Индекс может быть равен нулю, чтобы не указывать изображение оверлея.

Изображение состояния отображается рядом со значком элемента для указания на определенное приложением состояние. Изображения состояния содержатся в *списке изображений состояний* , который указывается путем отправки сообщения [**\_ сетимажелист TVM**](tvm-setimagelist.md) . Чтобы задать изображение состояния элемента, включите значение [**ТВИС \_ статеимажемаск**](tree-view-control-item-states.md) в элемент **статемаск** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) . В битах с 12 по 15 элемента **состояния** структуры указывается индекс в списке изображений состояния изображения для прорисовки.

Чтобы задать индекс изображения состояния, используйте [**индекстостатеимажемаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextostateimagemask). Этот макрос принимает индекс и устанавливает биты 12 – 15 соответствующим образом. Чтобы указать, что элемент не имеет изображения состояния, установите нулевое значение индекса. Это означает, что нулевой образ в списке изображений состояния нельзя использовать в качестве изображения состояния. Чтобы изолировать BITS 12 – 15 от члена **состояния** , используйте маску [**ТВИС \_ статеимажемаск**](tree-view-control-item-states.md) . Дополнительные сведения о наложении и образах состояний см. в разделе [древовидное представление списков изображений](#tree-view-image-lists).

## <a name="item-selection"></a>Выбор элементов

Элемент управления представлением в виде дерева уведомляет родительское окно о том, что при изменении выбора с одного элемента на другой отправляются сообщения уведомления [ТВН \_ Селчангинг](tvn-selchanging.md) и [ТВН \_ селчанжед](tvn-selchanged.md) . Оба уведомления включают значение, указывающее, является ли изменение результатом щелчка мыши или нажатия клавиши. Уведомления также содержат сведения об элементе, который получает выделение, и элементе, который теряет выделение. Эти сведения можно использовать для задания атрибутов элементов, зависящих от состояния выбора элемента. При возврате значения **true** в ответ на ТВН \_ селчангинг предотвращает изменение выбора, а возврат значения **false** позволяет изменить.

Приложение может изменить выбор, отправив сообщение [**TVM \_ селектитем**](tvm-selectitem.md) .

## <a name="item-information"></a>Сведения об элементе

Элементы управления "дерево-представление" поддерживают ряд сообщений, которые извлекают сведения об элементах в элементе управления.

Сообщение [**TVM \_ доitem**](tvm-getitem.md) может извлекать маркеры и атрибуты элемента. Атрибуты элемента включают в себя его текущее состояние, индексы в списке изображений элемента управления для выбранных и невыбранных растровых изображений, флаг, указывающий, имеет ли элемент дочерние элементы, адрес строки метки элемента и определяемое приложением 32-разрядное значение.

Сообщение [**TVM \_ жетнекститем**](tvm-getnextitem.md) извлекает элемент дерева-представления, который несет указанную связь с текущим элементом. Сообщение может получить родительский элемент, следующий или предыдущий видимый элемент, первый дочерний элемент и т. д.

Сообщение [**TVM \_ жетитемрект**](tvm-getitemrect.md) извлекает ограничивающий прямоугольник для элемента представления дерева. Сообщения [**TVM \_ NOCOUNT**](tvm-getcount.md) и [**TVM \_ жетвисиблекаунт**](tvm-getvisiblecount.md) извлекают количество элементов в элементе управления "дерево-представление" и число элементов, которые могут быть полностью видны в окне элемента управления "дерево-представление" соответственно. Вы можете убедиться, что конкретный элемент виден с помощью сообщения [**TVM \_ енсуревисибле**](tvm-ensurevisible.md) .

## <a name="tree-view-image-lists"></a>Tree-View списки изображений

Каждый элемент в элементе управления "дерево" может связываться с четырьмя изображениями с точечным рисунком.

-   Изображение, например открытая папка, отображаемое при выборе элемента.
-   Изображение, например закрытая папка, отображаемое, если элемент не выбран.
-   Изображение оверлея, которое прозрачно рисуется над выбранным или невыбранным изображением.
-   Изображение состояния, которое является дополнительным изображением, отображаемым слева от выбранного или невыделенного изображения. Для обозначения состояний элементов, определенных приложением, можно использовать изображения состояний, например флажки установлен и снят.

По умолчанию элемент управления "представление дерева" не отображает изображения элементов. Чтобы отобразить изображения элементов, необходимо создать списки изображений и связать их с элементом управления. Дополнительные сведения о списках изображений см. в разделе [Image Lists](image-lists.md).

Элемент управления "дерево" может иметь два списка изображений: нормальный список изображений и список изображений состояния. В стандартном списке изображений хранятся выбранные, невыбранные изображения и наложения. В списке изображений состояний хранятся образы состояний. Используйте функцию [**ImageList \_ CREATE**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_create) для создания списка изображений и используйте другие функции списка изображений для добавления точечных рисунков в список изображений. Затем, чтобы связать список изображений с элементом управления "дерево-представление", используйте сообщение [**TVM \_ сетимажелист**](tvm-setimagelist.md) . Сообщение [**TVM- \_ ImageList**](tvm-getimagelist.md) Извлекает маркер одного из списков изображений элемента управления представления в виде дерева. Это сообщение полезно, если необходимо добавить дополнительные изображения в список.

В дополнение к выбранным и невыбранным изображениям список обычных изображений элемента управления "дерево" может содержать до четырех изображений оверлея. Изображения наложения идентифицируются с помощью индекса, основанного на единицах, и предназначены для прозрачного рисования на выбранных и невыбранных изображениях. Чтобы назначить изображение маски оверлея изображению в списке обычного изображения, вызовите функцию [**ImageList \_ сетоверлайимаже**](/windows/desktop/api/Commctrl/nf-commctrl-imagelist_setoverlayimage) .

По умолчанию все элементы отображают первое изображение в списке обычные изображения для выбранных и невыбранных состояний. Кроме того, по умолчанию элементы не отображают изображения наложения или изображения состояния. Вы можете изменить поведение по умолчанию для элемента, отправив сообщение [**TVM \_ INSERTITEM**](tvm-insertitem.md) или [**TVM \_ сетитем**](tvm-setitem.md) . Эти сообщения используют структуру [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) для указания индексов списка изображений для элемента.

Чтобы указать выбранные и невыбранные изображения элемента, задайте \_ биты изображения твиф селектедимаже и твиф в элементе \_ **Mask** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) и укажите индексы из списка обычных изображений элемента управления в члене **иселектимаже** и **иимаже** . Кроме того, можно указать значение I \_ имажекаллбакк в **Иселектимаже** и **иимаже** вместо указания индексов. Это приводит к тому, что элемент управления запрашивает у родительского окна индекс списка изображений при каждом перерисовке элемента. Элемент управления отправляет сообщение уведомления [ТВН \_ жетдиспинфо](tvn-getdispinfo.md) для получения индекса.

Чтобы связать изображение оверлея с элементом, используйте макрос [**индекстуверлаймаск**](/windows/desktop/api/Commctrl/nf-commctrl-indextooverlaymask) , чтобы указать индекс маски оверлея в элементе **State** структуры [**твитем**](/windows/win32/api/commctrl/ns-commctrl-tvitema) элемента. Необходимо также задать биты [**ТВИС \_ оверлаймаск**](tree-view-control-item-states.md) в элементе **статемаск** . Индексы-маски наложения основаны на единицах; нулевой индекс означает, что изображение оверлея не указано.

Образы состояния хранятся в отдельном списке изображений состояний и определяются по их индексу. Чтобы указать список изображений состояния, отправьте сообщение [**TVM \_ сетимажелист**](tvm-setimagelist.md) . В отличие от элемента управления "представление списка", использующего Отсчитываемый от единицы индекса для идентификации изображений состояния, изображения состояния элемента управления "дерево" определяются индексом, начинающимся с нуля. Однако нулевой индекс указывает, что элемент не имеет изображения состояния. Следовательно, нулевое изображение не может использоваться в качестве изображения состояния. Дополнительные сведения о состояниях элементов и образах состояний см. в статье [Обзор состояний элементов в виде дерева](#tree-view-item-states-overview).

## <a name="drag-and-drop-operations"></a>Операции перетаскивания

Элемент управления просмотром дерева уведомляет родительское окно, когда пользователь начинает перетаскивать элемент. Родительское окно получает сообщение уведомления [ТВН \_ бегиндраг](tvn-begindrag.md) , когда пользователь начинает перетаскивать элемент с помощью левой кнопки мыши и сообщения уведомления [ТВН \_ бегинрдраг](tvn-beginrdrag.md) , когда пользователь начинает перетаскивать с помощью правой кнопки мыши. Можно предотвратить отправку таких уведомлений элементом управления "дерево-представление", предоставив элемент управления "дерево" в стиле [**\_ дисабледрагдроп**](tree-view-control-window-styles.md) .

Вы получаете изображение, которое будет отображаться во время операции перетаскивания с помощью сообщения [**TVM \_ креатедрагимаже**](tvm-createdragimage.md) . Элемент управления "дерево" создает перетаскивание растрового изображения на основе метки перетаскиваемого элемента. Затем элемент управления "дерево" создает список изображений, добавляет к нему растровое изображение и возвращает этот маркер в список изображений.

Необходимо указать код, который будет перетаскивать элемент. Обычно это касается использования возможностей перетаскивания в списке изображений и обработки сообщений [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) и [**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup) (или [**WM \_ рбуттонуп**](/windows/desktop/inputdev/wm-rbuttonup)), отправленных в родительское окно после начала операции перетаскивания.

Если элементы в элементе управления "дерево" являются целевыми объектами операций перетаскивания, необходимо знать, когда указатель мыши находится на целевом элементе. Вы можете узнать с помощью сообщения [**TVM \_ HITTEST**](tvm-hittest.md) . Вы указываете адрес структуры [**твхиттестинфо**](/windows/win32/api/commctrl/ns-commctrl-tvhittestinfo) , которая содержит текущие координаты указателя мыши. Когда функция [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) возвращает, структура содержит флаг, указывающий расположение указателя мыши относительно элемента управления "дерево-представление". Если указатель находится над элементом в элементе управления "дерево-представление", структура также содержит этот маркер элемента.

Можно указать, что элемент является целевым объектом операции перетаскивания с помощью сообщения [**TVM \_ сетитем**](tvm-setitem.md) , чтобы установить для состояния значение [**ТВИС \_ дрофилитед**](tree-view-control-item-states.md) . Элемент с этим состоянием рисуется в стиле, который указывает на цель перетаскивания.

## <a name="tree-view-control-notification-messages"></a>Tree-View контрольных сообщений

Элемент управления "представление в виде дерева" отправляет следующие сообщения уведомления родительскому окну в форме [**\_ уведомлений WM**](wm-notify.md) .



| Уведомление                                    | Описание                                                                            |
|-------------------------------------------------|----------------------------------------------------------------------------------------|
| [ТВН \_ бегиндраг](tvn-begindrag.md)             | Сигнализирует о начале операции перетаскивания.                                        |
| [ТВН \_ бегинлабеледит](tvn-beginlabeledit.md)   | Сигнализирует начало редактирования метки на месте.                                           |
| [ТВН \_ бегинрдраг](tvn-beginrdrag.md)           | Сигнализирует, что при нажатии правой кнопки мыши была запущена операция перетаскивания.             |
| [ТВН \_ DELETEITEM](tvn-deleteitem.md)           | Сообщает об удалении определенного элемента.                                               |
| [ТВН \_ ендлабеледит](tvn-endlabeledit.md)       | Сообщает об окончании редактирования метки.                                                      |
| [ТВН \_ жетдиспинфо](tvn-getdispinfo.md)         | Запрашивает сведения, необходимые элементу управления "дерево-представление" для отображения элемента.           |
| [ТВН \_ итемекспандед](tvn-itemexpanded.md)       | Сигнализирует, что список дочерних элементов родительского элемента был развернут или свернут.            |
| [ТВН \_ итемекспандинг](tvn-itemexpanding.md)     | Сигнализирует, что список дочерних элементов родительского элемента будет развернут или свернут. |
| [ТВН \_ KeyDown](tvn-keydown.md)                 | Сигнализирует о событии клавиатуры.                                                              |
| [ТВН \_ селчанжед](tvn-selchanged.md)           | Сигнализирует, что выделение изменилось с одного элемента на другой.                       |
| [ТВН \_ селчангинг](tvn-selchanging.md)         | Сигнализирует о том, что выбор будет изменен с одного элемента на другой.            |
| [ТВН \_ сетдиспинфо](tvn-setdispinfo.md)         | Уведомляет родительское окно о том, что необходимо обновить сведения, которые он поддерживает для элемента. |



 

## <a name="default-tree-view-control-message-processing"></a>Обработка сообщений управления Tree-View по умолчанию

В этом разделе описывается обработка сообщений окна, выполняемая элементом управления "дерево-представление". Сообщения, относящиеся к элементам управления "дерево-представление", обсуждаются в других разделах этого документа, поэтому они не включаются здесь.



| Сообщение                                            | Обработка выполнена                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**\_команда WM**](/windows/desktop/menurc/wm-command)               | Обрабатывает сообщения уведомления элемента управления " [en \_ Update](en-update.md) " и " [en \_ киллфокус](en-killfocus.md) Edit" и пересылает все остальные уведомления об изменении элемента управления в родительское окно. Возвращаемое значение отсутствует.                                                                                                                                                                                                                                                                                                |
| [**\_Создание WM**](/windows/desktop/winmsg/wm-create)                 | Выделяет память и инициализирует внутренние структуры данных. При успешном выполнении возвращается нуль, или значение-1 в противном случае.                                                                                                                                                                                                                                                                                                                                                                                                          |
| [**WM \_ destroy**](/windows/desktop/winmsg/wm-destroy)               | Освобождает все системные ресурсы, связанные с элементом управления. Он возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| [**\_Включение WM**](/windows/desktop/winmsg/wm-enable)                 | Включает или отключает элемент управления.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| [**WM \_ ерасебкгнд**](/windows/desktop/winmsg/wm-erasebkgnd)         | Стирает фон окна, используя текущий цвет фона для элемента управления "дерево-представление". Он возвращает **значение true**.                                                                                                                                                                                                                                                                                                                                                                                                     |
| [**WM \_ жетдлгкоде**](/windows/desktop/dlgbox/wm-getdlgcode)         | Возвращает сочетание \_ значений длгк вантарровс и длгк \_ вантчарс.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| [**WM, \_ Шрифт**](/windows/desktop/winmsg/wm-getfont)               | Возвращает маркер для текущего шрифта метки.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| [**WM \_ HSCROLL**](wm-hscroll.md)                  | Выполняет прокрутку элемента управления "дерево-представление". Он возвращает **значение true** , если выполняется прокрутка, или **false** в противном случае.                                                                                                                                                                                                                                                                                                                                                                                                                     |
| [**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown)             | Отправляет сообщение уведомления [ТВН \_ KeyDown](tvn-keydown.md) в родительское окно для всех ключей. Отправляет уведомление [о \_ возврате (представление в виде дерева)](nm-return-tree-view-.md) , когда пользователь нажимает клавишу ВВОД. Он перемещает курсор, когда пользователь нажимает клавиши со стрелками или вверх, на страницу вниз, в начало, конец или на клавишу BACKSPACE. Элемент управления "дерево" прокручивается, когда пользователь нажимает клавишу CTRL в сочетании с этими клавишами. Он возвращает **значение true** , если ключ обрабатывается, или **значение false** в противном случае. |
| [**WM \_ киллфокус**](/windows/desktop/inputdev/wm-killfocus)         | Перерисовывает элемент с упором, если он есть, и отправляет в родительское окно сообщение с уведомлением о [ \_ киллфокус (представление в виде дерева)](nm-killfocus-tree-view.md) .                                                                                                                                                                                                                                                                                                                                                                  |
| [**WM \_ лбуттондблклк**](/windows/desktop/inputdev/wm-lbuttondblclk) | Отменяет правку метки и, если элемент был двойным щелчком мыши, отправляет в родительское окно сообщение с уведомлением [NM \_ дблклк (представление в виде дерева)](nm-dblclk-tree-view.md) . Если родительское окно возвращает 0, элемент управления "представление дерева" переключает развернутое состояние элемента, отправляя родительское окно сообщения уведомления [ТВН \_ Итемекспандинг](tvn-itemexpanding.md) и [ТВН \_ итемекспандед](tvn-itemexpanded.md) . Возвращаемое значение отсутствует.                                                                             |
| [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown)     | Переключает развернутое состояние, если пользователь щелкнул кнопку, связанную с родительским элементом. Если пользователь щелкнул метку элемента, элемент управления "представление дерева" выбирает и устанавливает фокус на элемент. Если пользователь перемещает мышь перед отправкой кнопки мыши, элемент управления "представление дерева" начинает операцию перетаскивания. Возвращаемое значение отсутствует.                                                                                                                                                                          |
| [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)                      | Закрашивает недействительную область элемента управления "дерево-представление". Он возвращает ноль. Если параметр *wParam* не равен **null**, то элемент управления предполагает, что значение является обработчиком контекста устройства (HDC) и рисует его с помощью контекста этого устройства.                                                                                                                                                                                                                                                                                      |
| [**WM \_ рбуттондовн**](/windows/desktop/inputdev/wm-rbuttondown)     | Проверяет, была ли нажата кнопка, и начинается операция перетаскивания. Если операция началась, она отправляет сообщение уведомления [ТВН \_ бегинрдраг](tvn-beginrdrag.md) в родительское окно и выделяет цель перетаскивания. В противном случае он отправляет в родительское окно сообщение с уведомлением [NM \_ ркликк (представление в виде дерева)](nm-rclick-tree-view.md) . Возвращаемое значение отсутствует.                                                                                                                                           |
| [**WM \_ SETFOCUS**](/windows/desktop/inputdev/wm-setfocus)           | Перерисовывает элемент с отправкой, если он есть, и отправляет в родительское окно сообщение уведомления о [NM \_ SETFOCUS](nm-setfocus.md) .                                                                                                                                                                                                                                                                                                                                                                                          |
| [**WM \_ сетфонт**](/windows/desktop/winmsg/wm-setfont)               | Сохраняет заданный маркер шрифта и перерисовывает элемент управления "дерево-представление" с помощью нового шрифта.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| [**WM \_ сетредрав**](/windows/desktop/gdi/wm-setredraw)              | Задает или очищает флаг перерисовки. После установки флага перерисовки элемент управления представлением в виде дерева перерисовывается. Он возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                     |
| [**\_Размер WM**](/windows/desktop/winmsg/wm-size)                     | Пересчитывает внутренние переменные, зависящие от размера клиентской области элемента управления "дерево-представление". Он возвращает **значение true**.                                                                                                                                                                                                                                                                                                                                                                                                  |
| [**WM \_ стилечанжед**](/windows/desktop/winmsg/wm-stylechanged)     | Отменяет изменение метки и перерисовывает элемент управления "дерево-представление" с помощью новых стилей. Он возвращает ноль.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| [**WM \_ сисколорчанже**](/windows/desktop/gdi/wm-syscolorchange)    | Перерисовывает элемент управления "дерево-представление", используя новый цвет, если установлен флаг перерисовки. Возвращаемое значение отсутствует.                                                                                                                                                                                                                                                                                                                                                                                                              |
| [**\_таймер WM**](/windows/desktop/winmsg/wm-timer)                   | Начинает редактирование метки элемента. Если пользователь щелкает метку элемента с заголовком, элемент управления "представление дерева" устанавливает таймер вместо того, чтобы сразу перейти в режим редактирования. Таймер делает возможным представление в виде дерева, чтобы избежать входа в режим редактирования, если пользователь дважды щелкнет метку. Он возвращает ноль.                                                                                                                                                                                                                       |
| [**WM \_ VSCROLL**](wm-vscroll.md)                  | Выполняет прокрутку элемента управления "дерево-представление". Он возвращает **значение true** , если выполняется прокрутка, или **false** в противном случае.                                                                                                                                                                                                                                                                                                                                                                                                                     |



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Пример: Кустдтв демонстрирует пользовательское рисование в TreeView (Q248496)](https://support.microsoft.com/default.aspx?scid=kb;EN-US;q248496)
</dt> </dl>

 

 