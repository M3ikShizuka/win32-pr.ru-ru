---
title: Сведения о списках
description: В этом разделе описываются функции списка.
ms.assetid: 359bb363-5b97-4e0c-bdc4-bfa6a6504a76
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 674712226a79960e44ab99ed8e59c88b27984efb
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104488325"
---
# <a name="about-list-boxes"></a>Сведения о списках

Элемент управления "список" содержит простой список, из которого пользователь обычно может выбрать один или несколько элементов. Списки предоставляют ограниченную гибкость по сравнению с элементами управления " [представление списка](list-view-control-reference.md) ".

Элементы списка могут быть представлены текстовой строкой, точечными рисунками или обоими. Если список недостаточно велик для одновременного отображения всех элементов списка, в поле со списком отображается полоса прокрутки. Пользователь прокручивает список элементов списка и применяет или удаляет состояние выбора по мере необходимости. Выбор элемента списка изменяет его внешний вид, обычно изменяя цвета текста и фона на значения, указанные соответствующими метриками операционной системы. Когда пользователь выбирает или отменяет выбор элемента, система отправляет сообщение уведомления родительскому окну списка.

Для приложения ANSI система преобразует текст в поле со списком в Юникод, используя кодовую страницу **CP \_ ACP** . Это может вызвать проблемы. Например, римские символы с диакритическими знаками в списке не в Юникоде в Windows, версия для японского языка будет нечитаемой. Чтобы устранить эту проблему, либо скомпилируйте приложение как Юникод, либо используйте список, рисуемый владельцем.

В этом разделе рассматриваются следующие темы:

-   [Создание списка](#creating-a-list-box)
-   [Типы и стили списка](#list-box-types-and-styles)
-   [Функции списка](#list-box-functions)
-   [Сообщения уведомлений из списков](#notification-messages-from-list-boxes)
-   [Сообщения в списки](#notification-messages-from-list-boxes)
-   [Обработка сообщений окна по умолчанию](#default-window-message-processing)
-   [Списки, рисуемые владельцем](#owner-drawn-list-boxes)
-   [Перетаскивать списки](#drag-list-boxes)
    -   [Создание списков перетаскивания](#creating-drag-list-boxes)
    -   [Перетаскивать сообщения из списка](#drag-list-box-messages)
    -   [Перетаскивать коды уведомлений списка](#drag-list-box-notification-codes)

## <a name="creating-a-list-box"></a>Создание списка

Самый простой способ создать поле со списком в диалоговом окне — это перетащить его из области элементов в Microsoft Visual Studio в ресурс диалогового окна. Чтобы динамически создать окно списка или создать список в окне, отличном от диалогового окна, используйте функцию [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) , указав класс окна [**\_ ListBox WC**](common-control-window-classes.md) и соответствующие [стили списка](list-box-styles.md).

## <a name="list-box-types-and-styles"></a>Типы и стили списка

Существует два типа списков: одиночный выбор (по умолчанию) и множественный выбор. В списке с одним выбором пользователь может выбрать только один элемент за раз. В списке с множественным выбором пользователь может одновременно выбрать несколько элементов. Чтобы создать список с множественным выбором, укажите [**\_ мултиплесел фунта**](list-box-styles.md) или [**фунт \_ екстендедсел**](list-box-styles.md) .

Внешний вид и операция со списком определяются [стилями окна списка](list-box-styles.md) и стилями окон. Эти стили указывают, отсортирован ли список, упорядочены по нескольким столбцам, нарисованы приложением и т. д. Измерения и стили списка обычно определяются в шаблоне диалогового окна, который включен в ресурсы приложения.

> [!Note]  
> Чтобы использовать стили оформления с этими элементами управления, приложение должно включать манифест и вызывать [**иниткоммонконтролс**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrols) в начале программы. Сведения о визуальных стилях см. в разделе [стили визуальных](themes-overview.md)элементов. Дополнительные сведения о манифестах см. в разделе [Включение визуальных стилей](cookbook-overview.md).

 

## <a name="list-box-functions"></a>Функции списка

Функция [**длгдирлист**](/windows/desktop/api/Winuser/nf-winuser-dlgdirlista) заменяет содержимое списка именами дисков, каталогов и файлов, которые соответствуют заданному набору критериев. Функция [**длгдирселектекс**](/windows/desktop/api/Winuser/nf-winuser-dlgdirselectexa) извлекает текущее выделение в поле со списком, которое инициализируется с помощью **длгдирлист**. Эти функции позволяют пользователю выбрать диск, каталог или файл из списка, не вводя расположение и имя файла.

Кроме того, функция [**жетлистбоксинфо**](/windows/desktop/api/Winuser/nf-winuser-getlistboxinfo) возвращает количество элементов на столбец в указанном списке.

## <a name="notification-messages-from-list-boxes"></a>Сообщения уведомлений из списков

При возникновении события в списке Список отправляет код уведомления в виде [**\_ командного сообщения WM**](/windows/desktop/menurc/wm-command) в процедуру диалогового окна в окне владельца. Коды уведомления в списке отправляются, когда пользователь выбирает, дважды щелкает или отменяет элемент списка. когда окно списка получает или теряет фокус клавиатуры; и когда системе не удается выделить достаточно памяти для запроса окна списка. **\_ Командное сообщение WM** содержит идентификатор списка в младшем слове параметра *wParam* и код уведомления в слове с высоким порядком. Параметр *lParam* содержит маркер окна элемента управления.

Для обработки этих сообщений не требуется процедура диалогового окна; Процедура окна по умолчанию обрабатывает их.

Приложение должно отслеживать и обрабатывать следующие коды уведомлений списка.



| Код уведомления                   | Описание                                                      |
|-------------------------------------|------------------------------------------------------------------|
| [ЛБН \_ дблклк](lbn-dblclk.md)       | Пользователь дважды щелкает элемент в списке.                  |
| [ЛБН \_ еррспаце](lbn-errspace.md)   | Список не может выделить достаточно памяти для выполнения запроса. |
| [ЛБН \_ киллфокус](lbn-killfocus.md) | Поле со списком теряет фокус клавиатуры.                           |
| [ЛБН \_ селканцел](lbn-selcancel.md) | Пользователь отменяет выбор элемента в списке.       |
| [ЛБН \_ селчанже](lbn-selchange.md) | Выбор в окне списка собирается измениться.                  |
| [ЛБН \_ SETFOCUS](lbn-setfocus.md)   | Окно списка получает фокус клавиатуры.                        |



 

## <a name="messages-to-list-boxes"></a>Сообщения в списки

Процедура диалогового окна может отправить сообщения в список для добавления, удаления, проверки и изменения элементов списка. Например, процедура диалогового окна может отправить сообщение [**\_ ADDSTRINGа балансировки нагрузки**](lb-addstring.md) в список для добавления элемента и сообщение [**\_ жетсел балансировки нагрузки**](lb-getsel.md) , чтобы определить, выбран ли элемент. Другие сообщения задают и извлекают сведения о размере, внешнем виде и поведении списка. Например, сообщение [**\_ сесоризонталекстент балансировки нагрузки**](lb-sethorizontalextent.md) задает ширину прокручиваемого поля списка. Процедура диалогового окна может отправить любое сообщение в поле со списком с помощью функции [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage) или [**сенддлгитеммессаже**](/windows/desktop/api/winuser/nf-winuser-senddlgitemmessagea) .

На элемент списка часто ссылается его *индекс*— целое число, представляющее позицию элемента в списке. Индекс первого элемента в поле со списком равен 0, индекс второго элемента — 1 и т. д.

В следующей таблице показано, как предопределенное окно списка реагирует на сообщения списка.



| Сообщение                                                   | Ответ                                                                                                                                                                                                                         |
|-----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**ADDFILE балансировки нагрузки \_**](lb-addfile.md)                         | Вставляет файл в список каталогов, заполненный функцией [**длгдирлист**](/windows/desktop/api/Winuser/nf-winuser-dlgdirlista) , и получает индекс поля списка вставленного элемента.                                                                  |
| [**ADDSTRING балансировки нагрузки \_**](lb-addstring.md)                     | Добавляет строку в список и возвращает его индекс.                                                                                                                                                                               |
| [**делетестринг балансировки нагрузки \_**](lb-deletestring.md)               | Удаляет строку из списка и возвращает количество строк, остающихся в списке.                                                                                                                                      |
| [**Каталог балансировки нагрузки \_**](lb-dir.md)                                 | Добавляет список имен файлов в поле со списком и возвращает индекс последнего добавленного имени файла.                                                                                                                                       |
| [**FINDSTRING балансировки нагрузки \_**](lb-findstring.md)                   | Возвращает индекс первой строки в списке, которая начинается с указанной строки.                                                                                                                                       |
| [**финдстринжексакт балансировки нагрузки \_**](lb-findstringexact.md)         | Возвращает индекс строки в списке, равный указанной строке.                                                                                                                                             |
| [**жетанчориндекс балансировки нагрузки \_**](lb-getanchorindex.md)           | Возвращает индекс элемента, который был выбран последним щелчком мыши.                                                                                                                                                                      |
| [**жеткаретиндекс балансировки нагрузки \_**](lb-getcaretindex.md)             | Возвращает индекс элемента, имеющего прямоугольник фокуса.                                                                                                                                                                      |
| [**\_Счетчик фунтов**](lb-getcount.md)                       | Возвращает количество элементов в списке.                                                                                                                                                                                     |
| [**нерекурсивная балансировка нагрузки \_**](lb-getcursel.md)                     | Возвращает индекс выбранного в данный момент элемента.                                                                                                                                                                                |
| [**жесоризонталекстент балансировки нагрузки \_**](lb-gethorizontalextent.md) | Возвращает прокручиваемую ширину (в пикселях) поля со списком.                                                                                                                                                                          |
| [**жетитемдата балансировки нагрузки \_**](lb-getitemdata.md)                 | Возвращает значение, связанное с указанным элементом.                                                                                                                                                                    |
| [**GETITEMHEIGHT балансировки нагрузки \_**](lb-getitemheight.md)             | Возвращает высоту (в пикселях) элемента в поле со списком.                                                                                                                                                                         |
| [**жетитемрект балансировки нагрузки \_**](lb-getitemrect.md)                 | Получает клиентские координаты указанного элемента списка.                                                                                                                                                                 |
| [**Нестандартная балансировка нагрузки \_**](lb-getlocale.md)                     | Извлекает языковой стандарт для списка. Слово в высоком порядке содержит код страны или региона, а младшее слово содержит идентификатор языка.                                                                              |
| [**жетсел балансировки нагрузки \_**](lb-getsel.md)                           | Возвращает состояние выбора элемента списка.                                                                                                                                                                                  |
| [**жетселкаунт балансировки нагрузки \_**](lb-getselcount.md)                 | Возвращает число выбранных элементов в списке с множественным выбором.                                                                                                                                                           |
| [**жетселитемс балансировки нагрузки \_**](lb-getselitems.md)                 | Создает массив индексов всех выбранных элементов в списке с множественным выбором и возвращает общее число выбранных элементов.                                                                                           |
| [**\_Балансировка нагрузки**](lb-gettext.md)                         | Извлекает строку, связанную с указанным элементом, и длину строки.                                                                                                                                              |
| [**жеттекстлен балансировки нагрузки \_**](lb-gettextlen.md)                   | Возвращает длину строки в символах, связанной с указанным элементом.                                                                                                                                               |
| [**жеттопиндекс балансировки нагрузки \_**](lb-gettopindex.md)                 | Возвращает индекс первого видимого элемента в поле со списком.                                                                                                                                                                       |
| [**инитстораже балансировки нагрузки \_**](lb-initstorage.md)                 | Выделяет память для указанного числа элементов и связанных с ними строк.                                                                                                                                                 |
| [**инсертстринг балансировки нагрузки \_**](lb-insertstring.md)               | Вставляет строку с указанным индексом в поле со списком.                                                                                                                                                                             |
| [**итемфромпоинт балансировки нагрузки \_**](lb-itemfrompoint.md)             | Возвращает отсчитываемый от нуля индекс элемента, ближайшего к заданной точке в списке.                                                                                                                                            |
| [**ресетконтент балансировки нагрузки \_**](lb-resetcontent.md)               | Удаляет все элементы из списка.                                                                                                                                                                                               |
| [**селектстринг балансировки нагрузки \_**](lb-selectstring.md)               | Выбирает первую найденную строку, совпадающую с указанным префиксом.                                                                                                                                                               |
| [**селитемранже балансировки нагрузки \_**](lb-selitemrange.md)               | Выбирает указанный диапазон элементов в поле со списком.                                                                                                                                                                                |
| [**селитемранжеекс балансировки нагрузки \_**](lb-selitemrangeex.md)           | Выбирает указанный диапазон элементов, если индекс первого элемента в диапазоне меньше индекса последнего элемента в диапазоне. Отменяет выбор в диапазоне, если индекс первого элемента больше, чем последний. |
| [**сетанчориндекс балансировки нагрузки \_**](lb-setanchorindex.md)           | Задает элемент, который был последним выбран для указанного элемента.                                                                                                                                                                  |
| [**сеткаретиндекс балансировки нагрузки \_**](lb-setcaretindex.md)             | Задает прямоугольник фокуса для указанного элемента списка.                                                                                                                                                                           |
| [**сетколумнвидс балансировки нагрузки \_**](lb-setcolumnwidth.md)           | Задает ширину (в пикселях) всех столбцов в поле со списком.                                                                                                                                                                         |
| [**сеткаунт балансировки нагрузки \_**](lb-setcount.md)                       | Задает число элементов в поле со списком.                                                                                                                                                                                          |
| [**сеткурсел балансировки нагрузки \_**](lb-setcursel.md)                     | Выбирает указанный элемент списка.                                                                                                                                                                                               |
| [**сесоризонталекстент балансировки нагрузки \_**](lb-sethorizontalextent.md) | Задает ширину (в пикселях) прокручиваемого поля со списком.                                                                                                                                                                             |
| [**сетитемдата балансировки нагрузки \_**](lb-setitemdata.md)                 | Связывает значение с элементом списка.                                                                                                                                                                                         |
| [**сетитемхеигхт балансировки нагрузки \_**](lb-setitemheight.md)             | Задает высоту (в пикселях) элемента или элементов в поле со списком.                                                                                                                                                                   |
| [**ФУНТОВая \_ SETLOCALE**](lb-setlocale.md)                     | Задает языковой стандарт для списка и возвращает предыдущий идентификатор локали.                                                                                                                                                        |
| [**сетсел балансировки нагрузки \_**](lb-setsel.md)                           | Выбирает элемент в списке с множественным выбором.                                                                                                                                                                                |
| [**сеттабстопс балансировки нагрузки \_**](lb-settabstops.md)                 | Задает позицию табуляции, указанную в указанном массиве.                                                                                                                                                                      |
| [**сеттопиндекс балансировки нагрузки \_**](lb-settopindex.md)                 | Прокручивает список таким образом, чтобы указанный элемент находящегося в верхней части видимого диапазона.                                                                                                                                                   |



 

## <a name="default-window-message-processing"></a>Обработка сообщений окна по умолчанию

Процедура окна для стандартного класса окна списка выполняет обработку по умолчанию для всех сообщений, которые не обрабатываются списком. Если процедура окна списка возвращает **false** для сообщения, то предопределенная процедура окна проверяет сообщение и выполняет действия по умолчанию, как показано в следующей таблице.



| Сообщение                                            | Действие по умолчанию                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**WM \_ char**](/windows/desktop/inputdev/wm-char)                   | Перемещает выделенный фрагмент к первому элементу, который начинается с символа, введенного пользователем. Если в списке имеется стиль [**\_ Овнердрав**](button-styles.md) "L BS", никаких действий не происходит. Несколько символов, вводимых в течение короткого интервала, рассматриваются как группа, и выбирается первый элемент, который начинается с этого ряда символов.<br/> |
| [**\_Создание WM**](/windows/desktop/winmsg/wm-create)                 | Создает пустое окно списка.                                                                                                                                                                                                                                                                                                                                               |
| [**WM \_ destroy**](/windows/desktop/winmsg/wm-destroy)               | Уничтожает список и освобождает все используемые им ресурсы.                                                                                                                                                                                                                                                                                                              |
|                                                    | Передает сообщение процедуре диалогового окна или процессу родительского окна.                                                                                                                                                                                                                                                                                                 |
| [**\_Включение WM**](/windows/desktop/winmsg/wm-enable)                 | Если элемент управления является видимым, делает прямоугольник недействительным, чтобы строки можно было закрашены серым цветом.                                                                                                                                                                                                                                                                                 |
| [**WM \_ ерасебкгнд**](/windows/desktop/winmsg/wm-erasebkgnd)         | Удаляет фон поля со списком. Если в списке имеется стиль овнердрав-[**BS \_**](button-styles.md) , фон не удаляется.                                                                                                                                                                                                                   |
| [**WM \_ жетдлгкоде**](/windows/desktop/dlgbox/wm-getdlgcode)         | Возвращает ДЛГК \_ вантарровс \| длгк \_ вантчарс, указывающий, что процедура списка по умолчанию обрабатывает клавиши со стрелками и сообщения [**WM \_ char**](/windows/desktop/inputdev/wm-char) .                                                                                                                                                                                                      |
| [**WM, \_ Шрифт**](/windows/desktop/winmsg/wm-getfont)               | Возвращает маркер текущего шрифта для списка.                                                                                                                                                                                                                                                                                                                   |
| [**WM \_ HSCROLL**](wm-hscroll.md)                  | Прокручивает список по горизонтали.                                                                                                                                                                                                                                                                                                                                       |
| [**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown)             | Обрабатывает виртуальные ключи для прокрутки. Виртуальный ключ — это индекс элемента, к которому нужно переместить курсор. Выбор не изменяется.                                                                                                                                                                                                                                       |
| [**WM \_ киллфокус**](/windows/desktop/inputdev/wm-killfocus)         | Отключает курсор и уничтожает его. Отправляет код уведомления [ЛБН \_ киллфокус](lbn-killfocus.md) владельцу списка.                                                                                                                                                                                                                                        |
| [**WM \_ лбуттондблклк**](/windows/desktop/inputdev/wm-lbuttondblclk) | Отслеживает мышь в клиентской области списка. Это позволяет пользователю отменить выбор, если кнопка мыши выводится за пределы области окна списка.                                                                                                                                                                                                              |
| [**WM \_ лбуттондовн**](/windows/desktop/inputdev/wm-lbuttondown)     | Отслеживает мышь в клиентской области списка. Это позволяет пользователю отменить выбор, если кнопка мыши выводится за пределы области окна списка.                                                                                                                                                                                                              |
| [**WM \_ лбуттонуп**](/windows/desktop/inputdev/wm-lbuttonup)         | Отслеживает мышь в клиентской области списка. Это позволяет пользователю отменить выбор, если кнопка мыши выводится за пределы области окна списка.                                                                                                                                                                                                              |
| [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove)         | Отслеживает мышь в клиентской области списка. Это позволяет пользователю отменить выбор, если кнопка мыши выводится за пределы области окна списка.                                                                                                                                                                                                              |
| [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)                      | Выполняет операцию рисования в подклассе с помощью обработки списка в контексте устройства (DC).                                                                                                                                                                                                                                                                           |
| [**WM \_ SETFOCUS**](/windows/desktop/inputdev/wm-setfocus)           | Включает курсор и отправляет код уведомления [ЛБН \_ SETFOCUS](lbn-setfocus.md) владельцу списка.                                                                                                                                                                                                                                                        |
| [**WM \_ сетфонт**](/windows/desktop/winmsg/wm-setfont)               | Задает новый шрифт для списка.                                                                                                                                                                                                                                                                                                                                        |
| [**WM \_ сетредрав**](/windows/desktop/gdi/wm-setredraw)              | Задает или очищает флаг перерисовки на основе значения *wParam*.                                                                                                                                                                                                                                                                                                           |
| [**\_Размер WM**](/windows/desktop/winmsg/wm-size)                     | Изменяет размер окна списка до целого числа элементов.                                                                                                                                                                                                                                                                                                                     |
| [**WM \_ VSCROLL**](wm-vscroll.md)                  | Прокручивает список по вертикали.                                                                                                                                                                                                                                                                                                                                         |



 

Предопределенная процедура окна списка передает все остальные сообщения в [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для обработки по умолчанию.

## <a name="owner-drawn-list-boxes"></a>Списки Owner-Drawn

Приложение может создать список, *рисуемый владельцем* , чтобы принимать ответственность за рисование элементов списка. Родительское окно или диалоговое окно списка, рисуемого владельцем (его *владелец*), получает сообщения [**WM \_ DRAWITEM**](wm-drawitem.md) , когда часть списка должна быть окрашена. Список, рисуемый владельцем, может выводить сведения, Кроме текстовых строк, а также в дополнение к ним.

Владелец рисуемого владельцем списка должен обработать сообщение [**WM \_ DRAWITEM**](wm-drawitem.md) . Это сообщение отправляется при необходимости перерисовки части списка. Владельцу может потребоваться обработка других сообщений в зависимости от стилей, заданных для списка.

Приложение может создать список, рисуемый владельцем, указав стиль [**фунта \_ Овнердравфиксед**](list-box-styles.md) или [**фунта \_ овнердраввариабле**](list-box-styles.md) . Если все элементы списка в списке имеют одинаковую высоту, например строки или значки, приложение может использовать стиль **фунта \_ овнердравфиксед** . Если элементы списка имеют переменную высоту (например, точечные рисунки разного размера), приложение может использовать стиль **фунта \_ овнердраввариабле** .

Владелец рисуемого владельцем списка может обработать сообщение [**WM \_ меасуреитем**](wm-measureitem.md) , чтобы указать размеры элементов списка. Если приложение создает список с помощью стиля [**фунта \_ овнердравфиксед**](list-box-styles.md) , система отправляет сообщение **WM \_ меасуреитем** только один раз. Измерения, заданные владельцем, используются для всех элементов списка. Если используется стиль [**фунта \_ овнердраввариабле**](list-box-styles.md) , система отправляет сообщение **WM \_ меасуреитем** для каждого элемента списка, добавленного в список. Владелец может определить или задать высоту элемента списка в любое время с помощью сообщений [**\_ GETITEMHEIGHT**](lb-getitemheight.md) и [**\_ сетитемхеигхт**](lb-setitemheight.md) балансировки нагрузки соответственно.

Если информация, отображаемая в списке, рисуемом владельцем, содержит текст, приложение может отследить текст для каждого элемента списка, указав стиль [**фунта \_ хасстрингс**](list-box-styles.md) . Списки с стилем [**\_ сортировки фунтов**](list-box-styles.md) сортируются по этому тексту. Если список отсортирован, но не относится к стилю **фунта \_ хасстрингс** , владелец должен обработать сообщение [**WM \_ компареитем**](wm-compareitem.md) .

В списке, рисуемом владельцем, владелец должен вести отслеживание элементов списка, содержащих информацию, отличную от текста или в дополнение к тексту. Один из удобных способов сделать это — сохранить данные об элементе в виде данных элемента с помощью сообщения [**\_ сетитемдата балансировки нагрузки**](lb-setitemdata.md) . Чтобы освободить объекты данных, связанные с элементами, в поле со списком владелец может обработать сообщение [**WM \_ DELETEITEM**](wm-deleteitem.md) .

Пример списка, рисуемого владельцем, см. [в разделе Создание списка Owner-Drawn](create-an-owner-drawn-list-box.md).

## <a name="drag-list-boxes"></a>Перетаскивать списки

Поле списка перетаскивания представляет собой особый тип списка, который позволяет пользователю перетаскивать элементы из одной позиции в другую. Приложение может использовать список перетаскивания для вывода строк в определенной последовательности и предоставления пользователю возможности изменения последовательности путем перетаскивания элементов в нужное расположение.

### <a name="creating-drag-list-boxes"></a>Создание списков перетаскивания

Перетаскивая списки имеют одинаковые стили окна и обрабатывают те же сообщения, что и стандартные списки. Чтобы создать список перетаскивания, сначала создайте стандартный список, а затем вызовите функцию [**македраглист**](/windows/desktop/api/Commctrl/nf-commctrl-makedraglist) . Чтобы преобразовать список в диалоговом окне в поле списка перетаскивания, можно вызвать **македраглист** при \_ обработке сообщения WM инитдиалог.

### <a name="drag-list-box-messages"></a>Перетаскивать сообщения из списка

Поле со списком перетаскивания уведомляет родительское окно о событиях перетаскивания, отправив ему сообщение со списком перетаскивания. Родительское окно должно обработать сообщение перетаскивания списка.

Поле со списком перетаскивания регистрирует это сообщение при вызове функции [**македраглист**](/windows/desktop/api/Commctrl/nf-commctrl-makedraglist) . Чтобы получить идентификатор сообщения (числовое значение) сообщения о перетаскивании, вызовите функцию [**регистервиндовмессаже**](/windows/desktop/api/winuser/nf-winuser-registerwindowmessagea) и укажите значение драглистмсгстринг.

Параметр *wParam* сообщения, перетащив список, является идентификатором элемента управления для поля со списком перетаскивания. Параметр *lParam* является адресом структуры [**драглистинфо**](/windows/win32/api/commctrl/ns-commctrl-draglistinfo) , которая содержит код уведомления для события перетаскивания и другие сведения. Возвращаемое значение сообщения зависит от уведомления.

### <a name="drag-list-box-notification-codes"></a>Перетаскивать коды уведомлений списка

Код уведомления списка перетаскивания, определяемый элементом **унотификатион** структуры [**драглистинфо**](/windows/win32/api/commctrl/ns-commctrl-draglistinfo) , включенным в сообщение перетаскивания списка, может быть списком [рассылки \_ бегиндраг](dl-begindrag.md), [ \_ перетащив DL](dl-dragging.md), [DL \_ канцелдраг](dl-canceldrag.md)или [DL \_](dl-dropped.md).

Код [уведомления \_ бегиндраг DL](dl-begindrag.md) отправляется, когда курсор находится на элементе списка и пользователь нажимает левую кнопку мыши. Родительское окно может возвращать **значение true** , чтобы начать операцию перетаскивания, или **значение false** , чтобы запретить перетаскивание. Таким образом, родительское окно может включить перетаскивание для некоторых элементов списка и отключить его для других. Определить, какой элемент списка находится в указанном расположении, можно с помощью функции [**лбитемфромпт**](/windows/desktop/api/Commctrl/nf-commctrl-lbitemfrompt) .

Если [выполняется перетаскивание, код уведомления при \_ ](dl-dragging.md) перемещении мыши отсылается при нажатии мышью или через равные промежутки времени, если мышь не перемещается. Родительское окно должно сначала определить элемент списка в курсоре с помощью [**лбитемфромпт**](/windows/desktop/api/Commctrl/nf-commctrl-lbitemfrompt) , а затем нарисовать значок вставки с помощью функции [**дравинсерт**](/windows/desktop/api/Commctrl/nf-commctrl-drawinsert) . Если указать **значение true** для параметра *баутоскролл* в **лбитемфромпт**, то окно списка можно прокручивать по одной строке, если курсор находится выше или ниже области клиента. Значение, возвращаемое для этого уведомления, указывает тип курсора мыши, который должен быть установлен в поле со списком перетаскивания.

Код [уведомления \_ канцелдраг DL](dl-canceldrag.md) отправляется, если пользователь отменяет операцию перетаскивания щелчком правой кнопки мыши или нажатием клавиши ESC. Если пользователь завершает операцию перетаскивания, выпуская левую кнопку мыши, даже если курсор не находится над элементом списка, отправляется код уведомления [DL \_ ](dl-dropped.md) . Перед отправкой уведомления в поле со списком перетаскивания снимается захват мыши. Возвращаемое значение этих двух уведомлений игнорируется. Перетащить список

 

