---
title: Сведения об элементах управления ToolTip
description: Всплывающие подсказки отображаются автоматически или при наведении указателя мыши на инструмент или другой элемент пользовательского интерфейса.
ms.assetid: 1020cec7-57b4-4463-9419-f80fd14fa12c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e9c1042523c86e794865da5d38fb023ee37d60b4
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "104070701"
---
# <a name="about-tooltip-controls"></a>Сведения об элементах управления ToolTip

Всплывающие подсказки отображаются автоматически или при наведении указателя мыши на инструмент или другой элемент пользовательского интерфейса. Всплывающая подсказка появляется рядом с указателем и исчезает, когда пользователь нажимает кнопку мыши, перемещает указатель за пределы инструмента или просто ждет несколько секунд.

Элемент управления ToolTip на следующем рисунке отображает сведения о файле на рабочем столе Windows. При наведении указателя мыши на иллюстрацию также должна отобразиться Динамическая подсказка, содержащая описательный текст.

![снимок экрана с текстом во всплывающей подсказке, отображаемой для файла на рабочем столе](images/tt-desktop.png)

В этом разделе описывается работа элементов управления ToolTip и их создание.

-   [Поведение и внешний вид всплывающей подсказки](#tooltip-behavior-and-appearance)
-   [Создание элементов управления ToolTip](#creating-tooltip-controls)
-   [Активация элементов управления ToolTip](#activating-tooltip-controls)
-   [Вспомогательные средства](#supporting-tools)
-   [Отображение текста](#displaying-text)
-   [Обмен сообщениями и уведомление](#messaging-and-notification)
-   [Проверка нажатия](#hit-testing)
-   [Обработка сообщений по умолчанию](#default-message-processing)

## <a name="tooltip-behavior-and-appearance"></a>Поведение и внешний вид всплывающей подсказки

Элементы управления ToolTip могут отображать одну строку текста или несколько строк. Их углы можно округлить или квадратировать. Они могут или не иметь основу, которая указывает на такие средства, как мультипликационное всплывающее сообщение. Текст подсказки может быть стационарным или может перемещаться с помощью указателя мыши, называемого отслеживанием. Стационарный текст может отображаться рядом с инструментом или отображаться в средстве, который называется «на месте». Стандартные подсказки являются стационарными, отображают одну строку текста, имеют квадратные углы и не имеют основной области, указывающей на средство.

Отслеживание всплывающих подсказок, поддерживаемых стандартными элементами управления [версии 4,70](common-control-versions.md) , изменяет расположение на экране динамически. При быстром обновлении положения эти элементы управления ToolTip перемещаются плавно, или «Track». Они полезны, если текст подсказки должен следовать за положением указателя мыши по мере его перемещения. Дополнительные сведения об отслеживании всплывающих подсказок и пример кода с описанием их создания см. в разделе [Отслеживание подсказок](using-tooltip-contro.md).

Многострочные подсказки, которые также поддерживаются в версии 4,70 общих элементов управления, отображают текст на более чем одной строке. Они полезны для отображения длинных сообщений. Дополнительные сведения и пример, демонстрирующий создание многострочных подсказок, см. в разделе [многострочные подсказки](using-tooltip-contro.md).

Всплывающие подсказки отображаются в поле со скругленными углами и с появлением инструмента. Они могут быть либо однострочными, либо многострочными. На следующем рисунке показана всплывающая подсказка с областью и прямоугольником в их позициях по умолчанию. Дополнительные сведения о всплывающих подсказках и примерах, демонстрирующих их создание, см. в разделе [Использование элементов управления ToolTip](using-tooltip-contro.md).

![снимок экрана, показывающий подсказку, содержащую одну строку текста, расположенную над кнопкой в диалоговом окне](images/tt-balloon.png)

Всплывающая подсказка также может содержать текст заголовка и значок, как показано на следующем рисунке. Обратите внимание, что подсказка должна содержать текст; Если он содержит только текст заголовка, подсказка не отображается. Кроме того, значок не отображается, если отсутствует заголовок.

![снимок экрана с подсказкой с значком, заголовком и текстом, расположенным под кнопкой в диалоговом окне](images/tt-titled.png)

Иногда текстовые строки обрезаются, так как они слишком длинны для полного отображения в маленьком окне. Подсказки на месте используются для вывода текстовых строк для объектов, которые были обрезаны, например имя файла на следующем рисунке. Пример, демонстрирующий создание подсказок на месте, см. [в разделе подсказки на месте](using-tooltip-contro.md).

![снимок экрана с подсказкой, содержащей имя файла, расположенное рядом со значком файла в элементе управления "дерево"](images/tt-inplace.png)

Курсор должен навести указатель мыши на инструмент в течение определенного периода времени до отображения подсказки. По умолчанию длительность этого времени ожидания регулируется временем двойного щелчка пользователя и обычно составляет примерно одну половину секунды. Чтобы указать значение времени ожидания, отличное от значения по умолчанию, отправьте сообщение [**ТТМ \_ сетделайтиме**](ttm-setdelaytime.md) в элемент управления ToolTip.

## <a name="creating-tooltip-controls"></a>Создание элементов управления ToolTip

Чтобы создать элемент управления ToolTip, вызовите [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) и укажите класс окна [**\_ класса ToolTips**](common-control-window-classes.md) . Этот класс регистрируется при загрузке библиотеки DLL общих элементов управления. Чтобы убедиться, что библиотека DLL загружена, включите в приложение функцию [**InitCommonControlsEx**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrolsex) . Необходимо явно определить элемент управления ToolTip как верхний. В противном случае оно может быть охвачено родительским окном. В следующем фрагменте кода показано, как создать элемент управления ToolTip.


```
HWND hwndTip = CreateWindowEx(NULL, TOOLTIPS_CLASS, NULL,
                            WS_POPUP | TTS_NOPREFIX | TTS_ALWAYSTIP,
                            CW_USEDEFAULT, CW_USEDEFAULT,
                            CW_USEDEFAULT, CW_USEDEFAULT,
                            hwndParent, NULL, hinstMyDll,
                            NULL);

SetWindowPos(hwndTip, HWND_TOPMOST,0, 0, 0, 0,
             SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);
```



Процедура окна для элемента управления ToolTip автоматически задает размер, расположение и видимость элемента управления. Высота окна подсказки зависит от высоты шрифта, выбранного в данный момент в контексте устройства для элемента управления ToolTip. Ширина варьируется в зависимости от длины строки, находящегося в окне подсказки.

## <a name="activating-tooltip-controls"></a>Активация элементов управления ToolTip

Элемент управления ToolTip может быть либо активным, либо неактивным. Если указатель мыши находится на инструменте, отображается текст подсказки. Если он неактивен, текст подсказки не отображается, даже если указатель находится на инструменте. Сообщение [**\_ активации ТТМ**](ttm-activate.md) активирует и деактивирует элемент управления ToolTip.

## <a name="supporting-tools"></a>Вспомогательные средства

Элемент управления ToolTip может поддерживать любое количество инструментов. Для поддержки конкретного средства необходимо зарегистрировать средство с помощью элемента управления ToolTip, отправив управление сообщением [**ТТМ \_ аддтул**](ttm-addtool.md) . Сообщение включает адрес структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) , которая предоставляет сведения, необходимые элементу управления ToolTip для показа текста для инструмента. Элемент **UID** структуры **тулинфо** определяется приложением. Каждый раз при добавлении средства приложение предоставляет уникальный идентификатор. Элемент **кбсизе** структуры **тулинфо** является обязательным и должен указывать размер структуры.

Элемент управления ToolTip поддерживает средства, реализованные как окна (например, дочерние окна или окна элементов управления) и как прямоугольные области в клиентской области окна. При добавлении средства, реализованного в виде прямоугольной области, элемент **HWND** структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) должен задавать дескриптор для окна, содержащего область, а элемент **Rect** должен указывать клиентские координаты ограничивающего прямоугольника области. Кроме того, член **UID** должен указывать определяемый приложением идентификатор для инструмента.

При добавлении средства, реализованного в виде окна, элемент **UID** структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) должен содержать описатель окна для средства. Кроме того, элемент **уфлагс** должен задавать значение **TTF \_ идишвнд** , которое сообщает элементу управления ToolTip, что элемент **UID** интерпретируется как описатель окна.

## <a name="displaying-text"></a>Отображение текста

При добавлении инструмента в элемент управления ToolTip элемент **лпсзтекст** структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) должен указывать адрес строки, которая будет отображаться для средства. После добавления средства можно изменить текст с помощью сообщения [**ТТМ \_ упдатетиптекст**](ttm-updatetiptext.md) .

Если слово **лпсзтекст** с высоким приоритетом имеет нулевое значение, то слово низкого порядка должно быть идентификатором строкового ресурса. Когда элементу управления ToolTip требуется текст, система загружает указанный строковый ресурс из экземпляра приложения, идентифицируемого элементом **хинст** структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) .

Если указать \_ значение LPSTR тексткаллбакк в элементе **лпсзтекст** , элемент управления ToolTip уведомляет окно, указанное в элементе **HWND** структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa), каждый раз, когда элементу управления ToolTip требуется отображать текст для средства. Элемент управления ToolTip отправляет в окно код уведомления [ТТН \_ жетдиспинфо](ttn-getdispinfo.md) . Сообщение включает адрес структуры [**нмттдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmttdispinfoa) , которая содержит маркер окна, а также определяемый приложением идентификатор для инструмента. Окно анализирует структуру, чтобы определить средство, для которого требуется текст, и заполняет соответствующие элементы структуры данными, которые требуются для вывода строки элементом управления ToolTip.

> [!Note]  
> Максимальная длина стандартного текста всплывающей подсказки — 80 символов. Дополнительные сведения см. в разделе Структура [**нмттдиспинфо**](/windows/win32/api/commctrl/ns-commctrl-nmttdispinfoa) . Текст многострочной подсказки может быть больше.

 

Многие приложения создают панели инструментов, содержащие средства, соответствующие командам меню. Для таких инструментов удобно, чтобы элемент управления ToolTip отображал тот же текст, что и соответствующий пункт меню. Система автоматически отделяет символы ускорителя (&) от всех строк, передаваемых в элемент управления ToolTip, и завершает строку на первом символе табуляции ( \\ t), если только элемент управления не имеет стиля [**TTS без \_ префикса**](tooltip-styles.md) .

Чтобы получить текст для средства, используйте сообщение [**ТТМ \_ gettext**](ttm-gettext.md) .

## <a name="messaging-and-notification"></a>Обмен сообщениями и уведомление

Текст подсказки обычно отображается при наведении указателя мыши на область (обычно это прямоугольник, определенный средством, например элементом управления "Кнопка"). Однако Microsoft Windows отправляет только сообщения, связанные с мышью, в окно, содержащее указатель, а не сам элемент управления ToolTip. Информация, связанная с мышью, должна быть передаваться в элемент управления ToolTip для того, чтобы отображать текст подсказки в соответствующее время и место.

Сообщения можно ретранслировать автоматически, если:

-   Инструмент является элементом управления или определяется как прямоугольник в структуре [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) средства.
-   Окно, связанное с инструментом, находится в том же потоке, что и элемент управления ToolTip.

Если эти два условия выполнены, установите флаг **\_ подкласса TTF** в **уфлагс** элемента структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) при добавлении средства в элемент управления ToolTip с [**ТТМ \_ аддтул**](ttm-addtool.md). Необходимые сообщения мыши затем автоматически передаются элементу управления ToolTip.

Настройка **\_ подкласса TTF** для передвижения сообщений мыши в элемент управления достаточно для большинства целей. Однако он не будет работать в тех случаях, когда между элементом управления ToolTip и окном средства нет прямого соединения. Например, если средство реализуется в виде прямоугольной области в окне, определяемом приложением, то процедура окна получает сообщения мыши. Настройка **\_ подкласса TTF** достаточна для того, чтобы убедиться, что они передаются элементу управления. Однако если средство реализовано как системное окно, сообщения мыши отправляются в это окно и не доступны для приложения напрямую. В этом случае необходимо либо подделать окно подклассом, либо использовать обработчик сообщений для доступа к сообщениям мыши. Затем необходимо явно пересылать сообщения мыши в элемент управления ToolTip с помощью [**ТТМ \_ релайевент**](ttm-relayevent.md). Пример использования **ТТМ \_ релайевент** см. в разделе [Отслеживание подсказок](using-tooltip-contro.md).

Когда элемент управления ToolTip получает сообщение [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove) , он определяет, находится ли указатель мыши в ограничивающем прямоугольнике инструмента. Если это так, элемент управления ToolTip устанавливает таймер. По окончании интервала времени ожидания элемент управления ToolTip проверяет расположение указателя, чтобы увидеть, перемещен ли он. В противном случае элемент управления ToolTip извлекает текст для инструмента и отображает подсказку. Элемент управления ToolTip сохраняет окно до тех пор, пока оно не получит сообщение кнопки ретрансляции или кнопки или пока сообщение **WM \_ MOUSEMOVE** не покажет, что указатель переместился за пределы ограничивающего прямоугольника инструмента.

С элементом управления ToolTip фактически связано три длительности времени ожидания. Начальная длительность — это время, в течение которого указатель мыши должен оставаться в пределах ограничивающего прямоугольника инструмента перед отображением окна подсказки. Длительность повторного отображения — это длина задержки до отображения последующих окон всплывающей подсказки при переходе указателя с одного инструмента на другое. Длительность всплывающего окна — это время, когда окно подсказки остается видимым, прежде чем оно будет скрыто. То есть, если указатель остается неподвижным в ограничивающем прямоугольнике после отображения всплывающей подсказки, окно подсказки автоматически скрывается в конце интервала всплывающего окна. Все интервалы времени ожидания можно настроить с помощью сообщения [**ТТМ \_ сетделайтиме**](ttm-setdelaytime.md) .

Если приложение включает средство, реализованное в виде прямоугольной области, и размер или расположение элемента управления изменяется, приложение может использовать сообщение [**ТТМ \_ невтулрект**](ttm-newtoolrect.md) для сообщения об изменении элемента управления ToolTip. Приложению не требуется сообщать об изменениях размера и позиции для инструмента, реализованного в виде окна, поскольку элемент управления ToolTip использует маркер окна средства, чтобы определить, находится ли указатель мыши на инструменте, а не на ограничивающем прямоугольнике инструмента.

Когда подсказка будет отображаться, элемент управления ToolTip посылает окну-владельцу [ТТН \_ Показать](ttn-show.md) код уведомления. Окно-владелец получает код [уведомления \_ POP ТТН](ttn-pop.md) , когда подсказка будет скрыта. Каждый код уведомления отправляется в контексте сообщения [**WM \_ Notify**](wm-notify.md) .

## <a name="hit-testing"></a>Проверка нажатия

Сообщение [**ТТМ \_ HITTEST**](ttm-hittest.md) позволяет извлекать сведения, которые поддерживает элемент управления ToolTip, о средстве, которое занимает определенную точку. Сообщение содержит структуру [**тситтестинфо**](/windows/win32/api/commctrl/ns-commctrl-tthittestinfoa) , содержащую маркер окна, координаты точки и адрес структуры [**тулинфо**](/windows/win32/api/commctrl/ns-commctrl-tttoolinfoa) . Элемент управления ToolTip определяет, занимает ли инструмент точка, и, если это так, заполняет **тулинфо** информацией о средстве.

## <a name="default-message-processing"></a>Обработка сообщений по умолчанию

В следующей таблице описаны сообщения, обрабатываемые процедурой окна для элемента управления ToolTip.



| Сообщение                                        | Описание                                                                                                                                                                                                                                                       |
|------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**\_Создание WM**](/windows/desktop/winmsg/wm-create)             | Гарантирует, что элемент управления ToolTip содержит стили окна "панели [**\_ \_ инструментов WS**](/windows/desktop/winmsg/window-styles) " и [**\_ "ws"**](/windows/desktop/winmsg/window-styles) . Он также выделяет память и инициализирует внутренние переменные. |
| [**WM \_ destroy**](/windows/desktop/winmsg/wm-destroy)           | Освобождает ресурсы, выделенные для элемента управления ToolTip.                                                                                                                                                                                                                |
| [**WM, \_ Шрифт**](/windows/desktop/winmsg/wm-getfont)           | Возвращает маркер шрифта, который будет использоваться элементом управления ToolTip для рисования текста.                                                                                                                                                                                    |
| [**WM \_ MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove)     | Скрывает окно подсказки.                                                                                                                                                                                                                                         |
| [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)                  | Рисует окно подсказки.                                                                                                                                                                                                                                         |
| [**WM \_ сетфонт**](/windows/desktop/winmsg/wm-setfont)           | Задает маркер шрифта, который будет использоваться элементом управления ToolTip для рисования текста.                                                                                                                                                                                       |
| [**\_таймер WM**](/windows/desktop/winmsg/wm-timer)               | Скрывает окно подсказки, если оно изменилось или если указатель мыши переместился за пределы инструмента. В противном случае отображается окно подсказки.                                                                                                             |
| [**WM \_ вининичанже**](/windows/desktop/winmsg/wm-wininichange) | Сбрасывает внутренние переменные, основанные на системных метриках.                                                                                                                                                                                                       |



 

 

 