---
title: Включение стилей оформления
description: В этом разделе объясняется, как настроить приложение, чтобы обеспечить отображение стандартных элементов управления в предпочитаемом визуальном стиле пользователя.
ms.assetid: eb6c2469-25b9-43c4-a6ca-391a7b2859b3
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f259be6165bd3a4f9f5a655aaecf0fe6837de3dce057848ba92ac737e608fbc0
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118413370"
---
# <a name="enabling-visual-styles"></a>Включение стилей оформления

В этом разделе объясняется, как настроить приложение, чтобы обеспечить отображение стандартных элементов управления в предпочитаемом визуальном стиле пользователя.

Этот раздел включает следующие подразделы:

-   [Использование манифестов или директив для обеспечения возможности применения стилей оформления к приложениям](#using-manifests-or-directives-to-ensure-that-visual-styles-can-be-applied-to-applications)
-   [Использование ComCtl32.dll версии 6 в приложении, использующем только стандартные расширения](#using-comctl32dll-version-6-in-an-application-that-uses-only-standard-extensions)
-   [С помощью ComCtl32 версии 6 на панели управления или библиотеки DLL, которая запускается с RunDll32.exe](#using-comctl32-version-6-in-control-panel-or-a-dll-that-is-run-by-rundll32exe)
-   [Добавление поддержки визуального стиля для расширения, подключаемого модуля, оснастки MMC или библиотеки DLL, которая переносится в процесс](#adding-visual-style-support-to-an-extension-plug-in-mmc-snap-in-or-a-dll-that-is-brought-into-a-process)
-   [Выключение визуальных стилей](#turning-off-visual-styles)
-   [Использование стилей оформления с содержимым HTML](#using-visual-styles-with-html-content)
-   [Когда визуальные стили не применяются](#when-visual-styles-are-not-applied)
-   [Обеспечение совместимости приложения с более ранними версиями Windows](#making-your-application-compatible-with-earlier-versions-of-windows)
-   [Связанные темы](#related-topics)

## <a name="using-manifests-or-directives-to-ensure-that-visual-styles-can-be-applied-to-applications"></a>Использование манифестов или директив для обеспечения возможности применения стилей оформления к приложениям

Чтобы разрешить приложению использовать стили оформления, необходимо использовать ComCtl32.dll версии 6 или более поздней. поскольку версия 6 не распространяется на распространяемый пакет, она доступна только в том случае, если приложение работает в версии Windows, содержащей его. Windows поставляется как с версией 5, так и с версией 6. ComCtl32.dll версии 6 содержит как пользовательские элементы управления, так и общие элементы управления. По умолчанию приложения используют пользовательские элементы управления, определенные в User32.dll, и общие элементы управления, определенные в ComCtl32.dll версии 5. Список версий DLL и их платформ распространения см. в разделе [общие версии элементов управления](common-control-versions.md).

Если вы хотите, чтобы приложение использовало стили оформления, необходимо добавить манифест приложения или директиву компилятора, которая указывает, что следует использовать ComCtl32.dll версии 6, если она доступна.

Манифест приложения позволяет приложению указывать, какие версии сборки требуются. В Microsoft Win32 сборка представляет собой набор библиотек DLL и список объектов с версиями, содержащихся в этих библиотеках DLL.

Манифесты записываются в формате XML. Имя файла манифеста приложения — это имя исполняемого объекта, за которым следует расширение MANIFEST; Например, MyApp.exe. manifest. В следующем примере манифеста показано, что в первом разделе описывается сам манифест. В следующей таблице показаны атрибуты, заданные элементом **assemblyIdentity** в разделе описания манифеста.



| attribute             | Описание                                                                                                                 |
|-----------------------|-----------------------------------------------------------------------------------------------------------------------------|
| version               | Версия манифеста. Версия должна быть указана в формате основная. Дополнительная. Редакция. сборка (т. е. n. n. n. n, где n <= 65535). |
| processorArchitecture | Процессор, для которого разрабатывается приложение.                                                                          |
| name                  | Включает название организации, название продукта и имя приложения.                                                                   |
| type                  | Тип приложения, например Win32.                                                                                    |



 

Пример манифеста также предоставляет описание приложения и определяет зависимости приложений. В следующей таблице показаны атрибуты, заданные элементом **assemblyIdentity** в разделе зависимостей.



| attribute             | Описание                                      |
|-----------------------|--------------------------------------------------|
| type                  | Тип компонента зависимости, например Win32. |
| name                  | Имя компонента.                           |
| version               | Версия компонента.                        |
| processorArchitecture | Процессор, для которого предназначен компонент.    |
| publicKeyToken        | Токен ключа, используемый с этим компонентом.              |
| Язык              | Язык компонента.                       |



 

Ниже приведен пример файла манифеста.

> [!IMPORTANT]
> установите для записи **processorArchitecture** значение **"X86"** , если приложение предназначено для 32 разрядной Windows платформы, или **"amd64"** , если приложение предназначено для Windows разрядной платформы 64. Можно также указать **" \* "**, чтобы обеспечить целевую платформу для всех платформ, как показано в следующих примерах.

 


```C++
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
<assemblyIdentity
    version="1.0.0.0"
    processorArchitecture="*"
    name="CompanyName.ProductName.YourApplication"
    type="win32"
/>
<description>Your application description here.</description>
<dependency>
    <dependentAssembly>
        <assemblyIdentity
            type="win32"
            name="Microsoft.Windows.Common-Controls"
            version="6.0.0.0"
            processorArchitecture="*"
            publicKeyToken="6595b64144ccf1df"
            language="*"
        />
    </dependentAssembly>
</dependency>
</assembly>
```



при использовании Microsoft Visual C++ 2005 или более поздней версии можно добавить следующую директиву компилятора в исходный код вместо создания манифеста вручную. Для удобочитаемости директива разбивается на несколько строк.


```C++
#pragma comment(linker,"\"/manifestdependency:type='win32' \
name='Microsoft.Windows.Common-Controls' version='6.0.0.0' \
processorArchitecture='*' publicKeyToken='6595b64144ccf1df' language='*'\"")
```



В следующих разделах описаны действия по применению стилей оформления к различным типам приложений. Обратите внимание, что в каждом случае используется один и тот же формат манифеста.

## <a name="using-comctl32dll-version-6-in-an-application-that-uses-only-standard-extensions"></a>Использование ComCtl32.dll версии 6 в приложении, использующем только стандартные расширения

Ниже приведены примеры приложений, которые не используют сторонние расширения.

-   "Калькулятор"
-   солитер (в Windows Vista и Windows 7)
-   сапер (в Windows Vista и Windows 7)
-   Блокнот
-   косынка (в Windows Vista и Windows 7)

**Чтобы создать манифест и позволить приложению использовать стили оформления.**

1.  Свяжите с ComCtl32. lib и вызовите [**иниткоммонконтролс**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrols).
2.  Добавьте файл с именем YourApp.exe. manifest в дерево исходного кода, имеющее формат XML-манифеста.
    ```C++
    <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity
        version="1.0.0.0"
        processorArchitecture="*"
        name="CompanyName.ProductName.YourApplication"
        type="win32"
    />
    <description>Your application description here.</description>
    <dependency>
        <dependentAssembly>
            <assemblyIdentity
                type="win32"
                name="Microsoft.Windows.Common-Controls"
                version="6.0.0.0"
                processorArchitecture="*"
                publicKeyToken="6595b64144ccf1df"
                language="*"
            />
        </dependentAssembly>
    </dependency>
    </assembly>
    ```

    

3.  Добавьте манифест в файл ресурсов приложения следующим образом:
    ```C++
    CREATEPROCESS_MANIFEST_RESOURCE_ID RT_MANIFEST "YourApp.exe.manifest"
    ```

    

    > [!Note]  
    > При добавлении предыдущей записи в ресурс ее необходимо отформатировать в одной строке. Кроме того, файл манифеста XML можно поместить в тот же каталог, что и исполняемый файл приложения. Операционная система сначала загрузит манифест из файловой системы, а затем проверьте раздел ресурсов исполняемого файла. Версия файловой системы имеет приоритет.

     

При сборке приложения манифест будет добавлен как двоичный ресурс.

## <a name="using-comctl32-version-6-in-control-panel-or-a-dll-that-is-run-by-rundll32exe"></a>С помощью ComCtl32 версии 6 на панели управления или библиотеки DLL, которая запускается с RunDll32.exe

**Чтобы создать манифест и позволить приложению использовать стили оформления.**

1.  Свяжите с ComCtl32. lib и вызовите [**иниткоммонконтролс**](/windows/desktop/api/Commctrl/nf-commctrl-initcommoncontrols).
2.  Добавьте файл с именем YourApp.cpl. manifest в дерево исходного кода, имеющее формат XML-манифеста.
    ```C++
    <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity
        version="1.0.0.0"
        processorArchitecture="*"
        name="CompanyName.ProductName.YourApplication"
        type="win32"
    />
    <description>Your application description here.</description>
    <dependency>
        <dependentAssembly>
            <assemblyIdentity
                type="win32"
                name="Microsoft.Windows.Common-Controls"
                version="6.0.0.0"
                processorArchitecture="*"
                publicKeyToken="6595b64144ccf1df"
                language="*"
            />
        </dependentAssembly>
    </dependency>
    </assembly>
    ```

    

3.  Добавьте манифест в файл ресурсов приложения в качестве идентификатора ресурса 123.

> [!Note]  
> При создании приложения панели управления поместите его в соответствующую категорию. Панель управления теперь поддерживает категоризацию приложений панели управления. Это означает, что приложениям панели управления можно назначать идентификаторы и разделять их на области задач, такие как установка и удаление программ, оформление и темы, а также параметры даты, времени, языка и региональных параметров.

 

## <a name="adding-visual-style-support-to-an-extension-plug-in-mmc-snap-in-or-a-dll-that-is-brought-into-a-process"></a>Добавление поддержки визуального стиля для расширения, подключаемого модуля, оснастки MMC или библиотеки DLL, которая переносится в процесс

Поддержку визуальных стилей можно добавить в расширение, подключаемый модуль, оснастку MMC или библиотеку DLL, которая выполняется в процессе. Например, чтобы добавить поддержку визуальных стилей для оснастки консоли управления (MMC), выполните следующие действия.

1.  Скомпилируйте оснастку с флагом-ДИСОЛАТИОН, поддерживающим \_ \_ поддержку, или вставьте следующую инструкцию перед \# оператором include "Windows. h".

    ```C++
    #define ISOLATION_AWARE_ENABLED 1
    ```

    

    Дополнительные сведения о \_ \_ включении режима изоляции см. в разделе [изоляция компонентов](/windows/desktop/SbsCs/isolating-components).

2.  Включите файл заголовка Common Control в источник оснастки.
    ```C++
    #include <commctrl.h>
    ```

    

3.  Добавьте файл с именем Йоурапп. manifest в дерево источника, использующее формат XML-манифеста.
    ```C++
    <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity
        version="1.0.0.0"
        processorArchitecture="*"
        name="CompanyName.ProductName.YourApplication"
        type="win32"
    />
    <description>Your application description here.</description>
    <dependency>
        <dependentAssembly>
            <assemblyIdentity
                type="win32"
                name="Microsoft.Windows.Common-Controls"
                version="6.0.0.0"
                processorArchitecture="*"
                publicKeyToken="6595b64144ccf1df"
                language="*"
            />
        </dependentAssembly>
    </dependency>
    </assembly>
    ```

    

4.  Добавьте манифест в файл ресурсов оснастки. Дополнительные сведения о добавлении манифеста в файл ресурсов см. [в разделе Использование Comctl32 версии 6 в приложении, использующем расширения, подключаемые модули или библиотеку DLL, которая содержится в процессе](/previous-versions//ms649781(v=vs.85)) .

## <a name="turning-off-visual-styles"></a>Выключение визуальных стилей

Вы можете отключить визуальные стили для элемента управления или для всех элементов управления в окне, вызвав функцию [**SetWindowTheme**](/windows/desktop/api/Uxtheme/nf-uxtheme-setwindowtheme) следующим образом:


```C++
SetWindowTheme(hwnd, L" ", L" ");
```



В предыдущем примере *HWND* — это дескриптор окна, в котором отключаются визуальные стили. После вызова элемент управления визуализируется без визуальных стилей.

## <a name="using-visual-styles-with-html-content"></a>Использование стилей оформления с содержимым HTML

HTML-страницы, которые изменяют свойства каскадные таблицы стилей (CSS), такие как Background или Border, не имеют примененных к ним стилей оформления. Они отображают указанный атрибут CSS. При указании в составе содержимого большинство свойств CSS применяются к элементам, к которым применены визуальные стили.

По умолчанию визуальные стили применяются к встроенным элементам управления HTML на страницах, отображаемых в Microsoft Internet Explorer 6 и более поздних версиях. Чтобы отключить стили оформления для HTML-страницы, добавьте тег META в элемент <head> . Этот метод также применяется к содержимому, упакованному как HTML-приложения (HTA). Чтобы отключить стили оформления, тег META должен иметь следующий вид:


```
<META HTTP-EQUIV="MSThemeCompatible" CONTENT="no">
```



> [!Note]  
> Если параметр браузера и параметр tag не согласуются, страница не будет применять стили оформления. Например, если для тега META задано значение «нет» и браузер настроен на включение визуальных стилей, визуальные стили не будут применены к странице. Однако если в качестве тега браузера или мета задано значение "Да", а другой элемент не указан, будут применены визуальные стили.

 

Визуальные стили могут изменить макет содержимого. Кроме того, при задании определенных атрибутов для встроенных элементов управления HTML, таких как ширина кнопки, может оказаться, что метка кнопки нечитаема при определенных визуальных стилях.

Необходимо тщательно протестировать содержимое с помощью визуальных стилей, чтобы определить, оказывает ли применение визуальных стилей негативное воздействие на содержимое и макет.

## <a name="when-visual-styles-are-not-applied"></a>Когда визуальные стили не применяются

Чтобы избежать применения визуальных стилей к окну верхнего уровня, присвойте окну область, отличную от NULL (**сетвиндовргн**). Система предполагает, что окно с регионом, отличным от NULL, является специализированным окном, в котором не используются стили оформления. Дочернее окно, связанное с окном верхнего уровня, не относящимся к визуальному элементу, может по-прежнему применять стили оформления, даже если в родительском окне нет.

Если вы хотите отключить использование стилей оформления для всех окон в приложении, вызовите [**сетсемеапппропертиес**](/windows/desktop/api/Uxtheme/nf-uxtheme-setthemeappproperties) и не передавайте \_ \_ флагом СТАП Allow unclient. Если приложение не вызывает **сетсемеапппропертиес**, предполагается, что значения флага являются СТАП, \_ разрешающими \_ неклиентские СТАП, разрешить \| \_ \_ элементам управления \| СТАП разрешить доступ к \_ \_ содержимому. Предполагаемые значения приводят к применению визуального стиля к неклиентской области, элементам управления и веб-содержимому.

## <a name="making-your-application-compatible-with-earlier-versions-of-windows"></a>Обеспечение совместимости приложения с более ранними версиями Windows

большая часть архитектуры визуального стиля призвана упростить поставку продукта в более ранних версиях Windows, которые не поддерживают изменение внешнего вида элементов управления. При отправке приложения для нескольких операционных систем учитывайте следующее.

-   в версиях Windows до Windows 8 стили оформления отключены, когда включена высокая контрастность. Для поддержки высокой контрастности устаревшее приложение, поддерживающее стили оформления, должно предоставить отдельный путь к коду для правильной отрисовки элементов пользовательского интерфейса в высокой контрастности. в Windows 8 высокая контрастность является частью стилей оформления; однако приложение Windows 8 (которое включает в себя Windows 8 GUID в разделе совместимости его манифеста приложения) по-прежнему должно предоставлять отдельный путь к коду для правильной визуализации в Windows 7 более ранней версии.
-   Если вы используете функции ComCtl32.dll версии 6, например мозаичного представления или элемента управления связью, необходимо решить, где эти элементы управления недоступны на компьютере пользователя. Версия ComCtl32.dll 6 не является распространяемой.
-   Протестируйте приложение, чтобы убедиться, что вы не полагаетесь на компоненты ComCtl32.dll версии 6 без предварительной проверки текущей версии.
-   Не следует связываться с Укссеме. lib.
-   Напишите код обработки ошибок для экземпляров, если визуальные стили не работают должным образом.
-   Установка манифеста приложения в более ранних версиях не повлияет на отрисовку элементов управления.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Стили оформления](themes-overview.md)
</dt> </dl>

 

 
