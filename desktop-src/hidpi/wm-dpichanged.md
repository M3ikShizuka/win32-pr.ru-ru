---
title: Сообщение WM_DPICHANGED (WinUser. h)
description: Посылается при изменении эффективных точек на дюйм для окна.
ms.assetid: 97C458F2-89CD-45FF-ABEE-F158A3BCE0B8
keywords:
- WM_DPICHANGED высокое разрешение для сообщения
topic_type:
- apiref
api_name:
- WM_DPICHANGED
api_location:
- WinUser.h
api_type:
- HeaderDef
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: aafbce1e784e1f205f0d32e045785125c1fb5aaa
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127170248"
---
# <a name="wm_dpichanged-message"></a>\_Сообщение DPICHANGED WM

Посылается при изменении эффективных точек на дюйм для окна. Значение DPI является коэффициентом масштабирования для окна. Существует несколько событий, которые могут привести к изменению DPI. В следующем списке указаны возможные причины изменения DPI.

-   Окно перемещается на новый монитор с разными DPI.
-   Значение DPI монитора, размещающего окно, изменяется.

Текущее значение DPI для окна всегда равно последнему значению DPI, отправленному **WM \_ DPICHANGED**. Это коэффициент масштабирования, в течение которого окно должно масштабироваться для потоков, которые знают об изменениях DPI.


```C++
#define WM_DPICHANGED       0x02E0
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*wParam* 
</dt> <dd>

[**HIWORD**](/previous-versions/windows/desktop/legacy/ms632657(v=vs.85)) параметра *wParam* содержит значение оси Y нового значения DPI окна. [**Ловорд**](/previous-versions/windows/desktop/legacy/ms632659(v=vs.85)) параметра *wParam* содержит значение оси X нового значения DPI окна. Например, 96, 120, 144 или 192. значения оси X и оси Y идентичны для Windows приложений.

</dd> <dt>

*lParam* 
</dt> <dd>

Указатель на структуру [**Rect**](/windows/desktop/api/windef/ns-windef-rect) , которая предоставляет предлагаемый размер и расположение текущего окна, масштабированного для новых точек на дюйм. Ожидание заключается в том, что приложения будут перемещать окна и изменять их размер в зависимости от предложений, предоставляемых параметром *lParam* при обработке этого сообщения.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Если приложение обрабатывает это сообщение, оно должно вернуть ноль.

## <a name="remarks"></a>Remarks

Это сообщение относится только к **процессам \_ с \_ отслеживанием \_ dpi \_** на уровне монитора или по dpi для потоков, **\_ \_ \_ \_ поддерживающих мониторинг** . Оно может быть получено при определенных изменениях DPI, если окно или процесс верхнего уровня выполняется как неточное **разрешение dpi** или **учитывается dpi системы**, но в таких ситуациях его можно спокойно игнорировать. Дополнительные сведения о различных типах осведомленности см. в разделе [**Обработка \_ dpi \_**](/windows/desktop/api/ShellScalingApi/ne-shellscalingapi-process_dpi_awareness) и отслеживание [**dpi \_**](/windows/desktop/api/windef/ne-windef-dpi_awareness). более старые версии Windows требуют, чтобы поддержка DPI была привязана на уровне приложения. Эти приложения используют сведения о **\_ dpi \_ процесса**. В настоящее время отслеживание DPI привязано к потокам и отдельным окнам, а не ко всему приложению. Эти приложения используют **\_ Распознавание dpi**.

При масштабировании приложения необходимо использовать либо ось X, либо значение по оси Y, так как они совпадают.

Чтобы правильно обрабатывалось это сообщение, необходимо изменить размер и расположение окна на основе предложений *lParam* и [**SetWindowPos**](/windows/desktop/api/winuser/nf-winuser-setwindowpos). Если этого не сделать, окно будет увеличиваться или уменьшаться относительно всех остальных элементов на новом мониторе. Например, если пользователь использует несколько мониторов и перетащилт окно с монитора 96 DPI на монитор 192, размер окна будет вдвое выше, чем у других элементов монитора 192 DPI.

Базовое значение DPI определяется как **пользовательское \_ по умолчанию \_ \_ dpi** , значение которого равно 96. Чтобы определить коэффициент масштабирования для монитора, Возьмите значение DPI и разделите его по значению **\_ \_ \_ DPI по умолчанию на экране пользователя**. В следующей таблице приведены некоторые примеры значений DPI и связанные коэффициенты масштабирования.



| Значение DPI | Процент масштабирования |
|-----------|--------------------|
| 96        | 100 %               |
| 120       | 125%               |
| 144       | 150%               |
| 192       | 200 %               |



 

В следующем примере показан пример обработчика изменений DPI.


```C++
    case WM_DPICHANGED:
    {
        g_dpi = HIWORD(wParam);
        UpdateDpiDependentFontsAndResources();

        RECT* const prcNewWindow = (RECT*)lParam;
        SetWindowPos(hWnd,
            NULL,
            prcNewWindow ->left,
            prcNewWindow ->top,
            prcNewWindow->right - prcNewWindow->left,
            prcNewWindow->bottom - prcNewWindow->top,
            SWP_NOZORDER | SWP_NOACTIVATE);
        break;
    }
```



Следующий код линейно масштабирует значение с 100% (96 точек на дюйм) до произвольного DPI, определенного в *g \_ dpi*.


```C++
    INT iBorderWidth100 = 5;
    iBorderWidth = MulDiv(iBorderWidth100, g_dpi, USER_DEFAULT_SCREEN_DPI);
```



Альтернативный способ масштабирования значения — преобразование значения DPI в коэффициент масштабирования и его использование.


```C++
    INT iBorderWidth100 = 5;
    FLOAT fscale = (float) g_dpi / USER_DEFAULT_SCREEN_DPI;
    iBorderWidth = iBorderWidth100 * fscale;
```



## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|--------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows 8.1 \[ только классические приложения\]<br/>                                         |
| Минимальная версия сервера<br/> | Windows Server 2012 \[Только классические приложения R2\]<br/>                              |
| Заголовок<br/>                   | <dl> <dt>WinUser. h</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**\_Поддержка dpi**](/windows/desktop/api/windef/ne-windef-dpi_awareness)
</dt> <dt>

[**\_поддержка обработки dpi \_**](/windows/desktop/api/ShellScalingApi/ne-shellscalingapi-process_dpi_awareness)
</dt> </dl>

 

