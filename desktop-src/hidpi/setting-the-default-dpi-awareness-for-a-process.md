---
description: Дополнительные сведения см. в статье Настройка отслеживания количества точек на дюйм по умолчанию для процесса.
title: Настройка отслеживания количества точек на дюйм по умолчанию для процесса (Windows)
TOCTitle: Setting the default DPI awareness for a process
ms:assetid: C9488338-D863-45DF-B5CB-7ED9B869A5E2
ms:mtpsurl: https://msdn.microsoft.com/library/Mt846517(v=VS.85)
ms:contentKeyID: 74520139
ms.date: 03/30/2018
ms.topic: article
mtps_version: v=VS.85
ms.openlocfilehash: 52ef4f10ed2f4253c796ae10a57a71d8a7bc4f0d
ms.sourcegitcommit: 9b5faa61c38b2d0c432b7f2dbee8c127b0e28a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2021
ms.locfileid: "122465681"
---
# <a name="setting-the-default-dpi-awareness-for-a-process"></a>Настройка отслеживания количества точек на дюйм по умолчанию для процесса

классические приложения на Windows могут работать в разных режимах определения DPI. Эти режимы позволяют разрешать различные способы масштабирования DPI и могут использовать разные пространства координат. Дополнительные сведения о поддержке DPI см [. в разделе Разработка приложений с высоким разрешением на Windows.](https://msdn.microsoft.com/library/mt843498\(v=vs.85\)) Важно явно задать режим поддержки DPI по умолчанию для процесса, чтобы избежать непредвиденного поведения.

Существует два основных метода указания сведений о DPI по умолчанию для процесса:

1 \) через параметр манифеста приложения

2 \) программным путем через вызов API

Рекомендуется указывать сведения о соответствии процесса по умолчанию для процессов с помощью параметра манифеста. При указании интерфейса API по умолчанию поддержка не рекомендуется.

## <a name="setting-default-awareness-with-the-application-manifest"></a>Настройка осведомленности по умолчанию в манифесте приложения

Существует два параметра манифеста, которые позволяют указать режим поддержки по умолчанию для отслеживания количества точек на дюйм: \<dpiAwareness\> и \<dpiAware\> . \<dpiAware\>была введена в Windows Vista и позволяет установить для процесса по умолчанию только сведения о системе. \<dpiAwareness\>была введена в Windows 10 версии 1607 и позволяет указать упорядоченный список режимов отслеживания количества точек на уровне процесса по умолчанию. это позволяет задать режимы определения количества точек на дюйм для резервного копирования, которые будут использоваться, если приложение запущено в версии Windows не может поддерживать первый режим службы поддержки. в более старых версиях Windows новый \<dpiAwareness\> тег будет проигнорирован. это означает, что можно использовать оба этих параметра манифеста, чтобы включить сценарий, в котором по умолчанию для процесса может быть включена поддержка системы в более ранней версии Windows при Per-Monitor в версиях, превышающих Windows 10 версии 1607. в Windows 10 версии 1607 и в \<dpiAware\> параметр не учитывается, если \<dpiAwareness\> элемент имеется в наличии.

В следующей таблице показано, как задать различные режимы поддержки DPI по умолчанию для процессов с помощью двух параметров манифеста:


| Обработка режима поддержки DPI по умолчанию | Значение <dpiAware> | <dpiAwareness>параметр (Windows 10, версия 1607 и более поздние) | 
|------------------------------------|--------------------|--------------------------------------------------------------|
| связан | <p>Н/д (нет параметра Дпиаваре в манифесте)</p><p>или</p><p>&lt;Дпиаваре &gt; false &lt; /дпиаваре&gt;</p> | <dpiAwareness>связан</dpiAwareness> | 
| С учетом системы | <dpiAware>true</dpiAware> | <dpiAwareness>система</dpiAwareness> | 
| На монитор | <dpiAware>true/PM<dpiAware> | <dpiAwareness>пермонитор</dpiAwareness> | 
| На монитор версии 2 | Не поддерживается | <dpiAwareness>PerMonitorV2</dpiAwareness> | 


 

В приведенном ниже примере показаны \<dpiAwareness\> Параметры и, используемые в одном и том \<dpiAware\> же файле манифеста, для настройки поведения процесса по умолчанию для отслеживания dpi для различных версий Windows.

```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0" xmlns:asmv3="urn:schemas-microsoft-com:asm.v3">
  <asmv3:application>
    <asmv3:windowsSettings>
      <dpiAware xmlns="http://schemas.microsoft.com/SMI/2005/WindowsSettings">true</dpiAware>
      <dpiAwareness xmlns="http://schemas.microsoft.com/SMI/2016/WindowsSettings">PerMonitorV2</dpiAwareness>
    </asmv3:windowsSettings>
  </asmv3:application>
</assembly>
```

## <a name="setting-default-awareness-programmatically"></a>Программное задание осведомленности по умолчанию

Хотя это и не рекомендуется, по умолчанию можно задать отслеживание количества точек на дюйм программным способом. После создания окна (HWND) в процессе изменение режима поддержки DPI больше не поддерживается. Если вы устанавливаете режим поддержки по умолчанию для обработки точек на дюйм как программно, необходимо вызвать соответствующий API перед созданием дескрипторов HWND.

Существует несколько интерфейсов API, которые позволяют указать для процесса сведения о DPI по умолчанию. Текущий рекомендуемый API — [**сетпроцессдпиаваренессконтекст**](https://msdn.microsoft.com/library/mt807676\(v=vs.85\)), так как более старые API предлагают меньше функциональных возможностей.

 


| API | Минимальная версия Windows | Неосведомленность DPI | Учитывать DPI системы | На уровне DPI для каждого монитора | 
|-----|----------------------------|-------------|------------------|-----------------------|
| <a href="/windows/win32/api/winuser/nf-winuser-setprocessdpiaware">сетпроцессдпиаваре</a> | Windows Vista | Недоступно | Сетпроцессдпиаваре () | Недоступно | 
| <a href="/windows/win32/api/shellscalingapi/nf-shellscalingapi-setprocessdpiawareness"><strong>сетпроцессдпиаваренесс</strong></a> | Windows 8.1 | Сетпроцессдпиаваренесс (PROCESS_DPI_UNAWARE) | Сетпроцессдпиаваренесс (PROCESS_SYSTEM_DPI_AWARE) | Сетпроцессдпиаваренесс (PROCESS_PER_MONITOR_DPI_AWARE) | 
| <a href="/windows/win32/api/winuser/nf-winuser-setprocessdpiawarenesscontext"><strong>сетпроцессдпиаваренессконтекст</strong></a> | Windows 10, версия 1607 | Сетпроцессдпиаваренессконтекст (DPI_AWARENESS_CONTEXT_UNAWARE) | Сетпроцессдпиаваренессконтекст (DPI_AWARENESS_CONTEXT_SYSTEM_AWARE) | <p>Сетпроцессдпиаваренессконтекст (DPI_AWARENESS_CONTEXT_PER_MONITOR_AWARE)</p><p>Сетпроцессдпиаваренессконтекст (DPI_AWARENESS_CONTEXT_PER_MONITOR_AWARE_V2)</p> | 


 

## <a name="process-default-vs-thread-default"></a>Процесс-по умолчанию и поток по умолчанию

В этом документе описывается установка по умолчанию для процесса отслеживания DPI. это обусловлено тем, что Windows 10 поддерживала поддержку нескольких режимов разрешения DPI в рамках одного процесса (до Windows 10, весь процесс должен соответствовать режиму поддержки одного dpi). Поддержка выполнения более одного режима поддержки DPI в рамках процесса называется масштабированием DPI в смешанном режиме. При использовании масштабирования DPI в смешанном режиме в пределах процесса каждое окно верхнего уровня может работать в режиме поддержки DPI, который может отличаться от значения по умолчанию для процесса. Если явно не указано иное, каждый поток будет по умолчанию обрабатываться по умолчанию при создании. Дополнительные сведения о масштабировании DPI в смешанном режиме см. в статье [масштабирование в смешанном режиме](https://msdn.microsoft.com/library/mt744321\(v=vs.85\)) .
