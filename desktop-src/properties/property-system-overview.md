---
description: Система свойств Windows — это расширяемая система чтения и записи определений данных, которая обеспечивает единообразный способ представления метаданных об элементах оболочки.
ms.assetid: eb2dc2be-fc53-40aa-81f6-f353ab1d3a57
title: Обзор системы свойств
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dab3a17eacdbaa9a5d0255004ba544b7c3f7ff2b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105702021"
---
# <a name="property-system-overview"></a>Обзор системы свойств

Система свойств Windows — это расширяемая система чтения и записи определений данных, которая обеспечивает единообразный способ представления метаданных об элементах оболочки. Система свойств Windows в Windows Vista и более поздних версиях позволяет хранить и извлекать метаданные для элементов оболочки. Элемент оболочки — это любой отдельный фрагмент содержимого, например файл, папка, электронная почта или контакт. Свойство — это отдельный элемент метаданных, связанный с элементом оболочки. Значения свойств выражаются в виде структуры [**пропвариант**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) .

Этот раздел организован следующим образом:

-   [Введение](#introduction)
-   [Сценарии разработки](#development-scenarios)
-   [Свойства и поиск Windows](#properties-and-windows-search)
-   [Примечание для разработчиков](#note-to-implementers)
-   [Документация системы свойств Windows](#windows-property-system-documentation)
-   [Дополнительные ресурсы](#additional-resources)
-   [См. также](#related-topics)

## <a name="introduction"></a>Введение

Свойства уникально идентифицируются по их каноническому имени (например, `System.Document.LastAuthor` ) и ключу свойства (например, `PKEY_Document_LastAuthor` ). Ключ свойства (PKEY) — это имя части пары "имя-значение", которое состоит из имени PKEY/ПРОПВАРИАНТ или строки или ПРОПВАРИАНТ, где строка является каноническим именем PKEY (например, `System.Document.LastAuthor` ). PKEY — это определение, которое сообщает системе свойств о свойстве все, что необходимо, а значение является фактическим экземпляром свойства. Внутренний PKEY содержит Форматид и propID.

Отдельное свойство состоит из следующих трех частей:

-   Каноническое имя, например `System.Music.Artist` .
-   Описание схемы, которое указывается в формате XML-файла пропдеск и выражается программно через [**ипропертидескриптион**](/windows/desktop/api/Propsys/nn-propsys-ipropertydescription).
-   Значение типа, например имя Сингера.

Описание схемы состоит из сведений о свойстве, таких как имя свойства, тип данных, ограничения, сведения о взаимодействии свойства с представлениями и системой поиска и т. д. Имя и описание схемы определяются глобально и одинаковы для всех элементов и типов. Значение зависит от отдельного элемента. Это значит, что `System.Music.Artist` свойство всегда определено как строка с несколькими значениями, но может иметь другое значение (или вообще не иметь значения) для каждого элемента.

Обработчик свойств преобразует данные, хранящиеся в файле, в структурированную схему, которая распознается и может быть доступна в проводнике Windows, Windows Search и других приложениях. Затем эти системы могут взаимодействовать с обработчиком свойств для записи и чтения свойств в файле и из него. Переведенные данные предоставляются программно и отображаются для пользователя через проводник в различных контекстах, включая представление Details, инфотипс, область сведений, страницы свойств и т. д. Каждый обработчик свойств связан с определенным типом файла, который определяется расширением имени файла. Разработчики должны реализовать обработчик свойств, который создает и использует собственный формат типа файла, например JPG или PNG, или используйте хранилище свойств In-Memory, которое создает и использует двоичный формат MS-ПРОПСТОРЕ.

Система свойств Windows создает абстрактную модель данных, которая предоставляет уровень абстракции из отдельных форматов файлов. Абстрактная модель данных, предоставляемая системой свойств Windows, — это метод чтения и записи расширяемого набора именованных значений, связанных с элементом оболочки. Выражение значения является гибким, поддерживает множество типов данных и является расширяемым, позволяя использовать произвольные данные (**\_ объект VT**) и объекты в качестве значения.

Из-за абстракции можно запрашивать атрибуты или метаданные любого элемента. Примеры элементов, которые могут быть абстрактными, включают Microsoft Office документы, теги ID3, AutoCAD и другое стороннее программное обеспечение. Аналогично, при наличии JPEG-файла можно использовать кодеки. JPEG и EXIF, чтобы прочитать байты файла, чтобы узнать, что такое размеры изображения. Если вместо этого у вас есть PNG-файл, для этого нужен отдельный кодек и другой код. Использование системы свойств Windows позволяет избежать такого рода проблем. Если вы реализуете новый тип файла, то можете подключаться к единообразной абстракции, предлагаемой системой свойств Windows, и указать, как сделать метаданные более потребленными. По этим причинам всегда предпочтительнее использовать общую платформу, предоставляемую системой свойств Windows.

## <a name="development-scenarios"></a>Сценарии разработки

Свойства выражаются производителями и потребителями. В этом контексте производители являются перечнем свойств в системе свойств Windows, а потребители — приложениями (и их разработчиками), которые используют сведения о свойствах из этой системы. В следующей таблице приведены варианты использования и участников системы свойств Windows.



| Использование системы свойств Windows                                                                                                                                                                                            | Участник |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| Стандартный блок, предоставляющий расширяемый реестр описаний свойств, реализацию хранилища свойств в памяти и службы для привязки к обработчикам свойств, преобразования типов и сериализации хранилищ свойств. | Потребители    |
| Приложения, которые хотят считывать и записывать свойства абстрактным способом.                                                                                                                                                       | Потребители    |
| Свойство выполняет инвентаризацию, определяющую новые свойства для системы свойств, определяя схемы пользовательских свойств и разрабатывая собственные обработчики свойств.                                                                          | Производитель    |
| Владельцы форматов файлов, которым требуется разрешить доступ к свойствам, хранящимся в пользовательских форматах файлов.                                                                                                                           | Производитель    |



 

Потребители используют существующие свойства, схемы и обработчики свойств. Свойства, доступные для использования, включают свойства чтения и записи из обработчиков свойств для поддерживаемых типов файлов, а также могут включать некоторые пользовательские свойства. Доступные схемы включают как минимум системную схему, а иногда и другие. Потребитель может создать приложение для использования метаданных и создать представление на основе исполнителя, независимо от того, в каких папках хранятся элементы. Иерархия папок файлов не имеет значения. Например, можно указать все элементы песни определенным Сингера, не заботясь о расположении таких элементов. Этот комплексный, сквозной сценарий не ограничивается системой свойств Windows, но включает несколько различных компонентов, таких как индексирование и папки поиска.

Инвентаризация свойств или сторонних разработчиков — это производители в системе свойств Windows. При подготовке к определению нового свойства сначала проверьте набор свойств, которые определяет Windows. Если вы нашли нужный тип и семантику, которые соответствуют вашим потребностям, используйте это свойство и не изменяйте его. При определении нового пользовательского свойства попробуйте получить соглашение с другими разработчиками, которые могут использовать его, и опубликуйте результат этого соглашения, чтобы он мог присоединиться к сообществу пользователей этого свойства.

Производители могут воспользоваться возможностями проводника Windows. Например, если вы создаете новый формат изображения и реализуете обработчик свойства, новый формат файла станет доступен в проводнике Windows. Пользователи могут помечать свои фотографии и собирать их коллекции фотографий на основе любого свойства в системе свойств Windows. На самом деле, все, что делает оболочкой со свойствами, сторонние разработчики могут делать в своих приложениях. К ним относятся группирование, сортировка, запрос и отображение полных свойств. Взаимодействие с пользователем, предоставляемое проводником Windows, может значительно реализовываться сторонними производителями с общедоступными интерфейсами API. Проводник Windows можно заменить или расширить с помощью этих API-интерфейсов.

С точки зрения приложения, использующего модель данных оболочки, существует множество сценариев, использующих систему свойств Windows. Примерами являются приложения для управления носителями. Основные сценарии системы свойств включают такие сценарии, как чтение свойства ключевого слова фотографии или задание свойства датетакен. Примеры комплексных сценариев интеграции, которые включает система свойств Windows, но для работы которых требуется несколько других компонентов, включая отображение всех изображений или Поиск документа, содержащего ключевое слово.

## <a name="properties-and-windows-search"></a>Свойства и поиск Windows

Свойства служат производителями и потребителями при работе с поиском и индексированием Windows. В Windows Search имеется кэш значений свойств, которые используются в реализации Служба поиска Windows (WSS). Эти значения свойств можно запрашивать программным способом с помощью поставщика OLE DB поиска Windows или с помощью [**исеарчфолдеритемфактори**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-isearchfolderitemfactory), который представляет элементы в результатах поиска и представлениях на основе запросов. Затем поиск Windows собирает и сохраняет свойства, созданные обработчиками фильтров или обработчиками свойств при индексировании элемента, такого как документ Word. Это хранилище отбрасывается и перестраивается при перестроении индекса.

> [!Note]  
> Помните, что при повторной регистрации схемы изменения, внесенные в атрибуты ранее определенных свойств, могут не рассматриваться в качестве индексатора. Решением может быть перестроение индекса или появление новых свойств, отражающих изменения вместо обновления старых (не рекомендуется). Дополнительные сведения см. в подразделе " [Примечание для разработчиков](#note-to-implementers) " Далее в этой статье.

 

Например, разработчик, создающий приложение мультимедиа, хочет показать пользователям приложения всю доступную музыку по определенному исполнителю. Приложение предоставит пользователю список доступных исполнителей, а затем создаст список всех доступных музыкальных файлов по исполнителю, выбранному пользователем. Или конечному пользователю может потребоваться выполнить запрос для? исполнителя: Бисовен? и предоставить полный список доступных свойств в процессе поиска. В этом примере используется пространство имен оболочки, обработчики свойств и/или запрос индекса одним из следующих элементов:

-   Источник данных оболочки.
-   Поставщик OLE DB.
-   Файл сохраненного поиска (. Search-MS), который используется для инициации запроса путем перехода к файлу поиска в проводнике Windows или привязки к [**ишеллфолдер**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellfolder) программным способом.

> [!Note]  
> Несмотря на то `System.Kind` , что свойство не участвует в этом сценарии приложения мультимедиа, его можно использовать для создания запроса, возвращающего все файлы. Search-MS в определенной области.

 

Предпочтительный способ доступа к API поиска и создания приложений Windows Search — через источник данных оболочки. [**Исеарчфолдеритемфактори**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-isearchfolderitemfactory) — это компонент, который может создавать экземпляры источника данных папки поиска, т. е. "виртуальный" источник данных, предоставляемый оболочкой, который может выполнять запросы к другим источникам данных в пространстве имен оболочки и перечислять результаты. Это можно сделать либо с помощью индексатора, либо путем перечисления и проверки элементов в указанных областях вручную.

Сторонние разработчики могут создавать приложения, которые используют данные в индексе через программные запросы, и могут расширять данные в индексе для пользовательских файлов и типов элементов, индексируемых службой поиска Windows. Если необходимо отобразить результаты запроса в проводнике Windows, необходимо реализовать источник данных оболочки, прежде чем можно будет создать обработчик протокола для расширения индекса. Однако если все запросы будут программно (например, OLE DB) и интерпретироваться кодом приложения? s, а не оболочкой, то пространство имен оболочки по-прежнему является предпочтительным, но не является обязательным. Для получения сведений о содержимом файлов, таких как элементы в базах данных или пользовательские типы файлов, необходим обработчик протокола. Хотя поиск Windows может индексировать имя и свойства файла, Windows не содержит сведений о содержимом файла. В результате такие элементы не могут индексироваться или быть представлены в оболочке Windows. Реализуя пользовательский обработчик протокола, вы можете предоставить эти элементы. Список обработчиков, определяемых сценарием разработчика, которые вы пытаетесь получить, см. в разделе «Обзор обработчиков» в [Windows Search как платформа разработки](../search/-search-3x-wds-development-ovr.md).

> [!Note]  
> Источник данных оболочки иногда называют расширением пространства имен оболочки. Обработчик иногда называют расширением оболочки или обработчиком расширения оболочки.

 

## <a name="note-to-implementers"></a>Примечание для разработчиков

Из-за потенциальных проблем, которые может иметь индексатор при использовании схемы системы свойств, очень важно определить атрибуты внимательно и стратегически для первого выпуска схемы. Любые изменения атрибутов (тип, ширина столбца, будь то индексибле) не будут отражаться в базе данных после регистрации схемы. Единственным способом определения этих изменений после регистрации схемы в системе может быть либо перестроение индекса, а затем регистрация новой схемы или регистрация схемы, а затем создание нового свойства для каждого последующего выпуска. Например, `PKEY_GroupName_PropertyNameV2` `PKEY_GroupName_PropertyNameV3` и т. д. Не рекомендуется создавать новые свойства таким образом, поскольку несколько внешних столбцов могут повлиять на производительность системы.

## <a name="windows-property-system-documentation"></a>Документация системы свойств Windows

Оставшаяся часть этой документации содержит следующие разделы.

-   [Руководством разработчика системы свойств Windows](property-system-developer-s-guide.md)

    Подробное описание реализации основных сценариев разработки с использованием системы свойств Windows.

-   [Справочник по свойствам системы](property-system-reference.md)

    Документирует [Свойства Windows](props.md), [схему описания свойств](property-description-schema.md), [интерфейсы](interfaces.md), [функции](functions.md), [структуры](structures.md)и [константы, перечисления и флаги](constants--enumerations--and-flags.md) системы свойств Windows.

-   [Образцы кода системы свойств](property-system-code-samples.md)

    Содержит описание примеров, демонстрирующих использование системы свойств Windows.

## <a name="additional-resources"></a>Дополнительные ресурсы

-   Дополнительные сведения о повторном использовании хранилища свойств In-Memory см. в разделе [инициализация обработчиков свойств](building-property-handlers-property-handlers.md) и [**пскреатемеморипропертисторе**](/windows/desktop/api/Propsys/nf-propsys-pscreatememorypropertystore).
-   Описание формата двоичных файлов в хранилище свойств Майкрософт см. в разделе [ \[ MS \_ пропсторе \] ](/openspecs/windows_protocols/ms-propstore/39ea873f-7af5-44dd-92f9-bc1f293852cc).
-   Связь между поиском и индексацией Windows и расширением индекса описывается в следующих разделах, посвященных поиску в Windows.
    -   [Разработка обработчиков фильтров для поиска Windows](../search/-search-ifilter-conceptual.md)
    -   [Разработка обработчиков протоколов для поиска Windows](../search/-search-3x-wds-phaddins.md)
    -   [Разработка обработчиков свойств для поиска Windows](../search/-search-3x-wds-extidx-propertyhandlers.md)
    -   Для загрузки Windows 7 или обновления пакета SDK для Windows Vista см. [Windows SDK](https://msdn.microsoft.com/windowsvista/bb980924.aspx).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Руководством разработчика системы свойств Windows](property-system-developer-s-guide.md)
</dt> <dt>

[Справочник по свойствам системы](property-system-reference.md)
</dt> <dt>

[Образцы кода системы свойств](property-system-code-samples.md)
</dt> </dl>

 

 
