---
title: Блокировка команд
description: Для сохранения целостности операций некоторые команды TPM не могут выполняться программным обеспечением на платформе.
ms.assetid: 47402a4a-5f8d-4648-b3ea-06c95b2a1fc1
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3f8b9a302f12e7838240ee8bfeac1ea78a3884a1
ms.sourcegitcommit: f0ca63c18dc52c357d3398af7be766d2bdd40be7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2020
ms.locfileid: "104412744"
---
# <a name="command-blocking"></a>Блокировка команд

Для сохранения целостности операций некоторые команды TPM не могут выполняться программным обеспечением на платформе. Например, некоторые команды выполняются только системным программным обеспечением. Когда TBS блокирует команду, при необходимости возвращается ошибка. По умолчанию TBS блокирует команды, которые могут повлиять на конфиденциальность, безопасность и стабильность системы. TBS также предполагает, что другие части программного стека могут ограничить доступ к определенным командам для полномочных сущностей.

Для команд TPM версии 1,2 существует три списка заблокированных команд: список, контролируемый групповой политикой, список, управляемый локальными администраторами, и список по умолчанию. Команда доверенного платформенного модуля блокируется, если она находится в любом из списков. Однако существуют флаги групповой политики, позволяющие TBS игнорировать локальный список и список по умолчанию. Флаги групповой политики можно изменить напрямую или получить через редактор объектов групповой политики.

> [!Note]  
> Список локально заблокированных команд не сохраняется после обновления операционной системы. Команды, заблокированные в списке групповая политика, сохраняются.

 

Для команд TPM версии 2,0 логика для блокировки инвертирована; в нем используется список разрешенных команд. Эта логика автоматически блокирует команды, которые не были известны при первом внесении списка. При добавлении команд в спецификацию TPM после доставки версии Windows эти новые команды автоматически блокируются. Только обновление реестра добавит эти новые команды в список разрешенных команд.

Начиная с Windows 10 1809 (Windows Server 2019), разрешенные команды TPM 2,0 больше не могут управляться через параметры реестра. В этих версиях Windows 10 разрешенные команды TPM 2,0 исправлены в драйвере TPM. Команды TPM 1,2 по-прежнему могут блокироваться и разблокированы с помощью изменений в реестре. 

## <a name="direct-registry-access"></a>Прямой доступ к реестру

Флаги групповая политика находятся в разделе реестра **hKey \_ Local \_ Machine** \\ **Software** \\ **Policies**( \\ **Microsoft** \\ **TPM** \\ **блоккедкоммандс**).

Чтобы определить, какие списки следует использовать для блокирования команд TPM, в качестве логических флагов используются два значения **типа DWORD** :

-   "Игноредефаултлист"

    Если задано (значение существует и не равно нулю), то TBS игнорирует список заблокированных команд по умолчанию.

-   "Игнорелокаллист"

    Если задано (значение существует и не равно нулю), то TBS игнорирует список локальных заблокированных команд.

## <a name="group-policy-object-editor"></a>Редактор объектов групповой политики

**Доступ к редактору объектов групповая политика**

1.  Щелкните **Запуск**.
2.  Нажмите кнопку **Запустить**.
3.  В окне **Открыть** введите **gpedit.msc**. Нажмите кнопку **ОК**. Откроется редактор объектов групповая политика.
4.  Разверните узел **Конфигурация компьютера**.
5.  Разверните **Административные шаблоны**.
6.  Разверните узел **система**.
7.  Разверните узел **доверенный платформенный модуль (TPM) службы**.

Списки конкретных заблокированных команд TPM 1.2 можно изменять непосредственно в следующих расположениях.

-   Список групповых политик:

    ```
    HKEY_LOCAL_MACHINE
       Software
          Policies
             Microsoft
                Tpm
                   BlockedCommands
                      List
    ```

-   Локальный список:

    ```
    HKEY_LOCAL_MACHINE
       SYSTEM
          CurrentControlSet
             Services
                SharedAccess
                   Parameters
                      Tpm
                         BlockedCommands
                            List
    ```

-   Список по умолчанию:

    ```
    HKEY_LOCAL_MACHINE
       Software
          Microsoft
             Tpm
                BlockedCommands
                   List
    ```

В каждом из этих разделов реестра имеется список значений реестра с \_ типом reg SZ. Каждое значение представляет собой Заблокированную команду TPM. Каждый раздел реестра содержит поле "имя значения" и поле "данные значения". Оба поля ("имя значения" и "данные значения") должны точно соответствовать десятичному значению порядкового номера команды TPM, который будет заблокирован.

Список конкретных разрешенных команд TPM 2,0 можно изменить непосредственно в следующем расположении. В разделе реестра содержится список значений реестра с \_ типом DWORD. Каждое значение представляет разрешенную команду TPM 2,0. Каждое значение реестра имеет **имя** и поле **значения** . **Имя** соответствует шестнадцатеричному порядковому номеру команды TPM 2,0, который должен быть разрешен. **Значение** равно 1, если команда разрешена. Если порядковый номер команды отсутствует или имеет значение 0, команда будет заблокирована.

-   Список по умолчанию:

    ```
    HKEY_LOCAL_MACHINE
       Software
          Microsoft
             Tpm
                AllowedW8Commands
                   List
    ```

Для Windows 8, Windows Server 2012 и более поздних версий разделы реестра **блоккедкоммандс** и **AllowedW8Commands** , соответственно, определяют заблокированные или разрешенные команды TPM для учетных записей администратора. Учетные записи пользователей имеют список заблокированных или разрешенных команд TPM в разделах реестра **блоккедусеркоммандс** и **AllowedW8UserCommands** соответственно. В Windows 10 в версии 1607 появились новые разделы реестра для приложений AppContainer: **блоккедаппконтаинеркоммандс** и **AllowedW8AppContainerCommands**.

 

 




