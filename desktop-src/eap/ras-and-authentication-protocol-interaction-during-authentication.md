---
title: Взаимодействие протокола точки доступа и проверки подлинности во время проверки подлинности
description: Функция Расеапмакемессаже управляет большей частью взаимодействия между протоколом проверки подлинности и точкой доступа (AP).
ms.assetid: edc128e0-3104-4df9-80f4-b2aebcfe1087
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e486e3a10e323f28bc2f6fef4c131acfc095b48
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104069844"
---
# <a name="access-point-and-authentication-protocol-interaction-during-authentication"></a>Взаимодействие протокола точки доступа и проверки подлинности во время проверки подлинности

Функция [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) управляет большей частью взаимодействия между протоколом проверки подлинности и точкой доступа (AP). **Расеапмакемессаже** обрабатывает входящие пакеты EAP и создает пакеты EAP для передачи удаленному одноранговому узлу. Он также обрабатывает события, такие как время ожидания и завершение проверки подлинности.

Если сообщение получено от удаленного узла, то служба проверки подлинности AP вызывает [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), передавая указатель на полученное сообщение в параметре *прецеивепаккет* .

Если служба вызывает [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) с параметром *прецеивепаккет* , для которого задано **значение NULL**, то AP либо запускает диалоговое окно с помощью протокола проверки подлинности, либо запрашивает, что протокол повторно отправляет последний пакет. Протокол проверки подлинности должен определять, какое действие служба принимает в зависимости от состояния и контекста сообщения.

При возврате из [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85))значение члена **Action** в структуре [**\_ \_ вывода PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) показывает, какое действие использует служба проверки подлинности. Член **действия** принимает значения из перечислимого [**типа \_ \_ действия PPP EAP**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) .

Если **Action** имеет **значение еапактион \_ Send**, **Еапактион \_ сенданддоне**, **еапактион \_ сендвистимеаут** или **еапактион \_ сендвистимеаутинтерактиве**, служба передает пакет, на который указывает параметр *pSendPacket* , удаленному одноранговому узлу.

Значение **еапактион \_ сендвистимеаут** обеспечивает время ожидания, после которого служба проверки подлинности считает, что ссылка была потеряна, и отключает сеанс.

Значение **еапактион \_ сендвистимеаутинтерактиве** допускает неограниченное время ожидания. Средство проверки подлинности должно использовать это значение при ожидании ввода пользователем данных на клиенте. Это время ожидания позволяет пользователю неопределенный промежуток времени для выполнения требуемых входных данных.

Если **Action** имеет **значение \_ еапактион сендвистимеаут** или **еапактион \_ сендвистимеаутинтерактиве**, протокол проверки подлинности должен установить в качестве значения параметра **двидекспектед** в структуре [**\_ \_ вывода PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) идентификатор следующего пакета, ожидаемого от удаленного узла. Независимо от того, соответствует ли следующий пакет, полученный от узла, этому значению, служба проверки подлинности передает пакет протоколу проверки подлинности в последующем вызове [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)). Протокол проверки подлинности может отбросить пакет автоматически, просто возвращая **ошибку \_ PPP \_ Недопустимый \_ пакет**. Если пакет с ожидаемым идентификатором не получен в течение заданного периода ожидания, служба проверки подлинности по-прежнему вызывает **расеапмакемессаже**. В этом случае вызов выполняется с параметром *прецеивепаккет* , установленным в **значение NULL**, чтобы указать, что предыдущий пакет необходимо отправить повторно.

Если участник **Action** — **Еапактион \_ done** или **еапактион \_ сенданддоне**, служба проверки подлинности просматривает член **дваусресулткоде** [**вывода PPP \_ EAP \_**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output). Если **дваусресулткоде** не является \_ ошибкой, проверка подлинности прошла удачно. Если **дваусресулткоде** не является значением, отличным от \_ ошибки, проверка подлинности не удалась. Код ошибки, возвращенный для случая сбоя, должен поступать из Расеррор. h, Мпреррор. h или Winerror. h. Возможные коды возврата включают, но не ограничиваются следующим:

-   Ошибка \_ без \_ разрешения на подключение \_
-   Ошибка \_ паролей с \_ истекшим сроком действия
-   Ошибка \_ acct \_ отключена
-   ОШИБКА с \_ ограниченным \_ \_ временем входа
-   \_Внутренняя ошибка проверки подлинности \_

В случае, когда **действие** **Еапактион \_ Готово** или **еапактион \_ сенданддоне**, элемент **пусераттрибутес** должен указывать на атрибуты, переопределяющие атрибуты того же типа, которые были переданы серверу при вызове [**расеапбегин**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).

Протокол проверки подлинности на сервере может запрашивать, что служба проверки подлинности вызывает текущий поставщик проверки подлинности, возвращая **еапактион \_ Authenticate** в элементе **Action** в [**\_ \_ выходных данных PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output). В этом случае указатель **пусераттрибутес** в **\_ \_ выходных данных PPP EAP** будет иметь только те атрибуты, которые были созданы протоколом проверки подлинности на сервере. Он не включает атрибуты, которые были переданы на сервер при вызове [**расеапбегин**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)). Поставщик проверки подлинности не требует этих исходных атрибутов, так как учетные данные для проверки подлинности находятся в самом сообщении EAP, а не в отдельном атрибуте RADIUS. Когда служба проверки подлинности реагирует на **действие \_ проверки** подлинности еапактион, **пусераттрибутес** в [**\_ \_ входе PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), указывает на все атрибуты, созданные во время проверки подлинности. Эти атрибуты возвращаются в протокол проверки подлинности на клиенте.

Если протокол проверки подлинности использует **\_ проверку** подлинности еапактион, то поставщик проверки подлинности ВЫПОЛНЯЕТ PAP или MD5-CHAP. Этот метод проверки подлинности можно использовать только с клиентами Windows.

Если протокол проверки подлинности выполняет проверку подлинности пользователя без использования поставщика проверки подлинности, то не требуется, чтобы протокол задавал **действие** в **еапактион \_ Authenticate**. Примером такого случая является EAP-Transport безопасность уровня (TLS).

Пакет EAP Success — это неподтвержденный пакет. Таким образом, сервер может быть потерян и не передаваться на него. Если служба проверки подлинности на клиенте получает пакет протокола управления сетями (NCP), то служба проверки подлинности на стороне сервера продолжает работу, как будто проверка подлинности прошла успешно. Это происходит потому, что сервер перешел на фазу NCP протокола РРР. Соответственно, служба проверки подлинности вызывает [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) с членом **Фсукцесспаккетрецеивед** структуры [**\_ \_ ввода PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) , установленным в **значение true**.

В ходе сеанса проверки подлинности протоколу проверки подлинности может потребоваться взаимодействие непосредственно с пользователем на клиенте. Поставщик протокола проверки подлинности может предоставить интерактивный пользовательский интерфейс для этой цели. Протокол проверки подлинности может запросить отображение интерактивного пользовательского интерфейса для службы, задав элементы **финвокеинтерактивеуи**, **пуиконтекстдата** и **двсизеофуиконтекстдата** в [**выходной структуре \_ PPP \_ EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) . Дополнительные сведения об использовании интерактивного пользовательского интерфейса см. в разделе [интерактивный пользовательский интерфейс](interactive-user-interface.md).

Протокол проверки подлинности должен отображать пользовательский интерфейс только через механизм, описанный в разделе [интерактивный пользовательский интерфейс](interactive-user-interface.md). Если протокол проверки подлинности отображает пользовательский интерфейс, то поток PPP блокируется до закрытия пользовательского интерфейса.

Если во время процесса проверки подлинности [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) возвращает любое значение, отличное от " **нет \_ ошибок** " или " **Ошибка \_ PPP \_ Недопустимый \_ пакет**", сеанс отключается, а ошибка заносится в журнал (на сервере) или отображается пользователю (на клиенте).

 

 