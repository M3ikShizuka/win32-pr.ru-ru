---
description: CNG имеет следующие возможности.
ms.assetid: 400a2b6e-6bbe-4ba4-abde-a2f625007517
title: Функции CNG
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 434c72075c04b0c280c85831ca78d930c0fcc047de19609d11764bcf63ddad56
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118908451"
---
# <a name="cng-features"></a>Функции CNG

CNG имеет следующие возможности.

-   [Гибкость шифрования](#cryptographic-agility)
-   [Сертификация и соответствие требованиям](#certification-and-compliance)
-   [Поддержка пакета Suite B](#suite-b-support)
-   [Поддержка прежних версий](#legacy-support)
-   [Поддержка режима ядра](#kernel-mode-support)
-   [Аудит](#auditing)
-   [Заменяемые генераторы случайных чисел](#replaceable-random-number-generators)
-   [Потокобезопасность](#thread-safety)
-   [Режим работы](#mode-of-operation)

## <a name="cryptographic-agility"></a>Гибкость шифрования

Одной из ключевых особенностей CNG является криптографическая гибкость, иногда называемая независимым от криптографии. Однако для этого требуется преобразовать реализацию протоколов, таких [*SSL как протоколы*](/windows/desktop/SecGloss/s-gly) [*SSL или TLS, CMS (*](/windows/desktop/SecGloss/t-gly) S/MIME), IPsec, Kerberos и т. д., в CNG. На уровне CNG было необходимо обеспечить подстановку и возможность обнаружения для всех типов алгоритмов (симметричные, асимметричные, хэш-функции), генерации случайных чисел и других служебных функций. Изменения на уровне протокола являются более значимыми, так как во многих случаях API протоколов необходимы для добавления выбранных алгоритмов и других возможностей гибкости, которые ранее не существовали.

CNG впервые доступен в Windows Vista и позиционируется для замены существующих применений [*CryptoAPI*](/windows/desktop/SecGloss/c-gly) во всем стеке программного обеспечения майкрософт. Сторонние разработчики найдут в CNG множество новых функций, включая:

-   Новая система настройки шифрования, поддерживающая лучшую гибкость шифрования.
-   Детализированная абстракция для хранилища ключей (и разделение хранилища от операций алгоритма).
-   Изоляция процессов для операций с долгосрочными ключами.
-   Заменяемые генераторы случайных чисел.
-   Сброс ограничений на экспорт.
-   Безопасность потоков во всем стеке.
-   Криптографический API в режиме ядра.

Кроме того, CNG поддерживает все необходимые алгоритмы Suite B, включая шифрование на основе [*эллиптических*](/windows/desktop/SecGloss/e-gly) кривых (ECC). Существующие приложения CryptoAPI продолжат работать, как только CNG становится доступным.

## <a name="certification-and-compliance"></a>Сертификация и соответствие требованиям

CNG проверяется на федеральный стандарт обработки информации (FIPS) 140-2 и является частью цели оценки Windows сертификации общего критерия. CNG был разработан для использования в качестве компонента в проверенной системе уровня FIPS 2.

CNG соответствует требованиям общего критерия, сохраняя и используя длинные ключи в безопасном процессе.

## <a name="suite-b-support"></a>Поддержка пакета Suite B

Важной функцией CNG является поддержка алгоритмов Suite B. В феврале 2005 г. Агентство национальной безопасности (NSA) США объявило координированный набор симметричного шифрования, асимметричное секретное соглашение (также известный как обмен ключами), цифровую подпись и хэш-функции для будущего использования правительства США, именуемого *Suite B*. NSA объявил о том, что сертифицированные реализации Suite B могут и использоваться для защиты информации, обозначенной как основные секретные, секретные и конфиденциальные сведения, которые в прошлом были описаны как конфиденциальные, но не классифицированные. По этой причине поддержка Suite B очень важна для поставщиков программного обеспечения и системных интеграторов, а также для корпорации Майкрософт.

Все алгоритмы Suite B являются общеизвестными. Они были разработаны за пределами области государственных органов, исторически сопоставленные с разработкой алгоритма шифрования. В этом же периоде некоторые европейские страны и регионы также предложили те же требования Suite B для защиты информации.

криптография Suite B рекомендует использовать эллиптическую кривую Diffie-Hellman (ECDH) во многих существующих протоколах, таких как протокол IKE (IKE, в основном используется в IPsec [*), tls*](/windows/desktop/SecGloss/t-gly) и защищенный mime (S/mime).

CNG включает поддержку набора B, который распространяется на все необходимые алгоритмы: AES (все размеры ключей), Семейство SHA-2 (SHA-256, SHA-384 и SHA-512) для алгоритмов хэширования, ECDH и DSA (ECDSA) на основе стандартных кривых стандарта NIST P-256, P-384 и P-521. для поставщиков алгоритмов майкрософт, поставляемых с Windows Vista, не поддерживаются двоичные кривые, кривые коблитз, пользовательские простые кривые и эллиптическая кривая менезес-Qu-ванстоне (екмкв).

## <a name="legacy-support"></a>Поддержка прежних версий

CNG обеспечивает поддержку текущего набора алгоритмов в [*CryptoAPI*](/windows/desktop/SecGloss/c-gly) 1,0. Все алгоритмы, которые в настоящее время поддерживаются в *CryptoAPI* 1,0, по-прежнему будут поддерживаться в CNG.

## <a name="kernel-mode-support"></a>Поддержка режима ядра

CNG поддерживает шифрование в режиме ядра. Одни и те же API-интерфейсы используются как в ядре, так и в пользовательском режиме для полной поддержки криптографических функций. Как SSL/TLS, так и IPsec работают в режиме ядра в дополнение к процессам загрузки, которые будут использовать CNG. Не все функции CNG могут быть вызваны из режима ядра. В справочном разделе по функциям, которые не могут быть вызваны из режима ядра, будет явно указано, что функция не может быть вызвана из режима ядра. В противном случае все функции CNG могут быть вызваны из режима ядра, если вызывающий объект работает на **пассивном \_ уровне** [*IRQL*](/windows/desktop/SecGloss/i-gly). Кроме того, некоторые функции CNG в режиме ядра могут быть вызваны на **\_ уровне диспетчеризации IRQL** в зависимости от возможностей поставщика.

Интерфейс поставщика поддержки безопасности ядра (Майкрософт) (Ksecdd.sys) — это программный модуль шифрования, основанный на уровне ядра Windows. Ksecdd.sys запускается как драйвер экспорта в режиме ядра и предоставляет службы шифрования через задокументированные интерфейсы для компонентов ядра. Единственным встроенным алгоритмом поставщика (Майкрософт), который не поддерживается Ksecdd.sys, является DSA.

**Windows Server 2008 и Windows Vista:** CNG не поддерживает подключаемые алгоритмы и поставщики в режиме ядра. Единственными поддерживаемыми алгоритмами шифрования, доступными в режиме ядра, являются реализации, предоставляемые корпорацией Майкрософт через интерфейсы API CNG в режиме ядра.

## <a name="auditing"></a>Аудит

Для соблюдения некоторых требований к общему критерию, помимо обеспечения полной безопасности, многие действия, происходящие на уровне CNG, подлежат аудиту в поставщике хранилища ключей Майкрософт (KSP). Для создания записей аудита в журнале безопасности KSP Майкрософт соблюдает следующие рекомендации.

-   Аудит ошибок создания ключей и пар ключей, включая сбои самотестирования, должен проводиться.
-   Необходимо провести аудит импорта и экспорта ключей.
-   Аудит сбоев уничтожения ключей должен проводиться.
-   Необходимо проводить аудит постоянных ключей, когда они записываются в файлы и считываются из них.
-   Необходимо провести аудит сбоев при проверке согласованности между парами.
-   Аудит ошибок проверки секретного ключа, если таковые имеются, должен проводиться, например, проверки четности ключей 3DES.
-   Сбои при шифровании, расшифровке, хэшировании, подписи, проверке, обмене ключами и создании случайных чисел должны быть проверены.
-   Необходимо проводить аудит самопроверок шифрования.

Как правило, если у ключа нет имени, это эфемерный ключ. Эфемерный ключ не сохраняется, и KSP Майкрософт не создает записи аудита для временных ключей. KSP Майкрософт создает записи аудита в пользовательском режиме только в процессе LSA. Записи аудита не создаются в режиме ядра CNG. Администраторам необходимо настроить политику аудита для получения всех журналов аудита KSP из журнала безопасности. Для настройки дополнительных аудитов, создаваемых KSP, администратор должен запустить следующую командную строку:

**auditpol/Set/субкатегори: "другие системные события"/сукцесс: enable/фаилуре: enable**

## <a name="replaceable-random-number-generators"></a>Заменяемые генераторы случайных чисел

Еще одно улучшение, предоставляемое CNG, — это возможность заменить генератор случайных чисел по умолчанию (РНГ). В CryptoAPI можно предоставить альтернативный РНГ в составе поставщика служб шифрования (CSP), но невозможно перенаправить базовый CSP Майкрософт для использования другого РНГ. CNG позволяет явно указывать определенный РНГ для использования в определенных вызовах.

## <a name="thread-safety"></a>Потокобезопасность

Любые функции, изменяющие одну и ту же область памяти в то же время (критические секции) при вызове из отдельных потоков, не являются потокобезопасными.

## <a name="mode-of-operation"></a>Режим работы

CNG поддерживает пять режимов операций, которые можно использовать с симметричными блочными шифрами через API-интерфейсы шифрования. Эти режимы и их поддержка перечислены в следующей таблице. Режим работы можно изменить, задав свойство [**\_ \_ режима цепочки BCRYPT**](cng-property-identifiers.md) для поставщика алгоритма с помощью функции [**бкриптсетпроперти**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) .



| Режим работы           | \_Значение режима цепочки BCRYPT \_ | Алгоритмы              | Стандартный  |
|-----------------------------|------------------------------|-------------------------|-----------|
| ECB (Electronic режимом)   | **\_режим цепочки BCRYPT \_ \_ ECB** | Симметричные блочные шифры | SP800 — 38A |
| CBC (цепочки блоков шифра) | **\_режим цепочки BCRYPT \_ \_ CBC** | Симметричные блочные шифры | SP800 — 38A |
| CFB (отзыв шифра)       | **\_CFB режим цепочки BCRYPT \_ \_** | Симметричные блочные шифры | SP800 — 38A |
| CCM (счетчик с CBC)      | **\_CCM в \_ режиме ЦЕПОЧКи BCRYPT \_** | AES                     | SP800 — 38C |
| GCM (режим Галоис/Counter)   | **\_gcm в \_ режиме ЦЕПОЧКи BCRYPT \_** | AES                     | SP800 — 38D |



 

> [!Note]  
> в Windows Vista определяются только режимы ECB, CBC и CFB. для GCM и CCM требуется Windows Vista с пакетом обновления 1 (SP1) или Windows Server 2008.

 

 

 
