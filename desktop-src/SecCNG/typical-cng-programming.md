---
description: API CNG реализует расширяемую модель поставщика, которая позволяет загрузить поставщик, указав необходимый криптографический алгоритм, а не конкретный поставщик.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Типичное программирование CNG
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1cd45c68d7c34c3815008690b49cabfefff437222b29512abbf858cf3b370f1
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118905525"
---
# <a name="typical-cng-programming"></a>Типичное программирование CNG

API CNG реализует расширяемую модель поставщика, которая позволяет загрузить поставщик, указав необходимый криптографический алгоритм, а не конкретный поставщик. Преимущество заключается в том, что поставщик алгоритма можно заменить или обновить, и вам не придется изменять код каким-либо способом для использования нового поставщика. Кроме того, если в будущем некоторый алгоритм определен как небезопасный, более безопасная версия этого алгоритма может быть установлена без влияния на код. Для большинства API-интерфейсов CNG требуется поставщик или объект, созданный поставщиком.

Ниже приведены типичные действия, связанные с использованием API CNG для криптографических операций шифрования.

1.  Открытие поставщика алгоритма
2.  Получение или установка свойств алгоритма
3.  Создание или импорт ключа
4.  Выполнение криптографических операций
5.  Закрытие поставщика алгоритма

Дополнительные сведения см. в разделе примеры программирования.

## <a name="opening-the-algorithm-provider"></a>Открытие поставщика алгоритма

Функция [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) предоставляет обработчик поставщика алгоритмов, который используется в последующих API-интерфейсах CNG, таких как [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) или [**бкриптженератекэйпаир**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).

## <a name="getting-or-setting-algorithm-properties"></a>Получение или установка свойств алгоритма

Для получения сведений о реализации алгоритма, например размера ключа или текущего режима работы, можно использовать маркер поставщика алгоритма. Для получения конкретных свойств используется функция [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) .

Также можно изменить свойства алгоритма. Например, если вы хотите использовать цепочку блочных шифров в стандарте AES, задайте для **свойства \_ \_ режим цепочки BCRYPT** алгоритма AES значение **BCrypt \_ цепочки \_ в \_ ECB**; свойство назначается всем ключам AES, созданным с помощью этого обработчика алгоритма, без необходимости настройки каждого ключа AES. Для изменения этих свойств используется функция [**бкриптсетпроперти**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) .

## <a name="creating-or-importing-a-key"></a>Создание или импорт ключа

В зависимости от типа используемого алгоритма может потребоваться создать или загрузить ключ. Например, функция [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) принимает маркер ключа для первого параметра. Если требуется, чтобы функция зашифрует данные с помощью алгоритма симметричного шифрования, такого как AES, сначала необходимо получить ключ. Получение ключа зависит от типа используемого алгоритма и источника ключа.

Вы можете создать временные ключи с помощью функций [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) и [**бкриптженератекэйпаир**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) . Вы также можете импортировать временные ключи из большого двоичного объекта памяти с помощью функций [**бкриптимпорткэй**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) и [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .

Для сохраненных ключей используются функции хранилища ключей, чтобы загрузить поставщик хранилища ключей, а затем создать или загрузить ключи. Эти функции также можно использовать для создания или загрузки временных ключей путем передачи **значения NULL** для любых имен контейнеров. дополнительные сведения о функциях хранилища ключей см. в разделе [CNG key служба хранилища functions](cng-key-storage-functions.md).

## <a name="performing-cryptographic-operations"></a>Выполнение криптографических операций

Теперь все готово для выполнения криптографической операции, например для шифрования или расшифровки данных с помощью функций [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) или [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) соответственно.

## <a name="closing-the-algorithm-provider"></a>Закрытие поставщика алгоритма

Если поставщик больше не нужен, необходимо передать этот обработчик функции [**бкриптклосеалгорисмпровидер**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) , чтобы закрыть поставщик. В результате поставщик освобождает все ресурсы, выделенные для этого экземпляра поставщика алгоритма. После закрытия обработчика поставщика его нельзя использовать повторно.

Загрузка поставщика может быть достаточно трудоемким процессом. Поэтому следует кэшировать все дескрипторы поставщика, которые будут ссылаться несколько раз в течение времени существования приложения.

## <a name="programming-examples"></a>Примеры программирования

В следующих примерах описывается выполнение конкретных криптографических операций с помощью CNG.

-   [Создание хэша с помощью CNG](creating-a-hash-with-cng.md)
-   [Подписывание данных с помощью CNG](signing-data-with-cng.md)
-   [Шифрование данных с помощью CNG](encrypting-data-with-cng.md)

 

 



