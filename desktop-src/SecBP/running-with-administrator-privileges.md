---
description: Чтобы предотвратить вредоносную атаку, определите, требуются ли для приложения права администратора. для функций, требующих разрешений администратора, создайте отдельное приложение и используйте команду Windows RunAs command line.
ms.assetid: afa520fc-c206-49de-8d73-8f6566ec4fb6
title: Запуск с правами администратора
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87533e71fbce613ff01ec2cf4670f1632d46786eb2a5b77900f950357a9eaa8a
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119622724"
---
# <a name="running-with-administrator-privileges"></a>Запуск с правами администратора

Первым шагом в определении типа учетной записи, которую необходимо выполнить для приложения, является проверка того, какие ресурсы будут использоваться приложением и какие привилегированные интерфейсы API будут вызываться. Может оказаться, что приложение или его крупные части не требуют прав администратора. При *написании безопасного кода* Майкл Говард и Дэвид Леблана предлагают отличное описание того, как выполнять эту оценку и настоятельно рекомендуется. (Этот ресурс может быть недоступен в некоторых языках и странах.)

Вы можете предоставить привилегии, необходимые приложению, с меньшим риском для вредоносных атак, используя один из следующих подходов:

-   Запуск с учетной записью с меньшими привилегиями. Один из способов сделать это — использовать [**привилежечекк**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-privilegecheck) , чтобы определить, какие привилегии включены в маркере. Если доступные привилегии не подходят для текущей операции, можно отключить этот код и попросить пользователя войти в учетную запись с правами администратора.
-   Разбейтесь на отдельные функции приложения, требующие разрешений администратора. Для пользователя можно указать ярлык, который выполняет команду RunAs. Чтобы получить подробные инструкции по настройке ярлыка, выполните поиск по фразе "runas" в справке. Программным путем можно настроить команду [runas](/windows/desktop/com/runas) в разделе реестра [ключей AppID](/windows/desktop/com/appid-key) для вашего приложения.
-   Чтобы получить имя пользователя и пароль, необходимо выполнить аутентификацию пользователя, вызвав [**CredUIPromptForCredentials**](/windows/desktop/api/wincred/nf-wincred-creduipromptforcredentialsa) (GUI) или [**кредуикмдлинепромптфоркредентиалс**](/windows/desktop/api/wincred/nf-wincred-creduicmdlinepromptforcredentialsa) (Командная строка). Пример см. в разделе [запрос учетных данных у пользователя](asking-the-user-for-credentials.md).
-   Олицетворять пользователя. Процесс, который запускается под учетной записью с высоким уровнем привилегий, например System, может олицетворять учетную запись пользователя путем вызова [**имперсонателогжедонусер**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) или аналогичных функций олицетворения, таким образом уменьшая уровень привилегий. Однако если в поток внедряется вызов [**RevertToSelf**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-reverttoself) , процесс возвращается к исходным системным привилегиям.

Если вы определили, что приложение должно быть запущено от имени учетной записи с правами администратора и что пароль администратора должен храниться в программной системе, см. раздел [обработка паролей](handling-passwords.md) для безопасного использования методов.

 

 
