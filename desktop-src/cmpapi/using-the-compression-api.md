---
description: Многие приложения должны использовать сжатие и распаковку данных без потерь. API сжатия упрощает это, предоставляя алгоритмы сжатия Windows через общедоступный API.
ms.assetid: D603A7DE-D4A1-4515-9702-B03C81504661
title: Использование API сжатия
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 01eff163f4ea1ccf03e1cd4ac9cb16a26afeb265
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104142397"
---
# <a name="using-the-compression-api"></a>Использование API сжатия

Многие приложения должны использовать сжатие и распаковку данных без потерь. API сжатия упрощает это, предоставляя алгоритмы сжатия Windows через общедоступный API. Каждый алгоритм сжатия имеет набор свойств, управляющих его поведением. API сжатия предоставляет интерфейс, который позволяет разработчику задавать значения этих свойств или запрашивать их. Все свойства поддерживаемых алгоритмов сжатия имеют значения по умолчанию, представляющие часто используемые значения этих свойств. Если для сжатия и распаковки требуется свойство, значения по умолчанию будут идентичны, что гарантирует использование одинаковых значений для сжатия и распаковки.

## <a name="selecting-the-compression-algorithm"></a>Выбор алгоритма сжатия

После того как разработчик решит, что приложению необходимо сжать или распаковать данные, следует выбрать алгоритм сжатия. Это может зависеть от тестов, чтобы найти оптимальное сочетание скорости, коэффициента сжатия и требований к памяти для конкретного приложения. В следующем списке приводятся относительные сравнения алгоритмов сжатия, которые в настоящее время поддерживаются API сжатия. Не все параметры доступны для каждого алгоритма сжатия, и сравнение является приблизительным, поскольку производительность может зависеть от входных данных.

XPRESS (**Сжатие \_ алгоритма \_ Xpress**)

-   Очень быстро с низкими требованиями к ресурсам
-   Отношение среднего сжатия
-   Высокая скорость сжатия и распаковки
-   Требования к нехватке памяти
-   Поддерживает параметр **\_ \_ \_ уровня класса "сжимать сведения** ", доступный в перечислении [**\_ \_ класса сведений о сжатии**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) . Значение по умолчанию — **(DWORD) 0**. Для некоторых данных значение **(DWORD) 1** может улучшить коэффициент сжатия с немного низкой скоростью сжатия.

XPRESS с кодировкой Хаффмана (**Сжатие \_ алгоритма \_ Xpress \_ Хаффа**)

-   Коэффициент сжатия выше, чем **Сжатие \_ алгоритма \_ Xpress**
-   Отношение среднего сжатия
-   Средние и высокие скорости сжатия и распаковки
-   Требования к нехватке памяти
-   Поддерживает параметр **\_ \_ \_ уровня класса сжимать сведения** в перечислении [**\_ \_ класса сведений о сжатии**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) . Значение по умолчанию — **(DWORD) 0**. Для некоторых данных значение **(DWORD) 1** может улучшить коэффициент сжатия с немного низкой скоростью сжатия.

MSZIP (**Сжатие \_ алгоритма \_ MSZIP**)

-   Использует больше ресурсов, чем **Сжатие \_ алгоритма \_ Xpress \_ Хаффа**
-   Создает сжатый блок, аналогичный стандарту RFC 1951.
-   Отношение среднего и высокого сжатия
-   Средняя скорость сжатия и высокая скорость распаковки
-   Требования к среднему объему памяти

ЛЗМС (**Сжатие \_ алгоритма \_ лзмс**)

-   Хороший алгоритм, если размер данных для сжатия превышает 2 МБ.
-   Коэффициент высокой степени сжатия
-   Низкая скорость сжатия и высокая скорость распаковки
-   От среднего до высокого требования к памяти
-   Поддерживает параметр **сжатия \_ \_ блока данных \_ класса \_ Information** в перечислении [**\_ \_ класса сведений о сжатии**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) . Для повышения степени сжатия предлагается минимальный размер в 1 МБ.

## <a name="deciding-which-compression-api-mode-to-use"></a>Выбор режима использования API сжатия

Когда разработчик выбирает алгоритм сжатия, следующим решением будет выбор из двух режимов использования API сжатия: режим буфера или блочный режим. Режим буфера был разработан для простоты использования и рекомендуется в большинстве случаев.

Режим буфера автоматически разделяет входной буфер на блоки размера, который подходит для выбранного алгоритма сжатия. Режим буфера автоматически форматирует и сохраняет несжатый размер буфера в сжатом буфере. Размер сжатого буфера не сохраняется автоматически, и приложению необходимо сохранить его для распаковки. Не включайте флаг **сжатия \_ RAW** в параметр *Algorithm* при вызове [**креатекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) и [**креатедекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) для использования режима буфера. Пример кода для приложения в режиме буфера см. в разделе [Использование API сжатия в режиме буфера](using-the-compression-api-in-buffer-mode.md) .

Режим блокировки позволяет разработчику управлять размером блока, но требует больше работы, чем приложение. При использовании блочного режима приложение должно прерывать входные данные в соответствующих единицах при сжатии, а затем при распаковке вернуть их. Режим блокировки завершается сбоем, если размер входного буфера превышает размер внутреннего блока алгоритма сжатия. Внутренний размер блока — 32 КБ для MSZIP и 1 ГБ для алгоритмов сжатия XPRESS. Внутренний размер блока для ЛЗМС можно настроить до 64 ГБ с соответствующим увеличением использования памяти. Размер сжатого буфера не сохраняется автоматически, и приложение также должно сохранить его для распаковки. Значение параметра *ункомпресседбуфферсизе* для [**распаковки**](/windows/desktop/api/compressapi/nf-compressapi-decompress) должно быть в точности равно исходному размеру несжатых данных, а не только размеру выходного буфера. Это означает, что приложение должно сохранить точный исходный размер несжатых данных, а также сжатые данные и сжатый размер при использовании блочного режима. Включите флаг **сжатия \_ RAW** в параметр *Algorithm* при вызове [**креатекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) и [**креатедекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) для использования блочного режима. Пример кода для приложения в режиме блокировки см. в разделе [Использование API сжатия в режиме блокировки](using-the-compression-api-in-block-mode.md) .

## <a name="custom-memory-allocation"></a>Пользовательское выделение памяти

Приложения буферов и блочного режима позволяют указать настраиваемую подпрограмму выделения памяти при вызове [**креатекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) и [**креатедекомпрессор**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor). Параметр *аллокатионраутинес* указывает структуру [**\_ \_ процедуры распределения сжатия**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) , которая содержит подпрограммы выделения памяти. Затем приложение может задать размер блока для сжатия с помощью [**сеткомпрессоринформатион**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation). Пример простой настраиваемой подпрограммы выделения см. в разделе [Использование API сжатия в режиме блокировки](using-the-compression-api-in-block-mode.md) .

 

 



