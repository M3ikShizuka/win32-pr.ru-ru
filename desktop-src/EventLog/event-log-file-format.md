---
description: Каждый журнал событий содержит заголовок (представленный \_ \_ структурой заголовка файла журнала ELF) с фиксированным размером, за которым следуют переменное число записей событий (представленное структурами EVENTLOGRECORD) и запись конца файла (представленная \_ \_ структурой записи EOF ELF).
ms.assetid: 2b62b807-4ffd-4a8f-afe4-34e109d01856
title: Формат файла журнала событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: af4ba5c8bc0114e319107272e706801544e3effa
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104545026"
---
# <a name="event-log-file-format"></a>Формат файла журнала событий

Каждый журнал событий содержит заголовок (представленный структурой [**\_ \_ заголовка файла журнала ELF**](/previous-versions/windows/desktop/legacy/bb309024(v=vs.85)) ) с фиксированным размером, за которым следуют переменное число записей событий (представленное структурами [**EVENTLOGRECORD**](/windows/desktop/api/winnt/ns-winnt-eventlogrecord) ) и запись конца файла (представленная структурой [**\_ \_ записи EOF ELF**](/previous-versions/windows/desktop/legacy/bb309022(v=vs.85)) ).

Структура **\_ \_ заголовка файла журнала ELF** и структура **\_ \_ записи ELF EOF** записываются в журнал событий при создании журнала событий и обновляются каждый раз при записи события в журнал.

Когда приложение вызывает функцию [**репортевент**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) для записи записи в журнал событий, система передает параметры в службу ведения журнала событий. Служба ведения журнала событий использует эти сведения для записи структуры **EVENTLOGRECORD** в журнал событий. Этот процесс представлен на схеме ниже.

![запись файла журнала](images/evreport.png)

Записи событий упорядочены одним из следующих способов.

-   Без упаковки. Самая старая запись сразу после заголовка журнала событий и добавления новых записей после последней добавленной записи (до **\_ \_ записи ELF EOF**). В следующем примере показан метод без упаковки:

    ``` syntax
    HEADER                   (ELF_LOGFILE_HEADER)
    EVENT RECORD 1           (EVENTLOGRECORD)
    EVENT RECORD 2           (EVENTLOGRECORD)
    EOF RECORD               (ELF_EOF_RECORD)
    ```

    Необолочка может произойти при создании журнала событий или при очистке журнала событий. Журнал событий остается без оболочки, пока не будет достигнут предел размера журнала событий. Размер журнала событий ограничен значением конфигурации **MAXSIZE** или объемом системных ресурсов.

    При достижении предельного размера журнала событий он может начать перенос. Оболочка управляется значением конфигурации **хранения** . Дополнительные сведения о значениях конфигурации журнала событий см. в разделе [EventLog](eventlog-key.md).

-   Переход. Записи организованы в виде кольцевого буфера. По мере добавления новых записей самые старые записи заменяются. Расположение самых старых и новых записей будет различным. В следующем примере показан метод переноса.

    ``` syntax
    HEADER                   (ELF_LOGFILE_HEADER)
    Part of EVENT RECORD 300 (EVENTLOGRECORD)
    EVENT RECORD 301         (EVENTLOGRECORD)
    .
    .
    .
    EVENT RECORD 400         (EVENTLOGRECORD)
    EOF RECORD               (ELF_EOF_RECORD)
    Wasted space
    EVENT RECORD 102         (EVENTLOGRECORD)
    EVENT RECORD 103         (EVENTLOGRECORD)
    .
    .
    .
    EVENT RECORD 299         (EVENTLOGRECORD)
    Part of EVENT RECORD 300 (EVENTLOGRECORD)
    ```

    В примере самая старая запись больше 1, но — 102, поскольку пространство для записей от 1 до 101 было перезаписано.

    Между **\_ \_ записью EOF ELF** и самой старой записью имеется некоторое пространство, поскольку система удалит целое число записей, чтобы освободить место для последней записи. Например, если последняя запись составляет 100 байт и две самые старые записи имеют длину 75 байт, система удалит две самые старые записи. Дополнительные 50 байта будут использоваться позже при записи новых записей.

    Файл журнала событий имеет фиксированный размер, и когда записи в файле переносятся в оболочку, запись в конце файла обычно разбивается на две записи. Например, если в позиции следующей записи находится 100 байт с конца файла, а размер записи составляет 300 байт, первые 100 байт будут записаны в конец файла, а следующие 200 байты будут записаны в начало файла сразу после **\_ \_ заголовка ELF**. Если доступное место в конце файла меньше фиксированной части **EVENTLOGRECORD** (0x38 байт), то вся новая запись будет записана в начале файла сразу после **\_ \_ заголовков файла журнала ELF**. Неиспользуемые байты в конце файла будут заполнены шаблоном 0x00000027.

Дополнительные сведения и пример кода см. в разделе [сообщение о событии](reporting-an-event.md).

 

 
