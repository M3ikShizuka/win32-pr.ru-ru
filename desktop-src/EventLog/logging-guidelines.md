---
description: Журналы событий хранят записи о значимых событиях от имени системы и приложений, выполняющихся в системе.
ms.assetid: 58a6569a-2775-4687-bf99-579fa4153191
title: Рекомендации по ведению журнала
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c1210757a7961d82d13d4887e40fbd3837b86138
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104156162"
---
# <a name="logging-guidelines"></a>Рекомендации по ведению журнала

Журналы событий хранят записи о значимых событиях от имени системы и приложений, выполняющихся в системе. Так как функции ведения журнала являются общим целям, необходимо решить, какие сведения поддаются журналу. Как правило, следует заносить в журнал только те данные, которые могут оказаться полезными при диагностике проблем с оборудованием или программным обеспечением. Ведение журнала событий не предназначено для использования в качестве средства трассировки.

## <a name="choosing-events-to-log"></a>Выбор событий для записи в журнал

Ниже приведены примеры случаев, когда может быть полезно ведение журнала событий.

-   Проблемы с ресурсами. Регистрация события предупреждения при сбое выделения памяти может помочь определить причину нехватки памяти.
-   Проблемы оборудования. Если драйвер устройства обнаруживает время ожидания контроллера диска, сбой питания в параллельном порте или ошибку данных из сетевой или последовательной карты, драйвер устройства может записывать сведения об этих событиях, чтобы помочь системному администратору диагностировать проблемы с оборудованием.
-   Поврежденные сектора. Если драйвер диска встречает поврежденный сектор, он может выполнить чтение или запись в сектор после повторного выполнения операции, но сектор будет неудачным. Если драйвер диска может продолжать работу, он должен заносить в журнал событие предупреждения; в противном случае он должен зарегистрировать событие ошибки. Если драйвер файловой системы находит большое количество поврежденных секторов и устраняет их, администратор может определить, что диск может быть неудачным.
-   Информационные события. Серверное приложение (например, сервер базы данных) регистрирует вход пользователя в систему, открывает базу данных или запускает перенос файлов. Сервер также может регистрировать другие события, такие как ошибки (доступ к файлу, хост-процесс отключен и т. д.), повреждение базы данных или успешное перемещение файла.

## <a name="writing-messages"></a>Создание сообщений

Сообщения должны иметь смысл для администраторов и пользователей, пытающихся устранить проблему. Сообщение должно содержать всю информацию, необходимую для того, чтобы понять причину проблемы и способ ее устранения.

Не следует писать зашифрованное сообщение, например "Недопустимый пакет драйвера, полученный от подсистемы ввода-вывода. Данные представляют собой пакет. Лучшее сообщение указывает на то, что рассматриваемый драйвер работает правильно, но записывает в журнал неправильно отформатированные пакеты. Можно сказать, что для устранения проблемы требуется версия драйвера для Юникода. Дополнительные сведения о создании хороших сообщений об ошибках см. в разделе [рекомендации по сообщениям об ошибках](/windows/desktop/Debug/error-message-guidelines).

Не используйте в тексте сообщения символы табуляции и запятые, так как журналы событий могут быть сохранены в виде текстовых файлов с разделителями-запятыми или символами табуляции. Во многих организациях эти файлы импортируются в базы данных, а для дополнительных символов форматирования потребуется ручная манипуляция.

При использовании имен UNC или других ссылок, содержащих пробелы, заключите имя в угловые скобки. Например, <\\ \\ *ShareName* \\ *имя_сервера*>. Можно записать URL-адрес в конец сообщения, указывающего на пользователя на связанный справочный материал. URL-адрес должен быть полным именем узла DNS. Например, можно добавить в сообщения следующий текст: "Дополнительные сведения об этом сообщении см. на сайте поддержки по адресу https://www.microsoft.com/Support/ProdRedirect/ContentSearch.asp ". Ссылка приведет к переходу на страницу ASP, которая перенаправляет пользователя к содержимому, связанному с сообщением об ошибке. Он будет анализировать дополнительные параметры (передаются при щелчке URL-адреса), чтобы определить, куда перенаправлять пользователя.

Аргументы, передаваемые в функцию [**репортевент**](/windows/desktop/api/Winbase/nf-winbase-reporteventa) , добавляются к URL-адресу следующим образом:

``` syntax
strHTTPQuery += L"?EvtSrc=" + _strEscapedSource;
strHTTPQuery += L"&EvtCat=" + _strEscapedCategory;
strHTTPQuery += L"&EvtID=" + _strEscapedEventID;
strHTTPQuery += L"&EvtCatID=" + _strEscapedCategoryID;
strHTTPQuery += L"&EvtType=" + _strEscapedType;
strHTTPQuery += L"&EvtTypeID=" + _strEscapedTypeID;
strHTTPQuery += L"&EvtRptTime=" + _strEscapedDateAndTime;
strHTTPQuery += L"&EvtTZBias=" + _strEscapedTimeZoneBias;
```

Если название компании, название продукта, версия продукта, имя файла и версия файла из заголовка DLL сообщения для источника событий являются допустимыми, они также добавляются к URL-адресу:

``` syntax
ADD_VER_STR(L"CoName",   _strEscapedCompanyName);
ADD_VER_STR(L"ProdName", _strEscapedProductName);
ADD_VER_STR(L"ProdVer",  _strEscapedProductVersion);
ADD_VER_STR(L"FileName", _strEscapedFileName);
ADD_VER_STR(L"FileVer",  _strEscapedFileVersion);
```

## <a name="reducing-overhead"></a>Уменьшение издержек

Ведение журнала событий потребляет такие ресурсы, как место на диске и время процессора. Объем места на диске, требуемый для журнала событий, и дополнительная нагрузка для приложения, в котором регистрируются события, зависят от объема данных, выбранных для записи в журнал. Поэтому важно записывать только важные сведения. Также рекомендуется размещать вызовы регистрации событий в пути ошибок в коде, а не в основном коде кода, что приведет к снижению производительности.

Объем дискового пространства, необходимый для каждой записи журнала событий, включает элементы структуры [**EVENTLOGRECORD**](/windows/desktop/api/Winnt/ns-winnt-eventlogrecord) . Это структура переменной длины; строки и двоичные данные хранятся после структуры.

 

 
