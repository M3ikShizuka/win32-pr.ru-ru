---
description: Пакет для двойного назначения — это пакет установщик Windows 5,0, который был разработан для установки приложения в контексте установки на уровне пользователя или на компьютере.
ms.assetid: b2da9fba-8fdf-48fa-a662-6b3eee1bfe87
title: Создание отдельных пакетов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87c22b9be930be2d2178ea4efb7ba1538320823a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105674051"
---
# <a name="single-package-authoring"></a>Создание отдельных пакетов

Пакет для двойного назначения — это пакет установщик Windows 5,0, который был разработан для установки приложения в [контексте установки](installation-context.md)на уровне пользователя или на компьютере. Разработчики программы установки, использующие пакет с двойным набором приложений, могут предоставить пользователям возможность выбора контекста установки во время установки и удалить запросы учетных данных контроля учетных записей из установок для отдельных пользователей в Windows 7 или Windows Server 2008 R2. Разработка пакета с двойным набором установщик Windows 5,0 для установки в Windows 7 и Windows Server 2008 R2 называется созданием отдельного пакета.

Вы можете приступить к разработке пакетов двойного назначения для Windows 7 и Windows Server 2008 R2 с помощью установщик Windows 5,0, свойства [**мсиинсталлперусер**](msiinstallperuser.md) , свойства [**ALLUSERS**](allusers.md) и известных папок и регистраций [оболочки Windows](/previous-versions/windows/desktop/legacy/bb773177(v=vs.85))для каждого пользователя. Когда установщик Windows 5,0 устанавливает пакет двойного назначения в контексте "на пользователя" в Windows 7 или Windows Server 2008 R2, установщик направляет записи файлов и реестра в расположениях пользователей и не отображает запросы UAC для учетных данных. Когда установщик Windows 5,0 устанавливает пакет двойного назначения в контексте на компьютере, установщик направляет файлы и записи реестра в расположение компьютера и запрашивает учетные данные UAC, чтобы убедиться, что пользователь имеет достаточные привилегии для установки программного обеспечения для всех пользователей компьютера. После того как установщик Windows 5,0 устанавливает приложение, оно использует тот же контекст установки для всех последующих обновлений, исправлений или удаления приложения.

**[Установщик Windows 4,5 или более ранних](not-supported-in-windows-installer-4-5.md)версий:** свойство [**мсиинсталлперусер**](msiinstallperuser.md) и версии папок для каждого пользователя, на которые ссылаются свойства [**ProgramFilesFolder**](programfilesfolder.md), [**коммонфилесфолдер**](commonfilesfolder.md), [**ProgramFiles64Folder**](programfiles64folder.md)и [**CommonFiles64Folder**](commonfiles64folder.md) , не поддерживаются. Папки **FOLDERID \_ Усерпрограмфилес** и **FOLDERID \_ усерпрограмфилескоммон** доступны начиная с Windows 7 и Windows Server 2008 R2. Это означает, что установки, разработанные для установщик Windows 4,5 или более ранних версий файлов и записей реестра, FOLDERID \_ ProgramFiles, FOLDERID \_ ПРОГРАМФИЛЕСКОММОН, FOLDERID \_ ProgramFilesX64 и FOLDERID \_ ProgramFilesCommonX64. Так как эти расположения доступны другим пользователям компьютера, Windows Vista и более поздние системы должны отображать запросы UAC для учетных данных.

Когда пользователь устанавливает пакет двойного назначения, разработанный для установщик Windows 5,0 с установщик Windows 4,5 или более ранней версии, установщик игнорирует свойство [**мсиинсталлперусер**](msiinstallperuser.md) . В этом случае установка может направить файлы и записи реестра в расположения, доступные другим пользователям, и требует, чтобы система отображала запросы UAC для учетных данных. Установщик Windows 5,0 может установить пакет, разработанный для установщик Windows 4,5 или более ранней версии, однако установка направляет файлы и записи реестра в расположения, доступные другим пользователям, и требует, чтобы система отображала запросы UAC для учетных данных.

## <a name="development-guidelines"></a>Рекомендации по разработке

Придерживайтесь следующих руководств по созданию одного пакета, чтобы убедиться, что пакет можно установить в контексте "на пользователя" или "на компьютер". Следуйте этим рекомендациям, чтобы предоставить пользователю возможность выбора во время установки для отдельных пользователей или компьютеров, а также для удаления запросов контроля учетных записей из установок для отдельных пользователей.

-   Для установки на уровне пользователя требуется установщик Windows 5,0 в Windows 7 или Windows Server 2008 R2. Необходимо сообщить пользователю о том, что пакет поддерживает установку приложения на компьютере в более ранних версиях системы.
-   Инициализируйте значения свойств [**ALLUSERS**](allusers.md) и [**Мсиинсталлперусер**](msiinstallperuser.md) в [таблице свойств](property-table.md) пакета с двойным набором целей. Используйте значение **ALLUSERS** , равное 2, и значение **мсиинсталлперусер** , равное 1, в качестве начальных значений. Это означает установку по умолчанию для пакета с двойным назначением.
-   Рассмотрите возможность создания диалогового окна для [пользовательского интерфейса](user-interface.md) пакета с двойным набором, позволяющего пользователю выбирать контекст во время установки. Создайте элементы управления в этом настраиваемом диалоговом окне, чтобы задать значения свойств [**ALLUSERS**](allusers.md) и [**мсиинсталлперусер**](msiinstallperuser.md) . Для параметра **ALLUSERS** , равного 2, установите значение **мсиинсталлперусер** равным 1, чтобы указать установку для отдельного пользователя, и присвойте параметру **мсиинсталлперусер** пустую строку (""), чтобы указать установку на компьютер. Пользователи также могут задать в командной строке **ALLUSERS** и **мсиинсталлперусер** , если они устанавливают пакет из командной строки.
-   Проверить пакет, используя [внутренние средства оценки согласованности — ICEs](internal-consistency-evaluators-ices.md). Пакет должен быть способен пройти проверку с помощью [ICE105](ice-105.md) , чтобы стать допустимым пакетом с двойным набором.
-   Используйте [таблицу реестра](registry-table.md) и [таблицу ремоверегистри](removeregistry-table.md) для перенаправления записей реестра в пользовательские части реестра при установке на уровне пользователя. При установке на уровне пользователя записи реестра, имеющие значение-1 в корневом столбце, перенаправляются в раздел **hKey \_ текущий \_ пользователь**, а при установке на компьютере они направляются на **\_ локальный \_ компьютер hKey**. При установке на уровне пользователя записи реестра, имеющие мсидбрегистрирутклассесрут (0) в корневом столбце, перенаправляются в  \\ **классы программного обеспечения** HKCU \\ , а при установке на компьютере они направляются в  \\ **классы программного обеспечения** HKLM \\ .
-   Используйте свойство [**ProgramFilesFolder**](programfilesfolder.md) в [таблице каталогов](directory-table.md) [32-разрядных пакетов установщик Windows](32-bit-windows-installer-packages.md) , чтобы указать расположение каталогов, содержащих 32-разрядные компоненты, которые не являются общими для разных приложений. Когда пользователь устанавливает пакет с двойным набором, используя контекст на компьютере, эти компоненты сохраняются в папке Program Files в 32-разрядных версиях Windows и в папке Program Files (x86) в 64-разрядных версиях системы. К компонентам в этих каталогах могут обращаться все пользователи. Когда пользователь устанавливает пакет двойного назначения в Windows 7 или Windows Server 2008 R2 с использованием контекста «на пользователя», эти компоненты сохраняются в папке Programs текущего пользователя (например, в% LocalAppData% \\ Programs) и доступны только этому пользователю.
-   Используйте свойство [**коммонфилесфолдер**](commonfilesfolder.md) в [таблице каталогов](directory-table.md) [32-разрядных пакетов установщик Windows](32-bit-windows-installer-packages.md) , чтобы указать расположение каталогов, содержащих 32-разрядные компоненты, общие для разных приложений. Когда пользователь устанавливает пакет с двойным набором, используя контекст на компьютере, эти компоненты сохраняются в папке Common Files и могут быть доступны всем пользователям. Когда пользователь устанавливает пакет двойного назначения в Windows 7 или Windows Server 2008 R2 с помощью контекста для каждого пользователя, эти компоненты сохраняются в общей папке текущего пользователя (например, в% LocalAppData% \\ Programs \\ ) и могут быть доступны только этому пользователю.
-   Используйте свойство [**ProgramFiles64Folder**](programfiles64folder.md) в [таблице каталогов](directory-table.md) [64-разрядных пакетов установщик Windows](64-bit-windows-installer-packages.md) , чтобы указать расположение каталогов, содержащих 64-разрядные компоненты, которые не являются общими для разных приложений. Когда пользователь устанавливает пакет с двойным набором, используя контекст на компьютере, эти компоненты сохраняются в папке Program Files. К компонентам в этих каталогах могут обращаться все пользователи. Когда пользователь устанавливает пакет двойного назначения в Windows 7 или Windows Server 2008 R2 с использованием контекста «на пользователя», эти компоненты сохраняются в папке Programs текущего пользователя (например, в% LocalAppData% \\ Programs) и доступны только этому пользователю. Дополнительные сведения о создании пакета для установки приложения на 64-разрядных операционных системах см. в разделе [установщик Windows на 64-разрядных операционных системах](windows-installer-on-64-bit-operating-systems.md).
-   Используйте свойство [**CommonFiles64Folder**](commonfiles64folder.md) в [таблице каталогов](directory-table.md) [64-разрядных пакетов установщик Windows](64-bit-windows-installer-packages.md) , чтобы указать расположение каталогов, содержащих 64-разрядные компоненты, общие для разных приложений. Когда пользователь устанавливает пакет с двойным набором, используя контекст на компьютере, эти компоненты сохраняются в папке Common Files и могут быть доступны всем пользователям. Когда пользователь устанавливает пакет двойного назначения в Windows 7 или Windows Server 2008 R2 с помощью контекста для каждого пользователя, эти компоненты сохраняются в общей папке текущего пользователя (например, в% LocalAppData% \\ Programs \\ ) и могут быть доступны только этому пользователю.
-   Используйте свойства [**ProgramFilesFolder**](programfilesfolder.md) и [**Коммонфилесфолдер**](commonfilesfolder.md) в [таблице каталогов](directory-table.md) [64-разрядных пакетов установщик Windows](64-bit-windows-installer-packages.md) , чтобы указать расположение каталогов, содержащих 32-разрядные компоненты. Используйте разные имена для 32-разрядных и 64-разрядных версий всех компонентов с одинаковыми именами или сохраните версии в разных папках. Например, добавьте сведения в таблицу Directory, чтобы указать расположение каталога, содержащего 32-разрядную версию, в виде имени \[ ProgramFilesFolder \] \\ *ISV* имя \\ *приложения* \\ x86 и расположение каталога, содержащего 64-разрядную версию, в формате \[ Program64FilesFolder \] \\ *ISV имя* \\ *приложения* \\ x64. При установке на компьютер сохраняется 32-разрядная версия в файле Program Files (x86) \\ *имя* \\ *приложения* \\ x86 и сохраняется 64-разрядная версия в Program Files \\ *ISV* имя \\ *приложения* \\ x64. Установка на уровне пользователя сохраняет 32-разрядную версию в% LocalAppData% \\ Programs \\ *ISV* имя \\ *приложения* \\ x86 и устанавливает 64-разрядную версию в% LocalAppData% \\ Programs \\ *имя* \\ *приложения*— \\ x64.
-   Храните данные конфигурации для каждого пользователя для приложения в разделе \\ Пользователи \\ *имя пользователя* \\ APPDATA.
-   Сохраняйте шаблоны и файлы, создаваемые приложением, во вложенных папках в разделе \\ user \\ *username*.
-   Если приложение использует расширения оболочки, следует использовать точки [расширения оболочки](https://msdn.microsoft.com/library/bb762762.aspx) , поддерживающие для пользователя, которые доступны начиная с Windows 7 или windows Server 2008 R2.
-   Не используйте настраиваемые действия в пакете, для выполнения которых требуются повышенные привилегии. Таблица [CustomAction](customaction-table.md) не должна содержать настраиваемые действия, помеченные для запуска с повышенными привилегиями. Дополнительные сведения о настраиваемых действиях с повышенными правами см. в разделе [Безопасность настраиваемых действий](custom-action-security.md).
-   Не записывайте никаких глобальных системных папок. Таблица [каталогов](directory-table.md) не должна содержать ссылку на какие-либо из следующих свойств системной папки.

    <dl>

[**админтулсфолдер**](admintoolsfolder.md)  
    [**коммонаппдатафолдер**](commonappdatafolder.md)  
    [**фонтсфолдер**](fontsfolder.md)  
    [**System16Folder**](system16folder.md)  
    [**System64Folder**](system64folder.md)  
    [**системфолдер**](systemfolder.md)  
    [**темпфолдер**](tempfolder.md)  
    [**виндовсфолдер**](windowsfolder.md)  
    [**виндовсволуме**](windowsvolume.md)  
    </dl>

-   Не устанавливайте сборку среды CLR в глобальный кэш сборок (GAC). Дополнительные сведения об установке сборок в глобальный кэш сборок см. в разделе [Добавление сборок в пакет](adding-assemblies-to-a-package.md) и [Установка сборок среды](installation-of-common-language-runtime-assemblies.md)CLR.
-   Не устанавливайте источники данных ODBC. Не используйте таблицу [одбкдатасаурце](odbcdatasource-table.md) для установки источника данных.
-   Не устанавливайте какие бы то ни было службы. Не используйте таблицу [сервицеинсталл](serviceinstall-table.md) для установки службы.

## <a name="example"></a>Пример

Пример многоцелевого пакета предоставляется в [Windows SDK компонентов для установщик Windows разработчиков](platform-sdk-components-for-windows-installer-developers.md) в качестве PUASample1.msi файлов. Если у вас есть текущий пакет SDK, у вас есть доступ ко всем средствам и данным, необходимым для воспроизведения примера установочного пакета. Дополнительные сведения об этом примере см. в разделе [Пример создания отдельного пакета](single-package-authoring-example.md).

 

 
