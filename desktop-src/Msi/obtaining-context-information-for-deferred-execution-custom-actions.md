---
description: Так как сценарий установки может быть выполнен вне сеанса установки, в котором он был записан, сеанс может больше не существовать во время выполнения сценария установки.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Получение сведений о контексте для отложенных настраиваемых действий выполнения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127251080"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a>Получение сведений о контексте для отложенных настраиваемых действий выполнения

Так как сценарий установки может быть выполнен вне сеанса установки, в котором он был записан, сеанс может больше не существовать во время выполнения сценария установки. В этом случае исходный обработчик и свойства сеанса, заданные во время последовательности установки, недоступны для отложенного настраиваемого действия выполнения. Все функции, для которых требуется дескриптор сеанса, ограничены одними методами, которые могут извлекать сведения о контексте, или свойства, необходимые во время выполнения скрипта, должны быть записаны в скрипт установки. Например, отложенные пользовательские действия, вызывающие библиотеки динамической компоновки (DLL), передают маркер, который может использоваться только для получения очень ограниченного объема информации. К функциям, которым не требуется доступ к обработчику сеанса, можно обращаться из отложенного настраиваемого действия.

Пользовательские действия отложенного выполнения ограничены вызовом только следующих функций, для которых требуется маркер.



| Функция                                       | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | Поддерживает ограниченный набор свойств при использовании [настраиваемых действий отложенного выполнения](deferred-execution-custom-actions.md): свойство CustomActionData, свойство [**ProductCode**](productcode.md) [**и свойство "значение"**](usersid.md) . [Зафиксировать настраиваемые действия](commit-custom-actions.md) не могут использовать функцию [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) для получения свойства [**ProductCode**](productcode.md) . Зафиксировать настраиваемые действия могут использовать свойство CustomActionData для получения кода продукта.<br/> |
| [**мсиформатрекорд**](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | Поддерживает ограниченный набор свойств при использовании [настраиваемых действий отложенного выполнения](deferred-execution-custom-actions.md): свойства CustomActionData и ProductCode.                                                                                                                                                                                                                                                                                                                                                      |
| [**мсижетмоде**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | При вызове из [отложенных настраиваемых действий выполнения](deferred-execution-custom-actions.md), [фиксации настраиваемых действий](commit-custom-actions.md)или [отката настраиваемых действий](rollback-custom-actions.md) [**мсижетмоде**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) возвращает true или false при запросе для проверки параметров Mode мсирунмоде \_ Schedule, мсирунмоде \_ Commit или мсирунмоде \_ Rollback. Запросы на проверку любых других параметров режима выполнения из настраиваемого действия отложена, фиксации или отката возвращают значение false.<br/>                       |
| [**мсижетлангуаже**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | Числовой идентификатор языка для текущего продукта. [Зафиксировать настраиваемые действия](commit-custom-actions.md) не могут использовать функцию [**мсижетлангуаже**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) . Зафиксировать настраиваемые действия могут использовать свойство CustomActionData для получения числового идентификатора языка.<br/>                                                                                                                                                                                                                                                           |
| [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | Обрабатывает сообщения об ошибках или ходе выполнения настраиваемого действия.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

для пользовательского действия, написанного на JScript или VBScript, требуется объект [**сеанса**](session-object.md) установки. Это относится к объекту типа **Session** , а Установщик прикрепляет его к сценарию с именем Session. Так как объект **сеанса** может не существовать во время отката установки, отложенное настраиваемое действие, написанное в скрипте, должно использовать один из следующих методов или свойства объекта **Session** для получения контекста.



| Имя                                                           | Описание                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [**Режим, свойство**](session-mode.md)                          | Возвращает true для МСИРУНМОДЕ \_ только по расписанию.                                                                                       |
| [**Свойство Property (объект Session)**](session-session.md)  | Возвращает свойство CustomActionData, свойство [**ProductCode**](productcode.md) [**или свойство "значение"**](usersid.md) .        |
| [**Свойство Language (объект Session)**](session-language.md) | Возвращает числовой идентификатор языка сеанса установки.                                                                           |
| [**Метод сообщения**](session-message.md)                      | Вызывается для обработки ошибок и хода выполнения.                                                                                              |
| [**Свойство установщика**](session-installer.md)                | Возвращает родительский объект, который используется для функций, не являющихся сеансами, таких как доступ к реестру и управление конфигурацией установщика. |



 

Значения свойств, заданные во время обработки последовательности установки в скрипте, могут быть недоступны во время выполнения скрипта. Только следующий ограниченный набор свойств всегда доступен для настраиваемых действий во время выполнения скрипта.



| Имя свойства                      | Описание                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CustomActionData                   | Значение на момент времени в таблице последовательностей обрабатывается настраиваемое действие. Свойство CustomActionData доступно только для отложенных настраиваемых действий выполнения. Непосредственные настраиваемые действия не имеют доступа к этому свойству. |
| [**ProductCode**](productcode.md) | Уникальный код для продукта, строка [GUID](guid.md) .                                                                                                                                                         |
| [**UserSID**](usersid.md)         | Задается установщиком для идентификатора безопасности (SID) пользователя.                                                                                                                                                   |



 

Если для отложенного выполнения настраиваемого действия требуются другие данные свойств, их значения должны храниться в скрипте установки. Это можно сделать с помощью второго настраиваемого действия.

**Запись значения свойства в скрипт установки для использования во время отложенного выполнения настраиваемого действия**

1.  Вставьте небольшое пользовательское действие в последовательность установки, которое задает интересующее свойство свойства, имя которого совпадает с именем отложенного выполнения настраиваемого действия. Например, если первичный ключ для настраиваемого действия отложенного выполнения имеет значение "Мяктион", задайте свойству с именем "Мяктион" значение свойства X, которое необходимо получить. Необходимо задать свойство "Мяктион" в последовательности установки перед настраиваемым действием "Мяктион". Хотя любой тип настраиваемого действия может задавать данные контекста, простейшим методом является использование настраиваемого действия назначения свойств (например, [тип настраиваемого действия 51](custom-action-type-51.md)).
2.  Во время обработки последовательности установки установщик записывает значение свойства X в скрипт выполнения как значение свойства CustomActionData.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Сведения о свойствах](about-properties.md)
</dt> <dt>

[Использование свойств](using-properties.md)
</dt> <dt>

[Справочник по свойствам](property-reference.md)
</dt> </dl>

 

 




