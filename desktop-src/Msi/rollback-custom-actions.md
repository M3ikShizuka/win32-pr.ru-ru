---
description: Когда установщик обрабатывает скрипт установки, он одновременно создает скрипт отката.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Откат настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103898309"
---
# <a name="rollback-custom-actions"></a>Откат настраиваемых действий

Когда установщик обрабатывает скрипт установки, он одновременно создает скрипт отката. Помимо скрипта отката, установщик сохраняет копию каждого файла, который он удаляет, во время установки. Эти файлы хранятся в скрытом системном каталоге. После завершения установки сценарий отката и сохраненные файлы удаляются. Если установка завершается неудачно, установщик пытается выполнить откат изменений, сделанных во время установки, и восстановить исходное состояние компьютера.

Несмотря на то, что пользовательские действия, запланирующие системные операции путем вставки строк в таблицу базы данных, обращены к откату установки, настраиваемым действиям, которые изменяют систему напрямую или выдают команды другим системным службам, не всегда могут быть отменены в результате отката. Настраиваемое действие отката — это действие, выполняемое установщиком только во время отката установки, и его целью является отмена настраиваемого действия, которое внес изменения в систему.

Настраиваемое действие отката — это тип [отложенного выполнения настраиваемого действия](deferred-execution-custom-actions.md), поскольку его выполнение откладывается при вызове во время последовательности установки. Он отличается от обычного отложенного настраиваемого действия в том, что оно выполняется только во время отката. Настраиваемое действие отката всегда должно предшествовать отложенному пользовательскому действию, которое возвращается в последовательности действий. Настраиваемое действие отката также должно работать в случае, когда отложенное пользовательское действие прерывается в процессе выполнения. Например, если пользователь нажмет кнопку «Отмена» во время выполнения настраиваемого действия.

Обратите внимание, что настраиваемые действия отката не могут выполняться асинхронно. См. раздел [синхронные и асинхронные настраиваемые действия](synchronous-and-asynchronous-custom-actions.md).

Дополнение к настраиваемому действию отката — это [настраиваемое действие фиксации](commit-custom-actions.md). Установщик выполняет пользовательское действие фиксации во время последовательности установки, копирует пользовательское действие в скрипт отката, но не выполняет это действие во время отката.

Обратите внимание, что пользовательское действие отката может не иметь возможности удалить все изменения, сделанные настраиваемыми действиями фиксации. Несмотря на то, что установщик записывает как откат, так и фиксацию пользовательских действий в скрипте отката, пользовательские действия записываются только после того, как установщик успешно обработал сценарий установки. Фиксация настраиваемых действий — это первые действия, выполняемые в скрипте отката. Если пользовательское действие фиксации завершается ошибкой, установщик инициирует откат, но может выполнять только откат тех операций, которые уже записаны в скрипт отката. Это означает, что в зависимости от настраиваемого действия фиксации откат может не иметь возможности отменить изменения, внесенные действием. Можно пропускать сбои при фиксации настраиваемых действий путем создания настраиваемого действия для игнорирования кодов возврата.

Когда установщик запускает настраиваемое действие отката, единственным параметром mode, который он задает, будет МСИРУНМОДЕ \_ Rollback. Описание параметров режима выполнения см. в разделе [**мсижетмоде**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) .

Пользовательское действие отката можно указать, добавив флаг параметра в поле Тип [таблицы CustomAction](customaction-table.md). Дополнительные сведения см. в разделе [настраиваемое действие In-Script параметры выполнения](custom-action-in-script-execution-options.md) для флага параметра, определяющего настраиваемое действие отката.

Пользовательские действия отката и фиксации не выполняются, если откат отключен. Если автор пакета требует этих типов настраиваемых действий для правильной установки, они должны использовать свойство [**роллбаккдисаблед**](rollbackdisabled.md) в условии, которое не позволяет продолжить установку после отключения отката. Сведения о том, как отключить откат, см. в разделе [ROLLBACK Installation (установщик Windows)](rollback-installation.md).

 

 



