---
description: Пример PUASample.msi — это пример пакета с двойным набором установщик Windows 5,0, который может быть установлен в контексте установки на уровне пользователя или на компьютере в Windows Server 2008 R2 и Windows 7.
ms.assetid: be018e8a-ca5f-4135-a019-970ec4173f23
title: Пример создания отдельного пакета
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e0ed56b8d7aaf8793416ba3ecab24c1f2a48ffe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105650964"
---
# <a name="single-package-authoring-example"></a>Пример создания отдельного пакета

Пример PUASample.msi — это пример пакета с двойным набором установщик Windows 5,0, который может быть установлен в [контексте установки](installation-context.md) на уровне пользователя или на компьютере в windows Server 2008 R2 и Windows 7. Этот пример пакета соответствует рекомендациям по разработке, описанным в разделе [Создание отдельных пакетов](single-package-authoring.md).

## <a name="obtaining-a-copy-of-the-sample"></a>Получение копии образца

Копия этого примера и установщик Windows редактор таблиц базы данных, Orca.exe, находятся в [Windows SDK компонентов для установщик Windows разработчиков](platform-sdk-components-for-windows-installer-developers.md). Редактор образцов и таблиц предоставляется вместе с пакетом средств разработки программного обеспечения Windows для Windows Server 2008 R2 и Windows 7 в качестве файлов установки установщик Windows PUASample1.msi и Orca.msi.

## <a name="system-requirements"></a>Требования к системе

Для работы с редактором баз данных [Orca.exe](orca-exe.md)требуется windows Server 2008 R2 и более ранних версий, а также Windows 7 и более ранних версий. Пакет с двойным назначением, PUASample1.msi, можно установить в [контексте установки](installation-context.md) на компьютере или на уровне пользователя в windows Server 2008 R2 и Windows 7. PUASample1.msi можно установить только в контексте на компьютере под управлением Windows Server 2008 и более ранних версий, а также в Windows Vista и более ранних версиях. Можно установить редактор базы данных, чтобы проверить содержимое PUASample1.msi без установки образца. Чтобы установить образцы или пакеты редактора, убедитесь, что для политики [дисаблемси](disablemsi.md) не задано значение, блокирующее установку приложений.

## <a name="identifying-a-dual-purpose-package"></a>Определение пакета Dual-Purpose

Пакеты с двойным набором целей должны инициализировать значение свойства [**мсиинсталлперусер**](msiinstallperuser.md) равным 1. Это означает, что пакет может быть установлен в контексте "на компьютер" или "на пользователя" в Windows Server 2008 R2 и Windows 7. Установите свойство **мсиинсталлперусер** в пакете только в том случае, если оно было написано согласно рекомендациям по разработке, описанным в разделе [Создание отдельных пакетов](single-package-authoring.md) , и если предполагается предоставлять пользователям возможность установки пакета в контексте для каждого пользователя или на компьютере. Пакет с двойным набором значений также должен инициализировать значение свойства [**ALLUSERS**](allusers.md) равным 2. В этом случае для каждого пользователя в качестве контекста установки по умолчанию для приложения указывается. Если значение свойства **ALLUSERS** имеет любое значение, отличное от 2, установщик Windows игнорирует свойство **мсиинсталлперусер** .

Для просмотра содержимого PUASample1.msi используйте редактор базы данных установщик Windows, например [Orca.exe](orca-exe.md). Таблица [свойств](property-table.md) в образце пакета содержит следующие две записи.

[Свойство](property-table.md) Таблица (частичная)

| Свойство          | Значение |
|-------------------|-------|
| ALLUSERS          | 2     |
| мсиинсталлперусер | 1     |



 

## <a name="custom-dialog-box-for-installation-context"></a>Настраиваемое диалоговое окно для контекста установки

[Пользовательский интерфейс](user-interface.md) примера пакета содержит пример пользовательского диалогового окна верифиреадидиалог, которое позволяет пользователям выбирать контекст установки для каждого пользователя или компьютера во время установки. [Диалоговая](dialog-table.md) таблица содержит запись, описывающую диалоговое окно верифиреадидиалог. Значение, указанное в поле Attributes, равно 39, так как в этом диалоговом окне используются [биты стиля диалогового окна](dialog-style-bits.md)мсидбдиалогаттрибутесвисибле (1), мсидбдиалогаттрибутесмодал (2), мсидбдиалогаттрибутесминимизе (4) и msidbDialogAttributesTrackDiskSpace (32). В строке заголовка диалогового окна отображается заголовок, заданный значением свойства [**ProductName**](productname.md) .

[Диалоговое окно](dialog-table.md) Таблица (частичная) 

| Диалог            | хцентеринг | VCentering | Ширина | Высота: | Атрибуты | Заголовок           | Сначала элемент управления \_ | Элемент управления \_ по умолчанию | \_Отмена управления |
|-------------------|------------|------------|-------|--------|------------|-----------------|----------------|------------------|-----------------|
| верифиреадидиалог | 50         | 50         | 480   | 280    | 39         | \[ProductName\] | инсталлперусер | Следующая             | Отменить          |



 

Таблица [элементов управления](control-table.md) содержит записи для [элементов управления](controls.md) , отображаемых в диалоговом окне верифиреадидиалог. В диалоговом окне отображаются [кнопки](pushbutton-control.md) и элементы управления " [надпись](text-control.md) ". Все элементы управления используют [атрибуты управления](control-attributes.md)мсидбконтролаттрибутесенаблед (2) и мсидбконтролаттрибутесвисибле (1). Элемент управления Инсталлпермачине также использует атрибут элемента управления [елеватионшиелд](elevationshield-attribute.md) , мсидбконтролаттрибутеселеватионшиелд (8388608.) Этот атрибут элемента управления добавляет значок повышения прав контроля [*учетных записей*](u-gly.md) (UAC) (значок щита) в элемент управления инсталлпермачине и информирует пользователя о том, что для установки приложения в контексте на компьютере требуются учетные данные контроля учетных записей. Значение в текстовом поле таблицы управления является текстовым стилем и текстом, отображаемым элементом управления. Дополнительные сведения о добавлении текста в элемент управления с помощью предопределенных стилей см. в описании текстового поля в разделе «элемент управления».

[Элемент управления](control-table.md) Таблица (частичная)

| Диалог\_          | Control           | Тип       | attribute | Текст                                                   | Управление \_ следующим     |
|-------------------|-------------------|------------|-----------|--------------------------------------------------------|-------------------|
| верифиреадидиалог | Отменить            | PushButton | 3         | { \\ Tahoma10} &Отмена                                    | Следующая              |
| верифиреадидиалог | Назад          | PushButton | 3         | { \\ Tahoma10} <<&назад                          | Отменить            |
| верифиреадидиалог | Следующая              | PushButton | 3         | { \\ Tahoma10} &следующие >>                             | инсталлперусер    |
| верифиреадидиалог | Text2             | Текст       | 3         | Вы готовы выполнить приостановленную установку? |                   |
| верифиреадидиалог | инсталлперусер    | PushButton | 3         | { \\ Tahoma10} — установка только для &Me                       | инсталлпермачине |
| верифиреадидиалог | инсталлпермачине | PushButton | 8388611   | { \\ Tahoma10} установка для &всех                      | Назад          |
| верифиреадидиалог | Отменить            | PushButton | 3         | { \\ Tahoma10} &Отмена                                    | Следующая              |



 

В таблице [таблице ControlEvent событие](controlevent-table.md) указаны [контролевентс](control-events.md)или действия, выполняемые установщиком при взаимодействии пользователя с элементом управления. Когда пользователь активирует Инсталлперусерную кнопка, Пользовательский интерфейс отображает диалоговое окно Аутофдиск, если свойство [**аутофдискспаце**](outofdiskspace.md) равно 1, устанавливает значение свойства [**мсиинсталлперусер**](msiinstallperuser.md) равным 1, устанавливает [**для свойства**](allusers.md) [**мсифастинсталл**](msifastinstall.md) значение 1 и возвращает. Так как свойство **мсифастинсталл** задано, для установки не создается точка восстановления системы. Когда пользователь активирует Инсталлпермачиненую кнопка, Пользовательский интерфейс отображает диалоговое окно Аутофдиск, если свойство **аутофдискспаце** равно 1, устанавливает значение свойства **ALLUSERS** равным 1 и возвращает.

[Таблице ControlEvent событие](controlevent-table.md) Таблица (частичная) 

| Диалог\_          | элементом управления\_         | Событие                 | Аргумент  | Условие                 | Заказ |
|-------------------|-------------------|-----------------------|-----------|---------------------------|-------|
| верифиреадидиалог | инсталлперусер    | спавндиалог           | аутофдиск | Аутофдискспаце = 1        | 1     |
| верифиреадидиалог | инсталлперусер    | EndDialog             | Возвращает    | Аутофдискспаце <> 1 | 5     |
| верифиреадидиалог | инсталлперусер    | \[мсиинсталлперусер\] | 1         | 1                         | 2     |
| верифиреадидиалог | инсталлперусер    | \[ALLUSERS\]          | 2         | 1                         | 3     |
| верифиреадидиалог | инсталлпермачине | спавндиалог           | аутофдиск | Аутофдискспаце = 1        | 1     |
| верифиреадидиалог | инсталлпермачине | EndDialog             | Возвращает    | Аутофдискспаце <> 1 | 3     |
| верифиреадидиалог | инсталлпермачине | \[ALLUSERS\]          | 1         | 1                         | 2     |
| верифиреадидиалог | инсталлперусер    | \[мсифастинсталл\]    | 1         | 1                         | 4     |



 

Элемент управления Инсталлперусер должен быть удален из пользовательского интерфейса любой установки с использованием установщик Windows версии, более ранней, чем установщик Windows установщик Windows 5,0. Таблица [Таблица controlcondition](controlcondition-table.md) в образце пакета содержит четыре записи, которые отключают и скрывают элемент управления инсталлперусер, если текущая версия меньше установщик Windows 5,0. Для определения этого условия в таблице используется значение свойства [**версионмси**](versionmsi.md) и [синтаксис условного оператора](conditional-statement-syntax.md) . Действие, указанное в поле действие, выполняется только в том случае, если оператор в поле Condition имеет значение true.

[Таблица controlcondition](controlcondition-table.md) Таблица (частичная)

| Диалог\_          | элементом управления\_      | Действие  | Условие               |
|-------------------|----------------|---------|-------------------------|
| верифиреадидиалог | инсталлперусер | Включить  | Версионмси >= "5,00" |
| верифиреадидиалог | инсталлперусер | Отключить | Версионмси < "5,00"  |
| верифиреадидиалог | инсталлперусер | Показать    | Версионмси >= "5,00" |
| верифиреадидиалог | инсталлперусер | Скрыть    | Версионмси < "5,00"  |



 

## <a name="specifying-directory-structure"></a>Указание структуры каталогов

Используйте редактор базы данных для проверки таблицы [каталогов](directory-table.md) PUASample1.msi. Запись таблицы каталога с пустой строкой в \_ родительском поле каталога представляет корневой каталог как исходного, так и целевого дерева каталогов. Если свойство [**targetDir**](targetdir.md) не определено, установщик устанавливает значение свойства [**рутдриве**](rootdrive.md) во время установки. Если свойство [**SourceDir**](sourcedir.md) не определено, установщик устанавливает в качестве значения расположение каталога, содержащего пакет установщик Windows (MSI-файл). Имена каталогов задаются в коротком \| длинном формате.

[Каталог](directory-table.md) Таблица (частичная)

| Каталог          | \_Родительский каталог  | дефаултдир               |
|--------------------|--------------------|--------------------------|
| TARGETDIR          |                    | SourceDir                |
| ProgramFilesFolder | TARGETDIR          | .                        |
| программенуфолдер  | TARGETDIR          | .                        |
| INSTALLLOCATION    | мивендор           | Sample1 \| MSDN — PUASample1 |
| мивендор           | ProgramFilesFolder | MSFT \| Майкрософт          |



 

В источнике эта таблица [каталогов](directory-table.md) разрешается в следующие пути к каталогам.

<dl> \[SourceDir \] \\ MSFT \\ sample1  
\[SourceDir\]  
</dl>

На целевом объекте таблица [Directory](directory-table.md) разрешается в пути в следующей таблице. Установщик задает значения свойств [**ProgramFilesFolder**](programfilesfolder.md) и [**программенуфолдер**](programmenufolder.md) в местах, зависящих от [контекста установки](installation-context.md) , а также от того, является ли система 32-разрядной или 64-разрядной версией Windows Server 2008 R2 и Windows 7. Пути к целевым папкам зависят от того, выбирает ли пользователь установку на уровне пользователя или на компьютере.

| Контекст установки | Система                                                                              | Примеры путей                                                                                                                    |
|----------------------|-------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| Per-Machine          | Windows Server 2008 R2 и Windows 7<br/> 32-разрядная версия<br/>           | % ProgramFiles% \\ MSFT \\ sample1<br/> % ALLUSERSPROFILE% \\ \\ \\ программы меню "Пуск" Microsoft Windows \\<br/>                  |
| Per-Machine          | Windows Server 2008 R2 и Windows 7<br/> 64-разрядная версия<br/>           | % ProgramFiles (x86)% \\ MSFT \\ sample1<br/> % ALLUSERSPROFILE% \\ \\ \\ программы меню "Пуск" Microsoft Windows \\<br/>             |
| Per-User             | Windows Server 2008 R2 и Windows 7<br/> 32-разрядная или 64-разрядная версия<br/> | % USERPROFILE% \\ AppData \\ Local \\ Programs \\ MSFT \\ sample1<br/> \\ \\ \\ Программы меню "Пуск" в Microsoft Windows% AppData% \\<br/> |



 

Приложения для каждого пользователя должны храниться во вложенных папках в папке Programs, заданной значением свойства [**ProgramFilesFolder**](programfilesfolder.md) . Как правило, путь к приложению принимает следующую форму.

% LocalAppData% \\ Programs \\ *ISV имя* \\ *AppName*.

Данные конфигурации для каждого пользователя должны храниться в папке Programs, заданной значением свойства [**программенуфолдер**](programmenufolder.md) . Как правило, эта папка находится по следующему пути.

\\ \\ \\ Программы меню "Пуск" в Microsoft Windows% AppData% \\

При установке [32-разрядных компонентов пакета установщик Windows](32-bit-windows-installer-packages.md) используйте свойство [**ProgramFilesFolder**](programfilesfolder.md) и [**коммонфилесфолдер**](commonfilesfolder.md) в таблице [Directory](directory-table.md) . При установке [64-разрядных компонентов пакета установщик Windows](64-bit-windows-installer-packages.md) используйте свойства [**ProgramFiles64Folder**](programfiles64folder.md) и [**CommonFiles64Folder**](commonfiles64folder.md) . Если приложение содержит 32-разрядные и 64-разрядные версии одного и того же компонента с одним и тем же именем, убедитесь, что эти версии сохранены в разных каталогах или присвойте им разные имена.

В следующей таблице [каталога](directory-table.md) приведен пример макета каталога, совместимого с пакетом, который включает 32-разрядные и 64-разрядные компоненты и включает некоторые компоненты, которые совместно используются в разных приложениях.

| Каталог            | \_Родительский каталог    | дефаултдир                        |
|----------------------|----------------------|-----------------------------------|
| TARGETDIR            |                      | SourceDir                         |
| ProgramFilesFolder   | TARGETDIR            | .:P rog32                          |
| ProgramFiles64Folder | TARGETDIR            | .:P rog64                          |
| коммонфилесфолдер    | TARGETDIR            | .:Share32                         |
| CommonFiles64Folder  | TARGETDIR            | .:Share64                         |
| программенуфолдер    | TARGETDIR            | .: Sample1 \| MSDN — PUASample1        |
| INSTALLLOCATION      | мивендор             | Sample1 \| MSDN — PUASample1          |
| INSTALLLOCATIONX64   | Vendorx64            | Sample1 \| MSDN — PUASample1          |
| шаредлокатион       | швендор             | Sample1 \| MSDN — PUASample1          |
| SHAREDLOCATIONX64    | ShVendorx64          | Sample1 \| MSDN — PUASample1          |
| мивендор             | ProgramFilesFolder   | MSFT \| Майкрософт                   |
| Vendorx64            | ProgramFiles64Folder | MSFT \| Майкрософт                   |
| швендор             | коммонфилесфолдер    | MSFT \| Майкрософт                   |
| ShVendorx64          | CommonFiles64Folder  | MSFT \| Майкрософт                   |
| Shrx86               | шаредлокатион       | x32 \| 32-разрядные компоненты            |
| Shrx64               | SHAREDLOCATIONX64    | x64 \| 64-разрядные компоненты            |
| Binx86               | INSTALLLOCATION      | x32 \| 32-разрядные компоненты            |
| Binx64               | INSTALLLOCATIONX64   | x64 \| 64-разрядные компоненты            |
| App32                | Binx86               | MyApp \| — несовместное использование 32-разрядных компонентов |
| App64                | Binx64               | MyApp \| — несовместное использование 64-разрядных компонентов |
| Share32              | Shrx86               | Общие \| общие 32-разрядные компоненты  |
| Share64              | Shrx64               | Общие \| общие 64-разрядные компоненты  |



 

В источнике эта таблица [каталогов](directory-table.md) разрешается в следующие пути к каталогам.

<dl> \[SourceDir \] Prog32 \\ MSFT \\ sample1 \\ x32 \\ MyApp  
\[SourceDir \] Share32 \\ Common Files \\ MSFT \\ sample1 \\ x32 \\ Shared  
\[SourceDir \] Prog64 \\ MSFT \\ sample1 \\ x64 \\ MyApp  
\[SourceDir \] Share64 \\ Common Files \\ MSFT \\ sample1 \\ x64 \\ Shared  
\[SourceDir \] sample1  
</dl>

На целевом объекте эта таблица [каталогов](directory-table.md) разрешается в следующие пути к каталогам. Целевые пути зависят от [контекста установки](installation-context.md) и системы.

| Контекст установки | Система                                                                              | Примеры путей                                                                                                                                                                                                                                                                                                                                         |
|----------------------|-------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Per-Machine          | Windows Server 2008 R2 и Windows 7<br/> 32-разрядная версия<br/>           | % ProgramFiles% \\ MSFT \\ sample1 \\ x32 \\ MyApp<br/> % ProgramFiles% \\ общих файлов \\ MSFT \\ sample1 \\ x32 \\ Shared<br/> % ProgramFiles (x86)% \\ MSFT \\ sample1 \\ x64 \\ MyApp<br/> % ProgramFiles (x86)% \\ Common Files \\ MSFT \\ sample1 \\ x64 \\ Shared<br/> % Папка ProgramData% \\ \\ программ меню "Пуск" Microsoft Windows \\ \\ \\ sample1<br/>               |
| Per-Machine          | Windows Server 2008 R2 и Windows 7<br/> 64-разрядная версия<br/>           | % ProgramFiles (x86)% \\ MSFT \\ sample1 \\ x32 \\ MyApp<br/> % ProgramFiles (x86)% \\ Common Files \\ MSFT \\ sample1 \\ x32 \\ Shared<br/> % ProgramFiles% \\ MSFT \\ sample1 \\ x64 \\ MyApp<br/> % ProgramFiles% общих \\ файлов \\ MSFT \\ sample1 \\ x64 \\ Shared<br/> % Папка ProgramData% \\ \\ программ меню "Пуск" Microsoft Windows \\ \\ \\ sample1<br/>               |
| Per-User             | Windows Server 2008 R2 и Windows 7<br/> 32-разрядная или 64-разрядная версия<br/> | % LOCALAPPDATA% \\ Programs \\ MSFT \\ sample1 \\ x32 \\ MyApp<br/> % LOCALAPPDATA% \\ Programs \\ Common \\ MSFT \\ sample1 \\ x32 \\ Shared<br/> % LOCALAPPDATA% \\ Programs \\ MSFT \\ sample1 \\ x64 \\ MyApp<br/> % LOCALAPPDATA% \\ Programs \\ Common \\ MSFT \\ sample1 \\ x64 \\ Shared<br/> % APPDATA% \\ \\ программ меню "Пуск" Microsoft Windows \\ \\ \\ sample1<br/> |



 

## <a name="application-registration"></a>Регистрация приложения

PUASample.msi добавляет подраздел в раздел реестра путей приложений для приложения и выполняет регистрации, которые позволяют сохранить сведения о приложении в реестре с этим ключом. Дополнительные сведения о путях приложений и регистрации приложений см. в разделах [перцеиведтипес, системфилеассоЦиатионс и регистрация приложений](/previous-versions/windows/desktop/legacy/cc144150(v=vs.85)) в разделе [расширение оболочки](https://msdn.microsoft.com/library/bb762762.aspx) в документации [разработчика оболочки](/previous-versions/windows/desktop/legacy/bb776778(v=vs.85)). Во время установки пользователь принимает решение установить приложение в контексте установки "на пользователя" или "на компьютер". На момент создания пакета с двойным назначением разработчику пакета не удается выяснить, должны ли регистрации выполняться на \_ локальном компьютере hKey или в разделе \_ hKey \_ текущих \_ пользователей.

Разработчик пакета определяет идентификатор файла для исполняемого файла приложения в поле File таблицы [File](file-table.md) .

[Файл](file-table.md) Таблица (частичная) 

| Файл      | Компонент\_      | FileName                     | FileSize | Версия | Язык | Атрибуты | Последовательность |
|-----------|------------------|------------------------------|----------|---------|----------|------------|----------|
| мяппфиле | продукткомпонент | PUASAMP1.EXE\|PUASample1.exe | 81920    |         |          | 0          | 1        |



 

Значения, которые необходимо сохранить в реестре, можно указать в поле значение таблицы [реестра](registry-table.md) в виде [форматированной](formatted.md) строки. Используйте идентификатор файла, определенный в поле File таблицы [File](file-table.md) , и \[ \#  \] соглашение филекэй форматированного типа, чтобы указать значение по умолчанию для раздела реестра paths приложения. Действие по [установке](install-action.md) верхнего уровня выполняет действия в таблице [инсталлексекутесекуенце](installexecutesequence-table.md) . После завершения действий [костинитиализе](costinitialize-action.md), [филекост](filecost-action.md)и [функции InstallFinalize](installfinalize-action.md) в этой таблице установщик Windows заменяет отформатированную подстроку \[ \# мяппфиле \] в таблице реестра на полный путь к файлу приложения.

В примере определяется пользовательское свойство Регрут, которое содержит расположение корневого ключа, и используется настраиваемое действие для сброса значения свойства, если пользователь выбирает установку на компьютере. Используйте пользовательское свойство Регрут в любых форматированных строковых значениях, которые ссылаются на корневое расположение. В таблице [свойств](property-table.md) пакет PUASample.msi определяет пользовательское свойство и присваивает параметру РЕГРУТ значение HKCU. Это Инициализирует значение свойства для контекста установки на уровне пользователя, рекомендуемый контекст по умолчанию для пакетов с двойными целями.

[Свойство](property-table.md) Таблица (частичная)

| Свойство | Значение |
|----------|-------|
| регрут  | HKCU  |



 

В таблице [CustomAction](customaction-table.md) пакет определяет пользовательское действие с именем Set \_ регрут \_ HKLM. Значение в поле Тип определяет это как [настраиваемое](custom-action-type-51.md) настраиваемое действие 51 стандартного действия. Значение полей Source и Target в таблице CustomAction зависит от типа настраиваемого действия. Дополнительные сведения о стандартных типах настраиваемых действий см. в разделе [типы настраиваемых действий](summary-list-of-all-custom-action-types.md). Поле Source для \_ \_ настраиваемого действия Set регрут HKLM указывает, что значение свойства регрут. Если Установщик выполняет \_ \_ пользовательское действие Set регрут HKLM, значение свойства регрут сбрасывается в HKLM.

[CustomAction](customaction-table.md) Таблица (частичная)

| Действие             | Тип | Источник      | Назначение |
|--------------------|------|-------------|--------|
| Set \_ регрут \_ HKLM | 51   | \[регрут\] | HKLM   |



 

Действие по [установке](install-action.md) верхнего уровня выполняет действия в таблице [инсталлексекутесекуенце](installexecutesequence-table.md) в последовательности, указанной в поле Sequence этой таблицы. Значение, созданное в поле последовательности для \_ пользовательского действия Set регрут \_ HKLM (1501), указывает, что это настраиваемое действие должно выполняться после действия [инсталлинитиализе](installinitialize-action.md) (1500) и перед действием [процесскомпонентс](processcomponents-action.md) (1600.). Эта последовательность гарантирует, что запись для \_ \_ настраиваемого действия Set регрут HKLM будет оцениваться во время установки. Дополнительные сведения о рекомендуемой последовательности действий в таблице Инсталлексекутесекуенце см. в разделе [предлагаемый инсталлексекутесекуенце](suggested-installexecutesequence.md) . [Синтаксис условных инструкций](conditional-statement-syntax.md) , созданных в поле Condition, указывает, что \_ действие Set регрут \_ HKLM должно выполняться, только если значение свойства [**ALLUSERS**](allusers.md) равно 1 во время установки. Свойство **ALLUSERS** , равное 1, указывает установку на компьютер.

[Инсталлексекутесекуенце](installexecutesequence-table.md) Таблица (частичная)

| Действие             | Условие  | Последовательность |
|--------------------|------------|----------|
| Set \_ регрут \_ HKLM | ALLUSERS = 1 | 1501     |



 

Следующие записи в таблице [реестра](registry-table.md) выполняют регистрации, если установлен компонент продукткомпонент. Значение-1 в корневом поле требуется для выполнения регистрации на локальном компьютере в HKEY \_ \_ для установки на уровне пользователя и в разделе hKey \_ текущий \_ пользователь для установки на уровне пользователя. Запись с пустой строкой в поле реестра добавляет подраздел для приложения в раздел реестра Апппасс и устанавливает в качестве значения по умолчанию полный путь к исполняемому файлу приложения. Регистрация Мяпппасалиас сопоставляет исполняемый файл с псевдонимом приложения и позволяет запустить приложение, если пользователь вводит псевдоним "пуапкт" в командной строке. Регистрация Мяпппасрегистратион сопоставляет имя исполняемого файла с полным путем к файлу.



| Реестр              | Root | Клавиши                                                                     | Название | Значение                                                                            | Компонент        |
|-----------------------|------|-------------------------------------------------------------------------|------|----------------------------------------------------------------------------------|------------------|
|                       | -1   | Программное обеспечение \\ Microsoft \\ мяпппасрегистратионлокатион                      |      | \[Регрут \] \\ программное обеспечение \\ \\ \\ \\ пути к приложению Microsoft Windows CurrentVersion \\PUAPCT.exe | продукткомпонент |
| мяпппасалиас        | -1   | \\ \\ \\ Пути приложений Microsoft Windows CurrentVersion по \\ \\PUAPCT.exe     |      | \[\#мяппфиле\]                                                                  | продукткомпонент |
| мяпппасрегистратион | -1   | \\ \\ \\ Пути приложений Microsoft Windows CurrentVersion по \\ \\PUASample1.exe |      | \[\#мяппфиле\]                                                                  | продукткомпонент |



 

## <a name="autoplay-cancel-registration"></a>Автозапуск Отмена регистрации

PUASample.msi выполняет регистрации, которые позволяют пользователю приложения запретить запуск [аппаратного запуска](/previous-versions/windows/desktop/legacy/cc144210(v=vs.85)) для выбранных устройств. Сведения о регистрации обработчика для отмены автозапуска в ответ на событие см. в разделе [Подготовка оборудования и программного обеспечения для использования с автозапуском](/previous-versions//cc144208(v=vs.85)) в разделе [расширение оболочки](https://msdn.microsoft.com/library/bb762762.aspx) в [Руководстве разработчика оболочки](/previous-versions/windows/desktop/legacy/bb776778(v=vs.85)). Следующая запись регистрирует обработчик, указанный в поле имя, при установке компонента Продукткомпонент. Значение-1 в корневом поле должно указывать на установщик Windows, что регистрация должна перенаправляться в расположение, зависящее от контекста установки.

[Реестр](registry-table.md) Таблица 

| Реестр                     | Root | Клавиши                                                                                             | Название                                 | Значение | Компонент        |
|------------------------------|------|-------------------------------------------------------------------------------------------------|--------------------------------------|-------|------------------|
| мяутоплайканцелрегистратион | -1   | Программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ Explorer \\ аутоплайхандлерс \\ канцелаутоплай \\ CLSID | 66A32FE6-229D-427b-A608-D273F40C034C |       | продукткомпонент |



 

## <a name="preview-handler-registration"></a>Предварительный просмотр регистрации обработчика

PUASample.msi выполняет регистрации, необходимые для установки [обработчика просмотра](../shell/preview-handlers.md) , который позволяет просматривать PUA-файлы только для чтения без запуска приложения. Сведения о регистрации обработчиков просмотра см. в разделе [Регистрация обработчиков просмотра](../shell/how-to-register-a-preview-handler.md) статьи [расширение оболочки](https://msdn.microsoft.com/library/bb762762.aspx) в [Руководстве разработчика оболочки](/previous-versions/windows/desktop/legacy/bb776778(v=vs.85)). Следующие записи в таблице [реестра](registry-table.md) регистрируют обработчик при установке компонента продукткомпонент. Значение-1 в корневом поле должно указывать на установщик Windows, что регистрация должна перенаправляться в расположение, зависящее от контекста установки.

[Реестр](registry-table.md) Таблица

| Реестр                       | Root | Клавиши                                                                              | Название                                   | Значение                                        | Компонент        |
|--------------------------------|------|----------------------------------------------------------------------------------|----------------------------------------|----------------------------------------------|------------------|
| MyPreviewHandlerRegistration1  | -1   | Классы программного обеспечения \\ \\ . PUA                                                          |                                        | пуафиле                                      | продукткомпонент |
| MyPreviewHandlerRegistration2  | -1   | Программное обеспечение \\ Microsoft \\ Windows \\ CurrentVersion \\ превиевхандлерс                    | {1531d583-8375-4d3f-b5fb-d23bbd169f22} | Обработчик предварительной версии Microsoft Windows PUA TEST   | продукткомпонент |
| MyPreviewHandlerRegistration3  | -1   | Классы программного обеспечения \\ \\ пуафиле \\ шеллекс \\ {8895b1c6-b41f-4c1c-A562-0d564250836f}      |                                        | {1531d583-8375-4d3f-b5fb-d23bbd169f22}       | продукткомпонент |
| MyPreviewHandlerRegistration4  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22}                 |                                        | Обработчик предварительной версии Per-User приложения отменено Sample 1 | продукткомпонент |
| MyPreviewHandlerRegistration5  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22}                 | AppID                                  | {6d2b5079-2f0b-48dd-ab7f-97cec514d30b}       | продукткомпонент |
| MyPreviewHandlerRegistration6  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22}                 | DisplayName                            | @shell32,-38242                              | продукткомпонент |
| MyPreviewHandlerRegistration7  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22}                 | Значок                                   | notepad.exe, 2                                | продукткомпонент |
| MyPreviewHandlerRegistration8  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22} \\ InprocServer32 | ThreadingModel.                         | Разделение                                    | продукткомпонент |
| MyPreviewHandlerRegistration9  | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22} \\ InprocServer32 |                                        | \#%% SystemRoot% \\ system32 \\shell32.dll       | продукткомпонент |
| MyPreviewHandlerRegistration10 | -1   | Классы программного обеспечения \\ \\ CLSID \\ {1531d583-8375-4d3f-b5fb-d23bbd169f22} \\ InprocServer32 | ProgID:                                 | пуафиле                                      | продукткомпонент |



 

 

 
