---
description: Вы можете выполнять отладку пользовательских действий, основанных на библиотеках динамической компоновки, с помощью средств отладки для Windows. Нельзя использовать динамическую отладку с настраиваемыми действиями на основе исполняемых файлов или скриптов.
ms.assetid: 4241a27a-c127-4c65-96a2-1d655b343eba
title: Отладка настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ddfbc9952f0dd7fc1b85b5c64fa6a23381ceafe
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105663716"
---
# <a name="debugging-custom-actions"></a>Отладка настраиваемых действий

Вы можете выполнять отладку пользовательских действий, основанных на [библиотеках динамической компоновки](dynamic-link-libraries.md) , с помощью [средств отладки для Windows](https://www.microsoft.com/?ref=go). Нельзя использовать динамическую отладку с настраиваемыми действиями на основе [исполняемых файлов](executable-files.md) или [скриптов](scripts.md).

Методы, описанные в этом разделе, помогут вам выполнить отладку установщик Windows пользовательских действий. Сведения о [средствах отладки для Windows](https://www.microsoft.com/?ref=go)см. в разделе средства разработки драйверов пакета Windows Driver Kit (WDK).

Установщик Windows использует переменную среды Мсибреак, чтобы определить, какое настраиваемое действие следует отлаживать. Если у вас есть доступ к исходному коду настраиваемого действия, вы можете использовать отладку без Мсибреак. Чтобы начать отладку без Мсибреак, вставьте временное окно сообщения в начале кода действия. Когда в процессе установки появится окно сообщения, Подключите отладчик к процессу, владеющему окном сообщения. Затем можно задать все необходимые точки останова и закрыть окно сообщения, чтобы возобновить выполнение. Невозможно выполнить отладку предыдущих частей настраиваемого действия с помощью этого метода.

Чтобы использовать переменную среды Мсибреак для отладки настраиваемого действия, задайте Мсибреак в качестве имени настраиваемого действия в [таблице CustomAction](customaction-table.md). Мсибреак может быть либо системной, либо пользовательской переменной среды. Если переменная задана как системная переменная, то при изменении значения для обнаружения нового значения может потребоваться перезагрузка системы.

Чтобы использовать переменную среды Мсибреак для отладки внедренного пользовательского интерфейса, присвойте параметру Мсибреак значение Мсиембеддедуи.

Установщик Windows только проверяет переменную среды Мсибреак, если пользователь является администратором. Установщик игнорирует значение параметра Мсибреак, если пользователь не является администратором, даже если это [*управляемое приложение*](m-gly.md).

При отладке настраиваемого действия, выполняемого с привилегиями с повышенными правами (System) в последовательности выполнения, Подключите отладчик к службе установщик Windows. При отладке настраиваемого действия, которое выполняется с олицетворенными привилегиями в последовательности выполнения, система запрашивает диалоговое окно с указанием, какой процесс должен быть отлажен. Пользователю будет предложено диалоговое окно с указанием процесса отладки. Дополнительные сведения о настраиваемых действиях с повышенными правами см. в разделе [Безопасность настраиваемых действий](custom-action-security.md).

После присоединения отладчика к нужному процессу установщик активирует точку останова отладчика непосредственно перед вызовом точки входа библиотеки DLL. В точке останова ваша библиотека DLL уже загружена в процесс и определен адрес точки входа. Если не удалось загрузить библиотеку DLL пользовательского действия или точка входа настраиваемого действия не существует, точка останова не запускается. Так как точка останова активируется перед вызовом функции DLL, после активации точки останова следует использовать отладчик, чтобы перейти на другой адрес до вызова точки входа настраиваемого действия. Кроме того, можно задать точку останова в любом месте настраиваемого действия и возобновить нормальное выполнение.

Установщик Windows выполняет библиотеки DLL, не хранящиеся в [двоичной таблице](binary-table.md) непосредственно из расположения библиотеки DLL. Установщик не знает исходное имя библиотеки DLL, хранящейся в двоичной таблице, и запускает настраиваемое действие DLL с именем временного файла. Формат имени временного файла — MSI?????. TMP. В Windows XP этот временный файл хранится в безопасном месте, обычно в <WindowFolder> \\ установщике.

Обратите внимание, что многие библиотеки DLL, созданные для отладки, содержат имя и путь к соответствующему PDB-файлу в составе самой библиотеки DLL. При отладке библиотеки DLL этого типа в системе, где файл PDB можно найти в расположении, хранящемся в библиотеке DLL, символы могут загружаться автоматически с помощью средства отладки. В ситуациях, когда PDB не удается найти в сохраненном расположении, где отладчик не поддерживает загрузку символов из сохраненного расположения или если библиотека DLL не была построена с отладочной информацией, может потребоваться поместить файлы символов в папку с временным файлом DLL.

Установщик добавляет отладочную информацию для сценариев настраиваемых действий в файл журнала установки.

``` syntax
There is a problem with this Windows Installer package. A script 
required for this install to complete could not be run. Contact your 
support personnel or package vendor.  {Custom action [2] script error 
[3], [4]: [5] Line [6], Column [7], [8] }
```

 

 



