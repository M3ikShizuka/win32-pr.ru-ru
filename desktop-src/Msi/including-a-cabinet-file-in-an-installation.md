---
description: В этом разделе описывается включение CAB-файлов при установке. Дополнительные сведения см. в разделе Использование ящиков и сжатых источников.
ms.assetid: 17ea7f76-90b2-48fb-8187-64dc6d294443
title: Включение CAB-файла в установку
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 098e660de3f7ec7097ab02613d75219ac0a0d624
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105650698"
---
# <a name="including-a-cabinet-file-in-an-installation"></a>Включение CAB-файла в установку

В этом разделе описывается включение CAB-файлов при установке. Дополнительные сведения см. [в разделе Использование ящиков и сжатых источников](using-cabinets-and-compressed-sources.md).

**Включение CAB-файла в пакет установки**

1.  Используйте средство создания CAB-файлов, чтобы сжать исходные файлы в CAB-файл. См. [CAB-файлы](cabinet-files.md).
2.  CAB-файл должен находиться в потоке данных внутри MSI-файла или в отдельном CAB-файле, расположенном в корне исходного дерева, заданном в [таблице Directory](directory-table.md).
3.  Определите, является ли источник сжатым типом или смешанным типом, который содержит как несжатые, так и сжатые файлы. См. раздел [сжатые и несжатые источники](compressed-and-uncompressed-sources.md). В зависимости от типа исходного изображения установите флаги сжатых или несжатых битов для свойства [**Сводка слов**](word-count-summary.md) "Статистика".
4.  Добавьте запись в [таблицу файлов](file-table.md) для каждого файла в CAB-файле. Введите ключ файла в столбец File, который точно соответствует ключу файла в CAB-файле. В ключах файлов учитывается регистр. Последовательность установки файлов в таблице File и в CAB-файле также должна совпадать. Последовательность файлов указывается порядковым номером в столбце последовательности. Чтобы приступить к порядковому номеру первого файла в CAB-файле, выполните следующие действия. Найдите существующую запись в [таблице Media](media-table.md) , имеющую наибольшее значение в столбце DiskID. Поле Ластсекуенце этой записи содержит последний номер последовательности файлов, используемый на носителе. В таблице File Назначьте первому файлу нового CAB-файла порядковый номер, который больше этого. Присвойте порядковые номера всем оставшимся файлам в том же порядке, что и в CAB-файле. Описание оставшихся полей записей см. в разделе [File Table](file-table.md).
5.  Добавьте запись в [таблицу Media](media-table.md) для CAB-файла. Укажите значение в поле DiskID этой новой записи, которое больше, чем максимальное значение DiskID, уже существующее в таблице. Вставьте имя CAB-файла в поле CAB-файла. Это имя должно быть в виде типа данных [CAB](cabinet.md) . Добавьте перед именем знак решетки " \# ", если CAB-файл является потоком данных, хранящимся в файле MSI. Обратите внимание, что если CAB-файл является потоком данных, в имени CAB-файла учитывается регистр. Если CAB-файл является отдельным файлом, в имени файла регистр не учитывается.
6.  Определите наибольший порядковый номер файла в новом CAB-файле, проверив столбец последовательности обновленной таблицы файлов. Введите значение, которое больше этого, в поле Ластсекуенце новой записи таблицы мультимедиа. Описание оставшихся полей записей см. в разделе [Таблица мультимедиа](media-table.md).
7.  CAB-файл можно сохранить в установочном пакете с помощью такого средства, как Msidb.exe или с помощью [функций базы данных](database-functions.md)установщика. В следующих четырех шагах объясняется, как добавить CAB-файл из программы с помощью функций базы данных.
8.  Чтобы добавить CAB-файл в установочный пакет из программы, откройте представление в [ \_ таблице Streams](-streams-table.md) базы данных с помощью [**мсидатабасеопенвиев**](/windows/desktop/api/Msiquery/nf-msiquery-msidatabaseopenviewa).
9.  Используйте [**мсирекордсетстринг**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstringa) , чтобы задать для столбца Name \_ таблицы Streams имя, отображаемое в столбце CAB-файла [таблицы Media](media-table.md). Опустить знак номера: \# .
10. Используйте [**мсирекордсетстреам**](/windows/desktop/api/Msiquery/nf-msiquery-msirecordsetstreama) , чтобы задать для столбца данных \_ таблицы Streams данные CAB-файла.
11. Используйте [**мсивиевмодифи**](/windows/desktop/api/Msiquery/nf-msiquery-msiviewmodify) для обновления записи в \_ таблице Streams.
12. Чтобы использовать Msidb.exe для добавления CAB-файла Mycab.cab в установочный пакет с именем Mydatabase.msi, используйте следующую командную строку: Msidb.exe-d mydatabase.msi-a mycab.cab. В этом случае столбец CAB-файла таблицы мультимедиа должен содержать строку: \#mycab.cab.

 

 



