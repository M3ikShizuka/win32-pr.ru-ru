---
description: Приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют диспетчер перезапуска для уменьшения числа перезапусков системы.
ms.assetid: 821739ff-f7a7-4192-ad34-254aa7d74d13
title: Использование установщик Windows с диспетчером перезапуска
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4160b2241c75ec7305accd1ab4d1295a54fa9f65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105673366"
---
# <a name="using-windows-installer-with-restart-manager"></a>Использование установщик Windows с диспетчером перезапуска

Приложения, использующие установщик Windows 4,0 для установки и обслуживания в Windows Vista, автоматически используют [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы. Поведение по умолчанию в Windows Vista — завершение работы приложений, а не выключение и перезапуск операционной системы везде, где это возможно. В случаях, когда перезапуск системы недоступен, установщики могут использовать API [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) , чтобы запланировать перезапуск таким образом, чтобы минимизировать перебои в работе потока пользователя.

Установщик Windows разработчики могут выполнять следующие действия по подготовке пакета для работы с [диспетчером перезапуска](../rstmgr/restart-manager-portal.md).

-   Добавьте в пакет диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) . Если в пакете имеется диалоговое окно Мсирмфилесинусе, пользователь Windows Vista, выполняющий установку на [уровне пользовательского интерфейса](user-interface-levels.md) , получает возможность автоматического закрытия и перезапуска приложений. Пакет установки может содержать сведения как в диалоговом окне Мсирмфилесинусе, так и в диалоговом окне [филесинусе](filesinuse-dialog.md) . Диалоговое окно Мсирмфилесинусе отображается только в том случае, если пакет устанавливается по крайней мере установщик Windows 4,0 в Windows Vista, и в противном случае игнорируется. Существующие пакеты, не имеющие диалогового окна Мсирмфилесинусе, продолжают работать с помощью диалогового окна Филесинусе. Преобразование настройки можно использовать для добавления диалогового окна Мсирмфилесинусе в существующие пакеты.

    Конечные пользователи обычно запускают установку на полном [уровне](user-interface-levels.md)пользовательского интерфейса. Базовый пользовательский интерфейс или ограниченные установки уровня пользовательского интерфейса позволяют пользователю использовать [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md) для уменьшения числа перезапусков системы, даже если отсутствует диалоговое окно [мсирмфилесинусе](msirmfilesinuse-dialog.md) . Автоматическая установка на уровне пользовательского интерфейса всегда завершает работу приложений и служб, а в Windows Vista всегда используйте диспетчер перезапуска.

-   Регистрация приложений для перезапуска с помощью функции [**регистераппликатионрестарт**](/windows/win32/api/winbase/nf-winbase-registerapplicationrestart) . Диспетчер перезапуска может перезапустить только те приложения, которые были зарегистрированы для перезапуска. Диспетчер перезапуска перезапускает зарегистрированные приложения после установки. Если для установки требуется перезагрузка системы, диспетчер перезапускает перезапуск зарегистрированного приложения после перезагрузки системы.
-   Укажите ИНСТАЛЛЛОГМОДЕ \_ рмфилесинусе при включении обработчика внешнего пользовательского интерфейса с функциями [**Мсисетекстерналуи**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) и [**мсисетекстерналуирекорд**](/windows/desktop/api/Msi/nf-msi-msisetexternaluirecord) . Установщик Windows отправляет \_ сообщение РМФИЛЕСИНУСЕ инсталлмессаже для внешних обработчиков пользовательского интерфейса, поддерживающих [Диспетчер перезапуска](../rstmgr/restart-manager-portal.md). Если зарегистрированный или внутренний пользовательский интерфейс не обрабатывает сообщение ИНСТАЛЛМЕССАЖЕ \_ рмфилесинусе, установщик отправляет \_ сообщение инсталлмессаже филесинусе для обработчиков пользовательского интерфейса, поддерживающих диалоговое окно [филесинусе](filesinuse-dialog.md) . Дополнительные сведения см. в разделе [Использование диспетчера перезапуска с внешним пользовательским интерфейсом](using-restart-manager-with-an-external-ui-.md).
-   Настраиваемые действия могут добавлять ресурсы, принадлежащие сеансу [диспетчера перезапуска](../rstmgr/restart-manager-portal.md) . Настраиваемое действие должно быть упорядочено до действия [инсталлвалидате](installvalidate-action.md) . Настраиваемые действия могут использовать свойство [**мсирестартманажерсессионкэй**](msirestartmanagersessionkey.md) для получения ключа сеанса и должны вызывать функции [**РМЖОИНСЕССИОН**](/windows/win32/api/restartmanager/nf-restartmanager-rmjoinsession) и [**рмендсессион**](/windows/win32/api/restartmanager/nf-restartmanager-rmendsession) API диспетчера перезапуска. Настраиваемые действия не могут удалять ресурсы, принадлежащие сеансу диспетчера перезапуска. Пользовательские действия не должны пытаться завершить работу или перезапустить приложения с помощью функций [**рмшутдовн**](/windows/win32/api/restartmanager/nf-restartmanager-rmshutdown), [**RmGetList**](/windows/win32/api/restartmanager/nf-restartmanager-rmgetlist) и [**рмрестарт**](/windows/win32/api/restartmanager/nf-restartmanager-rmrestart) .
-   Авторы пакетов могут основывать условие в [таблице лаунчкондитион](launchcondition-table.md) свойства [**мсисистемребутпендинг**](msisystemrebootpending.md) , чтобы предотвратить установку пакета при ожидании перезагрузки системы.
-   Авторы пакетов и администраторы могут управлять взаимодействием установщик Windows и диспетчера перезапуска с помощью свойств [**мсирестартманажерконтрол**](msirestartmanagercontrol.md), [**мсидисаблермрестарт**](msidisablermrestart.md), [**мсирмшутдовн**](msirmshutdown.md) и политики [дисаблеаутоматикаппликатионшутдовн](disableautomaticapplicationshutdown.md) .
-   Приложения и службы должны следовать рекомендациям, описанным в разделе [Использование диспетчера перезапуска](../rstmgr/using-restart-manager.md) документации по [диспетчеру перезапуска](../rstmgr/restart-manager-portal.md) .

 

 
