---
description: Пользовательские действия нондеферред, вызывающие библиотеки или скрипты динамической компоновки, могут получить доступ к выполняющейся установке для запроса или изменения атрибутов текущего сеанса установки.
ms.assetid: cf70b0b3-ac81-47ab-a4c8-4db53ed9dc84
title: Доступ к текущему сеансу установщика из пользовательского действия
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29a870247f70742d408c0f5d1d0e67f20cef65d3
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127143154"
---
# <a name="accessing-the-current-installer-session-from-inside-a-custom-action"></a>Доступ к текущему сеансу установщика из пользовательского действия

Пользовательские действия нондеферред, вызывающие библиотеки или [скрипты](scripts.md) [динамической компоновки](dynamic-link-libraries.md) , могут получить доступ к выполняющейся установке для запроса или изменения атрибутов текущего сеанса установки. Для каждого процесса может существовать только один объект **сеанса** , а сценарии настраиваемых действий не должны пытаться создать другой сеанс.

Настраиваемые действия могут добавлять, изменять или удалять временные строки, столбцы или таблицы из базы данных. Настраиваемые действия не могут изменять постоянные данные в базе данных, например данные, которые являются частью базы данных, хранящейся на диске.

[Библиотеки динамической компоновки](dynamic-link-libraries.md)

Для доступа к выполняющейся установке настраиваемые действия, вызывающие библиотеки динамической компоновки (DLL), передаются в качестве единственного аргумента для точки входа DLL, именуемой в столбце Target [таблицы CustomAction](customaction-table.md). Поскольку установщик предоставляет этот обработчик, пользовательское действие не должно закрывать его, например, для получения маркера *хинсталл* из установщика, функция настраиваемого действия объявляется следующим образом.


```C++
UINT __stdcall CustomAction(MSIHANDLE hInstall)
```



Для доступа только для чтения к текущей базе данных получите маркер базы данных путем вызова [**метод msigetactivedatabase**](/windows/desktop/api/Msiquery/nf-msiquery-msigetactivedatabase). Дополнительные сведения см. [в разделе Получение маркера базы данных](obtaining-a-database-handle.md).

[Scripts](scripts.md)

настраиваемые действия, написанные на языке VBScript или JScript, могут получать доступ к текущему сеансу установки с помощью [**объекта session**](session-object.md). Установщик создает объект **сеанса** с именем Session, который ссылается на текущую установку. Для доступа только для чтения к текущей базе данных используйте свойство [**Database**](session-database.md) объекта **Session** .

Поскольку скрипт запускается из контекста объекта [**Session**](session-object.md) , не всегда нужно указывать полные свойства и методы. В следующем примере при использовании VBScript ссылка Me может заменить объект **Session** , например, следующие три строки эквивалентны.


```VB
Session.SetInstallLevel 1
```




```VB
Me.SetInstallLevel 1
```




```VB
SetInstallLevel 1
```



[Исполняемые файлы](executable-files.md)

Невозможно получить доступ к текущему сеансу установщика из пользовательских действий, которые вызывают исполняемые файлы, запускаемые с помощью командной строки, например, [тип настраиваемого действия 2](custom-action-type-2.md) и [тип настраиваемого действия 18](custom-action-type-18.md).

[Пользовательские действия отложенного выполнения](deferred-execution-custom-actions.md)

Невозможно получить доступ к текущему сеансу установщика или ко всем данным свойств из настраиваемого действия отложенного выполнения. Дополнительные сведения см. в разделе [Получение контекстных сведений для отложенного выполнения настраиваемых действий](obtaining-context-information-for-deferred-execution-custom-actions.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Доступ к базе данных или сеансу из настраиваемого действия](accessing-a-database-or-session-from-inside-a-custom-action.md)
</dt> </dl>

 

 



