---
description: В этом разделе приведен список советов, связанных с основной документацией по установщик Windows SDK, которая поможет разработчикам приложений, авторам программы установки, ИТ-специалистам и разработчикам инфраструктуры найти рекомендации по использованию установщик Windows.
ms.assetid: ff48d995-fe6f-4d1b-898d-67574ed3c5b7
title: Рекомендации по установщик Windows
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ffaf6aae83afbe510f2b1eefc447e34754296ba
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104081059"
---
# <a name="windows-installer-best-practices"></a>Рекомендации по установщик Windows

В этом разделе приведен список советов, связанных с основной документацией по установщик Windows SDK, которая поможет разработчикам приложений, авторам программы установки, ИТ-специалистам и разработчикам инфраструктуры найти рекомендации по использованию установщик Windows.

-   [Обновите версию установщик Windows.](#update-the-windows-installer-version)
-   [Соответствие требованиям к сертификации эмблемы Windows.](#meet-the-windows-logo-certification-requirements)
-   [Подготовка пакета к локализации.](#prepare-the-package-for-localization)
-   [Обновление средств и документации по разработке установщик Windows.](#update-your-windows-installer-development-tools-and-documentation)
-   [Если вы решили переупаковать устаревшее приложение установки, следуйте рекомендациям по перепакетированию.](#if-you-decide-to-repackage-a-legacy-setup-application-follow-good-repackaging-practices)
-   [Не пытайтесь заменить защищенные ресурсы.](#do-not-try-to-replace-protected-resources)
-   [Не зависят от некритических ресурсов.](#do-not-depend-upon-non-critical-resources)
-   [Используйте API для получения сведений о конфигурации установщик Windows.](#use-the-api-to-retrieve-windows-installer-configuration-information)
-   [Организуйте установку приложения вокруг компонентов.](#organize-the-installation-of-your-application-around-components)
-   [Сократите размер больших пакетов установщик Windows.](#reduce-the-size-of-large-windows-installer-packages)
-   [При использовании настраиваемых действий следуйте хорошим рекомендациям по настраиваемым действиям.](#if-you-use-custom-actions-follow-good-custom-action-practices)
-   [Если вы используете сборки, следуйте хорошим рекомендациям по сборке](#if-you-use-assemblies-follow-good-assembly-practices)
-   [Не поставлять параллельные установки.](#do-not-ship-concurrent-installations)
-   [Обеспечьте единообразие имен пакетов и кодов пакетов.](#keep-package-names-and-package-codes-consistent)
-   [Не используйте таблицы Селфрег и TypeLib.](#do-not-use-the-selfreg-and-typelib-tables)
-   [Укажите параметр для установки без пользовательского интерфейса.](#provide-the-option-to-install-without-a-user-interface)
-   [Избегайте использования политики AlwaysInstallElevated.](#avoid-using-the-alwaysinstallelevated-policy)
-   [Включите политику Дисаблемедиа, чтобы ограничить несанкционированную установку.](#enable-the-disablemedia-policy-to-limit-unauthorized-installation)
-   [Обеспечьте безопасность и доступность исходных исходных файлов пакета для пользователей.](#keep-the-original-package-source-files-secure-and-available-to-users)
-   [Включите подробное ведение журнала на компьютере пользователя при устранении неполадок развертывания.](#enable-verbose-logging-on-users-computer-when-troubleshooting-deployment)
-   [При удалении компьютер пользователя остается в чистом состоянии.](#uninstallation-leaves-the-users-computer-in-a-clean-state)
-   [Тестовые пакеты для развертывания с установкой на уровне пользователя и на компьютере.](#test-packages-for-both-per-user-and-per-machine-installation-deployment)
-   [Спланируйте и протестируйте стратегию обслуживания перед отправкой приложения.](#plan-and-test-a-servicing-strategy-before-shipping-the-application)
-   [Сократите зависимость обновлений от исходных источников.](#reduce-the-dependency-of-updates-upon-the-original-sources)
-   [Не распространяйте необслуживаемые модули слияния.](#do-not-distribute-unserviceable-merge-modules)
-   [Избегайте установки исправлений для административных установок.](#avoid-patching-administrative-installations)
-   [Регистрация обновлений для запуска с повышенными привилегиями.](#register-updates-to-run-with-elevated-privilege)
-   [Используйте таблицу Мсипатчсекуенце для последовательного исправления.](#use-the-msipatchsequence-table-to-sequence-patches)
-   [Тщательно протестируйте пакет установки.](#test-the-installation-package-thoroughly)
-   [Устраните все ошибки проверки перед развертыванием нового или измененного пакета установки.](#fix-all-validation-errors-before-deploying-a-new-or-revised-installation-package)
-   [Создайте безопасную установку.](#author-a-secure-installation)
-   [Использовать ПМСИХАНДЛЕ вместо HANDLE](#use-pmsihandle-instead-of-handle)

## <a name="update-the-windows-installer-version"></a>Обновите версию установщик Windows.

-   Используйте установщик Windows 5,0 в Windows Server 2008 R2 и Windows 7. Это установщик Windows версия, предоставляемая операционной системой.
-   Используйте установщик Windows 4,5 в Windows Server 2008, Windows Server 2003 с пакетом обновления 1 (SP1), Windows Vista с пакетом обновления 1 (SP1) или Windows XP с пакетом обновления 2 (SP2). Сведения о получении последней версии установщик Windows см. в разделе [установщик Windows распространяемые пакеты](windows-installer-redistributables.md).
-   Используйте установщик Windows 3,1 в Windows 2000 с пакетом обновления 3 (SP3). В установщик Windows версии 3,1 есть функции, упрощающие обслуживание приложений и [установку исправлений](patching.md).
-   Многие важные функции появились в версии 3,0 и перечислены в разделе, [не поддерживаемом в установщик Windows версии 2,0](not-supported-in-windows-installer-version-2-0.md). Пакеты установки и обновления, созданные для установщик Windows 2,0, можно установить с помощью установщик Windows 3,0 и более поздних версий. Пакеты исправлений, содержащие новые таблицы, используемые установщик Windows 3,0, по-прежнему могут применяться в более ранних версиях установщик Windows но без функции исправления установщик Windows 3,0. Кроме того, можно создавать исправления, явно требующие установщик Windows 3,0, которые не могут быть применены в более ранних версиях установщик Windows. Если пользователь не может обновить версию установщика, убедитесь, что приложение или обновление будет совместимо с будущим обновлением установщик Windows.
-   Список функций установщик Windows, не поддерживаемых более ранними версиями установщика Windows, см. в разделе [новые возможности установщик Windows](what-s-new-in-windows-installer.md).

## <a name="meet-the-windows-logo-certification-requirements"></a>Соответствие требованиям к сертификации эмблемы Windows.

-   Даже если вы не планируете отправлять приложение в программу Logo, следуйте рекомендациям по сертификации с логотипом, чтобы повысить эффективность установщик Windows пакета. Общие сведения о требованиях к логотипам и ссылки на программы сертификации, относящиеся к конкретным логотипам, см. в разделе [требования к установщик Windows и логотипам](windows-installer-and-logo-requirements.md).

## <a name="prepare-the-package-for-localization"></a>Подготовка пакета к локализации.

-   Рекомендуется подготовиться к будущей локализации при создании исходного пакета установки. Вы можете выполнить предложенную процедуру локализации пакета в разделе [локализация пакета установщик Windows](localizing-a-windows-installer-package.md).

## <a name="update-your-windows-installer-development-tools-and-documentation"></a>Обновление средств и документации по разработке установщик Windows.

-   [Средства разработки установщик Windows](windows-installer-development-tools.md) не являются распространяемыми, и вы должны использовать только версии этих средств, доступные в корпорации Майкрософт. Они доступны в [Windows SDK компонентов для разработчиков установщик Windows](platform-sdk-components-for-windows-installer-developers.md) в пакете средств разработки программного обеспечения (SDK) для Microsoft Windows.
-   Несколько независимых поставщиков программного обеспечения предлагают средства для создания или изменения пакетов установщик Windows. Эти средства могут предоставлять среду для создания пакетов, которая может быть проще в использовании, чем средства, предоставляемые пакетом SDK для установщик Windows. Дополнительные сведения об этих средствах можно получить из информационных ресурсов, обсуждаемых в [других источниках установщик Windows сведений](other-sources-of-windows-installer-information.md).
-   Возможность создания пакета из текстовых файлов может быть более интуитивно понятной для некоторых разработчиков. Набор средств установщик Windows XML (WiX), доступный в [SourceForge.NET](https://sourceforge.net/projects/wix) , создает пакеты установки Windows из ИСХОДНОГО кода XML.
-   Документация в [пакете SDK установщик Windows](./windows-installer-portal.md) , выпущенная в библиотеке MSDN Online, наиболее часто обновляется.
-   Используйте последнюю версию [Msizap.exe](msizap-exe.md) (версии 3.1.4000.2726 или выше), которая доступна в [Windows SDK компонентов для установщик Windows разработчиков](platform-sdk-components-for-windows-installer-developers.md) для Windows Vista или более поздних версий. Более ранние версии Msizap.exe могут удалять сведения обо всех обновлениях, примененных к другим приложениям на компьютере пользователя. Если эта информация будет удалена, для получения дополнительных обновлений может потребоваться удаление и повторная установка этих приложений.
-   Редактор таблиц базы данных [Orca.exe](orca-exe.md) является редактором таблиц базы данных для создания и редактирования пакетов установщик Windows и модулей слияния. Он имеет базовый графический интерфейс, но поддерживает расширенные возможности редактирования установщик Windows баз данных. Даже если вы используете другое приложение в качестве основного средства разработки, вы можете использовать Orca.exe удобно при устранении неполадок и тестировании пакета.
-   См. [другие источники установщик Windows сведений](other-sources-of-windows-installer-information.md) о текущих установщик Windowsх, доступных в блогах, технических обсуждениях, группах новостей, технических статьях и веб-сайтах.

## <a name="if-you-decide-to-repackage-a-legacy-setup-application-follow-good-repackaging-practices"></a>Если вы решили переупаковать устаревшее приложение установки, следуйте рекомендациям по перепакетированию.

Многие поставщики приложений предоставляют собственные пакеты установщик Windows для установки или их продуктов. Программное обеспечение, преобразующее существующее приложение установки прежних версий в пакет установщик Windows, называется средством переупаковки. В техническом [руководстве по созданию пакетов установщик Windows и перепакетированию программного обеспечения для установщик Windows](https://www.microsoft.com/technet/prodtechnol/windows2000serv/howto/winstall.mspx) описано средство перепакетирования, доступное для коммерческого доступа. Перекомпоновка существующего приложения установки не является оптимальной практикой при разработке. Приложения, разработанные с самого начала, могут быть проще в установке и обслуживании для использования преимуществ функций установщик Windows. Если вы решили использовать переупаковку программного обеспечения, приведенные ниже рекомендации помогут вам получить более установщик Windowsный пакет.

-   Перепакетирование средств преобразуют устаревшие установки в установщик Windowsный пакет, используя изображение промежуточной системы до и после установки. Все изменения в реестре, изменения файлов или системные параметры, происходящие во время процесса записи, включаются в установку. Настройте оборудование и программное обеспечение компьютера, используемого для повторной упаковки установки, как можно ближе к системе предполагаемого пользователя. Создайте отдельный пакет для каждой конфигурации оборудования. Переупаковка с помощью чистого промежуточного компьютера. Удалите все ненужные приложения. Останавливает все ненужные процессы. Закройте все ненужные системные службы.
-   Всегда делайте копию исходной установки перед началом работы с ней. Всегда работает с копией. Никогда не останавливайте повторную упаковку до завершения сборки пакета. Если пакет переупаковки будет приводить к повреждению пакета, он по-прежнему останется исходным.
-   Не переупаковывайте обновления программного обеспечения Майкрософт в пакет установщик Windows. Корпорация Майкрософт выпускает обновления программного обеспечения, такие как пакеты обновления, в виде самораскрывающихся файлов, автоматически выполняющих установку. Эти обновления используют разные установщики, чем установщик Windows для замены защищенных ресурсов Windows и не могут быть преобразованы в пакет установщик Windows. Сведения о развертывании пакетов обновления Windows см. в статье Руководство по развертыванию пакета обновления на [сайте Microsoft TechNet](https://technet.microsoft.com/).
-   Не используйте средство переупаковки для преобразования пакета установщик Windows в новый пакет. Установщик Windows добавляет сведения о конфигурации в систему, а также ресурсы приложения. Когда средство переупаковки сравнивает систему до и после установки, перепакетирование ошибочно интерпретирует сведения о конфигурации как часть приложения. Это обычно повреждает переупакованное приложение. Вместо этого используйте [преобразования настройки](a-customization-transform-example.md) для изменения существующего пакета установщик Windows или создания нового пакета. Преобразования настройки можно создать с помощью средства [Msitran.exe](msitran-exe.md) .
-   Не используйте средство переупаковки для объединения нескольких пакетов установщик Windows в один пакет. Вместо этого можно использовать средство [Msistuff.exe](msistuff-exe.md) , чтобы настроить исполняемый файл начальной загрузки Setup.exe для установки пакетов один за другим.
-   Создайте пакет установщик Windows, чтобы его можно было легко настроить с помощью клиента. Глобальные переменные, используемые установщик Windows во время установки, можно задать с помощью общих [свойств](properties.md) или [преобразований настройки](a-customization-transform-example.md). Предоставьте документацию по использованию этих свойств и практичных значений по умолчанию для всех настраиваемых значений. Дополнительные сведения о получении и установке свойств см. [в разделе Использование свойств](using-properties.md). Пример преобразования настройки см. [в примере преобразования настройки](a-customization-transform-example.md).

## <a name="do-not-try-to-replace-protected-resources"></a>Не пытайтесь заменить защищенные ресурсы.

Пакеты установщик Windows не должны пытаться заменить защищенные ресурсы во время установки или обновления. Установщик Windows не удаляет эти ресурсы или не заменяет их, так как Windows предотвращает замену необходимых системных файлов, папок и разделов реестра. Защита этих ресурсов предотвращает сбои приложений и операционных систем.

-   При работе в Windows Server 2008 или Windows Vista установщик Windows пропускает установку любого файла или раздела реестра, защищенного [Защита ресурсов Windows](../wfp/windows-resource-protection-portal.md) (WRP), установщик вводит предупреждение в файл журнала и остается в оставшейся части установки без ошибки. Дополнительные сведения см. [в разделе использование установщик Windows и защита ресурсов Windows](windows-resource-protection-on-windows-vista.md).
-   WRP — это новое имя для защиты файлов Windows (WFP). WRP защищает разделы и папки реестра, а также ключевые системные файлы. В Windows Server 2003, Windows XP и Windows 2000, когда установщик Windows обнаружил файл, защищенный с помощью WFP, установщик запрашивает установку файла в WFP. Дополнительные сведения см. [в разделе использование установщик Windows и защита ресурсов Windows](windows-resource-protection-on-windows-vista.md).

## <a name="do-not-depend-upon-non-critical-resources"></a>Не зависят от некритических ресурсов.

Установка или обновление не должны зависеть от установки некритических ресурсов по следующим причинам.

-   Пользовательские действия могут завершаться ошибкой, если они зависят от компонента, принадлежащего функции, которую пользователь объявляет, а не устанавливает.
-   Пользовательские действия, упорядоченные до действия [функции InstallFinalize](installfinalize-action.md) , могут завершиться ошибкой, если они зависят от компонента, содержащего устанавливаемую сборку. Установщик Windows не фиксирует сборки в глобальном кэше сборок (GAC) до тех пор, пока не завершится действие функции InstallFinalize.

## <a name="use-the-api-to-retrieve-windows-installer-configuration-information"></a>Используйте API для получения сведений о конфигурации установщик Windows.

Установка приложения или обновления не должна зависеть от прямого доступа к установщик Windows сведениям о конфигурации, сохраненным на компьютере. Вместо этого используйте установщик Windows программный интерфейс приложения для получения сведений о конфигурации. Расположение и формат сведений о конфигурации управляются службой установщик Windows и могут быть изменены.

-   Функции установки и настройки API установщик Windows описаны в [справочнике по функциям установщика](installer-function-reference.md).
-   [Свойства конфигурации](property-reference.md) описаны в справочнике по свойствам.
-   Методы и свойства автоматизации описаны в [справочнике по интерфейсу автоматизации](automation-interface-reference.md). Пример скрипта WiLstPrd.vbs подключается к объекту установщика и перечисляет зарегистрированные продукты и сведения о продукте. Дополнительные сведения см. в разделе [Список продуктов, свойств, функций и компонентов](list-products-properties-features-and-components.md).

## <a name="organize-the-installation-of-your-application-around-components"></a>Организуйте установку приложения вокруг компонентов.

Служба установщик Windows устанавливает или удаляет коллекции ресурсов, которые называются [компонентами](windows-installer-components.md). Поскольку компоненты обычно являются общими, автор пакета установки должен следовать правилам при указании компонентов компонента или приложения.

-   Придерживайтесь правил компонентов при [организации приложений в компоненты](organizing-applications-into-components.md) , чтобы обеспечить возможность установки и удаления новых компонентов или новых версий компонентов без повреждения других приложений. Вы можете выполнить процедуру, описанную в разделе [Определение компонентов установщика](defining-installer-components.md).
-   Установщик отслеживает каждый компонент по соответствующему идентификатору GUID компонента, указанному в [таблице Component](component-table.md). Это важно для работы механизма подсчета ссылок установщик Windows, что идентификатор GUID идентификатора компонента правильный. Следуйте рекомендациям по [изменению кода компонента](changing-the-component-code.md).
-   Если пакет должен прерывать правила компонента, следует иметь в виду возможные последствия и убедиться, что установка не устанавливает компоненты, которые могут повредить компоненты в системе пользователя. Дополнительные сведения см. [в статье что происходит, если правила компонентов повреждены?](what-happens-if-the-component-rules-are-broken.md)
-   Помните, как установщик Windows применяет [правила управления версиями файлов](file-versioning-rules.md) при [замене существующих файлов](replacing-existing-files.md). Установщик Windows сначала определяет, установлен ли файл ключа компонента, прежде чем пытаться установить какие-либо файлы компонента. Если установщик находит файл с тем же именем, что и файл ключей компонента, установленный в целевом расположении, он сравнивает версию, дату и язык двух ключевых файлов и использует правила управления версиями файлов, чтобы определить, следует ли установить компонент, предоставленный пакетом. Если установщик определит, что он должен заменить базу компонента на файл ключа, то он использует правила управления версиями файлов для каждого установленного файла, чтобы определить, следует ли заменить этот файл.

## <a name="reduce-the-size-of-large-windows-installer-packages"></a>Сократите размер больших пакетов установщик Windows.

Очень крупные пакеты Windows принимают системные ресурсы и могут быть сложными для установки пользователями. Рекомендуется уменьшить размер очень больших установщик Windows пакетов следующими методами.

-   Сжимать файлы в установке и сохранять их в CAB-файле. Установщик позволяет хранить CAB-файл в отдельном внешнем файле или в виде потока данных в самом пакете MSI. Дополнительные сведения см. [в разделе Использование ящиков и сжатых источников](using-cabinets-and-compressed-sources.md).
-   Удалите неиспользуемое дисковое пространство в MSI-файле, используя один из параметров, описанных в разделе [уменьшение размера MSI-файла](reducing-the-size-of-an--msi-file.md).
-   Если пакет установщик Windows содержит более 32767 файлов, необходимо изменить схему базы данных. Дополнительные сведения см. [в разделе Создание большого пакета](authoring-a-large-package.md).

## <a name="if-you-use-custom-actions-follow-good-custom-action-practices"></a>При использовании настраиваемых действий следуйте хорошим рекомендациям по настраиваемым действиям.

В установщик Windows имеется множество встроенных [стандартных действий](standard-actions-reference.md) для установки и обслуживания приложений. Разработчики должны попытаться полагаться на стандартные действия максимально практично, а не создавать собственные [пользовательские действия](custom-actions.md). Однако существуют ситуации, когда разработчик пакета установки находит необходимость в написании настраиваемого действия.

-   Следуйте рекомендациям по [использованию настраиваемых действий](using-custom-actions.md).
-   Следуйте [рекомендациям по защите настраиваемых действий](guidelines-for-securing-custom-actions.md). Пользовательские действия, использующие конфиденциальные данные, не должны записывать эту информацию в журнал. Дополнительные сведения см. в статье [Безопасность настраиваемых действий](custom-action-security.md).
-   Настраиваемые действия не должны пытаться задать точку входа для восстановления системы в рамках настраиваемого действия. Дополнительные сведения см. в разделе [Установка точки восстановления из настраиваемого действия](setting-a-restore-point-from-a-custom-action.md).
-   Возвращают сообщения об ошибках из пользовательских действий и записывают их в журнал, чтобы упростить устранение неполадок настраиваемых действий. Сведения см. в разделе [сообщения об ошибках пользовательские действия](error-message-custom-actions.md) и [возвращение сообщений об ошибках из настраиваемых действий](returning-error-messages-from-custom-actions.md).
-   Не изменяйте состояние системы с непосредственным пользовательским действием. Настраиваемые действия, которые изменяют систему напрямую или вызывают другую системную службу, должны быть отложены до момента выполнения скрипта установки. Для каждого [отложенного выполнения настраиваемого действия](deferred-execution-custom-actions.md) , которое изменяет состояние системы, должно предшествовать [настраиваемое действие отката](rollback-custom-actions.md) для отмены изменения состояния системы при откате установки. Дополнительные сведения см. в разделе [изменение состояния системы с помощью настраиваемого действия](changing-the-system-state-using-a-custom-action.md).
-   Настраиваемые действия, выполняющие сложные операции установки, должны быть [исполняемым файлом](executable-files.md) или [библиотекой динамической компоновки](dynamic-link-libraries.md). Ограничьте использование настраиваемых действий на основе [скриптов](scripts.md) для выполнения простых операций установки.
-   Предоставьте сведения о том, что пользовательское действие делает с системой легко обнаруживаемым для системных администраторов. Добавьте сведения о записях и файлах реестра, используемых пользовательским действием, в пользовательскую таблицу и изучите настраиваемое действие из этой таблицы. Это продемонстрировано в примере [использования настраиваемого действия для создания учетных записей пользователей на локальном компьютере](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md). Сведения о добавлении пользовательских таблиц в базу данных см. в разделе [Работа с запросами](working-with-queries.md) и [примеры запросов к базе данных с помощью SQL и скрипта](examples-of-database-queries-using-sql-and-script.md).
-   Пользовательские действия не должны отображать диалоговое окно. Пользовательские действия, для которых необходим пользовательский интерфейс, могут использовать вместо этого функцию [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) . См. раздел [Отправка сообщений в установщик Windows с помощью мсипроцессмессаже](sending-messages-to-windows-installer-using-msiprocessmessage.md).
-   Настраиваемые действия не должны использовать функции, перечисленные на странице: [функции, не предназначенные для использования в пользовательских действиях](functions-not-for-use-in-custom-actions.md).
-   Если установка предназначена для работы на сервере терминалов, проверьте, что все настраиваемые действия могут выполняться на сервере терминалов. Дополнительные сведения см. в разделе свойство [**терминалсервер**](terminalserver.md) .
-   Чтобы пользовательское действие выполнялось при удалении определенного исправления, пользовательское действие должно присутствовать в исходном приложении или быть исправлением для продукта, который всегда применяется. Дополнительные сведения см. в статье [Удаление исправлений с применением настраиваемых действий](patch-uninstall-custom-actions.md).
-   Пользовательские действия не должны использовать уровень пользовательского интерфейса в качестве условия для отправки сообщений об ошибках в установщик, так как это может повлиять на ведение журнала и внешние сообщения. Дополнительные сведения см. в разделе [Определение уровня пользовательского интерфейса из настраиваемого действия](determining-ui-level-from-a-custom-action.md).
-   Используйте условные операторы и [Синтаксис условных операторов](conditional-statement-syntax.md) , чтобы убедиться, что пакет правильно запускает пользовательские действия, не выполняет пользовательские действия или выполняет другое настраиваемое действие при удалении пакета. Проверка правильности работы пакета при [удалении настраиваемых действий](uninstalling-custom-actions.md). Дополнительные сведения см. [в статье условия выполнения действий во время удаления](conditioning-actions-to-run-during-removal.md) .
-   Если установка должна быть выполнена пользователями, не имеющими прав администратора, проверьте, чтобы все настраиваемые действия выполнялись с правами, не являющимися администраторами. Настраиваемые действия требуют повышенных привилегий для изменения частей системы, не зависящих от пользователя. Установщик может выполнять пользовательские действия с повышенными привилегиями при установке управляемого приложения или при указании системной политики для повышенных привилегий. Любые настраиваемые действия, требующие повышенных привилегий, должны включать в себя [настраиваемое действие мсидбкустомактионтипеинскрипт и msidbCustomActionTypeNoImpersonate In-Script параметры выполнения](custom-action-in-script-execution-options.md) в типе настраиваемого действия. Это продемонстрировано в примере [использования настраиваемого действия для создания учетных записей пользователей на локальном компьютере](using-a-custom-action-to-create-user-accounts-on-a-local-computer.md).

## <a name="if-you-use-assemblies-follow-good-assembly-practices"></a>Если вы используете сборки, следуйте хорошим рекомендациям по сборке

Если пакет использует [сборки](assemblies.md)программного обеспечения, следуйте рекомендациям по [добавлению сборок в пакет](adding-assemblies-to-a-package.md), [обновлению сборок](updating-assemblies.md), [установке и удалению сборок](installing-and-removing-assemblies.md).

## <a name="do-not-ship-concurrent-installations"></a>Не поставлять параллельные установки.

[Параллельные установки](concurrent-installations.md), также называемые вложенными установками, устанавливают другой пакет установщик Windows во время выполнения текущей установки. Использование параллельных установок не является хорошей практикой, поскольку они трудно обслуживать клиентам. Установка исправлений и обновления может не работать одновременно с параллельной установкой. Вместо этого рекомендуется использовать приложение установки и внешний обработчик пользовательского интерфейса для последовательной установки нескольких пакетов установщик Windows.

Дополнительные сведения об использовании внешнего обработчика пользовательского интерфейса см. в разделе [мониторинг установки с помощью мсисетекстерналуи](monitoring-an-installation-using-msisetexternalui.md). Дополнительные сведения об использовании внешнего обработчика на основе записей см. в разделе [мониторинг установки с помощью мсисетекстерналуирекорд](monitoring-an-installation-using-msisetexternaluirecord.md).

Параллельные установки иногда используются в контролируемых корпоративных средах для установки приложений, которые не предназначены для общего использования. Если вы решили использовать параллельные установки, следуйте этим рекомендациям.

-   Не используйте параллельные установки для установки или обновления поставляемого продукта.
-   Параллельные установки не должны предоставлять общий доступ к компонентам.
-   Административная установка не должна содержать параллельную установку.
-   Интегрированные компоненты ProgressBar не следует использовать с параллельными установками.
-   Ресурсы, которые должны быть объявлены, не должны устанавливаться параллельно установкой.
-   Пакет, выполняющий параллельную установку приложения, должен также удалить параллельное приложение при удалении родительского продукта. Вложенная установка находится в контексте родительского продукта в окне Установка и удаление программ на панели управления.

## <a name="keep-package-names-and-package-codes-consistent"></a>Обеспечьте единообразие имен пакетов и кодов пакетов.

Файлу. msi можно присвоить любое имя, которое помогает пользователям определять пакет, но имя не должно изменяться без изменения кода продукта.

-   Присвойте файлу MSI понятное имя, которое позволяет пользователю указать содержимое пакета установщик Windows.
-   [Код продукта](product-codes.md) — это основная идентификация приложения, которая должна изменяться при полном обновлении приложения. Дополнительные сведения см. в разделе [**ProductCode**](productcode.md) и [изменение кода продукта](changing-the-product-code.md). Изменение имени MSI-файла приложения считается исчерпывающим изменением, и для поддержания согласованности всегда требуется соответствующее изменение кода продукта.
-   [Код пакета](package-codes.md) — это основной идентификатор, используемый установщиком для поиска и проверки правильности пакета для данной установки. Ни один из двух неидентичных MSI-файлов никогда не должен иметь одинаковый код пакета. Если пакет изменен без изменения кода пакета, установщик может не использовать более новый пакет, если оба по-прежнему доступны для установщика. Код пакета хранится в свойстве [**Сводка номера редакции**](revision-number-summary.md) [информационного потока сводки](summary-information-stream.md).
-   Обратите внимание, что буквы в коде продукта и [идентификаторах GUID](guid.md) кода пакета должны быть в верхнем регистре.

## <a name="do-not-use-the-selfreg-and-typelib-tables"></a>Не используйте таблицы Селфрег и TypeLib.

-   Авторы пакета установки настоятельно рекомендуется использовать собственную регистрацию и таблицу [селфрег](selfreg-table.md) . Вместо этого они должны регистрировать модули путем создания одной или нескольких таблиц в группе « [таблицы реестра](registry-tables-group.md)». Многие преимущества установщик Windows теряются при самостоятельной регистрации, так как подпрограммы самостоятельной регистрации, как правило, скрывают важную информацию о конфигурации. Список причин для предотвращения самостоятельной регистрации см. в [таблице селфрег](selfreg-table.md).
-   Авторы пакета установки настоятельно рекомендуем использовать таблицу [typelib](typelib-table.md) . Вместо использования таблицы TypeLib зарегистрируйте библиотеки типов с помощью таблицы [Registry](registry-table.md) . Если установка, использующая таблицу TypeLib, завершается ошибкой и должна быть выполнена откат, то откат может не восстановить состояние компьютера, существовавшего до отката.

## <a name="provide-the-option-to-install-without-a-user-interface"></a>Укажите параметр для установки без пользовательского интерфейса.

Администраторы часто предпочитают развертывать приложения в корпорации, не требуя вмешательства пользователя. Рекомендуется предоставить приложению возможность установки с [уровнем пользовательского интерфейса](user-interface-levels.md) "нет".

-   Используйте [Общие свойства](public-properties.md) для получения сведений о конфигурации. Администраторы могут предоставить эту информацию в командной строке.
-   Не требуется, чтобы установка зависела от сведений, собранных при взаимодействии с пользователем с диалоговыми окнами. Эта информация недоступна во время автоматической установки.
-   Не перезапускайте компьютер пользователя автоматически во время автоматической установки.
-   Администраторы могут задать [уровень пользовательского интерфейса](user-interface-levels.md) при установке с помощью [параметра командной строки](command-line-options.md) "/q". Уровень пользовательского интерфейса также можно настроить программно с помощью вызова [**мсисетинтерналуи**](/windows/desktop/api/Msi/nf-msi-msisetinternalui).

## <a name="avoid-using-the-alwaysinstallelevated-policy"></a>Избегайте использования политики AlwaysInstallElevated.

Если политика [AlwaysInstallElevated](alwaysinstallelevated.md) не задана, то приложения, распространяемые администратором, устанавливаются с использованием привилегий пользователя, и только управляемые приложения получают повышенные привилегии. Установка этой политики направляет установщик Windows использовать системные разрешения при установке приложения в системе. Этот метод может открыть компьютер под угрозу безопасности, так как при установке этой политики пользователь без прав администратора может запускать установки с [*повышенными*](e-gly.md) привилегиями и получать доступ к защищенным расположениям на компьютере. Рекомендуется использовать другой метод, отличный от политики AlwaysInstallElevated при [установке пакета с повышенными привилегиями для неадминистратора](installing-a-package-with-elevated-privileges-for-a-non-admin.md) или [исправления Per-User управляемых приложениях](patching-per-user-managed-applications.md).

## <a name="enable-the-disablemedia-policy-to-limit-unauthorized-installation"></a>Включите политику Дисаблемедиа, чтобы ограничить несанкционированную установку.

Политика [дисаблемедиа](disablemedia.md) может препятствовать несанкционированной установке приложений. Если эта политика включена, пользователи и администраторы, выполняющие установку одного продукта, не смогут использовать диалоговое окно "Обзор" для просмотра источников мультимедиа, таких как CD-ROM, для источников других устанавливаемых продуктов. Просмотр других продуктов запрещается независимо от того, выполняется ли установка с повышенными привилегиями. Пользователь по-прежнему может переустановить продукт с носителя, если у пользователя есть правильно помеченный источник мультимедиа.

## <a name="keep-the-original-package-source-files-secure-and-available-to-users"></a>Обеспечьте безопасность и доступность исходных исходных файлов пакета для пользователей.

В некоторых случаях для установки по запросу, восстановления или обновления приложения может потребоваться исходный источник установщик Windows пакета. Если установщик не может найти доступный источник данных, пользователю предлагается предоставить носитель или подключиться к сетевому расположению, содержащему необходимые источники. Рекомендуется убедиться, что у установщика есть необходимые вам источники, без запроса пользователя.

-   Используйте [цифровые подписи и внешние CAB-файлы](digital-signatures-and-external-cabinet-files.md) , чтобы обеспечить безопасность используемых установщиком источников orig. Несжатый исходный образ, хранящийся в общедоступном расположении, не является безопасным.
-   Включите полный список сетевых или URL-адресов исходных путей к пакету установки приложения в свойстве [**SourceList**](sourcelist.md) .
-   Используйте общий ресурс распределенная файловая система (DFS) для исходного пути.
-   Используйте установщик Windows API для получения и изменения сведений о списке источников для установщик Windows приложений и исправлений. Дополнительные сведения см. в статье [Управление источниками установки](managing-installation-sources.md).
-   Используйте методы и свойства [**объекта установщика**](installer-object.md), [**объекта Product**](product-object.md)и [**объекта Patch**](patch-object.md) для получения и изменения сведений о списке источников для установщик Windows приложений и исправлений.
-   Придерживайтесь с точкими, перечисленными в поле [предотвращение необходимости доступа к исходным исходным](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md) точкам установки, чтобы не допустить появления необходимых исправлений доступа к исходным источникам.
-   Храните исходные файлы пакета в расположении, которое не является временной папкой системы. Установщик Windows исходные файлы, хранящиеся во временной папке, могут стать недоступными для пользователей.

## <a name="enable-verbose-logging-on-users-computer-when-troubleshooting-deployment"></a>Включите подробное ведение журнала на компьютере пользователя при устранении неполадок развертывания.

[Установщик Windows ведение журнала](windows-installer-logging.md) включает параметр подробного ведения журнала, который можно включить на компьютере пользователя. Сведения в подробном журнале могут пригодиться при устранении неполадок при установщик Windows развертывания пакета.

-   Вы можете включить подробное ведение журнала на компьютере пользователя с помощью [параметров командной строки](command-line-options.md), свойства [**Мсилоггинг**](msilogging.md) , [политики ведения журнала](logging.md), [**мсиенаблелог**](/windows/desktop/api/Msi/nf-msi-msienableloga)и метода [**EnableLog**](installer-enablelog.md) .
-   Очень полезным ресурсом для интерпретации установщик Windows файлов журнала является [Wilogutl.exe](wilogutl-exe.md). Это средство помогает анализировать файлы журнала и отображать предлагаемые решения для ошибок, обнаруженных в файле журнала.
-   Дополнительные сведения об интерпретации файлов журналов установщик Windows см. в техническом документе на сайте TechNet: [установщик Windows: преимущества и реализация для системных администраторов](https://www.microsoft.com/technet/prodtechnol/windows2000serv/maintain/featusability/winmsi.mspx).
-   Параметр подробного ведения журнала следует использовать только для устранения неполадок и не должен быть включен, поскольку он может оказать негативное воздействие на производительность системы и дисковое пространство. Каждый раз при использовании средства «Установка и удаление программ» на панели управления создается новый файл.

## <a name="uninstallation-leaves-the-users-computer-in-a-clean-state"></a>При удалении компьютер пользователя остается в чистом состоянии.

Удаление приложения так же важно, как установка. При удалении пакета установщик Windows не следует оставлять бесполезными части самого себя на компьютере пользователя.

-   Если файл, который должен быть удален с компьютера пользователя, остается установленным после удаления, установщик может не удалить компонент, содержащий этот файл, по одной или нескольким причинам, описанным в разделе [Удаление потерянных файлов](removing-stranded-files.md).
-   Если приложение должно быть зарегистрировано, создайте пакет для удаления данных реестра при удалении приложения. Дополнительные сведения см. [в разделе Добавление или удаление разделов реестра при установке или удалении компонентов](adding-or-removing-registry-keys-on-the-installation-or-removal-of-components.md). Если приложение не зарегистрировано, оно не отображается в компоненте Установка и удаление программ на панели управления и не может управляться с помощью установщик Windows.
-   Чтобы скрыть приложение в компоненте "Установка и удаление программ" на панели управления и по-прежнему иметь возможность использовать установщик Windows для управления приложением, следуйте рекомендациям, описанным в статье [Добавление и удаление приложения и отсутствие трассировки в реестре](adding-and-removing-an-application-and-leaving-no-trace-in-the-registry.md).
-   Пользовательские действия должны быть выполнены в соответствии с требованиями при удалении. При установке и удалении может потребоваться выполнить различные пользовательские действия.
-   Сведения о настройке для конкретного пользователя могут храниться в текстовом файле на компьютере. Это позволяет удалить файл при удалении приложения, даже если пользователь этой настройки в данный момент не вошел в систему.

## <a name="test-packages-for-both-per-user-and-per-machine-installation-deployment"></a>Тестовые пакеты для развертывания с установкой на уровне пользователя и на компьютере.

Рекомендуется позволить клиентам решить, следует ли развертывать пакет для установки в [контексте установки](installation-context.md)на компьютере или на уровне пользователя.

-   Определите, должно ли приложение быть доступно только отдельным пользователям или всем пользователям компьютера в процессе разработки.
-   Проверьте, правильно ли работает пакет для контекстов установки на уровне пользователя и для каждого компьютера.
-   Сделайте пакет легко настраиваемым и позвольте клиентам решить, следует ли развертывать его для каждого пользователя или для каждого компьютера.

## <a name="plan-and-test-a-servicing-strategy-before-shipping-the-application"></a>Спланируйте и протестируйте стратегию обслуживания перед отправкой приложения.

Прежде чем развертывать приложение в первый раз, необходимо решить, как вы планируете обслуживать приложение.

-   Примите во внимание типы обновлений, которые предполагается использовать для обслуживания приложения в будущем. Установщик Windows предоставляет три типа обновлений: [небольшое обновление](small-updates.md), [незначительное обновление](minor-upgrades.md)и [основные обновления](major-upgrades.md). Различия между ними описаны в статье [исправление и обновление](patching-and-upgrades.md) .
-   Перед отправкой приложения проверьте, что оно работает правильно после обслуживания с каждым типом обновления.

## <a name="reduce-the-dependency-of-updates-upon-the-original-sources"></a>Сократите зависимость обновлений от исходных источников.

Если исходные файлы необходимы для обновления приложения, это может усложнить обслуживание приложения. Следующие методы позволяют уменьшить зависимость обновлений от исходных источников.

-   Используйте [*разностное обновление*](d-gly.md) , чтобы обновить базовые версии приложения, такие как RTM-версия и версии пакета обновления. Следуйте рекомендациям по использованию разностных исправлений, описанных в статье об [уменьшении размера исправления](reducing-patch-size.md).
-   Следуйте рекомендациям, приведенным в разделе: [предотвращение необходимости доступа к исходному источнику установки для исправления](preventing-a-patch-from-requiring-access-to-the-original-installation-source.md).

## <a name="do-not-distribute-unserviceable-merge-modules"></a>Не распространяйте необслуживаемые модули слияния.

Приложения не должны зависеть от [модулей слияния](merge-modules.md) для установки компонента, если владелец модуля слияния и владелец приложения различаются. Это может усложнить обслуживание приложения, поскольку обоим владельцам необходимо координировать обновление приложения или модуля. Не зная всех приложений, которые использовали модуль слияния, владелец приложения не сможет обновить модуль слияния без риска, что обновление может быть несовместимо с другим приложением. Владелец модуля слияния не имеет прямого метода для обновления пакетов установщик Windows, которые уже установили модуль слияния.

-   Рассмотрите возможность предоставления пользователям необходимых компонентов в качестве другой установщик Windows установки.

## <a name="avoid-patching-administrative-installations"></a>Избегайте установки исправлений для административных установок.

Укажите в сети [административную установку](administrative-installation.md) исходного пакета установщик Windows приложения, чтобы разрешить участникам рабочей группы устанавливать приложение. Пользователи этого административного образа должны затем применить обновления к локальному экземпляру приложения, расположенному на своем компьютере. Это позволяет пользователям синхронизироваться с административным образом. Применение обновлений к административной установке не рекомендуется по следующим причинам.

-   Размер и задержка загрузки, необходимые пользователям для получения обновления, увеличивается по сравнению с загрузкой исправления. Все обновленные пакеты установщик Windows и исходные файлы должны загружаться, повторно кэшироваться и переустанавливаться.
-   Пользователи не могут установить программу по [запросу](installation-on-demand.md) и восстановить приложения из обновленной административной установки, пока они не будут повторно кэшированы и переустановлены.
-   Применение исправления к административной установке удаляет цифровую подпись из пакета. Администратор должен заново подписать пакет. Дополнительные сведения об использовании цифровых подписей см. в статье [цифровые подписи и установщик Windows](digital-signatures-and-windows-installer.md).
-   Многие двоичные исправления предназначены для образа RTM приложения и нуждаются в предыдущей версии файла. Локальный экземпляр приложения, установленного из обновленной административной установки, может не работать с другими обновлениями. Многие двоичные приложения обновления могут завершиться сбоем.
-   Применение исправления к административной установке обновляет исходные файлы и MSI-файл, но не отмечает образ сети сведениями об обновлении. Пользователи не могут определить, какие обновления были получены от административной установки. Это делает невозможным последовательное обновление, применяемое на стороне пользователя, с теми, которые уже применены на стороне административного образа.
-   Исправления, применяемые к административной установке, не являются [удаляемыми](uninstallable-patches.md). Это может препятствовать тому, что код пакета, кэшированный на компьютере пользователя, не станет отличаться от кода пакета в административной установке. Если код пакета, кэшированный на компьютере пользователя, отличается от того, который был в административной установке, переустановите приложение из административной установки, а затем Исследуйте обновление клиентского компьютера.
-   Если вы решили применить небольшие обновления путем исправления административного образа, следуйте рекомендациям, описанным в разделе [применение небольших обновлений путем исправления административного образа](applying-small-updates-by-patching-an-administrative-image.md).

## <a name="register-updates-to-run-with-elevated-privilege"></a>Регистрация обновлений для запуска с повышенными привилегиями.

Начиная с установщик Windows 3,0, можно применить исправления к приложению, которое было установлено в контексте, управляемом пользователем, после того как исправление будет зарегистрировано как имеющее повышенные привилегии. Вы не можете применить исправления к приложениям, которые установлены в контексте, управляемом пользователем, с использованием версий установщик Windows более ранних, чем 3,0.

-   Чтобы зарегистрировать пакет исправлений с повышенными привилегиями, используйте метод [**саурцелистаддсаурце**](patch-sourcelistaddsource.md) или функцию [**мсисаурцелистаддсаурцеекс**](/windows/desktop/api/Msi/nf-msi-msisourcelistaddsourceexa) . Следуйте рекомендациям и примерам, приведенным в руководстве по [установке исправлений Per-User управляемых приложений](patching-per-user-managed-applications.md).
-   При запуске установщик Windows версии 4,0 в Windows Vista можно также использовать [исправление контроля учетных записей (UAC)](user-account-control--uac--patching.md) , чтобы авторы установщик Windows установки могли определять исправления с цифровой подписью, которые могут быть применены в будущем пользователями, не являющимися администраторами. Он доступен только при установке пакетов в [контексте установки](installation-context.md) на компьютере (ALLUSERS = 1).
-   Убедитесь, что исправление с минимальными правами доступа не отключено путем установки свойства [**мсидисаблелуапатчинг**](msidisableluapatching.md) или политики [дисаблелуапатчинг](disableluapatching.md) .

## <a name="use-the-msipatchsequence-table-to-sequence-patches"></a>Используйте таблицу Мсипатчсекуенце для последовательного исправления.

Включите в пакет [таблицу мсипатчсекуенце](msipatchsequence-table.md) и добавьте сведения о последовательности исправлений. Начиная с версии установщик Windows 3,0, установщик может использовать таблицу Мсипатчсекуенце при [установке нескольких исправлений](installing-multiple-patches.md) для определения наилучшей последовательности приложений исправления. Используйте рекомендации, описанные в статье [виртуализация исправлений в установщик Windows версии 3,0](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3) , чтобы определить семейства исправлений.

-   Если это целесообразно, укажите все исправления как относящиеся к одному семейству исправлений. Во многих случаях одно семейство исправлений обеспечивает достаточную гибкость для последовательного исправления. Сложность разработки увеличивается при использовании нескольких семейств исправлений. Назначьте значимое имя семейству исправлений и назначьте значения последовательности в этом семействе исправлений, которые увеличиваются со временем. Чтобы применить исправления в том порядке, в котором они были выпущены, выполните [несколько примеров установки исправлений](multiple-patching-example.md) .
-   Используйте [таблицу патчсекуенце](patchsequence-table--patchwiz-dll-.md) в [Patchwiz.dll](patchwiz-dll.md) , чтобы создать сведения в [таблице мсипатчсекуенце](msipatchsequence-table.md). Версия PATCHWIZ.DLL, выпущенная с установщик Windows 3,0, может автоматически формировать сведения о последовательности обновления. Дополнительные сведения о добавлении нового исправления см. в разделе [Создание сведений о последовательности исправления](generating-patch-sequence-information---patchwiz-dll-.md). Дополнительные сведения о сценариях последовательности исправлений см. в техническом документе: [последовательное обновление в установщик Windows версии 3,0](https://www.microsoft.com/downloads/details.aspx?FamilyID=ad7ac91e-2493-4549-ae6f-bf5e007c12a3).

## <a name="test-the-installation-package-thoroughly"></a>Тщательно протестируйте пакет установки.

Проверьте правильность установки, восстановления и удаления пакета установщик Windows. Процесс тестирования можно разделить на следующие части.

-   Тестирование установки. Протестируйте установку со всеми возможными сочетаниями функций приложения. Протестируйте все типы установки, в том числе [административную установку](administrative-installation.md), [откат установки](rollback-installation.md)и [установку по запросу](installation-on-demand.md). Попробуйте все возможные методы установки, включая выбор MSI файла, [Параметры командной строки](command-line-options.md)и установку из панели управления. Проверка того, что пакет может быть установлен пользователями во всех возможных контекстах прав. Попробуйте установить пакет после его развертывания всеми возможными методами. Включите [ведение журнала установщик Windows](windows-installer-logging.md) для каждого теста и устраните все ошибки, найденные в журнале установщика и журнале событий.
-   Тестирование пользовательского интерфейса. Протестируйте пакет при установке со всеми возможными [уровнями пользовательского интерфейса](user-interface-levels.md). Протестируйте пакет, установленный без пользовательского интерфейса, и все сведения, предоставленные через пользовательский интерфейс. Обеспечьте [доступность](accessibility.md) пользовательского интерфейса и убедитесь, что пользовательский интерфейс работает так, как ожидается, для различных разрешений экрана и размеров шрифтов.
-   Обслуживание и восстановление тестирование — тестирование того, что пакет может выполнять [исправления и обновления](patching-and-upgrades.md) , доставляемые [небольшими обновлениями](small-updates.md), [незначительными обновлениями](minor-upgrades.md)и [основными обновлениями](major-upgrades.md). Перед развертыванием пакета напишите пробное обновление каждого типа и попробуйте применить его к исходному пакету.
-   Удаление тестирования. Убедитесь, что при удалении пакета он не содержит бесполезные части самого себя на компьютере пользователя и что удаляются только сведения, относящиеся к пакету. Перезагрузите тестовый компьютер после удаления пакета и проверьте целостность общих системных средств и других стандартных приложений. Проверка того, что пакет может быть удален пользователями во всех возможных контекстах прав. Проверьте все методы, чтобы удалить пакет, щелкните MSI-файл, попробуйте использовать [Параметры командной строки](command-line-options.md)и попробуйте удалить пакет с помощью панели управления. Включите [ведение журнала установщик Windows](windows-installer-logging.md) для каждого теста и устраните все ошибки, найденные в журнале установщика и журнале событий.
-   Тестирование функциональности продукта. Убедитесь, что приложение работает должным образом после установки, восстановления или удаления пакета.

## <a name="fix-all-validation-errors-before-deploying-a-new-or-revised-installation-package"></a>Устраните все ошибки проверки перед развертыванием нового или измененного пакета установки.

Выполните [проверку пакета](package-validation.md) для нового или измененного пакета установщик Windows, прежде чем пытаться установить его в первый раз. При проверке выполняется проверка установщик Windows базы данных на наличие ошибок разработки. Попытка установить пакет, который не проходит проверку, может повредить систему пользователя.

-   Вы можете проверить пакет с помощью [Orca.exe](orca-exe.md) или [Msival2.exe](msival2-exe.md). Оба средства предоставляются с Windows SDK. Сторонние поставщики также могут включить систему проверки ICE в свою среду разработки.
-   Вы можете использовать стандартный набор средств [оценки внутренней согласованности — ICEs](internal-consistency-evaluators-ices.md) , включенных в файлы. CUB, поставляемые вместе с пакетом SDK, или настроить проверку, [создав Ice](building-an-ice.md) и добавив ее в файл. cub.
-   С помощью Evalcom2.dll можно реализовать [автоматизацию проверки](validation-automation.md) для пакетов установки и модулей слияния.

## <a name="author-a-secure-installation"></a>Создайте безопасную установку.

Следуйте приведенным ниже рекомендациям при разработке пакета, чтобы обеспечить безопасность среды во время установки.

-   [Рекомендации по созданию безопасных установок](guidelines-for-authoring-secure-installations.md)
-   [Рекомендации по защите пакетов на заблокированных компьютерах](guidelines-for-securing-packages-on-locked-down-computers.md)
-   [Рекомендации по защите настраиваемых действий](guidelines-for-securing-custom-actions.md)

## <a name="use-pmsihandle-instead-of-handle"></a>Использовать ПМСИХАНДЛЕ вместо HANDLE

Переменные типа **пмсихандле** определены в MSI. h. Рекомендуется, чтобы приложение использовало тип **пмсихандле** , так как установщик закрывает объекты **пмсихандле** , когда они выходят за пределы области, тогда как приложение должно закрыть объекты **мсихандле** , вызвав [**мсиклосехандле**](/windows/desktop/api/Msi/nf-msi-msiclosehandle).

Например, при использовании следующего кода:

``` syntax
MSIHANDLE hRec = MsiCreateRecord(3);
```

Измените его на:

``` syntax
PMSIHANDLE hRec = MsiCreateRecord(3);
```

 

 
