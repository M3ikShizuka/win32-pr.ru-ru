---
description: модули слияния обеспечивают стандартный способ предоставления разработчикам общих установщик Windows компонентов и логики установки приложений.
ms.assetid: 3eb087b1-0f44-40d8-a950-67d489f09408
title: Использование API для слияния модуля слияния с базой данных
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7cdbeb68b193cceff10fbd1cd3f56f4c8804a4e1fb4f7c169fd2d893dc0b4bfb
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120039034"
---
# <a name="using-the-api-to-merge-a-merge-module-into-a-database"></a>Использование API для слияния модуля слияния с базой данных

[модули слияния](merge-modules.md) обеспечивают стандартный способ предоставления разработчикам общих установщик Windows [*компонентов*](c-gly.md) и логики установки приложений. Модули слияния должны быть объединены в установочный пакет с помощью средства слияния. Лучшим вариантом является получение свободно распределенного инструмента слияния или приобретение одного из средств слияния, доступных от независимых поставщиков программного обеспечения. Например, можно использовать функциональные возможности, предоставляемые [Mergemod.dll](merge-module-automation.md).

выполните следующие действия, чтобы объединить модуль слияния в базу данных установки установщик Windows с помощью API [Mergemod.dll](merge-module-automation.md).

**объединение модуля слияния в базу данных установки установщик Windows**

1.  Откройте файл журнала с помощью [**опенлог**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openlog). Этот шаг необходим только в том случае, если необходимо создать файл журнала или добавить существующий файл журнала для процесса слияния.
2.  Откройте базу данных установки — [ файл.msi](windows-installer-file-extensions.md), который получит модуль слияния с помощью [**опендатабасе**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-opendatabase). Этот шаг является обязательным.
3.  Откройте модуль слияния (MSM- [файл](windows-installer-file-extensions.md)), который объединяется с базой данных с помощью [**опенмодуле**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-openmodule). Модуль необходимо открыть, прежде чем его можно будет объединить с базой данных установки. Этот шаг является обязательным.
4.  Объедините модуль в базу данных установки с помощью [**Merge**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-merge) или [**мержеекс**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-mergeex). Обратите внимание, что **Merge** или **мержеекс** можно вызывать только один раз для слияния определенного сочетания .msi и MSM-файлов. **Мержеекс** доступен только при использовании [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней и только при использовании интерфейса [IMsmMerge2](/windows/desktop/api/Mergemod/nn-mergemod-imsmmerge2) . Этот шаг является обязательным.
5.  Вызывайте [**\_ ошибки Get**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-get_errors) и изучите извлеченную коллекцию ошибок для конфликтов слияния или других ошибок. Извлечение является обратимым. Несколько экземпляров коллекции ошибок могут быть извлечены путем многократного чтения вызывающих **\_ ошибок Get**. Вам потребуется устранить все ошибки в случае необходимости.
6.  свяжите компоненты модуля слияния с другими дополнительными компонентами, которые были объединены в базу данных установки с помощью [**Подключение**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-connect). Эта функция уже должна существовать до вызова этого метода. Этот шаг требуется, только если у вас есть дополнительные функции. Дополнительные сведения см. [в разделе Подключение модуля слияния к нескольким функциям](connecting-a-merge-module-to-multiple-features.md) .
7.  При необходимости извлеките исходные файлы из модуля, выполнив одно или несколько из следующих действий.

    Чтобы извлечь файлы из внедренного файла .cab, а затем скопировать их в указанный каталог, используйте [**екстрактфилес**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractfiles) или [**екстрактфилесекс**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-extractfilesex). Обратите внимание, что для **екстрактфилесекс** требуется [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней.

    Чтобы извлечь файлы из внедренного файла .cab и сохранить их в указанном файле, используйте [**екстракткаб**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-extractcab).

    Чтобы извлечь файлы из модуля и затем скопировать их в исходное изображение на диске после слияния, используйте [**креатесаурцеимаже**](/windows/desktop/api/Mergemod/nf-mergemod-imsmmerge2-createsourceimage). Обратите внимание, что **креатесаурцеимаже** доступен только в [Mergemod.dll версии 2,0](merge-module-automation.md) или более поздней.

8.  Закройте текущий открытый модуль слияния с помощью [**клосемодуле**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closemodule). Этот шаг является обязательным.
9.  Закройте текущую открытую базу данных установки с помощью [**клоседатабасе**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closedatabase). Этот шаг является обязательным. При закрытии базы данных удаляются все сведения о зависимостях, но не затрагиваются все ошибки, которые не были получены.
10. Закройте текущий файл журнала с помощью [**клоселог**](/windows/win32/api/mergemod/nf-mergemod-imsmmerge-closelog). Этот шаг необходим, если вы открыли файл журнала.

После слияния модуля с базой данных с помощью [Mergemod.dll](merge-module-automation.md)необходимо обновить [таблицу мультимедиа](media-table.md) , чтобы описать нужный макет исходного изображения. Процесс слияния, предоставляемый Mergemod.dll, не обновляет таблицу мультимедиа, так как потребитель модуля слияния может выбрать различные способы размещения исходного изображения.

 

 
