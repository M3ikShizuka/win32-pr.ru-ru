---
description: Установщик по умолчанию запускает настраиваемые действия с правами пользователя, чтобы ограничить доступ к системе настраиваемых действий.
ms.assetid: 62a3d103-a786-4727-b757-3a8229c8a53f
title: Безопасность настраиваемых действий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2e7d36e0e5c6cecc61730144fb7efdeed63ba0fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104349762"
---
# <a name="custom-action-security"></a>Безопасность настраиваемых действий

Установщик по умолчанию запускает настраиваемые действия с правами пользователя, чтобы ограничить доступ к системе настраиваемых действий. Установщик может выполнять пользовательские действия с повышенными привилегиями при установке управляемого приложения или при указании системной политики для повышенных привилегий.

Чтобы предотвратить ведение журнала конфиденциальной информации, используемой настраиваемым действием, следует использовать свойство [**мсихидденпропертиес**](msihiddenproperties.md) и **мсидбкустомактионтипехидетаржет** . Дополнительные сведения о **мсидбкустомактионтипехидетаржет** см. в разделе [параметр скрытого целевого объекта действия](custom-action-hidden-target-option.md).

Очистите свойство CustomActionData после его установки, чтобы убедиться, что конфиденциальные данные больше не доступны. Ниже приведен фрагмент кода, используемый непосредственным настраиваемым действием DLL, которое настраивает данные для использования отложенным пользовательским действием с именем "Мидеферредка":


```C++
#include <windows.h>
#include <Msiquery.h>
#pragma comment(lib, "msi.lib")

UINT __stdcall MyImmediateCA(MSIHANDLE hInstall)
{
    // set up information for deferred custom action called MyDeferredCA
    const TCHAR szValue[] = TEXT("data");
    UINT uiStat = ERROR_INSTALL_FAILURE;
    if (ERROR_SUCCESS == MsiSetProperty(hInstall, TEXT("MyDeferredCA"), szValue))
    {
        uiStat = MsiDoAction(hInstall, TEXT("MyDeferredCA"));

        // clear CustomActionData property
        if (ERROR_SUCCESS != MsiSetProperty(hInstall, TEXT("MyDeferredCA"), TEXT("")))
            return ERROR_INSTALL_FAILURE;
    }

    return (uiStat == ERROR_SUCCESS) ? uiStat : ERROR_INSTALL_FAILURE;    
}
```



Обратите внимание, что только [отложенные настраиваемые действия выполнения](deferred-execution-custom-actions.md) могут использовать атрибут **msidbCustomActionTypeNoImpersonate** . Дополнительные сведения см. в разделе [настраиваемое действие In-Script параметры выполнения](custom-action-in-script-execution-options.md).

Если бит **msidbCustomActionTypeNoImpersonate** не задан для настраиваемого действия, установщик запускает пользовательское действие с привилегиями уровня пользователя. Дополнительные сведения см. в разделе [пользовательские действия In-Script параметры выполнения](custom-action-in-script-execution-options.md).

Если установлен бит **msidbCustomActionTypeNoImpersonate** , а управляемое приложение устанавливается с правами администратора, то установщик может запустить настраиваемое действие с повышенными привилегиями. Однако если пользователь пытается установить управляемое приложение без разрешения администратора, установщик запускает приложение с правами доступа на уровне пользователя независимо от того, задано ли **msidbCustomActionTypeNoImpersonate** .

Обратите внимание, что пользовательское действие может выполняться с системными привилегиями, даже если бит **msidbCustomActionTypeNoImpersonate** не установлен. Это происходит, если администратор устанавливает приложение для всех пользователей на сервере, на котором запущена служба роли сервера терминалов, с помощью Windows 2000, и действие не помечено как **мсидбкустомактионтипетсаваре**. Пользовательское действие может также выполняться с системными привилегиями, если установка вызывается при отсутствии контекста пользователя. Например, если в данный момент во время установки, вызванного развертыванием приложения Windows 2000, пользователь не вошел в систему.

При создании собственных настраиваемых действий всегда следует создавать пользовательские действия с помощью защищенных методов. Дополнительные сведения см. в разделе [рекомендации по защите настраиваемых действий](guidelines-for-securing-custom-actions.md).

 

 



