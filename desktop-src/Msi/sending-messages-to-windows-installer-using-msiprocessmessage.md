---
description: Сообщения, отправленные с помощью Мсипроцессмессаже, — это те же сообщения, которые были получены \_ функцией обратного вызова обработчика инсталлуи, если был вызван мсисетекстерналуи.
ms.assetid: ca73bd0a-6f4e-453c-9e38-14cfd602d42c
title: Отправка сообщений в установщик Windows с помощью Мсипроцессмессаже
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3bcd8c8a704c1f4dd24763f7f47ff0d8898a95c0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999585"
---
# <a name="sending-messages-to-windows-installer-using-msiprocessmessage"></a>Отправка сообщений в установщик Windows с помощью Мсипроцессмессаже

Сообщения, отправленные с помощью [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) , — это те же сообщения, которые были получены функцией обратного вызова [**\_ обработчика инсталлуи**](/windows/desktop/api/Msi/nc-msi-installui_handlera) , если был вызван [**мсисетекстерналуи**](/windows/desktop/api/Msi/nf-msi-msisetexternaluia) . В противном случае установщик Windows обрабатывает сообщения. Дополнительные сведения см. в разделе [анализ установщик Windows сообщений](parsing-windows-installer-messages.md).

Например, чтобы отправить \_ сообщение об ошибке инсталлмессаже с \_ значком МБ иконварнинг и \_ кнопками МБ абортретриканцел:


```C++
PMSIHANDLE hInstall;
PMSIHANDLE hRec;
MsiProcessMessage(hInstall, INSTALLMESSAGE(INSTALLMESSAGE_ERROR|MB_ABORTRETRYIGNORE|MB_ICONWARNING), hRec);
```



Где *хинсталл* — это обработчик установки, предоставленный настраиваемому действию или обработчику *хпродукт* из [**Мсиопенпродукт**](/windows/desktop/api/Msi/nf-msi-msiopenproducta) или [**мсиопенпаккаже**](/windows/desktop/api/Msi/nf-msi-msiopenpackagea), а *хрек* — это запись, содержащая сведения об ошибке для форматирования. Сведения о том, как выполняется форматирование, см. в разделе [**мсиформатрекорд**](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda).

По умолчанию при \_ отправке сообщения об ошибке инсталлмессаже или инсталлмессаже \_ фаталексит без указания типов кнопок или значков, МБ \_ ОК, значок и МБ \_ DEFBUTTON1 используются.

Установщик Windows не помечает кнопку **Abort** строкой "Abort" при отображении MessageBox с \_ указанием кнопки "абортретригноре МБ", вместо этого он отмечает кнопку строкой "Cancel". Все сообщения об ошибках отменяют использование слова «Abort», а вместо этого используют слово «Cancel».

Параметр *хрекорд* функции [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) зависит от типа сообщений, отправляемого в [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage). В следующем списке приведены требования к записи относительно типа сообщений.

ИНСТАЛЛМЕССАЖЕ \_ фаталексит

 

\_сведения о инсталлмессаже

 

ИНСТАЛЛМЕССАЖЕ \_ аутофдискспаце



| Поле         | Описание                                                                                                                                                                                                        |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0             | Шаблон для форматирования результирующей строки. Дополнительные сведения см. в разделе [**мсиформатрекорд**](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda) . Поля записи указываются по \[ 1 \] для поля 1, \[ 2 — \] для поля 2 и т. д. |
| от 1 до *n* | Все последующие поля напрямую связаны с полями, на которые ссылается шаблон в поле 0.                                                                                                                    |



 

Если поле 0 имеет значение null, то строка, полученная обработчиком пользовательского интерфейса, форматируется следующим образом: 1: \[ данные из поля 1 \] 2. \[ данные из поля 2 \] означают, что для каждого поля записи строка содержит номер поля, за которым следуют данные, хранящиеся в поле.

Информационные сообщения от [**мсипроцессмессаже**](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) регистрируются, когда [**мсиенаблелог**](/windows/desktop/api/Msi/nf-msi-msienableloga), [параметр командной строки](command-line-options.md)"/l" или [Политика ведения журнала](logging.md) указывают "I" или инсталллогмоде \_ info.

ИНСТАЛЛМЕССАЖЕ, \_ Ошибка

 

\_предупреждение инсталлмессаже

 

\_пользователь инсталлмессаже

Для использования сообщения из таблицы ошибок.



| Поле         | Описание                                           |
|---------------|-------------------------------------------------------|
| 0             | Должен иметь значение null.                                         |
| 1             | Номер сообщения в [таблице ошибок](error-table.md). |
| от 2 до *n* | Связан с указанным сообщением в таблице ошибок.  |



 

Например, если выбран диапазон 10.0.0.0/20 для виртуальной сети, для пространства клиентских адресов можно выбрать 10.1.0.0/24.



| Поле | Тип   | Данные       |
|-------|--------|------------|
| 0     | строка | null       |
| 1     | INT    | 1304       |
| 2     | строка | Myfile.txt |



 

Полученное из обработчика пользовательского интерфейса сообщение получает следующее:

Ошибка 1304. Ошибка записи в файл: Myfile.txt. Убедитесь, что у вас есть доступ к этому каталогу.

Если поле 0 не равно null, сообщение из таблицы ошибок переопределяется. Вместо этого шаблон поля 0 определяет формат сообщения.

В сообщении также могут быть указаны кнопки, включая кнопку по умолчанию, и значок для использования с сообщением, как упоминалось выше. Кнопки и типы значков перечислены в [**\_ обработчике инсталлуи**](/windows/desktop/api/Msi/nc-msi-installui_handlera).

ИНСТАЛЛМЕССАЖЕ \_ коммондата

Это сообщение отправляется для включения или отключения кнопки **Отмена** в диалоговом окне хода выполнения.



| Поле | Описание                                                                                                                                  |
|-------|----------------------------------------------------------------------------------------------------------------------------------------------|
| 0     | Не используется.                                                                                                                                      |
| 1     | 2 — это кнопка **отмены** .                                                                                                           |
| 2     | Значение 1 указывает, что кнопка **Отмена** должна быть видимой. Значение 0 указывает, что кнопка **Отмена** должна быть невидимой.<br/> |



 

Например, чтобы отключить или скрыть кнопку **Отмена** , запись будет выглядеть следующим образом.



| Поле | Тип   | Данные |
|-------|--------|------|
| 0     | строка | null |
| 1     | INT    | 2    |
| 2     | INT    | 0    |



 

ИНСТАЛЛМЕССАЖЕ \_ актионстарт

 

ИНСТАЛЛМЕССАЖЕ \_ актиондата

Запись ИНСТАЛЛМЕССАЖЕ \_ актионстарт определяет формат записи актиондата.



| Поле | Описание                                                                                                   |
|-------|---------------------------------------------------------------------------------------------------------------|
| 0     | null                                                                                                          |
| 1     | Имя действия. Имя в этом поле не должно быть пустым.                                                         |
| 2     | Описание действия.                                                                                           |
| 3     | Шаблон действия. Используется для Актиондата, сообщение которого форматируется в соответствии с этим шаблоном. |



 

Не сослаться на поле 0 в сообщении шаблона действия.

\_Запись АКТИОНДАТА инсталлмессаже имеет следующий формат.



| Поле         | Описание                                                                                                                                        |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| 0             | null                                                                                                                                               |
| от 1 до *n* | Зависит от поля 3 соответствующего \_ сообщения инсталлмессаже актионстарт или шаблона, указанного в [таблице актионтекст](actiontext-table.md). |



 

Например, \_ запись инсталлмессаже актионстарт.



| Поле | Тип   | Данные                                                            |
|-------|--------|-----------------------------------------------------------------|
| 0     | строка | null                                                            |
| 1     | строка | мяктион                                                        |
| 2     | строка | Это описание «Мяктион»                           |
| 3     | строка | Шаблон Мяктион: field1 Data — \[ 1 \] . данные поля 2 — \[ 2 \] . |



 

Шаблон для ИНСТАЛЛМЕССАЖЕ \_ актионстарт (поле 3) ссылается на поля 1 и 2, запись инсталлмессаже \_ актиондата должна содержать 2 поля, содержащие гарантированные данные. Поля могут быть либо строками, либо целочисленными полями.

\_Запись АКТИОНДАТА инсталлмессаже.



| Поле | Тип   | Данные                    |
|-------|--------|-------------------------|
| 0     | строка | null                    |
| 1     | INT    | 2                       |
| 2     | строка | Актиондата для Мяктион |



 

ИНСТАЛЛМЕССАЖЕ \_ филесинусе

Запись ФИЛЕСИНУСЕ является записью переменной длины.



| Поле | Описание                                                                                                                                                                                                                                                                                                                                                     |
|-------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0     | Это поле может иметь значение null. Для установки с использованием базового пользовательского интерфейса в этом поле может быть указан статический текст для вывода в [элементе управления ListBox](listbox-control.md) [диалогового окна филесинусе](filesinuse-dialog.md). Для установки с использованием полного пользовательского интерфейса это поле не действует, так как текст задается при создании пользовательского диалогового окна Филесинусе. |
| 1     | Имя используемого файла.                                                                                                                                                                                                                                                                                                                                        |
| 2     | Это поле определяет процесс, в котором используется файл. **Установщик Windows версии 4,0:** Идентификатор процесса (PID) процесса или заголовок окна для процесса.<br/> **Установщик Windows версии 3,1 и более ранних версий:** Это поле должно быть идентификатором процесса (PID) процесса.<br/>                                                      |



 

Например, чтобы отправить сообщение Филесинусе, в котором используются два файла, red.exe и blue.exe, запись содержит четыре поля плюс поле 0. Формат записи будет выглядеть так, как показано в следующей таблице. Для этого примера требуется установщик Windows версии 4,0.

**Установщик Windows версии 3,1 и более ранних версий:** Поля 2 и 4 в следующем примере должны содержать идентификаторы PID процессов, содержащих red.exe и blue.exe.



| Поле | Описание       |
|-------|-------------------|
| 0     | null              |
| 1     | Red.exe           |
| 2     | Заголовок Красного окна  |
| 3     | Blue.exe          |
| 4     | Заголовок синего окна |



 

> [!Note]  
> В установщик Windows версии 4,0, если идентификатор процесса, переданный из службы, не имеет заголовка окна, например приложения панели задач, файл не отображается, а подробный журнал содержит следующие сообщения.

 

``` syntax
File In Use: -<FileName>- Window could not be found. Process ID: <PID>
No window with title could be found for FilesInUse
```

ИНСТАЛЛМЕССАЖЕ \_ ресолвесаурце

\_Запись РЕСОЛВЕСАУРЦЕ инсталлмессаже содержит семь полей. Для \_ правильной работы инсталлмессаже ресолвесаурце внешний обработчик пользовательского интерфейса может не справиться с \_ сообщением инсталлмессаже ресолвесаурце. Установщик Windows должен выполнять обработку \_ сообщения РЕСОЛВЕСАУРЦЕ инсталлмессаже. То есть внешний обработчик пользовательского интерфейса возвращает 0, чтобы указать, что при фильтрации сообщения ИНСТАЛЛМЕССАЖЕ ресолвесаурце не предпринято никаких действий \_ . Рекомендуется избегать отправки сообщения РЕСОЛВЕСАУРЦЕ.



| Поле | Описание                                                                                                                                                        |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0     | null                                                                                                                                                               |
| 1     | null                                                                                                                                                               |
| 2     | Имя пакета.                                                                                                                                                      |
| 3     | Код продукта.                                                                                                                                                      |
| 4     | Относительный путь, если он известен, может иметь значение null.                                                                                                                               |
| 5     | 0                                                                                                                                                                  |
| 6     | Следует ли проверять код пакета. Значение "1" указывает, что код пакета должен быть проверен. Значение "0" указывает, что пакет не должен проверяться. |
| 7     | Требуемый диск из таблицы носителей. Значение "0" указывает, что любой диск приемлем.                                                                              |



 

 

 




