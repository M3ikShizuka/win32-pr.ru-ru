---
description: Win32Shutdown &\# 8194; Метод класса WMI предоставляет полный набор параметров завершения работы, поддерживаемых операционными системами Win32. К ним относятся выход, завершение работы, перезагрузка и принудительный выход, завершение работы или перезагрузка.
ms.assetid: 7108570a-81ba-46d5-8b05-de6194f93f18
ms.tgt_platform: multiple
title: Метод Win32Shutdown класса Win32_OperatingSystem
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- Win32_OperatingSystem.Win32Shutdown
api_type:
- COM
api_location:
- CIMWin32.dll
ms.openlocfilehash: f2cca60c376859438b40ca35be26a99b115634c0
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103896338"
---
# <a name="win32shutdown-method-of-the-win32_operatingsystem-class"></a>Метод Win32Shutdown \_ класса операционной системы Win32

Метод    [класса WMI](../wmisdk/retrieving-a-class.md) Win32Shutdown предоставляет полный набор параметров завершения работы, поддерживаемых операционными системами Win32. К ним относятся выход, завершение работы, перезагрузка и принудительный выход, завершение работы или перезагрузка.

В этом разделе используется синтаксис MOF-файл (MOF). Дополнительные сведения об использовании этого метода см. [в разделе вызов метода](../wmisdk/calling-a-method.md).

## <a name="syntax"></a>Синтаксис


```mof
uint32 Win32Shutdown(
  [in] sint32 Flags,
  [in] sint32 Reserved = 
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*Флаги* \[ окне\]
</dt> <dd>

Набор флагов битовой панели для выключения компьютера. Чтобы принудительно выполнить команду, добавьте к значению команды флаг force (4). Использование Force в сочетании с завершением работы или перезагрузкой на удаленном компьютере немедленно завершает все (включая WMI, COM и т. д.) или перезагружает удаленный компьютер. Это приводит к неопределенному возвращаемому значению.

<dt>

0 (0x0)
</dt> <dd>

Выход **из** системы — записывает пользователя на компьютер. При выходе из системы останавливаются все процессы, связанные с контекстом безопасности процесса, который вызвал функцию Exit, записывает текущего пользователя в систему и отображает диалоговое окно входа.

</dd> <dt>

4 (0x4)
</dt> <dd>

**Принудительный выход из системы (0 + 4)** . записывает пользователя на компьютер немедленно и не уведомляет приложения о завершении сеанса входа. Это может привести к утрате данных.

</dd> <dt>

1 (0x1)
</dt> <dd>

**Shutdown** — завершает работу компьютера до точки, в которой можно отключить питание. (Все буферы файлов записываются на диск, а все запущенные процессы останавливаются.) Пользователи видят сообщение, `It is now safe to turn off your computer.`

Во время завершения работы система отправляет сообщение каждому работающему приложению. Приложения выполняют очистку при обработке сообщения и возвращают значение true, чтобы указать, что они могут быть завершены.

</dd> <dt>

5 (0x5)
</dt> <dd>

**Принудительное завершение работы (1 + 4)** . завершает работу компьютера до точки, в которой можно отключить питание. (Все буферы файлов записываются на диск, а все запущенные процессы останавливаются.) Пользователи видят сообщение,` It is now safe to turn off your computer.`

Когда используется подход принудительного завершения работы, все службы, включая WMI, немедленно завершают работу. По этой причине вы не сможете получить возвращаемое значение, если сценарий выполняется на удаленном компьютере.

</dd> <dt>

2 (0x2)
</dt> <dd>

**Перезагрузка** — завершает работу и перезагружает компьютер.

</dd> <dt>

6 (0x6)
</dt> <dd>

**Принудительная перезагрузка (2 + 4)** — завершает работу и перезагружает компьютер.

При использовании принудительной перезагрузки все службы, включая WMI, немедленно завершают работу. По этой причине вы не сможете получить возвращаемое значение, если сценарий выполняется на удаленном компьютере.

</dd> <dt>

8 (0x8)
</dt> <dd>

**Питание отключено** — завершает работу компьютера и выключает питание (если поддерживается компьютером).

</dd> <dt>

12 (0xC)
</dt> <dd>

**Принудительное выключение (8 + 4)** — завершает работу компьютера и выключает питание (если это поддерживается компьютером).

При использовании подхода принудительного выключения питания все службы, включая WMI, немедленно завершают работу. По этой причине вы не сможете получить возвращаемое значение, если сценарий выполняется на удаленном компьютере.

</dd> </dl> </dd> <dt>

*Зарезервировано* \[ окне\]
</dt> <dd>

Средства для расширения **Win32Shutdown**. В настоящее время *зарезервированный* параметр игнорируется.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Возвращает ноль (0), чтобы указать на успешное выполнение. Любое другое значение указывает на ошибку. Коды ошибок см. в разделе [**константы WMI Error**](../wmisdk/wmi-error-constants.md) или [**вбемерроренум**](/windows/win32/api/wbemdisp/ne-wbemdisp-wbemerrorenum). Общие значения **HRESULT** см. в разделе [коды системных ошибок](../debug/system-error-codes.md).

<dl> <dt>

**Успешно** (0)
</dt> <dt>

**Другое** (1 – 4294967295)
</dt> </dl>

## <a name="remarks"></a>Комментарии

Для более эффективного управления компьютерами в организации администраторам требуется возможность удаленного выключения или перезагрузки компьютера или удаленного выхода пользователя из системы. Возможность выполнения этих задач позволяет администраторам устанавливать программное обеспечение, перенастраивать параметры компьютера, удалять компьютеры из сети и выполнять другие задачи без ручного выключения или перезапуска каждого компьютера.

Например, чтобы выполнить обновление сети, может потребоваться завершить работу всех компьютеров, работающих в определенном сегменте сети. Чтобы принудительно обновить групповая политика, необходимо войти в систему пользователей с компьютеров. Если компьютер находится в любом месте Организации, может потребоваться завершить работу максимально возможного количества компьютеров, прежде чем этот вирус сможет распространяться. Возможность выключения и перезагрузки компьютеров, а также программного выхода пользователей, а не вручную, может быть огромным временем.

Вызывающий процесс должен иметь привилегию **SE \_ Shutdown \_ Name** .

Метод [**Win32ShutdownTracker**](win32shutdowntracker-method-in-class-win32-operatingsystem.md) предоставляет тот же набор параметров завершения работы, который поддерживает метод **Win32Shutdown** в [**Win32, \_**](win32-operatingsystem.md) но он также позволяет указывать комментарии, причину завершения работы или время ожидания.

Метод Win32Shutdown не имеет параметра для блокировки рабочей станции, при этом пользователь вошел в систему. Тем не менее рабочие станции можно заблокировать из командной строки с помощью следующей команды:

`% windir %\System32\rundll32.exe user32.dll,LockWorkStation`

## <a name="examples"></a>Примеры

Пример " [выход, перезагрузка" или "завершение работы нескольких компьютеров](https://Gallery.TechNet.Microsoft.Com/2e88d504-a4e5-499b-b09a-f90617a6d87d) " в коллекции TechNet использует Win32Shutdown для выхода, выключения, перезагрузки или выключения питания (в зависимости от выбранных параметров) компьютеров, перечисленных в массиве серверов.

Пример [ComputerManagement.ps1](https://Gallery.TechNet.Microsoft.Com/ef8de213-45b6-4751-8c77-01d1b6623e16) PowerShell в коллекции TechNet содержит метод, который вызывает Win32Shutdown на удаленном компьютере.

В следующем примере PowerShell используется метод Win32Shutdown для завершения работы указанного компьютера.


```PowerShell
$computername= "."
$win32OS = get-wmiobject win32_operatingsystem -computername $computername
$win32OS.psbase.Scope.Options.EnablePrivileges = $true
$win32OS.win32shutdown(8)
```



Следующий пример кода PowerShell использует Енаблеаллпривилежес из командлета Get-WmiObject для достижения нужных полномочий.


```PowerShell
$win32OS = get-wmiobject win32_operatingsystem -computername $computername -EnableAllPrivileges
$win32OS.win32shutdown(8)
```



В следующем примере кода VB.NET используется метод Shutdown для перезагрузки или выхода из системы.


```VB
Dim

testResult AsSingle

Dim WMIServiceObject, ComputerObject AsObject 

'Now get some privileges 

WMIServiceObject = GetObject(
"Winmgmts:{impersonationLevel=impersonate,(Debug,Shutdown)}")
ForEach ComputerObject In WMIServiceObject.InstancesOf("Win32_OperatingSystem") 
    testResult = ComputerObject.Win32Shutdown(2 + 4, 0) 
    'reboot
    'testResult = ComputerObject.Win32Shutdown(0, 0) 'logoff 
    ' testResult = ComputerObject.Win32Shutdown(8 + 4, 0) 'shutdown 

If testResult <> 0 Then 

MsgBox("Sorry, an error has occurred while trying to perform selected operation") 

Else 

'Operation selected in statement above if condition would be carried out 

EndIf 

Next
```



## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Пространство имен<br/>                | Корневой \\ CIMV2<br/>                                                                  |
| MOF<br/>                      | <dl> <dt>CIMWin32. mof</dt> </dl> |
| DLL<br/>                      | <dl> <dt>CIMWin32.dll</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Классы операционной системы](./operating-system-classes.md)
</dt> <dt>

[**Win32, \_ Операционная система**](win32-operatingsystem.md)
</dt> <dt>

[**Win32ShutdownTracker**](win32shutdowntracker-method-in-class-win32-operatingsystem.md)
</dt> <dt>

[Задачи WMI: управление рабочим столом](../wmisdk/wmi-tasks--desktop-management.md)
</dt> <dt>

[Выполнение привилегированных операций с помощью VBScript](../wmisdk/executing-privileged-operations-using-vbscript.md)
</dt> </dl>

 

 
