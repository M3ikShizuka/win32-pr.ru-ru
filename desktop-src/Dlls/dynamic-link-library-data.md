---
description: Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.
ms.assetid: b1f6811e-c413-4124-9ccb-ea59b7a8a7ff
title: Dynamic-Link данных библиотеки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 83280d3bfc449061c44f9e8bfd9b47833e7eca19
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664445"
---
# <a name="dynamic-link-library-data"></a>Dynamic-Link данных библиотеки

Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.

## <a name="variable-scope"></a>Область действия переменных

Переменные, объявленные как глобальные в файле исходного кода DLL, обрабатываются компилятором и компоновщиком как глобальные переменные, но каждый процесс, загружающий заданную библиотеку DLL, получает собственную копию глобальных переменных библиотеки DLL. Область статических переменных ограничена блоком, в котором объявляются статические переменные. В результате каждый процесс имеет собственный экземпляр глобальных и статических переменных DLL по умолчанию.

> [!Note]  
> Средства разработки могут позволять переопределить поведение по умолчанию. Например, компилятор Visual C++ поддерживает **\# раздел pragma** , а компоновщик поддерживает параметр/Section. Дополнительные сведения см. в документации, входящей в состав средств разработки.

 

## <a name="dynamic-memory-allocation"></a>Выделение динамическая память

Когда библиотека DLL выделяет память с помощью любой из функций выделения памяти ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**локалаллок**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**хеапаллок**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc)и [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), память выделяется в виртуальном адресном пространстве вызывающего процесса и доступна только потокам этого процесса.

Библиотека DLL может использовать сопоставление файлов для выделения памяти, которая может совместно использоваться процессами. Общее описание использования сопоставления файлов для создания именованной общей памяти см. в разделе [Сопоставление файлов](/windows/desktop/Memory/file-mapping). Пример, использующий функцию [**DllMain**](dllmain.md) для настройки общей памяти с помощью сопоставления файлов, см. [в разделе Использование общей памяти в библиотеке Dynamic-Link](using-shared-memory-in-a-dynamic-link-library.md).

## <a name="thread-local-storage"></a>локальное хранилище потока

Функции локального хранилища потока (TLS) позволяют библиотеке DLL выделить индекс для хранения и извлечения различных значений для каждого потока многопоточного процесса. Например, приложение электронной таблицы может создавать экземпляры одного и того же потока каждый раз, когда пользователь открывает новую электронную таблицу. Библиотека DLL, предоставляющая функции для различных операций с электронными таблицами, может использовать TLS для сохранения сведений о текущем состоянии каждой таблицы (строки, столбца и т. д.). Общие сведения о локальном хранилище потоков см. в статье [Локальное хранилище потока](/windows/desktop/ProcThread/thread-local-storage). Пример, в котором для настройки локального хранилища потока используется функция [**DllMain**](dllmain.md) , см. [в разделе Использование локального хранилища потока в библиотеке Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).

**Windows Server 2003 и Windows XP:** Компилятор Visual C++ поддерживает синтаксис, позволяющий объявлять локальные переменные потока: **\_ declspec (thread)**. При использовании этого синтаксиса в библиотеке DLL вы не сможете загрузить DLL явным образом с помощью [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) или [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) в версиях Windows, предшествовавших Windows Vista. Если библиотека DLL будет загружена явным образом, необходимо использовать функции локального хранилища потока вместо **\_ declspec (thread)**.

 

 
