---
description: Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.
ms.assetid: b1f6811e-c413-4124-9ccb-ea59b7a8a7ff
title: Dynamic-Link данных библиотеки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8902eb6388624d958c7176a14b8893f8e2245ddd9370f6ba2ac71605b2379cf6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120048444"
---
# <a name="dynamic-link-library-data"></a>Dynamic-Link данных библиотеки

Библиотека Dynamic-Link (DLL) может содержать глобальные данные или локальные данные.

## <a name="variable-scope"></a>Область действия переменных

Переменные, объявленные как глобальные в файле исходного кода DLL, обрабатываются компилятором и компоновщиком как глобальные переменные, но каждый процесс, загружающий заданную библиотеку DLL, получает собственную копию глобальных переменных библиотеки DLL. Область статических переменных ограничена блоком, в котором объявляются статические переменные. В результате каждый процесс имеет собственный экземпляр глобальных и статических переменных DLL по умолчанию.

> [!Note]  
> Средства разработки могут позволять переопределить поведение по умолчанию. Например, компилятор Visual C++ поддерживает **\# раздел pragma** , а компоновщик поддерживает параметр/Section. Дополнительные сведения см. в документации, входящей в состав средств разработки.

 

## <a name="dynamic-memory-allocation"></a>Выделение динамическая память

Когда библиотека DLL выделяет память с помощью любой из функций выделения памяти ([**GlobalAlloc**](/windows/desktop/api/winbase/nf-winbase-globalalloc), [**локалаллок**](/windows/desktop/api/winbase/nf-winbase-localalloc), [**хеапаллок**](/windows/desktop/api/heapapi/nf-heapapi-heapalloc)и [**VirtualAlloc**](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc)), память выделяется в виртуальном адресном пространстве вызывающего процесса и доступна только потокам этого процесса.

Библиотека DLL может использовать сопоставление файлов для выделения памяти, которая может совместно использоваться процессами. Общее описание использования сопоставления файлов для создания именованной общей памяти см. в разделе [Сопоставление файлов](/windows/desktop/Memory/file-mapping). Пример, использующий функцию [**DllMain**](dllmain.md) для настройки общей памяти с помощью сопоставления файлов, см. [в разделе Использование общей памяти в библиотеке Dynamic-Link](using-shared-memory-in-a-dynamic-link-library.md).

## <a name="thread-local-storage"></a>локальное хранилище потока

Функции локального хранилища потока (TLS) позволяют библиотеке DLL выделить индекс для хранения и извлечения различных значений для каждого потока многопоточного процесса. Например, приложение электронной таблицы может создавать экземпляры одного и того же потока каждый раз, когда пользователь открывает новую электронную таблицу. Библиотека DLL, предоставляющая функции для различных операций с электронными таблицами, может использовать TLS для сохранения сведений о текущем состоянии каждой таблицы (строки, столбца и т. д.). общие сведения о локальном хранилище потоков см. в статье [local служба хранилища потока](/windows/desktop/ProcThread/thread-local-storage). пример, в котором для настройки локального хранилища потока используется функция [**DllMain**](dllmain.md) , см. [в разделе использование локального служба хранилища потока в библиотеке Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).

**Windows Server 2003 и Windows XP:** Компилятор Visual C++ поддерживает синтаксис, позволяющий объявлять локальные переменные потока: **\_ declspec (thread)**. при использовании этого синтаксиса в библиотеке dll вы не сможете загрузить DLL явным образом с помощью [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) или [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) в версиях Windows до Windows Vista. Если библиотека DLL будет загружена явным образом, необходимо использовать функции локального хранилища потока вместо **\_ declspec (thread)**.

 

 
