---
title: Включение функций Интернета
description: Перед использованием функций WinINet приложение должно попытаться установить подключение к Интернету с помощью функции Интернетаттемптконнект.
ms.assetid: 80747c0d-5a09-4ffa-a0ca-b051b82acbf8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 23f4780b508059c088e2948829662171fd6df46f
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2021
ms.locfileid: "122885496"
---
# <a name="enabling-internet-functionality"></a>Включение функций Интернета

Перед использованием функций WinINet приложение должно попытаться установить подключение к Интернету с помощью функции [**интернетаттемптконнект**](/windows/desktop/api/Wininet/nf-wininet-internetattemptconnect) . Эта функция вызывает диалоговое окно удаленного доступа, чтобы установить соединение с Интернетом или проверить, существует ли уже соединение. Если эта функция завершается ошибкой, приложение может перейти в автономный режим, что позволяет ему получить доступ к информации, кэшированной во время предыдущих подключений к Интернету.

Используйте функцию [**интернетчеккконнектион**](/windows/desktop/api/Wininet/nf-wininet-internetcheckconnectiona) для проверки подключения к Интернету. Он пытается проверить связь с сервером, назначенным URL-адресом, который передается функции. Если \_ \_ установлен флаг флага подключения ICC Force \_ и URL-адрес имеет **значение NULL**, функция проверяет наличие записи в базе данных сервера для ближайшего сервера. Если он существует, функция проверяет связь с этим сервером.

Затем используйте функцию [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) , чтобы установить характеристики подключения к Интернету, используемого клиентским приложением. [**Интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) создает корневой обработчик [**хинтернет**](appendix-a-hinternet-handles.md) , который используется для установки сеансов [FTP](ftp-sessions.md) по [протоколу HTTP](http-sessions.md). [**Интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) не проверяет подключение к Интернету, чтобы убедиться, что характеристики, переданные в функцию, верны.

Используйте функцию [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) для создания конкретного сеанса. [**Интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) Инициализирует сеанс для указанного сайта с помощью переданных ему аргументов и создает обработчик [**хинтернет**](appendix-a-hinternet-handles.md) , который является ветвью корневого маркера. [**Интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) не пытается получить доступ к указанному сайту или установить соединение с ним, за исключением случая сеанса FTP. Функции [**фтпфиндфирстфиле**](/windows/desktop/api/Wininet/nf-wininet-ftpfindfirstfilea), [**фтпопенфиле**](/windows/desktop/api/Wininet/nf-wininet-ftpopenfilea)и [**Хттпопенрекуест**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta) используют маркер, созданный [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) , для установления соединения с указанным сайтом.

## <a name="using-internetopen"></a>Использование Интернетопен

Чтобы включить подключение к Интернету, необходимо создать корневой обработчик [**хинтернет**](appendix-a-hinternet-handles.md) с помощью [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena). Сведения об агенте пользователя (приложение, вызывающее Интернет-функции), тип доступа к Интернету, имена прокси-серверов, узлы и адреса, которые обходят прокси-сервер, и поведение передается в [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena).

### <a name="setting-the-user-agent"></a>Настройка агента пользователя

Вызывающее приложение должно предоставить строку, содержащую имя приложения или сущности, обращающейся к Интернету, в параметр *Лпсзажент* [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena). Эта строка используется в качестве агента пользователя в протоколе HTTP. Например, Microsoft Internet Explorer использует обозреватель Microsoft Internet Explorer.

### <a name="setting-access-types"></a>Настройка типов доступа

[**Интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) поддерживает три типа доступа:

-   Используйте параметр \_ открыть \_ в Интернете введите \_ Direct, если система, в которой выполняется приложение, использует прямое подключение к Интернету. Параметры *лпсзпроксинаме* и *лпсзпроксибипасс* [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) не используются и должны иметь значение **null**.
-   Используйте \_ \_ \_ прокси-сервер в Интернете с открытым типом, если в системе, в которой выполняется приложение, используется один или несколько прокси-серверов для доступа к Интернету. [**Интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) использует прокси-серверы, указанные в *лпсзпроксинаме* , и обходит прокси-сервер для любых имен узлов или IP-адресов, указанных в *лпсзпроксибипасс*.
-   Используйте \_ параметр Internet Open \_ Type \_ config, чтобы сообщить приложению о необходимости извлечения конфигурации из реестра. Обычно это лучший выбор, так как большинство приложений, включая веб-браузеры, используют этот параметр.

В \_ \_ \_ разделе "Конфигурация открытых типов в Интернете" рассматриваются значения реестра **Проксенабле**, **proxyserver** и **проксйоверриде**. эти значения находятся в папке "HKEY \_ CURRENT \_ USER \\ Software \\ Microsoft \\ Windows \\ CurrentVersion \\ Internet Параметры".

Если **проксенабле** равен нулю, приложение использует \_ прямое открытие типа "Интернет" \_ \_ . В противном случае приложение использует \_ \_ прокси-сервер с открытым типом Интернета \_ и использует сведения о **proxyserver** и **проксйоверриде** .

Функции WinINet обеспечивают поддержку для прокси типа SOCKS, только если установлен Internet Explorer. В состав установки Internet Explorer входит Wsock32n.dll файл, необходимый для поддержки прокси-серверов SOCKS. Wsock32n.dll не является распространяемым.

### <a name="listing-proxy-servers"></a>Вывод списка прокси-серверов

WinINet распознает два типа прокси: CERN типа прокси (только HTTP) и TIS FTP-прокси (только FTP). Если установлен Internet Explorer, WinINet также поддерживает прокси-серверы типа SOCKS. По умолчанию [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) предполагает, что указанный прокси-сервер является прокси-сервером CERN. Если для параметра Тип доступа задано значение INTERNET \_ Open \_ Type \_ Direct или Internet \_ Open Type \_ \_ config, параметр *лпсзпроксинаме* [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) должен иметь значение **null**. В противном случае значение, передаваемое в *лпсзпроксинаме* , должно содержать прокси-серверы в строке, разделенной пробелами. Списки прокси-серверов могут содержать номер порта, который используется для доступа к прокси-серверу.

Чтобы получить список прокси-сервера для конкретного протокола, строка должна соответствовать формату "" &lt; &gt; &lt; протокол протокола &gt; ://<имя прокси-сервера \_> "". Допустимые протоколы: HTTP, HTTPS и FTP. Например, чтобы получить список прокси-сервера FTP, допустима строка "" FTP = FTP://ФТП \_ Proxy \_ Name: 21 "", где \_ имя прокси-сервера FTP \_ — это имя прокси-сервера FTP, а 21 — номер порта, который должен использоваться для доступа к прокси-серверу. Если прокси-сервер использует номер порта по умолчанию для этого протокола, номер порта можно опустить. Если имя прокси-сервера указано отдельно, оно используется в качестве прокси-сервера по умолчанию для всех протоколов, для которых не указан определенный прокси-сервер. Например, "" HTTP = https://http\_proxy other "" будет использовать HTTP \_ -прокси для любых операций HTTP, тогда как все остальные протоколы будут использовать другие.

По умолчанию функция предполагает, что прокси-сервер, указанный в *лпсзпроксинаме* , является прокси-сервером CERN. Приложение может указывать более одного прокси-сервера, включая разные прокси для разных протоколов. Например, если указать "" FTP = FTP://ФТП-ГВ HTTP = https://jericho:99 proxy "", запросы FTP выполняются через прокси-сервер FTP-GW, который прослушивает порт 21, и HTTP-запросы выполняются через прокси-сервер CERN с именем жеричо, который прослушивает порт 99. В противном случае HTTP-запросы будут выполняться через прокси-сервер CERN с именем proxy, который прослушивает порт 80. Обратите внимание, что если приложение использует только FTP, например, не нужно указывать "" FTP = FTP://ФТП-ГВ: 21 "". Он может указать только "" FTP-GW "". Приложение требуется только для указания имен протоколов, если оно использует более одного протокола для каждого обработчика, возвращаемого функцией [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena).

### <a name="listing-the-proxy-bypass"></a>Вывод списка обхода прокси-сервера

Имена узлов или IP-адреса, которые не должны отправляться в прокси-сервер, могут быть перечислены в списке обхода прокси-сервера. Этот список может содержать подстановочные знаки, " \* ", что приводит к тому, что приложение обходит прокси-сервер для адресов, соответствующих указанному шаблону. Чтобы вывести несколько адресов и имен узлов, разделите их точкой с запятой в строке обхода прокси-сервера. Если указан " &lt; локальный &gt; " макрос, функция обходит прокси-сервер для любого имени узла, не содержащего точку.

По умолчанию WinINet будет обходить прокси-сервер для запросов, использующих имена узлов "localhost", "loopback", "127.0.0.1" или " \[ :: 1 \] ". Это связано с тем, что удаленный прокси-сервер обычно не будет правильно разрешать эти адреса.

**Internet Explorer 9:** Вы можете удалить локальный компьютер из списка обхода прокси-сервера с помощью макроса "<-loopback>".

В следующем примере показаны примеры вызовов [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) с использованием разных строк обхода прокси-сервера. В комментариях, вышеуказанных при каждом вызове, описывается, какое воздействие на строку обхода имеет имя узла, доступ к которому осуществляется из создаваемого им обработчика [**хинтернет**](appendix-a-hinternet-handles.md) .


```C++
HINTERNET hInternetRoot;

/* bypass the proxy for any host name that does not 
    contain a period */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("<local>"), 0);

/* bypass the proxy for any host name that starts with the 
    letters "ms" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("ms*"), 0);

/* bypass the proxy for any host name that contains "int", 
    such as "internet" and "painter" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("*int*"), 0);

/* bypass the proxy for the host name "example" and any 
    host name that contains "test" */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("proxy"),TEXT("example *test*"), 0);

/* Disable the loopback proxy bypass for localhost */
hInternetRoot = InternetOpen(TEXT("WinInet Example"), 
    INTERNET_OPEN_TYPE_PROXY,TEXT("127.0.0.1:8888"),TEXT("<-loopback>"), 0);
```



## <a name="using-internetconnect"></a>Использование Интернетконнект

Чтобы начать сеанс, функция [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) должна создать обработчик из корневого маркера, возвращенного функцией [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) . [**Интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) задает адрес сервера, номер порта, имя пользователя, пароль и тип службы.

[**Интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) использует для установки обработчика сеанса корневой обработчик [**хинтернет**](appendix-a-hinternet-handles.md) , созданный с помощью [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena) . Если в вызове [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena)был установлен флаг [ \_ \_ Async в Интернете](api-flags.md) , вызов [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) должен включать ненулевое значение контекста.

Имя сервера может содержать либо имя узла (например, "www.servername.com"), либо IP-номер сайта в точечно-десятичном формате ASCII (например, "10.0.1.45").

Порт сервера — это номер порта TCP/IP, к которому необходимо подключиться на сервере. [**Интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) использует порт по умолчанию для выбранного типа службы, если \_ используется недопустимое \_ значение номера порта в Интернете \_ . В следующих таблицах содержатся параметры порта сервера по умолчанию для WinINet.




| Значение | Значение | 
|-------|---------|
| INTERNET_DEFAULT_FTP_PORT | Используйте порт по умолчанию для FTP-серверов (порт 21). | 
| INTERNET_DEFAULT_GOPHER_PORT | Используйте порт по умолчанию для серверов gopher (порт 70).<blockquote>[!Note]<br />Windows XP и Windows Server 2003 R2 и более ранних версий.</blockquote><br /> | 
| INTERNET_DEFAULT_HTTP_PORT | Используйте порт по умолчанию для серверов HTTP (порт 80). | 
| INTERNET_DEFAULT_HTTPS_PORT | Используйте порт по умолчанию для серверов HTTPS (порт 443). | 
| INTERNET_DEFAULT_SOCKS_PORT | Используйте порт по умолчанию для серверов брандмауэра SOCKS (порт 1080). | 




 

### <a name="defining-the-user-name-and-password"></a>Определение имени пользователя и пароля

Значение *лпсзусернаме* — это адрес строки, завершающейся **нулем,** которая содержит имя пользователя, выполнившего вход в систему. Если этот параметр имеет **значение NULL**, функция использует подходящее значение по умолчанию, за исключением HTTP. Параметр **null** в HTTP приводит к тому, что сервер возвращает ошибку. Для FTP-протокола значение по умолчанию — Anonymous.

Значение *лпсзпассворд* — это адрес строки, завершающейся **нулем,** которая содержит пароль для входа. Если оба *лпсзусернаме* и *Лпсзпассворд* имеют **значение NULL**, функция использует анонимный пароль по умолчанию. В случае FTP анонимный пароль по умолчанию — это имя электронной почты пользователя. Если *лпсзусернаме* не равен **null** , а *лпсзпассворд* имеет **значение NULL**, функция использует пустой пароль. Существует четыре возможных параметра *лпсзусернаме* и *лпсзпассворд*, которые создают поведение, приведенное в следующей таблице.



| *лпсзусернаме*      | *лпсзпассворд*      | Имя пользователя, отправленное на FTP-сервер | Пароль, отправленный на FTP-сервер |
|---------------------|---------------------|------------------------------|-----------------------------|
| **NULL**            | **NULL**            | подключившихся                  | Имя электронной почты пользователя           |
| Строка, не **равная NULL** | **NULL**            | *лпсзусернаме*               | ""                          |
| **NULL**            | Строка, не **равная NULL** | ОШИБКА                        | ОШИБКА                       |
| Строка, не **равная NULL** | Строка, не **равная NULL** | *лпсзусернаме*               | *лпсзпассворд*              |



 

Эти сведения можно изменить с помощью функций [**интернетсетоптион**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) и [**интернетеррордлг**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) . [**Интернетсетоптион**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) изменяет значения имени пользователя и пароля, в то время как [**интернетеррордлг**](/windows/desktop/api/Wininet/nf-wininet-interneterrordlg) отображает диалоговое окно, в котором запрашиваются правильные имя пользователя и пароль.

### <a name="defining-the-session"></a>Определение сеанса

Чтобы определить установленный сеанс, задайте тип службы, флаги и значение контекста для [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta).

Существует два типа служб, доступных для [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta): \_ \_ FTP-служба Интернета и \_ \_ http. \_ \_ HTTP-служба Интернета используется как для сеансов HTTP, так и для HTTPS.

[Интернет \_ ФЛАГ \_ passive](api-flags.md) является единственным зависящим от службы флагом, используемым функциями WinInet. Этот флаг можно задать, если тип службы — INTERNET \_ Service \_ FTP, чтобы использовать пассивную семантику FTP.

Для всех синхронных операций значение *двконтекст* должно быть равно нулю. Если асинхронные операции были установлены путем установки флага [ \_ \_ Async Internet Flag](api-flags.md) в вызове [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena), для *двконтекст* должно быть задано ненулевое значение. Дополнительные сведения об асинхронных операциях см. в разделе [Настройка асинхронных операций](common-functions.md).

Для сеансов FTP [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) пытается установить подключение к серверу в Интернете. Для сеансов HTTP [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta) не устанавливает соединение, пока другая функция не попытается получить информацию с сервера.

> [!Note]  
> WinINet не поддерживает реализации серверов. Кроме того, его не следует использовать из службы. для серверных реализаций или служб используйте [Microsoft Windows HTTP services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).

 

 

