---
title: Кодирование контента
description: Начиная с Windows Server 2008 и Windows Vista, приложение может направить WinINet для выполнения декодирования содержимого gzip и Deflate схем кодирования содержимого.
ms.assetid: 136f22a6-e5ca-41c5-8651-6e132655d268
keywords:
- Кодирование контента
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 09b089ae2aa4cbacdfc9b6ebefe5cbdfc1bfc10e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104070488"
---
# <a name="content-encoding"></a>Кодирование контента

Как указано в приложениях протокола HTTP (RFC 2616), может запросить, чтобы сервер возвращал HTTP-ответы в закодированном формате. До Windows Server 2008 и Windows Vista запросы с кодировкой содержимого были отправлены приложению для обработки на их уровне. Начиная с Windows Server 2008 и Windows Vista, приложение может направить WinINet для выполнения декодирования содержимого gzip и Deflate схем кодирования содержимого.

Чтобы включить декодирование содержимого, приложение устанавливает параметр декодирования, запрашивающий, что WinINet выполняет декодирование от своего имени. Однако включение декодирования не гарантирует, что WinINet будет выполнять декодирование содержимого, и приложение должно быть подготовлено к обработке декодирования. WinINet отделяет заголовок Content-Encoding от ответа при успешном выполнении декодирования содержимого. Предполагается, что приложения обрабатывают декодирование содержимого независимо от того, включен или отключен параметр декодирования при наличии в ответе заголовка Content-Encoding.

При включении декодирования приложение должно указать список поддерживаемых кодировок в заголовке Accept-Encoding запроса. Однако заголовок Accept-Encoding не обязан отсылать закодированный ответ серверу. WinINet будет отправлять ответы, не соответствующие списку допустимых кодировок, обратно в приложение.

В следующем списке описаны условия, при которых WinINet будет выполнять декодирование содержимого при включенном параметре.

-   Заголовок Accept-Encoding должен присутствовать в запросе, и он должен указывать файлы gzip, Deflate, а также схемы кодирования gzip и Deflate.
-   Схема кодирования, указанная в заголовке Content-Encoding, должна соответствовать одной из схем кодирования, указанных в заголовке Accept-Encoding.
-   В заголовке Content-Encoding в ответе указывается только одна схема кодирования.
-   Ответ должен содержать только один заголовок Content-Encoding. WinINet декодирует содержимое, закодированное только одной схемой кодирования.
-   Заголовок Cache-Control не должен содержать директивы без преобразования.
-   Заголовок Content-Range не должен присутствовать в ответе.

## <a name="setting-the-decompression-option"></a>Установка параметра распаковки

Параметр декодирования может быть установлен для обработчика сеанса, маркера запроса или маркера соединения. Маркер, для которого задан параметр декодирования, определяет область действия параметра декодирования. Например, установка декодирования в сеансе позволит декодировать все соединения и запросы, созданные в этом обработчике.

Чтобы задать параметр декодирования, приложение вызывает [**интернетсетоптион**](/windows/desktop/api/Wininet/nf-wininet-internetsetoptiona) с маркером, возвращенным из [**интернетопен**](/windows/desktop/api/Wininet/nf-wininet-internetopena), [**интернетконнект**](/windows/desktop/api/Wininet/nf-wininet-internetconnecta)или [**хттпопенрекуест**](/windows/desktop/api/Wininet/nf-wininet-httpopenrequesta). Параметр **Интернета \_ " \_ параметр \_ декодирования HTTP** " указан в параметре *элемент dwoption* , а параметр *лпбуффер* указывает на логическую переменную, для которой установлено значение true. Чтобы отключить декодирование, приложение вызывает **интернетсетоптион** с параметром **Интернет \_ \_ - \_ декодирования HTTP** , а логическая переменная имеет значение false.

Если задан параметр декодирования, WinINet выполняет Декодирование запроса, когда приложение вызывает [**интернетреадфиле**](/windows/desktop/api/Wininet/nf-wininet-internetreadfile). Если WinINet обнаруживает ошибку при выполнении декодирования содержимого, вызов **интернетреадфиле** завершается сбоем с **ошибкой \_ \_ декодирования \_ в Интернете**. При неудачном декодировании приложение имеет два варианта: оно может удалить заголовок Accept-Encoding и повторно отправить запрос или установить параметр **Интернет \_ \_ - \_ декодирования HTTP** в запросе в значение false, а затем повторно отправить запрос. Если для параметра декодирования задано значение false, приложение должно проверить заголовок Content-Encoding и выполнить декодирование на уровне приложения.

> [!Note]  
> WinINet не поддерживает реализации серверов. Кроме того, его не следует использовать из службы. Для серверных реализаций или служб используйте [службы Microsoft Windows HTTP Services (WinHTTP)](/windows/desktop/WinHttp/winhttp-start-page).

 

 

 