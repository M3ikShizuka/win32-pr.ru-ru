---
description: Когда поток пытается получить доступ к защищаемому объекту, система либо предоставляет, либо запрещает доступ.
ms.assetid: dc98b23e-ce42-4d4a-a285-c0b7b5e2a478
title: Как работает AccessCheck
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 730cc8f63e7d69bf4cb38344f5eda60861d08a9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104568703"
---
# <a name="how-accesscheck-works"></a>Как работает AccessCheck

Когда поток пытается получить доступ к защищаемому объекту, система либо предоставляет, либо запрещает доступ. Если объект не имеет [*списка управления доступом на уровне пользователей*](/windows/desktop/SecGloss/d-gly) (DACL), система предоставляет доступ; в противном случае система ищет [записи контроля доступа](access-control-entries.md) (ACE) в списке DACL объекта, который применяется к потоку. Каждый элемент ACE в списке DACL объекта определяет права доступа, разрешенные или запрещенные для [доверенного лица](trustees.md), которое может быть учетной записью пользователя, учетной записью группы или [*сеансом входа в систему*](/windows/desktop/SecGloss/l-gly).

## <a name="dacls"></a>DACL

Система сравнивает доверенное лицо в каждом ACE с доверенными лицами, определенными в [маркере доступа](access-tokens.md)потока. Маркер доступа содержит [*идентификаторы безопасности*](/windows/desktop/SecGloss/s-gly) (SID), которые определяют пользователя и учетные записи групп, к которым принадлежит пользователь. Маркер также содержит [*идентификатор безопасности входа в систему*](/windows/desktop/SecGloss/l-gly) , определяющий текущий сеанс входа в систему. Во время проверки доступа система не учитывает идентификаторы безопасности групп, которые не включены. Дополнительные сведения о включенных, отключенных и запрещенных идентификаторах безопасности см. [в разделе атрибуты SID в маркере доступа](sid-attributes-in-an-access-token.md).

Как правило, система использует [*основной маркер доступа*](/windows/desktop/SecGloss/p-gly) потока, запрашивающего доступ. Однако если поток олицетворяет другого пользователя, система использует [*токен олицетворения*](/windows/desktop/SecGloss/i-gly)потока.

Система проверяет каждый элемент ACE в последовательности до тех пор, пока не произойдет одно из следующих событий:

-   ACE, запрещающий доступ, явно запрещает любой из запрошенных [прав доступа](access-rights-and-access-masks.md) к одному из доверенных лиц, перечисленных в маркере доступа потока.
-   Один или несколько записей ACE, разрешенных доступом для доверенных лиц, указанных в маркере доступа потока, явным образом предоставляют все запрошенные права доступа.
-   Все ACE проверены, и по-прежнему есть по крайней мере одно запрошенное право доступа, которое не было явно разрешено. в этом случае доступ неявно отклоняется.

На следующем рисунке показано, как DACL объекта может разрешить доступ к одному потоку при запрете доступа к другому.

![списки DACL, которые предоставляют различные права доступа к разным потокам](images/accctrl1.png)

Для потока а система считывает ACE 1 и немедленно запрещает доступ, так как доступ ACE, запрещенный для доступа, применяется к пользователю в маркере доступа потока. В этом случае система не проверяет ACE 2 и 3. Для потока B элемент управления доступом 1 не применяется, поэтому система переходит к записи ACE 2, которая обеспечивает доступ на запись, и запись ACE 3, которая разрешает доступ для чтения и выполнения.

Поскольку система прекращает проверку ACE, когда запрошенный доступ явно предоставлен или запрещен, важен порядок записей ACE в списке DACL. Обратите внимание, что если в этом примере порядок ACE был различным, система, возможно, предоставила доступ к потоку а. Для системных объектов операционная система определяет предпочтительный [порядок записей ACE в списке DACL](order-of-aces-in-a-dacl.md).

 

 
