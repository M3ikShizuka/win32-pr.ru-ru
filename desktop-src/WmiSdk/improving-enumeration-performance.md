---
description: Перечисления обычно используют значительный объем системных ресурсов.
ms.assetid: 4163e6c2-4ee3-4906-b297-618509666c90
ms.tgt_platform: multiple
title: Повышение производительности перечисления
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: df2554e9e1df2f2ece58f5703d6099d84acbe01c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265602"
---
# <a name="improving-enumeration-performance"></a>Повышение производительности перечисления

Перечисления обычно используют значительный объем системных ресурсов. Поэтому следует попытаться оптимизировать процесс перечисления WMI, если планируется выполнять перечисления для большой группы. Скрипты также могут использовать запрос, чтобы избежать снижения производительности в операциях "For Each.... Next" с большим набором. Дополнительные сведения см. в разделе [запрос WMI](querying-wmi.md).

Следующая процедура описывает, как повысить производительность перечисления.

**Повышение производительности перечисления**

1.  Установите параметр *лфлагс* , чтобы разрешить семисинчронаус возвращать данные с помощью перечислителя, который удаляет каждый элемент из WMI по мере его доставки. Дополнительные сведения см. [в разделе вызов метода](calling-a-method.md).

    В следующем примере кода C++ показано, как использовать **флаг WBEM \_ , \_ возвращающий \_** флаги Immediate и **WBEM, \_ \_ \_ только** флаги forward.

    `WBEM_FLAG_RETURN_IMMEDIATE | WBEM_FLAG_FORWARD_ONLY`

    В VBScript или Visual Basic используйте флаги скрипта **вбемфлагретурниммедиатели** и **вбемфлагфорвардонли** из [вбемфлаженум](/windows/desktop/api/Wbemdisp/ne-wbemdisp-wbemflagenum). Объединенное значение этих флагов — десятичное число 48.

    Флаги скрипта и параметров вызывают следующее поведение:

    -   **Флаг WBEM \_ \_ возвращает \_ немедленные** или **вбемфлагретурниммедиатели** запросы флагов, семисинчронаус поведение. Вызов для создания перечислителя немедленно возвращает значение. Затем можно начать проход по полученному набору объектов.
    -   Флаг **WBEM \_ \_ \_ только флаг Forward** или **вбемфлагфорвардонли** запрашивает перечислитель, который нельзя перемотать назад. Это значит, что инструментарий WMI может освободить объект после просмотра объекта.

    В ситуациях, когда перечисление велико, и приложение выполняется очень быстро, использование перечислителей с семисинчронаус позволяет инструментарию WMI разместить на гораздо меньшем количестве объектов, тем самым повышая время отклика и производительность памяти.

    В следующем примере кода VBScript показано, как выполнить вызов с использованием комбинированных флагов **вбемфлагретурниммедиатели** и **вбемфлагфорвардонли** для получения коллекции событий из журнала событий.

    ```VB
    Set Events = GetObject("winmgmts:").ExecQuery _
         ("SELECT * FROM Win32_NTLogEvent " _
          & "WHERE Logfile = 'System'",,48)
    ```

    

2.  По возможности избегайте использования [**CreateInstanceEnum**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-createinstanceenum) в C++ или [**SwbemServices. инстанцесоф**](swbemservices-instancesof.md)и вместо этого используйте **ExecQuery**.

    Метод **ExecQuery** запрашивает WMI с помощью технологий баз данных, в то время как [**CreateInstanceEnum**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-createinstanceenum) или [**SWBEMSERVICES. инстанцесоф**](swbemservices-instancesof.md) перечисляет объекты WMI. В частности, **ExecQuery** может запрашивать определенные подмножества данных, которые не могут перечислять методы.

    Поскольку некоторые поставщики не имеют возможностей запросов, Инструментарий WMI предоставляет функцию "POST Filter", позволяющую инструментарию WMI удалять экземпляры, не выполняющие спецификаций запроса. Использует ли конкретный поставщик преимущества этой функции, разработчик поставщика.

3.  Экспериментируйте с различными запросами, чтобы определить, что обеспечивает наилучшую производительность.

    Например, Инструментарий WMI редко эффективно обрабатывает запросы с предложениями **WHERE** формы Prop1 < "x". В отличие от этого, WMI обычно обрабатывает запросы формы KeyProp1 = "x" эффективно.

Дополнительные сведения см. в разделе [перечисление WMI](enumerating-wmi.md).

 

 



