---
description: Фильтр событий — это класс WMI, который описывает, какие события WMI доставляют с физическим потребителем.
ms.assetid: c0ce26a4-5ff2-44b4-8550-c7d8ad0ba0f0
ms.tgt_platform: multiple
title: Создание фильтра событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 693e4ef2eee5de14550b8efbf25a9b6720d6a8b2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105713109"
---
# <a name="creating-an-event-filter"></a>Создание фильтра событий

Фильтр событий — это класс WMI, который описывает, какие события WMI доставляют с физическим потребителем. Например, фильтр событий может указать инструментарию WMI предоставить потребителю все события управления питанием или все события перезагрузки системы. Фильтр событий также описывает условия, при которых Инструментарий WMI доставляет события. Фильтр событий может указывать внутреннее или внешнее событие. фильтр может ссылаться на события, происходящие в пространстве имен, то есть за исключением пространства имен фильтра. Постоянный потребитель должен иметь тот же [**креаторсид**](--eventconsumer.md) в экземплярах объекта-получателя, фильтра и привязки. Дополнительные сведения см. в статье [безопасное получение событий](receiving-events-securely.md).

В следующей процедуре описывается создание фильтра событий.

**Создание фильтра событий**

1.  Создайте экземпляр класса System [**\_ \_ EventFilter**](--eventfilter.md) WMI.
2.  Создайте уникальный идентификатор для фильтра с помощью свойства **Name** одним из двух способов:

    -   Используйте частную схему.

        Произвольное именование фильтров событий работает, пока не конфликтуют с другими схемами именования фильтров. Следует избегать конфликтов имен, так как добавление экземпляра с совпадающим значением **имени** перезаписывает старый экземпляр.

    -   Используйте глобальный уникальный идентификатор (GUID).

        Если оставить **имя** пустым, WMI заполнит **имя** идентификатором GUID.

3.  Опишите тип события, которое нужно фильтровать с помощью свойства **Query** .

    Свойство **Query** содержит запрос язык запросов WMI (WQL), описывающий тип события, для которого необходимо выполнить фильтрацию. Вы можете добиться точной фильтрации, используя различные операторы и расширения WQL.

    Событие журнала NT создается при сбое запроса от постоянного потребителя события. Источник события — WinMgmt, идентификатор события — 10, а тип события — ошибка.

    Инструментарий WMI более эффективен при обработке с преточными запросами, чем с широкими запросами. Создавая конкретный запрос, можно избежать ненужного межпроцессного взаимодействия и сетевого трафика. В случае событий, создаваемых поставщиком, WMI выполняет фильтрацию в процессе обработки поставщику. Это гарантирует, что только события, соответствующие фильтру, потребуют стоимости межпроцессного обмена данными. Дополнительные сведения см. в разделе [запрос WMI](querying-wmi.md).

4.  Задайте для свойства **куерилангуаже** тип языка запроса, используемого в свойстве **запрос** .

    Вы почти всегда устанавливаете **куерилангуаже** в "WQL".

В следующем примере кода описывается фильтр событий, который сигнализирует о событии каждый раз, когда инструментарий WMI создает экземпляр класса [**\_ \_ тимеревент**](--timerevent.md) в корневом \\ пространстве имен CIMV2.

``` syntax
instance of __EventFilter as $FILTER
{
    Name = "MyFilterName";
    Query = "select * from __TimerEvent where TimerID=\"MyTimer\"";
    QueryLanguage = "WQL";
    EventNamespace = "\root\cimv2";

    // this is the Administrators SID in array of bytes format
    CreatorSID = {1,2,0,0,0,0,0,5,32,0,0,0,32,2,0,0}; 
};
```

Свойство **евентнамеспаце** указывает пространство имен, из которого происходят события. Нет необходимости создавать экземпляры фильтров в пространстве имен, где происходят события. Если пространство имен не указано, Инструментарий WMI создает фильтр в пространстве имен по умолчанию. Внутренние классы событий, такие как [**\_ \_ инстанцеоператионевент**](--instanceoperationevent.md) , доступны в каждом пространстве имен.

Чтобы зарегистрировать логического потребителя для уведомлений о событиях, необходимо привязать фильтры событий к логическому потребителю. Дополнительные сведения см. в разделе [Привязка фильтра событий к логическому потребителю](binding-an-event-filter-with-a-logical-consumer.md).

 

 



