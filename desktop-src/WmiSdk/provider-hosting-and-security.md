---
description: Указывает модель размещения поставщика. Установка этого свойства приводит к тому, что поставщик загружается в общий хост-процесс с указанным уровнем привилегий.
ms.assetid: 1e5c778d-cd29-449b-88e2-fe0c90d0edcd
ms.tgt_platform: multiple
title: Размещение и безопасность поставщика
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db6b88a5727f34fbb76baf62dcdf0488e5eb9eb7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702834"
---
# <a name="provider-hosting-and-security"></a>Размещение и безопасность поставщика

Свойство [**хостингмодел**](--win32provider.md) в экземпляре **\_ \_ Win32Provider** , представляющем поставщик, указывает модель размещения поставщика. Установка этого свойства приводит к тому, что поставщик загружается в общий хост-процесс с указанным уровнем привилегий.

## <a name="shared-provider-host-process"></a>Процесс узла общего поставщика

Инструментарий WMI находится в узле общей службы с несколькими другими службами. Чтобы избежать остановки всех служб при сбое поставщика, поставщики загружаются в отдельный ведущий процесс с именем "Wmiprvse.exe". Может выполняться более одного процесса с таким именем. Каждый из них может выполняться под другой учетной записью с различными уровнями безопасности. Помните, что, начиная с Windows Vista, используйте команду [**Winmgmt**](winmgmt.md) для запуска инструментария WMI в отдельном процессе, используя фиксированный порт. Дополнительные сведения см. [в статье удаленное подключение к WMI, начиная с ОС Vista](connecting-to-wmi-remotely-starting-with-vista.md).

Общий узел может быть запущен с одной из следующих системных учетных записей в процессе Wmiprvse.exe узла:

-   [локальная система;](/windows/desktop/Services/localsystem-account)
-   [сетевая служба;](/windows/desktop/Services/networkservice-account)
-   [локальная служба.](/windows/desktop/Services/localservice-account)

Поставщик может также быть локальным сервером COM (. exe) или самостоятельным размещением, для которого не требуется узел поставщика WMI.

## <a name="setting-the-hosting-model"></a>Настройка модели размещения

Так как LocalSystem является привилегированной учетной записью, рекомендуется установить [**хостингмодел**](--win32provider.md) в значение **нетворксервицехост** , когда поставщик выполняется в процессе Wmiprvse.exe. Учетная запись Нетворксервицехост предназначена для служб, которым не требуются широкие привилегии, но требуется удаленно взаимодействовать с другими системами.

Если не задать значение для свойства [**хостингмодел**](--win32provider.md) , Инструментарий WMI установит значение по умолчанию **нетворксервицехосторселфхост**. Если для параметра **хостингмодел** задано значение **локалсистемхост**, WMI использует трассировку для создания событий 5603 и 5604 в журнале событий Windows. Так как локальная учетная запись [LocalSystem](/windows/desktop/Services/localsystem-account) имеет высокий уровень привилегий, этот параметр не рекомендуется. Эти события можно просмотреть в **Просмотр событий**. Дополнительные сведения см. в разделе [Трассировка действия WMI](tracing-wmi-activity.md).

Установите свойство [**хостингмодел**](--win32provider.md) для несвязанных поставщиков как "несвязанный: com". Поставщики, созданные путем добавления классов инструментирования из [**Microsoft. Management. Infrastructure**](/previous-versions//hh872326(v=vs.85)) в платформа .NET Framework, являются несвязанными поставщиками. (**System. Management. Instrumentation** больше не поддерживается.) Дополнительные сведения о создании несвязанного поставщика см. в разделе [Включение поставщика в приложение](incorporating-a-provider-in-an-application.md).

Модель размещения указывается в свойстве [**хостингмодел**](--win32provider.md) в экземпляре **\_ \_ Win32Provider** , представляющем поставщик.

**Задание модели размещения для поставщика**

1.  В MOF-файле, определяющем поставщик, создайте экземпляр [**\_ \_ Win32Provider**](--win32provider.md).
2.  Назначьте поставщику имя в свойстве **Name** и назначьте идентификатор класса (CLSID) COM-объекта поставщика свойству **CLSID** .

    Следующий пример кода присваивает свойству **Name** имя и КСЛИД COM-объекта поставщика свойству **CLSID** .

    ``` syntax
    Instance of __Win32Provider as $NewProvider
    {
        Name = "MyProvider";
        Clsid = "{.......}";
    }
    ```

3.  Назначьте соответствующее значение общего узла свойству [**хостингмодел**](--win32provider.md) . Значения общего узла, такие как "Нетворксервицехост", определяются в свойстве **хостингспеЦификатион** класса [**\_ поставщиков MSFT**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) .

    В следующем примере кода значение общего узла присваивается свойству [**хостингмодел**](--win32provider.md) .

    ``` syntax
    HostingModel = "NetworkServiceHost";
    ```

В следующем примере кода показано, как зарегистрировать поставщик в Нетворксервицехост.

``` syntax
Instance of __Win32Provider as $NewProvider
{
    Name = "MyProvider";
    Clsid = "{.......}";
    HostingModel = "NetworkServiceHost";
}
```

Если у вас есть несколько поставщиков, их можно сгруппировать в конкретный узел службы, зарегистрировав поставщик, чтобы он настроился в определенном экземпляре.

В следующем примере кода также регистрируется поставщик в Нетворксервицехост. Класс [**\_ поставщиков MSFT**](/previous-versions/windows/desktop/wmisystemprov/msft-providers) определяет значения для двух значений, которые комбинируются для создания свойства **хостингмодел** [**\_ \_ Win32Provider**](--win32provider.md) . В этом примере значение "Нетворксервицехост" берется из свойства **хостингспеЦификатион** **\_ поставщиков MSFT** , а "Локалсервицехост" — из свойства **хостингграуп** .

``` syntax
Instance of __Win32Provider as $NewProvider
{
    Name = "MyProvider";
    Clsid = "{.......}";
    HostingModel = "NetworkServiceHost:MySharedHost";
}
```

Существуют специальные проблемы разработки для поставщиков, которые не связаны и размещаются в процессе Wmiprvse. Дополнительные сведения см. в разделе [службы отладки](debugging-providers.md).

При создании поставщика, который содержит регистрацию свойств или поставщиков классов, не все модели потоков работают. Дополнительные сведения см. в разделе [Выбор правильной регистрации](choosing-correct-registration.md).

## <a name="hostingmodel-values-for-in-process-providers"></a>Значения Хостингмодел для поставщиков In-Process

В следующем списке перечислены значения модели размещения поставщика, используемые в экземпляре [**\_ \_ Win32Provider**](--win32provider.md) для поставщиков, которые выполняются в процессе Wmiprvse.exe.



| Значение в [ **\_ \_ Win32Provider. хостингмодел**](--win32provider.md) | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Резидент**                                                       | Поставщик начинает использовать реализацию локального сервера вместо внутрипроцессного. Контекст безопасности процесса, в котором запускается поставщик, определяет контекст безопасности поставщика.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **локалсистемхост**                                                | Поставщик, если он реализован как внутрипроцессный, загружается в узел общего поставщика, работающий в контексте [LocalSystem](/windows/desktop/Services/localsystem-account) . Начиная с Windows Vista, **локалсистемхост** больше не является моделью размещения по умолчанию, если [**хостингмодел**](--win32provider.md) поставщика WMI (**\_ \_ Win32Provider**.**Свойство Хостингмодел** ) не задано. Дополнительные сведения см. в разделе [безопасность моделей размещения](#provider-hosting-and-security).                                                                                                                                                                                                                                                                               |
| **локалсистемхосторселфхост**                                      | Поставщик самомещается или загружается в Wmiprvse.exe процесс, работающий под учетной записью [LocalSystem](/windows/desktop/Services/localsystem-account) . Так как LocalSystem является учетной записью с высоким уровнем привилегий, в журнале событий NT безопасности создается запись для уведомления администраторов поставщика, работающего в состоянии доверия.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **нетворксервицехост**                                             | Поставщик, если он реализован как внутрипроцессный, загружается в Wmiprvse.exe процесс, работающий под учетной записью [NetworkService](/windows/desktop/Services/networkservice-account) . Начиная с Windows Vista, это модель размещения по умолчанию, если [**хостингмодел**](--win32provider.md) поставщика WMI (**\_ \_ Win32Provider**.**Свойство Хостингмодел** ) не задано. Дополнительные сведения см. в разделе [безопасность моделей размещения](#provider-hosting-and-security).<br/> **Нетворксервицехост** имеет ограниченные привилегии и, таким образом, снижает вероятность атаки с повышенными правами доступа. Если поставщик работает только на локальном компьютере, установите для свойства [**хостингмодел**](--win32provider.md) значение **локалсервицехост**.<br/> |
| **нетворксервицехосторселфхост**                                   | Поставщик самомещается или загружается в WmiPrvse.exe процесс, работающий под учетной записью [NetworkService](/windows/desktop/Services/networkservice-account) . **Нетворксервицехосторселфхост** является конфигурацией по умолчанию, если свойство [**хостингмодел**](--win32provider.md) в **\_ \_ Win32Provider** имеет **значение NULL**. Поскольку **нетворксервицехосторселфхост** является значением по умолчанию, поставщики из предыдущих операционных систем могут продолжать работать в Windows Vista, windows Server 2008 и более поздних операционных системах.                                                                                                                                                                                                                                             |
| **локалсервицехост**                                               | Поставщик, если он реализован как внутрипроцессный, загружается в Wmiprvse.exe процесс, работающий под учетной записью [LocalService](/windows/desktop/Services/localservice-account) . Это рекомендуемая модель размещения для служб, так как LocalService имеет ограниченные привилегии.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

## <a name="hostingmodel-values-for-decoupled-providers"></a>Значения Хостингмодел для несвязанных поставщиков

В следующем списке перечислены значения модели размещения поставщика для несвязанных поставщиков.

<dl> <dt>

<span id="Decoupled_Com"></span><span id="decoupled_com"></span><span id="DECOUPLED_COM"></span>**Отделено: com**
</dt> <dd>

Поставщик — это отделенный поставщик, размещенный в отдельном процессе, который является клиентом для WMI.

В следующем примере показан спецификатор Фолдидентити для свойства [**хостингмодел**](--win32provider.md) , установленного в **значение false**, которое позволяет поставщику олицетворять клиента.

``` syntax
Decoupled:Com:FoldIdentity(FALSE)
```

Если Фолдидентити не указан, значение Фолдидентити по умолчанию равно **true** . По соображениям безопасности не рекомендуется указывать Фолдидентити (FALSE), так как фальшивое приложение с олицетворением делегата может повлиять на весь домен.

В следующем примере показано свойство [**хостингмодел**](--win32provider.md) , заданное в рекомендуемом способе, эквивалентном заданию ФОЛДИДЕНТИТИ (true).

``` syntax
Decoupled:Com
```

</dd> <dt>

<span id="Decoupled_Noncom"></span><span id="decoupled_noncom"></span><span id="DECOUPLED_NONCOM"></span>**С несвязанным: Нонком**
</dt> <dd>

Только для внутреннего использования. Не поддерживается.

</dd> </dl>

## <a name="security-of-hosting-models"></a>Безопасность моделей размещения

В большинстве случаев **LocalSystem** не нужен, а контекст **нетворксервицехост** является более подходящим. Большинство поставщиков WMI должны олицетворять контекст безопасности клиента для выполнения запрошенных операций от имени клиента WMI. Начиная с Windows Vista, поставщик WMI, в котором отсутствует определение модели размещения и выполняется, как если бы он работал под **локальной** системой, не будет работать должным образом. Чтобы исправить эту ситуацию, измените ожидаемую модель размещения и убедитесь, что код поставщика WMI выполняет операции в контексте Client Security, олицетворяя клиент WMI. LocalSystem редко является обязательным требованием. Если поставщик должен иметь такой уровень привилегий, укажите модель размещения с помощью следующей инструкции в MOF-файле.

``` syntax
HostingModel=LocalSystemHost
```

## <a name="related-topics"></a>См. также

<dl> <dt>

[Выбор правильной регистрации](choosing-correct-registration.md)
</dt> <dt>

[Доступ к пространствам имен WMI](access-to-wmi-namespaces.md)
</dt> <dt>

[Защита пространств имен WMI](securing-wmi-namespaces.md)
</dt> <dt>

[Классы для настройки и устранения неполадок поставщика](provider-configuration-and-troubleshooting-classes.md)
</dt> <dt>

[**\_Поставщики MSFT**](/previous-versions/windows/desktop/wmisystemprov/msft-providers)
</dt> <dt>

[Поддержание безопасности WMI](maintaining-wmi-security.md)
</dt> </dl>

 

