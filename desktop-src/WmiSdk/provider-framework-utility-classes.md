---
description: Классы C++ с WMI, которые являются частью платформы поставщика WMI, больше не рекомендуются для использования.
ms.assetid: d2414a72-3435-4035-bcd9-b3ec87f5709c
ms.tgt_platform: multiple
title: Вспомогательные классы инфраструктуры поставщика
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cab09c99fe2597cacd81e55a4ed18bd4e286ff16
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105703189"
---
# <a name="provider-framework-utility-classes"></a>Вспомогательные классы инфраструктуры поставщика

\[Классы C++ с WMI, которые являются частью платформы поставщика WMI, которая теперь считается окончательным состоянием, и дальнейшая разработка, улучшения и обновления не будут доступны для проблем, связанных с безопасностью, затрагивающих эти библиотеки. [API MI](/previous-versions/windows/desktop/wmi_v2/windows-management-infrastructure) следует использовать для всех новых разработок.\]

Библиотеки инфраструктуры поставщика Framedyd.dll (отладочная версия) и Framedyn.dll (версия выпуска) реализуют несколько вспомогательных классов поставщика. Некоторые функции в Framedyn.dll были удалены из файлов заголовков. Чтобы продолжить использовать эти функции, добавьте `#define FRAMEWORK_ALLOW_DEPRECATED` в код, прежде чем включать фвкоммон. h.

Вы можете выгрузить отдельных поставщиков, которые больше не требуются.

Чтобы использовать эту возможность, необходимо внести три следующих изменения в поставщик в Маиндлл. cpp:

-   В функции **DllMain** , в которой вызывается [**Квбемпровидерглуе:: фрамеворклогиндлл**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogindll(lpcwstr_plong)), необходимо добавить второй параметр, который является указателем на Long.
-   В функции **DllCanUnloadNow** , где вызывается [**Квбемпровидерглуе:: фрамеворклогоффдлл**](/windows/desktop/api/WbemGlue/nf-wbemglue-cwbemproviderglue-frameworklogoffdll(lpcwstr_plong)), необходимо добавить второй параметр, который является указателем на Long.
-   В функции **DllGetClassObject** , где создается экземпляр **квбемглуефактори**, необходимо добавить параметр, который является указателем на Long.

Во всех трех случаях указатель на Long должен быть одним и тем же указателем.

> [!Note]  
> В подпрограммых Маиндлл. cpp, **DllGetClassObject**, **DllCanUnloadNow**, **DllRegisterServer**, **DllUnregisterServer** и **DllMain** должны быть заключены в блок try/catch.

 

> [!Caution]  
> Ссылка на сборки отладки поставщика с помощью Фрамедид. lib для Framedyd.dll. Framedyd.dll находится в каталоге bin пакета средств разработки программного обеспечения Microsoft Windows (SDK) \\ , который не входит в системный путь. При тестировании отладочной сборки поставщика с помощью службы управления Windows поставщик платформы не сможет загрузиться, так как Framedyd.dll или одна из ее зависимостей не будет найдена. Поэтому необходимо либо скопировать Framedyd.dll из \\ каталога Windows SDK bin в \\ \\ каталог System32 WBEM, либо добавить Windows SDK \\ каталог bin в путь поиска системы.

 

В следующей таблице перечислены классы служебной программы платформы поставщика.



| Класс Utility                                          | Описание                                                                                                                     |
|--------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| [**чстринг**](chstring.md)                           | Предоставляет функции сравнения строк и управления для WMI.                                                                  |
| [**чстрингаррай**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray)                 | Содержит для создания массивов Чстринг и управления ими.                                                                      |
| [**трефпоинтерколлектион**](/windows/desktop/api/RefPtrCo/nl-refptrco-trefpointercollection) | Предоставляет доступ к классу контейнера для указателей.                                                                                |
| [**вбемтиме**](wbemtime.md)                           | Упрощает преобразование между различными форматами времени выполнения Windows и ANSI C.                                               |
| [**вбемтимеспан**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan)                   | Содержит вспомогательные функции, используемые для вычисления и удержания разницы временного интервала между двумя объектами [**вбемтиме**](wbemtime.md) . |



 

> [!Note]  
> Классы [**чстринг**](chstring.md) и [**чстрингаррай**](/windows/desktop/api/ChStrArr/nl-chstrarr-chstringarray) ПОХОЖИ на Microsoft Foundation Classes (MFC) **CString** и **кстрингаррай**. Версии WMI существуют, чтобы разработчики могли обращаться к методам обработки строк и сравнения без доступа к MFC. Классы [**вбемтиме**](wbemtime.md) и [**вбемтимеспан**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) также похожи на классы **CTime** и **ктимеспан** MFC. Версии инструментария WMI способны хранить время до наносекунд, а также выполнять преобразование в **BSTR** и обратно. Дополнительные сведения о классах CString, Кстрингаррай, CTime и Ктимеспан см. [Microsoft Foundation Classes](https://msdn.microsoft.com/library/d06h2x6e(VS.71).aspx) на сайте MSDN.

 

Значения **BSTR** , возвращаемые методами [**Вбемтиме**](wbemtime.md) , имеют [Формат даты и времени](date-and-time-format.md): "yyyymmddHHMMSS. ммммммсууу"

Значения **BSTR** , возвращаемые методами [**Вбемтимеспан**](/windows/desktop/api/WbemTime/nl-wbemtime-wbemtimespan) , имеют [Формат интервала](interval-format.md): "ддддддддххммсс. мммммм: 000"

Хотя время и диапазоны времени хранятся внутренне как наносекундах, они не обязательно хранятся с точностью до наносекунд. Это обусловлено тем, что объекты [**вбемтиме**](wbemtime.md) могут быть созданы с использованием форматов времени, которые являются точными для секунды (**Структура TM** и **время \_ t**). Добавление искусственных десятичных разрядов не приводит к повышению точности.

 

 
