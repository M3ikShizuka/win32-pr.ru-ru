---
description: Класс Коммандлинивентконсумер запускает произвольный процесс в локальной системе при доставке события в него.
ms.assetid: 0dcae783-1722-45a4-b5d4-3fcf455dacf8
ms.tgt_platform: multiple
title: Класс Коммандлинивентконсумер
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- CommandLineEventConsumer
- CommandLineEventConsumer.CreatorSID
- CommandLineEventConsumer.MachineName
- CommandLineEventConsumer.MaximumQueueSize
- CommandLineEventConsumer.CommandLineTemplate
- CommandLineEventConsumer.CreateNewConsole
- CommandLineEventConsumer.CreateNewProcessGroup
- CommandLineEventConsumer.CreateSeparateWowVdm
- CommandLineEventConsumer.CreateSharedWowVdm
- CommandLineEventConsumer.DesktopName
- CommandLineEventConsumer.ExecutablePath
- CommandLineEventConsumer.FillAttributes
- CommandLineEventConsumer.ForceOffFeedback
- CommandLineEventConsumer.ForceOnFeedback
- CommandLineEventConsumer.KillTimeout
- CommandLineEventConsumer.Name
- CommandLineEventConsumer.Priority
- CommandLineEventConsumer.RunInteractively
- CommandLineEventConsumer.ShowWindowCommand
- CommandLineEventConsumer.UseDefaultErrorMode
- CommandLineEventConsumer.WindowTitle
- CommandLineEventConsumer.WorkingDirectory
- CommandLineEventConsumer.XCoordinate
- CommandLineEventConsumer.XNumCharacters
- CommandLineEventConsumer.XSize
- CommandLineEventConsumer.YCoordinate
- CommandLineEventConsumer.YNumCharacters
- CommandLineEventConsumer.YSize
- CommandLineEventConsumer.FillAttribute
api_type:
- DllExport
api_location:
- Wbemcons.dll
ms.openlocfilehash: dce5100ba83a04ef2f6252421ec49068e84730141830e7b01f177c81bbac21b3
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118319593"
---
# <a name="commandlineeventconsumer-class"></a>Класс Коммандлинивентконсумер

Класс **коммандлинивентконсумер** запускает произвольный процесс в локальной системе при доставке события в него. Этот класс является одним из стандартных потребителей событий, предоставляемых инструментарием WMI. Дополнительные сведения см. [в разделе Мониторинг и реагирование на события с помощью стандартных потребителей](monitoring-and-responding-to-events-with-standard-consumers.md).

> [!Note]  
> При использовании класса **коммандлинивентконсумер** Обеспечьте безопасность исполняемого файла, который требуется запустить. Если исполняемый файл не находится в безопасном месте или защищен с помощью строгого списка управления доступом (ACL), неавторизованный пользователь может заменить исполняемый файл вредоносным. дополнительные сведения об acl см. в разделе "безопасность" пакета средств разработки Microsoft Windows Software Development Kit (SDK) и см. раздел [создание дескриптора безопасности для нового объекта](/windows/desktop/SecAuthZ/creating-a-security-descriptor-for-a-new-object-in-c--).

 

## <a name="syntax"></a>Синтаксис

``` syntax
[AMENDMENT]
class CommandLineEventConsumer : __EventConsumer
{
  uint8   CreatorSID[];
  string  MachineName;
  uint32  MaximumQueueSize;
  string  CommandLineTemplate;
  boolean CreateNewConsole = False;
  boolean CreateNewProcessGroup = True;
  boolean CreateSeparateWowVdm = False;
  boolean CreateSharedWowVdm = False;
  string  DesktopName;
  string  ExecutablePath;
  uint32  FillAttributes;
  boolean ForceOffFeedback = False;
  boolean ForceOnFeedback = False;
  uint32  KillTimeout = 0;
  string  Name;
  sint32  Priority = 0x20;
  boolean RunInteractively = False;
  uint32  ShowWindowCommand;
  boolean UseDefaultErrorMode = False;
  string  WindowTitle;
  string  WorkingDirectory;
  uint32  XCoordinate;
  uint32  XNumCharacters;
  uint32  XSize;
  uint32  YCoordinate;
  uint32  YNumCharacters;
  uint32  YSize;
  uint32  FillAttribute;
};
```

## <a name="members"></a>Члены

Класс **коммандлинивентконсумер** имеет следующие типы членов:

-   [Свойства](#properties)

### <a name="properties"></a>Элемент Property

Класс **коммандлинивентконсумер** имеет следующие свойства.

<dl> <dt>

**коммандлинетемплате**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Стандартный строковый шаблон, указывающий запускаемый процесс. Это свойство может иметь **значение NULL**, а свойство **ExecutablePath** используется в качестве командной строки.

</dd> <dt>

**креатеневконсоле**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Не используется. Если этому свойству присвоено значение, создается сообщение трассировки. Дополнительные сведения см. в разделе [Трассировка действия WMI](tracing-wmi-activity.md).

</dd> <dt>

**креатеневпроцессграуп**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если **значение — true**, новый процесс является корневым процессом новой группы процессов. Группа процессов включает все процессы, являющиеся потомками этого корневого процесса. Идентификатор процесса новой группы процессов аналогичен идентификатору этого процесса. Группы процессов используются методом [**женератеконсолектрлевент**](/windows/console/generateconsolectrlevent) , чтобы разрешить отправку сигналов CTRL + C или Ctrl + Break группе процессов консоли.

</dd> <dt>

**креатесепаратевоввдм**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если задано **значение true**, новый процесс выполняется в частной ВИРТУАЛЬНОЙ машине DOS (VDM). это допустимо только при запуске приложения, работающего в 16-разрядной Windows операционной системе. если задано значение **False**, все приложения, работающие в 16-разрядной Windows операционной системе, выполняются как потоки в одном общем виртуальном VDM. Дополнительные сведения см. в подразделе «Примечания» этого раздела.

</dd> <dt>

**креатешаредвоввдм**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если **значение — true**, метод [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) запускает новый процесс на общей ВИРТУАЛЬНОЙ машине DOS (VDM). это свойство может переопределить параметр дефаултсепаратевдм в разделе Windows Win.ini если задано значение **True**. Дополнительные сведения см. в подразделе «Примечания» этого раздела.

</dd> <dt>

**креаторсид**
</dt> <dd> <dl> <dt>

Тип данных: массив **Uint8**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Идентификатор безопасности (SID), однозначно определяющий пользователя, который создает фильтр. WMI хранит идентификатор безопасности пользователя, создающего экземпляр [**\_ \_ евентконсумер**](--eventconsumer.md) , или идентификатор безопасности администратора в зависимости от операционной системы. Дополнительные сведения см. в статьях [Привязка фильтра событий к логическому потребителю](binding-an-event-filter-with-a-logical-consumer.md) и [мониторинг и реагирование на события с помощью стандартных потребителей](monitoring-and-responding-to-events-with-standard-consumers.md).

Это свойство наследуется от [**\_ \_ евентконсумер**](--eventconsumer.md).

</dd> <dt>

**десктопнаме**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Не используется. Если этому свойству присвоено значение, создается сообщение трассировки. Дополнительные сведения см. в разделе [Трассировка действия WMI](tracing-wmi-activity.md).

</dd> <dt>

**ExecutablePath**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Выполняемый модуль. В строке можно указать полный путь и имя файла модуля для выполнения, а также указать часть имени. Если указано частичное имя, предполагается текущий диск и текущий каталог.

Свойство **ExecutablePath** может иметь **значение NULL**. В этом случае имя модуля должно быть первым пустым маркером, разделенным пробелом, в значении свойства **коммандлинетемплате** . При использовании длинного имени файла, содержащего пробел, используйте заключенные в кавычки строки, чтобы указать, где заканчивается имя файла, а аргументы начинаются для уточнения имени файла.

> [!Note]  
> Так как свойство **коммандлинетемплате** может быть шаблоном, в котором выполняемый модуль предоставляется переменной, свойство **ExecutablePath** **null** разрешает модуль, указанный в параметре, для выполнения, после чего он выходит за пределы вашего элемента управления. Всегда задавайте свойство **ExecutablePath** в регистрации **коммандлинивентконсумер** , чтобы включить необходимый исполняемый файл, что позволяет избежать перезаписи параметров событий. Если необходимо использовать шаблон и переменную для указания модуля для выполнения, будьте внимательны в том, кому предоставлены права на полную запись в пространстве имен.

 

</dd> <dt>

**филлаттрибуте**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Задает первоначальный текст и цвет фона при создании нового окна консоли в консольном приложении

</dd> <dt>

**филлаттрибутес**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: чтение и запись
</dt> </dl>

Исходные цвета текста и фона, если в консольном приложении создается новое окно консоли. Это свойство не учитывается в приложении графического пользовательского интерфейса. Значением может быть любое сочетание следующих значений.

<dt>

1 (0x1)
</dt> <dd>

синий передний план

</dd> <dt>

2 (0x2)
</dt> <dd>

Зеленый передний план

</dd> <dt>

4 (0x4)
</dt> <dd>

красный передний план

</dd> <dt>

8 (0x8)
</dt> <dd>

интенсивность переднего плана

</dd> <dt>

16 (0x10)
</dt> <dd>

синий фон

</dd> <dt>

32 (0x20)
</dt> <dd>

зеленый фон

</dd> <dt>

64 (0x40)
</dt> <dd>

красный фон

</dd> <dt>

128 (0x80)
</dt> <dd>

интенсивность фона

</dd> </dl>

Например, следующие сочетания выдают красный текст на белом фоне:


```mof
0x4 | 0x40 | 0x20 | 0x10
```



  или диспетчер конфигурации служб  


```mof
0x74
```



</dd> <dt>

**форцеофффидбакк**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если **значение — true**, курсор обратной связи принудительно отключается во время запуска процесса. Отображается стандартный курсор.

</dd> <dt>

**форцеонфидбакк**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если **значение — true**, курсор находится в режиме обратной связи в течение двух секунд после вызова [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) . В течение этих двух секунд, если процесс выполняет первый вызов графического пользовательского интерфейса, система выдает пять секунд на процесс. В течение этих пяти секунд, если в процессе отображается окно, система покажет процессу еще пять секунд на завершение рисования окна.

</dd> <dt>

**киллтимеаут**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Число (в секундах), в течение которого служба WMI ожидает перед завершением процесса 0 (нуль), что означает, что процесс не должен быть завершен. Прерывание процесса предотвращает неограниченное время выполнения процесса.

</dd> <dt>

**MachineName**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

имя компьютера, на который инструментарий управления Windows (WMI) (WMI) отправляет события.

Это свойство наследуется от [**\_ \_ евентконсумер**](--eventconsumer.md).

</dd> <dt>

**максимумкуеуесизе**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Максимальная очередь для конкретного потребителя в байтах.

Это свойство наследуется от [**\_ \_ евентконсумер**](--eventconsumer.md).

</dd> <dt>

**Имя**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> <dt>

Квалификаторы: [ **ключ**](key-qualifier.md)
</dt> </dl>

Уникальное имя потребителя.

</dd> <dt>

**Приоритет**
</dt> <dd> <dl> <dt>

Тип данных: **Sint32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Планирование уровня приоритета потоков процесса. В следующем списке перечислены доступные уровни приоритета.

<dt>

32 (0x20)
</dt> <dd>

Обозначает нормальную процедуру без необходимости планирования.

</dd> <dt>

64 (0x40)
</dt> <dd>

Обозначает процесс, потоки которого выполняются только в момент бездействия системы, и прерываются потоками любого процесса, запущенного в классе с более высоким приоритетом. Примером является экранная заставка. Класс приоритета простоя наследуется дочерними процессами.

</dd> <dt>

128 (0x80)
</dt> <dd>

Обозначает процесс, который выполняет критически важные задачи с высоким приоритетом. Потоки процесса класса с высоким приоритетом загружают потоки процессов класса с обычным приоритетом или с приоритетом простоя. Примером может быть список задач, который должен быстро реагировать при вызове пользователем, независимо от нагрузки на систему. При использовании класса с высоким приоритетом следует использовать крайне осторожно, поскольку зависящее от ЦП приложение с высокоприоритетным классом может использовать почти все доступные циклы.

</dd> <dt>

256 (0x100)
</dt> <dd>

Указывает процесс с наибольшим возможным приоритетом. Потоки процесса класса приоритета в режиме реального времени выгружают потоки всех других процессов, включая процессы операционной системы, выполняющие важные задачи. Например, процесс в режиме реального времени, который выполняется в течение более короткого интервала, может привести к тому, что кэши дисков не будут сбрасываться или заставить мышь не отвечать.

</dd> </dl>

</dd> <dt>

**рунинтерактивели**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если **значение — true**, процесс запускается в интерактивном винстатион. Если **значение равно false**, процесс запускается в службе по умолчанию винстатион. Это свойство переопределяет свойство **десктопнаме** . Это свойство используется только локально и только в том случае, если текущий пользователь является тем же пользователем, который настроил потребителя.

начиная с Windows Vista процесс, выполняющий экземпляр **коммандлинивентконсумер** , запускается под учетной записью **LocalSystem** и находится в сеансе 0. Службы, которые работают в сеансе 0, не могут взаимодействовать с пользовательскими сеансами.

</dd> <dt>

**шоввиндовкомманд**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Отображение состояния окна. Это может быть любое из значений, которое можно указать в параметре *нкмдшов* для функции [ShowWindow](/windows/desktop/api/winuser/nf-winuser-showwindow) .

</dd> <dt>

**уседефаултеррормоде**
</dt> <dd> <dl> <dt>

Тип данных: **логический**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Если задано **значение true**, используется режим ошибок по умолчанию.

</dd> <dt>

**WindowTitle**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Заголовок, отображаемый в заголовке процесса. Это свойство не учитывается для приложений графического пользовательского интерфейса.

</dd> <dt>

**WorkingDirectory**
</dt> <dd> <dl> <dt>

Тип данных: **строка**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Рабочий каталог для этого процесса.

</dd> <dt>

**кскурдинате**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Смещение по оси X (в пикселях) от левого края экрана до левого края окна, если создается новое окно.

</dd> <dt>

**кснумчарактерс**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Ширина буфера экрана в символьных столбцах, если создано новое окно консоли. Это свойство не учитывается в процессе графического пользовательского интерфейса.

</dd> <dt>

**кссизе**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Ширина (в пикселях) нового окна, если создается новое окно.

</dd> <dt>

**икурдинате**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Смещение по оси Y (в пикселях) от верхнего края экрана до верхнего края окна, если создается новое окно.

</dd> <dt>

**инумчарактерс**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Высота буфера экрана (в строках символов) при создании нового окна консоли. Это свойство не учитывается в процессе графического пользовательского интерфейса.

</dd> <dt>

**исизе**
</dt> <dd> <dl> <dt>

Тип данных: **UInt32**
</dt> <dt>

Тип доступа: только для чтения
</dt> </dl>

Высота (в пикселях) нового окна, если создается новое окно.

</dd> </dl>

## <a name="remarks"></a>Remarks

Класс **коммандлинивентконсумер** является производным от абстрактного класса [**\_ \_ евентконсумер**](--eventconsumer.md) .

Свойство **креатесепаратевоввдм** указывает, выполняется ли новый процесс в частной ВИРТУАЛЬНОЙ машине DOS (VDM). Преимущество выполнения по отдельности заключается в том, что сбой завершается только для одного VDM. программы, работающие в разных вдмс, продолжают работать в обычном режиме, а 16-разрядные Windows приложения, работающие в разных вдмс, имеют отдельные входные очереди. Это означает, что если одно приложение мгновенно перестает отвечать на запросы, приложения в разных ВДМС продолжают принимать входные данные. Недостатком выполнения по отдельности является то, что для этого требуется значительно больше памяти. этому свойству следует присвоить **значение True** , только если пользователь запрашивает выполнение 16-разрядных приложений на основе Windows в собственном виртуальном компьютере VDM.

> [!Note]  
> **Коммандлинивентконсумер** использует метод [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) для внутренних целей и передает свойства **ExecutablePath** и **коммандлинетемплате** в качестве параметров *лпаппликатионнаме* и *лпкоммандлине* . Следующий пример кода MOF-файл (MOF) не использует **коммандлинивентконсумер** правильно.

 


```mof
instance of CommandLineEventConsumer
{
  ExecutablePath = "C:\\windows\\system32\\cscript.exe";
  CommandLineTemplate = "C:\\scripts\\MyScript.js param1 param2";
};
```



Метод [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) передает *лпкоммандлине* как `argv[0]` , `argv[1]` и т. д. Так как `argv[0]` для 16-разрядных приложений используется резервное имя исполняемого файла, предыдущий код MOF создает процесс, как будто в командной строке введена следующая команда: **c: \\ Windows \\ system32 \\cscript.exe Param1 Param2**.

Предыдущая команда не выполнена, так как Cscript.exe не просматривает `argv[0]` , и поэтому не распознает, что он не содержит собственное имя, но что-то другое ("c: \\ \\ Scripts \\ \\MyScript.js"). В следующем примере определяется рекомендуемое использование **коммандлинивентконсумер**.


```mof
instance of CommandLineEventConsumer
{
  ExecutablePath = "C:\\windows\\system32\\cscript.exe";
  CommandLineTemplate = "C:\\windows\\system32\\cscript.exe"
    "C:\\scripts\\MyScript.js param1 param2";
};
```



Предыдущее использование **коммандлинивентконсумер** приводит к созданию процесса, как будто в командной строке введена следующая команда: **c: \\ Windows \\ system32 \\cscript.exe c: \\ Scripts \\MyScript.js Param1 Param2**

Так как "c: \\ \\ scripts \\ \\MyScript.js" сейчас `argv[1]` , он отображается Cscript.exe и команда выполнена.

Дополнительные сведения см. в описании функции [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) .

## <a name="examples"></a>Примеры

Пример использования **коммандлинивентконсумер** для создания потребителя см. в разделе [Запуск программы из командной строки на основе события](running-a-program-from-the-command-line-based-on-an-event.md).

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Пространство имен<br/>                | Корневая \\ Подписка<br/>                                                           |
| MOF<br/>                      | <dl> <dt>Вбемконс. mof</dt> </dl> |
| DLL<br/>                      | <dl> <dt>Wbemcons.dll</dt> </dl> |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[Классы стандартных потребителей](standard-consumer-classes.md)
</dt> <dt>

[Мониторинг событий и реагирование на них с помощью стандартных потребителей](monitoring-and-responding-to-events-with-standard-consumers.md)
</dt> <dt>

[Создание логического потребителя](creating-a-logical-consumer.md)
</dt> <dt>

[Получение событий в любое время](receiving-events-at-all-times.md)
</dt> <dt>

[**\_\_евентконсумер**](--eventconsumer.md)
</dt> </dl>

 

