---
description: При доступе к локальным или удаленным данным WMI в приложении или скрипте могут возникать ошибки от отсутствующих классов до отказа в доступе. Поставщики также имеют доступные варианты отладки и классы для устранения неполадок.
ms.assetid: b0aecdf6-ec30-49be-af4e-7eac5d124057
ms.tgt_platform: multiple
title: Устранение неполадок инструментария WMI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 94ccb8afa1af64e6eb80050c96973a9ad9456a52
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103898774"
---
# <a name="wmi-troubleshooting"></a>Устранение неполадок инструментария WMI

При доступе к локальным или удаленным данным WMI в приложении или скрипте могут возникать ошибки от отсутствующих классов до отказа в доступе. Поставщики также имеют доступные варианты отладки и классы для устранения неполадок.

> [!Note]  
> Следующая документация предназначена для разработчиков и ИТ-администраторов. Если вы являетесь пользователем, имеющим сообщение об ошибке, связанное с WMI, перейдите в [Служба поддержки Майкрософт](https://support.microsoft.com/) и найдите код ошибки, который вы видите в сообщении об ошибке. Дополнительные сведения об устранении неполадок со сценариями WMI и службой WMI см. в разделе [инструментарий WMI не работает.](/previous-versions/tn-archive/ff406382(v=msdn.10))

 

## <a name="wmi-diagnosis-utility"></a>служебная программа для диагностики WMI

Программа диагностики WMI (WMIDiag.exe) больше не поддерживается начиная с Windows 8 и Windows Server 2012.

* * Windows 7, Windows Server 2008 R2, Windows Vista и Windows Server 2008: * *

Если инструментарий WMI возвращает сообщения об ошибках, имейте в виду, что они могут не указывать на проблемы в службе WMI или в поставщиках WMI. Сбои могут исходить из других частей операционной системы и возникать как ошибки через инструментарий WMI. При любых обстоятельствах не удаляйте репозиторий WMI как первое действие, поскольку удаление репозитория может привести к повреждению системы или установке приложений.

Чтобы получить дополнительные сведения об источнике проблемы, скачайте и запустите программу командной строки для диагностики [служебная программа для диагностики WMI](https://www.microsoft.com/downloads/en/details.aspx?familyid=d7ba3cd6-18d1-4d05-b11e-4c64192ae97d&displaylang=en) . Это средство создает отчет, который обычно может изолировать источник проблемы и предоставить инструкции по ее устранению. Этот отчет также помогает в работе со службой поддержки Майкрософт. Служебная программа для диагностики WMI можно загрузить в [центре загрузки](https://www.microsoft.com/downloads/details.aspx?FamilyID=d7ba3cd6-18d1-4d05-b11e-4c64192ae97d).

Модули записи поставщика также могут столкнуться с проблемами отладки, если не выполняется запись [*несвязанного поставщика*](gloss-d.md). Дополнительные сведения см. в разделе [службы отладки](debugging-providers.md).

## <a name="logging-and-tracing"></a>Ведение журнала и трассировка

Файлы журналов WMI больше не существуют; они были заменены функцией [трассировки событий для Windows (ETW)](/windows/desktop/ETW/event-tracing-portal). Дополнительные сведения см. в статьях [Трассировка действий WMI](tracing-wmi-activity.md), [ведение журнала действий WMI](logging-wmi-activity.md)и [файлы журналов WMI](wmi-log-files.md).

## <a name="troubleshooting-in-scripts-and-applications"></a>Устранение неполадок в скриптах и приложениях

Инструментарий WMI содержит набор классов для [устранения неполадок](wmi-troubleshooting-classes.md) клиентских приложений, использующих поставщики WMI. Дополнительные сведения см. в разделе [Устранение неполадок клиентских приложений WMI](troubleshooting-wmi-client-applications.md).

## <a name="how-provider-writers-can-prevent-wmi-problems"></a>Как модули записи поставщика могут предотвратить проблемы WMI

Модули записи поставщика могут предотвращать многие проблемы, которые отображаются в сообщениях об ошибках через WMI, выполняя следующие действия.

-   Правильная регистрация поставщика. Дополнительные сведения см. [в разделе Регистрация поставщика](registering-a-provider.md).
-   Добавление инструкции [**\# pragma автосохранения**](pragma-autorecover.md) в файл MOF-файл (MOF), который определяет классы поставщиков.

Дополнительные сведения см. в статьях [поставщики отладки](debugging-providers.md), [предоставление данных WMI](providing-data-to-wmi.md), [Настройка поставщика и устранение неполадок](provider-configuration-and-troubleshooting-classes.md).

## <a name="access-denied"></a>доступ запрещен

Ошибки доступа, о которых сообщает скрипты и приложения, обращающиеся к пространствам имен WMI, обычно делятся на три категории. В следующей таблице перечислены три категории ошибок, а также проблемы, которые могут привести к ошибкам и возможным решениям.



| Ошибка                                                                                                                        | Возможные проблемы                                                                                                                                                                                                                                                                                                                                                                     | Решение                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0x800706BA `HRESULT_FROM_WIN32(RPC_S_SERVER_UNAVAILABLE)`<br/> Ошибка брандмауэра или сервер недоступен.<br/>      | На самом деле компьютер не существует, брандмауэр Windows блокирует подключение.<br/>                                                                                                                                                                                                                                                                                        | Подключение к Vista: **netsh advfirewall firewall set Rule Group = "Инструментарий управления Windows (WMI)" новое включение = да** подключение к предыдущей версии: разрешить правило "удаленное администрирование" в брандмауэре Windows.<br/>                                                                                                                                                                                                                                                                                                            |
| **\_ \_ отказано в доступе к** 0x80070005<br/> Отказано в доступе по безопасности DCOM.<br/>                                       | Пользователь не имеет удаленного доступа к компьютеру через DCOM. Как правило, при подключении к удаленному компьютеру с другой версией операционной системы возникают ошибки DCOM.<br/>                                                                                                                                                                                          | Предоставьте пользователю разрешения на удаленный запуск и удаленную активацию в DCOMCNFG. Щелкните правой кнопкой мыши Мой компьютер-> свойства. В разделе Безопасность COM щелкните "изменить ограничения" для обоих разделов. Предоставьте пользователю возможность удаленного доступа, удаленного запуска и удаленной активации. Затем перейдите в конфигурацию DCOM, найдите "инструментарий управления Windows (WMI)" и предоставьте пользователю возможность удаленного запуска и удаленной активации. Дополнительные сведения см. в разделе [подключение между разными операционными системами](/windows/desktop/WmiSdk/troubleshooting-a-remote-wmi-connection) .<br/> |
| **\_ \_ \_ отказано в доступе к 0x80041003 WBEM**<br/> Доступ запрещен [ *поставщиком*](gloss-p.md)<br/> | У пользователя нет разрешения на выполнение этой операции в WMI. Это может произойти при запросе определенных классов в качестве пользователя с минимальными правами, но чаще всего это происходит при попытке вызвать методы или изменить экземпляры WMI как пользователя с низким уровнем прав. Пространство имен, к которому вы подключаетесь, шифруется, и пользователь пытается подключиться к незашифрованному соединению.<br/> | Предоставьте пользователю доступ к элементу управления WMI (убедитесь, что у него \_ установлено значение true) Connect с помощью клиента, поддерживающего шифрование.<br/>                                                                                                                                                                                                                                                                                                                                                                                  |



 

-   Как правило, при подключении к удаленному компьютеру с другой версией операционной системы возникают ошибки DCOM.

-   Поставщики также могут запрещать доступ к данным в определенных пространствах имен или могут требовать определенных уровней безопасности подключения. Дополнительные сведения см. в разделе [Установка клиентских приложений безопасность](setting-client-application-process-security.md) и [Размещение поставщика и безопасность](provider-hosting-and-security.md).

-   Ошибки отказа в доступе из изменений брандмауэра подключения к Интернету (ICF).

    Дополнительные сведения см. в разделе [подключение через брандмауэр Windows](/windows/desktop/WmiSdk/connecting-to-wmi-remotely-starting-with-vista).

-   Безопасность DCOM возвращает ошибку отказа в доступе, когда клиент с низкой целостностью пытается получить доступ к инструментарию WMI. Например, элемент управления ActiveX, работающий в Internet Explorer, уровень безопасности которого имеет значение Low, не имеет доступа для выполнения локальных операций WMI.

    **Windows 7:** Пользователи с низкой целостностью имеют разрешения только на чтение для локальных операций WMI.

## <a name="information-on-errors"></a>Сведения об ошибках

При получении сообщения об ошибке из инструментария WMI можно найти сообщение в [**константах ошибки WMI**](wmi-error-constants.md) или, для сценариев, [**вбемерроренум**](/windows/desktop/api/Wbemdisp/ne-wbemdisp-wbemerrorenum). Однако сведения, предоставляемые только ошибкой, обычно недостаточно для определения того, что происходит. Повреждение репозитория WMI может быть замаскировано в качестве классов или экземпляров "не найдено".

Дополнительные сведения об ошибках WMI:

-   Журналы WMI записывают события из ядра WMI и из поставщиков. Дополнительные сведения см. в разделе [ведение журнала действий WMI](logging-wmi-activity.md).
-   Используйте [классы устранения неполадок WMI](wmi-troubleshooting-classes.md) для проверки внутреннего состояния WMI или получения уведомлений о событиях поставщика или службы WMI. Дополнительные сведения см. в разделе [классы конфигурации и устранения неполадок поставщика](provider-configuration-and-troubleshooting-classes.md) и [Устранение неполадок клиентских приложений WMI](troubleshooting-wmi-client-applications.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[Устранение неполадок WMI](wmi-troubleshooting.md).
</dt> <dt>

[Трассировка действий WMI](tracing-wmi-activity.md)
</dt> <dt>

[Ведение журнала действий WMI](logging-wmi-activity.md)
</dt> </dl>

 

