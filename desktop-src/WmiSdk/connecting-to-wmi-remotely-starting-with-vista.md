---
description: Для подключения к пространству имен WMI на удаленном компьютере может потребоваться изменить параметры брандмауэра Windows, контроля учетных записей пользователей (UAC), DCOM или диспетчера объектов модель CIM (CIMOM).
ms.assetid: 028b3101-0945-4288-bf32-ef4ad12a55f9
ms.tgt_platform: multiple
title: Настройка удаленного WMI-подключения
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 6ee254e12ecd806cd286d4a55746e203a3136b6c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104544847"
---
# <a name="setting-up-a-remote-wmi-connection"></a>Настройка удаленного WMI-подключения

Для подключения к пространству имен WMI на удаленном компьютере может потребоваться изменить параметры [брандмауэра Windows](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754274(v=ws.11)), [контроля учетных записей пользователей (UAC)](/previous-versions/aa905108(v=msdn.10)), DCOM или ДИСПЕТЧЕРА объектов модель CIM (CIMOM).

В этом разделе обсуждаются следующие разделы:

-   [Параметры брандмауэра Windows](#windows-firewall-settings)
-   [Параметры контроля учетных записей](#user-account-control-settings)
-   [Параметры DCOM](#dcom-settings)
-   [Параметры CIMOM](#cimom-settings)
-   [См. также](#related-topics)

## <a name="windows-firewall-settings"></a>Параметры брандмауэра Windows

Параметры WMI для параметров брандмауэра Windows позволяют использовать только подключения WMI, а не другие приложения DCOM.

Необходимо задать исключение в брандмауэре для инструментария WMI на удаленном целевом компьютере. Исключение для WMI позволяет инструментарию WMI принимать удаленные подключения и асинхронные обратные вызовы для Unsecapp.exe. Дополнительные сведения см. [в разделе Настройка безопасности при асинхронном вызове](setting-security-on-an-asynchronous-call.md).

Если клиентское приложение создает собственный приемник, этот приемник необходимо явно добавить в исключения брандмауэра, чтобы разрешить успешные обратные вызовы.

Исключение для WMI также работает, если Инструментарий WMI запущен с фиксированным портом с помощью команды **Winmgmt/стандалонехост** . Дополнительные сведения см. [в разделе Настройка фиксированного порта для WMI](setting-up-a-fixed-port-for-wmi.md).

Вы можете включить или отключить трафик WMI с помощью пользовательского интерфейса брандмауэра Windows.

**Включение или отключение трафика WMI с помощью пользовательского интерфейса брандмауэра**

1.  На **панели управления** щелкните **Безопасность** , а затем — **Брандмауэр Windows**.
2.  Щелкните **изменить параметры** , а затем перейдите на вкладку **исключения** .
3.  В окне Исключения установите флажок для **инструментарий управления Windows (WMI) (WMI)** , чтобы включить трафик WMI через брандмауэр. Чтобы отключить трафик WMI, снимите флажок.

Вы можете включить или отключить трафик WMI через брандмауэр в командной строке.

**Включение или отключение трафика WMI в командной строке с помощью группы правил WMI**

-   Используйте следующие команды в командной строке. Введите следующую команду, чтобы включить трафик WMI через брандмауэр.

    **netsh advfirewall firewall set Rule Group = "Инструментарий управления Windows (WMI)" новое включение = да**

    Введите следующую команду, чтобы отключить трафик WMI через брандмауэр.

    **netsh advfirewall firewall set Rule Group = "Инструментарий управления Windows (WMI)" новое включение = нет**

Вместо использования одной команды группы правил WMI можно также использовать отдельные команды для каждой DCOM, службы WMI и приемника.

**Включение трафика WMI с помощью отдельных правил для DCOM, WMI, приемника обратного вызова и исходящих подключений**

1.  Чтобы установить исключение брандмауэра для порта DCOM 135, используйте следующую команду.

    **netsh advfirewall Firewall добавить правило dir = in Name = "DCOM" Program =% systemroot% \\ system32 \\svchost.exe Service = RPCSS Action = Allow Protocol = TCP localPort = 135**

2.  Чтобы установить исключение брандмауэра для службы WMI, используйте следующую команду.

    **netsh advfirewall Firewall Add правило dir = in Name = "WMI" Program =% системный_корневой_каталог% \\ system32 \\svchost.exe Service = Winmgmt Action = Allow Protocol = TCP localPort = Any**

3.  Чтобы установить исключение брандмауэра для приемника, который получает обратные вызовы с удаленного компьютера, используйте следующую команду.

    **netsh advfirewall Firewall добавить правило dir = in имя = "Унсекапп" Program =% systemroot% \\ system32 \\ WBEM \\unsecapp.exe действие = разрешить**

4.  Чтобы установить исключение брандмауэра для исходящих подключений к удаленному компьютеру, с которым локальный компьютер обменивается данными в асинхронном режиме, используйте следующую команду.

    **netsh advfirewall Firewall добавить правило DIR = OUT имя = "WMI \_ out" программа =% SystemRoot% \\ system32 \\svchost.exe служба = Winmgmt Action = разрешить протокол = TCP localPort = Any**

Чтобы отключить исключения брандмауэра по отдельности, используйте следующие команды.

**Отключение трафика WMI с помощью отдельных правил для DCOM, WMI, приемника обратного вызова и исходящих подключений**

1.  Для отключения исключения DCOM.

    **netsh advfirewall Firewall Delete Rule Name = "DCOM"**

2.  Для отключения исключения службы WMI.

    **netsh advfirewall Firewall Delete Rule Name = "WMI"**

3.  Для отключения исключения приемника.

    **netsh advfirewall Firewall Delete Rule Name = "Унсекапп"**

4.  , Чтобы отключить исходящее исключение.

    **netsh advfirewall Firewall удаление правила Name = "WMI \_ out"**

## <a name="user-account-control-settings"></a>Параметры контроля учетных записей

Управление учетными записями пользователей (UAC) — фильтрация маркеров может влиять на то, какие операции разрешены в пространствах имен WMI или какие данные возвращаются. В разделе UAC все учетные записи в локальной группе "Администраторы" выполняются с [*маркером доступа*](/windows/desktop/SecGloss/a-gly)обычного пользователя, также известным как фильтрация маркера доступа UAC. Учетная запись администратора может выполнять скрипт с повышенными привилегиями — "Запуск от имени администратора".

При отсутствии подключения к встроенной учетной записи администратора UAC влияет на подключения к удаленному компьютеру по-разному в зависимости от того, находятся ли два компьютера в домене или рабочей группе. Дополнительные сведения об UAC и удаленных подключениях см. в разделе [Управление учетными записями пользователей и инструментарий WMI](user-account-control-and-wmi.md).

## <a name="dcom-settings"></a>Параметры DCOM

Дополнительные сведения о параметрах DCOM см. в разделе [Защита удаленного WMI-подключения](securing-a-remote-wmi-connection.md). Однако UAC влияет на подключения для недоменных учетных записей пользователей. При подключении к удаленному компьютеру с использованием недоменной учетной записи пользователя, входящей в локальную группу администраторов удаленного компьютера, необходимо явным образом предоставить учетной записи права удаленного доступа DCOM, активации и запуска.

## <a name="cimom-settings"></a>Параметры CIMOM

Необходимо обновить параметры CIMOM, если удаленное подключение установлено между компьютерами, не имеющими отношения доверия. в противном случае асинхронное соединение завершится ошибкой. Этот параметр не следует изменять для компьютеров в том же домене или в доверенных доменах.

Чтобы разрешить анонимный обратный вызов, необходимо изменить следующую запись реестра:

**HKey \_ \_** \\ **Программное обеспечение** локального компьютера \\ **Microsoft** \\ **WBEM** \\ **CIMOM** \\ **аллованонимаускаллбакк**<dl> <dt>

               Data type
</dt> <dd>               REG \_ DWORD</dd> </dl>

Если значение **аллованонимаускаллбакк** равно 0, то служба WMI предотвращает анонимный обратный вызов клиента. Если значение равно 1, служба WMI разрешает клиенту анонимные обратные вызовы.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Подключение к инструментарию WMI на удаленном компьютере](connecting-to-wmi-on-a-remote-computer.md)
</dt> </dl>

 

 
