---
description: Содержит правила сопоставления классов WMI с Active Directory.
ms.assetid: 295d3233-5729-4eb0-9fa3-1cf64fef2909
ms.tgt_platform: multiple
title: Сопоставление классов Active Directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bc38e91d52b59a206a0b64465d0f9710f6d515c9487853824477b7f4f6a126aa
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118992904"
---
# <a name="mapping-active-directory-classes"></a>Сопоставление классов Active Directory

Поскольку Active Directory имеет широкий спектр возможных объектов, Инструментарий WMI не может создать прямое сопоставление «один к одному». Вместо этого поставщик служб каталогов использует правила для сопоставления классов между двумя технологиями.

В этом разделе рассматриваются следующие подразделы:

-   [Классы сопоставления](#mapping-classes)
-   [Сопоставление атрибутов](#mapping-attributes)
-   [Классы ассоциаций](#association-classes)

> [!Note]  
> Дополнительные сведения о поддержке и установке этого компонента в определенной операционной системе см. в статье [доступность компонентов WMI в операционной системе](operating-system-availability-of-wmi-components.md).

 

## <a name="mapping-classes"></a>Классы сопоставления

В следующем списке описываются рекомендации, которые поставщик служб каталогов использует для соответствия классов Active Directory классам WMI:

-   Каждый абстрактный класс в схеме Active Directory сопоставляется с одним абстрактным классом в схеме WMI.

    В схеме WMI каждый абстрактный класс имеет префикс DS \_ . Например, класс **Person** из схемы Active Directory сопоставляется с классом WMI **\_ Person лица DS** .

-   Каждый неабстрактный класс из схемы Active Directory сопоставляется со следующими двумя классами в схеме WMI:

    -   Первый сопоставленный класс имеет префикс ADS \_ . Это абстрактные классы, которые сопоставляются в соответствии с приведенными ниже правилами.
    -   Второй сопоставленный класс является неабстрактным классом с \_ префиксом имени DS. Этот класс является производным от \_ абстрактного класса ADS с добавлением квалификатора [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) .

    Например, класс **User** из схемы Active Directory сопоставляется с двумя классами. Первым классом является абстрактный класс **ADS \_** , сопоставленный в соответствии с правилами ниже. Второй класс является неабстрактным классом **\_ пользователя DS** . Он является производным **от \_ пользователя ADS** и имеет добавленный квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) .

-   Если не указано иное, имя сопоставленного класса является искаженным значением свойства **LDAP-отображаемое имя** в классе Active Directory.
-   Если в классе Active Directory имеется свойство **подкласса** , то сопоставленный WMI класс является производным от указанного класса.

    Если свойство **подкласса** не задано, то сопоставляемый WMI класс является производным от класса **\_ \_ корневого \_ класса DS LDAP** , как указано в MOF-файле.

    > [!Note]  
    > Этот класс имеет свойство ключа **адсипас** с типом **VT \_ BSTR**. Это уникальный путь ADSI, идентифицирующий этот экземпляр. Active Directory поддерживает только одно наследование, поэтому это работает.

     

-   Для каждого класса создается **динамический** квалификатор типа **VT \_ bool**, а флаг Set имеет значение `WBEM_FLAVOR_FLAG_PROPAGATE_TO_INSTANCE | WBEM_FLAVOR_FLAG_PROPAGATE_TO_DERIVED_CLASS` **true** . Это Стандартный квалификатор WMI, указывающий, что экземпляры этого класса предоставляются динамически.
-   Если класс не является абстрактным, поставщик создает квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) типа " **VT \_ BSTR bool** " и флаг квалификатора `WBEM_FLAVOR_FLAG_PROPAGATE_TO_INSTANCE | WBEM_FLAVOR_FLAG_PROPAGATE_TO_DERIVED_CLASS` "поставщик экземпляра DS" для каждого класса. Это Стандартный квалификатор WMI, указывающий имя поставщика, динамически предоставляющее экземпляры этого класса.

Остальные свойства ADSI сопоставляются с квалификаторами и свойствами класса в соответствии со следующими таблицами. Все квалификаторы сопоставляются со значением флага квалификатора `WBEM_FLAVOR_FLAG_PROPAGATE_TO_INSTANCE | WBEM_FLAVOR_FLAG_PROPAGATE_TO_DERIVED_CLASS` .

Ниже перечислены сведения о сопоставлении для класса Active Directory, в котором показаны квалификатор WMI и тип квалификатора WMI для каждого свойства Active Directory.

<dl> <dt>

**Common-Name**
</dt> <dd>

**CN** (**VT \_ BSTR**)

Сопоставляется непосредственно со строковым значением.

</dd> <dt>

**По умолчанию — объект — Категория**
</dt> <dd>

**Дефаултобжекткатегори** (**VT \_ BSTR**)

Сопоставляется непосредственно со строковым значением.

</dd> <dt>

**Дескриптор безопасности по умолчанию**
</dt> <dd>

**Дефаултсекуритидескриптор** (**VT \_ BSTR**)

Сопоставляется непосредственно со строковым значением.

</dd> <dt>

**Идентификатор, управляющий**
</dt> <dd>

**GovernsId** (**VT \_ BSTR**)

Сопоставляется из строкового представления OID; Например, "{1 3 3 6}".

</dd> <dt>

**Объектный класс**
</dt> <dd>

Н/Д

Не сопоставлено.

</dd> <dt>

**Объект-класс-категория**
</dt> <dd>

**ObjectClassCategory** (**VT \_ I4**)

Сопоставляется непосредственно с целочисленным значением. Кроме того, если значение является абстрактным (2), то также создается стандартный квалификатор CIM **\_ логического типа VT** , называемый **"абстрактным"** квалификатором.

</dd> <dt>

**RDN-АТРИ-ID**
</dt> <dd>

**рднаттид** (**VT \_ BSTR**)

Сопоставляется из строкового представления значения OID; Например, "{1 3 3 6}". Кроме того, указанное здесь свойство помечено как стандартный **индексированный** квалификатор CIM со значением **true**.

</dd> <dt>

**Только система**
</dt> <dd>

**Системонли** (**\_ логическое значение VT**)

Сопоставляется непосредственно с логическим значением.

</dd> </dl>

 

Ниже перечислены свойства класса Active Directory, сопоставленные со свойствами класса WMI.

<dl> <dt>

**Может содержать**
</dt> <dd>

Каждое свойство в этом списке сопоставляется со свойством WMI.

</dd> <dt>

**Должен содержать**
</dt> <dd>

Каждое свойство в этом списке сопоставляется со свойством WMI. Для каждого из них создается стандартный квалификатор CIM, **отличный от \_ null** .

</dd> <dt>

**System — может содержать**
</dt> <dd>

Каждое свойство в этом списке сопоставляется со свойством WMI. Кроме того, каждое свойство дополняется квалификатором **системы** и устанавливается в **значение true**.

</dd> <dt>

**System — должно содержать**
</dt> <dd>

Каждое свойство в этом списке сопоставляется со свойством WMI. Для каждого из них создается стандартный квалификатор CIM, **отличный от \_ null** . Кроме того, каждое свойство дополняется квалификатором **системы** и устанавливается в **значение true**.

</dd> </dl>

## <a name="mapping-attributes"></a>Сопоставление атрибутов

Поставщик служб каталогов сопоставляет каждый атрибут класса Active Directory только с одним свойством соответствующего класса WMI в соответствии с правилами в этом разделе. Как правило, поставщик служб каталогов именует свойство WMI как искаженную версию значения **LDAP-отображаемого имени** атрибута Active Directory.

Если Active Directory свойство **имеет** **значение false**, то это свойство WMI объединяется с оператором или с **\_ \_ массивом флагов CIM**. Обратите внимание, что каждое свойство помечено квалификатором **VT \_ BSTR** , **адсинтакс**. Он представляет базовый синтаксис Active Directory.

В следующей таблице приведено сопоставление синтаксиса Active Directory с типом данных свойства WMI.



| Active Directory, элемент                                      | Тип данных WMI                                                           |
|---------------------------------------------------------------|-------------------------------------------------------------------------|
| [**Точка доступа**](/windows/desktop/ADSchema/s-object-access-point)            | **\_строка CIM**                                                         |
| [**Логическое**](/windows/desktop/ADSchema/s-boolean)                             | **\_логическое значение CIM**                                                        |
| **Строка без учета регистра**                                   | **\_строка CIM**                                                         |
| [**Строка с учетом регистра**](/windows/desktop/ADSchema/s-string-case-sensitive) | **\_строка CIM**                                                         |
| [**Различающееся имя**](/windows/desktop/ADSchema/s-object-ds-dn)             | **\_строка CIM**                                                         |
| [**DN — двоичные данные**](/windows/desktop/ADSchema/s-object-dn-binary)                  | Внедренный объект класса **DN \_ с \_ двоичными данными** , определенными ниже.<br/> |
| [**DN-строка**](/windows/desktop/ADSchema/s-object-dn-string)                  | Внедренный объект класса **DN \_ со \_ строкой** , определенной ниже.<br/> |
| [**Перечисление**](/windows/desktop/ADSchema/s-enumeration)                     | **\_SINT32 CIM**                                                         |
| [**Перечисление**](/windows/desktop/ADSchema/s-enumeration)                     | **\_строка CIM**                                                         |
| [**Целочисленный тип**](/windows/desktop/ADSchema/s-integer)                             | **\_SINT32 CIM**                                                         |
| [**ларжеинтежер**](/windows/desktop/ADSchema/s-largeinteger)                   | **\_строка CIM**                                                         |
| Дескриптор безопасности                                           | Внедренный объект класса **Uint8Array** , определенный ниже.<br/>       |
| Числовая строка                                                | **\_строка CIM**                                                         |
| Идентификатор объекта                                                     | **\_строка CIM**                                                         |
| Строка октета                                                  | Внедренный объект класса **Uint8Array** , определенный ниже.<br/>       |
| ИЛИ имя                                                       | **\_строка CIM**                                                         |
| Presentation-Address                                          | Внедренный объект класса **Uint8Array** , определенный ниже.<br/>       |
| Строка варианта печати                                             | **\_строка CIM**                                                         |
| Ссылка на реплику                                                  | Внедренный объект класса **Uint8Array** , определенный ниже.<br/>       |
| [**Строка (SID)**](/windows/desktop/ADSchema/s-string-sid)                      | Внедренный объект класса **Uint8Array** , определенный ниже.<br/>       |
| Time                                                          | **\_Дата и время CIM**                                                       |
| Время кодирования в формате UTC                                                | **\_Дата и время CIM**                                                       |
| Строка в Юникоде                                                | **\_строка CIM**                                                         |



 

Синтаксис строки октета, который ссылается на массив значений **Uint8** , представляет проблему при сопоставлении с WMI, поскольку Инструментарий WMI допускает свойства типа **Uint8** и массивы **Uint8**, тогда как Active Directory допускает свойства типа String октета, а также массивы строк октета.

В следующем примере показан класс поставщика служб каталогов, который используется для отображения массива свойств типа строки октета.

``` syntax
Class Uint8Array 
{
    uint8 values[];
    uint32 numberOfValues;
};
```

WMI сопоставляет все строки октета Active Directory значения свойств с внедренными экземплярами **Uint8Array**. Аналогичным образом WMI сопоставляет массивы строк октета с массивами внедренных объектов **Uint8Array** .

В следующем примере показаны классы, сопоставленные инструментарием WMI для DN-Binary и DN-String значений свойств DS.

``` syntax
Class DN_With_String
{
    string dnString;
    string value;
};

Class DN_With_Binary
{
    string dnString;
    uint8 value[];
};
```

В следующей таблице показано, как WMI сопоставляет остальные свойства интерфейса Active Directory атрибутов с квалификаторами свойств WMI.



| Атрибут Active Directory — имя свойства | Квалификатор WMI       | Тип данных    | Сведения о сопоставлении                               |
|------------------------------------------|---------------------|--------------|---------------------------------------------------|
| **Синтаксис атрибута**                     | **AttributeSyntax** | **VT \_ BSTR** | Сопоставляется из строкового представления OID. |
| **Common-Name**                          | **CN**              | **VT \_ BSTR** | Сопоставляется со строковым значением.                     |
| **Только система**                          | **Система**          | **Логическое значение VT \_** | Сопоставляется из логического значения.                    |



 

> [!Note]  
> WMI сопоставляет все квалификаторы Active Directory с `WBEM_FLAVOR_FLAG_PROPAGATE_TO_INSTANCE | WBEM_FLAVOR_FLAG_PROPAGATE_TO_DERIVED_CLASS` разновидностями квалификаторов.

 

## <a name="association-classes"></a>Классы ассоциаций

Служба каталогов по сути является иерархическим хранилищем объектов. Эти объекты, которые могут отображаться на неконечном уровне иерархии, называются контейнерами. Структура этой иерархии дополнительно управляется свойствами "ПОСС-старший" и "System-ПОСС-превосходно" класса в схеме. Вместе они указывают набор классов, экземпляры которых могут содержаться в экземпляре класса контейнера.

В приведенном ниже примере моделируется Ассоциация CIM как экземпляры [**\_ \_ \_ вложенности класса**](/previous-versions/windows/desktop/dsprov/ds-ldap-class-containment)static класса Association DS.

``` syntax
//  DS Class Associations Provider 

// Create a class of which instances are
// provided by this provider

[
  Association : ToInstance,
  dynamic,
  HasClassRefs,
  Provider("Microsoft|DSLDAPClassAssociationProvider|V1.0")
]
class DS_LDAP_Class_Containment
{
    [key, classref{"DS_LDAP_Root_Class"} : ToInstance ToSubClass]
    object Ref ChildClass;

    [key, classref{"DS_LDAP_Root_Class"} : ToInstance ToSubClass] 
    object Ref ParentClass; // The parent DS Class
};


// Create an instance of the provider class for registration
instance of __Win32Provider as $AssociationsProvider
{
    Name = "Microsoft|DSLDAPClassAssociationProvider|V1.0";
    Clsid = "{33831ED4-42B8-11d2-93AD-00805F853771}";
    ImpersonationLevel = 1;
};    

// Specification of the instances and operation
// provided by the provider
instance of __InstanceProviderRegistration
{
    Provider = $AssociationsProvider;
    SupportsGet = TRUE;
    SupportsPut = FALSE;
    SupportsDelete = FALSE;
    SupportsEnumeration = TRUE;
};
```

Поставщик класса взаимосвязей поддерживает методы [**жетобжектасинк**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-getobjectasync) и [**креатеклассенумасинк**](/windows/desktop/api/WbemCli/nf-wbemcli-iwbemservices-createclassenumasync) .

 

