---
description: Начиная с Windows Vista, служба WMI не использует файлы журнала WMI. Вместо этого он использует трассировку событий для Windows (ETW) и события, доступные с помощью Просмотр событий или программы командной строки wevtutil.
ms.assetid: bb6401e8-caf7-4f39-ab64-b7532723ce9a
ms.tgt_platform: multiple
title: Трассировка действий WMI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14371a4f18b81019073cd2b428500b12385719e4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103815697"
---
# <a name="tracing-wmi-activity"></a>Трассировка действий WMI

Начиная с Windows Vista, служба WMI не использует [файлы журнала WMI](wmi-log-files.md). Вместо этого он использует [трассировку событий для Windows (ETW)](/windows/desktop/ETW/event-tracing-portal) и события, доступные с помощью **Просмотр событий** или программы командной строки wevtutil.

В этом разделе обсуждаются следующие разделы:

-   [Получение событий WMI с помощью Просмотр событий](#obtaining-wmi-events-through-event-viewer)
-   [Включение трассировки WMI в командной строке](#enabling-wmi-tracing-at-command-prompt)
-   [Использование трассировки WMI на основе WPP](#using-wpp-based-wmi-tracing)
-   [См. также](#related-topics)

## <a name="obtaining-wmi-events-through-event-viewer"></a>Получение событий WMI с помощью Просмотр событий

Файл ВмитраЦинг. log содержит события, которые отслеживаются WMI. Однако это двоичный файл. Чтобы просмотреть эти события в формате, читаемом людьми, используйте **Просмотр событий**.

По умолчанию события WMI не отслеживаются. В этой процедуре описывается использование **Просмотр событий** для включения трассировки событий WMI и нахождение событий WMI. Те же операции можно выполнить с помощью программы командной строки wevtutil.

**Просмотр событий WMI в Просмотр событий**

1.  Откройте средство **просмотра событий**. В меню **вид** выберите команду **Показать журналы аналитики и отладки**. Выберите журнал канала **трассировки** для инструментария WMI в разделе приложения и службы журналы \| \| действие Microsoft Windows \| WMI.
2.  Щелкните правой кнопкой мыши журнал **трассировки** и выберите пункт **Свойства журнала**. Установите флажок **включить ведение журнала** , чтобы запустить трассировку событий WMI. Дополнительные сведения о каналах см. [в разделе журналы событий и каналы в журнале событий Windows](/previous-versions//aa385225(v=vs.85)).
3.  События WMI отображаются в окне событий для **WMI-Activity**. Дважды щелкните событие в списке, чтобы просмотреть подробные сведения. Событие можно просмотреть в **представлении XML** или в **удобном** для просмотра формате.

В поле **Event ID (идентификатор события** ) отображается значение, содержащее следующие сведения.

<dl> <dt>

<span id="Event_1"></span><span id="event_1"></span><span id="EVENT_1"></span>Событие 1
</dt> <dd>

Начало последовательности событий для определенной операции. Одно вхождение для каждой последовательности.

Поля событий для события 1:

-   **Граупоператионид** — это уникальный идентификатор, используемый для всех событий, сообщаемых для конкретного клиента.
-   Идентификатор **операции указывает на** последовательность операций.
-   **Операция** указывает соединение или запрос к инструментарию WMI.
-   **Пользователь** указывает учетную запись, которая выполняет запрос к WMI, запустив сценарий или CIM Studio.
-   **Пространство имен** отображает пространство имен WMI, в которое устанавливается соединение.

Например, скрипт может запросить все экземпляры класса WMI, например [**\_ службу Win32**](/windows/desktop/CIMWin32Prov/win32-service). Первая операция может быть соединением с WMI.

</dd> <dt>

<span id="Event_2"></span><span id="event_2"></span><span id="EVENT_2"></span>Событие 2
</dt> <dd>

События, составляющие операцию. Одно или несколько вхождений в последовательности.

Поля событий для события 2:

-   **Граупоператионид** указывает последовательность, в которой происходит событие.
-   **Граупоператионид** указывает последовательность, в которой происходит событие.
-   **ProviderName** указывает имя поставщика, предоставляющего данные.
-   **Path** — это WMI-путь к объекту.

Например, операция может быть перечислением [**\_ службы Win32**](/windows/desktop/CIMWin32Prov/win32-service).

</dd> <dt>

<span id="Event_3"></span><span id="event_3"></span><span id="EVENT_3"></span>Событие 3
</dt> <dd>

Конец последовательности событий для определенной операции. Одно вхождение для каждой последовательности.

Отображается только **граупоператионид** .

</dd> </dl>

## <a name="enabling-wmi-tracing-at-command-prompt"></a>Включение трассировки WMI в командной строке

Можно также включить трассировку событий WMI с помощью программы командной строки wevtutil. Используйте следующую команду: **Wevtutil.exe SL Microsoft-Windows-WMI-Activity/Trace/e: true**. Источником событий WMI является Microsoft-Windows-WMI. Дополнительные сведения о Wevtutil.exe см. в статье [о журнале событий Windows](/previous-versions//aa382610(v=vs.85)).

## <a name="using-wpp-based-wmi-tracing"></a>Использование трассировки WMI на основе WPP

В операционных системах Windows, начиная с Windows Vista, Инструментарий WMI создает активный канал трассировки во время процесса загрузки. Имя канала — \_ сеанс трассировки WMI \_ . В канал записываются только ошибки.

Препроцессор трассировки программного обеспечения Windows записывает сведения в двоичный файл. Для чтения файла необходимо сначала преобразовать его в текстовый формат для чтения. Для перевода используется средство с именем tracefmt.exe из [набора драйверов Windows (WDK)](https://www.microsoft.com/whdc/DevTools/WDK/WDKpkg.mspx) . Для этого средства требуются сведения, хранящиеся в некоторых связанных файлах. Файлы находятся в каталоге% SystemRoot% \\ system32 \\ WBEM \\ ТМФ и имеют расширение имени файла ТМФ. Для этого средства требуется один ТМФ-файл. Чтобы сделать этот файл, объедините все ТМФ файлы в другой файл ТМФ. Дополнительные сведения о файлах. ТМФ см. в разделе [файл форматирования сообщений трассировки](/windows-hardware/drivers/devtest/trace-message-format-file).

После установки [набора драйверов Windows (WDK)](https://www.microsoft.com/whdc/DevTools/WDK/WDKpkg.mspx) для получения tracelog.exe и tracefmt.exe программ командной строки выполните следующие действия, чтобы получить трассировку WMI на основе WPP.

**Просмотр трассировки WMI на основе WPP**

1.  Чтобы создать отдельный файл ТМФ, откройте окно командной строки с повышенными привилегиями и перейдите к каталогу% SystemRoot% \\ system32 \\ WBEM \\ ТМФ.

2.  Введите **Copy/y% systemroot% \\ system32 \\ WBEM \\ ТМФ \\ \* . ТМФ% systemroot% \\ system32 \\ WBEM \\ ТМФ \\ WMI. ТМФ**. При этом будет создан файл с именем WMI. ТМФ, содержащий содержимое всех остальных файлов. ТМФ.

3.  Введите **tracelog-Flush \_ \_ сеанс трассировки WMI**. Это приведет к сбросу буферов WPP на диске.
4.  Введите **префикс формата трассировки, равный \_ \_ \[ %9! d! \] %8! 04X!. %3! 04X!. %3! 04X!:: %4! s! \[ %1! s! \] (%! КОМПНАМЕ!:%! FUNC!: %2! s!)**. Средство трацефмт добавляет некоторые сведения по умолчанию в каждое сообщение трассировки. Вы можете настроить, какие сведения включаются, задав \_ \_ переменную среды префикса формата трассировки. Дополнительные сведения об используемом синтаксисе см. в разделе [Трассировка префикса сообщения](https://msdn.microsoft.com/library/aa139695.aspx).
5.  Введите **трацефмт-ТМФ% systemroot% \\ system32 \\ WBEM \\ ТМФ \\ wmi. ТМФ-o OUTPUT.TXT% systemroot% \\ system32 \\ WBEM \\ журналы \\ вмитраЦинг. log**. При этом выполняется преобразование из двоичного формата в текстовый формат, доступный для чтения.
6.  Введите **Notepad% systemroot% \\ system32 \\ WBEM \\ ТМФ \\OUTPUT.TXT**. Файл трассировки откроется в блокноте.

Ниже приведены некоторые другие задачи, связанные с КОНВЕЙЕРом, которые может потребоваться выполнить.

**Отключение трассировки WMI на основе WPP**

-   Введите **tracelog — останавливает \_ \_ сеанс трассировки WMI**.

**Запуск трассировки WMI на основе WPP**

-   Введите **tracelog-Start WMI \_ \_ сеанс трассировки-GUID \# 1FF6B227-2CA7-40f9-9A66-980EADAA602E-RT-Level 5-Flag 0x7-f митраце. BIN**

**Windows Vista:** По умолчанию для трассировки WMI на основе WPP задан уровень 2, который включает только сообщения об ошибках. Чтобы включить информационные сообщения, установите уровень равным 4. По умолчанию отслеживаются все области инструментария WMI. Существует три различающихся области, которые можно отслеживать: ядро (флаг = 0x1), ESS (Flag = 0x2) и Prov (Flag = 0x4). В приведенной выше команде Start **флаг 0x7** приводит к тому, что все три области будут трассироваться.

**Windows 7:** По умолчанию трассировка WMI на основе WPP отключена, и для нее устанавливается уровень 0. Чтобы использовать трассировку WMI на основе WPP, эта функция должна быть включена и иметь уровень 2 для сообщений об ошибках или уровень 4 как для сообщения об ошибках, так и для информационных сообщений.

**Вывод списка всех сеансов трассировки WPP**

-   Введите **tracelog-l**.

**Вывод списка сведений о сеансе трассировки WPP в WMI**

-   Введите **tracelog-l \| findstr/i "WMI \_ Trace"**.

**Просмотр параметров сеанса трассировки WMI WPP**

-   Введите **tracelog-q \_ \_ сеанс трассировки WMI**.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Устранение неполадок WMI](wmi-troubleshooting.md).
</dt> <dt>

[Файлы журналов WMI](wmi-log-files.md)
</dt> </dl>

 

 
