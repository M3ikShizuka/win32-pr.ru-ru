---
description: Для подключения к удаленному компьютеру с помощью инструментария WMI убедитесь, что для подключения включены правильные параметры DCOM и параметры безопасности пространства имен WMI.
ms.assetid: 96ebaa9b-a062-4300-a637-8eb71cb80d1c
ms.tgt_platform: multiple
title: Защита удаленного WMI-подключения
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8650ee47c549121a51e5d131055a84c176da944c6146f0532ffc86f1d2f9e4c6
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "117739518"
---
# <a name="securing-a-remote-wmi-connection"></a>Защита удаленного WMI-подключения

Для подключения к удаленному компьютеру с помощью инструментария WMI убедитесь, что для подключения включены правильные параметры DCOM и параметры безопасности пространства имен WMI.

Инструментарий WMI имеет параметры олицетворения, проверки подлинности и службы проверки подлинности (NTLM или Kerberos) по умолчанию, необходимые для целевого компьютера в удаленном подключении. На локальном компьютере могут использоваться разные значения по умолчанию, которые целевая система не принимает. Эти параметры можно изменить в вызове соединения.

В этом разделе обсуждаются следующие разделы:

-   [олицетворение DCOM и Параметры проверки подлинности для WMI](#dcom-impersonation-and-authentication-settings-for-wmi)
-   [Настройка безопасности DCOM для удаленного доступа пользователя к компьютеру](#setting-dcom-security-to-allow-a-user-to-access-a-computer-remotely)
-   [Предоставление пользователям доступа к определенному пространству имен WMI](#allowing-users-access-to-a-specific-wmi-namespace)
-   [Настройка безопасности пространства имен для обязательного шифрования данных для удаленных подключений](#setting-namespace-security-to-require-data-encryption-for-remote-connections)
-   [Связанные темы](#related-topics)

## <a name="dcom-impersonation-and-authentication-settings-for-wmi"></a>олицетворение DCOM и Параметры проверки подлинности для WMI

WMI использует параметры олицетворения DCOM по умолчанию, проверки подлинности и службы проверки подлинности (NTLM или Kerberos), необходимые удаленной системе. Локальная система может использовать разные значения по умолчанию, которые не принимает Целевая удаленная система. Эти параметры можно изменить в вызове соединения. Дополнительные сведения см. в разделе [Установка параметров безопасности процессов для клиентских приложений](setting-client-application-process-security.md). Однако для службы проверки подлинности рекомендуется указать **RPC \_ C \_ AUTHN \_ по умолчанию** и разрешить DCOM выбрать соответствующую службу для целевого компьютера.

Вы можете указать параметры в параметрах для вызовов [**CoInitializeSecurity**](/windows/win32/api/combaseapi/nf-combaseapi-coinitializesecurity) или [**CoSetProxyBlanket**](/windows/win32/api/combaseapi/nf-combaseapi-cosetproxyblanket) в C++. В скриптах можно установить параметры безопасности в вызовах [**SWbemLocator. коннектсервер**](swbemlocator-connectserver.md), в объекте [**свбемсекурити**](swbemsecurity.md) или в строке [моникера](constructing-a-moniker-string.md) скрипта.

Список всех констант олицетворения C++ см. в разделе [Задание уровня безопасности процесса по умолчанию с помощью C++](setting-the-default-process-security-level-using-c-.md). сведения о Visual Basic констант и строках скрипта для использования моникера connection см. в разделе [задание уровня безопасности процесса по умолчанию с помощью VBScript](setting-the-default-process-security-level-using-vbscript.md).

В следующей таблице перечислены параметры олицетворения DCOM, проверки подлинности и службы проверки подлинности по умолчанию, необходимые конечному компьютеру (компьютер б) в удаленном соединении. Дополнительные сведения см. в разделе Защита удаленного WMI-подключения.



| Операционная система компьютера B | Строка скрипта для уровня олицетворения | Строка скрипта уровня проверки подлинности | Служба проверки подлинности |
|-----------------------------|--------------------------------------|---------------------------------------|------------------------|
| Windows Vista или более поздней версии      | Impersonate                          | PKT                                   | Kerberos;               |



 

на удаленные подключения WMI влияют [контроль учетных записей (UAC)](/previous-versions/aa905108(v=msdn.10)) и [брандмауэр Windows](https://www.microsoft.com/technet/itsolutions/network/wf/default.mspx). дополнительные сведения см. [в статье подключение к инструментарию WMI удаленно с помощью Vista](connecting-to-wmi-remotely-starting-with-vista.md) и [подключение через брандмауэр Windows](/windows/desktop/WmiSdk/connecting-to-wmi-remotely-starting-with-vista).

Имейте в виду, что подключение к WMI на локальном компьютере имеет уровень проверки подлинности **пктприваци** по умолчанию.

## <a name="setting-dcom-security-to-allow-a-user-to-access-a-computer-remotely"></a>Настройка безопасности DCOM для удаленного доступа пользователя к компьютеру

Безопасность в WMI связана с подключением к пространству имен WMI. Инструментарий WMI использует DCOM для управления удаленными вызовами. Одной из причин сбоя подключения к удаленному компьютеру является сбой DCOM (ошибка "доступ DCOM запрещен" — десятичное число 2147024891 или шестнадцатеричное 0x80070005). Дополнительные сведения о безопасности DCOM в инструментарии WMI для приложений C++ см. в разделе [Установка параметров безопасности процессов для клиентских приложений](setting-client-application-process-security.md).

Параметры DCOM для WMI можно настроить с помощью служебной программы настройки DCOM (**DCOMCnfg.exe**), которая находится в **меню "Администрирование** " на **панели управления**. Эта программа предоставляет параметры, позволяющие определенным пользователям подключаться к компьютеру удаленно через DCOM. Члены группы "Администраторы" могут удаленно подключаться к компьютеру по умолчанию. С помощью этой служебной программы можно настроить безопасность для запуска, доступа и настройки службы WMI.

В следующей процедуре описывается, как предоставить разрешения на удаленный запуск и активацию DCOM для определенных пользователей и групп. Если компьютер A удаленно подключается к компьютеру б, можно установить эти разрешения на компьютере B, чтобы разрешить запуск DCOM на компьютере b для пользователя или группы, не входящей в группу администраторов на компьютере B.

**Предоставление разрешений на удаленный запуск и активацию DCOM для пользователя или группы**

1.  Нажмите кнопку **Пуск**, выберите пункт **выполнить**, введите **DCOMCNFG** и нажмите кнопку **ОК**.
2.  В диалоговом окне **службы компонентов** разверните узел **службы компонентов**, разверните узел **Компьютеры**, а затем щелкните правой кнопкой мыши элемент **Мой компьютер** и выберите пункт **Свойства**.
3.  В диалоговом окне **свойства мой компьютер** перейдите на вкладку **Безопасность COM** .
4.  В разделе **разрешения на запуск и активацию** нажмите кнопку **изменить ограничения**.
5.  В диалоговом окне **разрешение на запуск** выполните следующие действия, если имя или группа не отображаются в **списке группы или имена пользователей**.

    1.  В диалоговом окне **разрешение на запуск** нажмите кнопку **Добавить**.
    2.  В диалоговом окне **Выбор пользователей, компьютеров или групп** добавьте имя и группу в поле **Введите имена объектов для выбора** и нажмите кнопку **ОК**.

6.  В диалоговом окне **разрешение на запуск** выберите пользователя и группу в поле **группы или пользователи** . В столбце **Разрешить** в разделе **разрешения для пользователя** выберите **Удаленный запуск** и выберите **Удаленная активация**, а затем нажмите кнопку **ОК**.

В следующей процедуре описывается предоставление разрешений на удаленный доступ DCOM для определенных пользователей и групп. Если компьютер A удаленно подключается к компьютеру б, можно установить эти разрешения на компьютере B, чтобы разрешить пользователю или группе, не входящему в группу "Администраторы" на компьютере B, подключаться к компьютеру B.

**Предоставление разрешений на удаленный доступ DCOM**

1.  Нажмите кнопку **Пуск**, выберите пункт **выполнить**, введите **DCOMCNFG** и нажмите кнопку **ОК**.
2.  В диалоговом окне **службы компонентов** разверните узел **службы компонентов**, разверните узел **Компьютеры**, а затем щелкните правой кнопкой мыши элемент **Мой компьютер** и выберите пункт **Свойства**.
3.  В диалоговом окне **свойства мой компьютер** перейдите на вкладку **Безопасность COM** .
4.  В разделе **разрешения на доступ** нажмите кнопку **изменить ограничения**.
5.  В диалоговом окне **разрешение доступа** выберите имя **анонимного входа** в поле **имена групп или пользователей** . В столбце **Разрешить** в разделе **разрешения для пользователя** выберите **Удаленный доступ**, а затем нажмите кнопку **ОК**.

## <a name="allowing-users-access-to-a-specific-wmi-namespace"></a>Предоставление пользователям доступа к определенному пространству имен WMI

Вы можете разрешить или запретить пользователям доступ к определенному пространству имен WMI, установив разрешение Remote Enable в элементе управления WMI для пространства имен. Если пользователь пытается подключиться к пространству имен, к которому им не разрешен доступ, они получат ошибку 0x80041003. По умолчанию это разрешение включено только для администраторов. Администратор может включить удаленный доступ к конкретным пространствам имен WMI для пользователя, не имеющего прав администратора.

Следующая процедура задает разрешения на удаленную включение для пользователя без прав администратора.

**Установка разрешений на удаленное включение**

1.  Подключение на удаленный компьютер с помощью элемента управления WMI.

    Дополнительные сведения об элементе управления WMI см. [в разделе Настройка безопасности пространства имен с помощью элемента управления WMI](setting-namespace-security-with-the-wmi-control.md).

2.  На вкладке **Безопасность** выберите пространство имен и щелкните **Безопасность**.
3.  Откройте соответствующую учетную запись и установите флажок **включить удаленно** в списке **разрешений** .

## <a name="setting-namespace-security-to-require-data-encryption-for-remote-connections"></a>Настройка безопасности пространства имен для обязательного шифрования данных для удаленных подключений

Администратор или MOF-файл может настроить пространство имен WMI таким образом, чтобы никакие данные не возвращались, если только вы не используете конфиденциальность пакетов (**RPC \_ C \_ уровня "AUTHN \_ \_ \_** " или **пктприваци** в качестве моникера в сценарии) в соединении с этим пространством имен. Это гарантирует, что данные шифруются по мере пересечения сети. При попытке задать более низкий уровень проверки подлинности будет получено сообщение об отказе в доступе. Дополнительные сведения см. в разделе [требуется зашифрованное соединение с пространством имен](requiring-an-encrypted-connection-to-a-namespace.md).

В следующем примере кода VBScript показано, как подключиться к зашифрованному пространству имен с помощью "Пктприваци".


```VB
strComputer = "RemoteComputer"
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate,authenticationLevel=pktPrivacy}!\\" _
                              & strComputer & "\root\EncryptedNamespace")
```



## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Делегирование с помощью WMI](connecting-to-a-3rd-computer-delegation.md)
</dt> <dt>

[Удаленное создание процессов с помощью WMI](creating-processes-remotely.md)
</dt> <dt>

[Защита клиентов и поставщиков C++](securing-c---clients-and-providers.md)
</dt> <dt>

[Защита клиентов скриптов](securing-scripting-clients.md)
</dt> </dl>

 

 
