---
description: Поставщик класса управляет классом или набором классов для WMI.
ms.assetid: 755f1fde-a0bf-43f6-a01d-2da7d4e6c10d
ms.tgt_platform: multiple
title: Написание поставщика класса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7b45815c795b6f43f3e7ec99b9ce9535c4d14b2bc8426ea5ca6b44f736415bbf
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118311943"
---
# <a name="writing-a-class-provider"></a>Написание поставщика класса

Поставщик класса управляет классом или набором классов для WMI. Поставщик класса может быть либо принудительным, либо опрашивающим; то есть он может хранить собственные данные или разрешать инструментарию WMI сохранять данные для них в службе управления Windows. Хотя поставщик класса установлен на определенном компьютере, он может изменять определения классов во всей Организации. Поэтому большинство разработчиков часто не создают поставщики классов.

Перед созданием поставщика класса убедитесь, что поддерживаемые классы действительно должны создаваться динамически. В большинстве случаев список классов является неизменным и конечным. В этом случае не нужно создавать поставщик класса. Вместо этого можно разместить определения классов в репозитории WMI с помощью API инструментария WMI или MOF-файла.

В следующей процедуре описывается реализация поставщика класса.

**Реализация поставщика класса**

1.  Определите, является ли поставщик принудительным или поставщиком опрашивающей репликации.

    Поставщик опроса предоставляет данные динамически в ответ на запрос приложения, тогда как поставщики push-уведомлений хранят свои данные один раз в репозитории WMI. Дополнительные сведения см. в разделе [Определение состояния принудительной отправки или извлечения](determining-push-or-pull-status.md).

2.  Разработка и регистрация поставщика классов с помощью инструментария WMI.

    Поставщики классов регистрируются в WMI путем создания экземпляра [**\_ \_ Win32Provider**](--win32provider.md) и экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) . Дополнительные сведения см. [в разделе Регистрация поставщика класса](registering-a-class-provider.md).

3.  Реализуйте интерфейс [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) для поставщика.

    Инструментарий WMI использует [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) для загрузки и инициализации поставщика. При проектировании поставщика push-уведомлений **ивбемпровидеринит** является единственным интерфейсом, который вы будете реализовывать. Дополнительные сведения см. [в разделе Инициализация поставщика](initializing-a-provider.md).

    > [!Note]  
    > Поставщики классов настоятельно рекомендуется использовать модель многопоточности "both".

     

4.  Добавьте дополнительный код, необходимый для поставщика.

    При проектировании поставщика вам, скорее всего, придется вызывать интерфейсы WMI. Дополнительные сведения см. в разделе [вызов метода](calling-a-method.md) и [обслуживание уровней безопасности в поставщике](impersonating-a-client.md).

    При получении сведений для клиента может потребоваться доступ к уровням безопасности для этого клиента. Дополнительные сведения см. в разделе [олицетворение клиента](impersonating-a-client.md).

5.  Реализуйте интерфейс [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) для вашего поставщика.

    Интерфейс [**IWbemServices**](/windows/desktop/api/WbemCli/nn-wbemcli-iwbemservices) является основным интерфейсом для поставщика опрашивающего класса. Дополнительные сведения см. [в разделе Реализация основного интерфейса для поставщика класса](implementing-the-primary-interface-for-a-class-provider.md).

6.  Замените имеющийся поставщик новым кодом.

    Вам не нужно выполнять этот шаг, если у вас нет уже существующего поставщика для копирования. Дополнительные сведения см. [в разделе Обновление поставщика](updating-a-provider.md).

 

 



