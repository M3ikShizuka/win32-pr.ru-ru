---
description: Поставщик событий — это COM-объект, предоставляющий инструментарий WMI с уведомлениями о внутренних и внешних событиях.
ms.assetid: 075bdc65-4ea3-4f91-9823-1d2d0dc13423
ms.tgt_platform: multiple
title: Создание поставщика событий
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c04abf060ef5316790b04682430abd92d0a6bea31175f0e192fc7f73d047633d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119757214"
---
# <a name="writing-an-event-provider"></a>Создание поставщика событий

Поставщик событий — это COM-объект, предоставляющий инструментарий WMI с уведомлениями о внутренних и внешних событиях. Внутреннее событие сообщает о внутреннем изменении данных в WMI, а внешнее событие сообщает о определяемом пользователем событии, не описанном внутренним событием. Например, событие в ответ на изменения, создание или удаление класса [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) будет классифицироваться как внутреннее событие. Событие, формируемое на основе чего-либо, отличного от изменения, создания или удаления существующего объекта WMI, является событием внешнего вида. Независимо от поддерживаемого класса, можно реализовать все поставщики событий таким же образом.

В следующей процедуре описывается реализация поставщика событий.

**Реализация поставщика событий**

1.  Разработка и регистрация поставщика классов с помощью инструментария WMI.

    Поставщики классов регистрируются в WMI путем создания экземпляра [**\_ \_ Win32Provider**](--win32provider.md) и класса [**\_ \_ евентпровидеррегистратион**](--eventproviderregistration.md) . Дополнительные сведения см. в разделе [Регистрация поставщика событий](registering-an-event-provider.md).

2.  Реализуйте интерфейс [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) для поставщика.

    Интерфейс [**ивбемпровидеринит**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemproviderinit) — это общий интерфейс WMI, который используется для загрузки и инициализации всех поставщиков. Дополнительные сведения см. [в разделе Инициализация поставщика](initializing-a-provider.md).

3.  Реализуйте [**ивбемевентпровидер**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) в качестве основного интерфейса для поставщика.

    Интерфейс [**ивбемевентпровидер**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovider) использует метод **провидеревентс** для предоставления событий WMI. Дополнительные сведения см. [в разделе Реализация основного интерфейса для поставщика событий](implementing-the-primary-interface-for-an-event-provider.md).

    > [!Note]  
    > Поставщики событий должны использовать модель многопоточности "both".

     

4.  При необходимости можно также реализовать интерфейс [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) для повышения производительности поставщика событий.

    Интерфейс [**ивбемевентпровидеркуерисинк**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventproviderquerysink) позволяет поставщику оптимизировать запросы перед отправкой ответа инструментарию WMI и наиболее полезен для поставщика, предоставляющего события нескольких типов и требующих выполнения максимально допустимого количества внутренних оптимизаций. Дополнительные сведения см. в разделе [Оптимизация поставщика событий](optimizing-an-event-provider.md).

5.  Реализуйте интерфейс [**ивбемевентпровидерсекурити**](/windows/desktop/api/Wbemprov/nn-wbemprov-iwbemeventprovidersecurity) , чтобы ограничить потребителей определенными идентификаторами безопасности (SID) или реализуйте [**Ивбемевентсинк:: сетсинксекурити**](/windows/desktop/api/Wbemprov/nf-wbemprov-iwbemeventsink-setsinksecurity) для защиты самого приемника. Поставщик также может установить свойство **\_ дескриптора безопасности** в классе событий для защиты отдельных событий в MOF-коде. Дополнительные сведения см. в разделе [Защита событий WMI](securing-wmi-events.md).
6.  Добавьте дополнительный код, необходимый для поставщика.

    При проектировании поставщика вам, скорее всего, придется вызывать интерфейсы WMI. Дополнительные сведения см. [в разделе вызов метода](calling-a-method.md).

    При получении сведений для клиента может потребоваться доступ к уровням безопасности для этого клиента. Дополнительные сведения см. в разделе [олицетворение клиента](impersonating-a-client.md).

7.  Замените имеющийся поставщик новым кодом.

    Вам не нужно выполнять этот шаг, если у вас нет уже существующего поставщика для копирования. Дополнительные сведения см. [в разделе Обновление поставщика](updating-a-provider.md).

Клиентское приложение может запросить событие, зарегистрировав его в WMI как потребитель события. Дополнительные сведения см. [в разделе Получение WMI-события](receiving-a-wmi-event.md).

 

 
