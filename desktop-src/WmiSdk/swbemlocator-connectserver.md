---
description: Подключается к пространству имен на компьютере, указанном в параметре Стрсервер.
ms.assetid: 31364c68-b031-4cf0-851f-b4e302f077e0
ms.tgt_platform: multiple
title: SWbemLocator. Коннектсервер, метод (Wbemdisp. h)
ms.topic: reference
ms.date: 05/31/2018
topic_type:
- APIRef
- kbSyntax
api_name:
- SWbemLocator.ConnectServer
- ISWbemLocator.ConnectServer
- ISWbemLocator.ConnectServer
api_type:
- COM
api_location:
- Wbemdisp.dll
ms.openlocfilehash: f4153a5761d59c54cf8635202adcca0ddf72603022ebf8dbb5b160231c90e49e
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119955214"
---
# <a name="swbemlocatorconnectserver-method"></a>SWbemLocator. Коннектсервер, метод

Метод **коннектсервер** объекта [**SWbemLocator**](swbemlocator.md) подключается к пространству имен на компьютере, указанном в параметре *стрсервер* . Конечный компьютер может быть либо локальным, либо удаленным, но на нем должен быть установлен инструментарий WMI. Примеры и сравнение с типом моникера Connection см. в разделе [Создание скрипта WMI](creating-a-wmi-script.md).

начиная с Windows Vista, **SWbemLocator. коннектсервер** может подключаться к компьютерам с ipv6 с помощью ipv6-адреса в параметре *стрсервер* . Дополнительные сведения см. [в разделе Поддержка IPv6 и IPv4 в WMI](ipv6-and-ipv4-support-in-wmi.md).

Описание этого синтаксиса см. в разделе [соглашения о документе для API скриптов](document-conventions-for-the-scripting-api.md).

## <a name="syntax"></a>Синтаксис


```VB
objwbemServices = .ConnectServer( _
  [ ByVal strServer ], _
  [ ByVal strNamespace ], _
  [ ByVal strUser ], _
  [ ByVal strPassword ], _
  [ ByVal strLocale ], _
  [ ByVal strAuthority ], _
  [ ByVal iSecurityFlags ], _
  [ ByVal objwbemNamedValueSet ] _
)
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*стрсервер* \[ в необязательное\]
</dt> <dd>

Имя компьютера, к которому выполняется подключение. Если удаленный компьютер находится в домене, отличном от домена, в котором выполняется вход, используйте полное имя компьютера. Если этот параметр не предоставлен, по умолчанию вызывается локальный компьютер.

Пример: `server1.network.fabrikam`

В этом параметре также можно использовать IP-адрес. Если IP-адрес имеет формат IPv6, на целевом компьютере должен быть установлен протокол IPv6. Адрес в IPv4 выглядит следующим образом: `123.123.123.123`

IP-адрес в формате IPv6 выглядит следующим образом: `2010:836B:4179::836B:4179`

Дополнительные сведения о DNS и IPv4 см. в разделе "Примечания".

</dd> <dt>

*стрнамеспаце* \[ в необязательное\]
</dt> <dd>

Строка, указывающая пространство имен, в котором вы входите в систему. Например, чтобы войти в корневое \\ пространство имен по умолчанию, используйте корневую папку \\ по умолчанию. Если этот параметр не указан, по умолчанию используется пространство имен, настроенное в качестве пространства имен по умолчанию для сценариев. Дополнительные сведения см. [в разделе Создание приложения WMI или скрипта](creating-a-wmi-application-or-script.md).

Пример: "root \\ CIMV2"

</dd> <dt>

*strUser* \[ в необязательное\]
</dt> <dd>

Имя пользователя, используемое для подключения. Строка может иметь форму либо имени пользователя, либо доменного имени пользователя \\ . Оставьте этот параметр пустым, чтобы использовать текущий контекст безопасности. Параметр *strUser* следует использовать только с соединениями с удаленными серверами WMI. При попытке указать *strUser* для ЛОКАЛЬНОГО подключения WMI попытка подключения завершится неудачей. Если используется проверка подлинности Kerberos, то имя пользователя и пароль, указанные в параметре *strUser* и *стрпассворд* , не могут быть перехвачены в сети. Для указания *strUser* можно использовать формат имени участника-пользователя.

Пример: "имя_домена \\ имя_пользователя"

> [!Note]  
> Если домен указан в *страусорити*, то этот домен не должен указываться здесь. Указание домена в обоих параметрах приводит к ошибке недопустимого параметра.

 

</dd> <dt>

*стрпассворд* \[ в необязательное\]
</dt> <dd>

Строка, указывающая пароль, используемый при попытке подключения. Чтобы использовать текущий контекст безопасности, оставьте параметр пустым. Параметр *стрпассворд* следует использовать только с соединениями с удаленными серверами WMI. При попытке указать *стрпассворд* для ЛОКАЛЬНОГО подключения WMI попытка подключения завершится неудачей. Если используется проверка подлинности Kerberos, то имя пользователя и пароль, указанные в параметре *strUser* и *стрпассворд* , не могут быть перехвачены в сети.

</dd> <dt>

*стрлокале* \[ в необязательное\]
</dt> <dd>

Строка, указывающая код локализации. Если вы хотите использовать текущий языковой стандарт, оставьте это поле пустым. Если значение не пустое, этот параметр должен быть строкой, указывающей предпочтительный языковой стандарт, в который должны быть извлечены сведения. Для идентификаторов языковых стандартов Майкрософт формат строки — MS \_ XXXX, где XXXX — строка в шестнадцатеричной форме, указывающая код языка. Например, американский английский будет выглядеть как "MS \_ 409".

</dd> <dt>

*страусорити* \[ в необязательное\]
</dt> <dd>

<dt>

""
</dt> <dd>

Это необязательный параметр. Однако, если он указан, можно использовать только Kerberos или Нтлмдомаин.

</dd> <dt>

Проверк
</dt> <dd>

Если параметр *страусорити* начинается со строки "Kerberos:", используется проверка подлинности Kerberos и этот параметр должен содержать имя участника Kerberos. Имя участника Kerberos указывается как Kerberos:*domain*, например, `Kerberos:fabrikam` где `fabrikam` — это сервер, к которому выполняется попытка подключения.

Пример: "Kerberos: домен"

</dd> <dt>

Нтлмдомаин:
</dt> <dd>

Чтобы использовать проверку подлинности NT LAN Manager (NTLM), необходимо указать ее как Нтлмдомаин:*domain*, например, `NTLMDomain:fabrikam` где `fabrikam` — это имя домена.

Пример: "Нтлмдомаин: DOMAIN"

</dd> </dl>

Если оставить этот параметр пустым, операционная система согласовывается с COM, чтобы определить, используется ли проверка подлинности NTLM или Kerberos. Этот параметр следует использовать только с соединениями с удаленными серверами WMI. При попытке задать центр для локального WMI-подключения произойдет сбой попытки подключения.

> [!Note]  
> Если домен указан в параметре *strUser*, который является предпочтительным расположением, то его не следует указывать здесь. Указание домена в обоих параметрах приводит к ошибке недопустимого параметра.

 

</dd> <dt>

*исекуритифлагс* \[ в необязательное\]
</dt> <dd>

Используется для передачи значений флагов в **коннектсервер**.

<dt>

0 (0x0)
</dt> <dd>

Значение 0 для этого параметра приводит к возврату из вызова **коннектсервер** только после установки соединения с сервером. Это может привести к тому, что программа перестанет отвечать на запросы в неопределенное время, если не удается установить соединение.

</dd> <dt>

<span id="wbemConnectFlagUseMaxWait"></span><span id="wbemconnectflagusemaxwait"></span><span id="WBEMCONNECTFLAGUSEMAXWAIT"></span>

<span id="wbemConnectFlagUseMaxWait"></span><span id="wbemconnectflagusemaxwait"></span><span id="WBEMCONNECTFLAGUSEMAXWAIT"></span>Вбемконнектфлагусемаксваит * * * * (128 (0x80))


</dt> <dd>

Вызов **коннектсервер** гарантированно возвращается в течение 2 минут или меньше. Используйте этот флаг, чтобы программа из прекращение не отвечала на неопределенное время, если не удается установить соединение.

</dd> </dl> </dd> <dt>

*обжвбемнамедвалуесет* \[ в необязательное\]
</dt> <dd>

Как правило, это не определено. В противном случае это объект [**свбемнамедвалуесет**](swbemnamedvalueset.md) , элементы которого представляют сведения о контексте, которые могут использоваться поставщиком, обслуживающим запрос. Поставщик, который поддерживает или требует такую информацию, должен документировать распознанные имена значений, тип данных значения, допустимые значения и семантику.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

В случае успеха Инструментарий WMI возвращает объект [**SwbemServices**](swbemservices.md) , привязанный к пространству имен, указанному в *стрнамеспаце* на компьютере, указанном в *стрсервер*.

## <a name="error-codes"></a>Коды ошибок

После завершения метода **коннектсервер** объект [Err](/previous-versions//sbf5ze0e(v=vs.85)) может содержать один из кодов ошибок из следующего списка.

<dl> <dt>

**вбемерракцессдениед** -2147749891 (0x80041003)
</dt> <dd>

Текущее или указанное имя пользователя и пароль не были допустимыми или разрешены для создания соединения.

</dd> <dt>

**вбемеррфаилед** -2147749889 (0x80041001)
</dt> <dd>

Незаданная ошибка.

</dd> <dt>

**вбемерринвалиднамеспаце** -2147749902 (0x8004100E)
</dt> <dd>

Указанное пространство имен не существует на сервере.

</dd> <dt>

**вбемерринвалидпараметер** -2147749896 (0x80041008)
</dt> <dd>

Указан недопустимый параметр, или не удалось выполнить синтаксический анализ пространства имен.

</dd> <dt>

**вбемерраутофмемори** -2147749894 (0x80041006)
</dt> <dd>

Недостаточно памяти для завершения операции.

</dd> <dt>

**вбемерртранспортфаилуре** -2147749909
</dt> <dd>

Произошла сетевая ошибка, препятствующая нормальной работе.

</dd> </dl>

## <a name="remarks"></a>Remarks

Метод **коннектсервер** часто используется при подключении к учетной записи с другими учетными данными пользователя и пароля на удаленном компьютере, так как в строке [моникера](constructing-a-moniker-string.md) нельзя указать другой пароль. Дополнительные сведения см. в разделе [Подключение к WMI на удаленном компьютере](connecting-to-wmi-on-a-remote-computer.md).

Использование IPv4-адреса для подключения к удаленному серверу может привести к непредвиденному поведению. Вероятная причина — устаревшие записи DNS в вашей среде. В таких случаях будет использоваться устаревшая запись PTR для компьютера с непредсказуемыми результатами. Чтобы избежать такого поведения, перед вызовом Коннектсервер можно добавить точку (".") к IP-адресу. Это приводит к сбою уточняющего запроса DNS, но может привести к успешному выполнению вызова **коннектсервер** на нужном компьютере.

## <a name="examples"></a>Примеры

В следующем примере кода VBScript описывается подключение к удаленному компьютеру для получения данных [**Win32 \_ IP4RouteTable**](/previous-versions/windows/desktop/wmiiprouteprov/win32-ip4routetable) . Имя домена, указанное в *стрдомаин* , используется в *страусорити*.


```VB
Const intMin = 3600
strComputer = "RemoteComputer" 
strDomain = "DomainName"  
Wscript.StdOut.Write "Please enter your user name:"
strUser = Wscript.StdIn.ReadLine 
Set objPassword = CreateObject("ScriptPW.Password")
Wscript.StdOut.Write "Please enter your password:"
strPassword = objPassword.GetPassword()
Wscript.Echo

Set objSWbemLocator = CreateObject("WbemScripting.SWbemLocator") 
Set objWMIService = objSWbemLocator.ConnectServer(strComputer, _ 
                                                  "root\CIMV2", _ 
                                                  strUser, _ 
                                                  strPassword, _ 
                                                  "MS_409", _ 
                                                  "NTLMDomain:" + strDomain) 
Set colItems = objWMIService.ExecQuery("SELECT * FROM Win32_IP4RouteTable",,48) 
For Each objItem in colItems
    WScript.Echo "Age in Minutes: " & int(objItem.Age/intMin) & VBNewLine _
               & "Description:    " & objItem.Description & VBNewLine _
               & "Destination:    " & objItem.Destination & VBNewLine _
               & "InterfaceIndex: " & objItem.InterfaceIndex & VBNewLine _
               & "Mask:           " & objItem.Mask & VBNewLine _
               & "Metric1:        " & objItem.Metric1 & VBNewLine _
               & "Metric2:        " & objItem.Metric2 & VBNewLine _
               & "Metric3:        " & objItem.Metric3 & VBNewLine _
               & "Metric4:        " & objItem.Metric4 & VBNewLine _
               & "Metric5:        " & objItem.Metric5 & VBNewLine _
               & "Name:           " & objItem.Name & VBNewLine _
               & "NextHop:        " & objItem.NextHop & VBNewLine _
               & "Protocol:       " & objItem.Protocol & VBNewLine _
               & "Type: " & objItem.Type
    WScript.Echo
   </example>
Next
```



Следующий фрагмент кода PowerShell обращается к удаленному серверу и перечисляет доступные классы WMI.


```PowerShell
$NameSpace = 'root\ccm'
$ComputerName = 'sccm.company.com'
$WbemLocator = New-Object -ComObject "WbemScripting.SWbemLocator"
$WbemServices = $WbemLocator.ConnectServer($ComputerName, $Namespace)
$WbemClasses = $WbemServices.SubclassesOf()
$WbemClasses
```



## <a name="requirements"></a>Требования



| Требование | Значение |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Windows Vista<br/>                                                                |
| Минимальная версия сервера<br/> | Windows Server 2008<br/>                                                          |
| Заголовок<br/>                   | <dl> <dt>Wbemdisp. h</dt> </dl>   |
| Библиотека типов<br/>             | <dl> <dt>Wbemdisp. tlb</dt> </dl> |
| DLL<br/>                      | <dl> <dt>Wbemdisp.dll</dt> </dl> |
| CLSID<br/>                    | \_SWBEMLOCATOR CLSID<br/>                                                          |
| IID<br/>                      | IID \_ исвбемлокатор<br/>                                                           |



## <a name="see-also"></a>См. также раздел

<dl> <dt>

[**SWbemLocator**](swbemlocator.md)
</dt> <dt>

[**SWbemServices**](swbemservices.md)
</dt> <dt>

[Подключение к инструментарию WMI на удаленном компьютере](connecting-to-wmi-on-a-remote-computer.md)
</dt> <dt>

[Создание скрипта WMI](creating-a-wmi-script.md)
</dt> </dl>

 

