---
description: инструментарий wmi предоставляет данные об Windows управляемых объектах, доступных через поставщики WMI.
ms.assetid: 74558c6e-28b6-479f-9de6-2fbad793ae26
ms.tgt_platform: multiple
title: Предоставление данных инструментарию WMI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22fbff46959c001f589587f21b8b2b50ab5c5187d387338f407bf45e3e1a29d
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118316578"
---
# <a name="providing-data-to-wmi"></a>Предоставление данных инструментарию WMI

инструментарий wmi предоставляет данные об Windows управляемых объектах, доступных через [*поставщики*](gloss-p.md)WMI. Поставщик получает данные из системного компонента, например процесса, или инструментированного приложения, такого как SNMP или IIS, и передает эти данные через WMI в приложение управления. Например, когда приложение или сценарий запрашивают информацию о процессе с помощью класса [**\_ процесса Win32**](/windows/desktop/CIMWin32Prov/win32-process) WMI, данные получаются динамически через предварительно установленный поставщик.

В этом разделе обсуждаются следующие разделы:

-   [Создание модели для управляемого объекта](#creating-a-model-for-a-manageable-object)
-   [Реализация модели для управляемого объекта](#implementing-a-model-for-a-manageable-object)
-   [Определение типа поставщика для реализации](#determining-a-provider-type-to-implement)
-   [Определение модели размещения (реализации) для поставщика](#determining-a-hosting-implementation-model-for-a-provider)
-   [Реализация поставщика](#implementing-a-provider)
-   [Регистрация поставщика с помощью WMI и системы](#registering-a-provider-with-wmi-and-the-system)
-   [Тестирование поставщика](#testing-a-provider)
-   [Связанные темы](#related-topics)

## <a name="creating-a-model-for-a-manageable-object"></a>Создание модели для управляемого объекта

Перед разработкой поставщика создайте модель данных, представляющую управляемый объект, который будет предоставляться через WMI. Вы планируете предоставлять объекты данных, предоставляемые поставщиком. Например, если планируется управлять разрешением экрана фона рабочего стола, необходимо решить, как моделировать Рабочий стол в файле [*MOF-файл (MOF)*](gloss-m.md) .

Чтобы создать полезную модель, выполните следующие действия.

-   Определите реальные сценарии и укажите сведения, которые клиент может читать и обновлять (например, изменение фонового изображения) для каждого управляемого объекта. Это свойства класса.
-   Определите, какие действия может потребоваться клиенту с каждым управляемым объектом. Это ваши методы.

## <a name="implementing-a-model-for-a-manageable-object"></a>Реализация модели для управляемого объекта

Чтобы реализовать модель для управляемых объектов, создайте MOF-файл, содержащий класс WMI, представляющий каждый объект. Дополнительные сведения о создании MOF-файла для определения классов WMI см. в разделе [Разработка классов MOF-файл (MOF)](designing-managed-object-format--mof--classes.md). Регистрация поставщика и его классов обычно включается в MOF-файл, хотя для создания классов и методов можно использовать [API COM](com-api-for-wmi.md) . Дополнительные сведения см. [в разделе Разработка поставщика WMI](developing-a-wmi-provider.md).

> [!Note]  
> Чтобы гарантировать, что все определения классов WMI для управляемых объектов будут восстановлены в [*репозитории WMI*](gloss-w.md) в случае сбоя и перезапуска WMI, используйте инструкцию препроцессора [**\# pragma автовосстановления**](pragma-autorecover.md) в файле [*MOF-файл (MOF)*](gloss-m.md) .

 

После создания MOF-файла скомпилируйте его с помощью средства [**Mofcomp.exe**](mofcomp.md) . Это уведомление об ошибках в MOF-файле и добавляет класс WMI, определенный в MOF-файле, в [*репозиторий WMI*](gloss-w.md) , чтобы класс мог использоваться поставщиком.

## <a name="determining-a-provider-type-to-implement"></a>Определение типа поставщика для реализации

Инструментарий WMI поддерживает определенное количество типов поставщиков, которые определяют характер предоставляемых данных и операций, поддерживаемых поставщиками.

Типы поставщиков:

-   [*Поставщик экземпляров*](gloss-i.md)
-   [*Поставщик метода*](gloss-m.md)
-   [*Поставщик свойств*](gloss-p.md)
-   Поставщик класса
-   [*Поставщик событий*](gloss-e.md)
-   [*Поставщик потребителей событий*](gloss-e.md)
-   [*Поставщик ассоциаций*](gloss-a.md)

Подавляющее большинство поставщиков — поставщики экземпляров и поставщики методов. Поставщик экземпляров является наиболее распространенным поставщиком и предоставляет экземпляры данного класса. Поставщик метода реализует методы одного или нескольких классов. Дополнительные сведения о типах поставщиков см. в разделе [Разработка поставщика WMI](developing-a-wmi-provider.md).

## <a name="determining-a-hosting-implementation-model-for-a-provider"></a>Определение модели размещения (реализации) для поставщика

Поставщики WMI — это двоичные файлы, реализуемые как COM-объекты. Это означает, что у каждого поставщика есть DLL-файл, который может быть выполнен в определенном процессе и контексте безопасности. Это то, что WMI относится к [*модели размещения*](gloss-h.md). Инструментарий WMI предлагает различные способы размещения поставщиков, но наиболее распространенный подход заключается в использовании взаимодействующей модели поставщика (выполняемой в процессе WMI) в контексте безопасности Нетворксервицехост. Поставщик WMI может классифицироваться [*как связанный или*](gloss-d.md)отсоединенный.

Термин "связанный" или "несвязанный" поставщик определяет, в каком хост-процессе выполняется поставщик, по отношению к инструментарию WMI, предоставленному WMIPRVSE.EXE процессом. Рекомендуется определить, являются ли данные управления, предоставляемые поставщиком, и API или приложение, на котором они основаны, всегда доступны в системе. Если API или приложение, от которого зависит поставщик, всегда доступно (работает в системе), то поставщик должен быть связанным поставщиком, если нет, то он должен быть несвязанным поставщиком. Дополнительные сведения о моделях размещения см. в разделе [размещение и безопасность поставщика](provider-hosting-and-security.md).

Дополнительные сведения о создании взаимосвязанных поставщиков см. в статьях [предоставление данных в WMI путем написания поставщика](supplying-data-to-wmi-by-writing-a-provider.md), а сведения о включении в приложение несвязанного поставщика см. в разделе [Включение поставщика в приложение](incorporating-a-provider-in-an-application.md).

Связанные поставщики можно описать как внутрипроцессный (in-proc) или внепроцессный (внепроцессный) процесс. Если связанный поставщик является внутрипроцессным поставщиком, он выполняется с общим WMIPRVSE.EXE хост-процессом WMI и реализуется как внутрипроцессный сервер COM (.dll). Если поставщик является внепроцессный, он запускается WMI при запросе клиента или события, но выполняется как отдельный процесс и реализуется в виде исполняемого файла (.exe).

## <a name="implementing-a-provider"></a>Реализация поставщика

Поставщик может быть реализован следующими способами.

-   Использование мастера ATL в Visual Studio.

    Мастер ATL создает код поставщика, реализующий связанный поставщик. При использовании мастера ATL можно указать, что вы хотите создать внутрипроцессный (.dll) или внепроцессный (.exe) модель времени выполнения поставщика.

-   Определение COM-объекта, который будет содержать поставщик.

    Код поставщика написан на языке C++. Дополнительные сведения см. в разделе [предоставление данных WMI с помощью записи поставщика](supplying-data-to-wmi-by-writing-a-provider.md).

-   использование классов в пространстве имен [**Microsoft. Management. Infrastructure**](/previous-versions//hh872326(v=vs.85)) в платформа .NET Framework для создания поставщика с помощью управляемого кода. (Пространство имен **System. Management. Instrumentation** больше не поддерживается.)

    Этот процесс создает несвязанный поставщик.

## <a name="registering-a-provider-with-wmi-and-the-system"></a>Регистрация поставщика с помощью WMI и системы

прежде чем использовать поставщик из потребителя, важно зарегистрировать его в системе WMI и подсистеме Windows COM.

MOF-файл может содержать несколько типов поставщиков для одних и тех же классов. То же имя поставщика регистрируется как, например, экземпляр или поставщик метода. Дополнительные сведения см. [в разделе Регистрация поставщика](registering-a-provider.md).

## <a name="testing-a-provider"></a>Тестирование поставщика

При регистрации кода поставщика важно правильно протестировать поставщик с помощью поставщика от разных потребителей (например, скриптов, управляемого кода .NET и потребителей C++).

Для проверки поставщика выполните следующие задачи.

-   Убедитесь, что поставщик загружается должным образом, отследяя уведомления о событии [**MSFT \_ события \_ оператионевент**](/previous-versions/windows/desktop/wmisystemprov/msft-wmiprovider-operationevent) . Эти события сообщают о сбоях при загрузке поставщика. Другими классами для устранения неполадок, которые могут быть полезными, являются [**Win32 \_ Процессстарттраце**](/previous-versions/windows/desktop/krnlprov/win32-processstarttrace) и [**Win32 \_ процессстоптраце**](/previous-versions/windows/desktop/krnlprov/win32-processstoptrace). Дополнительные сведения об устранении неполадок поставщиков см. в разделе [Отладка поставщиков](debugging-providers.md) и [конфигурации поставщика и устранение неполадок классов](provider-configuration-and-troubleshooting-classes.md).
-   Если поставщик является экземпляром или поставщиком метода, убедитесь, что каждый из возможностей поставщика проверяются один за другим, чтобы избежать путаницы в работе логики кода.
-   Для поставщика экземпляров Создайте клиентское приложение или скрипт, который вызывает каждый интерфейс поставщика (перечисление, получение, размещение и удаление). Даже если поставщик не должен реализовывать ничего, он должен вернуть сообщение "не поддерживается". Возвращаемые значения, уже определенные в [кодах возврата WMI](wmi-return-codes.md), можно найти.
-   Чтобы обеспечить работу требуемого контекста безопасности в соответствии с планом, вызовите поддерживаемые операции поставщика из контекста безопасности неадминистратора. Поставщик должен поддерживать олицетворение. Если пользователь, не имеющий правильных учетных данных, пытается обновить данные или выполнить операцию, которая выполняет метод, поставщик должен запретить доступ с указанием соответствующего сообщения об ошибке.
-   Дополнительные сведения о безопасности поставщика см. [в разделе Защита поставщика](securing-your-provider.md).

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Разработка поставщика WMI](developing-a-wmi-provider.md)
</dt> <dt>

[Размещение и безопасность поставщика](provider-hosting-and-security.md)
</dt> <dt>

[Предоставление данных в WMI путем написания поставщика](supplying-data-to-wmi-by-writing-a-provider.md)
</dt> <dt>

[Включение поставщика в приложение](incorporating-a-provider-in-an-application.md)
</dt> <dt>

[Регистрация поставщика](registering-a-provider.md)
</dt> <dt>

[Устранение неполадок клиентских приложений WMI](troubleshooting-wmi-client-applications.md)
</dt> <dt>

[Защита поставщика](securing-your-provider.md)
</dt> <dt>

[Получение и предоставление данных на 64-разрядной платформе](getting-and-providing-data-on-a-64-bit-computer.md)
</dt> </dl>

 

 
