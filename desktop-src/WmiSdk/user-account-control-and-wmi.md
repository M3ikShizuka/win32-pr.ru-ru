---
description: Контроль учетных записей (UAC) влияет на данные WMI, возвращаемые из программы командной строки, удаленный доступ и то, как должны выполняться сценарии. Дополнительные сведения об UAC см. в разделе начало работы с контролем учетных записей.
ms.assetid: f6840aaa-834b-42c8-b641-01c570078fcb
ms.tgt_platform: multiple
title: Управление учетными записями пользователей и WMI
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 39d48abcffa537d886397092c6d4a7b558825021
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105702654"
---
# <a name="user-account-control-and-wmi"></a>Управление учетными записями пользователей и WMI

Контроль учетных записей (UAC) влияет на данные WMI, возвращаемые из программы командной строки, удаленный доступ и то, как должны выполняться сценарии. Дополнительные сведения об UAC см. [в разделе Начало работы с контролем учетных записей](https://support.microsoft.com/help/922708/how-to-use-user-account-control-uac-in-windows-vista).

В следующих разделах описываются функции UAC:

-   [Контроль учетных записей пользователей](#user-account-control-and-wmi)
-   [Учетная запись, необходимая для запуска средств Command-Line инструментария WMI](#account-needed-to-run-wmi-command-line-tools)
-   [Обработка удаленных подключений в UAC](#handling-remote-connections-under-uac)
-   [Воздействие UAC на данные WMI, возвращаемые в скрипты или приложения](#uac-effect-on-wmi-data-returned-to-scripts-or-applications)
-   [См. также](#related-topics)

## <a name="user-account-control"></a>контроль учетных записей

В разделе UAC учетные записи в локальной группе администраторов имеют два [*маркера доступа*](/windows/desktop/SecGloss/a-gly): один имеет права обычного пользователя и один с правами администратора. Из-за фильтрации маркера доступа UAC сценарий обычно выполняется под маркером обычного пользователя, если он не запускается как администратор в режиме повышенных привилегий. Не все сценарии требуют прав администратора.

Скрипты не могут программно определять, выполняются ли они с помощью маркера безопасности обычного пользователя или маркера администратора. Скрипт может завершиться ошибкой с ошибкой "доступ запрещен". Если скрипту требуются права администратора, он должен быть запущен в режиме с повышенными правами. Доступ к пространствам имен WMI зависит от того, выполняется ли сценарий в режиме с повышенными правами. Некоторые операции WMI, например получение данных или выполнение большинства методов, не предполагают, что учетная запись запускается от имени администратора. Дополнительные сведения о разрешениях на доступ по умолчанию см. [в разделе доступ к пространствам имен WMI](access-to-wmi-namespaces.md) и [выполнение привилегированных операций](executing-privileged-operations.md).

В связи с контролем учетных записей учетная запись, в которой выполняется сценарий, должна входить в группу администраторов на локальном компьютере, чтобы иметь возможность запуска с повышенными правами.

Вы можете запустить сценарий или приложение с повышенными правами, выполнив один из следующих методов:

**Запуск скрипта в режиме с повышенными правами**

1.  Откройте окно командной строки, щелкнув правой кнопкой мыши пункт Командная строка в меню Пуск и выбрав команду **Запуск от имени администратора**.
2.  Запланируйте выполнение скрипта с повышенными правами с помощью планировщик задач. Дополнительные сведения см. в разделе [контексты безопасности для выполняющихся задач](/windows/desktop/TaskSchd/security-contexts-for-running-tasks).
3.  Запустите скрипт, используя встроенную учетную запись администратора.

## <a name="account-needed-to-run-wmi-command-line-tools"></a>Учетная запись, необходимая для запуска средств Command-Line инструментария WMI

Чтобы запустить следующие [средства Command-Line WMI](wmi-command-line-tools.md), ваша учетная запись должна входить в группу администраторов, и средство должно быть запущено из командной строки с повышенными привилегиями. Встроенная учетная запись администратора также может запускать эти средства.

-   [**mofcomp**](mofcomp.md)

-   [**wmic**](wmic.md)

    При первом запуске WMIC после установки системы его необходимо запустить из командной строки с повышенными привилегиями. Режим с повышенными правами может не требоваться для последующего выполнения WMIC, если только операции WMI не требуют прав администратора.

-   [**инициирует**](winmgmt.md)

-   [**wmiadap**](wmiadap.md)

Чтобы запустить [*элемент управления WMI*](gloss-w.md) (wmimgmt. msc) и внести изменения в параметры безопасности или аудита пространства имен WMI, ваша учетная запись должна иметь явно предоставленное право на изменение безопасности или входить в группу локальных администраторов. Встроенная учетная запись администратора также может изменить безопасность или аудит пространства имен.

Wbemtest.exe, средство командной строки, не поддерживаемое службой поддержки пользователей Майкрософт, может запускаться учетными записями, которые не входят в группу локальных администраторов, если для конкретной операции требуются привилегии, которые обычно предоставляются учетным записям администратора.

## <a name="handling-remote-connections-under-uac"></a>Обработка удаленных подключений в UAC

При подключении к удаленному компьютеру в домене или рабочей группе определяет, выполняется ли фильтрация UAC.

Если компьютер входит в состав домена, подключитесь к целевому компьютеру, используя учетную запись домена, которая находится в локальной группе администраторов удаленного компьютера. После этого фильтрация маркеров доступа UAC не повлияет на учетные записи домена в локальной группе администраторов. Не используйте локальную, недоменную учетную запись на удаленном компьютере, даже если эта учетная запись входит в группу администраторов.

В Рабочей группе Учетная запись, подключенная к удаленному компьютеру, является локальным пользователем на этом компьютере. Даже если учетная запись входит в группу администраторов, фильтрация UAC означает, что сценарий выполняется как обычный пользователь. Рекомендуется создать выделенную локальную группу пользователей или учетную запись пользователя на целевом компьютере специально для удаленных подключений.

Для использования этой учетной записи необходимо настроить безопасность, поскольку учетная запись никогда не имела прав администратора. Укажите локального пользователя:

-   Удаленный запуск и активация прав доступа к DCOM. Дополнительные сведения см. в разделе [Подключение к WMI на удаленном компьютере](connecting-to-wmi-on-a-remote-computer.md).
-   Права на удаленный доступ к пространству имен WMI (удаленное включение). Дополнительные сведения см. [в разделе доступ к пространствам имен WMI](access-to-wmi-namespaces.md).
-   Право доступа к конкретному защищаемому объекту в зависимости от безопасности, необходимой для объекта.

Если вы используете локальную учетную запись, так как она находится в Рабочей группе или является учетной записью локального компьютера, может быть принудительно предоставлять определенные задачи локальному пользователю. Например, можно предоставить пользователю право на отключение или запуск определенной службы с помощью команды SC.exe, методов [**жетсекуритидескриптор**](/windows/desktop/CIMWin32Prov/getsecuritydescriptor-method-in-class-win32-service) и [**сетсекуритидескриптор**](/windows/desktop/CIMWin32Prov/setsecuritydescriptor-method-in-class-win32-service) [**\_ службы Win32**](/windows/desktop/CIMWin32Prov/win32-service)или с помощью групповая политика с помощью gpedit. msc. Некоторые защищаемые объекты могут не позволить обычным пользователям выполнять задачи и не предоставлять никаких средств для изменения параметров безопасности по умолчанию. В этом случае может потребоваться отключить контроль учетных записей, чтобы локальная учетная запись пользователя не была отфильтрована и вместо нее стала полным администратором. Имейте в виду, что в целях безопасности следует отключать контроль учетных записей в крайнем случае.

Отключение удаленного контроля учетных записей путем изменения записи реестра, управляющей удаленным контролем учетных записей, не рекомендуется, но может потребоваться в Рабочей группе. Запись реестра — **hKey \_ Local \_ Machine** \\ **Software** \\ **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Policies** \\ **System** \\ **LocalAccountTokenFilterPolicy**. Если значение этой записи равно нулю (0), то включена фильтрация маркеров доступа для удаленного контроля учетных записей. Если значение равно 1, то удаленное управление учетными записями отключено.

## <a name="uac-effect-on-wmi-data-returned-to-scripts-or-applications"></a>Воздействие UAC на данные WMI, возвращаемые в скрипты или приложения

Если сценарий или приложение выполняется под учетной записью в группе "Администраторы", но не запущена с повышенными привилегиями, вы можете не получить все возвращенные данные, так как эта учетная запись выполняется от имени обычного пользователя. [*Поставщики*](gloss-p.md) WMI для некоторых классов не возвращают все экземпляры в учетную запись обычного пользователя или учетную запись администратора, которая не работает как полный администратор из-за фильтрации UAC.

Следующие классы не возвращают некоторые экземпляры, если учетная запись фильтруется по контролю учетных записей:

-   [**\_Шина Win32**](/windows/desktop/CIMWin32Prov/win32-bus)
-   [**\_Принтер Win32**](/windows/desktop/CIMWin32Prov/win32-printer)
-   [**\_Компоненткатегори Win32**](/windows/desktop/CIMWin32Prov/win32-componentcategory)
-   [**\_Логикалпрограмграупитем Win32**](/windows/desktop/CIMWin32Prov/win32-logicalprogramgroupitem)
-   [**\_Логикалпрограмграуп Win32**](/windows/desktop/CIMWin32Prov/win32-logicalprogramgroup)
-   [**\_NetworkConnection Win32**](/windows/desktop/CIMWin32Prov/win32-networkconnection)
-   [**\_UserAccount Win32**](/windows/desktop/CIMWin32Prov/win32-useraccount)
-   [**\_Принтердривер Win32**](/windows/desktop/CIMWin32Prov/win32-printerdriver)
-   [**\_Портресаурце Win32**](/windows/desktop/CIMWin32Prov/win32-portresource)
-   [**\_Девицемеморяддресс Win32**](/windows/desktop/CIMWin32Prov/win32-devicememoryaddress)

Следующие классы не возвращают некоторые свойства, если учетная запись фильтруется по контролю учетных записей:

-   [**\_NetworkAdapterConfiguration Win32**](/windows/desktop/CIMWin32Prov/win32-networkadapterconfiguration)
-   [**\_Дкомаппликатионсеттинг Win32**](/windows/desktop/CIMWin32Prov/win32-dcomapplicationsetting)
-   [**\_Дкомаппликатион Win32**](/windows/desktop/CIMWin32Prov/win32-dcomapplication)
-   [**\_Основная плата Win32**](/windows/desktop/CIMWin32Prov/win32-baseboard)
-   [**Win32 \_ ComputerSystem**](/windows/desktop/CIMWin32Prov/win32-computersystem)
-   [**\_Сетевого адаптера Win32**](/windows/desktop/CIMWin32Prov/win32-networkadapter)
-   [**\_Мосербоарддевице Win32**](/windows/desktop/CIMWin32Prov/win32-motherboarddevice)
-   [**\_Дискдриве Win32**](/windows/desktop/CIMWin32Prov/win32-diskdrive)
-   [**\_Пнпентити Win32**](/windows/desktop/CIMWin32Prov/win32-pnpentity)
-   [**\_Видеоконтроллер Win32**](/windows/desktop/CIMWin32Prov/win32-videocontroller)
-   [**\_Параллелпорт Win32**](/windows/desktop/CIMWin32Prov/win32-parallelport)
-   [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk)
-   [**\_SystemDriver Win32**](/windows/desktop/CIMWin32Prov/win32-systemdriver)
-   [**\_Иркресаурце Win32**](/windows/desktop/CIMWin32Prov/win32-irqresource)
-   [**\_NetworkProtocol Win32**](/windows/desktop/CIMWin32Prov/win32-networkprotocol)

## <a name="related-topics"></a>См. также

<dl> <dt>

[Сведения об инструментарии WMI](about-wmi.md)
</dt> <dt>

[Доступ к защищаемым объектам WMI](access-to-wmi-securable-objects.md)
</dt> <dt>

[Изменение параметров безопасности доступа для защищаемых объектов](changing-access-security-on-securable-objects.md)
</dt> </dl>

 

 
