---
description: Может потребоваться написать приложение, которое может реагировать на события в любое время.
ms.assetid: 475dca47-b1e5-4362-ab00-9ab9383e92f9
ms.tgt_platform: multiple
title: Получение событий в любое время
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5559068e1e108c6f4185c31f8858a9e4169c50c9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104344732"
---
# <a name="receiving-events-at-all-times"></a>Получение событий в любое время

Может потребоваться написать приложение, которое может реагировать на события в любое время. Например, администратор может захотеть получить сообщение электронной почты, когда определенные меры производительности отклоняются на сетевых серверах. В этом случае приложение должно выполняться в любое время. Однако запуск приложения непрерывно не является эффективным использованием системных ресурсов. Вместо этого инструментарий WMI позволяет создать постоянный потребитель событий. Постоянные потребители событий должны соответствовать особым требованиям безопасности. Дополнительные сведения см. в разделе [Защита событий WMI](securing-wmi-events.md).

Постоянный потребитель событий получает события до тех пор, пока регистрация не будет явно отменена.

Постоянный потребитель событий — это сочетание следующих классов WMI, фильтров и COM-объектов, которые находятся в системе:

-   COM-объект, называемый физическим потребителем. Инструментарий WMI предоставляет несколько стандартных постоянных потребителей. Например, объект-получатель события активного скрипта [выполняет скрипт при возникновении события](running-a-script-based-on-an-event.md).
-   Новый постоянный класс потребителя.
-   Экземпляр постоянного класса потребителя, называемый логическим потребителем.
-   Фильтр, содержащий запрос для событий.
-   Связь между потребителем и фильтром.

Свойства логического потребителя событий указывают действия, выполняемые при уведомлении о событии, но не определяют запросы событий, с которыми они связаны. При получении сигнала WMI автоматически загружает COM-объект, представляющий постоянного потребителя событий, в активную память. Как правило, это происходит во время запуска или в ответ на событие, вызывающее срабатывание. После активации постоянный потребитель событий выступает в качестве обычного потребителя событий, но остается до тех пор, пока не выгружается операционной системой.

Вы можете создать собственный постоянный потребитель событий или использовать предустановленные [стандартные классы потребителей](standard-consumer-classes.md)WMI, такие как [**активескриптевентконсумер**](activescripteventconsumer.md). Дополнительные сведения см. в статьях [стандартные классы потребителей](standard-consumer-classes.md), [мониторинг и реагирование на события с помощью стандартных потребителей](monitoring-and-responding-to-events-with-standard-consumers.md)и [наблюдение за событиями](monitoring-events.md).

В следующей процедуре описывается создание собственного постоянного потребителя событий.

**Создание собственного постоянного потребителя событий**

1.  Определите тип событий, которые вы хотите получить.

    Инструментарий WMI поддерживает внутренние и внешние события. Внутреннее событие — это событие, предопределенное WMI, в то время как внешнее событие является событием, определенным сторонним поставщиком. Дополнительные сведения см. [в разделе Определение типа получаемого события](determining-the-type-of-event-to-receive.md).

2.  [Реализация физического потребителя](implementing-a-physical-consumer.md).

    Основное различие между приложением управления и [*физическим потребителем*](gloss-p.md) заключается в том, что пользователь загружает и выгружает приложение управления, тогда как инструментарий WMI загружает и выгружает физического потребителя. Большая часть кода должна быть в физическом потребителе.

    > [!Note]  
    > Этот шаг является первым в процедуре для простоты объяснения. С точки зрения программирования, необходимо создать физический потребитель. Таким образом вы сможете разместить параметры и логику для постоянного поставщика событий, прежде чем начать длинное программирование. Однако сначала нет ограничений на написание физического потребителя.

     

3.  [Создайте новый класс-получатель, описывающий физического потребителя](creating-a-new-permanent-event-consumer-class.md).

    Как и любой класс, класс-потребитель описывает общие параметры постоянного потребителя событий для WMI.

4.  [Создайте экземпляр класса-получателя](creating-a-logical-consumer.md).

    Как и любой другой класс WMI, необходимо создать экземпляр класса-получателя, если требуется реализовать класс. Экземпляр класса-получателя также известен как [*логический потребитель*](gloss-l.md). Логический потребитель представляет физического потребителя в WMI.

5.  [Создайте фильтр событий](creating-an-event-filter.md).

    Запросы событий, активирующие постоянные потребители событий, называются [*фильтрами событий*](gloss-e.md). Один фильтр событий может быть связан с несколькими потребителями логических событий. Более того, с одним потребителем логического события можно связать несколько фильтров событий. Фильтр является экземпляром [**\_ \_ EventFilter**](--eventfilter.md).

    Событие журнала NT создается при сбое запроса непостоянного потребителя событий. Источник события — WinMgmt, идентификатор события — 10, а тип события — ошибка.

6.  [Свяжите фильтр событий с логическим потребителем](binding-an-event-filter-with-a-logical-consumer.md).

    Связывая фильтр событий с логическим потребителем, вы указываете инструментарию WMI о том, какой фильтр событий принадлежит логическому потребителю. Логические потребители событий и фильтры событий связаны экземпляром класса Association объекта [**\_ \_ филтертоконсумербиндинг**](--filtertoconsumerbinding.md). Когда получено событие, совпадающее с запросом события, описанным в фильтре событий, Инструментарий WMI находит связанный объект-получатель логического события, просмотрев экземпляр класса Association. После обнаружения экземпляра потребителя логических событий Инструментарий WMI использует экземпляр класса [**\_ \_ евентконсумерпровидеррегистратион**](--eventconsumerproviderregistration.md) для поиска и запуска физического потребителя событий, связанного с этим экземпляром.

7.  [Написание поставщика потребителей событий](writing-an-event-consumer-provider.md).

    Поставщик потребителей событий — это COM-объект, который находит физического потребителя для WMI.

 

 



