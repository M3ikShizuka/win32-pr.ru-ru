---
description: Чтобы создать поставщик классов WMI, необходимо зарегистрировать \_ \_ экземпляр Win32Provider, представляющий поставщика, с помощью экземпляра \_ \_ класспровидеррегистратион.
ms.assetid: ed834969-47e9-47df-9db8-c805b2eb71da
ms.tgt_platform: multiple
title: Регистрация поставщика класса
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7bc15893e654f96f8c4e476219389a1f8f2c464a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991518"
---
# <a name="registering-a-class-provider"></a>Регистрация поставщика класса

Чтобы создать поставщик классов WMI, необходимо зарегистрировать экземпляр [**\_ \_ Win32Provider**](--win32provider.md) , представляющий поставщика, с помощью экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md). В качестве COM-объекта поставщик должен зарегистрироваться в операционной системе и инструментарии WMI. В следующей процедуре предполагается, что вы уже реализовали процесс регистрации, как описано в статье [Регистрация поставщика](registering-a-provider.md). Если поставщик хранит большинство данных в репозитории WMI и эти данные обновляются только при инициализации WMI, зарегистрируйте свой класс как поставщик класса push-уведомлений. Если данные, которые вы предоставляете, часто изменяются и динамически извлекаются в коде при каждом запросе от WMI, зарегистрируйте поставщик в качестве поставщика опрашивающего класса.

В следующей процедуре описывается регистрация поставщика класса push-уведомлений.

**Регистрация поставщика класса push-уведомлений**

-   Задайте для свойства **интерактионтипе** экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) значение 1.

    Создание экземпляра [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) является частью процесса регистрации.

В следующей процедуре описывается регистрация поставщика опрашивающего класса.

**Регистрация поставщика опрашивающего класса**

1.  Создайте экземпляр класса [**\_ \_ Win32Provider**](--win32provider.md) , который описывает поставщик.
2.  Создайте экземпляр класса [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) , описывающий набор функций поставщика.

    В экземпляре [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) :

    1.  Задайте свойство **интерактионтипе** , чтобы указать, является ли поставщик поставщиком Push или Pull.
    2.  Пометьте класс как как [**динамический**](standard-wmi-qualifiers.md) , так и квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) .

        [**Динамический**](standard-wmi-qualifiers.md) квалификатор сигнализирует, что инструментарий WMI должен использовать поставщик для получения экземпляров класса. Квалификатор [**поставщика**](/windows/desktop/api/Provider/nl-provider-provider) указывает имя поставщика, который должен использовать WMI.

    3.  Определите свойства **ресултсеткуериес**, **референцедсеткуериес** и **унсуппортедкуериес** .

        Эти свойства запроса описывают подробные сведения о поддерживаемом классе.

Кроме описания различных поддерживаемых методов класса, класс [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md) также имеет три свойства, описывающих последовательность запросов. При совместном использовании эти три свойства описывают весь диапазон классов, предоставляемых поставщиком классов. Каждое свойство запроса содержит инструкцию WQL SELECT, называемую "запрос схемы", для указания типов поддерживаемых классов. Запросы схемы указывают специальное имя класса, называемое meta \_ Class. В следующей таблице перечислены свойства запроса.



| Свойство                 | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ресултсеткуериес**     | Содержит сведения о результирующем наборе, предоставленном поставщиком. Инструментарий WMI использует эти сведения, чтобы определить, следует ли вызывать поставщик для удовлетворения запроса из приложения. Это свойство описывает либо набор всех классов, которые может предоставить поставщик, либо надмножество доступных классов, но никогда не является подмножеством. Инструментарий WMI требует, чтобы поставщик указал хотя бы один запрос в этом свойстве.<br/> В следующем примере показано, как задать **ресултсеткуериес** , когда поставщик предоставляет класс ассоциации, который ссылается на класс [**Win32 \_ LogicalDisk**](/windows/desktop/CIMWin32Prov/win32-logicaldisk) .<br/> `SELECT * FROM meta_class WHERE __Class = "Win32_LogicalDisk"`<br/> В следующем примере показано, как задать общий запрос, когда поставщик предоставляет классы, ссылающиеся на другие неизвестные классы.<br/> `SELECT * FROM meta_class`<br/> В следующем примере показано, как задать **ресултсеткуериес** , когда поставщик предоставляет только подклассы, но не родительский класс данного класса.<br/> `SELECT * FROM meta_class WHERE __Dynasty = "MyClass"`<br/> В следующем примере показано, как использовать специальное \_ \_ свойство и Set **ресултсеткуериес** , если поставщик предоставляет все классы и подклассы.<br/> `SELECT * FROM meta_class WHERE __this ISA "MyClass"`<br/> |
| **референцедсеткуериес** | Определяет, следует ли обходить поставщик в запросах схемы, где запрашиваются ассоциации и ссылки. Поставщики, которые могут предоставлять классы ассоциаций, должны содержать по крайней мере один запрос в своем свойстве **референцедсеткуериес** .<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **унсуппортедкуериес**   | Содержит сведения о результирующем наборе, который не предоставляется поставщиком класса. Инструментарий WMI использует это свойство для вычитания из набора классов, подразумеваемых **ресултсеткуериес**. Например, поставщик класса может указать в **ресултсеткуериес** support для всех классов, производных от MyClass, и указать в **унсуппортедкуериес** отсутствие поддержки для одного конкретного производного класса.<br/> Чем больше информации поставщик может зарегистрировать о своих возможностях обработки запросов, тем быстрее она выполняется. Ввод одного или нескольких запросов в свойстве **унсуппортедкуериес** является одним из способов, которые особенно важны, когда поставщик использует класс, который он не предоставляет. При запросе к классу, указанному в запросе в свойстве **унсуппортедкуериес** , Инструментарий WMI может предоставить сам класс или вызвать альтернативный поставщик, чтобы предоставить его.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                             |



 

Поскольку Инструментарий WMI не поддерживает предложение OR, необходимо создать отдельный запрос для каждого класса.

Следующие запросы указываются в **ресултсеткуериес** , когда поставщик класса предоставляет MyClass1, MyClass2 и MyClass3.


```sql
SELECT * FROM meta_class WHERE __Class = "MyClass1"
SELECT * FROM meta_class WHERE __Class = "MyClass2"
SELECT * FROM meta_class WHERE __Class = "MyClass3"
```



Только администраторы могут регистрировать или удалять поставщик, создавая экземпляр [**\_ \_ Win32Provider**](--win32provider.md) и [**\_ \_ класспровидеррегистратион**](--classproviderregistration.md).

 

