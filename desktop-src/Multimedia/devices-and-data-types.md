---
title: Устройства и типы данных
description: Устройства и типы данных
ms.assetid: 46247983-19c3-4c7a-a615-ba6cd8bd3289
keywords:
- звуковая волна, открытие выходных устройств
- аудио-интерфейс, открытие выходных устройств
- Открытие звуковых устройств аудио
- звуковая волна, запросы к выходным устройствам
- аудио-интерфейс, запрос устройств вывода
- запрос звуковых устройств аудио
- звуковая волна, дескрипторы устройств
- аудио-интерфейс, дескрипторы устройств
- звуковая волна, идентификаторы устройств
- волна-Audio Interface, идентификаторы устройств
- звуковая волна, типы выходных данных
- волна — аудио-интерфейс, типы выходных данных
- звуковая волна, форматы данных
- волна — аудио-интерфейс, форматы данных
- запись аудио-данных
- звуковая волна, запись данных
- волна — аудио-интерфейс, запись данных
- Волны PCM, звуковые данные
- звуковая волна, данные PCM
- аудио-интерфейс, данные PCM
- звуковая волна, закрытие выходных устройств
- аудио-интерфейс, закрытие выходных устройств
- Закрытие звуковых устройств аудио
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 29561a74695fb8bde950e2e75a430803a1a0351b
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "105650346"
---
# <a name="devices-and-data-types"></a>Устройства и типы данных

В этом разделе описывается работа с устройствами аудио-аудиосигнала, а также сведения о том, как открывать, закрывать и запрашивать их возможности. В нем также описывается отслеживание устройств в системе с помощью дескрипторов устройств и идентификаторов устройств.

## <a name="opening-waveform-audio-output-devices"></a>Открытие Waveform-Audio выходных устройств

Используйте функцию [**вавеаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen) , чтобы открыть выходное устройство звуковой волны для воспроизведения. Эта функция открывает устройство, связанное с указанным идентификатором устройства, и возвращает маркер открытого устройства путем записи маркера указанного расположения в памяти.

Некоторые мультимедийные компьютеры имеют несколько выходных устройств аудио-звука. Если вы не хотите открывать конкретное устройство вывода аудио-звука в системе, при \_ открытии устройства следует использовать флаг СОПОСТАВИТЕЛЯ Wave для идентификатора устройства. Функция **вавеаутопен** выбирает устройство в системе, которое лучше воспроизводить указанный формат данных.

## <a name="querying-audio-devices"></a>Запросы к звуковым устройствам

Windows предоставляет следующие функции для определения того, сколько устройств определенного типа доступно в системе.



| Функция                                       | Описание                                                                  |
|------------------------------------------------|------------------------------------------------------------------------------|
| [**ауксжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-auxgetnumdevs)         | Возвращает количество дополнительных выходных устройств, имеющихся в системе.      |
| [**вавеинжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetnumdevs)   | Возвращает число устройств ввода аудио-аудиосигнала, имеющихся в системе.  |
| [**вавеаутжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetnumdevs) | Возвращает число устройств вывода аудио-звука, имеющихся в системе. |



 

Звуковые устройства идентифицируются по идентификатору устройства. Идентификатор устройства определяется неявно на основе числа устройств, имеющихся в системе. Идентификаторы устройств находятся в диапазоне от 0 до меньшего числа имеющихся устройств. Например, если в системе есть два выходных устройства аудио-звука, допустимые идентификаторы устройств: 0 и 1.

После определения количества устройств определенного типа в системе можно использовать одну из следующих функций для запроса возможностей каждого устройства.



| Функция                                       | Описание                                                             |
|------------------------------------------------|-------------------------------------------------------------------------|
| [**ауксжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-auxgetdevcaps)         | Получает возможности указанного вспомогательного устройства вывода.      |
| [**вавеинжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps)   | Получает возможности указанного устройства ввода аудио-сигнала.  |
| [**вавеаутжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) | Получает возможности указанного устройства вывода аудио-звука. |



 

Каждая из этих функций заполняет структуру данными о возможностях указанного устройства. В следующей таблице перечислены структуры, соответствующие каждой из этих функций.



|                                                |                                    |
|------------------------------------------------|------------------------------------|
| Функция                                       | Структура                          |
| [**ауксжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-auxgetdevcaps)         | [**аукскапс**](/windows/win32/api/mmeapi/ns-mmeapi-auxcaps)         |
| [**вавеинжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetdevcaps)   | [**вавеинкапс**](/windows/win32/api/mmeapi/ns-mmeapi-waveincaps)   |
| [**вавеаутжетдевкапс**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetdevcaps) | [**вавеауткапс**](/windows/win32/api/mmeapi/ns-mmeapi-waveoutcaps) |



 

Стандартные форматы перечислены в элементе **двформатс** структуры **вавеауткапс** . Аудио-устройства могут поддерживать нестандартные форматы. Чтобы определить, поддерживается ли устройством определенный формат (стандартный или нестандартный), можно вызвать функцию [**вавеаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen) с \_ \_ флагом запроса Wave Format. Этот флаг не открывает устройство. Вы указываете нужный формат в структуре [**вавеформатекс**](/windows/win32/api/mmeapi/ns-mmeapi-waveformatex) , на которую указывает параметр *пвфкс* , передаваемый в **вавеаутопен**.

Устройства вывода аудио-файлов имеют различные возможности. Элемент **двсуппорт** структуры [**вавеауткапс**](/windows/win32/api/mmeapi/ns-mmeapi-waveoutcaps) указывает, поддерживает ли устройство такие возможности, как изменения громкости и шага.

## <a name="device-handles-and-device-identifiers"></a>Дескрипторы устройств и идентификаторы устройств

Каждая функция, открывающая звуковое устройство, указывает идентификатор устройства, указатель на расположение в памяти и некоторые параметры, уникальные для каждого типа устройства. Область памяти заполняется с помощью маркера устройства. Используйте этот маркер устройства для обнаружения открытого звукового устройства при вызове других звуковых функций.

Различие между идентификаторами и дескрипторами для звуковых устройств является неочевидным, но важным:

-   Идентификаторы устройств определяются неявно на количестве устройств, имеющихся в системе. Это число получается с помощью функции [**ауксжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-auxgetnumdevs), [**вавеинжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-waveingetnumdevs)или [**вавеаутжетнумдевс**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutgetnumdevs) .
-   Дескрипторы устройств возвращаются при открытии драйверов устройств с помощью функции [**вавеинопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveinopen) или [**вавеаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen) .

Нет функций, которые открывают или закрывают вспомогательные звуковые устройства. Вспомогательные звуковые устройства не должны открываться и закрываться как устройства аудио-аудио, так как с ними не связана непрерывная отправка данных. Все вспомогательные функции аудио используют идентификаторы устройств для идентификации устройств.

## <a name="waveform-audio-output-data-types"></a>Типы выходных данных Waveform-Audio

Для выходных функций аудио-звука определены следующие типы данных.



| Тип                                 | Описание                                                                                                                                                   |
|--------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **хвавеаут**                         | Обработчик для устройства вывода с открытым аудио-данным.                                                                                                               |
| [**вавеформатекс**](/windows/win32/api/mmeapi/ns-mmeapi-waveformatex) | Структура, указывающая форматы данных, поддерживаемые устройством ввода аудио-сигнала. Эта структура также уседфор звуковые устройства ввода аудио. |
| [**вавехдр**](/windows/win32/api/mmeapi/ns-mmeapi-wavehdr)           | Структура, используемая в качестве заголовка для блока входных данных аудио-сигнала. Эта структура также используется для устройств ввода аудиосигнала.                            |
| [**вавеауткапс**](/windows/win32/api/mmeapi/ns-mmeapi-waveoutcaps)   | Структура, используемая для запроса возможностей определенного устройства вывода аудио-звука.                                                                        |



 

## <a name="specifying-waveform-audio-data-formats"></a>Указание Waveform-Audio форматов данных

При вызове функции [**вавеаутопен**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutopen) для открытия драйвера устройства для воспроизведения или запроса того, поддерживает ли драйвер определенный формат данных, используйте параметр *пвфкс* , чтобы указать указатель на структуру [**вавеформатекс**](/windows/win32/api/mmeapi/ns-mmeapi-waveformatex) , содержащую запрошенный формат данных аудио-звука. **Вавеформатекс** заменяет структуры [**вавеформат**](/windows/win32/api/mmreg/ns-mmreg-waveformat) и [**пкмвавеформат**](/windows/win32/api/mmreg/ns-mmreg-pcmwaveformat) .

Для звуковых данных, разделенных на более двух каналов или имеющих размер выборки, не кратный 8, следует использовать [**вавеформатекстенсибле**](/windows/win32/api/mmreg/ns-mmreg-waveformatextensible). Эта структура просто настраивает дополнительные байты, на которые указывает член **кбсизе** в **вавеформатекс** , чтобы предоставить дополнительные сведения о формате. **Вавеформатекстенсибле** можно привести как **вавеформатекс**.

Есть также два формата буфера обмена, которые можно использовать для представления звуковых данных: CF \_ Wave и CF \_ Metallica. Используйте формат CF, \_ чтобы представить данные в одном из стандартных форматов, например в формате PCM 11 кГц или 22 кГц. Используйте формат CF \_ Metallica для представления более сложных форматов данных, которые не могут быть представлены как стандартные аудио-файлы.

## <a name="writing-waveform-audio-data"></a>Запись Waveform-Audio данных

После успешного открытия драйвера устройства вывода аудио-аудио можно начать воспроизведение звука. Windows предоставляет функцию [**вавеаутврите**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutwrite) для отправки блоков данных в устройства вывода аудио-сигнала.

Используйте структуру [**вавехдр**](/windows/win32/api/mmeapi/ns-mmeapi-wavehdr) , чтобы указать блок данных звуковой волны, отправляемый с помощью **вавеаутврите**. Эта структура содержит указатель на блок заблокированных данных, длину блока данных и некоторые флаги. Этот блок данных должен быть подготовлен перед использованием. Дополнительные сведения о подготовке блока данных см. в разделе [Звуковые блоки данных](audio-data-blocks.md).

После отправки блока данных на выходное устройство с помощью **вавеаутврите** необходимо дождаться завершения работы драйвера устройства с блоком данных перед его освобождением. При отправке нескольких блоков данных необходимо отслеживать завершение блоков данных, чтобы выяснить, когда отправлять дополнительные блоки. Дополнительные сведения о блоках данных см. в разделе [Звуковые блоки данных](audio-data-blocks.md).

## <a name="pcm-waveform-audio-data-format"></a>Формат данных PCM Waveform-Audio

Элемент **лпдата** структуры [**вавехдр**](/windows/win32/api/mmeapi/ns-mmeapi-wavehdr) поинтсеттс к образцам данных аудио-Audio. Для 8-разрядных данных PCM каждый пример представлен одним неподписанным байтом данных. Для 16-разрядных данных PCM каждый пример представлен 16-битным значением со знаком. В следующей таблице перечислены максимальные, минимальные и средние значения для звуковых данных PCM (волны).



|             |                 |                  |                |
|-------------|-----------------|------------------|----------------|
| Формат данных | Максимальное значение   | Минимальное значение    | Среднее значение |
| 8-разрядный PCM   | 255 (0xFF)      | 0                | 128 (0x80)     |
| 16-разрядный PCM  | 32 767 (0x7FFF) | – 32 768 (0x8000) | 0              |



 

## <a name="pcm-data-packing"></a>Упаковка данных PCM

Порядок байтов данных зависит от 8-разрядных и 16-разрядных форматов, а также от форматов Mono и стерео. В следующем списке описывается упаковка данных для различных форматов данных волновой волны PCM.



| Волновая волна PCM-аудио формат | Описание                                                                                                                                                                                                                                                                                                                                     |
|---------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8-разрядный моно                | Каждый пример имеет один байт, соответствующий одному каналу звука. После примера 1 следуют примеры 2, 3, 4 и т. д.                                                                                                                                                                                                                           |
| 8-разрядный стерео              | Каждый пример имеет размер 2 байта. После примера 1 следуют примеры 2, 3, 4 и т. д. Для каждого примера первым байтом является канал 0 (левый канал), а второй — канал 1 (правый канал).                                                                                                                                               |
| 16-разрядный моно               | Каждый пример имеет размер 2 байта. После примера 1 следуют примеры 2, 3, 4 и т. д. Для каждого примера первый байт является младшим байтом канала 0, а второй — старшим байтом канала 0.                                                                                                                                         |
| 16-разрядный стерео             | Каждый пример имеет 4 байта. После примера 1 следуют примеры 2, 3, 4 и т. д. Для каждого примера первый байт является младшим байтом канала 0 (левый канал); второй байт — старший байт канала 0; третий байт — это младший байт канала 1 (правый канал); четвертый байт — старший байт канала 1. |
| Другие                    | Каждый пример содержится в блоке, который имеет кратное 4 байта, но примеры могут быть не выходящими по байтам. Расположение каналов задается маской. Дополнительные сведения см. в разделе [**вавеформатекстенсибле**](/windows/win32/api/mmreg/ns-mmreg-waveformatextensible).                                                                                                 |



 

## <a name="closing-waveform-audio-output-devices"></a>Закрытие Waveform-Audio выходных устройств

После завершения воспроизведения аудио-сигнала вызовите [**вавеаутклосе**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutclose) , чтобы закрыть выходное устройство. Если **вавеаутклосе** вызывается во время воспроизведения звукового файла, операция закрытия завершается ошибкой и функция возвращает код ошибки, указывающий, что устройство не было закрыто. Если вы не хотите ждать окончания воспроизведения перед закрытием устройства, вызовите функцию [**вавеаутресет**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutreset) перед закрытием. Это завершает воспроизведение и позволяет закрыть устройство. Не забудьте использовать функцию [**вавеаутунпрепарехеадер**](/windows/win32/api/mmeapi/nf-mmeapi-waveoutunprepareheader) для очистки подготовки ко всем блокам данных перед закрытием устройства.

 

 