---
title: Настраиваемые службы
description: Настраиваемые службы
ms.assetid: 98b68205-3a34-4406-84de-bf2c8a5ed5b0
keywords:
- Ввод-вывод файлов мультимедиа, пользовательские службы
- Ввод-вывод файлов, пользовательские службы
- входные и выходные данные (ввод-вывод), пользовательские службы
- Ввод-вывод (входные и выходные данные), пользовательские службы
- пользовательский ввод-вывод
- Функция Ммиоинсталлиопрок
- Функция Ммиупен
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9e41e3c5974fee9903c0864b1cfefccc8354b26a
ms.sourcegitcommit: 9eebab0ead09cecdbc24f5f84d56c8b6a7c22736
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2021
ms.locfileid: "124372153"
---
# <a name="custom-services"></a>Настраиваемые службы

Службы файлового ввода-вывода используют процедуры ввода-вывода для обработки физических входных и выходных данных, связанных с чтением и записью в различные типы систем хранения, таких как архивные системы и системы хранения баз данных. Предопределенные процедуры ввода-вывода существуют для стандартных файловых систем и для файлов памяти, но можно предоставить пользовательскую процедуру ввода-вывода для доступа к уникальной системе хранения с помощью функции [**ммиоинсталлиопрок**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioinstallioproc) .

Чтобы открыть файл с помощью пользовательской процедуры ввода-вывода, используйте функцию [**ммиупен**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) . Включите знак плюс (+) или константу КФСЕПЧАР в имя файла, чтобы отделить имя физического файла от имени элемента файла, который необходимо открыть. В следующем примере открывается элемент File с именем "Element" из файла с именем FILENAME. ДУГИ


```C++
mmioOpen("filename.arc+element", NULL, MMIO_READ); 
```



Когда диспетчер файлового ввода-вывода встречает знак плюс в имени файла, он проверяет расширение имени файла, чтобы определить, какую процедуру ввода-вывода следует связать с файлом. В предыдущем примере диспетчер файлового ввода-вывода попытается использовать процедуру ввода-вывода, связанную с. Расширение имени файла ARC; Эта процедура ввода-вывода была бы установлена с помощью [**ммиоинсталлиопрок**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioinstallioproc). Если процедура ввода-вывода не установлена, [**ммиупен**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) возвращает ошибку.

Процедуры ввода-вывода должны отвечать на следующие сообщения:

-   [**ММИОМ \_ Закрыть**](mmiom-close.md)
-   [**ММИОМ \_ Открыть**](mmiom-open.md)
-   [**ММИОМ \_ чтение**](mmiom-read.md)
-   [**ММИОМ \_ запись**](mmiom-write.md)
-   [**ММИОМ \_ Поиск**](mmiom-seek.md)
-   [**\_Переименование ммиом**](mmiom-rename.md)
-   [**ММИОМ \_ вритефлуш**](mmiom-writeflush.md)

Вы также можете создавать пользовательские сообщения и передавать их в процедуру ввода-вывода с помощью функции [**ммиосендмессаже**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosendmessage) . Если вы определяете собственные сообщения, убедитесь, что они определены на уровне или выше значения, определенного \_ константой пользователя ммиом.

В дополнение к обработке сообщений процедура ввода-вывода должна поддерживать элемент **лдискоффсет** структуры [**ммиоинфо**](/previous-versions//dd757322(v=vs.85)) (на который указывает параметр *лпммиоинфо* функции **ммиупен** ). Элемент **лдискоффсет** всегда должен содержать смещение файла в расположении, \_ к которому будет обращаться следующий ммиом для чтения или ммиом \_ сообщения. Смещение указывается в байтах и задается относительно начала файла. Процедура ввода-вывода может использовать элемент **адвинфо** для сохранения необходимой информации о состоянии. Процедура ввода-вывода не должна изменять никакие другие члены структуры **ммиоинфо** .

 

 