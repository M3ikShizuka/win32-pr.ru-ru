---
title: размещение в Потоки
description: размещение в Потоки
ms.assetid: 97ab491d-1a58-4b4b-a13a-215be24dac1c
keywords:
- Функция Авистреамстарт
- Функция Авистреамфиндсампле
- Функция Авистреамсамплетотиме
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0528fea9ea10e28a418d253bd1abe6c599a952fe95a8c8f6c86807abe0e41159
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119805864"
---
# <a name="positioning-in-streams"></a>размещение в Потоки

Авифиле предоставляет несколько способов для размещения и перехода к положению в потоке данных. Функции и макросы в этом разделе позволяют приложению найти начальную точку, длину и ключевые кадры (содержащие полный образ в примере) в потоке. Функции и макросы также связывают время с позициями в потоке путем вычисления затраченного времени, необходимого для воспроизведения потока от начала до любой точки в потоке.

## <a name="finding-the-starting-position"></a>Поиск начальной должности

Вы можете получить образец номера первого кадра в видеопотоке с помощью функции [**авистреамстарт**](/windows/desktop/api/Vfw/nf-vfw-avistreamstart) . (Кадры фильма могут начинаться в примере 0 или 1 в зависимости от предпочтений автора.) Эти сведения также можно получить с помощью функции [**авистреаминфо**](/windows/desktop/api/Vfw/nf-vfw-avistreaminfoa) . Эта функция сохраняет номер примера в элементе **двстарт** структуры [**авистреаминфо**](/windows/desktop/api/Vfw/ns-vfw-avistreaminfoa) . Время начала первого образца потока можно получить с помощью макроса [**авистреамстарттиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamstarttime) .

Длину потока можно получить с помощью функции [**авистреамленгс**](/windows/desktop/api/Vfw/nf-vfw-avistreamlength) . Эта функция возвращает число выборок в потоке. Эти сведения также можно получить с помощью функции **авистреаминфо** . Эта функция сохраняет длину потока в элементе **двленгс** структуры **авистреаминфо** . Чтобы получить длину потока в миллисекундах, используйте макрос [**авистреамленгстиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamlengthtime) .

В потоке видео каждый пример обычно соответствует кадру видео. Однако могут быть примеры, для которых нет данных видео. При вызове функции [**авистреамреад**](/windows/desktop/api/Vfw/nf-vfw-avistreamread) , указывающей одну из этих позиций, возвращается длина данных в 0 байт. Примеры, содержащие данные, можно найти с помощью функции [**авистреамфиндсампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamfindsample) и указания \_ флага поиска Any.

В потоке звука каждый пример соответствует одному блоку данных звуковых данных. Например, если звуковые данные имеют формат 22 кГц (функция модуляции адаптивного разностного импульса), каждый пример для **авистреамленгс** соответствует блоку из 256 байт сжатых звуковых данных. Этот блок аудиоданных содержит приблизительно 500 аудио образцов при распаковке. Однако функции и макросы Авифиле обрабатывают каждый 256-байтовый блок как единый пример.

> [!Note]  
> Допустимые позиции в диапазоне от начала до конца потока, представляющие собой сумму начальной точки потока и ее длину. Значение, представленное суммой начальной и протяженной позиций, соответствует времени после отрисовки последних данных; Он не содержит никаких данных. Можно получить образец номера, представляющего конец потока, с помощью макроса [**авистреаменд**](/windows/desktop/api/Vfw/nf-vfw-avistreamend) . Можно получить значение времени в миллисекундах, представляющее конец потока, с помощью макроса [**авистреамендтиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamendtime) .

 

## <a name="finding-sample-and-key-frames"></a>Поиск образца и ключевых кадров

Можно выполнять поиск различных типов выборок в потоке с помощью функции [**авистреамфиндсампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamfindsample) . Эта функция ищет образец соответствующего типа в обратном направлении или вперед по потоку, начиная с указанного числа. Можно выполнять поиск различных типов выборок в потоке, указывая флаг в последовательности вызова **авистреамфиндсампле** . Укажите флаг найти \_ любой, чтобы найти непустые примеры или пропустить выборки, в которых отсутствуют данные. Укажите флаг поиска \_ ключа для поиска ключевых кадров, содержащих данные, для подготовки к просмотру полного образа без ссылки на предыдущие кадры. Укажите \_ флаг формата поиска для поиска изменений в формате. **Авистреамфиндсампле** используется в основном с потоками видео.

Несколько макросов, использующих функции Авифиле, дополняют функции потокового поиска. В следующем списке приводится краткое описание каждого макроса. Для макросов, которые выполняют поиск определенной позиции или типа данных, необходимо указать начальное расположение в потоке.



| Макрос                                                                | Описание                                                                                                                 |
|----------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| [**авистреамискэйфраме**](/windows/desktop/api/Vfw/nf-vfw-avistreamiskeyframe)                   | Указывает, является ли образец в указанном потоке ключевым кадром.                                                            |
| [**авистреамнеаресткэйфраме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnearestkeyframe)         | Находит ключевой кадр в или предшествующий указанной позиции в потоке.                                                     |
| [**авистреамнеаресткэйфраметиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnearestkeyframetime) | Определяет время, соответствующее началу ключевого кадра, ближайшего (в или предшествующем) указанному времени в потоке. |
| [**авистреамнеарестсампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamnearestsample)             | Находит ближайший непустой пример в или предшествующей указанной позиции в потоке.                                       |
| [**авистреамнеарестсамплетиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnearestsampletime)     | Определяет время, соответствующее началу выборки, ближайшее к заданному времени в потоке.             |
| [**авистреамнексткэйфраме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnextkeyframe)               | Находит следующий ключевой кадр, следующий за заданной позицией в потоке.                                                      |
| [**авистреамнексткэйфраметиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnextkeyframetime)       | Возвращает время следующего ключевого кадра в потоке, начиная с заданного времени.                                               |
| [**авистреамнекстсампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamnextsample)                   | Находит следующий непустой пример из указанной позицией в потоке.                                                     |
| [**авистреамнекстсамплетиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamnextsampletime)           | Возвращает время, в течение которого образец изменяется на следующий образец в потоке.                                                    |
| [**авистреампревкэйфраме**](/windows/desktop/api/Vfw/nf-vfw-avistreamprevkeyframe)               | Находит ключевой кадр, предшествующий указанному положению в потоке.                                                       |
| [**авистреампревкэйфраметиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamprevkeyframetime)       | Возвращает время предыдущего ключевого кадра в потоке, начиная с заданного времени.                                         |
| [**авистреампревсампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamprevsample)                   | Находит непустой пример, предшествующий указанному положению в потоке.                                                 |
| [**авистреампревсамплетиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamprevsampletime)           | Определяет время, в течение которого предыдущий пример заменяет предшествующий элемент в потоке.                                    |
| [**авистреамсамплетосампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamsampletosample)           | Возвращает образец в потоке, который выполняется в то же время, что и пример, происходящий во втором потоке.                     |



 

## <a name="switching-between-samples-and-time"></a>Переключение между образцами и временем

С помощью функции [**авистреамсамплетотиме**](/windows/desktop/api/Vfw/nf-vfw-avistreamsampletotime) можно определить прошедшее время с начала потока до примера. Эта функция преобразует число выборки в значение времени, выраженное в миллисекундах. Для видеокадра (который занимает несколько миллисекунд) это значение представляет время начала воспроизведения образца с момента начала воспроизведения и предполагает воспроизведение видеоклипа с нормальной скоростью. Для примера звука (с несколькими примерами в миллисекундах) значение времени соответствует времени начала воспроизведения примера и предполагает, что поток звука воспроизводится с нормальной скоростью.

И наоборот, можно найти образец номера, связанный со значением времени, с помощью функции [**авистреамтиметосампле**](/windows/desktop/api/Vfw/nf-vfw-avistreamtimetosample) . Эта функция преобразует значение миллисекунды в выборное число и предполагает воспроизведение видеоклипа с нормальной скоростью.

Поскольку **авистреамсамплетотиме** Возвращает время, когда начинается воспроизведение кадра, связь между **авистреамсамплетотиме** и **авистреамтиметосампле** не является действительно обратной. Они определяют расположение в файле более акуратели, чем они определяют время. Например, два последовательных звуковых образца могут воспроизводиться в одной миллисекунде. Использование **авистреамсамплетотиме** для преобразования примеров чисел приведет к одинаковым значениям времени. Если преобразовывать значение времени обратно в пример с помощью **авистреамтиметосампле**, на один пример будет ссылаться.

 

 




