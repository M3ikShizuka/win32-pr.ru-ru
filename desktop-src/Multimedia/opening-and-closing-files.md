---
title: Открытие и закрытие файлов
description: Открытие и закрытие файлов
ms.assetid: 72655d33-f685-4205-a982-f7cd20c59f22
keywords:
- Функция Авифилеопен
- Функция Авифилерелеасе
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cca5cfdce177e119d178ca09dd447b7d4e3b6a52c1881f059b72e4424f9c54c3
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120038324"
---
# <a name="opening-and-closing-files"></a>Открытие и закрытие файлов

Перед чтением или записью приложение должно открыть файл AVI. Чтобы открыть файл AVI, используйте функцию [**авифилеопен**](/windows/desktop/api/Vfw/nf-vfw-avifileopen) . **Авифилеопен** возвращает адрес интерфейса AVI, который содержит маркер открытого файла и увеличивает счетчик ссылок файла.

Функция **авифилеопен** поддерживает флаги, используемые с функцией [OpenFile](/documentation/) . Если приложение записывает в существующий файл, оно должно включать \_ флаг записи в **авифилеопен**. Аналогичным образом, если приложение создает и записывает в новый файл, необходимо включить в \_ \_ **авифилеопен** флаги Create и Write.

При открытии файла с помощью **авифилеопен** можно использовать обработчик файлов по умолчанию или указать пользовательский обработчик файлов для чтения и записи в файл и его потоки данных. В любом случае Авифиле выполняет поиск нужного обработчика файлов в реестре. Необходимо убедиться, что пользовательские обработчики файлов находятся в реестре, прежде чем приложение сможет получить к ним доступ.

Значение счетчика ссылок для файла можно увеличить с помощью функции [**авифилеаддреф**](/windows/desktop/api/Vfw/nf-vfw-avifileaddref) . Например, это может потребоваться при передаче обработчика файлового интерфейса другому приложению или при необходимости сохранения файла при использовании функции, которая обычно закрывает файл.

Вы можете закрыть файл с помощью функции [**авифилерелеасе**](/windows/desktop/api/Vfw/nf-vfw-avifilerelease) . Функция **авифилерелеасе** уменьшает счетчик ссылок файла AVI, сохраняет изменения, внесенные в файл, а когда число ссылок достигает нуля, закрывает файл. Приложения должны сбалансировать количество ссылок, включив вызов **авифилерелеасе** для каждого использования [**авифилеопен**](/windows/desktop/api/Vfw/nf-vfw-avifileopen) и **авифилеаддреф**.

> [!Note]  
> Приложение может открыть файл с одним или несколькими потоками программы. Однако для достижения наилучшей производительности только один поток должен иметь доступ к файлу в любой момент времени.

 

 

 