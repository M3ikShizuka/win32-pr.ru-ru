---
title: Службы формата файлов обмена ресурсами
description: Службы формата файлов обмена ресурсами
ms.assetid: 8526794b-7b40-470f-94f7-935d7dbf9151
keywords:
- файловый ввод-вывод в формате мультимедиа, формат файла обмена ресурсами (Metallica)
- файловый ввод-вывод, формат файла обмена ресурсами (Metallica)
- входные и выходные данные (ввод-вывод), формат файла обмена ресурсами (Metallica)
- Ввод-вывод (входные и выходные данные), формат файла обмена ресурсами (Metallica)
- Функция Ммиупен
- формат файла обмена ресурсами (Metallica)
- Metallica (формат файла обмена ресурсами)
- ВВОД-ВЫВОД METALLICA
- Фрагмент Metallica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50cca3792ccded248951065c7b69f2e50d27e0ba
ms.sourcegitcommit: 9eebab0ead09cecdbc24f5f84d56c8b6a7c22736
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2021
ms.locfileid: "124370857"
---
# <a name="resource-interchange-file-format-services"></a>Службы формата файлов обмена ресурсами

Для файлов мультимедиа предпочтительным форматом является формат файла обмена ресурсами (Metallica). Функции файлового ввода-вывода Metallica работают с базовыми буферизованными и небуферизованными файловыми службами ввода-вывода. Файлы Metallica можно открывать, читать и записывать так же, как и другие типы файлов. Подробные сведения о Metallica см. в разделе [функции и макросы авифиле](avifile-functions-and-macros.md).

Metallica-файлы используют четыре символа для поиска элементов файла. Эти коды представляют собой 32-битные количества, представляющие последовательность из одного до четырех буквенно-цифровых символов ASCII, дополненную справа символами пробела. Тип данных для кодов из четырех символов — **FourCC**. Используйте макрос [**ммиофауркк**](/windows/win32/api/vfw/nf-vfw-mmiofourcc) для преобразования четырех символов в код из четырех символов. Чтобы преобразовать строку, завершающуюся нулем, в код из четырех символов, используйте функцию [**ммиострингтофауркк**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiostringtofourcc) .

Базовый стандартный блок файла Metallica — это *фрагмент*. Фрагмент — это логическая единица мультимедийных данных, например один кадр в видеоролике. Каждый блок содержит следующие поля:

-   Код из четырех символов, указывающий идентификатор блока
-   Значение даублеворд, указывающее размер элемента данных в блоке
-   Поле данных

На следующем рисунке показан фрагмент "Metallica", содержащий два подфрагмента.

![фрагмент Metallica, содержащий два фрагмента изображения](images/mmio1.gif)

Фрагмент, содержащийся в другом фрагменте, является *подблоком*. Единственными фрагментами, которые могут содержать подблокы, являются идентификаторы блоков "Metallica" и "LIST". Фрагмент, содержащий другой фрагмент, называется *родительским фрагментом*. Первый фрагмент в файле Metallica должен быть блоком "Metallica". Все остальные фрагменты в файле являются подфрагментами фрагмента "Metallica".

Фрагменты "Metallica" содержат дополнительное поле в первых четырех байтах поля данных. Это дополнительное поле предоставляет *тип формы* для поля. Тип формы — это код из четырех символов, идентифицирующий формат данных, хранящихся в файле. Например, файлы Microsoft Wave-Audio имеют тип «WAVE».

Блоки "LIST" также включают дополнительное поле в первые четыре байта поля данных. Это дополнительное поле содержит *тип списка* для поля. Тип списка — это код из четырех символов, идентифицирующий содержимое списка. Например, блок "LIST" со списком "INFO" может содержать фрагменты "ИКОП" и "ИКРД", предоставляющие авторские права и сведения о дате создания. На следующем рисунке показан фрагмент "Metallica", содержащий блок "LIST" и один другой подблок (блок "LIST" содержит два подфрагмента).

![блок Metallica, содержащий образ блока списка](images/mmio2.gif)

Службы файлового ввода-вывода содержат две функции, которые можно использовать для перемещения между фрагментами в файле Metallica: [**ммиоасценд**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioascend) и [**ммиодесценд**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiodescend). Эти функции можно использовать как функции верхнего уровня поиска. При пошаговом выполнении в блоке расположение файла устанавливается в поле данных фрагмента (8 байтов с начала фрагмента). Для фрагментов "Metallica" и "LIST" положение файла устанавливается в расположение, следующее за типом или типом списка (12 байт с начала фрагмента). Когда вы выйдете по возрастанию для фрагмента, положение файла устанавливается в расположение после конца фрагмента.

Чтобы создать новый фрагмент, используйте функцию [**ммиокреатечунк**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiocreatechunk) для записи заголовка блока в текущей позиции в открытом файле. Функции **ммиоасценд**, **ммиодесценд** и **ммиокреатечунк** используют структуру [**ммккинфо**](/windows/win32/api/mmiscapi/ns-mmiscapi-mmckinfo) для указания и получения сведений о блоках "Metallica".

 

 