---
title: Управление MIDI
description: Управление MIDI
ms.assetid: ba03a2a1-d998-498d-ad53-027ba2b6e276
keywords:
- Цифровой интерфейс MIDI, драйвер
- MIDI (цифровой интерфейс музыкального инструмента), с драйвером
- запись аудио MIDI, драйвер
- Драйвер MIDI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 24214dd3f6cd13ca034b2555398f6055e4ce2da1
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127173647"
---
# <a name="managing-midi-thru"></a>Управление MIDI

устройство ввода midi можно подключить непосредственно к выходному устройству midi, чтобы при получении входного устройства с [**MIMным \_**](mim-data.md) сообщением система отправляла сообщение с теми же данными событий MIDI в драйвер выходного устройства. Чтобы подключить устройство вывода MIDI к устройству ввода MIDI, используйте функцию [**мидиконнект**](/windows/win32/api/mmeapi/nf-mmeapi-midiconnect) .

Для достижения наилучшей производительности с несколькими выходами приложение может предоставить специальную форму драйвера вывода MIDI, который называется *драйвером*. Несмотря на то, что система поддерживает подключение только одного выходного устройства MIDI к устройству ввода MIDI, несколько выходных устройств MIDI могут быть подключены к драйверу с. Приложение на такой системе может подключить устройство ввода MIDI к этому устройству через устройство и подключить устройство MIDI к максимальному количеству выходных устройств MIDI по мере необходимости. дополнительные сведения о драйверах см. в документации по драйверу устройства Windows.

## <a name="using-messages-to-manage-midi-recording"></a>Использование сообщений для управления записью MIDI

Следующие сообщения могут быть отправлены в процедуру обратного вызова окна или потока для управления записью MIDI.



| Значение                                          | Значение                                                                                                                                |
|------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| [**MM \_ MIM \_ CLOSE**](mm-mim-close.md)         | Отправляется, когда устройство ввода MIDI закрывается с помощью функции [**мидиинклосе**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) .                                      |
| [**\_MIM \_ данных MM**](mm-mim-data.md)           | Отправляется при получении полного сообщения MIDI. (Это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы.)          |
| [**\_ошибка MIM \_ MM**](mm-mim-error.md)         | Отправляется при получении недопустимого сообщения MIDI. (Это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы.)          |
| [**MM \_ MIM \_ лонгдата**](mm-mim-longdata.md)   | Посылается, когда получается сообщение об истечении времени, полученное системой MIDI, или когда буфер заполнен данными, исключающие данные из системы.     |
| [**MM \_ MIM \_ лонжеррор**](mm-mim-longerror.md) | Посылается, когда получено недопустимое системное сообщение MIDI.                                                                        |
| [**MM \_ MIM \_ MOREDATA**](mm-mim-moredata.md)   | отправляется, когда приложение не обрабатывает сообщения [**MIM \_ данных**](mim-data.md) достаточно быстро, чтобы не допустить входного драйвера устройства. |
| [**\_открыт MIM \_ мм**](mm-mim-open.md)           | Отправляется при открытии входного устройства MIDI с помощью функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) .                                        |



 

Параметр *wParam* и параметр *lParam* связаны с каждым из этих сообщений. Параметр *wParam* всегда задает маркер открытого устройства MIDI. параметр *lParam* не используется для [**mm \_ MIM \_ CLOSE**](mm-mim-close.md) и [**mm \_ MIM \_ открытые**](mm-mim-open.md) сообщения.

для сообщения [**MM \_ MIM \_ лонгдата**](mm-mim-longdata.md) *лпмидихдр* указывает адрес структуры [**мидихдр**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) , определяющей буфер для сообщений, исключаемых из системы. Буфер может не быть полностью заполнен, поскольку размер безсистемных сообщений обычно неизвестен перед записью, а так как буферы, общий размер которых может содержать наибольшее ожидаемое сообщение, должны быть выделены. Чтобы определить объем допустимых данных, имеющихся в буфере, используйте элемент **двбитесрекордед** структуры **мидихдр** .

## <a name="using-a-callback-function-to-manage-midi-recording"></a>Использование функции обратного вызова для управления записью MIDI

Вы можете определить собственную функцию обратного вызова для управления записью устройств ввода MIDI. Функция обратного вызова описана как [**мидиинпрок**](/previous-versions//dd798460(v=vs.85)).

В параметр *вмсг* функции обратного вызова **мидиинпрок** можно отправить следующие сообщения.



| Значение                                   | Значение                                                                                                                                |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| [**MIM \_ ВЫХОДА**](mim-close.md)         | Отправляется, когда устройство закрывается с помощью функции [**мидиинклосе**](/windows/win32/api/mmeapi/nf-mmeapi-midiinclose) .                                               |
| [**MIM \_ DATA**](mim-data.md)           | Посылается при получении полного сообщения MIDI (это сообщение используется для всех сообщений MIDI, кроме сообщений, исключающих систему).           |
| [**MIM \_ ПЛАН**](mim-error.md)         | Посылается, когда получено недопустимое сообщение MIDI (это сообщение используется для всех сообщений MIDI, кроме сообщений, исключаемых из системы).           |
| [**MIM \_ лонгдата**](mim-longdata.md)   | Посылается, когда получается сообщение об истечении времени, полученное системой MIDI, или когда буфер заполнен данными, исключающие данные из системы.     |
| [**MIM \_ лонжеррор**](mim-longerror.md) | Посылается, когда получено недопустимое системное сообщение MIDI.                                                                        |
| [**MIM \_ MOREDATA**](mim-moredata.md)   | отправляется, когда приложение не обрабатывает сообщения [**MIM \_ данных**](mim-data.md) достаточно быстро, чтобы не допустить входного драйвера устройства. |
| [**MIM \_ ОТКРЫТ**](mim-open.md)           | Посылается при открытии входного устройства MIDI с помощью функции [**мидиинопен**](/windows/win32/api/mmeapi/nf-mmeapi-midiinopen) .                                      |



 

Эти сообщения похожи на те, которые были отправлены в функции процедур Windows, но параметры различны. Обработчик открытого MIDI-устройства передается в качестве параметра функции обратного вызова вместе с даублеворд данных экземпляра, переданного с помощью **мидиинопен**.

для сообщения [**MIM \_ лонгдата**](mim-longdata.md) *лпмидихдр* указывает адрес структуры [**мидихдр**](/windows/win32/api/mmeapi/ns-mmeapi-midihdr) , которая идентифицирует буфер для сообщений, исключаемых из системы. Буфер может быть заполнен неполным. Чтобы определить объем допустимых данных, имеющихся в буфере, используйте элемент **двбитесрекордед** структуры **мидихдр** .

После завершения работы драйвера устройства с блоком данных можно очистить и освободить блок данных.

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[Запись звука MIDI](recording-midi-audio.md)
</dt> </dl>

 

 