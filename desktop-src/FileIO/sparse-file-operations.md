---
description: Определите, поддерживает ли файловая система разреженные файлы, вызвав функцию Жетволумеинформатион.
ms.assetid: a08f6bbc-c139-4396-8964-4aa63285f3f5
title: Операции с разреженными файлами
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2c23d26fc1c52db32ca7674aec2fc487a826e9a6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662532"
---
# <a name="sparse-file-operations"></a>Операции с разреженными файлами

Чтобы определить, поддерживает ли файловая система разреженные файлы, вызовите функцию [**жетволумеинформатион**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) и изучите файл поддержка битового флага **\_ \_ разреженных \_ файлов** , возвращаемого с помощью параметра *лпфилесистемфлагс* .

Большинство приложений не знают о разреженных файлах и не создают разреженные файлы. Тот факт, что приложение считывает разреженный файл, является прозрачным для приложения. Приложение, осведомленное о разреженных файлах, должно определять, подходит ли его набор данных для хранения в разреженном файле. После этого приложение должно явным образом объявить файл как разреженный с помощью [**фсктл \_ Set \_ разреженный**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse) код элемента управления.

После того как приложение настроило разреженный файл, приложение может использовать код элемента управления [**фсктл \_ Set \_ Zero \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) , чтобы установить в качестве региона файла нулевое значение. Кроме того, приложение может использовать [**\_ \_ выделенный \_ запрос фсктл**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_allocated_ranges) , управляющий кодом, чтобы ускорить поиск ненулевых данных в разреженном файле.

При выполнении операции записи (с функцией или операцией, отличной от [**фсктл \_ набора \_ нулевых \_ данных**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)), данные которых состоят из нуля и равны нулю, нули записываются на диск для всей длины записи. Чтобы обнулить диапазон файла и сохранить разреженность, используйте **фсктл \_ набор \_ нулевых \_ данных**.

Приложение, поддерживающее разреженность, также может задавать разреженность существующего файла. Если приложение задает разреженный файл, он должен просканировать файл для регионов, содержащих нули, и использовать [**фсктл \_ \_ нулевые \_ данные**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data) для сброса этих регионов, что может привести к отмене выделения места на физическом диске. Приложение, обновленное до уровня разреженного файла, должно выполнить это преобразование.

При выполнении операции чтения с обнуленной части разреженного файла операционная система может не считывать с жесткого диска. Вместо этого система распознает, что часть файла, которая должна быть считана, содержит нули и возвращает буфер, заполненный нулями без фактического считывания с диска.

Как и в случае с любым другим файлом, система может записывать данные или считывать их из любой места в разреженном файле. Ненулевые данные, записываемые в ранее нулевую часть файла, могут привести к выделению места на диске. Нули, записываемые на ненулевые данные (только с [**\_ нулевым набором \_ \_ данных фсктл**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data)), могут привести к освобождению места на диске.

> [!Note]  
> Приложение может поддерживать разреженность, записывая нули с [**фсктл \_ набором \_ \_ данных**](/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data).

 

Средства дефрагментации, обрабатывающие сжатые файлы в файловых системах NTFS, будут правильно работать с разреженными файлами на томах с файловой системой NTFS. Большие и сильно фрагментированные разреженные файлы могут превысить ограничение NTFS в экстентах диска до того, как будет использовано доступное пространство. Дополнительные сведения см. в разделе [расширение файла может завершиться ошибкой с ошибкой переполнения диска, даже если на томе свободно свободное место](https://support.microsoft.com/default.aspx/kb/957180).

 

 
