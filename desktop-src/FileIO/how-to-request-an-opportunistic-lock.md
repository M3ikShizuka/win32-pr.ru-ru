---
description: Для запроса уступающей блокировки сначала открывается файл с разрешениями и флагами, соответствующими приложению, открывающему файл. Все файлы, для которых будут запрошены уступающей блокировки, должны быть открыты для перекрывающихся (асинхронных) операций.
ms.assetid: a55d38c6-46e3-48e6-9b5b-d4f4234d8c07
title: Как запросить уступающую блокировку
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0dd6b99eb32ce191db78b55c4f8b79dafa340b7
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127057887"
---
# <a name="how-to-request-an-opportunistic-lock"></a>Как запросить уступающую блокировку

Клиентские приложения напрямую запрашивают уступающей блокировку только в том случае, если блокировка предназначена для файла на локальном сервере. При доступе к файлам на удаленных серверах это перенаправитель сети, а не клиентское приложение, которое запрашивает уступающую блокировку с удаленного сервера.

Для запроса уступающей блокировки сначала открывается файл с разрешениями и флагами, соответствующими приложению, открывающему файл. Все файлы, для которых будут запрошены уступающей блокировки, должны быть открыты для перекрывающихся (асинхронных) операций. После открытия файлов для выполнения операции перекрытия Используйте функцию [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) с соответствующим управляющим кодом для запроса уступающей блокировки. Список операций оппортунистической блокировки см. в разделе [операции оппортунистической блокировки](opportunistic-lock-operations.md).

Приложения получают уведомления о разрыве оппортунистической блокировки с помощью члена **Хевент** [**перекрывающейся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуры, связанной с файлом. Приложения также могут использовать такие функции, как [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) и [**хасоверлаппедиокомплетед**](/windows/desktop/api/winbase/nf-winbase-hasoverlappediocompleted). Приложение отвечает за сопоставление правильного файла с поврежденной оппортунистической блокировкой.

Дополнительные сведения об уведомлении см. в разделе [Синхронизация](/windows/desktop/Sync/synchronization).

 

 
