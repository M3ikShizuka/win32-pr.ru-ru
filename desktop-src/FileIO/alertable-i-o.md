---
description: С помощью предупреждений I/O потоки приложений обрабатывают асинхронные запросы ввода-вывода только в том случае, если они находятся в состоянии оповещения.
ms.assetid: d996f1cc-eeab-456b-818b-5307a79effd9
title: Ввод-вывод с оповещением
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8fb830dfadb97051c47b2472eb3e7a3c2d6a0bd0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683047"
---
# <a name="alertable-io"></a>Ввод-вывод с оповещением

С помощью предупреждений I/O потоки приложений обрабатывают асинхронные запросы ввода-вывода только в том случае, если они находятся в состоянии оповещения.

Чтобы понять, когда поток находится в состоянии оповещения, рассмотрим следующий сценарий:

1.  Поток инициирует асинхронный запрос на чтение путем вызова [**реадфиликс**](/windows/desktop/api/FileAPI/nf-fileapi-readfileex) с указателем на функцию обратного вызова.
2.  Поток инициирует асинхронный запрос на запись путем вызова [**вритефиликс**](/windows/desktop/api/FileAPI/nf-fileapi-writefileex) с указателем на функцию обратного вызова.
3.  Поток вызывает функцию, которая извлекает строку данных с удаленного сервера базы данных.

В этом сценарии вызовы [**реадфиликс**](/windows/desktop/api/FileAPI/nf-fileapi-readfileex) и [**вритефиликс**](/windows/desktop/api/FileAPI/nf-fileapi-writefileex) , скорее всего, будут возвращаться перед вызовом функции на шаге 3. В этом случае ядро размещает указатели на функции обратного вызова в очереди асинхронного вызова процедур (APC) потока. Ядро поддерживает эту очередь специально для хранения возвращенных данных запроса ввода-вывода до тех пор, пока они не будут обработаны соответствующим потоком.

Когда выборка строки завершается и поток возвращается из функции, его наивысший приоритет заключается в обработке возвращенных запросов ввода-вывода в очереди путем вызова функций обратного вызова. Для этого необходимо ввести оповещенное состояние. Поток может сделать это, вызвав одну из следующих функций с соответствующими флагами:

-   [**слипекс**](/windows/desktop/api/synchapi/nf-synchapi-sleepex)
-   [**WaitForSingleObjectEx**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobjectex)
-   [**ваитформултиплеобжектсекс**](/windows/desktop/api/synchapi/nf-synchapi-waitformultipleobjectsex)
-   [**сигналобжектандваит**](/windows/win32/api/synchapi/nf-synchapi-signalobjectandwait)
-   [**мсгваитформултиплеобжектсекс**](/windows/desktop/api/winuser/nf-winuser-msgwaitformultipleobjectsex)

Когда поток попадает в состояние оповещения, происходят следующие события:

1.  Ядро проверяет очередь APC потока. Если очередь содержит указатели на функцию обратного вызова, ядро удаляет указатель из очереди и отправляет его в поток.
2.  Поток выполняет функцию обратного вызова.
3.  Шаги 1 и 2 повторяются для каждого указателя, оставшегося в очереди.
4.  Если очередь пуста, поток возвращается из функции, которая поместила ее в состояние оповещения.

В этом сценарии, когда поток переходит в состояние оповещения, он вызывает функции обратного вызова, отправленные в [**реадфиликс**](/windows/desktop/api/FileAPI/nf-fileapi-readfileex) и [**вритефиликс**](/windows/desktop/api/FileAPI/nf-fileapi-writefileex), а затем возвращает из функции, которая поместила ее в оповещенное состояние.

Если поток переходит в состояние оповещения, когда очередь APC пуста, выполнение потока будет приостановлено ядром до тех пор, пока не произойдет одно из следующих событий:

-   Объект ядра, который находится в состоянии ожидания, получает сигнал.
-   Указатель функции обратного вызова помещается в очередь APC.

Поток, использующий обработанные операции ввода-вывода, обрабатывает асинхронные запросы ввода-вывода более эффективно, чем при простом ожидании установленного флага события в структуре [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) , а механизм с оповещением ввода-вывода менее сложен по сравнению с [портами завершения ввода-вывода](i-o-completion-ports.md) . Однако при этом операция ввода-вывода с оповещением возвращает результат запроса ввода-вывода только в поток, который инициировал его. Порты завершения ввода-вывода не имеют этого ограничения.

## <a name="related-topics"></a>См. также

<dl> <dt>

[Асинхронные вызовы процедур](/windows/desktop/Sync/asynchronous-procedure-calls)
</dt> </dl>

 

 
