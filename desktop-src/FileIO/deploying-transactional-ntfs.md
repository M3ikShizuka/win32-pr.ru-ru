---
description: Управление кэшированием в транзакционной NTFS.
ms.assetid: 0fd272ee-cf5f-4ba9-b8aa-ff0016f51d4b
title: Развертывание транзакционной NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd7c44e0ad3b83854e56d18171072a7cb4615d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991542"
---
# <a name="deploying-transactional-ntfs"></a>Развертывание транзакционной NTFS

Транзакционная NTFS (TxF), как и большинство механизмов транзакций, зависит от правильного упорядочения операций записи данных. Обеспечение надлежащего порядка записи требует явного управления кэшированием данных. Для удовлетворения этого требования TxF требует, чтобы дисковые накопители применялись к механизмам управления кэшированием, которые являются частью стандартизированных интерфейсов дисков, таких как SCSI, SATA и ATA.

Механизм управления кэшированием, используемый TxF, — это флаг, известный как функция принудительного доступа к блоку (Фуа). Этот флаг указывает, что диск должен записывать данные в стабильное хранилище мультимедиа до завершения передачи сигнала. В некоторых критических точках транзакции TxF должен выдать Фуа, чтобы гарантировать, что некоторые данные элемента управления, необходимые для успешного отката транзакции, не теряются в случае сбоя питания.

Диски серверного класса (SCSI и волоконный канал) обычно поддерживают флаг Фуа. Начиная с Vista, Windows поддерживает флаг Фуа только для дисков SCSI и волоконного канала.

На жестких дисках (ATA/SATA/USB) система TxF имеет период уязвимости, в ходе которой сбой питания может привести к тому, что система TxF не сможет правильно выполнить откат транзакции, тем самым оставляя данные в несогласованном состоянии, пока не отключен кэш записи диска.

Некоторые адаптеры шины (HBA) и контроллеры хранилища (например, системы RAID) имеют встроенные кэши с зарезервированным аккумулятором. Так как эти устройства сохраняют кэшированные данные в случае сбоя питания, все подключенные к ним диски не должны учитывать флаг Фуа. Кроме того, для диска, источник питания которого защищен с помощью бесперебойного питания (ИБП), не нужно учитывать флаг Фуа. Это связано с тем, что ИБП будут поддерживать мощность, достаточную для очистки кэша на диске.

Отключение кэша записи диска устраняет необходимость использовать диск для использования флага Фуа. Можно отключить кэширование записи на диск, выполнив на диске код управления [**\_ \_ \_ \_ сведениями о кэше**](/windows/desktop/api/WinIoCtl/ni-winioctl-ioctl_disk_set_cache_information) на диске IOCTL. Состояние кэша записи (ON/OFF) будет сохраняться при перезагрузке системы. Выдача этого управляющего кода приведет к очень значительным последствиям для всех операций ввода-вывода, выданных этому диску, что, скорее всего, станет заметным снижением производительности. Использование этого кода элемента управления следует тщательно рассматривать перед развертыванием.

> [!Note]  
> Чтобы система TxF была в состоянии обеспечить единообразную защиту целостности данных за счет ошибок электропитания, в системе должен соответствовать хотя бы один из следующих критериев.
>
> -   Используйте диски серверного класса (SCSI, оптоволоконный канал).
> -   Убедитесь, что диски подключены к адаптеру шины HBA с резервным питанием.
> -   В качестве устройства хранения используйте контроллер хранилища (например, RAID-систему).
> -   Убедитесь, что питание диска защищено ИБП.
> -   Убедитесь, что функция кэширования записи на диск отключена.

 

 

 



