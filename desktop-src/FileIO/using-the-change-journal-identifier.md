---
description: Файловая система NTFS связывает неподписанный 64-разрядный идентификатор с каждым журналом изменений.
ms.assetid: 5ae79460-b69a-4901-a417-1d5358dcba29
title: Использование идентификатора журнала изменений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0483c171b69bcee0faf8df9f325d4ee8ffcb6e904f6aa0cd3c720b83df326e3c
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119015072"
---
# <a name="using-the-change-journal-identifier"></a>Использование идентификатора журнала изменений

Файловая система NTFS связывает неподписанный 64-разрядный идентификатор с каждым журналом изменений. При создании журнала он отмечается этим идентификатором. Файловая система помечает журнал новым идентификатором, в котором существующие записи последовательного номера обновлений (USN) либо могут быть непригодными для использования.

Например, файловая система NTFS отмечает журнал изменений новым идентификатором при перемещении тома из одной версии NTFS в другую, а затем обратно. Такое перемещение может произойти в среде с двойной загрузкой или при работе со съемными носителями.

Чтобы получить идентификатор текущего журнала изменений на указанном томе, используйте код управления [**\_ \_ \_ журнала USN фсктл Query**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) . Для выполнения этого и всех других операций с журналом изменений необходимо иметь права системного администратора. То есть необходимо быть членом группы администраторов.

Когда администратор удаляет и повторно создает журнал изменений, например, когда текущее значение USN приближается к максимально возможному значению USN, значения USN начинают с нуля. Когда файловая система NTFS помечает журнал с новым идентификатором вместо повторного создания журнала, он не сбрасывает USN в ноль, но продолжится с текущего USN. В любом случае все существующие Usnы будут меньше, чем все будущие USN.

Если вам нужны сведения о конкретном наборе записей, используйте код [**управления \_ \_ \_ журнала USN фсктл Query**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) , чтобы получить идентификатор журнала изменений. Затем используйте контрольный код [**фсктл \_ Read \_ USN \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_read_usn_journal) для чтения интересующих записей журнала. Файловая система NTFS возвращает только те записи, которые действительны для журнала, указанного идентификатором.

Приложению требуются записи "USN" и идентификатор для чтения журнала. Это требование обеспечивает проверку целостности для случаев, когда приложение должно игнорировать существующие записи в файле и записи, записанные в предыдущих экземплярах журнала для того же тома.

Чтобы получить интересующие вас записи, необходимо начать с самой старой записи (то есть с наименьшим USN) и выполнить сканирование вперед до тех пор, пока не будет найдена первая интересующая запись.

 

 
