---
description: Оппортунистическая блокировка (также называемая жесткой блокировкой) — это блокировка, размещенная клиентом в файле, размещенном на сервере.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Оппортунистической блокировки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103810450"
---
# <a name="opportunistic-locks"></a>Оппортунистической блокировки

Оппортунистическая блокировка (также называемая жесткой блокировкой) — это блокировка, размещенная клиентом в файле, размещенном на сервере. В большинстве случаев клиент запрашивает уступающую блокировку, чтобы она могла локально кэшировать данные, таким образом уменьшая сетевой трафик и повышая очевидное время ответа. Для сетевых перенаправок используются сетевые перенаправителя на клиентах с удаленными серверами, а также клиентскими приложениями на локальных серверах.

Оппортунистическая блокировка координирует кэширование и согласованность данных между клиентами и серверами и несколькими клиентами. Согласованные данные — это данные, которые являются одинаковыми по сети. Иными словами, если данные согласованы, данные на сервере и все клиенты синхронизируются.

Оппортунистическая блокировки не являются командами клиента на сервере. Они являются запросами от клиента к серверу. С точки зрения клиента они являются уступающей. Другими словами, сервер предоставляет такие блокировки всякий раз, когда другие факторы делают блокировки возможными.

Когда локальное приложение запрашивает доступ к удаленному файлу, реализация уступающей блокировки прозрачна для приложения. Сетевой перенаправитель и сервер, участвующие в открытии, открывают и автоматически закрывают оппортунистической блокировки. Однако оппортунистическая блокировки также можно использовать, когда локальное приложение запрашивает доступ к локальному файлу, а доступ других приложений и процессов должен быть делегирован для предотвращения повреждения файла. В этом случае локальное приложение напрямую запрашивает уступающую блокировку из локальной файловой системы и кэширует файл локально. При таком использовании оппортунистическая блокировка фактически является семафором, управляемым локальным сервером, и в основном используется в целях согласования данных в уведомлениях о доступе к файлам и файлам.

Перед использованием уступающей блокировки в приложении необходимо ознакомиться с режимами доступа к файлам и совместного использования, описанными в разделе [Создание и открытие файлов](creating-and-opening-files.md).

Максимальное количество одновременно создаваемых гибких блокировок ограничено только объемом доступной памяти.

Локальные приложения не должны пытаться запрашивать оппортунистической блокировки с удаленных серверов. Если была предпринята попытка выполнить эту операцию, будет возвращена ошибка [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) .

Оппортунистическая блокировки — это очень ограниченное использование для приложений. Единственная практическая работа — Проверка сетевого перенаправителя или оппортунистической блокировки сервера. Как правило, файловые системы реализуют поддержку уступающей блокировки. Как правило, приложения применяют уступающую управление блокировками к драйверам файловой системы. Любой пользователь, реализующий файловую систему, должен использовать [набор устанавливаемых файловых систем (IFS)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx). Любой пользователь, разрабатывающих драйвер устройства, отличный от устанавливаемой файловой системы, должен использовать [набор драйверов для Windows (WDK)](https://www.microsoft.com/?ref=go).

Уступающей блокировки и связанные с ними операции являются надмножеством части оппортунистической блокировки протокола Интернета (CIFS), Интернет-черновика. Протокол CIFS — это улучшенная версия протокола SMB. Дополнительные сведения см. в [статье Обзор протокола SMB и протокола CIFS](microsoft-smb-protocol-and-cifs-protocol-overview.md). Интернет-черновик CIFS явно определяет, что реализация CIFS может реализовать уступающей блокировку, отклонить их.

В следующих разделах описываются уступающей блокировки.

## <a name="in-this-section"></a>В этом разделе



| Раздел                                                                                                               | Описание                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [Локальное кэширование](local-caching.md)<br/>                                                                       | *Локальное кэширование* данных — это метод, используемый для ускорения сетевого доступа к файлам данных. Он включает кэширование данных на клиентах, а не на серверах, когда это возможно.<br/>                                                                                                                           |
| [Согласование данных](data-coherency.md)<br/>                                                                     | Если данные согласованы, данные на сервере и все клиенты синхронизируются. Один из типов программной системы, обеспечивающей согласованность данных, — это система контроля версий (RCS).<br/>                                                                                                              |
| [Как запросить уступающую блокировку](how-to-request-an-opportunistic-lock.md)<br/>                         | Для запроса уступающей блокировки сначала открывается файл с разрешениями и флагами, соответствующими приложению, открывающему файл. Все файлы, для которых будут запрошены уступающей блокировки, должны быть открыты для перекрывающихся (асинхронных) операций.<br/>                                |
| [Ответ сервера на открытые запросы к заблокированным файлам](server-response-to-open-requests-on-locked-files.md)<br/> | Вы можете уменьшить влияние приложения на другие клиенты и влияние их на приложение, предоставив максимально возможный общий доступ, запросив минимальный уровень доступа и используя наименее агрессивную оппортунистической блокировку, подходящую для вашего приложения.<br/> |
| [Типы уступающей блокировки](types-of-opportunistic-locks.md)<br/>                                         | Описывает уровень 1, уровень 2, пакетную обработку и фильтрацию уступающей блокировки.<br/>                                                                                                                                                                                                                     |
| [Разбиение уступающей блокировки](breaking-opportunistic-locks.md)<br/>                                         | Разбиение уступающей блокировки — это процесс снижения блокировки, которую один клиент имеет на файл, чтобы другой клиент мог открыть файл с оппортунистической блокировкой или без нее.<br/>                                                                                                     |
| [Примеры оппортунистической блокировки](opportunistic-lock-examples.md)<br/>                                           | Схемы представлений сетевого трафика для уступающей блокировки уровня 1, оппортунистической блокировки пакетной службы и фильтра оппортунистической блокировки.<br/>                                                                                                                                                       |
| [Операции оппортунистической блокировки](opportunistic-lock-operations.md)<br/>                                       | Если приложение запрашивает уступающую блокировку, все файлы, для которых он запрашивает блокировки, должны быть открыты для перекрывающихся (асинхронных) входных и выходных данных с помощью функции [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) с флагом **File \_ Flag \_ OVERLAPPED** .<br/>                                   |



 

Дополнительные сведения о уступающей блокировке см. в документе Интернет – черновике CIFS. Все расхождения между этой темой и текущим черным черновиком CIFS должны быть разрешены в соответствии с черновиком CIFS Интернета.

 

