---
description: Служба отслеживания распределенных каналов позволяет клиентским приложениям отслеживать перемещенные источники связей.
ms.assetid: 6f438c72-f23d-4ca4-83bd-fe3bc433ceeb
title: Отслеживание распределенных ссылок и идентификаторы объектов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 62d28e151c21fd5320a41950be7647c1e8e0a88b
ms.sourcegitcommit: 6515eef99ca0d1bbe3e27d4575e9986f5255f277
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "105664951"
---
# <a name="distributed-link-tracking-and-object-identifiers"></a>Отслеживание распределенных ссылок и идентификаторы объектов

Хранение ссылки на файл или каталог с использованием пути и имени файла является ненадежным. Если пользователь переименовывает файл, он разделяет ссылки на этот файл. Если пользователь переименовывает каталог, он разрывает ссылки на файл и все файлы и подкаталоги в дереве каталогов.

**Служба отслеживания распределенных каналов** позволяет клиентским приложениям отслеживать перемещенные источники связей. Клиенты, которые подписываются на службу отслеживания ссылок, могут поддерживать целостность своих ссылок, а объекты могут отслеживаться способом, прозрачным для пользователя.

## <a name="object-identifiers"></a>Идентификаторы объектов

Служба отслеживания ссылок сохраняет свою связь с объектом, используя **идентификатор объекта (ID)**. Идентификатор объекта является необязательным атрибутом, который однозначно определяет файл или каталог на томе.

Индекс всех идентификаторов объектов хранится на томе. Операции rename, Backup и RESTORE сохраняют идентификаторы объектов. Однако операции копирования не сохраняют идентификаторы объектов, так как это нарушает их уникальность.

С идентификаторами объектов можно выполнять следующие операции.

-   Создание
-   Удаление
-   Запрос

При создании идентификатора объекта вы устанавливаете удостоверение файла для службы отслеживания ссылок. И наоборот, при удалении идентификатора объекта Служба отслеживания ссылок прекращает поддерживать ссылки на этот файл. Список кодов управления файловой системой, выполняющих операции с идентификаторами объектов, см. в разделе управляющие [коды управления файлами](file-management-control-codes.md).

Служба отслеживания распределенных каналов отслеживает источники ссылок для ярлыков оболочки и связей OLE в томах файловой системы NTFS. Клиент Link может исправить неработающую связь с обновленной информацией о новом расположении источника связи.

## <a name="link-tracking-features"></a>Функции отслеживания ссылок

Ярлыки оболочки включают эвристику отслеживания ссылок, которая использует алгоритм поиска в виде дерева для поиска соответствия для перемещенного источника связи. Алгоритм поиска основан на последнем известном пути файла и файла, включая дату создания, размер файла, имя файла и расширение.

Связывание OLE включает в себя то же самое эвристическое отслеживание ссылок. Windows также включает в себя то же самое эвристическое отслеживание ссылок с дополнительными улучшениями для поиска пространств имен, чтобы дать результаты в некоторых распространенных сценариях. В число улучшений входит следующая процедура, зависящая от ограничений времени, наложенных клиентским приложением.

**Поиск пространств имен**

1.  Поиск по четырем уровням каталога, начиная с последнего каталога.
2.  Переместитесь вверх на один каталог и повторите шаги 1 и 2 еще три раза, что может привести к получению результатов, если объект переместился поблизости.
3.  Поиск на четырех уровнях вниз от корня рабочего стола, что может привести к получению результатов, если объект перемещен в расположение на том же рабочем столе.
4.  Поиск по четырем уровням в корне на каждом локальном жестком диске.
5.  Повторите шаги 1-3 без ограничения на четыре каталога.

> [!Note]  
> Эти схемы отслеживания ссылок прозрачны для конечного пользователя. Однако они не всегда дают положительный результат и могут занять много времени.

 

Дополнительные сведения о ярлыках оболочки см. в разделе [**ишелллинк**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelllinka).

Дополнительные сведения о связях OLE см. в разделе [**иолелинк**](/windows/win32/api/oleidl/nn-oleidl-iolelink).

Если выполняется ссылка на файл в системе NTFS 3,0 или более поздней версии, а файл перемещается на любой другой том с файловой системой NTFS 3,0 или более поздней версии в пределах того же домена, этот файл может быть найден службой отслеживания, в соответствии с соображениями времени. Кроме того, если файл перемещен за пределы домена или рабочей группы, он будет найден.

Чтобы получить версию тома NTFS, откройте командную строку с правами доступа администратора и выполните следующую команду:

**fsutil fsinfo NTFSInfo** *X * * *:**

где *X* — буква диска тома.

При создании ссылки на файл целевой файл считается **источником ссылки**, а создателем ссылки — **клиентом ссылки**. Например, если создается ярлык оболочки для связи с текстовым документом, то текстовый документ является источником ссылки, а ярлык оболочки — клиентом связи.

Служба DLT хранит ссылки на файлы в следующих ситуациях, происходящих в пределах домена:

-   Исходный файл ссылки перемещается с одного тома файловой системы NTFS на другой в том же домене.
-   Имя компьютера, на котором находится источник связи, переименовывается.
-   Сетевые общие папки на исходном компьютере связи изменяются.
-   Том, содержащий исходный файл ссылки, перемещается на другой компьютер в том же домене.

Служба DLT также пытается поддерживать ссылки в предыдущих ситуациях, даже если они не происходят в домене, то есть они находятся в разных доменах или в Рабочей группе. Ссылки всегда могут храниться в таких ситуациях при изменении общей сетевой папки на компьютере-источнике связи. Их также можно поддерживать при перемещении источника ссылок внутри компьютера. Обычно ссылки могут поддерживаться при перемещении источника ссылок на другой компьютер, но такая форма отслеживания менее надежна со временем.

## <a name="link-tracking-functionality"></a>Функции отслеживания ссылок

Функции отслеживания ссылок в основном реализуются в виде следующих двух системных служб:

-   Клиент отслеживания изменившихся связей
-   Сервер отслеживания распределенных каналов

<dl> <dt>

<span id="Distributed_Link_Tracking_Client"></span><span id="distributed_link_tracking_client"></span><span id="DISTRIBUTED_LINK_TRACKING_CLIENT"></span>Клиент отслеживания распределенных каналов
</dt> <dd>

Клиент отслеживания распределенных ссылок запускается на всех компьютерах и управляет действиями по отслеживанию ссылок для этого компьютера. Эти действия включают поиск источников ссылок и обработку перемещений источников ссылок. При перемещении источника ссылки служба передает сведения на сервер отслеживания распределенных каналов, работающий на контроллерах домена.

</dd> <dt>

<span id="Distributed_Link_Tracking_Server"></span><span id="distributed_link_tracking_server"></span><span id="DISTRIBUTED_LINK_TRACKING_SERVER"></span>Сервер отслеживания распределенных каналов
</dt> <dd>

Сервер отслеживания распределенных каналов выполняется на каждом контроллере домена в домене. Служба принимает уведомления о перемещении файлов и томов из службы отслеживания на компьютере и позволяет клиенту отслеживания распределенных каналов запрашивать текущее расположение источника связи.

Эта служба сервера хранит сведения на контроллерах домена о перемещенных томах и файлах. Сведения о перемещениях не могут увеличиваться сверх определенного размера и автоматически удаляются, если они становятся ненужными.

</dd> </dl>

Службы отслеживания ссылок предоставляются интерфейсами [**ишелллинк**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishelllinka) и [**иолелинк**](/windows/win32/api/oleidl/nn-oleidl-iolelink) . Поэтому они используются ярлыками оболочки. Если при вызове метода [**ишелллинк:: Resolve**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishelllinka-resolve) не удается найти файл референт, например, когда пользователь активирует ярлык оболочки, служба отслеживания вызывается автоматически для поиска файла. Аналогично, когда реализация [**иолелинк**](/windows/win32/api/oleidl/nn-oleidl-iolelink) не может найти файл, например в его методе [**биндтосаурце**](/windows/desktop/api/oleidl/nf-oleidl-iolelink-bindtosource) , он автоматически вызывает службу отслеживания.

## <a name="link-tracking-limitations"></a>Ограничения отслеживания ссылок

Службы отслеживания распределенных каналов доступны только в файловой системе NTFS и доступны только для источников ссылок на NTFS 3,0 или более поздней версии. Таким образом, если источник ссылки перемещен на том файловой системы FAT, данные отслеживания теряются. Кроме того, если источник связи перемещается между NTFS 3,0 или более поздней версией, но компьютер, выполняющий перемещение, работает под управлением более ранней версии Windows, данные отслеживания ссылок теряются. Если данные отслеживания ссылок теряются, в сам исходный файл ссылки не наносится вред, он просто не отслеживается службами отслеживания распределенных каналов.

Чтобы получить версию тома NTFS, откройте командную строку с правами доступа администратора и выполните следующую команду:

**fsutil fsinfo NTFSInfo** *X * * *:**

где *X* — буква диска тома.

Ссылки на файлы на съемных носителях не поддерживаются. Кроме того, служба отслеживания не распознает новый том файловой системы NTFS до тех пор, пока система не будет перезагружена. Новый том может стать доступным из-за повторного разбиения на разделы, переформатирования тома файловой системы FAT в файловую систему NTFS или подключения нового внешнего диска.

 

 
