---
description: Используйте транзакционную NTFS для поддержания целостности данных.
ms.assetid: 886d6075-57e8-47db-aec5-77660d0a53f9
title: Когда следует использовать транзакционную NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 28c0a134a8cb5824337022fedf14fe3db3c6f76c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105663596"
---
# <a name="when-to-use-transactional-ntfs"></a>Когда следует использовать транзакционную NTFS

Приложение может использовать транзакционную NTFS (TxF) для сохранения целостности данных на диске при непредвиденных условиях возникновения ошибки. В общем случае приложение должно использовать TxF, если приложение очищает файлы и использует другие методы для поддержания целостности данных. TxF может улучшить работу и упростить код обработки ошибок приложения, улучшая восстановление после ошибок и надежность. В следующих подразделах этого раздела приведены примеры сценариев использования TxF.

## <a name="updating-a-file"></a>Обновление файла

Обновление файла — это обычная и обычно простая операция. Однако при сбое системы или приложения, когда приложение обновляет данные на диске, результат может быть разрушительным, так как данные пользователя могут быть повреждены при выполнении операции обновления файлов, которая была частично завершена. Надежные приложения часто выполняют сложные последовательности копирования файлов и переименования файлов, чтобы гарантировать, что данные не повреждаются в случае сбоя системы.

TxF упрощает для приложения защиту операций обновления файлов от сбоев системы или приложений. Чтобы безопасно обновить файл, приложение открывает файл в режиме транзакции, вносит необходимые обновления, а затем фиксирует транзакцию. Если во время обновления файла происходит сбой системы или приложения, TxF автоматически восстанавливает файл до начала обновления файла, что позволяет избежать повреждения файлов.

## <a name="multi-file-updates"></a>Обновление нескольких файлов

TxF является еще более важным, если одна логическая операция влияет на несколько файлов. Например, если вы хотите использовать средство для переименования одной из страниц HTML или ASP на веб-сайте, хорошо спроектированное средство также исправит все ссылки для использования нового имени файла. Однако при выполнении этой операции веб-сайт находится в несогласованном состоянии, а некоторые ссылки по-прежнему ссылаются на старое имя файла. После того как операция переименования файла и операция исправления связи обрабатывают одну транзакцию, TxF гарантирует успешное или неудачное исправление имени файла и ссылки.

## <a name="consistent-concurrent-updates"></a>Единообразные одновременные обновления

TxF изолирует параллельные транзакции. Если приложение открывает файл для транзакционного чтения, а другое приложение имеет тот же файл, Открытый для обработки транзакций, TxF изолирует эффекты двух транзакций друг от друга. Иными словами, средство чтения транзакций всегда просматривает единственную согласованную версию файла, даже если этот файл находится в процессе обновления другой транзакции.

Приложение может использовать эту функцию, чтобы позволить клиентам просматривать файлы, а другие клиенты выполняют обновления. Например, транзакционный веб-сервер может предоставлять единое согласованное представление файлов, а другое средство параллельно обновляет эти файлы.

> [!Note]  
> TxF не поддерживает параллельное обновление несколькими модулями записи в разных транзакциях. TxF поддерживает только один модуль записи с несколькими параллельными и последовательными модулями чтения.

 

## <a name="coordinating-with-other-transacted-resource-managers"></a>Координация с другими диспетчерами ресурсов транзакций

Транзакции, используемые с транзакционными файловыми системами, также могут использоваться с реестром транзакций. Обновления файла и реестра координируются с одной транзакцией.

С помощью транзакций [координатор распределенных транзакций](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC) или System. Transactions обновления, ВНОСИМЫЕ в SQL, MSMQ и другие транзакционные ресурсы, можно координировать с помощью транзакционных обновлений файлов. Дополнительные сведения см. в разделе DTC [IKernelTransaction](/previous-versions/windows/desktop/aa344210(v=vs.85)).

## <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

TxF не поддерживает следующие сценарии транзакций:

-   Транзакции на сетевых томах, например в общих файловых ресурсах. Система TxF не поддерживается протоколами CIFS/SMB.
-   Транзакции в любой файловой системе, отличной от NTFS.
-   Транзакционные операции с файлами, кэшированными с помощью кэширования на стороне клиента.
-   Доступ к файлам с помощью идентификаторов объектов.
-   Любой сценарий общего модуля записи.
-   Любая ситуация, когда файл открывается в течение продолжительного периода времени (дни или недели).

 

 
