---
description: По мере добавления, удаления и изменения файлов, каталогов и других объектов файловой системы NTFS файловая система NTFS вводит в потоки записи журнала изменений, по одному для каждого тома на компьютере.
ms.assetid: c41aa3a8-c8d8-4bf2-9bbb-d6a6a556c5e4
title: Записи журнала изменений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 56580a28c01ca164af4598cb290a37c8e36828f5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105684380"
---
# <a name="change-journal-records"></a>Записи журнала изменений

По мере добавления, удаления и изменения файлов, каталогов и других объектов файловой системы NTFS файловая система NTFS вводит в потоки записи журнала изменений, по одному для каждого тома на компьютере. В каждой записи указывается тип изменения и измененный объект. Смещение от начала потока для конкретной записи называется порядковым номером обновления (USN) для конкретной записи. Новые записи добавляются в конец потока.

Файловая система NTFS может удалять старые записи для экономии пространства. Если необходимые записи были удалены, служба индексирования восстанавливается путем повторного индексирования тома, как это происходит, если журнал изменений не существует.

Журнал изменений регистрирует только факт изменения файла и причины изменения (например, операции записи, усечение, увеличение, удаление и т. д.). Он не записывает достаточно информации, чтобы разрешить изменение.

Кроме того, несколько изменений в одном файле могут привести к добавлению только одного флага причин к текущей записи. Если один и тот же тип изменения происходит несколько раз, файловая система NTFS не записывает новую запись для изменений после первой. Например, несколько операций записи без промежуточных операций закрытия и повторного открытия приводят к появлению только одной записи изменений с флагом причины USN \_ \_ \_ набор перезаписи данных причины.

Чтобы продемонстрировать, как работает журнал изменений, предположим, что пользователь обращается к файлу в следующем порядке:

1.  Выполняет запись в файл.
2.  Задает отметку времени для файла.
3.  Выполняет запись в файл.
4.  Усекает файл.
5.  Выполняет запись в файл.
6.  Закрывает файл.

В этом случае файловая система NTFS выполняет следующие действия в журнале изменений (где \| указывает побитовую операцию или).



| Событие                                 | Действие файловой системы NTFS                                                                                                                                                                                                                                                    |
|---------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Начальная операция записи<br/>    | Файловая система NTFS записывает новую запись USN с \_ \_ \_ установленным флагом причины перезаписи данных причины USN. Дополнительные сведения о возможных флагах причин см. в разделе Структура [**\_ записи USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_record_v2) .<br/>                                                     |
| Параметр метки времени файла<br/> | Файловая система NTFS записывает новую запись USN с флажком " \_ \_ \_ перезаписать данные причины USN \| \_ \_ Основные сведения" \_ \_ .<br/>                                                                                                                            |
| Вторая операция записи<br/>     | Файловая система NTFS не записывает новую запись USN. Так как \_ для \_ \_ существующей записи уже задана причина USN, то изменения записи не вносятся.<br/>                                                                                           |
| Усечение файлов<br/>            | Файловая система NTFS записывает новую запись USN с указанием параметра USN \_ Причина \_ перезаписи данных причины USN \_ \| \_ \_ основные \_ сведения \_ изменение \| \_ данных причина \_ \_ усечения.<br/>                                                                                           |
| Третья операция записи<br/>      | Файловая система NTFS не записывает новую запись USN. Так как \_ для \_ \_ существующей записи уже задана причина USN, то изменения записи не вносятся.<br/>                                                                                           |
| Операция закрытия<br/>            | Если пользователь, выполняющий изменения, является единственным пользователем файла, то файловая система NTFS записывает новую запись USN со следующим значением флага: USN \_ Причина \_ \_ Перезаписать \| USN \_ Причина \_ основные \_ сведения \_ изменение USN причина \| \_ \_ усечения данных USN \_ \| \_ Причина \_ закрытия.<br/> |



 

Журнал изменений накапливает ряд записей между первым открытием и последним закрытием файла. Для каждой записи задан новый флаг причины, указывающий на то, что произошло изменение нового типа. Последовательность записей содержит частичную историю файла. Последняя запись, созданная при закрытии файла, добавляет \_ флаг закрытия причины USN \_ . Эта запись представляет сводку изменений в файле, но, в отличие от предыдущих записей, не дает указания на порядок изменений.

Следующий пользователь для доступа к файлу и его изменения создает новую запись USN с одним флагом причины.

 

 




