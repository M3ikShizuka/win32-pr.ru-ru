---
description: Файл, помеченный как зашифрованный, шифруется файловой системой NTFS с использованием текущего драйвера шифрования.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Обработка зашифрованных файлов и каталогов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cf1a3a7b4a2d38aa2f4e012ccb96d01712f280879ff578afdb5c69392ab826a5
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119927794"
---
# <a name="handling-encrypted-files-and-directories"></a>Обработка зашифрованных файлов и каталогов

Программист или пользователь может пометить каталог или файл как зашифрованный. Файл, помеченный как зашифрованный, шифруется файловой системой NTFS с использованием текущего драйвера шифрования. Если позже файл помечается как не зашифрованный, он расшифровывается и остается в обычном текстовом (небезопасном) состоянии.

Каталоги не шифруются. Вместо этого по умолчанию в зашифрованном каталоге все новые файлы в каталоге шифруются при создании. Пользователь должен специально изменить состояние нового файла на расшифровать, если пользователь не хочет, чтобы он был зашифрован. Отображается зашифрованный каталог. Чтобы сделать каталог недоступным для других пользователей, используйте стандартные методы управления доступом.

Функции шифрования не могут использоваться с [API архивации](/windows/desktop/Backup/backup).

Чтобы зашифровать новый файл, используйте функцию [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) с флагом **File \_ \_ Encrypted** . Чтобы зашифровать существующий файл, используйте функцию [**енкриптфиле**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) . Все потоки данных в файле шифруются. Если файл уже зашифрован, **енкриптфиле** не выполняет никаких действий, но возвращает ненулевое значение, которое указывает на успешное выполнение. Если файл сжат, **енкриптфиле** распаковывает файл перед его шифрованием.

Чтобы расшифровать зашифрованный файл, используйте функцию [**декриптфиле**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) . Если файл не зашифрован, **декриптфиле** не выполняет никаких действий, но возвращает ненулевое значение, указывающее на успешное выполнение.

Функция [**енкриптиондисабле**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) отключает или включает шифрование указанного каталога и файлов в нем. Он не влияет на шифрование подкаталогов ниже указанного каталога.

Чтобы получить состояние шифрования файла, используйте функцию [**филинкриптионстатус**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) . Кроме того, можно вызвать функцию [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) и проверить в возвращаемом значении флаг **\_ \_ зашифрованного атрибута файла** .

[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) и [**копифиликс**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) пытаются зашифровать файл назначения с помощью ключей, используемых при шифровании исходного файла. Если это невозможно, обе функции пытаются зашифровать файл назначения с помощью ключей по умолчанию. Если не удается выполнить оба этих метода, **CopyFile** и **копифиликс** завершаются сбоем с ошибкой " **\_ \_ Сбой шифрования ошибки** ". Если вы хотите, чтобы **копифиликс** выполнил операцию копирования, даже если не удается зашифровать целевой файл, включите в параметр *двкопифлагс* в вызове **копифиликс** флажок **\_ \_ \_ расшифровать \_ конечный** флаг.

 

 
