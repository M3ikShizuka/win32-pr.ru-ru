---
description: Разбиение уступающей блокировки — это процесс снижения блокировки, которую один клиент имеет на файл, чтобы другой клиент мог открыть файл с оппортунистической блокировкой или без нее.
ms.assetid: 0356c167-2973-4820-85a9-bc14abcbf163
title: Разбиение уступающей блокировки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74b797feed06c5f02f1b87ff4e05e2d82d44a34f0efe86d7a0881ec1d722023f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119582604"
---
# <a name="breaking-opportunistic-locks"></a>Разбиение уступающей блокировки

Разбиение уступающей блокировки — это процесс снижения блокировки, которую один клиент имеет на файл, чтобы другой клиент мог открыть файл с оппортунистической блокировкой или без нее. Когда другой клиент запрашивает операцию открытия, сервер задерживает операцию открытия и уведомляет клиента о том, что он владеет оппортунистической блокировкой.

Клиент, удерживающий блокировку, принимает действия, соответствующие типу блокировки, например, отменяя буферы чтения, закрывая файл и т. д. Только когда клиент, удерживающий уступающую блокировку, уведомляет сервер о том, что он выполняется, сервер открывает файл для клиента, запрашивающего операцию открытия. Однако при разрыве блокировки уровня 2 сервер сообщает клиенту, что он был разорван, но не ждет подтверждения, так как кэшированные данные для записи на сервер не записываются.

При подтверждении разрыва любой монопольной блокировки (фильтра, уровня 1 или пакета) владелец поврежденной блокировки не может запросить другую монопольную блокировку. Она может понизить монопольную блокировку до блокировки уровня 2 или вообще без блокировки. Держатель, как правило, снимает блокировку и закрывает файл, когда все собирается закрыть файл.

Приложения получают уведомления о том, что оппортунистическая блокировка разбивается с помощью члена **Хевент** [**перекрывающейся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуры, связанной с файлом, на котором блокировка была нарушена. Приложения также могут использовать такие функции, как [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) и [**хасоверлаппедиокомплетед**](/windows/desktop/api/winbase/nf-winbase-hasoverlappediocompleted).

 

 
