---
description: Ограничение максимальной длины пути.
title: Ограничение максимальной длины пути
ms.topic: article
ms.custom: contperf-fy21q1
ms.date: 09/15/2020
ms.openlocfilehash: f57aba8d022e3b193289c8abf884e661797a0cf8585b7537fae19c171250eb12
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119914764"
---
# <a name="maximum-path-length-limitation"></a>Ограничение максимальной длины пути

в Windows API (с некоторыми исключениями, обсуждаемыми в следующих параграфах) максимальная длина пути — это максимальный **\_ путь**, который определен как 260 символов. Локальный путь структурирован в следующем порядке: буква диска, двоеточие, обратная косая черта, имена компонентов, разделенные обратной косой чертой, и завершающий нуль-символ. Например, максимальный путь на диске D — это "D: \\ *часть 256-символьного пути* &lt; NUL &gt; ", где " &lt; NUL &gt; " представляет невидимый завершающий нуль-символ для текущей системной кодовой страницы. (Символы < > используются для наглядности и не могут быть частью допустимой строки пути.)

Например, это ограничение может быть достигнуто при клонировании репозитория Git с длинными именами файлов в папку с длинным именем.


> [!Note]  
> функции файлового ввода-вывода в Windows API преобразуют "/" в " \\ " в процессе преобразования имени в имя в формате NT, за исключением случаев использования \\ \\ префикса "? \\ ", как описано в следующих разделах.

Windows API имеет много функций, которые также имеют версии юникода, чтобы предоставить путь расширенной длины для максимальной общей длины пути в 32 767 символов. Этот тип пути состоит из компонентов, разделенных символами обратной косой черты, до значения, возвращаемого в параметре *лпмаксимумкомпонентленгс* функции [**жетволумеинформатион**](/windows/desktop/api/FileAPI/nf-fileapi-getvolumeinformationa) (обычно это значение 255 символов). Чтобы указать путь расширенной длины, используйте \\ \\ префикс "? \\ ". Например, " \\ \\ ? \\ D: \\ *очень длинный путь*".

> [!Note]  
> Максимальный путь в 32 767 символов приблизительный, так как префикс " \\ \\ ? \\ " может быть расширен до более длинной строки системой во время выполнения, а это расширение применяется к общей длине.

Префикс " \\ \\ ? \\ " также можно использовать с путями, созданными в соответствии с соглашением об универсальных именах (UNC). Чтобы указать такой путь с помощью UNC, используйте параметр " \\ \\ ? \\ UNC- \\ префикс. Например, " \\ \\ ? \\ Общая \\ папка сервера UNC \\ ", где" Server "— это имя компьютера, а" Share "— имя общей папки. Эти префиксы не используются как часть самого пути. Они указывают, что путь должен быть передан в систему с минимальным изменением, что означает, что нельзя использовать косую черту для представления разделителей пути или точку для представления текущего каталога или двойные точки для представления родительского каталога. Поскольку нельзя использовать \\ \\ префикс "? \\ " с относительным путем, относительные пути всегда ограничены максимальным числом символов **\_ пути** .

нет необходимости выполнять нормализацию юникода в строках пути и имени файла для использования в Windows функциях API-интерфейса файлового ввода/вывода, так как файловая система обрабатывает путь и имена файлов как непрозрачную последовательность **WCHAR**. любые нормализации, необходимые приложению, должны выполняться с учетом того, что внешние вызовы связанных функций API-интерфейса Windows файлового ввода/вывода.

При использовании API для создания каталога указанный путь не может быть настолько длинным, что нельзя добавить имя файла 8,3 (т. е. имя каталога не может превышать **максимальный \_ путь** минус 12).

Оболочка и файловая система имеют разные требования. можно создать путь с Windows API, который пользовательский интерфейс оболочки не может интерпретировать правильно.

## <a name="enable-long-paths-in-windows-10-version-1607-and-later"></a>включение длинных путей в Windows 10, версии 1607 и более поздних

Windows 10 начиная с версии 1607, ограничения по **максимальному \_ пути** были удалены из общих функций файлов и каталогов Win32. Однако необходимо явно принять участие в новом поведении.

Чтобы обеспечить новое поведение при полном пути, должны выполняться оба следующих условия.

* Раздел реестра `Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem\LongPathsEnabled (Type: REG_DWORD)` должен существовать и иметь значение 1. Значение ключа будет кэшироваться системой (на процесс) после первого вызова затронутого файла или функции каталога Win32 (см. ниже для списка функций). Этот раздел реестра не будет перезагружен в течение времени существования процесса. Чтобы все приложения в системе могли распознать значение ключа, может потребоваться перезагрузка, так как некоторые процессы могли быть запущены до установки ключа.

Можно также скопировать этот код в `.reg` файл, который может задать это значение, или использовать команду PowerShell из окна терминала с повышенными привилегиями:
# <a name="cmd"></a>[cmd](#tab/cmd)

```cmd
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem]
"LongPathsEnabled"=dword:00000001

```

# <a name="powershell"></a>[PowerShell](#tab/powershell)

```powershell
New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" `
-Name "LongPathsEnabled" -Value 1 -PropertyType DWORD -Force

```

---

> [!NOTE]  
> Этот раздел реестра можно также контролировать с помощью групповая политика по адресу `Computer Configuration > Administrative Templates > System > Filesystem > Enable Win32 long paths` .

* [Манифест приложения](../sbscs/application-manifests.md) также должен содержать `longPathAware` элемент.

    ```XML
    <application xmlns="urn:schemas-microsoft-com:asm.v3">
        <windowsSettings xmlns:ws2="http://schemas.microsoft.com/SMI/2016/WindowsSettings">
            <ws2:longPathAware>true</ws2:longPathAware>
        </windowsSettings>
    </application>
    ```

Это функции управления каталогом, которые больше не имеют ограничений на **Максимальное число \_ путей** , если вы явно хотите использовать режим длинного пути: Креатедиректорив, Креатедиректорексв жеткуррентдиректорив ремоведиректорив сеткуррентдиректорив.

Это функции управления файлами, которые больше не имеют ограничений на **максимальную длину \_ пути** , если вы явно задействуете поведение пути: копифилев, CopyFile2, копифиликсв, креатефилев, CreateFile2, креатехардлинкв, креатесимболиклинкв, делетефилев, FindFirstFileW, FindFirstFileExW, FindNextFileW, GetFileAttributesW, GetFileAttributesExW, SetFileAttributesW, GetFullPathNameW, GetLongPathNameW, MoveFileW, MoveFileExW, MoveFileWithProgressW, ReplaceFileW, SearchPathW, FindFirstFileNameW, FindNextFileNameW.
