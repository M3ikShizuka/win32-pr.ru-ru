---
description: В файловой системе NTFS потоки содержат данные, которые записываются в файл и предоставляют дополнительные сведения о файле, чем атрибуты и свойства.
ms.assetid: 41dda6f1-a6d1-4e76-94f3-a72f9e491bee
title: Файловые потоки (локальные файловые системы)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a934a51225a886e3d5a7de4d9e1e91900fab460
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103812521"
---
# <a name="file-streams-local-file-systems"></a>Файловые потоки (локальные файловые системы)

Поток — это последовательность байтов. В файловой системе NTFS потоки содержат данные, которые записываются в файл и предоставляют дополнительные сведения о файле, чем атрибуты и свойства. Например, можно создать поток, содержащий ключевые слова поиска, или удостоверение учетной записи пользователя, которая создает файл.

Каждый поток, связанный с файлом, имеет свой собственный размер выделения, фактический размер и допустимую длину данных:

-   Размер выделения — это объем места на диске, зарезервированный для потока.
-   Фактический размер — это число байтов, используемых вызывающим объектом.
-   Допустимая длина данных (ВДЛ) — это число байтов, инициализированных из размера выделения для потока.

Каждый поток также сохраняет свое собственное состояние для сжатия, шифрования и разреженности. Атрибут **\_ \_ разреженного \_ файла атрибута** file задается в элементе **двфилеаттрибутес** структуры [**\_ \_ данных Win32 Find**](/windows/desktop/api/MinWinBase/ns-minwinbase-win32_find_dataa) , возвращаемой функциями [**FindFirstFile**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfilea), [**финдфирстфиликс**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfileexa)и [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) , если любой из потоков когда-либо был разреженным. [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa), [**сбой getfileattributesex**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesexa), [**жетфилеаттрибутестрансактед**](/windows/desktop/api/WinBase/nf-winbase-getfileattributestransacteda), [**жетфилеинформатионбихандле**](/windows/desktop/api/FileAPI/nf-fileapi-getfileinformationbyhandle)и [**жетфилеинформатионбихандликс**](/windows/desktop/api/WinBase/nf-winbase-getfileinformationbyhandleex) возвращают разреженное состояние потока данных по умолчанию, если поток не указан.

Нет файлов со временем, связанных с потоком. Время файла для файла обновляется при обновлении любого потока в файле.

Для каждого потока поддерживается оппортунистическая блокировка. Режимы совместного использования также поддерживаются для каждого потока. Когда для файла запрашивается доступ на удаление, операционная система проверяет доступ на удаление всех открытых потоков в файле. Если другой процесс открыл поток без разрешения на **\_ \_ удаление файлового ресурса** , открыть его для удаления доступа нельзя.

Если копируемый файл содержит поток данных и используется перенаправитель сети, то файл можно скопировать только в том случае, если у клиента есть разрешение на чтение и чтение атрибутов.

## <a name="naming-conventions-for-streams"></a>Соглашения об именовании для потоков

При указании из командной строки оболочки Windows полное имя потока — «*filename*:*Stream Name*:*Stream Type*», как показано в следующем примере: «myfile. dat: stream1: $Data».

Все символы, допустимые для имени файла, также являются допустимыми для имени потока, включая пробелы. Дополнительные сведения см. [в разделе Присвоение имени файлу](naming-a-file.md). Тип потока (также называемый кодом типа атрибута) является внутренним для файловой системы NTFS. Поэтому пользователи не могут создавать новые типы потоков, но могут открывать существующие типы файловой системы NTFS. Значения спецификатора типа потока всегда начинаются с символа доллара ($). Список типов потоков см. ниже.

По умолчанию поток данных не имеет имени. Чтобы полностью указать поток данных по умолчанию, используйте "*filename*:: $Data", где $Data является типом потока. Это эквивалентно "*filename*". В файле можно создать именованный поток, используя [соглашения об именовании файлов](naming-a-file.md). Обратите внимание, что "$DATA" является допустимым именем потока. Например, полное имя потока с именем "$DATA" для файла "*Sample*" будет иметь вид "*Sample*: $data: $Data". Если вы создали поток с именем "Bar" для того же файла, его полное имя будет иметь вид "*Пример*: линейчатая диаграмма: $Data".

При создании и работе с файлами, имеющими имена из одного символа, добавляйте к имени файла с точкой, за которой следует обратная косая черта (. \) или используйте полное имя пути. Причиной этого является то, что Windows обрабатывает имена файлов одного символа как буквы диска. Если буква диска указана с помощью относительного пути, двоеточие отделяет букву диска от пути. Если неоднозначность состоит в том, что односимвольное имя является буквой диска или именем файла, Windows предполагает, что это буква диска, если строка, следующая за двоеточием, является допустимым путем, даже если буква диска является недопустимой.

## <a name="stream-types"></a>Типы потоков

Ниже приведен список типов потоков NTFS, которые также называются кодами типов атрибутов. Некоторые типы потоков являются внутренними для файловой системы NTFS, и их формат не является документом.



| Тип потока                | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| :: $ATTRIBUTE \_ список         | Содержит список всех атрибутов, составляющих файл, и определяет, где находится каждый атрибут.                                                                                                                                                                                                                                                                                                                                          |
| :: $BITMAP                  | Битовая карта, используемая индексами для управления свободным местом в сбалансированном дереве для каталога. Сбалансированное дерево управляется блоками по 4 КБ (независимо от размера кластера) и используется для управления размещением этих блоков. Этот тип потока имеется в каждом каталоге.                                                                                                                                                                                           |
| :: $DATA                    | Поток данных. Поток данных по умолчанию не имеет имени. Потоки данных можно перечислить с помощью функций [**финдфирстстреамв**](/windows/desktop/api/fileapi/nf-fileapi-findfirststreamw) и [**финднекстстреамв**](/windows/desktop/api/fileapi/nf-fileapi-findnextstreamw) .                                                                                                                                                                                                                                                |
| :: $EA                      | Содержит данные расширенных атрибутов.|
| :: $EA \_ сведения         | Содержит сведения о поддержке расширенных атрибутов.                                                                                                                                                                                                                                                                                                                                                                                      |
| :: $FILE \_ имя              | Имя файла в символах Юникода. Сюда входит краткое имя файла, а также все жесткие связи.                                                                                                                                                                                                                                                                                                                                 |
| :: $INDEXное \_ выделение       | Тип потока каталога. Используется для реализации выделения имен файлов для больших каталогов. Этот поток представляет каталог и содержит все данные каталога. Изменения в потоках этого типа записываются в журнал изменений NTFS. Имя потока по умолчанию для \_ типа потока выделения $index — $I 30, то есть "*dirname*", "*dirname*:: $index \_ allocation" и "*dirname*: $I 30: $index \_ выделения" являются эквивалентными. |
| :: $INDEX \_ корневой элемент             | Этот поток представляет корень сбалансированного дерева индекса. Этот тип потока имеется в каждом каталоге.                                                                                                                                                                                                                                                                                                                                           |
| :: $LOGGEDный \_ поток служебной программы \_ | Аналогично:: $DATA, но операции записываются в журнал изменений NTFS. Используется системой EFS и [транзакционной NTFS (TxF)](transactional-ntfs-portal.md). Пара ":*StreamName*: $*СТРЕАМТИПЕ*" для EFS — ": $EFS: $LOGGEDный \_ поток служебной программы \_ " и для TxF — ": $TxF \_ data: $Logged \_ служебный \_ поток".                                                                                                                                                    |
| :: \_ идентификатор $Object              | 16-байтовый идентификатор, используемый для идентификации файла для службы отслеживания ссылок.                                                                                                                                                                                                                                                                                                                                                                           |
| :: $REPARSE \_ точка          | Данные [точки повторного анализа](reparse-points.md) .|



 

## <a name="related-topics"></a>См. также

<dl> <dt>

[Использование потоков](using-streams.md)
</dt> </dl>

 

 



