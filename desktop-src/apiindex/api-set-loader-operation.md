---
description: Описание использования наборов API в Windows 10 в операциях загрузчика.
title: Операция загрузчика набора API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: 701409c0d8dac2c275add06d2502c8764d502aba
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "105719875"
---
# <a name="api-set-loader-operation"></a>Операция загрузчика набора API

[Наборы API](windows-apisets.md) зависят от поддержки ОС в загрузчике библиотеки для эффективного представления перенаправления пространства имен модуля в процессе привязки библиотеки. [Имя контракта набора API](windows-apisets.md#api-set-contract-names) используется загрузчиком библиотеки для выполнения перенаправления ссылки на двоичный файл целевого узла, который содержит соответствующую реализацию набора API.

Когда загрузчик встречает зависимость от набора API во время выполнения, загрузчик обращается к данным конфигурации в образе, чтобы определить двоичный файл узла для набора API. Эти данные конфигурации называются **схемой набора API**. Схема собирается как свойство операционной системы, а сопоставление наборов API и двоичных файлов может отличаться в зависимости от того, какие двоичные файлы включены в данное устройство. Схема позволяет правильно маршрутизировать импортированную функцию в одном двоичном файле на разных устройствах, даже если имена модулей двоичного узла были переименованы или полностью переработаны на разных устройствах Windows.

Windows 10 поддерживает два стандартных способа использования наборов API и взаимодействия с ними: **прямую переадресацию** и **обратную пересылку**.

### <a name="direct-forwarding"></a>Прямая пересылка

В этой конфигурации код, использующий непосредственный импорт, импортирует имя модуля набора API напрямую. Этот импорт разрешается в одной операции и является наиболее эффективным методом с минимальными издержками. По сути, это разрешение может указывать на различные двоичные файлы на разных устройствах Windows 10, как показано в следующем примере:

Импортированный набор API: **api-feature1-l1-1-0.dll**
-  КОМПЬЮТЕР с Windows — > **feature1.dll**
-  HoloLens — > **feature1_holo.dll**
-  IoT — > **feature1_iot.dll**

Поскольку сопоставления хранятся в пользовательском хранилище данных схемы, это означает, что имя набора API, заканчивающееся на **. dll** , не ссылается непосредственно на файл на диске. Часть **. dll** имени набора API является только соглашением, необходимым загрузчику. Имя набора API больше похоже на псевдоним или виртуальное имя для физического DLL-файла. Это делает имя переносимым во всем диапазоне устройств Windows 10.

### <a name="reverse-forwarding"></a>Обратная переадресация

Хотя имена наборов API предоставляют устойчивое пространство имен для модулей на разных устройствах, не всегда практично преобразовывать каждый двоичный файл в эту новую систему. Например, приложение может быть широко распространено в течение многих лет, а повторная компиляция двоичных файлов приложения может оказаться невыполнимой. Кроме того, для некоторых приложений может потребоваться продолжить работу в системах, созданных до того, как были введены определенные наборы API.

Чтобы обеспечить этот уровень совместимости, система *серверов пересылки* предоставляется на всех устройствах Windows 10, охватывающих подмножество поверхности API Win32. Эти серверы пересылки используют имена модулей, которые были введены на компьютерах с Windows, и используют систему набора API для обеспечения совместимости на всех устройствах Windows 10.

Операция загрузчика ведет себя следующим образом:

1.  На устройстве, отличном от компьютера Windows, загрузчик представляет собой неуправляемую зависимость имени модуля ПК Windows, которая отсутствует на устройстве.
2.  Загрузчик находит сервер пересылки набора API для этого модуля и загружает его в память.
3.  Сервер пересылки имеет сопоставление для набора API с заданной вызываемой функцией.
4.  Загрузчик находит правильный двоичный файл узла для данного устройства.

По сути, сопоставление выглядит следующим образом:

Импортированная библиотека DLL: **feature1.dll**
- КОМПЬЮТЕР с Windows — > **feature1.dll**
- > **api-feature1-l1-1-0.dll** сервера > HoloLens- **feature1.dll**  ->  **feature1_holo.dll**
- Сервер пересылки IOT-> **feature1.dll** > **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**

Конечный результат функционально аналогичен [прямой пересылке](#direct-forwarding), но он выполняет эту задачу таким образом, чтобы максимально повысить уровень совместимости приложений.

> [!NOTE]
> Обратная переадресация обеспечивает покрытие только для подмножества поверхности API Win32. Он не позволяет запускать приложения, предназначенные для настольных версий Windows 10, на всех устройствах с Windows 10.
