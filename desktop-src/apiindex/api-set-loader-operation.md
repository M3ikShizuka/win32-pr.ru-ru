---
description: описывает, как Windows 10 использует наборы API в операциях загрузчика.
title: Операция загрузчика набора API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: d2d1ac23e8bc1ecc3f94b2bd53367525b799228ba4457a48819a89f841789682
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118814536"
---
# <a name="api-set-loader-operation"></a>Операция загрузчика набора API

[Наборы API](windows-apisets.md) зависят от поддержки ОС в загрузчике библиотеки для эффективного представления перенаправления пространства имен модуля в процессе привязки библиотеки. [Имя контракта набора API](windows-apisets.md#api-set-contract-names) используется загрузчиком библиотеки для выполнения перенаправления ссылки на двоичный файл целевого узла, который содержит соответствующую реализацию набора API.

Когда загрузчик встречает зависимость от набора API во время выполнения, загрузчик обращается к данным конфигурации в образе, чтобы определить двоичный файл узла для набора API. Эти данные конфигурации называются **схемой набора API**. Схема собирается как свойство операционной системы, а сопоставление наборов API и двоичных файлов может отличаться в зависимости от того, какие двоичные файлы включены в данное устройство. схема позволяет правильно маршрутизировать импортированную функцию в одном двоичном файле на разных устройствах, даже если имена модулей двоичного узла были переименованы или полностью переработаны на разных Windows устройствах.

Windows 10 поддерживает два стандартных метода использования и взаимодействия с наборами API: **прямая переадресация** и **обратная переадресация**.

### <a name="direct-forwarding"></a>Прямая пересылка

В этой конфигурации код, использующий непосредственный импорт, импортирует имя модуля набора API напрямую. Этот импорт разрешается в одной операции и является наиболее эффективным методом с минимальными издержками. по сути, это решение может указывать на различные двоичные файлы на разных Windows 10 устройствах, как показано в следующем примере:

Импортированный набор API: **api-feature1-l1-1-0.dll**
-  Windows **feature1.dll** > ПК
-  > HoloLens **feature1_holo.dll**
-  IoT — > **feature1_iot.dll**

Поскольку сопоставления хранятся в пользовательском хранилище данных схемы, это означает, что имя набора API, заканчивающееся на **.dll** , не ссылается непосредственно на файл на диске. **.dll** часть имени набора API является только соглашением, необходимым загрузчику. Имя набора API больше похоже на псевдоним или виртуальное имя для физического DLL-файла. это делает имя переносимым во всем диапазоне Windows 10 устройств.

### <a name="reverse-forwarding"></a>Обратная переадресация

Хотя имена наборов API предоставляют устойчивое пространство имен для модулей на разных устройствах, не всегда практично преобразовывать каждый двоичный файл в эту новую систему. Например, приложение может быть широко распространено в течение многих лет, а повторная компиляция двоичных файлов приложения может оказаться невыполнимой. Кроме того, для некоторых приложений может потребоваться продолжить работу в системах, созданных до того, как были введены определенные наборы API.

чтобы обеспечить этот уровень совместимости, система *серверов пересылки* предоставляется на всех Windows 10 устройствах, охватывающих подмножество поверхности API Win32. эти серверы пересылки используют имена модулей, которые были введены на Windows пк, и используют систему набора API для обеспечения совместимости во всех Windows 10 устройствах.

Операция загрузчика ведет себя следующим образом:

1.  на устройстве, отличном от Windows пк, загрузчик представляет собой зависимость имени модуля "устаревший Windows пк", которая отсутствует на устройстве.
2.  Загрузчик находит сервер пересылки набора API для этого модуля и загружает его в память.
3.  Сервер пересылки имеет сопоставление для набора API с заданной вызываемой функцией.
4.  Загрузчик находит правильный двоичный файл узла для данного устройства.

По сути, сопоставление выглядит следующим образом:

Импортированная библиотека DLL: **feature1.dll**
- Windows **feature1.dll** > ПК
- HoloLens-> **feature1.dll** пересылки **>api-feature1-l1-1-0.dll**  ->  **feature1_holo.dll**
- Сервер пересылки IOT-> **feature1.dll** > **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**

Конечный результат функционально аналогичен [прямой пересылке](#direct-forwarding), но он выполняет эту задачу таким образом, чтобы максимально повысить уровень совместимости приложений.

> [!NOTE]
> Обратная переадресация обеспечивает покрытие только для подмножества поверхности API Win32. он не позволяет запускать приложения, предназначенные для настольных версий Windows 10, на всех Windows 10 устройствах.
