---
title: Создание и инициализация модуля записи DRM
description: Создание и инициализация модуля записи DRM
ms.assetid: ce0508e1-f69f-4e09-8c32-8c9dac48b5ec
keywords:
- Windows Media Format SDK, записи DRM
- Управление цифровыми правами (DRM), создание модулей записи DRM
- DRM (Управление цифровыми правами), создание модулей записи DRM
- Управление цифровыми правами (DRM), инициализация записи DRM
- DRM (Управление цифровыми правами), инициализация записи DRM
- Расширенные API клиента DRM, модули записи DRM
- Расширенные API клиента, записи DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0ed40b7f9dd9c486b1ef22e5042261c5ce03d2f7
ms.sourcegitcommit: 773fa6257ead6c74154ad3cf46d21e49adc900aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "105700969"
---
# <a name="creating-and-initializing-a-drm-writer"></a>Создание и инициализация модуля записи DRM

Чтобы инициализировать объект модуля записи ASF для импорта зашифрованных примеров мультимедиа в Windows Media DRM, необходимо выполнить следующие действия.

1.  Выполните шаги 1 – 4 [импорта лицензии и материала ключа](importing-license-and-key-material.md).
2.  Создание и инициализация объекта модуля записи ASF с помощью соответствующего материала ключа DRM Windows Media. Дополнительные сведения см. в разделе [Включение поддержки DRM](enabling-drm-support.md).
3.  Задайте каждый из следующих атрибутов, вызвав [**ивмдрмвритер:: сетдрматтрибуте**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter-setdrmattribute):
    -   \_ХЕАДЕРСИГНПРИВКЭЙ DRM
    -   \_V1LICENSEACQURL DRM
    -   \_KEYID DRM
    -   \_ЛИЦЕНСЕАККУРЛ DRM
4.  Если на компьютере, на котором работает программное обеспечение, не установлена лицензированная версия диспетчера прав Windows Media, необходимо также задать следующие четыре атрибута:
    -   \_ЛАСИГНАТУРЕРУТЦЕРТ DRM
    -   \_ЛАСИГНАТУРЕЦЕРТ DRM
    -   \_ЛАСИГНАТУРЕЛИКСРВЦЕРТ DRM
    -   \_ЛАСИГНАТУРЕПРИВКЭЙ DRM
    -   Приложение для необходимых сертификатов шифрования можно выполнить, заполнив [соглашение о лицензировании Windows Media (вмла)](https://www.microsoft.com/licensing/default) в сети.
5.  Создайте ключ сеанса и заполните структуру [**\_ \_ \_ ключа сеанса импорта WMDRM**](wmdrm-import-session-key.md) . Ключ сеанса будет использоваться для шифрования ключа содержимого. Пример см. в разделе [Пример создания ключа сеанса](create-session-key-example.md).
6.  Создайте ключ содержимого на основе вектора инициализации случайных чисел RC4 и заполните [**структуру \_ \_ \_ ключа содержимого для импорта WMDRM**](wmdrm-import-content-key.md) . Ключ содержимого используется для шифрования образцов мультимедиа. Пример см. в разделе [Пример создания ключа содержимого](create-content-key-example.md).
7.  Зашифруйте ключ содержимого с помощью ключа сеанса, используя шифрование RC4.
8.  Извлеките ключ коллекции сертификатов компьютера. Например, см. [Пример получения сертификата компьютера](get-machine-certificate-example.md).
9.  Зашифруйте ключ сеанса с помощью открытого ключа, извлеченного из сертификата.
10. Заполните [**структуру \_ \_ \_ структуры инициализации для импорта WMDRM**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmdrm_import_init_struct) .
11. Вызовите метод [**IWMDRMWriter3:: сетпротектстреамсамплес**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmwriter3-setprotectstreamsamples) , чтобы УВЕДОМИТЬ пакет SDK о том, что образцы, поступающие из модуля записи, уже защищены и должны быть отправлены непосредственно клиенту DRM Windows Media для импорта.
12. Вызовите [**ивмвритер:: бегинвритинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-beginwriting).

Остальные шаги по созданию файла, защищенного с помощью DRM, описаны в руководстве по программированию Windows Media Format SDK. Дополнительные сведения см. в разделе [Создание защищенных файлов](creating-protected-files.md).

Следующий шаг — выполнить итерацию каждого примера носителя, зашифровать его и передать в объект модуля записи. Дополнительные сведения см. в разделе [Примеры шифрования и импорта мультимедиа](encrypting-and-importing-media-samples.md).

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Атрибуты**](attributes.md)
</dt> <dt>

[**Импорт DRM**](drm-import.md)
</dt> </dl>

 

 




