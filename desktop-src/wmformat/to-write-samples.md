---
title: Написание образцов
description: Написание образцов
ms.assetid: 9ce10a77-9e80-45e0-a7e7-2ffdf8b57773
keywords:
- Расширенный системный формат (ASF), написание примеров
- ASF (Расширенный системный формат), написание образцов
- Расширенный формат систем (ASF), передача образцов в модуль записи
- ASF (Расширенный системный формат), передача образцов в модуль записи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 738014b3c42441e878105d12a8ebf23ce4b266f7
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104412503"
---
# <a name="to-write-samples"></a>Написание образцов

Определив и настроив входные данные для файла, который вы пишете, можно начать передавать примеры в модуль записи. При возможности необходимо передавать образцы в порядке, если это возможно, чтобы сделать процесс записи более эффективным.

Перед передачей всех выборок необходимо настроить для модуля записи возможность их принятия путем вызова [**ивмвритер:: бегинвритинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-beginwriting).

Чтобы передать пример в модуль записи, выполните следующие действия.

1.  Выделите буфер и получите указатель на интерфейс [**инссбуффер**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) , вызвав [**Ивмвритер:: аллокатесампле**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-allocatesample).
2.  Извлеките адрес буфера, созданного на шаге 1, вызвав [**инссбуффер:: @ buffer**](/previous-versions/windows/desktop/api/Wmsbuffer/nf-wmsbuffer-inssbuffer-getbuffer).
3.  Скопируйте образец данных в буферное расположение, убедившись, что переданный образец будет помещаться в выделенный буфер. Для копирования данных можно использовать любую функцию копирования памяти. Распространенный выбор — memcpy, который включается в стандартную библиотеку времени выполнения C.
4.  Обновите объем данных, используемых в буфере, чтобы отразить фактический размер образца путем вызова [**инссбуффер:: SetLength**](/previous-versions/windows/desktop/api/Wmsbuffer/nf-wmsbuffer-inssbuffer-setlength).
5.  Передайте интерфейс буфера записи, а также входной номер и время выборки с помощью метода [**ивмвритер:: вритесампле**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-writesample) . Все звуковые примеры для входных данных представляют одинаковую длительность содержимого, поэтому можно определить время выборки, добавив длительность выборки в итоговое значение. Для видео необходимо вычислить время на основе частоты кадров.

**Вритесампле** работает асинхронно и может не завершить запись данных из буфера до того, как приложение будет готово к повторному вызову метода. Поэтому важно вызывать **аллокатесампле** один раз для каждого вызова **вритесампле**. Однако можно освободить интерфейс **инссбуффер** сразу после вызова **вритесампле**.

После завершения передачи образцов вызовите [**ивмвритер:: ендвритинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-endwriting).

**Примечание** . Важно, чтобы образцы из всех потоков в файле передавались модулю записи при синхронизации друг с другом. То есть каждый раз, когда это возможно, следует передавать образцы в модуль записи в порядке представления в пределах синхронизации, указанной в [**ивмвритерадванцед:: сетсинктолеранце**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriteradvanced-setsynctolerance). Наилучшие результаты достигаются, когда данные доставляются в каждый поток в единицах в одну секунду или меньше.

Потоки также должны заканчиваться приблизительно в одно и то же время. Например, не следует писать файл со звуковым потоком, который составляет 45 секунд и длинный поток видео длиной 50 секунды. Если вы кодируете такой файл с неизмененными входами, некоторые звуковые данные в конце потока будут удалены (даже если это более короткий поток). Чтобы кодировка файла работала, необходимо добавить 5 секунд тишины к входному звуку, чтобы один поток не закончит несколько секунд перед другим. Для типов потоков с временными примерами, такими как потоки текста или изображений, необязательно устанавливать заполнение таким образом. Потоки команд сценария также должны следовать всем этим правилам.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Интерфейс Инссбуффер**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer)
</dt> <dt>

[**Интерфейс Ивмвритер**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter)
</dt> <dt>

[**Запись файлов ASF**](writing-asf-files.md)
</dt> </dl>

 

 




