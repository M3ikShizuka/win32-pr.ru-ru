---
title: настройка Потоки аудио
description: настройка Потоки аудио
ms.assetid: 6ddd9bc1-3fde-4098-afce-fdda461ced62
keywords:
- потоки, Настройка звуковых потоков
- кодеки, Настройка звуковых потоков
- звуковые потоки, Настройка
- кодеки, форматы
- потоки, интерфейс ИвмкодеЦинфо
- ИвмкодеЦинфо, звуковые потоки
- потоки, синхронизация/V
- звуковые потоки, синхронизация/V
- Синхронизация A/V
- потоки, синхронизация/V
- звуковые потоки, синхронизация/V
- потоки, аудио форматы с низкой задержкой
- звуковые потоки, форматы с низкой задержкой
- кодеки, форматы с низкой задержкой
- потоки, переменная скорость (VBR)
- звуковые потоки, переменная скорость (VBR)
- кодеки, переменные скорость (VBR)
- Переменная скорость (VBR), Настройка
- VBR (переменная скорость), Настройка
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6e28c32e9d0e237e72f693bded74c7620d33845261a6137afdf58b04f35f441f
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "119548034"
---
# <a name="configuring-audio-streams"></a>настройка Потоки аудио

Обычно для настройки используются потоки аудио. Получите конфигурацию потока из кодека, используя методы [**ивмкодеЦинфо**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) , как описано в статье [Получение сведений о конфигурации потока из кодеков](getting-stream-configuration-information-from-codecs.md). В большинстве случаев не следует изменять параметры из полученных.

Формат кодека, выбранный из перечисленных в списке, зависит от предполагаемого использования файлов ASF, созданных с профилем. Описание формата кодека, полученное с помощью [**IWMCodecInfo2:: жеткодекформатдеск**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) , суммирует характеристики формата. Если в приложении не отображаются описания для выбора между ними, можно вызвать **QueryInterface** в интерфейсе [**ивмстреамконфиг**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) формата кодека, чтобы получить интерфейс [**ивммедиапропс**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) . Затем можно получить структуру [**\_ \_ типа мультимедиа WM**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) , вызвав [**ивммедиапропс:: жетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype). Изучив структуру **\_ \_ типа мультимедиа WM** и структуру [**вавеформатекс**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) , на которую он указывает, можно определить параметры формата кодека и сравнить их с вашими требованиями.

## <a name="getting-audio-formats-for-av-synchronization"></a>Получение форматов звука для синхронизации/V

кодек Windows media audio и Windows кодека media audio Professional поддерживают форматы только для звуковых файлов и аудио-и видеофайлов. Форматы только для звука оптимизированы для файлов, содержащих только звуковые данные, а форматы аудио и видео оптимизированы для аудио, который находится в файле с видеопотоком. При перечислении форматов кодеков для этих кодеков форматы аудио и видео поступают после форматов только для аудио. Все описания формата аудио/видео содержат строку "(A/V)". Можно задать форматы, предназначенные для синхронизации аудио и видео программным путем, проверив количество пакетов в секунду. Форматы для синхронизации имеют 5 или более пакетов в секунду, если скорость потока больше или равна 32 000 бит/сек. Форматы с скоростями битов, меньшими 32 000 бит в секунду, можно использовать с синхронизированным видео, если они используют 3 или более пакетов в секунду. Пример кода в разделе [to find Audio formats](to-find-audio-formats.md) содержит код, необходимый для выполнения этой проверки:


```C++
if((pWave->nAvgBytesPerSec / pWave->nBlockAlign) >= 
       ((pWave->nAvgBytesPerSec >= 4000) ? 5.0 : 3.0))
{
    // Set this stream configuration as the new best match.
}
```



## <a name="getting-low-delay-audio-formats"></a>Получение Low-Delay звуковых форматов

кодек Windows media 9,1 и Windows media Audio 9,1 Professional поддерживают форматы с низкой задержкой. В этих форматах окно буфера меньше, чем в других звуковых форматах. Воспроизведение звука с низкой задержкой предназначено для повышения производительности в ситуациях, когда файлы или потоки будут часто переключаться. Например, приложение, которое содержит несколько песен для потоковой передачи в пользовательском интерфейсе и позволяет пользователям произвольно переключаться между ними.

Форматы с низкой задержкой доступны только в режиме CBR (один или два прохода). Все описания формата с низкой задержкой содержат строку "низкая задержка". Форматы можно задать программно, проверив значение битовой скорости формата. Форматы с низкой задержкой имеют скорость в 1 килобит меньше, чем скорость в эквивалентном нормальном формате. например, кодек Windows Media Audio 9,1 поддерживает однопроходный формат CBR с скоростью в 192 кбит/с. Эквивалентный формат с низкой задержкой имеет скорость 191 кбит/с. кроме того, за исключением формата mono 5 кбит/с, поддерживаемого кодеком Windows Media Audio 9,1, форматы с низкой задержкой являются единственными форматами с нечетным значением битовой скорости.

## <a name="configuring-variable-bit-rate-audio"></a>Настройка звука переменной скорости

если требуется формат переменной скорости (VBR) для одного из кодеков Windows Media audio, его можно получить, задав параметры перечисления в методе [**IWMCodecInfo3:: сеткодеценумератионсеттинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) . Задайте для параметра g \_ всзвбренаблед значение true и задайте для параметра g \_ всзнумпассес значение 1 для параметра с параметром VBR или 2 для двух проходов (ограниченный или неограниченный). при использовании ограниченных двух проходов VBR необходимо вручную задать максимальную скорость и окно буфера для потока с помощью методов [**ивмпропертиваулт**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) , как описано в разделе [настройка VBR Потоки](configuring-vbr-streams.md).

В профилях VBR на основе качества элемент **навгбитесперсек** структуры **вавеформатекс** содержит уровень качества (от 1 до 100) в байтах нижнего порядка, а три старших байта — 0x7fffff. Не пытайтесь изменить параметр качества, изменив это значение вручную. необходимо использовать формат, так как он извлекается из кодека. Чтобы использовать другое значение качества, необходимо перечислить форматы до тех пор, пока не найдете соответствующий потребностям. Кроме того, **навгбитесперсек** не будет сохраняться в файле ASF; При получении структуры **вавеформатекс** для файла, открытого с помощью объекта Reader, **навгбитесперсек** содержит приблизительное значение, представляющее среднее число байтов в секунду.

> [!Note]  
> При настройке звуковых потоков никогда не следует использовать значение окна буфера аудио, которое больше значения для всех потоков видео в файле. Обычно это не является проблемой, так как значения окна звукового буфера должны находиться в диапазоне от 1,5 до 3 секунд, а значения видео должны находиться в диапазоне от 3 до 5 секунд. Если окно буфера аудио больше, чем окно буфера видео, файл будет воспроизводиться с потоками, которые немного не синхронизированы.

 

## <a name="related-topics"></a>Связанные темы

<dl> <dt>

[**общая конфигурация для всех Потоки**](configuration-common-to-all-streams.md)
</dt> <dt>

[**настройка Потоки**](configuring-streams.md)
</dt> <dt>

[**Поиск форматов аудио**](to-find-audio-formats.md)
</dt> </dl>

 

 