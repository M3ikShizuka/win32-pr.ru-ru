---
title: Чтение файлов с помощью синхронного модуля чтения
description: Чтение файлов с помощью синхронного модуля чтения
ms.assetid: 18c6c0cd-478f-4325-b23e-571c33779a96
keywords:
- Windows Media Format SDK, чтение файлов
- Пакет SDK для Windows Media Format, синхронные средства чтения
- Расширенный формат систем (ASF), синхронные средства чтения
- ASF (Расширенный системный формат), синхронные средства чтения
- Расширенный формат систем (ASF), чтение файлов
- ASF (Расширенный системный формат), чтение файлов
- синхронные читатели, интерфейс Ивмреадеркаллбакк
- Ивмреадеркаллбакк, синхронные читатели
- синхронные читатели, чтение файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 893a1bd324cdc91968e423f2084bfdba5ef57c8e
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104412491"
---
# <a name="reading-files-with-the-synchronous-reader"></a>Чтение файлов с помощью синхронного модуля чтения

Синхронное средство чтения можно использовать для чтения файла ASF с помощью синхронных вызовов вместо асинхронных методов в объекте Reader. Использование синхронных вызовов сокращает количество потоков, необходимых для чтения файла. Асинхронный модуль чтения использует несколько потоков для обработки потоков. Для файлов с несколькими потоками количество используемых потоков может стать очень большим. Синхронный читатель использует только один поток.

Синхронное средство чтения было спроектировано в соответствии с потребностями создания содержимого и приложений для редактирования файлов. Синхронное средство чтения можно использовать для других приложений, но его функциональные возможности ограничены.

Синхронный читатель может открывать локальные файлы или файлы в сети по UNC-пути (например, " \\ \\ сомешаре \\ сомедиректори \\ somefile. wmv"). Вы не можете выполнять потоковую передачу файлов в синхронное средство чтения или открывать файлы из расположения в Интернете. Синхронное средство чтения также обеспечивает поддержку использования интерфейса **IStream** com в качестве источника.

Синхронное средство чтения предоставляет больше универсальности для извлечения примеров из файла ASF, чем асинхронный модуль чтения. Синхронный читатель может доставлять образцы по номеру потока, а также по выходным данным. Образцы, доставляемые номером потока, могут быть сжаты или распакованы. Синхронное средство чтения может также переключаться между сжатой и несжатой доставкой во время воспроизведения. Эта функция называется «быстрое редактирование». Эта функция позволяет приложению редактирования читать содержимое на основе Windows Media и передавать его непосредственно в модуль записи, пока не будет достигнут нужный кадр. На этом этапе приложение может сообщить модулю чтения о необходимости начать доставку несжатого содержимого, которое затем приложение может изменить и передать в модуль записи для повторного сжатия. Когда приложение закончит изменение указанных кадров, оно может сообщить модулю чтения о необходимости начать доставку сжатых кадров.

Основные функции синхронного объекта Reader можно разделить на следующие шаги. На этих этапах "приложение" относится к программе, которую вы пишете с помощью пакета SDK Windows Media Format.

1.  Приложение передает синхронному средству чтения имя файла для чтения. Когда синхронный модуль чтения открывает файл, он присваивает каждому потоку номер выхода. Если файл использует взаимное исключение, модуль чтения назначает один выход для всех взаимоисключающих потоков.
2.  Приложение получает сведения о конфигурации различных выходных данных из средства чтения. Собранная информация позволит приложению правильно отображать образцы мультимедиа.
3.  Приложение начинает запрашивать образцы, по одному за раз, из синхронного модуля чтения. Синхронный читатель доставляет каждый пример в объект buffer, для которого он доставляет интерфейс [**инссбуффер**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) .
4.  Приложение отвечает за отрисовку данных после их доставки модулем чтения. Пакет SDK для формата Windows Media не предоставляет никаких подпрограмм отрисовки. Как правило, приложения используют другие пакеты SDK для визуализации данных, например пакет SDK Microsoft Direct X, или мультимедийные функции пакета SDK для платформы Microsoft Windows.

Эти шаги показаны в примере приложения Вмсинкреадер. Дополнительные сведения см. в разделе [примеры приложений](sample-applications.md).

Синхронное средство чтения также поддерживает более сложные функции. Синхронное средство чтения позволяет выполнять следующие действия.

-   Укажите диапазон выборок для получения по времени или по номеру кадра.
-   Управление выбором потока для взаимоисключающих потоков.
-   Откройте файл, используя стандартный COM-интерфейс **IStream**.
-   Чтение данных профиля из заголовка файла.
-   Считывает метаданные из заголовка файла.
-   Переключение между потоковых и выходными примерами во время воспроизведения.
-   Переключение между сжатыми и распакованными примерами потока во время воспроизведения.

В следующих разделах подробно описывается использование синхронного объекта Reader.

-   [Создание синхронного средства чтения и открытие файла](to-create-a-synchronous-reader-and-open-a-file.md)
-   [Поиск номеров потоков и выходных номеров](to-find-stream-numbers-and-output-numbers.md)
-   [Получение примеров мультимедиа с помощью синхронного модуля чтения](to-retrieve-media-samples-with-the-synchronous-reader.md)
-   [Поиск по времени с помощью синхронного модуля чтения](to-seek-by-time-using-the-synchronous-reader.md)
-   [Поиск по номеру кадра с помощью синхронного модуля чтения](to-seek-by-frame-number-using-the-synchronous-reader.md)
-   [Поиск по коду времени SMPTE с помощью синхронного модуля чтения](to-seek-by-smpte-time-code-using-the-synchronous-reader.md)
-   [Получение примеров Stream с помощью синхронного модуля чтения](to-retrieve-stream-samples-with-the-synchronous-reader.md)
-   [Извлечение сжатых образцов с помощью синхронного модуля чтения](to-retrieve-compressed-samples-with-the-synchronous-reader.md)

**Пример кода**

В следующем примере кода показано, как считывать образцы из файла ASF с помощью синхронного модуля чтения. Он указывает номер кадра, диапазон выборок для доставки.


```C++
IWMSyncReader* pSyncReader = NULL;
INSSBuffer*    pMyBuffer   = NULL;

QWORD cnsSampleTime = 0;
QWORD cnsSampleDuration = 0;
DWORD dwFlags = 0;
DWORD dwOutputNumber;
HRESULT hr = S_OK;

// Initialize COM.
hr = CoInitialize(NULL);

// Create a synchronous reader.
hr = WMCreateSyncReader(NULL, WMT_RIGHT_PLAYBACK, &pSyncReader);

// Open an ASF file.
hr = pSyncReader->Open(L"c:\\somefile.wmv");

// TODO: Identify the properties for each output. This works 
// exactly as it does with the asynchronous reader.

// Specify a playback range from frame number 100 of the video 
// stream to the end of the file. Assume that the video stream 
// is stream number 2.
hr = pSyncReader->SetRangeByFrame(2, 100, 0);

// Loop through all the samples in the specified range.
do
{
   // Get the next sample, regardless of its stream number.
   hr = pSyncReader->GetNextSample(0,
                                   &pMyBuffer,
                                   &cnsSampleTime,
                                   &cnsSampleDuration,
                                   &dwFlags,
                                   &dwOutputNumber,
                                   NULL);

   if(SUCCEEDED(hr))
   {
      // TODO: Process the sample in whatever way is appropriate 
      // to your application. When finished, clean up.
      pMyBuffer->Release();
      pMyBuffer = NULL;
      cnsSampleTime     = 0;
      cnsSampleDuration = 0;
      dwFlags           = 0;
      dwOutputNumber    = 0;
   }
} 
while (SUCCEEDED(hr));

pSyncReader->Release();
pSyncReader = NULL;

```



## <a name="related-topics"></a>См. также

<dl> <dt>

[**Интерфейс Ивмсинкреадер**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmsyncreader)
</dt> <dt>

[**Чтение файлов ASF**](reading-asf-files.md)
</dt> <dt>

[**Объект модуля синхронного чтения**](synchronous-reader-object.md)
</dt> </dl>

 

 




