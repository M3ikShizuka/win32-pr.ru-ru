---
title: Смена протокола
description: Смена протокола
ms.assetid: 61db5e2b-4858-446e-9a27-e0305b46683d
keywords:
- Windows Media Format SDK, переключение протокола
- Расширенный системный формат (ASF), переключение протокола
- ASF (Расширенный системный формат), переключение протокола
- Смена протокола
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b2de8d0496467535f5740a10082f82e285c11ef6
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104069572"
---
# <a name="protocol-rollover"></a>Смена протокола

Переключение протокола — это процесс, при котором объект чтения обнаруживает лучший протокол потоковой передачи, доступный с сервера. При открытии URL-адреса, содержащего схему "MMS", модуль чтения использует смену протокола.

Модуль чтения поддерживает несколько протоколов:

-   Протокол передачи данных в реальном времени (RTSP)
-   Протокол HTTP
-   Microsoft Media Server (MMS)

Протоколы RTSP и MMS имеют две разновидности: один использует [*UDP*](wmformat-glossary.md) в качестве базового протокола доставки, а другой — по протоколу TCP.

Объект модуля чтения всегда использует протокол TCP для команд управления воспроизведением, но он может использовать TCP или UDP для доставки потокового содержимого. Протокол UDP является предпочтительным для доставки содержимого, так как он накладывает меньше ресурсов на пропускную способность, чем TCP. Протокол TCP обеспечивает надежный транспорт с помощью виртуальных каналов, но стоимость этого означает, что протокол TCP не так хорошо подходит для цифровых мультимедийных потоков, где эффективное использование пропускной способности является более важным, чем случайные потерянные пакеты.

Если URL-адрес указывает "mms://", средство чтения пытается использовать следующие протоколы для доставки данных в следующем порядке:

1.  РТСПУ (RTSP с использованием UDP)
2.  Протокол RTSP (RTSP с использованием TCP)
3.  ММСУ (MMS с использованием UDP)
4.  ММСТ (MMS по протоколу TCP)
5.  HTTP

HTTP является односторонним протоколом, основанным на протоколе TCP, и является протоколом, используемым веб-серверами. Потоковая передача с использованием HTTP менее эффективна, чем использование протокола RTSP. Однако большинство брандмауэров настроены на прием HTTP-запросов, тогда как они обычно отклоняют другие протоколы потоковой передачи.

Серия Windows Media Services 9 в Microsoft Windows Server 2003 будет отклонять любые запросы ММСУ или ММСТ из средства чтения пакетов SDK формата Windows Media, так как протокол RTSP является предпочтительным. Службы Windows Media версии 4,1 и более ранних версий не поддерживают протокол RTSP. В этом случае объект модуля чтения возвращается к ММСУ или HTTP.

Переключение протокола не применяется, если схема URL-адресов предоставляет конкретный протокол, например "rtspu://" для РТСПУ или "https://" для HTTP. Если схема URL-адресов имеет значение "rtsp://", модуль чтения пытается выполнить РТСПУ и RTSP, но не другие.

После того, как средство чтения откроет файл, можно запросить используемый протокол, вызвав метод [**IWMReaderAdvanced2:: жетпротоколнаме**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreaderadvanced2-getprotocolname) в модуле чтения. Во время потоковой передачи или загрузки содержимого этот метод возвращает имя, как только содержимое будет полностью кэшировано, метод **жетпротоколнаме** возвращает строку "Cache".

Чтобы получить имена всех протоколов Windows Media Server, поддерживаемых средством чтения, вызовите метод [**ивмреадернетворкконфиг:: жетсуппортедпротоколнаме**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-getsupportedprotocolname) в модуле чтения. Вы можете отключить один или несколько протоколов в списке переключения протокола средства чтения с помощью интерфейса **ивмреадернетворкконфиг** . Например, метод [**ивмреадернетворкконфиг:: сетенаблеткп**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenabletcp) включает или отключает протоколы на основе TCP, а [**Ивмреадернетворкконфиг:: сетенаблеудп**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmreadernetworkconfig-setenableudp) включает или отключает протоколы на основе UDP. Эти методы применяются только к смене протокола. протоколы по-прежнему доступны, если схема URL-адресов содержит конкретный протокол. Обычно нет причин отключить какие-либо протоколы, используемые при смене протокола. Это может привести к снижению производительности. Однако он может быть полезен для тестирования.

 

 




