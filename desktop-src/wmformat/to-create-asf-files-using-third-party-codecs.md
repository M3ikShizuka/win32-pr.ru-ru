---
title: Создание файлов ASF с помощью сторонних кодеков
description: Создание файлов ASF с помощью сторонних кодеков
ms.assetid: 5cd348ca-1f86-429d-92ee-4eab4ced8571
keywords:
- Windows Media Format SDK, создание файлов ASF
- Пакет SDK для Windows Media Format, сторонние кодеки
- Расширенный системный формат (ASF), создание файлов
- ASF (Расширенный системный формат), создание файлов
- Расширенный системный формат (ASF), сторонние кодеки
- ASF (Расширенный системный формат), сторонние кодеки
- сторонние кодеки
- кодеки, сторонние
- кодеки, создание файлов ASF
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9d6c057f1785ed50e328ac6094ff7dbe078e98fc
ms.sourcegitcommit: ad672d3a10192c5ccac619ad2524407109266e93
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/25/2020
ms.locfileid: "104336636"
---
# <a name="to-create-asf-files-using-third-party-codecs"></a>Создание файлов ASF с помощью сторонних кодеков

Пакет Windows Media Format SDK можно использовать для создания файлов ASF, которые содержат цифровые файлы мультимедиа, закодированные с помощью любого выбранного вами кодека. При использовании кодека, не входящего в состав этого пакета SDK, необходимо выполнить следующие действия.

1.  Кодирование содержимого с помощью нужного кодека.
2.  Найдите или создайте значение идентификатора GUID для определения содержимого, закодированного кодеком, который используется на шаге 1.
3.  Создайте новый профиль или измените существующий профиль для использования с закодированным содержимым.
    -   Создайте поток для закодированного содержимого с соответствующим основным типом. Дополнительные сведения о основных типах носителей см. в разделе [типы носителей](media-types.md). Используйте идентификатор GUID, указанный в шаге 2, в качестве подтипа носителя.
    -   Задайте для потока значения скорость и буфер, которые не будут приводить к переполнению буфера. Эти значения можно получить из кодека во время кодирования. Компоненты среды выполнения пакета SDK проверяют значения скорости и окна буфера и удаляют образцы, если это необходимо, чтобы обеспечить соответствие заданным значениям. Если значения заданы неправильно, то файл не будет правильно работать в потоке, что приведет к плохому воспроизведению.
    -   Для видеопотоков необходимо установить элемент **бикомпрессион** структуры **битмапинфохеадер** , содержащейся в структуре [**ВМВИДЕОИНФОХЕАДЕР**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmvideoinfoheader) , в соответствующее значение FOURCC для содержимого. Это значение должно быть равно первым четырем байтам в GUID подтипа. Например, если **бикомпрессион** имеет значение Макефауркк ('t ', ' E ', ', ') = 0x54455354, то идентификатор GUID подтипа будет начинаться следующим образом: 54455354-XXXX-XXXX-XXXX-XXXXXXXXXXXX.
4.  Создайте объект модуля записи и загрузите профиль, созданный на предыдущем шаге. Дополнительные сведения о записи файлов см. в разделе [запись файлов ASF](writing-asf-files.md).
5.  Пройдите по входным данным файла и присвойте входные свойства, как обычно. Дополнительные сведения о входных данных см. [в разделе Работа с входными](working-with-inputs.md)данными. Для потока, закодированного с помощью стороннего кодека, установите указатель интерфейса [**ивминпутмедиапропс**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwminputmediaprops) в **значение NULL** перед вызовом [**ивмвритер:: бегинвритинг**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-beginwriting).
6.  Используйте новый профиль, созданный на предыдущем шаге, для записи файла. Передайте сжатые образцы с помощью [**ивмвритерадванцед:: вритестреамсампле**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriteradvanced-writestreamsample) вместо [**Ивмвритер:: вритесампле**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-writesample). Для видео необходимо указать, какие примеры являются ключевыми кадрами, передав WM \_ SF \_ клеанпоинт в качестве параметра *dwFlags* .

Чтобы обработать и распаковать поток, закодированный сторонним кодеком, необходимо ознакомиться со сжатыми примерами потока. Приложение для чтения должно также выполнять распаковку выборки для потока.

## <a name="putting-mpeg-2-streams-into-asf"></a>Размещение потоков MPEG-2 в формате ASF

> [!Note]  
> Эта статья относится к приложениям, использующим пакет SDK Windows Media Format для помещения MPEG-2 (или других форматов сжатия, использующих кадры B) в контейнер файлов ASF.

 

Объект модуля записи требует, чтобы все входные образцы имели штампы времени, и предполагается, что каждый входной пример имеет время презентации позже, чем предшествующее ему. Хотя практически все несжатые видео и даже некоторые сжатые видеопотоки соответствуют этим условиям, потоки MPEG-2 не имеют. В формате MPEG-2 не все образцы имеют отметку времени, а при наличии кадров B, порядок декодирования примеров не совпадает с порядком отрисовки. Когда объект модуля записи обнаруживает неупорядоченные образцы, он перемещает их в правильный порядок. Таким образом, чтобы хранить потоки MPEG-2 в собственном (не декодированном) потоке в контейнере ASF, необходимо выполнить следующие действия.

При записи файла:

1.  Добавьте расширение единицы данных фиксированного размера (из-за) к каждому входному примеру, который будет содержать структуру, содержащую фактические значения времени начала и времени остановки для образца. Используйте значение-1 для этих значений, если у образца нет метки времени.
2.  Предоставьте объекту модуля записи "фиктивные" метки времени, которые всегда увеличиваются, чтобы они записывали образцы в файл в том же порядке, в котором они были получены. Штампы времени фиктивных данных должны соответствовать реальному времени показа, как усреднено по времени. Временные метки времени формируют временную шкалу, поэтому если они расходятся относительно меток реального времени, операции поиска в файле приведут к непредвиденным результатам. Однако ограниченное количество колебаний между временами выборки не повлияет на операции поиска.

При чтении файла:

-   Для каждого примера, считанного из файла, следует изучить значение по причине. Если оно содержит время начала, которое больше или равно нулю, скопируйте это значение в отметку времени для образца выходных данных перед его доставкой в декодер. Задайте для всех других меток времени в выходных образцах **значение NULL**. В DirectShow это делается путем вызова **имедиасампле:: setTime**(**null**,**null**).

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Буферизация содержимого**](buffering-content.md)
</dt> <dt>

[**Интерфейс Ивмвритер**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriter)
</dt> <dt>

[**Интерфейс Ивмвритерадванцед**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmwriteradvanced)
</dt> <dt>

[**Доставка сжатых образцов с помощью асинхронного модуля чтения**](to-deliver-compressed-samples-with-the-asynchronous-reader.md)
</dt> <dt>

[**Получение примеров Stream с помощью синхронного модуля чтения**](to-retrieve-stream-samples-with-the-synchronous-reader.md)
</dt> <dt>

[**вмвидеоинфохеадер**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wmvideoinfoheader)
</dt> <dt>

[**Работа с профилями**](working-with-profiles.md)
</dt> <dt>

[**Запись файлов ASF**](writing-asf-files.md)
</dt> </dl>

 

 




