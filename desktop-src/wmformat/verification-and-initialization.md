---
title: Проверка и инициализация
description: Проверка и инициализация
ms.assetid: e92abaa2-0bac-4c78-bda7-d118c4f5b332
keywords:
- Windows Media Format SDK, проверка
- Windows Media Format SDK, инициализация
- Управление цифровыми правами (DRM), проверка
- DRM (Управление цифровыми правами), проверка
- Управление цифровыми правами (DRM), инициализация
- DRM (Управление цифровыми правами), инициализация
- Расширенные API клиента DRM, проверка
- Расширенные API клиента, проверка
- Расширенные API клиента DRM, инициализация
- Расширенные API клиента, инициализация
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59c54b56e0622fb65a1a57ae1909e0e6e64aaca6
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104336375"
---
# <a name="verification-and-initialization"></a>Проверка и инициализация

Чтобы проверить, разрешено ли шифрование и инициализировать объект, который будет расшифровывать содержимое, выполните следующие действия.

1.  Если у вас уже есть идентификатор ключа для содержимого, перейдите к шагу 5.
2.  Вызовите функцию [**вмкреатидитор**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreateeditor) , чтобы создать объект редактора метаданных и получить экземпляр интерфейса [**ивмметадатаедитор**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmetadataeditor) этого объекта.
3.  Вызовите метод **ивмметадатаедитор:: QueryInterface** , чтобы получить экземпляр интерфейса [**ивмдрмедитор**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmeditor) .
4.  Вызовите [**ивмдрмедитор:: жетдрмпроперти**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmeditor-getdrmproperty) , чтобы получить свойство **DRM \_ дрмхеадер \_ KeyID** .
5.  Инициализируйте расширенные API клиента DRM Windows Media, вызвав функцию [**вмдрмстартуп**](wmdrmstartup.md) .
6.  Вызовите функцию [**вмдрмкреатепротектедпровидер**](wmdrmcreateprotectedprovider.md) , чтобы создать объект безопасного поставщика и получить экземпляр интерфейса [**ивмдрмпровидер**](iwmdrmprovider.md) этого объекта.
7.  Вызовите метод [**ивмдрмпровидер:: CreateObject**](iwmdrmprovider-createobject.md) , чтобы создать объект управления лицензиями и получить экземпляр его интерфейса [**ивмдрмлиценсеманажемент**](iwmdrmlicensemanagement.md) .
8.  Вызовите [**ивмдрмлиценсеманажемент:: креателиценсинумератион**](iwmdrmlicensemanagement-createlicenseenumeration.md), передав идентификатор ключа и право, которые управляют действиями, выполняемыми с содержимым после его шифрования. Этот вызов получит экземпляр интерфейса [**ивмдрмлиценсе**](iwmdrmlicense.md) , который можно использовать для перечисления всех соответствующих лицензий.
9.  Вызовите [**ивмдрмлиценсе:: жетинклусионлист**](iwmdrmlicense-getinclusionlist.md) , чтобы получить список проверенных систем защиты содержимого (CPS) в соответствии с указаниями издателя лицензии.
10. Проанализируйте список включения, чтобы убедиться в том, что идентификатор GUID выходного сервера публикаций Contribute разрешен лицензией.
11. Если нужный GUID экспорта отсутствует в списке включения, вызовите [**ивмдрмлиценсе:: GetNext**](iwmdrmlicense-getnext.md) , чтобы получить следующую подходящую лицензию (если она есть), и повторите шаги 9 и 10. Если ни одна из лицензий не содержит требуемый идентификатор GUID в списке включения, экспорт не может быть выполнен.
12. Вызовите метод [**ивмдрмлиценсе:: креатесекуредекриптор**](iwmdrmlicense-createsecuredecryptor.md) , чтобы создать объект дешифратора. Передайте сертификат экспорта приложения. Этот вызов предоставит указатель на экземпляр интерфейса [**ивмдрмдекрипт**](iwmdrmdecrypt.md) объекта дешифратора и двоичный объект, содержащий начальное значение. В данный момент в качестве аргумента параметра *dwFlags* поддерживается только константа **\_ \_ \_ RC4 типа защиты DRM** Windows Media.
13. Используйте схему шифрования OAEP RSA для расшифровки вектора инициализации.
14. Используйте библиотеку синтаксического анализа ASF, предоставляемую корпорацией Майкрософт при входе в соглашение Export DRM для Windows Media, чтобы указать смещение в байтах для каждой полезной нагрузки.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Экспорт сжатого содержимого**](exporting-compressed-content.md)
</dt> </dl>

 

 




