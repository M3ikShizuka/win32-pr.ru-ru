---
title: Написание примеров видеороликов
description: Написание примеров видеороликов
ms.assetid: 1d375186-230a-4a18-a995-b331c72a76e7
keywords:
- Расширенный формат систем (ASF), написание образцов видеороликов
- ASF (Расширенный системный формат), написание образцов видеороликов
- видеоизображения, создание образцов
- потоки, запись образцов видеороликов
- кодеки, написание образцов видеороликов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0fbac644d7938477ba3d2e8b21ebb6e631a47708
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "104336295"
---
# <a name="writing-video-image-samples"></a>Написание примеров видеороликов

Поток видеоизображения — это видео, которое содержит последовательность изображений. Изображения могут перемещаться внутри рамки, и каждое изображение может быть перенесено в следующую область. Потоки видеороликов кодируются с помощью кодека Windows Media Video 9 Image v2. Выходное видео аналогично тому, что было создано кодеком Windows Media Video 9.

Чтобы создать профиль, содержащий поток видеоизображения, начните с перечисления видеокодеков, как описано в статье [Получение сведений о конфигурации потока из кодеков](getting-stream-configuration-information-from-codecs.md). Найдите кодек, который поддерживает \_ ПОДТИП вммедиасубтипе WVP2.

После настройки профиля в объекте модуля записи вызовите метод [**ивмвритер:: жетинпутпропс**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmwriter-getinputprops) , чтобы получить свойства мультимедиа для входного потока видеоизображения. Получите тип мультимедиа из объекта свойств носителя, вызвав [**ивммедиапропс:: жетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype), и измените ПОДТИП на вммедиасубтипе \_ видеоимаже. Необходимо задать ширину и высоту видео в соответствии с максимальным размером, необходимым для охватывающих изображения, которые будут добавлены в поток. Затем вызовите [**ивммедиапропс:: сетмедиатипе**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-setmediatype) с измененным типом входных данных. Теперь вы готовы начать отправку образцов в объект модуля записи.

Каждый пример должен начинаться с структуры **ВМТ \_ видеоимаже \_ SAMPLE2** . Кроме того, примеры могут содержать растровые изображения. Изображение прикрепляется к образцу только для первого кадра, в котором он отображается. Всем дополнительным кадрам, использующим этот образ, требуется только информация в структуре. Входные точечные рисунки должны иметь формат RGB, 24 бита на пиксель.

Файлы точечных рисунков хранят данные изображения таким образом, чтобы данные для каждой строки изображения занимали несколько байтов, кратных четырем. (Это называется шагом точечного рисунка.) Это заставляет начало каждой строки видео превышено на границу **DWORD** , что делает копирование более эффективным. Если строки изображения не делятся неравномерно на четыре, то строка заполняется до следующего наибольшего числа, кратного четырем байтам. При присоединении данных изображения необходимо удалить все заполнения, существующие в конце данных для каждой строки.

Кодек Windows Media Video 9 Image v2 поддерживает до двух изображений в памяти за раз. Эти изображения называются предыдущим и текущим изображениями. Каждый образ имеет набор элементов в структуре **ВМТ \_ видеоимаже \_ SAMPLE2** , который определяет, как изображение отображается в кадре. Вы можете добавить образ, задав для элемента Двконтролфлагс в **ВМТ \_ видеоимаже \_ SAMPLE2** значение ВМТ \_ видеоимаже \_ пример \_ входного \_ кадра. При передаче кадра ввода в кодек этот образ станет текущим изображением. Изображение, которое было текущим изображением в предыдущем примере, обычно становится предыдущим изображением, а изображение, которое было предыдущим изображением в предыдущем примере, отбрасывается. Можно настроить кодек для удержания старого предыдущего изображения, задав для элемента **Бкиппревимаже** **значение true**. В этом случае изображение, которое было текущим изображением в предыдущем примере, отбрасывается.

Базовая композиция кадра видеоизображения определяется двумя факторами для каждого изображения: областью интересов и коэффициентом смешения. Область, представляющая интерес для изображения, определяется исходной точкой, шириной и высотой. Часть изображения, описываемая интересующим регионом, заполняет выходной кадр. Если размер интересующей области отличается от размера выходного фрейма, кодек изменяет его размер. Коэффициент смешения изображения определяет смешение двух изображений. Коэффициенты смешения для текущего и предыдущего изображений должны всего 1,0. Например, если для **фкуррблендкоеф** задано значение 0,5, а **фпревблендкоеф** имеет значение 0,5, то выходной кадр состоит из одинакового смешения интересующих регионов из обоих изображений.

Управляя интересующей областью изображения, можно создавать эффекты панорамирования и масштабирования. Коэффициенты смешения позволяют пересекать (растворение) между изображениями. Помимо этих эффектов, для создания более сложных кадров можно использовать один из стандартных переходов. Доступные переходы описаны в разделе [переходы по изображениям видео](video-image-transitions.md) этой документации. При использовании перехода необходимо настроить каждый кадр. Самый простой способ сделать это — создать функцию, которая постепенно изменяет члены структуры **ВМТ \_ видеоимаже \_ SAMPLE2** для выполнения всего действия.

Дополнительные сведения о значениях, которые необходимо задать для обозначений, см. в разделе [**ВМТ \_ видеоимаже \_ SAMPLE2**](/previous-versions/windows/desktop/api/Wmsdkidl/ns-wmsdkidl-wmt_videoimage_sample2).

**Примечание** . Если вы хотите включить звук в файл с потоком видеоизображения, необходимо использовать несжатый звуковый вход. Чтобы объединить поток видеоизображения с существующим сжатым потоком звука, необходимо распаковать звук и передать образцы в несжатом виде. Если передать сжатые образцы в модуль записи при записи потока видеоизображения, возникнет ошибка, в результате чего образцы будут удалены из видео.

Кроме того, сжатые файлы видеоизображений без звуковых потоков могут содержать несколько очень мелких, очень сжатых видеокадров в одном пакете ASF, что может привести к плохому воспроизведению в предыдущих версиях проигрывателя Windows Media. Чтобы избежать этой проблемы, лучшим решением будет Вставка в файл звукового потока без звука, хотя это также увеличит размер файла.

## <a name="related-topics"></a>См. также

<dl> <dt>

[**Видеоизображение**](video-image.md)
</dt> <dt>

[**Запись файлов ASF**](writing-asf-files.md)
</dt> </dl>

 

 




