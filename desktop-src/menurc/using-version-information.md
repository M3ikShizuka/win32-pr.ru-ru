---
title: Использование сведений о версии
description: В этом разделе рассматривается использование функций сведений о версии.
ms.assetid: 447b57c9-9e94-4a28-897e-f7b87d9cb25a
keywords:
- ресурсы, сведения о версии
- сведения о версии
- сведения о файле установки
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a8785275f5aac69218989250d1c0f83e0a1ff9f
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127459451"
---
# <a name="using-version-information"></a>Использование сведений о версии

Программа установки обычно имеет следующие цели:

-   Размещение файлов в правильном расположении.
-   Для уведомления пользователя, если программа установки заменяет существующий файл значительно отличающейся версией (например, замените файл на немецком языке файлом на английском языке) или замените более новый файл более старым.

При написании программы установки необходимо иметь следующие сведения для каждого файла:

-   Имя и расположение файла (называемого исходным файлом).
-   Имя эквивалентного файла на жестком диске пользователя (который называется файлом назначения). Обычно это имя совпадает с именем файла на установочном диске.
-   Состояние общего доступа к файлу — то есть, является ли файл частным для устанавливаемого приложения или может совместно использоваться несколькими приложениями.

Программа установки может использовать функцию [**верфиндфиле**](/windows/desktop/api/Winver/nf-winver-verfindfilea) для определения места копирования файла на диск. Эта функция также может использоваться для указания того, является ли файл частным для приложения или может быть общим. Если при поиске файла возникает проблема, **верфиндфиле** возвращает значение ошибки. Например, если система использует файл назначения, **верфиндфиле** возвращает **ВФФ \_ филеинусе**. Программа установки должна уведомить пользователя о проблеме и ответить на решение пользователя продолжить или завершить установку.

Функция [**веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) копирует исходный файл во временный файл в каталоге, указанном параметром [**верфиндфиле**](/windows/desktop/api/Winver/nf-winver-verfindfilea). При необходимости **веринсталлфиле** расширяет файл с помощью функций в библиотеке распаковки данных.

[**Веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) сравнивает сведения о версии временного файла с целевым файлом. Если эти две различаются, **веринсталлфиле** возвращает одно или несколько значений ошибок. Например, он возвращает **ВИФ \_ срколд** , если временный файл старше целевого файла, и **ВИФ \_ диффланг** , если файлы имеют разные идентификаторы языка или значения кодовой страницы. Программа установки должна уведомить пользователя о проблеме и ответить на решение пользователя продолжить или завершить установку.

Некоторые ошибки [**веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) могут быть восстановлены. Это значит, что программа установки может снова вызвать **веринсталлфиле** , указав параметр **ВИФФ \_ форцеинсталл** , чтобы установить файл независимо от конфликта версий. Если **веринсталлфиле** возвращает **ВИФ \_ темпфиле** и пользователь решил не устанавливать принудительную установку, программа установки должна удалить временный файл.

[**Веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) может столкнуться с неустранимой ошибкой при попытке принудительной установки, даже если эта ошибка не существовала ранее. Например, файл может быть заблокирован другим пользователем до того, как программа установки попытается принудительно выполнить установку. Если программа установки пытается принудительно выполнить установку после неустранимой ошибки, **веринсталлфиле** завершается сбоем. Программа установки должна содержать подпрограммы для восстановления после ошибки такого типа.

Рекомендуемым решением является отображение диалогового окна с кнопками **установить**, **пропустить** и **установить все**. (Другое решение — это диалоговое окно с кнопками **Да**, **Да для всех**, **пропустить** и **Отмена**.) Кнопка **установить все** не позволит программе установки выдать запрос на ввод похожих ошибок, включив параметр **ВИФФ \_ форцеинсталл** во всех последующих применениях [**веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea). Для неустранимых ошибок кнопки **установить** и **установить все** должны быть отключены.

Чтобы отобразить полезное сообщение об ошибке для пользователя, программа установки обычно должна получить сведения из ресурсов версий конфликтующих файлов. Для этой цели программа установки может использовать четыре функции:

-   [**Ошибка getfileversioninfosize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea)
-   [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)
-   [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea)
-   [**верлангуаженаме**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea)

[**Ошибка getfileversioninfosize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) возвращает размер сведений о версии. [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) использует сведения, полученные с помощью **Ошибка getfileversioninfosize** , для получения структуры, содержащей сведения о версии. [**Веркуеривалуе**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) извлекает из этой структуры конкретный элемент.

Например, если [**веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) возвращает ошибку **\_ диффтипе ВИФ** , программа установки должна использовать функции [**Ошибка getfileversioninfosize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)и [**веркуеривалуе**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) для временных и целевых файлов, чтобы получить общий тип каждого файла. Если языки файлов конфликтуют, программа установки также должна использовать [**верлангуаженаме**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) для перевода двоичного идентификатора языка в текстовое представление языка. (Например, 0x040C преобразуется в строку «французский».)

Если [**веринсталлфиле**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) возвращает ошибку файла, например **ВИФ \_ AccessViolationException**, программа установки должна использовать функцию [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) для получения последнего значения ошибки. Программа должна преобразовать это значение в информативное сообщение, отображаемое пользователю. Программа не должна возвращать управление между вызовами **веринсталлфиле** и **GetLastError**.

 

 