---
title: О меню
description: В этом разделе обсуждаются меню.
ms.assetid: fd0b26f1-93cd-421b-9097-8502ab7681e9
keywords:
- ресурсы, меню
- меню, сведения
- подменю
- строки меню
- меню верхнего уровня
- всплывающие меню
- раскрывающиеся меню
- меню, верхний уровень
- меню, всплывающее окно
- меню, раскрывающийся список
- имена меню
- меню, ярлык
- меню, окно
- меню, система
- меню, элемент управления
- контекстные меню
- Меню "Окно"
- Системное меню
- Меню управления
- идентификаторы справки
- дескрипторы меню
- пункты меню
- командные элементы
- идентификаторы элементов меню
- меню — позиция элемента
- Выбор пунктов меню
- Очистка пунктов меню
- меню, рисуемое владельцем
- меню, рисуемых владельцем
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed5d42eb42aaaaa16eef0b5b118adcfe0f91156e
ms.sourcegitcommit: d75fc10b9f0825bbe5ce5045c90d4045e3c53243
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/13/2021
ms.locfileid: "127268584"
---
# <a name="about-menus"></a>О меню

*Меню* — это список элементов, в котором указываются параметры или группы параметров (подменю) для приложения. При щелчке пункта меню открывается подменю или приложение выполняет команду. В этом разделе содержатся сведения по следующим темам:

-   [Строки меню и меню](#menu-bars-and-menus)
    -   [Контекстные меню](#shortcut-menus)
    -   [Меню «окно»](#the-window-menu)
    -   [Идентификатор справки](#help-identifier)
-   [Доступ с клавиатуры к меню](#keyboard-access-to-menus)
    -   [Стандартный интерфейс клавиатуры](#standard-keyboard-interface)
    -   [Ключи доступа к меню](#menu-access-keys)
    -   [Сочетания клавиш для меню](#menu-shortcut-keys)
-   [Создание меню](#menu-creation)
    -   [Ресурсы шаблона меню](#menu-template-resources)
    -   [Шаблон меню в памяти](#menu-template-in-memory)
    -   [Дескрипторы меню](#menu-handles)
    -   [Функции создания меню](#menu-creation-functions)
    -   [Отображение меню](#menu-display)
    -   [Меню классов окон](#window-class-menus)
-   [Пункты меню](#menu-items)
    -   [Элементы команд и элементы, открывающие подменю](#command-items-and-items-that-open-submenus)
    -   [Меню — идентификатор элемента](#menu-item-identifier)
    -   [Меню — позиция элемента](#menu-item-position)
    -   [Доступ к пунктам меню программным способом](#accessing-menu-items-programmatically)
    -   [Элементы меню по умолчанию](#default-menu-items)
    -   [Выбранные и очищенные пункты меню](#selected-and-clear-menu-items)
    -   [Включенные, серые и отключенные пункты меню](#enabled-grayed-and-disabled-menu-items)
    -   [Выделенные пункты меню](#highlighted-menu-items)
    -   [Элементы меню, рисуемые владельцем](#owner-drawn-menu-items)
    -   [Разделители пунктов меню и разрывы строк](#menu-item-separators-and-line-breaks)
-   [Сообщения, используемые с меню](#messages-used-with-menus)
-   [Уничтожение меню](#menu-destruction)

## <a name="menu-bars-and-menus"></a>Строки меню и меню

Меню упорядочивается в иерархии. На верхнем уровне иерархии находится *строка меню*; , содержащий список *меню*, которые, в свою очередь, могут содержать *подменю*. Строка меню иногда называется *меню верхнего уровня*, а меню и подменю также называются *всплывающими меню*.

Пункт меню может либо выполнить команду, либо открыть подменю. Элемент, выполняющий команду, называется *командным элементом* или *командой*.

Элемент в строке меню почти всегда открывает меню. Строки меню редко содержат элементы команд. Меню, открываемое из строки меню, выпадает из строки меню и иногда называется раскрывающимся *меню*. При отображении раскрывающегося меню оно прикрепляется к строке меню. Пункт меню в строке меню, открывающем раскрывающееся меню, также называется *именем меню*.

Имена меню в строке меню представляют основные категории команд, предоставляемых приложением. При выборе имени меню в строке меню обычно открывается меню, пункты меню которого соответствуют командам в категории. Например, строка меню может содержать имя меню « **файл** », которое при щелчке пользователем активирует меню с такими элементами меню, как « **создать**», « **Открыть**» и « **сохранить**». Чтобы получить сведения о строке меню, вызовите [**GetMenuBarInfo**](/windows/desktop/api/Winuser/nf-winuser-getmenubarinfo).

Только перекрывающиеся или всплывающие окна могут содержать строку меню; дочернее окно не может содержать одно. Если окно содержит заголовок, система размещает строку меню под ней. Строка меню всегда видна. Однако подменю не отображается, пока пользователь не выберет пункт меню, который его активирует. Дополнительные сведения о перекрывающихся и всплывающих окнах см. в разделе [типы окон](/windows/desktop/winmsg/window-features).

Каждое меню должно иметь окно владельца. Система отправляет сообщения в окно владельца меню, когда пользователь выбирает меню или выбирает элемент из меню.

В этом разделе рассматриваются следующие темы.

-   [Контекстные меню](#shortcut-menus)
-   [Меню «окно»](#the-window-menu)
-   [Идентификатор справки](#help-identifier)

### <a name="shortcut-menus"></a>Контекстные меню

Система также предоставляет *Контекстные меню*. Контекстное меню не присоединено к строке меню; Он может находиться в любом месте экрана. Приложение обычно связывает контекстное меню с частью окна, например клиентской областью, или с конкретным объектом, например значком. По этой причине эти меню также называются *контекстными меню*.

Контекстное меню остается скрытым до тех пор, пока пользователь не активирует его, обычно щелкнув правой кнопкой мыши выделенную область, панель инструментов или кнопку на панели задач. Меню обычно отображается в положении курсора или курсора мыши.

### <a name="the-window-menu"></a>Меню «окно»

Меню « **окно»** (также называемое **системным** меню или меню « **Управление** ») — это всплывающее меню, которое определяется и управляется практически исключительно операционной системой. Пользователь может открыть меню окно, щелкнув значок приложения в строке заголовка или щелкнув правой кнопкой мыши в любом месте заголовка окна.

Меню **окно** предоставляет стандартный набор элементов меню, которые пользователь может выбрать для изменения размера или расположения окна, или закрыть приложение. Элементы в меню окно можно добавлять, удалять и изменять, но большинство приложений просто используют стандартный набор пунктов меню. Перекрывающиеся, всплывающие или дочерние окна могут иметь меню окон. Часто перекрытие или всплывающее окно не включает меню окна.

Когда пользователь выбирает команду в меню " **окно** ", система отправляет сообщение [**WM \_ сискомманд**](wm-syscommand.md) в окно владельца меню. В большинстве приложений процедура Window не обрабатывает сообщения из меню окно. Вместо этого он просто передает сообщения в функцию [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для обработки сообщения системой по умолчанию. Если приложение добавляет команду в меню окно, процедура окна должна обработать команду.

Приложение может использовать функцию [**жетсистеммену**](/windows/desktop/api/Winuser/nf-winuser-getsystemmenu) , чтобы создать копию меню окна по умолчанию для изменения. Любое окно, не использующее функцию **жетсистеммену** для создания собственной копии меню «окно», получает стандартное меню «окно».

### <a name="help-identifier"></a>Идентификатор справки

Это идентификатор справки, связанный с каждой строкой меню, меню, подменю и контекстным меню. Если пользователь нажимает клавишу F1, когда меню активно, это значение отправляется в окно "владелец" как часть [**\_ справочного сообщения WM**](../shell/wm-help.md) .

## <a name="keyboard-access-to-menus"></a>Доступ с клавиатуры к меню

Система предоставляет стандартный интерфейс клавиатуры для меню. Этот интерфейс можно расширить, предоставив назначенные клавиши доступа и сочетания клавиш (сочетания клавиш) для пунктов меню.

В следующих разделах описывается стандартный интерфейс клавиатуры, ключи доступа и сочетания клавиш:

-   [Стандартный интерфейс клавиатуры](#standard-keyboard-interface)
-   [Ключи доступа к меню](#menu-access-keys)
-   [Сочетания клавиш для меню](#menu-shortcut-keys)

### <a name="standard-keyboard-interface"></a>Стандартный интерфейс клавиатуры

Система разработана для работы с мышью или другими указывающими устройствами или без них. Поскольку система предоставляет стандартный интерфейс клавиатуры, пользователь может использовать клавиатуру для выбора пунктов меню. Этот интерфейс клавиатуры не требует специального кода. Приложение получает сообщение команды о том, выбирает ли пользователь пункт меню с помощью клавиатуры или с помощью мыши. Стандартный интерфейс клавиатуры обрабатывает следующие нажатия клавиш.



| Клавиши              | Действие                                                                                                                                                                                                                                   |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Алфавитный символ | Выбирает первый элемент меню с указанным символом в качестве ключа доступа. Если выбранный элемент вызывает меню, отображается меню, и первый элемент выделяется. В противном случае выбирается пункт меню.                            |
| ALT                    | Включает и выключает режим строки меню.                                                                                                                                                                                                     |
| ALT + ПРОБЕЛ           | Отображает меню окно.                                                                                                                                                                                                                |
| ВВОД                  | Активирует меню и выбирает первый пункт меню, если у элемента есть связанное с ним меню. В противном случае нажатие клавиши выбирает элемент, как если бы пользователь отпускает кнопку мыши во время выбора элемента.                              |
| ESC                    | Выход из режима меню.                                                                                                                                                                                                                         |
| СТРЕЛКА ВЛЕВО             | Циклический переход к предыдущему пункту меню верхнего уровня. Пункты меню верхнего уровня включают имена меню и оконное меню. Если выбранный элемент находится в меню, выбирается предыдущий столбец в меню или выбирается предыдущий пункт меню верхнего уровня. |
| СТРЕЛКА ВПРАВО            | Работает как клавиша со стрелкой влево, за исключением обратного направления. В меню это нажатие клавиши перемещается вперед на один столбец; когда текущий выбранный элемент находится в крайнем правом столбце, выбирается следующее меню.                              |
| СТРЕЛКИ вверх или вниз      | Активирует меню при нажатии в имени меню. При нажатии в меню клавиша со стрелкой вверх выбирает предыдущий элемент. Нажатие клавиши со стрелкой вниз выбирает следующий элемент.                                                                  |



 

### <a name="menu-access-keys"></a>Ключи доступа к меню

Стандартный интерфейс клавиатуры для меню можно расширить, добавив клавиши доступа (назначенные клавиши) в пункты меню. Клавиша доступа — это подчеркнутая буква в тексте пункта меню. Когда меню активно, пользователь может выбрать пункт меню, нажав клавишу, соответствующую подчеркнутой букве элемента. Пользователь делает строку меню активной, нажав клавишу ALT, чтобы выделить первый элемент в строке меню. Меню активно, когда оно отображается.

Чтобы создать ключ доступа для пункта меню, перед любым символом в текстовой строке элемента введите амперсанд. Например, Текстовая строка "&Move" заставляет систему подчеркиванием буквы "M".

### <a name="menu-shortcut-keys"></a>Сочетания клавиш для меню

В дополнение к клавише доступа, элементу меню может быть назначена комбинация клавиш. Сочетание клавиш отличается от клавиши доступа, поскольку меню не обязательно должно быть активным для работы сочетания клавиш. Кроме того, клавиша доступа *всегда* связана с пунктом меню, а сочетание клавиш *обычно* (но не обязательно) связано с пунктом меню.

Текст, определяющий сочетание клавиш, добавляется в текстовую строку элемента меню. Текст ярлыка отображается справа от имени элемента меню после обратной косой черты и символа табуляции ( \\ t). Например, "&Close \\ талт + F4" представляет команду "Закрыть" с сочетанием клавиш ALT + F4 в качестве сочетания клавиш и буквой "C" в качестве ключа доступа. Дополнительные сведения см. в разделе [сочетания](keyboard-accelerators.md)клавиш.

## <a name="menu-creation"></a>Создание меню

Меню можно создать с помощью шаблона меню или функций создания меню. Шаблоны меню обычно определяются как ресурсы. Меню — ресурсы шаблона можно загрузить явным образом или назначить в качестве меню по умолчанию для класса окна. Кроме того, в памяти можно динамически создавать шаблонные ресурсы меню.

В следующих разделах подробно описывается создание меню.

-   [Ресурсы шаблона меню](#menu-template-resources)
-   [Шаблон меню в памяти](#menu-template-in-memory)
-   [Дескрипторы меню](#menu-handles)
-   [Функции создания меню](#menu-creation-functions)
-   [Отображение меню](#menu-display)
-   [Меню классов окон](#window-class-menus)

### <a name="menu-template-resources"></a>Ресурсы шаблона меню

Большинство приложений создают меню с помощью контекстных ресурсов меню. *Шаблон меню* определяет меню, включая элементы в строке меню и все меню. Сведения о создании ресурса шаблона меню см. в документации, входящей в состав средств разработки.

После создания ресурса шаблона меню и добавления его в исполняемый файл приложения (.exe) можно использовать функцию [**лоадмену**](/windows/desktop/api/Winuser/nf-winuser-loadmenua) для загрузки ресурса в память. Эта функция возвращает в меню маркер, который затем можно присвоить окну с помощью функции [**сетмену**](/windows/desktop/api/Winuser/nf-winuser-setmenu) . Меню можно назначить любому окну, которое не является дочерним окном.

Реализация меню в качестве ресурсов упрощает локализацию приложения для использования в нескольких странах и регионах. Только файл определения ресурса должен быть локализован для каждого языка, а не исходного кода приложения.

### <a name="menu-template-in-memory"></a>Шаблон меню в памяти

Меню можно создать из шаблона меню, который построен в памяти во время выполнения. Например, приложение, которое позволяет пользователю настраивать меню, может создать шаблон меню в памяти на основе предпочтений пользователя. Затем приложение может сохранить шаблон в файле или в реестре для последующего использования. Чтобы создать меню из шаблона в памяти, используйте функцию [**лоадменуиндирект**](/windows/desktop/api/Winuser/nf-winuser-loadmenuindirecta) . Описание форматов шаблонов меню см. в разделе [ресурсы шаблона меню](#menu-template-resources).

Стандартный шаблон меню состоит из структуры [**менуитемтемплатехеадер**](/windows/desktop/api/Winuser/ns-winuser-menuitemtemplateheader) , за которой следует одна или несколько структур [**менуитемтемплате**](/windows/desktop/api/Winuser/ns-winuser-menuitemtemplate) .

Расширенный шаблон меню состоит из структуры [**\_ \_ заголовка шаблона менуекс**](menuex-template-header.md) , за которой следуют одна или несколько [**структур \_ \_ элементов шаблона менуекс**](menuex-template-item.md) .

### <a name="menu-handles"></a>Дескрипторы меню

Система создает уникальный маркер для каждого меню. *Маркер меню* — это значение типа **HMENU** . Приложение должно задавать маркер меню во многих функциях меню. При создании меню или загрузке ресурса меню вы получаете маркер в строке меню.

Чтобы получить маркер в строке меню для созданного или загруженного меню, используйте функцию [**Menu**](/windows/desktop/api/Winuser/nf-winuser-getmenu) . Чтобы получить маркер в подменю, связанном с пунктом меню, используйте [**вложенное**](/windows/desktop/api/Winuser/nf-winuser-getsubmenu) меню или функцию [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa) . Чтобы получить маркер в меню окна, используйте функцию [**жетсистеммену**](/windows/desktop/api/Winuser/nf-winuser-getsystemmenu) .

### <a name="menu-creation-functions"></a>Функции создания меню

С помощью функций создания меню можно создавать меню во время выполнения или добавлять пункты меню в существующие меню. С помощью функции [**креатемену**](/windows/desktop/api/Winuser/nf-winuser-createmenu) можно создать пустую строку меню и функцию [**креатепопупмену**](/windows/desktop/api/Winuser/nf-winuser-createpopupmenu) , чтобы создать пустое меню. Вы можете сохранить определенные сведения о параметрах меню с помощью структуры [**менуинфо**](/windows/win32/api/winuser/ns-winuser-menuinfo) . Чтобы получить или получить параметры меню, используйте [**жетменуинфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuinfo) или [**сетменуинфо**](/windows/desktop/api/Winuser/nf-winuser-setmenuinfo). Чтобы добавить элементы в меню, используйте функцию [**инсертменуитем**](/windows/desktop/api/Winuser/nf-winuser-insertmenuitema) . Старые функции [**аппендмену**](/windows/desktop/api/Winuser/nf-winuser-appendmenua) и [**инсертмену**](/windows/desktop/api/Winuser/nf-winuser-insertmenua) по-прежнему поддерживаются, но **инсертменуитем** следует использовать для новых приложений.

### <a name="menu-display"></a>Отображение меню

После того как меню загружено или создано, оно должно быть назначено окну, прежде чем система сможет отобразить его. Можно назначить меню, определив меню класса. Дополнительные сведения см. в разделе [меню классов окон](#window-class-menus). Можно также назначить меню окну, указав его маркер в качестве параметра *HMENU* функции [**CreateWindow**](/windows/desktop/api/winuser/nf-winuser-createwindowa) или [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) или вызвав функцию [**сетмену**](/windows/desktop/api/Winuser/nf-winuser-setmenu) .

Для вывода контекстного меню используйте функцию [**траккпопупменуекс**](/windows/desktop/api/Winuser/nf-winuser-trackpopupmenuex) . Контекстные меню, называемые также плавающими всплывающими меню или контекстными меню, обычно отображаются при обработке сообщения [**WM \_ CONTEXTMENU**](wm-contextmenu.md) .

Меню можно назначить любому окну, которое не является дочерним окном.

Старая функция [**метод TrackPopupMenu**](/windows/desktop/api/Winuser/nf-winuser-trackpopupmenu) по-прежнему поддерживается, но новые приложения должны использовать функцию [**траккпопупменуекс**](/windows/desktop/api/Winuser/nf-winuser-trackpopupmenuex) .

### <a name="window-class-menus"></a>Меню классов окон

При регистрации класса окна можно указать меню по умолчанию, называемое *меню класса* . Для этого необходимо назначить имя ресурса шаблона меню элементу **лпсзменунаме** структуры [**вндкласс**](/windows/win32/api/winuser/ns-winuser-wndclassa) , используемой для регистрации класса.

По умолчанию каждому окну присваивается меню класс для своего класса Window, поэтому вам не нужно явно загружать меню и присваивать его каждому окну. Можно переопределить меню класса, указав другой маркер меню в вызове функции [**CreateWindowEx**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) . Можно также изменить меню окна после его создания с помощью функции [**сетмену**](/windows/desktop/api/Winuser/nf-winuser-setmenu) . Дополнительные сведения см. в разделе [классы окон](/windows/desktop/winmsg/window-classes).

## <a name="menu-items"></a>Пункты меню

В следующих разделах рассматриваются действия, выполняемые системой, когда пользователь выбирает пункт меню, а также способы, которыми приложение может управлять внешним видом и функциональностью элемента.

-   [Элементы команд и элементы, открывающие подменю](#command-items-and-items-that-open-submenus)
-   [Меню — идентификатор элемента](#menu-item-identifier)
-   [Меню — позиция элемента](#menu-item-position)
-   [Доступ к пунктам меню программным способом](#accessing-menu-items-programmatically)
-   [Элементы меню по умолчанию](#default-menu-items)
-   [Выбранные и очищенные пункты меню](#selected-and-clear-menu-items)
-   [Включенные, серые и отключенные пункты меню](#enabled-grayed-and-disabled-menu-items)
-   [Выделенные пункты меню](#highlighted-menu-items)
-   [Элементы меню, рисуемые владельцем](#owner-drawn-menu-items)
-   [Разделители пунктов меню и разрывы строк](#menu-item-separators-and-line-breaks)

### <a name="command-items-and-items-that-open-submenus"></a>Элементы команд и элементы, открывающие подменю

Когда пользователь выбирает элемент команды, система отправляет командное сообщение в окно, которому принадлежит меню. Если командный элемент находится в меню окно, система отправляет сообщение [**WM \_ сискомманд**](wm-syscommand.md) . В противном случае отправляется [**\_ командное сообщение WM**](wm-command.md) .

Связанный с каждым пунктом меню, открывающим подменю, является маркером соответствующего подменю. Когда пользователь указывает на такой элемент, система открывает подменю. В окно "владелец" не отправляется командное сообщение. Однако система перед отображением подменю отправляет сообщение [**WM \_ инитменупопуп**](wm-initmenupopup.md) в окно владельца. Вы можете получить маркер для подменю, связанного с элементом, используя [**вложенное меню**](/windows/desktop/api/Winuser/nf-winuser-getsubmenu) или функцию [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa) .

Строка меню обычно содержит имена меню, но она также может содержать командные элементы. Подменю обычно содержит командные элементы, но также может содержать элементы, открывающие вложенные подменю. Добавляя такие элементы в подменю, можно вкладывать меню в любую глубину. Чтобы предоставить визуальную подсказку для пользователя, система автоматически отображает маленькую стрелку справа от текста пункта меню, открывающего подменю.

### <a name="menu-item-identifier"></a>Идентификатор Menu-Item

Связанный с каждым пунктом меню — это уникальное, определяемое приложением целое число, именуемое *идентификатором элемента меню*. Когда пользователь выбирает элемент команды из меню, система отправляет идентификатор элемента в окно владельца как часть [**\_ командного сообщения WM**](wm-command.md) . Процедура окна проверяет идентификатор, чтобы определить источник сообщения, и обрабатывает сообщение соответствующим образом. Кроме того, при вызове функций меню можно указать пункт меню, используя его идентификатор. Например, чтобы включить или отключить пункт меню.

Элементы меню, открывающие подменю, имеют идентификаторы так же, как и элементы команд. Однако система не отправляет командное сообщение при выборе такого элемента из меню. Вместо этого система открывает подменю, связанное с пунктом меню.

Чтобы получить идентификатор элемента меню в указанной позиции, используйте функцию [**жетменуитемид**](/windows/desktop/api/Winuser/nf-winuser-getmenuitemid) или [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa) .

### <a name="menu-item-position"></a>Menu-Itemное расположение

Помимо уникального идентификатора, каждый пункт меню в строке меню или меню имеет уникальное значение позиции. Крайний левый элемент в строке меню или верхний элемент меню имеет нулевую позицию. Значение позиции увеличивается для последующих пунктов меню. Система присваивает значение позиции всем элементам меню, включая разделители. На следующем рисунке показаны значения позиции элементов в строке меню и в меню.

![Строка меню и меню](images/csemn-01.png)

При вызове функции меню, которая изменяет или извлекает сведения о конкретном пункте меню, можно указать элемент, используя его идентификатор или его позицию. Дополнительные сведения см. в следующем разделе.

### <a name="accessing-menu-items-programmatically"></a>Доступ к пунктам меню программным способом

Большинство функций меню позволяют указать пункт меню либо по позиции, либо по команде. Некоторые функции используют флаги **MF \_ Бипоситион** и **MF \_ бикомманд** для указания алгоритма поиска. другие имеют явный параметр *фбипоситион* . Если указать пункт меню по позиции, то номер элемента будет содержать Отсчитываемый от нуля индекс в меню. Если указать пункт меню с помощью команды, в меню и его подменю будет выполнен поиск элемента, идентификатор меню которого равен указанному номеру товара. Если число элементов в иерархии меню совпадает с номером элемента, не указывается, какой из них используется. Если меню содержат дублирующиеся идентификаторы меню, следует использовать операции меню на основе позиций, чтобы избежать этой неоднозначности.

### <a name="default-menu-items"></a>Элементы меню по умолчанию

Подменю может содержать один пункт меню по умолчанию. Когда пользователь открывает подменю двойным щелчком, система отправляет командное сообщение окну-владельцу меню и закрывает меню так, как если бы был выбран элемент команд по умолчанию. Если элемент команды по умолчанию отсутствует, подменю остается открытым. Чтобы получить и задать элемент по умолчанию для подменю, используйте функции [**жетменудефаултитем**](/windows/desktop/api/Winuser/nf-winuser-getmenudefaultitem) и [**сетменудефаултитем**](/windows/desktop/api/Winuser/nf-winuser-setmenudefaultitem) .

### <a name="selected-and-clear-menu-items"></a>Выбранные и очищенные пункты меню

Пункт меню можно либо выбрать, либо очистить. Система отображает точечный рисунок рядом с выбранными элементами меню, чтобы показать их выбранное состояние. Система не отображает точечный рисунок рядом с пунктом очистить элементы, если не задано определенное приложением точечное изображение "Clear". Можно выбрать только пункты меню. нельзя выбрать элементы в строке меню.

Приложения обычно проверяют или очищают пункт меню, чтобы указать, действует ли параметр. Например, предположим, что приложение содержит панель инструментов, которую пользователь может отображать или скрывать с помощью команды **панели инструментов** в меню. Если панель инструментов скрыта, пункт меню **панели инструментов** становится четким. Когда пользователь выбирает команду, приложение проверяет пункт меню и отображает панель инструментов.

Атрибут галочки определяет, выбран ли пункт меню. Можно задать атрибут галочки пункта меню с помощью функции [**чеккменуитем**](/windows/desktop/api/Winuser/nf-winuser-checkmenuitem) . Функцию [**жетменустате**](/windows/desktop/api/Winuser/nf-winuser-getmenustate) можно использовать, чтобы определить, выбран ли в данный момент пункт меню или снят.

Вместо [**чеккменуитем**](/windows/desktop/api/Winuser/nf-winuser-checkmenuitem) и [**жетменустате**](/windows/desktop/api/Winuser/nf-winuser-getmenustate)можно использовать функции [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa) и [**сетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-setmenuiteminfoa) для получения и установки состояния проверки пункта меню.

Иногда группа элементов меню соответствует набору взаимоисключающих параметров. В этом случае можно указать выбранный параметр с помощью выбранного пункта меню переключателя (аналогично элементу управления "переключатель"). Выбранные переключатели отображаются с помощью точечного рисунка, а не точечного рисунка галочки. Чтобы проверить пункт меню и сделать его элементом Радио, используйте функцию [**чеккменурадиоитем**](/windows/desktop/api/Winuser/nf-winuser-checkmenuradioitem) .

По умолчанию система отображает флажок или точечный рисунок рядом с выбранными пунктами меню и без точечного рисунка рядом с пунктом снятые пункты меню. Однако функцию [**сетменуитембитмапс**](/windows/desktop/api/Winuser/nf-winuser-setmenuitembitmaps) можно использовать для связывания выбранных приложением и снятых растровых изображений с пунктом меню. Затем система использует указанные растровые изображения для указания выбранного или выключенного состояния элемента меню.

Определяемые приложением точечные рисунки, связанные с пунктом меню, должны иметь тот же размер, что и точечный рисунок флажка по умолчанию. размеры могут различаться в зависимости от разрешения экрана. Чтобы получить правильные размеры, используйте функцию [**жетсистемметрикс**](/windows/desktop/api/winuser/nf-winuser-getsystemmetrics) . Можно создать несколько растровых ресурсов для различных разрешений экрана. Создайте один ресурс Bitmap и при необходимости измените его масштаб. или создать точечный рисунок во время выполнения и нарисовать в нем изображение. Точечные рисунки могут быть либо монохромными, либо цветными. Однако, поскольку элементы меню инвертированы при выделении, внешний вид некоторых инвертированных цветных растровых изображений может оказаться нежелательным. Дополнительные сведения см. в разделе [точечные рисунки](/windows/desktop/gdi/bitmaps).

### <a name="enabled-grayed-and-disabled-menu-items"></a>Включенные, серые и отключенные пункты меню

Пункт меню может быть включен, серым или отключен. По умолчанию пункт меню включен. Когда пользователь выбирает включенный пункт меню, система отправляет командное сообщение окну-владельцу или отображает соответствующее подменю в зависимости от того, какой вид его пункта меню.

Когда пункты меню недоступны для пользователя, они должны быть серыми или отключенными. Невозможно выбрать элементы меню серым и отключено. Отключенный элемент выглядит так же, как и включенный элемент. Когда пользователь щелкает отключенный элемент, этот элемент не выбирается и ничего не происходит. Отключенные элементы могут быть полезны в, например, в учебнике, в котором отображается активное меню, но нет.

Приложение серого элемента меню недоступно, чтобы предоставить пользователю визуальную подсказку о том, что команда недоступна. Если действие не подходит, можно использовать серый элемент (например, если в системе не установлен принтер, в меню « **файл** » может быть серая команда « **Печать** »).

Функция [**енаблеменуитем**](/windows/desktop/api/Winuser/nf-winuser-enablemenuitem) включает, серый или отключает пункт меню. Чтобы определить, включен ли пункт меню (серый или отключен), используйте функцию [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa) .

Вместо [**жетменуитеминфо**](/windows/desktop/api/Winuser/nf-winuser-getmenuiteminfoa)можно также использовать функцию [**жетменустате**](/windows/desktop/api/Winuser/nf-winuser-getmenustate) , чтобы определить, включен ли элемент меню, серый или отключен.

### <a name="highlighted-menu-items"></a>Выделенные пункты меню

Система автоматически выделяет пункты меню в меню по мере их выбора пользователем. Однако выделение можно явно добавить или удалить из имени меню в строке меню с помощью функции [**хилитеменуитем**](/windows/desktop/api/Winuser/nf-winuser-hilitemenuitem) . Эта функция не влияет на пункты меню. Если **хилитеменуитем** используется для выделения имени меню, то отображается только выбранное имя. Если пользователь нажмет клавишу ВВОД, выделенный элемент не выбирается. Эта функция может быть полезной в, например, в обучающем приложении, которое демонстрирует использование меню.

### <a name="owner-drawn-menu-items"></a>Owner-Drawn пункты меню

Приложение может полностью управлять внешним видом элемента меню с помощью *рисуемого владельцем элемента*. Для элементов, рисуемых владельцем, требуется, чтобы приложение занимало общую ответственность за рисование выбранных (выделенных), выбранных и сброшенных состояний. Например, если приложение предоставляет меню шрифтов, оно может нарисовать каждый пункт меню с помощью соответствующего шрифта. элемент для Roman будет нарисован с помощью латиницы, а элемент для наклона будет нарисован курсивом и т. д. Дополнительные сведения см. в разделе [создание Owner-Drawn пунктов меню](using-menus.md).

### <a name="menu-item-separators-and-line-breaks"></a>Разделители пунктов меню и разрывы строк

Система предоставляет специальный тип пункта меню, называемый *разделителем*, который отображается горизонтальной линией. Можно использовать разделитель, чтобы разделить меню на группы связанных элементов. Разделитель не может быть использован в строке меню, и пользователь не может выбрать разделитель.

Если строка меню содержит больше названий меню, чем помещается на одной строке, система переносит строку меню, автоматически разбивая ее на две или несколько строк. Можно вызвать разрыв строки в определенном элементе строки меню, назначив этому элементу флаг типа **MFT \_ менубреак** . Система размещает этот элемент и все последующие элементы на новой строке.

Если меню содержит больше элементов, чем помещается в одном столбце, меню будет обрезано. Можно вызвать разрыв столбца в определенном элементе меню, назначив флаг типа **MFT \_ менубреак** для элемента или используя параметр Менубреак в инструкции [MenuItem](/windows/desktop/menurc/menuitem-statement) . Система размещает этот элемент и все последующие элементы в новом столбце. Флаг типа **MFT \_ менубарбреак** имеет тот же результат, за исключением того, что между новым и старым столбцами отображается вертикальная линия.

Если для назначения разрывов строк используются функции [**аппендмену**](/windows/desktop/api/Winuser/nf-winuser-appendmenua), [**инсертмену**](/windows/desktop/api/Winuser/nf-winuser-insertmenua)или [**модифимену**](/windows/desktop/api/Winuser/nf-winuser-modifymenua) , следует назначить флаги типа **MF \_ менубреак** или **MF \_ менубарбреак**.

## <a name="messages-used-with-menus"></a>Сообщения, используемые с меню

Действие системы, связанное с меню, отправляет сообщения в процедуру окна окна, которому принадлежит меню. Система отправляет ряд сообщений, когда пользователь выбирает элементы в строке меню или нажимает правую кнопку мыши для вывода контекстного меню.

Когда пользователь активирует элемент в строке меню, окно владельца сначала получает сообщение [**WM \_ сискомманд**](wm-syscommand.md) . Это сообщение содержит флаг, указывающий, активировало ли пользователь меню с помощью клавиатуры (SC \_ кэймену) или мыши (SC \_ маусемену). Дополнительные сведения см. [в разделе доступ с клавиатуры к меню](#keyboard-access-to-menus).

Далее, перед отображением меню система отправляет сообщение [**WM \_ инитмену**](wm-initmenu.md) в процедуру окна, чтобы приложение может изменить меню до того, как пользователь увидит их. Система отправляет сообщение **WM \_ инитмену** только один раз для активации меню.

Когда пользователь указывает на пункт меню, открывающий подменю, система отправляет окну-владельцу сообщение [**WM \_ инитменупопуп**](wm-initmenupopup.md) перед отображением подменю. Это сообщение дает приложению возможность изменить подменю перед его отображением.

Каждый раз, когда пользователь перемещает выделение с одного элемента на другой, система отправляет сообщение [**WM \_ менуселект**](wm-menuselect.md) в оконную процедуру окна "владелец" меню. Это сообщение обозначает выбранный в данный момент пункт меню. Многие приложения предоставляют информационную область в нижней части их основных окон и используют это сообщение для вывода дополнительных сведений о выбранном пункте меню.

Когда пользователь выбирает элемент команды из меню, система отправляет [**\_ командное сообщение WM**](wm-command.md) в процедуру окна. Слово низкого порядка в параметре wParam **\_ командного** сообщения WM  содержит идентификатор выбранного элемента. Процедура окна должна проверить идентификатор и соответствующим образом обработать сообщение.

Сведения о меню можно сохранить с помощью структуры [**менуинфо**](/windows/win32/api/winuser/ns-winuser-menuinfo) . Если меню определено с помощью **менуинфо**. **двстиле** значение MNS \_ нотифибипос, система отправляет [**WM \_ MENUCOMMAND**](wm-menucommand.md) вместо [**\_ команды WM**](wm-command.md) при выборе элемента. Это позволяет получить доступ к информации в структуре **менуинфо** , а также напрямую предоставить индекс выбранного элемента.

Не все меню доступны в строке меню окна. Во многих приложениях контекстное меню отображается, когда пользователь нажимает правую кнопку мыши в определенном месте. Такие приложения должны обрабатывать сообщение [**WM \_ CONTEXTMENU**](wm-contextmenu.md) и отображать контекстное меню, если это необходимо. Если в приложении не отображается контекстное меню, оно должно передать сообщение **WM \_ CONTEXTMENU** функции [**дефвиндовпрок**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) для обработки по умолчанию.

Сообщение [**WM \_ менурбуттонуп**](wm-menurbuttonup.md) отправляется, когда пользователь отпускает правую кнопку мыши, когда курсор находится над пунктом меню. Это сообщение предоставляется таким образом, чтобы приложения могли отобразить контекстное меню или контекстное меню для пункта меню.

Существует несколько сообщений, использующих только меню перетаскивания. [**WM \_ менужетобжект**](wm-menugetobject.md) отправляется владельцу меню перетаскивания, когда курсор мыши попадает в пункт меню или перемещается от центра элемента к верхнему или нижнему краю элемента. Сообщение [**WM \_ менудраг**](wm-menudrag.md) отправляется, когда пользователь фактически перетаскивает пункт меню.

При удалении раскрывающегося меню или подменю система отправляет сообщение [**WM \_ унинитменупопуп**](wm-uninitmenupopup.md) .

## <a name="menu-destruction"></a>Уничтожение меню

Если меню назначено окну и это окно уничтожается, система автоматически уничтожает меню и его подменю, освобождая маркер меню и память, занятую меню. Система не удаляет автоматически меню, которое не назначено окну. Приложение должно уничтожить Неназначенное меню, вызвав функцию [**дестроймену**](/windows/desktop/api/Winuser/nf-winuser-destroymenu) . В противном случае меню останется в памяти даже после закрытия приложения. Чтобы завершить активное меню вызывающего потока, используйте [**ендмену**](/windows/desktop/api/Winuser/nf-winuser-endmenu). Если платформа не поддерживает **ендмену**, отправляйте владельцу активного меню сообщение [**WM \_ канцелмоде**](/windows/desktop/winmsg/wm-cancelmode) .

 

 