---
title: О сочетаниях клавиш
description: В этом разделе обсуждаются сочетания клавиш.
ms.assetid: cbf7619d-289d-40c9-9a06-6ce47026d43f
keywords:
- Пользовательский интерфейс Windows, ввод данных пользователем
- Пользовательский интерфейс Windows, сочетания клавиш
- Ввод данных пользователем, сочетания клавиш
- захват вводимых пользователем данных, сочетания клавиш
- сочетания клавиш
- Accelerator
- Сообщение WM_COMMAND
- Сообщение команды WM_SYS
- таблицы сочетаний клавиш
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 88e97f0b4997d15d55601e571270276e7d7a3bd4
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2021
ms.locfileid: "113120379"
---
# <a name="about-keyboard-accelerators"></a>О сочетаниях клавиш

Сочетания клавиш тесно связаны с меню — они предоставляют пользователю доступ к набору команд приложения. Как правило, пользователи полагаются на меню приложения, чтобы узнать набор команд, а затем переключиться на использование ускорителей, так как они станут более хорошо подработаны с приложением. Ускорители обеспечивают более быстрый и непосредственный доступ к командам по сравнению с меню. Как минимум, приложение должно предоставлять ускорители для наиболее часто используемых команд. Хотя ускорители обычно создают команды, которые существуют как пункты меню, они также могут формировать команды, не имеющие эквивалентных пунктов меню.

В этом разделе рассматриваются следующие темы.

-   [Таблицы сочетаний клавиш](#accelerator-tables)
-   [Ускоритель — создание таблицы](#accelerator-table-creation)
-   [Назначение сочетаний клавиш](#accelerator-keystroke-assignments)
-   [Сочетания клавиш и меню](#accelerators-and-menus)
-   [Состояние пользовательского интерфейса](#ui-state)

## <a name="accelerator-tables"></a>Таблицы сочетаний клавиш

Таблица сочетаний клавиш состоит из массива несамостоятельных [**структур, каждый из которых**](/windows/win32/api/winuser/ns-winuser-accel) определяет отдельный ускоритель. Каждая **Структура** предоставляет следующие сведения:

-   Сочетание клавиш ускорителя.
-   Идентификатор ускорителя.
-   Различные флаги. Сюда входит один из них, который определяет, должна ли система предоставлять визуальную обратную связь, выделяя соответствующий пункт меню (если он есть) при использовании сочетания клавиш.

Чтобы обработать нажатия клавиш быстрого вызова для указанного потока, разработчик должен вызвать функцию [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) в цикле обработки сообщений, связанном с очередью сообщений потока. Функция **TranslateAccelerator** отслеживает ввод с клавиатуры в очереди сообщений, проверяя сочетания клавиш, соответствующие записи в таблице сочетаний клавиш. Когда **TranslateAccelerator** находит совпадение, он преобразует ввод с клавиатуры (то есть сообщения [**WM \_ KEYUP**](/windows/desktop/inputdev/wm-keyup) и [**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown) ) в [**\_ команду WM**](wm-command.md) или сообщение [**WM \_ сискомманд**](wm-syscommand.md) , а затем отправляет сообщение в процедуру окна указанного окна. На следующем рисунке показано, как обрабатываются ускорители.

![модель обработки сочетаний клавиш](images/cskac-01.png)

[**\_ Командное сообщение WM**](wm-command.md) содержит идентификатор ускорителя, вызвавший [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) создание сообщения. Процедура окна проверяет идентификатор, чтобы определить источник сообщения, а затем обрабатывает сообщение соответствующим образом.

Таблицы сочетаний клавиш существуют на двух разных уровнях. Система поддерживает единую системную таблицу сочетаний клавиш, которая применяется ко всем приложениям. Приложение не может изменить таблицу системных ускорителей. Описание сочетаний клавиш, предоставляемых таблицей системного ускорителя, см. в разделе [сочетания клавиш ускорителя](#accelerator-keystroke-assignments).

Система также поддерживает таблицы ускорителей для каждого приложения. Приложение может определить любое количество таблиц сочетаний клавиш для использования с собственными окнами. Уникальный 32-разрядный маркер (**хакцел**) определяет каждую таблицу. Однако для указанного потока может быть активна только одна таблица сочетаний клавиш. Маркер для таблицы сочетаний клавиш, переданный функции [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) , определяет, какая таблица сочетаний клавиш активна для потока. Таблицу активных сочетаний клавиш можно изменить в любое время, передав другой маркер-таблицу ускорителя в **TranslateAccelerator**.

## <a name="accelerator-table-creation"></a>Создание Accelerator-Table

Для создания таблицы сочетаний клавиш для приложения необходимо выполнить несколько действий. Во-первых, компилятор ресурсов используется для создания ресурсов таблицы ускорителя и их добавления в исполняемый файл приложения. Во время выполнения функция [**лоадакцелераторс**](/windows/desktop/api/Winuser/nf-winuser-loadacceleratorsa) используется для загрузки таблицы ускорителя в память и получения маркера в таблицу сочетаний клавиш. Этот обработчик передается функции [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) для активации таблицы сочетаний клавиш.

Таблицу сочетаний клавиш можно также создать для приложения во время выполнения, передав массив [**неиспользуемых структур**](/windows/win32/api/winuser/ns-winuser-accel) в функцию [**креатеакцелератортабле**](/windows/desktop/api/Winuser/nf-winuser-createacceleratortablea) . Этот метод поддерживает пользовательские ускорители в приложении. Как и функция [**лоадакцелераторс**](/windows/desktop/api/Winuser/nf-winuser-loadacceleratorsa) , **креатеакцелератортабле** возвращает маркер ускорителя, который можно передать в [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) для активации таблицы ускорителя.

Система автоматически уничтожает таблицы ускорителя, загруженные [**лоадакцелераторс**](/windows/desktop/api/Winuser/nf-winuser-loadacceleratorsa) или созданными [**креатеакцелератортабле**](/windows/desktop/api/Winuser/nf-winuser-createacceleratortablea). Однако приложение может освобождать ресурсы во время работы, уничтожая ненужные таблицы ускорителя, вызывая функцию [**дестройакцелератортабле**](/windows/desktop/api/Winuser/nf-winuser-destroyacceleratortable) .

Можно скопировать и изменить существующую таблицу сочетаний клавиш. Существующая таблица сочетаний клавиш копируется с помощью функции [**копякцелератортабле**](/windows/desktop/api/Winuser/nf-winuser-copyacceleratortablea) . После изменения копии происходит получение маркера новой таблицы сочетаний клавиш путем вызова [**креатеакцелератортабле**](/windows/desktop/api/Winuser/nf-winuser-createacceleratortablea). Наконец, этот маркер передается в [**TranslateAccelerator**](/windows/desktop/api/Winuser/nf-winuser-translateacceleratora) для активации новой таблицы.

## <a name="accelerator-keystroke-assignments"></a>Назначение сочетаний клавиш

Для определения сочетания клавиш можно использовать код символа ASCII или код виртуального ключа. Код символа ASCII позволяет учитывать регистр сочетаний клавиш. Таким образом, использование символа ASCII "C" определяет ускоритель как ALT + C, а не ALT + c. Однако сочетания клавиш с учетом регистра могут быть непонятны для использования. Например, сочетание клавиш ALT + C будет создано, если клавиша CAPS LOCK не нажата или нажата клавиша SHIFT, но не работает.

Как правило, сочетания клавиш не требуют учета регистра, поэтому большинство приложений используют коды виртуальных клавиш для ускорителей, а не кодов символов ASCII.

Избегайте использования ускорителей, которые конфликтуют с назначенными меню приложения, так как ускоритель переопределяет сочетание клавиш, которое может запутать пользователя. Дополнительные сведения о назначении клавиш меню см. в разделе [меню](menus.md).

Если приложение определяет ускоритель, который также определен в таблице системного ускорителя, то ускоритель, определяемый приложением, переопределяет системный ускоритель, но только в контексте приложения. Тем не менее, не рекомендуется использовать этот подход, так как он не позволяет системному ускорителю выполнять свою стандартную роль в пользовательском интерфейсе. В следующем списке описаны сочетания клавиш для всей системы.



| Accelerator                 | Описание                                                                                                      |
|------------------|-------------------------------------------------------------------------------------------------------|
| ALT + ESC          | Переключается на следующее приложение.                                                                     |
| ALT+F4           | Закрывает приложение или окно.                                                                    |
| ALT + ДЕФИС       | Открывает меню **окно** для окна документа.                                                      |
| ALT + ЭКРАН ПЕЧАТИ | Копирует изображение из активного окна в буфер обмена.                                              |
| ALT + ПРОБЕЛ     | Открывает меню **окно** для главного окна приложения.                                          |
| ALT+TAB          | Переключается на следующее приложение.                                                                     |
| CTRL + ESC         | Переключиться в меню " **Пуск** ".                                                                       |
| CTRL + F4          | Закрывает окно активной группы или документа.                                                           |
| F1               | Запускает файл справки приложения, если он существует.                                                    |
| ПЕЧАТЬ ЭКРАНА     | Копирует изображение с экрана на экран в буфер обмена.                                                     |
| SHIFT + ALT + TAB    | Переключиться на предыдущее приложение. Пользователь должен нажать и удерживать клавиши ALT + SHIFT при нажатии клавиши TAB. |



 

## <a name="accelerators-and-menus"></a>Сочетания клавиш и меню

Использование ускорителя аналогично выбору пункта меню: оба действия приводят к тому, что система отправляет [**\_ команду WM**](wm-command.md) или сообщение [**WM \_ сискомманд**](wm-syscommand.md) в соответствующую процедуру окна. **\_ Командное сообщение WM** содержит идентификатор, который процедура Window проверяет для определения источника сообщения. Если ускоритель создал **\_ командное сообщение WM** , идентификатором является ускоритель. Аналогично, если пункт меню сгенерировал **\_ командное сообщение WM** , идентификатором является элемент меню. Так как ускоритель предоставляет ярлык для выбора команды из меню, приложение обычно присваивает этому же идентификатору сочетание клавиш и соответствующий пункт меню.

Приложение обрабатывает [**\_ командное сообщение WM**](wm-command.md) в точно так же, как и соответствующий пункт меню **\_ командное сообщение WM** . Однако **\_ командное сообщение WM** содержит флаг, указывающий, порождено ли сообщение от ускорителя или пункта меню. в противном случае ускорители должны обрабатываться иначе, чем в соответствующих пунктах меню. Сообщение [**WM \_ сискомманд**](wm-syscommand.md) не содержит этот флаг.

Идентификатор определяет, создает ли ускоритель [**\_ команду WM**](wm-command.md) или сообщение [**WM \_ сискомманд**](wm-syscommand.md) . Если идентификатор имеет то же значение, что и пункт меню в системном меню, ускоритель создает сообщение **WM \_ сискомманд** . В противном случае ускоритель создает **\_ командное сообщение WM** .

Если сочетание клавиш имеет тот же идентификатор, что и элемент меню, и элемент меню является серым или отключенным, ускоритель отключается и не создает [**\_ команду WM**](wm-command.md) или сообщение [**\_ сискомманд WM**](wm-syscommand.md) . Кроме того, при сворачивании соответствующего окна ускоритель не создает командное сообщение.

Когда пользователь использует ускоритель, соответствующий пункту меню, процедура окна получает сообщения [**WM \_ Инитмену**](wm-initmenu.md) и [**WM \_ инитменупопуп**](wm-initmenupopup.md) , как будто пользователь выбрал пункт меню. Сведения о том, как обрабатывать эти сообщения, см. в разделе [меню](menus.md).

Ускоритель, соответствующий пункту меню, должен быть добавлен в текст элемента меню.

## <a name="ui-state"></a>Состояние пользовательского интерфейса

Windows позволяет приложениям скрывать или отображать различные функции в пользовательском интерфейсе. Эти параметры называются состоянием пользовательского интерфейса. Состояние пользовательского интерфейса включает следующие параметры:

-   индикаторы фокуса (например, прямоугольники фокуса на кнопках)
-   сочетания клавиш (обозначены подчеркиванием в метках элементов управления)

Окно может отправлять сообщения для запроса изменения состояния пользовательского интерфейса, может запрашивать состояние пользовательского интерфейса или принудительно применять определенное состояние для своих дочерних окон. Эти сообщения выглядят следующим образом.



| Сообщение                                       | Описание                                |
|-----------------------------------------------|--------------------------------------------|
| [**WM \_ чанжеуистате**](wm-changeuistate.md) | Указывает, что состояние пользовательского интерфейса должно измениться. |
| [**WM \_ куерюистате**](wm-queryuistate.md)   | Возвращает состояние пользовательского интерфейса для окна.       |
| [**WM \_ упдатеуистате**](wm-updateuistate.md) | Изменяет состояние пользовательского интерфейса.                      |



 

По умолчанию все дочерние окна окна верхнего уровня создаются с тем же состоянием пользовательского интерфейса, что и их родительский элемент.

Система обрабатывает состояние пользовательского интерфейса для элементов управления в диалоговых окнах. При создании диалогового окна система соответствующим образом Инициализирует состояние пользовательского интерфейса. Все дочерние элементы управления наследуют это состояние. После создания диалогового окна система отслеживает нажатия клавиш пользователя. Если параметры состояния пользовательского интерфейса скрыты и пользователь переходит с помощью клавиатуры, система обновляет состояние пользовательского интерфейса. Например, если пользователь нажимает клавишу TAB для перемещения фокуса на следующий элемент управления, система вызывает [**WM \_ чанжеуистате**](wm-changeuistate.md) , чтобы сделать индикаторы фокуса видимыми. Если пользователь нажимает клавишу Alt, система вызывает **WM \_ чанжеуистате** для отображения сочетаний клавиш.

Если элемент управления поддерживает навигацию между элементами пользовательского интерфейса, которые он содержит, он может обновить собственное состояние пользовательского интерфейса. Элемент управления может вызывать [**WM \_ куерюистате**](wm-queryuistate.md) для извлечения и кэширования ИСХОДНОГО состояния пользовательского интерфейса. Каждый раз, когда элемент управления получает сообщение [**WM \_ упдатеуистате**](wm-updateuistate.md) , он может обновить состояние пользовательского интерфейса и отправить сообщение [**WM \_ чанжеуистате**](wm-changeuistate.md) в родительский объект. Каждое окно продолжает отсылать сообщение родительскому окну, пока не достигнет окна верхнего уровня. Окно верхнего уровня отправляет сообщение **WM \_ упдатеуистате** в окна в дереве окна. Если окно не передает сообщение **\_ чанжеуистате WM** , оно не будет достигнуто на окно верхнего уровня, а состояние пользовательского интерфейса не будет обновлено.

 

 